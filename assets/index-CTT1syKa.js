function XL(n,e){for(var t=0;t<e.length;t++){const i=e[t];if(typeof i!="string"&&!Array.isArray(i)){for(const c in i)if(c!=="default"&&!(c in n)){const u=Object.getOwnPropertyDescriptor(i,c);u&&Object.defineProperty(n,c,u.get?u:{enumerable:!0,get:()=>i[c]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))i(c);new MutationObserver(c=>{for(const u of c)if(u.type==="childList")for(const m of u.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&i(m)}).observe(document,{childList:!0,subtree:!0});function t(c){const u={};return c.integrity&&(u.integrity=c.integrity),c.referrerPolicy&&(u.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?u.credentials="include":c.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function i(c){if(c.ep)return;c.ep=!0;const u=t(c);fetch(c.href,u)}})();var A$=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Zv(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function ZL(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function i(){var c=!1;try{c=this instanceof i}catch{}return c?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(i){var c=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,c.get?c:{enumerable:!0,get:function(){return n[i]}})}),t}var sb={exports:{}},xy={},ab={exports:{}},os={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _2;function YL(){if(_2)return os;_2=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),c=Symbol.for("react.profiler"),u=Symbol.for("react.provider"),m=Symbol.for("react.context"),_=Symbol.for("react.forward_ref"),o=Symbol.for("react.suspense"),b=Symbol.for("react.memo"),I=Symbol.for("react.lazy"),M=Symbol.iterator;function V(xe){return xe===null||typeof xe!="object"?null:(xe=M&&xe[M]||xe["@@iterator"],typeof xe=="function"?xe:null)}var k={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ie=Object.assign,se={};function fe(xe,le,De){this.props=xe,this.context=le,this.refs=se,this.updater=De||k}fe.prototype.isReactComponent={},fe.prototype.setState=function(xe,le){if(typeof xe!="object"&&typeof xe!="function"&&xe!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,xe,le,"setState")},fe.prototype.forceUpdate=function(xe){this.updater.enqueueForceUpdate(this,xe,"forceUpdate")};function J(){}J.prototype=fe.prototype;function ne(xe,le,De){this.props=xe,this.context=le,this.refs=se,this.updater=De||k}var me=ne.prototype=new J;me.constructor=ne,ie(me,fe.prototype),me.isPureReactComponent=!0;var ue=Array.isArray,ke=Object.prototype.hasOwnProperty,je={current:null},pe={key:!0,ref:!0,__self:!0,__source:!0};function U(xe,le,De){var Be,Ye={},rt=null,mt=null;if(le!=null)for(Be in le.ref!==void 0&&(mt=le.ref),le.key!==void 0&&(rt=""+le.key),le)ke.call(le,Be)&&!pe.hasOwnProperty(Be)&&(Ye[Be]=le[Be]);var ft=arguments.length-2;if(ft===1)Ye.children=De;else if(1<ft){for(var Dt=Array(ft),Yt=0;Yt<ft;Yt++)Dt[Yt]=arguments[Yt+2];Ye.children=Dt}if(xe&&xe.defaultProps)for(Be in ft=xe.defaultProps,ft)Ye[Be]===void 0&&(Ye[Be]=ft[Be]);return{$$typeof:n,type:xe,key:rt,ref:mt,props:Ye,_owner:je.current}}function F(xe,le){return{$$typeof:n,type:xe.type,key:le,ref:xe.ref,props:xe.props,_owner:xe._owner}}function q(xe){return typeof xe=="object"&&xe!==null&&xe.$$typeof===n}function j(xe){var le={"=":"=0",":":"=2"};return"$"+xe.replace(/[=:]/g,function(De){return le[De]})}var H=/\/+/g;function Z(xe,le){return typeof xe=="object"&&xe!==null&&xe.key!=null?j(""+xe.key):le.toString(36)}function be(xe,le,De,Be,Ye){var rt=typeof xe;(rt==="undefined"||rt==="boolean")&&(xe=null);var mt=!1;if(xe===null)mt=!0;else switch(rt){case"string":case"number":mt=!0;break;case"object":switch(xe.$$typeof){case n:case e:mt=!0}}if(mt)return mt=xe,Ye=Ye(mt),xe=Be===""?"."+Z(mt,0):Be,ue(Ye)?(De="",xe!=null&&(De=xe.replace(H,"$&/")+"/"),be(Ye,le,De,"",function(Yt){return Yt})):Ye!=null&&(q(Ye)&&(Ye=F(Ye,De+(!Ye.key||mt&&mt.key===Ye.key?"":(""+Ye.key).replace(H,"$&/")+"/")+xe)),le.push(Ye)),1;if(mt=0,Be=Be===""?".":Be+":",ue(xe))for(var ft=0;ft<xe.length;ft++){rt=xe[ft];var Dt=Be+Z(rt,ft);mt+=be(rt,le,De,Dt,Ye)}else if(Dt=V(xe),typeof Dt=="function")for(xe=Dt.call(xe),ft=0;!(rt=xe.next()).done;)rt=rt.value,Dt=Be+Z(rt,ft++),mt+=be(rt,le,De,Dt,Ye);else if(rt==="object")throw le=String(xe),Error("Objects are not valid as a React child (found: "+(le==="[object Object]"?"object with keys {"+Object.keys(xe).join(", ")+"}":le)+"). If you meant to render a collection of children, use an array instead.");return mt}function Re(xe,le,De){if(xe==null)return xe;var Be=[],Ye=0;return be(xe,Be,"","",function(rt){return le.call(De,rt,Ye++)}),Be}function Oe(xe){if(xe._status===-1){var le=xe._result;le=le(),le.then(function(De){(xe._status===0||xe._status===-1)&&(xe._status=1,xe._result=De)},function(De){(xe._status===0||xe._status===-1)&&(xe._status=2,xe._result=De)}),xe._status===-1&&(xe._status=0,xe._result=le)}if(xe._status===1)return xe._result.default;throw xe._result}var Ne={current:null},we={transition:null},Fe={ReactCurrentDispatcher:Ne,ReactCurrentBatchConfig:we,ReactCurrentOwner:je};function nt(){throw Error("act(...) is not supported in production builds of React.")}return os.Children={map:Re,forEach:function(xe,le,De){Re(xe,function(){le.apply(this,arguments)},De)},count:function(xe){var le=0;return Re(xe,function(){le++}),le},toArray:function(xe){return Re(xe,function(le){return le})||[]},only:function(xe){if(!q(xe))throw Error("React.Children.only expected to receive a single React element child.");return xe}},os.Component=fe,os.Fragment=t,os.Profiler=c,os.PureComponent=ne,os.StrictMode=i,os.Suspense=o,os.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Fe,os.act=nt,os.cloneElement=function(xe,le,De){if(xe==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+xe+".");var Be=ie({},xe.props),Ye=xe.key,rt=xe.ref,mt=xe._owner;if(le!=null){if(le.ref!==void 0&&(rt=le.ref,mt=je.current),le.key!==void 0&&(Ye=""+le.key),xe.type&&xe.type.defaultProps)var ft=xe.type.defaultProps;for(Dt in le)ke.call(le,Dt)&&!pe.hasOwnProperty(Dt)&&(Be[Dt]=le[Dt]===void 0&&ft!==void 0?ft[Dt]:le[Dt])}var Dt=arguments.length-2;if(Dt===1)Be.children=De;else if(1<Dt){ft=Array(Dt);for(var Yt=0;Yt<Dt;Yt++)ft[Yt]=arguments[Yt+2];Be.children=ft}return{$$typeof:n,type:xe.type,key:Ye,ref:rt,props:Be,_owner:mt}},os.createContext=function(xe){return xe={$$typeof:m,_currentValue:xe,_currentValue2:xe,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},xe.Provider={$$typeof:u,_context:xe},xe.Consumer=xe},os.createElement=U,os.createFactory=function(xe){var le=U.bind(null,xe);return le.type=xe,le},os.createRef=function(){return{current:null}},os.forwardRef=function(xe){return{$$typeof:_,render:xe}},os.isValidElement=q,os.lazy=function(xe){return{$$typeof:I,_payload:{_status:-1,_result:xe},_init:Oe}},os.memo=function(xe,le){return{$$typeof:b,type:xe,compare:le===void 0?null:le}},os.startTransition=function(xe){var le=we.transition;we.transition={};try{xe()}finally{we.transition=le}},os.unstable_act=nt,os.useCallback=function(xe,le){return Ne.current.useCallback(xe,le)},os.useContext=function(xe){return Ne.current.useContext(xe)},os.useDebugValue=function(){},os.useDeferredValue=function(xe){return Ne.current.useDeferredValue(xe)},os.useEffect=function(xe,le){return Ne.current.useEffect(xe,le)},os.useId=function(){return Ne.current.useId()},os.useImperativeHandle=function(xe,le,De){return Ne.current.useImperativeHandle(xe,le,De)},os.useInsertionEffect=function(xe,le){return Ne.current.useInsertionEffect(xe,le)},os.useLayoutEffect=function(xe,le){return Ne.current.useLayoutEffect(xe,le)},os.useMemo=function(xe,le){return Ne.current.useMemo(xe,le)},os.useReducer=function(xe,le,De){return Ne.current.useReducer(xe,le,De)},os.useRef=function(xe){return Ne.current.useRef(xe)},os.useState=function(xe){return Ne.current.useState(xe)},os.useSyncExternalStore=function(xe,le,De){return Ne.current.useSyncExternalStore(xe,le,De)},os.useTransition=function(){return Ne.current.useTransition()},os.version="18.3.1",os}var v2;function pw(){return v2||(v2=1,ab.exports=YL()),ab.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var x2;function JL(){if(x2)return xy;x2=1;var n=pw(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,c=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function m(_,o,b){var I,M={},V=null,k=null;b!==void 0&&(V=""+b),o.key!==void 0&&(V=""+o.key),o.ref!==void 0&&(k=o.ref);for(I in o)i.call(o,I)&&!u.hasOwnProperty(I)&&(M[I]=o[I]);if(_&&_.defaultProps)for(I in o=_.defaultProps,o)M[I]===void 0&&(M[I]=o[I]);return{$$typeof:e,type:_,key:V,ref:k,props:M,_owner:c.current}}return xy.Fragment=t,xy.jsx=m,xy.jsxs=m,xy}var b2;function QL(){return b2||(b2=1,sb.exports=JL()),sb.exports}var Y=QL(),Nn=pw();const eP=Zv(Nn),tP=XL({__proto__:null,default:eP},[Nn]);var c1={},lb={exports:{}},Xh={},cb={exports:{}},ub={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var w2;function nP(){return w2||(w2=1,(function(n){function e(we,Fe){var nt=we.length;we.push(Fe);e:for(;0<nt;){var xe=nt-1>>>1,le=we[xe];if(0<c(le,Fe))we[xe]=Fe,we[nt]=le,nt=xe;else break e}}function t(we){return we.length===0?null:we[0]}function i(we){if(we.length===0)return null;var Fe=we[0],nt=we.pop();if(nt!==Fe){we[0]=nt;e:for(var xe=0,le=we.length,De=le>>>1;xe<De;){var Be=2*(xe+1)-1,Ye=we[Be],rt=Be+1,mt=we[rt];if(0>c(Ye,nt))rt<le&&0>c(mt,Ye)?(we[xe]=mt,we[rt]=nt,xe=rt):(we[xe]=Ye,we[Be]=nt,xe=Be);else if(rt<le&&0>c(mt,nt))we[xe]=mt,we[rt]=nt,xe=rt;else break e}}return Fe}function c(we,Fe){var nt=we.sortIndex-Fe.sortIndex;return nt!==0?nt:we.id-Fe.id}if(typeof performance=="object"&&typeof performance.now=="function"){var u=performance;n.unstable_now=function(){return u.now()}}else{var m=Date,_=m.now();n.unstable_now=function(){return m.now()-_}}var o=[],b=[],I=1,M=null,V=3,k=!1,ie=!1,se=!1,fe=typeof setTimeout=="function"?setTimeout:null,J=typeof clearTimeout=="function"?clearTimeout:null,ne=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function me(we){for(var Fe=t(b);Fe!==null;){if(Fe.callback===null)i(b);else if(Fe.startTime<=we)i(b),Fe.sortIndex=Fe.expirationTime,e(o,Fe);else break;Fe=t(b)}}function ue(we){if(se=!1,me(we),!ie)if(t(o)!==null)ie=!0,Oe(ke);else{var Fe=t(b);Fe!==null&&Ne(ue,Fe.startTime-we)}}function ke(we,Fe){ie=!1,se&&(se=!1,J(U),U=-1),k=!0;var nt=V;try{for(me(Fe),M=t(o);M!==null&&(!(M.expirationTime>Fe)||we&&!j());){var xe=M.callback;if(typeof xe=="function"){M.callback=null,V=M.priorityLevel;var le=xe(M.expirationTime<=Fe);Fe=n.unstable_now(),typeof le=="function"?M.callback=le:M===t(o)&&i(o),me(Fe)}else i(o);M=t(o)}if(M!==null)var De=!0;else{var Be=t(b);Be!==null&&Ne(ue,Be.startTime-Fe),De=!1}return De}finally{M=null,V=nt,k=!1}}var je=!1,pe=null,U=-1,F=5,q=-1;function j(){return!(n.unstable_now()-q<F)}function H(){if(pe!==null){var we=n.unstable_now();q=we;var Fe=!0;try{Fe=pe(!0,we)}finally{Fe?Z():(je=!1,pe=null)}}else je=!1}var Z;if(typeof ne=="function")Z=function(){ne(H)};else if(typeof MessageChannel<"u"){var be=new MessageChannel,Re=be.port2;be.port1.onmessage=H,Z=function(){Re.postMessage(null)}}else Z=function(){fe(H,0)};function Oe(we){pe=we,je||(je=!0,Z())}function Ne(we,Fe){U=fe(function(){we(n.unstable_now())},Fe)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(we){we.callback=null},n.unstable_continueExecution=function(){ie||k||(ie=!0,Oe(ke))},n.unstable_forceFrameRate=function(we){0>we||125<we?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<we?Math.floor(1e3/we):5},n.unstable_getCurrentPriorityLevel=function(){return V},n.unstable_getFirstCallbackNode=function(){return t(o)},n.unstable_next=function(we){switch(V){case 1:case 2:case 3:var Fe=3;break;default:Fe=V}var nt=V;V=Fe;try{return we()}finally{V=nt}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(we,Fe){switch(we){case 1:case 2:case 3:case 4:case 5:break;default:we=3}var nt=V;V=we;try{return Fe()}finally{V=nt}},n.unstable_scheduleCallback=function(we,Fe,nt){var xe=n.unstable_now();switch(typeof nt=="object"&&nt!==null?(nt=nt.delay,nt=typeof nt=="number"&&0<nt?xe+nt:xe):nt=xe,we){case 1:var le=-1;break;case 2:le=250;break;case 5:le=1073741823;break;case 4:le=1e4;break;default:le=5e3}return le=nt+le,we={id:I++,callback:Fe,priorityLevel:we,startTime:nt,expirationTime:le,sortIndex:-1},nt>xe?(we.sortIndex=nt,e(b,we),t(o)===null&&we===t(b)&&(se?(J(U),U=-1):se=!0,Ne(ue,nt-xe))):(we.sortIndex=le,e(o,we),ie||k||(ie=!0,Oe(ke))),we},n.unstable_shouldYield=j,n.unstable_wrapCallback=function(we){var Fe=V;return function(){var nt=V;V=Fe;try{return we.apply(this,arguments)}finally{V=nt}}}})(ub)),ub}var S2;function rP(){return S2||(S2=1,cb.exports=nP()),cb.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var E2;function iP(){if(E2)return Xh;E2=1;var n=pw(),e=rP();function t(d){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+d,E=1;E<arguments.length;E++)g+="&args[]="+encodeURIComponent(arguments[E]);return"Minified React error #"+d+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,c={};function u(d,g){m(d,g),m(d+"Capture",g)}function m(d,g){for(c[d]=g,d=0;d<g.length;d++)i.add(g[d])}var _=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),o=Object.prototype.hasOwnProperty,b=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,I={},M={};function V(d){return o.call(M,d)?!0:o.call(I,d)?!1:b.test(d)?M[d]=!0:(I[d]=!0,!1)}function k(d,g,E,D){if(E!==null&&E.type===0)return!1;switch(typeof g){case"function":case"symbol":return!0;case"boolean":return D?!1:E!==null?!E.acceptsBooleans:(d=d.toLowerCase().slice(0,5),d!=="data-"&&d!=="aria-");default:return!1}}function ie(d,g,E,D){if(g===null||typeof g>"u"||k(d,g,E,D))return!0;if(D)return!1;if(E!==null)switch(E.type){case 3:return!g;case 4:return g===!1;case 5:return isNaN(g);case 6:return isNaN(g)||1>g}return!1}function se(d,g,E,D,K,ce,Ve){this.acceptsBooleans=g===2||g===3||g===4,this.attributeName=D,this.attributeNamespace=K,this.mustUseProperty=E,this.propertyName=d,this.type=g,this.sanitizeURL=ce,this.removeEmptyString=Ve}var fe={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(d){fe[d]=new se(d,0,!1,d,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(d){var g=d[0];fe[g]=new se(g,1,!1,d[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(d){fe[d]=new se(d,2,!1,d.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(d){fe[d]=new se(d,2,!1,d,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(d){fe[d]=new se(d,3,!1,d.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(d){fe[d]=new se(d,3,!0,d,null,!1,!1)}),["capture","download"].forEach(function(d){fe[d]=new se(d,4,!1,d,null,!1,!1)}),["cols","rows","size","span"].forEach(function(d){fe[d]=new se(d,6,!1,d,null,!1,!1)}),["rowSpan","start"].forEach(function(d){fe[d]=new se(d,5,!1,d.toLowerCase(),null,!1,!1)});var J=/[\-:]([a-z])/g;function ne(d){return d[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(d){var g=d.replace(J,ne);fe[g]=new se(g,1,!1,d,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(d){var g=d.replace(J,ne);fe[g]=new se(g,1,!1,d,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(d){var g=d.replace(J,ne);fe[g]=new se(g,1,!1,d,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(d){fe[d]=new se(d,1,!1,d.toLowerCase(),null,!1,!1)}),fe.xlinkHref=new se("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(d){fe[d]=new se(d,1,!1,d.toLowerCase(),null,!0,!0)});function me(d,g,E,D){var K=fe.hasOwnProperty(g)?fe[g]:null;(K!==null?K.type!==0:D||!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(ie(g,E,K,D)&&(E=null),D||K===null?V(g)&&(E===null?d.removeAttribute(g):d.setAttribute(g,""+E)):K.mustUseProperty?d[K.propertyName]=E===null?K.type===3?!1:"":E:(g=K.attributeName,D=K.attributeNamespace,E===null?d.removeAttribute(g):(K=K.type,E=K===3||K===4&&E===!0?"":""+E,D?d.setAttributeNS(D,g,E):d.setAttribute(g,E))))}var ue=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ke=Symbol.for("react.element"),je=Symbol.for("react.portal"),pe=Symbol.for("react.fragment"),U=Symbol.for("react.strict_mode"),F=Symbol.for("react.profiler"),q=Symbol.for("react.provider"),j=Symbol.for("react.context"),H=Symbol.for("react.forward_ref"),Z=Symbol.for("react.suspense"),be=Symbol.for("react.suspense_list"),Re=Symbol.for("react.memo"),Oe=Symbol.for("react.lazy"),Ne=Symbol.for("react.offscreen"),we=Symbol.iterator;function Fe(d){return d===null||typeof d!="object"?null:(d=we&&d[we]||d["@@iterator"],typeof d=="function"?d:null)}var nt=Object.assign,xe;function le(d){if(xe===void 0)try{throw Error()}catch(E){var g=E.stack.trim().match(/\n( *(at )?)/);xe=g&&g[1]||""}return`
`+xe+d}var De=!1;function Be(d,g){if(!d||De)return"";De=!0;var E=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(_n){var D=_n}Reflect.construct(d,[],g)}else{try{g.call()}catch(_n){D=_n}d.call(g.prototype)}else{try{throw Error()}catch(_n){D=_n}d()}}catch(_n){if(_n&&D&&typeof _n.stack=="string"){for(var K=_n.stack.split(`
`),ce=D.stack.split(`
`),Ve=K.length-1,St=ce.length-1;1<=Ve&&0<=St&&K[Ve]!==ce[St];)St--;for(;1<=Ve&&0<=St;Ve--,St--)if(K[Ve]!==ce[St]){if(Ve!==1||St!==1)do if(Ve--,St--,0>St||K[Ve]!==ce[St]){var Ot=`
`+K[Ve].replace(" at new "," at ");return d.displayName&&Ot.includes("<anonymous>")&&(Ot=Ot.replace("<anonymous>",d.displayName)),Ot}while(1<=Ve&&0<=St);break}}}finally{De=!1,Error.prepareStackTrace=E}return(d=d?d.displayName||d.name:"")?le(d):""}function Ye(d){switch(d.tag){case 5:return le(d.type);case 16:return le("Lazy");case 13:return le("Suspense");case 19:return le("SuspenseList");case 0:case 2:case 15:return d=Be(d.type,!1),d;case 11:return d=Be(d.type.render,!1),d;case 1:return d=Be(d.type,!0),d;default:return""}}function rt(d){if(d==null)return null;if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case pe:return"Fragment";case je:return"Portal";case F:return"Profiler";case U:return"StrictMode";case Z:return"Suspense";case be:return"SuspenseList"}if(typeof d=="object")switch(d.$$typeof){case j:return(d.displayName||"Context")+".Consumer";case q:return(d._context.displayName||"Context")+".Provider";case H:var g=d.render;return d=d.displayName,d||(d=g.displayName||g.name||"",d=d!==""?"ForwardRef("+d+")":"ForwardRef"),d;case Re:return g=d.displayName||null,g!==null?g:rt(d.type)||"Memo";case Oe:g=d._payload,d=d._init;try{return rt(d(g))}catch{}}return null}function mt(d){var g=d.type;switch(d.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return d=g.render,d=d.displayName||d.name||"",g.displayName||(d!==""?"ForwardRef("+d+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return rt(g);case 8:return g===U?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function ft(d){switch(typeof d){case"boolean":case"number":case"string":case"undefined":return d;case"object":return d;default:return""}}function Dt(d){var g=d.type;return(d=d.nodeName)&&d.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function Yt(d){var g=Dt(d)?"checked":"value",E=Object.getOwnPropertyDescriptor(d.constructor.prototype,g),D=""+d[g];if(!d.hasOwnProperty(g)&&typeof E<"u"&&typeof E.get=="function"&&typeof E.set=="function"){var K=E.get,ce=E.set;return Object.defineProperty(d,g,{configurable:!0,get:function(){return K.call(this)},set:function(Ve){D=""+Ve,ce.call(this,Ve)}}),Object.defineProperty(d,g,{enumerable:E.enumerable}),{getValue:function(){return D},setValue:function(Ve){D=""+Ve},stopTracking:function(){d._valueTracker=null,delete d[g]}}}}function cn(d){d._valueTracker||(d._valueTracker=Yt(d))}function gn(d){if(!d)return!1;var g=d._valueTracker;if(!g)return!0;var E=g.getValue(),D="";return d&&(D=Dt(d)?d.checked?"true":"false":d.value),d=D,d!==E?(g.setValue(d),!0):!1}function Mn(d){if(d=d||(typeof document<"u"?document:void 0),typeof d>"u")return null;try{return d.activeElement||d.body}catch{return d.body}}function Gt(d,g){var E=g.checked;return nt({},g,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:E??d._wrapperState.initialChecked})}function st(d,g){var E=g.defaultValue==null?"":g.defaultValue,D=g.checked!=null?g.checked:g.defaultChecked;E=ft(g.value!=null?g.value:E),d._wrapperState={initialChecked:D,initialValue:E,controlled:g.type==="checkbox"||g.type==="radio"?g.checked!=null:g.value!=null}}function mr(d,g){g=g.checked,g!=null&&me(d,"checked",g,!1)}function Er(d,g){mr(d,g);var E=ft(g.value),D=g.type;if(E!=null)D==="number"?(E===0&&d.value===""||d.value!=E)&&(d.value=""+E):d.value!==""+E&&(d.value=""+E);else if(D==="submit"||D==="reset"){d.removeAttribute("value");return}g.hasOwnProperty("value")?Ln(d,g.type,E):g.hasOwnProperty("defaultValue")&&Ln(d,g.type,ft(g.defaultValue)),g.checked==null&&g.defaultChecked!=null&&(d.defaultChecked=!!g.defaultChecked)}function Cr(d,g,E){if(g.hasOwnProperty("value")||g.hasOwnProperty("defaultValue")){var D=g.type;if(!(D!=="submit"&&D!=="reset"||g.value!==void 0&&g.value!==null))return;g=""+d._wrapperState.initialValue,E||g===d.value||(d.value=g),d.defaultValue=g}E=d.name,E!==""&&(d.name=""),d.defaultChecked=!!d._wrapperState.initialChecked,E!==""&&(d.name=E)}function Ln(d,g,E){(g!=="number"||Mn(d.ownerDocument)!==d)&&(E==null?d.defaultValue=""+d._wrapperState.initialValue:d.defaultValue!==""+E&&(d.defaultValue=""+E))}var ir=Array.isArray;function er(d,g,E,D){if(d=d.options,g){g={};for(var K=0;K<E.length;K++)g["$"+E[K]]=!0;for(E=0;E<d.length;E++)K=g.hasOwnProperty("$"+d[E].value),d[E].selected!==K&&(d[E].selected=K),K&&D&&(d[E].defaultSelected=!0)}else{for(E=""+ft(E),g=null,K=0;K<d.length;K++){if(d[K].value===E){d[K].selected=!0,D&&(d[K].defaultSelected=!0);return}g!==null||d[K].disabled||(g=d[K])}g!==null&&(g.selected=!0)}}function Yr(d,g){if(g.dangerouslySetInnerHTML!=null)throw Error(t(91));return nt({},g,{value:void 0,defaultValue:void 0,children:""+d._wrapperState.initialValue})}function Vt(d,g){var E=g.value;if(E==null){if(E=g.children,g=g.defaultValue,E!=null){if(g!=null)throw Error(t(92));if(ir(E)){if(1<E.length)throw Error(t(93));E=E[0]}g=E}g==null&&(g=""),E=g}d._wrapperState={initialValue:ft(E)}}function Pn(d,g){var E=ft(g.value),D=ft(g.defaultValue);E!=null&&(E=""+E,E!==d.value&&(d.value=E),g.defaultValue==null&&d.defaultValue!==E&&(d.defaultValue=E)),D!=null&&(d.defaultValue=""+D)}function Gn(d){var g=d.textContent;g===d._wrapperState.initialValue&&g!==""&&g!==null&&(d.value=g)}function Dn(d){switch(d){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Mr(d,g){return d==null||d==="http://www.w3.org/1999/xhtml"?Dn(g):d==="http://www.w3.org/2000/svg"&&g==="foreignObject"?"http://www.w3.org/1999/xhtml":d}var wr,Tr=(function(d){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(g,E,D,K){MSApp.execUnsafeLocalFunction(function(){return d(g,E,D,K)})}:d})(function(d,g){if(d.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in d)d.innerHTML=g;else{for(wr=wr||document.createElement("div"),wr.innerHTML="<svg>"+g.valueOf().toString()+"</svg>",g=wr.firstChild;d.firstChild;)d.removeChild(d.firstChild);for(;g.firstChild;)d.appendChild(g.firstChild)}});function Ir(d,g){if(g){var E=d.firstChild;if(E&&E===d.lastChild&&E.nodeType===3){E.nodeValue=g;return}}d.textContent=g}var Pr={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ei=["Webkit","ms","Moz","O"];Object.keys(Pr).forEach(function(d){Ei.forEach(function(g){g=g+d.charAt(0).toUpperCase()+d.substring(1),Pr[g]=Pr[d]})});function Pi(d,g,E){return g==null||typeof g=="boolean"||g===""?"":E||typeof g!="number"||g===0||Pr.hasOwnProperty(d)&&Pr[d]?(""+g).trim():g+"px"}function or(d,g){d=d.style;for(var E in g)if(g.hasOwnProperty(E)){var D=E.indexOf("--")===0,K=Pi(E,g[E],D);E==="float"&&(E="cssFloat"),D?d.setProperty(E,K):d[E]=K}}var oi=nt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Kr(d,g){if(g){if(oi[d]&&(g.children!=null||g.dangerouslySetInnerHTML!=null))throw Error(t(137,d));if(g.dangerouslySetInnerHTML!=null){if(g.children!=null)throw Error(t(60));if(typeof g.dangerouslySetInnerHTML!="object"||!("__html"in g.dangerouslySetInnerHTML))throw Error(t(61))}if(g.style!=null&&typeof g.style!="object")throw Error(t(62))}}function Br(d,g){if(d.indexOf("-")===-1)return typeof g.is=="string";switch(d){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var di=null;function si(d){return d=d.target||d.srcElement||window,d.correspondingUseElement&&(d=d.correspondingUseElement),d.nodeType===3?d.parentNode:d}var ut=null,Ee=null,Ie=null;function Qe(d){if(d=_u(d)){if(typeof ut!="function")throw Error(t(280));var g=d.stateNode;g&&(g=vu(g),ut(d.stateNode,d.type,g))}}function ht(d){Ee?Ie?Ie.push(d):Ie=[d]:Ee=d}function Ct(){if(Ee){var d=Ee,g=Ie;if(Ie=Ee=null,Qe(d),g)for(d=0;d<g.length;d++)Qe(g[d])}}function Mt(d,g){return d(g)}function Bt(){}var Et=!1;function Pt(d,g,E){if(Et)return d(g,E);Et=!0;try{return Mt(d,g,E)}finally{Et=!1,(Ee!==null||Ie!==null)&&(Bt(),Ct())}}function vn(d,g){var E=d.stateNode;if(E===null)return null;var D=vu(E);if(D===null)return null;E=D[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(D=!D.disabled)||(d=d.type,D=!(d==="button"||d==="input"||d==="select"||d==="textarea")),d=!D;break e;default:d=!1}if(d)return null;if(E&&typeof E!="function")throw Error(t(231,g,typeof E));return E}var Bn=!1;if(_)try{var Tn={};Object.defineProperty(Tn,"passive",{get:function(){Bn=!0}}),window.addEventListener("test",Tn,Tn),window.removeEventListener("test",Tn,Tn)}catch{Bn=!1}function kr(d,g,E,D,K,ce,Ve,St,Ot){var _n=Array.prototype.slice.call(arguments,3);try{g.apply(E,_n)}catch(rr){this.onError(rr)}}var Lr=!1,Vr=null,Ar=!1,Ai=null,no={onError:function(d){Lr=!0,Vr=d}};function yo(d,g,E,D,K,ce,Ve,St,Ot){Lr=!1,Vr=null,kr.apply(no,arguments)}function $o(d,g,E,D,K,ce,Ve,St,Ot){if(yo.apply(this,arguments),Lr){if(Lr){var _n=Vr;Lr=!1,Vr=null}else throw Error(t(198));Ar||(Ar=!0,Ai=_n)}}function ro(d){var g=d,E=d;if(d.alternate)for(;g.return;)g=g.return;else{d=g;do g=d,(g.flags&4098)!==0&&(E=g.return),d=g.return;while(d)}return g.tag===3?E:null}function ys(d){if(d.tag===13){var g=d.memoizedState;if(g===null&&(d=d.alternate,d!==null&&(g=d.memoizedState)),g!==null)return g.dehydrated}return null}function io(d){if(ro(d)!==d)throw Error(t(188))}function Is(d){var g=d.alternate;if(!g){if(g=ro(d),g===null)throw Error(t(188));return g!==d?null:d}for(var E=d,D=g;;){var K=E.return;if(K===null)break;var ce=K.alternate;if(ce===null){if(D=K.return,D!==null){E=D;continue}break}if(K.child===ce.child){for(ce=K.child;ce;){if(ce===E)return io(K),d;if(ce===D)return io(K),g;ce=ce.sibling}throw Error(t(188))}if(E.return!==D.return)E=K,D=ce;else{for(var Ve=!1,St=K.child;St;){if(St===E){Ve=!0,E=K,D=ce;break}if(St===D){Ve=!0,D=K,E=ce;break}St=St.sibling}if(!Ve){for(St=ce.child;St;){if(St===E){Ve=!0,E=ce,D=K;break}if(St===D){Ve=!0,D=ce,E=K;break}St=St.sibling}if(!Ve)throw Error(t(189))}}if(E.alternate!==D)throw Error(t(190))}if(E.tag!==3)throw Error(t(188));return E.stateNode.current===E?d:g}function ga(d){return d=Is(d),d!==null?gl(d):null}function gl(d){if(d.tag===5||d.tag===6)return d;for(d=d.child;d!==null;){var g=gl(d);if(g!==null)return g;d=d.sibling}return null}var sl=e.unstable_scheduleCallback,Wi=e.unstable_cancelCallback,Jl=e.unstable_shouldYield,Lu=e.unstable_requestPaint,Eo=e.unstable_now,fu=e.unstable_getCurrentPriorityLevel,Ea=e.unstable_ImmediatePriority,Ko=e.unstable_UserBlockingPriority,Xa=e.unstable_NormalPriority,Nl=e.unstable_LowPriority,Ql=e.unstable_IdlePriority,Aa=null,sa=null;function dn(d){if(sa&&typeof sa.onCommitFiberRoot=="function")try{sa.onCommitFiberRoot(Aa,d,void 0,(d.current.flags&128)===128)}catch{}}var Xo=Math.clz32?Math.clz32:pu,ss=Math.log,xi=Math.LN2;function pu(d){return d>>>=0,d===0?32:31-(ss(d)/xi|0)|0}var Za=64,Ya=4194304;function al(d){switch(d&-d){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return d&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return d}}function Cs(d,g){var E=d.pendingLanes;if(E===0)return 0;var D=0,K=d.suspendedLanes,ce=d.pingedLanes,Ve=E&268435455;if(Ve!==0){var St=Ve&~K;St!==0?D=al(St):(ce&=Ve,ce!==0&&(D=al(ce)))}else Ve=E&~K,Ve!==0?D=al(Ve):ce!==0&&(D=al(ce));if(D===0)return 0;if(g!==0&&g!==D&&(g&K)===0&&(K=D&-D,ce=g&-g,K>=ce||K===16&&(ce&4194240)!==0))return g;if((D&4)!==0&&(D|=E&16),g=d.entangledLanes,g!==0)for(d=d.entanglements,g&=D;0<g;)E=31-Xo(g),K=1<<E,D|=d[E],g&=~K;return D}function tr(d,g){switch(d){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function zr(d,g){for(var E=d.suspendedLanes,D=d.pingedLanes,K=d.expirationTimes,ce=d.pendingLanes;0<ce;){var Ve=31-Xo(ce),St=1<<Ve,Ot=K[Ve];Ot===-1?((St&E)===0||(St&D)!==0)&&(K[Ve]=tr(St,g)):Ot<=g&&(d.expiredLanes|=St),ce&=~St}}function Nr(d){return d=d.pendingLanes&-1073741825,d!==0?d:d&1073741824?1073741824:0}function js(){var d=Za;return Za<<=1,(Za&4194240)===0&&(Za=64),d}function Ta(d){for(var g=[],E=0;31>E;E++)g.push(d);return g}function bi(d,g,E){d.pendingLanes|=g,g!==536870912&&(d.suspendedLanes=0,d.pingedLanes=0),d=d.eventTimes,g=31-Xo(g),d[g]=E}function Mi(d,g){var E=d.pendingLanes&~g;d.pendingLanes=g,d.suspendedLanes=0,d.pingedLanes=0,d.expiredLanes&=g,d.mutableReadLanes&=g,d.entangledLanes&=g,g=d.entanglements;var D=d.eventTimes;for(d=d.expirationTimes;0<E;){var K=31-Xo(E),ce=1<<K;g[K]=0,D[K]=-1,d[K]=-1,E&=~ce}}function yl(d,g){var E=d.entangledLanes|=g;for(d=d.entanglements;E;){var D=31-Xo(E),K=1<<D;K&g|d[D]&g&&(d[D]|=g),E&=~K}}var Gi=0;function fs(d){return d&=-d,1<d?4<d?(d&268435455)!==0?16:536870912:4:1}var Ui,mu,ec,nu,_c,tc=!1,Da=[],Ls=null,Vi=null,Fa=null,ai=new Map,Zo=new Map,Ao=[],Ih="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Pu(d,g){switch(d){case"focusin":case"focusout":Ls=null;break;case"dragenter":case"dragleave":Vi=null;break;case"mouseover":case"mouseout":Fa=null;break;case"pointerover":case"pointerout":ai.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":Zo.delete(g.pointerId)}}function _o(d,g,E,D,K,ce){return d===null||d.nativeEvent!==ce?(d={blockedOn:g,domEventName:E,eventSystemFlags:D,nativeEvent:ce,targetContainers:[K]},g!==null&&(g=_u(g),g!==null&&mu(g)),d):(d.eventSystemFlags|=D,g=d.targetContainers,K!==null&&g.indexOf(K)===-1&&g.push(K),d)}function Us(d,g,E,D,K){switch(g){case"focusin":return Ls=_o(Ls,d,g,E,D,K),!0;case"dragenter":return Vi=_o(Vi,d,g,E,D,K),!0;case"mouseover":return Fa=_o(Fa,d,g,E,D,K),!0;case"pointerover":var ce=K.pointerId;return ai.set(ce,_o(ai.get(ce)||null,d,g,E,D,K)),!0;case"gotpointercapture":return ce=K.pointerId,Zo.set(ce,_o(Zo.get(ce)||null,d,g,E,D,K)),!0}return!1}function ku(d){var g=ql(d.target);if(g!==null){var E=ro(g);if(E!==null){if(g=E.tag,g===13){if(g=ys(E),g!==null){d.blockedOn=g,_c(d.priority,function(){ec(E)});return}}else if(g===3&&E.stateNode.current.memoizedState.isDehydrated){d.blockedOn=E.tag===3?E.stateNode.containerInfo:null;return}}}d.blockedOn=null}function Go(d){if(d.blockedOn!==null)return!1;for(var g=d.targetContainers;0<g.length;){var E=ru(d.domEventName,d.eventSystemFlags,g[0],d.nativeEvent);if(E===null){E=d.nativeEvent;var D=new E.constructor(E.type,E);di=D,E.target.dispatchEvent(D),di=null}else return g=_u(E),g!==null&&mu(g),d.blockedOn=E,!1;g.shift()}return!0}function vo(d,g,E){Go(d)&&E.delete(g)}function Dl(){tc=!1,Ls!==null&&Go(Ls)&&(Ls=null),Vi!==null&&Go(Vi)&&(Vi=null),Fa!==null&&Go(Fa)&&(Fa=null),ai.forEach(vo),Zo.forEach(vo)}function Oa(d,g){d.blockedOn===g&&(d.blockedOn=null,tc||(tc=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Dl)))}function Vs(d){function g(K){return Oa(K,d)}if(0<Da.length){Oa(Da[0],d);for(var E=1;E<Da.length;E++){var D=Da[E];D.blockedOn===d&&(D.blockedOn=null)}}for(Ls!==null&&Oa(Ls,d),Vi!==null&&Oa(Vi,d),Fa!==null&&Oa(Fa,d),ai.forEach(g),Zo.forEach(g),E=0;E<Ao.length;E++)D=Ao[E],D.blockedOn===d&&(D.blockedOn=null);for(;0<Ao.length&&(E=Ao[0],E.blockedOn===null);)ku(E),E.blockedOn===null&&Ao.shift()}var Bo=ue.ReactCurrentBatchConfig,Bc=!0;function Ho(d,g,E,D){var K=Gi,ce=Bo.transition;Bo.transition=null;try{Gi=1,Ja(d,g,E,D)}finally{Gi=K,Bo.transition=ce}}function ya(d,g,E,D){var K=Gi,ce=Bo.transition;Bo.transition=null;try{Gi=4,Ja(d,g,E,D)}finally{Gi=K,Bo.transition=ce}}function Ja(d,g,E,D){if(Bc){var K=ru(d,g,E,D);if(K===null)su(d,g,D,ll,E),Pu(d,D);else if(Us(K,d,g,E,D))D.stopPropagation();else if(Pu(d,D),g&4&&-1<Ih.indexOf(d)){for(;K!==null;){var ce=_u(K);if(ce!==null&&Ui(ce),ce=ru(d,g,E,D),ce===null&&su(d,g,D,ll,E),ce===K)break;K=ce}K!==null&&D.stopPropagation()}else su(d,g,D,null,E)}}var ll=null;function ru(d,g,E,D){if(ll=null,d=si(D),d=ql(d),d!==null)if(g=ro(d),g===null)d=null;else if(E=g.tag,E===13){if(d=ys(g),d!==null)return d;d=null}else if(E===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;d=null}else g!==d&&(d=null);return ll=d,null}function vc(d){switch(d){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(fu()){case Ea:return 1;case Ko:return 4;case Xa:case Nl:return 16;case Ql:return 536870912;default:return 16}default:return 16}}var qs=null,Ti=null,Ss=null;function $s(){if(Ss)return Ss;var d,g=Ti,E=g.length,D,K="value"in qs?qs.value:qs.textContent,ce=K.length;for(d=0;d<E&&g[d]===K[d];d++);var Ve=E-d;for(D=1;D<=Ve&&g[E-D]===K[ce-D];D++);return Ss=K.slice(d,1<D?1-D:void 0)}function aa(d){var g=d.keyCode;return"charCode"in d?(d=d.charCode,d===0&&g===13&&(d=13)):d=g,d===10&&(d=13),32<=d||d===13?d:0}function la(){return!0}function cl(){return!1}function Gs(d){function g(E,D,K,ce,Ve){this._reactName=E,this._targetInst=K,this.type=D,this.nativeEvent=ce,this.target=Ve,this.currentTarget=null;for(var St in d)d.hasOwnProperty(St)&&(E=d[St],this[St]=E?E(ce):ce[St]);return this.isDefaultPrevented=(ce.defaultPrevented!=null?ce.defaultPrevented:ce.returnValue===!1)?la:cl,this.isPropagationStopped=cl,this}return nt(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var E=this.nativeEvent;E&&(E.preventDefault?E.preventDefault():typeof E.returnValue!="unknown"&&(E.returnValue=!1),this.isDefaultPrevented=la)},stopPropagation:function(){var E=this.nativeEvent;E&&(E.stopPropagation?E.stopPropagation():typeof E.cancelBubble!="unknown"&&(E.cancelBubble=!0),this.isPropagationStopped=la)},persist:function(){},isPersistent:la}),g}var Hs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(d){return d.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},xc=Gs(Hs),W=nt({},Hs,{view:0,detail:0}),Ce=Gs(W),pt,yt,qt,Zt=nt({},W,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Qa,button:0,buttons:0,relatedTarget:function(d){return d.relatedTarget===void 0?d.fromElement===d.srcElement?d.toElement:d.fromElement:d.relatedTarget},movementX:function(d){return"movementX"in d?d.movementX:(d!==qt&&(qt&&d.type==="mousemove"?(pt=d.screenX-qt.screenX,yt=d.screenY-qt.screenY):yt=pt=0,qt=d),pt)},movementY:function(d){return"movementY"in d?d.movementY:yt}}),Fn=Gs(Zt),Dr=nt({},Zt,{dataTransfer:0}),Xr=Gs(Dr),yi=nt({},W,{relatedTarget:0}),Ii=Gs(yi),xo=nt({},Hs,{animationName:0,elapsedTime:0,pseudoElement:0}),bo=Gs(xo),Yo=nt({},Hs,{clipboardData:function(d){return"clipboardData"in d?d.clipboardData:window.clipboardData}}),Ro=Gs(Yo),zo=nt({},Hs,{data:0}),Jo=Gs(zo),us={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},jo={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Es={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function zc(d){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(d):(d=Es[d])?!!g[d]:!1}function Qa(){return zc}var L=nt({},W,{key:function(d){if(d.key){var g=us[d.key]||d.key;if(g!=="Unidentified")return g}return d.type==="keypress"?(d=aa(d),d===13?"Enter":String.fromCharCode(d)):d.type==="keydown"||d.type==="keyup"?jo[d.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Qa,charCode:function(d){return d.type==="keypress"?aa(d):0},keyCode:function(d){return d.type==="keydown"||d.type==="keyup"?d.keyCode:0},which:function(d){return d.type==="keypress"?aa(d):d.type==="keydown"||d.type==="keyup"?d.keyCode:0}}),ae=Gs(L),ve=nt({},Zt,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ge=Gs(ve),Xt=nt({},W,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Qa}),hn=Gs(Xt),ar=nt({},Hs,{propertyName:0,elapsedTime:0,pseudoElement:0}),so=Gs(ar),Fo=nt({},Zt,{deltaX:function(d){return"deltaX"in d?d.deltaX:"wheelDeltaX"in d?-d.wheelDeltaX:0},deltaY:function(d){return"deltaY"in d?d.deltaY:"wheelDeltaY"in d?-d.wheelDeltaY:"wheelDelta"in d?-d.wheelDelta:0},deltaZ:0,deltaMode:0}),Ki=Gs(Fo),zi=[9,13,27,32],Mo=_&&"CompositionEvent"in window,ca=null;_&&"documentMode"in document&&(ca=document.documentMode);var Lo=_&&"TextEvent"in window&&!ca,Bi=_&&(!Mo||ca&&8<ca&&11>=ca),Fl=" ",ua=!1;function Ru(d,g){switch(d){case"keyup":return zi.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ul(d){return d=d.detail,typeof d=="object"&&"data"in d?d.data:null}var bc=!1;function Ps(d,g){switch(d){case"compositionend":return ul(g);case"keypress":return g.which!==32?null:(ua=!0,Fl);case"textInput":return d=g.data,d===Fl&&ua?null:d;default:return null}}function _a(d,g){if(bc)return d==="compositionend"||!Mo&&Ru(d,g)?(d=$s(),Ss=Ti=qs=null,bc=!1,d):null;switch(d){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return Bi&&g.locale!=="ko"?null:g.data;default:return null}}var gu={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Qo(d){var g=d&&d.nodeName&&d.nodeName.toLowerCase();return g==="input"?!!gu[d.type]:g==="textarea"}function Ws(d,g,E,D){ht(D),g=li(g,"onChange"),0<g.length&&(E=new xc("onChange","change",null,E,D),d.push({event:E,listeners:g}))}var Ba=null,Ol=null;function _s(d){oc(d,0)}function Uo(d){var g=xa(d);if(gn(g))return d}function Ia(d,g){if(d==="change")return g}var Ks=!1;if(_){var yu;if(_){var wc="oninput"in document;if(!wc){var iu=document.createElement("div");iu.setAttribute("oninput","return;"),wc=typeof iu.oninput=="function"}yu=wc}else yu=!1;Ks=yu&&(!document.documentMode||9<document.documentMode)}function za(){Ba&&(Ba.detachEvent("onpropertychange",nc),Ol=Ba=null)}function nc(d){if(d.propertyName==="value"&&Uo(Ol)){var g=[];Ws(g,Ol,d,si(d)),Pt(_s,g)}}function _l(d,g,E){d==="focusin"?(za(),Ba=g,Ol=E,Ba.attachEvent("onpropertychange",nc)):d==="focusout"&&za()}function Bl(d){if(d==="selectionchange"||d==="keyup"||d==="keydown")return Uo(Ol)}function zl(d,g){if(d==="click")return Uo(g)}function vl(d,g){if(d==="input"||d==="change")return Uo(g)}function el(d,g){return d===g&&(d!==0||1/d===1/g)||d!==d&&g!==g}var ks=typeof Object.is=="function"?Object.is:el;function No(d,g){if(ks(d,g))return!0;if(typeof d!="object"||d===null||typeof g!="object"||g===null)return!1;var E=Object.keys(d),D=Object.keys(g);if(E.length!==D.length)return!1;for(D=0;D<E.length;D++){var K=E[D];if(!o.call(g,K)||!ks(d[K],g[K]))return!1}return!0}function Wo(d){for(;d&&d.firstChild;)d=d.firstChild;return d}function Vo(d,g){var E=Wo(d);d=0;for(var D;E;){if(E.nodeType===3){if(D=d+E.textContent.length,d<=g&&D>=g)return{node:E,offset:g-d};d=D}e:{for(;E;){if(E.nextSibling){E=E.nextSibling;break e}E=E.parentNode}E=void 0}E=Wo(E)}}function vs(d,g){return d&&g?d===g?!0:d&&d.nodeType===3?!1:g&&g.nodeType===3?vs(d,g.parentNode):"contains"in d?d.contains(g):d.compareDocumentPosition?!!(d.compareDocumentPosition(g)&16):!1:!1}function Ca(){for(var d=window,g=Mn();g instanceof d.HTMLIFrameElement;){try{var E=typeof g.contentWindow.location.href=="string"}catch{E=!1}if(E)d=g.contentWindow;else break;g=Mn(d.document)}return g}function Sc(d){var g=d&&d.nodeName&&d.nodeName.toLowerCase();return g&&(g==="input"&&(d.type==="text"||d.type==="search"||d.type==="tel"||d.type==="url"||d.type==="password")||g==="textarea"||d.contentEditable==="true")}function zh(d){var g=Ca(),E=d.focusedElem,D=d.selectionRange;if(g!==E&&E&&E.ownerDocument&&vs(E.ownerDocument.documentElement,E)){if(D!==null&&Sc(E)){if(g=D.start,d=D.end,d===void 0&&(d=g),"selectionStart"in E)E.selectionStart=g,E.selectionEnd=Math.min(d,E.value.length);else if(d=(g=E.ownerDocument||document)&&g.defaultView||window,d.getSelection){d=d.getSelection();var K=E.textContent.length,ce=Math.min(D.start,K);D=D.end===void 0?ce:Math.min(D.end,K),!d.extend&&ce>D&&(K=D,D=ce,ce=K),K=Vo(E,ce);var Ve=Vo(E,D);K&&Ve&&(d.rangeCount!==1||d.anchorNode!==K.node||d.anchorOffset!==K.offset||d.focusNode!==Ve.node||d.focusOffset!==Ve.offset)&&(g=g.createRange(),g.setStart(K.node,K.offset),d.removeAllRanges(),ce>D?(d.addRange(g),d.extend(Ve.node,Ve.offset)):(g.setEnd(Ve.node,Ve.offset),d.addRange(g)))}}for(g=[],d=E;d=d.parentNode;)d.nodeType===1&&g.push({element:d,left:d.scrollLeft,top:d.scrollTop});for(typeof E.focus=="function"&&E.focus(),E=0;E<g.length;E++)d=g[E],d.element.scrollLeft=d.left,d.element.scrollTop=d.top}}var Ch=_&&"documentMode"in document&&11>=document.documentMode,rc=null,eh=null,Ec=null,td=!1;function jh(d,g,E){var D=E.window===E?E.document:E.nodeType===9?E:E.ownerDocument;td||rc==null||rc!==Mn(D)||(D=rc,"selectionStart"in D&&Sc(D)?D={start:D.selectionStart,end:D.selectionEnd}:(D=(D.ownerDocument&&D.ownerDocument.defaultView||window).getSelection(),D={anchorNode:D.anchorNode,anchorOffset:D.anchorOffset,focusNode:D.focusNode,focusOffset:D.focusOffset}),Ec&&No(Ec,D)||(Ec=D,D=li(eh,"onSelect"),0<D.length&&(g=new xc("onSelect","select",null,g,E),d.push({event:g,listeners:D}),g.target=rc)))}function ic(d,g){var E={};return E[d.toLowerCase()]=g.toLowerCase(),E["Webkit"+d]="webkit"+g,E["Moz"+d]="moz"+g,E}var jc={animationend:ic("Animation","AnimationEnd"),animationiteration:ic("Animation","AnimationIteration"),animationstart:ic("Animation","AnimationStart"),transitionend:ic("Transition","TransitionEnd")},La={},Uc={};_&&(Uc=document.createElement("div").style,"AnimationEvent"in window||(delete jc.animationend.animation,delete jc.animationiteration.animation,delete jc.animationstart.animation),"TransitionEvent"in window||delete jc.transitionend.transition);function Mu(d){if(La[d])return La[d];if(!jc[d])return d;var g=jc[d],E;for(E in g)if(g.hasOwnProperty(E)&&E in Uc)return La[d]=g[E];return d}var xl=Mu("animationend"),bl=Mu("animationiteration"),Xs=Mu("animationstart"),th=Mu("transitionend"),Jn=new Map,Nu="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ac(d,g){Jn.set(d,g),u(g,[d])}for(var hl=0;hl<Nu.length;hl++){var as=Nu[hl],Tc=as.toLowerCase(),Vc=as[0].toUpperCase()+as.slice(1);Ac(Tc,"on"+Vc)}Ac(xl,"onAnimationEnd"),Ac(bl,"onAnimationIteration"),Ac(Xs,"onAnimationStart"),Ac("dblclick","onDoubleClick"),Ac("focusin","onFocus"),Ac("focusout","onBlur"),Ac(th,"onTransitionEnd"),m("onMouseEnter",["mouseout","mouseover"]),m("onMouseLeave",["mouseout","mouseover"]),m("onPointerEnter",["pointerout","pointerover"]),m("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ha="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Du=new Set("cancel close invalid load scroll toggle".split(" ").concat(ha));function qc(d,g,E){var D=d.type||"unknown-event";d.currentTarget=E,$o(D,g,void 0,d),d.currentTarget=null}function oc(d,g){g=(g&4)!==0;for(var E=0;E<d.length;E++){var D=d[E],K=D.event;D=D.listeners;e:{var ce=void 0;if(g)for(var Ve=D.length-1;0<=Ve;Ve--){var St=D[Ve],Ot=St.instance,_n=St.currentTarget;if(St=St.listener,Ot!==ce&&K.isPropagationStopped())break e;qc(K,St,_n),ce=Ot}else for(Ve=0;Ve<D.length;Ve++){if(St=D[Ve],Ot=St.instance,_n=St.currentTarget,St=St.listener,Ot!==ce&&K.isPropagationStopped())break e;qc(K,St,_n),ce=Ot}}}if(Ar)throw d=Ai,Ar=!1,Ai=null,d}function qn(d,g){var E=g[lo];E===void 0&&(E=g[lo]=new Set);var D=d+"__bubble";E.has(D)||(ou(g,d,2,!1),E.add(D))}function jl(d,g,E){var D=0;g&&(D|=4),ou(E,d,D,g)}var va="_reactListening"+Math.random().toString(36).slice(2);function $c(d){if(!d[va]){d[va]=!0,i.forEach(function(E){E!=="selectionchange"&&(Du.has(E)||jl(E,!1,d),jl(E,!0,d))});var g=d.nodeType===9?d:d.ownerDocument;g===null||g[va]||(g[va]=!0,jl("selectionchange",!1,g))}}function ou(d,g,E,D){switch(vc(g)){case 1:var K=Ho;break;case 4:K=ya;break;default:K=Ja}E=K.bind(null,g,E,d),K=void 0,!Bn||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(K=!0),D?K!==void 0?d.addEventListener(g,E,{capture:!0,passive:K}):d.addEventListener(g,E,!0):K!==void 0?d.addEventListener(g,E,{passive:K}):d.addEventListener(g,E,!1)}function su(d,g,E,D,K){var ce=D;if((g&1)===0&&(g&2)===0&&D!==null)e:for(;;){if(D===null)return;var Ve=D.tag;if(Ve===3||Ve===4){var St=D.stateNode.containerInfo;if(St===K||St.nodeType===8&&St.parentNode===K)break;if(Ve===4)for(Ve=D.return;Ve!==null;){var Ot=Ve.tag;if((Ot===3||Ot===4)&&(Ot=Ve.stateNode.containerInfo,Ot===K||Ot.nodeType===8&&Ot.parentNode===K))return;Ve=Ve.return}for(;St!==null;){if(Ve=ql(St),Ve===null)return;if(Ot=Ve.tag,Ot===5||Ot===6){D=ce=Ve;continue e}St=St.parentNode}}D=D.return}Pt(function(){var _n=ce,rr=si(E),cr=[];e:{var Hn=Jn.get(d);if(Hn!==void 0){var Zr=xc,ii=d;switch(d){case"keypress":if(aa(E)===0)break e;case"keydown":case"keyup":Zr=ae;break;case"focusin":ii="focus",Zr=Ii;break;case"focusout":ii="blur",Zr=Ii;break;case"beforeblur":case"afterblur":Zr=Ii;break;case"click":if(E.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Zr=Fn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Zr=Xr;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Zr=hn;break;case xl:case bl:case Xs:Zr=bo;break;case th:Zr=so;break;case"scroll":Zr=Ce;break;case"wheel":Zr=Ki;break;case"copy":case"cut":case"paste":Zr=Ro;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Zr=Ge}var fi=(g&4)!==0,kl=!fi&&d==="scroll",ln=fi?Hn!==null?Hn+"Capture":null:Hn;fi=[];for(var Wt=_n,fn;Wt!==null;){fn=Wt;var xr=fn.stateNode;if(fn.tag===5&&xr!==null&&(fn=xr,ln!==null&&(xr=vn(Wt,ln),xr!=null&&fi.push(lr(Wt,xr,fn)))),kl)break;Wt=Wt.return}0<fi.length&&(Hn=new Zr(Hn,ii,null,E,rr),cr.push({event:Hn,listeners:fi}))}}if((g&7)===0){e:{if(Hn=d==="mouseover"||d==="pointerover",Zr=d==="mouseout"||d==="pointerout",Hn&&E!==di&&(ii=E.relatedTarget||E.fromElement)&&(ql(ii)||ii[Va]))break e;if((Zr||Hn)&&(Hn=rr.window===rr?rr:(Hn=rr.ownerDocument)?Hn.defaultView||Hn.parentWindow:window,Zr?(ii=E.relatedTarget||E.toElement,Zr=_n,ii=ii?ql(ii):null,ii!==null&&(kl=ro(ii),ii!==kl||ii.tag!==5&&ii.tag!==6)&&(ii=null)):(Zr=null,ii=_n),Zr!==ii)){if(fi=Fn,xr="onMouseLeave",ln="onMouseEnter",Wt="mouse",(d==="pointerout"||d==="pointerover")&&(fi=Ge,xr="onPointerLeave",ln="onPointerEnter",Wt="pointer"),kl=Zr==null?Hn:xa(Zr),fn=ii==null?Hn:xa(ii),Hn=new fi(xr,Wt+"leave",Zr,E,rr),Hn.target=kl,Hn.relatedTarget=fn,xr=null,ql(rr)===_n&&(fi=new fi(ln,Wt+"enter",ii,E,rr),fi.target=fn,fi.relatedTarget=kl,xr=fi),kl=xr,Zr&&ii)t:{for(fi=Zr,ln=ii,Wt=0,fn=fi;fn;fn=ja(fn))Wt++;for(fn=0,xr=ln;xr;xr=ja(xr))fn++;for(;0<Wt-fn;)fi=ja(fi),Wt--;for(;0<fn-Wt;)ln=ja(ln),fn--;for(;Wt--;){if(fi===ln||ln!==null&&fi===ln.alternate)break t;fi=ja(fi),ln=ja(ln)}fi=null}else fi=null;Zr!==null&&es(cr,Hn,Zr,fi,!1),ii!==null&&kl!==null&&es(cr,kl,ii,fi,!0)}}e:{if(Hn=_n?xa(_n):window,Zr=Hn.nodeName&&Hn.nodeName.toLowerCase(),Zr==="select"||Zr==="input"&&Hn.type==="file")var pi=Ia;else if(Qo(Hn))if(Ks)pi=vl;else{pi=Bl;var Fi=_l}else(Zr=Hn.nodeName)&&Zr.toLowerCase()==="input"&&(Hn.type==="checkbox"||Hn.type==="radio")&&(pi=zl);if(pi&&(pi=pi(d,_n))){Ws(cr,pi,E,rr);break e}Fi&&Fi(d,Hn,_n),d==="focusout"&&(Fi=Hn._wrapperState)&&Fi.controlled&&Hn.type==="number"&&Ln(Hn,"number",Hn.value)}switch(Fi=_n?xa(_n):window,d){case"focusin":(Qo(Fi)||Fi.contentEditable==="true")&&(rc=Fi,eh=_n,Ec=null);break;case"focusout":Ec=eh=rc=null;break;case"mousedown":td=!0;break;case"contextmenu":case"mouseup":case"dragend":td=!1,jh(cr,E,rr);break;case"selectionchange":if(Ch)break;case"keydown":case"keyup":jh(cr,E,rr)}var Oi;if(Mo)e:{switch(d){case"compositionstart":var to="onCompositionStart";break e;case"compositionend":to="onCompositionEnd";break e;case"compositionupdate":to="onCompositionUpdate";break e}to=void 0}else bc?Ru(d,E)&&(to="onCompositionEnd"):d==="keydown"&&E.keyCode===229&&(to="onCompositionStart");to&&(Bi&&E.locale!=="ko"&&(bc||to!=="onCompositionStart"?to==="onCompositionEnd"&&bc&&(Oi=$s()):(qs=rr,Ti="value"in qs?qs.value:qs.textContent,bc=!0)),Fi=li(_n,to),0<Fi.length&&(to=new Jo(to,d,null,E,rr),cr.push({event:to,listeners:Fi}),Oi?to.data=Oi:(Oi=ul(E),Oi!==null&&(to.data=Oi)))),(Oi=Lo?Ps(d,E):_a(d,E))&&(_n=li(_n,"onBeforeInput"),0<_n.length&&(rr=new Jo("onBeforeInput","beforeinput",null,E,rr),cr.push({event:rr,listeners:_n}),rr.data=Oi))}oc(cr,g)})}function lr(d,g,E){return{instance:d,listener:g,currentTarget:E}}function li(d,g){for(var E=g+"Capture",D=[];d!==null;){var K=d,ce=K.stateNode;K.tag===5&&ce!==null&&(K=ce,ce=vn(d,E),ce!=null&&D.unshift(lr(d,ce,K)),ce=vn(d,g),ce!=null&&D.push(lr(d,ce,K))),d=d.return}return D}function ja(d){if(d===null)return null;do d=d.return;while(d&&d.tag!==5);return d||null}function es(d,g,E,D,K){for(var ce=g._reactName,Ve=[];E!==null&&E!==D;){var St=E,Ot=St.alternate,_n=St.stateNode;if(Ot!==null&&Ot===D)break;St.tag===5&&_n!==null&&(St=_n,K?(Ot=vn(E,ce),Ot!=null&&Ve.unshift(lr(E,Ot,St))):K||(Ot=vn(E,ce),Ot!=null&&Ve.push(lr(E,Ot,St)))),E=E.return}Ve.length!==0&&d.push({event:g,listeners:Ve})}var Ul=/\r\n?/g,Do=/\u0000|\uFFFD/g;function ao(d){return(typeof d=="string"?d:""+d).replace(Ul,`
`).replace(Do,"")}function Zs(d,g,E){if(g=ao(g),ao(d)!==g&&E)throw Error(t(425))}function Lh(){}var Ph=null,ni=null;function nh(d,g){return d==="textarea"||d==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var rh=typeof setTimeout=="function"?setTimeout:void 0,dl=typeof clearTimeout=="function"?clearTimeout:void 0,wl=typeof Promise=="function"?Promise:void 0,Uh=typeof queueMicrotask=="function"?queueMicrotask:typeof wl<"u"?function(d){return wl.resolve(null).then(d).catch(Sl)}:rh;function Sl(d){setTimeout(function(){throw d})}function ih(d,g){var E=g,D=0;do{var K=E.nextSibling;if(d.removeChild(E),K&&K.nodeType===8)if(E=K.data,E==="/$"){if(D===0){d.removeChild(K),Vs(g);return}D--}else E!=="$"&&E!=="$?"&&E!=="$!"||D++;E=K}while(E);Vs(g)}function El(d){for(;d!=null;d=d.nextSibling){var g=d.nodeType;if(g===1||g===3)break;if(g===8){if(g=d.data,g==="$"||g==="$!"||g==="$?")break;if(g==="/$")return null}}return d}function Al(d){d=d.previousSibling;for(var g=0;d;){if(d.nodeType===8){var E=d.data;if(E==="$"||E==="$!"||E==="$?"){if(g===0)return d;g--}else E==="/$"&&g++}d=d.previousSibling}return null}var Ni=Math.random().toString(36).slice(2),Ua="__reactFiber$"+Ni,Vl="__reactProps$"+Ni,Va="__reactContainer$"+Ni,lo="__reactEvents$"+Ni,vd="__reactListeners$"+Ni,nd="__reactHandles$"+Ni;function ql(d){var g=d[Ua];if(g)return g;for(var E=d.parentNode;E;){if(g=E[Va]||E[Ua]){if(E=g.alternate,g.child!==null||E!==null&&E.child!==null)for(d=Al(d);d!==null;){if(E=d[Ua])return E;d=Al(d)}return g}d=E,E=d.parentNode}return null}function _u(d){return d=d[Ua]||d[Va],!d||d.tag!==5&&d.tag!==6&&d.tag!==13&&d.tag!==3?null:d}function xa(d){if(d.tag===5||d.tag===6)return d.stateNode;throw Error(t(33))}function vu(d){return d[Vl]||null}var xd=[],sc=-1;function Pa(d){return{current:d}}function qo(d){0>sc||(d.current=xd[sc],xd[sc]=null,sc--)}function Hi(d,g){sc++,xd[sc]=d.current,d.current=g}var xu={},Rs=Pa(xu),ac=Pa(!1),oh=xu;function tl(d,g){var E=d.type.contextTypes;if(!E)return xu;var D=d.stateNode;if(D&&D.__reactInternalMemoizedUnmaskedChildContext===g)return D.__reactInternalMemoizedMaskedChildContext;var K={},ce;for(ce in E)K[ce]=g[ce];return D&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=g,d.__reactInternalMemoizedMaskedChildContext=K),K}function nl(d){return d=d.childContextTypes,d!=null}function Fu(){qo(ac),qo(Rs)}function Ic(d,g,E){if(Rs.current!==xu)throw Error(t(168));Hi(Rs,g),Hi(ac,E)}function lc(d,g,E){var D=d.stateNode;if(g=g.childContextTypes,typeof D.getChildContext!="function")return E;D=D.getChildContext();for(var K in D)if(!(K in g))throw Error(t(108,mt(d)||"Unknown",K));return nt({},E,D)}function Tl(d){return d=(d=d.stateNode)&&d.__reactInternalMemoizedMergedChildContext||xu,oh=Rs.current,Hi(Rs,d),Hi(ac,ac.current),!0}function sh(d,g,E){var D=d.stateNode;if(!D)throw Error(t(169));E?(d=lc(d,g,oh),D.__reactInternalMemoizedMergedChildContext=d,qo(ac),qo(Rs),Hi(Rs,d)):qo(ac),Hi(ac,E)}var hr=null,ah=!1,C=!1;function B(d){hr===null?hr=[d]:hr.push(d)}function Q(d){ah=!0,B(d)}function oe(){if(!C&&hr!==null){C=!0;var d=0,g=Gi;try{var E=hr;for(Gi=1;d<E.length;d++){var D=E[d];do D=D(!0);while(D!==null)}hr=null,ah=!1}catch(K){throw hr!==null&&(hr=hr.slice(d+1)),sl(Ea,oe),K}finally{Gi=g,C=!1}}return null}var Pe=[],qe=0,He=null,Je=0,et=[],dt=0,Nt=null,tn=1,ct="";function Ft(d,g){Pe[qe++]=Je,Pe[qe++]=He,He=d,Je=g}function Qt(d,g,E){et[dt++]=tn,et[dt++]=ct,et[dt++]=Nt,Nt=d;var D=tn;d=ct;var K=32-Xo(D)-1;D&=~(1<<K),E+=1;var ce=32-Xo(g)+K;if(30<ce){var Ve=K-K%5;ce=(D&(1<<Ve)-1).toString(32),D>>=Ve,K-=Ve,tn=1<<32-Xo(g)+K|E<<K|D,ct=ce+d}else tn=1<<ce|E<<K|D,ct=d}function En(d){d.return!==null&&(Ft(d,1),Qt(d,1,0))}function y(d){for(;d===He;)He=Pe[--qe],Pe[qe]=null,Je=Pe[--qe],Pe[qe]=null;for(;d===Nt;)Nt=et[--dt],et[dt]=null,ct=et[--dt],et[dt]=null,tn=et[--dt],et[dt]=null}var a=null,f=null,v=!1,S=null;function T(d,g){var E=Kc(5,null,null,0);E.elementType="DELETED",E.stateNode=g,E.return=d,g=d.deletions,g===null?(d.deletions=[E],d.flags|=16):g.push(E)}function N(d,g){switch(d.tag){case 5:var E=d.type;return g=g.nodeType!==1||E.toLowerCase()!==g.nodeName.toLowerCase()?null:g,g!==null?(d.stateNode=g,a=d,f=El(g.firstChild),!0):!1;case 6:return g=d.pendingProps===""||g.nodeType!==3?null:g,g!==null?(d.stateNode=g,a=d,f=null,!0):!1;case 13:return g=g.nodeType!==8?null:g,g!==null?(E=Nt!==null?{id:tn,overflow:ct}:null,d.memoizedState={dehydrated:g,treeContext:E,retryLane:1073741824},E=Kc(18,null,null,0),E.stateNode=g,E.return=d,d.child=E,a=d,f=null,!0):!1;default:return!1}}function z(d){return(d.mode&1)!==0&&(d.flags&128)===0}function G(d){if(v){var g=f;if(g){var E=g;if(!N(d,g)){if(z(d))throw Error(t(418));g=El(E.nextSibling);var D=a;g&&N(d,g)?T(D,E):(d.flags=d.flags&-4097|2,v=!1,a=d)}}else{if(z(d))throw Error(t(418));d.flags=d.flags&-4097|2,v=!1,a=d}}}function ee(d){for(d=d.return;d!==null&&d.tag!==5&&d.tag!==3&&d.tag!==13;)d=d.return;a=d}function te(d){if(d!==a)return!1;if(!v)return ee(d),v=!0,!1;var g;if((g=d.tag!==3)&&!(g=d.tag!==5)&&(g=d.type,g=g!=="head"&&g!=="body"&&!nh(d.type,d.memoizedProps)),g&&(g=f)){if(z(d))throw ge(),Error(t(418));for(;g;)T(d,g),g=El(g.nextSibling)}if(ee(d),d.tag===13){if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(t(317));e:{for(d=d.nextSibling,g=0;d;){if(d.nodeType===8){var E=d.data;if(E==="/$"){if(g===0){f=El(d.nextSibling);break e}g--}else E!=="$"&&E!=="$!"&&E!=="$?"||g++}d=d.nextSibling}f=null}}else f=a?El(d.stateNode.nextSibling):null;return!0}function ge(){for(var d=f;d;)d=El(d.nextSibling)}function Ae(){f=a=null,v=!1}function Le(d){S===null?S=[d]:S.push(d)}var Xe=ue.ReactCurrentBatchConfig;function Ue(d,g,E){if(d=E.ref,d!==null&&typeof d!="function"&&typeof d!="object"){if(E._owner){if(E=E._owner,E){if(E.tag!==1)throw Error(t(309));var D=E.stateNode}if(!D)throw Error(t(147,d));var K=D,ce=""+d;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===ce?g.ref:(g=function(Ve){var St=K.refs;Ve===null?delete St[ce]:St[ce]=Ve},g._stringRef=ce,g)}if(typeof d!="string")throw Error(t(284));if(!E._owner)throw Error(t(290,d))}return d}function Ze(d,g){throw d=Object.prototype.toString.call(g),Error(t(31,d==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":d))}function _e(d){var g=d._init;return g(d._payload)}function $e(d){function g(ln,Wt){if(d){var fn=ln.deletions;fn===null?(ln.deletions=[Wt],ln.flags|=16):fn.push(Wt)}}function E(ln,Wt){if(!d)return null;for(;Wt!==null;)g(ln,Wt),Wt=Wt.sibling;return null}function D(ln,Wt){for(ln=new Map;Wt!==null;)Wt.key!==null?ln.set(Wt.key,Wt):ln.set(Wt.index,Wt),Wt=Wt.sibling;return ln}function K(ln,Wt){return ln=_f(ln,Wt),ln.index=0,ln.sibling=null,ln}function ce(ln,Wt,fn){return ln.index=fn,d?(fn=ln.alternate,fn!==null?(fn=fn.index,fn<Wt?(ln.flags|=2,Wt):fn):(ln.flags|=2,Wt)):(ln.flags|=1048576,Wt)}function Ve(ln){return d&&ln.alternate===null&&(ln.flags|=2),ln}function St(ln,Wt,fn,xr){return Wt===null||Wt.tag!==6?(Wt=Y0(fn,ln.mode,xr),Wt.return=ln,Wt):(Wt=K(Wt,fn),Wt.return=ln,Wt)}function Ot(ln,Wt,fn,xr){var pi=fn.type;return pi===pe?rr(ln,Wt,fn.props.children,xr,fn.key):Wt!==null&&(Wt.elementType===pi||typeof pi=="object"&&pi!==null&&pi.$$typeof===Oe&&_e(pi)===Wt.type)?(xr=K(Wt,fn.props),xr.ref=Ue(ln,Wt,fn),xr.return=ln,xr):(xr=Ig(fn.type,fn.key,fn.props,null,ln.mode,xr),xr.ref=Ue(ln,Wt,fn),xr.return=ln,xr)}function _n(ln,Wt,fn,xr){return Wt===null||Wt.tag!==4||Wt.stateNode.containerInfo!==fn.containerInfo||Wt.stateNode.implementation!==fn.implementation?(Wt=J0(fn,ln.mode,xr),Wt.return=ln,Wt):(Wt=K(Wt,fn.children||[]),Wt.return=ln,Wt)}function rr(ln,Wt,fn,xr,pi){return Wt===null||Wt.tag!==7?(Wt=ap(fn,ln.mode,xr,pi),Wt.return=ln,Wt):(Wt=K(Wt,fn),Wt.return=ln,Wt)}function cr(ln,Wt,fn){if(typeof Wt=="string"&&Wt!==""||typeof Wt=="number")return Wt=Y0(""+Wt,ln.mode,fn),Wt.return=ln,Wt;if(typeof Wt=="object"&&Wt!==null){switch(Wt.$$typeof){case ke:return fn=Ig(Wt.type,Wt.key,Wt.props,null,ln.mode,fn),fn.ref=Ue(ln,null,Wt),fn.return=ln,fn;case je:return Wt=J0(Wt,ln.mode,fn),Wt.return=ln,Wt;case Oe:var xr=Wt._init;return cr(ln,xr(Wt._payload),fn)}if(ir(Wt)||Fe(Wt))return Wt=ap(Wt,ln.mode,fn,null),Wt.return=ln,Wt;Ze(ln,Wt)}return null}function Hn(ln,Wt,fn,xr){var pi=Wt!==null?Wt.key:null;if(typeof fn=="string"&&fn!==""||typeof fn=="number")return pi!==null?null:St(ln,Wt,""+fn,xr);if(typeof fn=="object"&&fn!==null){switch(fn.$$typeof){case ke:return fn.key===pi?Ot(ln,Wt,fn,xr):null;case je:return fn.key===pi?_n(ln,Wt,fn,xr):null;case Oe:return pi=fn._init,Hn(ln,Wt,pi(fn._payload),xr)}if(ir(fn)||Fe(fn))return pi!==null?null:rr(ln,Wt,fn,xr,null);Ze(ln,fn)}return null}function Zr(ln,Wt,fn,xr,pi){if(typeof xr=="string"&&xr!==""||typeof xr=="number")return ln=ln.get(fn)||null,St(Wt,ln,""+xr,pi);if(typeof xr=="object"&&xr!==null){switch(xr.$$typeof){case ke:return ln=ln.get(xr.key===null?fn:xr.key)||null,Ot(Wt,ln,xr,pi);case je:return ln=ln.get(xr.key===null?fn:xr.key)||null,_n(Wt,ln,xr,pi);case Oe:var Fi=xr._init;return Zr(ln,Wt,fn,Fi(xr._payload),pi)}if(ir(xr)||Fe(xr))return ln=ln.get(fn)||null,rr(Wt,ln,xr,pi,null);Ze(Wt,xr)}return null}function ii(ln,Wt,fn,xr){for(var pi=null,Fi=null,Oi=Wt,to=Wt=0,Xc=null;Oi!==null&&to<fn.length;to++){Oi.index>to?(Xc=Oi,Oi=null):Xc=Oi.sibling;var rs=Hn(ln,Oi,fn[to],xr);if(rs===null){Oi===null&&(Oi=Xc);break}d&&Oi&&rs.alternate===null&&g(ln,Oi),Wt=ce(rs,Wt,to),Fi===null?pi=rs:Fi.sibling=rs,Fi=rs,Oi=Xc}if(to===fn.length)return E(ln,Oi),v&&Ft(ln,to),pi;if(Oi===null){for(;to<fn.length;to++)Oi=cr(ln,fn[to],xr),Oi!==null&&(Wt=ce(Oi,Wt,to),Fi===null?pi=Oi:Fi.sibling=Oi,Fi=Oi);return v&&Ft(ln,to),pi}for(Oi=D(ln,Oi);to<fn.length;to++)Xc=Zr(Oi,ln,to,fn[to],xr),Xc!==null&&(d&&Xc.alternate!==null&&Oi.delete(Xc.key===null?to:Xc.key),Wt=ce(Xc,Wt,to),Fi===null?pi=Xc:Fi.sibling=Xc,Fi=Xc);return d&&Oi.forEach(function(Hh){return g(ln,Hh)}),v&&Ft(ln,to),pi}function fi(ln,Wt,fn,xr){var pi=Fe(fn);if(typeof pi!="function")throw Error(t(150));if(fn=pi.call(fn),fn==null)throw Error(t(151));for(var Fi=pi=null,Oi=Wt,to=Wt=0,Xc=null,rs=fn.next();Oi!==null&&!rs.done;to++,rs=fn.next()){Oi.index>to?(Xc=Oi,Oi=null):Xc=Oi.sibling;var Hh=Hn(ln,Oi,rs.value,xr);if(Hh===null){Oi===null&&(Oi=Xc);break}d&&Oi&&Hh.alternate===null&&g(ln,Oi),Wt=ce(Hh,Wt,to),Fi===null?pi=Hh:Fi.sibling=Hh,Fi=Hh,Oi=Xc}if(rs.done)return E(ln,Oi),v&&Ft(ln,to),pi;if(Oi===null){for(;!rs.done;to++,rs=fn.next())rs=cr(ln,rs.value,xr),rs!==null&&(Wt=ce(rs,Wt,to),Fi===null?pi=rs:Fi.sibling=rs,Fi=rs);return v&&Ft(ln,to),pi}for(Oi=D(ln,Oi);!rs.done;to++,rs=fn.next())rs=Zr(Oi,ln,to,rs.value,xr),rs!==null&&(d&&rs.alternate!==null&&Oi.delete(rs.key===null?to:rs.key),Wt=ce(rs,Wt,to),Fi===null?pi=rs:Fi.sibling=rs,Fi=rs);return d&&Oi.forEach(function(q_){return g(ln,q_)}),v&&Ft(ln,to),pi}function kl(ln,Wt,fn,xr){if(typeof fn=="object"&&fn!==null&&fn.type===pe&&fn.key===null&&(fn=fn.props.children),typeof fn=="object"&&fn!==null){switch(fn.$$typeof){case ke:e:{for(var pi=fn.key,Fi=Wt;Fi!==null;){if(Fi.key===pi){if(pi=fn.type,pi===pe){if(Fi.tag===7){E(ln,Fi.sibling),Wt=K(Fi,fn.props.children),Wt.return=ln,ln=Wt;break e}}else if(Fi.elementType===pi||typeof pi=="object"&&pi!==null&&pi.$$typeof===Oe&&_e(pi)===Fi.type){E(ln,Fi.sibling),Wt=K(Fi,fn.props),Wt.ref=Ue(ln,Fi,fn),Wt.return=ln,ln=Wt;break e}E(ln,Fi);break}else g(ln,Fi);Fi=Fi.sibling}fn.type===pe?(Wt=ap(fn.props.children,ln.mode,xr,fn.key),Wt.return=ln,ln=Wt):(xr=Ig(fn.type,fn.key,fn.props,null,ln.mode,xr),xr.ref=Ue(ln,Wt,fn),xr.return=ln,ln=xr)}return Ve(ln);case je:e:{for(Fi=fn.key;Wt!==null;){if(Wt.key===Fi)if(Wt.tag===4&&Wt.stateNode.containerInfo===fn.containerInfo&&Wt.stateNode.implementation===fn.implementation){E(ln,Wt.sibling),Wt=K(Wt,fn.children||[]),Wt.return=ln,ln=Wt;break e}else{E(ln,Wt);break}else g(ln,Wt);Wt=Wt.sibling}Wt=J0(fn,ln.mode,xr),Wt.return=ln,ln=Wt}return Ve(ln);case Oe:return Fi=fn._init,kl(ln,Wt,Fi(fn._payload),xr)}if(ir(fn))return ii(ln,Wt,fn,xr);if(Fe(fn))return fi(ln,Wt,fn,xr);Ze(ln,fn)}return typeof fn=="string"&&fn!==""||typeof fn=="number"?(fn=""+fn,Wt!==null&&Wt.tag===6?(E(ln,Wt.sibling),Wt=K(Wt,fn),Wt.return=ln,ln=Wt):(E(ln,Wt),Wt=Y0(fn,ln.mode,xr),Wt.return=ln,ln=Wt),Ve(ln)):E(ln,Wt)}return kl}var it=$e(!0),ot=$e(!1),bt=Pa(null),wt=null,vt=null,Rt=null;function Lt(){Rt=vt=wt=null}function zt(d){var g=bt.current;qo(bt),d._currentValue=g}function mn(d,g,E){for(;d!==null;){var D=d.alternate;if((d.childLanes&g)!==g?(d.childLanes|=g,D!==null&&(D.childLanes|=g)):D!==null&&(D.childLanes&g)!==g&&(D.childLanes|=g),d===E)break;d=d.return}}function Ut(d,g){wt=d,Rt=vt=null,d=d.dependencies,d!==null&&d.firstContext!==null&&((d.lanes&g)!==0&&(Te=!0),d.firstContext=null)}function an(d){var g=d._currentValue;if(Rt!==d)if(d={context:d,memoizedValue:g,next:null},vt===null){if(wt===null)throw Error(t(308));vt=d,wt.dependencies={lanes:0,firstContext:d}}else vt=vt.next=d;return g}var Ht=null;function Cn(d){Ht===null?Ht=[d]:Ht.push(d)}function jt(d,g,E,D){var K=g.interleaved;return K===null?(E.next=E,Cn(g)):(E.next=K.next,K.next=E),g.interleaved=E,on(d,D)}function on(d,g){d.lanes|=g;var E=d.alternate;for(E!==null&&(E.lanes|=g),E=d,d=d.return;d!==null;)d.childLanes|=g,E=d.alternate,E!==null&&(E.childLanes|=g),E=d,d=d.return;return E.tag===3?E.stateNode:null}var In=!1;function xn(d){d.updateQueue={baseState:d.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function bn(d,g){d=d.updateQueue,g.updateQueue===d&&(g.updateQueue={baseState:d.baseState,firstBaseUpdate:d.firstBaseUpdate,lastBaseUpdate:d.lastBaseUpdate,shared:d.shared,effects:d.effects})}function pr(d,g){return{eventTime:d,lane:g,tag:0,payload:null,callback:null,next:null}}function Fr(d,g,E){var D=d.updateQueue;if(D===null)return null;if(D=D.shared,(Qr&2)!==0){var K=D.pending;return K===null?g.next=g:(g.next=K.next,K.next=g),D.pending=g,on(d,E)}return K=D.interleaved,K===null?(g.next=g,Cn(D)):(g.next=K.next,K.next=g),D.interleaved=g,on(d,E)}function sr(d,g,E){if(g=g.updateQueue,g!==null&&(g=g.shared,(E&4194240)!==0)){var D=g.lanes;D&=d.pendingLanes,E|=D,g.lanes=E,yl(d,E)}}function fr(d,g){var E=d.updateQueue,D=d.alternate;if(D!==null&&(D=D.updateQueue,E===D)){var K=null,ce=null;if(E=E.firstBaseUpdate,E!==null){do{var Ve={eventTime:E.eventTime,lane:E.lane,tag:E.tag,payload:E.payload,callback:E.callback,next:null};ce===null?K=ce=Ve:ce=ce.next=Ve,E=E.next}while(E!==null);ce===null?K=ce=g:ce=ce.next=g}else K=ce=g;E={baseState:D.baseState,firstBaseUpdate:K,lastBaseUpdate:ce,shared:D.shared,effects:D.effects},d.updateQueue=E;return}d=E.lastBaseUpdate,d===null?E.firstBaseUpdate=g:d.next=g,E.lastBaseUpdate=g}function $r(d,g,E,D){var K=d.updateQueue;In=!1;var ce=K.firstBaseUpdate,Ve=K.lastBaseUpdate,St=K.shared.pending;if(St!==null){K.shared.pending=null;var Ot=St,_n=Ot.next;Ot.next=null,Ve===null?ce=_n:Ve.next=_n,Ve=Ot;var rr=d.alternate;rr!==null&&(rr=rr.updateQueue,St=rr.lastBaseUpdate,St!==Ve&&(St===null?rr.firstBaseUpdate=_n:St.next=_n,rr.lastBaseUpdate=Ot))}if(ce!==null){var cr=K.baseState;Ve=0,rr=_n=Ot=null,St=ce;do{var Hn=St.lane,Zr=St.eventTime;if((D&Hn)===Hn){rr!==null&&(rr=rr.next={eventTime:Zr,lane:0,tag:St.tag,payload:St.payload,callback:St.callback,next:null});e:{var ii=d,fi=St;switch(Hn=g,Zr=E,fi.tag){case 1:if(ii=fi.payload,typeof ii=="function"){cr=ii.call(Zr,cr,Hn);break e}cr=ii;break e;case 3:ii.flags=ii.flags&-65537|128;case 0:if(ii=fi.payload,Hn=typeof ii=="function"?ii.call(Zr,cr,Hn):ii,Hn==null)break e;cr=nt({},cr,Hn);break e;case 2:In=!0}}St.callback!==null&&St.lane!==0&&(d.flags|=64,Hn=K.effects,Hn===null?K.effects=[St]:Hn.push(St))}else Zr={eventTime:Zr,lane:Hn,tag:St.tag,payload:St.payload,callback:St.callback,next:null},rr===null?(_n=rr=Zr,Ot=cr):rr=rr.next=Zr,Ve|=Hn;if(St=St.next,St===null){if(St=K.shared.pending,St===null)break;Hn=St,St=Hn.next,Hn.next=null,K.lastBaseUpdate=Hn,K.shared.pending=null}}while(!0);if(rr===null&&(Ot=cr),K.baseState=Ot,K.firstBaseUpdate=_n,K.lastBaseUpdate=rr,g=K.shared.interleaved,g!==null){K=g;do Ve|=K.lane,K=K.next;while(K!==g)}else ce===null&&(K.shared.lanes=0);Ma|=Ve,d.lanes=Ve,d.memoizedState=cr}}function gi(d,g,E){if(d=g.effects,g.effects=null,d!==null)for(g=0;g<d.length;g++){var D=d[g],K=D.callback;if(K!==null){if(D.callback=null,D=E,typeof K!="function")throw Error(t(191,K));K.call(D)}}}var Sr={},ki=Pa(Sr),Ci=Pa(Sr),co=Pa(Sr);function Ri(d){if(d===Sr)throw Error(t(174));return d}function ba(d,g){switch(Hi(co,g),Hi(Ci,d),Hi(ki,Sr),d=g.nodeType,d){case 9:case 11:g=(g=g.documentElement)?g.namespaceURI:Mr(null,"");break;default:d=d===8?g.parentNode:g,g=d.namespaceURI||null,d=d.tagName,g=Mr(g,d)}qo(ki),Hi(ki,g)}function ts(){qo(ki),qo(Ci),qo(co)}function cc(d){Ri(co.current);var g=Ri(ki.current),E=Mr(g,d.type);g!==E&&(Hi(Ci,d),Hi(ki,E))}function Cc(d){Ci.current===d&&(qo(ki),qo(Ci))}var Li=Pa(0);function eo(d){for(var g=d;g!==null;){if(g.tag===13){var E=g.memoizedState;if(E!==null&&(E=E.dehydrated,E===null||E.data==="$?"||E.data==="$!"))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===d)break;for(;g.sibling===null;){if(g.return===null||g.return===d)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var uo=[];function Ms(){for(var d=0;d<uo.length;d++)uo[d]._workInProgressVersionPrimary=null;uo.length=0}var qa=ue.ReactCurrentDispatcher,ns=ue.ReactCurrentBatchConfig,As=0,hs=null,xs=null,ls=null,$l=!1,Il=!1,ka=0,rd=0;function Ys(){throw Error(t(321))}function Vh(d,g){if(g===null)return!1;for(var E=0;E<g.length&&E<d.length;E++)if(!ks(d[E],g[E]))return!1;return!0}function bd(d,g,E,D,K,ce){if(As=ce,hs=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,qa.current=d===null||d.memoizedState===null?bg:xm,d=E(D,K),Il){ce=0;do{if(Il=!1,ka=0,25<=ce)throw Error(t(301));ce+=1,ls=xs=null,g.updateQueue=null,qa.current=Hc,d=E(D,K)}while(Il)}if(qa.current=hc,g=xs!==null&&xs.next!==null,As=0,ls=xs=hs=null,$l=!1,g)throw Error(t(300));return d}function Ou(){var d=ka!==0;return ka=0,d}function Bu(){var d={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ls===null?hs.memoizedState=ls=d:ls=ls.next=d,ls}function Lc(){if(xs===null){var d=hs.alternate;d=d!==null?d.memoizedState:null}else d=xs.next;var g=ls===null?hs.memoizedState:ls.next;if(g!==null)ls=g,xs=d;else{if(d===null)throw Error(t(310));xs=d,d={memoizedState:xs.memoizedState,baseState:xs.baseState,baseQueue:xs.baseQueue,queue:xs.queue,next:null},ls===null?hs.memoizedState=ls=d:ls=ls.next=d}return ls}function qh(d,g){return typeof g=="function"?g(d):g}function id(d){var g=Lc(),E=g.queue;if(E===null)throw Error(t(311));E.lastRenderedReducer=d;var D=xs,K=D.baseQueue,ce=E.pending;if(ce!==null){if(K!==null){var Ve=K.next;K.next=ce.next,ce.next=Ve}D.baseQueue=K=ce,E.pending=null}if(K!==null){ce=K.next,D=D.baseState;var St=Ve=null,Ot=null,_n=ce;do{var rr=_n.lane;if((As&rr)===rr)Ot!==null&&(Ot=Ot.next={lane:0,action:_n.action,hasEagerState:_n.hasEagerState,eagerState:_n.eagerState,next:null}),D=_n.hasEagerState?_n.eagerState:d(D,_n.action);else{var cr={lane:rr,action:_n.action,hasEagerState:_n.hasEagerState,eagerState:_n.eagerState,next:null};Ot===null?(St=Ot=cr,Ve=D):Ot=Ot.next=cr,hs.lanes|=rr,Ma|=rr}_n=_n.next}while(_n!==null&&_n!==ce);Ot===null?Ve=D:Ot.next=St,ks(D,g.memoizedState)||(Te=!0),g.memoizedState=D,g.baseState=Ve,g.baseQueue=Ot,E.lastRenderedState=D}if(d=E.interleaved,d!==null){K=d;do ce=K.lane,hs.lanes|=ce,Ma|=ce,K=K.next;while(K!==d)}else K===null&&(E.lanes=0);return[g.memoizedState,E.dispatch]}function zu(d){var g=Lc(),E=g.queue;if(E===null)throw Error(t(311));E.lastRenderedReducer=d;var D=E.dispatch,K=E.pending,ce=g.memoizedState;if(K!==null){E.pending=null;var Ve=K=K.next;do ce=d(ce,Ve.action),Ve=Ve.next;while(Ve!==K);ks(ce,g.memoizedState)||(Te=!0),g.memoizedState=ce,g.baseQueue===null&&(g.baseState=ce),E.lastRenderedState=ce}return[ce,D]}function Fd(){}function Pc(d,g){var E=hs,D=Lc(),K=g(),ce=!ks(D.memoizedState,K);if(ce&&(D.memoizedState=K,Te=!0),D=D.queue,Uu(Od.bind(null,E,D,d),[d]),D.getSnapshot!==g||ce||ls!==null&&ls.memoizedState.tag&1){if(E.flags|=2048,kc(9,wd.bind(null,E,D,K,g),void 0,null),rl===null)throw Error(t(349));(As&30)!==0||ju(E,g,K)}return K}function ju(d,g,E){d.flags|=16384,d={getSnapshot:g,value:E},g=hs.updateQueue,g===null?(g={lastEffect:null,stores:null},hs.updateQueue=g,g.stores=[d]):(E=g.stores,E===null?g.stores=[d]:E.push(d))}function wd(d,g,E,D){g.value=E,g.getSnapshot=D,lh(g)&&cf(d)}function Od(d,g,E){return E(function(){lh(g)&&cf(d)})}function lh(d){var g=d.getSnapshot;d=d.value;try{var E=g();return!ks(d,E)}catch{return!0}}function cf(d){var g=on(d,1);g!==null&&ud(g,d,1,-1)}function kh(d){var g=Bu();return typeof d=="function"&&(d=d()),g.memoizedState=g.baseState=d,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:qh,lastRenderedState:d},g.queue=d,d=d.dispatch=Ra.bind(null,hs,d),[g.memoizedState,d]}function kc(d,g,E,D){return d={tag:d,create:g,destroy:E,deps:D,next:null},g=hs.updateQueue,g===null?(g={lastEffect:null,stores:null},hs.updateQueue=g,g.lastEffect=d.next=d):(E=g.lastEffect,E===null?g.lastEffect=d.next=d:(D=E.next,E.next=d,d.next=D,g.lastEffect=d)),d}function uc(){return Lc().memoizedState}function $a(d,g,E,D){var K=Bu();hs.flags|=d,K.memoizedState=kc(1|g,E,void 0,D===void 0?null:D)}function Rc(d,g,E,D){var K=Lc();D=D===void 0?null:D;var ce=void 0;if(xs!==null){var Ve=xs.memoizedState;if(ce=Ve.destroy,D!==null&&Vh(D,Ve.deps)){K.memoizedState=kc(g,E,ce,D);return}}hs.flags|=d,K.memoizedState=kc(1|g,E,ce,D)}function Gc(d,g){return $a(8390656,8,d,g)}function Uu(d,g){return Rc(2048,8,d,g)}function ch(d,g){return Rc(4,2,d,g)}function Vu(d,g){return Rc(4,4,d,g)}function uf(d,g){if(typeof g=="function")return d=d(),g(d),function(){g(null)};if(g!=null)return d=d(),g.current=d,function(){g.current=null}}function _g(d,g,E){return E=E!=null?E.concat([d]):null,Rc(4,4,uf.bind(null,g,d),E)}function kp(){}function vg(d,g){var E=Lc();g=g===void 0?null:g;var D=E.memoizedState;return D!==null&&g!==null&&Vh(g,D[1])?D[0]:(E.memoizedState=[d,g],d)}function _m(d,g){var E=Lc();g=g===void 0?null:g;var D=E.memoizedState;return D!==null&&g!==null&&Vh(g,D[1])?D[0]:(d=d(),E.memoizedState=[d,g],d)}function vm(d,g,E){return(As&21)===0?(d.baseState&&(d.baseState=!1,Te=!0),d.memoizedState=E):(ks(E,g)||(E=js(),hs.lanes|=E,Ma|=E,d.baseState=!0),g)}function Rh(d,g){var E=Gi;Gi=E!==0&&4>E?E:4,d(!0);var D=ns.transition;ns.transition={};try{d(!1),g()}finally{Gi=E,ns.transition=D}}function hf(){return Lc().memoizedState}function xg(d,g,E){var D=Td(d);if(E={lane:D,action:E,hasEagerState:!1,eagerState:null,next:null},Jr(d))od(g,E);else if(E=jt(d,g,E,D),E!==null){var K=$u();ud(E,d,D,K),Yf(E,g,D)}}function Ra(d,g,E){var D=Td(d),K={lane:D,action:E,hasEagerState:!1,eagerState:null,next:null};if(Jr(d))od(g,K);else{var ce=d.alternate;if(d.lanes===0&&(ce===null||ce.lanes===0)&&(ce=g.lastRenderedReducer,ce!==null))try{var Ve=g.lastRenderedState,St=ce(Ve,E);if(K.hasEagerState=!0,K.eagerState=St,ks(St,Ve)){var Ot=g.interleaved;Ot===null?(K.next=K,Cn(g)):(K.next=Ot.next,Ot.next=K),g.interleaved=K;return}}catch{}finally{}E=jt(d,g,K,D),E!==null&&(K=$u(),ud(E,d,D,K),Yf(E,g,D))}}function Jr(d){var g=d.alternate;return d===hs||g!==null&&g===hs}function od(d,g){Il=$l=!0;var E=d.pending;E===null?g.next=g:(g.next=E.next,E.next=g),d.pending=g}function Yf(d,g,E){if((E&4194240)!==0){var D=g.lanes;D&=d.pendingLanes,E|=D,g.lanes=E,yl(d,E)}}var hc={readContext:an,useCallback:Ys,useContext:Ys,useEffect:Ys,useImperativeHandle:Ys,useInsertionEffect:Ys,useLayoutEffect:Ys,useMemo:Ys,useReducer:Ys,useRef:Ys,useState:Ys,useDebugValue:Ys,useDeferredValue:Ys,useTransition:Ys,useMutableSource:Ys,useSyncExternalStore:Ys,useId:Ys,unstable_isNewReconciler:!1},bg={readContext:an,useCallback:function(d,g){return Bu().memoizedState=[d,g===void 0?null:g],d},useContext:an,useEffect:Gc,useImperativeHandle:function(d,g,E){return E=E!=null?E.concat([d]):null,$a(4194308,4,uf.bind(null,g,d),E)},useLayoutEffect:function(d,g){return $a(4194308,4,d,g)},useInsertionEffect:function(d,g){return $a(4,2,d,g)},useMemo:function(d,g){var E=Bu();return g=g===void 0?null:g,d=d(),E.memoizedState=[d,g],d},useReducer:function(d,g,E){var D=Bu();return g=E!==void 0?E(g):g,D.memoizedState=D.baseState=g,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:d,lastRenderedState:g},D.queue=d,d=d.dispatch=xg.bind(null,hs,d),[D.memoizedState,d]},useRef:function(d){var g=Bu();return d={current:d},g.memoizedState=d},useState:kh,useDebugValue:kp,useDeferredValue:function(d){return Bu().memoizedState=d},useTransition:function(){var d=kh(!1),g=d[0];return d=Rh.bind(null,d[1]),Bu().memoizedState=d,[g,d]},useMutableSource:function(){},useSyncExternalStore:function(d,g,E){var D=hs,K=Bu();if(v){if(E===void 0)throw Error(t(407));E=E()}else{if(E=g(),rl===null)throw Error(t(349));(As&30)!==0||ju(D,g,E)}K.memoizedState=E;var ce={value:E,getSnapshot:g};return K.queue=ce,Gc(Od.bind(null,D,ce,d),[d]),D.flags|=2048,kc(9,wd.bind(null,D,ce,E,g),void 0,null),E},useId:function(){var d=Bu(),g=rl.identifierPrefix;if(v){var E=ct,D=tn;E=(D&~(1<<32-Xo(D)-1)).toString(32)+E,g=":"+g+"R"+E,E=ka++,0<E&&(g+="H"+E.toString(32)),g+=":"}else E=rd++,g=":"+g+"r"+E.toString(32)+":";return d.memoizedState=g},unstable_isNewReconciler:!1},xm={readContext:an,useCallback:vg,useContext:an,useEffect:Uu,useImperativeHandle:_g,useInsertionEffect:ch,useLayoutEffect:Vu,useMemo:_m,useReducer:id,useRef:uc,useState:function(){return id(qh)},useDebugValue:kp,useDeferredValue:function(d){var g=Lc();return vm(g,xs.memoizedState,d)},useTransition:function(){var d=id(qh)[0],g=Lc().memoizedState;return[d,g]},useMutableSource:Fd,useSyncExternalStore:Pc,useId:hf,unstable_isNewReconciler:!1},Hc={readContext:an,useCallback:vg,useContext:an,useEffect:Uu,useImperativeHandle:_g,useInsertionEffect:ch,useLayoutEffect:Vu,useMemo:_m,useReducer:zu,useRef:uc,useState:function(){return zu(qh)},useDebugValue:kp,useDeferredValue:function(d){var g=Lc();return xs===null?g.memoizedState=d:vm(g,xs.memoizedState,d)},useTransition:function(){var d=zu(qh)[0],g=Lc().memoizedState;return[d,g]},useMutableSource:Fd,useSyncExternalStore:Pc,useId:hf,unstable_isNewReconciler:!1};function au(d,g){if(d&&d.defaultProps){g=nt({},g),d=d.defaultProps;for(var E in d)g[E]===void 0&&(g[E]=d[E]);return g}return g}function Wc(d,g,E,D){g=d.memoizedState,E=E(D,g),E=E==null?g:nt({},g,E),d.memoizedState=E,d.lanes===0&&(d.updateQueue.baseState=E)}var bu={isMounted:function(d){return(d=d._reactInternals)?ro(d)===d:!1},enqueueSetState:function(d,g,E){d=d._reactInternals;var D=$u(),K=Td(d),ce=pr(D,K);ce.payload=g,E!=null&&(ce.callback=E),g=Fr(d,ce,K),g!==null&&(ud(g,d,K,D),sr(g,d,K))},enqueueReplaceState:function(d,g,E){d=d._reactInternals;var D=$u(),K=Td(d),ce=pr(D,K);ce.tag=1,ce.payload=g,E!=null&&(ce.callback=E),g=Fr(d,ce,K),g!==null&&(ud(g,d,K,D),sr(g,d,K))},enqueueForceUpdate:function(d,g){d=d._reactInternals;var E=$u(),D=Td(d),K=pr(E,D);K.tag=2,g!=null&&(K.callback=g),g=Fr(d,K,D),g!==null&&(ud(g,d,D,E),sr(g,d,D))}};function sd(d,g,E,D,K,ce,Ve){return d=d.stateNode,typeof d.shouldComponentUpdate=="function"?d.shouldComponentUpdate(D,ce,Ve):g.prototype&&g.prototype.isPureReactComponent?!No(E,D)||!No(K,ce):!0}function Rp(d,g,E){var D=!1,K=xu,ce=g.contextType;return typeof ce=="object"&&ce!==null?ce=an(ce):(K=nl(g)?oh:Rs.current,D=g.contextTypes,ce=(D=D!=null)?tl(d,K):xu),g=new g(E,ce),d.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=bu,d.stateNode=g,g._reactInternals=d,D&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=K,d.__reactInternalMemoizedMaskedChildContext=ce),g}function Jf(d,g,E,D){d=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(E,D),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(E,D),g.state!==d&&bu.enqueueReplaceState(g,g.state,null)}function Qf(d,g,E,D){var K=d.stateNode;K.props=E,K.state=d.memoizedState,K.refs={},xn(d);var ce=g.contextType;typeof ce=="object"&&ce!==null?K.context=an(ce):(ce=nl(g)?oh:Rs.current,K.context=tl(d,ce)),K.state=d.memoizedState,ce=g.getDerivedStateFromProps,typeof ce=="function"&&(Wc(d,g,ce,E),K.state=d.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof K.getSnapshotBeforeUpdate=="function"||typeof K.UNSAFE_componentWillMount!="function"&&typeof K.componentWillMount!="function"||(g=K.state,typeof K.componentWillMount=="function"&&K.componentWillMount(),typeof K.UNSAFE_componentWillMount=="function"&&K.UNSAFE_componentWillMount(),g!==K.state&&bu.enqueueReplaceState(K,K.state,null),$r(d,E,K,D),K.state=d.memoizedState),typeof K.componentDidMount=="function"&&(d.flags|=4194308)}function Bd(d,g){try{var E="",D=g;do E+=Ye(D),D=D.return;while(D);var K=E}catch(ce){K=`
Error generating stack: `+ce.message+`
`+ce.stack}return{value:d,source:g,stack:K,digest:null}}function bm(d,g,E){return{value:d,source:null,stack:E??null,digest:g??null}}function ep(d,g){try{console.error(g.value)}catch(E){setTimeout(function(){throw E})}}var df=typeof WeakMap=="function"?WeakMap:Map;function zd(d,g,E){E=pr(-1,E),E.tag=3,E.payload={element:null};var D=g.value;return E.callback=function(){Sm||(Sm=!0,q0=D),ep(d,g)},E}function Sd(d,g,E){E=pr(-1,E),E.tag=3;var D=d.type.getDerivedStateFromError;if(typeof D=="function"){var K=g.value;E.payload=function(){return D(K)},E.callback=function(){ep(d,g)}}var ce=d.stateNode;return ce!==null&&typeof ce.componentDidCatch=="function"&&(E.callback=function(){ep(d,g),typeof D!="function"&&(wu===null?wu=new Set([this]):wu.add(this));var Ve=g.stack;this.componentDidCatch(g.value,{componentStack:Ve!==null?Ve:""})}),E}function $h(d,g,E){var D=d.pingCache;if(D===null){D=d.pingCache=new df;var K=new Set;D.set(g,K)}else K=D.get(g),K===void 0&&(K=new Set,D.set(g,K));K.has(E)||(K.add(E),d=Z0.bind(null,d,g,E),g.then(d,d))}function Mp(d){do{var g;if((g=d.tag===13)&&(g=d.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return d;d=d.return}while(d!==null);return null}function O(d,g,E,D,K){return(d.mode&1)===0?(d===g?d.flags|=65536:(d.flags|=128,E.flags|=131072,E.flags&=-52805,E.tag===1&&(E.alternate===null?E.tag=17:(g=pr(-1,1),g.tag=2,Fr(E,g,1))),E.lanes|=1),d):(d.flags|=65536,d.lanes=K,d)}var de=ue.ReactCurrentOwner,Te=!1;function Me(d,g,E,D){g.child=d===null?ot(g,null,E,D):it(g,d.child,E,D)}function tt(d,g,E,D,K){E=E.render;var ce=g.ref;return Ut(g,K),D=bd(d,g,E,D,ce,K),E=Ou(),d!==null&&!Te?(g.updateQueue=d.updateQueue,g.flags&=-2053,d.lanes&=~K,vr(d,g,K)):(v&&E&&En(g),g.flags|=1,Me(d,g,D,K),g.child)}function ze(d,g,E,D,K){if(d===null){var ce=E.type;return typeof ce=="function"&&!sp(ce)&&ce.defaultProps===void 0&&E.compare===null&&E.defaultProps===void 0?(g.tag=15,g.type=ce,Ke(d,g,ce,D,K)):(d=Ig(E.type,null,D,g,g.mode,K),d.ref=g.ref,d.return=g,g.child=d)}if(ce=d.child,(d.lanes&K)===0){var Ve=ce.memoizedProps;if(E=E.compare,E=E!==null?E:No,E(Ve,D)&&d.ref===g.ref)return vr(d,g,K)}return g.flags|=1,d=_f(ce,D),d.ref=g.ref,d.return=g,g.child=d}function Ke(d,g,E,D,K){if(d!==null){var ce=d.memoizedProps;if(No(ce,D)&&d.ref===g.ref)if(Te=!1,g.pendingProps=D=ce,(d.lanes&K)!==0)(d.flags&131072)!==0&&(Te=!0);else return g.lanes=d.lanes,vr(d,g,K)}return gt(d,g,E,D,K)}function At(d,g,E){var D=g.pendingProps,K=D.children,ce=d!==null?d.memoizedState:null;if(D.mode==="hidden")if((g.mode&1)===0)g.memoizedState={baseLanes:0,cachePool:null,transitions:null},Hi(mc,ea),ea|=E;else{if((E&1073741824)===0)return d=ce!==null?ce.baseLanes|E:E,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:d,cachePool:null,transitions:null},g.updateQueue=null,Hi(mc,ea),ea|=d,null;g.memoizedState={baseLanes:0,cachePool:null,transitions:null},D=ce!==null?ce.baseLanes:E,Hi(mc,ea),ea|=D}else ce!==null?(D=ce.baseLanes|E,g.memoizedState=null):D=E,Hi(mc,ea),ea|=D;return Me(d,g,K,E),g.child}function kt(d,g){var E=g.ref;(d===null&&E!==null||d!==null&&d.ref!==E)&&(g.flags|=512,g.flags|=2097152)}function gt(d,g,E,D,K){var ce=nl(E)?oh:Rs.current;return ce=tl(g,ce),Ut(g,K),E=bd(d,g,E,D,ce,K),D=Ou(),d!==null&&!Te?(g.updateQueue=d.updateQueue,g.flags&=-2053,d.lanes&=~K,vr(d,g,K)):(v&&D&&En(g),g.flags|=1,Me(d,g,E,K),g.child)}function $t(d,g,E,D,K){if(nl(E)){var ce=!0;Tl(g)}else ce=!1;if(Ut(g,K),g.stateNode===null)_i(d,g),Rp(g,E,D),Qf(g,E,D,K),D=!0;else if(d===null){var Ve=g.stateNode,St=g.memoizedProps;Ve.props=St;var Ot=Ve.context,_n=E.contextType;typeof _n=="object"&&_n!==null?_n=an(_n):(_n=nl(E)?oh:Rs.current,_n=tl(g,_n));var rr=E.getDerivedStateFromProps,cr=typeof rr=="function"||typeof Ve.getSnapshotBeforeUpdate=="function";cr||typeof Ve.UNSAFE_componentWillReceiveProps!="function"&&typeof Ve.componentWillReceiveProps!="function"||(St!==D||Ot!==_n)&&Jf(g,Ve,D,_n),In=!1;var Hn=g.memoizedState;Ve.state=Hn,$r(g,D,Ve,K),Ot=g.memoizedState,St!==D||Hn!==Ot||ac.current||In?(typeof rr=="function"&&(Wc(g,E,rr,D),Ot=g.memoizedState),(St=In||sd(g,E,St,D,Hn,Ot,_n))?(cr||typeof Ve.UNSAFE_componentWillMount!="function"&&typeof Ve.componentWillMount!="function"||(typeof Ve.componentWillMount=="function"&&Ve.componentWillMount(),typeof Ve.UNSAFE_componentWillMount=="function"&&Ve.UNSAFE_componentWillMount()),typeof Ve.componentDidMount=="function"&&(g.flags|=4194308)):(typeof Ve.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=D,g.memoizedState=Ot),Ve.props=D,Ve.state=Ot,Ve.context=_n,D=St):(typeof Ve.componentDidMount=="function"&&(g.flags|=4194308),D=!1)}else{Ve=g.stateNode,bn(d,g),St=g.memoizedProps,_n=g.type===g.elementType?St:au(g.type,St),Ve.props=_n,cr=g.pendingProps,Hn=Ve.context,Ot=E.contextType,typeof Ot=="object"&&Ot!==null?Ot=an(Ot):(Ot=nl(E)?oh:Rs.current,Ot=tl(g,Ot));var Zr=E.getDerivedStateFromProps;(rr=typeof Zr=="function"||typeof Ve.getSnapshotBeforeUpdate=="function")||typeof Ve.UNSAFE_componentWillReceiveProps!="function"&&typeof Ve.componentWillReceiveProps!="function"||(St!==cr||Hn!==Ot)&&Jf(g,Ve,D,Ot),In=!1,Hn=g.memoizedState,Ve.state=Hn,$r(g,D,Ve,K);var ii=g.memoizedState;St!==cr||Hn!==ii||ac.current||In?(typeof Zr=="function"&&(Wc(g,E,Zr,D),ii=g.memoizedState),(_n=In||sd(g,E,_n,D,Hn,ii,Ot)||!1)?(rr||typeof Ve.UNSAFE_componentWillUpdate!="function"&&typeof Ve.componentWillUpdate!="function"||(typeof Ve.componentWillUpdate=="function"&&Ve.componentWillUpdate(D,ii,Ot),typeof Ve.UNSAFE_componentWillUpdate=="function"&&Ve.UNSAFE_componentWillUpdate(D,ii,Ot)),typeof Ve.componentDidUpdate=="function"&&(g.flags|=4),typeof Ve.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof Ve.componentDidUpdate!="function"||St===d.memoizedProps&&Hn===d.memoizedState||(g.flags|=4),typeof Ve.getSnapshotBeforeUpdate!="function"||St===d.memoizedProps&&Hn===d.memoizedState||(g.flags|=1024),g.memoizedProps=D,g.memoizedState=ii),Ve.props=D,Ve.state=ii,Ve.context=Ot,D=_n):(typeof Ve.componentDidUpdate!="function"||St===d.memoizedProps&&Hn===d.memoizedState||(g.flags|=4),typeof Ve.getSnapshotBeforeUpdate!="function"||St===d.memoizedProps&&Hn===d.memoizedState||(g.flags|=1024),D=!1)}return en(d,g,E,D,ce,K)}function en(d,g,E,D,K,ce){kt(d,g);var Ve=(g.flags&128)!==0;if(!D&&!Ve)return K&&sh(g,E,!1),vr(d,g,ce);D=g.stateNode,de.current=g;var St=Ve&&typeof E.getDerivedStateFromError!="function"?null:D.render();return g.flags|=1,d!==null&&Ve?(g.child=it(g,d.child,null,ce),g.child=it(g,null,St,ce)):Me(d,g,St,ce),g.memoizedState=D.state,K&&sh(g,E,!0),g.child}function An(d){var g=d.stateNode;g.pendingContext?Ic(d,g.pendingContext,g.pendingContext!==g.context):g.context&&Ic(d,g.context,!1),ba(d,g.containerInfo)}function yn(d,g,E,D,K){return Ae(),Le(K),g.flags|=256,Me(d,g,E,D),g.child}var Kt={dehydrated:null,treeContext:null,retryLane:0};function rn(d){return{baseLanes:d,cachePool:null,transitions:null}}function $n(d,g,E){var D=g.pendingProps,K=Li.current,ce=!1,Ve=(g.flags&128)!==0,St;if((St=Ve)||(St=d!==null&&d.memoizedState===null?!1:(K&2)!==0),St?(ce=!0,g.flags&=-129):(d===null||d.memoizedState!==null)&&(K|=1),Hi(Li,K&1),d===null)return G(g),d=g.memoizedState,d!==null&&(d=d.dehydrated,d!==null)?((g.mode&1)===0?g.lanes=1:d.data==="$!"?g.lanes=8:g.lanes=1073741824,null):(Ve=D.children,d=D.fallback,ce?(D=g.mode,ce=g.child,Ve={mode:"hidden",children:Ve},(D&1)===0&&ce!==null?(ce.childLanes=0,ce.pendingProps=Ve):ce=Cg(Ve,D,0,null),d=ap(d,D,E,null),ce.return=g,d.return=g,ce.sibling=d,g.child=ce,g.child.memoizedState=rn(E),g.memoizedState=Kt,d):yr(g,Ve));if(K=d.memoizedState,K!==null&&(St=K.dehydrated,St!==null))return gr(d,g,Ve,D,St,K,E);if(ce){ce=D.fallback,Ve=g.mode,K=d.child,St=K.sibling;var Ot={mode:"hidden",children:D.children};return(Ve&1)===0&&g.child!==K?(D=g.child,D.childLanes=0,D.pendingProps=Ot,g.deletions=null):(D=_f(K,Ot),D.subtreeFlags=K.subtreeFlags&14680064),St!==null?ce=_f(St,ce):(ce=ap(ce,Ve,E,null),ce.flags|=2),ce.return=g,D.return=g,D.sibling=ce,g.child=D,D=ce,ce=g.child,Ve=d.child.memoizedState,Ve=Ve===null?rn(E):{baseLanes:Ve.baseLanes|E,cachePool:null,transitions:Ve.transitions},ce.memoizedState=Ve,ce.childLanes=d.childLanes&~E,g.memoizedState=Kt,D}return ce=d.child,d=ce.sibling,D=_f(ce,{mode:"visible",children:D.children}),(g.mode&1)===0&&(D.lanes=E),D.return=g,D.sibling=null,d!==null&&(E=g.deletions,E===null?(g.deletions=[d],g.flags|=16):E.push(d)),g.child=D,g.memoizedState=null,D}function yr(d,g){return g=Cg({mode:"visible",children:g},d.mode,0,null),g.return=d,d.child=g}function On(d,g,E,D){return D!==null&&Le(D),it(g,d.child,null,E),d=yr(g,g.pendingProps.children),d.flags|=2,g.memoizedState=null,d}function gr(d,g,E,D,K,ce,Ve){if(E)return g.flags&256?(g.flags&=-257,D=bm(Error(t(422))),On(d,g,Ve,D)):g.memoizedState!==null?(g.child=d.child,g.flags|=128,null):(ce=D.fallback,K=g.mode,D=Cg({mode:"visible",children:D.children},K,0,null),ce=ap(ce,K,Ve,null),ce.flags|=2,D.return=g,ce.return=g,D.sibling=ce,g.child=D,(g.mode&1)!==0&&it(g,d.child,null,Ve),g.child.memoizedState=rn(Ve),g.memoizedState=Kt,ce);if((g.mode&1)===0)return On(d,g,Ve,null);if(K.data==="$!"){if(D=K.nextSibling&&K.nextSibling.dataset,D)var St=D.dgst;return D=St,ce=Error(t(419)),D=bm(ce,D,void 0),On(d,g,Ve,D)}if(St=(Ve&d.childLanes)!==0,Te||St){if(D=rl,D!==null){switch(Ve&-Ve){case 4:K=2;break;case 16:K=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:K=32;break;case 536870912:K=268435456;break;default:K=0}K=(K&(D.suspendedLanes|Ve))!==0?0:K,K!==0&&K!==ce.retryLane&&(ce.retryLane=K,on(d,K),ud(D,d,K,-1))}return H0(),D=bm(Error(t(421))),On(d,g,Ve,D)}return K.data==="$?"?(g.flags|=128,g.child=d.child,g=Tx.bind(null,d),K._reactRetry=g,null):(d=ce.treeContext,f=El(K.nextSibling),a=g,v=!0,S=null,d!==null&&(et[dt++]=tn,et[dt++]=ct,et[dt++]=Nt,tn=d.id,ct=d.overflow,Nt=g),g=yr(g,D.children),g.flags|=4096,g)}function ti(d,g,E){d.lanes|=g;var D=d.alternate;D!==null&&(D.lanes|=g),mn(d.return,g,E)}function Or(d,g,E,D,K){var ce=d.memoizedState;ce===null?d.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:D,tail:E,tailMode:K}:(ce.isBackwards=g,ce.rendering=null,ce.renderingStartTime=0,ce.last=D,ce.tail=E,ce.tailMode=K)}function Hr(d,g,E){var D=g.pendingProps,K=D.revealOrder,ce=D.tail;if(Me(d,g,D.children,E),D=Li.current,(D&2)!==0)D=D&1|2,g.flags|=128;else{if(d!==null&&(d.flags&128)!==0)e:for(d=g.child;d!==null;){if(d.tag===13)d.memoizedState!==null&&ti(d,E,g);else if(d.tag===19)ti(d,E,g);else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===g)break e;for(;d.sibling===null;){if(d.return===null||d.return===g)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}D&=1}if(Hi(Li,D),(g.mode&1)===0)g.memoizedState=null;else switch(K){case"forwards":for(E=g.child,K=null;E!==null;)d=E.alternate,d!==null&&eo(d)===null&&(K=E),E=E.sibling;E=K,E===null?(K=g.child,g.child=null):(K=E.sibling,E.sibling=null),Or(g,!1,K,E,ce);break;case"backwards":for(E=null,K=g.child,g.child=null;K!==null;){if(d=K.alternate,d!==null&&eo(d)===null){g.child=K;break}d=K.sibling,K.sibling=E,E=K,K=d}Or(g,!0,E,null,ce);break;case"together":Or(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function _i(d,g){(g.mode&1)===0&&d!==null&&(d.alternate=null,g.alternate=null,g.flags|=2)}function vr(d,g,E){if(d!==null&&(g.dependencies=d.dependencies),Ma|=g.lanes,(E&g.childLanes)===0)return null;if(d!==null&&g.child!==d.child)throw Error(t(153));if(g.child!==null){for(d=g.child,E=_f(d,d.pendingProps),g.child=E,E.return=g;d.sibling!==null;)d=d.sibling,E=E.sibling=_f(d,d.pendingProps),E.return=g;E.sibling=null}return g.child}function Rr(d,g,E){switch(g.tag){case 3:An(g),Ae();break;case 5:cc(g);break;case 1:nl(g.type)&&Tl(g);break;case 4:ba(g,g.stateNode.containerInfo);break;case 10:var D=g.type._context,K=g.memoizedProps.value;Hi(bt,D._currentValue),D._currentValue=K;break;case 13:if(D=g.memoizedState,D!==null)return D.dehydrated!==null?(Hi(Li,Li.current&1),g.flags|=128,null):(E&g.child.childLanes)!==0?$n(d,g,E):(Hi(Li,Li.current&1),d=vr(d,g,E),d!==null?d.sibling:null);Hi(Li,Li.current&1);break;case 19:if(D=(E&g.childLanes)!==0,(d.flags&128)!==0){if(D)return Hr(d,g,E);g.flags|=128}if(K=g.memoizedState,K!==null&&(K.rendering=null,K.tail=null,K.lastEffect=null),Hi(Li,Li.current),D)break;return null;case 22:case 23:return g.lanes=0,At(d,g,E)}return vr(d,g,E)}var ji,Gr,jr,Wr;ji=function(d,g){for(var E=g.child;E!==null;){if(E.tag===5||E.tag===6)d.appendChild(E.stateNode);else if(E.tag!==4&&E.child!==null){E.child.return=E,E=E.child;continue}if(E===g)break;for(;E.sibling===null;){if(E.return===null||E.return===g)return;E=E.return}E.sibling.return=E.return,E=E.sibling}},Gr=function(){},jr=function(d,g,E,D){var K=d.memoizedProps;if(K!==D){d=g.stateNode,Ri(ki.current);var ce=null;switch(E){case"input":K=Gt(d,K),D=Gt(d,D),ce=[];break;case"select":K=nt({},K,{value:void 0}),D=nt({},D,{value:void 0}),ce=[];break;case"textarea":K=Yr(d,K),D=Yr(d,D),ce=[];break;default:typeof K.onClick!="function"&&typeof D.onClick=="function"&&(d.onclick=Lh)}Kr(E,D);var Ve;E=null;for(_n in K)if(!D.hasOwnProperty(_n)&&K.hasOwnProperty(_n)&&K[_n]!=null)if(_n==="style"){var St=K[_n];for(Ve in St)St.hasOwnProperty(Ve)&&(E||(E={}),E[Ve]="")}else _n!=="dangerouslySetInnerHTML"&&_n!=="children"&&_n!=="suppressContentEditableWarning"&&_n!=="suppressHydrationWarning"&&_n!=="autoFocus"&&(c.hasOwnProperty(_n)?ce||(ce=[]):(ce=ce||[]).push(_n,null));for(_n in D){var Ot=D[_n];if(St=K?.[_n],D.hasOwnProperty(_n)&&Ot!==St&&(Ot!=null||St!=null))if(_n==="style")if(St){for(Ve in St)!St.hasOwnProperty(Ve)||Ot&&Ot.hasOwnProperty(Ve)||(E||(E={}),E[Ve]="");for(Ve in Ot)Ot.hasOwnProperty(Ve)&&St[Ve]!==Ot[Ve]&&(E||(E={}),E[Ve]=Ot[Ve])}else E||(ce||(ce=[]),ce.push(_n,E)),E=Ot;else _n==="dangerouslySetInnerHTML"?(Ot=Ot?Ot.__html:void 0,St=St?St.__html:void 0,Ot!=null&&St!==Ot&&(ce=ce||[]).push(_n,Ot)):_n==="children"?typeof Ot!="string"&&typeof Ot!="number"||(ce=ce||[]).push(_n,""+Ot):_n!=="suppressContentEditableWarning"&&_n!=="suppressHydrationWarning"&&(c.hasOwnProperty(_n)?(Ot!=null&&_n==="onScroll"&&qn("scroll",d),ce||St===Ot||(ce=[])):(ce=ce||[]).push(_n,Ot))}E&&(ce=ce||[]).push("style",E);var _n=ce;(g.updateQueue=_n)&&(g.flags|=4)}},Wr=function(d,g,E,D){E!==D&&(g.flags|=4)};function Un(d,g){if(!v)switch(d.tailMode){case"hidden":g=d.tail;for(var E=null;g!==null;)g.alternate!==null&&(E=g),g=g.sibling;E===null?d.tail=null:E.sibling=null;break;case"collapsed":E=d.tail;for(var D=null;E!==null;)E.alternate!==null&&(D=E),E=E.sibling;D===null?g||d.tail===null?d.tail=null:d.tail.sibling=null:D.sibling=null}}function Jt(d){var g=d.alternate!==null&&d.alternate.child===d.child,E=0,D=0;if(g)for(var K=d.child;K!==null;)E|=K.lanes|K.childLanes,D|=K.subtreeFlags&14680064,D|=K.flags&14680064,K.return=d,K=K.sibling;else for(K=d.child;K!==null;)E|=K.lanes|K.childLanes,D|=K.subtreeFlags,D|=K.flags,K.return=d,K=K.sibling;return d.subtreeFlags|=D,d.childLanes=E,g}function pn(d,g,E){var D=g.pendingProps;switch(y(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Jt(g),null;case 1:return nl(g.type)&&Fu(),Jt(g),null;case 3:return D=g.stateNode,ts(),qo(ac),qo(Rs),Ms(),D.pendingContext&&(D.context=D.pendingContext,D.pendingContext=null),(d===null||d.child===null)&&(te(g)?g.flags|=4:d===null||d.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,S!==null&&(Vd(S),S=null))),Gr(d,g),Jt(g),null;case 5:Cc(g);var K=Ri(co.current);if(E=g.type,d!==null&&g.stateNode!=null)jr(d,g,E,D,K),d.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!D){if(g.stateNode===null)throw Error(t(166));return Jt(g),null}if(d=Ri(ki.current),te(g)){D=g.stateNode,E=g.type;var ce=g.memoizedProps;switch(D[Ua]=g,D[Vl]=ce,d=(g.mode&1)!==0,E){case"dialog":qn("cancel",D),qn("close",D);break;case"iframe":case"object":case"embed":qn("load",D);break;case"video":case"audio":for(K=0;K<ha.length;K++)qn(ha[K],D);break;case"source":qn("error",D);break;case"img":case"image":case"link":qn("error",D),qn("load",D);break;case"details":qn("toggle",D);break;case"input":st(D,ce),qn("invalid",D);break;case"select":D._wrapperState={wasMultiple:!!ce.multiple},qn("invalid",D);break;case"textarea":Vt(D,ce),qn("invalid",D)}Kr(E,ce),K=null;for(var Ve in ce)if(ce.hasOwnProperty(Ve)){var St=ce[Ve];Ve==="children"?typeof St=="string"?D.textContent!==St&&(ce.suppressHydrationWarning!==!0&&Zs(D.textContent,St,d),K=["children",St]):typeof St=="number"&&D.textContent!==""+St&&(ce.suppressHydrationWarning!==!0&&Zs(D.textContent,St,d),K=["children",""+St]):c.hasOwnProperty(Ve)&&St!=null&&Ve==="onScroll"&&qn("scroll",D)}switch(E){case"input":cn(D),Cr(D,ce,!0);break;case"textarea":cn(D),Gn(D);break;case"select":case"option":break;default:typeof ce.onClick=="function"&&(D.onclick=Lh)}D=K,g.updateQueue=D,D!==null&&(g.flags|=4)}else{Ve=K.nodeType===9?K:K.ownerDocument,d==="http://www.w3.org/1999/xhtml"&&(d=Dn(E)),d==="http://www.w3.org/1999/xhtml"?E==="script"?(d=Ve.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild)):typeof D.is=="string"?d=Ve.createElement(E,{is:D.is}):(d=Ve.createElement(E),E==="select"&&(Ve=d,D.multiple?Ve.multiple=!0:D.size&&(Ve.size=D.size))):d=Ve.createElementNS(d,E),d[Ua]=g,d[Vl]=D,ji(d,g,!1,!1),g.stateNode=d;e:{switch(Ve=Br(E,D),E){case"dialog":qn("cancel",d),qn("close",d),K=D;break;case"iframe":case"object":case"embed":qn("load",d),K=D;break;case"video":case"audio":for(K=0;K<ha.length;K++)qn(ha[K],d);K=D;break;case"source":qn("error",d),K=D;break;case"img":case"image":case"link":qn("error",d),qn("load",d),K=D;break;case"details":qn("toggle",d),K=D;break;case"input":st(d,D),K=Gt(d,D),qn("invalid",d);break;case"option":K=D;break;case"select":d._wrapperState={wasMultiple:!!D.multiple},K=nt({},D,{value:void 0}),qn("invalid",d);break;case"textarea":Vt(d,D),K=Yr(d,D),qn("invalid",d);break;default:K=D}Kr(E,K),St=K;for(ce in St)if(St.hasOwnProperty(ce)){var Ot=St[ce];ce==="style"?or(d,Ot):ce==="dangerouslySetInnerHTML"?(Ot=Ot?Ot.__html:void 0,Ot!=null&&Tr(d,Ot)):ce==="children"?typeof Ot=="string"?(E!=="textarea"||Ot!=="")&&Ir(d,Ot):typeof Ot=="number"&&Ir(d,""+Ot):ce!=="suppressContentEditableWarning"&&ce!=="suppressHydrationWarning"&&ce!=="autoFocus"&&(c.hasOwnProperty(ce)?Ot!=null&&ce==="onScroll"&&qn("scroll",d):Ot!=null&&me(d,ce,Ot,Ve))}switch(E){case"input":cn(d),Cr(d,D,!1);break;case"textarea":cn(d),Gn(d);break;case"option":D.value!=null&&d.setAttribute("value",""+ft(D.value));break;case"select":d.multiple=!!D.multiple,ce=D.value,ce!=null?er(d,!!D.multiple,ce,!1):D.defaultValue!=null&&er(d,!!D.multiple,D.defaultValue,!0);break;default:typeof K.onClick=="function"&&(d.onclick=Lh)}switch(E){case"button":case"input":case"select":case"textarea":D=!!D.autoFocus;break e;case"img":D=!0;break e;default:D=!1}}D&&(g.flags|=4)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return Jt(g),null;case 6:if(d&&g.stateNode!=null)Wr(d,g,d.memoizedProps,D);else{if(typeof D!="string"&&g.stateNode===null)throw Error(t(166));if(E=Ri(co.current),Ri(ki.current),te(g)){if(D=g.stateNode,E=g.memoizedProps,D[Ua]=g,(ce=D.nodeValue!==E)&&(d=a,d!==null))switch(d.tag){case 3:Zs(D.nodeValue,E,(d.mode&1)!==0);break;case 5:d.memoizedProps.suppressHydrationWarning!==!0&&Zs(D.nodeValue,E,(d.mode&1)!==0)}ce&&(g.flags|=4)}else D=(E.nodeType===9?E:E.ownerDocument).createTextNode(D),D[Ua]=g,g.stateNode=D}return Jt(g),null;case 13:if(qo(Li),D=g.memoizedState,d===null||d.memoizedState!==null&&d.memoizedState.dehydrated!==null){if(v&&f!==null&&(g.mode&1)!==0&&(g.flags&128)===0)ge(),Ae(),g.flags|=98560,ce=!1;else if(ce=te(g),D!==null&&D.dehydrated!==null){if(d===null){if(!ce)throw Error(t(318));if(ce=g.memoizedState,ce=ce!==null?ce.dehydrated:null,!ce)throw Error(t(317));ce[Ua]=g}else Ae(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;Jt(g),ce=!1}else S!==null&&(Vd(S),S=null),ce=!0;if(!ce)return g.flags&65536?g:null}return(g.flags&128)!==0?(g.lanes=E,g):(D=D!==null,D!==(d!==null&&d.memoizedState!==null)&&D&&(g.child.flags|=8192,(g.mode&1)!==0&&(d===null||(Li.current&1)!==0?Oo===0&&(Oo=3):H0())),g.updateQueue!==null&&(g.flags|=4),Jt(g),null);case 4:return ts(),Gr(d,g),d===null&&$c(g.stateNode.containerInfo),Jt(g),null;case 10:return zt(g.type._context),Jt(g),null;case 17:return nl(g.type)&&Fu(),Jt(g),null;case 19:if(qo(Li),ce=g.memoizedState,ce===null)return Jt(g),null;if(D=(g.flags&128)!==0,Ve=ce.rendering,Ve===null)if(D)Un(ce,!1);else{if(Oo!==0||d!==null&&(d.flags&128)!==0)for(d=g.child;d!==null;){if(Ve=eo(d),Ve!==null){for(g.flags|=128,Un(ce,!1),D=Ve.updateQueue,D!==null&&(g.updateQueue=D,g.flags|=4),g.subtreeFlags=0,D=E,E=g.child;E!==null;)ce=E,d=D,ce.flags&=14680066,Ve=ce.alternate,Ve===null?(ce.childLanes=0,ce.lanes=d,ce.child=null,ce.subtreeFlags=0,ce.memoizedProps=null,ce.memoizedState=null,ce.updateQueue=null,ce.dependencies=null,ce.stateNode=null):(ce.childLanes=Ve.childLanes,ce.lanes=Ve.lanes,ce.child=Ve.child,ce.subtreeFlags=0,ce.deletions=null,ce.memoizedProps=Ve.memoizedProps,ce.memoizedState=Ve.memoizedState,ce.updateQueue=Ve.updateQueue,ce.type=Ve.type,d=Ve.dependencies,ce.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),E=E.sibling;return Hi(Li,Li.current&1|2),g.child}d=d.sibling}ce.tail!==null&&Eo()>Np&&(g.flags|=128,D=!0,Un(ce,!1),g.lanes=4194304)}else{if(!D)if(d=eo(Ve),d!==null){if(g.flags|=128,D=!0,E=d.updateQueue,E!==null&&(g.updateQueue=E,g.flags|=4),Un(ce,!0),ce.tail===null&&ce.tailMode==="hidden"&&!Ve.alternate&&!v)return Jt(g),null}else 2*Eo()-ce.renderingStartTime>Np&&E!==1073741824&&(g.flags|=128,D=!0,Un(ce,!1),g.lanes=4194304);ce.isBackwards?(Ve.sibling=g.child,g.child=Ve):(E=ce.last,E!==null?E.sibling=Ve:g.child=Ve,ce.last=Ve)}return ce.tail!==null?(g=ce.tail,ce.rendering=g,ce.tail=g.sibling,ce.renderingStartTime=Eo(),g.sibling=null,E=Li.current,Hi(Li,D?E&1|2:E&1),g):(Jt(g),null);case 22:case 23:return Ag(),D=g.memoizedState!==null,d!==null&&d.memoizedState!==null!==D&&(g.flags|=8192),D&&(g.mode&1)!==0?(ea&1073741824)!==0&&(Jt(g),g.subtreeFlags&6&&(g.flags|=8192)):Jt(g),null;case 24:return null;case 25:return null}throw Error(t(156,g.tag))}function Xn(d,g){switch(y(g),g.tag){case 1:return nl(g.type)&&Fu(),d=g.flags,d&65536?(g.flags=d&-65537|128,g):null;case 3:return ts(),qo(ac),qo(Rs),Ms(),d=g.flags,(d&65536)!==0&&(d&128)===0?(g.flags=d&-65537|128,g):null;case 5:return Cc(g),null;case 13:if(qo(Li),d=g.memoizedState,d!==null&&d.dehydrated!==null){if(g.alternate===null)throw Error(t(340));Ae()}return d=g.flags,d&65536?(g.flags=d&-65537|128,g):null;case 19:return qo(Li),null;case 4:return ts(),null;case 10:return zt(g.type._context),null;case 22:case 23:return Ag(),null;case 24:return null;default:return null}}var dr=!1,qr=!1,Di=typeof WeakSet=="function"?WeakSet:Set,Wn=null;function qi(d,g){var E=d.ref;if(E!==null)if(typeof E=="function")try{E(null)}catch(D){Pl(d,g,D)}else E.current=null}function wo(d,g,E){try{E()}catch(D){Pl(d,g,D)}}var ho=!1;function dc(d,g){if(Ph=Bc,d=Ca(),Sc(d)){if("selectionStart"in d)var E={start:d.selectionStart,end:d.selectionEnd};else e:{E=(E=d.ownerDocument)&&E.defaultView||window;var D=E.getSelection&&E.getSelection();if(D&&D.rangeCount!==0){E=D.anchorNode;var K=D.anchorOffset,ce=D.focusNode;D=D.focusOffset;try{E.nodeType,ce.nodeType}catch{E=null;break e}var Ve=0,St=-1,Ot=-1,_n=0,rr=0,cr=d,Hn=null;t:for(;;){for(var Zr;cr!==E||K!==0&&cr.nodeType!==3||(St=Ve+K),cr!==ce||D!==0&&cr.nodeType!==3||(Ot=Ve+D),cr.nodeType===3&&(Ve+=cr.nodeValue.length),(Zr=cr.firstChild)!==null;)Hn=cr,cr=Zr;for(;;){if(cr===d)break t;if(Hn===E&&++_n===K&&(St=Ve),Hn===ce&&++rr===D&&(Ot=Ve),(Zr=cr.nextSibling)!==null)break;cr=Hn,Hn=cr.parentNode}cr=Zr}E=St===-1||Ot===-1?null:{start:St,end:Ot}}else E=null}E=E||{start:0,end:0}}else E=null;for(ni={focusedElem:d,selectionRange:E},Bc=!1,Wn=g;Wn!==null;)if(g=Wn,d=g.child,(g.subtreeFlags&1028)!==0&&d!==null)d.return=g,Wn=d;else for(;Wn!==null;){g=Wn;try{var ii=g.alternate;if((g.flags&1024)!==0)switch(g.tag){case 0:case 11:case 15:break;case 1:if(ii!==null){var fi=ii.memoizedProps,kl=ii.memoizedState,ln=g.stateNode,Wt=ln.getSnapshotBeforeUpdate(g.elementType===g.type?fi:au(g.type,fi),kl);ln.__reactInternalSnapshotBeforeUpdate=Wt}break;case 3:var fn=g.stateNode.containerInfo;fn.nodeType===1?fn.textContent="":fn.nodeType===9&&fn.documentElement&&fn.removeChild(fn.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(xr){Pl(g,g.return,xr)}if(d=g.sibling,d!==null){d.return=g.return,Wn=d;break}Wn=g.return}return ii=ho,ho=!1,ii}function Ns(d,g,E){var D=g.updateQueue;if(D=D!==null?D.lastEffect:null,D!==null){var K=D=D.next;do{if((K.tag&d)===d){var ce=K.destroy;K.destroy=void 0,ce!==void 0&&wo(g,E,ce)}K=K.next}while(K!==D)}}function Ds(d,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var E=g=g.next;do{if((E.tag&d)===d){var D=E.create;E.destroy=D()}E=E.next}while(E!==g)}}function fo(d){var g=d.ref;if(g!==null){var E=d.stateNode;switch(d.tag){case 5:d=E;break;default:d=E}typeof g=="function"?g(d):g.current=d}}function Qn(d){var g=d.alternate;g!==null&&(d.alternate=null,Qn(g)),d.child=null,d.deletions=null,d.sibling=null,d.tag===5&&(g=d.stateNode,g!==null&&(delete g[Ua],delete g[Vl],delete g[lo],delete g[vd],delete g[nd])),d.stateNode=null,d.return=null,d.dependencies=null,d.memoizedProps=null,d.memoizedState=null,d.pendingProps=null,d.stateNode=null,d.updateQueue=null}function lu(d){return d.tag===5||d.tag===3||d.tag===4}function ad(d){e:for(;;){for(;d.sibling===null;){if(d.return===null||lu(d.return))return null;d=d.return}for(d.sibling.return=d.return,d=d.sibling;d.tag!==5&&d.tag!==6&&d.tag!==18;){if(d.flags&2||d.child===null||d.tag===4)continue e;d.child.return=d,d=d.child}if(!(d.flags&2))return d.stateNode}}function Mh(d,g,E){var D=d.tag;if(D===5||D===6)d=d.stateNode,g?E.nodeType===8?E.parentNode.insertBefore(d,g):E.insertBefore(d,g):(E.nodeType===8?(g=E.parentNode,g.insertBefore(d,E)):(g=E,g.appendChild(d)),E=E._reactRootContainer,E!=null||g.onclick!==null||(g.onclick=Lh));else if(D!==4&&(d=d.child,d!==null))for(Mh(d,g,E),d=d.sibling;d!==null;)Mh(d,g,E),d=d.sibling}function Cl(d,g,E){var D=d.tag;if(D===5||D===6)d=d.stateNode,g?E.insertBefore(d,g):E.appendChild(d);else if(D!==4&&(d=d.child,d!==null))for(Cl(d,g,E),d=d.sibling;d!==null;)Cl(d,g,E),d=d.sibling}var Js=null,Qs=!1;function Mc(d,g,E){for(E=E.child;E!==null;)uh(d,g,E),E=E.sibling}function uh(d,g,E){if(sa&&typeof sa.onCommitFiberUnmount=="function")try{sa.onCommitFiberUnmount(Aa,E)}catch{}switch(E.tag){case 5:qr||qi(E,g);case 6:var D=Js,K=Qs;Js=null,Mc(d,g,E),Js=D,Qs=K,Js!==null&&(Qs?(d=Js,E=E.stateNode,d.nodeType===8?d.parentNode.removeChild(E):d.removeChild(E)):Js.removeChild(E.stateNode));break;case 18:Js!==null&&(Qs?(d=Js,E=E.stateNode,d.nodeType===8?ih(d.parentNode,E):d.nodeType===1&&ih(d,E),Vs(d)):ih(Js,E.stateNode));break;case 4:D=Js,K=Qs,Js=E.stateNode.containerInfo,Qs=!0,Mc(d,g,E),Js=D,Qs=K;break;case 0:case 11:case 14:case 15:if(!qr&&(D=E.updateQueue,D!==null&&(D=D.lastEffect,D!==null))){K=D=D.next;do{var ce=K,Ve=ce.destroy;ce=ce.tag,Ve!==void 0&&((ce&2)!==0||(ce&4)!==0)&&wo(E,g,Ve),K=K.next}while(K!==D)}Mc(d,g,E);break;case 1:if(!qr&&(qi(E,g),D=E.stateNode,typeof D.componentWillUnmount=="function"))try{D.props=E.memoizedProps,D.state=E.memoizedState,D.componentWillUnmount()}catch(St){Pl(E,g,St)}Mc(d,g,E);break;case 21:Mc(d,g,E);break;case 22:E.mode&1?(qr=(D=qr)||E.memoizedState!==null,Mc(d,g,E),qr=D):Mc(d,g,E);break;default:Mc(d,g,E)}}function ff(d){var g=d.updateQueue;if(g!==null){d.updateQueue=null;var E=d.stateNode;E===null&&(E=d.stateNode=new Di),g.forEach(function(D){var K=Ix.bind(null,d,D);E.has(D)||(E.add(D),D.then(K,K))})}}function fc(d,g){var E=g.deletions;if(E!==null)for(var D=0;D<E.length;D++){var K=E[D];try{var ce=d,Ve=g,St=Ve;e:for(;St!==null;){switch(St.tag){case 5:Js=St.stateNode,Qs=!1;break e;case 3:Js=St.stateNode.containerInfo,Qs=!0;break e;case 4:Js=St.stateNode.containerInfo,Qs=!0;break e}St=St.return}if(Js===null)throw Error(t(160));uh(ce,Ve,K),Js=null,Qs=!1;var Ot=K.alternate;Ot!==null&&(Ot.return=null),K.return=null}catch(_n){Pl(K,g,_n)}}if(g.subtreeFlags&12854)for(g=g.child;g!==null;)jd(g,d),g=g.sibling}function jd(d,g){var E=d.alternate,D=d.flags;switch(d.tag){case 0:case 11:case 14:case 15:if(fc(g,d),pc(d),D&4){try{Ns(3,d,d.return),Ds(3,d)}catch(fi){Pl(d,d.return,fi)}try{Ns(5,d,d.return)}catch(fi){Pl(d,d.return,fi)}}break;case 1:fc(g,d),pc(d),D&512&&E!==null&&qi(E,E.return);break;case 5:if(fc(g,d),pc(d),D&512&&E!==null&&qi(E,E.return),d.flags&32){var K=d.stateNode;try{Ir(K,"")}catch(fi){Pl(d,d.return,fi)}}if(D&4&&(K=d.stateNode,K!=null)){var ce=d.memoizedProps,Ve=E!==null?E.memoizedProps:ce,St=d.type,Ot=d.updateQueue;if(d.updateQueue=null,Ot!==null)try{St==="input"&&ce.type==="radio"&&ce.name!=null&&mr(K,ce),Br(St,Ve);var _n=Br(St,ce);for(Ve=0;Ve<Ot.length;Ve+=2){var rr=Ot[Ve],cr=Ot[Ve+1];rr==="style"?or(K,cr):rr==="dangerouslySetInnerHTML"?Tr(K,cr):rr==="children"?Ir(K,cr):me(K,rr,cr,_n)}switch(St){case"input":Er(K,ce);break;case"textarea":Pn(K,ce);break;case"select":var Hn=K._wrapperState.wasMultiple;K._wrapperState.wasMultiple=!!ce.multiple;var Zr=ce.value;Zr!=null?er(K,!!ce.multiple,Zr,!1):Hn!==!!ce.multiple&&(ce.defaultValue!=null?er(K,!!ce.multiple,ce.defaultValue,!0):er(K,!!ce.multiple,ce.multiple?[]:"",!1))}K[Vl]=ce}catch(fi){Pl(d,d.return,fi)}}break;case 6:if(fc(g,d),pc(d),D&4){if(d.stateNode===null)throw Error(t(162));K=d.stateNode,ce=d.memoizedProps;try{K.nodeValue=ce}catch(fi){Pl(d,d.return,fi)}}break;case 3:if(fc(g,d),pc(d),D&4&&E!==null&&E.memoizedState.isDehydrated)try{Vs(g.containerInfo)}catch(fi){Pl(d,d.return,fi)}break;case 4:fc(g,d),pc(d);break;case 13:fc(g,d),pc(d),K=d.child,K.flags&8192&&(ce=K.memoizedState!==null,K.stateNode.isHidden=ce,!ce||K.alternate!==null&&K.alternate.memoizedState!==null||(wm=Eo())),D&4&&ff(d);break;case 22:if(rr=E!==null&&E.memoizedState!==null,d.mode&1?(qr=(_n=qr)||rr,fc(g,d),qr=_n):fc(g,d),pc(d),D&8192){if(_n=d.memoizedState!==null,(d.stateNode.isHidden=_n)&&!rr&&(d.mode&1)!==0)for(Wn=d,rr=d.child;rr!==null;){for(cr=Wn=rr;Wn!==null;){switch(Hn=Wn,Zr=Hn.child,Hn.tag){case 0:case 11:case 14:case 15:Ns(4,Hn,Hn.return);break;case 1:qi(Hn,Hn.return);var ii=Hn.stateNode;if(typeof ii.componentWillUnmount=="function"){D=Hn,E=Hn.return;try{g=D,ii.props=g.memoizedProps,ii.state=g.memoizedState,ii.componentWillUnmount()}catch(fi){Pl(D,E,fi)}}break;case 5:qi(Hn,Hn.return);break;case 22:if(Hn.memoizedState!==null){hh(cr);continue}}Zr!==null?(Zr.return=Hn,Wn=Zr):hh(cr)}rr=rr.sibling}e:for(rr=null,cr=d;;){if(cr.tag===5){if(rr===null){rr=cr;try{K=cr.stateNode,_n?(ce=K.style,typeof ce.setProperty=="function"?ce.setProperty("display","none","important"):ce.display="none"):(St=cr.stateNode,Ot=cr.memoizedProps.style,Ve=Ot!=null&&Ot.hasOwnProperty("display")?Ot.display:null,St.style.display=Pi("display",Ve))}catch(fi){Pl(d,d.return,fi)}}}else if(cr.tag===6){if(rr===null)try{cr.stateNode.nodeValue=_n?"":cr.memoizedProps}catch(fi){Pl(d,d.return,fi)}}else if((cr.tag!==22&&cr.tag!==23||cr.memoizedState===null||cr===d)&&cr.child!==null){cr.child.return=cr,cr=cr.child;continue}if(cr===d)break e;for(;cr.sibling===null;){if(cr.return===null||cr.return===d)break e;rr===cr&&(rr=null),cr=cr.return}rr===cr&&(rr=null),cr.sibling.return=cr.return,cr=cr.sibling}}break;case 19:fc(g,d),pc(d),D&4&&ff(d);break;case 21:break;default:fc(g,d),pc(d)}}function pc(d){var g=d.flags;if(g&2){try{e:{for(var E=d.return;E!==null;){if(lu(E)){var D=E;break e}E=E.return}throw Error(t(160))}switch(D.tag){case 5:var K=D.stateNode;D.flags&32&&(Ir(K,""),D.flags&=-33);var ce=ad(d);Cl(d,ce,K);break;case 3:case 4:var Ve=D.stateNode.containerInfo,St=ad(d);Mh(d,St,Ve);break;default:throw Error(t(161))}}catch(Ot){Pl(d,d.return,Ot)}d.flags&=-3}g&4096&&(d.flags&=-4097)}function ci(d,g,E){Wn=d,bs(d)}function bs(d,g,E){for(var D=(d.mode&1)!==0;Wn!==null;){var K=Wn,ce=K.child;if(K.tag===22&&D){var Ve=K.memoizedState!==null||dr;if(!Ve){var St=K.alternate,Ot=St!==null&&St.memoizedState!==null||qr;St=dr;var _n=qr;if(dr=Ve,(qr=Ot)&&!_n)for(Wn=K;Wn!==null;)Ve=Wn,Ot=Ve.child,Ve.tag===22&&Ve.memoizedState!==null?Ll(K):Ot!==null?(Ot.return=Ve,Wn=Ot):Ll(K);for(;ce!==null;)Wn=ce,bs(ce),ce=ce.sibling;Wn=K,dr=St,qr=_n}da(d)}else(K.subtreeFlags&8772)!==0&&ce!==null?(ce.return=K,Wn=ce):da(d)}}function da(d){for(;Wn!==null;){var g=Wn;if((g.flags&8772)!==0){var E=g.alternate;try{if((g.flags&8772)!==0)switch(g.tag){case 0:case 11:case 15:qr||Ds(5,g);break;case 1:var D=g.stateNode;if(g.flags&4&&!qr)if(E===null)D.componentDidMount();else{var K=g.elementType===g.type?E.memoizedProps:au(g.type,E.memoizedProps);D.componentDidUpdate(K,E.memoizedState,D.__reactInternalSnapshotBeforeUpdate)}var ce=g.updateQueue;ce!==null&&gi(g,ce,D);break;case 3:var Ve=g.updateQueue;if(Ve!==null){if(E=null,g.child!==null)switch(g.child.tag){case 5:E=g.child.stateNode;break;case 1:E=g.child.stateNode}gi(g,Ve,E)}break;case 5:var St=g.stateNode;if(E===null&&g.flags&4){E=St;var Ot=g.memoizedProps;switch(g.type){case"button":case"input":case"select":case"textarea":Ot.autoFocus&&E.focus();break;case"img":Ot.src&&(E.src=Ot.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(g.memoizedState===null){var _n=g.alternate;if(_n!==null){var rr=_n.memoizedState;if(rr!==null){var cr=rr.dehydrated;cr!==null&&Vs(cr)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}qr||g.flags&512&&fo(g)}catch(Hn){Pl(g,g.return,Hn)}}if(g===d){Wn=null;break}if(E=g.sibling,E!==null){E.return=g.return,Wn=E;break}Wn=g.return}}function hh(d){for(;Wn!==null;){var g=Wn;if(g===d){Wn=null;break}var E=g.sibling;if(E!==null){E.return=g.return,Wn=E;break}Wn=g.return}}function Ll(d){for(;Wn!==null;){var g=Wn;try{switch(g.tag){case 0:case 11:case 15:var E=g.return;try{Ds(4,g)}catch(Ot){Pl(g,E,Ot)}break;case 1:var D=g.stateNode;if(typeof D.componentDidMount=="function"){var K=g.return;try{D.componentDidMount()}catch(Ot){Pl(g,K,Ot)}}var ce=g.return;try{fo(g)}catch(Ot){Pl(g,ce,Ot)}break;case 5:var Ve=g.return;try{fo(g)}catch(Ot){Pl(g,Ve,Ot)}}}catch(Ot){Pl(g,g.return,Ot)}if(g===d){Wn=null;break}var St=g.sibling;if(St!==null){St.return=g.return,Wn=St;break}Wn=g.return}}var Ed=Math.ceil,qu=ue.ReactCurrentDispatcher,dh=ue.ReactCurrentOwner,Ga=ue.ReactCurrentBatchConfig,Qr=0,rl=null,Ts=null,fa=0,ea=0,mc=Pa(0),Oo=0,pf=null,Ma=0,tp=0,Gh=0,Ud=null,cu=null,wm=0,Np=1/0,ld=null,Sm=!1,q0=null,wu=null,Ad=!1,cd=null,np=0,rp=0,wg=null,Sg=-1,Em=0;function $u(){return(Qr&6)!==0?Eo():Sg!==-1?Sg:Sg=Eo()}function Td(d){return(d.mode&1)===0?1:(Qr&2)!==0&&fa!==0?fa&-fa:Xe.transition!==null?(Em===0&&(Em=js()),Em):(d=Gi,d!==0||(d=window.event,d=d===void 0?16:vc(d.type)),d)}function ud(d,g,E,D){if(50<rp)throw rp=0,wg=null,Error(t(185));bi(d,E,D),((Qr&2)===0||d!==rl)&&(d===rl&&((Qr&2)===0&&(tp|=E),Oo===4&&mf(d,fa)),Su(d,D),E===1&&Qr===0&&(g.mode&1)===0&&(Np=Eo()+500,ah&&oe()))}function Su(d,g){var E=d.callbackNode;zr(d,g);var D=Cs(d,d===rl?fa:0);if(D===0)E!==null&&Wi(E),d.callbackNode=null,d.callbackPriority=0;else if(g=D&-D,d.callbackPriority!==g){if(E!=null&&Wi(E),g===1)d.tag===0?Q(ip.bind(null,d)):B(ip.bind(null,d)),Uh(function(){(Qr&6)===0&&oe()}),E=null;else{switch(fs(D)){case 1:E=Ea;break;case 4:E=Ko;break;case 16:E=Xa;break;case 536870912:E=Ql;break;default:E=Xa}E=Tm(E,$0.bind(null,d))}d.callbackPriority=g,d.callbackNode=E}}function $0(d,g){if(Sg=-1,Em=0,(Qr&6)!==0)throw Error(t(327));var E=d.callbackNode;if(fh()&&d.callbackNode!==E)return null;var D=Cs(d,d===rl?fa:0);if(D===0)return null;if((D&30)!==0||(D&d.expiredLanes)!==0||g)g=Am(d,D);else{g=D;var K=Qr;Qr|=2;var ce=G0();(rl!==d||fa!==g)&&(ld=null,Np=Eo()+500,op(d,g));do try{Ax();break}catch(St){z_(d,St)}while(!0);Lt(),qu.current=ce,Qr=K,Ts!==null?g=0:(rl=null,fa=0,g=Oo)}if(g!==0){if(g===2&&(K=Nr(d),K!==0&&(D=K,g=Eg(d,K))),g===1)throw E=pf,op(d,0),mf(d,D),Su(d,Eo()),E;if(g===6)mf(d,D);else{if(K=d.current.alternate,(D&30)===0&&!B_(K)&&(g=Am(d,D),g===2&&(ce=Nr(d),ce!==0&&(D=ce,g=Eg(d,ce))),g===1))throw E=pf,op(d,0),mf(d,D),Su(d,Eo()),E;switch(d.finishedWork=K,d.finishedLanes=D,g){case 0:case 1:throw Error(t(345));case 2:yf(d,cu,ld);break;case 3:if(mf(d,D),(D&130023424)===D&&(g=wm+500-Eo(),10<g)){if(Cs(d,0)!==0)break;if(K=d.suspendedLanes,(K&D)!==D){$u(),d.pingedLanes|=d.suspendedLanes&K;break}d.timeoutHandle=rh(yf.bind(null,d,cu,ld),g);break}yf(d,cu,ld);break;case 4:if(mf(d,D),(D&4194240)===D)break;for(g=d.eventTimes,K=-1;0<D;){var Ve=31-Xo(D);ce=1<<Ve,Ve=g[Ve],Ve>K&&(K=Ve),D&=~ce}if(D=K,D=Eo()-D,D=(120>D?120:480>D?480:1080>D?1080:1920>D?1920:3e3>D?3e3:4320>D?4320:1960*Ed(D/1960))-D,10<D){d.timeoutHandle=rh(yf.bind(null,d,cu,ld),D);break}yf(d,cu,ld);break;case 5:yf(d,cu,ld);break;default:throw Error(t(329))}}}return Su(d,Eo()),d.callbackNode===E?$0.bind(null,d):null}function Eg(d,g){var E=Ud;return d.current.memoizedState.isDehydrated&&(op(d,g).flags|=256),d=Am(d,g),d!==2&&(g=cu,cu=E,g!==null&&Vd(g)),d}function Vd(d){cu===null?cu=d:cu.push.apply(cu,d)}function B_(d){for(var g=d;;){if(g.flags&16384){var E=g.updateQueue;if(E!==null&&(E=E.stores,E!==null))for(var D=0;D<E.length;D++){var K=E[D],ce=K.getSnapshot;K=K.value;try{if(!ks(ce(),K))return!1}catch{return!1}}}if(E=g.child,g.subtreeFlags&16384&&E!==null)E.return=g,g=E;else{if(g===d)break;for(;g.sibling===null;){if(g.return===null||g.return===d)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function mf(d,g){for(g&=~Gh,g&=~tp,d.suspendedLanes|=g,d.pingedLanes&=~g,d=d.expirationTimes;0<g;){var E=31-Xo(g),D=1<<E;d[E]=-1,g&=~D}}function ip(d){if((Qr&6)!==0)throw Error(t(327));fh();var g=Cs(d,0);if((g&1)===0)return Su(d,Eo()),null;var E=Am(d,g);if(d.tag!==0&&E===2){var D=Nr(d);D!==0&&(g=D,E=Eg(d,D))}if(E===1)throw E=pf,op(d,0),mf(d,g),Su(d,Eo()),E;if(E===6)throw Error(t(345));return d.finishedWork=d.current.alternate,d.finishedLanes=g,yf(d,cu,ld),Su(d,Eo()),null}function Dp(d,g){var E=Qr;Qr|=1;try{return d(g)}finally{Qr=E,Qr===0&&(Np=Eo()+500,ah&&oe())}}function gf(d){cd!==null&&cd.tag===0&&(Qr&6)===0&&fh();var g=Qr;Qr|=1;var E=Ga.transition,D=Gi;try{if(Ga.transition=null,Gi=1,d)return d()}finally{Gi=D,Ga.transition=E,Qr=g,(Qr&6)===0&&oe()}}function Ag(){ea=mc.current,qo(mc)}function op(d,g){d.finishedWork=null,d.finishedLanes=0;var E=d.timeoutHandle;if(E!==-1&&(d.timeoutHandle=-1,dl(E)),Ts!==null)for(E=Ts.return;E!==null;){var D=E;switch(y(D),D.tag){case 1:D=D.type.childContextTypes,D!=null&&Fu();break;case 3:ts(),qo(ac),qo(Rs),Ms();break;case 5:Cc(D);break;case 4:ts();break;case 13:qo(Li);break;case 19:qo(Li);break;case 10:zt(D.type._context);break;case 22:case 23:Ag()}E=E.return}if(rl=d,Ts=d=_f(d.current,null),fa=ea=g,Oo=0,pf=null,Gh=tp=Ma=0,cu=Ud=null,Ht!==null){for(g=0;g<Ht.length;g++)if(E=Ht[g],D=E.interleaved,D!==null){E.interleaved=null;var K=D.next,ce=E.pending;if(ce!==null){var Ve=ce.next;ce.next=K,D.next=Ve}E.pending=D}Ht=null}return d}function z_(d,g){do{var E=Ts;try{if(Lt(),qa.current=hc,$l){for(var D=hs.memoizedState;D!==null;){var K=D.queue;K!==null&&(K.pending=null),D=D.next}$l=!1}if(As=0,ls=xs=hs=null,Il=!1,ka=0,dh.current=null,E===null||E.return===null){Oo=1,pf=g,Ts=null;break}e:{var ce=d,Ve=E.return,St=E,Ot=g;if(g=fa,St.flags|=32768,Ot!==null&&typeof Ot=="object"&&typeof Ot.then=="function"){var _n=Ot,rr=St,cr=rr.tag;if((rr.mode&1)===0&&(cr===0||cr===11||cr===15)){var Hn=rr.alternate;Hn?(rr.updateQueue=Hn.updateQueue,rr.memoizedState=Hn.memoizedState,rr.lanes=Hn.lanes):(rr.updateQueue=null,rr.memoizedState=null)}var Zr=Mp(Ve);if(Zr!==null){Zr.flags&=-257,O(Zr,Ve,St,ce,g),Zr.mode&1&&$h(ce,_n,g),g=Zr,Ot=_n;var ii=g.updateQueue;if(ii===null){var fi=new Set;fi.add(Ot),g.updateQueue=fi}else ii.add(Ot);break e}else{if((g&1)===0){$h(ce,_n,g),H0();break e}Ot=Error(t(426))}}else if(v&&St.mode&1){var kl=Mp(Ve);if(kl!==null){(kl.flags&65536)===0&&(kl.flags|=256),O(kl,Ve,St,ce,g),Le(Bd(Ot,St));break e}}ce=Ot=Bd(Ot,St),Oo!==4&&(Oo=2),Ud===null?Ud=[ce]:Ud.push(ce),ce=Ve;do{switch(ce.tag){case 3:ce.flags|=65536,g&=-g,ce.lanes|=g;var ln=zd(ce,Ot,g);fr(ce,ln);break e;case 1:St=Ot;var Wt=ce.type,fn=ce.stateNode;if((ce.flags&128)===0&&(typeof Wt.getDerivedStateFromError=="function"||fn!==null&&typeof fn.componentDidCatch=="function"&&(wu===null||!wu.has(fn)))){ce.flags|=65536,g&=-g,ce.lanes|=g;var xr=Sd(ce,St,g);fr(ce,xr);break e}}ce=ce.return}while(ce!==null)}K0(E)}catch(pi){g=pi,Ts===E&&E!==null&&(Ts=E=E.return);continue}break}while(!0)}function G0(){var d=qu.current;return qu.current=hc,d===null?hc:d}function H0(){(Oo===0||Oo===3||Oo===2)&&(Oo=4),rl===null||(Ma&268435455)===0&&(tp&268435455)===0||mf(rl,fa)}function Am(d,g){var E=Qr;Qr|=2;var D=G0();(rl!==d||fa!==g)&&(ld=null,op(d,g));do try{Ex();break}catch(K){z_(d,K)}while(!0);if(Lt(),Qr=E,qu.current=D,Ts!==null)throw Error(t(261));return rl=null,fa=0,Oo}function Ex(){for(;Ts!==null;)W0(Ts)}function Ax(){for(;Ts!==null&&!Jl();)W0(Ts)}function W0(d){var g=Tg(d.alternate,d,ea);d.memoizedProps=d.pendingProps,g===null?K0(d):Ts=g,dh.current=null}function K0(d){var g=d;do{var E=g.alternate;if(d=g.return,(g.flags&32768)===0){if(E=pn(E,g,ea),E!==null){Ts=E;return}}else{if(E=Xn(E,g),E!==null){E.flags&=32767,Ts=E;return}if(d!==null)d.flags|=32768,d.subtreeFlags=0,d.deletions=null;else{Oo=6,Ts=null;return}}if(g=g.sibling,g!==null){Ts=g;return}Ts=g=d}while(g!==null);Oo===0&&(Oo=5)}function yf(d,g,E){var D=Gi,K=Ga.transition;try{Ga.transition=null,Gi=1,X0(d,g,E,D)}finally{Ga.transition=K,Gi=D}return null}function X0(d,g,E,D){do fh();while(cd!==null);if((Qr&6)!==0)throw Error(t(327));E=d.finishedWork;var K=d.finishedLanes;if(E===null)return null;if(d.finishedWork=null,d.finishedLanes=0,E===d.current)throw Error(t(177));d.callbackNode=null,d.callbackPriority=0;var ce=E.lanes|E.childLanes;if(Mi(d,ce),d===rl&&(Ts=rl=null,fa=0),(E.subtreeFlags&2064)===0&&(E.flags&2064)===0||Ad||(Ad=!0,Tm(Xa,function(){return fh(),null})),ce=(E.flags&15990)!==0,(E.subtreeFlags&15990)!==0||ce){ce=Ga.transition,Ga.transition=null;var Ve=Gi;Gi=1;var St=Qr;Qr|=4,dh.current=null,dc(d,E),jd(E,d),zh(ni),Bc=!!Ph,ni=Ph=null,d.current=E,ci(E),Lu(),Qr=St,Gi=Ve,Ga.transition=ce}else d.current=E;if(Ad&&(Ad=!1,cd=d,np=K),ce=d.pendingLanes,ce===0&&(wu=null),dn(E.stateNode),Su(d,Eo()),g!==null)for(D=d.onRecoverableError,E=0;E<g.length;E++)K=g[E],D(K.value,{componentStack:K.stack,digest:K.digest});if(Sm)throw Sm=!1,d=q0,q0=null,d;return(np&1)!==0&&d.tag!==0&&fh(),ce=d.pendingLanes,(ce&1)!==0?d===wg?rp++:(rp=0,wg=d):rp=0,oe(),null}function fh(){if(cd!==null){var d=fs(np),g=Ga.transition,E=Gi;try{if(Ga.transition=null,Gi=16>d?16:d,cd===null)var D=!1;else{if(d=cd,cd=null,np=0,(Qr&6)!==0)throw Error(t(331));var K=Qr;for(Qr|=4,Wn=d.current;Wn!==null;){var ce=Wn,Ve=ce.child;if((Wn.flags&16)!==0){var St=ce.deletions;if(St!==null){for(var Ot=0;Ot<St.length;Ot++){var _n=St[Ot];for(Wn=_n;Wn!==null;){var rr=Wn;switch(rr.tag){case 0:case 11:case 15:Ns(8,rr,ce)}var cr=rr.child;if(cr!==null)cr.return=rr,Wn=cr;else for(;Wn!==null;){rr=Wn;var Hn=rr.sibling,Zr=rr.return;if(Qn(rr),rr===_n){Wn=null;break}if(Hn!==null){Hn.return=Zr,Wn=Hn;break}Wn=Zr}}}var ii=ce.alternate;if(ii!==null){var fi=ii.child;if(fi!==null){ii.child=null;do{var kl=fi.sibling;fi.sibling=null,fi=kl}while(fi!==null)}}Wn=ce}}if((ce.subtreeFlags&2064)!==0&&Ve!==null)Ve.return=ce,Wn=Ve;else e:for(;Wn!==null;){if(ce=Wn,(ce.flags&2048)!==0)switch(ce.tag){case 0:case 11:case 15:Ns(9,ce,ce.return)}var ln=ce.sibling;if(ln!==null){ln.return=ce.return,Wn=ln;break e}Wn=ce.return}}var Wt=d.current;for(Wn=Wt;Wn!==null;){Ve=Wn;var fn=Ve.child;if((Ve.subtreeFlags&2064)!==0&&fn!==null)fn.return=Ve,Wn=fn;else e:for(Ve=Wt;Wn!==null;){if(St=Wn,(St.flags&2048)!==0)try{switch(St.tag){case 0:case 11:case 15:Ds(9,St)}}catch(pi){Pl(St,St.return,pi)}if(St===Ve){Wn=null;break e}var xr=St.sibling;if(xr!==null){xr.return=St.return,Wn=xr;break e}Wn=St.return}}if(Qr=K,oe(),sa&&typeof sa.onPostCommitFiberRoot=="function")try{sa.onPostCommitFiberRoot(Aa,d)}catch{}D=!0}return D}finally{Gi=E,Ga.transition=g}}return!1}function Gu(d,g,E){g=Bd(E,g),g=zd(d,g,1),d=Fr(d,g,1),g=$u(),d!==null&&(bi(d,1,g),Su(d,g))}function Pl(d,g,E){if(d.tag===3)Gu(d,d,E);else for(;g!==null;){if(g.tag===3){Gu(g,d,E);break}else if(g.tag===1){var D=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof D.componentDidCatch=="function"&&(wu===null||!wu.has(D))){d=Bd(E,d),d=Sd(g,d,1),g=Fr(g,d,1),d=$u(),g!==null&&(bi(g,1,d),Su(g,d));break}}g=g.return}}function Z0(d,g,E){var D=d.pingCache;D!==null&&D.delete(g),g=$u(),d.pingedLanes|=d.suspendedLanes&E,rl===d&&(fa&E)===E&&(Oo===4||Oo===3&&(fa&130023424)===fa&&500>Eo()-wm?op(d,0):Gh|=E),Su(d,g)}function j_(d,g){g===0&&((d.mode&1)===0?g=1:(g=Ya,Ya<<=1,(Ya&130023424)===0&&(Ya=4194304)));var E=$u();d=on(d,g),d!==null&&(bi(d,g,E),Su(d,E))}function Tx(d){var g=d.memoizedState,E=0;g!==null&&(E=g.retryLane),j_(d,E)}function Ix(d,g){var E=0;switch(d.tag){case 13:var D=d.stateNode,K=d.memoizedState;K!==null&&(E=K.retryLane);break;case 19:D=d.stateNode;break;default:throw Error(t(314))}D!==null&&D.delete(g),j_(d,E)}var Tg;Tg=function(d,g,E){if(d!==null)if(d.memoizedProps!==g.pendingProps||ac.current)Te=!0;else{if((d.lanes&E)===0&&(g.flags&128)===0)return Te=!1,Rr(d,g,E);Te=(d.flags&131072)!==0}else Te=!1,v&&(g.flags&1048576)!==0&&Qt(g,Je,g.index);switch(g.lanes=0,g.tag){case 2:var D=g.type;_i(d,g),d=g.pendingProps;var K=tl(g,Rs.current);Ut(g,E),K=bd(null,g,D,d,K,E);var ce=Ou();return g.flags|=1,typeof K=="object"&&K!==null&&typeof K.render=="function"&&K.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,nl(D)?(ce=!0,Tl(g)):ce=!1,g.memoizedState=K.state!==null&&K.state!==void 0?K.state:null,xn(g),K.updater=bu,g.stateNode=K,K._reactInternals=g,Qf(g,D,d,E),g=en(null,g,D,!0,ce,E)):(g.tag=0,v&&ce&&En(g),Me(null,g,K,E),g=g.child),g;case 16:D=g.elementType;e:{switch(_i(d,g),d=g.pendingProps,K=D._init,D=K(D._payload),g.type=D,K=g.tag=Cx(D),d=au(D,d),K){case 0:g=gt(null,g,D,d,E);break e;case 1:g=$t(null,g,D,d,E);break e;case 11:g=tt(null,g,D,d,E);break e;case 14:g=ze(null,g,D,au(D.type,d),E);break e}throw Error(t(306,D,""))}return g;case 0:return D=g.type,K=g.pendingProps,K=g.elementType===D?K:au(D,K),gt(d,g,D,K,E);case 1:return D=g.type,K=g.pendingProps,K=g.elementType===D?K:au(D,K),$t(d,g,D,K,E);case 3:e:{if(An(g),d===null)throw Error(t(387));D=g.pendingProps,ce=g.memoizedState,K=ce.element,bn(d,g),$r(g,D,null,E);var Ve=g.memoizedState;if(D=Ve.element,ce.isDehydrated)if(ce={element:D,isDehydrated:!1,cache:Ve.cache,pendingSuspenseBoundaries:Ve.pendingSuspenseBoundaries,transitions:Ve.transitions},g.updateQueue.baseState=ce,g.memoizedState=ce,g.flags&256){K=Bd(Error(t(423)),g),g=yn(d,g,D,E,K);break e}else if(D!==K){K=Bd(Error(t(424)),g),g=yn(d,g,D,E,K);break e}else for(f=El(g.stateNode.containerInfo.firstChild),a=g,v=!0,S=null,E=ot(g,null,D,E),g.child=E;E;)E.flags=E.flags&-3|4096,E=E.sibling;else{if(Ae(),D===K){g=vr(d,g,E);break e}Me(d,g,D,E)}g=g.child}return g;case 5:return cc(g),d===null&&G(g),D=g.type,K=g.pendingProps,ce=d!==null?d.memoizedProps:null,Ve=K.children,nh(D,K)?Ve=null:ce!==null&&nh(D,ce)&&(g.flags|=32),kt(d,g),Me(d,g,Ve,E),g.child;case 6:return d===null&&G(g),null;case 13:return $n(d,g,E);case 4:return ba(g,g.stateNode.containerInfo),D=g.pendingProps,d===null?g.child=it(g,null,D,E):Me(d,g,D,E),g.child;case 11:return D=g.type,K=g.pendingProps,K=g.elementType===D?K:au(D,K),tt(d,g,D,K,E);case 7:return Me(d,g,g.pendingProps,E),g.child;case 8:return Me(d,g,g.pendingProps.children,E),g.child;case 12:return Me(d,g,g.pendingProps.children,E),g.child;case 10:e:{if(D=g.type._context,K=g.pendingProps,ce=g.memoizedProps,Ve=K.value,Hi(bt,D._currentValue),D._currentValue=Ve,ce!==null)if(ks(ce.value,Ve)){if(ce.children===K.children&&!ac.current){g=vr(d,g,E);break e}}else for(ce=g.child,ce!==null&&(ce.return=g);ce!==null;){var St=ce.dependencies;if(St!==null){Ve=ce.child;for(var Ot=St.firstContext;Ot!==null;){if(Ot.context===D){if(ce.tag===1){Ot=pr(-1,E&-E),Ot.tag=2;var _n=ce.updateQueue;if(_n!==null){_n=_n.shared;var rr=_n.pending;rr===null?Ot.next=Ot:(Ot.next=rr.next,rr.next=Ot),_n.pending=Ot}}ce.lanes|=E,Ot=ce.alternate,Ot!==null&&(Ot.lanes|=E),mn(ce.return,E,g),St.lanes|=E;break}Ot=Ot.next}}else if(ce.tag===10)Ve=ce.type===g.type?null:ce.child;else if(ce.tag===18){if(Ve=ce.return,Ve===null)throw Error(t(341));Ve.lanes|=E,St=Ve.alternate,St!==null&&(St.lanes|=E),mn(Ve,E,g),Ve=ce.sibling}else Ve=ce.child;if(Ve!==null)Ve.return=ce;else for(Ve=ce;Ve!==null;){if(Ve===g){Ve=null;break}if(ce=Ve.sibling,ce!==null){ce.return=Ve.return,Ve=ce;break}Ve=Ve.return}ce=Ve}Me(d,g,K.children,E),g=g.child}return g;case 9:return K=g.type,D=g.pendingProps.children,Ut(g,E),K=an(K),D=D(K),g.flags|=1,Me(d,g,D,E),g.child;case 14:return D=g.type,K=au(D,g.pendingProps),K=au(D.type,K),ze(d,g,D,K,E);case 15:return Ke(d,g,g.type,g.pendingProps,E);case 17:return D=g.type,K=g.pendingProps,K=g.elementType===D?K:au(D,K),_i(d,g),g.tag=1,nl(D)?(d=!0,Tl(g)):d=!1,Ut(g,E),Rp(g,D,K),Qf(g,D,K,E),en(null,g,D,!0,d,E);case 19:return Hr(d,g,E);case 22:return At(d,g,E)}throw Error(t(156,g.tag))};function Tm(d,g){return sl(d,g)}function U_(d,g,E,D){this.tag=d,this.key=E,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=D,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Kc(d,g,E,D){return new U_(d,g,E,D)}function sp(d){return d=d.prototype,!(!d||!d.isReactComponent)}function Cx(d){if(typeof d=="function")return sp(d)?1:0;if(d!=null){if(d=d.$$typeof,d===H)return 11;if(d===Re)return 14}return 2}function _f(d,g){var E=d.alternate;return E===null?(E=Kc(d.tag,g,d.key,d.mode),E.elementType=d.elementType,E.type=d.type,E.stateNode=d.stateNode,E.alternate=d,d.alternate=E):(E.pendingProps=g,E.type=d.type,E.flags=0,E.subtreeFlags=0,E.deletions=null),E.flags=d.flags&14680064,E.childLanes=d.childLanes,E.lanes=d.lanes,E.child=d.child,E.memoizedProps=d.memoizedProps,E.memoizedState=d.memoizedState,E.updateQueue=d.updateQueue,g=d.dependencies,E.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},E.sibling=d.sibling,E.index=d.index,E.ref=d.ref,E}function Ig(d,g,E,D,K,ce){var Ve=2;if(D=d,typeof d=="function")sp(d)&&(Ve=1);else if(typeof d=="string")Ve=5;else e:switch(d){case pe:return ap(E.children,K,ce,g);case U:Ve=8,K|=8;break;case F:return d=Kc(12,E,g,K|2),d.elementType=F,d.lanes=ce,d;case Z:return d=Kc(13,E,g,K),d.elementType=Z,d.lanes=ce,d;case be:return d=Kc(19,E,g,K),d.elementType=be,d.lanes=ce,d;case Ne:return Cg(E,K,ce,g);default:if(typeof d=="object"&&d!==null)switch(d.$$typeof){case q:Ve=10;break e;case j:Ve=9;break e;case H:Ve=11;break e;case Re:Ve=14;break e;case Oe:Ve=16,D=null;break e}throw Error(t(130,d==null?d:typeof d,""))}return g=Kc(Ve,E,g,K),g.elementType=d,g.type=D,g.lanes=ce,g}function ap(d,g,E,D){return d=Kc(7,d,D,g),d.lanes=E,d}function Cg(d,g,E,D){return d=Kc(22,d,D,g),d.elementType=Ne,d.lanes=E,d.stateNode={isHidden:!1},d}function Y0(d,g,E){return d=Kc(6,d,null,g),d.lanes=E,d}function J0(d,g,E){return g=Kc(4,d.children!==null?d.children:[],d.key,g),g.lanes=E,g.stateNode={containerInfo:d.containerInfo,pendingChildren:null,implementation:d.implementation},g}function Q0(d,g,E,D,K){this.tag=g,this.containerInfo=d,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ta(0),this.expirationTimes=Ta(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ta(0),this.identifierPrefix=D,this.onRecoverableError=K,this.mutableSourceEagerHydrationData=null}function ey(d,g,E,D,K,ce,Ve,St,Ot){return d=new Q0(d,g,E,St,Ot),g===1?(g=1,ce===!0&&(g|=8)):g=0,ce=Kc(3,null,null,g),d.current=ce,ce.stateNode=d,ce.memoizedState={element:D,isDehydrated:E,cache:null,transitions:null,pendingSuspenseBoundaries:null},xn(ce),d}function Fp(d,g,E){var D=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:je,key:D==null?null:""+D,children:d,containerInfo:g,implementation:E}}function V_(d){if(!d)return xu;d=d._reactInternals;e:{if(ro(d)!==d||d.tag!==1)throw Error(t(170));var g=d;do{switch(g.tag){case 3:g=g.stateNode.context;break e;case 1:if(nl(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break e}}g=g.return}while(g!==null);throw Error(t(171))}if(d.tag===1){var E=d.type;if(nl(E))return lc(d,E,g)}return g}function il(d,g,E,D,K,ce,Ve,St,Ot){return d=ey(E,D,!0,d,K,ce,Ve,St,Ot),d.context=V_(null),E=d.current,D=$u(),K=Td(E),ce=pr(D,K),ce.callback=g??null,Fr(E,ce,K),d.current.lanes=K,bi(d,K,D),Su(d,D),d}function lp(d,g,E,D){var K=g.current,ce=$u(),Ve=Td(K);return E=V_(E),g.context===null?g.context=E:g.pendingContext=E,g=pr(ce,Ve),g.payload={element:d},D=D===void 0?null:D,D!==null&&(g.callback=D),d=Fr(K,g,Ve),d!==null&&(ud(d,K,Ve,ce),sr(d,K,Ve)),Ve}function Im(d){if(d=d.current,!d.child)return null;switch(d.child.tag){case 5:return d.child.stateNode;default:return d.child.stateNode}}function Cm(d,g){if(d=d.memoizedState,d!==null&&d.dehydrated!==null){var E=d.retryLane;d.retryLane=E!==0&&E<g?E:g}}function Op(d,g){Cm(d,g),(d=d.alternate)&&Cm(d,g)}function Lm(){return null}var ty=typeof reportError=="function"?reportError:function(d){console.error(d)};function Lg(d){this._internalRoot=d}vf.prototype.render=Lg.prototype.render=function(d){var g=this._internalRoot;if(g===null)throw Error(t(409));lp(d,g,null,null)},vf.prototype.unmount=Lg.prototype.unmount=function(){var d=this._internalRoot;if(d!==null){this._internalRoot=null;var g=d.containerInfo;gf(function(){lp(null,d,null,null)}),g[Va]=null}};function vf(d){this._internalRoot=d}vf.prototype.unstable_scheduleHydration=function(d){if(d){var g=nu();d={blockedOn:null,target:d,priority:g};for(var E=0;E<Ao.length&&g!==0&&g<Ao[E].priority;E++);Ao.splice(E,0,d),E===0&&ku(d)}};function Pm(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)}function Bp(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11&&(d.nodeType!==8||d.nodeValue!==" react-mount-point-unstable "))}function Pg(){}function Lx(d,g,E,D,K){if(K){if(typeof D=="function"){var ce=D;D=function(){var _n=Im(Ve);ce.call(_n)}}var Ve=il(g,D,d,0,null,!1,!1,"",Pg);return d._reactRootContainer=Ve,d[Va]=Ve.current,$c(d.nodeType===8?d.parentNode:d),gf(),Ve}for(;K=d.lastChild;)d.removeChild(K);if(typeof D=="function"){var St=D;D=function(){var _n=Im(Ot);St.call(_n)}}var Ot=ey(d,0,!1,null,null,!1,!1,"",Pg);return d._reactRootContainer=Ot,d[Va]=Ot.current,$c(d.nodeType===8?d.parentNode:d),gf(function(){lp(g,Ot,E,D)}),Ot}function km(d,g,E,D,K){var ce=E._reactRootContainer;if(ce){var Ve=ce;if(typeof K=="function"){var St=K;K=function(){var Ot=Im(Ve);St.call(Ot)}}lp(g,Ve,d,K)}else Ve=Lx(E,g,d,K,D);return Im(Ve)}Ui=function(d){switch(d.tag){case 3:var g=d.stateNode;if(g.current.memoizedState.isDehydrated){var E=al(g.pendingLanes);E!==0&&(yl(g,E|1),Su(g,Eo()),(Qr&6)===0&&(Np=Eo()+500,oe()))}break;case 13:gf(function(){var D=on(d,1);if(D!==null){var K=$u();ud(D,d,1,K)}}),Op(d,1)}},mu=function(d){if(d.tag===13){var g=on(d,134217728);if(g!==null){var E=$u();ud(g,d,134217728,E)}Op(d,134217728)}},ec=function(d){if(d.tag===13){var g=Td(d),E=on(d,g);if(E!==null){var D=$u();ud(E,d,g,D)}Op(d,g)}},nu=function(){return Gi},_c=function(d,g){var E=Gi;try{return Gi=d,g()}finally{Gi=E}},ut=function(d,g,E){switch(g){case"input":if(Er(d,E),g=E.name,E.type==="radio"&&g!=null){for(E=d;E.parentNode;)E=E.parentNode;for(E=E.querySelectorAll("input[name="+JSON.stringify(""+g)+'][type="radio"]'),g=0;g<E.length;g++){var D=E[g];if(D!==d&&D.form===d.form){var K=vu(D);if(!K)throw Error(t(90));gn(D),Er(D,K)}}}break;case"textarea":Pn(d,E);break;case"select":g=E.value,g!=null&&er(d,!!E.multiple,g,!1)}},Mt=Dp,Bt=gf;var Rm={usingClientEntryPoint:!1,Events:[_u,xa,vu,ht,Ct,Dp]},Mm={findFiberByHostInstance:ql,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ny={bundleType:Mm.bundleType,version:Mm.version,rendererPackageName:Mm.rendererPackageName,rendererConfig:Mm.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ue.ReactCurrentDispatcher,findHostInstanceByFiber:function(d){return d=ga(d),d===null?null:d.stateNode},findFiberByHostInstance:Mm.findFiberByHostInstance||Lm,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var kg=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!kg.isDisabled&&kg.supportsFiber)try{Aa=kg.inject(ny),sa=kg}catch{}}return Xh.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Rm,Xh.createPortal=function(d,g){var E=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Pm(g))throw Error(t(200));return Fp(d,g,null,E)},Xh.createRoot=function(d,g){if(!Pm(d))throw Error(t(299));var E=!1,D="",K=ty;return g!=null&&(g.unstable_strictMode===!0&&(E=!0),g.identifierPrefix!==void 0&&(D=g.identifierPrefix),g.onRecoverableError!==void 0&&(K=g.onRecoverableError)),g=ey(d,1,!1,null,null,E,!1,D,K),d[Va]=g.current,$c(d.nodeType===8?d.parentNode:d),new Lg(g)},Xh.findDOMNode=function(d){if(d==null)return null;if(d.nodeType===1)return d;var g=d._reactInternals;if(g===void 0)throw typeof d.render=="function"?Error(t(188)):(d=Object.keys(d).join(","),Error(t(268,d)));return d=ga(g),d=d===null?null:d.stateNode,d},Xh.flushSync=function(d){return gf(d)},Xh.hydrate=function(d,g,E){if(!Bp(g))throw Error(t(200));return km(null,d,g,!0,E)},Xh.hydrateRoot=function(d,g,E){if(!Pm(d))throw Error(t(405));var D=E!=null&&E.hydratedSources||null,K=!1,ce="",Ve=ty;if(E!=null&&(E.unstable_strictMode===!0&&(K=!0),E.identifierPrefix!==void 0&&(ce=E.identifierPrefix),E.onRecoverableError!==void 0&&(Ve=E.onRecoverableError)),g=il(g,null,d,1,E??null,K,!1,ce,Ve),d[Va]=g.current,$c(d),D)for(d=0;d<D.length;d++)E=D[d],K=E._getVersion,K=K(E._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[E,K]:g.mutableSourceEagerHydrationData.push(E,K);return new vf(g)},Xh.render=function(d,g,E){if(!Bp(g))throw Error(t(200));return km(null,d,g,!1,E)},Xh.unmountComponentAtNode=function(d){if(!Bp(d))throw Error(t(40));return d._reactRootContainer?(gf(function(){km(null,null,d,!1,function(){d._reactRootContainer=null,d[Va]=null})}),!0):!1},Xh.unstable_batchedUpdates=Dp,Xh.unstable_renderSubtreeIntoContainer=function(d,g,E,D){if(!Bp(E))throw Error(t(200));if(d==null||d._reactInternals===void 0)throw Error(t(38));return km(d,g,E,!1,D)},Xh.version="18.3.1-next-f1338f8080-20240426",Xh}var A2;function oP(){if(A2)return lb.exports;A2=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),lb.exports=iP(),lb.exports}var T2;function sP(){if(T2)return c1;T2=1;var n=oP();return c1.createRoot=n.createRoot,c1.hydrateRoot=n.hydrateRoot,c1}var aP=sP();const lP=Zv(aP);/**
 * react-router v7.8.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var I2="popstate";function cP(n={}){function e(i,c){let{pathname:u,search:m,hash:_}=i.location;return p5("",{pathname:u,search:m,hash:_},c.state&&c.state.usr||null,c.state&&c.state.key||"default")}function t(i,c){return typeof c=="string"?c:r_(c)}return hP(e,t,null,n)}function Zl(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function Gf(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function uP(){return Math.random().toString(36).substring(2,10)}function C2(n,e){return{usr:n.state,key:n.key,idx:e}}function p5(n,e,t=null,i){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof e=="string"?M0(e):e,state:t,key:e&&e.key||i||uP()}}function r_({pathname:n="/",search:e="",hash:t=""}){return e&&e!=="?"&&(n+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(n+=t.charAt(0)==="#"?t:"#"+t),n}function M0(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substring(t),n=n.substring(0,t));let i=n.indexOf("?");i>=0&&(e.search=n.substring(i),n=n.substring(0,i)),n&&(e.pathname=n)}return e}function hP(n,e,t,i={}){let{window:c=document.defaultView,v5Compat:u=!1}=i,m=c.history,_="POP",o=null,b=I();b==null&&(b=0,m.replaceState({...m.state,idx:b},""));function I(){return(m.state||{idx:null}).idx}function M(){_="POP";let fe=I(),J=fe==null?null:fe-b;b=fe,o&&o({action:_,location:se.location,delta:J})}function V(fe,J){_="PUSH";let ne=p5(se.location,fe,J);b=I()+1;let me=C2(ne,b),ue=se.createHref(ne);try{m.pushState(me,"",ue)}catch(ke){if(ke instanceof DOMException&&ke.name==="DataCloneError")throw ke;c.location.assign(ue)}u&&o&&o({action:_,location:se.location,delta:1})}function k(fe,J){_="REPLACE";let ne=p5(se.location,fe,J);b=I();let me=C2(ne,b),ue=se.createHref(ne);m.replaceState(me,"",ue),u&&o&&o({action:_,location:se.location,delta:0})}function ie(fe){return dP(fe)}let se={get action(){return _},get location(){return n(c,m)},listen(fe){if(o)throw new Error("A history only accepts one active listener");return c.addEventListener(I2,M),o=fe,()=>{c.removeEventListener(I2,M),o=null}},createHref(fe){return e(c,fe)},createURL:ie,encodeLocation(fe){let J=ie(fe);return{pathname:J.pathname,search:J.search,hash:J.hash}},push:V,replace:k,go(fe){return m.go(fe)}};return se}function dP(n,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),Zl(t,"No window.location.(origin|href) available to create URL");let i=typeof n=="string"?n:r_(n);return i=i.replace(/ $/,"%20"),!e&&i.startsWith("//")&&(i=t+i),new URL(i,t)}function qT(n,e,t="/"){return fP(n,e,t,!1)}function fP(n,e,t,i){let c=typeof e=="string"?M0(e):e,u=Ep(c.pathname||"/",t);if(u==null)return null;let m=$T(n);pP(m);let _=null;for(let o=0;_==null&&o<m.length;++o){let b=AP(u);_=SP(m[o],b,i)}return _}function $T(n,e=[],t=[],i="",c=!1){let u=(m,_,o=c,b)=>{let I={relativePath:b===void 0?m.path||"":b,caseSensitive:m.caseSensitive===!0,childrenIndex:_,route:m};if(I.relativePath.startsWith("/")){if(!I.relativePath.startsWith(i)&&o)return;Zl(I.relativePath.startsWith(i),`Absolute route path "${I.relativePath}" nested under path "${i}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),I.relativePath=I.relativePath.slice(i.length)}let M=xp([i,I.relativePath]),V=t.concat(I);m.children&&m.children.length>0&&(Zl(m.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${M}".`),$T(m.children,e,V,M,o)),!(m.path==null&&!m.index)&&e.push({path:M,score:bP(M,m.index),routesMeta:V})};return n.forEach((m,_)=>{if(m.path===""||!m.path?.includes("?"))u(m,_);else for(let o of GT(m.path))u(m,_,!0,o)}),e}function GT(n){let e=n.split("/");if(e.length===0)return[];let[t,...i]=e,c=t.endsWith("?"),u=t.replace(/\?$/,"");if(i.length===0)return c?[u,""]:[u];let m=GT(i.join("/")),_=[];return _.push(...m.map(o=>o===""?u:[u,o].join("/"))),c&&_.push(...m),_.map(o=>n.startsWith("/")&&o===""?"/":o)}function pP(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:wP(e.routesMeta.map(i=>i.childrenIndex),t.routesMeta.map(i=>i.childrenIndex)))}var mP=/^:[\w-]+$/,gP=3,yP=2,_P=1,vP=10,xP=-2,L2=n=>n==="*";function bP(n,e){let t=n.split("/"),i=t.length;return t.some(L2)&&(i+=xP),e&&(i+=yP),t.filter(c=>!L2(c)).reduce((c,u)=>c+(mP.test(u)?gP:u===""?_P:vP),i)}function wP(n,e){return n.length===e.length&&n.slice(0,-1).every((i,c)=>i===e[c])?n[n.length-1]-e[e.length-1]:0}function SP(n,e,t=!1){let{routesMeta:i}=n,c={},u="/",m=[];for(let _=0;_<i.length;++_){let o=i[_],b=_===i.length-1,I=u==="/"?e:e.slice(u.length)||"/",M=dv({path:o.relativePath,caseSensitive:o.caseSensitive,end:b},I),V=o.route;if(!M&&b&&t&&!i[i.length-1].route.index&&(M=dv({path:o.relativePath,caseSensitive:o.caseSensitive,end:!1},I)),!M)return null;Object.assign(c,M.params),m.push({params:c,pathname:xp([u,M.pathname]),pathnameBase:LP(xp([u,M.pathnameBase])),route:V}),M.pathnameBase!=="/"&&(u=xp([u,M.pathnameBase]))}return m}function dv(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,i]=EP(n.path,n.caseSensitive,n.end),c=e.match(t);if(!c)return null;let u=c[0],m=u.replace(/(.)\/+$/,"$1"),_=c.slice(1);return{params:i.reduce((b,{paramName:I,isOptional:M},V)=>{if(I==="*"){let ie=_[V]||"";m=u.slice(0,u.length-ie.length).replace(/(.)\/+$/,"$1")}const k=_[V];return M&&!k?b[I]=void 0:b[I]=(k||"").replace(/%2F/g,"/"),b},{}),pathname:u,pathnameBase:m,pattern:n}}function EP(n,e=!1,t=!0){Gf(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let i=[],c="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(m,_,o)=>(i.push({paramName:_,isOptional:o!=null}),o?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return n.endsWith("*")?(i.push({paramName:"*"}),c+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?c+="\\/*$":n!==""&&n!=="/"&&(c+="(?:(?=\\/|$))"),[new RegExp(c,e?void 0:"i"),i]}function AP(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Gf(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),n}}function Ep(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,i=n.charAt(t);return i&&i!=="/"?null:n.slice(t)||"/"}function TP(n,e="/"){let{pathname:t,search:i="",hash:c=""}=typeof n=="string"?M0(n):n;return{pathname:t?t.startsWith("/")?t:IP(t,e):e,search:PP(i),hash:kP(c)}}function IP(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(c=>{c===".."?t.length>1&&t.pop():c!=="."&&t.push(c)}),t.length>1?t.join("/"):"/"}function hb(n,e,t,i){return`Cannot include a '${n}' character in a manually specified \`to.${e}\` field [${JSON.stringify(i)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function CP(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function HT(n){let e=CP(n);return e.map((t,i)=>i===e.length-1?t.pathname:t.pathnameBase)}function WT(n,e,t,i=!1){let c;typeof n=="string"?c=M0(n):(c={...n},Zl(!c.pathname||!c.pathname.includes("?"),hb("?","pathname","search",c)),Zl(!c.pathname||!c.pathname.includes("#"),hb("#","pathname","hash",c)),Zl(!c.search||!c.search.includes("#"),hb("#","search","hash",c)));let u=n===""||c.pathname==="",m=u?"/":c.pathname,_;if(m==null)_=t;else{let M=e.length-1;if(!i&&m.startsWith("..")){let V=m.split("/");for(;V[0]==="..";)V.shift(),M-=1;c.pathname=V.join("/")}_=M>=0?e[M]:"/"}let o=TP(c,_),b=m&&m!=="/"&&m.endsWith("/"),I=(u||m===".")&&t.endsWith("/");return!o.pathname.endsWith("/")&&(b||I)&&(o.pathname+="/"),o}var xp=n=>n.join("/").replace(/\/\/+/g,"/"),LP=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),PP=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,kP=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function RP(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}var KT=["POST","PUT","PATCH","DELETE"];new Set(KT);var MP=["GET",...KT];new Set(MP);var N0=Nn.createContext(null);N0.displayName="DataRouter";var Yv=Nn.createContext(null);Yv.displayName="DataRouterState";Nn.createContext(!1);var XT=Nn.createContext({isTransitioning:!1});XT.displayName="ViewTransition";var NP=Nn.createContext(new Map);NP.displayName="Fetchers";var DP=Nn.createContext(null);DP.displayName="Await";var Kf=Nn.createContext(null);Kf.displayName="Navigation";var __=Nn.createContext(null);__.displayName="Location";var Xf=Nn.createContext({outlet:null,matches:[],isDataRoute:!1});Xf.displayName="Route";var mw=Nn.createContext(null);mw.displayName="RouteError";function FP(n,{relative:e}={}){Zl(v_(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:i}=Nn.useContext(Kf),{hash:c,pathname:u,search:m}=x_(n,{relative:e}),_=u;return t!=="/"&&(_=u==="/"?t:xp([t,u])),i.createHref({pathname:_,search:m,hash:c})}function v_(){return Nn.useContext(__)!=null}function dg(){return Zl(v_(),"useLocation() may be used only in the context of a <Router> component."),Nn.useContext(__).location}var ZT="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function YT(n){Nn.useContext(Kf).static||Nn.useLayoutEffect(n)}function OP(){let{isDataRoute:n}=Nn.useContext(Xf);return n?YP():BP()}function BP(){Zl(v_(),"useNavigate() may be used only in the context of a <Router> component.");let n=Nn.useContext(N0),{basename:e,navigator:t}=Nn.useContext(Kf),{matches:i}=Nn.useContext(Xf),{pathname:c}=dg(),u=JSON.stringify(HT(i)),m=Nn.useRef(!1);return YT(()=>{m.current=!0}),Nn.useCallback((o,b={})=>{if(Gf(m.current,ZT),!m.current)return;if(typeof o=="number"){t.go(o);return}let I=WT(o,JSON.parse(u),c,b.relative==="path");n==null&&e!=="/"&&(I.pathname=I.pathname==="/"?e:xp([e,I.pathname])),(b.replace?t.replace:t.push)(I,b.state,b)},[e,t,u,c,n])}Nn.createContext(null);function zP(){let{matches:n}=Nn.useContext(Xf),e=n[n.length-1];return e?e.params:{}}function x_(n,{relative:e}={}){let{matches:t}=Nn.useContext(Xf),{pathname:i}=dg(),c=JSON.stringify(HT(t));return Nn.useMemo(()=>WT(n,JSON.parse(c),i,e==="path"),[n,c,i,e])}function jP(n,e){return JT(n,e)}function JT(n,e,t,i){Zl(v_(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:c}=Nn.useContext(Kf),{matches:u}=Nn.useContext(Xf),m=u[u.length-1],_=m?m.params:{},o=m?m.pathname:"/",b=m?m.pathnameBase:"/",I=m&&m.route;{let J=I&&I.path||"";QT(o,!I||J.endsWith("*")||J.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${o}" (under <Route path="${J}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${J}"> to <Route path="${J==="/"?"*":`${J}/*`}">.`)}let M=dg(),V;if(e){let J=typeof e=="string"?M0(e):e;Zl(b==="/"||J.pathname?.startsWith(b),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${b}" but pathname "${J.pathname}" was given in the \`location\` prop.`),V=J}else V=M;let k=V.pathname||"/",ie=k;if(b!=="/"){let J=b.replace(/^\//,"").split("/");ie="/"+k.replace(/^\//,"").split("/").slice(J.length).join("/")}let se=qT(n,{pathname:ie});Gf(I||se!=null,`No routes matched location "${V.pathname}${V.search}${V.hash}" `),Gf(se==null||se[se.length-1].route.element!==void 0||se[se.length-1].route.Component!==void 0||se[se.length-1].route.lazy!==void 0,`Matched leaf route at location "${V.pathname}${V.search}${V.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let fe=GP(se&&se.map(J=>Object.assign({},J,{params:Object.assign({},_,J.params),pathname:xp([b,c.encodeLocation?c.encodeLocation(J.pathname).pathname:J.pathname]),pathnameBase:J.pathnameBase==="/"?b:xp([b,c.encodeLocation?c.encodeLocation(J.pathnameBase).pathname:J.pathnameBase])})),u,t,i);return e&&fe?Nn.createElement(__.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...V},navigationType:"POP"}},fe):fe}function UP(){let n=ZP(),e=RP(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,i="rgba(200,200,200, 0.5)",c={padding:"0.5rem",backgroundColor:i},u={padding:"2px 4px",backgroundColor:i},m=null;return console.error("Error handled by React Router default ErrorBoundary:",n),m=Nn.createElement(Nn.Fragment,null,Nn.createElement("p",null," Hey developer "),Nn.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",Nn.createElement("code",{style:u},"ErrorBoundary")," or"," ",Nn.createElement("code",{style:u},"errorElement")," prop on your route.")),Nn.createElement(Nn.Fragment,null,Nn.createElement("h2",null,"Unexpected Application Error!"),Nn.createElement("h3",{style:{fontStyle:"italic"}},e),t?Nn.createElement("pre",{style:c},t):null,m)}var VP=Nn.createElement(UP,null),qP=class extends Nn.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,e){return e.location!==n.location||e.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:e.error,location:e.location,revalidation:n.revalidation||e.revalidation}}componentDidCatch(n,e){console.error("React Router caught the following error during render",n,e)}render(){return this.state.error!==void 0?Nn.createElement(Xf.Provider,{value:this.props.routeContext},Nn.createElement(mw.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function $P({routeContext:n,match:e,children:t}){let i=Nn.useContext(N0);return i&&i.static&&i.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=e.route.id),Nn.createElement(Xf.Provider,{value:n},t)}function GP(n,e=[],t=null,i=null){if(n==null){if(!t)return null;if(t.errors)n=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let c=n,u=t?.errors;if(u!=null){let o=c.findIndex(b=>b.route.id&&u?.[b.route.id]!==void 0);Zl(o>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(u).join(",")}`),c=c.slice(0,Math.min(c.length,o+1))}let m=!1,_=-1;if(t)for(let o=0;o<c.length;o++){let b=c[o];if((b.route.HydrateFallback||b.route.hydrateFallbackElement)&&(_=o),b.route.id){let{loaderData:I,errors:M}=t,V=b.route.loader&&!I.hasOwnProperty(b.route.id)&&(!M||M[b.route.id]===void 0);if(b.route.lazy||V){m=!0,_>=0?c=c.slice(0,_+1):c=[c[0]];break}}}return c.reduceRight((o,b,I)=>{let M,V=!1,k=null,ie=null;t&&(M=u&&b.route.id?u[b.route.id]:void 0,k=b.route.errorElement||VP,m&&(_<0&&I===0?(QT("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),V=!0,ie=null):_===I&&(V=!0,ie=b.route.hydrateFallbackElement||null)));let se=e.concat(c.slice(0,I+1)),fe=()=>{let J;return M?J=k:V?J=ie:b.route.Component?J=Nn.createElement(b.route.Component,null):b.route.element?J=b.route.element:J=o,Nn.createElement($P,{match:b,routeContext:{outlet:o,matches:se,isDataRoute:t!=null},children:J})};return t&&(b.route.ErrorBoundary||b.route.errorElement||I===0)?Nn.createElement(qP,{location:t.location,revalidation:t.revalidation,component:k,error:M,children:fe(),routeContext:{outlet:null,matches:se,isDataRoute:!0}}):fe()},null)}function gw(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function HP(n){let e=Nn.useContext(N0);return Zl(e,gw(n)),e}function WP(n){let e=Nn.useContext(Yv);return Zl(e,gw(n)),e}function KP(n){let e=Nn.useContext(Xf);return Zl(e,gw(n)),e}function yw(n){let e=KP(n),t=e.matches[e.matches.length-1];return Zl(t.route.id,`${n} can only be used on routes that contain a unique "id"`),t.route.id}function XP(){return yw("useRouteId")}function ZP(){let n=Nn.useContext(mw),e=WP("useRouteError"),t=yw("useRouteError");return n!==void 0?n:e.errors?.[t]}function YP(){let{router:n}=HP("useNavigate"),e=yw("useNavigate"),t=Nn.useRef(!1);return YT(()=>{t.current=!0}),Nn.useCallback(async(c,u={})=>{Gf(t.current,ZT),t.current&&(typeof c=="number"?n.navigate(c):await n.navigate(c,{fromRouteId:e,...u}))},[n,e])}var P2={};function QT(n,e,t){!e&&!P2[n]&&(P2[n]=!0,Gf(!1,t))}Nn.memo(JP);function JP({routes:n,future:e,state:t}){return JT(n,void 0,t,e)}function qm(n){Zl(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function QP({basename:n="/",children:e=null,location:t,navigationType:i="POP",navigator:c,static:u=!1}){Zl(!v_(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let m=n.replace(/^\/*/,"/"),_=Nn.useMemo(()=>({basename:m,navigator:c,static:u,future:{}}),[m,c,u]);typeof t=="string"&&(t=M0(t));let{pathname:o="/",search:b="",hash:I="",state:M=null,key:V="default"}=t,k=Nn.useMemo(()=>{let ie=Ep(o,m);return ie==null?null:{location:{pathname:ie,search:b,hash:I,state:M,key:V},navigationType:i}},[m,o,b,I,M,V,i]);return Gf(k!=null,`<Router basename="${m}"> is not able to match the URL "${o}${b}${I}" because it does not start with the basename, so the <Router> won't render anything.`),k==null?null:Nn.createElement(Kf.Provider,{value:_},Nn.createElement(__.Provider,{children:e,value:k}))}function e7({children:n,location:e}){return jP(m5(n),e)}function m5(n,e=[]){let t=[];return Nn.Children.forEach(n,(i,c)=>{if(!Nn.isValidElement(i))return;let u=[...e,c];if(i.type===Nn.Fragment){t.push.apply(t,m5(i.props.children,u));return}Zl(i.type===qm,`[${typeof i.type=="string"?i.type:i.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Zl(!i.props.index||!i.props.children,"An index route cannot have child routes.");let m={id:i.props.id||u.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,loader:i.props.loader,action:i.props.action,hydrateFallbackElement:i.props.hydrateFallbackElement,HydrateFallback:i.props.HydrateFallback,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.hasErrorBoundary===!0||i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(m.children=m5(i.props.children,u)),t.push(m)}),t}var O1="get",B1="application/x-www-form-urlencoded";function Jv(n){return n!=null&&typeof n.tagName=="string"}function t7(n){return Jv(n)&&n.tagName.toLowerCase()==="button"}function n7(n){return Jv(n)&&n.tagName.toLowerCase()==="form"}function r7(n){return Jv(n)&&n.tagName.toLowerCase()==="input"}function i7(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function o7(n,e){return n.button===0&&(!e||e==="_self")&&!i7(n)}var u1=null;function s7(){if(u1===null)try{new FormData(document.createElement("form"),0),u1=!1}catch{u1=!0}return u1}var a7=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function db(n){return n!=null&&!a7.has(n)?(Gf(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${B1}"`),null):n}function l7(n,e){let t,i,c,u,m;if(n7(n)){let _=n.getAttribute("action");i=_?Ep(_,e):null,t=n.getAttribute("method")||O1,c=db(n.getAttribute("enctype"))||B1,u=new FormData(n)}else if(t7(n)||r7(n)&&(n.type==="submit"||n.type==="image")){let _=n.form;if(_==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let o=n.getAttribute("formaction")||_.getAttribute("action");if(i=o?Ep(o,e):null,t=n.getAttribute("formmethod")||_.getAttribute("method")||O1,c=db(n.getAttribute("formenctype"))||db(_.getAttribute("enctype"))||B1,u=new FormData(_,n),!s7()){let{name:b,type:I,value:M}=n;if(I==="image"){let V=b?`${b}.`:"";u.append(`${V}x`,"0"),u.append(`${V}y`,"0")}else b&&u.append(b,M)}}else{if(Jv(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=O1,i=null,c=B1,m=n}return u&&c==="text/plain"&&(m=u,u=void 0),{action:i,method:t.toLowerCase(),encType:c,formData:u,body:m}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function _w(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function c7(n,e,t){let i=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return i.pathname==="/"?i.pathname=`_root.${t}`:e&&Ep(i.pathname,e)==="/"?i.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:i.pathname=`${i.pathname.replace(/\/$/,"")}.${t}`,i}async function u7(n,e){if(n.id in e)return e[n.id];try{let t=await import(n.module);return e[n.id]=t,t}catch(t){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function h7(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function d7(n,e,t){let i=await Promise.all(n.map(async c=>{let u=e.routes[c.route.id];if(u){let m=await u7(u,t);return m.links?m.links():[]}return[]}));return g7(i.flat(1).filter(h7).filter(c=>c.rel==="stylesheet"||c.rel==="preload").map(c=>c.rel==="stylesheet"?{...c,rel:"prefetch",as:"style"}:{...c,rel:"prefetch"}))}function k2(n,e,t,i,c,u){let m=(o,b)=>t[b]?o.route.id!==t[b].route.id:!0,_=(o,b)=>t[b].pathname!==o.pathname||t[b].route.path?.endsWith("*")&&t[b].params["*"]!==o.params["*"];return u==="assets"?e.filter((o,b)=>m(o,b)||_(o,b)):u==="data"?e.filter((o,b)=>{let I=i.routes[o.route.id];if(!I||!I.hasLoader)return!1;if(m(o,b)||_(o,b))return!0;if(o.route.shouldRevalidate){let M=o.route.shouldRevalidate({currentUrl:new URL(c.pathname+c.search+c.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(n,window.origin),nextParams:o.params,defaultShouldRevalidate:!0});if(typeof M=="boolean")return M}return!0}):[]}function f7(n,e,{includeHydrateFallback:t}={}){return p7(n.map(i=>{let c=e.routes[i.route.id];if(!c)return[];let u=[c.module];return c.clientActionModule&&(u=u.concat(c.clientActionModule)),c.clientLoaderModule&&(u=u.concat(c.clientLoaderModule)),t&&c.hydrateFallbackModule&&(u=u.concat(c.hydrateFallbackModule)),c.imports&&(u=u.concat(c.imports)),u}).flat(1))}function p7(n){return[...new Set(n)]}function m7(n){let e={},t=Object.keys(n).sort();for(let i of t)e[i]=n[i];return e}function g7(n,e){let t=new Set;return new Set(e),n.reduce((i,c)=>{let u=JSON.stringify(m7(c));return t.has(u)||(t.add(u),i.push({key:u,link:c})),i},[])}function e6(){let n=Nn.useContext(N0);return _w(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function y7(){let n=Nn.useContext(Yv);return _w(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var vw=Nn.createContext(void 0);vw.displayName="FrameworkContext";function t6(){let n=Nn.useContext(vw);return _w(n,"You must render this element inside a <HydratedRouter> element"),n}function _7(n,e){let t=Nn.useContext(vw),[i,c]=Nn.useState(!1),[u,m]=Nn.useState(!1),{onFocus:_,onBlur:o,onMouseEnter:b,onMouseLeave:I,onTouchStart:M}=e,V=Nn.useRef(null);Nn.useEffect(()=>{if(n==="render"&&m(!0),n==="viewport"){let se=J=>{J.forEach(ne=>{m(ne.isIntersecting)})},fe=new IntersectionObserver(se,{threshold:.5});return V.current&&fe.observe(V.current),()=>{fe.disconnect()}}},[n]),Nn.useEffect(()=>{if(i){let se=setTimeout(()=>{m(!0)},100);return()=>{clearTimeout(se)}}},[i]);let k=()=>{c(!0)},ie=()=>{c(!1),m(!1)};return t?n!=="intent"?[u,V,{}]:[u,V,{onFocus:by(_,k),onBlur:by(o,ie),onMouseEnter:by(b,k),onMouseLeave:by(I,ie),onTouchStart:by(M,k)}]:[!1,V,{}]}function by(n,e){return t=>{n&&n(t),t.defaultPrevented||e(t)}}function v7({page:n,...e}){let{router:t}=e6(),i=Nn.useMemo(()=>qT(t.routes,n,t.basename),[t.routes,n,t.basename]);return i?Nn.createElement(b7,{page:n,matches:i,...e}):null}function x7(n){let{manifest:e,routeModules:t}=t6(),[i,c]=Nn.useState([]);return Nn.useEffect(()=>{let u=!1;return d7(n,e,t).then(m=>{u||c(m)}),()=>{u=!0}},[n,e,t]),i}function b7({page:n,matches:e,...t}){let i=dg(),{manifest:c,routeModules:u}=t6(),{basename:m}=e6(),{loaderData:_,matches:o}=y7(),b=Nn.useMemo(()=>k2(n,e,o,c,i,"data"),[n,e,o,c,i]),I=Nn.useMemo(()=>k2(n,e,o,c,i,"assets"),[n,e,o,c,i]),M=Nn.useMemo(()=>{if(n===i.pathname+i.search+i.hash)return[];let ie=new Set,se=!1;if(e.forEach(J=>{let ne=c.routes[J.route.id];!ne||!ne.hasLoader||(!b.some(me=>me.route.id===J.route.id)&&J.route.id in _&&u[J.route.id]?.shouldRevalidate||ne.hasClientLoader?se=!0:ie.add(J.route.id))}),ie.size===0)return[];let fe=c7(n,m,"data");return se&&ie.size>0&&fe.searchParams.set("_routes",e.filter(J=>ie.has(J.route.id)).map(J=>J.route.id).join(",")),[fe.pathname+fe.search]},[m,_,i,c,b,e,n,u]),V=Nn.useMemo(()=>f7(I,c),[I,c]),k=x7(I);return Nn.createElement(Nn.Fragment,null,M.map(ie=>Nn.createElement("link",{key:ie,rel:"prefetch",as:"fetch",href:ie,...t})),V.map(ie=>Nn.createElement("link",{key:ie,rel:"modulepreload",href:ie,...t})),k.map(({key:ie,link:se})=>Nn.createElement("link",{key:ie,nonce:t.nonce,...se})))}function w7(...n){return e=>{n.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var n6=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{n6&&(window.__reactRouterVersion="7.8.1")}catch{}function S7({basename:n,children:e,window:t}){let i=Nn.useRef();i.current==null&&(i.current=cP({window:t,v5Compat:!0}));let c=i.current,[u,m]=Nn.useState({action:c.action,location:c.location}),_=Nn.useCallback(o=>{Nn.startTransition(()=>m(o))},[m]);return Nn.useLayoutEffect(()=>c.listen(_),[c,_]),Nn.createElement(QP,{basename:n,children:e,location:u.location,navigationType:u.action,navigator:c})}var r6=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,i6=Nn.forwardRef(function({onClick:e,discover:t="render",prefetch:i="none",relative:c,reloadDocument:u,replace:m,state:_,target:o,to:b,preventScrollReset:I,viewTransition:M,...V},k){let{basename:ie}=Nn.useContext(Kf),se=typeof b=="string"&&r6.test(b),fe,J=!1;if(typeof b=="string"&&se&&(fe=b,n6))try{let F=new URL(window.location.href),q=b.startsWith("//")?new URL(F.protocol+b):new URL(b),j=Ep(q.pathname,ie);q.origin===F.origin&&j!=null?b=j+q.search+q.hash:J=!0}catch{Gf(!1,`<Link to="${b}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let ne=FP(b,{relative:c}),[me,ue,ke]=_7(i,V),je=I7(b,{replace:m,state:_,target:o,preventScrollReset:I,relative:c,viewTransition:M});function pe(F){e&&e(F),F.defaultPrevented||je(F)}let U=Nn.createElement("a",{...V,...ke,href:fe||ne,onClick:J||u?e:pe,ref:w7(k,ue),target:o,"data-discover":!se&&t==="render"?"true":void 0});return me&&!se?Nn.createElement(Nn.Fragment,null,U,Nn.createElement(v7,{page:ne})):U});i6.displayName="Link";var E7=Nn.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:i="",end:c=!1,style:u,to:m,viewTransition:_,children:o,...b},I){let M=x_(m,{relative:b.relative}),V=dg(),k=Nn.useContext(Yv),{navigator:ie,basename:se}=Nn.useContext(Kf),fe=k!=null&&R7(M)&&_===!0,J=ie.encodeLocation?ie.encodeLocation(M).pathname:M.pathname,ne=V.pathname,me=k&&k.navigation&&k.navigation.location?k.navigation.location.pathname:null;t||(ne=ne.toLowerCase(),me=me?me.toLowerCase():null,J=J.toLowerCase()),me&&se&&(me=Ep(me,se)||me);const ue=J!=="/"&&J.endsWith("/")?J.length-1:J.length;let ke=ne===J||!c&&ne.startsWith(J)&&ne.charAt(ue)==="/",je=me!=null&&(me===J||!c&&me.startsWith(J)&&me.charAt(J.length)==="/"),pe={isActive:ke,isPending:je,isTransitioning:fe},U=ke?e:void 0,F;typeof i=="function"?F=i(pe):F=[i,ke?"active":null,je?"pending":null,fe?"transitioning":null].filter(Boolean).join(" ");let q=typeof u=="function"?u(pe):u;return Nn.createElement(i6,{...b,"aria-current":U,className:F,ref:I,style:q,to:m,viewTransition:_},typeof o=="function"?o(pe):o)});E7.displayName="NavLink";var A7=Nn.forwardRef(({discover:n="render",fetcherKey:e,navigate:t,reloadDocument:i,replace:c,state:u,method:m=O1,action:_,onSubmit:o,relative:b,preventScrollReset:I,viewTransition:M,...V},k)=>{let ie=P7(),se=k7(_,{relative:b}),fe=m.toLowerCase()==="get"?"get":"post",J=typeof _=="string"&&r6.test(_),ne=me=>{if(o&&o(me),me.defaultPrevented)return;me.preventDefault();let ue=me.nativeEvent.submitter,ke=ue?.getAttribute("formmethod")||m;ie(ue||me.currentTarget,{fetcherKey:e,method:ke,navigate:t,replace:c,state:u,relative:b,preventScrollReset:I,viewTransition:M})};return Nn.createElement("form",{ref:k,method:fe,action:se,onSubmit:i?o:ne,...V,"data-discover":!J&&n==="render"?"true":void 0})});A7.displayName="Form";function T7(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function o6(n){let e=Nn.useContext(N0);return Zl(e,T7(n)),e}function I7(n,{target:e,replace:t,state:i,preventScrollReset:c,relative:u,viewTransition:m}={}){let _=OP(),o=dg(),b=x_(n,{relative:u});return Nn.useCallback(I=>{if(o7(I,e)){I.preventDefault();let M=t!==void 0?t:r_(o)===r_(b);_(n,{replace:M,state:i,preventScrollReset:c,relative:u,viewTransition:m})}},[o,_,b,t,i,e,n,c,u,m])}var C7=0,L7=()=>`__${String(++C7)}__`;function P7(){let{router:n}=o6("useSubmit"),{basename:e}=Nn.useContext(Kf),t=XP();return Nn.useCallback(async(i,c={})=>{let{action:u,method:m,encType:_,formData:o,body:b}=l7(i,e);if(c.navigate===!1){let I=c.fetcherKey||L7();await n.fetch(I,t,c.action||u,{preventScrollReset:c.preventScrollReset,formData:o,body:b,formMethod:c.method||m,formEncType:c.encType||_,flushSync:c.flushSync})}else await n.navigate(c.action||u,{preventScrollReset:c.preventScrollReset,formData:o,body:b,formMethod:c.method||m,formEncType:c.encType||_,replace:c.replace,state:c.state,fromRouteId:t,flushSync:c.flushSync,viewTransition:c.viewTransition})},[n,e,t])}function k7(n,{relative:e}={}){let{basename:t}=Nn.useContext(Kf),i=Nn.useContext(Xf);Zl(i,"useFormAction must be used inside a RouteContext");let[c]=i.matches.slice(-1),u={...x_(n||".",{relative:e})},m=dg();if(n==null){u.search=m.search;let _=new URLSearchParams(u.search),o=_.getAll("index");if(o.some(I=>I==="")){_.delete("index"),o.filter(M=>M).forEach(M=>_.append("index",M));let I=_.toString();u.search=I?`?${I}`:""}}return(!n||n===".")&&c.route.index&&(u.search=u.search?u.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(u.pathname=u.pathname==="/"?t:xp([t,u.pathname])),r_(u)}function R7(n,{relative:e}={}){let t=Nn.useContext(XT);Zl(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=o6("useViewTransitionState"),c=x_(n,{relative:e});if(!t.isTransitioning)return!1;let u=Ep(t.currentLocation.pathname,i)||t.currentLocation.pathname,m=Ep(t.nextLocation.pathname,i)||t.nextLocation.pathname;return dv(c.pathname,m)!=null||dv(c.pathname,u)!=null}var z1={exports:{}},M7=z1.exports,R2;function N7(){return R2||(R2=1,(function(n,e){var t={};(function(i,c){n.exports=c()})(M7,(function(){var i,c,u;function m(o,b){if(!i)i=b;else if(!c)c=b;else{var I="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+i+")(sharedChunk); ("+c+")(sharedChunk); self.onerror = null;",M={};i(M),u=b(M),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(u.workerUrl=window.URL.createObjectURL(new Blob([I],{type:"text/javascript"})))}}m(["exports"],(function(o){var b=typeof self<"u"?self:{},I="2.15.0";let M;const V={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(M==null){const s=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{M=t.API_URL_REGEX!=null?new RegExp(t.API_URL_REGEX):s}catch{M=s}}return M},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!V.API_URL)return null;try{const s=new URL(V.API_URL);return s.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":s.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},k={supported:!1,testSupport:function(s){!fe&&se&&(J?ne(s):ie=s)}};let ie,se,fe=!1,J=!1;function ne(s){const r=s.createTexture();s.bindTexture(s.TEXTURE_2D,r);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,se),s.isContextLost())return;k.supported=!0}catch{}s.deleteTexture(r),fe=!0}b.document&&(se=b.document.createElement("img"),se.onload=function(){ie&&ne(ie),ie=null,J=!0},se.onerror=function(){fe=!0,ie=null},se.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const me="01";function ue(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var ke=je;function je(s,r,l,h){this.cx=3*s,this.bx=3*(l-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(h-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=r,this.p2x=l,this.p2y=h}je.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,r){if(r===void 0&&(r=1e-6),s<0)return 0;if(s>1)return 1;for(var l=s,h=0;h<8;h++){var p=this.sampleCurveX(l)-s;if(Math.abs(p)<r)return l;var x=this.sampleCurveDerivativeX(l);if(Math.abs(x)<1e-6)break;l-=p/x}var w=0,A=1;for(l=s,h=0;h<20&&(p=this.sampleCurveX(l),!(Math.abs(p-s)<r));h++)s>p?w=l:A=l,l=.5*(A-w)+w;return l},solve:function(s,r){return this.sampleCurveY(this.solveCurveX(s,r))}};var pe=ue(ke),U=F;function F(s,r){this.x=s,this.y=r}F.prototype={clone:function(){return new F(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,r){return this.clone()._rotateAround(s,r)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var r=s.x-this.x,l=s.y-this.y;return r*r+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,r){return Math.atan2(this.x*r-this.y*s,this.x*s+this.y*r)},_matMult:function(s){var r=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=r,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var r=Math.cos(s),l=Math.sin(s),h=l*this.x+r*this.y;return this.x=r*this.x-l*this.y,this.y=h,this},_rotateAround:function(s,r){var l=Math.cos(s),h=Math.sin(s),p=r.y+h*(this.x-r.x)+l*(this.y-r.y);return this.x=r.x+l*(this.x-r.x)-h*(this.y-r.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},F.convert=function(s){return s instanceof F?s:Array.isArray(s)?new F(s[0],s[1]):s};var q=ue(U);const j=Math.PI/180,H=180/Math.PI;function Z(s){return s*j}function be(s){return s*H}const Re=[[0,0],[1,0],[1,1],[0,1]];function Oe(s){if(s<=0)return 0;if(s>=1)return 1;const r=s*s,l=r*s;return 4*(s<.5?l:3*(s-r)+l-.75)}function Ne(s,r,l,h){const p=new pe(s,r,l,h);return function(x){return p.solve(x)}}const we=Ne(.25,.1,.25,1);function Fe(s,r,l){return Math.min(l,Math.max(r,s))}function nt(s,r,l){return(l=Fe((l-s)/(r-s),0,1))*l*(3-2*l)}function xe(s,r,l){const h=l-r,p=((s-r)%h+h)%h+r;return p===r?l:p}function le(s,r,l){if(!s.length)return l(null,[]);let h=s.length;const p=new Array(s.length);let x=null;s.forEach(((w,A)=>{r(w,((P,R)=>{P&&(x=P),p[A]=R,--h==0&&l(x,p)}))}))}function De(s){const r=[];for(const l in s)r.push(s[l]);return r}function Be(s,...r){for(const l of r)for(const h in l)s[h]=l[h];return s}let Ye=1;function rt(){return Ye++}function mt(){return(function s(r){return r?(r^Math.random()*(16>>r/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)})()}function ft(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function Dt(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)}function Yt(s,r){s.forEach((l=>{r[l]&&(r[l]=r[l].bind(r))}))}function cn(s,r){return s.indexOf(r,s.length-r.length)!==-1}function gn(s,r,l){const h={};for(const p in s)h[p]=r.call(this,s[p],p,s);return h}function Mn(s,r,l){const h={};for(const p in s)r.call(l||this,s[p],p,s)&&(h[p]=s[p]);return h}function Gt(s){return Array.isArray(s)?s.map(Gt):typeof s=="object"&&s?gn(s,Gt):s}const st={};function mr(s){st[s]||(typeof console<"u"&&console.warn(s),st[s]=!0)}function Er(s,r,l){return(l.y-s.y)*(r.x-s.x)>(r.y-s.y)*(l.x-s.x)}function Cr(s){let r=0;for(let l,h,p=0,x=s.length,w=x-1;p<x;w=p++)l=s[p],h=s[w],r+=(h.x-l.x)*(l.y+h.y);return r}function Ln(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function ir(s){const r={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((l,h,p,x)=>{const w=p||x;return r[h]=!w||w.toLowerCase(),""})),r["max-age"]){const l=parseInt(r["max-age"],10);isNaN(l)?delete r["max-age"]:r["max-age"]=l}return r}let er=null;function Yr(s){if(er==null){const r=s.navigator?s.navigator.userAgent:null;er=!!s.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return er}function Vt(s){try{const r=b[s];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch{return!1}}function Pn(s,r){return[s[4*r],s[4*r+1],s[4*r+2],s[4*r+3]]}const Gn="mapbox-tiles";let Dn=500,Mr=50,wr,Tr;function Ir(){try{return b.caches}catch{}}function Pr(){Ir()&&!wr&&(wr=b.caches.open(Gn))}function Ei(s){const r=s.indexOf("?");if(r<0)return s;const l=(function(p){const x=p.indexOf("?");return x>0?p.slice(x+1).split("&"):[]})(s),h=l.filter((p=>{const x=p.split("=");return x[0]==="language"||x[0]==="worldview"}));return h.length?`${s.slice(0,r)}?${h.join("&")}`:s.slice(0,r)}let Pi=1/0;const or={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(or);class oi extends Error{constructor(r,l,h){l===401&&Mt(h)&&(r+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(r),this.status=l,this.url=h}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Kr=Ln()?()=>self.worker&&self.worker.referrer:()=>(b.location.protocol==="blob:"?b.parent:b).location.href,Br=function(s,r){if(!(/^file:/.test(l=s.url)||/^file:/.test(Kr())&&!/^\w+:/.test(l))){if(b.fetch&&b.Request&&b.AbortController&&b.Request.prototype.hasOwnProperty("signal"))return(function(h,p){const x=new b.AbortController,w=new b.Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:Kr(),referrerPolicy:h.referrerPolicy,signal:x.signal});let A=!1,P=!1;const R=($=w.url).indexOf("sku=")>0&&Mt($);var $;h.type==="json"&&w.headers.set("Accept","application/json");const X=(he,ye,Se)=>{if(P)return;if(he&&he.message!=="SecurityError"&&mr(he.toString()),ye&&Se)return re(ye);const We=Date.now();b.fetch(w).then((at=>{if(at.ok){const xt=R?at.clone():null;return re(at,xt,We)}return p(new oi(at.statusText,at.status,h.url))})).catch((at=>{at.name!=="AbortError"&&p(new Error(`${at.message} ${h.url}`))}))},re=(he,ye,Se)=>{(h.type==="arrayBuffer"?he.arrayBuffer():h.type==="json"?he.json():he.text()).then((We=>{P||(ye&&Se&&(function(at,xt,lt){if(Pr(),!wr)return;const _t={status:xt.status,statusText:xt.statusText,headers:new b.Headers};xt.headers.forEach(((sn,nn)=>_t.headers.set(nn,sn)));const It=ir(xt.headers.get("Cache-Control")||"");if(It["no-store"])return;It["max-age"]&&_t.headers.set("Expires",new Date(lt+1e3*It["max-age"]).toUTCString());const Tt=_t.headers.get("Expires");Tt&&(new Date(Tt).getTime()-lt<42e4||(function(sn,nn){if(Tr===void 0)try{new Response(new ReadableStream),Tr=!0}catch{Tr=!1}Tr?nn(sn.body):sn.blob().then(nn)})(xt,(sn=>{const nn=new b.Response(sn,_t);Pr(),wr&&wr.then((Sn=>Sn.put(Ei(at.url),nn))).catch((Sn=>mr(Sn.message)))})))})(w,ye,Se),A=!0,p(null,We,he.headers.get("Cache-Control"),he.headers.get("Expires")))})).catch((We=>{P||p(new Error(We.message))}))};return R?(function(he,ye){if(Pr(),!wr)return ye(null);const Se=Ei(he.url);wr.then((We=>{We.match(Se).then((at=>{const xt=(function(lt){if(!lt)return!1;const _t=new Date(lt.headers.get("Expires")||0),It=ir(lt.headers.get("Cache-Control")||"");return _t>Date.now()&&!It["no-cache"]})(at);We.delete(Se),xt&&We.put(Se,at.clone()),ye(null,at,xt)})).catch(ye)})).catch(ye)})(w,X):X(null,null),{cancel:()=>{P=!0,A||x.abort()}}})(s,r);if(Ln()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,r,void 0,!0)}var l;return(function(h,p){const x=new b.XMLHttpRequest;x.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(x.responseType="arraybuffer");for(const w in h.headers)x.setRequestHeader(w,h.headers[w]);return h.type==="json"&&(x.responseType="text",x.setRequestHeader("Accept","application/json")),x.withCredentials=h.credentials==="include",x.onerror=()=>{p(new Error(x.statusText))},x.onload=()=>{if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let w=x.response;if(h.type==="json")try{w=JSON.parse(x.response)}catch(A){return p(A)}p(null,w,x.getResponseHeader("Cache-Control"),x.getResponseHeader("Expires"))}else p(new oi(x.statusText,x.status,h.url))},x.send(h.body),{cancel:()=>x.abort()}})(s,r)},di=function(s,r){return Br(Be(s,{type:"arrayBuffer"}),r)};function si(s){const r=b.document.createElement("a");return r.href=s,r.protocol===b.document.location.protocol&&r.host===b.document.location.host}const ut="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ee,Ie;Ee=[],Ie=0;const Qe=function(s,r){if(k.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),Ie>=V.MAX_PARALLEL_IMAGE_REQUESTS){const x={requestParameters:s,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return Ee.push(x),x}Ie++;let l=!1;const h=()=>{if(!l)for(l=!0,Ie--;Ee.length&&Ie<V.MAX_PARALLEL_IMAGE_REQUESTS;){const x=Ee.shift(),{requestParameters:w,callback:A,cancelled:P}=x;P||(x.cancel=Qe(w,A).cancel)}},p=di(s,((x,w,A,P)=>{h(),x?r(x):w&&(b.createImageBitmap?(function(R,$){const X=new b.Blob([new Uint8Array(R)],{type:"image/png"});b.createImageBitmap(X).then((re=>{$(null,re)})).catch((re=>{$(new Error(`Could not load image because of ${re.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))})(w,((R,$)=>r(R,$,A,P))):(function(R,$){const X=new b.Image,re=b.URL;X.onload=()=>{$(null,X),re.revokeObjectURL(X.src),X.onload=null,b.requestAnimationFrame((()=>{X.src=ut}))},X.onerror=()=>$(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const he=new b.Blob([new Uint8Array(R)],{type:"image/png"});X.src=R.byteLength?re.createObjectURL(he):ut})(w,((R,$)=>r(R,$,A,P))))}));return{cancel:()=>{p.cancel(),h()}}},ht="NO_ACCESS_TOKEN";function Ct(s){return s.indexOf("mapbox:")===0}function Mt(s){return V.API_URL_REGEX.test(s)}function Bt(s){return V.API_CDN_URL_REGEX.test(s)}function Et(s){return V.API_STYLE_REGEX.test(s)&&!Pt(s)}function Pt(s){return V.API_SPRITE_REGEX.test(s)}const vn=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Bn(s){const r=s.match(vn);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function Tn(s){const r=s.params.length?`?${s.params.join("&")}`:"";return`${s.protocol}://${s.authority}${s.path}${r}`}const kr="mapbox.eventData";function Lr(s){if(!s)return null;const r=s.split(".");if(!r||r.length!==3)return null;try{return JSON.parse(decodeURIComponent(b.atob(r[1]).split("").map((l=>"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2))).join("")))}catch{return null}}class Vr{constructor(r){this.type=r,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const l=Lr(V.ACCESS_TOKEN);let h="";return h=l&&l.u?b.btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,((p,x)=>String.fromCharCode(+("0x"+x))))):V.ACCESS_TOKEN||"",r?`${kr}.${r}:${h}`:`${kr}:${h}`}fetchEventData(){const r=Vt("localStorage"),l=this.getStorageKey(),h=this.getStorageKey("uuid");if(r)try{const p=b.localStorage.getItem(l);p&&(this.eventData=JSON.parse(p));const x=b.localStorage.getItem(h);x&&(this.anonId=x)}catch{mr("Unable to read from LocalStorage")}}saveEventData(){const r=Vt("localStorage"),l=this.getStorageKey(),h=this.getStorageKey("uuid");if(r)try{b.localStorage.setItem(h,this.anonId),Object.keys(this.eventData).length>=1&&b.localStorage.setItem(l,JSON.stringify(this.eventData))}catch{mr("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,l,h,p){if(!V.EVENTS_URL)return;const x=Bn(V.EVENTS_URL);x.params.push(`access_token=${p||V.ACCESS_TOKEN||""}`);const w={event:this.type,created:new Date(r).toISOString()},A=l?Be(w,l):w,P={url:Tn(x),headers:{"Content-Type":"text/plain"},body:JSON.stringify([A])};this.pendingRequest=(function(R,$){return Br(Be(R,{method:"POST"}),$)})(P,(R=>{this.pendingRequest=null,h(R),this.saveEventData(),this.processRequests(p)}))}queueRequest(r,l){this.queue.push(r),this.processRequests(l)}}const Ar=new class extends Vr{constructor(s){super("appUserTurnstile"),this._customAccessToken=s}postTurnstileEvent(s,r){V.EVENTS_URL&&V.ACCESS_TOKEN&&Array.isArray(s)&&s.some((l=>Ct(l)||Mt(l)))&&this.queueRequest(Date.now(),r)}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=Lr(V.ACCESS_TOKEN),l=r?r.u:V.ACCESS_TOKEN;let h=l!==this.eventData.tokenU;Dt(this.anonId)||(this.anonId=mt(),h=!0);const p=this.queue.shift();if(this.eventData.lastSuccess){const x=new Date(this.eventData.lastSuccess),w=new Date(p),A=(p-this.eventData.lastSuccess)/864e5;h=h||A>=1||A<-1||x.getDate()!==w.getDate()}else h=!0;h?this.postEvent(p,{sdkIdentifier:"mapbox-gl-js",sdkVersion:I,skuId:me,"enabled.telemetry":!1,userId:this.anonId},(x=>{x||(this.eventData.lastSuccess=p,this.eventData.tokenU=l)}),s):this.processRequests()}},Ai=Ar.postTurnstileEvent.bind(Ar),no=new class extends Vr{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(s,r,l,h){this.skuToken=r,this.errorCb=h,V.EVENTS_URL&&(l||V.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},l):this.errorCb(new Error(ht)))}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:l}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),Dt(this.anonId)||(this.anonId=mt()),this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:I,skuId:me,skuToken:this.skuToken,userId:this.anonId},(h=>{h?this.errorCb(h):r&&(this.success[r]=!0)}),s))}},yo=no.postMapLoadEvent.bind(no),$o=new class extends Vr{constructor(){super("gljs.performance")}postPerformanceEvent(s,r){V.EVENTS_URL&&(s||V.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:r},s)}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:r,performanceData:l}=this.queue.shift(),h=(function(p){const x=b.performance.getEntriesByType("resource"),w=b.performance.getEntriesByType("mark"),A=(function(re){const he={};if(re){for(const ye in re)if(ye!=="other")for(const Se of re[ye]){const We=`${ye}ResolveRangeMin`,at=`${ye}ResolveRangeMax`,xt=`${ye}RequestCount`,lt=`${ye}RequestCachedCount`;he[We]=Math.min(he[We]||1/0,Se.startTime),he[at]=Math.max(he[at]||-1/0,Se.responseEnd);const _t=It=>{he[It]===void 0&&(he[It]=0),++he[It]};Se.transferSize!==void 0&&Se.transferSize===0&&_t(lt),_t(xt)}}return he})((function(re,he){const ye={};if(re)for(const Se of re){const We=he(Se);ye[We]===void 0&&(ye[We]=[]),ye[We].push(Se)}return ye})(x,sl)),P=b.devicePixelRatio,R=b.navigator.connection||b.navigator.mozConnection||b.navigator.webkitConnection,$={counters:[],metadata:[],attributes:[]},X=(re,he,ye)=>{ye!=null&&re.push({name:he,value:ye.toString()})};for(const re in A)X($.counters,re,A[re]);if(p.interactionRange[0]!==1/0&&p.interactionRange[1]!==-1/0&&(X($.counters,"interactionRangeMin",p.interactionRange[0]),X($.counters,"interactionRangeMax",p.interactionRange[1])),w)for(const re of Object.keys(ga)){const he=ga[re],ye=w.find((Se=>Se.name===he));ye&&X($.counters,he,ye.startTime)}return X($.counters,"visibilityHidden",p.visibilityHidden),X($.attributes,"style",(function(re){if(re)for(const he of re){const ye=he.name.split("?")[0];if(Et(ye)){const Se=ye.split("/").slice(-2);if(Se.length===2)return`mapbox://styles/${Se[0]}/${Se[1]}`}}})(x)),X($.attributes,"terrainEnabled",p.terrainEnabled?"true":"false"),X($.attributes,"fogEnabled",p.fogEnabled?"true":"false"),X($.attributes,"projection",p.projection),X($.attributes,"zoom",p.zoom),X($.metadata,"devicePixelRatio",P),X($.metadata,"connectionEffectiveType",R?R.effectiveType:void 0),X($.metadata,"navigatorUserAgent",b.navigator.userAgent),X($.metadata,"screenWidth",b.screen.width),X($.metadata,"screenHeight",b.screen.height),X($.metadata,"windowWidth",b.innerWidth),X($.metadata,"windowHeight",b.innerHeight),X($.metadata,"mapWidth",p.width/P),X($.metadata,"mapHeight",p.height/P),X($.metadata,"webglRenderer",p.renderer),X($.metadata,"webglVendor",p.vendor),X($.metadata,"sdkVersion",I),X($.metadata,"sdkIdentifier","mapbox-gl-js"),$})(l);for(const p of h.metadata);for(const p of h.counters);for(const p of h.attributes);this.postEvent(r,h,(()=>{}),s)}},ro=$o.postPerformanceEvent.bind($o),ys=new class extends Vr{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(s,r,l,h){if(!V.API_URL||!V.SESSION_PATH)return;const p=Bn(V.API_URL+V.SESSION_PATH);p.params.push(`sku=${r||""}`),p.params.push(`access_token=${h||V.ACCESS_TOKEN||""}`);const x={url:Tn(p),headers:{"Content-Type":"text/plain"}};this.pendingRequest=(function(w,A){return Br(Be(w,{method:"GET"}),A)})(x,(w=>{this.pendingRequest=null,l(w),this.saveEventData(),this.processRequests(h)}))}getSessionAPI(s,r,l,h){this.skuToken=r,this.errorCb=h,V.SESSION_PATH&&V.API_URL&&(l||V.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},l):this.errorCb(new Error(ht)))}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:l}=this.queue.shift();r&&this.success[r]||this.getSession(l,this.skuToken,(h=>{h?this.errorCb(h):r&&(this.success[r]=!0)}),s)}},io=ys.getSessionAPI.bind(ys),Is=new Set,ga={create:"create",load:"load",fullLoad:"fullLoad"},gl={mark(s){b.performance.mark(s)},measure(s,r,l){b.performance.measure(s,r,l)}};function sl(s){const r=s.name.split("?")[0];return Bt(r)&&r.includes("mapbox-gl.js")?"javascript":Bt(r)&&r.includes("mapbox-gl.css")?"css":(function(l){return V.API_FONTS_REGEX.test(l)})(r)?"fontRange":Pt(r)?"sprite":Et(r)?"style":(function(l){return V.API_TILEJSON_REGEX.test(l)})(r)?"tilejson":"other"}const Wi=b.performance;function Jl(s){const r=s?s.url.toString():void 0;return Wi.getEntriesByName(r)}let Lu,Eo,fu,Ea;const Ko={now:()=>fu!==void 0?fu:b.performance.now(),setNow(s){fu=s},restoreNow(){fu=void 0},frame(s){const r=b.requestAnimationFrame(s);return{cancel:()=>b.cancelAnimationFrame(r)}},getImageData(s,r=0){const{width:l,height:h}=s;Ea||(Ea=b.document.createElement("canvas"));const p=Ea.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(l>Ea.width||h>Ea.height)&&(Ea.width=l,Ea.height=h),p.clearRect(-r,-r,l+2*r,h+2*r),p.drawImage(s,0,0,l,h),p.getImageData(-r,-r,l+2*r,h+2*r)},resolveURL:s=>(Lu||(Lu=b.document.createElement("a")),Lu.href=s,Lu.href),get devicePixelRatio(){return b.devicePixelRatio},get prefersReducedMotion(){return!!b.matchMedia&&(Eo==null&&(Eo=b.matchMedia("(prefers-reduced-motion: reduce)")),Eo.matches)}};function Xa(s,r,l){l[s]&&l[s].indexOf(r)!==-1||(l[s]=l[s]||[],l[s].push(r))}function Nl(s,r,l){if(l&&l[s]){const h=l[s].indexOf(r);h!==-1&&l[s].splice(h,1)}}class Ql{constructor(r,l={}){Be(this,l),this.type=r}}class Aa extends Ql{constructor(r,l={}){super("error",Be({error:r},l))}}class sa{on(r,l){return this._listeners=this._listeners||{},Xa(r,l,this._listeners),this}off(r,l){return Nl(r,l,this._listeners),Nl(r,l,this._oneTimeListeners),this}once(r,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},Xa(r,l,this._oneTimeListeners),this):new Promise((h=>this.once(r,h)))}fire(r,l){typeof r=="string"&&(r=new Ql(r,l||{}));const h=r.type;if(this.listens(h)){r.target=this;const p=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const A of p)A.call(this,r);const x=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const A of x)Nl(h,A,this._oneTimeListeners),A.call(this,r);const w=this._eventedParent;w&&(Be(r,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),w.fire(r))}else r instanceof Aa&&console.error(r.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,l){return this._eventedParent=r,this._eventedParentData=l,this}}var dn=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Xo(s,...r){for(const l of r)for(const h in l)s[h]=l[h];return s}function ss(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function xi(s){if(Array.isArray(s))return s.map(xi);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const r={};for(const l in s)r[l]=xi(s[l]);return r}return ss(s)}class pu extends Error{constructor(r,l){super(l),this.message=l,this.key=r}}var Za=pu;class Ya{constructor(r,l=[]){this.parent=r,this.bindings={};for(const[h,p]of l)this.bindings[h]=p}concat(r){return new Ya(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}var al=Ya;const Cs={kind:"null"},tr={kind:"number"},zr={kind:"string"},Nr={kind:"boolean"},js={kind:"color"},Ta={kind:"object"},bi={kind:"value"},Mi={kind:"collator"},yl={kind:"formatted"},Gi={kind:"resolvedImage"};function fs(s,r){return{kind:"array",itemType:s,N:r}}function Ui(s){if(s.kind==="array"){const r=Ui(s.itemType);return typeof s.N=="number"?`array<${r}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${r}>`}return s.kind}const mu=[Cs,tr,zr,Nr,js,yl,Ta,fs(bi),Gi];function ec(s,r){if(r.kind==="error")return null;if(s.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!ec(s.itemType,r.itemType))&&(typeof s.N!="number"||s.N===r.N))return null}else{if(s.kind===r.kind)return null;if(s.kind==="value"){for(const l of mu)if(!ec(l,r))return null}}return`Expected ${Ui(s)} but found ${Ui(r)} instead.`}function nu(s,r){return r.some((l=>l.kind===s.kind))}function _c(s,r){return r.some((l=>l==="null"?s===null:l==="array"?Array.isArray(s):l==="object"?s&&!Array.isArray(s)&&typeof s=="object":l===typeof s))}var tc,Da={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Ls(s){return(s=Math.round(s))<0?0:s>255?255:s}function Vi(s){return Ls(s[s.length-1]==="%"?parseFloat(s)/100*255:parseInt(s))}function Fa(s){return(r=s[s.length-1]==="%"?parseFloat(s)/100:parseFloat(s))<0?0:r>1?1:r;var r}function ai(s,r,l){return l<0?l+=1:l>1&&(l-=1),6*l<1?s+(r-s)*l*6:2*l<1?r:3*l<2?s+(r-s)*(2/3-l)*6:s}try{tc={}.parseCSSColor=function(s){var r,l=s.replace(/ /g,"").toLowerCase();if(l in Da)return Da[l].slice();if(l[0]==="#")return l.length===4?(r=parseInt(l.substr(1),16))>=0&&r<=4095?[(3840&r)>>4|(3840&r)>>8,240&r|(240&r)>>4,15&r|(15&r)<<4,1]:null:l.length===7&&(r=parseInt(l.substr(1),16))>=0&&r<=16777215?[(16711680&r)>>16,(65280&r)>>8,255&r,1]:null;var h=l.indexOf("("),p=l.indexOf(")");if(h!==-1&&p+1===l.length){var x=l.substr(0,h),w=l.substr(h+1,p-(h+1)).split(","),A=1;switch(x){case"rgba":if(w.length!==4)return null;A=Fa(w.pop());case"rgb":return w.length!==3?null:[Vi(w[0]),Vi(w[1]),Vi(w[2]),A];case"hsla":if(w.length!==4)return null;A=Fa(w.pop());case"hsl":if(w.length!==3)return null;var P=(parseFloat(w[0])%360+360)%360/360,R=Fa(w[1]),$=Fa(w[2]),X=$<=.5?$*(R+1):$+R-$*R,re=2*$-X;return[Ls(255*ai(re,X,P+1/3)),Ls(255*ai(re,X,P)),Ls(255*ai(re,X,P-1/3)),A];default:return null}}return null}}catch{}class Zo{constructor(r,l,h,p=1){this.r=r,this.g=l,this.b=h,this.a=p}static parse(r){if(!r)return;if(r instanceof Zo)return r;if(typeof r!="string")return;const l=tc(r);return l?new Zo(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){const[r,l,h,p]=this.toArray();return`rgba(${Math.round(r)},${Math.round(l)},${Math.round(h)},${p})`}toArray(){const{r,g:l,b:h,a:p}=this;return p===0?[0,0,0,0]:[255*r/p,255*l/p,255*h/p,p]}toArray01(){const{r,g:l,b:h,a:p}=this;return p===0?[0,0,0,0]:[r/p,l/p,h/p,p]}toArray01PremultipliedAlpha(){const{r,g:l,b:h,a:p}=this;return[r,l,h,p]}}Zo.black=new Zo(0,0,0,1),Zo.white=new Zo(1,1,1,1),Zo.transparent=new Zo(0,0,0,0),Zo.red=new Zo(1,0,0,1),Zo.blue=new Zo(0,0,1,1);var Ao=Zo;class Ih{constructor(r,l,h){this.sensitivity=r?l?"variant":"case":l?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,l){return this.collator.compare(r,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Pu{constructor(r,l,h,p,x){this.text=r.normalize?r.normalize():r,this.image=l,this.scale=h,this.fontStack=p,this.textColor=x}}class _o{constructor(r){this.sections=r}static fromString(r){return new _o([new Pu(r,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((r=>r.text.length!==0||r.image&&r.image.name.length!==0))}static factory(r){return r instanceof _o?r:_o.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map((r=>r.text)).join("")}serialize(){const r=["format"];for(const l of this.sections){if(l.image){r.push(["image",l.image.name]);continue}r.push(l.text);const h={};l.fontStack&&(h["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(h["font-scale"]=l.scale),l.textColor&&(h["text-color"]=["rgba"].concat(l.textColor.toArray())),r.push(h)}return r}}class Us{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new Us({name:r,available:!1}):null}serialize(){return["image",this.name]}}function ku(s,r,l,h){return typeof s=="number"&&s>=0&&s<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof l=="number"&&l>=0&&l<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[s,r,l,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[s,r,l,h]:[s,r,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Go(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof Ao||s instanceof Ih||s instanceof _o||s instanceof Us)return!0;if(Array.isArray(s)){for(const r of s)if(!Go(r))return!1;return!0}if(typeof s=="object"){for(const r in s)if(!Go(s[r]))return!1;return!0}return!1}function vo(s){if(s===null)return Cs;if(typeof s=="string")return zr;if(typeof s=="boolean")return Nr;if(typeof s=="number")return tr;if(s instanceof Ao)return js;if(s instanceof Ih)return Mi;if(s instanceof _o)return yl;if(s instanceof Us)return Gi;if(Array.isArray(s)){const r=s.length;let l;for(const h of s){const p=vo(h);if(l){if(l===p)continue;l=bi;break}l=p}return fs(l||bi,r)}return Ta}function Dl(s){const r=typeof s;return s===null?"":r==="string"||r==="number"||r==="boolean"?String(s):s instanceof Ao||s instanceof _o||s instanceof Us?s.toString():JSON.stringify(s)}class Oa{constructor(r,l){this.type=r,this.value=l}static parse(r,l){if(r.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!Go(r[1]))return l.error("invalid value");const h=r[1];let p=vo(h);const x=l.expectedType;return p.kind!=="array"||p.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(p=x),new Oa(p,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ao?["rgba"].concat(this.value.toArray()):this.value instanceof _o?this.value.serialize():this.value}}var Vs=Oa,Bo=class{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}};const Bc={string:zr,number:tr,boolean:Nr,object:Ta};class Ho{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");let h,p=1;const x=r[0];if(x==="array"){let A,P;if(r.length>2){const R=r[1];if(typeof R!="string"||!(R in Bc)||R==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);A=Bc[R],p++}else A=bi;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return l.error('The length argument to "array" must be a positive integer literal',2);P=r[2],p++}h=fs(A,P)}else h=Bc[x];const w=[];for(;p<r.length;p++){const A=l.parse(r[p],p,bi);if(!A)return null;w.push(A)}return new Ho(h,w)}evaluate(r){for(let l=0;l<this.args.length;l++){const h=this.args[l].evaluate(r);if(!ec(this.type,vo(h)))return h;if(l===this.args.length-1)throw new Bo(`Expected value to be of type ${Ui(this.type)}, but found ${Ui(vo(h))} instead.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every((r=>r.outputDefined()))}serialize(){const r=this.type,l=[r.kind];if(r.kind==="array"){const h=r.itemType;if(h.kind==="string"||h.kind==="number"||h.kind==="boolean"){l.push(h.kind);const p=r.N;(typeof p=="number"||this.args.length>1)&&l.push(p)}}return l.concat(this.args.map((h=>h.serialize())))}}var ya=Ho;class Ja{constructor(r){this.type=yl,this.sections=r}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");const h=r[1];if(!Array.isArray(h)&&typeof h=="object")return l.error("First argument must be an image or text section.");const p=[];let x=!1;for(let w=1;w<=r.length-1;++w){const A=r[w];if(x&&typeof A=="object"&&!Array.isArray(A)){x=!1;let P=null;if(A["font-scale"]&&(P=l.parse(A["font-scale"],1,tr),!P))return null;let R=null;if(A["text-font"]&&(R=l.parse(A["text-font"],1,fs(zr)),!R))return null;let $=null;if(A["text-color"]&&($=l.parse(A["text-color"],1,js),!$))return null;const X=p[p.length-1];X.scale=P,X.font=R,X.textColor=$}else{const P=l.parse(r[w],1,bi);if(!P)return null;const R=P.type.kind;if(R!=="string"&&R!=="value"&&R!=="null"&&R!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,p.push({content:P,scale:null,font:null,textColor:null})}}return new Ja(p)}evaluate(r){return new _o(this.sections.map((l=>{const h=l.content.evaluate(r);return vo(h)===Gi?new Pu("",h,null,null,null):new Pu(Dl(h),null,l.scale?l.scale.evaluate(r):null,l.font?l.font.evaluate(r).join(","):null,l.textColor?l.textColor.evaluate(r):null)})))}eachChild(r){for(const l of this.sections)r(l.content),l.scale&&r(l.scale),l.font&&r(l.font),l.textColor&&r(l.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const l of this.sections){r.push(l.content.serialize());const h={};l.scale&&(h["font-scale"]=l.scale.serialize()),l.font&&(h["text-font"]=l.font.serialize()),l.textColor&&(h["text-color"]=l.textColor.serialize()),r.push(h)}return r}}class ll{constructor(r){this.type=Gi,this.input=r}static parse(r,l){if(r.length!==2)return l.error("Expected two arguments.");const h=l.parse(r[1],1,zr);return h?new ll(h):l.error("No image name provided.")}evaluate(r){const l=this.input.evaluate(r),h=Us.fromString(l);return h&&r.availableImages&&(h.available=r.availableImages.indexOf(l)>-1),h}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const ru={"to-boolean":Nr,"to-color":js,"to-number":tr,"to-string":zr};class vc{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");const h=r[0];if((h==="to-boolean"||h==="to-string")&&r.length!==2)return l.error("Expected one argument.");const p=ru[h],x=[];for(let w=1;w<r.length;w++){const A=l.parse(r[w],w,bi);if(!A)return null;x.push(A)}return new vc(p,x)}evaluate(r){if(this.type.kind==="boolean")return!!this.args[0].evaluate(r);if(this.type.kind==="color"){let l,h;for(const p of this.args){if(l=p.evaluate(r),h=null,l instanceof Ao)return l;if(typeof l=="string"){const x=r.parseColor(l);if(x)return x}else if(Array.isArray(l)&&(h=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:ku(l[0],l[1],l[2],l[3]),!h))return new Ao(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new Bo(h||`Could not parse color from value '${typeof l=="string"?l:String(JSON.stringify(l))}'`)}if(this.type.kind==="number"){let l=null;for(const h of this.args){if(l=h.evaluate(r),l===null)return 0;const p=Number(l);if(!isNaN(p))return p}throw new Bo(`Could not convert ${JSON.stringify(l)} to number.`)}return this.type.kind==="formatted"?_o.fromString(Dl(this.args[0].evaluate(r))):this.type.kind==="resolvedImage"?Us.fromString(Dl(this.args[0].evaluate(r))):Dl(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every((r=>r.outputDefined()))}serialize(){if(this.type.kind==="formatted")return new Ja([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ll(this.args[0]).serialize();const r=[`to-${this.type.kind}`];return this.eachChild((l=>{r.push(l.serialize())})),r}}var qs=vc;const Ti=["Unknown","Point","LineString","Polygon"];var Ss=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ti[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const s=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:l,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*r-s[0])+this.featureDistanceData.bearing[1]*(h*r-s[1])}return 0}parseColor(s){let r=this._parseColorCache[s];return r||(r=this._parseColorCache[s]=Ao.parse(s)),r}};class $s{constructor(r,l,h,p){this.name=r,this.type=l,this._evaluate=h,this.args=p}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((r=>r.serialize())))}static parse(r,l){const h=r[0],p=$s.definitions[h];if(!p)return l.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const x=Array.isArray(p)?p[0]:p.type,w=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,A=w.filter((([R])=>!Array.isArray(R)||R.length===r.length-1));let P=null;for(const[R,$]of A){P=new zc(l.registry,l.path,null,l.scope);const X=[];let re=!1;for(let he=1;he<r.length;he++){const ye=r[he],Se=Array.isArray(R)?R[he-1]:R.type,We=P.parse(ye,1+X.length,Se);if(!We){re=!0;break}X.push(We)}if(!re)if(Array.isArray(R)&&R.length!==X.length)P.error(`Expected ${R.length} arguments, but found ${X.length} instead.`);else{for(let he=0;he<X.length;he++){const ye=Array.isArray(R)?R[he]:R.type,Se=X[he];P.concat(he+1).checkSubtype(ye,Se.type)}if(P.errors.length===0)return new $s(h,x,$,X)}}if(A.length===1)l.errors.push(...P.errors);else{const R=(A.length?A:w).map((([X])=>{return re=X,Array.isArray(re)?`(${re.map(Ui).join(", ")})`:`(${Ui(re.type)}...)`;var re})).join(" | "),$=[];for(let X=1;X<r.length;X++){const re=l.parse(r[X],1+$.length);if(!re)return null;$.push(Ui(re.type))}l.error(`Expected arguments of type ${R}, but found (${$.join(", ")}) instead.`)}return null}static register(r,l){$s.definitions=l;for(const h in l)r[h]=$s}}var aa=$s;class la{constructor(r,l,h){this.type=Mi,this.locale=h,this.caseSensitive=r,this.diacriticSensitive=l}static parse(r,l){if(r.length!==2)return l.error("Expected one argument.");const h=r[1];if(typeof h!="object"||Array.isArray(h))return l.error("Collator options argument must be an object.");const p=l.parse(h["case-sensitive"]!==void 0&&h["case-sensitive"],1,Nr);if(!p)return null;const x=l.parse(h["diacritic-sensitive"]!==void 0&&h["diacritic-sensitive"],1,Nr);if(!x)return null;let w=null;return h.locale&&(w=l.parse(h.locale,1,zr),!w)?null:new la(p,x,w)}evaluate(r){return new Ih(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}const cl=8192;function Gs(s,r){s[0]=Math.min(s[0],r[0]),s[1]=Math.min(s[1],r[1]),s[2]=Math.max(s[2],r[0]),s[3]=Math.max(s[3],r[1])}function Hs(s,r){return!(s[0]<=r[0]||s[2]>=r[2]||s[1]<=r[1]||s[3]>=r[3])}function xc(s,r){const l=(180+s[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,p=Math.pow(2,r.z);return[Math.round(l*p*cl),Math.round(h*p*cl)]}function W(s,r,l){const h=s[0]-r[0],p=s[1]-r[1],x=s[0]-l[0],w=s[1]-l[1];return h*w-x*p==0&&h*x<=0&&p*w<=0}function Ce(s,r){let l=!1;for(let w=0,A=r.length;w<A;w++){const P=r[w];for(let R=0,$=P.length;R<$-1;R++){if(W(s,P[R],P[R+1]))return!1;(p=P[R])[1]>(h=s)[1]!=(x=P[R+1])[1]>h[1]&&h[0]<(x[0]-p[0])*(h[1]-p[1])/(x[1]-p[1])+p[0]&&(l=!l)}}var h,p,x;return l}function pt(s,r){for(let l=0;l<r.length;l++)if(Ce(s,r[l]))return!0;return!1}function yt(s,r,l,h){const p=h[0]-l[0],x=h[1]-l[1],w=(s[0]-l[0])*x-p*(s[1]-l[1]),A=(r[0]-l[0])*x-p*(r[1]-l[1]);return w>0&&A<0||w<0&&A>0}function qt(s,r,l){for(const R of l)for(let $=0;$<R.length-1;++$)if((A=[(w=R[$+1])[0]-(x=R[$])[0],w[1]-x[1]])[0]*(P=[(p=r)[0]-(h=s)[0],p[1]-h[1]])[1]-A[1]*P[0]!=0&&yt(h,p,x,w)&&yt(x,w,h,p))return!0;var h,p,x,w,A,P;return!1}function Zt(s,r){for(let l=0;l<s.length;++l)if(!Ce(s[l],r))return!1;for(let l=0;l<s.length-1;++l)if(qt(s[l],s[l+1],r))return!1;return!0}function Fn(s,r){for(let l=0;l<r.length;l++)if(Zt(s,r[l]))return!0;return!1}function Dr(s,r,l){const h=[];for(let p=0;p<s.length;p++){const x=[];for(let w=0;w<s[p].length;w++){const A=xc(s[p][w],l);Gs(r,A),x.push(A)}h.push(x)}return h}function Xr(s,r,l){const h=[];for(let p=0;p<s.length;p++){const x=Dr(s[p],r,l);h.push(x)}return h}function yi(s,r,l,h){if(s[0]<l[0]||s[0]>l[2]){const p=.5*h;let x=s[0]-l[0]>p?-h:l[0]-s[0]>p?h:0;x===0&&(x=s[0]-l[2]>p?-h:l[2]-s[0]>p?h:0),s[0]+=x}Gs(r,s)}function Ii(s,r,l,h){const p=Math.pow(2,h.z)*cl,x=[h.x*cl,h.y*cl],w=[];if(!s)return w;for(const A of s)for(const P of A){const R=[P.x+x[0],P.y+x[1]];yi(R,r,l,p),w.push(R)}return w}function xo(s,r,l,h){const p=Math.pow(2,h.z)*cl,x=[h.x*cl,h.y*cl],w=[];if(!s)return w;for(const P of s){const R=[];for(const $ of P){const X=[$.x+x[0],$.y+x[1]];Gs(r,X),R.push(X)}w.push(R)}if(r[2]-r[0]<=p/2){(A=r)[0]=A[1]=1/0,A[2]=A[3]=-1/0;for(const P of w)for(const R of P)yi(R,r,l,p)}var A;return w}class bo{constructor(r,l){this.type=Nr,this.geojson=r,this.geometries=l}static parse(r,l){if(r.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(Go(r[1])){const h=r[1];if(h.type==="FeatureCollection")for(let p=0;p<h.features.length;++p){const x=h.features[p].geometry.type;if(x==="Polygon"||x==="MultiPolygon")return new bo(h,h.features[p].geometry)}else if(h.type==="Feature"){const p=h.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new bo(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new bo(h,h)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return(function(l,h){const p=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],w=l.canonicalID();if(!w)return!1;if(h.type==="Polygon"){const A=Dr(h.coordinates,x,w),P=Ii(l.geometry(),p,x,w);if(!Hs(p,x))return!1;for(const R of P)if(!Ce(R,A))return!1}if(h.type==="MultiPolygon"){const A=Xr(h.coordinates,x,w),P=Ii(l.geometry(),p,x,w);if(!Hs(p,x))return!1;for(const R of P)if(!pt(R,A))return!1}return!0})(r,this.geometries);if(r.geometryType()==="LineString")return(function(l,h){const p=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],w=l.canonicalID();if(!w)return!1;if(h.type==="Polygon"){const A=Dr(h.coordinates,x,w),P=xo(l.geometry(),p,x,w);if(!Hs(p,x))return!1;for(const R of P)if(!Zt(R,A))return!1}if(h.type==="MultiPolygon"){const A=Xr(h.coordinates,x,w),P=xo(l.geometry(),p,x,w);if(!Hs(p,x))return!1;for(const R of P)if(!Fn(R,A))return!1}return!0})(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Yo=bo;function Ro(s){if(s instanceof aa&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof Yo)return!1;let r=!0;return s.eachChild((l=>{r&&!Ro(l)&&(r=!1)})),r}function zo(s){if(s instanceof aa&&s.name==="feature-state")return!1;let r=!0;return s.eachChild((l=>{r&&!zo(l)&&(r=!1)})),r}function Jo(s,r){if(s instanceof aa&&r.indexOf(s.name)>=0)return!1;let l=!0;return s.eachChild((h=>{l&&!Jo(h,r)&&(l=!1)})),l}class us{constructor(r,l){this.type=l.type,this.name=r,this.boundExpression=l}static parse(r,l){if(r.length!==2||typeof r[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");const h=r[1];return l.scope.has(h)?new us(h,l.scope.get(h)):l.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var jo=us;class Es{constructor(r,l=[],h,p=new al,x=[]){this.registry=r,this.path=l,this.key=l.map((w=>`[${w}]`)).join(""),this.scope=p,this.errors=x,this.expectedType=h}parse(r,l,h,p,x={}){return l?this.concat(l,h,p)._parse(r,x):this._parse(r,x)}_parse(r,l){function h(p,x,w){return w==="assert"?new ya(x,[p]):w==="coerce"?new qs(x,[p]):p}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=r[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const x=this.registry[p];if(x){let w=x.parse(r,this);if(!w)return null;if(this.expectedType){const A=this.expectedType,P=w.type;if(A.kind!=="string"&&A.kind!=="number"&&A.kind!=="boolean"&&A.kind!=="object"&&A.kind!=="array"||P.kind!=="value")if(A.kind!=="color"&&A.kind!=="formatted"&&A.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string"){if(this.checkSubtype(A,P))return null}else w=h(w,A,l.typeAnnotation||"coerce");else w=h(w,A,l.typeAnnotation||"assert")}if(!(w instanceof Vs)&&w.type.kind!=="resolvedImage"&&Qa(w)){const A=new Ss;try{w=new Vs(w.type,w.evaluate(A))}catch(P){return this.error(P.message),null}}return w}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,l,h){const p=typeof r=="number"?this.path.concat(r):this.path,x=h?this.scope.concat(h):this.scope;return new Es(this.registry,p,l||null,x,this.errors)}error(r,...l){const h=`${this.key}${l.map((p=>`[${p}]`)).join("")}`;this.errors.push(new Za(h,r))}checkSubtype(r,l){const h=ec(r,l);return h&&this.error(h),h}}var zc=Es;function Qa(s){if(s instanceof jo)return Qa(s.boundExpression);if(s instanceof aa&&s.name==="error"||s instanceof la||s instanceof Yo)return!1;const r=s instanceof qs||s instanceof ya;let l=!0;return s.eachChild((h=>{l=r?l&&Qa(h):l&&h instanceof Vs})),!!l&&Ro(s)&&Jo(s,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function L(s,r){const l=s.length-1;let h,p,x=0,w=l,A=0;for(;x<=w;)if(A=Math.floor((x+w)/2),h=s[A],p=s[A+1],h<=r){if(A===l||r<p)return A;x=A+1}else{if(!(h>r))throw new Bo("Input is not a number.");w=A-1}return 0}class ae{constructor(r,l,h){this.type=r,this.input=l,this.labels=[],this.outputs=[];for(const[p,x]of h)this.labels.push(p),this.outputs.push(x)}static parse(r,l){if(r.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return l.error("Expected an even number of arguments.");const h=l.parse(r[1],1,tr);if(!h)return null;const p=[];let x=null;l.expectedType&&l.expectedType.kind!=="value"&&(x=l.expectedType);for(let w=1;w<r.length;w+=2){const A=w===1?-1/0:r[w],P=r[w+1],R=w,$=w+1;if(typeof A!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(p.length&&p[p.length-1][0]>=A)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',R);const X=l.parse(P,$,x);if(!X)return null;x=x||X.type,p.push([A,X])}return new ae(x,h,p)}evaluate(r){const l=this.labels,h=this.outputs;if(l.length===1)return h[0].evaluate(r);const p=this.input.evaluate(r);if(p<=l[0])return h[0].evaluate(r);const x=l.length;return p>=l[x-1]?h[x-1].evaluate(r):h[L(l,p)].evaluate(r)}eachChild(r){r(this.input);for(const l of this.outputs)r(l)}outputDefined(){return this.outputs.every((r=>r.outputDefined()))}serialize(){const r=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&r.push(this.labels[l]),r.push(this.outputs[l].serialize());return r}}var ve=ae;function Ge(s,r,l){return s*(1-l)+r*l}var Xt=Object.freeze({__proto__:null,array:function(s,r,l){return s.map(((h,p)=>Ge(h,r[p],l)))},color:function(s,r,l){return new Ao(Ge(s.r,r.r,l),Ge(s.g,r.g,l),Ge(s.b,r.b,l),Ge(s.a,r.a,l))},number:Ge});const hn=.95047,ar=1.08883,so=4/29,Fo=6/29,Ki=3*Fo*Fo,zi=Fo*Fo*Fo,Mo=Math.PI/180,ca=180/Math.PI;function Lo(s){return s>zi?Math.pow(s,1/3):s/Ki+so}function Bi(s){return s>Fo?s*s*s:Ki*(s-so)}function Fl(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function ua(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function Ru(s){const r=ua(s.r),l=ua(s.g),h=ua(s.b),p=Lo((.4124564*r+.3575761*l+.1804375*h)/hn),x=Lo((.2126729*r+.7151522*l+.072175*h)/1);return{l:116*x-16,a:500*(p-x),b:200*(x-Lo((.0193339*r+.119192*l+.9503041*h)/ar)),alpha:s.a}}function ul(s){let r=(s.l+16)/116,l=isNaN(s.a)?r:r+s.a/500,h=isNaN(s.b)?r:r-s.b/200;return r=1*Bi(r),l=hn*Bi(l),h=ar*Bi(h),new Ao(Fl(3.2404542*l-1.5371385*r-.4985314*h),Fl(-.969266*l+1.8760108*r+.041556*h),Fl(.0556434*l-.2040259*r+1.0572252*h),s.alpha)}function bc(s,r,l){const h=r-s;return s+l*(h>180||h<-180?h-360*Math.round(h/360):h)}const Ps={forward:Ru,reverse:ul,interpolate:function(s,r,l){return{l:Ge(s.l,r.l,l),a:Ge(s.a,r.a,l),b:Ge(s.b,r.b,l),alpha:Ge(s.alpha,r.alpha,l)}}},_a={forward:function(s){const{l:r,a:l,b:h}=Ru(s),p=Math.atan2(h,l)*ca;return{h:p<0?p+360:p,c:Math.sqrt(l*l+h*h),l:r,alpha:s.a}},reverse:function(s){const r=s.h*Mo,l=s.c;return ul({l:s.l,a:Math.cos(r)*l,b:Math.sin(r)*l,alpha:s.alpha})},interpolate:function(s,r,l){return{h:bc(s.h,r.h,l),c:Ge(s.c,r.c,l),l:Ge(s.l,r.l,l),alpha:Ge(s.alpha,r.alpha,l)}}};var gu=Object.freeze({__proto__:null,hcl:_a,lab:Ps});class Qo{constructor(r,l,h,p,x){this.type=r,this.operator=l,this.interpolation=h,this.input=p,this.labels=[],this.outputs=[];for(const[w,A]of x)this.labels.push(w),this.outputs.push(A)}static interpolationFactor(r,l,h,p){let x=0;if(r.name==="exponential")x=Ws(l,r.base,h,p);else if(r.name==="linear")x=Ws(l,1,h,p);else if(r.name==="cubic-bezier"){const w=r.controlPoints;x=new pe(w[0],w[1],w[2],w[3]).solve(Ws(l,1,h,p))}return x}static parse(r,l){let[h,p,x,...w]=r;if(!Array.isArray(p)||p.length===0)return l.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const R=p[1];if(typeof R!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:R}}else{if(p[0]!=="cubic-bezier")return l.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const R=p.slice(1);if(R.length!==4||R.some(($=>typeof $!="number"||$<0||$>1)))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:R}}}if(r.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(x=l.parse(x,2,tr),!x)return null;const A=[];let P=null;h==="interpolate-hcl"||h==="interpolate-lab"?P=js:l.expectedType&&l.expectedType.kind!=="value"&&(P=l.expectedType);for(let R=0;R<w.length;R+=2){const $=w[R],X=w[R+1],re=R+3,he=R+4;if(typeof $!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',re);if(A.length&&A[A.length-1][0]>=$)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',re);const ye=l.parse(X,he,P);if(!ye)return null;P=P||ye.type,A.push([$,ye])}return P.kind==="number"||P.kind==="color"||P.kind==="array"&&P.itemType.kind==="number"&&typeof P.N=="number"?new Qo(P,h,p,x,A):l.error(`Type ${Ui(P)} is not interpolatable.`)}evaluate(r){const l=this.labels,h=this.outputs;if(l.length===1)return h[0].evaluate(r);const p=this.input.evaluate(r);if(p<=l[0])return h[0].evaluate(r);const x=l.length;if(p>=l[x-1])return h[x-1].evaluate(r);const w=L(l,p),A=Qo.interpolationFactor(this.interpolation,p,l[w],l[w+1]),P=h[w].evaluate(r),R=h[w+1].evaluate(r);return this.operator==="interpolate"?Xt[this.type.kind.toLowerCase()](P,R,A):this.operator==="interpolate-hcl"?_a.reverse(_a.interpolate(_a.forward(P),_a.forward(R),A)):Ps.reverse(Ps.interpolate(Ps.forward(P),Ps.forward(R),A))}eachChild(r){r(this.input);for(const l of this.outputs)r(l)}outputDefined(){return this.outputs.every((r=>r.outputDefined()))}serialize(){let r;r=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const l=[this.operator,r,this.input.serialize()];for(let h=0;h<this.labels.length;h++)l.push(this.labels[h],this.outputs[h].serialize());return l}}function Ws(s,r,l,h){const p=h-l,x=s-l;return p===0?0:r===1?x/p:(Math.pow(r,x)-1)/(Math.pow(r,p)-1)}var Ba=Qo;class Ol{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expectected at least one argument.");let h=null;const p=l.expectedType;p&&p.kind!=="value"&&(h=p);const x=[];for(const A of r.slice(1)){const P=l.parse(A,1+x.length,h,void 0,{typeAnnotation:"omit"});if(!P)return null;h=h||P.type,x.push(P)}const w=p&&x.some((A=>ec(p,A.type)));return new Ol(w?bi:h,x)}evaluate(r){let l,h=null,p=0;for(const x of this.args){if(p++,h=x.evaluate(r),h&&h instanceof Us&&!h.available&&(l||(l=h),h=null,p===this.args.length))return l;if(h!==null)break}return h}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every((r=>r.outputDefined()))}serialize(){const r=["coalesce"];return this.eachChild((l=>{r.push(l.serialize())})),r}}var _s=Ol;class Uo{constructor(r,l){this.type=l.type,this.bindings=[].concat(r),this.result=l}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const l of this.bindings)r(l[1]);r(this.result)}static parse(r,l){if(r.length<4)return l.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const h=[];for(let x=1;x<r.length-1;x+=2){const w=r[x];if(typeof w!="string")return l.error(`Expected string, but found ${typeof w} instead.`,x);if(/[^a-zA-Z0-9_]/.test(w))return l.error("Variable names must contain only alphanumeric characters or '_'.",x);const A=l.parse(r[x+1],x+1);if(!A)return null;h.push([w,A])}const p=l.parse(r[r.length-1],r.length-1,l.expectedType,h);return p?new Uo(h,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[l,h]of this.bindings)r.push(l,h.serialize());return r.push(this.result.serialize()),r}}var Ia=Uo;class Ks{constructor(r,l,h){this.type=r,this.index=l,this.input=h}static parse(r,l){if(r.length!==3)return l.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const h=l.parse(r[1],1,tr),p=l.parse(r[2],2,fs(l.expectedType||bi));return h&&p?new Ks(p.type.itemType,h,p):null}evaluate(r){const l=this.index.evaluate(r),h=this.input.evaluate(r);if(l<0)throw new Bo(`Array index out of bounds: ${l} < 0.`);if(l>=h.length)throw new Bo(`Array index out of bounds: ${l} > ${h.length-1}.`);if(l!==Math.floor(l))throw new Bo(`Array index must be an integer, but found ${l} instead.`);return h[l]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var yu=Ks;class wc{constructor(r,l){this.type=Nr,this.needle=r,this.haystack=l}static parse(r,l){if(r.length!==3)return l.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const h=l.parse(r[1],1,bi),p=l.parse(r[2],2,bi);return h&&p?nu(h.type,[Nr,zr,tr,Cs,bi])?new wc(h,p):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ui(h.type)} instead`):null}evaluate(r){const l=this.needle.evaluate(r),h=this.haystack.evaluate(r);if(h==null)return!1;if(!_c(l,["boolean","string","number","null"]))throw new Bo(`Expected first argument to be of type boolean, string, number or null, but found ${Ui(vo(l))} instead.`);if(!_c(h,["string","array"]))throw new Bo(`Expected second argument to be of type array or string, but found ${Ui(vo(h))} instead.`);return h.indexOf(l)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var iu=wc;class za{constructor(r,l,h){this.type=tr,this.needle=r,this.haystack=l,this.fromIndex=h}static parse(r,l){if(r.length<=2||r.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const h=l.parse(r[1],1,bi),p=l.parse(r[2],2,bi);if(!h||!p)return null;if(!nu(h.type,[Nr,zr,tr,Cs,bi]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ui(h.type)} instead`);if(r.length===4){const x=l.parse(r[3],3,tr);return x?new za(h,p,x):null}return new za(h,p)}evaluate(r){const l=this.needle.evaluate(r),h=this.haystack.evaluate(r);if(!_c(l,["boolean","string","number","null"]))throw new Bo(`Expected first argument to be of type boolean, string, number or null, but found ${Ui(vo(l))} instead.`);if(!_c(h,["string","array"]))throw new Bo(`Expected second argument to be of type array or string, but found ${Ui(vo(h))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(r);return h.indexOf(l,p)}return h.indexOf(l)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var nc=za;class _l{constructor(r,l,h,p,x,w){this.inputType=r,this.type=l,this.input=h,this.cases=p,this.outputs=x,this.otherwise=w}static parse(r,l){if(r.length<5)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return l.error("Expected an even number of arguments.");let h,p;l.expectedType&&l.expectedType.kind!=="value"&&(p=l.expectedType);const x={},w=[];for(let R=2;R<r.length-1;R+=2){let $=r[R];const X=r[R+1];Array.isArray($)||($=[$]);const re=l.concat(R);if($.length===0)return re.error("Expected at least one branch label.");for(const ye of $){if(typeof ye!="number"&&typeof ye!="string")return re.error("Branch labels must be numbers or strings.");if(typeof ye=="number"&&Math.abs(ye)>Number.MAX_SAFE_INTEGER)return re.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ye=="number"&&Math.floor(ye)!==ye)return re.error("Numeric branch labels must be integer values.");if(h){if(re.checkSubtype(h,vo(ye)))return null}else h=vo(ye);if(x[String(ye)]!==void 0)return re.error("Branch labels must be unique.");x[String(ye)]=w.length}const he=l.parse(X,R,p);if(!he)return null;p=p||he.type,w.push(he)}const A=l.parse(r[1],1,bi);if(!A)return null;const P=l.parse(r[r.length-1],r.length-1,p);return P?A.type.kind!=="value"&&l.concat(1).checkSubtype(h,A.type)?null:new _l(h,p,A,x,w,P):null}evaluate(r){const l=this.input.evaluate(r);return(vo(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every((r=>r.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),h=[],p={};for(const w of l){const A=p[this.cases[w]];A===void 0?(p[this.cases[w]]=h.length,h.push([this.cases[w],[w]])):h[A][1].push(w)}const x=w=>this.inputType.kind==="number"?Number(w):w;for(const[w,A]of h)r.push(A.length===1?x(A[0]):A.map(x)),r.push(this.outputs[w].serialize());return r.push(this.otherwise.serialize()),r}}var Bl=_l;class zl{constructor(r,l,h){this.type=r,this.branches=l,this.otherwise=h}static parse(r,l){if(r.length<4)return l.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return l.error("Expected an odd number of arguments.");let h;l.expectedType&&l.expectedType.kind!=="value"&&(h=l.expectedType);const p=[];for(let w=1;w<r.length-1;w+=2){const A=l.parse(r[w],w,Nr);if(!A)return null;const P=l.parse(r[w+1],w+1,h);if(!P)return null;p.push([A,P]),h=h||P.type}const x=l.parse(r[r.length-1],r.length-1,h);return x?new zl(h,p,x):null}evaluate(r){for(const[l,h]of this.branches)if(l.evaluate(r))return h.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[l,h]of this.branches)r(l),r(h);r(this.otherwise)}outputDefined(){return this.branches.every((([r,l])=>l.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild((l=>{r.push(l.serialize())})),r}}var vl=zl;class el{constructor(r,l,h,p){this.type=r,this.input=l,this.beginIndex=h,this.endIndex=p}static parse(r,l){if(r.length<=2||r.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const h=l.parse(r[1],1,bi),p=l.parse(r[2],2,tr);if(!h||!p)return null;if(!nu(h.type,[fs(bi),zr,bi]))return l.error(`Expected first argument to be of type array or string, but found ${Ui(h.type)} instead`);if(r.length===4){const x=l.parse(r[3],3,tr);return x?new el(h.type,h,p,x):null}return new el(h.type,h,p)}evaluate(r){const l=this.input.evaluate(r),h=this.beginIndex.evaluate(r);if(!_c(l,["string","array"]))throw new Bo(`Expected first argument to be of type array or string, but found ${Ui(vo(l))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(r);return l.slice(h,p)}return l.slice(h)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var ks=el;function No(s,r){return s==="=="||s==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function Wo(s,r,l,h){return h.compare(r,l)===0}function Vo(s,r,l){const h=s!=="=="&&s!=="!=";return class s6{constructor(x,w,A){this.type=Nr,this.lhs=x,this.rhs=w,this.collator=A,this.hasUntypedArgument=x.type.kind==="value"||w.type.kind==="value"}static parse(x,w){if(x.length!==3&&x.length!==4)return w.error("Expected two or three arguments.");const A=x[0];let P=w.parse(x[1],1,bi);if(!P)return null;if(!No(A,P.type))return w.concat(1).error(`"${A}" comparisons are not supported for type '${Ui(P.type)}'.`);let R=w.parse(x[2],2,bi);if(!R)return null;if(!No(A,R.type))return w.concat(2).error(`"${A}" comparisons are not supported for type '${Ui(R.type)}'.`);if(P.type.kind!==R.type.kind&&P.type.kind!=="value"&&R.type.kind!=="value")return w.error(`Cannot compare types '${Ui(P.type)}' and '${Ui(R.type)}'.`);h&&(P.type.kind==="value"&&R.type.kind!=="value"?P=new ya(R.type,[P]):P.type.kind!=="value"&&R.type.kind==="value"&&(R=new ya(P.type,[R])));let $=null;if(x.length===4){if(P.type.kind!=="string"&&R.type.kind!=="string"&&P.type.kind!=="value"&&R.type.kind!=="value")return w.error("Cannot use collator to compare non-string types.");if($=w.parse(x[3],3,Mi),!$)return null}return new s6(P,R,$)}evaluate(x){const w=this.lhs.evaluate(x),A=this.rhs.evaluate(x);if(h&&this.hasUntypedArgument){const P=vo(w),R=vo(A);if(P.kind!==R.kind||P.kind!=="string"&&P.kind!=="number")throw new Bo(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${P.kind}, ${R.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const P=vo(w),R=vo(A);if(P.kind!=="string"||R.kind!=="string")return r(x,w,A)}return this.collator?l(x,w,A,this.collator.evaluate(x)):r(x,w,A)}eachChild(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)}outputDefined(){return!0}serialize(){const x=[s];return this.eachChild((w=>{x.push(w.serialize())})),x}}}const vs=Vo("==",(function(s,r,l){return r===l}),Wo),Ca=Vo("!=",(function(s,r,l){return r!==l}),(function(s,r,l,h){return!Wo(0,r,l,h)})),Sc=Vo("<",(function(s,r,l){return r<l}),(function(s,r,l,h){return h.compare(r,l)<0})),zh=Vo(">",(function(s,r,l){return r>l}),(function(s,r,l,h){return h.compare(r,l)>0})),Ch=Vo("<=",(function(s,r,l){return r<=l}),(function(s,r,l,h){return h.compare(r,l)<=0})),rc=Vo(">=",(function(s,r,l){return r>=l}),(function(s,r,l,h){return h.compare(r,l)>=0}));class eh{constructor(r,l,h,p,x,w){this.type=zr,this.number=r,this.locale=l,this.currency=h,this.unit=p,this.minFractionDigits=x,this.maxFractionDigits=w}static parse(r,l){if(r.length!==3)return l.error("Expected two arguments.");const h=l.parse(r[1],1,tr);if(!h)return null;const p=r[2];if(typeof p!="object"||Array.isArray(p))return l.error("NumberFormat options argument must be an object.");let x=null;if(p.locale&&(x=l.parse(p.locale,1,zr),!x))return null;let w=null;if(p.currency&&(w=l.parse(p.currency,1,zr),!w))return null;let A=null;if(p.unit&&(A=l.parse(p.unit,1,zr),!A))return null;let P=null;if(p["min-fraction-digits"]&&(P=l.parse(p["min-fraction-digits"],1,tr),!P))return null;let R=null;return p["max-fraction-digits"]&&(R=l.parse(p["max-fraction-digits"],1,tr),!R)?null:new eh(h,x,w,A,P,R)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(r):void 0,unit:this.unit?this.unit.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.unit&&r(this.unit),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.unit&&(r.unit=this.unit.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class Ec{constructor(r){this.type=tr,this.input=r}static parse(r,l){if(r.length!==2)return l.error(`Expected 1 argument, but found ${r.length-1} instead.`);const h=l.parse(r[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${Ui(h.type)} instead.`):new Ec(h):null}evaluate(r){const l=this.input.evaluate(r);if(typeof l=="string"||Array.isArray(l))return l.length;throw new Bo(`Expected value to be of type string or array, but found ${Ui(vo(l))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild((l=>{r.push(l.serialize())})),r}}const td={"==":vs,"!=":Ca,">":zh,"<":Sc,">=":rc,"<=":Ch,array:ya,at:yu,boolean:ya,case:vl,coalesce:_s,collator:la,format:Ja,image:ll,in:iu,"index-of":nc,interpolate:Ba,"interpolate-hcl":Ba,"interpolate-lab":Ba,length:Ec,let:Ia,literal:Vs,match:Bl,number:ya,"number-format":eh,object:ya,slice:ks,step:ve,string:ya,"to-boolean":qs,"to-color":qs,"to-number":qs,"to-string":qs,var:jo,within:Yo};function jh(s,[r,l,h,p]){r=r.evaluate(s),l=l.evaluate(s),h=h.evaluate(s);const x=p?p.evaluate(s):1,w=ku(r,l,h,x);if(w)throw new Bo(w);return new Ao(r/255*x,l/255*x,h/255*x,x)}function ic(s,r){return s in r}function jc(s,r){const l=r[s];return l===void 0?null:l}function La(s){return{type:s}}aa.register(td,{error:[{kind:"error"},[zr],(s,[r])=>{throw new Bo(r.evaluate(s))}],typeof:[zr,[bi],(s,[r])=>Ui(vo(r.evaluate(s)))],"to-rgba":[fs(tr,4),[js],(s,[r])=>r.evaluate(s).toArray()],rgb:[js,[tr,tr,tr],jh],rgba:[js,[tr,tr,tr,tr],jh],has:{type:Nr,overloads:[[[zr],(s,[r])=>ic(r.evaluate(s),s.properties())],[[zr,Ta],(s,[r,l])=>ic(r.evaluate(s),l.evaluate(s))]]},get:{type:bi,overloads:[[[zr],(s,[r])=>jc(r.evaluate(s),s.properties())],[[zr,Ta],(s,[r,l])=>jc(r.evaluate(s),l.evaluate(s))]]},"feature-state":[bi,[zr],(s,[r])=>jc(r.evaluate(s),s.featureState||{})],properties:[Ta,[],s=>s.properties()],"geometry-type":[zr,[],s=>s.geometryType()],id:[bi,[],s=>s.id()],zoom:[tr,[],s=>s.globals.zoom],pitch:[tr,[],s=>s.globals.pitch||0],"distance-from-center":[tr,[],s=>s.distanceFromCenter()],"heatmap-density":[tr,[],s=>s.globals.heatmapDensity||0],"line-progress":[tr,[],s=>s.globals.lineProgress||0],"sky-radial-progress":[tr,[],s=>s.globals.skyRadialProgress||0],accumulated:[bi,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[tr,La(tr),(s,r)=>{let l=0;for(const h of r)l+=h.evaluate(s);return l}],"*":[tr,La(tr),(s,r)=>{let l=1;for(const h of r)l*=h.evaluate(s);return l}],"-":{type:tr,overloads:[[[tr,tr],(s,[r,l])=>r.evaluate(s)-l.evaluate(s)],[[tr],(s,[r])=>-r.evaluate(s)]]},"/":[tr,[tr,tr],(s,[r,l])=>r.evaluate(s)/l.evaluate(s)],"%":[tr,[tr,tr],(s,[r,l])=>r.evaluate(s)%l.evaluate(s)],ln2:[tr,[],()=>Math.LN2],pi:[tr,[],()=>Math.PI],e:[tr,[],()=>Math.E],"^":[tr,[tr,tr],(s,[r,l])=>Math.pow(r.evaluate(s),l.evaluate(s))],sqrt:[tr,[tr],(s,[r])=>Math.sqrt(r.evaluate(s))],log10:[tr,[tr],(s,[r])=>Math.log(r.evaluate(s))/Math.LN10],ln:[tr,[tr],(s,[r])=>Math.log(r.evaluate(s))],log2:[tr,[tr],(s,[r])=>Math.log(r.evaluate(s))/Math.LN2],sin:[tr,[tr],(s,[r])=>Math.sin(r.evaluate(s))],cos:[tr,[tr],(s,[r])=>Math.cos(r.evaluate(s))],tan:[tr,[tr],(s,[r])=>Math.tan(r.evaluate(s))],asin:[tr,[tr],(s,[r])=>Math.asin(r.evaluate(s))],acos:[tr,[tr],(s,[r])=>Math.acos(r.evaluate(s))],atan:[tr,[tr],(s,[r])=>Math.atan(r.evaluate(s))],min:[tr,La(tr),(s,r)=>Math.min(...r.map((l=>l.evaluate(s))))],max:[tr,La(tr),(s,r)=>Math.max(...r.map((l=>l.evaluate(s))))],abs:[tr,[tr],(s,[r])=>Math.abs(r.evaluate(s))],round:[tr,[tr],(s,[r])=>{const l=r.evaluate(s);return l<0?-Math.round(-l):Math.round(l)}],floor:[tr,[tr],(s,[r])=>Math.floor(r.evaluate(s))],ceil:[tr,[tr],(s,[r])=>Math.ceil(r.evaluate(s))],"filter-==":[Nr,[zr,bi],(s,[r,l])=>s.properties()[r.value]===l.value],"filter-id-==":[Nr,[bi],(s,[r])=>s.id()===r.value],"filter-type-==":[Nr,[zr],(s,[r])=>s.geometryType()===r.value],"filter-<":[Nr,[zr,bi],(s,[r,l])=>{const h=s.properties()[r.value],p=l.value;return typeof h==typeof p&&h<p}],"filter-id-<":[Nr,[bi],(s,[r])=>{const l=s.id(),h=r.value;return typeof l==typeof h&&l<h}],"filter->":[Nr,[zr,bi],(s,[r,l])=>{const h=s.properties()[r.value],p=l.value;return typeof h==typeof p&&h>p}],"filter-id->":[Nr,[bi],(s,[r])=>{const l=s.id(),h=r.value;return typeof l==typeof h&&l>h}],"filter-<=":[Nr,[zr,bi],(s,[r,l])=>{const h=s.properties()[r.value],p=l.value;return typeof h==typeof p&&h<=p}],"filter-id-<=":[Nr,[bi],(s,[r])=>{const l=s.id(),h=r.value;return typeof l==typeof h&&l<=h}],"filter->=":[Nr,[zr,bi],(s,[r,l])=>{const h=s.properties()[r.value],p=l.value;return typeof h==typeof p&&h>=p}],"filter-id->=":[Nr,[bi],(s,[r])=>{const l=s.id(),h=r.value;return typeof l==typeof h&&l>=h}],"filter-has":[Nr,[bi],(s,[r])=>r.value in s.properties()],"filter-has-id":[Nr,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[Nr,[fs(zr)],(s,[r])=>r.value.indexOf(s.geometryType())>=0],"filter-id-in":[Nr,[fs(bi)],(s,[r])=>r.value.indexOf(s.id())>=0],"filter-in-small":[Nr,[zr,fs(bi)],(s,[r,l])=>l.value.indexOf(s.properties()[r.value])>=0],"filter-in-large":[Nr,[zr,fs(bi)],(s,[r,l])=>(function(h,p,x,w){for(;x<=w;){const A=x+w>>1;if(p[A]===h)return!0;p[A]>h?w=A-1:x=A+1}return!1})(s.properties()[r.value],l.value,0,l.value.length-1)],all:{type:Nr,overloads:[[[Nr,Nr],(s,[r,l])=>r.evaluate(s)&&l.evaluate(s)],[La(Nr),(s,r)=>{for(const l of r)if(!l.evaluate(s))return!1;return!0}]]},any:{type:Nr,overloads:[[[Nr,Nr],(s,[r,l])=>r.evaluate(s)||l.evaluate(s)],[La(Nr),(s,r)=>{for(const l of r)if(l.evaluate(s))return!0;return!1}]]},"!":[Nr,[Nr],(s,[r])=>!r.evaluate(s)],"is-supported-script":[Nr,[zr],(s,[r])=>{const l=s.globals&&s.globals.isSupportedScript;return!l||l(r.evaluate(s))}],upcase:[zr,[zr],(s,[r])=>r.evaluate(s).toUpperCase()],downcase:[zr,[zr],(s,[r])=>r.evaluate(s).toLowerCase()],concat:[zr,La(bi),(s,r)=>r.map((l=>Dl(l.evaluate(s)))).join("")],"resolved-locale":[zr,[Mi],(s,[r])=>r.evaluate(s).resolvedLocale()]});var Uc=td;function Mu(s){return{result:"success",value:s}}function xl(s){return{result:"error",value:s}}function bl(s){return s["property-type"]==="data-driven"}function Xs(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function th(s){return!!s.expression&&s.expression.interpolated}function Jn(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function Nu(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function Ac(s){return s}function hl(s,r){const l=r.type==="color",h=s.stops&&typeof s.stops[0][0]=="object",p=h||!(h||s.property!==void 0),x=s.type||(th(r)?"exponential":"interval");if(l&&((s=Xo({},s)).stops&&(s.stops=s.stops.map((R=>[R[0],Ao.parse(R[1])]))),s.default=Ao.parse(s.default?s.default:r.default)),s.colorSpace&&s.colorSpace!=="rgb"&&!gu[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let w,A,P;if(x==="exponential")w=ha;else if(x==="interval")w=Vc;else if(x==="categorical"){w=Tc,A=Object.create(null);for(const R of s.stops)A[R[0]]=R[1];P=typeof s.stops[0][0]}else{if(x!=="identity")throw new Error(`Unknown function type "${x}"`);w=Du}if(h){const R={},$=[];for(let he=0;he<s.stops.length;he++){const ye=s.stops[he],Se=ye[0].zoom;R[Se]===void 0&&(R[Se]={zoom:Se,type:s.type,property:s.property,default:s.default,stops:[]},$.push(Se)),R[Se].stops.push([ye[0].value,ye[1]])}const X=[];for(const he of $)X.push([R[he].zoom,hl(R[he],r)]);const re={name:"linear"};return{kind:"composite",interpolationType:re,interpolationFactor:Ba.interpolationFactor.bind(void 0,re),zoomStops:X.map((he=>he[0])),evaluate:({zoom:he},ye)=>ha({stops:X,base:s.base},r,he).evaluate(he,ye)}}if(p){const R=x==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:R,interpolationFactor:Ba.interpolationFactor.bind(void 0,R),zoomStops:s.stops.map(($=>$[0])),evaluate:({zoom:$})=>w(s,r,$,A,P)}}return{kind:"source",evaluate(R,$){const X=$&&$.properties?$.properties[s.property]:void 0;return X===void 0?as(s.default,r.default):w(s,r,X,A,P)}}}function as(s,r,l){return s!==void 0?s:r!==void 0?r:l!==void 0?l:void 0}function Tc(s,r,l,h,p){return as(typeof l===p?h[l]:void 0,s.default,r.default)}function Vc(s,r,l){if(Jn(l)!=="number")return as(s.default,r.default);const h=s.stops.length;if(h===1||l<=s.stops[0][0])return s.stops[0][1];if(l>=s.stops[h-1][0])return s.stops[h-1][1];const p=L(s.stops.map((x=>x[0])),l);return s.stops[p][1]}function ha(s,r,l){const h=s.base!==void 0?s.base:1;if(Jn(l)!=="number")return as(s.default,r.default);const p=s.stops.length;if(p===1||l<=s.stops[0][0])return s.stops[0][1];if(l>=s.stops[p-1][0])return s.stops[p-1][1];const x=L(s.stops.map(($=>$[0])),l),w=(function($,X,re,he){const ye=he-re,Se=$-re;return ye===0?0:X===1?Se/ye:(Math.pow(X,Se)-1)/(Math.pow(X,ye)-1)})(l,h,s.stops[x][0],s.stops[x+1][0]),A=s.stops[x][1],P=s.stops[x+1][1];let R=Xt[r.type]||Ac;if(s.colorSpace&&s.colorSpace!=="rgb"){const $=gu[s.colorSpace];R=(X,re)=>$.reverse($.interpolate($.forward(X),$.forward(re),w))}return typeof A.evaluate=="function"?{evaluate(...$){const X=A.evaluate.apply(void 0,$),re=P.evaluate.apply(void 0,$);if(X!==void 0&&re!==void 0)return R(X,re,w)}}:R(A,P,w)}function Du(s,r,l){return r.type==="color"?l=Ao.parse(l):r.type==="formatted"?l=_o.fromString(l.toString()):r.type==="resolvedImage"?l=Us.fromString(l.toString()):Jn(l)===r.type||r.type==="enum"&&r.values[l]||(l=void 0),as(l,s.default,r.default)}class qc{constructor(r,l){this.expression=r,this._warningHistory={},this._evaluator=new Ss,this._defaultValue=l?(function(h){return h.type==="color"&&(Nu(h.default)||Array.isArray(h.default))?new Ao(0,0,0,0):h.type==="color"?Ao.parse(h.default)||null:h.default===void 0?null:h.default})(l):null,this._enumValues=l&&l.type==="enum"?l.values:null}evaluateWithoutErrorHandling(r,l,h,p,x,w,A,P){return this._evaluator.globals=r,this._evaluator.feature=l,this._evaluator.featureState=h,this._evaluator.canonical=p||null,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=w,this._evaluator.featureTileCoord=A||null,this._evaluator.featureDistanceData=P||null,this.expression.evaluate(this._evaluator)}evaluate(r,l,h,p,x,w,A,P){this._evaluator.globals=r,this._evaluator.feature=l||null,this._evaluator.featureState=h||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=w||null,this._evaluator.featureTileCoord=A||null,this._evaluator.featureDistanceData=P||null;try{const R=this.expression.evaluate(this._evaluator);if(R==null||typeof R=="number"&&R!=R)return this._defaultValue;if(this._enumValues&&!(R in this._enumValues))throw new Bo(`Expected value to be one of ${Object.keys(this._enumValues).map(($=>JSON.stringify($))).join(", ")}, but found ${JSON.stringify(R)} instead.`);return R}catch(R){return this._warningHistory[R.message]||(this._warningHistory[R.message]=!0,typeof console<"u"&&console.warn(R.message)),this._defaultValue}}}function oc(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in Uc}function qn(s,r){const l=new zc(Uc,[],r?(function(p){const x={color:js,string:zr,number:tr,enum:zr,boolean:Nr,formatted:yl,resolvedImage:Gi};return p.type==="array"?fs(x[p.value]||bi,p.length):x[p.type]})(r):void 0),h=l.parse(s,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Mu(new qc(h,r)):xl(l.errors)}class jl{constructor(r,l){this.kind=r,this._styleExpression=l,this.isStateDependent=r!=="constant"&&!zo(l.expression)}evaluateWithoutErrorHandling(r,l,h,p,x,w){return this._styleExpression.evaluateWithoutErrorHandling(r,l,h,p,x,w)}evaluate(r,l,h,p,x,w){return this._styleExpression.evaluate(r,l,h,p,x,w)}}class va{constructor(r,l,h,p){this.kind=r,this.zoomStops=h,this._styleExpression=l,this.isStateDependent=r!=="camera"&&!zo(l.expression),this.interpolationType=p}evaluateWithoutErrorHandling(r,l,h,p,x,w){return this._styleExpression.evaluateWithoutErrorHandling(r,l,h,p,x,w)}evaluate(r,l,h,p,x,w){return this._styleExpression.evaluate(r,l,h,p,x,w)}interpolationFactor(r,l,h){return this.interpolationType?Ba.interpolationFactor(this.interpolationType,r,l,h):0}}function $c(s,r){if((s=qn(s,r)).result==="error")return s;const l=s.value.expression,h=Ro(l);if(!h&&!bl(r))return xl([new Za("","data expressions not supported")]);const p=Jo(l,["zoom","pitch","distance-from-center"]);if(!p&&!Xs(r))return xl([new Za("","zoom expressions not supported")]);const x=su(l);return x||p?x instanceof Za?xl([x]):x instanceof Ba&&!th(r)?xl([new Za("",'"interpolate" expressions cannot be used with this property')]):Mu(x?new va(h?"camera":"composite",s.value,x.labels,x instanceof Ba?x.interpolation:void 0):new jl(h?"constant":"source",s.value)):xl([new Za("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ou{constructor(r,l){this._parameters=r,this._specification=l,Xo(this,hl(this._parameters,this._specification))}static deserialize(r){return new ou(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function su(s){let r=null;if(s instanceof Ia)r=su(s.result);else if(s instanceof _s){for(const l of s.args)if(r=su(l),r)break}else(s instanceof ve||s instanceof Ba)&&s.input instanceof aa&&s.input.name==="zoom"&&(r=s);return r instanceof Za||s.eachChild((l=>{const h=su(l);h instanceof Za?r=h:!r&&h?r=new Za("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&h&&r!==h&&(r=new Za("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),r}class lr{constructor(r,l,h,p){this.message=(r?`${r}: `:"")+h,p&&(this.identifier=p),l!=null&&l.__line__&&(this.line=l.__line__)}}function li(s){const r=s.key,l=s.value,h=s.valueSpec||{},p=s.objectElementValidators||{},x=s.style,w=s.styleSpec;let A=[];const P=Jn(l);if(P!=="object")return[new lr(r,l,`object expected, ${P} found`)];for(const R in l){const $=R.split(".")[0];let X;p[$]?X=p[$]:h[$]?X=Hi:p["*"]?X=p["*"]:h["*"]&&(X=Hi),X?A=A.concat(X({key:(r&&`${r}.`)+R,value:l[R],valueSpec:h[$]||h["*"],style:x,styleSpec:w,object:l,objectKey:R},l)):A.push(new lr(r,l[R],`unknown property "${R}"`))}for(const R in h)p[R]||h[R].required&&h[R].default===void 0&&l[R]===void 0&&A.push(new lr(r,l,`missing required property "${R}"`));return A}function ja(s){const r=s.value,l=s.valueSpec,h=s.style,p=s.styleSpec,x=s.key,w=s.arrayElementValidator||Hi;if(Jn(r)!=="array")return[new lr(x,r,`array expected, ${Jn(r)} found`)];if(l.length&&r.length!==l.length)return[new lr(x,r,`array length ${l.length} expected, length ${r.length} found`)];if(l["min-length"]&&r.length<l["min-length"])return[new lr(x,r,`array length at least ${l["min-length"]} expected, length ${r.length} found`)];let A={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};p.$version<7&&(A.function=l.function),Jn(l.value)==="object"&&(A=l.value);let P=[];for(let R=0;R<r.length;R++)P=P.concat(w({array:r,arrayIndex:R,value:r[R],valueSpec:A,style:h,styleSpec:p,key:`${x}[${R}]`}));return P}function es(s){const r=s.key,l=s.value,h=s.valueSpec;let p=Jn(l);if(p==="number"&&l!=l&&(p="NaN"),p!=="number")return[new lr(r,l,`number expected, ${p} found`)];if("minimum"in h){let x=h.minimum;if(Jn(h.minimum)==="array"&&(x=h.minimum[s.arrayIndex]),l<x)return[new lr(r,l,`${l} is less than the minimum value ${x}`)]}if("maximum"in h){let x=h.maximum;if(Jn(h.maximum)==="array"&&(x=h.maximum[s.arrayIndex]),l>x)return[new lr(r,l,`${l} is greater than the maximum value ${x}`)]}return[]}function Ul(s){const r=s.valueSpec,l=ss(s.value.type);let h,p,x,w={};const A=l!=="categorical"&&s.value.property===void 0,P=!A,R=Jn(s.value.stops)==="array"&&Jn(s.value.stops[0])==="array"&&Jn(s.value.stops[0][0])==="object",$=li({key:s.key,value:s.value,valueSpec:s.styleSpec.function,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(he){if(l==="identity")return[new lr(he.key,he.value,'identity function may not have a "stops" property')];let ye=[];const Se=he.value;return ye=ye.concat(ja({key:he.key,value:Se,valueSpec:he.valueSpec,style:he.style,styleSpec:he.styleSpec,arrayElementValidator:X})),Jn(Se)==="array"&&Se.length===0&&ye.push(new lr(he.key,Se,"array must have at least one stop")),ye},default:function(he){return Hi({key:he.key,value:he.value,valueSpec:r,style:he.style,styleSpec:he.styleSpec})}}});return l==="identity"&&A&&$.push(new lr(s.key,s.value,'missing required property "property"')),l==="identity"||s.value.stops||$.push(new lr(s.key,s.value,'missing required property "stops"')),l==="exponential"&&s.valueSpec.expression&&!th(s.valueSpec)&&$.push(new lr(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(P&&!bl(s.valueSpec)?$.push(new lr(s.key,s.value,"property functions not supported")):A&&!Xs(s.valueSpec)&&$.push(new lr(s.key,s.value,"zoom functions not supported"))),l!=="categorical"&&!R||s.value.property!==void 0||$.push(new lr(s.key,s.value,'"property" property is required')),$;function X(he){let ye=[];const Se=he.value,We=he.key;if(Jn(Se)!=="array")return[new lr(We,Se,`array expected, ${Jn(Se)} found`)];if(Se.length!==2)return[new lr(We,Se,`array length 2 expected, length ${Se.length} found`)];if(R){if(Jn(Se[0])!=="object")return[new lr(We,Se,`object expected, ${Jn(Se[0])} found`)];if(Se[0].zoom===void 0)return[new lr(We,Se,"object stop key must have zoom")];if(Se[0].value===void 0)return[new lr(We,Se,"object stop key must have value")];const at=ss(Se[0].zoom);if(typeof at!="number")return[new lr(We,Se[0].zoom,"stop zoom values must be numbers")];if(x&&x>at)return[new lr(We,Se[0].zoom,"stop zoom values must appear in ascending order")];at!==x&&(x=at,p=void 0,w={}),ye=ye.concat(li({key:`${We}[0]`,value:Se[0],valueSpec:{zoom:{}},style:he.style,styleSpec:he.styleSpec,objectElementValidators:{zoom:es,value:re}}))}else ye=ye.concat(re({key:`${We}[0]`,value:Se[0],style:he.style,styleSpec:he.styleSpec},Se));return oc(xi(Se[1]))?ye.concat([new lr(`${We}[1]`,Se[1],"expressions are not allowed in function stops.")]):ye.concat(Hi({key:`${We}[1]`,value:Se[1],valueSpec:r,style:he.style,styleSpec:he.styleSpec}))}function re(he,ye){const Se=Jn(he.value),We=ss(he.value),at=he.value!==null?he.value:ye;if(h){if(Se!==h)return[new lr(he.key,at,`${Se} stop domain type must match previous stop domain type ${h}`)]}else h=Se;if(Se!=="number"&&Se!=="string"&&Se!=="boolean"&&typeof We!="number"&&typeof We!="string"&&typeof We!="boolean")return[new lr(he.key,at,"stop domain value must be a number, string, or boolean")];if(Se!=="number"&&l!=="categorical"){let xt=`number expected, ${Se} found`;return bl(r)&&l===void 0&&(xt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new lr(he.key,at,xt)]}return l!=="categorical"||Se!=="number"||typeof We=="number"&&isFinite(We)&&Math.floor(We)===We?l!=="categorical"&&Se==="number"&&typeof We=="number"&&typeof p=="number"&&p!==void 0&&We<p?[new lr(he.key,at,"stop domain values must appear in ascending order")]:(p=We,l==="categorical"&&We in w?[new lr(he.key,at,"stop domain values must be unique")]:(w[We]=!0,[])):[new lr(he.key,at,`integer expected, found ${String(We)}`)]}}function Do(s){const r=(s.expressionContext==="property"?$c:qn)(xi(s.value),s.valueSpec);if(r.result==="error")return r.value.map((h=>new lr(`${s.key}${h.key}`,s.value,h.message)));const l=r.value.expression||r.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!l.outputDefined())return[new lr(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!zo(l))return[new lr(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter")return ao(l,s);if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!Jo(l,["zoom","feature-state"]))return[new lr(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!Ro(l))return[new lr(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ao(s,r){const l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const p of r.valueSpec.expression.parameters)l.delete(p);if(l.size===0)return[];const h=[];return s instanceof aa&&l.has(s.name)?[new lr(r.key,r.value,`["${s.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(s.eachChild((p=>{h.push(...ao(p,r))})),h)}function Zs(s){const r=s.key,l=s.value,h=s.valueSpec,p=[];return Array.isArray(h.values)?h.values.indexOf(ss(l))===-1&&p.push(new lr(r,l,`expected one of [${h.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(h.values).indexOf(ss(l))===-1&&p.push(new lr(r,l,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(l)} found`)),p}function Lh(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const r of s.slice(1))if(!Lh(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}function Ph(s,r="fill"){if(s==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Lh(s)||(s=Sl(s));const l=s;let h=!0;try{h=(function(R){if(!rh(R))return R;let $=xi(R);return nh($),$=ni($),$})(l)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(l,null,2)}
        `)}const p=dn[`filter_${r}`],x=qn(h,p);let w=null;if(x.result==="error")throw new Error(x.value.map((R=>`${R.key}: ${R.message}`)).join(", "));w=(R,$,X)=>x.value.evaluate(R,$,{},X);let A=null,P=null;if(h!==l){const R=qn(l,p);if(R.result==="error")throw new Error(R.value.map(($=>`${$.key}: ${$.message}`)).join(", "));A=($,X,re,he,ye)=>R.value.evaluate($,X,{},re,void 0,void 0,he,ye),P=!Ro(R.value.expression)}return{filter:w,dynamicFilter:A||void 0,needGeometry:Uh(h),needFeature:!!P}}function ni(s){if(!Array.isArray(s))return s;const r=(function(l){if(dl.has(l[0])){for(let h=1;h<l.length;h++)if(rh(l[h]))return!0}return l})(s);return r===!0?r:r.map((l=>ni(l)))}function nh(s){let r=!1;const l=[];if(s[0]==="case"){for(let h=1;h<s.length-1;h+=2)r=r||rh(s[h]),l.push(s[h+1]);l.push(s[s.length-1])}else if(s[0]==="match"){r=r||rh(s[1]);for(let h=2;h<s.length-1;h+=2)l.push(s[h+1]);l.push(s[s.length-1])}else if(s[0]==="step"){r=r||rh(s[1]);for(let h=1;h<s.length-1;h+=2)l.push(s[h+1])}r&&(s.length=0,s.push("any",...l));for(let h=1;h<s.length;h++)nh(s[h])}function rh(s){if(!Array.isArray(s))return!1;if((r=s[0])==="pitch"||r==="distance-from-center")return!0;var r;for(let l=1;l<s.length;l++)if(rh(s[l]))return!0;return!1}const dl=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function wl(s,r){return s<r?-1:s>r?1:0}function Uh(s){if(!Array.isArray(s))return!1;if(s[0]==="within")return!0;for(let r=1;r<s.length;r++)if(Uh(s[r]))return!0;return!1}function Sl(s){if(!s)return!0;const r=s[0];return s.length<=1?r!=="any":r==="=="?ih(s[1],s[2],"=="):r==="!="?Ni(ih(s[1],s[2],"==")):r==="<"||r===">"||r==="<="||r===">="?ih(s[1],s[2],r):r==="any"?(l=s.slice(1),["any"].concat(l.map(Sl))):r==="all"?["all"].concat(s.slice(1).map(Sl)):r==="none"?["all"].concat(s.slice(1).map(Sl).map(Ni)):r==="in"?El(s[1],s.slice(2)):r==="!in"?Ni(El(s[1],s.slice(2))):r==="has"?Al(s[1]):r==="!has"?Ni(Al(s[1])):r!=="within"||s;var l}function ih(s,r,l){switch(s){case"$type":return[`filter-type-${l}`,r];case"$id":return[`filter-id-${l}`,r];default:return[`filter-${l}`,s,r]}}function El(s,r){if(r.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some((l=>typeof l!=typeof r[0]))?["filter-in-large",s,["literal",r.sort(wl)]]:["filter-in-small",s,["literal",r]]}}function Al(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function Ni(s){return["!",s]}function Ua(s){return Lh(xi(s.value))?Do(Xo({},s,{expressionContext:"filter",valueSpec:s.styleSpec[`filter_${s.layerType||"fill"}`]})):Vl(s)}function Vl(s){const r=s.value,l=s.key;if(Jn(r)!=="array")return[new lr(l,r,`array expected, ${Jn(r)} found`)];const h=s.styleSpec;let p,x=[];if(r.length<1)return[new lr(l,r,"filter array must have at least 1 element")];switch(x=x.concat(Zs({key:`${l}[0]`,value:r[0],valueSpec:h.filter_operator,style:s.style,styleSpec:s.styleSpec})),ss(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&ss(r[1])==="$type"&&x.push(new lr(l,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&x.push(new lr(l,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(p=Jn(r[1]),p!=="string"&&x.push(new lr(`${l}[1]`,r[1],`string expected, ${p} found`)));for(let w=2;w<r.length;w++)p=Jn(r[w]),ss(r[1])==="$type"?x=x.concat(Zs({key:`${l}[${w}]`,value:r[w],valueSpec:h.geometry_type,style:s.style,styleSpec:s.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&x.push(new lr(`${l}[${w}]`,r[w],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let w=1;w<r.length;w++)x=x.concat(Vl({key:`${l}[${w}]`,value:r[w],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":p=Jn(r[1]),r.length!==2?x.push(new lr(l,r,`filter array for "${r[0]}" operator must have 2 elements`)):p!=="string"&&x.push(new lr(`${l}[1]`,r[1],`string expected, ${p} found`));break;case"within":p=Jn(r[1]),r.length!==2?x.push(new lr(l,r,`filter array for "${r[0]}" operator must have 2 elements`)):p!=="object"&&x.push(new lr(`${l}[1]`,r[1],`object expected, ${p} found`))}return x}function Va(s,r){const l=s.key,h=s.style,p=s.styleSpec,x=s.value,w=s.objectKey,A=p[`${r}_${s.layerType}`];if(!A)return[];const P=w.match(/^(.*)-transition$/);if(r==="paint"&&P&&A[P[1]]&&A[P[1]].transition)return Hi({key:l,value:x,valueSpec:p.transition,style:h,styleSpec:p});const R=s.valueSpec||A[w];if(!R)return[new lr(l,x,`unknown property "${w}"`)];let $;if(Jn(x)==="string"&&bl(R)&&!R.tokens&&($=/^{([^}]+)}$/.exec(x))){const re=`\`{ "type": "identity", "property": ${$?JSON.stringify($[1]):'"_"'} }\``;return[new lr(l,x,`"${w}" does not support interpolation syntax
Use an identity property function instead: ${re}.`)]}const X=[];return s.layerType==="symbol"&&(w==="text-field"&&h&&!h.glyphs&&X.push(new lr(l,x,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&Nu(xi(x))&&ss(x.type)==="identity"&&X.push(new lr(l,x,'"text-font" does not support identity functions'))),X.concat(Hi({key:s.key,value:x,valueSpec:R,style:h,styleSpec:p,expressionContext:"property",propertyType:r,propertyKey:w}))}function lo(s){return Va(s,"paint")}function vd(s){return Va(s,"layout")}function nd(s){let r=[];const l=s.value,h=s.key,p=s.style,x=s.styleSpec;l.type||l.ref||r.push(new lr(h,l,'either "type" or "ref" is required'));let w=ss(l.type);const A=ss(l.ref);if(l.id){const P=ss(l.id);for(let R=0;R<s.arrayIndex;R++){const $=p.layers[R];ss($.id)===P&&r.push(new lr(h,l.id,`duplicate layer id "${l.id}", previously used at line ${$.id.__line__}`))}}if("ref"in l){let P;["type","source","source-layer","filter","layout"].forEach((R=>{R in l&&r.push(new lr(h,l[R],`"${R}" is prohibited for ref layers`))})),p.layers.forEach((R=>{ss(R.id)===A&&(P=R)})),P?P.ref?r.push(new lr(h,l.ref,"ref cannot reference another ref layer")):w=ss(P.type):typeof A=="string"&&r.push(new lr(h,l.ref,`ref layer "${A}" not found`))}else if(w!=="background"&&w!=="sky")if(l.source){const P=p.sources&&p.sources[l.source],R=P&&ss(P.type);P?R==="vector"&&w==="raster"?r.push(new lr(h,l.source,`layer "${l.id}" requires a raster source`)):R==="raster"&&w!=="raster"?r.push(new lr(h,l.source,`layer "${l.id}" requires a vector source`)):R!=="vector"||l["source-layer"]?R==="raster-dem"&&w!=="hillshade"?r.push(new lr(h,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):w!=="line"||!l.paint||!l.paint["line-gradient"]&&!l.paint["line-trim-offset"]||R==="geojson"&&P.lineMetrics||r.push(new lr(h,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new lr(h,l,`layer "${l.id}" must specify a "source-layer"`)):r.push(new lr(h,l.source,`source "${l.source}" not found`))}else r.push(new lr(h,l,'missing required property "source"'));return r=r.concat(li({key:h,value:l,valueSpec:x.layer,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Hi({key:`${h}.type`,value:l.type,valueSpec:x.layer.type,style:s.style,styleSpec:s.styleSpec,object:l,objectKey:"type"}),filter:P=>Ua(Xo({layerType:w},P)),layout:P=>li({layer:l,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":R=>vd(Xo({layerType:w},R))}}),paint:P=>li({layer:l,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":R=>lo(Xo({layerType:w},R))}})}})),r}function ql(s){const r=s.value,l=s.key,h=Jn(r);return h!=="string"?[new lr(l,r,`string expected, ${h} found`)]:[]}const _u={promoteId:function({key:s,value:r}){if(Jn(r)==="string")return ql({key:s,value:r});{const l=[];for(const h in r)l.push(...ql({key:`${s}.${h}`,value:r[h]}));return l}}};function xa(s){const r=s.value,l=s.key,h=s.styleSpec,p=s.style;if(!r.type)return[new lr(l,r,'"type" is required')];const x=ss(r.type);let w;switch(x){case"vector":case"raster":case"raster-dem":return w=li({key:l,value:r,valueSpec:h[`source_${x.replace("-","_")}`],style:s.style,styleSpec:h,objectElementValidators:_u}),w;case"geojson":if(w=li({key:l,value:r,valueSpec:h.source_geojson,style:p,styleSpec:h,objectElementValidators:_u}),r.cluster)for(const A in r.clusterProperties){const[P,R]=r.clusterProperties[A],$=typeof P=="string"?[P,["accumulated"],["get",A]]:P;w.push(...Do({key:`${l}.${A}.map`,value:R,expressionContext:"cluster-map"})),w.push(...Do({key:`${l}.${A}.reduce`,value:$,expressionContext:"cluster-reduce"}))}return w;case"video":return li({key:l,value:r,valueSpec:h.source_video,style:p,styleSpec:h});case"image":return li({key:l,value:r,valueSpec:h.source_image,style:p,styleSpec:h});case"canvas":return[new lr(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Zs({key:`${l}.type`,value:r.type,valueSpec:{values:vu(h)}})}}function vu(s){return s.source.reduce(((r,l)=>{const h=s[l];return h.type.type==="enum"&&(r=r.concat(Object.keys(h.type.values))),r}),[])}function xd(s){const r=s.value,l=s.styleSpec,h=l.light,p=s.style;let x=[];const w=Jn(r);if(r===void 0)return x;if(w!=="object")return x=x.concat([new lr("light",r,`object expected, ${w} found`)]),x;for(const A in r){const P=A.match(/^(.*)-transition$/);x=x.concat(P&&h[P[1]]&&h[P[1]].transition?Hi({key:A,value:r[A],valueSpec:l.transition,style:p,styleSpec:l}):h[A]?Hi({key:A,value:r[A],valueSpec:h[A],style:p,styleSpec:l}):[new lr(A,r[A],`unknown property "${A}"`)])}return x}function sc(s){const r=s.value,l=s.key,h=s.style,p=s.styleSpec,x=p.terrain;let w=[];const A=Jn(r);if(r===void 0)return w;if(A!=="object")return w=w.concat([new lr("terrain",r,`object expected, ${A} found`)]),w;for(const P in r){const R=P.match(/^(.*)-transition$/);w=w.concat(R&&x[R[1]]&&x[R[1]].transition?Hi({key:P,value:r[P],valueSpec:p.transition,style:h,styleSpec:p}):x[P]?Hi({key:P,value:r[P],valueSpec:x[P],style:h,styleSpec:p}):[new lr(P,r[P],`unknown property "${P}"`)])}if(r.source){const P=h.sources&&h.sources[r.source],R=P&&ss(P.type);P?R!=="raster-dem"&&w.push(new lr(l,r.source,`terrain cannot be used with a source of type ${String(R)}, it only be used with a "raster-dem" source type`)):w.push(new lr(l,r.source,`source "${r.source}" not found`))}else w.push(new lr(l,r,'terrain is missing required property "source"'));return w}function Pa(s){const r=s.value,l=s.style,h=s.styleSpec,p=h.fog;let x=[];const w=Jn(r);if(r===void 0)return x;if(w!=="object")return x=x.concat([new lr("fog",r,`object expected, ${w} found`)]),x;for(const A in r){const P=A.match(/^(.*)-transition$/);x=x.concat(P&&p[P[1]]&&p[P[1]].transition?Hi({key:A,value:r[A],valueSpec:h.transition,style:l,styleSpec:h}):p[A]?Hi({key:A,value:r[A],valueSpec:p[A],style:l,styleSpec:h}):[new lr(A,r[A],`unknown property "${A}"`)])}return x}const qo={"*":()=>[],array:ja,boolean:function(s){const r=s.value,l=s.key,h=Jn(r);return h!=="boolean"?[new lr(l,r,`boolean expected, ${h} found`)]:[]},number:es,color:function(s){const r=s.key,l=s.value,h=Jn(l);return h!=="string"?[new lr(r,l,`color expected, ${h} found`)]:tc(l)===null?[new lr(r,l,`color expected, "${l}" found`)]:[]},enum:Zs,filter:Ua,function:Ul,layer:nd,object:li,source:xa,light:xd,terrain:sc,fog:Pa,string:ql,formatted:function(s){return ql(s).length===0?[]:Do(s)},resolvedImage:function(s){return ql(s).length===0?[]:Do(s)},projection:function(s){const r=s.value,l=s.styleSpec,h=l.projection,p=s.style;let x=[];const w=Jn(r);if(w==="object")for(const A in r)x=x.concat(Hi({key:A,value:r[A],valueSpec:h[A],style:p,styleSpec:l}));else w!=="string"&&(x=x.concat([new lr("projection",r,`object or string expected, ${w} found`)]));return x}};function Hi(s){const r=s.value,l=s.valueSpec,h=s.styleSpec;return l.expression&&Nu(ss(r))?Ul(s):l.expression&&oc(xi(r))?Do(s):l.type&&qo[l.type]?qo[l.type](s):li(Xo({},s,{valueSpec:l.type?h[l.type]:l}))}function xu(s){const r=s.value,l=s.key,h=ql(s);return h.length||(r.indexOf("{fontstack}")===-1&&h.push(new lr(l,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&h.push(new lr(l,r,'"glyphs" url must include a "{range}" token'))),h}function Rs(s,r=dn){return tl(Hi({key:"",value:s,valueSpec:r.$root,styleSpec:r,style:s,objectElementValidators:{glyphs:xu,"*":()=>[]}}))}const ac=s=>tl(lo(s)),oh=s=>tl(vd(s));function tl(s){return s.slice().sort(((r,l)=>r.line&&l.line?r.line-l.line:0))}function nl(s,r){let l=!1;if(r&&r.length)for(const h of r)s.fire(new Aa(new Error(h.message))),l=!0;return l}var Fu=lc,Ic=3;function lc(s,r,l){var h=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var p=new Int32Array(this.arrayBuffer);s=p[0],this.d=(r=p[1])+2*(l=p[2]);for(var x=0;x<this.d*this.d;x++){var w=p[Ic+x],A=p[Ic+x+1];h.push(w===A?null:p.subarray(w,A))}var P=p[Ic+h.length+1];this.keys=p.subarray(p[Ic+h.length],P),this.bboxes=p.subarray(P),this.insert=this._insertReadonly}else{this.d=r+2*l;for(var R=0;R<this.d*this.d;R++)h.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=s,this.padding=l,this.scale=r/s,this.uid=0;var $=l/r*s;this.min=-$,this.max=s+$}lc.prototype.insert=function(s,r,l,h,p){this._forEachCell(r,l,h,p,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(r),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(p)},lc.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},lc.prototype._insertCell=function(s,r,l,h,p,x){this.cells[p].push(x)},lc.prototype.query=function(s,r,l,h,p){var x=this.min,w=this.max;if(s<=x&&r<=x&&w<=l&&w<=h&&!p)return Array.prototype.slice.call(this.keys);var A=[];return this._forEachCell(s,r,l,h,this._queryCell,A,{},p),A},lc.prototype._queryCell=function(s,r,l,h,p,x,w,A){var P=this.cells[p];if(P!==null)for(var R=this.keys,$=this.bboxes,X=0;X<P.length;X++){var re=P[X];if(w[re]===void 0){var he=4*re;(A?A($[he+0],$[he+1],$[he+2],$[he+3]):s<=$[he+2]&&r<=$[he+3]&&l>=$[he+0]&&h>=$[he+1])?(w[re]=!0,x.push(R[re])):w[re]=!1}}},lc.prototype._forEachCell=function(s,r,l,h,p,x,w,A){for(var P=this._convertToCellCoord(s),R=this._convertToCellCoord(r),$=this._convertToCellCoord(l),X=this._convertToCellCoord(h),re=P;re<=$;re++)for(var he=R;he<=X;he++){var ye=this.d*he+re;if((!A||A(this._convertFromCellCoord(re),this._convertFromCellCoord(he),this._convertFromCellCoord(re+1),this._convertFromCellCoord(he+1)))&&p.call(this,s,r,l,h,ye,x,w,A))return}},lc.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},lc.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},lc.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,r=Ic+this.cells.length+1+1,l=0,h=0;h<this.cells.length;h++)l+=this.cells[h].length;var p=new Int32Array(r+l+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var x=r,w=0;w<s.length;w++){var A=s[w];p[Ic+w]=x,p.set(A,x),x+=A.length}return p[Ic+s.length]=x,p.set(this.keys,x),p[Ic+s.length+1]=x+=this.keys.length,p.set(this.bboxes,x),x+=this.bboxes.length,p.buffer};var Tl=ue(Fu);const sh={};function hr(s,r,l={}){Object.defineProperty(s,"_classRegistryKey",{value:r,writeable:!1}),sh[r]={klass:s,omit:l.omit||[]}}hr(Object,"Object"),Tl.serialize=function(s,r){const l=s.toArrayBuffer();return r&&r.push(l),{buffer:l}},Tl.deserialize=function(s){return new Tl(s.buffer)},Object.defineProperty(Tl,"name",{value:"Grid"}),hr(Tl,"Grid"),hr(Ao,"Color"),hr(Error,"Error"),hr(oi,"AJAXError"),hr(Us,"ResolvedImage"),hr(ou,"StylePropertyFunction"),hr(qc,"StyleExpression",{omit:["_evaluator"]}),hr(va,"ZoomDependentExpression"),hr(jl,"ZoomConstantExpression"),hr(aa,"CompoundExpression",{omit:["_evaluate"]});for(const s in Uc)sh[Uc[s]._classRegistryKey]||hr(Uc[s],`Expression${s}`);function ah(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function C(s){return b.ImageBitmap&&s instanceof b.ImageBitmap}function B(s,r){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(ah(s)||C(s))return r&&r.push(s),s;if(ArrayBuffer.isView(s)){const l=s;return r&&r.push(l.buffer),l}if(s instanceof b.ImageData)return r&&r.push(s.data.buffer),s;if(Array.isArray(s)){const l=[];for(const h of s)l.push(B(h,r));return l}if(typeof s=="object"){const l=s.constructor,h=l._classRegistryKey;if(!h)throw new Error(`can't serialize object of unregistered class ${h}`);const p=l.serialize?l.serialize(s,r):{};if(!l.serialize){for(const x in s)s.hasOwnProperty(x)&&(sh[h].omit.indexOf(x)>=0||(p[x]=B(s[x],r)));s instanceof Error&&(p.message=s.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return h!=="Object"&&(p.$name=h),p}throw new Error("can't serialize object of type "+typeof s)}function Q(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||ah(s)||C(s)||ArrayBuffer.isView(s)||s instanceof b.ImageData)return s;if(Array.isArray(s))return s.map(Q);if(typeof s=="object"){const r=s.$name||"Object",{klass:l}=sh[r];if(!l)throw new Error(`can't deserialize unregistered class ${r}`);if(l.deserialize)return l.deserialize(s);const h=Object.create(l.prototype);for(const p of Object.keys(s))p!=="$name"&&(h[p]=Q(s[p]));return h}throw new Error("can't deserialize object of type "+typeof s)}const oe={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function Pe(s){for(const r of s)if(Je(r.charCodeAt(0)))return!0;return!1}function qe(s){for(const r of s)if(!He(r.charCodeAt(0)))return!1;return!0}function He(s){return!(oe.Arabic(s)||oe["Arabic Supplement"](s)||oe["Arabic Extended-A"](s)||oe["Arabic Presentation Forms-A"](s)||oe["Arabic Presentation Forms-B"](s))}function Je(s){return!(s!==746&&s!==747&&(s<4352||!(oe["Bopomofo Extended"](s)||oe.Bopomofo(s)||oe["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||oe["CJK Compatibility Ideographs"](s)||oe["CJK Compatibility"](s)||oe["CJK Radicals Supplement"](s)||oe["CJK Strokes"](s)||!(!oe["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||oe["CJK Unified Ideographs Extension A"](s)||oe["CJK Unified Ideographs"](s)||oe["Enclosed CJK Letters and Months"](s)||oe["Hangul Compatibility Jamo"](s)||oe["Hangul Jamo Extended-A"](s)||oe["Hangul Jamo Extended-B"](s)||oe["Hangul Jamo"](s)||oe["Hangul Syllables"](s)||oe.Hiragana(s)||oe["Ideographic Description Characters"](s)||oe.Kanbun(s)||oe["Kangxi Radicals"](s)||oe["Katakana Phonetic Extensions"](s)||oe.Katakana(s)&&s!==12540||!(!oe["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!oe["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||oe["Unified Canadian Aboriginal Syllabics"](s)||oe["Unified Canadian Aboriginal Syllabics Extended"](s)||oe["Vertical Forms"](s)||oe["Yijing Hexagram Symbols"](s)||oe["Yi Syllables"](s)||oe["Yi Radicals"](s))))}function et(s){return!(Je(s)||(function(r){return!!(oe["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||oe["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||oe["Letterlike Symbols"](r)||oe["Number Forms"](r)||oe["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||oe["Control Pictures"](r)&&r!==9251||oe["Optical Character Recognition"](r)||oe["Enclosed Alphanumerics"](r)||oe["Geometric Shapes"](r)||oe["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||oe["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||oe["CJK Symbols and Punctuation"](r)||oe.Katakana(r)||oe["Private Use Area"](r)||oe["CJK Compatibility Forms"](r)||oe["Small Form Variants"](r)||oe["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)})(s))}function dt(s){return s>=1424&&s<=2303||oe["Arabic Presentation Forms-A"](s)||oe["Arabic Presentation Forms-B"](s)}function Nt(s,r){return!(!r&&dt(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||oe.Khmer(s))}function tn(s){for(const r of s)if(dt(r.charCodeAt(0)))return!0;return!1}const ct="deferred",Ft="loading",Qt="loaded";let En=null,y="unavailable",a=null;const f=function(s){s&&typeof s=="string"&&s.indexOf("NetworkError")>-1&&(y="error"),En&&En(s)};function v(){S.fire(new Ql("pluginStateChange",{pluginStatus:y,pluginURL:a}))}const S=new sa,T=function(){return y},N=function(){if(y!==ct||!a)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");y=Ft,v(),a&&di({url:a},(s=>{s?f(s):(y=Qt,v())}))},z={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>y===Qt||z.applyArabicShaping!=null,isLoading:()=>y===Ft,setState(s){y=s.pluginStatus,a=s.pluginURL},isParsed:()=>z.applyArabicShaping!=null&&z.processBidirectionalText!=null&&z.processStyledBidirectionalText!=null,getPluginURL:()=>a};class G{constructor(r,l){this.zoom=r,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.transition=l.transition,this.pitch=l.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(r){return(function(l,h){for(const p of l)if(!Nt(p.charCodeAt(0),h))return!1;return!0})(r,z.isLoaded())}}class ee{constructor(r,l){this.property=r,this.value=l,this.expression=(function(h,p){if(Nu(h))return new ou(h,p);if(oc(h)){const x=$c(h,p);if(x.result==="error")throw new Error(x.value.map((w=>`${w.key}: ${w.message}`)).join(", "));return x.value}{let x=h;return typeof h=="string"&&p.type==="color"&&(x=Ao.parse(h)),{kind:"constant",evaluate:()=>x}}})(l===void 0?r.specification.default:l,r.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(r,l,h){return this.property.possiblyEvaluate(this,r,l,h)}}class te{constructor(r){this.property=r,this.value=new ee(r,void 0)}transitioned(r,l){return new Ae(this.property,this.value,l,Be({},r.transition,this.transition),r.now)}untransitioned(){return new Ae(this.property,this.value,null,{},0)}}class ge{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return Gt(this._values[r].value.value)}setValue(r,l){this._values.hasOwnProperty(r)||(this._values[r]=new te(this._values[r].property)),this._values[r].value=new ee(this._values[r].property,l===null?void 0:Gt(l))}getTransition(r){return Gt(this._values[r].transition)}setTransition(r,l){this._values.hasOwnProperty(r)||(this._values[r]=new te(this._values[r].property)),this._values[r].transition=Gt(l)||void 0}serialize(){const r={};for(const l of Object.keys(this._values)){const h=this.getValue(l);h!==void 0&&(r[l]=h);const p=this.getTransition(l);p!==void 0&&(r[`${l}-transition`]=p)}return r}transitioned(r,l){const h=new Le(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].transitioned(r,l._values[p]);return h}untransitioned(){const r=new Le(this._properties);for(const l of Object.keys(this._values))r._values[l]=this._values[l].untransitioned();return r}}class Ae{constructor(r,l,h,p,x){const w=p.delay||0,A=p.duration||0;x=x||0,this.property=r,this.value=l,this.begin=x+w,this.end=this.begin+A,r.specification.transition&&(p.delay||p.duration)&&(this.prior=h)}possiblyEvaluate(r,l,h){const p=r.now||0,x=this.value.possiblyEvaluate(r,l,h),w=this.prior;if(w){if(p>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(p<this.begin)return w.possiblyEvaluate(r,l,h);{const A=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(w.possiblyEvaluate(r,l,h),x,Oe(A))}}return x}}class Le{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,l,h){const p=new Ze(this._properties);for(const x of Object.keys(this._values))p._values[x]=this._values[x].possiblyEvaluate(r,l,h);return p}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class Xe{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}getValue(r){return Gt(this._values[r].value)}setValue(r,l){this._values[r]=new ee(this._values[r].property,l===null?void 0:Gt(l))}serialize(){const r={};for(const l of Object.keys(this._values)){const h=this.getValue(l);h!==void 0&&(r[l]=h)}return r}possiblyEvaluate(r,l,h){const p=new Ze(this._properties);for(const x of Object.keys(this._values))p._values[x]=this._values[x].possiblyEvaluate(r,l,h);return p}}class Ue{constructor(r,l,h){this.property=r,this.value=l,this.parameters=h}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,l,h,p){return this.property.evaluate(this.value,this.parameters,r,l,h,p)}}class Ze{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class _e{constructor(r){this.specification=r}possiblyEvaluate(r,l){return r.expression.evaluate(l)}interpolate(r,l,h){const p=Xt[this.specification.type];return p?p(r,l,h):r}}class $e{constructor(r,l){this.specification=r,this.overrides=l}possiblyEvaluate(r,l,h,p){return new Ue(this,r.expression.kind==="constant"||r.expression.kind==="camera"?{kind:"constant",value:r.expression.evaluate(l,null,{},h,p)}:r.expression,l)}interpolate(r,l,h){if(r.value.kind!=="constant"||l.value.kind!=="constant")return r;if(r.value.value===void 0||l.value.value===void 0)return new Ue(this,{kind:"constant",value:void 0},r.parameters);const p=Xt[this.specification.type];return p?new Ue(this,{kind:"constant",value:p(r.value.value,l.value.value,h)},r.parameters):r}evaluate(r,l,h,p,x,w){return r.kind==="constant"?r.value:r.evaluate(l,h,p,x,w)}}class it{constructor(r){this.specification=r}possiblyEvaluate(r,l,h,p){return!!r.expression.evaluate(l,null,{},h,p)}interpolate(){return!1}}class ot{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const l=new G(0,{});for(const h in r){const p=r[h];p.specification.overridable&&this.overridableProperties.push(h);const x=this.defaultPropertyValues[h]=new ee(p,void 0),w=this.defaultTransitionablePropertyValues[h]=new te(p);this.defaultTransitioningPropertyValues[h]=w.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=x.possiblyEvaluate(l)}}}function bt(s,r){return 256*(s=Fe(Math.floor(s),0,255))+Fe(Math.floor(r),0,255)}hr($e,"DataDrivenProperty"),hr(_e,"DataConstantProperty"),hr(it,"ColorRampProperty");const wt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class vt{constructor(r,l){this._structArray=r,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Rt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,l){return r._trim(),l&&(r.isTransferred=!0,l.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const l=Object.create(this.prototype);return l.arrayBuffer=r.arrayBuffer,l.length=r.length,l.capacity=r.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Lt(s,r=1){let l=0,h=0;return{members:s.map((p=>{const x=wt[p.type].BYTES_PER_ELEMENT,w=l=zt(l,Math.max(r,x)),A=p.components||1;return h=Math.max(h,x),l+=x*A,{name:p.name,type:p.type,components:A,offset:w}})),size:zt(l,Math.max(h,r)),alignment:r}}function zt(s,r){return Math.ceil(s/r)*r}class mn extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l){const h=this.length;return this.resize(h+1),this.emplace(h,r,l)}emplace(r,l,h){const p=2*r;return this.int16[p+0]=l,this.int16[p+1]=h,r}}mn.prototype.bytesPerElement=4,hr(mn,"StructArrayLayout2i4");class Ut extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,r,l,h)}emplace(r,l,h,p){const x=3*r;return this.int16[x+0]=l,this.int16[x+1]=h,this.int16[x+2]=p,r}}Ut.prototype.bytesPerElement=6,hr(Ut,"StructArrayLayout3i6");class an extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,h,p){const x=this.length;return this.resize(x+1),this.emplace(x,r,l,h,p)}emplace(r,l,h,p,x){const w=4*r;return this.int16[w+0]=l,this.int16[w+1]=h,this.int16[w+2]=p,this.int16[w+3]=x,r}}an.prototype.bytesPerElement=8,hr(an,"StructArrayLayout4i8");class Ht extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x,w,A){const P=this.length;return this.resize(P+1),this.emplace(P,r,l,h,p,x,w,A)}emplace(r,l,h,p,x,w,A,P){const R=6*r,$=12*r,X=3*r;return this.int16[R+0]=l,this.int16[R+1]=h,this.uint8[$+4]=p,this.uint8[$+5]=x,this.uint8[$+6]=w,this.uint8[$+7]=A,this.float32[X+2]=P,r}}Ht.prototype.bytesPerElement=12,hr(Ht,"StructArrayLayout2i4ub1f12");class Cn extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,p){const x=this.length;return this.resize(x+1),this.emplace(x,r,l,h,p)}emplace(r,l,h,p,x){const w=4*r;return this.float32[w+0]=l,this.float32[w+1]=h,this.float32[w+2]=p,this.float32[w+3]=x,r}}Cn.prototype.bytesPerElement=16,hr(Cn,"StructArrayLayout4f16");class jt extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x){const w=this.length;return this.resize(w+1),this.emplace(w,r,l,h,p,x)}emplace(r,l,h,p,x,w){const A=6*r,P=3*r;return this.uint16[A+0]=l,this.uint16[A+1]=h,this.uint16[A+2]=p,this.uint16[A+3]=x,this.float32[P+2]=w,r}}jt.prototype.bytesPerElement=12,hr(jt,"StructArrayLayout4ui1f12");class on extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,h,p){const x=this.length;return this.resize(x+1),this.emplace(x,r,l,h,p)}emplace(r,l,h,p,x){const w=4*r;return this.uint16[w+0]=l,this.uint16[w+1]=h,this.uint16[w+2]=p,this.uint16[w+3]=x,r}}on.prototype.bytesPerElement=8,hr(on,"StructArrayLayout4ui8");class In extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x,w){const A=this.length;return this.resize(A+1),this.emplace(A,r,l,h,p,x,w)}emplace(r,l,h,p,x,w,A){const P=6*r;return this.int16[P+0]=l,this.int16[P+1]=h,this.int16[P+2]=p,this.int16[P+3]=x,this.int16[P+4]=w,this.int16[P+5]=A,r}}In.prototype.bytesPerElement=12,hr(In,"StructArrayLayout6i12");class xn extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x,w,A,P,R,$,X,re){const he=this.length;return this.resize(he+1),this.emplace(he,r,l,h,p,x,w,A,P,R,$,X,re)}emplace(r,l,h,p,x,w,A,P,R,$,X,re,he){const ye=12*r;return this.int16[ye+0]=l,this.int16[ye+1]=h,this.int16[ye+2]=p,this.int16[ye+3]=x,this.uint16[ye+4]=w,this.uint16[ye+5]=A,this.uint16[ye+6]=P,this.uint16[ye+7]=R,this.int16[ye+8]=$,this.int16[ye+9]=X,this.int16[ye+10]=re,this.int16[ye+11]=he,r}}xn.prototype.bytesPerElement=24,hr(xn,"StructArrayLayout4i4ui4i24");class bn extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x,w){const A=this.length;return this.resize(A+1),this.emplace(A,r,l,h,p,x,w)}emplace(r,l,h,p,x,w,A){const P=10*r,R=5*r;return this.int16[P+0]=l,this.int16[P+1]=h,this.int16[P+2]=p,this.float32[R+2]=x,this.float32[R+3]=w,this.float32[R+4]=A,r}}bn.prototype.bytesPerElement=20,hr(bn,"StructArrayLayout3i3f20");class pr extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.uint32[1*r+0]=l,r}}pr.prototype.bytesPerElement=4,hr(pr,"StructArrayLayout1ul4");class Fr extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x,w,A,P,R,$,X,re,he){const ye=this.length;return this.resize(ye+1),this.emplace(ye,r,l,h,p,x,w,A,P,R,$,X,re,he)}emplace(r,l,h,p,x,w,A,P,R,$,X,re,he,ye){const Se=20*r,We=10*r;return this.int16[Se+0]=l,this.int16[Se+1]=h,this.int16[Se+2]=p,this.int16[Se+3]=x,this.int16[Se+4]=w,this.float32[We+3]=A,this.float32[We+4]=P,this.float32[We+5]=R,this.float32[We+6]=$,this.int16[Se+14]=X,this.uint32[We+8]=re,this.uint16[Se+18]=he,this.uint16[Se+19]=ye,r}}Fr.prototype.bytesPerElement=40,hr(Fr,"StructArrayLayout5i4f1i1ul2ui40");class sr extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x,w,A){const P=this.length;return this.resize(P+1),this.emplace(P,r,l,h,p,x,w,A)}emplace(r,l,h,p,x,w,A,P){const R=8*r;return this.int16[R+0]=l,this.int16[R+1]=h,this.int16[R+2]=p,this.int16[R+4]=x,this.int16[R+5]=w,this.int16[R+6]=A,this.int16[R+7]=P,r}}sr.prototype.bytesPerElement=16,hr(sr,"StructArrayLayout3i2i2i16");class fr extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x){const w=this.length;return this.resize(w+1),this.emplace(w,r,l,h,p,x)}emplace(r,l,h,p,x,w){const A=4*r,P=8*r;return this.float32[A+0]=l,this.float32[A+1]=h,this.float32[A+2]=p,this.int16[P+6]=x,this.int16[P+7]=w,r}}fr.prototype.bytesPerElement=16,hr(fr,"StructArrayLayout2f1f2i16");class $r extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,p){const x=this.length;return this.resize(x+1),this.emplace(x,r,l,h,p)}emplace(r,l,h,p,x){const w=12*r,A=3*r;return this.uint8[w+0]=l,this.uint8[w+1]=h,this.float32[A+1]=p,this.float32[A+2]=x,r}}$r.prototype.bytesPerElement=12,hr($r,"StructArrayLayout2ub2f12");class gi extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,r,l,h)}emplace(r,l,h,p){const x=3*r;return this.float32[x+0]=l,this.float32[x+1]=h,this.float32[x+2]=p,r}}gi.prototype.bytesPerElement=12,hr(gi,"StructArrayLayout3f12");class Sr extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,r,l,h)}emplace(r,l,h,p){const x=3*r;return this.uint16[x+0]=l,this.uint16[x+1]=h,this.uint16[x+2]=p,r}}Sr.prototype.bytesPerElement=6,hr(Sr,"StructArrayLayout3ui6");class ki extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x,w,A,P,R,$,X,re,he,ye,Se,We,at,xt,lt,_t,It){const Tt=this.length;return this.resize(Tt+1),this.emplace(Tt,r,l,h,p,x,w,A,P,R,$,X,re,he,ye,Se,We,at,xt,lt,_t,It)}emplace(r,l,h,p,x,w,A,P,R,$,X,re,he,ye,Se,We,at,xt,lt,_t,It,Tt){const sn=30*r,nn=15*r,Sn=60*r;return this.int16[sn+0]=l,this.int16[sn+1]=h,this.int16[sn+2]=p,this.float32[nn+2]=x,this.float32[nn+3]=w,this.uint16[sn+8]=A,this.uint16[sn+9]=P,this.uint32[nn+5]=R,this.uint32[nn+6]=$,this.uint32[nn+7]=X,this.uint16[sn+16]=re,this.uint16[sn+17]=he,this.uint16[sn+18]=ye,this.float32[nn+10]=Se,this.float32[nn+11]=We,this.uint8[Sn+48]=at,this.uint8[Sn+49]=xt,this.uint8[Sn+50]=lt,this.uint32[nn+13]=_t,this.int16[sn+28]=It,this.uint8[Sn+58]=Tt,r}}ki.prototype.bytesPerElement=60,hr(ki,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ci extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x,w,A,P,R,$,X,re,he,ye,Se,We,at,xt,lt,_t,It,Tt,sn,nn,Sn,Vn,un,kn,Rn,zn){const Kn=this.length;return this.resize(Kn+1),this.emplace(Kn,r,l,h,p,x,w,A,P,R,$,X,re,he,ye,Se,We,at,xt,lt,_t,It,Tt,sn,nn,Sn,Vn,un,kn,Rn,zn)}emplace(r,l,h,p,x,w,A,P,R,$,X,re,he,ye,Se,We,at,xt,lt,_t,It,Tt,sn,nn,Sn,Vn,un,kn,Rn,zn,Kn){const wn=38*r,_r=19*r;return this.int16[wn+0]=l,this.int16[wn+1]=h,this.int16[wn+2]=p,this.float32[_r+2]=x,this.float32[_r+3]=w,this.int16[wn+8]=A,this.int16[wn+9]=P,this.int16[wn+10]=R,this.int16[wn+11]=$,this.int16[wn+12]=X,this.int16[wn+13]=re,this.uint16[wn+14]=he,this.uint16[wn+15]=ye,this.uint16[wn+16]=Se,this.uint16[wn+17]=We,this.uint16[wn+18]=at,this.uint16[wn+19]=xt,this.uint16[wn+20]=lt,this.uint16[wn+21]=_t,this.uint16[wn+22]=It,this.uint16[wn+23]=Tt,this.uint16[wn+24]=sn,this.uint16[wn+25]=nn,this.uint16[wn+26]=Sn,this.uint16[wn+27]=Vn,this.uint16[wn+28]=un,this.uint32[_r+15]=kn,this.float32[_r+16]=Rn,this.float32[_r+17]=zn,this.float32[_r+18]=Kn,r}}Ci.prototype.bytesPerElement=76,hr(Ci,"StructArrayLayout3i2f6i15ui1ul3f76");class co extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.float32[1*r+0]=l,r}}co.prototype.bytesPerElement=4,hr(co,"StructArrayLayout1f4");class Ri extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x){const w=this.length;return this.resize(w+1),this.emplace(w,r,l,h,p,x)}emplace(r,l,h,p,x,w){const A=5*r;return this.float32[A+0]=l,this.float32[A+1]=h,this.float32[A+2]=p,this.float32[A+3]=x,this.float32[A+4]=w,r}}Ri.prototype.bytesPerElement=20,hr(Ri,"StructArrayLayout5f20");class ba extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,h,p){const x=this.length;return this.resize(x+1),this.emplace(x,r,l,h,p)}emplace(r,l,h,p,x){const w=6*r;return this.uint32[3*r+0]=l,this.uint16[w+2]=h,this.uint16[w+3]=p,this.uint16[w+4]=x,r}}ba.prototype.bytesPerElement=12,hr(ba,"StructArrayLayout1ul3ui12");class ts extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l){const h=this.length;return this.resize(h+1),this.emplace(h,r,l)}emplace(r,l,h){const p=2*r;return this.uint16[p+0]=l,this.uint16[p+1]=h,r}}ts.prototype.bytesPerElement=4,hr(ts,"StructArrayLayout2ui4");class cc extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.uint16[1*r+0]=l,r}}cc.prototype.bytesPerElement=2,hr(cc,"StructArrayLayout1ui2");class Cc extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l){const h=this.length;return this.resize(h+1),this.emplace(h,r,l)}emplace(r,l,h){const p=2*r;return this.float32[p+0]=l,this.float32[p+1]=h,r}}Cc.prototype.bytesPerElement=8,hr(Cc,"StructArrayLayout2f8");class Li extends vt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Li.prototype.size=40;class eo extends Fr{get(r){return new Li(this,r)}}hr(eo,"CollisionBoxArray");class uo extends vt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}uo.prototype.size=60;class Ms extends ki{get(r){return new uo(this,r)}}hr(Ms,"PlacedSymbolArray");class qa extends vt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(r){this._structArray.uint32[this._pos4+15]=r}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}qa.prototype.size=76;class ns extends Ci{get(r){return new qa(this,r)}}hr(ns,"SymbolInstanceArray");class As extends co{getoffsetX(r){return this.float32[1*r+0]}}hr(As,"GlyphOffsetArray");class hs extends mn{getx(r){return this.int16[2*r+0]}gety(r){return this.int16[2*r+1]}}hr(hs,"SymbolLineVertexArray");class xs extends vt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}xs.prototype.size=12;class ls extends ba{get(r){return new xs(this,r)}}hr(ls,"FeatureIndexArray");class $l extends ts{geta_centroid_pos0(r){return this.uint16[2*r+0]}geta_centroid_pos1(r){return this.uint16[2*r+1]}}hr($l,"FillExtrusionCentroidArray");const Il=Lt([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),ka=Lt([{name:"a_dash",components:4,type:"Uint16"}]);var rd={exports:{}},Ys={exports:{}};Ys.exports=function(s,r){var l,h,p,x,w,A,P,R;for(h=s.length-(l=3&s.length),p=r,w=3432918353,A=461845907,R=0;R<h;)P=255&s.charCodeAt(R)|(255&s.charCodeAt(++R))<<8|(255&s.charCodeAt(++R))<<16|(255&s.charCodeAt(++R))<<24,++R,p=27492+(65535&(x=5*(65535&(p=(p^=P=(65535&(P=(P=(65535&P)*w+(((P>>>16)*w&65535)<<16)&4294967295)<<15|P>>>17))*A+(((P>>>16)*A&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(P=0,l){case 3:P^=(255&s.charCodeAt(R+2))<<16;case 2:P^=(255&s.charCodeAt(R+1))<<8;case 1:p^=P=(65535&(P=(P=(65535&(P^=255&s.charCodeAt(R)))*w+(((P>>>16)*w&65535)<<16)&4294967295)<<15|P>>>17))*A+(((P>>>16)*A&65535)<<16)&4294967295}return p^=s.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0};var Vh=Ys.exports,bd={exports:{}};bd.exports=function(s,r){for(var l,h=s.length,p=r^h,x=0;h>=4;)l=1540483477*(65535&(l=255&s.charCodeAt(x)|(255&s.charCodeAt(++x))<<8|(255&s.charCodeAt(++x))<<16|(255&s.charCodeAt(++x))<<24))+((1540483477*(l>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),h-=4,++x;switch(h){case 3:p^=(255&s.charCodeAt(x+2))<<16;case 2:p^=(255&s.charCodeAt(x+1))<<8;case 1:p=1540483477*(65535&(p^=255&s.charCodeAt(x)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0};var Ou=Vh,Bu=bd.exports;rd.exports=Ou,rd.exports.murmur3=Ou,rd.exports.murmur2=Bu;var Lc=ue(rd.exports);class qh{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,l,h,p){this.ids.push(id(r)),this.positions.push(l,h,p)}getPositions(r){const l=id(r);let h=0,p=this.ids.length-1;for(;h<p;){const w=h+p>>1;this.ids[w]>=l?p=w:h=w+1}const x=[];for(;this.ids[h]===l;)x.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return x}static serialize(r,l){const h=new Float64Array(r.ids),p=new Uint32Array(r.positions);return zu(h,p,0,h.length-1),l&&l.push(h.buffer,p.buffer),{ids:h,positions:p}}static deserialize(r){const l=new qh;return l.ids=r.ids,l.positions=r.positions,l.indexed=!0,l}}function id(s){const r=+s;return!isNaN(r)&&Number.MIN_SAFE_INTEGER<=r&&r<=Number.MAX_SAFE_INTEGER?r:Lc(String(s))}function zu(s,r,l,h){for(;l<h;){const p=s[l+h>>1];let x=l-1,w=h+1;for(;;){do x++;while(s[x]<p);do w--;while(s[w]>p);if(x>=w)break;Fd(s,x,w),Fd(r,3*x,3*w),Fd(r,3*x+1,3*w+1),Fd(r,3*x+2,3*w+2)}w-l<h-w?(zu(s,r,l,w),l=w+1):(zu(s,r,w+1,h),h=w)}}function Fd(s,r,l){const h=s[r];s[r]=s[l],s[l]=h}hr(qh,"FeaturePositionMap");class Pc{constructor(r){this.gl=r.gl,this.initialized=!1}fetchUniformLocation(r,l){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(r,l),this.initialized=!0),!!this.location}}class ju extends Pc{constructor(r){super(r),this.current=0}set(r,l,h){this.fetchUniformLocation(r,l)&&this.current!==h&&(this.current=h,this.gl.uniform1f(this.location,h))}}class wd extends Pc{constructor(r){super(r),this.current=[0,0,0,0]}set(r,l,h){this.fetchUniformLocation(r,l)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]&&h[3]===this.current[3]||(this.current=h,this.gl.uniform4f(this.location,h[0],h[1],h[2],h[3])))}}class Od extends Pc{constructor(r){super(r),this.current=Ao.transparent}set(r,l,h){this.fetchUniformLocation(r,l)&&(h.r===this.current.r&&h.g===this.current.g&&h.b===this.current.b&&h.a===this.current.a||(this.current=h,this.gl.uniform4f(this.location,h.r,h.g,h.b,h.a)))}}const lh=new Float32Array(16),cf=new Float32Array(9),kh=new Float32Array(4);function kc(s){return[bt(255*s.r,255*s.g),bt(255*s.b,255*s.a)]}class uc{constructor(r,l,h){this.value=r,this.uniformNames=l.map((p=>`u_${p}`)),this.type=h}setUniform(r,l,h,p,x){l.set(r,x,p.constantOr(this.value))}getBinding(r,l){return this.type==="color"?new Od(r):new ju(r)}}class $a{constructor(r,l){this.uniformNames=l.map((h=>`u_${h}`)),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(r){this.pixelRatio=r.pixelRatio||1,this.pattern=r.tl.concat(r.br)}setUniform(r,l,h,p,x){const w=x==="u_pattern"||x==="u_dash"?this.pattern:x==="u_pixel_ratio"?this.pixelRatio:null;w&&l.set(r,x,w)}getBinding(r,l){return l==="u_pattern"||l==="u_dash"?new wd(r):new ju(r)}}class Rc{constructor(r,l,h,p){this.expression=r,this.type=h,this.maxValue=0,this.paintVertexAttributes=l.map((x=>({name:`a_${x}`,type:"Float32",components:h==="color"?2:1,offset:0}))),this.paintVertexArray=new p}populatePaintArray(r,l,h,p,x,w){const A=this.paintVertexArray.length,P=this.expression.evaluate(new G(0),l,{},x,p,w);this.paintVertexArray.resize(r),this._setPaintValue(A,r,P)}updatePaintArray(r,l,h,p,x){const w=this.expression.evaluate({zoom:0},h,p,void 0,x);this._setPaintValue(r,l,w)}_setPaintValue(r,l,h){if(this.type==="color"){const p=kc(h);for(let x=r;x<l;x++)this.paintVertexArray.emplace(x,p[0],p[1])}else{for(let p=r;p<l;p++)this.paintVertexArray.emplace(p,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Gc{constructor(r,l,h,p,x,w){this.expression=r,this.uniformNames=l.map((A=>`u_${A}_t`)),this.type=h,this.useIntegerZoom=p,this.zoom=x,this.maxValue=0,this.paintVertexAttributes=l.map((A=>({name:`a_${A}`,type:"Float32",components:h==="color"?4:2,offset:0}))),this.paintVertexArray=new w}populatePaintArray(r,l,h,p,x,w){const A=this.expression.evaluate(new G(this.zoom),l,{},x,p,w),P=this.expression.evaluate(new G(this.zoom+1),l,{},x,p,w),R=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(R,r,A,P)}updatePaintArray(r,l,h,p,x){const w=this.expression.evaluate({zoom:this.zoom},h,p,void 0,x),A=this.expression.evaluate({zoom:this.zoom+1},h,p,void 0,x);this._setPaintValue(r,l,w,A)}_setPaintValue(r,l,h,p){if(this.type==="color"){const x=kc(h),w=kc(p);for(let A=r;A<l;A++)this.paintVertexArray.emplace(A,x[0],x[1],w[0],w[1])}else{for(let x=r;x<l;x++)this.paintVertexArray.emplace(x,h,p);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(p))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,l,h,p,x){const w=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,A=Fe(this.expression.interpolationFactor(w,this.zoom,this.zoom+1),0,1);l.set(r,x,A)}getBinding(r,l){return new ju(r)}}class Uu{constructor(r,l,h,p,x){this.expression=r,this.layerId=x,this.paintVertexAttributes=(h==="array"?ka:Il).members;for(let w=0;w<l.length;++w);this.paintVertexArray=new p}populatePaintArray(r,l,h){const p=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValues(p,r,l.patterns&&l.patterns[this.layerId],h)}updatePaintArray(r,l,h,p,x,w){this._setPaintValues(r,l,h.patterns&&h.patterns[this.layerId],w)}_setPaintValues(r,l,h,p){if(!p||!h)return;const x=p[h];if(!x)return;const{tl:w,br:A,pixelRatio:P}=x;for(let R=r;R<l;R++)this.paintVertexArray.emplace(R,w[0],w[1],A[0],A[1],P)}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ch{constructor(r,l,h=(()=>!0)){this.binders={},this._buffers=[];const p=[];for(const x in r.paint._values){if(!h(x))continue;const w=r.paint.get(x);if(!(w instanceof Ue&&bl(w.property.specification)))continue;const A=_g(x,r.type),P=w.value,R=w.property.specification.type,$=!!w.property.useIntegerZoom,X=x==="line-dasharray"||x.endsWith("pattern"),re=x==="line-dasharray"&&r.layout.get("line-cap").value.kind!=="constant";if(P.kind!=="constant"||re)if(P.kind==="source"||re||X){const he=_m(x,R,"source");this.binders[x]=X?new Uu(P,A,R,he,r.id):new Rc(P,A,R,he),p.push(`/a_${x}`)}else{const he=_m(x,R,"composite");this.binders[x]=new Gc(P,A,R,$,l,he),p.push(`/z_${x}`)}else this.binders[x]=X?new $a(P.value,A):new uc(P.value,A,R),p.push(`/u_${x}`)}this.cacheKey=p.sort().join("")}getMaxValue(r){const l=this.binders[r];return l instanceof Rc||l instanceof Gc?l.maxValue:0}populatePaintArrays(r,l,h,p,x,w){for(const A in this.binders){const P=this.binders[A];(P instanceof Rc||P instanceof Gc||P instanceof Uu)&&P.populatePaintArray(r,l,h,p,x,w)}}setConstantPatternPositions(r){for(const l in this.binders){const h=this.binders[l];h instanceof $a&&h.setConstantPatternPositions(r)}}updatePaintArrays(r,l,h,p,x,w){let A=!1;for(const P in r){const R=l.getPositions(P);for(const $ of R){const X=h.feature($.index);for(const re in this.binders){const he=this.binders[re];if((he instanceof Rc||he instanceof Gc||he instanceof Uu)&&he.expression.isStateDependent===!0){const ye=p.paint.get(re);he.expression=ye.value,he.updatePaintArray($.start,$.end,X,r[P],x,w),A=!0}}}}return A}defines(){const r=[];for(const l in this.binders){const h=this.binders[l];(h instanceof uc||h instanceof $a)&&r.push(...h.uniformNames.map((p=>`#define HAS_UNIFORM_${p}`)))}return r}getBinderAttributes(){const r=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof Rc||h instanceof Gc||h instanceof Uu)for(let p=0;p<h.paintVertexAttributes.length;p++)r.push(h.paintVertexAttributes[p].name)}return r}getBinderUniforms(){const r=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof uc||h instanceof $a||h instanceof Gc)for(const p of h.uniformNames)r.push(p)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r){const l=[];for(const h in this.binders){const p=this.binders[h];if(p instanceof uc||p instanceof $a||p instanceof Gc)for(const x of p.uniformNames)l.push({name:x,property:h,binding:p.getBinding(r,x)})}return l}setUniforms(r,l,h,p,x){for(const{name:w,property:A,binding:P}of h)this.binders[A].setUniform(r,P,x,p.get(A),w)}updatePaintBuffers(){this._buffers=[];for(const r in this.binders){const l=this.binders[r];(l instanceof Rc||l instanceof Gc||l instanceof Uu)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(r){for(const l in this.binders){const h=this.binders[l];(h instanceof Rc||h instanceof Gc||h instanceof Uu)&&h.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const l=this.binders[r];(l instanceof Rc||l instanceof Gc||l instanceof Uu)&&l.destroy()}}}class Vu{constructor(r,l,h=(()=>!0)){this.programConfigurations={};for(const p of r)this.programConfigurations[p.id]=new ch(p,l,h);this.needsUpload=!1,this._featureMap=new qh,this._bufferOffset=0}populatePaintArrays(r,l,h,p,x,w,A){for(const P in this.programConfigurations)this.programConfigurations[P].populatePaintArrays(r,l,p,x,w,A);l.id!==void 0&&this._featureMap.add(l.id,h,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,l,h,p,x){for(const w of h)this.needsUpload=this.programConfigurations[w.id].updatePaintArrays(r,this._featureMap,l,w,p,x)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const uf={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function _g(s,r){return uf[s]||[s.replace(`${r}-`,"").replace(/-/g,"_")]}const kp={"line-pattern":{source:jt,composite:jt},"fill-pattern":{source:jt,composite:jt},"fill-extrusion-pattern":{source:jt,composite:jt},"line-dasharray":{source:on,composite:on}},vg={color:{source:Cc,composite:Cn},number:{source:co,composite:Cc}};function _m(s,r,l){const h=kp[s];return h&&h[l]||vg[r][l]}hr(uc,"ConstantBinder"),hr($a,"PatternConstantBinder"),hr(Rc,"SourceExpressionBinder"),hr(Uu,"PatternCompositeBinder"),hr(Gc,"CompositeExpressionBinder"),hr(ch,"ProgramConfiguration",{omit:["_buffers"]}),hr(Vu,"ProgramConfigurationSet");const vm="-transition";class Rh extends sa{constructor(r,l){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,r.type!=="custom"&&(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&r.type!=="sky"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),l.layout&&(this._unevaluatedLayout=new Xe(l.layout)),l.paint)){this._transitionablePaint=new ge(l.paint);for(const h in r.paint)this.setPaintProperty(h,r.paint[h],{validate:!1});for(const h in r.layout)this.setLayoutProperty(h,r.layout[h],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ze(l.paint)}}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,l,h={}){l!=null&&this._validate(oh,`layers.${this.id}.layout.${r}`,r,l,h)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,l):this.visibility=l)}getPaintProperty(r){return cn(r,vm)?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)}setPaintProperty(r,l,h={}){if(l!=null&&this._validate(ac,`layers.${this.id}.paint.${r}`,r,l,h))return!1;if(cn(r,vm))return this._transitionablePaint.setTransition(r.slice(0,-11),l||void 0),!1;{const p=this._transitionablePaint._values[r],x=p.value.isDataDriven(),w=p.value;this._transitionablePaint.setValue(r,l),this._handleSpecialPaintPropertyUpdate(r);const A=this._transitionablePaint._values[r].value,P=A.isDataDriven(),R=cn(r,"pattern")||r==="line-dasharray";return P||x||R||this._handleOverridablePaintPropertyUpdate(r,w,A)}}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getProgramConfiguration(r){return null}_handleOverridablePaintPropertyUpdate(r,l,h){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,l){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,l)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),Mn(r,((l,h)=>!(l===void 0||h==="layout"&&!Object.keys(l).length||h==="paint"&&!Object.keys(l).length)))}_validate(r,l,h,p,x={}){return(!x||x.validate!==!1)&&nl(this,r.call(Rs,{key:l,layerType:this.type,objectKey:h,value:p,styleSpec:dn,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const l=this.paint.get(r);if(l instanceof Ue&&bl(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Ph(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const hf=Lt([{name:"a_pos",components:2,type:"Int16"}],4),xg=Lt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Ra{constructor(r=[]){this.segments=r}prepareSegment(r,l,h,p){let x=this.segments[this.segments.length-1];return r>Ra.MAX_VERTEX_ARRAY_LENGTH&&mr(`Max vertices per segment is ${Ra.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!x||x.vertexLength+r>Ra.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==p)&&(x={vertexOffset:l.length,primitiveOffset:h.length,vertexLength:0,primitiveLength:0},p!==void 0&&(x.sortKey=p),this.segments.push(x)),x}get(){return this.segments}destroy(){for(const r of this.segments)for(const l in r.vaos)r.vaos[l].destroy()}static simpleSegment(r,l,h,p){return new Ra([{vertexOffset:r,primitiveOffset:l,vertexLength:h,primitiveLength:p,vaos:{},sortKey:0}])}}Ra.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,hr(Ra,"SegmentVector");var Jr=8192;class od{constructor(r,l){r&&(l?this.setSouthWest(r).setNorthEast(l):r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof Qr?new Qr(r.lng,r.lat):Qr.convert(r),this}setSouthWest(r){return this._sw=r instanceof Qr?new Qr(r.lng,r.lat):Qr.convert(r),this}extend(r){const l=this._sw,h=this._ne;let p,x;if(r instanceof Qr)p=r,x=r;else{if(!(r instanceof od))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(od.convert(r)):this.extend(Qr.convert(r)):typeof r=="object"&&r!==null&&r.hasOwnProperty("lat")&&(r.hasOwnProperty("lon")||r.hasOwnProperty("lng"))?this.extend(Qr.convert(r)):this;if(p=r._sw,x=r._ne,!p||!x)return this}return l||h?(l.lng=Math.min(p.lng,l.lng),l.lat=Math.min(p.lat,l.lat),h.lng=Math.max(x.lng,h.lng),h.lat=Math.max(x.lat,h.lat)):(this._sw=new Qr(p.lng,p.lat),this._ne=new Qr(x.lng,x.lat)),this}getCenter(){return new Qr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Qr(this.getWest(),this.getNorth())}getSouthEast(){return new Qr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:l,lat:h}=Qr.convert(r);let p=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&p}static convert(r){return!r||r instanceof od?r:new od(r)}}var Yf=1e-6,hc=typeof Float32Array<"u"?Float32Array:Array;function bg(){var s=new hc(9);return hc!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s}function xm(s,r,l){var h=r[0],p=r[1],x=r[2],w=r[3],A=r[4],P=r[5],R=r[6],$=r[7],X=r[8],re=l[0],he=l[1],ye=l[2],Se=l[3],We=l[4],at=l[5],xt=l[6],lt=l[7],_t=l[8];return s[0]=re*h+he*w+ye*R,s[1]=re*p+he*A+ye*$,s[2]=re*x+he*P+ye*X,s[3]=Se*h+We*w+at*R,s[4]=Se*p+We*A+at*$,s[5]=Se*x+We*P+at*X,s[6]=xt*h+lt*w+_t*R,s[7]=xt*p+lt*A+_t*$,s[8]=xt*x+lt*P+_t*X,s}function Hc(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function au(s,r){var l=r[0],h=r[1],p=r[2],x=r[3],w=r[4],A=r[5],P=r[6],R=r[7],$=r[8],X=r[9],re=r[10],he=r[11],ye=r[12],Se=r[13],We=r[14],at=r[15],xt=l*A-h*w,lt=l*P-p*w,_t=l*R-x*w,It=h*P-p*A,Tt=h*R-x*A,sn=p*R-x*P,nn=$*Se-X*ye,Sn=$*We-re*ye,Vn=$*at-he*ye,un=X*We-re*Se,kn=X*at-he*Se,Rn=re*at-he*We,zn=xt*Rn-lt*kn+_t*un+It*Vn-Tt*Sn+sn*nn;return zn?(s[0]=(A*Rn-P*kn+R*un)*(zn=1/zn),s[1]=(p*kn-h*Rn-x*un)*zn,s[2]=(Se*sn-We*Tt+at*It)*zn,s[3]=(re*Tt-X*sn-he*It)*zn,s[4]=(P*Vn-w*Rn-R*Sn)*zn,s[5]=(l*Rn-p*Vn+x*Sn)*zn,s[6]=(We*_t-ye*sn-at*lt)*zn,s[7]=($*sn-re*_t+he*lt)*zn,s[8]=(w*kn-A*Vn+R*nn)*zn,s[9]=(h*Vn-l*kn-x*nn)*zn,s[10]=(ye*Tt-Se*_t+at*xt)*zn,s[11]=(X*_t-$*Tt-he*xt)*zn,s[12]=(A*Sn-w*un-P*nn)*zn,s[13]=(l*un-h*Sn+p*nn)*zn,s[14]=(Se*lt-ye*It-We*xt)*zn,s[15]=($*It-X*lt+re*xt)*zn,s):null}function Wc(s,r,l){var h=r[0],p=r[1],x=r[2],w=r[3],A=r[4],P=r[5],R=r[6],$=r[7],X=r[8],re=r[9],he=r[10],ye=r[11],Se=r[12],We=r[13],at=r[14],xt=r[15],lt=l[0],_t=l[1],It=l[2],Tt=l[3];return s[0]=lt*h+_t*A+It*X+Tt*Se,s[1]=lt*p+_t*P+It*re+Tt*We,s[2]=lt*x+_t*R+It*he+Tt*at,s[3]=lt*w+_t*$+It*ye+Tt*xt,s[4]=(lt=l[4])*h+(_t=l[5])*A+(It=l[6])*X+(Tt=l[7])*Se,s[5]=lt*p+_t*P+It*re+Tt*We,s[6]=lt*x+_t*R+It*he+Tt*at,s[7]=lt*w+_t*$+It*ye+Tt*xt,s[8]=(lt=l[8])*h+(_t=l[9])*A+(It=l[10])*X+(Tt=l[11])*Se,s[9]=lt*p+_t*P+It*re+Tt*We,s[10]=lt*x+_t*R+It*he+Tt*at,s[11]=lt*w+_t*$+It*ye+Tt*xt,s[12]=(lt=l[12])*h+(_t=l[13])*A+(It=l[14])*X+(Tt=l[15])*Se,s[13]=lt*p+_t*P+It*re+Tt*We,s[14]=lt*x+_t*R+It*he+Tt*at,s[15]=lt*w+_t*$+It*ye+Tt*xt,s}function bu(s,r,l){var h,p,x,w,A,P,R,$,X,re,he,ye,Se=l[0],We=l[1],at=l[2];return r===s?(s[12]=r[0]*Se+r[4]*We+r[8]*at+r[12],s[13]=r[1]*Se+r[5]*We+r[9]*at+r[13],s[14]=r[2]*Se+r[6]*We+r[10]*at+r[14],s[15]=r[3]*Se+r[7]*We+r[11]*at+r[15]):(p=r[1],x=r[2],w=r[3],A=r[4],P=r[5],R=r[6],$=r[7],X=r[8],re=r[9],he=r[10],ye=r[11],s[0]=h=r[0],s[1]=p,s[2]=x,s[3]=w,s[4]=A,s[5]=P,s[6]=R,s[7]=$,s[8]=X,s[9]=re,s[10]=he,s[11]=ye,s[12]=h*Se+A*We+X*at+r[12],s[13]=p*Se+P*We+re*at+r[13],s[14]=x*Se+R*We+he*at+r[14],s[15]=w*Se+$*We+ye*at+r[15]),s}function sd(s,r,l){var h=l[0],p=l[1],x=l[2];return s[0]=r[0]*h,s[1]=r[1]*h,s[2]=r[2]*h,s[3]=r[3]*h,s[4]=r[4]*p,s[5]=r[5]*p,s[6]=r[6]*p,s[7]=r[7]*p,s[8]=r[8]*x,s[9]=r[9]*x,s[10]=r[10]*x,s[11]=r[11]*x,s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15],s}function Rp(s,r,l){var h=Math.sin(l),p=Math.cos(l),x=r[4],w=r[5],A=r[6],P=r[7],R=r[8],$=r[9],X=r[10],re=r[11];return r!==s&&(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[4]=x*p+R*h,s[5]=w*p+$*h,s[6]=A*p+X*h,s[7]=P*p+re*h,s[8]=R*p-x*h,s[9]=$*p-w*h,s[10]=X*p-A*h,s[11]=re*p-P*h,s}function Jf(s,r,l){var h=Math.sin(l),p=Math.cos(l),x=r[0],w=r[1],A=r[2],P=r[3],R=r[8],$=r[9],X=r[10],re=r[11];return r!==s&&(s[4]=r[4],s[5]=r[5],s[6]=r[6],s[7]=r[7],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[0]=x*p-R*h,s[1]=w*p-$*h,s[2]=A*p-X*h,s[3]=P*p-re*h,s[8]=x*h+R*p,s[9]=w*h+$*p,s[10]=A*h+X*p,s[11]=P*h+re*p,s}function Qf(s,r){return s[0]=r[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=r[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=r[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Bd(s,r,l){var h,p,x,w=l[0],A=l[1],P=l[2],R=Math.hypot(w,A,P);return R<Yf?null:(w*=R=1/R,A*=R,P*=R,h=Math.sin(r),p=Math.cos(r),s[0]=w*w*(x=1-p)+p,s[1]=A*w*x+P*h,s[2]=P*w*x-A*h,s[3]=0,s[4]=w*A*x-P*h,s[5]=A*A*x+p,s[6]=P*A*x+w*h,s[7]=0,s[8]=w*P*x+A*h,s[9]=A*P*x-w*h,s[10]=P*P*x+p,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s)}Math.hypot||(Math.hypot=function(){for(var s=0,r=arguments.length;r--;)s+=arguments[r]*arguments[r];return Math.sqrt(s)});var bm=Wc;function ep(){var s=new hc(3);return hc!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function df(s){var r=new hc(3);return r[0]=s[0],r[1]=s[1],r[2]=s[2],r}function zd(s){return Math.hypot(s[0],s[1],s[2])}function Sd(s,r,l){var h=new hc(3);return h[0]=s,h[1]=r,h[2]=l,h}function $h(s,r,l){return s[0]=r[0]+l[0],s[1]=r[1]+l[1],s[2]=r[2]+l[2],s}function Mp(s,r,l){return s[0]=r[0]-l[0],s[1]=r[1]-l[1],s[2]=r[2]-l[2],s}function O(s,r,l){return s[0]=r[0]*l[0],s[1]=r[1]*l[1],s[2]=r[2]*l[2],s}function de(s,r,l){return s[0]=Math.min(r[0],l[0]),s[1]=Math.min(r[1],l[1]),s[2]=Math.min(r[2],l[2]),s}function Te(s,r,l){return s[0]=Math.max(r[0],l[0]),s[1]=Math.max(r[1],l[1]),s[2]=Math.max(r[2],l[2]),s}function Me(s,r,l){return s[0]=r[0]*l,s[1]=r[1]*l,s[2]=r[2]*l,s}function tt(s,r,l,h){return s[0]=r[0]+l[0]*h,s[1]=r[1]+l[1]*h,s[2]=r[2]+l[2]*h,s}function ze(s,r){var l=r[0],h=r[1],p=r[2],x=l*l+h*h+p*p;return x>0&&(x=1/Math.sqrt(x)),s[0]=r[0]*x,s[1]=r[1]*x,s[2]=r[2]*x,s}function Ke(s,r){return s[0]*r[0]+s[1]*r[1]+s[2]*r[2]}function At(s,r,l){var h=r[0],p=r[1],x=r[2],w=l[0],A=l[1],P=l[2];return s[0]=p*P-x*A,s[1]=x*w-h*P,s[2]=h*A-p*w,s}function kt(s,r,l){var h=r[0],p=r[1],x=r[2],w=l[3]*h+l[7]*p+l[11]*x+l[15];return s[0]=(l[0]*h+l[4]*p+l[8]*x+l[12])/(w=w||1),s[1]=(l[1]*h+l[5]*p+l[9]*x+l[13])/w,s[2]=(l[2]*h+l[6]*p+l[10]*x+l[14])/w,s}function gt(s,r,l){var h=l[0],p=l[1],x=l[2],w=r[0],A=r[1],P=r[2],R=p*P-x*A,$=x*w-h*P,X=h*A-p*w,re=p*X-x*$,he=x*R-h*X,ye=h*$-p*R,Se=2*l[3];return $*=Se,X*=Se,he*=2,ye*=2,s[0]=w+(R*=Se)+(re*=2),s[1]=A+$+he,s[2]=P+X+ye,s}var $t,en=Mp,An=O,yn=zd;function Kt(s,r,l){return s[0]=r[0]*l,s[1]=r[1]*l,s[2]=r[2]*l,s[3]=r[3]*l,s}function rn(s,r){var l=r[0],h=r[1],p=r[2],x=r[3],w=l*l+h*h+p*p+x*x;return w>0&&(w=1/Math.sqrt(w)),s[0]=l*w,s[1]=h*w,s[2]=p*w,s[3]=x*w,s}function $n(s,r,l){var h=r[0],p=r[1],x=r[2],w=r[3];return s[0]=l[0]*h+l[4]*p+l[8]*x+l[12]*w,s[1]=l[1]*h+l[5]*p+l[9]*x+l[13]*w,s[2]=l[2]*h+l[6]*p+l[10]*x+l[14]*w,s[3]=l[3]*h+l[7]*p+l[11]*x+l[15]*w,s}function yr(){var s=new hc(4);return hc!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s[3]=1,s}function On(s){return s[0]=0,s[1]=0,s[2]=0,s[3]=1,s}function gr(s,r,l){l*=.5;var h=r[0],p=r[1],x=r[2],w=r[3],A=Math.sin(l),P=Math.cos(l);return s[0]=h*P+w*A,s[1]=p*P+x*A,s[2]=x*P-p*A,s[3]=w*P-h*A,s}function ti(s,r,l){l*=.5;var h=r[0],p=r[1],x=r[2],w=r[3],A=Math.sin(l),P=Math.cos(l);return s[0]=h*P-x*A,s[1]=p*P+w*A,s[2]=x*P+h*A,s[3]=w*P-p*A,s}ep(),$t=new hc(4),hc!=Float32Array&&($t[0]=0,$t[1]=0,$t[2]=0,$t[3]=0);var Or=rn;ep(),Sd(1,0,0),Sd(0,1,0),yr(),yr(),bg();const Hr=Lt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:_i}=Hr,vr=Lt([{name:"a_pos_3",components:3,type:"Int16"}]);var Rr=Lt([{name:"a_pos",type:"Int16",components:2}]);class ji{constructor(r,l){this.pos=r,this.dir=l}intersectsPlane(r,l,h){const p=Ke(l,this.dir);if(Math.abs(p)<1e-6)return!1;const x=((r[0]-this.pos[0])*l[0]+(r[1]-this.pos[1])*l[1]+(r[2]-this.pos[2])*l[2])/p;return h[0]=this.pos[0]+this.dir[0]*x,h[1]=this.pos[1]+this.dir[1]*x,h[2]=this.pos[2]+this.dir[2]*x,!0}closestPointOnSphere(r,l,h){if((function(he,ye){var Se=he[0],We=he[1],at=he[2],xt=ye[0],lt=ye[1],_t=ye[2];return Math.abs(Se-xt)<=Yf*Math.max(1,Math.abs(Se),Math.abs(xt))&&Math.abs(We-lt)<=Yf*Math.max(1,Math.abs(We),Math.abs(lt))&&Math.abs(at-_t)<=Yf*Math.max(1,Math.abs(at),Math.abs(_t))})(this.pos,r)||l===0)return h[0]=h[1]=h[2]=0,!1;const[p,x,w]=this.dir,A=this.pos[0]-r[0],P=this.pos[1]-r[1],R=this.pos[2]-r[2],$=p*p+x*x+w*w,X=2*(A*p+P*x+R*w),re=X*X-4*$*(A*A+P*P+R*R-l*l);if(re<0){const he=Math.max(-X/2,0),ye=A+p*he,Se=P+x*he,We=R+w*he,at=Math.hypot(ye,Se,We);return h[0]=ye*l/at,h[1]=Se*l/at,h[2]=We*l/at,!1}{const he=(-X-Math.sqrt(re))/(2*$);if(he<0){const ye=Math.hypot(A,P,R);return h[0]=A*l/ye,h[1]=P*l/ye,h[2]=R*l/ye,!1}return h[0]=A+p*he,h[1]=P+x*he,h[2]=R+w*he,!0}}}class Gr{constructor(r,l,h,p,x){this.TL=r,this.TR=l,this.BR=h,this.BL=p,this.horizon=x}static fromInvProjectionMatrix(r,l,h){const p=[-1,1,1],x=[1,1,1],w=[1,-1,1],A=[-1,-1,1],P=kt(p,p,r),R=kt(x,x,r),$=kt(w,w,r),X=kt(A,A,r);return new Gr(P,R,$,X,l/h)}}class jr{constructor(r,l){this.points=r,this.planes=l}static fromInvProjectionMatrix(r,l,h,p){const x=Math.pow(2,h),w=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((P=>{const R=$n([],P,r),$=1/R[3]/l*x;return(function(X,re,he){return X[0]=re[0]*he[0],X[1]=re[1]*he[1],X[2]=re[2]*he[2],X[3]=re[3]*he[3],X})(R,R,[$,$,p?1/R[3]:$,$])})),A=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((P=>{const R=ze([],At([],en([],w[P[0]],w[P[1]]),en([],w[P[2]],w[P[1]]))),$=-Ke(R,w[P[1]]);return R.concat($)}));return new jr(w,A)}}class Wr{static fromPoints(r){const l=[1/0,1/0,1/0],h=[-1/0,-1/0,-1/0];for(const p of r)de(l,l,p),Te(h,h,p);return new Wr(l,h)}static applyTransform(r,l){const h=r.getCorners();for(let p=0;p<h.length;++p)kt(h[p],h[p],l);return Wr.fromPoints(h)}constructor(r,l){this.min=r,this.max=l,this.center=Me([],$h([],this.min,this.max),.5)}quadrant(r){const l=[r%2==0,r<2],h=df(this.min),p=df(this.max);for(let x=0;x<l.length;x++)h[x]=l[x]?this.min[x]:this.center[x],p[x]=l[x]?this.center[x]:this.max[x];return p[2]=this.max[2],new Wr(h,p)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}getCorners(){const r=this.min,l=this.max;return[[r[0],r[1],r[2]],[l[0],r[1],r[2]],[l[0],l[1],r[2]],[r[0],l[1],r[2]],[r[0],r[1],l[2]],[l[0],r[1],l[2]],[l[0],l[1],l[2]],[r[0],l[1],l[2]]]}intersects(r){const l=this.getCorners();let h=!0;for(let p=0;p<r.planes.length;p++){const x=r.planes[p];let w=0;for(let A=0;A<l.length;A++)w+=Ke(x,l[A])+x[3]>=0;if(w===0)return 0;w!==l.length&&(h=!1)}if(h)return 2;for(let p=0;p<3;p++){let x=Number.MAX_VALUE,w=-Number.MAX_VALUE;for(let A=0;A<r.points.length;A++){const P=r.points[A][p]-this.min[p];x=Math.min(x,P),w=Math.max(w,P)}if(w<0||x>this.max[p]-this.min[p])return 0}return 1}}const Un=5,Jt=6,pn=Jr/Math.PI/2,Xn=16383,dr=64,qr=[dr,32,16],Di=-pn,Wn=pn,qi=[new Wr([Di,Di,Di],[Wn,Wn,Wn]),new Wr([Di,Di,Di],[0,0,Wn]),new Wr([0,Di,Di],[Wn,0,Wn]),new Wr([Di,0,Di],[0,Wn,Wn]),new Wr([0,0,Di],[Wn,Wn,Wn])];function wo(s){return s*pn/qu}function ho(s,r,l,h=!0){const p=Me([],s._camera.position,s.worldSize),x=[r,l,1,1];$n(x,x,s.pixelMatrixInverse),Kt(x,x,1/x[3]);const w=ze([],en([],x,p)),A=s.globeMatrix,P=[A[12],A[13],A[14]],R=en([],P,p),$=zd(R),X=ze([],R),re=s.worldSize/(2*Math.PI),he=Ke(X,w),ye=Math.asin(re/$);if(ye<Math.acos(he)){if(!h)return null;const Vn=[],un=[];Me(Vn,w,$/he),ze(un,en(un,Vn,R)),ze(w,$h(w,R,Me(w,un,Math.tan(ye)*$)))}const Se=[];new ji(p,w).closestPointOnSphere(P,re,Se);const We=ze([],Pn(A,0)),at=ze([],Pn(A,1)),xt=ze([],Pn(A,2)),lt=Ke(We,Se),_t=Ke(at,Se),It=Ke(xt,Se),Tt=be(Math.asin(-_t/re));let sn=be(Math.atan2(lt,It));sn=s.center.lng+(function(Vn,un){const kn=(un-Vn+180)%360-180;return kn<-180?kn+360:kn})(s.center.lng,sn);const nn=Ts(sn),Sn=Fe(fa(Tt),0,1);return new Gh(nn,Sn)}class dc{constructor(r,l,h){this.a=en([],r,h),this.b=en([],l,h),this.center=h;const p=ze([],this.a),x=ze([],this.b);this.angle=Math.acos(Ke(p,x))}}function Ns(s,r){if(s.angle===0)return null;let l;return l=s.a[r]===0?1/s.angle*.5*Math.PI:1/s.angle*Math.atan(s.b[r]/s.a[r]/Math.sin(s.angle)-1/Math.tan(s.angle)),l<0||l>1?null:(function(h,p,x,w){const A=Math.sin(x);return h*(Math.sin((1-w)*x)/A)+p*(Math.sin(w*x)/A)})(s.a[r],s.b[r],s.angle,Fe(l,0,1))+s.center[r]}function Ds(s){if(s.z<=1)return qi[s.z+2*s.y+s.x];const r=Cl(Mh(s));return Wr.fromPoints(r)}function fo(s,r,l){return Me(s,s,1-l),tt(s,s,r,l)}function Qn(s,r){const l=ci(r.zoom);if(l===0)return Ds(s);const h=Mh(s),p=Cl(h),x=Ts(h.getWest())*r.worldSize,w=Ts(h.getEast())*r.worldSize,A=fa(h.getNorth())*r.worldSize,P=fa(h.getSouth())*r.worldSize,R=[x,A,0],$=[w,A,0],X=[x,P,0],re=[w,P,0],he=au([],r.globeMatrix);return kt(R,R,he),kt($,$,he),kt(X,X,he),kt(re,re,he),p[0]=fo(p[0],X,l),p[1]=fo(p[1],re,l),p[2]=fo(p[2],$,l),p[3]=fo(p[3],R,l),Wr.fromPoints(p)}function lu(s,r,l){for(const h of s)kt(h,h,r),Me(h,h,l)}function ad(s,r,l){const h=r/s.worldSize,p=s.globeMatrix;if(l.z<=1){const nn=Ds(l).getCorners();return lu(nn,p,h),Wr.fromPoints(nn)}const x=Mh(l),w=Cl(x);lu(w,p,h);const A=Number.MAX_VALUE,P=[-A,-A,-A],R=[A,A,A];if(x.contains(s.center)){for(const Vn of w)de(R,R,Vn),Te(P,P,Vn);P[2]=0;const nn=s.point,Sn=[nn.x*h,nn.y*h,0];return de(R,R,Sn),Te(P,P,Sn),new Wr(R,P)}const $=[p[12]*h,p[13]*h,p[14]*h],X=x.getCenter(),re=Fe(s.center.lat,-Ma,Ma),he=Fe(X.lat,-Ma,Ma),ye=Ts(s.center.lng),Se=fa(re);let We=ye-Ts(X.lng);const at=Se-fa(he);We>.5?We-=1:We<-.5&&(We+=1);let xt=0;Math.abs(We)>Math.abs(at)?xt=We>=0?1:3:(xt=at>=0?0:2,tt($,$,[p[4]*h,p[5]*h,p[6]*h],-Math.sin(Z(at>=0?x.getSouth():x.getNorth()))*pn));const lt=w[xt],_t=w[(xt+1)%4],It=new dc(lt,_t,$),Tt=[Ns(It,0)||lt[0],Ns(It,1)||lt[1],Ns(It,2)||lt[2]],sn=ci(s.zoom);if(sn>0){const nn=(function({x:Vn,y:un,z:kn},Rn,zn,Kn,wn){const _r=1/(1<<kn);let Ur=Vn*_r,br=Ur+_r,Xi=un*_r,Zn=Xi+_r,ri=0;const Zi=(Ur+br)/2-Kn;return Zi>.5?ri=-1:Zi<-.5&&(ri=1),Ur=((Ur+ri)*Rn-(Kn*=Rn))*zn+Kn,br=((br+ri)*Rn-Kn)*zn+Kn,Xi=(Xi*Rn-(wn*=Rn))*zn+wn,Zn=(Zn*Rn-wn)*zn+wn,[[Ur,Zn,0],[br,Zn,0],[br,Xi,0],[Ur,Xi,0]]})(l,r,s._pixelsPerMercatorPixel,ye,Se);for(let Vn=0;Vn<w.length;Vn++)fo(w[Vn],nn[Vn],sn);const Sn=$h([],nn[xt],nn[(xt+1)%4]);Me(Sn,Sn,.5),fo(Tt,Sn,sn)}for(const nn of w)de(R,R,nn),Te(P,P,nn);return R[2]=Math.min(lt[2],_t[2]),de(R,R,Tt),Te(P,P,Tt),new Wr(R,P)}function Mh({x:s,y:r,z:l}){const h=1/(1<<l),p=new Qr(mc(s*h),Oo((r+1)*h)),x=new Qr(mc((s+1)*h),Oo(r*h));return new od(p,x)}function Cl(s){const r=Z(s.getNorth()),l=Z(s.getSouth()),h=Math.cos(r),p=Math.cos(l),x=Math.sin(r),w=Math.sin(l),A=s.getWest(),P=s.getEast();return[Js(p,w,A),Js(p,w,P),Js(h,x,P),Js(h,x,A)]}function Js(s,r,l,h=pn){return l=Z(l),[s*Math.sin(l)*h,-r*h,s*Math.cos(l)*h]}function Qs(s,r,l){return Js(Math.cos(Z(s)),Math.sin(Z(s)),r,l)}function Mc(s,r,l,h){const p=1<<l.z,x=(s/Jr+l.x)/p;return Qs(Oo((r/Jr+l.y)/p),mc(x),h)}function uh({min:s,max:r}){return Xn/Math.max(r[0]-s[0],r[1]-s[1],r[2]-s[2])}const ff=new Float64Array(16);function fc(s){const r=uh(s),l=Qf(ff,[r,r,r]);return bu(l,l,((h=[])[0]=-(p=s.min)[0],h[1]=-p[1],h[2]=-p[2],h));var h,p}function jd(s){const r=(h=s.min,(l=ff)[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=h[0],l[13]=h[1],l[14]=h[2],l[15]=1,l);var l,h;const p=1/uh(s);return sd(r,r,[p,p,p])}function pc(s,r,l,h,p){const x=(function(P){const R=Jr/(2*Math.PI);return P/(2*Math.PI)/R})(l),w=[s,r,-l/(2*Math.PI)],A=Hc(new Float64Array(16));return bu(A,A,w),sd(A,A,[x,x,x]),Rp(A,A,Z(-p)),Jf(A,A,Z(-h)),A}function ci(s){return nt(Un,Jt,s)}function bs(s,r){const l=Qs(r.lat,r.lng),h=(function(ye){const Se=Qs(ye._center.lat,ye._center.lng);let We=At([],Sd(0,1,0),Se);const at=Bd([],-ye.angle,Se);We=kt(We,We,at),Bd(at,-ye._pitch,We);const xt=ze([],Se);return Me(xt,xt,wo(ye.cameraToCenterDistance/ye.pixelsPerMeter)),kt(xt,xt,at),$h([],Se,xt)})(s);return w=(p=Mp([],h,l))[0],A=p[1],P=p[2],R=(x=l)[0],$=x[1],X=x[2],he=(re=Math.sqrt(w*w+A*A+P*P)*Math.sqrt(R*R+$*$+X*X))&&Ke(p,x)/re,Math.acos(Math.min(Math.max(he,-1),1));var p,x,w,A,P,R,$,X,re,he}function da(s,r){return bs(s,r)>Math.PI/2*1.01}const hh=Z(85),Ll=Math.cos(hh),Ed=Math.sin(hh),qu=63710088e-1,dh=2*Math.PI*qu;class Ga{constructor(r,l){if(isNaN(r)||isNaN(l))throw new Error(`Invalid LngLat object: (${r}, ${l})`);if(this.lng=+r,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ga(xe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const l=Math.PI/180,h=this.lat*l,p=r.lat*l,x=Math.sin(h)*Math.sin(p)+Math.cos(h)*Math.cos(p)*Math.cos((r.lng-this.lng)*l);return qu*Math.acos(Math.min(x,1))}toBounds(r=0){const l=360*r/40075017,h=l/Math.cos(Math.PI/180*this.lat);return new od(new Ga(this.lng-h,this.lat-l),new Ga(this.lng+h,this.lat+l))}toEcef(r){const l=wo(r);return Qs(this.lat,this.lng,pn+l)}static convert(r){if(r instanceof Ga)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new Ga(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new Ga(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Qr=Ga;function rl(s){return dh*Math.cos(s*Math.PI/180)}function Ts(s){return(180+s)/360}function fa(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function ea(s,r){return s/rl(r)}function mc(s){return 360*s-180}function Oo(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function pf(s,r){return s*rl(Oo(r))}const Ma=85.051129;function tp(s){return 1/Math.cos(s*Math.PI/180)}class Gh{constructor(r,l,h=0){this.x=+r,this.y=+l,this.z=+h}static fromLngLat(r,l=0){const h=Qr.convert(r);return new Gh(Ts(h.lng),fa(h.lat),ea(l,h.lat))}toLngLat(){return new Qr(mc(this.x),Oo(this.y))}toAltitude(){return pf(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/dh*tp(Oo(this.y))}}function Ud(s,r,l,h,p,x,w,A,P){const R=(r+h)/2,$=(l+p)/2,X=new q(R,$);A(X),(function(re,he,ye,Se,We,at){const xt=ye-We,lt=Se-at;return Math.abs((Se-he)*xt-(ye-re)*lt)/Math.hypot(xt,lt)})(X.x,X.y,x.x,x.y,w.x,w.y)>=P?(Ud(s,r,l,R,$,x,X,A,P),Ud(s,R,$,h,p,X,w,A,P)):s.push(w)}function cu(s,r,l){let h=s[0],p=h.x,x=h.y;r(h);const w=[h];for(let A=1;A<s.length;A++){const P=s[A],{x:R,y:$}=P;r(P),Ud(w,p,x,R,$,h,P,r,l),p=R,x=$,h=P}return w}function wm(s,r,l,h){if(h(r,l)){const p=r.add(l)._mult(.5);wm(s,r,p,h),wm(s,p,l,h)}else s.push(l)}function Np(s,r){let l=s[0];const h=[l];for(let p=1;p<s.length;p++){const x=s[p];wm(h,l,x,r),l=x}return h}const ld=Math.pow(2,14)-1,Sm=-ld-1;function q0(s,r){const l=Math.round(s.x*r),h=Math.round(s.y*r);return s.x=Fe(l,Sm,ld),s.y=Fe(h,Sm,ld),(l<s.x||l>s.x+1||h<s.y||h>s.y+1)&&mr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function wu(s,r,l){const h=s.loadGeometry(),p=s.extent,x=Jr/p;if(r&&l&&l.projection.isReprojectedInTileSpace){const w=1<<r.z,{scale:A,x:P,y:R,projection:$}=l,X=re=>{const he=mc((r.x+re.x/p)/w),ye=Oo((r.y+re.y/p)/w),Se=$.project(he,ye);re.x=(Se.x*A-P)*p,re.y=(Se.y*A-R)*p};for(let re=0;re<h.length;re++)if(s.type!==1)h[re]=cu(h[re],X,1);else{const he=[];for(const ye of h[re])ye.x<0||ye.x>=p||ye.y<0||ye.y>=p||(X(ye),he.push(ye));h[re]=he}}for(const w of h)for(const A of w)q0(A,x);return h}function Ad(s,r){return{type:s.type,id:s.id,properties:s.properties,geometry:r?wu(s):[]}}function cd(s,r,l,h,p){s.emplaceBack(2*r+(h+1)/2,2*l+(p+1)/2)}function np(s,r,l){s.emplaceBack(r.x,r.y,r.z,l[0]*16384,l[1]*16384,l[2]*16384)}class rp{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((l=>l.id)),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new mn,this.indexArray=new Sr,this.segments=new Ra,this.programConfigurations=new Vu(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter((l=>l.isStateDependent())).map((l=>l.id))}populate(r,l,h,p){const x=this.layers[0],w=[];let A=null;x.type==="circle"&&(A=x.layout.get("circle-sort-key"));for(const{feature:R,id:$,index:X,sourceLayerIndex:re}of r){const he=this.layers[0]._featureFilter.needGeometry,ye=Ad(R,he);if(!this.layers[0]._featureFilter.filter(new G(this.zoom),ye,h))continue;const Se=A?A.evaluate(ye,{},h):void 0,We={id:$,properties:R.properties,type:R.type,sourceLayerIndex:re,index:X,geometry:he?ye.geometry:wu(R,h,p),patterns:{},sortKey:Se};w.push(We)}A&&w.sort(((R,$)=>R.sortKey-$.sortKey));let P=null;p.projection.name==="globe"&&(this.globeExtVertexArray=new In,P=p.projection);for(const R of w){const{geometry:$,index:X,sourceLayerIndex:re}=R,he=r[X].feature;this.addFeature(R,$,X,l.availableImages,h,P),l.featureIndex.insert(he,$,X,re,this.index)}}update(r,l,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,hf.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,xg.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(r,l,h,p,x,w){for(const A of l)for(const P of A){const R=P.x,$=P.y;if(R<0||R>=Jr||$<0||$>=Jr)continue;if(w){const he=w.projectTilePoint(R,$,x),ye=w.upVector(x,R,$),Se=this.globeExtVertexArray;np(Se,he,ye),np(Se,he,ye),np(Se,he,ye),np(Se,he,ye)}const X=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),re=X.vertexLength;cd(this.layoutVertexArray,R,$,-1,-1),cd(this.layoutVertexArray,R,$,1,-1),cd(this.layoutVertexArray,R,$,1,1),cd(this.layoutVertexArray,R,$,-1,1),this.indexArray.emplaceBack(re,re+1,re+2),this.indexArray.emplaceBack(re,re+2,re+3),X.vertexLength+=4,X.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,{},p,x)}}function wg(s,r){for(let l=0;l<s.length;l++)if(Vd(r,s[l]))return!0;for(let l=0;l<r.length;l++)if(Vd(s,r[l]))return!0;return!!Td(s,r)}function Sg(s,r,l){return!!Vd(s,r)||!!Su(r,s,l)}function Em(s,r){if(s.length===1)return Eg(r,s[0]);for(let l=0;l<r.length;l++){const h=r[l];for(let p=0;p<h.length;p++)if(Vd(s,h[p]))return!0}for(let l=0;l<s.length;l++)if(Eg(r,s[l]))return!0;for(let l=0;l<r.length;l++)if(Td(s,r[l]))return!0;return!1}function $u(s,r,l){if(s.length>1){if(Td(s,r))return!0;for(let h=0;h<r.length;h++)if(Su(r[h],s,l))return!0}for(let h=0;h<s.length;h++)if(Su(s[h],r,l))return!0;return!1}function Td(s,r){if(s.length===0||r.length===0)return!1;for(let l=0;l<s.length-1;l++){const h=s[l],p=s[l+1];for(let x=0;x<r.length-1;x++)if(ud(h,p,r[x],r[x+1]))return!0}return!1}function ud(s,r,l,h){return Er(s,l,h)!==Er(r,l,h)&&Er(s,r,l)!==Er(s,r,h)}function Su(s,r,l){const h=l*l;if(r.length===1)return s.distSqr(r[0])<h;for(let p=1;p<r.length;p++)if($0(s,r[p-1],r[p])<h)return!0;return!1}function $0(s,r,l){const h=r.distSqr(l);if(h===0)return s.distSqr(r);const p=((s.x-r.x)*(l.x-r.x)+(s.y-r.y)*(l.y-r.y))/h;return s.distSqr(p<0?r:p>1?l:l.sub(r)._mult(p)._add(r))}function Eg(s,r){let l,h,p,x=!1;for(let w=0;w<s.length;w++){l=s[w];for(let A=0,P=l.length-1;A<l.length;P=A++)h=l[A],p=l[P],h.y>r.y!=p.y>r.y&&r.x<(p.x-h.x)*(r.y-h.y)/(p.y-h.y)+h.x&&(x=!x)}return x}function Vd(s,r){let l=!1;for(let h=0,p=s.length-1;h<s.length;p=h++){const x=s[h],w=s[p];x.y>r.y!=w.y>r.y&&r.x<(w.x-x.x)*(r.y-x.y)/(w.y-x.y)+x.x&&(l=!l)}return l}function B_(s,r,l,h,p){for(const w of s)if(r<=w.x&&l<=w.y&&h>=w.x&&p>=w.y)return!0;const x=[new q(r,l),new q(r,p),new q(h,p),new q(h,l)];if(s.length>2){for(const w of x)if(Vd(s,w))return!0}for(let w=0;w<s.length-1;w++)if(mf(s[w],s[w+1],x))return!0;return!1}function mf(s,r,l){const h=l[0],p=l[2];if(s.x<h.x&&r.x<h.x||s.x>p.x&&r.x>p.x||s.y<h.y&&r.y<h.y||s.y>p.y&&r.y>p.y)return!1;const x=Er(s,r,l[0]);return x!==Er(s,r,l[1])||x!==Er(s,r,l[2])||x!==Er(s,r,l[3])}function ip(s,r,l){const h=r.paint.get(s).value;return h.kind==="constant"?h.value:l.programConfigurations.get(r.id).getMaxValue(s)}function Dp(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function gf(s,r,l,h,p){if(!r[0]&&!r[1])return s;const x=q.convert(r)._mult(p);l==="viewport"&&x._rotate(-h);const w=[];for(let A=0;A<s.length;A++)w.push(s[A].sub(x));return w}function Ag(s,r,l,h){const p=q.convert(s)._mult(h);return r==="viewport"&&p._rotate(-l),p}hr(rp,"CircleBucket",{omit:["layers"]});const op=new ot({"circle-sort-key":new $e(dn.layout_circle["circle-sort-key"])});var z_={paint:new ot({"circle-radius":new $e(dn.paint_circle["circle-radius"]),"circle-color":new $e(dn.paint_circle["circle-color"]),"circle-blur":new $e(dn.paint_circle["circle-blur"]),"circle-opacity":new $e(dn.paint_circle["circle-opacity"]),"circle-translate":new _e(dn.paint_circle["circle-translate"]),"circle-translate-anchor":new _e(dn.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new _e(dn.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new _e(dn.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new $e(dn.paint_circle["circle-stroke-width"]),"circle-stroke-color":new $e(dn.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new $e(dn.paint_circle["circle-stroke-opacity"])}),layout:op};function G0(s,r,l,h,p,x,w,A,P){if(x&&s.queryGeometry.isAboveHorizon)return!1;x&&(P*=s.pixelToTileUnitsFactor);const R=s.tileID.canonical,$=l.projection.upVectorScale(R,l.center.lat,l.worldSize).metersToTile;for(const X of r)for(const re of X){const he=re.add(A),ye=p&&l.elevation?l.elevation.exaggeration()*p.getElevationAt(he.x,he.y,!0):0,Se=l.projection.projectTilePoint(he.x,he.y,R);if(ye>0){const lt=l.projection.upVector(R,he.x,he.y);Se.x+=lt[0]*$*ye,Se.y+=lt[1]*$*ye,Se.z+=lt[2]*$*ye}const We=x?he:H0(Se.x,Se.y,Se.z,h),at=x?s.tilespaceRays.map((lt=>Ax(lt,ye))):s.queryGeometry.screenGeometry,xt=$n([],[Se.x,Se.y,Se.z,1],h);if(!w&&x?P*=xt[3]/l.cameraToCenterDistance:w&&!x&&(P*=l.cameraToCenterDistance/xt[3]),x){const lt=Oo((re.y/Jr+R.y)/(1<<R.z));P/=l.projection.pixelsPerMeter(lt,1)/ea(1,lt)}if(Sg(at,We,P))return!0}return!1}function H0(s,r,l,h){const p=$n([],[s,r,l,1],h);return new q(p[0]/p[3],p[1]/p[3])}const Am=Sd(0,0,0),Ex=Sd(0,0,1);function Ax(s,r){const l=ep();return Am[2]=r,s.intersectsPlane(Am,Ex,l),new q(l[0],l[1])}class W0 extends rp{}function K0(s,{width:r,height:l},h,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==r*l*h)throw new RangeError("mismatched image size")}else p=new Uint8Array(r*l*h);return s.width=r,s.height=l,s.data=p,s}function yf(s,r,l){const{width:h,height:p}=r;h===s.width&&p===s.height||(X0(s,r,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,h),height:Math.min(s.height,p)},l),s.width=h,s.height=p,s.data=r.data)}function X0(s,r,l,h,p,x){if(p.width===0||p.height===0)return r;if(p.width>s.width||p.height>s.height||l.x>s.width-p.width||l.y>s.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>r.width||p.height>r.height||h.x>r.width-p.width||h.y>r.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const w=s.data,A=r.data;for(let P=0;P<p.height;P++){const R=((l.y+P)*s.width+l.x)*x,$=((h.y+P)*r.width+h.x)*x;for(let X=0;X<p.width*x;X++)A[$+X]=w[R+X]}return r}hr(W0,"HeatmapBucket",{omit:["layers"]});class fh{constructor(r,l){K0(this,r,1,l)}resize(r){yf(this,new fh(r),1)}clone(){return new fh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,l,h,p,x){X0(r,l,h,p,x,1)}}class Gu{constructor(r,l){K0(this,r,4,l)}resize(r){yf(this,new Gu(r),4)}replace(r,l){l?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new Gu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,l,h,p,x){X0(r,l,h,p,x,4)}}hr(fh,"AlphaImage"),hr(Gu,"RGBAImage");var Pl={paint:new ot({"heatmap-radius":new $e(dn.paint_heatmap["heatmap-radius"]),"heatmap-weight":new $e(dn.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new _e(dn.paint_heatmap["heatmap-intensity"]),"heatmap-color":new it(dn.paint_heatmap["heatmap-color"]),"heatmap-opacity":new _e(dn.paint_heatmap["heatmap-opacity"])})};function Z0(s){const r={},l=s.resolution||256,h=s.clips?s.clips.length:1,p=s.image||new Gu({width:l,height:h}),x=(w,A,P)=>{r[s.evaluationKey]=P;const R=s.expression.evaluate(r);p.data[w+A+0]=Math.floor(255*R.r/R.a),p.data[w+A+1]=Math.floor(255*R.g/R.a),p.data[w+A+2]=Math.floor(255*R.b/R.a),p.data[w+A+3]=Math.floor(255*R.a)};if(s.clips)for(let w=0,A=0;w<h;++w,A+=4*l)for(let P=0,R=0;P<l;P++,R+=4){const $=P/(l-1),{start:X,end:re}=s.clips[w];x(A,R,X*(1-$)+re*$)}else for(let w=0,A=0;w<l;w++,A+=4)x(0,A,w/(l-1));return p}var j_={paint:new ot({"hillshade-illumination-direction":new _e(dn.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new _e(dn.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new _e(dn.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new _e(dn.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new _e(dn.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new _e(dn.paint_hillshade["hillshade-accent-color"])})};const Tx=Lt([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ix}=Tx;var Tg={exports:{}};function Tm(s,r,l){l=l||2;var h,p,x,w,A,P,R,$=r&&r.length,X=$?r[0]*l:s.length,re=U_(s,0,X,l,!0),he=[];if(!re||re.next===re.prev)return he;if($&&(re=(function(Se,We,at,xt){var lt,_t,It,Tt=[];for(lt=0,_t=We.length;lt<_t;lt++)(It=U_(Se,We[lt]*xt,lt<_t-1?We[lt+1]*xt:Se.length,xt,!1))===It.next&&(It.steiner=!0),Tt.push(ey(It));for(Tt.sort(Cg),lt=0;lt<Tt.length;lt++)at=Y0(Tt[lt],at);return at})(s,r,re,l)),s.length>80*l){h=x=s[0],p=w=s[1];for(var ye=l;ye<X;ye+=l)(A=s[ye])<h&&(h=A),(P=s[ye+1])<p&&(p=P),A>x&&(x=A),P>w&&(w=P);R=(R=Math.max(x-h,w-p))!==0?32767/R:0}return sp(re,he,l,h,p,R,0),he}function U_(s,r,l,h,p){var x,w;if(p===Bp(s,r,l,h)>0)for(x=r;x<l;x+=h)w=Lg(x,s[x],s[x+1],w);else for(x=l-h;x>=r;x-=h)w=Lg(x,s[x],s[x+1],w);return w&&lp(w,w.next)&&(vf(w),w=w.next),w}function Kc(s,r){if(!s)return s;r||(r=s);var l,h=s;do if(l=!1,h.steiner||!lp(h,h.next)&&il(h.prev,h,h.next)!==0)h=h.next;else{if(vf(h),(h=r=h.prev)===h.next)break;l=!0}while(l||h!==r);return r}function sp(s,r,l,h,p,x,w){if(s){!w&&x&&(function($,X,re,he){var ye=$;do ye.z===0&&(ye.z=Q0(ye.x,ye.y,X,re,he)),ye.prevZ=ye.prev,ye.nextZ=ye.next,ye=ye.next;while(ye!==$);ye.prevZ.nextZ=null,ye.prevZ=null,(function(Se){var We,at,xt,lt,_t,It,Tt,sn,nn=1;do{for(at=Se,Se=null,_t=null,It=0;at;){for(It++,xt=at,Tt=0,We=0;We<nn&&(Tt++,xt=xt.nextZ);We++);for(sn=nn;Tt>0||sn>0&&xt;)Tt!==0&&(sn===0||!xt||at.z<=xt.z)?(lt=at,at=at.nextZ,Tt--):(lt=xt,xt=xt.nextZ,sn--),_t?_t.nextZ=lt:Se=lt,lt.prevZ=_t,_t=lt;at=xt}_t.nextZ=null,nn*=2}while(It>1)})(ye)})(s,h,p,x);for(var A,P,R=s;s.prev!==s.next;)if(A=s.prev,P=s.next,x?_f(s,h,p,x):Cx(s))r.push(A.i/l|0),r.push(s.i/l|0),r.push(P.i/l|0),vf(s),s=P.next,R=P.next;else if((s=P)===R){w?w===1?sp(s=Ig(Kc(s),r,l),r,l,h,p,x,2):w===2&&ap(s,r,l,h,p,x):sp(Kc(s),r,l,h,p,x,1);break}}}function Cx(s){var r=s.prev,l=s,h=s.next;if(il(r,l,h)>=0)return!1;for(var p=r.x,x=l.x,w=h.x,A=r.y,P=l.y,R=h.y,$=p<x?p<w?p:w:x<w?x:w,X=A<P?A<R?A:R:P<R?P:R,re=p>x?p>w?p:w:x>w?x:w,he=A>P?A>R?A:R:P>R?P:R,ye=h.next;ye!==r;){if(ye.x>=$&&ye.x<=re&&ye.y>=X&&ye.y<=he&&Fp(p,A,x,P,w,R,ye.x,ye.y)&&il(ye.prev,ye,ye.next)>=0)return!1;ye=ye.next}return!0}function _f(s,r,l,h){var p=s.prev,x=s,w=s.next;if(il(p,x,w)>=0)return!1;for(var A=p.x,P=x.x,R=w.x,$=p.y,X=x.y,re=w.y,he=A<P?A<R?A:R:P<R?P:R,ye=$<X?$<re?$:re:X<re?X:re,Se=A>P?A>R?A:R:P>R?P:R,We=$>X?$>re?$:re:X>re?X:re,at=Q0(he,ye,r,l,h),xt=Q0(Se,We,r,l,h),lt=s.prevZ,_t=s.nextZ;lt&&lt.z>=at&&_t&&_t.z<=xt;){if(lt.x>=he&&lt.x<=Se&&lt.y>=ye&&lt.y<=We&&lt!==p&&lt!==w&&Fp(A,$,P,X,R,re,lt.x,lt.y)&&il(lt.prev,lt,lt.next)>=0||(lt=lt.prevZ,_t.x>=he&&_t.x<=Se&&_t.y>=ye&&_t.y<=We&&_t!==p&&_t!==w&&Fp(A,$,P,X,R,re,_t.x,_t.y)&&il(_t.prev,_t,_t.next)>=0))return!1;_t=_t.nextZ}for(;lt&&lt.z>=at;){if(lt.x>=he&&lt.x<=Se&&lt.y>=ye&&lt.y<=We&&lt!==p&&lt!==w&&Fp(A,$,P,X,R,re,lt.x,lt.y)&&il(lt.prev,lt,lt.next)>=0)return!1;lt=lt.prevZ}for(;_t&&_t.z<=xt;){if(_t.x>=he&&_t.x<=Se&&_t.y>=ye&&_t.y<=We&&_t!==p&&_t!==w&&Fp(A,$,P,X,R,re,_t.x,_t.y)&&il(_t.prev,_t,_t.next)>=0)return!1;_t=_t.nextZ}return!0}function Ig(s,r,l){var h=s;do{var p=h.prev,x=h.next.next;!lp(p,x)&&Im(p,h,h.next,x)&&Lm(p,x)&&Lm(x,p)&&(r.push(p.i/l|0),r.push(h.i/l|0),r.push(x.i/l|0),vf(h),vf(h.next),h=s=x),h=h.next}while(h!==s);return Kc(h)}function ap(s,r,l,h,p,x){var w=s;do{for(var A=w.next.next;A!==w.prev;){if(w.i!==A.i&&V_(w,A)){var P=ty(w,A);return w=Kc(w,w.next),P=Kc(P,P.next),sp(w,r,l,h,p,x,0),void sp(P,r,l,h,p,x,0)}A=A.next}w=w.next}while(w!==s)}function Cg(s,r){return s.x-r.x}function Y0(s,r){var l=(function(p,x){var w,A=x,P=p.x,R=p.y,$=-1/0;do{if(R<=A.y&&R>=A.next.y&&A.next.y!==A.y){var X=A.x+(R-A.y)*(A.next.x-A.x)/(A.next.y-A.y);if(X<=P&&X>$&&($=X,w=A.x<A.next.x?A:A.next,X===P))return w}A=A.next}while(A!==x);if(!w)return null;var re,he=w,ye=w.x,Se=w.y,We=1/0;A=w;do P>=A.x&&A.x>=ye&&P!==A.x&&Fp(R<Se?P:$,R,ye,Se,R<Se?$:P,R,A.x,A.y)&&(re=Math.abs(R-A.y)/(P-A.x),Lm(A,p)&&(re<We||re===We&&(A.x>w.x||A.x===w.x&&J0(w,A)))&&(w=A,We=re)),A=A.next;while(A!==he);return w})(s,r);if(!l)return r;var h=ty(l,s);return Kc(h,h.next),Kc(l,l.next)}function J0(s,r){return il(s.prev,s,r.prev)<0&&il(r.next,s,s.next)<0}function Q0(s,r,l,h,p){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-l)*p|0)|s<<8))|s<<4))|s<<2))|s<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-h)*p|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function ey(s){var r=s,l=s;do(r.x<l.x||r.x===l.x&&r.y<l.y)&&(l=r),r=r.next;while(r!==s);return l}function Fp(s,r,l,h,p,x,w,A){return(p-w)*(r-A)>=(s-w)*(x-A)&&(s-w)*(h-A)>=(l-w)*(r-A)&&(l-w)*(x-A)>=(p-w)*(h-A)}function V_(s,r){return s.next.i!==r.i&&s.prev.i!==r.i&&!(function(l,h){var p=l;do{if(p.i!==l.i&&p.next.i!==l.i&&p.i!==h.i&&p.next.i!==h.i&&Im(p,p.next,l,h))return!0;p=p.next}while(p!==l);return!1})(s,r)&&(Lm(s,r)&&Lm(r,s)&&(function(l,h){var p=l,x=!1,w=(l.x+h.x)/2,A=(l.y+h.y)/2;do p.y>A!=p.next.y>A&&p.next.y!==p.y&&w<(p.next.x-p.x)*(A-p.y)/(p.next.y-p.y)+p.x&&(x=!x),p=p.next;while(p!==l);return x})(s,r)&&(il(s.prev,s,r.prev)||il(s,r.prev,r))||lp(s,r)&&il(s.prev,s,s.next)>0&&il(r.prev,r,r.next)>0)}function il(s,r,l){return(r.y-s.y)*(l.x-r.x)-(r.x-s.x)*(l.y-r.y)}function lp(s,r){return s.x===r.x&&s.y===r.y}function Im(s,r,l,h){var p=Op(il(s,r,l)),x=Op(il(s,r,h)),w=Op(il(l,h,s)),A=Op(il(l,h,r));return p!==x&&w!==A||!(p!==0||!Cm(s,l,r))||!(x!==0||!Cm(s,h,r))||!(w!==0||!Cm(l,s,h))||!(A!==0||!Cm(l,r,h))}function Cm(s,r,l){return r.x<=Math.max(s.x,l.x)&&r.x>=Math.min(s.x,l.x)&&r.y<=Math.max(s.y,l.y)&&r.y>=Math.min(s.y,l.y)}function Op(s){return s>0?1:s<0?-1:0}function Lm(s,r){return il(s.prev,s,s.next)<0?il(s,r,s.next)>=0&&il(s,s.prev,r)>=0:il(s,r,s.prev)<0||il(s,s.next,r)<0}function ty(s,r){var l=new Pm(s.i,s.x,s.y),h=new Pm(r.i,r.x,r.y),p=s.next,x=r.prev;return s.next=r,r.prev=s,l.next=p,p.prev=l,h.next=l,l.prev=h,x.next=h,h.prev=x,h}function Lg(s,r,l,h){var p=new Pm(s,r,l);return h?(p.next=h.next,p.prev=h,h.next.prev=p,h.next=p):(p.prev=p,p.next=p),p}function vf(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Pm(s,r,l){this.i=s,this.x=r,this.y=l,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Bp(s,r,l,h){for(var p=0,x=r,w=l-h;x<l;x+=h)p+=(s[w]-s[x])*(s[x+1]+s[w+1]),w=x;return p}Tg.exports=Tm,Tg.exports.default=Tm,Tm.deviation=function(s,r,l,h){var p=r&&r.length,x=Math.abs(Bp(s,0,p?r[0]*l:s.length,l));if(p)for(var w=0,A=r.length;w<A;w++)x-=Math.abs(Bp(s,r[w]*l,w<A-1?r[w+1]*l:s.length,l));var P=0;for(w=0;w<h.length;w+=3){var R=h[w]*l,$=h[w+1]*l,X=h[w+2]*l;P+=Math.abs((s[R]-s[X])*(s[$+1]-s[R+1])-(s[R]-s[$])*(s[X+1]-s[R+1]))}return x===0&&P===0?0:Math.abs((P-x)/x)},Tm.flatten=function(s){for(var r=s[0][0].length,l={vertices:[],holes:[],dimensions:r},h=0,p=0;p<s.length;p++){for(var x=0;x<s[p].length;x++)for(var w=0;w<r;w++)l.vertices.push(s[p][x][w]);p>0&&l.holes.push(h+=s[p-1].length)}return l};var Pg=ue(Tg.exports);function Lx(s,r,l,h,p){km(s,r,l,h||s.length-1,p||Mm)}function km(s,r,l,h,p){for(;h>l;){if(h-l>600){var x=h-l+1,w=r-l+1,A=Math.log(x),P=.5*Math.exp(2*A/3),R=.5*Math.sqrt(A*P*(x-P)/x)*(w-x/2<0?-1:1);km(s,r,Math.max(l,Math.floor(r-w*P/x+R)),Math.min(h,Math.floor(r+(x-w)*P/x+R)),p)}var $=s[r],X=l,re=h;for(Rm(s,l,r),p(s[h],$)>0&&Rm(s,l,h);X<re;){for(Rm(s,X,re),X++,re--;p(s[X],$)<0;)X++;for(;p(s[re],$)>0;)re--}p(s[l],$)===0?Rm(s,l,re):Rm(s,++re,h),re<=r&&(l=re+1),r<=re&&(h=re-1)}}function Rm(s,r,l){var h=s[r];s[r]=s[l],s[l]=h}function Mm(s,r){return s<r?-1:s>r?1:0}function ny(s,r){const l=s.length;if(l<=1)return[s];const h=[];let p,x;for(let w=0;w<l;w++){const A=Cr(s[w]);A!==0&&(s[w].area=Math.abs(A),x===void 0&&(x=A<0),x===A<0?(p&&h.push(p),p=[s[w]]):p.push(s[w]))}if(p&&h.push(p),r>1)for(let w=0;w<h.length;w++)h[w].length<=r||(Lx(h[w],r,1,h[w].length-1,kg),h[w]=h[w].slice(0,r));return h}function kg(s,r){return r.area-s.area}function d(s,r,l){const h=l.patternDependencies;let p=!1;for(const x of r){const w=x.paint.get(`${s}-pattern`);w.isConstant()||(p=!0);const A=w.constantOr(null);A&&(p=!0,h[A]=!0)}return p}function g(s,r,l,h,p){const x=p.patternDependencies;for(const w of r){const A=w.paint.get(`${s}-pattern`).value;if(A.kind!=="constant"){let P=A.evaluate({zoom:h},l,{},p.availableImages);P=P&&P.name?P.name:P,x[P]=!0,l.patterns[w.id]=P}}return l}class E{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((l=>l.id)),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new mn,this.indexArray=new Sr,this.indexArray2=new ts,this.programConfigurations=new Vu(r.layers,r.zoom),this.segments=new Ra,this.segments2=new Ra,this.stateDependentLayerIds=this.layers.filter((l=>l.isStateDependent())).map((l=>l.id)),this.projection=r.projection}populate(r,l,h,p){this.hasPattern=d("fill",this.layers,l);const x=this.layers[0].layout.get("fill-sort-key"),w=[];for(const{feature:A,id:P,index:R,sourceLayerIndex:$}of r){const X=this.layers[0]._featureFilter.needGeometry,re=Ad(A,X);if(!this.layers[0]._featureFilter.filter(new G(this.zoom),re,h))continue;const he=x?x.evaluate(re,{},h,l.availableImages):void 0,ye={id:P,properties:A.properties,type:A.type,sourceLayerIndex:$,index:R,geometry:X?re.geometry:wu(A,h,p),patterns:{},sortKey:he};w.push(ye)}x&&w.sort(((A,P)=>A.sortKey-P.sortKey));for(const A of w){const{geometry:P,index:R,sourceLayerIndex:$}=A;if(this.hasPattern){const X=g("fill",this.layers,A,this.zoom,l);this.patternFeatures.push(X)}else this.addFeature(A,P,R,h,{},l.availableImages);l.featureIndex.insert(r[R].feature,P,R,$,this.index)}}update(r,l,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,h,p)}addFeatures(r,l,h,p,x){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,l,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Ix),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,l,h,p,x,w=[]){for(const A of ny(l,500)){let P=0;for(const ye of A)P+=ye.length;const R=this.segments.prepareSegment(P,this.layoutVertexArray,this.indexArray),$=R.vertexLength,X=[],re=[];for(const ye of A){if(ye.length===0)continue;ye!==A[0]&&re.push(X.length/2);const Se=this.segments2.prepareSegment(ye.length,this.layoutVertexArray,this.indexArray2),We=Se.vertexLength;this.layoutVertexArray.emplaceBack(ye[0].x,ye[0].y),this.indexArray2.emplaceBack(We+ye.length-1,We),X.push(ye[0].x),X.push(ye[0].y);for(let at=1;at<ye.length;at++)this.layoutVertexArray.emplaceBack(ye[at].x,ye[at].y),this.indexArray2.emplaceBack(We+at-1,We+at),X.push(ye[at].x),X.push(ye[at].y);Se.vertexLength+=ye.length,Se.primitiveLength+=ye.length}const he=Pg(X,re);for(let ye=0;ye<he.length;ye+=3)this.indexArray.emplaceBack($+he[ye],$+he[ye+1],$+he[ye+2]);R.vertexLength+=P,R.primitiveLength+=he.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,x,w,p)}}hr(E,"FillBucket",{omit:["layers","patternFeatures"]});const D=new ot({"fill-sort-key":new $e(dn.layout_fill["fill-sort-key"])});var K={paint:new ot({"fill-antialias":new _e(dn.paint_fill["fill-antialias"]),"fill-opacity":new $e(dn.paint_fill["fill-opacity"]),"fill-color":new $e(dn.paint_fill["fill-color"]),"fill-outline-color":new $e(dn.paint_fill["fill-outline-color"]),"fill-translate":new _e(dn.paint_fill["fill-translate"]),"fill-translate-anchor":new _e(dn.paint_fill["fill-translate-anchor"]),"fill-pattern":new $e(dn.paint_fill["fill-pattern"])}),layout:D};const ce=Lt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Ve=Lt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),St=Lt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Ot}=ce;var _n={},rr=U,cr=Hn;function Hn(s,r,l,h,p){this.properties={},this.extent=l,this.type=0,this._pbf=s,this._geometry=-1,this._keys=h,this._values=p,s.readFields(Zr,this,r)}function Zr(s,r,l){s==1?r.id=l.readVarint():s==2?(function(h,p){for(var x=h.readVarint()+h.pos;h.pos<x;){var w=p._keys[h.readVarint()],A=p._values[h.readVarint()];p.properties[w]=A}})(l,r):s==3?r.type=l.readVarint():s==4&&(r._geometry=l.pos)}function ii(s){for(var r,l,h=0,p=0,x=s.length,w=x-1;p<x;w=p++)h+=((l=s[w]).x-(r=s[p]).x)*(r.y+l.y);return h}Hn.types=["Unknown","Point","LineString","Polygon"],Hn.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var r,l=s.readVarint()+s.pos,h=1,p=0,x=0,w=0,A=[];s.pos<l;){if(p<=0){var P=s.readVarint();h=7&P,p=P>>3}if(p--,h===1||h===2)x+=s.readSVarint(),w+=s.readSVarint(),h===1&&(r&&A.push(r),r=[]),r.push(new rr(x,w));else{if(h!==7)throw new Error("unknown command "+h);r&&r.push(r[0].clone())}}return r&&A.push(r),A},Hn.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var r=s.readVarint()+s.pos,l=1,h=0,p=0,x=0,w=1/0,A=-1/0,P=1/0,R=-1/0;s.pos<r;){if(h<=0){var $=s.readVarint();l=7&$,h=$>>3}if(h--,l===1||l===2)(p+=s.readSVarint())<w&&(w=p),p>A&&(A=p),(x+=s.readSVarint())<P&&(P=x),x>R&&(R=x);else if(l!==7)throw new Error("unknown command "+l)}return[w,P,A,R]},Hn.prototype.toGeoJSON=function(s,r,l){var h,p,x=this.extent*Math.pow(2,l),w=this.extent*s,A=this.extent*r,P=this.loadGeometry(),R=Hn.types[this.type];function $(he){for(var ye=0;ye<he.length;ye++){var Se=he[ye];he[ye]=[360*(Se.x+w)/x-180,360/Math.PI*Math.atan(Math.exp((180-360*(Se.y+A)/x)*Math.PI/180))-90]}}switch(this.type){case 1:var X=[];for(h=0;h<P.length;h++)X[h]=P[h][0];$(P=X);break;case 2:for(h=0;h<P.length;h++)$(P[h]);break;case 3:for(P=(function(he){var ye=he.length;if(ye<=1)return[he];for(var Se,We,at=[],xt=0;xt<ye;xt++){var lt=ii(he[xt]);lt!==0&&(We===void 0&&(We=lt<0),We===lt<0?(Se&&at.push(Se),Se=[he[xt]]):Se.push(he[xt]))}return Se&&at.push(Se),at})(P),h=0;h<P.length;h++)for(p=0;p<P[h].length;p++)$(P[h][p])}P.length===1?P=P[0]:R="Multi"+R;var re={type:"Feature",geometry:{type:R,coordinates:P},properties:this.properties};return"id"in this&&(re.id=this.id),re};var fi=cr,kl=ln;function ln(s,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(Wt,this,r),this.length=this._features.length}function Wt(s,r,l){s===15?r.version=l.readVarint():s===1?r.name=l.readString():s===5?r.extent=l.readVarint():s===2?r._features.push(l.pos):s===3?r._keys.push(l.readString()):s===4&&r._values.push((function(h){for(var p=null,x=h.readVarint()+h.pos;h.pos<x;){var w=h.readVarint()>>3;p=w===1?h.readString():w===2?h.readFloat():w===3?h.readDouble():w===4?h.readVarint64():w===5?h.readVarint():w===6?h.readSVarint():w===7?h.readBoolean():null}return p})(l))}ln.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var r=this._pbf.readVarint()+this._pbf.pos;return new fi(this._pbf,r,this.extent,this._keys,this._values)};var fn=kl;function xr(s,r,l){if(s===3){var h=new fn(l,l.readVarint()+l.pos);h.length&&(r[h.name]=h)}}var pi=_n.VectorTile=function(s,r){this.layers=s.readFields(xr,{},r)},Fi=_n.VectorTileFeature=cr;function Oi(s,r,l,h){const p=[],x=h===0?(w,A,P,R,$,X)=>{w.push(new q(X,P+(X-A)/(R-A)*($-P)))}:(w,A,P,R,$,X)=>{w.push(new q(A+(X-P)/($-P)*(R-A),X))};for(const w of s){const A=[];for(const P of w){if(P.length<=2)continue;const R=[];for(let re=0;re<P.length-1;re++){const he=P[re].x,ye=P[re].y,Se=P[re+1].x,We=P[re+1].y,at=h===0?he:ye,xt=h===0?Se:We;at<r?xt>r&&x(R,he,ye,Se,We,r):at>l?xt<l&&x(R,he,ye,Se,We,l):R.push(P[re]),xt<r&&at>=r&&x(R,he,ye,Se,We,r),xt>l&&at<=l&&x(R,he,ye,Se,We,l)}let $=P[P.length-1];const X=h===0?$.x:$.y;X>=r&&X<=l&&R.push($),R.length&&($=R[R.length-1],R[0].x===$.x&&R[0].y===$.y||R.push(R[0]),A.push(R))}A.length&&p.push(A)}return p}_n.VectorTileLayer=kl;const to=Fi.types,Xc=Math.pow(2,13);function rs(s,r,l,h,p,x,w,A){s.emplaceBack((r<<1)+w,(l<<1)+x,(Math.floor(h*Xc)<<1)+p,Math.round(A))}function Hh(s,r,l){s.emplaceBack(r.x,r.y,r.z,l[0]*16384,l[1]*16384,l[2]*16384)}class q_{constructor(){this.acc=new q(0,0),this.polyCount=[]}startRing(r){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new q(r.x,r.y),this.max=new q(r.x,r.y))}append(r,l){this.currentPolyCount.edges++,this.acc._add(r);const h=this.min,p=this.max;r.x<h.x?h.x=r.x:r.x>p.x&&(p.x=r.x),r.y<h.y?h.y=r.y:r.y>p.y&&(p.y=r.y),((r.x===0||r.x===Jr)&&r.x===l.x)!=((r.y===0||r.y===Jr)&&r.y===l.y)&&this.processBorderOverlap(r,l),l.x<0!=r.x<0&&this.addBorderIntersection(0,Ge(l.y,r.y,(0-l.x)/(r.x-l.x))),l.x>Jr!=r.x>Jr&&this.addBorderIntersection(1,Ge(l.y,r.y,(Jr-l.x)/(r.x-l.x))),l.y<0!=r.y<0&&this.addBorderIntersection(2,Ge(l.x,r.x,(0-l.y)/(r.y-l.y))),l.y>Jr!=r.y>Jr&&this.addBorderIntersection(3,Ge(l.x,r.x,(Jr-l.y)/(r.y-l.y)))}addBorderIntersection(r,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const h=this.borders[r];l<h[0]&&(h[0]=l),l>h[1]&&(h[1]=l)}processBorderOverlap(r,l){if(r.x===l.x){if(r.y===l.y)return;const h=r.x===0?0:1;this.addBorderIntersection(h,l.y),this.addBorderIntersection(h,r.y)}else{const h=r.y===0?2:3;this.addBorderIntersection(h,l.x),this.addBorderIntersection(h,r.x)}}centroid(){const r=this.polyCount.reduce(((l,h)=>l+h.edges),0);return r!==0?this.acc.div(r)._round():new q(0,0)}span(){return new q(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce(((r,l)=>r+ +(l[0]!==Number.MAX_VALUE)),0)}}class ry{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((l=>l.id)),this.index=r.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=r.projection,this.layoutVertexArray=new an,this.centroidVertexArray=new $l,this.indexArray=new Sr,this.programConfigurations=new Vu(r.layers,r.zoom),this.segments=new Ra,this.stateDependentLayerIds=this.layers.filter((l=>l.isStateDependent())).map((l=>l.id)),this.enableTerrain=r.enableTerrain}populate(r,l,h,p){this.features=[],this.hasPattern=d("fill-extrusion",this.layers,l),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=(function(x){const w=Math.exp(Math.PI*(1-x.y/(1<<x.z)*2));return 80150034*w/(w*w+1)/Jr/(1<<x.z)})(h),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:x,id:w,index:A,sourceLayerIndex:P}of r){const R=this.layers[0]._featureFilter.needGeometry,$=Ad(x,R);if(!this.layers[0]._featureFilter.filter(new G(this.zoom),$,h))continue;const X={id:w,sourceLayerIndex:P,index:A,geometry:R?$.geometry:wu(x,h,p),properties:x.properties,type:x.type,patterns:{}},re=this.layoutVertexArray.length;this.hasPattern?this.features.push(g("fill-extrusion",this.layers,X,this.zoom,l)):this.addFeature(X,X.geometry,A,h,{},l.availableImages,p),l.featureIndex.insert(x,X.geometry,A,P,this.index,re)}this.sortBorders()}addFeatures(r,l,h,p,x){for(const w of this.features){const{geometry:A}=w;this.addFeature(w,A,w.index,l,h,p,x)}this.sortBorders()}update(r,l,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Ot),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=r.createVertexBuffer(this.layoutVertexExtArray,St.members,!0))),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,Ve.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,l,h,p,x,w,A){const P=[new q(0,0),new q(Jr,Jr)],R=A.projection,$=R.name==="globe",X=this.enableTerrain&&!$?new q_:null,re=to[r.type]==="Polygon";$&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new In);const he=ny(l,500);for(let at=he.length-1;at>=0;at--){const xt=he[at];(xt.length===0||(ye=xt[0]).every((lt=>lt.x<=0))||ye.every((lt=>lt.x>=Jr))||ye.every((lt=>lt.y<=0))||ye.every((lt=>lt.y>=Jr)))&&he.splice(at,1)}var ye;let Se;if($)Se=Z3(he,P,p);else{Se=[];for(const at of he)Se.push({polygon:at,bounds:P})}const We=re?this.edgeRadius:0;for(const{polygon:at,bounds:xt}of Se){let lt=0,_t=0;for(const Tt of at)re&&!Tt[0].equals(Tt[Tt.length-1])&&Tt.push(Tt[0]),_t+=re?Tt.length-1:Tt.length;const It=this.segments.prepareSegment((re?5:4)*_t,this.layoutVertexArray,this.indexArray);if(re){const Tt=[],sn=[];lt=It.vertexLength;for(const Sn of at){let Vn,un;Sn.length&&Sn!==at[0]&&sn.push(Tt.length/2),Vn=Sn[1].sub(Sn[0])._perp()._unit();for(let kn=1;kn<Sn.length;kn++){const Rn=Sn[kn],zn=Sn[kn===Sn.length-1?1:kn+1];let{x:Kn,y:wn}=Rn;if(We){un=zn.sub(Rn)._perp()._unit();const _r=Vn.add(un)._unit(),Ur=We*Math.min(4,1/(Vn.x*_r.x+Vn.y*_r.y));Kn+=Ur*_r.x,wn+=Ur*_r.y,Vn=un}rs(this.layoutVertexArray,Kn,wn,0,0,1,1,0),It.vertexLength++,Tt.push(Rn.x,Rn.y),$&&Hh(this.layoutVertexExtArray,R.projectTilePoint(Kn,wn,p),R.upVector(p,Kn,wn))}}const nn=Pg(Tt,sn);for(let Sn=0;Sn<nn.length;Sn+=3)this.indexArray.emplaceBack(lt+nn[Sn],lt+nn[Sn+2],lt+nn[Sn+1]),It.primitiveLength++}for(const Tt of at){X&&Tt.length&&X.startRing(Tt[0]);let sn,nn,Sn,Vn=Tt.length>4&&W3(Tt[Tt.length-2],Tt[0],Tt[1]),un=We?PC(Tt[Tt.length-2],Tt[0],Tt[1],We):0;nn=Tt[1].sub(Tt[0])._perp()._unit();let kn=!0;for(let Rn=1,zn=0;Rn<Tt.length;Rn++){let Kn=Tt[Rn-1],wn=Tt[Rn];const _r=Tt[Rn===Tt.length-1?1:Rn+1];if(X&&re&&X.currentPolyCount.top++,H3(wn,Kn,xt)){We&&(nn=_r.sub(wn)._perp()._unit(),kn=!kn);continue}X&&X.append(wn,Kn);const Ur=wn.sub(Kn)._perp(),br=Ur.x/(Math.abs(Ur.x)+Math.abs(Ur.y)),Xi=Ur.y>0?1:0,Zn=Kn.dist(wn);if(zn+Zn>32768&&(zn=0),We){Sn=_r.sub(wn)._perp()._unit();let Yi=G3(Kn,wn,_r,$3(nn,Sn),We);isNaN(Yi)&&(Yi=0);const wi=wn.sub(Kn)._unit();Kn=Kn.add(wi.mult(un))._round(),wn=wn.add(wi.mult(-Yi))._round(),un=Yi,nn=Sn}const ri=It.vertexLength,Zi=Tt.length>4&&W3(Kn,wn,_r);let is=K3(zn,Vn,kn);if(rs(this.layoutVertexArray,Kn.x,Kn.y,br,Xi,0,0,is),rs(this.layoutVertexArray,Kn.x,Kn.y,br,Xi,0,1,is),zn+=Zn,is=K3(zn,Zi,!kn),Vn=Zi,rs(this.layoutVertexArray,wn.x,wn.y,br,Xi,0,0,is),rs(this.layoutVertexArray,wn.x,wn.y,br,Xi,0,1,is),It.vertexLength+=4,this.indexArray.emplaceBack(ri+0,ri+1,ri+2),this.indexArray.emplaceBack(ri+1,ri+3,ri+2),It.primitiveLength+=2,We){const Yi=lt+(Rn===1?Tt.length-2:Rn-2),wi=Rn===1?lt:Yi+1;if(this.indexArray.emplaceBack(ri+1,Yi,ri+3),this.indexArray.emplaceBack(Yi,wi,ri+3),It.primitiveLength+=2,sn===void 0&&(sn=ri),!H3(_r,Tt[Rn],xt)){const pa=Rn===Tt.length-1?sn:It.vertexLength;this.indexArray.emplaceBack(ri+2,ri+3,pa),this.indexArray.emplaceBack(ri+3,pa+1,pa),this.indexArray.emplaceBack(ri+3,wi,pa+1),It.primitiveLength+=3}kn=!kn}if($){const Yi=this.layoutVertexExtArray,wi=R.projectTilePoint(Kn.x,Kn.y,p),pa=R.projectTilePoint(wn.x,wn.y,p),Ji=R.upVector(p,Kn.x,Kn.y),Qi=R.upVector(p,wn.x,wn.y);Hh(Yi,wi,Ji),Hh(Yi,wi,Ji),Hh(Yi,pa,Qi),Hh(Yi,pa,Qi)}}re&&(lt+=Tt.length-1)}}if(X&&X.polyCount.length>0){if(X.borders){X.vertexArrayOffset=this.centroidVertexArray.length;const at=X.borders,xt=this.featuresOnBorder.push(X)-1;for(let lt=0;lt<4;lt++)at[lt][0]!==Number.MAX_VALUE&&this.borders[lt].push(xt)}this.encodeCentroid(X.borders?void 0:X.centroid(),X)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,x,w,p)}sortBorders(){for(let r=0;r<4;r++)this.borders[r].sort(((l,h)=>this.featuresOnBorder[l].borders[r][0]-this.featuresOnBorder[h].borders[r][0]))}encodeCentroid(r,l,h=!0){let p,x;if(r)if(r.y!==0){const A=l.span()._mult(this.tileToMeter);p=(Math.max(r.x,1)<<3)+Math.min(7,Math.round(A.x/10)),x=(Math.max(r.y,1)<<3)+Math.min(7,Math.round(A.y/10))}else p=Math.ceil(7*(r.x+450)),x=0;else p=0,x=+h;let w=h?this.centroidVertexArray.length:l.vertexArrayOffset;for(const A of l.polyCount){h&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*A.edges+A.top);for(let P=0;P<A.top;P++)this.centroidVertexArray.emplace(w++,p,x);for(let P=0;P<2*A.edges;P++)this.centroidVertexArray.emplace(w++,0,x),this.centroidVertexArray.emplace(w++,p,x)}}}function $3(s,r){const l=s.add(r)._unit();return s.x*l.x+s.y*l.y}function PC(s,r,l,h){const p=r.sub(s)._perp()._unit(),x=l.sub(r)._perp()._unit();return G3(s,r,l,$3(p,x),h)}function G3(s,r,l,h,p){const x=Math.sqrt(1-h*h);return Math.min(s.dist(r)/3,r.dist(l)/3,p*x/h)}function H3(s,r,l){return s.x<l[0].x&&r.x<l[0].x||s.x>l[1].x&&r.x>l[1].x||s.y<l[0].y&&r.y<l[0].y||s.y>l[1].y&&r.y>l[1].y}function W3(s,r,l){if(s.x<0||s.x>=Jr||r.x<0||r.x>=Jr||l.x<0||l.x>=Jr)return!1;const h=l.sub(r),p=h.perp(),x=s.sub(r);return(h.x*x.x+h.y*x.y)/Math.sqrt((h.x*h.x+h.y*h.y)*(x.x*x.x+x.y*x.y))>-.866&&p.x*x.x+p.y*x.y<0}function K3(s,r,l){const h=r?2|s:-3&s;return l?1|h:-2&h}function X3(){const s=Math.PI/32,r=Math.tan(s),l=qu;return l*Math.sqrt(1+2*r*r)-l}function Z3(s,r,l){const h=1<<l.z,p=mc(l.x/h),x=mc((l.x+1)/h),w=Oo(l.y/h),A=Oo((l.y+1)/h);return(function(P,R,$,X,re=0,he){const ye=[];if(!P.length||!$||!X)return ye;const Se=(Tt,sn)=>{for(const nn of Tt)ye.push({polygon:nn,bounds:sn})},We=Math.ceil(Math.log2($)),at=Math.ceil(Math.log2(X)),xt=We-at,lt=[];for(let Tt=0;Tt<Math.abs(xt);Tt++)lt.push(xt>0?0:1);for(let Tt=0;Tt<Math.min(We,at);Tt++)lt.push(0),lt.push(1);let _t=P;if(_t=Oi(_t,R[0].y-re,R[1].y+re,1),_t=Oi(_t,R[0].x-re,R[1].x+re,0),!_t.length)return ye;const It=[];for(lt.length?It.push({polygons:_t,bounds:R,depth:0}):Se(_t,R);It.length;){const Tt=It.pop(),sn=Tt.depth,nn=lt[sn],Sn=Tt.bounds[0],Vn=Tt.bounds[1],un=nn===0?Sn.x:Sn.y,kn=nn===0?Vn.x:Vn.y,Rn=he?he(nn,un,kn):.5*(un+kn),zn=Oi(Tt.polygons,un-re,Rn+re,nn),Kn=Oi(Tt.polygons,Rn-re,kn+re,nn);if(zn.length){const wn=[Sn,new q(nn===0?Rn:Vn.x,nn===1?Rn:Vn.y)];lt.length>sn+1?It.push({polygons:zn,bounds:wn,depth:sn+1}):Se(zn,wn)}if(Kn.length){const wn=[new q(nn===0?Rn:Sn.x,nn===1?Rn:Sn.y),Vn];lt.length>sn+1?It.push({polygons:Kn,bounds:wn,depth:sn+1}):Se(Kn,wn)}}return ye})(s,r,Math.ceil((x-p)/11.25),Math.ceil((w-A)/11.25),1,((P,R,$)=>{if(P===0)return .5*(R+$);{const X=Oo((l.y+R/Jr)/h);return(fa(.5*(Oo((l.y+$/Jr)/h)+X))*h-l.y)*Jr}}))}hr(ry,"FillExtrusionBucket",{omit:["layers","features"]}),hr(q_,"PartMetadata");const kC=new ot({"fill-extrusion-edge-radius":new _e(dn["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var RC={paint:new ot({"fill-extrusion-opacity":new _e(dn["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new $e(dn["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new _e(dn["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new _e(dn["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new $e(dn["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new $e(dn["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new $e(dn["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new _e(dn["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new _e(dn["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new _e(dn["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new _e(dn["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:kC};function Y3(s,r,l){var h=2*Math.PI*6378137/256/Math.pow(2,l);return[s*h-2*Math.PI*6378137/2,r*h-2*Math.PI*6378137/2]}class $_{constructor(r,l,h){this.z=r,this.x=l,this.y=h,this.key=iy(0,r,r,l,h)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,l){const h=(function(x,w,A){var P=Y3(256*x,256*(w=Math.pow(2,A)-w-1),A),R=Y3(256*(x+1),256*(w+1),A);return P[0]+","+P[1]+","+R[0]+","+R[1]})(this.x,this.y,this.z),p=(function(x,w,A){let P,R="";for(let $=x;$>0;$--)P=1<<$-1,R+=(w&P?1:0)+(A&P?2:0);return R})(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",h)}toString(){return`${this.z}/${this.x}/${this.y}`}}class J3{constructor(r,l){this.wrap=r,this.canonical=l,this.key=iy(r,l.z,l.z,l.x,l.y)}}class ph{constructor(r,l,h,p,x){this.overscaledZ=r,this.wrap=l,this.canonical=new $_(h,+p,+x),this.key=l===0&&r===h?this.canonical.key:iy(l,r,h,p,x)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const l=this.canonical.z-r;return r>this.canonical.z?new ph(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ph(r,this.wrap,r,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(r,l=!0){if(this.overscaledZ===r&&l)return this.key;if(r>this.canonical.z)return iy(this.wrap*+l,r,this.canonical.z,this.canonical.x,this.canonical.y);{const h=this.canonical.z-r;return iy(this.wrap*+l,r,r,this.canonical.x>>h,this.canonical.y>>h)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const l=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>l&&r.canonical.y===this.canonical.y>>l}children(r){if(this.overscaledZ>=r)return[new ph(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,h=2*this.canonical.x,p=2*this.canonical.y;return[new ph(l,this.wrap,l,h,p),new ph(l,this.wrap,l,h+1,p),new ph(l,this.wrap,l,h,p+1),new ph(l,this.wrap,l,h+1,p+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new ph(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new ph(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new J3(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function iy(s,r,l,h,p){const x=1<<Math.min(l,22);let w=x*(p%x)+h%x;return s&&l<22&&(w+=x*x*((s<0?-2*s-1:2*s)%(1<<2*(22-l)))),16*(32*w+l)+(r-l)}hr($_,"CanonicalTileID"),hr(ph,"OverscaledTileID",{omit:["projMatrix"]});class Rg extends q{constructor(r,l,h){super(r,l),this.z=h}}function oy(s,r){return s.x*r.x+s.y*r.y}function Q3(s,r){if(s.length===1){let l=0;const h=r[l++];let p;for(;!p||h.equals(p);)if(p=r[l++],!p)return 1/0;for(;l<r.length;l++){const x=r[l],w=s[0],A=p.sub(h),P=x.sub(h),R=w.sub(h),$=oy(A,A),X=oy(A,P),re=oy(P,P),he=oy(R,A),ye=oy(R,P),Se=$*re-X*X,We=(re*he-X*ye)/Se,at=($*ye-X*he)/Se,xt=h.z*(1-We-at)+p.z*We+x.z*at;if(isFinite(xt))return xt}return 1/0}{let l=1/0;for(const h of r)l=Math.min(l,h.z);return l}}function e4(s,r,l,h,p,x,w,A){const P=w*p.getElevationAt(s,r,!0,!0),R=x[0]!==0,$=R?x[1]===0?w*(x[0]/7-450):w*(function(X,re,he){const ye=Math.floor(re[0]/8),Se=Math.floor(re[1]/8),We=10*(re[0]-8*ye),at=10*(re[1]-8*Se),xt=X.getElevationAt(ye,Se,!0,!0),lt=X.getMeterToDEM(he),_t=Math.floor(.5*(We*lt-1)),It=Math.floor(.5*(at*lt-1)),Tt=X.tileCoordToPixel(ye,Se),sn=2*_t+1,nn=2*It+1,Sn=(function(Kn,wn,_r,Ur,br){return[Kn.getElevationAtPixel(wn,_r,!0),Kn.getElevationAtPixel(wn+br,_r,!0),Kn.getElevationAtPixel(wn,_r+br,!0),Kn.getElevationAtPixel(wn+Ur,_r+br,!0)]})(X,Tt.x-_t,Tt.y-It,sn,nn),Vn=Math.abs(Sn[0]-Sn[1]),un=Math.abs(Sn[2]-Sn[3]),kn=Math.abs(Sn[0]-Sn[2])+Math.abs(Sn[1]-Sn[3]),Rn=Math.min(.25,.5*lt*(Vn+un)/sn),zn=Math.min(.25,.5*lt*kn/nn);return xt+Math.max(Rn*We,zn*at)})(p,x,A):P;return{base:P+(l===0)?-1:l,top:R?Math.max($+h,P+l+2):P+h}}const MC=Lt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:NC}=MC,DC=Lt([{name:"a_packed",components:4,type:"Float32"}]),{members:FC}=DC,OC=Fi.types,BC=Math.cos(Math.PI/180*37.5);class G_{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((l=>l.id)),this.index=r.index,this.projection=r.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((l=>{this.gradients[l.id]={}})),this.layoutVertexArray=new Ht,this.layoutVertexArray2=new Cn,this.indexArray=new Sr,this.programConfigurations=new Vu(r.layers,r.zoom),this.segments=new Ra,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((l=>l.isStateDependent())).map((l=>l.id))}populate(r,l,h,p){this.hasPattern=d("line",this.layers,l);const x=this.layers[0].layout.get("line-sort-key"),w=[];for(const{feature:$,id:X,index:re,sourceLayerIndex:he}of r){const ye=this.layers[0]._featureFilter.needGeometry,Se=Ad($,ye);if(!this.layers[0]._featureFilter.filter(new G(this.zoom),Se,h))continue;const We=x?x.evaluate(Se,{},h):void 0,at={id:X,properties:$.properties,type:$.type,sourceLayerIndex:he,index:re,geometry:ye?Se.geometry:wu($,h,p),patterns:{},sortKey:We};w.push(at)}x&&w.sort((($,X)=>$.sortKey-X.sortKey));const{lineAtlas:A,featureIndex:P}=l,R=this.addConstantDashes(A);for(const $ of w){const{geometry:X,index:re,sourceLayerIndex:he}=$;if(R&&this.addFeatureDashes($,A),this.hasPattern){const ye=g("line",this.layers,$,this.zoom,l);this.patternFeatures.push(ye)}else this.addFeature($,X,re,h,A.positions,l.availableImages);P.insert(r[re].feature,X,re,he,this.index)}}addConstantDashes(r){let l=!1;for(const h of this.layers){const p=h.paint.get("line-dasharray").value,x=h.layout.get("line-cap").value;if(p.kind!=="constant"||x.kind!=="constant")l=!0;else{const w=x.value,A=p.value;if(!A)continue;r.addDash(A,w)}}return l}addFeatureDashes(r,l){const h=this.zoom;for(const p of this.layers){const x=p.paint.get("line-dasharray").value,w=p.layout.get("line-cap").value;if(x.kind==="constant"&&w.kind==="constant")continue;let A,P;if(x.kind==="constant"){if(A=x.value,!A)continue}else A=x.evaluate({zoom:h},r);P=w.kind==="constant"?w.value:w.evaluate({zoom:h},r),l.addDash(A,P),r.patterns[p.id]=l.getKey(A,P)}}update(r,l,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,h,p)}addFeatures(r,l,h,p,x){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,l,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,FC)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,NC),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&r.properties.hasOwnProperty("mapbox_clip_start")&&r.properties.hasOwnProperty("mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,l,h,p,x,w){const A=this.layers[0].layout,P=A.get("line-join").evaluate(r,{}),R=A.get("line-cap").evaluate(r,{}),$=A.get("line-miter-limit"),X=A.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const re of l)this.addLine(re,r,P,R,$,X);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,x,w,p)}addLine(r,l,h,p,x,w){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let at=0;at<r.length-1;at++)this.totalDistance+=r[at].dist(r[at+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const A=OC[l.type]==="Polygon";let P=r.length;for(;P>=2&&r[P-1].equals(r[P-2]);)P--;let R=0;for(;R<P-1&&r[R].equals(r[R+1]);)R++;if(P<(A?3:2))return;h==="bevel"&&(x=1.05);const $=this.overscaling<=16?15*Jr/(512*this.overscaling):0,X=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray);let re,he,ye,Se,We;this.e1=this.e2=-1,A&&(re=r[P-2],We=r[R].sub(re)._unit()._perp());for(let at=R;at<P;at++){if(ye=at===P-1?A?r[R+1]:void 0:r[at+1],ye&&r[at].equals(ye))continue;We&&(Se=We),re&&(he=re),re=r[at],We=ye?ye.sub(re)._unit()._perp():Se,Se=Se||We;let xt=Se.add(We);xt.x===0&&xt.y===0||xt._unit();const lt=Se.x*We.x+Se.y*We.y,_t=xt.x*We.x+xt.y*We.y,It=_t!==0?1/_t:1/0,Tt=2*Math.sqrt(2-2*_t),sn=_t<BC&&he&&ye,nn=Se.x*We.y-Se.y*We.x>0;if(sn&&at>R){const un=re.dist(he);if(un>2*$){const kn=re.sub(re.sub(he)._mult($/un)._round());this.updateDistance(he,kn),this.addCurrentVertex(kn,Se,0,0,X),he=kn}}const Sn=he&&ye;let Vn=Sn?h:A?"butt":p;if(Sn&&Vn==="round"&&(It<w?Vn="miter":It<=2&&(Vn="fakeround")),Vn==="miter"&&It>x&&(Vn="bevel"),Vn==="bevel"&&(It>2&&(Vn="flipbevel"),It<x&&(Vn="miter")),he&&this.updateDistance(he,re),Vn==="miter")xt._mult(It),this.addCurrentVertex(re,xt,0,0,X);else if(Vn==="flipbevel"){if(It>100)xt=We.mult(-1);else{const un=It*Se.add(We).mag()/Se.sub(We).mag();xt._perp()._mult(un*(nn?-1:1))}this.addCurrentVertex(re,xt,0,0,X),this.addCurrentVertex(re,xt.mult(-1),0,0,X)}else if(Vn==="bevel"||Vn==="fakeround"){const un=-Math.sqrt(It*It-1),kn=nn?un:0,Rn=nn?0:un;if(he&&this.addCurrentVertex(re,Se,kn,Rn,X),Vn==="fakeround"){const zn=Math.round(180*Tt/Math.PI/20);for(let Kn=1;Kn<zn;Kn++){let wn=Kn/zn;if(wn!==.5){const Ur=wn-.5;wn+=wn*Ur*(wn-1)*((1.0904+lt*(lt*(3.55645-1.43519*lt)-3.2452))*Ur*Ur+(.848013+lt*(.215638*lt-1.06021)))}const _r=We.sub(Se)._mult(wn)._add(Se)._unit()._mult(nn?-1:1);this.addHalfVertex(re,_r.x,_r.y,!1,nn,0,X)}}ye&&this.addCurrentVertex(re,We,-kn,-Rn,X)}else if(Vn==="butt")this.addCurrentVertex(re,xt,0,0,X);else if(Vn==="square"){const un=he?1:-1;he||this.addCurrentVertex(re,xt,un,un,X),this.addCurrentVertex(re,xt,0,0,X),he&&this.addCurrentVertex(re,xt,un,un,X)}else Vn==="round"&&(he&&(this.addCurrentVertex(re,Se,0,0,X),this.addCurrentVertex(re,Se,1,1,X,!0)),ye&&(this.addCurrentVertex(re,We,-1,-1,X,!0),this.addCurrentVertex(re,We,0,0,X)));if(sn&&at<P-1){const un=re.dist(ye);if(un>2*$){const kn=re.add(ye.sub(re)._mult($/un)._round());this.updateDistance(re,kn),this.addCurrentVertex(kn,We,0,0,X),re=kn}}}}addCurrentVertex(r,l,h,p,x,w=!1){const A=l.y*p-l.x,P=-l.y-l.x*p;this.addHalfVertex(r,l.x+l.y*h,l.y-l.x*h,w,!1,h,x),this.addHalfVertex(r,A,P,w,!0,-p,x)}addHalfVertex({x:r,y:l},h,p,x,w,A,P){this.layoutVertexArray.emplaceBack((r<<1)+(x?1:0),(l<<1)+(w?1:0),Math.round(63*h)+128,Math.round(63*p)+128,1+(A===0?0:A<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const R=P.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,R),P.primitiveLength++),w?this.e2=R:this.e1=R}updateScaledDistance(){if(this.lineClips){const r=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=r*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(r,l){this.distance+=r.dist(l),this.updateScaledDistance()}}hr(G_,"LineBucket",{omit:["layers","patternFeatures"]});const zC=new ot({"line-cap":new $e(dn.layout_line["line-cap"]),"line-join":new $e(dn.layout_line["line-join"]),"line-miter-limit":new _e(dn.layout_line["line-miter-limit"]),"line-round-limit":new _e(dn.layout_line["line-round-limit"]),"line-sort-key":new $e(dn.layout_line["line-sort-key"])});var t4={paint:new ot({"line-opacity":new $e(dn.paint_line["line-opacity"]),"line-color":new $e(dn.paint_line["line-color"]),"line-translate":new _e(dn.paint_line["line-translate"]),"line-translate-anchor":new _e(dn.paint_line["line-translate-anchor"]),"line-width":new $e(dn.paint_line["line-width"]),"line-gap-width":new $e(dn.paint_line["line-gap-width"]),"line-offset":new $e(dn.paint_line["line-offset"]),"line-blur":new $e(dn.paint_line["line-blur"]),"line-dasharray":new $e(dn.paint_line["line-dasharray"]),"line-pattern":new $e(dn.paint_line["line-pattern"]),"line-gradient":new it(dn.paint_line["line-gradient"]),"line-trim-offset":new _e(dn.paint_line["line-trim-offset"])}),layout:zC};const n4=new class extends $e{possiblyEvaluate(s,r){return r=new G(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,transition:r.transition}),super.possiblyEvaluate(s,r)}evaluate(s,r,l,h){return r=Be({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(s,r,l,h)}}(t4.paint.properties["line-width"].specification);function r4(s,r){return r>0?r+2*s:s}n4.useIntegerZoom=!0;const jC=Lt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),UC=Lt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),VC=Lt([{name:"a_projected_pos",components:4,type:"Float32"}],4);Lt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const qC=Lt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),$C=Lt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Lt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const i4=Lt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),GC=Lt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Lt([{name:"triangle",components:3,type:"Uint16"}]),Lt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Lt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Lt([{type:"Float32",name:"offsetX"}]),Lt([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var uu=24;const qd=128;function Px(s,r){const{expression:l}=r;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new G(s+1))};if(l.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:p}=l;let x=0;for(;x<h.length&&h[x]<=s;)x++;x=Math.max(0,x-1);let w=x;for(;w<h.length&&h[w]<s+1;)w++;w=Math.min(h.length-1,w);const A=h[x],P=h[w];return l.kind==="composite"?{kind:"composite",minZoom:A,maxZoom:P,interpolationType:p}:{kind:"camera",minZoom:A,maxZoom:P,minSize:l.evaluate(new G(A)),maxSize:l.evaluate(new G(P)),interpolationType:p}}}function H_(s,{uSize:r,uSizeT:l},{lowerSize:h,upperSize:p}){return s.kind==="source"?h/qd:s.kind==="composite"?Ge(h/qd,p/qd,l):r}function Mg(s,r){let l=0,h=0;if(s.kind==="constant")h=s.layoutSize;else if(s.kind!=="source"){const{interpolationType:p,minZoom:x,maxZoom:w}=s,A=p?Fe(Ba.interpolationFactor(p,r,x,w),0,1):0;s.kind==="camera"?h=Ge(s.minSize,s.maxSize,A):l=A}return{uSizeT:l,uSize:h}}var HC=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:qd,evaluateSizeForFeature:H_,evaluateSizeForZoom:Mg,getSizeData:Px});function WC(s,r,l){return s.sections.forEach((h=>{h.text=(function(p,x,w){const A=x.layout.get("text-transform").evaluate(w,{});return A==="uppercase"?p=p.toLocaleUpperCase():A==="lowercase"&&(p=p.toLocaleLowerCase()),z.applyArabicShaping&&(p=z.applyArabicShaping(p)),p})(h.text,r,l)})),s}const sy={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function KC(s){return s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""}function XC(s){return s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""}var o4=ta,s4=function(s,r,l,h,p){var x,w,A=8*p-h-1,P=(1<<A)-1,R=P>>1,$=-7,X=p-1,re=-1,he=s[r+X];for(X+=re,x=he&(1<<-$)-1,he>>=-$,$+=A;$>0;x=256*x+s[r+X],X+=re,$-=8);for(w=x&(1<<-$)-1,x>>=-$,$+=h;$>0;w=256*w+s[r+X],X+=re,$-=8);if(x===0)x=1-R;else{if(x===P)return w?NaN:1/0*(he?-1:1);w+=Math.pow(2,h),x-=R}return(he?-1:1)*w*Math.pow(2,x-h)},a4=function(s,r,l,h,p,x){var w,A,P,R=8*x-p-1,$=(1<<R)-1,X=$>>1,re=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,he=0,ye=1,Se=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(A=isNaN(r)?1:0,w=$):(w=Math.floor(Math.log(r)/Math.LN2),r*(P=Math.pow(2,-w))<1&&(w--,P*=2),(r+=w+X>=1?re/P:re*Math.pow(2,1-X))*P>=2&&(w++,P/=2),w+X>=$?(A=0,w=$):w+X>=1?(A=(r*P-1)*Math.pow(2,p),w+=X):(A=r*Math.pow(2,X-1)*Math.pow(2,p),w=0));p>=8;s[l+he]=255&A,he+=ye,A/=256,p-=8);for(w=w<<p|A,R+=p;R>0;s[l+he]=255&w,he+=ye,w/=256,R-=8);s[l+he-ye]|=128*Se};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function ta(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}ta.Varint=0,ta.Fixed64=1,ta.Bytes=2,ta.Fixed32=5;var kx=4294967296,l4=1/kx,c4=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function cp(s){return s.type===ta.Bytes?s.readVarint()+s.pos:s.pos+1}function Ng(s,r,l){return l?4294967296*r+(s>>>0):4294967296*(r>>>0)+(s>>>0)}function u4(s,r,l){var h=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));l.realloc(h);for(var p=l.pos-1;p>=s;p--)l.buf[p+h]=l.buf[p]}function ZC(s,r){for(var l=0;l<s.length;l++)r.writeVarint(s[l])}function YC(s,r){for(var l=0;l<s.length;l++)r.writeSVarint(s[l])}function JC(s,r){for(var l=0;l<s.length;l++)r.writeFloat(s[l])}function QC(s,r){for(var l=0;l<s.length;l++)r.writeDouble(s[l])}function eL(s,r){for(var l=0;l<s.length;l++)r.writeBoolean(s[l])}function tL(s,r){for(var l=0;l<s.length;l++)r.writeFixed32(s[l])}function nL(s,r){for(var l=0;l<s.length;l++)r.writeSFixed32(s[l])}function rL(s,r){for(var l=0;l<s.length;l++)r.writeFixed64(s[l])}function iL(s,r){for(var l=0;l<s.length;l++)r.writeSFixed64(s[l])}function W_(s,r){return(s[r]|s[r+1]<<8|s[r+2]<<16)+16777216*s[r+3]}function Dg(s,r,l){s[l]=r,s[l+1]=r>>>8,s[l+2]=r>>>16,s[l+3]=r>>>24}function h4(s,r){return(s[r]|s[r+1]<<8|s[r+2]<<16)+(s[r+3]<<24)}ta.prototype={destroy:function(){this.buf=null},readFields:function(s,r,l){for(l=l||this.length;this.pos<l;){var h=this.readVarint(),p=h>>3,x=this.pos;this.type=7&h,s(p,r,this),this.pos===x&&this.skip(h)}return r},readMessage:function(s,r){return this.readFields(s,r,this.readVarint()+this.pos)},readFixed32:function(){var s=W_(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=h4(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=W_(this.buf,this.pos)+W_(this.buf,this.pos+4)*kx;return this.pos+=8,s},readSFixed64:function(){var s=W_(this.buf,this.pos)+h4(this.buf,this.pos+4)*kx;return this.pos+=8,s},readFloat:function(){var s=s4(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=s4(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var r,l,h=this.buf;return r=127&(l=h[this.pos++]),l<128?r:(r|=(127&(l=h[this.pos++]))<<7,l<128?r:(r|=(127&(l=h[this.pos++]))<<14,l<128?r:(r|=(127&(l=h[this.pos++]))<<21,l<128?r:(function(p,x,w){var A,P,R=w.buf;if(A=(112&(P=R[w.pos++]))>>4,P<128||(A|=(127&(P=R[w.pos++]))<<3,P<128)||(A|=(127&(P=R[w.pos++]))<<10,P<128)||(A|=(127&(P=R[w.pos++]))<<17,P<128)||(A|=(127&(P=R[w.pos++]))<<24,P<128)||(A|=(1&(P=R[w.pos++]))<<31,P<128))return Ng(p,A,x);throw new Error("Expected varint not more than 10 bytes")})(r|=(15&(l=h[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var s=this.readVarint()+this.pos,r=this.pos;return this.pos=s,s-r>=12&&c4?(function(l,h,p){return c4.decode(l.subarray(h,p))})(this.buf,r,s):(function(l,h,p){for(var x="",w=h;w<p;){var A,P,R,$=l[w],X=null,re=$>239?4:$>223?3:$>191?2:1;if(w+re>p)break;re===1?$<128&&(X=$):re===2?(192&(A=l[w+1]))==128&&(X=(31&$)<<6|63&A)<=127&&(X=null):re===3?(P=l[w+2],(192&(A=l[w+1]))==128&&(192&P)==128&&((X=(15&$)<<12|(63&A)<<6|63&P)<=2047||X>=55296&&X<=57343)&&(X=null)):re===4&&(P=l[w+2],R=l[w+3],(192&(A=l[w+1]))==128&&(192&P)==128&&(192&R)==128&&((X=(15&$)<<18|(63&A)<<12|(63&P)<<6|63&R)<=65535||X>=1114112)&&(X=null)),X===null?(X=65533,re=1):X>65535&&(X-=65536,x+=String.fromCharCode(X>>>10&1023|55296),X=56320|1023&X),x+=String.fromCharCode(X),w+=re}return x})(this.buf,r,s)},readBytes:function(){var s=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,s);return this.pos=s,r},readPackedVarint:function(s,r){if(this.type!==ta.Bytes)return s.push(this.readVarint(r));var l=cp(this);for(s=s||[];this.pos<l;)s.push(this.readVarint(r));return s},readPackedSVarint:function(s){if(this.type!==ta.Bytes)return s.push(this.readSVarint());var r=cp(this);for(s=s||[];this.pos<r;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==ta.Bytes)return s.push(this.readBoolean());var r=cp(this);for(s=s||[];this.pos<r;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==ta.Bytes)return s.push(this.readFloat());var r=cp(this);for(s=s||[];this.pos<r;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==ta.Bytes)return s.push(this.readDouble());var r=cp(this);for(s=s||[];this.pos<r;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==ta.Bytes)return s.push(this.readFixed32());var r=cp(this);for(s=s||[];this.pos<r;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==ta.Bytes)return s.push(this.readSFixed32());var r=cp(this);for(s=s||[];this.pos<r;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==ta.Bytes)return s.push(this.readFixed64());var r=cp(this);for(s=s||[];this.pos<r;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==ta.Bytes)return s.push(this.readSFixed64());var r=cp(this);for(s=s||[];this.pos<r;)s.push(this.readSFixed64());return s},skip:function(s){var r=7&s;if(r===ta.Varint)for(;this.buf[this.pos++]>127;);else if(r===ta.Bytes)this.pos=this.readVarint()+this.pos;else if(r===ta.Fixed32)this.pos+=4;else{if(r!==ta.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(s,r){this.writeVarint(s<<3|r)},realloc:function(s){for(var r=this.length||16;r<this.pos+s;)r*=2;if(r!==this.length){var l=new Uint8Array(r);l.set(this.buf),this.buf=l,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),Dg(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),Dg(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),Dg(this.buf,-1&s,this.pos),Dg(this.buf,Math.floor(s*l4),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),Dg(this.buf,-1&s,this.pos),Dg(this.buf,Math.floor(s*l4),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?(function(r,l){var h,p;if(r>=0?(h=r%4294967296|0,p=r/4294967296|0):(p=~(-r/4294967296),4294967295^(h=~(-r%4294967296))?h=h+1|0:(h=0,p=p+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),(function(x,w,A){A.buf[A.pos++]=127&x|128,x>>>=7,A.buf[A.pos++]=127&x|128,x>>>=7,A.buf[A.pos++]=127&x|128,x>>>=7,A.buf[A.pos++]=127&x|128,A.buf[A.pos]=127&(x>>>=7)})(h,0,l),(function(x,w){var A=(7&x)<<4;w.buf[w.pos++]|=A|((x>>>=3)?128:0),x&&(w.buf[w.pos++]=127&x|((x>>>=7)?128:0),x&&(w.buf[w.pos++]=127&x|((x>>>=7)?128:0),x&&(w.buf[w.pos++]=127&x|((x>>>=7)?128:0),x&&(w.buf[w.pos++]=127&x|((x>>>=7)?128:0),x&&(w.buf[w.pos++]=127&x)))))})(p,l)})(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(!!s)},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var r=this.pos;this.pos=(function(h,p,x){for(var w,A,P=0;P<p.length;P++){if((w=p.charCodeAt(P))>55295&&w<57344){if(!A){w>56319||P+1===p.length?(h[x++]=239,h[x++]=191,h[x++]=189):A=w;continue}if(w<56320){h[x++]=239,h[x++]=191,h[x++]=189,A=w;continue}w=A-55296<<10|w-56320|65536,A=null}else A&&(h[x++]=239,h[x++]=191,h[x++]=189,A=null);w<128?h[x++]=w:(w<2048?h[x++]=w>>6|192:(w<65536?h[x++]=w>>12|224:(h[x++]=w>>18|240,h[x++]=w>>12&63|128),h[x++]=w>>6&63|128),h[x++]=63&w|128)}return x})(this.buf,s,this.pos);var l=this.pos-r;l>=128&&u4(r,l,this),this.pos=r-1,this.writeVarint(l),this.pos+=l},writeFloat:function(s){this.realloc(4),a4(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),a4(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var r=s.length;this.writeVarint(r),this.realloc(r);for(var l=0;l<r;l++)this.buf[this.pos++]=s[l]},writeRawMessage:function(s,r){this.pos++;var l=this.pos;s(r,this);var h=this.pos-l;h>=128&&u4(l,h,this),this.pos=l-1,this.writeVarint(h),this.pos+=h},writeMessage:function(s,r,l){this.writeTag(s,ta.Bytes),this.writeRawMessage(r,l)},writePackedVarint:function(s,r){r.length&&this.writeMessage(s,ZC,r)},writePackedSVarint:function(s,r){r.length&&this.writeMessage(s,YC,r)},writePackedBoolean:function(s,r){r.length&&this.writeMessage(s,eL,r)},writePackedFloat:function(s,r){r.length&&this.writeMessage(s,JC,r)},writePackedDouble:function(s,r){r.length&&this.writeMessage(s,QC,r)},writePackedFixed32:function(s,r){r.length&&this.writeMessage(s,tL,r)},writePackedSFixed32:function(s,r){r.length&&this.writeMessage(s,nL,r)},writePackedFixed64:function(s,r){r.length&&this.writeMessage(s,rL,r)},writePackedSFixed64:function(s,r){r.length&&this.writeMessage(s,iL,r)},writeBytesField:function(s,r){this.writeTag(s,ta.Bytes),this.writeBytes(r)},writeFixed32Field:function(s,r){this.writeTag(s,ta.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(s,r){this.writeTag(s,ta.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(s,r){this.writeTag(s,ta.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(s,r){this.writeTag(s,ta.Fixed64),this.writeSFixed64(r)},writeVarintField:function(s,r){this.writeTag(s,ta.Varint),this.writeVarint(r)},writeSVarintField:function(s,r){this.writeTag(s,ta.Varint),this.writeSVarint(r)},writeStringField:function(s,r){this.writeTag(s,ta.Bytes),this.writeString(r)},writeFloatField:function(s,r){this.writeTag(s,ta.Fixed32),this.writeFloat(r)},writeDoubleField:function(s,r){this.writeTag(s,ta.Fixed64),this.writeDouble(r)},writeBooleanField:function(s,r){this.writeVarintField(s,!!r)}};var K_=ue(o4);const Rx=3;function oL(s,r,l){r.glyphs=[],s===1&&l.readMessage(sL,r)}function sL(s,r,l){if(s===3){const{id:h,bitmap:p,width:x,height:w,left:A,top:P,advance:R}=l.readMessage(aL,{});r.glyphs.push({id:h,bitmap:new fh({width:x+2*Rx,height:w+2*Rx},p),metrics:{width:x,height:w,left:A,top:P,advance:R}})}else s===4?r.ascender=l.readSVarint():s===5&&(r.descender=l.readSVarint())}function aL(s,r,l){s===1?r.id=l.readVarint():s===2?r.bitmap=l.readBytes():s===3?r.width=l.readVarint():s===4?r.height=l.readVarint():s===5?r.left=l.readSVarint():s===6?r.top=l.readSVarint():s===7&&(r.advance=l.readVarint())}const d4=Rx;function Mx(s){let r=0,l=0;for(const w of s)r+=w.w*w.h,l=Math.max(l,w.w);s.sort(((w,A)=>A.h-w.h));const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),l),h:1/0}];let p=0,x=0;for(const w of s)for(let A=h.length-1;A>=0;A--){const P=h[A];if(!(w.w>P.w||w.h>P.h)){if(w.x=P.x,w.y=P.y,x=Math.max(x,w.y+w.h),p=Math.max(p,w.x+w.w),w.w===P.w&&w.h===P.h){const R=h.pop();A<h.length&&(h[A]=R)}else w.h===P.h?(P.x+=w.w,P.w-=w.w):w.w===P.w?(P.y+=w.h,P.h-=w.h):(h.push({x:P.x+w.w,y:P.y,w:P.w-w.w,h:w.h}),P.y+=w.h,P.h-=w.h);break}}return{w:p,h:x,fill:r/(p*x)||0}}const Nh=1;class Nx{constructor(r,{pixelRatio:l,version:h,stretchX:p,stretchY:x,content:w}){this.paddedRect=r,this.pixelRatio=l,this.stretchX=p,this.stretchY=x,this.content=w,this.version=h}get tl(){return[this.paddedRect.x+Nh,this.paddedRect.y+Nh]}get br(){return[this.paddedRect.x+this.paddedRect.w-Nh,this.paddedRect.y+this.paddedRect.h-Nh]}get displaySize(){return[(this.paddedRect.w-2*Nh)/this.pixelRatio,(this.paddedRect.h-2*Nh)/this.pixelRatio]}}class f4{constructor(r,l){const h={},p={};this.haveRenderCallbacks=[];const x=[];this.addImages(r,h,x),this.addImages(l,p,x);const{w,h:A}=Mx(x),P=new Gu({width:w||1,height:A||1});for(const R in r){const $=r[R],X=h[R].paddedRect;Gu.copy($.data,P,{x:0,y:0},{x:X.x+Nh,y:X.y+Nh},$.data)}for(const R in l){const $=l[R],X=p[R].paddedRect,re=X.x+Nh,he=X.y+Nh,ye=$.data.width,Se=$.data.height;Gu.copy($.data,P,{x:0,y:0},{x:re,y:he},$.data),Gu.copy($.data,P,{x:0,y:Se-1},{x:re,y:he-1},{width:ye,height:1}),Gu.copy($.data,P,{x:0,y:0},{x:re,y:he+Se},{width:ye,height:1}),Gu.copy($.data,P,{x:ye-1,y:0},{x:re-1,y:he},{width:1,height:Se}),Gu.copy($.data,P,{x:0,y:0},{x:re+ye,y:he},{width:1,height:Se})}this.image=P,this.iconPositions=h,this.patternPositions=p}addImages(r,l,h){for(const p in r){const x=r[p],w={x:0,y:0,w:x.data.width+2*Nh,h:x.data.height+2*Nh};h.push(w),l[p]=new Nx(w,x),x.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(r,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((h=>r.hasImage(h))),r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const h in r.updatedImages)this.patchUpdatedImage(this.iconPositions[h],r.getImage(h),l),this.patchUpdatedImage(this.patternPositions[h],r.getImage(h),l)}patchUpdatedImage(r,l,h){if(!r||!l||r.version===l.version)return;r.version=l.version;const[p,x]=r.tl;h.update(l.data,void 0,{x:p,y:x})}}hr(Nx,"ImagePosition"),hr(f4,"ImageAtlas");const hd={horizontal:1,vertical:2,horizontalOnly:3},p4=-17;class ay{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,l){const h=new ay;return h.scale=r||1,h.fontStack=l,h}static forImage(r){const l=new ay;return l.imageName=r,l}}class Fg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,l){const h=new Fg;for(let p=0;p<r.sections.length;p++){const x=r.sections[p];x.image?h.addImageSection(x):h.addTextSection(x,l)}return h}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(r){this.text=(function(l,h){let p="";for(let x=0;x<l.length;x++){const w=l.charCodeAt(x+1)||null,A=l.charCodeAt(x-1)||null;p+=!h&&(w&&et(w)&&!sy[l[x+1]]||A&&et(A)&&!sy[l[x-1]])||!sy[l[x]]?l[x]:sy[l[x]]}return p})(this.text,r)}trim(){let r=0;for(let h=0;h<this.text.length&&X_[this.text.charCodeAt(h)];h++)r++;let l=this.text.length;for(let h=this.text.length-1;h>=0&&h>=r&&X_[this.text.charCodeAt(h)];h--)l--;this.text=this.text.substring(r,l),this.sectionIndex=this.sectionIndex.slice(r,l)}substring(r,l){const h=new Fg;return h.text=this.text.substring(r,l),h.sectionIndex=this.sectionIndex.slice(r,l),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((r,l)=>Math.max(r,this.sections[l].scale)),0)}addTextSection(r,l){this.text+=r.text,this.sections.push(ay.forText(r.scale,r.fontStack||l));const h=this.sections.length-1;for(let p=0;p<r.text.length;++p)this.sectionIndex.push(h)}addImageSection(r){const l=r.image?r.image.name:"";if(l.length===0)return void mr("Can't add FormattedSection with an empty image.");const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCharCode(h),this.sections.push(ay.forImage(l)),this.sectionIndex.push(this.sections.length-1)):mr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Dx(s,r,l,h,p,x,w,A,P,R,$,X,re,he,ye){const Se=Fg.fromFeature(s,p);X===hd.vertical&&Se.verticalizePunctuation(re);let We=[];const at=(function(Tt,sn,nn,Sn,Vn,un){if(!Tt)return[];const kn=[],Rn=(function(_r,Ur,br,Xi,Zn,ri){let Zi=0;for(let is=0;is<_r.length();is++){const Yi=_r.getSection(is);Zi+=m4(_r.getCharCode(is),Yi,Xi,Zn,Ur,ri)}return Zi/Math.max(1,Math.ceil(Zi/br))})(Tt,sn,nn,Sn,Vn,un),zn=Tt.text.indexOf("")>=0;let Kn=0;for(let _r=0;_r<Tt.length();_r++){const Ur=Tt.getSection(_r),br=Tt.getCharCode(_r);if(X_[br]||(Kn+=m4(br,Ur,Sn,Vn,sn,un)),_r<Tt.length()-1){const Xi=!((wn=br)<11904||!(oe["Bopomofo Extended"](wn)||oe.Bopomofo(wn)||oe["CJK Compatibility Forms"](wn)||oe["CJK Compatibility Ideographs"](wn)||oe["CJK Compatibility"](wn)||oe["CJK Radicals Supplement"](wn)||oe["CJK Strokes"](wn)||oe["CJK Symbols and Punctuation"](wn)||oe["CJK Unified Ideographs Extension A"](wn)||oe["CJK Unified Ideographs"](wn)||oe["Enclosed CJK Letters and Months"](wn)||oe["Halfwidth and Fullwidth Forms"](wn)||oe.Hiragana(wn)||oe["Ideographic Description Characters"](wn)||oe["Kangxi Radicals"](wn)||oe["Katakana Phonetic Extensions"](wn)||oe.Katakana(wn)||oe["Vertical Forms"](wn)||oe["Yi Radicals"](wn)||oe["Yi Syllables"](wn)));(lL[br]||Xi||Ur.imageName)&&kn.push(y4(_r+1,Kn,Rn,kn,cL(br,Tt.getCharCode(_r+1),Xi&&zn),!1))}}var wn;return _4(y4(Tt.length(),Kn,Rn,kn,0,!0))})(Se,R,x,r,h,he),{processBidirectionalText:xt,processStyledBidirectionalText:lt}=z;if(xt&&Se.sections.length===1){const Tt=xt(Se.toString(),at);for(const sn of Tt){const nn=new Fg;nn.text=sn,nn.sections=Se.sections;for(let Sn=0;Sn<sn.length;Sn++)nn.sectionIndex.push(0);We.push(nn)}}else if(lt){const Tt=lt(Se.text,Se.sectionIndex,at);for(const sn of Tt){const nn=new Fg;nn.text=sn[0],nn.sectionIndex=sn[1],nn.sections=Se.sections,We.push(nn)}}else We=(function(Tt,sn){const nn=[],Sn=Tt.text;let Vn=0;for(const un of sn)nn.push(Tt.substring(Vn,un)),Vn=un;return Vn<Sn.length&&nn.push(Tt.substring(Vn,Sn.length)),nn})(Se,at);const _t=[],It={positionedLines:_t,text:Se.toString(),top:$[1],bottom:$[1],left:$[0],right:$[0],writingMode:X,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return(function(Tt,sn,nn,Sn,Vn,un,kn,Rn,zn,Kn,wn,_r){let Ur=0,br=0,Xi=0;const Zn=Rn==="right"?1:Rn==="left"?0:.5;let ri=!1;for(const Ji of Vn){const Qi=Ji.getSections();for(const Fs of Qi){if(Fs.imageName)continue;const na=sn[Fs.fontStack];if(na&&(ri=na.ascender!==void 0&&na.descender!==void 0,!ri))break}if(!ri)break}let Zi=0;for(const Ji of Vn){Ji.trim();const Qi=Ji.getMaxScale(),Fs=(Qi-1)*uu,na={positionedGlyphs:[],lineOffset:0};Tt.positionedLines[Zi]=na;const ra=na.positionedGlyphs;let Os=0;if(!Ji.length()){br+=un,++Zi;continue}let Ha=0,fl=0;for(let Bs=0;Bs<Ji.length();Bs++){const gc=Ji.getSection(Bs),Hl=Ji.getSectionIndex(Bs),ol=Ji.getCharCode(Bs);let cs=gc.scale,Wl=null,ia=null,mh=null,Kl=uu,hu=0;const Zc=!(zn===hd.horizontal||!wn&&!Je(ol)||wn&&(X_[ol]||(is=ol,oe.Arabic(is)||oe["Arabic Supplement"](is)||oe["Arabic Extended-A"](is)||oe["Arabic Presentation Forms-A"](is)||oe["Arabic Presentation Forms-B"](is))));if(gc.imageName){const gh=Sn[gc.imageName];if(!gh)continue;mh=gc.imageName,Tt.iconsInText=Tt.iconsInText||!0,ia=gh.paddedRect;const Yc=gh.displaySize;cs=cs*uu/_r,Wl={width:Yc[0],height:Yc[1],left:Nh,top:-d4,advance:Zc?Yc[1]:Yc[0],localGlyph:!1},hu=ri?-Wl.height*cs:p4+Qi*uu-Yc[1]*cs,Kl=Wl.advance;const Hd=(Zc?Yc[0]:Yc[1])*cs-uu*Qi;Hd>0&&Hd>Os&&(Os=Hd)}else{const gh=nn[gc.fontStack];if(!gh)continue;gh[ol]&&(ia=gh[ol]);const Yc=sn[gc.fontStack];if(!Yc)continue;const Hd=Yc.glyphs[ol];if(!Hd)continue;if(Wl=Hd.metrics,Kl=ol!==8203?uu:0,ri){const qg=Yc.ascender!==void 0?Math.abs(Yc.ascender):0,yy=Yc.descender!==void 0?Math.abs(Yc.descender):0,_y=(qg+yy)*cs;Ha<_y&&(Ha=_y,fl=(qg-yy)/2*cs),hu=-qg*cs}else hu=p4+(Qi-cs)*uu}Zc?(Tt.verticalizable=!0,ra.push({glyph:ol,imageName:mh,x:Ur,y:br+hu,vertical:Zc,scale:cs,localGlyph:Wl.localGlyph,fontStack:gc.fontStack,sectionIndex:Hl,metrics:Wl,rect:ia}),Ur+=Kl*cs+Kn):(ra.push({glyph:ol,imageName:mh,x:Ur,y:br+hu,vertical:Zc,scale:cs,localGlyph:Wl.localGlyph,fontStack:gc.fontStack,sectionIndex:Hl,metrics:Wl,rect:ia}),Ur+=Wl.advance*cs+Kn)}ra.length!==0&&(Xi=Math.max(Ur-Kn,Xi),ri?v4(ra,Zn,Os,fl,un*Qi/2):v4(ra,Zn,Os,0,un/2)),Ur=0;const Gl=un*Qi+Os;na.lineOffset=Math.max(Os,Fs),br+=Gl,++Zi}var is;const Yi=br,{horizontalAlign:wi,verticalAlign:pa}=Fx(kn);(function(Ji,Qi,Fs,na,ra,Os){const Ha=(Qi-Fs)*ra,fl=-Os*na;for(const Gl of Ji)for(const Bs of Gl.positionedGlyphs)Bs.x+=Ha,Bs.y+=fl})(Tt.positionedLines,Zn,wi,pa,Xi,Yi),Tt.top+=-pa*Yi,Tt.bottom=Tt.top+Yi,Tt.left+=-wi*Xi,Tt.right=Tt.left+Xi,Tt.hasBaseline=ri})(It,r,l,h,We,w,A,P,X,R,re,ye),!(function(Tt){for(const sn of Tt)if(sn.positionedGlyphs.length!==0)return!1;return!0})(_t)&&It}const X_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},lL={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function m4(s,r,l,h,p,x){if(r.imageName){const w=h[r.imageName];return w?w.displaySize[0]*r.scale*uu/x+p:0}{const w=l[r.fontStack],A=w&&w.glyphs[s];return A?A.metrics.advance*r.scale+p:0}}function g4(s,r,l,h){const p=Math.pow(s-r,2);return h?s<r?p/2:2*p:p+Math.abs(l)*l}function cL(s,r,l){let h=0;return s===10&&(h-=1e4),l&&(h+=150),s!==40&&s!==65288||(h+=50),r!==41&&r!==65289||(h+=50),h}function y4(s,r,l,h,p,x){let w=null,A=g4(r,l,p,x);for(const P of h){const R=g4(r-P.x,l,p,x)+P.badness;R<=A&&(w=P,A=R)}return{index:s,x:r,priorBreak:w,badness:A}}function _4(s){return s?_4(s.priorBreak).concat(s.index):[]}function Fx(s){let r=.5,l=.5;switch(s){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:r,verticalAlign:l}}function v4(s,r,l,h,p){if(!(r||l||h||p))return;const x=s.length-1,w=s[x],A=(w.x+w.metrics.advance*w.scale)*r;for(let P=0;P<=x;P++)s[P].x-=A,s[P].y+=l+h+p}function uL(s,r,l){const{horizontalAlign:h,verticalAlign:p}=Fx(l),x=r[0]-s.displaySize[0]*h,w=r[1]-s.displaySize[1]*p;return{image:s,top:w,bottom:w+s.displaySize[1],left:x,right:x+s.displaySize[0]}}function x4(s,r,l,h,p,x){const w=s.image;let A;if(w.content){const We=w.content,at=w.pixelRatio||1;A=[We[0]/at,We[1]/at,w.displaySize[0]-We[2]/at,w.displaySize[1]-We[3]/at]}const P=r.left*x,R=r.right*x;let $,X,re,he;l==="width"||l==="both"?(he=p[0]+P-h[3],X=p[0]+R+h[1]):(he=p[0]+(P+R-w.displaySize[0])/2,X=he+w.displaySize[0]);const ye=r.top*x,Se=r.bottom*x;return l==="height"||l==="both"?($=p[1]+ye-h[0],re=p[1]+Se+h[2]):($=p[1]+(ye+Se-w.displaySize[1])/2,re=$+w.displaySize[1]),{image:w,top:$,right:X,bottom:re,left:he,collisionPadding:A}}class up extends q{constructor(r,l,h,p,x){super(r,l),this.angle=p,this.z=h,x!==void 0&&(this.segment=x)}clone(){return new up(this.x,this.y,this.z,this.angle,this.segment)}}function b4(s,r,l,h,p){if(r.segment===void 0)return!0;let x=r,w=r.segment+1,A=0;for(;A>-l/2;){if(w--,w<0)return!1;A-=s[w].dist(x),x=s[w]}A+=s[w].dist(s[w+1]),w++;const P=[];let R=0;for(;A<l/2;){const $=s[w],X=s[w+1];if(!X)return!1;let re=s[w-1].angleTo($)-$.angleTo(X);for(re=Math.abs((re+3*Math.PI)%(2*Math.PI)-Math.PI),P.push({distance:A,angleDelta:re}),R+=re;A-P[0].distance>h;)R-=P.shift().angleDelta;if(R>p)return!1;w++,A+=$.dist(X)}return!0}function w4(s){let r=0;for(let l=0;l<s.length-1;l++)r+=s[l].dist(s[l+1]);return r}function S4(s,r,l){return s?.6*r*l:0}function E4(s,r){return Math.max(s?s.right-s.left:0,r?r.right-r.left:0)}function hL(s,r,l,h,p,x){const w=S4(l,p,x),A=E4(l,h)*x;let P=0;const R=w4(s)/2;for(let $=0;$<s.length-1;$++){const X=s[$],re=s[$+1],he=X.dist(re);if(P+he>R){const ye=(R-P)/he,Se=Ge(X.x,re.x,ye),We=Ge(X.y,re.y,ye),at=new up(Se,We,0,re.angleTo(X),$);return!w||b4(s,at,A,w,r)?at:void 0}P+=he}}function dL(s,r,l,h,p,x,w,A,P){const R=S4(h,x,w),$=E4(h,p),X=$*w,re=s[0].x===0||s[0].x===P||s[0].y===0||s[0].y===P;return r-X<r/4&&(r=X+r/4),A4(s,re?r/2*A%r:($/2+2*x)*w*A%r,r,R,l,X,re,!1,P)}function A4(s,r,l,h,p,x,w,A,P){const R=x/2,$=w4(s);let X=0,re=r-l,he=[];for(let ye=0;ye<s.length-1;ye++){const Se=s[ye],We=s[ye+1],at=Se.dist(We),xt=We.angleTo(Se);for(;re+l<X+at;){re+=l;const lt=(re-X)/at,_t=Ge(Se.x,We.x,lt),It=Ge(Se.y,We.y,lt);if(_t>=0&&_t<P&&It>=0&&It<P&&re-R>=0&&re+R<=$){const Tt=new up(_t,It,0,xt,ye);Tt._round(),h&&!b4(s,Tt,x,h,p)||he.push(Tt)}}X+=at}return A||he.length||w||(he=A4(s,X/2,l,h,p,x,w,!0,P)),he}function T4(s,r,l,h,p){const x=[];for(let w=0;w<s.length;w++){const A=s[w];let P;for(let R=0;R<A.length-1;R++){let $=A[R],X=A[R+1];$.x<r&&X.x<r||($.x<r?$=new q(r,$.y+(r-$.x)/(X.x-$.x)*(X.y-$.y))._round():X.x<r&&(X=new q(r,$.y+(r-$.x)/(X.x-$.x)*(X.y-$.y))._round()),$.y<l&&X.y<l||($.y<l?$=new q($.x+(l-$.y)/(X.y-$.y)*(X.x-$.x),l)._round():X.y<l&&(X=new q($.x+(l-$.y)/(X.y-$.y)*(X.x-$.x),l)._round()),$.x>=h&&X.x>=h||($.x>=h?$=new q(h,$.y+(h-$.x)/(X.x-$.x)*(X.y-$.y))._round():X.x>=h&&(X=new q(h,$.y+(h-$.x)/(X.x-$.x)*(X.y-$.y))._round()),$.y>=p&&X.y>=p||($.y>=p?$=new q($.x+(p-$.y)/(X.y-$.y)*(X.x-$.x),p)._round():X.y>=p&&(X=new q($.x+(p-$.y)/(X.y-$.y)*(X.x-$.x),p)._round()),P&&$.equals(P[P.length-1])||(P=[$],x.push(P)),P.push(X)))))}}return x}hr(up,"Anchor");const ly=1e20;function I4(s,r,l,h,p,x,w,A,P){for(let R=r;R<r+h;R++)C4(s,l*x+R,x,p,w,A,P);for(let R=l;R<l+p;R++)C4(s,R*x+r,1,h,w,A,P)}function C4(s,r,l,h,p,x,w){x[0]=0,w[0]=-ly,w[1]=ly,p[0]=s[r];for(let A=1,P=0,R=0;A<h;A++){p[A]=s[r+A*l];const $=A*A;do{const X=x[P];R=(p[A]-p[X]+$-X*X)/(A-X)/2}while(R<=w[P]&&--P>-1);P++,x[P]=A,w[P]=R,w[P+1]=ly}for(let A=0,P=0;A<h;A++){for(;w[P+1]<A;)P++;const R=x[P],$=A-R;s[r+A*l]=p[R]+$*$}}const $d=2,Ox={none:0,ideographs:1,all:2};class Og{constructor(r,l,h){this.requestManager=r,this.localGlyphMode=l,this.localFontFamily=h,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r){this.url=r}getGlyphs(r,l){const h=[];for(const p in r)for(const x of r[p])h.push({stack:p,id:x});le(h,(({stack:p,id:x},w)=>{let A=this.entries[p];A||(A=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let P=A.glyphs[x];if(P!==void 0)return void w(null,{stack:p,id:x,glyph:P});if(P=this._tinySDF(A,p,x),P)return A.glyphs[x]=P,void w(null,{stack:p,id:x,glyph:P});const R=Math.floor(x/256);if(256*R>65535)return void w(new Error("glyphs > 65535 not supported"));if(A.ranges[R])return void w(null,{stack:p,id:x,glyph:P});let $=A.requests[R];$||($=A.requests[R]=[],Og.loadGlyphRange(p,R,this.url,this.requestManager,((X,re)=>{if(re){A.ascender=re.ascender,A.descender=re.descender;for(const he in re.glyphs)this._doesCharSupportLocalGlyph(+he)||(A.glyphs[+he]=re.glyphs[+he]);A.ranges[R]=!0}for(const he of $)he(X,re);delete A.requests[R]}))),$.push(((X,re)=>{X?w(X):re&&w(null,{stack:p,id:x,glyph:re.glyphs[x]||null})}))}),((p,x)=>{if(p)l(p);else if(x){const w={};for(const{stack:A,id:P,glyph:R}of x)w[A]===void 0&&(w[A]={}),w[A].glyphs===void 0&&(w[A].glyphs={}),w[A].glyphs[P]=R&&{id:R.id,bitmap:R.bitmap.clone(),metrics:R.metrics},w[A].ascender=this.entries[A].ascender,w[A].descender=this.entries[A].descender;l(null,w)}}))}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==Ox.none&&(this.localGlyphMode===Ox.all?!!this.localFontFamily:!!this.localFontFamily&&(oe["CJK Unified Ideographs"](r)||oe["Hangul Syllables"](r)||oe.Hiragana(r)||oe.Katakana(r)||oe["CJK Symbols and Punctuation"](r)))}_tinySDF(r,l,h){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(h))return;let x=r.tinySDF;if(!x){let Se="400";/bold/i.test(l)?Se="900":/medium/i.test(l)?Se="500":/light/i.test(l)&&(Se="200"),x=r.tinySDF=new Og.TinySDF({fontFamily:p,fontWeight:Se,fontSize:24*$d,buffer:3*$d,radius:8*$d}),x.fontWeight=Se}if(this.localGlyphs[x.fontWeight][h])return this.localGlyphs[x.fontWeight][h];const w=String.fromCharCode(h),{data:A,width:P,height:R,glyphWidth:$,glyphHeight:X,glyphLeft:re,glyphTop:he,glyphAdvance:ye}=x.draw(w);return this.localGlyphs[x.fontWeight][h]={id:h,bitmap:new fh({width:P,height:R},A),metrics:{width:$/$d,height:X/$d,left:re/$d,top:he/$d-27,advance:ye/$d,localGlyph:!0}}}}Og.loadGlyphRange=function(s,r,l,h,p){const x=256*r,w=x+255,A=h.transformRequest(h.normalizeGlyphsURL(l).replace("{fontstack}",s).replace("{range}",`${x}-${w}`),or.Glyphs);di(A,((P,R)=>{if(P)p(P);else if(R){const $={},X=(function(re){return new K_(re).readFields(oL,{})})(R);for(const re of X.glyphs)$[re.id]=re;p(null,{glyphs:$,ascender:X.ascender,descender:X.descender})}}))},Og.TinySDF=class{constructor({fontSize:s=24,buffer:r=3,radius:l=8,cutoff:h=.25,fontFamily:p="sans-serif",fontWeight:x="normal",fontStyle:w="normal"}={}){this.buffer=r,this.cutoff=h,this.radius=l;const A=this.size=s+4*r,P=this._createCanvas(A),R=this.ctx=P.getContext("2d",{willReadFrequently:!0});R.font=`${w} ${x} ${s}px ${p}`,R.textBaseline="alphabetic",R.textAlign="left",R.fillStyle="black",this.gridOuter=new Float64Array(A*A),this.gridInner=new Float64Array(A*A),this.f=new Float64Array(A),this.z=new Float64Array(A+1),this.v=new Uint16Array(A)}_createCanvas(s){const r=document.createElement("canvas");return r.width=r.height=s,r}draw(s){const{width:r,actualBoundingBoxAscent:l,actualBoundingBoxDescent:h,actualBoundingBoxLeft:p,actualBoundingBoxRight:x}=this.ctx.measureText(s),w=Math.ceil(l),A=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(x-p))),P=Math.min(this.size-this.buffer,w+Math.ceil(h)),R=A+2*this.buffer,$=P+2*this.buffer,X=Math.max(R*$,0),re=new Uint8ClampedArray(X),he={data:re,width:R,height:$,glyphWidth:A,glyphHeight:P,glyphTop:w,glyphLeft:0,glyphAdvance:r};if(A===0||P===0)return he;const{ctx:ye,buffer:Se,gridInner:We,gridOuter:at}=this;ye.clearRect(Se,Se,A,P),ye.fillText(s,Se,Se+w);const xt=ye.getImageData(Se,Se,A,P);at.fill(ly,0,X),We.fill(0,0,X);for(let lt=0;lt<P;lt++)for(let _t=0;_t<A;_t++){const It=xt.data[4*(lt*A+_t)+3]/255;if(It===0)continue;const Tt=(lt+Se)*R+_t+Se;if(It===1)at[Tt]=0,We[Tt]=ly;else{const sn=.5-It;at[Tt]=sn>0?sn*sn:0,We[Tt]=sn<0?sn*sn:0}}I4(at,0,0,R,$,R,this.f,this.v,this.z),I4(We,Se,Se,A,P,R,this.f,this.v,this.z);for(let lt=0;lt<X;lt++){const _t=Math.sqrt(at[lt])-Math.sqrt(We[lt]);re[lt]=Math.round(255-255*(_t/this.radius+this.cutoff))}return he}};const Bg=Nh;function L4(s,r,l,h){const p=[],x=s.image,w=x.pixelRatio,A=x.paddedRect.w-2*Bg,P=x.paddedRect.h-2*Bg,R=s.right-s.left,$=s.bottom-s.top,X=x.stretchX||[[0,A]],re=x.stretchY||[[0,P]],he=(un,kn)=>un+kn[1]-kn[0],ye=X.reduce(he,0),Se=re.reduce(he,0),We=A-ye,at=P-Se;let xt=0,lt=ye,_t=0,It=Se,Tt=0,sn=We,nn=0,Sn=at;if(x.content&&h){const un=x.content;xt=Z_(X,0,un[0]),_t=Z_(re,0,un[1]),lt=Z_(X,un[0],un[2]),It=Z_(re,un[1],un[3]),Tt=un[0]-xt,nn=un[1]-_t,sn=un[2]-un[0]-lt,Sn=un[3]-un[1]-It}const Vn=(un,kn,Rn,zn)=>{const Kn=Y_(un.stretch-xt,lt,R,s.left),wn=J_(un.fixed-Tt,sn,un.stretch,ye),_r=Y_(kn.stretch-_t,It,$,s.top),Ur=J_(kn.fixed-nn,Sn,kn.stretch,Se),br=Y_(Rn.stretch-xt,lt,R,s.left),Xi=J_(Rn.fixed-Tt,sn,Rn.stretch,ye),Zn=Y_(zn.stretch-_t,It,$,s.top),ri=J_(zn.fixed-nn,Sn,zn.stretch,Se),Zi=new q(Kn,_r),is=new q(br,_r),Yi=new q(br,Zn),wi=new q(Kn,Zn),pa=new q(wn/w,Ur/w),Ji=new q(Xi/w,ri/w),Qi=r*Math.PI/180;if(Qi){const ra=Math.sin(Qi),Os=Math.cos(Qi),Ha=[Os,-ra,ra,Os];Zi._matMult(Ha),is._matMult(Ha),wi._matMult(Ha),Yi._matMult(Ha)}const Fs=un.stretch+un.fixed,na=kn.stretch+kn.fixed;return{tl:Zi,tr:is,bl:wi,br:Yi,tex:{x:x.paddedRect.x+Bg+Fs,y:x.paddedRect.y+Bg+na,w:Rn.stretch+Rn.fixed-Fs,h:zn.stretch+zn.fixed-na},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:pa,pixelOffsetBR:Ji,minFontScaleX:sn/w/R,minFontScaleY:Sn/w/$,isSDF:l}};if(h&&(x.stretchX||x.stretchY)){const un=P4(X,We,ye),kn=P4(re,at,Se);for(let Rn=0;Rn<un.length-1;Rn++){const zn=un[Rn],Kn=un[Rn+1];for(let wn=0;wn<kn.length-1;wn++)p.push(Vn(zn,kn[wn],Kn,kn[wn+1]))}}else p.push(Vn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:A+1},{fixed:0,stretch:P+1}));return p}function Z_(s,r,l){let h=0;for(const p of s)h+=Math.max(r,Math.min(l,p[1]))-Math.max(r,Math.min(l,p[0]));return h}function P4(s,r,l){const h=[{fixed:-Bg,stretch:0}];for(const[p,x]of s){const w=h[h.length-1];h.push({fixed:p-w.stretch,stretch:w.stretch}),h.push({fixed:p-w.stretch,stretch:w.stretch+(x-p)})}return h.push({fixed:r+Bg,stretch:l}),h}function Y_(s,r,l,h){return s/r*l+h}function J_(s,r,l,h){return s-r*l/h}function fL(s,r,l,h){const p=r+s.positionedLines[h].lineOffset;return h===0?l+p/2:l+(p+(r+s.positionedLines[h-1].lineOffset))/2}class pL{constructor(r=[],l=mL){if(this.data=r,this.length=this.data.length,this.compare=l,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const r=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:l,compare:h}=this,p=l[r];for(;r>0;){const x=r-1>>1,w=l[x];if(h(p,w)>=0)break;l[r]=w,r=x}l[r]=p}_down(r){const{data:l,compare:h}=this,p=this.length>>1,x=l[r];for(;r<p;){let w=1+(r<<1),A=l[w];const P=w+1;if(P<this.length&&h(l[P],A)<0&&(w=P,A=l[P]),h(A,x)>=0)break;l[r]=A,r=w}l[r]=x}}function mL(s,r){return s<r?-1:s>r?1:0}function gL(s,r=1,l=!1){let h=1/0,p=1/0,x=-1/0,w=-1/0;const A=s[0];for(let he=0;he<A.length;he++){const ye=A[he];(!he||ye.x<h)&&(h=ye.x),(!he||ye.y<p)&&(p=ye.y),(!he||ye.x>x)&&(x=ye.x),(!he||ye.y>w)&&(w=ye.y)}const P=Math.min(x-h,w-p);let R=P/2;const $=new pL([],yL);if(P===0)return new q(h,p);for(let he=h;he<x;he+=P)for(let ye=p;ye<w;ye+=P)$.push(new zg(he+R,ye+R,R,s));let X=(function(he){let ye=0,Se=0,We=0;const at=he[0];for(let xt=0,lt=at.length,_t=lt-1;xt<lt;_t=xt++){const It=at[xt],Tt=at[_t],sn=It.x*Tt.y-Tt.x*It.y;Se+=(It.x+Tt.x)*sn,We+=(It.y+Tt.y)*sn,ye+=3*sn}return new zg(Se/ye,We/ye,0,he)})(s),re=$.length;for(;$.length;){const he=$.pop();(he.d>X.d||!X.d)&&(X=he,l&&console.log("found best %d after %d probes",Math.round(1e4*he.d)/1e4,re)),he.max-X.d<=r||(R=he.h/2,$.push(new zg(he.p.x-R,he.p.y-R,R,s)),$.push(new zg(he.p.x+R,he.p.y-R,R,s)),$.push(new zg(he.p.x-R,he.p.y+R,R,s)),$.push(new zg(he.p.x+R,he.p.y+R,R,s)),re+=4)}return l&&(console.log(`num probes: ${re}`),console.log(`best distance: ${X.d}`)),X.p}function yL(s,r){return r.max-s.max}class zg{constructor(r,l,h,p){this.p=new q(r,l),this.h=h,this.d=(function(x,w){let A=!1,P=1/0;for(let R=0;R<w.length;R++){const $=w[R];for(let X=0,re=$.length,he=re-1;X<re;he=X++){const ye=$[X],Se=$[he];ye.y>x.y!=Se.y>x.y&&x.x<(Se.x-ye.x)*(x.y-ye.y)/(Se.y-ye.y)+ye.x&&(A=!A),P=Math.min(P,$0(x,ye,Se))}}return(A?1:-1)*Math.sqrt(P)})(this.p,p),this.max=this.d+this.h*Math.SQRT2}}const jg=7,Bx=Number.POSITIVE_INFINITY,_L=Math.sqrt(2);function k4(s,[r,l]){let h=0,p=0;if(l===Bx){r<0&&(r=0);const x=r/_L;switch(s){case"top-right":case"top-left":p=x-jg;break;case"bottom-right":case"bottom-left":p=-x+jg;break;case"bottom":p=-r+jg;break;case"top":p=r-jg}switch(s){case"top-right":case"bottom-right":h=-x;break;case"top-left":case"bottom-left":h=x;break;case"left":h=r;break;case"right":h=-r}}else{switch(r=Math.abs(r),l=Math.abs(l),s){case"top-right":case"top-left":case"top":p=l-jg;break;case"bottom-right":case"bottom-left":case"bottom":p=-l+jg}switch(s){case"top-right":case"bottom-right":case"right":h=-r;break;case"top-left":case"bottom-left":case"left":h=r}}return[h,p]}function vL(s,r,l,h,p,x,w,A,P,R){s.createArrays(),s.tilePixelRatio=Jr/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const $=s.layers[0].layout,X=s.layers[0]._unevaluatedLayout._values,re={};if(s.textSizeData.kind==="composite"){const{minZoom:Se,maxZoom:We}=s.textSizeData;re.compositeTextSizes=[X["text-size"].possiblyEvaluate(new G(Se),A),X["text-size"].possiblyEvaluate(new G(We),A)]}if(s.iconSizeData.kind==="composite"){const{minZoom:Se,maxZoom:We}=s.iconSizeData;re.compositeIconSizes=[X["icon-size"].possiblyEvaluate(new G(Se),A),X["icon-size"].possiblyEvaluate(new G(We),A)]}re.layoutTextSize=X["text-size"].possiblyEvaluate(new G(P+1),A),re.layoutIconSize=X["icon-size"].possiblyEvaluate(new G(P+1),A),re.textMaxSize=X["text-size"].possiblyEvaluate(new G(18),A);const he=$.get("text-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",ye=$.get("text-size");for(const Se of s.features){const We=$.get("text-font").evaluate(Se,{},A).join(","),at=ye.evaluate(Se,{},A),xt=re.layoutTextSize.evaluate(Se,{},A),lt=(re.layoutIconSize.evaluate(Se,{},A),{horizontal:{},vertical:void 0}),_t=Se.text;let It,Tt=[0,0];if(_t){const Sn=_t.toString(),Vn=$.get("text-letter-spacing").evaluate(Se,{},A)*uu,un=$.get("text-line-height").evaluate(Se,{},A)*uu,kn=qe(Sn)?Vn:0,Rn=$.get("text-anchor").evaluate(Se,{},A),zn=$.get("text-variable-anchor");if(!zn){const br=$.get("text-radial-offset").evaluate(Se,{},A);Tt=br?k4(Rn,[br*uu,Bx]):$.get("text-offset").evaluate(Se,{},A).map((Xi=>Xi*uu))}let Kn=he?"center":$.get("text-justify").evaluate(Se,{},A);const wn=$.get("symbol-placement")==="point",_r=wn?$.get("text-max-width").evaluate(Se,{},A)*uu:1/0,Ur=br=>{s.allowVerticalPlacement&&Pe(Sn)&&(lt.vertical=Dx(_t,r,l,p,We,_r,un,Rn,br,kn,Tt,hd.vertical,!0,xt,at))};if(!he&&zn){const br=Kn==="auto"?zn.map((Zn=>zx(Zn))):[Kn];let Xi=!1;for(let Zn=0;Zn<br.length;Zn++){const ri=br[Zn];if(!lt.horizontal[ri])if(Xi)lt.horizontal[ri]=lt.horizontal[0];else{const Zi=Dx(_t,r,l,p,We,_r,un,"center",ri,kn,Tt,hd.horizontal,!1,xt,at);Zi&&(lt.horizontal[ri]=Zi,Xi=Zi.positionedLines.length===1)}}Ur("left")}else{if(Kn==="auto"&&(Kn=zx(Rn)),wn||$.get("text-writing-mode").indexOf("horizontal")>=0||!Pe(Sn)){const br=Dx(_t,r,l,p,We,_r,un,Rn,Kn,kn,Tt,hd.horizontal,!1,xt,at);br&&(lt.horizontal[Kn]=br)}Ur(wn?"left":Kn)}}let sn=!1;if(Se.icon&&Se.icon.name){const Sn=h[Se.icon.name];Sn&&(It=uL(p[Se.icon.name],$.get("icon-offset").evaluate(Se,{},A),$.get("icon-anchor").evaluate(Se,{},A)),sn=Sn.sdf,s.sdfIcons===void 0?s.sdfIcons=Sn.sdf:s.sdfIcons!==Sn.sdf&&mr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Sn.pixelRatio!==s.pixelRatio||$.get("icon-rotate").constantOr(1)!==0)&&(s.iconsNeedLinear=!0))}const nn=M4(lt.horizontal)||lt.vertical;s.iconsInText||(s.iconsInText=!!nn&&nn.iconsInText),(nn||It)&&xL(s,Se,lt,It,h,re,xt,0,Tt,sn,w,A,R)}x&&s.generateCollisionDebugBuffers(P,s.collisionBoxArray)}function zx(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function xL(s,r,l,h,p,x,w,A,P,R,$,X,re){let he=x.textMaxSize.evaluate(r,{},X);he===void 0&&(he=w);const ye=s.layers[0].layout,Se=ye.get("icon-offset").evaluate(r,{},X),We=M4(l.horizontal)||l.vertical,at=re.name==="globe",xt=uu,lt=w/xt,_t=s.tilePixelRatio*he/xt,It=(Rn=s.overscaling,s.zoom>18&&Rn>2&&(Rn>>=1),Math.max(Jr/(512*Rn),1)*ye.get("symbol-spacing")),Tt=ye.get("text-padding")*s.tilePixelRatio,sn=ye.get("icon-padding")*s.tilePixelRatio,nn=Z(ye.get("text-max-angle")),Sn=ye.get("text-rotation-alignment")==="map"&&ye.get("symbol-placement")!=="point",Vn=ye.get("icon-rotation-alignment")==="map"&&ye.get("symbol-placement")!=="point",un=ye.get("symbol-placement"),kn=It/2;var Rn;const zn=ye.get("icon-text-fit");let Kn;h&&zn!=="none"&&(s.allowVerticalPlacement&&l.vertical&&(Kn=x4(h,l.vertical,zn,ye.get("icon-text-fit-padding"),Se,lt)),We&&(h=x4(h,We,zn,ye.get("icon-text-fit-padding"),Se,lt)));const wn=(_r,Ur,br)=>{if(Ur.x<0||Ur.x>=Jr||Ur.y<0||Ur.y>=Jr)return;let Xi=null;if(at){const{x:Zn,y:ri,z:Zi}=re.projectTilePoint(Ur.x,Ur.y,br);Xi={anchor:new up(Zn,ri,Zi,0,void 0),up:re.upVector(br,Ur.x,Ur.y)}}(function(Zn,ri,Zi,is,Yi,wi,pa,Ji,Qi,Fs,na,ra,Os,Ha,fl,Gl,Bs,gc,Hl,ol,cs,Wl,ia,mh,Kl){const hu=Zn.addToLineVertexArray(ri,is);let Zc,gh,Yc,Hd,qg,yy,_y,d2=0,f2=0,p2=0,m2=0,eb=-1,tb=-1;const Sf={};let g2=Lc("");const Fm=Zi?Zi.anchor:ri;let nb=0,rb=0;if(Qi._unevaluatedLayout.getValue("text-radial-offset")===void 0?[nb,rb]=Qi.layout.get("text-offset").evaluate(cs,{},Kl).map((Wh=>Wh*uu)):(nb=Qi.layout.get("text-radial-offset").evaluate(cs,{},Kl)*uu,rb=Bx),Zn.allowVerticalPlacement&&Yi.vertical){const Wh=Yi.vertical;if(fl)yy=jx(Wh),Ji&&(_y=jx(Ji));else{const Kh=Qi.layout.get("text-rotate").evaluate(cs,{},Kl)+90;Yc=Q_(Fs,Fm,ri,na,ra,Os,Wh,Ha,Kh,Gl),Ji&&(Hd=Q_(Fs,Fm,ri,na,ra,Os,Ji,gc,Kh))}}if(wi){const Wh=Qi.layout.get("icon-rotate").evaluate(cs,{},Kl),Kh=Qi.layout.get("icon-text-fit")!=="none",vy=L4(wi,Wh,ia,Kh),ob=Ji?L4(Ji,Wh,ia,Kh):void 0;gh=Q_(Fs,Fm,ri,na,ra,Os,wi,gc,Wh),d2=4*vy.length;const y2=Zn.iconSizeData;let Om=null;y2.kind==="source"?(Om=[qd*Qi.layout.get("icon-size").evaluate(cs,{},Kl)],Om[0]>zp&&mr(`${Zn.layerIds[0]}: Value for "icon-size" is >= ${cy}. Reduce your "icon-size".`)):y2.kind==="composite"&&(Om=[qd*Wl.compositeIconSizes[0].evaluate(cs,{},Kl),qd*Wl.compositeIconSizes[1].evaluate(cs,{},Kl)],(Om[0]>zp||Om[1]>zp)&&mr(`${Zn.layerIds[0]}: Value for "icon-size" is >= ${cy}. Reduce your "icon-size".`)),Zn.addSymbols(Zn.icon,vy,Om,ol,Hl,cs,!1,Zi,ri,hu.lineStartIndex,hu.lineLength,-1,mh,Kl),eb=Zn.icon.placedSymbolArray.length-1,ob&&(f2=4*ob.length,Zn.addSymbols(Zn.icon,ob,Om,ol,Hl,cs,hd.vertical,Zi,ri,hu.lineStartIndex,hu.lineLength,-1,mh,Kl),tb=Zn.icon.placedSymbolArray.length-1)}for(const Wh in Yi.horizontal){const Kh=Yi.horizontal[Wh];Zc||(g2=Lc(Kh.text),fl?qg=jx(Kh):Zc=Q_(Fs,Fm,ri,na,ra,Os,Kh,Ha,Qi.layout.get("text-rotate").evaluate(cs,{},Kl),Gl));const vy=Kh.positionedLines.length===1;if(p2+=R4(Zn,Zi,ri,Kh,pa,Qi,fl,cs,Gl,hu,Yi.vertical?hd.horizontal:hd.horizontalOnly,vy?Object.keys(Yi.horizontal):[Wh],Sf,eb,Wl,mh,Kl),vy)break}Yi.vertical&&(m2+=R4(Zn,Zi,ri,Yi.vertical,pa,Qi,fl,cs,Gl,hu,hd.vertical,["vertical"],Sf,tb,Wl,mh,Kl));let Gp=-1;const ib=(Wh,Kh)=>Wh?Math.max(Wh,Kh):Kh;Gp=ib(qg,Gp),Gp=ib(yy,Gp),Gp=ib(_y,Gp);const KL=Gp>-1?1:0;Zn.glyphOffsetArray.length>=Up.MAX_GLYPHS&&mr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),cs.sortKey!==void 0&&Zn.addToSortKeyRanges(Zn.symbolInstances.length,cs.sortKey),Zn.symbolInstances.emplaceBack(Fm.x,Fm.y,Fm.z,ri.x,ri.y,Sf.right>=0?Sf.right:-1,Sf.center>=0?Sf.center:-1,Sf.left>=0?Sf.left:-1,Sf.vertical>=0?Sf.vertical:-1,eb,tb,g2,Zc!==void 0?Zc:Zn.collisionBoxArray.length,Zc!==void 0?Zc+1:Zn.collisionBoxArray.length,Yc!==void 0?Yc:Zn.collisionBoxArray.length,Yc!==void 0?Yc+1:Zn.collisionBoxArray.length,gh!==void 0?gh:Zn.collisionBoxArray.length,gh!==void 0?gh+1:Zn.collisionBoxArray.length,Hd||Zn.collisionBoxArray.length,Hd?Hd+1:Zn.collisionBoxArray.length,na,p2,m2,d2,f2,KL,0,nb,rb,Gp)})(s,Ur,Xi,_r,l,h,p,Kn,s.layers[0],s.collisionBoxArray,r.index,r.sourceLayerIndex,s.index,Tt,Sn,P,0,sn,Vn,Se,r,x,R,$,X)};if(un==="line")for(const _r of T4(r.geometry,0,0,Jr,Jr)){const Ur=dL(_r,It,nn,l.vertical||We,h,xt,_t,s.overscaling,Jr);for(const br of Ur)We&&bL(s,We.text,kn,br)||wn(_r,br,X)}else if(un==="line-center"){for(const _r of r.geometry)if(_r.length>1){const Ur=hL(_r,nn,l.vertical||We,h,xt,_t);Ur&&wn(_r,Ur,X)}}else if(r.type==="Polygon")for(const _r of ny(r.geometry,0)){const Ur=gL(_r,16);wn(_r[0],new up(Ur.x,Ur.y,0,0,void 0),X)}else if(r.type==="LineString")for(const _r of r.geometry)wn(_r,new up(_r[0].x,_r[0].y,0,0,void 0),X);else if(r.type==="Point")for(const _r of r.geometry)for(const Ur of _r)wn([Ur],new up(Ur.x,Ur.y,0,0,void 0),X)}const cy=255,zp=cy*qd;function R4(s,r,l,h,p,x,w,A,P,R,$,X,re,he,ye,Se,We){const at=(function(_t,It,Tt,sn,nn,Sn,Vn,un){const kn=[];if(It.positionedLines.length===0)return kn;const Rn=sn.layout.get("text-rotate").evaluate(Sn,{})*Math.PI/180,zn=(function(br){const Xi=br[0],Zn=br[1],ri=Xi*Zn;return ri>0?[Xi,-Zn]:ri<0?[-Xi,Zn]:Xi===0?[Zn,Xi]:[Zn,-Xi]})(Tt);let Kn=Math.abs(It.top-It.bottom);for(const br of It.positionedLines)Kn-=br.lineOffset;const wn=It.positionedLines.length,_r=Kn/wn;let Ur=It.top-Tt[1];for(let br=0;br<wn;++br){const Xi=It.positionedLines[br];Ur=fL(It,_r,Ur,br);for(const Zn of Xi.positionedGlyphs){if(!Zn.rect)continue;const ri=Zn.rect||{};let Zi=d4+1,is=!0,Yi=1,wi=0;if(Zn.imageName){const ia=Vn[Zn.imageName];if(!ia)continue;if(ia.sdf){mr("SDF images are not supported in formatted text and will be ignored.");continue}is=!1,Yi=ia.pixelRatio,Zi=Nh/Yi}const pa=(nn||un)&&Zn.vertical,Ji=Zn.metrics.advance*Zn.scale/2,Qi=Zn.metrics,Fs=Zn.rect;if(Fs===null)continue;un&&It.verticalizable&&(wi=Zn.imageName?Ji-Zn.metrics.width*Zn.scale/2:0);const na=nn?[Zn.x+Ji,Zn.y]:[0,0];let ra=[0,0],Os=[0,0],Ha=!1;nn||(pa?(Os=[Zn.x+Ji+zn[0],Zn.y+zn[1]-wi],Ha=!0):ra=[Zn.x+Ji+Tt[0],Zn.y+Tt[1]-wi]);const fl=Fs.w*Zn.scale/(Yi*(Zn.localGlyph?$d:1)),Gl=Fs.h*Zn.scale/(Yi*(Zn.localGlyph?$d:1));let Bs,gc,Hl,ol;if(pa){const ia=Zn.y-Ur,mh=new q(-Ji,Ji-ia),Kl=-Math.PI/2,hu=new q(...Os);Bs=new q(-Ji+ra[0],ra[1]),Bs._rotateAround(Kl,mh)._add(hu),Bs.x+=-ia+Ji,Bs.y-=(Qi.left-Zi)*Zn.scale;const Zc=Zn.imageName?Qi.advance*Zn.scale:uu*Zn.scale,gh=String.fromCharCode(Zn.glyph);KC(gh)?Bs.x+=(1-Zi)*Zn.scale:XC(gh)?Bs.x+=Zc-Qi.height*Zn.scale+(-Zi-1)*Zn.scale:Bs.x+=Zn.imageName||Qi.width+2*Zi===Fs.w&&Qi.height+2*Zi===Fs.h?(Zc-Gl)/2:(Zc-(Qi.height+2*Zi)*Zn.scale)/2,gc=new q(Bs.x,Bs.y-fl),Hl=new q(Bs.x+Gl,Bs.y),ol=new q(Bs.x+Gl,Bs.y-fl)}else{const ia=(Qi.left-Zi)*Zn.scale-Ji+ra[0],mh=(-Qi.top-Zi)*Zn.scale+ra[1],Kl=ia+fl,hu=mh+Gl;Bs=new q(ia,mh),gc=new q(Kl,mh),Hl=new q(ia,hu),ol=new q(Kl,hu)}if(Rn){let ia;ia=nn?new q(0,0):Ha?new q(zn[0],zn[1]):new q(Tt[0],Tt[1]),Bs._rotateAround(Rn,ia),gc._rotateAround(Rn,ia),Hl._rotateAround(Rn,ia),ol._rotateAround(Rn,ia)}const cs=new q(0,0),Wl=new q(0,0);kn.push({tl:Bs,tr:gc,bl:Hl,br:ol,tex:ri,writingMode:It.writingMode,glyphOffset:na,sectionIndex:Zn.sectionIndex,isSDF:is,pixelOffsetTL:cs,pixelOffsetBR:Wl,minFontScaleX:0,minFontScaleY:0})}}return kn})(0,h,P,x,w,A,p,s.allowVerticalPlacement),xt=s.textSizeData;let lt=null;xt.kind==="source"?(lt=[qd*x.layout.get("text-size").evaluate(A,{},We)],lt[0]>zp&&mr(`${s.layerIds[0]}: Value for "text-size" is >= ${cy}. Reduce your "text-size".`)):xt.kind==="composite"&&(lt=[qd*ye.compositeTextSizes[0].evaluate(A,{},We),qd*ye.compositeTextSizes[1].evaluate(A,{},We)],(lt[0]>zp||lt[1]>zp)&&mr(`${s.layerIds[0]}: Value for "text-size" is >= ${cy}. Reduce your "text-size".`)),s.addSymbols(s.text,at,lt,P,w,A,$,r,l,R.lineStartIndex,R.lineLength,he,Se,We);for(const _t of X)re[_t]=s.text.placedSymbolArray.length-1;return 4*at.length}function M4(s){for(const r in s)return s[r];return null}function Q_(s,r,l,h,p,x,w,A,P,R){let $=w.top,X=w.bottom,re=w.left,he=w.right;const ye=w.collisionPadding;if(ye&&(re-=ye[0],$-=ye[1],he+=ye[2],X+=ye[3]),P){const Se=new q(re,$),We=new q(he,$),at=new q(re,X),xt=new q(he,X),lt=Z(P);let _t=new q(0,0);R&&(_t=new q(R[0],R[1])),Se._rotateAround(lt,_t),We._rotateAround(lt,_t),at._rotateAround(lt,_t),xt._rotateAround(lt,_t),re=Math.min(Se.x,We.x,at.x,xt.x),he=Math.max(Se.x,We.x,at.x,xt.x),$=Math.min(Se.y,We.y,at.y,xt.y),X=Math.max(Se.y,We.y,at.y,xt.y)}return s.emplaceBack(r.x,r.y,r.z,l.x,l.y,re,$,he,X,A,h,p,x),s.length-1}function jx(s){s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const r=s.bottom-s.top;return r>0?Math.max(10,r):null}function bL(s,r,l,h){const p=s.compareText;if(r in p){const x=p[r];for(let w=x.length-1;w>=0;w--)if(h.dist(x[w])<l)return!0}else p[r]=[];return p[r].push(h),!1}function N4(s,r){const l=s.fovAboveCenter,h=s.elevation?s.elevation.getMinElevationBelowMSL()*r:0,p=(s._camera.position[2]*s.worldSize-h)/Math.cos(s._pitch),x=Math.sin(l)*p/Math.sin(Math.max(Math.PI/2-s._pitch-l,.01)),w=Math.sin(s._pitch)*x+p;return Math.min(1.01*w,p*(1/s._horizonShift))}function Nm(s,r){if(!r.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:r};const l=Math.pow(2,-s.z),h=s.x*l,p=(s.x+1)*l,x=s.y*l,w=(s.y+1)*l,A=mc(h),P=mc(p),R=Oo(x),$=Oo(w),X=r.project(A,R),re=r.project(P,R),he=r.project(P,$),ye=r.project(A,$);let Se=Math.min(X.x,re.x,he.x,ye.x),We=Math.min(X.y,re.y,he.y,ye.y),at=Math.max(X.x,re.x,he.x,ye.x),xt=Math.max(X.y,re.y,he.y,ye.y);const lt=l/16;function _t(Tt,sn,nn,Sn,Vn,un){const kn=(nn+Vn)/2,Rn=(Sn+un)/2,zn=r.project(mc(kn),Oo(Rn)),Kn=Math.max(0,Se-zn.x,We-zn.y,zn.x-at,zn.y-xt);Se=Math.min(Se,zn.x),at=Math.max(at,zn.x),We=Math.min(We,zn.y),xt=Math.max(xt,zn.y),Kn>lt&&(_t(Tt,zn,nn,Sn,kn,Rn),_t(zn,sn,kn,Rn,Vn,un))}_t(X,re,h,x,p,x),_t(re,he,p,x,p,w),_t(he,ye,p,w,h,w),_t(ye,X,h,w,h,x),Se-=lt,We-=lt,at+=lt,xt+=lt;const It=1/Math.max(at-Se,xt-We);return{scale:It,x:Se*It,y:We*It,x2:at*It,y2:xt*It,projection:r}}const wL=Hc(new Float32Array(16));class jp{constructor(r){this.spec=r,this.name=r.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(r,l){return{x:0,y:0,z:0}}unproject(r,l){return new Qr(0,0)}projectTilePoint(r,l,h){return{x:r,y:l,z:0}}locationPoint(r,l,h=!0){return r._coordinatePoint(r.locationCoordinate(l),h)}pixelsPerMeter(r,l){return ea(1,r)*l}pixelSpaceConversion(r,l,h){return 1}farthestPixelDistance(r){return N4(r,r.pixelsPerMeter)}pointCoordinate(r,l,h,p){const x=r.horizonLineFromTop(!1),w=new q(l,Math.max(x,h));return r.rayIntersectionCoordinate(r.pointRayIntersection(w,p))}pointCoordinate3D(r,l,h){const p=new q(l,h);if(r.elevation)return r.elevation.pointCoordinate(p);{const x=this.pointCoordinate(r,p.x,p.y,0);return[x.x,x.y,x.z]}}isPointAboveHorizon(r,l){if(r.elevation)return!this.pointCoordinate3D(r,l.x,l.y);const h=r.horizonLineFromTop();return l.y<h}createInversionMatrix(r,l){return wL}createTileMatrix(r,l,h){let p,x,w;const A=h.canonical,P=Hc(new Float64Array(16));if(this.isReprojectedInTileSpace){const R=Nm(A,this);p=1,x=R.x+h.wrap*R.scale,w=R.y,sd(P,P,[p/R.scale,p/R.scale,r.pixelsPerMeter/l])}else p=l/r.zoomScale(A.z),x=(A.x+Math.pow(2,A.z)*h.wrap)*p,w=A.y*p;return bu(P,P,[x,w,0]),sd(P,P,[p/Jr,p/Jr,1]),P}upVector(r,l,h){return[0,0,1]}upVectorScale(r,l,h){return{metersToTile:1}}}class SL extends jp{constructor(r){super(r),this.range=[4,7],this.center=r.center||[-96,37.5];const[l,h]=this.parallels=r.parallels||[29.5,45.5],p=Math.sin(Z(l));this.n=(p+Math.sin(Z(h)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(r,l){const{n:h,c:p,r0:x}=this,w=Z(r-this.center[0]),A=Z(l),P=Math.sqrt(p-2*h*Math.sin(A))/h;return{x:P*Math.sin(w*h),y:P*Math.cos(w*h)-x,z:0}}unproject(r,l){const{n:h,c:p,r0:x}=this,w=x+l;let A=Math.atan2(r,Math.abs(w))*Math.sign(w);w*h<0&&(A-=Math.PI*Math.sign(r)*Math.sign(w));const P=Z(this.center[0])*h;A=xe(A,-Math.PI-P,Math.PI-P);const R=Fe(be(A/h)+this.center[0],-180,180),$=Math.asin(Fe((p-(r*r+w*w)*h*h)/(2*h),-1,1)),X=Fe(be($),-Ma,Ma);return new Qr(R,X)}}const uy=1.340264,hy=-.081106,dy=893e-6,fy=.003796,e1=Math.sqrt(3)/2;class EL extends jp{project(r,l){l=l/180*Math.PI,r=r/180*Math.PI;const h=Math.asin(e1*Math.sin(l)),p=h*h,x=p*p*p;return{x:.5*(r*Math.cos(h)/(e1*(uy+3*hy*p+x*(7*dy+9*fy*p)))/Math.PI+.5),y:1-.5*(h*(uy+hy*p+x*(dy+fy*p))/Math.PI+1),z:0}}unproject(r,l){r=(2*r-.5)*Math.PI;let h=l=(2*(1-l)-1)*Math.PI,p=h*h,x=p*p*p;for(let $,X,re,he=0;he<12&&(X=h*(uy+hy*p+x*(dy+fy*p))-l,re=uy+3*hy*p+x*(7*dy+9*fy*p),$=X/re,h=Fe(h-$,-Math.PI/3,Math.PI/3),p=h*h,x=p*p*p,!(Math.abs($)<1e-12));++he);const w=e1*r*(uy+3*hy*p+x*(7*dy+9*fy*p))/Math.cos(h),A=Math.asin(Math.sin(h)/e1),P=Fe(180*w/Math.PI,-180,180),R=Fe(180*A/Math.PI,-Ma,Ma);return new Qr(P,R)}}class AL extends jp{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0}project(r,l){return{x:.5+r/360,y:.5-l/360,z:0}}unproject(r,l){const h=360*(r-.5),p=Fe(360*(.5-l),-Ma,Ma);return new Qr(h,p)}}const Ug=Math.PI/2;function t1(s){return Math.tan((Ug+s)/2)}class TL extends jp{constructor(r){super(r),this.center=r.center||[0,30];const[l,h]=this.parallels=r.parallels||[30,30];let p=Z(l),x=Z(h);this.southernCenter=p+x<0,this.southernCenter&&(p=-p,x=-x);const w=Math.cos(p),A=t1(p);this.n=p===x?Math.sin(p):Math.log(w/Math.cos(x))/Math.log(t1(x)/A),this.f=w*Math.pow(t1(p),this.n)/this.n}project(r,l){l=Z(l),this.southernCenter&&(l=-l),r=Z(r-this.center[0]);const h=1e-6,{n:p,f:x}=this;x>0?l<-Ug+h&&(l=-Ug+h):l>Ug-h&&(l=Ug-h);const w=x/Math.pow(t1(l),p);let A=w*Math.sin(p*r),P=x-w*Math.cos(p*r);return A=.5*(A/Math.PI+.5),P=.5*(P/Math.PI+.5),{x:A,y:this.southernCenter?P:1-P,z:0}}unproject(r,l){r=(2*r-.5)*Math.PI,this.southernCenter&&(l=1-l),l=(2*(1-l)-.5)*Math.PI;const{n:h,f:p}=this,x=p-l,w=Math.sign(x),A=Math.sign(h)*Math.sqrt(r*r+x*x);let P=Math.atan2(r,Math.abs(x))*w;x*h<0&&(P-=Math.PI*Math.sign(r)*w);const R=Fe(be(P/h)+this.center[0],-180,180),$=Fe(be(2*Math.atan(Math.pow(p/A,1/h))-Ug),-Ma,Ma);return new Qr(R,this.southernCenter?-$:$)}}class D4 extends jp{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(r,l){return{x:Ts(r),y:fa(l),z:0}}unproject(r,l){const h=mc(r),p=Oo(l);return new Qr(h,p)}}const F4=Z(Ma);class IL extends jp{project(r,l){const h=(l=Z(l))*l,p=h*h;return{x:.5*((r=Z(r))*(.8707-.131979*h+p*(p*(.003971*h-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(l*(1.007226+h*(.015085+p*(.028874*h-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(r,l){r=(2*r-.5)*Math.PI;let h=l=(2*(1-l)-1)*Math.PI,p=25,x=0,w=h*h;do{w=h*h;const R=w*w;x=(h*(1.007226+w*(.015085+R*(.028874*w-.044475-.005916*R)))-l)/(1.007226+w*(.045255+R*(.259866*w-.311325-.005916*11*R))),h=Fe(h-x,-F4,F4)}while(Math.abs(x)>1e-6&&--p>0);w=h*h;const A=Fe(be(r/(.8707+w*(w*(w*w*w*(.003971-.001529*w)-.013791)-.131979))),-180,180),P=be(h);return new Qr(A,P)}}const O4=Z(Ma);class CL extends jp{project(r,l){l=Z(l),r=Z(r);const h=Math.cos(l),p=2/Math.PI,x=Math.acos(h*Math.cos(r/2)),w=Math.sin(x)/x,A=.5*(r*p+2*h*Math.sin(r/2)/w)||0,P=.5*(l+Math.sin(l)/w)||0;return{x:.5*(A/Math.PI+.5),y:1-.5*(P/Math.PI+1),z:0}}unproject(r,l){let h=r=(2*r-.5)*Math.PI,p=l=(2*(1-l)-1)*Math.PI,x=25;const w=1e-6;let A=0,P=0;do{const R=Math.cos(p),$=Math.sin(p),X=2*$*R,re=$*$,he=R*R,ye=Math.cos(h/2),Se=Math.sin(h/2),We=2*ye*Se,at=Se*Se,xt=1-he*ye*ye,lt=xt?1/xt:0,_t=xt?Math.acos(R*ye)*Math.sqrt(1/xt):0,It=.5*(2*_t*R*Se+2*h/Math.PI)-r,Tt=.5*(_t*$+p)-l,sn=.5*lt*(he*at+_t*R*ye*re)+1/Math.PI,nn=lt*(We*X/4-_t*$*Se),Sn=.125*lt*(X*Se-_t*$*he*We),Vn=.5*lt*(re*ye+_t*at*R)+.5,un=nn*Sn-Vn*sn;A=(Tt*nn-It*Vn)/un,P=(It*Sn-Tt*sn)/un,h=Fe(h-A,-Math.PI,Math.PI),p=Fe(p-P,-O4,O4)}while((Math.abs(A)>w||Math.abs(P)>w)&&--x>0);return new Qr(be(h),be(p))}}class B4 extends jp{constructor(r){super(r),this.center=r.center||[0,0],this.parallels=r.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Z(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(r,l){const{scale:h,cosPhi:p}=this;return{x:Z(r)*p*h+.5,y:-Math.sin(Z(l))/p*h+.5,z:0}}unproject(r,l){const{scale:h,cosPhi:p}=this,x=-(l-.5)/h,w=Fe(be((r-.5)/h)/p,-180,180),A=Math.asin(Fe(x*p,-1,1)),P=Fe(be(A),-Ma,Ma);return new Qr(w,P)}}class LL extends D4{constructor(r){super(r),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(r,l,h){const p=Mc(r,l,h);return kt(p,p,fc(Ds(h))),{x:p[0],y:p[1],z:p[2]}}locationPoint(r,l){const h=Qs(l.lat,l.lng),p=ze([],h),x=r.elevation?r.elevation.getAtPointOrZero(r.locationCoordinate(l),r._centerAltitude):r._centerAltitude;tt(h,h,p,ea(1,0)*Jr*x);const w=Hc(new Float64Array(16));return Wc(w,r.pixelMatrix,r.globeMatrix),kt(h,h,w),new q(h[0],h[1])}pixelsPerMeter(r,l){return ea(1,0)*l}pixelSpaceConversion(r,l,h){const p=ea(1,r)*l,x=Ge(ea(1,45)*l,p,h);return this.pixelsPerMeter(r,l)/x}createTileMatrix(r,l,h){const p=jd(Ds(h.canonical));return Wc(new Float64Array(16),r.globeMatrix,p)}createInversionMatrix(r,l){const{center:h}=r,p=fc(Ds(l));return Jf(p,p,Z(h.lng)),Rp(p,p,Z(h.lat)),sd(p,p,[r._pixelsPerMercatorPixel,r._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(r,l,h,p){return ho(r,l,h,!0)||new Gh(0,0)}pointCoordinate3D(r,l,h){const p=this.pointCoordinate(r,l,h,0);return[p.x,p.y,p.z]}isPointAboveHorizon(r,l){return!ho(r,l.x,l.y,!1)}farthestPixelDistance(r){const l=(function(p,x){const w=p.cameraToCenterDistance,A=p._centerAltitude*x,P=p._camera,R=p._camera.forward(),$=$h([],Me([],R,-w),[0,0,A]),X=p.worldSize/(2*Math.PI),re=[0,0,-X],he=p.width/p.height,ye=Math.tan(p.fovAboveCenter),Se=Me([],P.up(),ye),We=Me([],P.right(),ye*he),at=ze([],$h([],$h([],R,Se),We)),xt=[];let lt;if(new ji($,at).closestPointOnSphere(re,X,xt)){const _t=$h([],xt,re),It=en([],_t,$);lt=Math.cos(p.fovAboveCenter)*zd(It)}else{const _t=en([],$,re),It=en([],re,$);ze(It,It);const Tt=zd(_t)-X;lt=Math.sqrt(Tt*(Tt+2*X));const sn=Math.acos(lt/(X+Tt))-Math.acos(Ke(R,It));lt*=Math.cos(sn)}return 1.01*lt})(r,this.pixelsPerMeter(r.center.lat,r.worldSize)),h=ci(r.zoom);if(h>0){const p=N4(r,ea(1,r.center.lat)*r.worldSize),x=r.worldSize/(2*Math.PI),w=Math.max(r.width,r.height)/r.worldSize*Math.PI;return Ge(l,p+x*(1-Math.cos(w)),Math.pow(h,10))}return l}upVector(r,l,h){return Mc(l,h,r,1)}upVectorScale(r){return{metersToTile:wo(uh(Ds(r)))}}}function z4(s){const r=s.parallels,l=!!r&&Math.abs(r[0]+r[1])<.01;switch(s.name){case"mercator":return new D4(s);case"equirectangular":return new AL(s);case"naturalEarth":return new IL(s);case"equalEarth":return new EL(s);case"winkelTripel":return new CL(s);case"albers":return l?new B4(s):new SL(s);case"lambertConformalConic":return l?new B4(s):new TL(s);case"globe":return new LL(s)}throw new Error(`Invalid projection name: ${s.name}`)}const PL=Fi.types,kL=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function n1(s,r,l,h,p,x,w,A,P,R,$,X,re){const he=A?Math.min(zp,Math.round(A[0])):0,ye=A?Math.min(zp,Math.round(A[1])):0;s.emplaceBack(r,l,Math.round(32*h),Math.round(32*p),x,w,(he<<1)+(P?1:0),ye,16*R,16*$,256*X,256*re)}function r1(s,r,l,h,p,x,w){s.emplaceBack(r,l,h,p,x,w)}function i1(s,r,l,h,p){s.emplaceBack(r,l,h,p),s.emplaceBack(r,l,h,p),s.emplaceBack(r,l,h,p),s.emplaceBack(r,l,h,p)}function RL(s){for(const r of s.sections)if(tn(r.text))return!0;return!1}class Ux{constructor(r){this.layoutVertexArray=new xn,this.indexArray=new Sr,this.programConfigurations=r,this.segments=new Ra,this.dynamicLayoutVertexArray=new Cn,this.opacityVertexArray=new pr,this.placedSymbolArray=new Ms,this.globeExtVertexArray=new bn}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(r,l,h,p){this.isEmpty()||(h&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,jC.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,VC.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,kL,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,UC.members,!0)),this.opacityVertexBuffer.itemSize=1),(h||p)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}hr(Ux,"SymbolBuffers");class Vx{constructor(r,l,h){this.layoutVertexArray=new r,this.layoutAttributes=l,this.indexArray=new h,this.segments=new Ra,this.collisionVertexArray=new $r,this.collisionVertexArrayExt=new gi}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,qC.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,$C.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}hr(Vx,"CollisionBuffers");class Up{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((w=>w.id)),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Hc([]),this.placementViewportMatrix=Hc([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Px(this.zoom,l["text-size"]),this.iconSizeData=Px(this.zoom,l["icon-size"]);const h=this.layers[0].layout,p=h.get("symbol-sort-key"),x=h.get("symbol-z-order");this.canOverlap=h.get("text-allow-overlap")||h.get("icon-allow-overlap")||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=h.get("text-writing-mode").map((w=>hd[w])),this.stateDependentLayerIds=this.layers.filter((w=>w.isStateDependent())).map((w=>w.id)),this.sourceID=r.sourceID,this.projection=r.projection}createArrays(){this.text=new Ux(new Vu(this.layers,this.zoom,(r=>/^text/.test(r)))),this.icon=new Ux(new Vu(this.layers,this.zoom,(r=>/^icon/.test(r)))),this.glyphOffsetArray=new As,this.lineVertexArray=new hs,this.symbolInstances=new ns}calculateGlyphDependencies(r,l,h,p,x){for(let w=0;w<r.length;w++)if(l[r.charCodeAt(w)]=!0,p&&x){const A=sy[r.charAt(w)];A&&(l[A.charCodeAt(0)]=!0)}}populate(r,l,h,p){const x=this.layers[0],w=x.layout,A=this.projection.name==="globe",P=w.get("text-font"),R=w.get("text-field"),$=w.get("icon-image"),X=(R.value.kind!=="constant"||R.value.value instanceof _o&&!R.value.value.isEmpty()||R.value.value.toString().length>0)&&(P.value.kind!=="constant"||P.value.value.length>0),re=$.value.kind!=="constant"||!!$.value.value||Object.keys($.parameters).length>0,he=w.get("symbol-sort-key");if(this.features=[],!X&&!re)return;const ye=l.iconDependencies,Se=l.glyphDependencies,We=l.availableImages,at=new G(this.zoom);for(const{feature:xt,id:lt,index:_t,sourceLayerIndex:It}of r){const Tt=x._featureFilter.needGeometry,sn=Ad(xt,Tt);if(!x._featureFilter.filter(at,sn,h))continue;if(Tt||(sn.geometry=wu(xt,h,p)),A&&xt.type!==1&&h.z<=5){const un=sn.geometry,kn=.98078528056,Rn=(zn,Kn)=>Ke(Mc(zn.x,zn.y,h,1),Mc(Kn.x,Kn.y,h,1))<kn;for(let zn=0;zn<un.length;zn++)un[zn]=Np(un[zn],Rn)}let nn,Sn;if(X){const un=x.getValueAndResolveTokens("text-field",sn,h,We),kn=_o.factory(un);RL(kn)&&(this.hasRTLText=!0),(!this.hasRTLText||T()==="unavailable"||this.hasRTLText&&z.isParsed())&&(nn=WC(kn,x,sn))}if(re){const un=x.getValueAndResolveTokens("icon-image",sn,h,We);Sn=un instanceof Us?un:Us.fromString(un)}if(!nn&&!Sn)continue;const Vn=this.sortFeaturesByKey?he.evaluate(sn,{},h):void 0;if(this.features.push({id:lt,text:nn,icon:Sn,index:_t,sourceLayerIndex:It,geometry:sn.geometry,properties:xt.properties,type:PL[xt.type],sortKey:Vn}),Sn&&(ye[Sn.name]=!0),nn){const un=P.evaluate(sn,{},h).join(","),kn=w.get("text-rotation-alignment")==="map"&&w.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(hd.vertical)>=0;for(const Rn of nn.sections)if(Rn.image)ye[Rn.image.name]=!0;else{const zn=Pe(nn.toString()),Kn=Rn.fontStack||un,wn=Se[Kn]=Se[Kn]||{};this.calculateGlyphDependencies(Rn.text,wn,kn,this.allowVerticalPlacement,zn)}}}w.get("symbol-placement")==="line"&&(this.features=(function(xt){const lt={},_t={},It=[];let Tt=0;function sn(un){It.push(xt[un]),Tt++}function nn(un,kn,Rn){const zn=_t[un];return delete _t[un],_t[kn]=zn,It[zn].geometry[0].pop(),It[zn].geometry[0]=It[zn].geometry[0].concat(Rn[0]),zn}function Sn(un,kn,Rn){const zn=lt[kn];return delete lt[kn],lt[un]=zn,It[zn].geometry[0].shift(),It[zn].geometry[0]=Rn[0].concat(It[zn].geometry[0]),zn}function Vn(un,kn,Rn){const zn=Rn?kn[0][kn[0].length-1]:kn[0][0];return`${un}:${zn.x}:${zn.y}`}for(let un=0;un<xt.length;un++){const kn=xt[un],Rn=kn.geometry,zn=kn.text?kn.text.toString():null;if(!zn){sn(un);continue}const Kn=Vn(zn,Rn),wn=Vn(zn,Rn,!0);if(Kn in _t&&wn in lt&&_t[Kn]!==lt[wn]){const _r=Sn(Kn,wn,Rn),Ur=nn(Kn,wn,It[_r].geometry);delete lt[Kn],delete _t[wn],_t[Vn(zn,It[Ur].geometry,!0)]=Ur,It[_r].geometry=null}else Kn in _t?nn(Kn,wn,Rn):wn in lt?Sn(Kn,wn,Rn):(sn(un),lt[Kn]=Tt-1,_t[wn]=Tt-1)}return It.filter((un=>un.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((xt,lt)=>xt.sortKey-lt.sortKey))}update(r,l,h,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,l,this.layers,h,p),this.icon.programConfigurations.updatePaintArrays(r,l,this.layers,h,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=z4(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,l){const h=this.lineVertexArray.length;if(r.segment!==void 0)for(const{x:p,y:x}of l)this.lineVertexArray.emplaceBack(p,x);return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(r,l,h,p,x,w,A,P,R,$,X,re,he,ye){const Se=r.indexArray,We=r.layoutVertexArray,at=r.globeExtVertexArray,xt=r.segments.prepareSegment(4*l.length,We,Se,this.canOverlap?w.sortKey:void 0),lt=this.glyphOffsetArray.length,_t=xt.vertexLength,It=this.allowVerticalPlacement&&A===hd.vertical?Math.PI/2:0,Tt=w.text&&w.text.sections;for(let nn=0;nn<l.length;nn++){const{tl:Sn,tr:Vn,bl:un,br:kn,tex:Rn,pixelOffsetTL:zn,pixelOffsetBR:Kn,minFontScaleX:wn,minFontScaleY:_r,glyphOffset:Ur,isSDF:br,sectionIndex:Xi}=l[nn],Zn=xt.vertexLength,ri=Ur[1];if(n1(We,R.x,R.y,Sn.x,ri+Sn.y,Rn.x,Rn.y,h,br,zn.x,zn.y,wn,_r),n1(We,R.x,R.y,Vn.x,ri+Vn.y,Rn.x+Rn.w,Rn.y,h,br,Kn.x,zn.y,wn,_r),n1(We,R.x,R.y,un.x,ri+un.y,Rn.x,Rn.y+Rn.h,h,br,zn.x,Kn.y,wn,_r),n1(We,R.x,R.y,kn.x,ri+kn.y,Rn.x+Rn.w,Rn.y+Rn.h,h,br,Kn.x,Kn.y,wn,_r),P){const{x:Zi,y:is,z:Yi}=P.anchor,[wi,pa,Ji]=P.up;r1(at,Zi,is,Yi,wi,pa,Ji),r1(at,Zi,is,Yi,wi,pa,Ji),r1(at,Zi,is,Yi,wi,pa,Ji),r1(at,Zi,is,Yi,wi,pa,Ji),i1(r.dynamicLayoutVertexArray,Zi,is,Yi,It)}else i1(r.dynamicLayoutVertexArray,R.x,R.y,R.z,It);Se.emplaceBack(Zn,Zn+1,Zn+2),Se.emplaceBack(Zn+1,Zn+2,Zn+3),xt.vertexLength+=4,xt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ur[0]),nn!==l.length-1&&Xi===l[nn+1].sectionIndex||r.programConfigurations.populatePaintArrays(We.length,w,w.index,{},he,ye,Tt&&Tt[Xi])}const sn=P?P.anchor:R;r.placedSymbolArray.emplaceBack(sn.x,sn.y,sn.z,R.x,R.y,lt,this.glyphOffsetArray.length-lt,_t,$,X,R.segment,h?h[0]:0,h?h[1]:0,p[0],p[1],A,0,!1,0,re,0)}_commitLayoutVertex(r,l,h,p,x,w,A){r.emplaceBack(l,h,p,x,w,Math.round(A.x),Math.round(A.y))}_addCollisionDebugVertices(r,l,h,p,x,w,A){const P=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),R=P.vertexLength,$=A.tileAnchorX,X=A.tileAnchorY;for(let he=0;he<4;he++)h.collisionVertexArray.emplaceBack(0,0,0,0);h.collisionVertexArrayExt.emplaceBack(l,-r.padding,-r.padding),h.collisionVertexArrayExt.emplaceBack(l,r.padding,-r.padding),h.collisionVertexArrayExt.emplaceBack(l,r.padding,r.padding),h.collisionVertexArrayExt.emplaceBack(l,-r.padding,r.padding),this._commitLayoutVertex(h.layoutVertexArray,p,x,w,$,X,new q(r.x1,r.y1)),this._commitLayoutVertex(h.layoutVertexArray,p,x,w,$,X,new q(r.x2,r.y1)),this._commitLayoutVertex(h.layoutVertexArray,p,x,w,$,X,new q(r.x2,r.y2)),this._commitLayoutVertex(h.layoutVertexArray,p,x,w,$,X,new q(r.x1,r.y2)),P.vertexLength+=4;const re=h.indexArray;re.emplaceBack(R,R+1),re.emplaceBack(R+1,R+2),re.emplaceBack(R+2,R+3),re.emplaceBack(R+3,R),P.primitiveLength+=4}_addTextDebugCollisionBoxes(r,l,h,p,x,w){for(let A=p;A<x;A++){const P=h.get(A),R=this.getSymbolInstanceTextSize(r,w,l,A);this._addCollisionDebugVertices(P,R,this.textCollisionBox,P.projectedAnchorX,P.projectedAnchorY,P.projectedAnchorZ,w)}}_addIconDebugCollisionBoxes(r,l,h,p,x,w){for(let A=p;A<x;A++){const P=h.get(A),R=this.getSymbolInstanceIconSize(r,l,w.placedIconSymbolIndex);this._addCollisionDebugVertices(P,R,this.iconCollisionBox,P.projectedAnchorX,P.projectedAnchorY,P.projectedAnchorZ,w)}}generateCollisionDebugBuffers(r,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Vx(sr,i4.members,ts),this.iconCollisionBox=new Vx(sr,i4.members,ts);const h=Mg(this.iconSizeData,r),p=Mg(this.textSizeData,r);for(let x=0;x<this.symbolInstances.length;x++){const w=this.symbolInstances.get(x);this._addTextDebugCollisionBoxes(p,r,l,w.textBoxStartIndex,w.textBoxEndIndex,w),this._addTextDebugCollisionBoxes(p,r,l,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w),this._addIconDebugCollisionBoxes(h,r,l,w.iconBoxStartIndex,w.iconBoxEndIndex,w),this._addIconDebugCollisionBoxes(h,r,l,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w)}}getSymbolInstanceTextSize(r,l,h,p){const x=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:p),w=H_(this.textSizeData,r,x)/uu;return this.tilePixelRatio*w}getSymbolInstanceIconSize(r,l,h){const p=this.icon.placedSymbolArray.get(h),x=H_(this.iconSizeData,r,p);return this.tilePixelRatio*x}_commitDebugCollisionVertexUpdate(r,l,h){r.emplaceBack(l,-h,-h),r.emplaceBack(l,h,-h),r.emplaceBack(l,h,h),r.emplaceBack(l,-h,h)}_updateTextDebugCollisionBoxes(r,l,h,p,x,w){for(let A=p;A<x;A++){const P=h.get(A),R=this.getSymbolInstanceTextSize(r,w,l,A);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,R,P.padding)}}_updateIconDebugCollisionBoxes(r,l,h,p,x,w){for(let A=p;A<x;A++){const P=h.get(A),R=this.getSymbolInstanceIconSize(r,l,w);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,R,P.padding)}}updateCollisionDebugBuffers(r,l){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const h=Mg(this.iconSizeData,r),p=Mg(this.textSizeData,r);for(let x=0;x<this.symbolInstances.length;x++){const w=this.symbolInstances.get(x);this._updateTextDebugCollisionBoxes(p,r,l,w.textBoxStartIndex,w.textBoxEndIndex,w),this._updateTextDebugCollisionBoxes(p,r,l,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w),this._updateIconDebugCollisionBoxes(h,r,l,w.iconBoxStartIndex,w.iconBoxEndIndex,w.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(h,r,l,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,l,h,p,x,w,A,P,R){const $={};if(l<h){const{x1:X,y1:re,x2:he,y2:ye,padding:Se,projectedAnchorX:We,projectedAnchorY:at,projectedAnchorZ:xt,tileAnchorX:lt,tileAnchorY:_t,featureIndex:It}=r.get(l);$.textBox={x1:X,y1:re,x2:he,y2:ye,padding:Se,projectedAnchorX:We,projectedAnchorY:at,projectedAnchorZ:xt,tileAnchorX:lt,tileAnchorY:_t},$.textFeatureIndex=It}if(p<x){const{x1:X,y1:re,x2:he,y2:ye,padding:Se,projectedAnchorX:We,projectedAnchorY:at,projectedAnchorZ:xt,tileAnchorX:lt,tileAnchorY:_t,featureIndex:It}=r.get(p);$.verticalTextBox={x1:X,y1:re,x2:he,y2:ye,padding:Se,projectedAnchorX:We,projectedAnchorY:at,projectedAnchorZ:xt,tileAnchorX:lt,tileAnchorY:_t},$.verticalTextFeatureIndex=It}if(w<A){const{x1:X,y1:re,x2:he,y2:ye,padding:Se,projectedAnchorX:We,projectedAnchorY:at,projectedAnchorZ:xt,tileAnchorX:lt,tileAnchorY:_t,featureIndex:It}=r.get(w);$.iconBox={x1:X,y1:re,x2:he,y2:ye,padding:Se,projectedAnchorX:We,projectedAnchorY:at,projectedAnchorZ:xt,tileAnchorX:lt,tileAnchorY:_t},$.iconFeatureIndex=It}if(P<R){const{x1:X,y1:re,x2:he,y2:ye,padding:Se,projectedAnchorX:We,projectedAnchorY:at,projectedAnchorZ:xt,tileAnchorX:lt,tileAnchorY:_t,featureIndex:It}=r.get(P);$.verticalIconBox={x1:X,y1:re,x2:he,y2:ye,padding:Se,projectedAnchorX:We,projectedAnchorY:at,projectedAnchorZ:xt,tileAnchorX:lt,tileAnchorY:_t},$.verticalIconFeatureIndex=It}return $}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const h=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,l){const h=r.placedSymbolArray.get(l),p=h.vertexStartIndex+4*h.numGlyphs;for(let x=h.vertexStartIndex;x<p;x+=4)r.indexArray.emplaceBack(x,x+1,x+2),r.indexArray.emplaceBack(x+1,x+2,x+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const l=Math.sin(r),h=Math.cos(r),p=[],x=[],w=[];for(let A=0;A<this.symbolInstances.length;++A){w.push(A);const P=this.symbolInstances.get(A);p.push(0|Math.round(l*P.tileAnchorX+h*P.tileAnchorY)),x.push(P.featureIndex)}return w.sort(((A,P)=>p[A]-p[P]||x[P]-x[A])),w}addToSortKeyRanges(r,l){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===l?h.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const h=this.symbolInstances.get(l);this.featureSortOrder.push(h.featureIndex);const{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:x,leftJustifiedTextSymbolIndex:w,verticalPlacedTextSymbolIndex:A,placedIconSymbolIndex:P,verticalPlacedIconSymbolIndex:R}=h;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),x>=0&&x!==p&&this.addIndicesForPlacedSymbol(this.text,x),w>=0&&w!==x&&w!==p&&this.addIndicesForPlacedSymbol(this.text,w),A>=0&&this.addIndicesForPlacedSymbol(this.text,A),P>=0&&this.addIndicesForPlacedSymbol(this.icon,P),R>=0&&this.addIndicesForPlacedSymbol(this.icon,R)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}hr(Up,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Up.MAX_GLYPHS=65535,Up.addDynamicAttributes=i1;const ML=new ot({"symbol-placement":new _e(dn.layout_symbol["symbol-placement"]),"symbol-spacing":new _e(dn.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new _e(dn.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new $e(dn.layout_symbol["symbol-sort-key"]),"symbol-z-order":new _e(dn.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new _e(dn.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new _e(dn.layout_symbol["icon-ignore-placement"]),"icon-optional":new _e(dn.layout_symbol["icon-optional"]),"icon-rotation-alignment":new _e(dn.layout_symbol["icon-rotation-alignment"]),"icon-size":new $e(dn.layout_symbol["icon-size"]),"icon-text-fit":new _e(dn.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new _e(dn.layout_symbol["icon-text-fit-padding"]),"icon-image":new $e(dn.layout_symbol["icon-image"]),"icon-rotate":new $e(dn.layout_symbol["icon-rotate"]),"icon-padding":new _e(dn.layout_symbol["icon-padding"]),"icon-keep-upright":new _e(dn.layout_symbol["icon-keep-upright"]),"icon-offset":new $e(dn.layout_symbol["icon-offset"]),"icon-anchor":new $e(dn.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new _e(dn.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new _e(dn.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new _e(dn.layout_symbol["text-rotation-alignment"]),"text-field":new $e(dn.layout_symbol["text-field"]),"text-font":new $e(dn.layout_symbol["text-font"]),"text-size":new $e(dn.layout_symbol["text-size"]),"text-max-width":new $e(dn.layout_symbol["text-max-width"]),"text-line-height":new $e(dn.layout_symbol["text-line-height"]),"text-letter-spacing":new $e(dn.layout_symbol["text-letter-spacing"]),"text-justify":new $e(dn.layout_symbol["text-justify"]),"text-radial-offset":new $e(dn.layout_symbol["text-radial-offset"]),"text-variable-anchor":new _e(dn.layout_symbol["text-variable-anchor"]),"text-anchor":new $e(dn.layout_symbol["text-anchor"]),"text-max-angle":new _e(dn.layout_symbol["text-max-angle"]),"text-writing-mode":new _e(dn.layout_symbol["text-writing-mode"]),"text-rotate":new $e(dn.layout_symbol["text-rotate"]),"text-padding":new _e(dn.layout_symbol["text-padding"]),"text-keep-upright":new _e(dn.layout_symbol["text-keep-upright"]),"text-transform":new $e(dn.layout_symbol["text-transform"]),"text-offset":new $e(dn.layout_symbol["text-offset"]),"text-allow-overlap":new _e(dn.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new _e(dn.layout_symbol["text-ignore-placement"]),"text-optional":new _e(dn.layout_symbol["text-optional"])});var qx={paint:new ot({"icon-opacity":new $e(dn.paint_symbol["icon-opacity"]),"icon-color":new $e(dn.paint_symbol["icon-color"]),"icon-halo-color":new $e(dn.paint_symbol["icon-halo-color"]),"icon-halo-width":new $e(dn.paint_symbol["icon-halo-width"]),"icon-halo-blur":new $e(dn.paint_symbol["icon-halo-blur"]),"icon-translate":new _e(dn.paint_symbol["icon-translate"]),"icon-translate-anchor":new _e(dn.paint_symbol["icon-translate-anchor"]),"text-opacity":new $e(dn.paint_symbol["text-opacity"]),"text-color":new $e(dn.paint_symbol["text-color"],{runtimeType:js,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new $e(dn.paint_symbol["text-halo-color"]),"text-halo-width":new $e(dn.paint_symbol["text-halo-width"]),"text-halo-blur":new $e(dn.paint_symbol["text-halo-blur"]),"text-translate":new _e(dn.paint_symbol["text-translate"]),"text-translate-anchor":new _e(dn.paint_symbol["text-translate-anchor"])}),layout:ML};class j4{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:Cs,this.defaultValue=r}evaluate(r){if(r.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(r.formattedSection))return l.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}hr(j4,"FormatSectionOverride",{omit:["defaultValue"]});class o1 extends Rh{constructor(r){super(r,qx)}recalculate(r,l){super.recalculate(r,l),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const h=this.layout.get("text-writing-mode");if(h){const p=[];for(const x of h)p.indexOf(x)<0&&p.push(x);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(r,l,h,p){const x=this.layout.get(r).evaluate(l,{},h,p),w=this._unevaluatedLayout._values[r];return w.isDataDriven()||oc(w.value)||!x?x:(function(A,P){return P.replace(/{([^{}]+)}/g,((R,$)=>$ in A?String(A[$]):""))})(l.properties,x)}createBucket(r){return new Up(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of qx.paint.overridableProperties){if(!o1.hasPaintOverride(this.layout,r))continue;const l=this.paint.get(r),h=new j4(l),p=new qc(h,l.property.specification);let x=null;x=l.value.kind==="constant"||l.value.kind==="source"?new jl("source",p):new va("composite",p,l.value.zoomStops,l.value._interpolationType),this.paint._values[r]=new Ue(l.property,x,l.parameters)}}_handleOverridablePaintPropertyUpdate(r,l,h){return!(!this.layout||l.isDataDriven()||h.isDataDriven())&&o1.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,l){const h=r.get("text-field"),p=qx.paint.properties[l];let x=!1;const w=A=>{for(const P of A)if(p.overrides&&p.overrides.hasOverride(P))return void(x=!0)};if(h.value.kind==="constant"&&h.value.value instanceof _o)w(h.value.value.sections);else if(h.value.kind==="source"){const A=R=>{x||(R instanceof Vs&&vo(R.value)===yl?w(R.value.sections):R instanceof Ja?w(R.sections):R.eachChild(A))},P=h.value;P._styleExpression&&A(P._styleExpression.expression)}return x}getProgramConfiguration(r){return new ch(this,r)}}var NL={paint:new ot({"background-color":new _e(dn.paint_background["background-color"]),"background-pattern":new _e(dn.paint_background["background-pattern"]),"background-opacity":new _e(dn.paint_background["background-opacity"])})},DL={paint:new ot({"raster-opacity":new _e(dn.paint_raster["raster-opacity"]),"raster-hue-rotate":new _e(dn.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new _e(dn.paint_raster["raster-brightness-min"]),"raster-brightness-max":new _e(dn.paint_raster["raster-brightness-max"]),"raster-saturation":new _e(dn.paint_raster["raster-saturation"]),"raster-contrast":new _e(dn.paint_raster["raster-contrast"]),"raster-resampling":new _e(dn.paint_raster["raster-resampling"]),"raster-fade-duration":new _e(dn.paint_raster["raster-fade-duration"])})};class FL extends Rh{constructor(r){super(r,{}),this.implementation=r}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}var OL={paint:new ot({"sky-type":new _e(dn.paint_sky["sky-type"]),"sky-atmosphere-sun":new _e(dn.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new _e(dn.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new _e(dn.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new _e(dn.paint_sky["sky-gradient-radius"]),"sky-gradient":new it(dn.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new _e(dn.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new _e(dn.paint_sky["sky-atmosphere-color"]),"sky-opacity":new _e(dn.paint_sky["sky-opacity"])})};function $x(s,r,l){const h=[0,0,1],p=On([]);return ti(p,p,l?-Z(s)+Math.PI:Z(s)),gr(p,p,-Z(r)),gt(h,h,p),ze(h,h)}const BL={circle:class extends Rh{constructor(s){super(s,z_)}createBucket(s){return new rp(s)}queryRadius(s){const r=s;return ip("circle-radius",this,r)+ip("circle-stroke-width",this,r)+Dp(this.paint.get("circle-translate"))}queryIntersectsFeature(s,r,l,h,p,x,w,A){const P=Ag(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,s.pixelToTileUnitsFactor),R=this.paint.get("circle-radius").evaluate(r,l)+this.paint.get("circle-stroke-width").evaluate(r,l);return G0(s,h,x,w,A,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",P,R)}getProgramIds(){return["circle"]}getProgramConfiguration(s){return new ch(this,s)}},heatmap:class extends Rh{createBucket(s){return new W0(s)}constructor(s){super(s,Pl),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Z0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(s){return ip("heatmap-radius",this,s)}queryIntersectsFeature(s,r,l,h,p,x,w,A){const P=this.paint.get("heatmap-radius").evaluate(r,l);return G0(s,h,x,w,A,!0,!0,new q(0,0),P)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(s){return new ch(this,s)}},hillshade:class extends Rh{constructor(s){super(s,j_)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Rh{constructor(s){super(s,K)}getProgramIds(){const s=this.paint.get("fill-pattern"),r=s&&s.constantOr(1),l=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getProgramConfiguration(s){return new ch(this,s)}recalculate(s,r){super.recalculate(s,r);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new E(s)}queryRadius(){return Dp(this.paint.get("fill-translate"))}queryIntersectsFeature(s,r,l,h,p,x){return!s.queryGeometry.isAboveHorizon&&Em(gf(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,s.pixelToTileUnitsFactor),h)}isTileClipped(){return!0}},"fill-extrusion":class extends Rh{constructor(s){super(s,RC)}createBucket(s){return new ry(s)}queryRadius(){return Dp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(s){return new ch(this,s)}queryIntersectsFeature(s,r,l,h,p,x,w,A,P){const R=Ag(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,s.pixelToTileUnitsFactor),$=this.paint.get("fill-extrusion-height").evaluate(r,l),X=this.paint.get("fill-extrusion-base").evaluate(r,l),re=[0,0],he=A&&x.elevation,ye=x.elevation?x.elevation.exaggeration():1,Se=s.tile.getBucket(this);if(he&&Se instanceof ry){const _t=Se.centroidVertexArray,It=P+1;It<_t.length&&(re[0]=_t.geta_centroid_pos0(It),re[1]=_t.geta_centroid_pos1(It))}if(re[0]===0&&re[1]===1)return!1;x.projection.name==="globe"&&(h=Z3([h],[new q(0,0),new q(Jr,Jr)],s.tileID.canonical).map((_t=>_t.polygon)).flat());const We=he?A:null,[at,xt]=(function(_t,It,Tt,sn,nn,Sn,Vn,un,kn,Rn,zn){return _t.projection.name==="globe"?(function(Kn,wn,_r,Ur,br,Xi,Zn,ri,Zi,is,Yi){const wi=[],pa=[],Ji=Kn.projection.upVectorScale(Yi,Kn.center.lat,Kn.worldSize).metersToTile,Qi=[0,0,0,1],Fs=[0,0,0,1],na=(Os,Ha,fl,Gl)=>{Os[0]=Ha,Os[1]=fl,Os[2]=Gl,Os[3]=1},ra=X3();_r>0&&(_r+=ra),Ur+=ra;for(const Os of wn){const Ha=[],fl=[];for(const Gl of Os){const Bs=Gl.x+br.x,gc=Gl.y+br.y,Hl=Kn.projection.projectTilePoint(Bs,gc,Yi),ol=Kn.projection.upVector(Yi,Gl.x,Gl.y);let cs=_r,Wl=Ur;if(Zn){const ia=e4(Bs,gc,_r,Ur,Zn,ri,Zi,is);cs+=ia.base,Wl+=ia.top}_r!==0?na(Qi,Hl.x+ol[0]*Ji*cs,Hl.y+ol[1]*Ji*cs,Hl.z+ol[2]*Ji*cs):na(Qi,Hl.x,Hl.y,Hl.z),na(Fs,Hl.x+ol[0]*Ji*Wl,Hl.y+ol[1]*Ji*Wl,Hl.z+ol[2]*Ji*Wl),kt(Qi,Qi,Xi),kt(Fs,Fs,Xi),Ha.push(new Rg(Qi[0],Qi[1],Qi[2])),fl.push(new Rg(Fs[0],Fs[1],Fs[2]))}wi.push(Ha),pa.push(fl)}return[wi,pa]})(_t,It,Tt,sn,nn,Sn,Vn,un,kn,Rn,zn):Vn?(function(Kn,wn,_r,Ur,br,Xi,Zn,ri,Zi){const is=[],Yi=[],wi=[0,0,0,1];for(const pa of Kn){const Ji=[],Qi=[];for(const Fs of pa){const na=Fs.x+Ur.x,ra=Fs.y+Ur.y,Os=e4(na,ra,wn,_r,Xi,Zn,ri,Zi);wi[0]=na,wi[1]=ra,wi[2]=Os.base,wi[3]=1,$n(wi,wi,br),wi[3]=Math.max(wi[3],1e-5);const Ha=new Rg(wi[0]/wi[3],wi[1]/wi[3],wi[2]/wi[3]);wi[0]=na,wi[1]=ra,wi[2]=Os.top,wi[3]=1,$n(wi,wi,br),wi[3]=Math.max(wi[3],1e-5);const fl=new Rg(wi[0]/wi[3],wi[1]/wi[3],wi[2]/wi[3]);Ji.push(Ha),Qi.push(fl)}is.push(Ji),Yi.push(Qi)}return[is,Yi]})(It,Tt,sn,nn,Sn,Vn,un,kn,Rn):(function(Kn,wn,_r,Ur,br){const Xi=[],Zn=[],ri=br[8]*wn,Zi=br[9]*wn,is=br[10]*wn,Yi=br[11]*wn,wi=br[8]*_r,pa=br[9]*_r,Ji=br[10]*_r,Qi=br[11]*_r;for(const Fs of Kn){const na=[],ra=[];for(const Os of Fs){const Ha=Os.x+Ur.x,fl=Os.y+Ur.y,Gl=br[0]*Ha+br[4]*fl+br[12],Bs=br[1]*Ha+br[5]*fl+br[13],gc=br[2]*Ha+br[6]*fl+br[14],Hl=br[3]*Ha+br[7]*fl+br[15],ol=Gl+ri,cs=Bs+Zi,Wl=gc+is,ia=Math.max(Hl+Yi,1e-5),mh=Gl+wi,Kl=Bs+pa,hu=gc+Ji,Zc=Math.max(Hl+Qi,1e-5);na.push(new Rg(ol/ia,cs/ia,Wl/ia)),ra.push(new Rg(mh/Zc,Kl/Zc,hu/Zc))}Xi.push(na),Zn.push(ra)}return[Xi,Zn]})(It,Tt,sn,nn,Sn)})(x,h,X,$,R,w,We,re,ye,x.center.lat,s.tileID.canonical),lt=s.queryGeometry;return(function(_t,It,Tt){let sn=1/0;Em(Tt,It)&&(sn=Q3(Tt,It[0]));for(let nn=0;nn<It.length;nn++){const Sn=It[nn],Vn=_t[nn];for(let un=0;un<Sn.length-1;un++){const kn=Sn[un],Rn=[kn,Sn[un+1],Vn[un+1],Vn[un],kn];wg(Tt,Rn)&&(sn=Math.min(sn,Q3(Tt,Rn)))}}return sn!==1/0&&sn})(at,xt,lt.isPointQuery()?lt.screenBounds:lt.screenGeometry)}},line:class extends Rh{constructor(s){super(s,t4),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof ve,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(s,r){super.recalculate(s,r),this.paint._values["line-floorwidth"]=n4.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new G_(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(s){return new ch(this,s)}queryRadius(s){const r=s,l=r4(ip("line-width",this,r),ip("line-gap-width",this,r)),h=ip("line-offset",this,r);return l/2+Math.abs(h)+Dp(this.paint.get("line-translate"))}queryIntersectsFeature(s,r,l,h,p,x){if(s.queryGeometry.isAboveHorizon)return!1;const w=gf(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,s.pixelToTileUnitsFactor),A=s.pixelToTileUnitsFactor/2*r4(this.paint.get("line-width").evaluate(r,l),this.paint.get("line-gap-width").evaluate(r,l)),P=this.paint.get("line-offset").evaluate(r,l);return P&&(h=(function(R,$){const X=[],re=new q(0,0);for(let he=0;he<R.length;he++){const ye=R[he],Se=[];for(let We=0;We<ye.length;We++){const at=ye[We],xt=ye[We+1],lt=We===0?re:at.sub(ye[We-1])._unit()._perp(),_t=We===ye.length-1?re:xt.sub(at)._unit()._perp(),It=lt._add(_t)._unit();It._mult(1/(It.x*_t.x+It.y*_t.y)),Se.push(It._mult($)._add(at))}X.push(Se)}return X})(h,P*s.pixelToTileUnitsFactor)),(function(R,$,X){for(let re=0;re<$.length;re++){const he=$[re];if(R.length>=3){for(let ye=0;ye<he.length;ye++)if(Vd(R,he[ye]))return!0}if($u(R,he,X))return!0}return!1})(w,h,A)}isTileClipped(){return!0}},symbol:o1,background:class extends Rh{constructor(s){super(s,NL)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Rh{constructor(s){super(s,DL)}getProgramIds(){return["raster"]}},sky:class extends Rh{constructor(s){super(s,OL),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="sky-gradient"?this._updateColorRamp():s!=="sky-atmosphere-sun"&&s!=="sky-atmosphere-halo-color"&&s!=="sky-atmosphere-color"&&s!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Z0({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}return!1}getCenter(s,r){if(this.paint.get("sky-type")==="atmosphere"){const h=this.paint.get("sky-atmosphere-sun"),p=!h,x=s.style.light,w=x.properties.get("position");return p&&x.properties.get("anchor")==="viewport"&&mr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?$x(w.azimuthal,90-w.polar,r):$x(h[0],90-h[1],r)}const l=this.paint.get("sky-gradient-center");return $x(l[0],90-l[1],r)}is3D(){return!1}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return s==="atmosphere"?["skyboxCapture","skybox"]:s==="gradient"?["skyboxGradient"]:null}}};class py{constructor(r,l,h,p){this.context=r,this.format=h,this.texture=r.gl.createTexture(),this.update(l,p)}update(r,l,h){const{width:p,height:x}=r,{context:w}=this,{gl:A}=w,{HTMLImageElement:P,HTMLCanvasElement:R,HTMLVideoElement:$,ImageData:X,ImageBitmap:re}=b;if(A.bindTexture(A.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===A.RGBA&&(!l||l.premultiply!==!1)),h||this.size&&this.size[0]===p&&this.size[1]===x){const{x:he,y:ye}=h||{x:0,y:0};r instanceof P||r instanceof R||r instanceof $||r instanceof X||re&&r instanceof re?A.texSubImage2D(A.TEXTURE_2D,0,he,ye,A.RGBA,A.UNSIGNED_BYTE,r):A.texSubImage2D(A.TEXTURE_2D,0,he,ye,p,x,A.RGBA,A.UNSIGNED_BYTE,r.data)}else this.size=[p,x],r instanceof P||r instanceof R||r instanceof $||r instanceof X||re&&r instanceof re?A.texImage2D(A.TEXTURE_2D,0,this.format,this.format,A.UNSIGNED_BYTE,r):A.texImage2D(A.TEXTURE_2D,0,this.format,p,x,0,this.format,A.UNSIGNED_BYTE,r.data);this.useMipmap=!!(l&&l.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&A.generateMipmap(A.TEXTURE_2D)}bind(r,l){const{context:h}=this,{gl:p}=h;p.bindTexture(p.TEXTURE_2D,this.texture),r!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,r),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?r===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_NEAREST:r),this.filter=r),l!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,l),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class zL{constructor(r){this._callback=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class jL{constructor(){this.tasks={},this.taskQueue=[],Yt(["process"],this),this.invoker=new zL(this.process),this.nextId=0}add(r,l){const h=this.nextId++,p=(function({type:x,isSymbolTile:w,zoom:A}){return A=A||0,x==="message"?0:x!=="maybePrepare"||w?x!=="parseTile"||w?x==="parseTile"&&w?300-A:x==="maybePrepare"&&w?400-A:500:200-A:100-A})(l);if(p===0){Ln();try{r()}finally{}return{cancel:()=>{}}}return this.tasks[h]={fn:r,metadata:l,priority:p,id:h},this.taskQueue.push(h),this.invoker.trigger(),{cancel:()=>{delete this.tasks[h]}}}process(){Ln();try{if(this.taskQueue=this.taskQueue.filter((h=>!!this.tasks[h])),!this.taskQueue.length)return;const r=this.pick();if(r===null)return;const l=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let r=null,l=1/0;for(let p=0;p<this.taskQueue.length;p++){const x=this.tasks[this.taskQueue[p]];x.priority<l&&(l=x.priority,r=p)}if(r===null)return null;const h=this.taskQueue[r];return this.taskQueue.splice(r,1),h}remove(){this.invoker.remove()}}class U4{constructor(r){this._stringToNumber={},this._numberToString=[];for(let l=0;l<r.length;l++){const h=r[l];this._stringToNumber[h]=l,this._numberToString[l]=h}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}const UL=["tile","layer","source","sourceLayer","state"];class V4{constructor(r,l,h,p,x){this.type="Feature",this._vectorTileFeature=r,this._z=l,this._x=h,this._y=p,this.properties=r.properties,this.id=x}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(r.id=this.id);for(const l of UL)this[l]!==void 0&&(r[l]=this[l]);return r}}const Id=32,xf=33,Vp=new Uint16Array(8184);for(let s=0;s<2046;s++){let r=s+2,l=0,h=0,p=0,x=0,w=0,A=0;for(1&r?p=x=w=Id:l=h=A=Id;(r>>=1)>1;){const R=l+p>>1,$=h+x>>1;1&r?(p=l,x=h,l=w,h=A):(l=p,h=x,p=w,x=A),w=R,A=$}const P=4*s;Vp[P+0]=l,Vp[P+1]=h,Vp[P+2]=p,Vp[P+3]=x}const bf=new Uint16Array(2178),qp=new Uint8Array(1089),s1=new Uint16Array(1089);function q4(s){return s===0?-.03125:s===32?.03125:0}var $4=Lt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const G4={type:2,extent:Jr,loadGeometry:()=>[[new q(0,0),new q(Jr+1,0),new q(Jr+1,Jr+1),new q(0,Jr+1),new q(0,0)]]};class Gx{constructor(r,l,h,p,x){this.tileID=r,this.uid=rt(),this.uses=0,this.tileSize=l,this.tileZoom=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=x,this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection)}registerFadeDuration(r){const l=r+this.timeAdded;l<Ko.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Nm(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,l,h){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=(function(p,x){const w={};if(!x)return w;for(const A of p){const P=A.layerIds.map((R=>x.getLayer(R))).filter(Boolean);if(P.length!==0){A.layers=P,A.stateDependentLayerIds&&(A.stateDependentLayers=A.stateDependentLayerIds.map((R=>P.filter(($=>$.id===R))[0])));for(const R of P)w[R.id]=A}}return w})(r.buckets,l.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const x=this.buckets[p];if(x instanceof Up){if(this.hasSymbolBuckets=!0,!h)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const x=this.buckets[p];if(x instanceof Up&&x.hasRTLText){this.hasRTLText=!0,z.isLoading()||z.isLoaded()||T()!=="deferred"||N();break}}this.queryPadding=0;for(const p in this.buckets){const x=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(p).queryRadius(x))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas)}else this.collisionBoxArray=new eo}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(r){return this.buckets[r.id]}upload(r){for(const h in this.buckets){const p=this.buckets[h];p.uploadPending()&&p.upload(r)}const l=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new py(r,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new py(r,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new py(r,this.lineAtlas.image,l.ALPHA),this.lineAtlas.uploaded=!0)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,l,h,p,x,w,A,P){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:p,pixelPosMatrix:A,transform:w,params:x,tileTransform:this.tileTransform},r,l,h):{}}querySourceFeatures(r,l){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const p=h.loadVTLayers(),x=l?l.sourceLayer:"",w=p._geojsonTileLayer||p[x];if(!w)return;const A=Ph(l&&l.filter),{z:P,x:R,y:$}=this.tileID.canonical,X={z:P,x:R,y:$};for(let re=0;re<w.length;re++){const he=w.feature(re);if(A.needGeometry){const We=Ad(he,!0);if(!A.filter(new G(this.tileID.overscaledZ),We,this.tileID.canonical))continue}else if(!A.filter(new G(this.tileID.overscaledZ),he))continue;const ye=h.getId(he,x),Se=new V4(he,P,R,$,ye);Se.tile=X,r.push(Se)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const l=this.expirationTime;if(r.cacheControl){const h=ir(r.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const h=Date.now();let p=!1;if(this.expirationTime>h)p=!1;else if(l)if(this.expirationTime<l)p=!0;else{const x=this.expirationTime-l;x?this.expirationTime=h+Math.max(x,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(r,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(r).length===0||!l)return;const h=this.latestFeatureIndex.loadVTLayers(),p=l.style.listImages();for(const x in this.buckets){if(!l.style.hasLayer(x))continue;const w=this.buckets[x],A=w.layers[0].sourceLayer||"_geojsonTileLayer",P=h[A],R=r[A];if(!P||!R||Object.keys(R).length===0)continue;if(w.update(R,P,p,this.imageAtlas&&this.imageAtlas.patternPositions||{}),w instanceof G_||w instanceof E){const X=l.style._getSourceCache(w.layers[0].source);l._terrain&&l._terrain.enabled&&X&&w.programConfigurations.needsUpload&&l._terrain._clearRenderCacheForTile(X.id,this.tileID)}const $=l&&l.style&&l.style.getLayer(x);$&&(this.queryPadding=Math.max(this.queryPadding,$.queryRadius(w)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ko.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=Ko.now()+r}setTexture(r,l){const h=l.context,p=h.gl;this.texture=this.texture||l.getTileTexture(r.width),this.texture?this.texture.update(r,{useMipmap:!0}):(this.texture=new py(h,r,p.RGBA,{useMipmap:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE))}setDependencies(r,l){const h={};for(const p of l)h[p]=!0;this.dependencies[r]=h}hasDependency(r,l){for(const h of r){const p=this.dependencies[h];if(p){for(const x of l)if(p[x])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,l){if(!l||l.name==="mercator"||this._tileDebugBuffer)return;const h=wu(G4,this.tileID.canonical,this.tileTransform)[0],p=new mn,x=new cc;for(let w=0;w<h.length;w++){const{x:A,y:P}=h[w];p.emplaceBack(A,P),x.emplaceBack(w)}x.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(x),this._tileDebugBuffer=r.createVertexBuffer(p,Rr.members),this._tileDebugSegments=Ra.simpleSegment(0,0,p.length,x.length)}_makeTileBoundsBuffers(r,l){if(this._tileBoundsBuffer||!l||l.name==="mercator")return;const h=wu(G4,this.tileID.canonical,this.tileTransform)[0];let p,x;if(this.isRaster){const w=(function(A,P){const R=Nm(A,P),$=Math.pow(2,A.z);for(let We=0;We<xf;We++)for(let at=0;at<xf;at++){const xt=mc((A.x+(at+q4(at))/Id)/$),lt=Oo((A.y+(We+q4(We))/Id)/$),_t=P.project(xt,lt),It=We*xf+at;bf[2*It+0]=Math.round((_t.x*R.scale-R.x)*Jr),bf[2*It+1]=Math.round((_t.y*R.scale-R.y)*Jr)}qp.fill(0),s1.fill(0);for(let We=2045;We>=0;We--){const at=4*We,xt=Vp[at+0],lt=Vp[at+1],_t=Vp[at+2],It=Vp[at+3],Tt=xt+_t>>1,sn=lt+It>>1,nn=Tt+sn-lt,Sn=sn+xt-Tt,Vn=lt*xf+xt,un=It*xf+_t,kn=sn*xf+Tt,Rn=Math.hypot((bf[2*Vn+0]+bf[2*un+0])/2-bf[2*kn+0],(bf[2*Vn+1]+bf[2*un+1])/2-bf[2*kn+1])>=16;qp[kn]=qp[kn]||(Rn?1:0),We<1022&&(qp[kn]=qp[kn]||qp[(lt+Sn>>1)*xf+(xt+nn>>1)]||qp[(It+Sn>>1)*xf+(_t+nn>>1)])}const X=new an,re=new Sr;let he=0;function ye(We,at){const xt=at*xf+We;return s1[xt]===0&&(X.emplaceBack(bf[2*xt+0],bf[2*xt+1],We*Jr/Id,at*Jr/Id),s1[xt]=++he),s1[xt]-1}function Se(We,at,xt,lt,_t,It){const Tt=We+xt>>1,sn=at+lt>>1;if(Math.abs(We-_t)+Math.abs(at-It)>1&&qp[sn*xf+Tt])Se(_t,It,We,at,Tt,sn),Se(xt,lt,_t,It,Tt,sn);else{const nn=ye(We,at),Sn=ye(xt,lt),Vn=ye(_t,It);re.emplaceBack(nn,Sn,Vn)}}return Se(0,0,Id,Id,Id,0),Se(Id,Id,0,0,0,Id),{vertices:X,indices:re}})(this.tileID.canonical,l);p=w.vertices,x=w.indices}else{p=new an,x=new Sr;for(const{x:A,y:P}of h)p.emplaceBack(A,P,0,0);const w=Pg(p.int16,void 0,4);for(let A=0;A<w.length;A+=3)x.emplaceBack(w[A],w[A+1],w[A+2])}this._tileBoundsBuffer=r.createVertexBuffer(p,$4.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(x),this._tileBoundsSegments=Ra.simpleSegment(0,0,p.length,x.length)}_makeGlobeTileDebugBuffers(r,l){const h=l.projection;if(!h||h.name!=="globe"||l.freezeTileCoverage)return;const p=this.tileID.canonical,x=fc(Qn(p,l)),w=ci(l.zoom);let A;w>0&&(A=au(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(r,p,l,x,A,w),this._makeGlobeTileDebugTextBuffer(r,p,l,x,A,w)}_globePoint(r,l,h,p,x,w,A){let P=Mc(r,l,h);if(w){const R=1<<h.z,$=Ts(p.center.lng),X=fa(p.center.lat),re=(h.x+.5)/R-$;let he=0;re>.5?he=-1:re<-.5&&(he=1);let ye=(r/Jr+h.x)/R+he,Se=(l/Jr+h.y)/R;ye=(ye-$)*p._pixelsPerMercatorPixel+$,Se=(Se-X)*p._pixelsPerMercatorPixel+X;const We=[ye*p.worldSize,Se*p.worldSize,0];kt(We,We,w),P=fo(P,We,A)}return kt(P,P,x)}_makeGlobeTileDebugBorderBuffer(r,l,h,p,x,w){const A=new mn,P=new cc,R=new Ut,$=(re,he,ye,Se,We)=>{const at=(ye-re)/(We-1),xt=(Se-he)/(We-1),lt=A.length;for(let _t=0;_t<We;_t++){const It=re+_t*at,Tt=he+_t*xt;A.emplaceBack(It,Tt);const sn=this._globePoint(It,Tt,l,h,p,x,w);R.emplaceBack(sn[0],sn[1],sn[2]),P.emplaceBack(lt+_t)}},X=Jr;$(0,0,X,0,16),$(X,0,X,X,16),$(X,X,0,X,16),$(0,X,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(P),this._tileDebugBuffer=r.createVertexBuffer(A,Rr.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(R,vr.members),this._tileDebugSegments=Ra.simpleSegment(0,0,A.length,P.length)}_makeGlobeTileDebugTextBuffer(r,l,h,p,x,w){const A=Jr/4,P=new mn,R=new Sr,$=new Ut,X=25;R.reserve(32),P.reserve(X),$.reserve(X);const re=(he,ye)=>X*he+ye;for(let he=0;he<X;he++){const ye=he*A;for(let Se=0;Se<X;Se++){const We=Se*A;P.emplaceBack(We,ye);const at=this._globePoint(We,ye,l,h,p,x,w);$.emplaceBack(at[0],at[1],at[2])}}for(let he=0;he<4;he++)for(let ye=0;ye<4;ye++){const Se=re(he,ye),We=re(he,ye+1),at=re(he+1,ye),xt=re(he+1,ye+1);R.emplaceBack(Se,We,at),R.emplaceBack(at,We,xt)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(R),this._tileDebugTextBuffer=r.createVertexBuffer(P,Rr.members),this._globeTileDebugTextBuffer=r.createVertexBuffer($,vr.members),this._tileDebugTextSegments=Ra.simpleSegment(0,0,X,32)}}class VL{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,l,h){const p=String(l);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][p]=this.stateChanges[r][p]||{},Be(this.stateChanges[r][p],h),this.deletedStates[r]===null){this.deletedStates[r]={};for(const x in this.state[r])x!==p&&(this.deletedStates[r][x]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][p]===null){this.deletedStates[r][p]={};for(const x in this.state[r][p])h[x]||(this.deletedStates[r][p][x]=null)}else for(const x in h)this.deletedStates[r]&&this.deletedStates[r][p]&&this.deletedStates[r][p][x]===null&&delete this.deletedStates[r][p][x]}removeFeatureState(r,l,h){if(this.deletedStates[r]===null)return;const p=String(l);if(this.deletedStates[r]=this.deletedStates[r]||{},h&&l!==void 0)this.deletedStates[r][p]!==null&&(this.deletedStates[r][p]=this.deletedStates[r][p]||{},this.deletedStates[r][p][h]=null);else if(l!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][p])for(h in this.deletedStates[r][p]={},this.stateChanges[r][p])this.deletedStates[r][p][h]=null;else this.deletedStates[r][p]=null;else this.deletedStates[r]=null}getState(r,l){const h=String(l),p=Be({},(this.state[r]||{})[h],(this.stateChanges[r]||{})[h]);if(this.deletedStates[r]===null)return{};if(this.deletedStates[r]){const x=this.deletedStates[r][l];if(x===null)return{};for(const w in x)delete p[w]}return p}initializeTileState(r,l){r.setFeatureState(this.state,l)}coalesceChanges(r,l){const h={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const x={};for(const w in this.stateChanges[p])this.state[p][w]||(this.state[p][w]={}),Be(this.state[p][w],this.stateChanges[p][w]),x[w]=this.state[p][w];h[p]=x}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const x={};if(this.deletedStates[p]===null)for(const w in this.state[p])x[w]={},this.state[p][w]={};else for(const w in this.deletedStates[p]){if(this.deletedStates[p][w]===null)this.state[p][w]={};else if(this.state[p][w])for(const A of Object.keys(this.deletedStates[p][w]))delete this.state[p][w][A];x[w]=this.state[p][w]}h[p]=h[p]||{},Be(h[p],x)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(const p in r)r[p].setFeatureState(h,l)}}class H4{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,l){const h=this.toIdx(r,l);return{min:this.minimums[h],max:this.maximums[h]}}isLeaf(r,l){return this.leaves[this.toIdx(r,l)]}toIdx(r,l){return l*this.size+r}}function W4(s,r,l,h){let p=0,x=Number.MAX_VALUE;for(let w=0;w<3;w++)if(Math.abs(h[w])<1e-15){if(l[w]<s[w]||l[w]>r[w])return null}else{const A=1/h[w];let P=(s[w]-l[w])*A,R=(r[w]-l[w])*A;if(P>R){const $=P;P=R,R=$}if(P>p&&(p=P),R<x&&(x=R),p>x)return null}return p}function K4(s,r,l,h,p,x,w,A,P,R,$){const X=h-s,re=p-r,he=x-l,ye=w-s,Se=A-r,We=P-l,at=$[1]*We-$[2]*Se,xt=$[2]*ye-$[0]*We,lt=$[0]*Se-$[1]*ye,_t=X*at+re*xt+he*lt;if(Math.abs(_t)<1e-15)return null;const It=1/_t,Tt=R[0]-s,sn=R[1]-r,nn=R[2]-l,Sn=(Tt*at+sn*xt+nn*lt)*It;if(Sn<0||Sn>1)return null;const Vn=sn*he-nn*re,un=nn*X-Tt*he,kn=Tt*re-sn*X,Rn=($[0]*Vn+$[1]*un+$[2]*kn)*It;return Rn<0||Sn+Rn>1?null:(ye*Vn+Se*un+We*kn)*It}function X4(s,r,l){return(s-r)/(l-r)}function Z4(s,r,l,h,p,x,w,A,P){const R=1<<l,$=x-h,X=w-p,re=(s+1)/R*$+h,he=(r+0)/R*X+p,ye=(r+1)/R*X+p;A[0]=(s+0)/R*$+h,A[1]=he,P[0]=re,P[1]=ye}class Y4{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=(function(x){const w=Math.ceil(Math.log2(x.dim/8)),A=[];let P=Math.ceil(Math.pow(2,w));const R=1/P,$=(he,ye,Se,We,at)=>{const xt=We?1:0,lt=(he+1)*Se-xt,_t=ye*Se,It=(ye+1)*Se-xt;at[0]=he*Se,at[1]=_t,at[2]=lt,at[3]=It};let X=new H4(P);const re=[];for(let he=0;he<P*P;he++){$(he%P,Math.floor(he/P),R,!1,re);const ye=$p(re[0],re[1],x),Se=$p(re[2],re[1],x),We=$p(re[2],re[3],x),at=$p(re[0],re[3],x);X.minimums.push(Math.min(ye,Se,We,at)),X.maximums.push(Math.max(ye,Se,We,at)),X.leaves.push(1)}for(A.push(X),P/=2;P>=1;P/=2){const he=A[A.length-1];X=new H4(P);for(let ye=0;ye<P*P;ye++){$(ye%P,Math.floor(ye/P),2,!0,re);const Se=he.getElevation(re[0],re[1]),We=he.getElevation(re[2],re[1]),at=he.getElevation(re[2],re[3]),xt=he.getElevation(re[0],re[3]),lt=he.isLeaf(re[0],re[1]),_t=he.isLeaf(re[2],re[1]),It=he.isLeaf(re[2],re[3]),Tt=he.isLeaf(re[0],re[3]),sn=Math.min(Se.min,We.min,at.min,xt.min),nn=Math.max(Se.max,We.max,at.max,xt.max),Sn=lt&&_t&&It&&Tt;X.maximums.push(nn),X.minimums.push(sn),X.leaves.push(nn-sn<=5&&Sn?1:0)}A.push(X)}return A})(this.dem),h=l.length-1,p=l[h];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(l,0,0,h,0)}raycastRoot(r,l,h,p,x,w,A=1){return W4([r,l,-100],[h,p,this.maximums[0]*A],x,w)}raycast(r,l,h,p,x,w,A=1){if(!this.nodeCount)return null;const P=this.raycastRoot(r,l,h,p,x,w,A);if(P==null)return null;const R=[],$=[],X=[],re=[],he=[{idx:0,t:P,nodex:0,nodey:0,depth:0}];for(;he.length>0;){const{idx:ye,t:Se,nodex:We,nodey:at,depth:xt}=he.pop();if(this.leaves[ye]){Z4(We,at,xt,r,l,h,p,X,re);const _t=1<<xt,It=(We+0)/_t,Tt=(We+1)/_t,sn=(at+0)/_t,nn=(at+1)/_t,Sn=$p(It,sn,this.dem)*A,Vn=$p(Tt,sn,this.dem)*A,un=$p(Tt,nn,this.dem)*A,kn=$p(It,nn,this.dem)*A,Rn=K4(X[0],X[1],Sn,re[0],X[1],Vn,re[0],re[1],un,x,w),zn=K4(re[0],re[1],un,X[0],re[1],kn,X[0],X[1],Sn,x,w),Kn=Math.min(Rn!==null?Rn:Number.MAX_VALUE,zn!==null?zn:Number.MAX_VALUE);if(Kn!==Number.MAX_VALUE)return Kn;{const wn=tt([],x,w,Se);if(J4(Sn,Vn,kn,un,X4(wn[0],X[0],re[0]),X4(wn[1],X[1],re[1]))>=wn[2])return Se}continue}let lt=0;for(let _t=0;_t<this._siblingOffset.length;_t++){Z4((We<<1)+this._siblingOffset[_t][0],(at<<1)+this._siblingOffset[_t][1],xt+1,r,l,h,p,X,re),X[2]=-100,re[2]=this.maximums[this.childOffsets[ye]+_t]*A;const It=W4(X,re,x,w);if(It!=null){const Tt=It;R[_t]=Tt;let sn=!1;for(let nn=0;nn<lt&&!sn;nn++)Tt>=R[$[nn]]&&($.splice(nn,0,_t),sn=!0);sn||($[lt]=_t),lt++}}for(let _t=0;_t<lt;_t++){const It=$[_t];he.push({idx:this.childOffsets[ye]+It,t:R[It],nodex:(We<<1)+this._siblingOffset[It][0],nodey:(at<<1)+this._siblingOffset[It][1],depth:xt+1})}}return null}_addNode(r,l,h){return this.minimums.push(r),this.maximums.push(l),this.leaves.push(h),this.childOffsets.push(0),this.nodeCount++}_construct(r,l,h,p,x){if(r[p].isLeaf(l,h)===1)return;this.childOffsets[x]||(this.childOffsets[x]=this.nodeCount);const w=p-1,A=r[w];let P=0,R=0;for(let $=0;$<this._siblingOffset.length;$++){const X=2*l+this._siblingOffset[$][0],re=2*h+this._siblingOffset[$][1],he=A.getElevation(X,re),ye=A.isLeaf(X,re),Se=this._addNode(he.min,he.max,ye);ye&&(P|=1<<$),R||(R=Se)}for(let $=0;$<this._siblingOffset.length;$++)P&1<<$||this._construct(r,2*l+this._siblingOffset[$][0],2*h+this._siblingOffset[$][1],w,R+$)}}function J4(s,r,l,h,p,x){return Ge(Ge(s,l,x),Ge(r,h,x),p)}function $p(s,r,l){const h=l.dim,p=Fe(s*h-.5,0,h-1),x=Fe(r*h-.5,0,h-1),w=Math.floor(p),A=Math.floor(x),P=Math.min(w+1,h-1),R=Math.min(A+1,h-1);return J4(l.get(w,A),l.get(P,A),l.get(w,R),l.get(P,R),p-w,x-A)}const Q4={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function qL(s,r,l){return(256*s*256+256*r+l)/10-1e4}function $L(s,r,l){return 256*s+r+l/256-32768}class a1{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,l,h,p=!1,x=!1){if(this.uid=r,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(h&&h!=="mapbox"&&h!=="terrarium")return mr(`"${h}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const w=this.dim=l.height-2,A=new Uint32Array(l.data.buffer);if(this.pixels=new Uint8Array(l.data.buffer),this.encoding=h||"mapbox",this.borderReady=p,!p){for(let P=0;P<w;P++)A[this._idx(-1,P)]=A[this._idx(0,P)],A[this._idx(w,P)]=A[this._idx(w-1,P)],A[this._idx(P,-1)]=A[this._idx(P,0)],A[this._idx(P,w)]=A[this._idx(P,w-1)];A[this._idx(-1,-1)]=A[this._idx(0,0)],A[this._idx(w,-1)]=A[this._idx(w-1,0)],A[this._idx(-1,w)]=A[this._idx(0,w-1)],A[this._idx(w,w)]=A[this._idx(w-1,w-1)],x&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Y4(this)}get(r,l,h=!1){h&&(r=Fe(r,-1,this.dim),l=Fe(l,-1,this.dim));const p=4*this._idx(r,l);return(this.encoding==="terrarium"?$L:qL)(this.pixels[p],this.pixels[p+1],this.pixels[p+2])}static getUnpackVector(r){return Q4[r]}get unpackVector(){return Q4[this.encoding]}_idx(r,l){if(r<-1||r>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(r+1)}static pack(r,l){const h=[0,0,0,0],p=a1.getUnpackVector(l);let x=Math.floor((r+p[3])/p[2]);return h[2]=x%256,x=Math.floor(x/256),h[1]=x%256,x=Math.floor(x/256),h[0]=x,h}getPixels(){return new Gu({width:this.stride,height:this.stride},this.pixels)}backfillBorder(r,l,h){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let p=l*this.dim,x=l*this.dim+this.dim,w=h*this.dim,A=h*this.dim+this.dim;switch(l){case-1:p=x-1;break;case 1:x=p+1}switch(h){case-1:w=A-1;break;case 1:A=w+1}const P=-l*this.dim,R=-h*this.dim;for(let $=w;$<A;$++)for(let X=p;X<x;X++){const re=4*this._idx(X,$),he=4*this._idx(X+P,$+R);this.pixels[re+0]=r.pixels[he+0],this.pixels[re+1]=r.pixels[he+1],this.pixels[re+2]=r.pixels[he+2],this.pixels[re+3]=r.pixels[he+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}hr(a1,"DEMData"),hr(Y4,"DemMinMaxQuadTree",{omit:["dem"]});class GL{constructor(r,l){this.max=r,this.onRemove=l,this.reset()}reset(){for(const r in this.data)for(const l of this.data[r])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(r,l,h){const p=r.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const x={value:l,timeout:void 0};if(h!==void 0&&(x.timeout=setTimeout((()=>{this.remove(r,x)}),h)),this.data[p].push(x),this.order.push(p),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const l=this.data[r].shift();return l.timeout&&clearTimeout(l.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),l.value}getByKey(r){const l=this.data[r];return l?l[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,l){if(!this.has(r))return this;const h=r.wrapped().key,p=l===void 0?0:this.data[h].indexOf(l),x=this.data[h][p];return this.data[h].splice(p,1),x.timeout&&clearTimeout(x.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(x.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(r){const l=[];for(const h in this.data)for(const p of this.data[h])r(p.value)||l.push(p);for(const h of l)this.remove(h.value.tileID,h)}}class Vg{constructor(r,l,h){this.func=r,this.mask=l,this.range=h}}Vg.ReadOnly=!1,Vg.ReadWrite=!0,Vg.disabled=new Vg(519,Vg.ReadOnly,[0,1]);const Hx=7680;class Wx{constructor(r,l,h,p,x,w){this.test=r,this.ref=l,this.mask=h,this.fail=p,this.depthFail=x,this.pass=w}}Wx.disabled=new Wx({func:519,mask:0},0,0,Hx,Hx,Hx);class wf{constructor(r,l,h){this.blendFunction=r,this.blendColor=l,this.mask=h}}wf.Replace=[1,0],wf.disabled=new wf(wf.Replace,Ao.transparent,[!1,!1,!1,!1]),wf.unblended=new wf(wf.Replace,Ao.transparent,[!0,!0,!0,!0]),wf.alphaBlended=new wf([1,771],Ao.transparent,[!0,!0,!0,!0]);const Kx=1029,Xx=2305;class Gd{constructor(r,l,h){this.enable=r,this.mode=l,this.frontFace=h}}Gd.disabled=new Gd(!1,Kx,Xx),Gd.backCCW=new Gd(!0,Kx,Xx),Gd.backCW=new Gd(!0,Kx,2304),Gd.frontCW=new Gd(!0,1028,2304),Gd.frontCCW=new Gd(!0,1028,Xx);class Dm extends sa{constructor(r,l,h){super(),this.id=r,this._onlySymbols=h,l.on("data",(p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))})),l.on("error",(()=>{this._sourceErrored=!0})),this._source=l,this._tiles={},this._cache=new GL(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new VL,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(r){this.map=r,this._minTileCacheSize=this._minTileCacheSize===void 0&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles){const l=this._tiles[r];if(l.state!=="loaded"&&l.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,l){return r.isSymbolTile=this._onlySymbols,this._source.loadTile(r,l)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,(()=>{}))}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r,(()=>{}))}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const h=this._tiles[l];h.upload(r),h.prepare(this.map.style.imageManager)}}getIds(){return De(this._tiles).map((r=>r.tileID)).sort(e2).map((r=>r.key))}getRenderableIds(r){const l=[];for(const h in this._tiles)this._isIdRenderable(+h,r)&&l.push(this._tiles[h]);return r?l.sort(((h,p)=>{const x=h.tileID,w=p.tileID,A=new q(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),P=new q(w.canonical.x,w.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-w.overscaledZ||P.y-A.y||P.x-A.x})).map((h=>h.tileID.key)):l.map((h=>h.tileID)).sort(e2).map((h=>h.key))}hasRenderableParent(r){const l=this.findLoadedParent(r,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(r,l){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(l||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(+r,"reloading")}}_reloadTile(r,l){const h=this._tiles[r];h&&(h.state!=="loading"&&(h.state=l),this._loadTile(h,this._tileLoaded.bind(this,h,r,l)))}_tileLoaded(r,l,h,p){if(p)if(r.state="errored",p.status!==404)this._source.fire(new Aa(p,{tile:r}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const x=this.map.painter.terrain;this.update(this.transform,x.getScaledDemTileSize(),!0),x.resetTileLookupCache(this.id)}else this.update(this.transform);else r.timeAdded=Ko.now(),h==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(l,r),this._source.type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new Ql("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const l=this.getRenderableIds();for(let p=0;p<l.length;p++){const x=l[p];if(r.neighboringTiles&&r.neighboringTiles[x]){const w=this.getTileByID(x);h(r,w),h(w,r)}}function h(p,x){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let w=x.tileID.canonical.x-p.tileID.canonical.x;const A=x.tileID.canonical.y-p.tileID.canonical.y,P=Math.pow(2,p.tileID.canonical.z),R=x.tileID.key;w===0&&A===0||Math.abs(A)>1||(Math.abs(w)>1&&(Math.abs(w+P)===1?w+=P:Math.abs(w-P)===1&&(w-=P)),x.dem&&p.dem&&(p.dem.backfillBorder(x.dem,w,A),p.neighboringTiles&&p.neighboringTiles[R]&&(p.neighboringTiles[R].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,l,h,p){for(const x in this._tiles){let w=this._tiles[x];if(p[x]||!w.hasData()||w.tileID.overscaledZ<=l||w.tileID.overscaledZ>h)continue;let A=w.tileID;for(;w&&w.tileID.overscaledZ>l+1;){const R=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[R.key],w&&w.hasData()&&(A=R)}let P=A;for(;P.overscaledZ>l;)if(P=P.scaledTo(P.overscaledZ-1),r[P.key]){p[A.key]=A;break}}}findLoadedParent(r,l){if(r.key in this._loadedParentTiles){const h=this._loadedParentTiles[r.key];return h&&h.tileID.overscaledZ>=l?h:null}for(let h=r.overscaledZ-1;h>=l;h--){const p=r.scaledTo(h),x=this._getLoadedTile(p);if(x)return x}}_getLoadedTile(r){const l=this._tiles[r.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,l){l=l||this._source.tileSize;const h=Math.ceil(r.width/l)+1,p=Math.ceil(r.height/l)+1,x=Math.floor(h*p*5),w=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,x):x,A=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(A)}handleWrapJump(r){const l=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,l){const h={};for(const p in this._tiles){const x=this._tiles[p];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+l),h[x.tileID.key]=x}this._tiles=h;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(r,l,h){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!h)return;let p;this.updateCacheSize(r,l),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=r.getVisibleUnwrappedCoordinates(this._source.tileID).map((A=>new ph(A.canonical.z,A.wrap,A.canonical.z,A.canonical.x,A.canonical.y))):(p=r.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(p=p.filter((A=>this._source.hasTile(A))))):p=[];const x=this._updateRetainedTiles(p);if(t2(this._source.type)&&p.length!==0){const A={},P={},R=Object.keys(x);for(const X of R){const re=x[X],he=this._tiles[X];if(!he||he.fadeEndTime&&he.fadeEndTime<=Ko.now())continue;const ye=this.findLoadedParent(re,Math.max(re.overscaledZ-Dm.maxOverzooming,this._source.minzoom));ye&&(this._addTile(ye.tileID),A[ye.tileID.key]=ye.tileID),P[X]=re}const $=p[p.length-1].overscaledZ;for(const X in this._tiles){const re=this._tiles[X];if(x[X]||!re.hasData())continue;let he=re.tileID;for(;he.overscaledZ>$;){he=he.scaledTo(he.overscaledZ-1);const ye=this._tiles[he.key];if(ye&&ye.hasData()&&P[he.key]){x[X]=re.tileID;break}}}for(const X in A)x[X]||(this._coveredTiles[X]=!0,x[X]=A[X])}for(const A in x)this._tiles[A].clearFadeHold();const w=(function(A,P){const R=[];for(const $ in A)$ in P||R.push($);return R})(this._tiles,x);for(const A of w){const P=this._tiles[A];P.hasSymbolBuckets&&!P.holdingForFade()?P.setHoldDuration(this.map._fadeDuration):P.hasSymbolBuckets&&!P.symbolFadeFinished()||this._removeTile(+A)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const l={};if(r.length===0)return l;const h={},p=r.reduce(((R,$)=>Math.min(R,$.overscaledZ)),1/0),x=r[0].overscaledZ,w=Math.max(x-Dm.maxOverzooming,this._source.minzoom),A=Math.max(x+Dm.maxUnderzooming,this._source.minzoom),P={};for(const R of r){const $=this._addTile(R);l[R.key]=R,$.hasData()||p<this._source.maxzoom&&(P[R.key]=R)}this._retainLoadedChildren(P,p,A,l);for(const R of r){let $=this._tiles[R.key];if($.hasData())continue;if(R.canonical.z>=this._source.maxzoom){const re=R.children(this._source.maxzoom)[0],he=this.getTile(re);if(he&&he.hasData()){l[re.key]=re;continue}}else{const re=R.children(this._source.maxzoom);if(l[re[0].key]&&l[re[1].key]&&l[re[2].key]&&l[re[3].key])continue}let X=$.wasRequested();for(let re=R.overscaledZ-1;re>=w;--re){const he=R.scaledTo(re);if(h[he.key]||(h[he.key]=!0,$=this.getTile(he),!$&&X&&($=this._addTile(he)),$&&(l[he.key]=he,X=$.wasRequested(),$.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const l=[];let h,p=this._tiles[r].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){h=this._loadedParentTiles[p.key];break}l.push(p.key);const x=p.scaledTo(p.overscaledZ-1);if(h=this._getLoadedTile(x),h)break;p=x}for(const x of l)this._loadedParentTiles[x]=h}}_addTile(r){let l=this._tiles[r.key];if(l)return l;l=this._cache.getAndRemove(r),l&&(this._setTileReloadTimer(r.key,l),l.tileID=r,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,l)));const h=!!l;if(!h){const p=this.map?this.map.painter:null;l=new Gx(r,this._source.tileSize*r.overscaleFactor(),this.transform.tileZoom,p,this._isRaster),this._loadTile(l,this._tileLoaded.bind(this,l,r.key,l.state))}return l?(l.uses++,this._tiles[r.key]=l,h||this._source.fire(new Ql("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(r,l){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const h=l.getExpiryTimeout();h&&(this._timers[r]=setTimeout((()=>{this._reloadTile(r,"expired"),delete this._timers[r]}),h))}_removeTile(r){const l=this._tiles[r];l&&(l.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),l.uses>0||(l.hasData()&&l.state!=="reloading"?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,l,h){const p=[],x=this.transform;if(!x)return p;const w=x.projection.name==="globe",A=Ts(x.center.lng);for(const P in this._tiles){const R=this._tiles[P];if(h&&R.clearQueryDebugViz(),R.holdingForFade())continue;let $;if(w){const X=R.tileID.canonical;if(X.z===0){const re=[Math.abs(Fe(A,...my(X,-1))-A),Math.abs(Fe(A,...my(X,1))-A)];$=[0,2*re.indexOf(Math.min(...re))-1]}else{const re=[Math.abs(Fe(A,...my(X,-1))-A),Math.abs(Fe(A,...my(X,0))-A),Math.abs(Fe(A,...my(X,1))-A)];$=[re.indexOf(Math.min(...re))-1]}}else $=[0];for(const X of $){const re=r.containsTile(R,x,l,X);re&&p.push(re)}}return p}getVisibleCoordinates(r){const l=this.getRenderableIds(r).map((h=>this._tiles[h].tileID));for(const h of l)h.projMatrix=this.transform.calculateProjMatrix(h.toUnwrapped());return l}hasTransition(){if(this._source.hasTransition())return!0;if(t2(this._source.type))for(const r in this._tiles){const l=this._tiles[r];if(l.fadeEndTime!==void 0&&l.fadeEndTime>=Ko.now())return!0}return!1}setFeatureState(r,l,h){this._state.updateState(r=r||"_geojsonTileLayer",l,h)}removeFeatureState(r,l,h){this._state.removeFeatureState(r=r||"_geojsonTileLayer",l,h)}getFeatureState(r,l){return this._state.getState(r=r||"_geojsonTileLayer",l)}setDependencies(r,l,h){const p=this._tiles[r];p&&p.setDependencies(l,h)}reloadTilesForDependencies(r,l){for(const h in this._tiles)this._tiles[h].hasDependency(r,l)&&this._reloadTile(+h,"reloading");this._cache.filter((h=>!h.hasDependency(r,l)))}_preloadTiles(r,l){if(!this._sourceLoaded){const A=()=>{this._sourceLoaded&&(this._source.off("data",A),this._preloadTiles(r,l))};return void this._source.on("data",A)}const h=new Map,p=Array.isArray(r)?r:[r],x=this.map.painter.terrain,w=this.usedForTerrain&&x?x.getScaledDemTileSize():this._source.tileSize;for(const A of p){const P=A.coveringTiles({tileSize:w,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const R of P)h.set(R.key,R);this.usedForTerrain&&A.updateElevation(!1)}le(Array.from(h.values()),((A,P)=>{const R=new Gx(A,this._source.tileSize*A.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(R,($=>{this._source.type==="raster-dem"&&R.dem&&this._backfillDEM(R),P($,R)}))}),l)}}function e2(s,r){const l=Math.abs(2*s.wrap)-+(s.wrap<0),h=Math.abs(2*r.wrap)-+(r.wrap<0);return s.overscaledZ-r.overscaledZ||h-l||r.canonical.y-s.canonical.y||r.canonical.x-s.canonical.x}function t2(s){return s==="raster"||s==="image"||s==="video"||s==="custom"}function my(s,r){const l=1<<s.z;return[s.x/l+r,(s.x+1)/l+r]}Dm.maxOverzooming=10,Dm.maxUnderzooming=3;class l1{constructor(r,l,h){this._demTile=r,this._dem=this._demTile.dem,this._scale=l,this._offset=h}static create(r,l,h){const p=h||r.findDEMTileFor(l);if(!p||!p.dem)return;const x=p.dem,w=p.tileID,A=1<<l.canonical.z-w.canonical.z;return new l1(p,p.tileSize/Jr/A,[(l.canonical.x/A-w.canonical.x)*x.dim,(l.canonical.y/A-w.canonical.y)*x.dim])}tileCoordToPixel(r,l){const h=l*this._scale+this._offset[1],p=Math.floor(r*this._scale+this._offset[0]),x=Math.floor(h);return new q(p,x)}getElevationAt(r,l,h,p){const x=r*this._scale+this._offset[0],w=l*this._scale+this._offset[1],A=Math.floor(x),P=Math.floor(w),R=this._dem;return p=!!p,h?Ge(Ge(R.get(A,P,p),R.get(A,P+1,p),w-P),Ge(R.get(A+1,P,p),R.get(A+1,P+1,p),w-P),x-A):R.get(A,P,p)}getElevationAtPixel(r,l,h){return this._dem.get(r,l,!!h)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*ea(1,r)*this._dem.stride}}class n2{constructor(r,l){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new Tl(Jr,16,0),this.featureIndexArray=new ls,this.promoteId=l}insert(r,l,h,p,x,w=0){const A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,p,x,w);const P=this.grid;for(let R=0;R<l.length;R++){const $=l[R],X=[1/0,1/0,-1/0,-1/0];for(let re=0;re<$.length;re++){const he=$[re];X[0]=Math.min(X[0],he.x),X[1]=Math.min(X[1],he.y),X[2]=Math.max(X[2],he.x),X[3]=Math.max(X[3],he.y)}X[0]<Jr&&X[1]<Jr&&X[2]>=0&&X[3]>=0&&P.insert(A,X[0],X[1],X[2],X[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new pi(new K_(this.rawTileData)).layers,this.sourceLayerCoder=new U4(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,l,h,p){this.loadVTLayers();const x=r.params||{},w=Ph(x.filter),A=r.tileResult,P=r.transform,R=A.bufferedTilespaceBounds,$=this.grid.query(R.min.x,R.min.y,R.max.x,R.max.y,((ye,Se,We,at)=>B_(A.bufferedTilespaceGeometry,ye,Se,We,at)));$.sort(HL);let X=null;P.elevation&&$.length>0&&(X=l1.create(P.elevation,this.tileID));const re={};let he;for(let ye=0;ye<$.length;ye++){const Se=$[ye];if(Se===he)continue;he=Se;const We=this.featureIndexArray.get(Se);let at=null;this.loadMatchingFeature(re,We,w,x.layers,x.availableImages,l,h,p,((xt,lt,_t,It=0)=>(at||(at=wu(xt,this.tileID.canonical,r.tileTransform)),lt.queryIntersectsFeature(A,xt,_t,at,this.z,r.transform,r.pixelPosMatrix,X,It))))}return re}loadMatchingFeature(r,l,h,p,x,w,A,P,R){const{featureIndex:$,bucketIndex:X,sourceLayerIndex:re,layoutVertexArrayOffset:he}=l,ye=this.bucketLayerIDs[X];if(p&&!(function(xt,lt){for(let _t=0;_t<xt.length;_t++)if(lt.indexOf(xt[_t])>=0)return!0;return!1})(p,ye))return;const Se=this.sourceLayerCoder.decode(re),We=this.vtLayers[Se].feature($);if(h.needGeometry){const xt=Ad(We,!0);if(!h.filter(new G(this.tileID.overscaledZ),xt,this.tileID.canonical))return}else if(!h.filter(new G(this.tileID.overscaledZ),We))return;const at=this.getId(We,Se);for(let xt=0;xt<ye.length;xt++){const lt=ye[xt];if(p&&p.indexOf(lt)<0)continue;const _t=w[lt];if(!_t)continue;let It={};at!==void 0&&P&&(It=P.getState(_t.sourceLayer||"_geojsonTileLayer",at));const Tt=Be({},A[lt]);Tt.paint=r2(Tt.paint,_t.paint,We,It,x),Tt.layout=r2(Tt.layout,_t.layout,We,It,x);const sn=!R||R(We,_t,It,he);if(!sn)continue;const nn=new V4(We,this.z,this.x,this.y,at);nn.layer=Tt;let Sn=r[lt];Sn===void 0&&(Sn=r[lt]=[]),Sn.push({featureIndex:$,feature:nn,intersectionZ:sn})}}lookupSymbolFeatures(r,l,h,p,x,w,A,P){const R={};this.loadVTLayers();const $=Ph(x);for(const X of r)this.loadMatchingFeature(R,{bucketIndex:h,sourceLayerIndex:p,featureIndex:X,layoutVertexArrayOffset:0},$,w,A,P,l);return R}loadFeature(r){const{featureIndex:l,sourceLayerIndex:h}=r;this.loadVTLayers();const p=this.sourceLayerCoder.decode(h),x=this.vtFeatures[p];if(x[l])return x[l];const w=this.vtLayers[p].feature(l);return x[l]=w,w}hasLayer(r){for(const l of this.bucketLayerIDs)for(const h of l)if(r===h)return!0;return!1}getId(r,l){let h=r.id;if(this.promoteId){const p=typeof this.promoteId=="string"?this.promoteId:this.promoteId[l];p!=null&&(h=r.properties[p]),typeof h=="boolean"&&(h=Number(h))}return h}}function r2(s,r,l,h,p){return gn(s,((x,w)=>{const A=r instanceof Ze?r.get(w):null;return A&&A.evaluate?A.evaluate(l,h,p):A}))}function HL(s,r){return r-s}hr(n2,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class i2{constructor(r,l){this.width=r,this.height=l,this.nextRow=0,this.image=new fh({width:r,height:l}),this.positions={},this.uploaded=!1}getDash(r,l){const h=this.getKey(r,l);return this.positions[h]}trim(){const r=this.width,l=this.height=ft(this.nextRow);this.image.resize({width:r,height:l})}getKey(r,l){return r.join(",")+l}getDashRanges(r,l,h){const p=[];let x=r.length%2==1?-r[r.length-1]*h:0,w=r[0]*h,A=!0;p.push({left:x,right:w,isDash:A,zeroLength:r[0]===0});let P=r[0];for(let R=1;R<r.length;R++){A=!A;const $=r[R];x=P*h,P+=$,w=P*h,p.push({left:x,right:w,isDash:A,zeroLength:$===0})}return p}addRoundDash(r,l,h){const p=l/2;for(let x=-h;x<=h;x++){const w=this.width*(this.nextRow+h+x);let A=0,P=r[A];for(let R=0;R<this.width;R++){R/P.right>1&&(P=r[++A]);const $=Math.abs(R-P.left),X=Math.abs(R-P.right),re=Math.min($,X);let he;const ye=x/h*(p+1);if(P.isDash){const Se=p-Math.abs(ye);he=Math.sqrt(re*re+Se*Se)}else he=p-Math.sqrt(re*re+ye*ye);this.image.data[w+R]=Math.max(0,Math.min(255,he+128))}}}addRegularDash(r,l){for(let P=r.length-1;P>=0;--P){const R=r[P],$=r[P+1];R.zeroLength?r.splice(P,1):$&&$.isDash===R.isDash&&($.left=R.left,r.splice(P,1))}const h=r[0],p=r[r.length-1];h.isDash===p.isDash&&(h.left=p.left-this.width,p.right=h.right+this.width);const x=this.width*this.nextRow;let w=0,A=r[w];for(let P=0;P<this.width;P++){P/A.right>1&&(A=r[++w]);const R=Math.abs(P-A.left),$=Math.abs(P-A.right),X=Math.min(R,$);this.image.data[x+P]=Math.max(0,Math.min(255,(A.isDash?X:-X)+l+128))}}addDash(r,l){const h=this.getKey(r,l);if(this.positions[h])return this.positions[h];const p=l==="round",x=p?7:0,w=2*x+1;if(this.nextRow+w>this.height)return mr("LineAtlas out of space"),null;r.length===0&&r.push(1);let A=0;for(let $=0;$<r.length;$++)r[$]<0&&(mr("Negative value is found in line dasharray, replacing values with 0"),r[$]=0),A+=r[$];if(A!==0){const $=this.width/A,X=this.getDashRanges(r,this.width,$);p?this.addRoundDash(X,$,x):this.addRegularDash(X,l==="square"?.5*$:0)}const P=this.nextRow+x;this.nextRow+=w;const R={tl:[P,x],br:[A,0]};return this.positions[h]=R,R}}hr(i2,"LineAtlas");const o2=1*$d;class s2{constructor(r){const l={},h=[];for(const A in r){const P=r[A],R=l[A]={};for(const $ in P.glyphs){const X=P.glyphs[+$];if(!X||X.bitmap.width===0||X.bitmap.height===0)continue;const re=X.metrics.localGlyph?o2:1,he={x:0,y:0,w:X.bitmap.width+2*re,h:X.bitmap.height+2*re};h.push(he),R[$]=he}}const{w:p,h:x}=Mx(h),w=new fh({width:p||1,height:x||1});for(const A in r){const P=r[A];for(const R in P.glyphs){const $=P.glyphs[+R];if(!$||$.bitmap.width===0||$.bitmap.height===0)continue;const X=l[A][R],re=$.metrics.localGlyph?o2:1;fh.copy($.bitmap,w,{x:0,y:0},{x:X.x+re,y:X.y+re},$.bitmap)}}this.image=w,this.positions=l}}hr(s2,"GlyphAtlas");class WL{constructor(r){this.tileID=new ph(r.tileID.overscaledZ,r.tileID.wrap,r.tileID.canonical.z,r.tileID.canonical.x,r.tileID.canonical.y),this.tileZoom=r.tileZoom,this.uid=r.uid,this.zoom=r.zoom,this.canonical=r.tileID.canonical,this.pixelRatio=r.pixelRatio,this.tileSize=r.tileSize,this.source=r.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=r.showCollisionBoxes,this.collectResourceTiming=!!r.collectResourceTiming,this.returnDependencies=!!r.returnDependencies,this.promoteId=r.promoteId,this.enableTerrain=!!r.enableTerrain,this.isSymbolTile=r.isSymbolTile,this.tileTransform=Nm(r.tileID.canonical,r.projection),this.projection=r.projection}parse(r,l,h,p,x){this.status="parsing",this.data=r,this.collisionBoxArray=new eo;const w=new U4(Object.keys(r.layers).sort()),A=new n2(this.tileID,this.promoteId);A.bucketLayerIDs=[];const P={},R=new i2(256,256),$={featureIndex:A,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:R,availableImages:h},X=l.familiesBySource[this.source];for(const It in X){const Tt=r.layers[It];if(!Tt)continue;let sn=!1,nn=!1;for(const un of X[It])un[0].type==="symbol"?sn=!0:nn=!0;if(this.isSymbolTile===!0&&!sn||this.isSymbolTile===!1&&!nn)continue;Tt.version===1&&mr(`Vector tile source "${this.source}" layer "${It}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Sn=w.encode(It),Vn=[];for(let un=0;un<Tt.length;un++){const kn=Tt.feature(un),Rn=A.getId(kn,It);Vn.push({feature:kn,id:Rn,index:un,sourceLayerIndex:Sn})}for(const un of X[It]){const kn=un[0];this.isSymbolTile!==void 0&&kn.type==="symbol"!==this.isSymbolTile||kn.minzoom&&this.zoom<Math.floor(kn.minzoom)||kn.maxzoom&&this.zoom>=kn.maxzoom||kn.visibility!=="none"&&(Zx(un,this.zoom,h),(P[kn.id]=kn.createBucket({index:A.bucketLayerIDs.length,layers:un,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Sn,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:h})).populate(Vn,$,this.tileID.canonical,this.tileTransform),A.bucketLayerIDs.push(un.map((Rn=>Rn.id))))}}let re,he,ye,Se;R.trim();const We={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},at=()=>{if(re)return x(re);if(he&&ye&&Se){const It=new s2(he),Tt=new f4(ye,Se);for(const sn in P){const nn=P[sn];nn instanceof Up?(Zx(nn.layers,this.zoom,h),vL(nn,he,It.positions,ye,Tt.iconPositions,this.showCollisionBoxes,h,this.tileID.canonical,this.tileZoom,this.projection)):nn.hasPattern&&(nn instanceof G_||nn instanceof E||nn instanceof ry)&&(Zx(nn.layers,this.zoom,h),nn.addFeatures($,this.tileID.canonical,Tt.patternPositions,h,this.tileTransform))}this.status="done",x(null,{buckets:De(P).filter((sn=>!sn.isEmpty())),featureIndex:A,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:It.image,lineAtlas:R,imageAtlas:Tt,glyphMap:this.returnDependencies?he:null,iconMap:this.returnDependencies?ye:null,glyphPositions:this.returnDependencies?It.positions:null})}},xt=gn($.glyphDependencies,(It=>Object.keys(It).map(Number)));Object.keys(xt).length?p.send("getGlyphs",{uid:this.uid,stacks:xt},((It,Tt)=>{re||(re=It,he=Tt,at())}),void 0,!1,We):he={};const lt=Object.keys($.iconDependencies);lt.length?p.send("getImages",{icons:lt,source:this.source,tileID:this.tileID,type:"icons"},((It,Tt)=>{re||(re=It,ye=Tt,at())}),void 0,!1,We):ye={};const _t=Object.keys($.patternDependencies);_t.length?p.send("getImages",{icons:_t,source:this.source,tileID:this.tileID,type:"patterns"},((It,Tt)=>{re||(re=It,Se=Tt,at())}),void 0,!1,We):Se={},at()}}function Zx(s,r,l){const h=new G(r);for(const p of s)p.recalculate(h,l)}class a2{constructor(r){this.entries={},this.scheduler=r}request(r,l,h,p){const x=this.entries[r]=this.entries[r]||{callbacks:[]};if(x.result){const[w,A]=x.result;return this.scheduler?this.scheduler.add((()=>{p(w,A)}),l):p(w,A),()=>{}}return x.callbacks.push(p),x.cancel||(x.cancel=h(((w,A)=>{x.result=[w,A];for(const P of x.callbacks)this.scheduler?this.scheduler.add((()=>{P(w,A)}),l):P(w,A);setTimeout((()=>delete this.entries[r]),3e3)}))),()=>{x.result||(x.callbacks=x.callbacks.filter((w=>w!==p)),x.callbacks.length||(x.cancel(),delete this.entries[r]))}}}function l2(s,r,l){const h=JSON.stringify(s.request);return s.data&&(this.deduped.entries[h]={result:[null,s.data]}),this.deduped.request(h,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},(p=>{const x=di(s.request,((w,A,P,R)=>{w?p(w):A&&p(null,{vectorTile:l?void 0:new pi(new K_(A)),rawData:A,cacheControl:P,expires:R})}));return()=>{x.cancel(),p()}}),r)}const c2=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Yx{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,h]=new Uint8Array(r,0,2);if(l!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=h>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const x=c2[15&h];if(!x)throw new Error("Unrecognized array type.");const[w]=new Uint16Array(r,2,1),[A]=new Uint32Array(r,4,1);return new Yx(A,w,x,r)}constructor(r,l=64,h=Float64Array,p){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=h,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const x=c2.indexOf(this.ArrayType),w=2*r*this.ArrayType.BYTES_PER_ELEMENT,A=r*this.IndexArrayType.BYTES_PER_ELEMENT,P=(8-A%8)%8;if(x<0)throw new Error(`Unexpected typed array class: ${h}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+A+P,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+w+A+P),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+A+P,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+x]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=r)}add(r,l){const h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=r,this.coords[this._pos++]=l,h}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return Jx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,l,h,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:x,coords:w,nodeSize:A}=this,P=[0,x.length-1,0],R=[];for(;P.length;){const $=P.pop()||0,X=P.pop()||0,re=P.pop()||0;if(X-re<=A){for(let We=re;We<=X;We++){const at=w[2*We],xt=w[2*We+1];at>=r&&at<=h&&xt>=l&&xt<=p&&R.push(x[We])}continue}const he=re+X>>1,ye=w[2*he],Se=w[2*he+1];ye>=r&&ye<=h&&Se>=l&&Se<=p&&R.push(x[he]),($===0?r<=ye:l<=Se)&&(P.push(re),P.push(he-1),P.push(1-$)),($===0?h>=ye:p>=Se)&&(P.push(he+1),P.push(X),P.push(1-$))}return R}within(r,l,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:x,nodeSize:w}=this,A=[0,p.length-1,0],P=[],R=h*h;for(;A.length;){const $=A.pop()||0,X=A.pop()||0,re=A.pop()||0;if(X-re<=w){for(let We=re;We<=X;We++)h2(x[2*We],x[2*We+1],r,l)<=R&&P.push(p[We]);continue}const he=re+X>>1,ye=x[2*he],Se=x[2*he+1];h2(ye,Se,r,l)<=R&&P.push(p[he]),($===0?r-h<=ye:l-h<=Se)&&(A.push(re),A.push(he-1),A.push(1-$)),($===0?r+h>=ye:l+h>=Se)&&(A.push(he+1),A.push(X),A.push(1-$))}return P}}function Jx(s,r,l,h,p,x){if(p-h<=l)return;const w=h+p>>1;u2(s,r,w,h,p,x),Jx(s,r,l,h,w-1,1-x),Jx(s,r,l,w+1,p,1-x)}function u2(s,r,l,h,p,x){for(;p>h;){if(p-h>600){const R=p-h+1,$=l-h+1,X=Math.log(R),re=.5*Math.exp(2*X/3),he=.5*Math.sqrt(X*re*(R-re)/R)*($-R/2<0?-1:1);u2(s,r,l,Math.max(h,Math.floor(l-$*re/R+he)),Math.min(p,Math.floor(l+(R-$)*re/R+he)),x)}const w=r[2*l+x];let A=h,P=p;for(gy(s,r,h,l),r[2*p+x]>w&&gy(s,r,h,p);A<P;){for(gy(s,r,A,P),A++,P--;r[2*A+x]<w;)A++;for(;r[2*P+x]>w;)P--}r[2*h+x]===w?gy(s,r,h,P):(P++,gy(s,r,P,p)),P<=l&&(h=P+1),l<=P&&(p=P-1)}}function gy(s,r,l,h){Qx(s,l,h),Qx(r,2*l,2*h),Qx(r,2*l+1,2*h+1)}function Qx(s,r,l){const h=s[r];s[r]=s[l],s[l]=h}function h2(s,r,l,h){const p=s-l,x=r-h;return p*p+x*x}o.ARRAY_TYPE=hc,o.AUTH_ERR_MSG=ht,o.Aabb=Wr,o.Actor=class{constructor(s,r,l){this.target=s,this.parent=r,this.mapId=l,this.callbacks={},this.cancelCallbacks={},Yt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ln()?s:b,this.scheduler=new jL}send(s,r,l,h,p=!1,x){const w=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=x,this.callbacks[w]=l);const A=Yr(this.globalScope)?void 0:[];return this.target.postMessage({id:w,type:s,hasCallback:!!l,targetMapId:h,mustQueue:p,sourceMapId:this.mapId,data:B(r,A)},A),{cancel:()=>{l&&delete this.callbacks[w],this.target.postMessage({id:w,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(s){const r=s.data,l=r.id;if(l&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){const h=this.cancelCallbacks[l];delete this.cancelCallbacks[l],h&&h.cancel()}else if(r.mustQueue||Ln()){const h=this.callbacks[l];this.cancelCallbacks[l]=this.scheduler.add((()=>this.processTask(l,r)),h&&h.metadata||{type:"message"})}else this.processTask(l,r)}processTask(s,r){if(r.type==="<response>"){const l=this.callbacks[s];delete this.callbacks[s],l&&(r.error?l(Q(r.error)):l(null,Q(r.data)))}else{const l=Yr(this.globalScope)?void 0:[],h=r.hasCallback?(x,w)=>{delete this.cancelCallbacks[s],this.target.postMessage({id:s,type:"<response>",sourceMapId:this.mapId,error:x?B(x):null,data:B(w,l)},l)}:x=>{},p=Q(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,p,h);else if(this.parent.getWorkerSource){const x=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,x[0],p.source)[x[1]](p,h)}else h(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.CanonicalTileID=$_,o.Color=Ao,o.ColorMode=wf,o.CullFaceMode=Gd,o.DEMData=a1,o.DataConstantProperty=_e,o.DedupedRequest=a2,o.DepthMode=Vg,o.EXTENT=Jr,o.Elevation=class{isDataAvailableAtPoint(s){const r=this._source();if(this.isUsingMockSource()||!r||s.y<0||s.y>1)return!1;const l=r.getSource().maxzoom,h=1<<l,p=Math.floor(s.x),x=Math.floor((s.x-p)*h),w=Math.floor(s.y*h),A=this.findDEMTileFor(new ph(l,p,l,x,w));return!(!A||!A.dem)}getAtPointOrZero(s,r=0){return this.getAtPoint(s,r)||0}getAtPoint(s,r,l=!0){if(this.isUsingMockSource())return null;r==null&&(r=null);const h=this._source();if(!h||s.y<0||s.y>1)return r;const p=h.getSource().maxzoom,x=1<<p,w=Math.floor(s.x),A=s.x-w,P=new ph(p,w,p,Math.floor(A*x),Math.floor(s.y*x)),R=this.findDEMTileFor(P);if(!R||!R.dem)return r;const $=R.dem,X=1<<R.tileID.canonical.z,re=(A*X-R.tileID.canonical.x)*$.dim,he=(s.y*X-R.tileID.canonical.y)*$.dim,ye=Math.floor(re),Se=Math.floor(he);return(l?this.exaggeration():1)*Ge(Ge($.get(ye,Se),$.get(ye,Se+1),he-Se),Ge($.get(ye+1,Se),$.get(ye+1,Se+1),he-Se),re-ye)}getAtTileOffset(s,r,l){const h=1<<s.canonical.z;return this.getAtPointOrZero(new Gh(s.wrap+(s.canonical.x+r/Jr)/h,(s.canonical.y+l/Jr)/h))}getAtTileOffsetFunc(s,r,l,h){return p=>{const x=this.getAtTileOffset(s,p.x,p.y),w=h.upVector(s.canonical,p.x,p.y);return Me(w,w,x*h.upVectorScale(s.canonical,r,l).metersToTile),w}}getForTilePoints(s,r,l,h){if(this.isUsingMockSource())return!1;const p=l1.create(this,s,h);return!!p&&(r.forEach((x=>{x[2]=this.exaggeration()*p.getElevationAt(x[0],x[1],l)})),!0)}getMinMaxForTile(s){if(this.isUsingMockSource())return null;const r=this.findDEMTileFor(s);if(!r||!r.dem)return null;const l=r.dem.tree,h=r.tileID,p=1<<s.canonical.z-h.canonical.z;let x=s.canonical.x/p-h.canonical.x,w=s.canonical.y/p-h.canonical.y,A=0;for(let P=0;P<s.canonical.z-h.canonical.z&&!l.leaves[A];P++){x*=2,w*=2;const R=2*Math.floor(w)+Math.floor(x);A=l.childOffsets[A]+R,x%=1,w%=1}return{min:this.exaggeration()*l.minimums[A],max:this.exaggeration()*l.maximums[A]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,r,l){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},o.ErrorEvent=Aa,o.EvaluationParameters=G,o.Event=Ql,o.Evented=sa,o.FillExtrusionBucket=ry,o.Frustum=jr,o.FrustumCorners=Gr,o.GLOBE_RADIUS=pn,o.GLOBE_SCALE_MATCH_LATITUDE=45,o.GLOBE_ZOOM_THRESHOLD_MAX=Jt,o.GLOBE_ZOOM_THRESHOLD_MIN=Un,o.GlobeSharedBuffers=class{constructor(s){this._createGrid(s),this._createPoles(s)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const s of this._poleSegments)s.destroy();for(const s of this._gridSegments)s.withSkirts.destroy(),s.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const s of this._wireframeSegments)s.destroy()}}_fillGridMeshWithLods(s,r){const l=new mn,h=new Sr,p=[],x=s+1+2,w=r[0]+1,A=r[0]+1+(1+r.length),P=(R,$,X)=>{let re=R===x-1?R-2:R===0?R:R-1;return re+=X?24575:0,[re,$]};for(let R=0;R<x;++R)l.emplaceBack(...P(R,0,!0));for(let R=0;R<w;++R)for(let $=0;$<x;++$)l.emplaceBack(...P($,R,($===0||$===x-1)&&!0));for(let R=0;R<r.length;++R){const $=r[R];for(let X=0;X<x;++X)l.emplaceBack(...P(X,$,!0))}for(let R=0;R<r.length;++R){const $=h.length,X=r[R]+1+2,re=new Sr;for(let Se=0;Se<X-1;Se++){const We=Se===X-2,at=We?x*(A-r.length+R-Se):x;for(let xt=0;xt<x-1;xt++){const lt=Se*x+xt;Se===0||We||xt===0||xt===x-2?(re.emplaceBack(lt+1,lt,lt+at),re.emplaceBack(lt+at,lt+at+1,lt+1)):(h.emplaceBack(lt+1,lt,lt+at),h.emplaceBack(lt+at,lt+at+1,lt+1))}}const he=Ra.simpleSegment(0,$,l.length,h.length-$);for(let Se=0;Se<re.uint16.length;Se+=3)h.emplaceBack(re.uint16[Se],re.uint16[Se+1],re.uint16[Se+2]);const ye=Ra.simpleSegment(0,$,l.length,h.length-$);p.push({withoutSkirts:he,withSkirts:ye})}return{vertices:l,indices:h,segments:p}}_createGrid(s){const r=this._fillGridMeshWithLods(dr,qr);this._gridSegments=r.segments,this._gridBuffer=s.createVertexBuffer(r.vertices,Rr.members),this._gridIndexBuffer=s.createIndexBuffer(r.indices,!0)}_createPoles(s){const r=new Sr;for(let p=0;p<=dr;p++)r.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=s.createIndexBuffer(r,!0);const l=new Ri,h=new Ri;this._poleSegments=[];for(let p=0,x=0;p<Un;p++){const w=360/(1<<p);l.emplaceBack(0,-pn,0,.5,0),h.emplaceBack(0,-pn,0,.5,1);for(let A=0;A<=dr;A++){const P=A/dr,R=Ge(0,w,P),[$,X,re]=Js(Ll,Ed,R,pn);l.emplaceBack($,X,re,P,0),h.emplaceBack($,X,re,P,1)}this._poleSegments.push(Ra.simpleSegment(x,0,66,64)),x+=66}this._poleNorthVertexBuffer=s.createVertexBuffer(l,_i,!1),this._poleSouthVertexBuffer=s.createVertexBuffer(h,_i,!1)}getGridBuffers(s,r){return[this._gridBuffer,this._gridIndexBuffer,r?this._gridSegments[s].withSkirts:this._gridSegments[s].withoutSkirts]}getPoleBuffers(s){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[s]]}getWirefameBuffers(s,r){if(!this._wireframeSegments){const l=new ts,h=dr,p=h+1+2,x=1;this._wireframeSegments=[];for(let w=0,A=0;w<qr.length;w++){const P=qr[w];for(let $=x;$<P+x;$++)for(let X=x;X<h+x;X++){const re=$*p+X;l.emplaceBack(re,re+1),l.emplaceBack(re,re+p),l.emplaceBack(re,re+p+1)}const R=P*h*3;this._wireframeSegments.push(Ra.simpleSegment(0,A,(P+1)*p,R)),A+=R}this._wireframeIndexBuffer=s.createIndexBuffer(l)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[r]]}},o.GlyphManager=Og,o.ImagePosition=Nx,o.KDBush=Yx,o.LivePerformanceUtils=gl,o.LngLat=Qr,o.LngLatBounds=od,o.LocalGlyphMode=Ox,o.MAX_MERCATOR_LATITUDE=Ma,o.MercatorCoordinate=Gh,o.ONE_EM=uu,o.OverscaledTileID=ph,o.PerformanceMarkers=ga,o.Point=q,o.Properties=ot,o.RGBAImage=Gu,o.Ray=ji,o.RequestManager=class{constructor(s,r,l){this._transformRequestFn=s,this._customAccessToken=r,this._silenceAuthErrors=!!l,this._createSkuToken()}_createSkuToken(){const s=(function(){let r="";for(let l=0;l<10;l++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",me,r].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(s,r){return this._transformRequestFn&&this._transformRequestFn(s,r)||{url:s}}normalizeStyleURL(s,r){if(!Ct(s))return s;const l=Bn(s);return l.path=`/styles/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||r)}normalizeGlyphsURL(s,r){if(!Ct(s))return s;const l=Bn(s);return l.path=`/fonts/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||r)}normalizeSourceURL(s,r,l,h){if(!Ct(s))return s;const p=Bn(s);return p.path=`/v4/${p.authority}.json`,p.params.push("secure"),l&&p.params.push(`language=${l}`),h&&p.params.push(`worldview=${h}`),this._makeAPIURL(p,this._customAccessToken||r)}normalizeSpriteURL(s,r,l,h){const p=Bn(s);return Ct(s)?(p.path=`/styles/v1${p.path}/sprite${r}${l}`,this._makeAPIURL(p,this._customAccessToken||h)):(p.path+=`${r}${l}`,Tn(p))}normalizeTileURL(s,r,l){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!Ct(s))return s;const h=Bn(s);h.path=h.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||l&&h.authority!=="raster"&&l===512?"@2x":""}${k.supported?".webp":"$1"}`),h.authority==="raster"?h.path=`/${V.RASTER_URL_PREFIX}${h.path}`:(h.path=h.path.replace(/^.+\/v4\//,"/"),h.path=`/${V.TILE_URL_VERSION}${h.path}`);const p=this._customAccessToken||(function(x){for(const w of x){const A=w.match(/^access_token=(.*)$/);if(A)return A[1]}return null})(h.params)||V.ACCESS_TOKEN;return V.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&h.params.push(`sku=${this._skuToken}`),this._makeAPIURL(h,p)}canonicalizeTileURL(s,r){const l=Bn(s);if(!l.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!l.path.match(/\.[\w]+$/))return s;let h="mapbox://";l.path.match(/^\/raster\/v1\//)?h+=`raster/${l.path.replace(`/${V.RASTER_URL_PREFIX}/`,"")}`:h+=`tiles/${l.path.replace(`/${V.TILE_URL_VERSION}/`,"")}`;let p=l.params;return r&&(p=p.filter((x=>!x.match(/^access_token=/)))),p.length&&(h+=`?${p.join("&")}`),h}canonicalizeTileset(s,r){const l=!!r&&Ct(r),h=[];for(const p of s.tiles||[])Mt(p)?h.push(this.canonicalizeTileURL(p,l)):h.push(p);return h}_makeAPIURL(s,r){const l="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",h=Bn(V.API_URL);if(s.protocol=h.protocol,s.authority=h.authority,s.protocol==="http"){const p=s.params.indexOf("secure");p>=0&&s.params.splice(p,1)}if(h.path!=="/"&&(s.path=`${h.path}${s.path}`),!V.REQUIRE_ACCESS_TOKEN)return Tn(s);if(r=r||V.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${l}`);if(r[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${l}`)}return s.params=s.params.filter((p=>p.indexOf("access_token")===-1)),s.params.push(`access_token=${r||""}`),Tn(s)}},o.ResourceType=or,o.SegmentVector=Ra,o.SourceCache=Dm,o.StencilMode=Wx,o.StructArrayLayout1ui2=cc,o.StructArrayLayout2f1f2i16=fr,o.StructArrayLayout2i4=mn,o.StructArrayLayout2ui4=ts,o.StructArrayLayout3f12=gi,o.StructArrayLayout3ui6=Sr,o.StructArrayLayout4i8=an,o.StructArrayLayout5f20=Ri,o.Texture=py,o.Tile=Gx,o.Transitionable=ge,o.Uniform1f=ju,o.Uniform1i=class extends Pc{constructor(s){super(s),this.current=0}set(s,r,l){this.fetchUniformLocation(s,r)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},o.Uniform2f=class extends Pc{constructor(s){super(s),this.current=[0,0]}set(s,r,l){this.fetchUniformLocation(s,r)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}},o.Uniform3f=class extends Pc{constructor(s){super(s),this.current=[0,0,0]}set(s,r,l){this.fetchUniformLocation(s,r)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}},o.Uniform4f=wd,o.UniformColor=Od,o.UniformMatrix2f=class extends Pc{constructor(s){super(s),this.current=kh}set(s,r,l){if(this.fetchUniformLocation(s,r)){for(let h=0;h<4;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}}},o.UniformMatrix3f=class extends Pc{constructor(s){super(s),this.current=cf}set(s,r,l){if(this.fetchUniformLocation(s,r)){for(let h=0;h<9;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix3fv(this.location,!1,l);break}}}},o.UniformMatrix4f=class extends Pc{constructor(s){super(s),this.current=lh}set(s,r,l){if(this.fetchUniformLocation(s,r)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let h=1;h<16;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}},o.UnwrappedTileID=J3,o.ValidationError=lr,o.VectorTileFeature=Fi,o.VectorTileWorkerSource=class extends sa{constructor(s,r,l,h,p){super(),this.actor=s,this.layerIndex=r,this.availableImages=l,this.loadVectorData=p||l2,this.loading={},this.loaded={},this.deduped=new a2(s.scheduler),this.isSpriteLoaded=h,this.scheduler=s.scheduler}loadTile(s,r){const l=s.uid,h=s&&s.request,p=h&&h.collectResourceTiming,x=this.loading[l]=new WL(s);x.abort=this.loadVectorData(s,((w,A)=>{const P=!this.loading[l];if(delete this.loading[l],P||w||!A)return x.status="done",P||(this.loaded[l]=x),r(w);const R=A.rawData,$={};A.expires&&($.expires=A.expires),A.cacheControl&&($.cacheControl=A.cacheControl),x.vectorTile=A.vectorTile||new pi(new K_(R));const X=()=>{x.parse(x.vectorTile,this.layerIndex,this.availableImages,this.actor,((re,he)=>{if(re||!he)return r(re);const ye={};if(p){const Se=Jl(h);Se.length>0&&(ye.resourceTiming=JSON.parse(JSON.stringify(Se)))}r(null,Be({rawTileData:R.slice(0)},he,$,ye))}))};this.isSpriteLoaded?X():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(X,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom}):X()})),this.loaded=this.loaded||{},this.loaded[l]=x}))}reloadTile(s,r){const l=this.loaded,h=s.uid,p=this;if(l&&l[h]){const x=l[h];x.showCollisionBoxes=s.showCollisionBoxes,x.enableTerrain=!!s.enableTerrain,x.projection=s.projection,x.tileTransform=Nm(s.tileID.canonical,s.projection);const w=(A,P)=>{const R=x.reloadCallback;R&&(delete x.reloadCallback,x.parse(x.vectorTile,p.layerIndex,this.availableImages,p.actor,R)),r(A,P)};x.status==="parsing"?x.reloadCallback=w:x.status==="done"&&(x.vectorTile?x.parse(x.vectorTile,this.layerIndex,this.availableImages,this.actor,w):w())}}abortTile(s,r){const l=s.uid,h=this.loading[l];h&&(h.abort&&h.abort(),delete this.loading[l]),r()}removeTile(s,r){const l=this.loaded,h=s.uid;l&&l[h]&&delete l[h],r()}},o.WritingMode=hd,o.ZoomDependentExpression=va,o.add=$h,o.addDynamicAttributes=i1,o.adjoint=function(s,r){var l=r[0],h=r[1],p=r[2],x=r[3],w=r[4],A=r[5],P=r[6],R=r[7],$=r[8];return s[0]=w*$-A*R,s[1]=p*R-h*$,s[2]=h*A-p*w,s[3]=A*P-x*$,s[4]=l*$-p*P,s[5]=p*x-l*A,s[6]=x*R-w*P,s[7]=h*P-l*R,s[8]=l*w-h*x,s},o.asyncAll=le,o.bezier=Ne,o.bindAll=Yt,o.boundsAttributes=$4,o.bufferConvexPolygon=function(s,r){const l=[];for(let h=0;h<s.length;h++){const p=xe(h-1,-1,s.length-1),x=xe(h+1,-1,s.length-1),w=s[h],A=s[x],P=s[p].sub(w).unit(),R=A.sub(w).unit(),$=R.angleWithSep(P.x,P.y),X=P.add(R).unit().mult(-1*r/Math.sin($/2));l.push(w.add(X))}return l},o.cacheEntryPossiblyAdded=function(s){Pi++,Pi>Mr&&(s.getActor().send("enforceCacheSizeLimit",Dn),Pi=0)},o.calculateGlobeLabelMatrix=function(s,r){const{x:l,y:h}=s.point,p=pc(l,h,s.worldSize/s._pixelsPerMercatorPixel,0,0);return Wc(p,p,jd(Ds(r)))},o.calculateGlobeMatrix=function(s){const{x:r,y:l}=s.point,{lng:h,lat:p}=s._center;return pc(r,l,s.worldSize,h,p)},o.calculateGlobeMercatorMatrix=function(s){const r=s.pixelsPerMeter,l=r/ea(1,s.center.lat),h=Hc(new Float64Array(16));return bu(h,h,[s.point.x,s.point.y,0]),sd(h,h,[l,l,r]),Float32Array.from(h)},o.circumferenceAtLatitude=rl,o.clamp=Fe,o.clearTileCache=function(s){if(!Ir())return;const r=b.caches.delete(Gn);s&&r.catch(s).then((()=>s()))},o.clipLine=T4,o.clone=function(s){var r=new hc(16);return r[0]=s[0],r[1]=s[1],r[2]=s[2],r[3]=s[3],r[4]=s[4],r[5]=s[5],r[6]=s[6],r[7]=s[7],r[8]=s[8],r[9]=s[9],r[10]=s[10],r[11]=s[11],r[12]=s[12],r[13]=s[13],r[14]=s[14],r[15]=s[15],r},o.clone$1=Gt,o.collisionCircleLayout=GC,o.config=V,o.conjugate=function(s,r){return s[0]=-r[0],s[1]=-r[1],s[2]=-r[2],s[3]=r[3],s},o.create=function(){var s=new hc(16);return hc!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},o.create$1=bg,o.createExpression=qn,o.createLayout=Lt,o.createStyleLayer=function(s){return s.type==="custom"?new FL(s):new BL[s.type](s)},o.cross=At,o.degToRad=Z,o.distance=function(s,r){return Math.hypot(r[0]-s[0],r[1]-s[1],r[2]-s[2])},o.div=function(s,r,l){return s[0]=r[0]/l[0],s[1]=r[1]/l[1],s[2]=r[2]/l[2],s},o.dot=Ke,o.earthRadius=qu,o.ease=we,o.easeCubicInOut=Oe,o.ecefToLatLng=function([s,r,l]){const h=Math.hypot(s,r,l),p=Math.atan2(s,l),x=.5*Math.PI-Math.acos(-r/h);return new Qr(be(p),be(x))},o.emitValidationErrors=nl,o.endsWith=cn,o.enforceCacheSizeLimit=function(s){Pr(),wr&&wr.then((r=>{r.keys().then((l=>{for(let h=0;h<l.length-s;h++)r.delete(l[h])}))}))},o.evaluateSizeForFeature=H_,o.evaluateSizeForZoom=Mg,o.evaluateVariableOffset=k4,o.evented=S,o.exactEquals=function(s,r){return s[0]===r[0]&&s[1]===r[1]&&s[2]===r[2]&&s[3]===r[3]},o.exactEquals$1=function(s,r){return s[0]===r[0]&&s[1]===r[1]&&s[2]===r[2]},o.exported=Ko,o.exported$1=k,o.extend=Be,o.extend$1=Xo,o.fillExtrusionHeightLift=X3,o.filterObject=Mn,o.fromMat4=function(s,r){return s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[4],s[4]=r[5],s[5]=r[6],s[6]=r[8],s[7]=r[9],s[8]=r[10],s},o.fromQuat=function(s,r){var l=r[0],h=r[1],p=r[2],x=r[3],w=l+l,A=h+h,P=p+p,R=l*w,$=h*w,X=h*A,re=p*w,he=p*A,ye=p*P,Se=x*w,We=x*A,at=x*P;return s[0]=1-X-ye,s[1]=$+at,s[2]=re-We,s[3]=0,s[4]=$-at,s[5]=1-R-ye,s[6]=he+Se,s[7]=0,s[8]=re+We,s[9]=he-Se,s[10]=1-R-X,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},o.fromRotation=function(s,r){var l=Math.sin(r),h=Math.cos(r);return s[0]=h,s[1]=l,s[2]=0,s[3]=-l,s[4]=h,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},o.fromScaling=Qf,o.furthestTileCorner=function(s){const r=Math.round((s+45+360)%360/90)%4;return Re[r]},o.getAABBPointSquareDist=function(s,r,l){let h=0;for(let p=0;p<2;++p){const x=l?l[p]:0;s[p]>x&&(h+=(s[p]-x)*(s[p]-x)),r[p]<x&&(h+=(x-r[p])*(x-r[p]))}return h},o.getAnchorAlignment=Fx,o.getAnchorJustification=zx,o.getBounds=function(s){let r=1/0,l=1/0,h=-1/0,p=-1/0;for(const x of s)r=Math.min(r,x.x),l=Math.min(l,x.y),h=Math.max(h,x.x),p=Math.max(p,x.y);return{min:new q(r,l),max:new q(h,p)}},o.getColumn=Pn,o.getDefaultExportFromCjs=ue,o.getGridMatrix=function(s,r,l,h){const p=r.getNorth(),x=r.getSouth(),w=r.getWest(),A=r.getEast(),P=1<<s.z,R=A-w,$=p-x,X=R/dr,re=-$/qr[l],he=[0,X,0,re,0,0,p,w,0];if(s.z>0){const ye=180/h;xm(he,he,[ye/R+1,0,0,0,ye/$+1,0,-.5*ye/X,.5*ye/re,1])}return he[2]=P,he[5]=s.x,he[8]=s.y,he},o.getImage=Qe,o.getJSON=function(s,r){return Br(Be(s,{type:"json"}),r)},o.getLatitudinalLod=function(s){const r=Ma-5;s=Fe(s,-r,r)/r*90;const l=Math.pow(Math.abs(Math.sin(Z(s))),3);return Math.round(l*(qr.length-1))},o.getMapSessionAPI=io,o.getPerformanceMeasurement=Jl,o.getProjection=z4,o.getRTLTextPluginStatus=T,o.getReferrer=Kr,o.getTilePoint=function(s,{x:r,y:l},h=0){return new q(((r-h)*s.scale-s.x)*Jr,(l*s.scale-s.y)*Jr)},o.getTileVec3=function(s,r,l=0){return Sd(((r.x-l)*s.scale-s.x)*Jr,(r.y*s.scale-s.y)*Jr,pf(r.z,r.y))},o.getVideo=function(s,r){const l=b.document.createElement("video");l.muted=!0,l.onloadstart=function(){r(null,l)};for(let h=0;h<s.length;h++){const p=b.document.createElement("source");si(s[h])||(l.crossOrigin="Anonymous"),p.src=s[h],l.appendChild(p)}return{cancel:()=>{}}},o.globeCenterToScreenPoint=function(s){const r=[0,0,0],l=Hc(new Float64Array(16));return Wc(l,s.pixelMatrix,s.globeMatrix),kt(r,r,l),new q(r[0],r[1])},o.globeDenormalizeECEF=jd,o.globeECEFOrigin=function(s,r){const l=[0,0,0];return kt(l,l,fc(Ds(r.canonical))),kt(l,l,s),l},o.globeMetersToEcef=wo,o.globeNormalizeECEF=fc,o.globePixelsToTileUnits=function(s,r){return Jr/(512*Math.pow(2,s))*uh(Ds(r))},o.globePoleMatrixForTile=function(s,r,l){const h=Hc(new Float64Array(16)),p=(r/(1<<s)-.5)*Math.PI*2;return Jf(h,l.globeMatrix,p),Float32Array.from(h)},o.globeTileBounds=Ds,o.globeTiltAtLngLat=bs,o.globeToMercatorTransition=ci,o.globeUseCustomAntiAliasing=function(s,r,l){const h=ci(l.zoom),p=s.style.map._antialias,x=!!r.extStandardDerivatives,w=r.extStandardDerivativesForceOff||s.terrain&&s.terrain.exaggeration()>0;return h===0&&!p&&!w&&x},o.identity=Hc,o.identity$1=On,o.invert=au,o.isFullscreen=function(){return!!b.document.fullscreenElement||!!b.document.webkitFullscreenElement},o.isLngLatBehindGlobe=da,o.isMapAuthenticated=function(s){return Is.has(s)},o.isMapboxURL=Ct,o.isSafariWithAntialiasingBug=function(s){const r=s.navigator?s.navigator.userAgent:null;return!!Yr(s)&&r&&(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.latFromMercatorY=Oo,o.latLngToECEF=Qs,o.len=yn,o.length=zd,o.length$1=function(s){return Math.hypot(s[0],s[1],s[2],s[3])},o.lngFromMercatorX=mc,o.loadVectorTile=l2,o.makeRequest=Br,o.mapValue=function(s,r,l,h,p){return Fe((s-r)/(l-r)*(p-h)+h,h,p)},o.mercatorScale=tp,o.mercatorXfromLng=Ts,o.mercatorYfromLat=fa,o.mercatorZfromAltitude=ea,o.mul=bm,o.mul$1=An,o.multiply=Wc,o.multiply$1=xm,o.multiply$2=O,o.nextPowerOfTwo=ft,o.normalize=ze,o.normalize$1=Or,o.normalize$2=rn,o.number=Ge,o.ortho=function(s,r,l,h,p,x,w){var A=1/(r-l),P=1/(h-p),R=1/(x-w);return s[0]=-2*A,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*P,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*R,s[11]=0,s[12]=(r+l)*A,s[13]=(p+h)*P,s[14]=(w+x)*R,s[15]=1,s},o.pbf=o4,o.perspective=function(s,r,l,h,p){var x,w=1/Math.tan(r/2);return s[0]=w/l,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=w,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,p!=null&&p!==1/0?(s[10]=(p+h)*(x=1/(h-p)),s[14]=2*p*h*x):(s[10]=-1,s[14]=-2*h),s},o.pick=function(s,r){const l={};for(let h=0;h<r.length;h++){const p=r[h];p in s&&(l[p]=s[p])}return l},o.plugin=z,o.pointGeometry=U,o.polesInViewport=function(s){const r=Hc(new Float64Array(16));Wc(r,s.pixelMatrix,s.globeMatrix);const l=[0,Di,0],h=[0,Wn,0];return kt(l,l,r),kt(h,h,r),[l[0]>0&&l[0]<=s.width&&l[1]>0&&l[1]<=s.height&&!da(s,new Qr(s.center.lat,90)),h[0]>0&&h[0]<=s.width&&h[1]>0&&h[1]<=s.height&&!da(s,new Qr(s.center.lat,-90))]},o.polygonContainsPoint=Vd,o.polygonIntersectsBox=B_,o.polygonIntersectsPolygon=wg,o.polygonizeBounds=function(s,r,l=0,h=!0){const p=new q(l,l),x=s.sub(p),w=r.add(p),A=[x,new q(w.x,x.y),w,new q(x.x,w.y)];return h&&A.push(x.clone()),A},o.posAttributes=Rr,o.postMapLoadEvent=yo,o.postPerformanceEvent=ro,o.postTurnstileEvent=Ai,o.potpack=Mx,o.prevPowerOfTwo=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log(s)/Math.LN2))},o.radToDeg=be,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.registerForPluginStateChange=function(s){return s({pluginStatus:y,pluginURL:a}),S.on("pluginStateChange",s),s},o.removeAuthState=function(s){Is.delete(s)},o.renderColorRamp=Z0,o.resample=cu,o.rotateX=Rp,o.rotateX$1=gr,o.rotateY=Jf,o.rotateY$1=ti,o.rotateZ=function(s,r,l){var h=Math.sin(l),p=Math.cos(l),x=r[0],w=r[1],A=r[2],P=r[3],R=r[4],$=r[5],X=r[6],re=r[7];return r!==s&&(s[8]=r[8],s[9]=r[9],s[10]=r[10],s[11]=r[11],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[0]=x*p+R*h,s[1]=w*p+$*h,s[2]=A*p+X*h,s[3]=P*p+re*h,s[4]=R*p-x*h,s[5]=$*p-w*h,s[6]=X*p-A*h,s[7]=re*p-P*h,s},o.rotateZ$1=function(s,r,l){l*=.5;var h=r[0],p=r[1],x=r[2],w=r[3],A=Math.sin(l),P=Math.cos(l);return s[0]=h*P+p*A,s[1]=p*P-h*A,s[2]=x*P+w*A,s[3]=w*P-x*A,s},o.scale=sd,o.scale$1=Kt,o.scale$2=Me,o.scaleAndAdd=tt,o.set=function(s,r,l,h){return s[0]=r,s[1]=l,s[2]=h,s},o.setCacheLimits=function(s,r){Dn=s,Mr=r},o.setColumn=function(s,r,l){s[4*r+0]=l[0],s[4*r+1]=l[1],s[4*r+2]=l[2],s[4*r+3]=l[3]},o.setRTLTextPlugin=function(s,r,l=!1){if(y===ct||y===Ft||y===Qt)throw new Error("setRTLTextPlugin cannot be called multiple times.");a=Ko.resolveURL(s),y=ct,En=r,v(),l||N()},o.smoothstep=nt,o.spec=dn,o.squaredLength=function(s){var r=s[0],l=s[1],h=s[2];return r*r+l*l+h*h},o.storeAuthState=function(s,r){r?Is.add(s):Is.delete(s)},o.sub=en,o.subtract=Mp,o.symbolSize=HC,o.tileAABB=function(s,r,l,h,p,x,w,A,P){if(P.name==="globe")return ad(s,r,new $_(l,h,p));const R=Nm({z:l,x:h,y:p},P);return new Wr([(x+R.x/R.scale)*r,r*(R.y/R.scale),w],[(x+R.x2/R.scale)*r,r*(R.y2/R.scale),A])},o.tileCornersToBounds=Mh,o.tileTransform=Nm,o.transformMat3=function(s,r,l){var h=r[0],p=r[1],x=r[2];return s[0]=h*l[0]+p*l[3]+x*l[6],s[1]=h*l[1]+p*l[4]+x*l[7],s[2]=h*l[2]+p*l[5]+x*l[8],s},o.transformMat4=kt,o.transformMat4$1=$n,o.transformQuat=gt,o.transitionTileAABBinECEF=Qn,o.translate=bu,o.transpose=function(s,r){if(s===r){var l=r[1],h=r[2],p=r[5];s[1]=r[3],s[2]=r[6],s[3]=l,s[5]=r[7],s[6]=h,s[7]=p}else s[0]=r[0],s[1]=r[3],s[2]=r[6],s[3]=r[1],s[4]=r[4],s[5]=r[7],s[6]=r[2],s[7]=r[5],s[8]=r[8];return s},o.triggerPluginCompletionEvent=f,o.uniqueId=rt,o.updateGlobeVertexNormal=function(s,r,l,h,p){const x=5*r+2;s.float32[x+0]=l,s.float32[x+1]=h,s.float32[x+2]=p},o.validateCustomStyleLayer=function(s){const r=[],l=s.id;return l===void 0&&r.push({message:`layers.${l}: missing required property "id"`}),s.render===void 0&&r.push({message:`layers.${l}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&r.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),r},o.validateFilter=s=>tl(Ua(s)),o.validateFog=s=>tl(Pa(s)),o.validateLayer=s=>tl(nd(s)),o.validateLight=s=>tl(xd(s)),o.validateSource=s=>tl(xa(s)),o.validateStyle=Rs,o.validateTerrain=s=>tl(sc(s)),o.values=De,o.vectorTile=_n,o.version=I,o.warnOnce=mr,o.window=b,o.wrap=xe})),m(["./shared"],(function(o){function b(ut){if(typeof ut=="number"||typeof ut=="boolean"||typeof ut=="string"||ut==null)return JSON.stringify(ut);if(Array.isArray(ut)){let Ie="[";for(const Qe of ut)Ie+=`${b(Qe)},`;return`${Ie}]`}let Ee="{";for(const Ie of Object.keys(ut).sort())Ee+=`${Ie}:${b(ut[Ie])},`;return`${Ee}}`}function I(ut){let Ee="";for(const Ie of o.refProperties)Ee+=`/${b(ut[Ie])}`;return Ee}class M{constructor(Ee){this.keyCache={},Ee&&this.replace(Ee)}replace(Ee){this._layerConfigs={},this._layers={},this.update(Ee,[])}update(Ee,Ie){for(const ht of Ee)this._layerConfigs[ht.id]=ht,(this._layers[ht.id]=o.createStyleLayer(ht)).compileFilter(),this.keyCache[ht.id]&&delete this.keyCache[ht.id];for(const ht of Ie)delete this.keyCache[ht],delete this._layerConfigs[ht],delete this._layers[ht];this.familiesBySource={};const Qe=(function(ht,Ct){const Mt={};for(let Et=0;Et<ht.length;Et++){const Pt=Ct&&Ct[ht[Et].id]||I(ht[Et]);Ct&&(Ct[ht[Et].id]=Pt);let vn=Mt[Pt];vn||(vn=Mt[Pt]=[]),vn.push(ht[Et])}const Bt=[];for(const Et in Mt)Bt.push(Mt[Et]);return Bt})(o.values(this._layerConfigs),this.keyCache);for(const ht of Qe){const Ct=ht.map((Bn=>this._layers[Bn.id])),Mt=Ct[0];if(Mt.visibility==="none")continue;const Bt=Mt.source||"";let Et=this.familiesBySource[Bt];Et||(Et=this.familiesBySource[Bt]={});const Pt=Mt.sourceLayer||"_geojsonTileLayer";let vn=Et[Pt];vn||(vn=Et[Pt]=[]),vn.push(Ct)}}}class V{loadTile(Ee,Ie){const{uid:Qe,encoding:ht,rawImageData:Ct,padding:Mt,buildQuadTree:Bt}=Ee,Et=o.window.ImageBitmap&&Ct instanceof o.window.ImageBitmap?this.getImageData(Ct,Mt):Ct;Ie(null,new o.DEMData(Qe,Et,ht,Mt<1,Bt))}getImageData(Ee,Ie){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Ee.width,Ee.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Ee.width,this.offscreenCanvas.height=Ee.height,this.offscreenCanvasContext.drawImage(Ee,0,0,Ee.width,Ee.height);const Qe=this.offscreenCanvasContext.getImageData(-Ie,-Ie,Ee.width+2*Ie,Ee.height+2*Ie);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Qe}}function k(ut,Ee){if(ut.length!==0){ie(ut[0],Ee);for(var Ie=1;Ie<ut.length;Ie++)ie(ut[Ie],!Ee)}}function ie(ut,Ee){for(var Ie=0,Qe=0,ht=0,Ct=ut.length,Mt=Ct-1;ht<Ct;Mt=ht++){var Bt=(ut[ht][0]-ut[Mt][0])*(ut[Mt][1]+ut[ht][1]),Et=Ie+Bt;Qe+=Math.abs(Ie)>=Math.abs(Bt)?Ie-Et+Bt:Bt-Et+Ie,Ie=Et}Ie+Qe>=0!=!!Ee&&ut.reverse()}var se=o.getDefaultExportFromCjs((function ut(Ee,Ie){var Qe,ht=Ee&&Ee.type;if(ht==="FeatureCollection")for(Qe=0;Qe<Ee.features.length;Qe++)ut(Ee.features[Qe],Ie);else if(ht==="GeometryCollection")for(Qe=0;Qe<Ee.geometries.length;Qe++)ut(Ee.geometries[Qe],Ie);else if(ht==="Feature")ut(Ee.geometry,Ie);else if(ht==="Polygon")k(Ee.coordinates,Ie);else if(ht==="MultiPolygon")for(Qe=0;Qe<Ee.coordinates.length;Qe++)k(Ee.coordinates[Qe],Ie);return Ee}));const fe=o.VectorTileFeature.prototype.toGeoJSON;var J={exports:{}},ne=o.pointGeometry,me=o.vectorTile.VectorTileFeature,ue=ke;function ke(ut,Ee){this.options=Ee||{},this.features=ut,this.length=ut.length}function je(ut,Ee){this.id=typeof ut.id=="number"?ut.id:void 0,this.type=ut.type,this.rawGeometry=ut.type===1?[ut.geometry]:ut.geometry,this.properties=ut.tags,this.extent=Ee||4096}ke.prototype.feature=function(ut){return new je(this.features[ut],this.options.extent)},je.prototype.loadGeometry=function(){var ut=this.rawGeometry;this.geometry=[];for(var Ee=0;Ee<ut.length;Ee++){for(var Ie=ut[Ee],Qe=[],ht=0;ht<Ie.length;ht++)Qe.push(new ne(Ie[ht][0],Ie[ht][1]));this.geometry.push(Qe)}return this.geometry},je.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ut=this.geometry,Ee=1/0,Ie=-1/0,Qe=1/0,ht=-1/0,Ct=0;Ct<ut.length;Ct++)for(var Mt=ut[Ct],Bt=0;Bt<Mt.length;Bt++){var Et=Mt[Bt];Ee=Math.min(Ee,Et.x),Ie=Math.max(Ie,Et.x),Qe=Math.min(Qe,Et.y),ht=Math.max(ht,Et.y)}return[Ee,Qe,Ie,ht]},je.prototype.toGeoJSON=me.prototype.toGeoJSON;var pe=o.pbf,U=ue;function F(ut){var Ee=new pe;return(function(Ie,Qe){for(var ht in Ie.layers)Qe.writeMessage(3,q,Ie.layers[ht])})(ut,Ee),Ee.finish()}function q(ut,Ee){var Ie;Ee.writeVarintField(15,ut.version||1),Ee.writeStringField(1,ut.name||""),Ee.writeVarintField(5,ut.extent||4096);var Qe={keys:[],values:[],keycache:{},valuecache:{}};for(Ie=0;Ie<ut.length;Ie++)Qe.feature=ut.feature(Ie),Ee.writeMessage(2,j,Qe);var ht=Qe.keys;for(Ie=0;Ie<ht.length;Ie++)Ee.writeStringField(3,ht[Ie]);var Ct=Qe.values;for(Ie=0;Ie<Ct.length;Ie++)Ee.writeMessage(4,Oe,Ct[Ie])}function j(ut,Ee){var Ie=ut.feature;Ie.id!==void 0&&Ee.writeVarintField(1,Ie.id),Ee.writeMessage(2,H,ut),Ee.writeVarintField(3,Ie.type),Ee.writeMessage(4,Re,Ie)}function H(ut,Ee){var Ie=ut.feature,Qe=ut.keys,ht=ut.values,Ct=ut.keycache,Mt=ut.valuecache;for(var Bt in Ie.properties){var Et=Ie.properties[Bt],Pt=Ct[Bt];if(Et!==null){Pt===void 0&&(Qe.push(Bt),Ct[Bt]=Pt=Qe.length-1),Ee.writeVarint(Pt);var vn=typeof Et;vn!=="string"&&vn!=="boolean"&&vn!=="number"&&(Et=JSON.stringify(Et));var Bn=vn+":"+Et,Tn=Mt[Bn];Tn===void 0&&(ht.push(Et),Mt[Bn]=Tn=ht.length-1),Ee.writeVarint(Tn)}}}function Z(ut,Ee){return(Ee<<3)+(7&ut)}function be(ut){return ut<<1^ut>>31}function Re(ut,Ee){for(var Ie=ut.loadGeometry(),Qe=ut.type,ht=0,Ct=0,Mt=Ie.length,Bt=0;Bt<Mt;Bt++){var Et=Ie[Bt],Pt=1;Qe===1&&(Pt=Et.length),Ee.writeVarint(Z(1,Pt));for(var vn=Qe===3?Et.length-1:Et.length,Bn=0;Bn<vn;Bn++){Bn===1&&Qe!==1&&Ee.writeVarint(Z(2,vn-1));var Tn=Et[Bn].x-ht,kr=Et[Bn].y-Ct;Ee.writeVarint(be(Tn)),Ee.writeVarint(be(kr)),ht+=Tn,Ct+=kr}Qe===3&&Ee.writeVarint(Z(7,1))}}function Oe(ut,Ee){var Ie=typeof ut;Ie==="string"?Ee.writeStringField(1,ut):Ie==="boolean"?Ee.writeBooleanField(7,ut):Ie==="number"&&(ut%1!=0?Ee.writeDoubleField(3,ut):ut<0?Ee.writeSVarintField(6,ut):Ee.writeVarintField(5,ut))}J.exports=F,J.exports.fromVectorTileJs=F,J.exports.fromGeojsonVt=function(ut,Ee){Ee=Ee||{};var Ie={};for(var Qe in ut)Ie[Qe]=new U(ut[Qe].features,Ee),Ie[Qe].name=Qe,Ie[Qe].version=Ee.version,Ie[Qe].extent=Ee.extent;return F({layers:Ie})},J.exports.GeoJSONWrapper=U;var Ne=o.getDefaultExportFromCjs(J.exports);const we={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ut=>ut},Fe=Math.fround||(nt=new Float32Array(1),ut=>(nt[0]=+ut,nt[0]));var nt;const xe=3,le=5,De=6;class Be{constructor(Ee){this.options=Object.assign(Object.create(we),Ee),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Ee){const{log:Ie,minZoom:Qe,maxZoom:ht}=this.options;Ie&&console.time("total time");const Ct=`prepare ${Ee.length} points`;Ie&&console.time(Ct),this.points=Ee;const Mt=[];for(let Et=0;Et<Ee.length;Et++){const Pt=Ee[Et];if(!Pt.geometry)continue;const[vn,Bn]=Pt.geometry.coordinates,Tn=Fe(mt(vn)),kr=Fe(ft(Bn));Mt.push(Tn,kr,1/0,Et,-1,1),this.options.reduce&&Mt.push(0)}let Bt=this.trees[ht+1]=this._createTree(Mt);Ie&&console.timeEnd(Ct);for(let Et=ht;Et>=Qe;Et--){const Pt=+Date.now();Bt=this.trees[Et]=this._createTree(this._cluster(Bt,Et)),Ie&&console.log("z%d: %d clusters in %dms",Et,Bt.numItems,+Date.now()-Pt)}return Ie&&console.timeEnd("total time"),this}getClusters(Ee,Ie){let Qe=((Ee[0]+180)%360+360)%360-180;const ht=Math.max(-90,Math.min(90,Ee[1]));let Ct=Ee[2]===180?180:((Ee[2]+180)%360+360)%360-180;const Mt=Math.max(-90,Math.min(90,Ee[3]));if(Ee[2]-Ee[0]>=360)Qe=-180,Ct=180;else if(Qe>Ct){const Bn=this.getClusters([Qe,ht,180,Mt],Ie),Tn=this.getClusters([-180,ht,Ct,Mt],Ie);return Bn.concat(Tn)}const Bt=this.trees[this._limitZoom(Ie)],Et=Bt.range(mt(Qe),ft(Mt),mt(Ct),ft(ht)),Pt=Bt.data,vn=[];for(const Bn of Et){const Tn=this.stride*Bn;vn.push(Pt[Tn+le]>1?Ye(Pt,Tn,this.clusterProps):this.points[Pt[Tn+xe]])}return vn}getChildren(Ee){const Ie=this._getOriginId(Ee),Qe=this._getOriginZoom(Ee),ht="No cluster with the specified id.",Ct=this.trees[Qe];if(!Ct)throw new Error(ht);const Mt=Ct.data;if(Ie*this.stride>=Mt.length)throw new Error(ht);const Bt=this.options.radius/(this.options.extent*Math.pow(2,Qe-1)),Et=Ct.within(Mt[Ie*this.stride],Mt[Ie*this.stride+1],Bt),Pt=[];for(const vn of Et){const Bn=vn*this.stride;Mt[Bn+4]===Ee&&Pt.push(Mt[Bn+le]>1?Ye(Mt,Bn,this.clusterProps):this.points[Mt[Bn+xe]])}if(Pt.length===0)throw new Error(ht);return Pt}getLeaves(Ee,Ie,Qe){const ht=[];return this._appendLeaves(ht,Ee,Ie=Ie||10,Qe=Qe||0,0),ht}getTile(Ee,Ie,Qe){const ht=this.trees[this._limitZoom(Ee)],Ct=Math.pow(2,Ee),{extent:Mt,radius:Bt}=this.options,Et=Bt/Mt,Pt=(Qe-Et)/Ct,vn=(Qe+1+Et)/Ct,Bn={features:[]};return this._addTileFeatures(ht.range((Ie-Et)/Ct,Pt,(Ie+1+Et)/Ct,vn),ht.data,Ie,Qe,Ct,Bn),Ie===0&&this._addTileFeatures(ht.range(1-Et/Ct,Pt,1,vn),ht.data,Ct,Qe,Ct,Bn),Ie===Ct-1&&this._addTileFeatures(ht.range(0,Pt,Et/Ct,vn),ht.data,-1,Qe,Ct,Bn),Bn.features.length?Bn:null}getClusterExpansionZoom(Ee){let Ie=this._getOriginZoom(Ee)-1;for(;Ie<=this.options.maxZoom;){const Qe=this.getChildren(Ee);if(Ie++,Qe.length!==1)break;Ee=Qe[0].properties.cluster_id}return Ie}_appendLeaves(Ee,Ie,Qe,ht,Ct){const Mt=this.getChildren(Ie);for(const Bt of Mt){const Et=Bt.properties;if(Et&&Et.cluster?Ct+Et.point_count<=ht?Ct+=Et.point_count:Ct=this._appendLeaves(Ee,Et.cluster_id,Qe,ht,Ct):Ct<ht?Ct++:Ee.push(Bt),Ee.length===Qe)break}return Ct}_createTree(Ee){const Ie=new o.KDBush(Ee.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Qe=0;Qe<Ee.length;Qe+=this.stride)Ie.add(Ee[Qe],Ee[Qe+1]);return Ie.finish(),Ie.data=Ee,Ie}_addTileFeatures(Ee,Ie,Qe,ht,Ct,Mt){for(const Bt of Ee){const Et=Bt*this.stride,Pt=Ie[Et+le]>1;let vn,Bn,Tn;if(Pt)vn=rt(Ie,Et,this.clusterProps),Bn=Ie[Et],Tn=Ie[Et+1];else{const Vr=this.points[Ie[Et+xe]];vn=Vr.properties;const[Ar,Ai]=Vr.geometry.coordinates;Bn=mt(Ar),Tn=ft(Ai)}const kr={type:1,geometry:[[Math.round(this.options.extent*(Bn*Ct-Qe)),Math.round(this.options.extent*(Tn*Ct-ht))]],tags:vn};let Lr;Lr=Pt||this.options.generateId?Ie[Et+xe]:this.points[Ie[Et+xe]].id,Lr!==void 0&&(kr.id=Lr),Mt.features.push(kr)}}_limitZoom(Ee){return Math.max(this.options.minZoom,Math.min(Math.floor(+Ee),this.options.maxZoom+1))}_cluster(Ee,Ie){const{radius:Qe,extent:ht,reduce:Ct,minPoints:Mt}=this.options,Bt=Qe/(ht*Math.pow(2,Ie)),Et=Ee.data,Pt=[],vn=this.stride;for(let Bn=0;Bn<Et.length;Bn+=vn){if(Et[Bn+2]<=Ie)continue;Et[Bn+2]=Ie;const Tn=Et[Bn],kr=Et[Bn+1],Lr=Ee.within(Et[Bn],Et[Bn+1],Bt),Vr=Et[Bn+le];let Ar=Vr;for(const Ai of Lr){const no=Ai*vn;Et[no+2]>Ie&&(Ar+=Et[no+le])}if(Ar>Vr&&Ar>=Mt){let Ai,no=Tn*Vr,yo=kr*Vr,$o=-1;const ro=((Bn/vn|0)<<5)+(Ie+1)+this.points.length;for(const ys of Lr){const io=ys*vn;if(Et[io+2]<=Ie)continue;Et[io+2]=Ie;const Is=Et[io+le];no+=Et[io]*Is,yo+=Et[io+1]*Is,Et[io+4]=ro,Ct&&(Ai||(Ai=this._map(Et,Bn,!0),$o=this.clusterProps.length,this.clusterProps.push(Ai)),Ct(Ai,this._map(Et,io)))}Et[Bn+4]=ro,Pt.push(no/Ar,yo/Ar,1/0,ro,-1,Ar),Ct&&Pt.push($o)}else{for(let Ai=0;Ai<vn;Ai++)Pt.push(Et[Bn+Ai]);if(Ar>1)for(const Ai of Lr){const no=Ai*vn;if(!(Et[no+2]<=Ie)){Et[no+2]=Ie;for(let yo=0;yo<vn;yo++)Pt.push(Et[no+yo])}}}}return Pt}_getOriginId(Ee){return Ee-this.points.length>>5}_getOriginZoom(Ee){return(Ee-this.points.length)%32}_map(Ee,Ie,Qe){if(Ee[Ie+le]>1){const Mt=this.clusterProps[Ee[Ie+De]];return Qe?Object.assign({},Mt):Mt}const ht=this.points[Ee[Ie+xe]].properties,Ct=this.options.map(ht);return Qe&&Ct===ht?Object.assign({},Ct):Ct}}function Ye(ut,Ee,Ie){return{type:"Feature",id:ut[Ee+xe],properties:rt(ut,Ee,Ie),geometry:{type:"Point",coordinates:[(Qe=ut[Ee],360*(Qe-.5)),Dt(ut[Ee+1])]}};var Qe}function rt(ut,Ee,Ie){const Qe=ut[Ee+le],ht=Qe>=1e4?`${Math.round(Qe/1e3)}k`:Qe>=1e3?Math.round(Qe/100)/10+"k":Qe,Ct=ut[Ee+De],Mt=Ct===-1?{}:Object.assign({},Ie[Ct]);return Object.assign(Mt,{cluster:!0,cluster_id:ut[Ee+xe],point_count:Qe,point_count_abbreviated:ht})}function mt(ut){return ut/360+.5}function ft(ut){const Ee=Math.sin(ut*Math.PI/180),Ie=.5-.25*Math.log((1+Ee)/(1-Ee))/Math.PI;return Ie<0?0:Ie>1?1:Ie}function Dt(ut){const Ee=(180-360*ut)*Math.PI/180;return 360*Math.atan(Math.exp(Ee))/Math.PI-90}function Yt(ut,Ee,Ie,Qe){for(var ht,Ct=Qe,Mt=Ie-Ee>>1,Bt=Ie-Ee,Et=ut[Ee],Pt=ut[Ee+1],vn=ut[Ie],Bn=ut[Ie+1],Tn=Ee+3;Tn<Ie;Tn+=3){var kr=cn(ut[Tn],ut[Tn+1],Et,Pt,vn,Bn);if(kr>Ct)ht=Tn,Ct=kr;else if(kr===Ct){var Lr=Math.abs(Tn-Mt);Lr<Bt&&(ht=Tn,Bt=Lr)}}Ct>Qe&&(ht-Ee>3&&Yt(ut,Ee,ht,Qe),ut[ht+2]=Ct,Ie-ht>3&&Yt(ut,ht,Ie,Qe))}function cn(ut,Ee,Ie,Qe,ht,Ct){var Mt=ht-Ie,Bt=Ct-Qe;if(Mt!==0||Bt!==0){var Et=((ut-Ie)*Mt+(Ee-Qe)*Bt)/(Mt*Mt+Bt*Bt);Et>1?(Ie=ht,Qe=Ct):Et>0&&(Ie+=Mt*Et,Qe+=Bt*Et)}return(Mt=ut-Ie)*Mt+(Bt=Ee-Qe)*Bt}function gn(ut,Ee,Ie,Qe){var ht={id:ut===void 0?null:ut,type:Ee,geometry:Ie,tags:Qe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return(function(Ct){var Mt=Ct.geometry,Bt=Ct.type;if(Bt==="Point"||Bt==="MultiPoint"||Bt==="LineString")Mn(Ct,Mt);else if(Bt==="Polygon"||Bt==="MultiLineString")for(var Et=0;Et<Mt.length;Et++)Mn(Ct,Mt[Et]);else if(Bt==="MultiPolygon")for(Et=0;Et<Mt.length;Et++)for(var Pt=0;Pt<Mt[Et].length;Pt++)Mn(Ct,Mt[Et][Pt])})(ht),ht}function Mn(ut,Ee){for(var Ie=0;Ie<Ee.length;Ie+=3)ut.minX=Math.min(ut.minX,Ee[Ie]),ut.minY=Math.min(ut.minY,Ee[Ie+1]),ut.maxX=Math.max(ut.maxX,Ee[Ie]),ut.maxY=Math.max(ut.maxY,Ee[Ie+1])}function Gt(ut,Ee,Ie,Qe){if(Ee.geometry){var ht=Ee.geometry.coordinates,Ct=Ee.geometry.type,Mt=Math.pow(Ie.tolerance/((1<<Ie.maxZoom)*Ie.extent),2),Bt=[],Et=Ee.id;if(Ie.promoteId?Et=Ee.properties[Ie.promoteId]:Ie.generateId&&(Et=Qe||0),Ct==="Point")st(ht,Bt);else if(Ct==="MultiPoint")for(var Pt=0;Pt<ht.length;Pt++)st(ht[Pt],Bt);else if(Ct==="LineString")mr(ht,Bt,Mt,!1);else if(Ct==="MultiLineString"){if(Ie.lineMetrics){for(Pt=0;Pt<ht.length;Pt++)mr(ht[Pt],Bt=[],Mt,!1),ut.push(gn(Et,"LineString",Bt,Ee.properties));return}Er(ht,Bt,Mt,!1)}else if(Ct==="Polygon")Er(ht,Bt,Mt,!0);else{if(Ct!=="MultiPolygon"){if(Ct==="GeometryCollection"){for(Pt=0;Pt<Ee.geometry.geometries.length;Pt++)Gt(ut,{id:Et,geometry:Ee.geometry.geometries[Pt],properties:Ee.properties},Ie,Qe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Pt=0;Pt<ht.length;Pt++){var vn=[];Er(ht[Pt],vn,Mt,!0),Bt.push(vn)}}ut.push(gn(Et,Ct,Bt,Ee.properties))}}function st(ut,Ee){Ee.push(Cr(ut[0])),Ee.push(Ln(ut[1])),Ee.push(0)}function mr(ut,Ee,Ie,Qe){for(var ht,Ct,Mt=0,Bt=0;Bt<ut.length;Bt++){var Et=Cr(ut[Bt][0]),Pt=Ln(ut[Bt][1]);Ee.push(Et),Ee.push(Pt),Ee.push(0),Bt>0&&(Mt+=Qe?(ht*Pt-Et*Ct)/2:Math.sqrt(Math.pow(Et-ht,2)+Math.pow(Pt-Ct,2))),ht=Et,Ct=Pt}var vn=Ee.length-3;Ee[2]=1,Yt(Ee,0,vn,Ie),Ee[vn+2]=1,Ee.size=Math.abs(Mt),Ee.start=0,Ee.end=Ee.size}function Er(ut,Ee,Ie,Qe){for(var ht=0;ht<ut.length;ht++){var Ct=[];mr(ut[ht],Ct,Ie,Qe),Ee.push(Ct)}}function Cr(ut){return ut/360+.5}function Ln(ut){var Ee=Math.sin(ut*Math.PI/180),Ie=.5-.25*Math.log((1+Ee)/(1-Ee))/Math.PI;return Ie<0?0:Ie>1?1:Ie}function ir(ut,Ee,Ie,Qe,ht,Ct,Mt,Bt){if(Qe/=Ee,Ct>=(Ie/=Ee)&&Mt<Qe)return ut;if(Mt<Ie||Ct>=Qe)return null;for(var Et=[],Pt=0;Pt<ut.length;Pt++){var vn=ut[Pt],Bn=vn.geometry,Tn=vn.type,kr=ht===0?vn.minX:vn.minY,Lr=ht===0?vn.maxX:vn.maxY;if(kr>=Ie&&Lr<Qe)Et.push(vn);else if(!(Lr<Ie||kr>=Qe)){var Vr=[];if(Tn==="Point"||Tn==="MultiPoint")er(Bn,Vr,Ie,Qe,ht);else if(Tn==="LineString")Yr(Bn,Vr,Ie,Qe,ht,!1,Bt.lineMetrics);else if(Tn==="MultiLineString")Pn(Bn,Vr,Ie,Qe,ht,!1);else if(Tn==="Polygon")Pn(Bn,Vr,Ie,Qe,ht,!0);else if(Tn==="MultiPolygon")for(var Ar=0;Ar<Bn.length;Ar++){var Ai=[];Pn(Bn[Ar],Ai,Ie,Qe,ht,!0),Ai.length&&Vr.push(Ai)}if(Vr.length){if(Bt.lineMetrics&&Tn==="LineString"){for(Ar=0;Ar<Vr.length;Ar++)Et.push(gn(vn.id,Tn,Vr[Ar],vn.tags));continue}Tn!=="LineString"&&Tn!=="MultiLineString"||(Vr.length===1?(Tn="LineString",Vr=Vr[0]):Tn="MultiLineString"),Tn!=="Point"&&Tn!=="MultiPoint"||(Tn=Vr.length===3?"Point":"MultiPoint"),Et.push(gn(vn.id,Tn,Vr,vn.tags))}}}return Et.length?Et:null}function er(ut,Ee,Ie,Qe,ht){for(var Ct=0;Ct<ut.length;Ct+=3){var Mt=ut[Ct+ht];Mt>=Ie&&Mt<=Qe&&(Ee.push(ut[Ct]),Ee.push(ut[Ct+1]),Ee.push(ut[Ct+2]))}}function Yr(ut,Ee,Ie,Qe,ht,Ct,Mt){for(var Bt,Et,Pt=Vt(ut),vn=ht===0?Dn:Mr,Bn=ut.start,Tn=0;Tn<ut.length-3;Tn+=3){var kr=ut[Tn],Lr=ut[Tn+1],Vr=ut[Tn+2],Ar=ut[Tn+3],Ai=ut[Tn+4],no=ht===0?kr:Lr,yo=ht===0?Ar:Ai,$o=!1;Mt&&(Bt=Math.sqrt(Math.pow(kr-Ar,2)+Math.pow(Lr-Ai,2))),no<Ie?yo>Ie&&(Et=vn(Pt,kr,Lr,Ar,Ai,Ie),Mt&&(Pt.start=Bn+Bt*Et)):no>Qe?yo<Qe&&(Et=vn(Pt,kr,Lr,Ar,Ai,Qe),Mt&&(Pt.start=Bn+Bt*Et)):Gn(Pt,kr,Lr,Vr),yo<Ie&&no>=Ie&&(Et=vn(Pt,kr,Lr,Ar,Ai,Ie),$o=!0),yo>Qe&&no<=Qe&&(Et=vn(Pt,kr,Lr,Ar,Ai,Qe),$o=!0),!Ct&&$o&&(Mt&&(Pt.end=Bn+Bt*Et),Ee.push(Pt),Pt=Vt(ut)),Mt&&(Bn+=Bt)}var ro=ut.length-3;kr=ut[ro],Lr=ut[ro+1],Vr=ut[ro+2],(no=ht===0?kr:Lr)>=Ie&&no<=Qe&&Gn(Pt,kr,Lr,Vr),ro=Pt.length-3,Ct&&ro>=3&&(Pt[ro]!==Pt[0]||Pt[ro+1]!==Pt[1])&&Gn(Pt,Pt[0],Pt[1],Pt[2]),Pt.length&&Ee.push(Pt)}function Vt(ut){var Ee=[];return Ee.size=ut.size,Ee.start=ut.start,Ee.end=ut.end,Ee}function Pn(ut,Ee,Ie,Qe,ht,Ct){for(var Mt=0;Mt<ut.length;Mt++)Yr(ut[Mt],Ee,Ie,Qe,ht,Ct,!1)}function Gn(ut,Ee,Ie,Qe){ut.push(Ee),ut.push(Ie),ut.push(Qe)}function Dn(ut,Ee,Ie,Qe,ht,Ct){var Mt=(Ct-Ee)/(Qe-Ee);return ut.push(Ct),ut.push(Ie+(ht-Ie)*Mt),ut.push(1),Mt}function Mr(ut,Ee,Ie,Qe,ht,Ct){var Mt=(Ct-Ie)/(ht-Ie);return ut.push(Ee+(Qe-Ee)*Mt),ut.push(Ct),ut.push(1),Mt}function wr(ut,Ee){for(var Ie=[],Qe=0;Qe<ut.length;Qe++){var ht,Ct=ut[Qe],Mt=Ct.type;if(Mt==="Point"||Mt==="MultiPoint"||Mt==="LineString")ht=Tr(Ct.geometry,Ee);else if(Mt==="MultiLineString"||Mt==="Polygon"){ht=[];for(var Bt=0;Bt<Ct.geometry.length;Bt++)ht.push(Tr(Ct.geometry[Bt],Ee))}else if(Mt==="MultiPolygon")for(ht=[],Bt=0;Bt<Ct.geometry.length;Bt++){for(var Et=[],Pt=0;Pt<Ct.geometry[Bt].length;Pt++)Et.push(Tr(Ct.geometry[Bt][Pt],Ee));ht.push(Et)}Ie.push(gn(Ct.id,Mt,ht,Ct.tags))}return Ie}function Tr(ut,Ee){var Ie=[];Ie.size=ut.size,ut.start!==void 0&&(Ie.start=ut.start,Ie.end=ut.end);for(var Qe=0;Qe<ut.length;Qe+=3)Ie.push(ut[Qe]+Ee,ut[Qe+1],ut[Qe+2]);return Ie}function Ir(ut,Ee){if(ut.transformed)return ut;var Ie,Qe,ht,Ct=1<<ut.z,Mt=ut.x,Bt=ut.y;for(Ie=0;Ie<ut.features.length;Ie++){var Et=ut.features[Ie],Pt=Et.geometry,vn=Et.type;if(Et.geometry=[],vn===1)for(Qe=0;Qe<Pt.length;Qe+=2)Et.geometry.push(Pr(Pt[Qe],Pt[Qe+1],Ee,Ct,Mt,Bt));else for(Qe=0;Qe<Pt.length;Qe++){var Bn=[];for(ht=0;ht<Pt[Qe].length;ht+=2)Bn.push(Pr(Pt[Qe][ht],Pt[Qe][ht+1],Ee,Ct,Mt,Bt));Et.geometry.push(Bn)}}return ut.transformed=!0,ut}function Pr(ut,Ee,Ie,Qe,ht,Ct){return[Math.round(Ie*(ut*Qe-ht)),Math.round(Ie*(Ee*Qe-Ct))]}function Ei(ut,Ee,Ie,Qe,ht){for(var Ct=Ee===ht.maxZoom?0:ht.tolerance/((1<<Ee)*ht.extent),Mt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Ie,y:Qe,z:Ee,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Bt=0;Bt<ut.length;Bt++){Mt.numFeatures++,Pi(Mt,ut[Bt],Ct,ht);var Et=ut[Bt].minX,Pt=ut[Bt].minY,vn=ut[Bt].maxX,Bn=ut[Bt].maxY;Et<Mt.minX&&(Mt.minX=Et),Pt<Mt.minY&&(Mt.minY=Pt),vn>Mt.maxX&&(Mt.maxX=vn),Bn>Mt.maxY&&(Mt.maxY=Bn)}return Mt}function Pi(ut,Ee,Ie,Qe){var ht=Ee.geometry,Ct=Ee.type,Mt=[];if(Ct==="Point"||Ct==="MultiPoint")for(var Bt=0;Bt<ht.length;Bt+=3)Mt.push(ht[Bt]),Mt.push(ht[Bt+1]),ut.numPoints++,ut.numSimplified++;else if(Ct==="LineString")or(Mt,ht,ut,Ie,!1,!1);else if(Ct==="MultiLineString"||Ct==="Polygon")for(Bt=0;Bt<ht.length;Bt++)or(Mt,ht[Bt],ut,Ie,Ct==="Polygon",Bt===0);else if(Ct==="MultiPolygon")for(var Et=0;Et<ht.length;Et++){var Pt=ht[Et];for(Bt=0;Bt<Pt.length;Bt++)or(Mt,Pt[Bt],ut,Ie,!0,Bt===0)}if(Mt.length){var vn=Ee.tags||null;if(Ct==="LineString"&&Qe.lineMetrics){for(var Bn in vn={},Ee.tags)vn[Bn]=Ee.tags[Bn];vn.mapbox_clip_start=ht.start/ht.size,vn.mapbox_clip_end=ht.end/ht.size}var Tn={geometry:Mt,type:Ct==="Polygon"||Ct==="MultiPolygon"?3:Ct==="LineString"||Ct==="MultiLineString"?2:1,tags:vn};Ee.id!==null&&(Tn.id=Ee.id),ut.features.push(Tn)}}function or(ut,Ee,Ie,Qe,ht,Ct){var Mt=Qe*Qe;if(Qe>0&&Ee.size<(ht?Mt:Qe))Ie.numPoints+=Ee.length/3;else{for(var Bt=[],Et=0;Et<Ee.length;Et+=3)(Qe===0||Ee[Et+2]>Mt)&&(Ie.numSimplified++,Bt.push(Ee[Et]),Bt.push(Ee[Et+1])),Ie.numPoints++;ht&&(function(Pt,vn){for(var Bn=0,Tn=0,kr=Pt.length,Lr=kr-2;Tn<kr;Lr=Tn,Tn+=2)Bn+=(Pt[Tn]-Pt[Lr])*(Pt[Tn+1]+Pt[Lr+1]);if(Bn>0===vn)for(Tn=0,kr=Pt.length;Tn<kr/2;Tn+=2){var Vr=Pt[Tn],Ar=Pt[Tn+1];Pt[Tn]=Pt[kr-2-Tn],Pt[Tn+1]=Pt[kr-1-Tn],Pt[kr-2-Tn]=Vr,Pt[kr-1-Tn]=Ar}})(Bt,Ct),ut.push(Bt)}}function oi(ut,Ee){var Ie=(Ee=this.options=(function(ht,Ct){for(var Mt in Ct)ht[Mt]=Ct[Mt];return ht})(Object.create(this.options),Ee)).debug;if(Ie&&console.time("preprocess data"),Ee.maxZoom<0||Ee.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Ee.promoteId&&Ee.generateId)throw new Error("promoteId and generateId cannot be used together.");var Qe=(function(ht,Ct){var Mt=[];if(ht.type==="FeatureCollection")for(var Bt=0;Bt<ht.features.length;Bt++)Gt(Mt,ht.features[Bt],Ct,Bt);else Gt(Mt,ht.type==="Feature"?ht:{geometry:ht},Ct);return Mt})(ut,Ee);this.tiles={},this.tileCoords=[],Ie&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Ee.indexMaxZoom,Ee.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Qe=(function(ht,Ct){var Mt=Ct.buffer/Ct.extent,Bt=ht,Et=ir(ht,1,-1-Mt,Mt,0,-1,2,Ct),Pt=ir(ht,1,1-Mt,2+Mt,0,-1,2,Ct);return(Et||Pt)&&(Bt=ir(ht,1,-Mt,1+Mt,0,-1,2,Ct)||[],Et&&(Bt=wr(Et,1).concat(Bt)),Pt&&(Bt=Bt.concat(wr(Pt,-1)))),Bt})(Qe,Ee),Qe.length&&this.splitTile(Qe,0,0,0),Ie&&(Qe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Kr(ut,Ee,Ie){return 32*((1<<ut)*Ie+Ee)+ut}function Br(ut,Ee){const Ie=ut.tileID.canonical;if(!this._geoJSONIndex)return Ee(null,null);const Qe=this._geoJSONIndex.getTile(Ie.z,Ie.x,Ie.y);if(!Qe)return Ee(null,null);const ht=new class{constructor(Mt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=Mt.length,this._features=Mt}feature(Mt){return new class{constructor(Bt){this._feature=Bt,this.extent=o.EXTENT,this.type=Bt.type,this.properties=Bt.tags,"id"in Bt&&!isNaN(Bt.id)&&(this.id=parseInt(Bt.id,10))}loadGeometry(){if(this._feature.type===1){const Bt=[];for(const Et of this._feature.geometry)Bt.push([new o.Point(Et[0],Et[1])]);return Bt}{const Bt=[];for(const Et of this._feature.geometry){const Pt=[];for(const vn of Et)Pt.push(new o.Point(vn[0],vn[1]));Bt.push(Pt)}return Bt}}toGeoJSON(Bt,Et,Pt){return fe.call(this,Bt,Et,Pt)}}(this._features[Mt])}}(Qe.features);let Ct=Ne(ht);Ct.byteOffset===0&&Ct.byteLength===Ct.buffer.byteLength||(Ct=new Uint8Array(Ct)),Ee(null,{vectorTile:ht,rawData:Ct.buffer})}oi.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},oi.prototype.splitTile=function(ut,Ee,Ie,Qe,ht,Ct,Mt){for(var Bt=[ut,Ee,Ie,Qe],Et=this.options,Pt=Et.debug;Bt.length;){Qe=Bt.pop(),Ie=Bt.pop(),Ee=Bt.pop(),ut=Bt.pop();var vn=1<<Ee,Bn=Kr(Ee,Ie,Qe),Tn=this.tiles[Bn];if(!Tn&&(Pt>1&&console.time("creation"),Tn=this.tiles[Bn]=Ei(ut,Ee,Ie,Qe,Et),this.tileCoords.push({z:Ee,x:Ie,y:Qe}),Pt)){Pt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Ee,Ie,Qe,Tn.numFeatures,Tn.numPoints,Tn.numSimplified),console.timeEnd("creation"));var kr="z"+Ee;this.stats[kr]=(this.stats[kr]||0)+1,this.total++}if(Tn.source=ut,ht){if(Ee===Et.maxZoom||Ee===ht)continue;var Lr=1<<ht-Ee;if(Ie!==Math.floor(Ct/Lr)||Qe!==Math.floor(Mt/Lr))continue}else if(Ee===Et.indexMaxZoom||Tn.numPoints<=Et.indexMaxPoints)continue;if(Tn.source=null,ut.length!==0){Pt>1&&console.time("clipping");var Vr,Ar,Ai,no,yo,$o,ro=.5*Et.buffer/Et.extent,ys=.5-ro,io=.5+ro,Is=1+ro;Vr=Ar=Ai=no=null,yo=ir(ut,vn,Ie-ro,Ie+io,0,Tn.minX,Tn.maxX,Et),$o=ir(ut,vn,Ie+ys,Ie+Is,0,Tn.minX,Tn.maxX,Et),ut=null,yo&&(Vr=ir(yo,vn,Qe-ro,Qe+io,1,Tn.minY,Tn.maxY,Et),Ar=ir(yo,vn,Qe+ys,Qe+Is,1,Tn.minY,Tn.maxY,Et),yo=null),$o&&(Ai=ir($o,vn,Qe-ro,Qe+io,1,Tn.minY,Tn.maxY,Et),no=ir($o,vn,Qe+ys,Qe+Is,1,Tn.minY,Tn.maxY,Et),$o=null),Pt>1&&console.timeEnd("clipping"),Bt.push(Vr||[],Ee+1,2*Ie,2*Qe),Bt.push(Ar||[],Ee+1,2*Ie,2*Qe+1),Bt.push(Ai||[],Ee+1,2*Ie+1,2*Qe),Bt.push(no||[],Ee+1,2*Ie+1,2*Qe+1)}}},oi.prototype.getTile=function(ut,Ee,Ie){var Qe=this.options,ht=Qe.extent,Ct=Qe.debug;if(ut<0||ut>24)return null;var Mt=1<<ut,Bt=Kr(ut,Ee=(Ee%Mt+Mt)%Mt,Ie);if(this.tiles[Bt])return Ir(this.tiles[Bt],ht);Ct>1&&console.log("drilling down to z%d-%d-%d",ut,Ee,Ie);for(var Et,Pt=ut,vn=Ee,Bn=Ie;!Et&&Pt>0;)Pt--,vn=Math.floor(vn/2),Bn=Math.floor(Bn/2),Et=this.tiles[Kr(Pt,vn,Bn)];return Et&&Et.source?(Ct>1&&console.log("found parent tile z%d-%d-%d",Pt,vn,Bn),Ct>1&&console.time("drilling down"),this.splitTile(Et.source,Pt,vn,Bn,ut,Ee,Ie),Ct>1&&console.timeEnd("drilling down"),this.tiles[Bt]?Ir(this.tiles[Bt],ht):null):null};class di extends o.VectorTileWorkerSource{constructor(Ee,Ie,Qe,ht,Ct){super(Ee,Ie,Qe,ht,Br),Ct&&(this.loadGeoJSON=Ct)}loadData(Ee,Ie){const Qe=Ee&&Ee.request,ht=Qe&&Qe.collectResourceTiming;this.loadGeoJSON(Ee,((Ct,Mt)=>{if(Ct||!Mt)return Ie(Ct);if(typeof Mt!="object")return Ie(new Error(`Input data given to '${Ee.source}' is not a valid GeoJSON object.`));{se(Mt,!0);try{if(Ee.filter){const Et=o.createExpression(Ee.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Et.result==="error")throw new Error(Et.value.map((vn=>`${vn.key}: ${vn.message}`)).join(", "));Mt={type:"FeatureCollection",features:Mt.features.filter((vn=>Et.value.evaluate({zoom:0},vn)))}}this._geoJSONIndex=Ee.cluster?new Be((function({superclusterOptions:Et,clusterProperties:Pt}){if(!Pt||!Et)return Et;const vn={},Bn={},Tn={accumulated:null,zoom:0},kr={properties:null},Lr=Object.keys(Pt);for(const Vr of Lr){const[Ar,Ai]=Pt[Vr],no=o.createExpression(Ai),yo=o.createExpression(typeof Ar=="string"?[Ar,["accumulated"],["get",Vr]]:Ar);vn[Vr]=no.value,Bn[Vr]=yo.value}return Et.map=Vr=>{kr.properties=Vr;const Ar={};for(const Ai of Lr)Ar[Ai]=vn[Ai].evaluate(Tn,kr);return Ar},Et.reduce=(Vr,Ar)=>{kr.properties=Ar;for(const Ai of Lr)Tn.accumulated=Vr[Ai],Vr[Ai]=Bn[Ai].evaluate(Tn,kr)},Et})(Ee)).load(Mt.features):(function(Et,Pt){return new oi(Et,Pt)})(Mt,Ee.geojsonVtOptions)}catch(Et){return Ie(Et)}this.loaded={};const Bt={};if(ht){const Et=o.getPerformanceMeasurement(Qe);Et&&(Bt.resourceTiming={},Bt.resourceTiming[Ee.source]=JSON.parse(JSON.stringify(Et)))}Ie(null,Bt)}}))}reloadTile(Ee,Ie){const Qe=this.loaded;return Qe&&Qe[Ee.uid]?super.reloadTile(Ee,Ie):this.loadTile(Ee,Ie)}loadGeoJSON(Ee,Ie){if(Ee.request)o.getJSON(Ee.request,Ie);else{if(typeof Ee.data!="string")return Ie(new Error(`Input data given to '${Ee.source}' is not a valid GeoJSON object.`));try{return Ie(null,JSON.parse(Ee.data))}catch{return Ie(new Error(`Input data given to '${Ee.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Ee,Ie){try{Ie(null,this._geoJSONIndex.getClusterExpansionZoom(Ee.clusterId))}catch(Qe){Ie(Qe)}}getClusterChildren(Ee,Ie){try{Ie(null,this._geoJSONIndex.getChildren(Ee.clusterId))}catch(Qe){Ie(Qe)}}getClusterLeaves(Ee,Ie){try{Ie(null,this._geoJSONIndex.getLeaves(Ee.clusterId,Ee.limit,Ee.offset))}catch(Qe){Ie(Qe)}}}class si{constructor(Ee){this.self=Ee,this.actor=new o.Actor(Ee,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.getProjection({name:"mercator"}),this.workerSourceTypes={vector:o.VectorTileWorkerSource,geojson:di},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Ie,Qe)=>{if(this.workerSourceTypes[Ie])throw new Error(`Worker source with name "${Ie}" already registered.`);this.workerSourceTypes[Ie]=Qe},this.self.registerRTLTextPlugin=Ie=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=Ie.applyArabicShaping,o.plugin.processBidirectionalText=Ie.processBidirectionalText,o.plugin.processStyledBidirectionalText=Ie.processStyledBidirectionalText}}clearCaches(Ee,Ie,Qe){delete this.layerIndexes[Ee],delete this.availableImages[Ee],delete this.workerSources[Ee],delete this.demWorkerSources[Ee],Qe()}checkIfReady(Ee,Ie,Qe){Qe()}setReferrer(Ee,Ie){this.referrer=Ie}spriteLoaded(Ee,Ie){this.isSpriteLoaded[Ee]=Ie;for(const Qe in this.workerSources[Ee]){const ht=this.workerSources[Ee][Qe];for(const Ct in ht)ht[Ct]instanceof o.VectorTileWorkerSource&&(ht[Ct].isSpriteLoaded=Ie,ht[Ct].fire(new o.Event("isSpriteLoaded")))}}setImages(Ee,Ie,Qe){this.availableImages[Ee]=Ie;for(const ht in this.workerSources[Ee]){const Ct=this.workerSources[Ee][ht];for(const Mt in Ct)Ct[Mt].availableImages=Ie}Qe()}enableTerrain(Ee,Ie,Qe){this.terrain=Ie,Qe()}setProjection(Ee,Ie){this.projections[Ee]=o.getProjection(Ie)}setLayers(Ee,Ie,Qe){this.getLayerIndex(Ee).replace(Ie),Qe()}updateLayers(Ee,Ie,Qe){this.getLayerIndex(Ee).update(Ie.layers,Ie.removedIds),Qe()}loadTile(Ee,Ie,Qe){const ht=this.enableTerrain?o.extend({enableTerrain:this.terrain},Ie):Ie;ht.projection=this.projections[Ee]||this.defaultProjection,this.getWorkerSource(Ee,Ie.type,Ie.source).loadTile(ht,Qe)}loadDEMTile(Ee,Ie,Qe){const ht=this.enableTerrain?o.extend({buildQuadTree:this.terrain},Ie):Ie;this.getDEMWorkerSource(Ee,Ie.source).loadTile(ht,Qe)}reloadTile(Ee,Ie,Qe){const ht=this.enableTerrain?o.extend({enableTerrain:this.terrain},Ie):Ie;ht.projection=this.projections[Ee]||this.defaultProjection,this.getWorkerSource(Ee,Ie.type,Ie.source).reloadTile(ht,Qe)}abortTile(Ee,Ie,Qe){this.getWorkerSource(Ee,Ie.type,Ie.source).abortTile(Ie,Qe)}removeTile(Ee,Ie,Qe){this.getWorkerSource(Ee,Ie.type,Ie.source).removeTile(Ie,Qe)}removeSource(Ee,Ie,Qe){if(!this.workerSources[Ee]||!this.workerSources[Ee][Ie.type]||!this.workerSources[Ee][Ie.type][Ie.source])return;const ht=this.workerSources[Ee][Ie.type][Ie.source];delete this.workerSources[Ee][Ie.type][Ie.source],ht.removeSource!==void 0?ht.removeSource(Ie,Qe):Qe()}loadWorkerSource(Ee,Ie,Qe){try{this.self.importScripts(Ie.url),Qe()}catch(ht){Qe(ht.toString())}}syncRTLPluginState(Ee,Ie,Qe){try{o.plugin.setState(Ie);const ht=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&ht!=null){this.self.importScripts(ht);const Ct=o.plugin.isParsed();Qe(Ct?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ht}`),Ct)}}catch(ht){Qe(ht.toString())}}getAvailableImages(Ee){let Ie=this.availableImages[Ee];return Ie||(Ie=[]),Ie}getLayerIndex(Ee){let Ie=this.layerIndexes[Ee];return Ie||(Ie=this.layerIndexes[Ee]=new M),Ie}getWorkerSource(Ee,Ie,Qe){if(this.workerSources[Ee]||(this.workerSources[Ee]={}),this.workerSources[Ee][Ie]||(this.workerSources[Ee][Ie]={}),!this.workerSources[Ee][Ie][Qe]){const ht={send:(Ct,Mt,Bt,Et,Pt,vn)=>{this.actor.send(Ct,Mt,Bt,Ee,Pt,vn)},scheduler:this.actor.scheduler};this.workerSources[Ee][Ie][Qe]=new this.workerSourceTypes[Ie](ht,this.getLayerIndex(Ee),this.getAvailableImages(Ee),this.isSpriteLoaded[Ee])}return this.workerSources[Ee][Ie][Qe]}getDEMWorkerSource(Ee,Ie){return this.demWorkerSources[Ee]||(this.demWorkerSources[Ee]={}),this.demWorkerSources[Ee][Ie]||(this.demWorkerSources[Ee][Ie]=new V),this.demWorkerSources[Ee][Ie]}enforceCacheSizeLimit(Ee,Ie){o.enforceCacheSizeLimit(Ie)}getWorkerPerformanceMetrics(Ee,Ie,Qe){Qe(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new si(self)),si})),m(["./shared"],(function(o){function b(y,a){if(Array.isArray(y)){if(!Array.isArray(a)||y.length!==a.length)return!1;for(let f=0;f<y.length;f++)if(!b(y[f],a[f]))return!1;return!0}if(typeof y=="object"&&y!==null&&a!==null){if(typeof a!="object"||Object.keys(y).length!==Object.keys(a).length)return!1;for(const f in y)if(!b(y[f],a[f]))return!1;return!0}return y===a}var I=M;function M(y){return!(function(a){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var v,S,T=new Blob([""],{type:"text/javascript"}),N=URL.createObjectURL(T);try{S=new Worker(N),v=!0}catch{v=!1}return S&&S.terminate(),URL.revokeObjectURL(N),v})()?"Uint8ClampedArray"in window?ArrayBuffer.isView?(function(){var v=document.createElement("canvas");v.width=v.height=1;var S=v.getContext("2d");if(!S)return!1;var T=S.getImageData(0,0,1,1);return T&&T.width===v.width})()?(V[f=a&&a.failIfMajorPerformanceCaveat]===void 0&&(V[f]=(function(v){var S,T=(function(N){var z=document.createElement("canvas"),G=Object.create(M.webGLContextAttributes);return G.failIfMajorPerformanceCaveat=N,z.getContext("webgl",G)||z.getContext("experimental-webgl",G)})(v);if(!T)return!1;try{S=T.createShader(T.VERTEX_SHADER)}catch{return!1}return!(!S||T.isContextLost())&&(T.shaderSource(S,"void main() {}"),T.compileShader(S),T.getShaderParameter(S,T.COMPILE_STATUS)===!0)})(f)),V[f]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var f})(y)}var V={};function k(y,a,f){const v=o.window.document.createElement(y);return a!==void 0&&(v.className=a),f&&f.appendChild(v),v}function ie(y,a,f){const v=o.window.document.createElementNS("http://www.w3.org/2000/svg",y);for(const S of Object.keys(a))v.setAttributeNS(null,S,a[S]);return f&&f.appendChild(v),v}M.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const se=o.window.document&&o.window.document.documentElement.style,fe=se&&se.userSelect!==void 0?"userSelect":"WebkitUserSelect";let J;function ne(){se&&fe&&(J=se[fe],se[fe]="none")}function me(){se&&fe&&(se[fe]=J)}function ue(y){y.preventDefault(),y.stopPropagation(),o.window.removeEventListener("click",ue,!0)}function ke(){o.window.addEventListener("click",ue,!0),o.window.setTimeout((()=>{o.window.removeEventListener("click",ue,!0)}),0)}function je(y,a){const f=y.getBoundingClientRect();return F(y,f,a)}function pe(y,a){const f=y.getBoundingClientRect(),v=[];for(let S=0;S<a.length;S++)v.push(F(y,f,a[S]));return v}function U(y){return o.window.InstallTrigger!==void 0&&y.button===2&&y.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:y.button}function F(y,a,f){const v=y.offsetWidth===a.width?1:y.offsetWidth/a.width;return new o.Point((f.clientX-a.left)*v,(f.clientY-a.top)*v)}function q(y,a){var f=a[0],v=a[1],S=a[2],T=a[3],N=f*T-S*v;return N?(y[0]=T*(N=1/N),y[1]=-v*N,y[2]=-S*N,y[3]=f*N,y):null}function j(y){const{userImage:a}=y;return!!(a&&a.render&&a.render())&&(y.data.replace(new Uint8Array(a.data.buffer)),!0)}class H extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(a){if(this.loaded!==a&&(this.loaded=a,a)){for(const{ids:f,callback:v}of this.requestors)this._notify(f,v);this.requestors=[]}}hasImage(a){return!!this.getImage(a)}getImage(a){return this.images[a]}addImage(a,f){this._validate(a,f)&&(this.images[a]=f)}_validate(a,f){let v=!0;return this._validateStretch(f.stretchX,f.data&&f.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${a}" has invalid "stretchX" value`))),v=!1),this._validateStretch(f.stretchY,f.data&&f.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${a}" has invalid "stretchY" value`))),v=!1),this._validateContent(f.content,f)||(this.fire(new o.ErrorEvent(new Error(`Image "${a}" has invalid "content" value`))),v=!1),v}_validateStretch(a,f){if(!a)return!0;let v=0;for(const S of a){if(S[0]<v||S[1]<S[0]||f<S[1])return!1;v=S[1]}return!0}_validateContent(a,f){return!(a&&(a.length!==4||a[0]<0||f.data.width<a[0]||a[1]<0||f.data.height<a[1]||a[2]<0||f.data.width<a[2]||a[3]<0||f.data.height<a[3]||a[2]<a[0]||a[3]<a[1]))}updateImage(a,f){f.version=this.images[a].version+1,this.images[a]=f,this.updatedImages[a]=!0}removeImage(a){const f=this.images[a];delete this.images[a],delete this.patterns[a],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(a,f){let v=!0;if(!this.isLoaded())for(const S of a)this.images[S]||(v=!1);this.isLoaded()||v?this._notify(a,f):this.requestors.push({ids:a,callback:f})}_notify(a,f){const v={};for(const S of a){this.images[S]||this.fire(new o.Event("styleimagemissing",{id:S}));const T=this.images[S];T?v[S]={data:T.data.clone(),pixelRatio:T.pixelRatio,sdf:T.sdf,version:T.version,stretchX:T.stretchX,stretchY:T.stretchY,content:T.content,hasRenderCallback:!!(T.userImage&&T.userImage.render)}:o.warnOnce(`Image "${S}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}f(null,v)}getPixelSize(){const{width:a,height:f}=this.atlasImage;return{width:a,height:f}}getPattern(a){const f=this.patterns[a],v=this.getImage(a);if(!v)return null;if(f&&f.position.version===v.version)return f.position;if(f)f.position.version=v.version;else{const S={w:v.data.width+2,h:v.data.height+2,x:0,y:0},T=new o.ImagePosition(S,v);this.patterns[a]={bin:S,position:T}}return this._updatePatternAtlas(),this.patterns[a].position}bind(a){const f=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(a,this.atlasImage,f.RGBA),this.atlasTexture&&this.atlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(){const a=[];for(const T in this.patterns)a.push(this.patterns[T].bin);const{w:f,h:v}=o.potpack(a),S=this.atlasImage;S.resize({width:f||1,height:v||1});for(const T in this.patterns){const{bin:N}=this.patterns[T],z=N.x+1,G=N.y+1,ee=this.images[T].data,te=ee.width,ge=ee.height;o.RGBAImage.copy(ee,S,{x:0,y:0},{x:z,y:G},{width:te,height:ge}),o.RGBAImage.copy(ee,S,{x:0,y:ge-1},{x:z,y:G-1},{width:te,height:1}),o.RGBAImage.copy(ee,S,{x:0,y:0},{x:z,y:G+ge},{width:te,height:1}),o.RGBAImage.copy(ee,S,{x:te-1,y:0},{x:z-1,y:G},{width:1,height:ge}),o.RGBAImage.copy(ee,S,{x:0,y:0},{x:z+te,y:G},{width:1,height:ge})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(a){for(const f of a){if(this.callbackDispatchedThisFrame[f])continue;this.callbackDispatchedThisFrame[f]=!0;const v=this.images[f];j(v)&&this.updateImage(f,v)}}}const Z=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(y,a){return(function([f,v,S]){const T=o.degToRad(v+90),N=o.degToRad(S);return{x:f*Math.cos(T)*Math.sin(N),y:f*Math.sin(T)*Math.sin(N),z:f*Math.cos(N),azimuthal:v,polar:S}})(y.expression.evaluate(a))}interpolate(y,a,f){return{x:o.number(y.x,a.x,f),y:o.number(y.y,a.y,f),z:o.number(y.z,a.z,f),azimuthal:o.number(y.azimuthal,a.azimuthal,f),polar:o.number(y.polar,a.polar,f)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)});class be extends o.Evented{constructor(a){super(),this._transitionable=new o.Transitionable(Z),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a,f={}){if(!this._validate(o.validateLight,a,f))for(const v in a){const S=a[v];o.endsWith(v,"-transition")?this._transitionable.setTransition(v.slice(0,-11),S):this._transitionable.setValue(v,S)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,f,v){return(!v||v.validate!==!1)&&o.emitValidationErrors(this,a.call(o.validateStyle,o.extend({value:f,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}const Re=new o.Properties({source:new o.DataConstantProperty(o.spec.terrain.source),exaggeration:new o.DataConstantProperty(o.spec.terrain.exaggeration)});let Oe=class extends o.Evented{constructor(y,a){super(),this._transitionable=new o.Transitionable(Re),this.set(y),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=a}get(){return this._transitionable.serialize()}set(y){for(const a in y){const f=y[a];o.endsWith(a,"-transition")?this._transitionable.setTransition(a.slice(0,-11),f):this._transitionable.setValue(a,f)}}updateTransitions(y){this._transitioning=this._transitionable.transitioned(y,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(y){this.properties=this._transitioning.possiblyEvaluate(y)}};function Ne(y,a,f,v){const S=o.smoothstep(45,65,f),[T,N]=we(y,v),z=o.length(a);let G=1-Math.min(1,Math.exp((z-T)/(N-T)*-6));return G*=G*G,G=Math.min(1,1.00747*G),G*S*y.alpha}function we(y,a){const f=.5/Math.tan(.5*a);return[y.range[0]+f,y.range[1]+f]}const Fe=new o.Properties({range:new o.DataConstantProperty(o.spec.fog.range),color:new o.DataConstantProperty(o.spec.fog.color),"high-color":new o.DataConstantProperty(o.spec.fog["high-color"]),"space-color":new o.DataConstantProperty(o.spec.fog["space-color"]),"horizon-blend":new o.DataConstantProperty(o.spec.fog["horizon-blend"]),"star-intensity":new o.DataConstantProperty(o.spec.fog["star-intensity"])});class nt extends o.Evented{constructor(a,f){super(),this._transitionable=new o.Transitionable(Fe),this.set(a),this._transitioning=this._transitionable.untransitioned(),this._transform=f}get state(){const a=this._transform,f=a.projection.name==="globe",v=o.globeToMercatorTransition(a.zoom),S=this.properties.get("range"),T=[.5,3];return{range:f?[o.number(T[0],S[0],v),o.number(T[1],S[1],v)]:S,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(a,f={}){if(!this._validate(o.validateFog,a,f)){for(const v of Object.keys(o.spec.fog))a&&a[v]===void 0&&(a[v]=o.spec.fog[v].default);for(const v in a){const S=a[v];o.endsWith(v,"-transition")?this._transitionable.setTransition(v.slice(0,-11),S):this._transitionable.setValue(v,S)}}}getOpacity(a){if(!this._transform.projection.supportsFog)return 0;const f=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.smoothstep(45,65,a))*f.a}getOpacityAtLatLng(a,f){return this._transform.projection.supportsFog?(function(v,S,T){const N=o.MercatorCoordinate.fromLngLat(S),z=T.elevation?T.elevation.getAtPointOrZero(N):0,G=[N.x,N.y,z];return o.transformMat4(G,G,T.mercatorFogMatrix),Ne(v,G,T.pitch,T._fov)})(this.state,a,f):0}getFovAdjustedRange(a){return this._transform.projection.supportsFog?we(this.state,a):[0,1]}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,f,v){return(!v||v.validate!==!1)&&o.emitValidationErrors(this,a.call(o.validateStyle,o.extend({value:f,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class xe{constructor(a,f){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=o.uniqueId();const v=this.workerPool.acquire(this.id);for(let S=0;S<v.length;S++){const T=new xe.Actor(v[S],f,this.id);T.name=`Worker ${S}`,this.actors.push(T)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(a,f,v){o.asyncAll(this.actors,((S,T)=>{S.send(a,f,T)}),v=v||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((a=>{a.remove()})),this.actors=[],this.workerPool.release(this.id)}}function le(y,a,f){return a*(o.EXTENT/(y.tileSize*Math.pow(2,f-y.tileID.overscaledZ)))}xe.Actor=o.Actor;class De{constructor(a,f,v,S){this.screenBounds=a,this.cameraPoint=f,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=v,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,S)}static createFromScreenPoints(a,f){let v,S;if(a instanceof o.Point||typeof a[0]=="number"){const T=o.Point.convert(a);v=[T],S=f.isPointAboveHorizon(T)}else{const T=o.Point.convert(a[0]),N=o.Point.convert(a[1]);v=[T,N],S=o.polygonizeBounds(T,N).every((z=>f.isPointAboveHorizon(z)))}return new De(v,f.getCameraPoint(),S,f)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(a){return o.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],a)}bufferedCameraGeometry(a){const f=this.screenBounds[0],v=this.screenBounds.length===1?this.screenBounds[0].add(new o.Point(1,1)):this.screenBounds[1],S=o.polygonizeBounds(f,v,0,!1);return this.cameraPoint.y>v.y&&(this.cameraPoint.x>f.x&&this.cameraPoint.x<v.x?S.splice(3,0,this.cameraPoint):this.cameraPoint.x>=v.x?S[2]=this.cameraPoint:this.cameraPoint.x<=f.x&&(S[3]=this.cameraPoint)),o.bufferConvexPolygon(S,a)}bufferedCameraGeometryGlobe(a){const f=this.screenBounds[0],v=this.screenBounds.length===1?this.screenBounds[0].add(new o.Point(1,1)):this.screenBounds[1],S=o.polygonizeBounds(f,v,a),T=this.cameraPoint.clone();switch(3*((T.y>f.y)+(T.y>v.y))+((T.x>f.x)+(T.x>v.x))){case 0:S[0]=T,S[4]=T.clone();break;case 1:S.splice(1,0,T);break;case 2:S[1]=T;break;case 3:S.splice(4,0,T);break;case 5:S.splice(2,0,T);break;case 6:S[3]=T;break;case 7:S.splice(3,0,T);break;case 8:S[2]=T}return S}containsTile(a,f,v,S=0){const T=a.queryPadding/f._pixelsPerMercatorPixel+1,N=v?this._bufferedCameraMercator(T,f):this._bufferedScreenMercator(T,f);let z=a.tileID.wrap+(N.unwrapped?S:0);const G=N.polygon.map((Ze=>o.getTilePoint(a.tileTransform,Ze,z)));if(!o.polygonIntersectsBox(G,0,0,o.EXTENT,o.EXTENT))return;z=a.tileID.wrap+(this.screenGeometryMercator.unwrapped?S:0);const ee=this.screenGeometryMercator.polygon.map((Ze=>o.getTileVec3(a.tileTransform,Ze,z))),te=ee.map((Ze=>new o.Point(Ze[0],Ze[1]))),ge=f.getFreeCameraOptions().position||new o.MercatorCoordinate(0,0,0),Ae=o.getTileVec3(a.tileTransform,ge,z),Le=ee.map((Ze=>{const _e=o.sub(Ze,Ze,Ae);return o.normalize(_e,_e),new o.Ray(Ae,_e)})),Xe=le(a,1,f.zoom)*f._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:te,tilespaceRays:Le,bufferedTilespaceGeometry:G,bufferedTilespaceBounds:(Ue=o.getBounds(G),Ue.min.x=o.clamp(Ue.min.x,0,o.EXTENT),Ue.min.y=o.clamp(Ue.min.y,0,o.EXTENT),Ue.max.x=o.clamp(Ue.max.x,0,o.EXTENT),Ue.max.y=o.clamp(Ue.max.y,0,o.EXTENT),Ue),tile:a,tileID:a.tileID,pixelToTileUnitsFactor:Xe};var Ue}_bufferedScreenMercator(a,f){const v=rt(a);if(this._screenRaycastCache[v])return this._screenRaycastCache[v];{let S;return S=f.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(a),f):{polygon:this.bufferedScreenGeometry(a).map((T=>f.pointCoordinate3D(T))),unwrapped:!0},this._screenRaycastCache[v]=S,S}}_bufferedCameraMercator(a,f){const v=rt(a);if(this._cameraRaycastCache[v])return this._cameraRaycastCache[v];{let S;return S=f.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(a),f):{polygon:this.bufferedCameraGeometry(a).map((T=>f.pointCoordinate3D(T))),unwrapped:!0},this._cameraRaycastCache[v]=S,S}}_projectAndResample(a,f){const v=(function(T,N){const z=o.multiply([],N.pixelMatrix,N.globeMatrix),G=[0,-o.GLOBE_RADIUS,0,1],ee=[0,o.GLOBE_RADIUS,0,1],te=[0,0,0,1];o.transformMat4$1(G,G,z),o.transformMat4$1(ee,ee,z),o.transformMat4$1(te,te,z);const ge=new o.Point(G[0]/G[3],G[1]/G[3]),Ae=new o.Point(ee[0]/ee[3],ee[1]/ee[3]),Le=o.polygonContainsPoint(T,ge)&&G[3]<te[3],Xe=o.polygonContainsPoint(T,Ae)&&ee[3]<te[3];if(!Le&&!Xe)return null;const Ue=(function(vt,Rt,Lt){for(let zt=1;zt<vt.length;zt++){const mn=Ye(Rt.pointCoordinate3D(vt[zt-1]).x),Ut=Ye(Rt.pointCoordinate3D(vt[zt]).x);if(Lt<0){if(mn<Ut)return{idx:zt,t:-mn/(Ut-1-mn)}}else if(Ut<mn)return{idx:zt,t:(1-mn)/(Ut+1-mn)}}return null})(T,N,Le?-1:1);if(!Ue)return null;const{idx:Ze,t:_e}=Ue;let $e=Ze>1?Be(T.slice(0,Ze),N):[],it=Ze<T.length?Be(T.slice(Ze),N):[];$e=$e.map((vt=>new o.Point(Ye(vt.x),vt.y))),it=it.map((vt=>new o.Point(Ye(vt.x),vt.y)));const ot=[...$e];ot.length===0&&ot.push(it[it.length-1]);const bt=o.number(ot[ot.length-1].y,(it.length===0?$e[0]:it[0]).y,_e);let wt;return wt=Le?[new o.Point(0,bt),new o.Point(0,0),new o.Point(1,0),new o.Point(1,bt)]:[new o.Point(1,bt),new o.Point(1,1),new o.Point(0,1),new o.Point(0,bt)],ot.push(...wt),it.length===0?ot.push($e[0]):ot.push(...it),{polygon:ot.map((vt=>new o.MercatorCoordinate(vt.x,vt.y))),unwrapped:!1}})(a,f);if(v)return v;const S=(function(T,N){let z=!1,G=-1/0,ee=0;for(let ge=0;ge<T.length-1;ge++)T[ge].x>G&&(G=T[ge].x,ee=ge);for(let ge=0;ge<T.length-1;ge++){const Ae=(ee+ge)%(T.length-1),Le=T[Ae],Xe=T[Ae+1];Math.abs(Le.x-Xe.x)>.5&&(Le.x<Xe.x?(Le.x+=1,Ae===0&&(T[T.length-1].x+=1)):(Xe.x+=1,Ae+1===T.length-1&&(T[0].x+=1)),z=!0)}const te=o.mercatorXfromLng(N.center.lng);return z&&te<Math.abs(te-1)&&T.forEach((ge=>{ge.x-=1})),{polygon:T,unwrapped:z}})(Be(a,f).map((T=>new o.Point(Ye(T.x),T.y))),f);return{polygon:S.polygon.map((T=>new o.MercatorCoordinate(T.x,T.y))),unwrapped:S.unwrapped}}}function Be(y,a){return o.resample(y,(f=>{const v=a.pointCoordinate3D(f);f.x=v.x,f.y=v.y}),1/256)}function Ye(y){return y<0?1+y%1:y%1}function rt(y){return 100*y|0}function mt(y,a,f,v,S){const T=function(N,z){if(N)return S(N);if(z){y.url&&z.tiles&&y.tiles&&delete y.tiles;const G=o.pick(o.extend(z,y),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);z.vector_layers&&(G.vectorLayers=z.vector_layers,G.vectorLayerIds=G.vectorLayers.map((ee=>ee.id))),G.tiles=a.canonicalizeTileset(G,y.url),S(null,G)}};return y.url?o.getJSON(a.transformRequest(a.normalizeSourceURL(y.url,null,f,v),o.ResourceType.Source),T):o.exported.frame((()=>T(null,y)))}class ft{constructor(a,f,v){this.bounds=o.LngLatBounds.convert(this.validateBounds(a)),this.minzoom=f||0,this.maxzoom=v||24}validateBounds(a){return Array.isArray(a)&&a.length===4?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(a){const f=Math.pow(2,a.z),v=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*f),S=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*f),T=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*f),N=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*f);return a.x>=v&&a.x<T&&a.y>=S&&a.y<N}}class Dt{constructor(a,f,v){this.context=a;const S=a.gl;this.buffer=S.createBuffer(),this.dynamicDraw=!!v,this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),S.bufferData(S.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||f.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){const f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Yt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class cn{constructor(a,f,v,S){this.length=f.length,this.attributes=v,this.itemSize=f.bytesPerElement,this.dynamicDraw=S,this.context=a;const T=a.gl;this.buffer=T.createBuffer(),a.bindVertexBuffer.set(this.buffer),T.bufferData(T.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||f.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,f){for(let v=0;v<this.attributes.length;v++){const S=f.attributes[this.attributes[v].name];S!==void 0&&a.enableVertexAttribArray(S)}}setVertexAttribPointers(a,f,v){for(let S=0;S<this.attributes.length;S++){const T=this.attributes[S],N=f.attributes[T.name];N!==void 0&&a.vertexAttribPointer(N,T.components,a[Yt[T.type]],!1,this.itemSize,T.offset+this.itemSize*(v||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class gn{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Mn extends gn{getDefault(){return o.Color.transparent}set(a){const f=this.current;(a.r!==f.r||a.g!==f.g||a.b!==f.b||a.a!==f.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class Gt extends gn{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class st extends gn{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class mr extends gn{getDefault(){return[!0,!0,!0,!0]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||a[2]!==f[2]||a[3]!==f[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class Er extends gn{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class Cr extends gn{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class Ln extends gn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const f=this.current;(a.func!==f.func||a.ref!==f.ref||a.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class ir extends gn{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||a[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class er extends gn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=a,this.dirty=!1}}class Yr extends gn{getDefault(){return[0,1]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class Vt extends gn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=a,this.dirty=!1}}class Pn extends gn{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class Gn extends gn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.BLEND):f.disable(f.BLEND),this.current=a,this.dirty=!1}}class Dn extends gn{getDefault(){const a=this.gl;return[a.ONE,a.ZERO]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)}}class Mr extends gn{getDefault(){return o.Color.transparent}set(a){const f=this.current;(a.r!==f.r||a.g!==f.g||a.b!==f.b||a.a!==f.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class wr extends gn{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)}}class Tr extends gn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=a,this.dirty=!1}}class Ir extends gn{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class Pr extends gn{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}let Ei,Pi=class extends gn{getDefault(){return null}set(y){(y!==this.current||this.dirty)&&(this.gl.useProgram(y),this.current=y,this.dirty=!1)}};class or extends gn{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class oi extends gn{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||a[2]!==f[2]||a[3]!==f[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class Kr extends gn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class Br extends gn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class di extends gn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class si extends gn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class ut extends gn{getDefault(){return null}set(a){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class Ee extends gn{constructor(a){super(a),this.vao=a.extVertexArrayObject}getDefault(){return null}set(a){this.vao&&(a!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(a),this.current=a,this.dirty=!1)}}class Ie extends gn{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class Qe extends gn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class ht extends gn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class Ct extends gn{constructor(a,f){super(a),this.context=a,this.parent=f}getDefault(){return null}}class Mt extends Ct{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class Bt extends Ct{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,this.attachment(),f.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Et extends Bt{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Pt{constructor(a,f,v,S){this.context=a,this.width=f,this.height=v;const T=this.framebuffer=a.gl.createFramebuffer();this.colorAttachment=new Mt(a,T),S&&(this.depthAttachment=new Bt(a,T))}destroy(){const a=this.context.gl,f=this.colorAttachment.get();if(f&&a.deleteTexture(f),this.depthAttachment){const v=this.depthAttachment.get();v&&a.deleteRenderbuffer(v)}a.deleteFramebuffer(this.framebuffer)}}class vn{constructor(a,f=!1){if(this.gl=a,this.isWebGL2=f,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),f){const v=a;this.extVertexArrayObject={createVertexArrayOES:v.createVertexArray.bind(a),deleteVertexArrayOES:v.deleteVertexArray.bind(a),bindVertexArrayOES:v.bindVertexArray.bind(a)}}this.clearColor=new Mn(this),this.clearDepth=new Gt(this),this.clearStencil=new st(this),this.colorMask=new mr(this),this.depthMask=new Er(this),this.stencilMask=new Cr(this),this.stencilFunc=new Ln(this),this.stencilOp=new ir(this),this.stencilTest=new er(this),this.depthRange=new Yr(this),this.depthTest=new Vt(this),this.depthFunc=new Pn(this),this.blend=new Gn(this),this.blendFunc=new Dn(this),this.blendColor=new Mr(this),this.blendEquation=new wr(this),this.cullFace=new Tr(this),this.cullFaceSide=new Ir(this),this.frontFace=new Pr(this),this.program=new Pi(this),this.activeTexture=new or(this),this.viewport=new oi(this),this.bindFramebuffer=new Kr(this),this.bindRenderbuffer=new Br(this),this.bindTexture=new di(this),this.bindVertexBuffer=new si(this),this.bindElementBuffer=new ut(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Ee(this),this.pixelStoreUnpack=new Ie(this),this.pixelStoreUnpackPremultiplyAlpha=new Qe(this),this.pixelStoreUnpackFlipY=new ht(this),this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=a.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=a.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=a.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),f||(this.extTextureHalfFloat=a.getExtension("OES_texture_half_float")),(f||this.extTextureHalfFloat&&a.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=a.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=f||a.getExtension("OES_standard_derivatives"),this.extTimerQuery=a.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,f){return new Dt(this,a,f)}createVertexBuffer(a,f,v){return new cn(this,a,f,v)}createRenderbuffer(a,f,v){const S=this.gl,T=S.createRenderbuffer();return this.bindRenderbuffer.set(T),S.renderbufferStorage(S.RENDERBUFFER,a,f,v),this.bindRenderbuffer.set(null),T}createFramebuffer(a,f,v){return new Pt(this,a,f,v)}clear({color:a,depth:f,stencil:v}){const S=this.gl;let T=0;a&&(T|=S.COLOR_BUFFER_BIT,this.clearColor.set(a),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(T|=S.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),v!==void 0&&(T|=S.STENCIL_BUFFER_BIT,this.clearStencil.set(v),this.stencilMask.set(255)),S.clear(T)}setCullFace(a){a.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){b(a.blendFunction,o.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor)),this.colorMask.set(a.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Bn extends o.Evented{constructor(a,f,v,S){if(super(),this.id=a,this.dispatcher=v,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(f,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},f),this._collectResourceTiming=f.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(S),this._tileWorkers={},this._deduped=new o.DedupedRequest}load(a){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"}));const f=Array.isArray(this.map._language)?this.map._language.join():this.map._language,v=this.map._worldview;this._tileJSONRequest=mt(this._options,this.map._requestManager,f,v,((S,T)=>{this._tileJSONRequest=null,this._loaded=!0,S?(f&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${f}`),v&&v.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${v}`),this.fire(new o.ErrorEvent(S))):T&&(o.extend(this,T),T.bounds&&(this.tileBounds=new ft(T.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(T.tiles,this.map._requestManager._customAccessToken),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),a&&a(S)}))}loaded(){return this._loaded}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest(),this.load((()=>this.map.style._clearSource(this.id)))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.extend({},this._options)}loadTile(a,f){const v=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme)),S={request:this.map._requestManager.transformRequest(v,o.ResourceType.Tile),data:void 0,uid:a.uid,tileID:a.tileID,tileZoom:a.tileZoom,zoom:a.tileID.overscaledZ,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:a.isSymbolTile};if(S.request.collectResourceTiming=this._collectResourceTiming,a.actor&&a.state!=="expired")a.state==="loading"?a.reloadCallback=f:a.request=a.actor.send("reloadTile",S,T.bind(this));else if(a.actor=this._tileWorkers[v]=this._tileWorkers[v]||this.dispatcher.getActor(),this.dispatcher.ready)a.request=a.actor.send("loadTile",S,T.bind(this),void 0,!0);else{const N=o.loadVectorTile.call({deduped:this._deduped},S,((z,G)=>{z||!G?T.call(this,z):(S.data={cacheControl:G.cacheControl,expires:G.expires,rawData:G.rawData.slice(0)},a.actor&&a.actor.send("loadTile",S,T.bind(this),void 0,!0))}),!0);a.request={cancel:N}}function T(N,z){return delete a.request,a.aborted?f(null):N&&N.status!==404?f(N):(z&&z.resourceTiming&&(a.resourceTiming=z.resourceTiming),this.map._refreshExpiredTiles&&z&&a.setExpiryData(z),a.loadVectorData(z,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),f(null),void(a.reloadCallback&&(this.loadTile(a,a.reloadCallback),a.reloadCallback=null)))}}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id})}unloadTile(a){a.unloadVectorData(),a.actor&&a.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Tn extends o.Evented{constructor(a,f,v,S){super(),this.id=a,this.dispatcher=v,this.setEventedParent(S),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},f),o.extend(this,o.pick(f,["url","scheme","tileSize"]))}load(a){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=mt(this._options,this.map._requestManager,null,null,((f,v)=>{this._tileJSONRequest=null,this._loaded=!0,f?this.fire(new o.ErrorEvent(f)):v&&(o.extend(this,v),v.bounds&&(this.tileBounds=new ft(v.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(v.tiles),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),a&&a(f)}))}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest(),this.load((()=>this.map.style._clearSource(this.id)))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.extend({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a,f){const v=o.exported.devicePixelRatio>=2,S=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),v,this.tileSize);a.request=o.getImage(this.map._requestManager.transformRequest(S,o.ResourceType.Tile),((T,N,z,G)=>(delete a.request,a.aborted?(a.state="unloaded",f(null)):T?(a.state="errored",f(T)):N?(this.map._refreshExpiredTiles&&a.setExpiryData({cacheControl:z,expires:G}),a.setTexture(N,this.map.painter),a.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),void f(null)):f(null))))}static loadTileData(a,f,v){a.setTexture(f,v)}static unloadTileData(a,f){a.texture&&f.saveTileTexture(a.texture)}abortTile(a,f){a.request&&(a.request.cancel(),delete a.request),f()}unloadTile(a,f){a.texture&&this.map.painter.saveTileTexture(a.texture),f()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function kr(y,a,f,v,S,T,N,z){const G=[y,f,S,a,v,T,1,1,1],ee=[N,z,1],te=o.adjoint([],G),[ge,Ae,Le]=o.transformMat3(ee,ee,o.transpose(te,te));return o.multiply$1(G,[ge,0,0,0,Ae,0,0,0,Le],G)}class Lr extends o.Evented{constructor(a,f,v,S){super(),this.id=a,this.dispatcher=v,this.coordinates=f.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(S),this.options=f,this._dirty=!1}load(a,f){this._loaded=f||!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),((v,S)=>{if(this._imageRequest=null,this._loaded=!0,v)this.fire(new o.ErrorEvent(v));else if(S){const{HTMLImageElement:T}=o.window;this.image=S instanceof T?o.exported.getImageData(S):S,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,a&&(this.coordinates=a),this._finishLoading()}}))}loaded(){return this._loaded}updateImage(a){return this.image&&a.url?(this._imageRequest&&a.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=a.url,this.load(a.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(a){this.coordinates=a,this._boundsArray=void 0;const f=a.map(o.MercatorCoordinate.fromLngLat);return this.tileID=(function(v){let S=1/0,T=1/0,N=-1/0,z=-1/0;for(const ge of v)S=Math.min(S,ge.x),T=Math.min(T,ge.y),N=Math.max(N,ge.x),z=Math.max(z,ge.y);const G=Math.max(N-S,z-T),ee=Math.max(0,Math.floor(-Math.log(G)/Math.LN2)),te=Math.pow(2,ee);return new o.CanonicalTileID(ee,Math.floor((S+N)/2*te),Math.floor((T+z)/2*te))})(f),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(a){for(const G in this.tiles){const ee=this.tiles[G];ee.state!=="loaded"&&(ee.state="loaded",ee.texture=this.texture)}if(this._boundsArray)return;const f=o.tileTransform(this.tileID,this.map.transform.projection),[v,S,T,N]=this.coordinates.map((G=>{const ee=f.projection.project(G[0],G[1]);return o.getTilePoint(f,ee)._round()}));this.perspectiveTransform=(function(G,ee,te,ge,Ae,Le,Xe,Ue,Ze,_e){const $e=kr(0,0,G,0,0,ee,G,ee),it=kr(te,ge,Ae,Le,Xe,Ue,Ze,_e);return o.multiply$1(it,o.adjoint($e,$e),it),[it[6]/it[8]*G/o.EXTENT,it[7]/it[8]*ee/o.EXTENT]})(this.width,this.height,v.x,v.y,S.x,S.y,N.x,N.y,T.x,T.y);const z=this._boundsArray=new o.StructArrayLayout4i8;z.emplaceBack(v.x,v.y,0,0),z.emplaceBack(S.x,S.y,o.EXTENT,0),z.emplaceBack(N.x,N.y,0,o.EXTENT),z.emplaceBack(T.x,T.y,o.EXTENT,o.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=a.createVertexBuffer(z,o.boundsAttributes.members),this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const a=this.map.painter.context,f=a.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new o.Texture(a,this.image,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(a)}loadTile(a,f){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={},f(null)):(a.state="errored",f(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Vr={vector:Bn,raster:Tn,"raster-dem":class extends Tn{constructor(y,a,f,v){super(y,a,f,v),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox"}loadTile(y,a){const f=this.map._requestManager.normalizeTileURL(y.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function v(S,T){S&&(y.state="errored",a(S)),T&&(y.dem=T,y.dem.onDeserialize(),y.needsHillshadePrepare=!0,y.needsDEMTextureUpload=!0,y.state="loaded",a(null))}y.request=o.getImage(this.map._requestManager.transformRequest(f,o.ResourceType.Tile),(function(S,T,N,z){if(delete y.request,y.aborted)y.state="unloaded",a(null);else if(S)y.state="errored",a(S);else if(T){this.map._refreshExpiredTiles&&y.setExpiryData({cacheControl:N,expires:z});const G=o.window.ImageBitmap&&T instanceof o.window.ImageBitmap&&(Ei==null&&(Ei=o.window.OffscreenCanvas&&new o.window.OffscreenCanvas(1,1).getContext("2d")&&typeof o.window.createImageBitmap=="function"),Ei),ee=1-(T.width-o.prevPowerOfTwo(T.width))/2;ee<1||y.neighboringTiles||(y.neighboringTiles=this._getNeighboringTiles(y.tileID));const te=G?T:o.exported.getImageData(T,ee),ge={uid:y.uid,coord:y.tileID,source:this.id,rawImageData:te,encoding:this.encoding,padding:ee};y.actor&&y.state!=="expired"||(y.actor=this.dispatcher.getActor(),y.actor.send("loadDEMTile",ge,v.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(y){const a=y.canonical,f=Math.pow(2,a.z),v=(a.x-1+f)%f,S=a.x===0?y.wrap-1:y.wrap,T=(a.x+1+f)%f,N=a.x+1===f?y.wrap+1:y.wrap,z={};return z[new o.OverscaledTileID(y.overscaledZ,S,a.z,v,a.y).key]={backfilled:!1},z[new o.OverscaledTileID(y.overscaledZ,N,a.z,T,a.y).key]={backfilled:!1},a.y>0&&(z[new o.OverscaledTileID(y.overscaledZ,S,a.z,v,a.y-1).key]={backfilled:!1},z[new o.OverscaledTileID(y.overscaledZ,y.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},z[new o.OverscaledTileID(y.overscaledZ,N,a.z,T,a.y-1).key]={backfilled:!1}),a.y+1<f&&(z[new o.OverscaledTileID(y.overscaledZ,S,a.z,v,a.y+1).key]={backfilled:!1},z[new o.OverscaledTileID(y.overscaledZ,y.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},z[new o.OverscaledTileID(y.overscaledZ,N,a.z,T,a.y+1).key]={backfilled:!1}),z}unloadTile(y){y.demTexture&&this.map.painter.saveTileTexture(y.demTexture),y.fbo&&(y.fbo.destroy(),delete y.fbo),y.dem&&delete y.dem,delete y.neighboringTiles,y.state="unloaded"}},geojson:class extends o.Evented{constructor(y,a,f,v){super(),this.id=y,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=f.getActor(),this.setEventedParent(v),this._data=a.data,this._options=o.extend({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const S=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(a.buffer!==void 0?a.buffer:128)*S,tolerance:(a.tolerance!==void 0?a.tolerance:.375)*S,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:a.clusterMaxZoom!==void 0?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:o.EXTENT,radius:(a.clusterRadius!==void 0?a.clusterRadius:50)*S,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions)}onAdd(y){this.map=y,this.setData(this._data)}setData(y){return this._data=y,this._updateWorkerData(),this}getClusterExpansionZoom(y,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:y,source:this.id},a),this}getClusterChildren(y,a){return this.actor.send("geojson.getClusterChildren",{clusterId:y,source:this.id},a),this}getClusterLeaves(y,a,f,v){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:y,limit:a,offset:f},v),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.Event("dataloading",{dataType:"source"})),this._loaded=!1;const y=o.extend({},this.workerOptions),a=this._data;typeof a=="string"?(y.request=this.map._requestManager.transformRequest(o.exported.resolveURL(a),o.ResourceType.Source),y.request.collectResourceTiming=this._collectResourceTiming):y.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,y,((f,v)=>{if(this._loaded=!0,this._pendingLoad=null,f)this.fire(new o.ErrorEvent(f));else{const S={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(S.resourceTiming=v.resourceTiming[this.id]),this.fire(new o.Event("data",S)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)}))}loaded(){return this._loaded}loadTile(y,a){const f=y.actor?"reloadTile":"loadTile";y.actor=this.actor,y.request=this.actor.send(f,{type:this.type,uid:y.uid,tileID:y.tileID,tileZoom:y.tileZoom,zoom:y.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},((v,S)=>(delete y.request,y.unloadVectorData(),y.aborted?a(null):v?a(v):(y.loadVectorData(S,this.map.painter,f==="reloadTile"),a(null)))),void 0,f==="loadTile")}abortTile(y){y.request&&(y.request.cancel(),delete y.request),y.aborted=!0}unloadTile(y){y.unloadVectorData(),this.actor.send("removeTile",{uid:y.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Lr{constructor(y,a,f,v){super(y,a,f,v),this.roundZoom=!0,this.type="video",this.options=a}load(){this._loaded=!1;const y=this.options;this.urls=[];for(const a of y.urls)this.urls.push(this.map._requestManager.transformRequest(a,o.ResourceType.Source).url);o.getVideo(this.urls,((a,f)=>{this._loaded=!0,a?this.fire(new o.ErrorEvent(a)):f&&(this.video=f,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(y){if(this.video){const a=this.video.seekable;y<a.start(0)||y>a.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=y}}getVideo(){return this.video}onAdd(y){this.map||(this.map=y,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const y=this.map.painter.context,a=y.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(y,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(y)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Lr,canvas:class extends Lr{constructor(y,a,f,v){super(y,a,f,v),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some((S=>!Array.isArray(S)||S.length!==2||S.some((T=>typeof T!="number"))))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${y}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${y}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${y}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${y}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${y}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(y){this.map=y,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let y=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,y=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,y=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context;this.texture?(y||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(a,this.canvas,a.gl.RGBA,{premultiply:!0}),this._prepareData(a)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const y of[this.canvas.width,this.canvas.height])if(isNaN(y)||y<=0)return!0;return!1}},custom:class extends o.Evented{constructor(y,a,f,v){super(),this.id=y,this.type="custom",this._dataType="raster",this._dispatcher=f,this._implementation=a,this.setEventedParent(v),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new ft(this._implementation.bounds,this.minzoom,this.maxzoom)),a.update=this._update.bind(this),a.clearTiles=this._clearTiles.bind(this),a.coveringTiles=this._coveringTiles.bind(this),o.extend(this,o.pick(a,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(y){this._map=y,this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(y),this.load()}onRemove(y){this._implementation.onRemove&&this._implementation.onRemove(y)}hasTile(y){if(this._implementation.hasTile){const{x:a,y:f,z:v}=y.canonical;return this._implementation.hasTile({x:a,y:f,z:v})}return!this.tileBounds||this.tileBounds.contains(y.canonical)}loadTile(y,a){const{x:f,y:v,z:S}=y.tileID.canonical,T=new o.window.AbortController;y.request=Promise.resolve(this._implementation.loadTile({x:f,y:v,z:S},{signal:T.signal})).then((function(N){return delete y.request,y.aborted?(y.state="unloaded",a(null)):N===void 0?(y.state="errored",a(null)):N===null?(this.loadTileData(y,{width:this.tileSize,height:this.tileSize,data:null}),y.state="loaded",a(null)):(function(z){return z instanceof o.window.ImageData||z instanceof o.window.HTMLCanvasElement||z instanceof o.window.ImageBitmap||z instanceof o.window.HTMLImageElement})(N)?(this.loadTileData(y,N),y.state="loaded",void a(null)):(y.state="errored",a(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch((N=>{N.code!==20&&(y.state="errored",a(N))})),y.request.cancel=()=>T.abort()}loadTileData(y,a){Tn.loadTileData(y,a,this._map.painter)}unloadTileData(y){Tn.unloadTileData(y,this._map.painter)}unloadTile(y,a){if(this.unloadTileData(y),this._implementation.unloadTile){const{x:f,y:v,z:S}=y.tileID.canonical;this._implementation.unloadTile({x:f,y:v,z:S})}a()}abortTile(y,a){y.request&&y.request.cancel&&(y.request.cancel(),delete y.request),a()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((y=>({x:y.canonical.x,y:y.canonical.y,z:y.canonical.z})))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Ar=function(y,a,f,v){const S=new Vr[a.type](y,a,f,v);if(S.id!==y)throw new Error(`Expected Source id to be ${y} instead of ${S.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],S),S};function Ai(y,a){const f=o.identity([]);return o.scale(f,f,[.5*y.width,.5*-y.height,1]),o.translate(f,f,[1,-1,0]),o.multiply(f,f,y.calculateProjMatrix(a.toUnwrapped())),Float32Array.from(f)}function no(y,a,f,v,S,T,N,z=!1){const G=y.tilesIn(v,N,z);G.sort($o);const ee=[];for(const ge of G)ee.push({wrappedTileID:ge.tile.tileID.wrapped().key,queryResults:ge.tile.queryRenderedFeatures(a,f,y._state,ge,S,T,Ai(y.transform,ge.tile.tileID),z)});const te=(function(ge){const Ae={},Le={};for(const Xe of ge){const Ue=Xe.queryResults,Ze=Xe.wrappedTileID,_e=Le[Ze]=Le[Ze]||{};for(const $e in Ue){const it=Ue[$e],ot=_e[$e]=_e[$e]||{},bt=Ae[$e]=Ae[$e]||[];for(const wt of it)ot[wt.featureIndex]||(ot[wt.featureIndex]=!0,bt.push(wt))}}return Ae})(ee);for(const ge in te)te[ge].forEach((Ae=>{const Le=Ae.feature,Xe=Le.layer;Xe&&Xe.type!=="background"&&Xe.type!=="sky"&&(Le.source=Xe.source,Xe["source-layer"]&&(Le.sourceLayer=Xe["source-layer"]),Le.state=Le.id!==void 0?y.getFeatureState(Xe["source-layer"],Le.id):{})}));return te}function yo(y,a){const f=y.getRenderableIds().map((T=>y.getTileByID(T))),v=[],S={};for(let T=0;T<f.length;T++){const N=f[T],z=N.tileID.canonical.key;S[z]||(S[z]=!0,N.querySourceFeatures(v,a))}return v}function $o(y,a){const f=y.tileID,v=a.tileID;return f.overscaledZ-v.overscaledZ||f.canonical.y-v.canonical.y||f.wrap-v.wrap||f.canonical.x-v.canonical.x}function ro(){return En.workerClass!=null?new En.workerClass:new o.window.Worker(En.workerUrl)}const ys="mapboxgl_preloaded_worker_pool";class io{constructor(){this.active={}}acquire(a){if(!this.workers)for(this.workers=[];this.workers.length<io.workerCount;)this.workers.push(new ro);return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],this.numActive()===0&&(this.workers.forEach((f=>{f.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[ys]}numActive(){return Object.keys(this.active).length}}let Is;function ga(){return Is||(Is=new io),Is}function gl(y,a){const f={};for(const v in y)v!=="ref"&&(f[v]=y[v]);return o.refProperties.forEach((v=>{v in a&&(f[v]=a[v])})),f}function sl(y){y=y.slice();const a=Object.create(null);for(let f=0;f<y.length;f++)a[y[f].id]=y[f];for(let f=0;f<y.length;f++)"ref"in y[f]&&(y[f]=gl(y[f],a[y[f].ref]));return y}io.workerCount=2;const Wi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Jl(y,a,f){f.push({command:Wi.addSource,args:[y,a[y]]})}function Lu(y,a,f){a.push({command:Wi.removeSource,args:[y]}),f[y]=!0}function Eo(y,a,f,v){Lu(y,f,v),Jl(y,a,f)}function fu(y,a,f){let v;for(v in y[f])if(y[f].hasOwnProperty(v)&&v!=="data"&&!b(y[f][v],a[f][v]))return!1;for(v in a[f])if(a[f].hasOwnProperty(v)&&v!=="data"&&!b(y[f][v],a[f][v]))return!1;return!0}function Ea(y,a,f,v,S,T){let N;for(N in a=a||{},y=y||{})y.hasOwnProperty(N)&&(b(y[N],a[N])||f.push({command:T,args:[v,N,a[N],S]}));for(N in a)a.hasOwnProperty(N)&&!y.hasOwnProperty(N)&&(b(y[N],a[N])||f.push({command:T,args:[v,N,a[N],S]}))}function Ko(y){return y.id}function Xa(y,a){return y[a.id]=a,y}class Nl{constructor(a,f){this.reset(a,f)}reset(a,f){this.points=a||[],this._distances=[0];for(let v=1;v<this.points.length;v++)this._distances[v]=this._distances[v-1]+this.points[v].dist(this.points[v-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(this.points.length===1)return this.points[0];a=o.clamp(a,0,1);let f=1,v=this._distances[f];const S=a*this.paddedLength+this.padding;for(;v<S&&f<this._distances.length;)v=this._distances[++f];const T=f-1,N=this._distances[T],z=v-N,G=z>0?(S-N)/z:0;return this.points[T].mult(1-G).add(this.points[f].mult(G))}}class Ql{constructor(a,f,v){const S=this.boxCells=[],T=this.circleCells=[];this.xCellCount=Math.ceil(a/v),this.yCellCount=Math.ceil(f/v);for(let N=0;N<this.xCellCount*this.yCellCount;N++)S.push([]),T.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=f,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,f,v,S,T){this._forEachCell(f,v,S,T,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(f),this.bboxes.push(v),this.bboxes.push(S),this.bboxes.push(T)}insertCircle(a,f,v,S){this._forEachCell(f-S,v-S,f+S,v+S,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(f),this.circles.push(v),this.circles.push(S)}_insertBoxCell(a,f,v,S,T,N){this.boxCells[T].push(N)}_insertCircleCell(a,f,v,S,T,N){this.circleCells[T].push(N)}_query(a,f,v,S,T,N){if(v<0||a>this.width||S<0||f>this.height)return!T&&[];const z=[];if(a<=0&&f<=0&&this.width<=v&&this.height<=S){if(T)return!0;for(let G=0;G<this.boxKeys.length;G++)z.push({key:this.boxKeys[G],x1:this.bboxes[4*G],y1:this.bboxes[4*G+1],x2:this.bboxes[4*G+2],y2:this.bboxes[4*G+3]});for(let G=0;G<this.circleKeys.length;G++){const ee=this.circles[3*G],te=this.circles[3*G+1],ge=this.circles[3*G+2];z.push({key:this.circleKeys[G],x1:ee-ge,y1:te-ge,x2:ee+ge,y2:te+ge})}return N?z.filter(N):z}return this._forEachCell(a,f,v,S,this._queryCell,z,{hitTest:T,seenUids:{box:{},circle:{}}},N),T?z.length>0:z}_queryCircle(a,f,v,S,T){const N=a-v,z=a+v,G=f-v,ee=f+v;if(z<0||N>this.width||ee<0||G>this.height)return!S&&[];const te=[];return this._forEachCell(N,G,z,ee,this._queryCellCircle,te,{hitTest:S,circle:{x:a,y:f,radius:v},seenUids:{box:{},circle:{}}},T),S?te.length>0:te}query(a,f,v,S,T){return this._query(a,f,v,S,!1,T)}hitTest(a,f,v,S,T){return this._query(a,f,v,S,!0,T)}hitTestCircle(a,f,v,S){return this._queryCircle(a,f,v,!0,S)}_queryCell(a,f,v,S,T,N,z,G){const ee=z.seenUids,te=this.boxCells[T];if(te!==null){const Ae=this.bboxes;for(const Le of te)if(!ee.box[Le]){ee.box[Le]=!0;const Xe=4*Le;if(a<=Ae[Xe+2]&&f<=Ae[Xe+3]&&v>=Ae[Xe+0]&&S>=Ae[Xe+1]&&(!G||G(this.boxKeys[Le]))){if(z.hitTest)return N.push(!0),!0;N.push({key:this.boxKeys[Le],x1:Ae[Xe],y1:Ae[Xe+1],x2:Ae[Xe+2],y2:Ae[Xe+3]})}}}const ge=this.circleCells[T];if(ge!==null){const Ae=this.circles;for(const Le of ge)if(!ee.circle[Le]){ee.circle[Le]=!0;const Xe=3*Le;if(this._circleAndRectCollide(Ae[Xe],Ae[Xe+1],Ae[Xe+2],a,f,v,S)&&(!G||G(this.circleKeys[Le]))){if(z.hitTest)return N.push(!0),!0;{const Ue=Ae[Xe],Ze=Ae[Xe+1],_e=Ae[Xe+2];N.push({key:this.circleKeys[Le],x1:Ue-_e,y1:Ze-_e,x2:Ue+_e,y2:Ze+_e})}}}}}_queryCellCircle(a,f,v,S,T,N,z,G){const ee=z.circle,te=z.seenUids,ge=this.boxCells[T];if(ge!==null){const Le=this.bboxes;for(const Xe of ge)if(!te.box[Xe]){te.box[Xe]=!0;const Ue=4*Xe;if(this._circleAndRectCollide(ee.x,ee.y,ee.radius,Le[Ue+0],Le[Ue+1],Le[Ue+2],Le[Ue+3])&&(!G||G(this.boxKeys[Xe])))return N.push(!0),!0}}const Ae=this.circleCells[T];if(Ae!==null){const Le=this.circles;for(const Xe of Ae)if(!te.circle[Xe]){te.circle[Xe]=!0;const Ue=3*Xe;if(this._circlesCollide(Le[Ue],Le[Ue+1],Le[Ue+2],ee.x,ee.y,ee.radius)&&(!G||G(this.circleKeys[Xe])))return N.push(!0),!0}}}_forEachCell(a,f,v,S,T,N,z,G){const ee=this._convertToXCellCoord(a),te=this._convertToYCellCoord(f),ge=this._convertToXCellCoord(v),Ae=this._convertToYCellCoord(S);for(let Le=ee;Le<=ge;Le++)for(let Xe=te;Xe<=Ae;Xe++)if(T.call(this,a,f,v,S,this.xCellCount*Xe+Le,N,z,G))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,f,v,S,T,N){const z=S-a,G=T-f,ee=v+N;return ee*ee>z*z+G*G}_circleAndRectCollide(a,f,v,S,T,N,z){const G=(N-S)/2,ee=Math.abs(a-(S+G));if(ee>G+v)return!1;const te=(z-T)/2,ge=Math.abs(f-(T+te));if(ge>te+v)return!1;if(ee<=G||ge<=te)return!0;const Ae=ee-G,Le=ge-te;return Ae*Ae+Le*Le<=v*v}}const Aa={unknown:0,flipRequired:1,flipNotRequired:2},sa=Math.tan(85*Math.PI/180);function dn(y,a,f,v,S,T,N){const z=o.create();if(f)if(T.name==="globe"){const G=o.calculateGlobeLabelMatrix(S,a);o.multiply(z,z,G)}else{const G=q([],N);z[0]=G[0],z[1]=G[1],z[4]=G[2],z[5]=G[3],v||o.rotateZ(z,z,S.angle)}else o.multiply(z,S.labelPlaneMatrix,y);return z}function Xo(y,a,f,v,S,T,N){const z=dn(y,a,f,v,S,T,N);return T.name==="globe"&&f||(z[2]=z[6]=z[10]=z[14]=0),z}function ss(y,a,f,v,S,T,N){if(f){if(T.name==="globe"){const z=dn(y,a,f,v,S,T,N);return o.invert(z,z),o.multiply(z,y,z),z}{const z=o.clone(y),G=o.identity([]);return G[0]=N[0],G[1]=N[1],G[4]=N[2],G[5]=N[3],o.multiply(z,z,G),v||o.rotateZ(z,z,-S.angle),z}}return S.glCoordMatrix}function xi(y,a,f,v){const S=[y,a,f,1];f?o.transformMat4$1(S,S,v):bi(S,S,v);const T=S[3];return S[0]/=T,S[1]/=T,S[2]/=T,S}function pu(y,a){return Math.min(.5+y/a*.5,1.5)}function Za(y,a){const f=y[0]/y[3],v=y[1]/y[3];return f>=-a[0]&&f<=a[0]&&v>=-a[1]&&v<=a[1]}function Ya(y,a,f,v,S,T,N,z,G,ee){const te=f.transform,ge=v?y.textSizeData:y.iconSizeData,Ae=o.evaluateSizeForZoom(ge,f.transform.zoom),Le=te.projection.name==="globe",Xe=[256/f.width*2+1,256/f.height*2+1],Ue=v?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;Ue.clear();let Ze=null;Le&&(Ze=v?y.text.globeExtVertexArray:y.icon.globeExtVertexArray);const _e=y.lineVertexArray,$e=v?y.text.placedSymbolArray:y.icon.placedSymbolArray,it=f.transform.width/f.transform.height;let ot,bt=!1;for(let wt=0;wt<$e.length;wt++){const vt=$e.get(wt),{numGlyphs:Rt,writingMode:Lt}=vt;if(Lt!==o.WritingMode.vertical||bt||ot===o.WritingMode.horizontal||(bt=!0),ot=Lt,(vt.hidden||Lt===o.WritingMode.vertical)&&!bt){Ta(Rt,Ue);continue}bt=!1;const zt=new o.Point(vt.tileAnchorX,vt.tileAnchorY);let{x:mn,y:Ut,z:an}=te.projection.projectTilePoint(zt.x,zt.y,ee.canonical);if(G){const[Fr,sr,fr]=G(zt);mn+=Fr,Ut+=sr,an+=fr}const Ht=[mn,Ut,an,1];if(o.transformMat4$1(Ht,Ht,a),!Za(Ht,Xe)){Ta(Rt,Ue);continue}const Cn=pu(f.transform.cameraToCenterDistance,Ht[3]),jt=o.evaluateSizeForFeature(ge,Ae,vt),on=N?jt/Cn:jt*Cn,In=xi(mn,Ut,an,S);if(In[3]<=0){Ta(Rt,Ue);continue}let xn={};const bn=N?null:G,pr=tr(vt,on,!1,z,a,S,T,y.glyphOffsetArray,_e,Ue,Ze,In,zt,xn,it,bn,te.projection,ee,N);bt=pr.useVertical,bn&&pr.needsFlipping&&(xn={}),(pr.notEnoughRoom||bt||pr.needsFlipping&&tr(vt,on,!0,z,a,S,T,y.glyphOffsetArray,_e,Ue,Ze,In,zt,xn,it,bn,te.projection,ee,N).notEnoughRoom)&&Ta(Rt,Ue)}v?(y.text.dynamicLayoutVertexBuffer.updateData(Ue),Ze&&y.text.globeExtVertexBuffer.updateData(Ze)):(y.icon.dynamicLayoutVertexBuffer.updateData(Ue),Ze&&y.icon.globeExtVertexBuffer.updateData(Ze))}function al(y,a,f,v,S,T,N,z,G,ee,te,ge,Ae,Le,Xe,Ue){const{lineStartIndex:Ze,glyphStartIndex:_e,segment:$e}=z,it=_e+z.numGlyphs,ot=Ze+z.lineLength,bt=a.getoffsetX(_e),wt=a.getoffsetX(it-1),vt=js(y*bt,f,v,S,T,N,$e,Ze,ot,G,ee,te,ge,Ae,!0,Le,Xe,Ue);if(!vt)return null;const Rt=js(y*wt,f,v,S,T,N,$e,Ze,ot,G,ee,te,ge,Ae,!0,Le,Xe,Ue);return Rt?{first:vt,last:Rt}:null}function Cs(y,a,f,v){return y===o.WritingMode.horizontal&&Math.abs(v)>Math.abs(f)?{useVertical:!0}:y===o.WritingMode.vertical?v>0?{needsFlipping:!0}:null:a!==Aa.unknown&&(function(S,T){return S===0||Math.abs(T/S)>sa})(f,v)?a===Aa.flipRequired?{needsFlipping:!0}:null:f<0?{needsFlipping:!0}:null}function tr(y,a,f,v,S,T,N,z,G,ee,te,ge,Ae,Le,Xe,Ue,Ze,_e,$e){const it=a/24,ot=y.lineOffsetX*it,bt=y.lineOffsetY*it,{lineStartIndex:wt,glyphStartIndex:vt,numGlyphs:Rt,segment:Lt,writingMode:zt,flipState:mn}=y,Ut=wt+y.lineLength,an=Ht=>{if(te){const[In,xn,bn]=Ht.up,pr=ee.length;o.updateGlobeVertexNormal(te,pr+0,In,xn,bn),o.updateGlobeVertexNormal(te,pr+1,In,xn,bn),o.updateGlobeVertexNormal(te,pr+2,In,xn,bn),o.updateGlobeVertexNormal(te,pr+3,In,xn,bn)}const[Cn,jt,on]=Ht.point;o.addDynamicAttributes(ee,Cn,jt,on,Ht.angle)};if(Rt>1){const Ht=al(it,z,ot,bt,f,ge,Ae,y,G,T,Le,Ue,!1,Ze,_e,$e);if(!Ht)return{notEnoughRoom:!0};if(v&&!f){let[Cn,jt,on]=Ht.first.point,[In,xn,bn]=Ht.last.point;[Cn,jt]=xi(Cn,jt,on,N),[In,xn]=xi(In,xn,bn,N);const pr=Cs(zt,mn,(In-Cn)*Xe,xn-jt);if(y.flipState=pr&&pr.needsFlipping?Aa.flipRequired:Aa.flipNotRequired,pr)return pr}an(Ht.first);for(let Cn=vt+1;Cn<vt+Rt-1;Cn++){const jt=js(it*z.getoffsetX(Cn),ot,bt,f,ge,Ae,Lt,wt,Ut,G,T,Le,Ue,!1,!1,Ze,_e,$e);if(!jt)return ee.length-=4*(Cn-vt),{notEnoughRoom:!0};an(jt)}an(Ht.last)}else{if(v&&!f){const Cn=xi(Ae.x,Ae.y,0,S),jt=wt+Lt+1,on=new o.Point(G.getx(jt),G.gety(jt)),In=xi(on.x,on.y,0,S),xn=In[3]>0?In:Nr(Ae,on,Cn,1,S,void 0,Ze,_e.canonical),bn=Cs(zt,mn,(xn[0]-Cn[0])*Xe,xn[1]-Cn[1]);if(y.flipState=bn&&bn.needsFlipping?Aa.flipRequired:Aa.flipNotRequired,bn)return bn}const Ht=js(it*z.getoffsetX(vt),ot,bt,f,ge,Ae,Lt,wt,Ut,G,T,Le,Ue,!1,!1,Ze,_e,$e);if(!Ht)return{notEnoughRoom:!0};an(Ht)}return{}}function zr(y,a,f,v,S){const{x:T,y:N,z}=v.projectTilePoint(y.x,y.y,a);if(!S)return xi(T,N,z,f);const[G,ee,te]=S(y);return xi(T+G,N+ee,z+te,f)}function Nr(y,a,f,v,S,T,N,z){const G=zr(y.sub(a)._unit()._add(y),z,S,N,T);return o.sub(G,f,G),o.normalize(G,G),o.scaleAndAdd(G,f,G,v)}function js(y,a,f,v,S,T,N,z,G,ee,te,ge,Ae,Le,Xe,Ue,Ze,_e){const $e=v?y-a:y+a;let it=$e>0?1:-1,ot=0;v&&(it*=-1,ot=Math.PI),it<0&&(ot+=Math.PI);let bt=z+N+(it>0?0:1)|0,wt=S,vt=S,Rt=0,Lt=0;const zt=Math.abs($e),mn=[],Ut=[];let an=T,Ht=an;const Cn=()=>Nr(Ht,an,vt,zt-Rt+1,te,Ae,Ue,Ze.canonical);for(;Rt+Lt<=zt;){if(bt+=it,bt<z||bt>=G)return null;if(vt=wt,Ht=an,mn.push(vt),Le&&Ut.push(Ht),an=new o.Point(ee.getx(bt),ee.gety(bt)),wt=ge[bt],!wt){const fr=zr(an,Ze.canonical,te,Ue,Ae);wt=fr[3]>0?ge[bt]=fr:Cn()}Rt+=Lt,Lt=o.distance(vt,wt)}Xe&&Ae&&(ge[bt]&&(wt=Cn(),Lt=o.distance(vt,wt)),ge[bt]=wt);const jt=(zt-Rt)/Lt,on=an.sub(Ht)._mult(jt)._add(Ht),In=o.sub([],wt,vt),xn=o.scaleAndAdd([],vt,In,jt);let bn=[0,0,1],pr=In[0],Fr=In[1];if(_e&&(bn=Ue.upVector(Ze.canonical,on.x,on.y),bn[0]!==0||bn[1]!==0||bn[2]!==1)){const fr=[bn[2],0,-bn[0]],$r=o.cross([],bn,fr);o.normalize(fr,fr),o.normalize($r,$r),pr=o.dot(In,fr),Fr=o.dot(In,$r)}if(f){const fr=o.cross([],bn,In);o.normalize(fr,fr),o.scaleAndAdd(xn,xn,fr,f*it)}const sr=ot+Math.atan2(Fr,pr);return mn.push(xn),Le&&Ut.push(on),{point:xn,angle:sr,path:mn,tilePath:Ut,up:bn}}function Ta(y,a){const f=a.length,v=f+4*y;a.resize(v),a.float32.fill(-1/0,4*f,4*v)}function bi(y,a,f){const v=a[0],S=a[1];return y[0]=f[0]*v+f[4]*S+f[12],y[1]=f[1]*v+f[5]*S+f[13],y[3]=f[3]*v+f[7]*S+f[15],y}const Mi=100;class yl{constructor(a,f,v=new Ql(a.width+200,a.height+200,25),S=new Ql(a.width+200,a.height+200,25)){this.transform=a,this.grid=v,this.ignoredGrid=S,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+Mi,this.screenBottomBoundary=a.height+Mi,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.fogState=f}placeCollisionBox(a,f,v,S,T,N,z,G){let ee=v.projectedAnchorX,te=v.projectedAnchorY,ge=v.projectedAnchorZ;const Ae=v.elevation,Le=v.tileID,Xe=a.getProjection();if(Ae&&Le){const[wt,vt,Rt]=Xe.upVector(Le.canonical,v.tileAnchorX,v.tileAnchorY),Lt=Xe.upVectorScale(Le.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;ee+=wt*Ae*Lt,te+=vt*Ae*Lt,ge+=Rt*Ae*Lt}const Ue=this.projectAndGetPerspectiveRatio(z,ee,te,ge,v.tileID,Xe.name==="globe"||!!Ae||this.transform.pitch>0,Xe),Ze=N*Ue.perspectiveRatio,_e=(v.x1*f+S.x-v.padding)*Ze+Ue.point.x,$e=(v.y1*f+S.y-v.padding)*Ze+Ue.point.y,it=(v.x2*f+S.x+v.padding)*Ze+Ue.point.x,ot=(v.y2*f+S.y+v.padding)*Ze+Ue.point.y,bt=Ue.perspectiveRatio<=.55||Ue.occluded;return!this.isInsideGrid(_e,$e,it,ot)||!T&&this.grid.hitTest(_e,$e,it,ot,G)||bt?{box:[],offscreen:!1,occluded:Ue.occluded}:{box:[_e,$e,it,ot],offscreen:this.isOffscreen(_e,$e,it,ot),occluded:!1}}placeCollisionCircles(a,f,v,S,T,N,z,G,ee,te,ge,Ae,Le,Xe,Ue){const Ze=[],_e=this.transform.elevation,$e=a.getProjection(),it=_e?_e.getAtTileOffsetFunc(Ue,this.transform.center.lat,this.transform.worldSize,$e):null,ot=new o.Point(v.tileAnchorX,v.tileAnchorY);let{x:bt,y:wt,z:vt}=$e.projectTilePoint(ot.x,ot.y,Ue.canonical);if(it){const[on,In,xn]=it(ot);bt+=on,wt+=In,vt+=xn}const Rt=$e.name==="globe",Lt=this.projectAndGetPerspectiveRatio(z,bt,wt,vt,Ue,Rt||!!_e||this.transform.pitch>0,$e),{perspectiveRatio:zt}=Lt,mn=(ge?N/zt:N*zt)/o.ONE_EM,Ut=xi(bt,wt,vt,G),an=Lt.signedDistanceFromCamera>0?al(mn,T,v.lineOffsetX*mn,v.lineOffsetY*mn,!1,Ut,ot,v,S,G,{},_e&&!ge?it:null,ge&&!!_e,$e,Ue,ge):null;let Ht=!1,Cn=!1,jt=!0;if(an&&!Lt.occluded){const on=.5*Le*zt+Xe,In=new o.Point(-100,-100),xn=new o.Point(this.screenRightBoundary,this.screenBottomBoundary),bn=new Nl,{first:pr,last:Fr}=an,sr=pr.path.length;let fr=[];for(let Sr=sr-1;Sr>=1;Sr--)fr.push(pr.path[Sr]);for(let Sr=1;Sr<Fr.path.length;Sr++)fr.push(Fr.path[Sr]);const $r=2.5*on;ee&&(fr=fr.map((([Sr,ki,Ci],co)=>(it&&!Rt&&(Ci=it(co<sr-1?pr.tilePath[sr-1-co]:Fr.tilePath[co-sr+2])[2]),xi(Sr,ki,Ci,ee)))),fr.some((Sr=>Sr[3]<=0))&&(fr=[]));let gi=[];if(fr.length>0){let Sr=1/0,ki=-1/0,Ci=1/0,co=-1/0;for(const Ri of fr)Sr=Math.min(Sr,Ri[0]),Ci=Math.min(Ci,Ri[1]),ki=Math.max(ki,Ri[0]),co=Math.max(co,Ri[1]);ki>=In.x&&Sr<=xn.x&&co>=In.y&&Ci<=xn.y&&(gi=[fr.map((Ri=>new o.Point(Ri[0],Ri[1])))],(Sr<In.x||ki>xn.x||Ci<In.y||co>xn.y)&&(gi=o.clipLine(gi,In.x,In.y,xn.x,xn.y)))}for(const Sr of gi){bn.reset(Sr,.25*on);let ki=0;ki=bn.length<=.5*on?1:Math.ceil(bn.paddedLength/$r)+1;for(let Ci=0;Ci<ki;Ci++){const co=Ci/Math.max(ki-1,1),Ri=bn.lerp(co),ba=Ri.x+Mi,ts=Ri.y+Mi;Ze.push(ba,ts,on,0);const cc=ba-on,Cc=ts-on,Li=ba+on,eo=ts+on;if(jt=jt&&this.isOffscreen(cc,Cc,Li,eo),Cn=Cn||this.isInsideGrid(cc,Cc,Li,eo),!f&&this.grid.hitTestCircle(ba,ts,on,Ae)&&(Ht=!0,!te))return{circles:[],offscreen:!1,collisionDetected:Ht,occluded:!1}}}}return{circles:!te&&Ht||!Cn?[]:Ze,offscreen:jt,collisionDetected:Ht,occluded:Lt.occluded}}queryRenderedSymbols(a){if(a.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const f=[];let v=1/0,S=1/0,T=-1/0,N=-1/0;for(const te of a){const ge=new o.Point(te.x+Mi,te.y+Mi);v=Math.min(v,ge.x),S=Math.min(S,ge.y),T=Math.max(T,ge.x),N=Math.max(N,ge.y),f.push(ge)}const z=this.grid.query(v,S,T,N).concat(this.ignoredGrid.query(v,S,T,N)),G={},ee={};for(const te of z){const ge=te.key;if(G[ge.bucketInstanceId]===void 0&&(G[ge.bucketInstanceId]={}),G[ge.bucketInstanceId][ge.featureIndex])continue;const Ae=[new o.Point(te.x1,te.y1),new o.Point(te.x2,te.y1),new o.Point(te.x2,te.y2),new o.Point(te.x1,te.y2)];o.polygonIntersectsPolygon(f,Ae)&&(G[ge.bucketInstanceId][ge.featureIndex]=!0,ee[ge.bucketInstanceId]===void 0&&(ee[ge.bucketInstanceId]=[]),ee[ge.bucketInstanceId].push(ge.featureIndex))}return ee}insertCollisionBox(a,f,v,S,T){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:S,collisionGroupID:T},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,f,v,S,T){const N=f?this.ignoredGrid:this.grid,z={bucketInstanceId:v,featureIndex:S,collisionGroupID:T};for(let G=0;G<a.length;G+=4)N.insertCircle(z,a[G],a[G+1],a[G+2])}projectAndGetPerspectiveRatio(a,f,v,S,T,N,z){const G=[f,v,S,1];let ee=!1;S||this.transform.pitch>0?(o.transformMat4$1(G,G,a),this.fogState&&T&&z.name!=="globe"&&(ee=(function(Ae,Le,Xe,Ue,Ze,_e){const $e=_e.calculateFogTileMatrix(Ze),it=[Le,Xe,Ue];return o.transformMat4(it,it,$e),Ne(Ae,it,_e.pitch,_e._fov)})(this.fogState,f,v,S,T.toUnwrapped(),this.transform)>.9)):bi(G,G,a);const te=G[3];return{point:new o.Point((G[0]/te+1)/2*this.transform.width+Mi,(-G[1]/te+1)/2*this.transform.height+Mi),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(z)/te*.5,1.5),signedDistanceFromCamera:te,occluded:N&&G[2]>te||ee}}isOffscreen(a,f,v,S){return v<Mi||a>=this.screenRightBoundary||S<Mi||f>this.screenBottomBoundary}isInsideGrid(a,f,v,S){return v>=0&&a<this.gridRightBoundary&&S>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const a=o.identity([]);return o.translate(a,a,[-100,-100,0]),a}}function Gi(y,a,f){const v=a.createTileMatrix(y,y.worldSize,f.toUnwrapped());return o.multiply(new Float32Array(16),y.projMatrix,v)}function fs(y,a,f){if(a.projection.name===f.projection.name)return y.projMatrix;const v=f.clone();return v.setProjection(a.projection),Gi(v,a.getProjection(),y)}function Ui(y,a,f){return a.name===f.projection.name?y.projMatrix:Gi(f,a,y)}class mu{constructor(a,f,v,S){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?f:-f))):S&&v?1:0,this.placed=v}isHidden(){return this.opacity===0&&!this.placed}}class ec{constructor(a,f,v,S,T,N=!1){this.text=new mu(a?a.text:null,f,v,T),this.icon=new mu(a?a.icon:null,f,S,T),this.clipped=N}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class nu{constructor(a,f,v,S=!1){this.text=a,this.icon=f,this.skipFade=v,this.clipped=S}}class _c{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class tc{constructor(a,f,v,S,T){this.bucketInstanceId=a,this.featureIndex=f,this.sourceLayerIndex=v,this.bucketIndex=S,this.tileID=T}}class Da{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const f=++this.maxGroupID;this.collisionGroups[a]={ID:f,predicate:v=>v.collisionGroupID===f}}return this.collisionGroups[a]}}function Ls(y,a,f,v,S){const{horizontalAlign:T,verticalAlign:N}=o.getAnchorAlignment(y),z=-(T-.5)*a,G=-(N-.5)*f,ee=o.evaluateVariableOffset(y,v);return new o.Point(z+ee[0]*S,G+ee[1]*S)}function Vi(y,a,f,v,S){const T=new o.Point(y,a);return f&&T._rotate(v?S:-S),T}class Fa{constructor(a,f,v,S,T){this.transform=a.clone(),this.projection=a.projection.name,this.collisionIndex=new yl(this.transform,T),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new Da(v),this.collisionCircleArrays={},this.prevPlacement=S,S&&(S.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,f,v,S){const T=v.getBucket(f),N=v.latestFeatureIndex;if(!T||!N||f.id!==T.layerIds[0])return;const z=T.layers[0].layout,G=v.collisionBoxArray,ee=Math.pow(2,this.transform.zoom-v.tileID.overscaledZ),te=v.tileSize/o.EXTENT,ge=v.tileID.toUnwrapped();this.transform.setProjection(T.projection);const Ae=(Le=v.tileID,Xe=T.getProjection(),Ue=this.transform,Xe.name===this.projection?Ue.calculateProjMatrix(Le.toUnwrapped()):Gi(Ue,Xe,Le));var Le,Xe,Ue;const Ze=z.get("text-pitch-alignment")==="map",_e=z.get("text-rotation-alignment")==="map";f.compileFilter();const $e=f.dynamicFilter(),it=f.dynamicFilterNeedsFeature(),ot=this.transform.calculatePixelsToTileUnitsMatrix(v),bt=Xo(Ae,v.tileID.canonical,Ze,_e,this.transform,T.getProjection(),ot);let wt=null;if(Ze){const Lt=ss(Ae,v.tileID.canonical,Ze,_e,this.transform,T.getProjection(),ot);wt=o.multiply([],this.transform.labelPlaneMatrix,Lt)}let vt=null;$e&&v.latestFeatureIndex&&(vt={unwrappedTileID:ge,dynamicFilter:$e,dynamicFilterNeedsFeature:it,featureIndex:v.latestFeatureIndex}),this.retainedQueryData[T.bucketInstanceId]=new tc(T.bucketInstanceId,N,T.sourceLayerIndex,T.index,v.tileID);const Rt={bucket:T,layout:z,posMatrix:Ae,textLabelPlaneMatrix:bt,labelToScreenMatrix:wt,clippingData:vt,scale:ee,textPixelRatio:te,holdingForFade:v.holdingForFade(),collisionBoxArray:G,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(T.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.evaluateSizeForZoom(T.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(T.sourceID)};if(S)for(const Lt of T.sortKeyRanges){const{sortKey:zt,symbolInstanceStart:mn,symbolInstanceEnd:Ut}=Lt;a.push({sortKey:zt,symbolInstanceStart:mn,symbolInstanceEnd:Ut,parameters:Rt})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:Rt})}attemptAnchorPlacement(a,f,v,S,T,N,z,G,ee,te,ge,Ae,Le,Xe,Ue,Ze,_e,$e){const{textOffset0:it,textOffset1:ot,crossTileID:bt}=Ae,wt=[it,ot],vt=Ls(a,v,S,wt,T),Rt=this.collisionIndex.placeCollisionBox(Xe,T,f,Vi(vt.x,vt.y,N,z,this.transform.angle),ge,G,ee,te.predicate);if(Ze){const Lt=Xe.getSymbolInstanceIconSize($e,this.transform.zoom,Ae.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Xe,Lt,Ze,Vi(vt.x,vt.y,N,z,this.transform.angle),ge,G,ee,te.predicate).box.length===0)return}if(Rt.box.length>0){let Lt;return this.prevPlacement&&this.prevPlacement.variableOffsets[bt]&&this.prevPlacement.placements[bt]&&this.prevPlacement.placements[bt].text&&(Lt=this.prevPlacement.variableOffsets[bt].anchor),this.variableOffsets[bt]={textOffset:wt,width:v,height:S,anchor:a,textScale:T,prevAnchor:Lt},this.markUsedJustification(Xe,a,Ae,Ue),Xe.allowVerticalPlacement&&(this.markUsedOrientation(Xe,Ue,Ae),this.placedOrientations[bt]=Ue),{shift:vt,placedGlyphBoxes:Rt}}}placeLayerBucketPart(a,f,v,S){const{bucket:T,layout:N,posMatrix:z,textLabelPlaneMatrix:G,labelToScreenMatrix:ee,clippingData:te,textPixelRatio:ge,holdingForFade:Ae,collisionBoxArray:Le,partiallyEvaluatedTextSize:Xe,partiallyEvaluatedIconSize:Ue,collisionGroup:Ze}=a.parameters,_e=N.get("text-optional"),$e=N.get("icon-optional"),it=N.get("text-allow-overlap"),ot=N.get("icon-allow-overlap"),bt=N.get("text-rotation-alignment")==="map",wt=N.get("text-pitch-alignment")==="map",vt=N.get("icon-text-fit")!=="none",Rt=N.get("symbol-z-order")==="viewport-y";this.transform.setProjection(T.projection);let Lt=it&&(ot||!T.hasIconData()||$e),zt=ot&&(it||!T.hasTextData()||_e);!T.collisionArrays&&Le&&T.deserializeCollisionBoxes(Le),v&&S&&T.updateCollisionDebugBuffers(this.transform.zoom,Le);const mn=(Ut,an,Ht)=>{const{crossTileID:Cn,numVerticalGlyphVertices:jt}=Ut;if(te){const Li={zoom:this.transform.zoom,pitch:this.transform.pitch};let eo=null;if(te.dynamicFilterNeedsFeature){const uo=this.retainedQueryData[T.bucketInstanceId];eo=te.featureIndex.loadFeature({featureIndex:Ut.featureIndex,bucketIndex:uo.bucketIndex,sourceLayerIndex:uo.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,te.dynamicFilter)(Li,eo,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new o.Point(Ut.tileAnchorX,Ut.tileAnchorY),this.transform.calculateDistanceTileData(te.unwrappedTileID)))return this.placements[Cn]=new nu(!1,!1,!1,!0),void f.add(Cn)}if(f.has(Cn))return;if(Ae)return void(this.placements[Cn]=new nu(!1,!1,!1));let on=!1,In=!1,xn=!0,bn=!1,pr=!1,Fr=null,sr={box:null,offscreen:null,occluded:null},fr={box:null},$r=null,gi=null,Sr=null,ki=0,Ci=0,co=0;Ht.textFeatureIndex?ki=Ht.textFeatureIndex:Ut.useRuntimeCollisionCircles&&(ki=Ut.featureIndex),Ht.verticalTextFeatureIndex&&(Ci=Ht.verticalTextFeatureIndex);const Ri=Li=>{Li.tileID=this.retainedQueryData[T.bucketInstanceId].tileID;const eo=this.transform.elevation;(eo||Li.elevation)&&(Li.elevation=eo?eo.getAtTileOffset(Li.tileID,Li.tileAnchorX,Li.tileAnchorY):0)},ba=Ht.textBox;if(ba){Ri(ba);const Li=uo=>{let Ms=o.WritingMode.horizontal;if(T.allowVerticalPlacement&&!uo&&this.prevPlacement){const qa=this.prevPlacement.placedOrientations[Cn];qa&&(this.placedOrientations[Cn]=qa,Ms=qa,this.markUsedOrientation(T,Ms,Ut))}return Ms},eo=(uo,Ms)=>{if(T.allowVerticalPlacement&&jt>0&&Ht.verticalTextBox){for(const qa of T.writingModes)if(qa===o.WritingMode.vertical?(sr=Ms(),fr=sr):sr=uo(),sr&&sr.box&&sr.box.length)break}else sr=uo()};if(N.get("text-variable-anchor")){let uo=N.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Cn]){const ns=this.prevPlacement.variableOffsets[Cn];uo.indexOf(ns.anchor)>0&&(uo=uo.filter((As=>As!==ns.anchor)),uo.unshift(ns.anchor))}const Ms=(ns,As,hs)=>{const xs=T.getSymbolInstanceTextSize(Xe,Ut,this.transform.zoom,an),ls=(ns.x2-ns.x1)*xs+2*ns.padding,$l=(ns.y2-ns.y1)*xs+2*ns.padding,Il=vt&&!ot?As:null;Il&&Ri(Il);let ka={box:[],offscreen:!1,occluded:!1};const rd=it?2*uo.length:uo.length;for(let Ys=0;Ys<rd;++Ys){const Vh=this.attemptAnchorPlacement(uo[Ys%uo.length],ns,ls,$l,xs,bt,wt,ge,z,Ze,Ys>=uo.length,Ut,an,T,hs,Il,Xe,Ue);if(Vh&&(ka=Vh.placedGlyphBoxes,ka&&ka.box&&ka.box.length)){on=!0,Fr=Vh.shift;break}}return ka};eo((()=>Ms(ba,Ht.iconBox,o.WritingMode.horizontal)),(()=>{const ns=Ht.verticalTextBox;return ns&&Ri(ns),T.allowVerticalPlacement&&!(sr&&sr.box&&sr.box.length)&&jt>0&&ns?Ms(ns,Ht.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null,occluded:null}})),sr&&(on=sr.box,xn=sr.offscreen,bn=sr.occluded);const qa=Li(!(!sr||!sr.box));if(!on&&this.prevPlacement){const ns=this.prevPlacement.variableOffsets[Cn];ns&&(this.variableOffsets[Cn]=ns,this.markUsedJustification(T,ns.anchor,Ut,qa))}}else{const uo=(Ms,qa)=>{const ns=T.getSymbolInstanceTextSize(Xe,Ut,this.transform.zoom,an),As=this.collisionIndex.placeCollisionBox(T,ns,Ms,new o.Point(0,0),it,ge,z,Ze.predicate);return As&&As.box&&As.box.length&&(this.markUsedOrientation(T,qa,Ut),this.placedOrientations[Cn]=qa),As};eo((()=>uo(ba,o.WritingMode.horizontal)),(()=>{const Ms=Ht.verticalTextBox;return T.allowVerticalPlacement&&jt>0&&Ms?(Ri(Ms),uo(Ms,o.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}})),Li(!!(sr&&sr.box&&sr.box.length))}}if($r=sr,on=$r&&$r.box&&$r.box.length>0,xn=$r&&$r.offscreen,bn=$r&&$r.occluded,Ut.useRuntimeCollisionCircles){const Li=T.text.placedSymbolArray.get(Ut.centerJustifiedTextSymbolIndex>=0?Ut.centerJustifiedTextSymbolIndex:Ut.verticalPlacedTextSymbolIndex),eo=o.evaluateSizeForFeature(T.textSizeData,Xe,Li),uo=N.get("text-padding");gi=this.collisionIndex.placeCollisionCircles(T,it,Li,T.lineVertexArray,T.glyphOffsetArray,eo,z,G,ee,v,wt,Ze.predicate,Ut.collisionCircleDiameter*eo/o.ONE_EM,uo,this.retainedQueryData[T.bucketInstanceId].tileID),on=it||gi.circles.length>0&&!gi.collisionDetected,xn=xn&&gi.offscreen,bn=gi.occluded}if(Ht.iconFeatureIndex&&(co=Ht.iconFeatureIndex),Ht.iconBox){const Li=eo=>{Ri(eo);const uo=vt&&Fr?Vi(Fr.x,Fr.y,bt,wt,this.transform.angle):new o.Point(0,0),Ms=T.getSymbolInstanceIconSize(Ue,this.transform.zoom,Ut.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(T,Ms,eo,uo,ot,ge,z,Ze.predicate)};fr&&fr.box&&fr.box.length&&Ht.verticalIconBox?(Sr=Li(Ht.verticalIconBox),In=Sr.box.length>0):(Sr=Li(Ht.iconBox),In=Sr.box.length>0),xn=xn&&Sr.offscreen,pr=Sr.occluded}const ts=_e||Ut.numHorizontalGlyphVertices===0&&jt===0,cc=$e||Ut.numIconVertices===0;if(ts||cc?cc?ts||(In=In&&on):on=In&&on:In=on=In&&on,on&&$r&&$r.box&&this.collisionIndex.insertCollisionBox($r.box,N.get("text-ignore-placement"),T.bucketInstanceId,fr&&fr.box&&Ci?Ci:ki,Ze.ID),In&&Sr&&this.collisionIndex.insertCollisionBox(Sr.box,N.get("icon-ignore-placement"),T.bucketInstanceId,co,Ze.ID),gi&&(on&&this.collisionIndex.insertCollisionCircles(gi.circles,N.get("text-ignore-placement"),T.bucketInstanceId,ki,Ze.ID),v)){const Li=T.bucketInstanceId;let eo=this.collisionCircleArrays[Li];eo===void 0&&(eo=this.collisionCircleArrays[Li]=new _c);for(let uo=0;uo<gi.circles.length;uo+=4)eo.circles.push(gi.circles[uo+0]),eo.circles.push(gi.circles[uo+1]),eo.circles.push(gi.circles[uo+2]),eo.circles.push(gi.collisionDetected?1:0)}const Cc=T.projection.name!=="globe";Lt=Lt&&(Cc||!bn),zt=zt&&(Cc||!pr),this.placements[Cn]=new nu(on||Lt,In||zt,xn||T.justReloaded),f.add(Cn)};if(Rt){const Ut=T.getSortedSymbolIndexes(this.transform.angle);for(let an=Ut.length-1;an>=0;--an){const Ht=Ut[an];mn(T.symbolInstances.get(Ht),Ht,T.collisionArrays[Ht])}}else for(let Ut=a.symbolInstanceStart;Ut<a.symbolInstanceEnd;Ut++)mn(T.symbolInstances.get(Ut),Ut,T.collisionArrays[Ut]);if(v&&T.bucketInstanceId in this.collisionCircleArrays){const Ut=this.collisionCircleArrays[T.bucketInstanceId];o.invert(Ut.invProjMatrix,z),Ut.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(a,f,v,S){const{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:N,rightJustifiedTextSymbolIndex:z,verticalPlacedTextSymbolIndex:G,crossTileID:ee}=v,te=o.getAnchorJustification(f),ge=S===o.WritingMode.vertical?G:te==="left"?T:te==="center"?N:te==="right"?z:-1;T>=0&&(a.text.placedSymbolArray.get(T).crossTileID=ge>=0&&T!==ge?0:ee),N>=0&&(a.text.placedSymbolArray.get(N).crossTileID=ge>=0&&N!==ge?0:ee),z>=0&&(a.text.placedSymbolArray.get(z).crossTileID=ge>=0&&z!==ge?0:ee),G>=0&&(a.text.placedSymbolArray.get(G).crossTileID=ge>=0&&G!==ge?0:ee)}markUsedOrientation(a,f,v){const S=f===o.WritingMode.horizontal||f===o.WritingMode.horizontalOnly?f:0,T=f===o.WritingMode.vertical?f:0,{leftJustifiedTextSymbolIndex:N,centerJustifiedTextSymbolIndex:z,rightJustifiedTextSymbolIndex:G,verticalPlacedTextSymbolIndex:ee}=v,te=a.text.placedSymbolArray;N>=0&&(te.get(N).placedOrientation=S),z>=0&&(te.get(z).placedOrientation=S),G>=0&&(te.get(G).placedOrientation=S),ee>=0&&(te.get(ee).placedOrientation=T)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let v=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const S=f?f.symbolFadeChange(a):1,T=f?f.opacities:{},N=f?f.variableOffsets:{},z=f?f.placedOrientations:{};for(const G in this.placements){const ee=this.placements[G],te=T[G];te?(this.opacities[G]=new ec(te,S,ee.text,ee.icon,null,ee.clipped),v=v||ee.text!==te.text.placed||ee.icon!==te.icon.placed):(this.opacities[G]=new ec(null,S,ee.text,ee.icon,ee.skipFade,ee.clipped),v=v||ee.text||ee.icon)}for(const G in T){const ee=T[G];if(!this.opacities[G]){const te=new ec(ee,S,!1,!1);te.isHidden()||(this.opacities[G]=te,v=v||ee.text.placed||ee.icon.placed)}}for(const G in N)this.variableOffsets[G]||!this.opacities[G]||this.opacities[G].isHidden()||(this.variableOffsets[G]=N[G]);for(const G in z)this.placedOrientations[G]||!this.opacities[G]||this.opacities[G].isHidden()||(this.placedOrientations[G]=z[G]);v?this.lastPlacementChangeTime=a:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:a)}updateLayerOpacities(a,f){const v=new Set;for(const S of f){const T=S.getBucket(a);T&&S.latestFeatureIndex&&a.id===T.layerIds[0]&&this.updateBucketOpacities(T,v,S.collisionBoxArray)}}updateBucketOpacities(a,f,v){a.hasTextData()&&a.text.opacityVertexArray.clear(),a.hasIconData()&&a.icon.opacityVertexArray.clear(),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const S=a.layers[0].layout,T=!!a.layers[0].dynamicFilter(),N=new ec(null,0,!1,!1,!0),z=S.get("text-allow-overlap"),G=S.get("icon-allow-overlap"),ee=S.get("text-variable-anchor"),te=S.get("text-rotation-alignment")==="map",ge=S.get("text-pitch-alignment")==="map",Ae=S.get("icon-text-fit")!=="none",Le=new ec(null,0,z&&(G||!a.hasIconData()||S.get("icon-optional")),G&&(z||!a.hasTextData()||S.get("text-optional")),!0);!a.collisionArrays&&v&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(v);const Xe=(Ze,_e,$e)=>{for(let it=0;it<_e/4;it++)Ze.opacityVertexArray.emplaceBack($e)};let Ue=0;for(let Ze=0;Ze<a.symbolInstances.length;Ze++){const _e=a.symbolInstances.get(Ze),{numHorizontalGlyphVertices:$e,numVerticalGlyphVertices:it,crossTileID:ot,numIconVertices:bt}=_e,wt=f.has(ot);let vt=this.opacities[ot];wt?vt=N:vt||(vt=Le,this.opacities[ot]=vt),f.add(ot);const Rt=$e>0||it>0,Lt=bt>0,zt=this.placedOrientations[ot],mn=zt===o.WritingMode.vertical,Ut=zt===o.WritingMode.horizontal||zt===o.WritingMode.horizontalOnly;if(!Rt&&!Lt||vt.isHidden()||Ue++,Rt){const an=Go(vt.text);Xe(a.text,$e,mn?vo:an),Xe(a.text,it,Ut?vo:an);const Ht=vt.text.isHidden(),{leftJustifiedTextSymbolIndex:Cn,centerJustifiedTextSymbolIndex:jt,rightJustifiedTextSymbolIndex:on,verticalPlacedTextSymbolIndex:In}=_e,xn=a.text.placedSymbolArray,bn=Ht||mn?1:0;Cn>=0&&(xn.get(Cn).hidden=bn),jt>=0&&(xn.get(jt).hidden=bn),on>=0&&(xn.get(on).hidden=bn),In>=0&&(xn.get(In).hidden=Ht||Ut?1:0);const pr=this.variableOffsets[ot];pr&&this.markUsedJustification(a,pr.anchor,_e,zt);const Fr=this.placedOrientations[ot];Fr&&(this.markUsedJustification(a,"left",_e,Fr),this.markUsedOrientation(a,Fr,_e))}if(Lt){const an=Go(vt.icon),{placedIconSymbolIndex:Ht,verticalPlacedIconSymbolIndex:Cn}=_e,jt=a.icon.placedSymbolArray,on=vt.icon.isHidden()?1:0;Ht>=0&&(Xe(a.icon,bt,mn?vo:an),jt.get(Ht).hidden=on),Cn>=0&&(Xe(a.icon,_e.numVerticalIconVertices,Ut?vo:an),jt.get(Cn).hidden=on)}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const an=a.collisionArrays[Ze];if(an){let Ht=new o.Point(0,0),Cn=!0;if(an.textBox||an.verticalTextBox){if(ee){const on=this.variableOffsets[ot];on?(Ht=Ls(on.anchor,on.width,on.height,on.textOffset,on.textScale),te&&Ht._rotate(ge?this.transform.angle:-this.transform.angle)):Cn=!1}T&&(Cn=!vt.clipped),an.textBox&&ai(a.textCollisionBox.collisionVertexArray,vt.text.placed,!Cn||mn,Ht.x,Ht.y),an.verticalTextBox&&ai(a.textCollisionBox.collisionVertexArray,vt.text.placed,!Cn||Ut,Ht.x,Ht.y)}const jt=Cn&&!!(!Ut&&an.verticalIconBox);an.iconBox&&ai(a.iconCollisionBox.collisionVertexArray,vt.icon.placed,jt,Ae?Ht.x:0,Ae?Ht.y:0),an.verticalIconBox&&ai(a.iconCollisionBox.collisionVertexArray,vt.icon.placed,!jt,Ae?Ht.x:0,Ae?Ht.y:0)}}}if(a.fullyClipped=Ue===0,a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.bucketInstanceId in this.collisionCircleArrays){const Ze=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=Ze.invProjMatrix,a.placementViewportMatrix=Ze.viewportMatrix,a.collisionCircleArray=Ze.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return this.fadeDuration===0?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,f){const v=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*v>a}setStale(){this.stale=!0}}function ai(y,a,f,v,S){y.emplaceBack(a?1:0,f?1:0,v||0,S||0),y.emplaceBack(a?1:0,f?1:0,v||0,S||0),y.emplaceBack(a?1:0,f?1:0,v||0,S||0),y.emplaceBack(a?1:0,f?1:0,v||0,S||0)}const Zo=Math.pow(2,25),Ao=Math.pow(2,24),Ih=Math.pow(2,17),Pu=Math.pow(2,16),_o=Math.pow(2,9),Us=Math.pow(2,8),ku=Math.pow(2,1);function Go(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const a=y.placed?1:0,f=Math.floor(127*y.opacity);return f*Zo+a*Ao+f*Ih+a*Pu+f*_o+a*Us+f*ku+a}const vo=0;class Dl{constructor(a){this._sortAcrossTiles=a.layout.get("symbol-z-order")!=="viewport-y"&&a.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(a,f,v,S,T){const N=this._bucketParts;for(;this._currentTileIndex<a.length;)if(f.getBucketParts(N,S,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,T())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,N.sort(((z,G)=>z.sortKey-G.sortKey)));this._currentPartIndex<N.length;){const z=N[this._currentPartIndex];if(f.placeLayerBucketPart(z,this._seenCrossTileIDs,v,z.symbolInstanceStart===0),this._currentPartIndex++,T())return!0}return!1}}class Oa{constructor(a,f,v,S,T,N,z,G){this.placement=new Fa(a,T,N,z,G),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=S,this._done=!1}isDone(){return this._done}continuePlacement(a,f,v){const S=o.exported.now(),T=()=>{const N=o.exported.now()-S;return!this._forceFullPlacement&&N>2};for(;this._currentPlacementIndex>=0;){const N=f[a[this._currentPlacementIndex]],z=this.placement.collisionIndex.transform.zoom;if(N.type==="symbol"&&(!N.minzoom||N.minzoom<=z)&&(!N.maxzoom||N.maxzoom>z)){if(this._inProgressLayer||(this._inProgressLayer=new Dl(N)),this._inProgressLayer.continuePlacement(v[N.source],this.placement,this._showCollisionBoxes,N,T))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const Vs=512/o.EXTENT/2;class Bo{constructor(a,f,v){this.tileID=a,this.bucketInstanceId=v,this.index=new o.KDBush(f.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const S=a.canonical.x*o.EXTENT,T=a.canonical.y*o.EXTENT;for(let N=0;N<f.length;N++){const{key:z,crossTileID:G,tileAnchorX:ee,tileAnchorY:te}=f.get(N),ge=Math.floor((S+ee)*Vs),Ae=Math.floor((T+te)*Vs);this.index.add(ge,Ae),this.keys.push(z),this.crossTileIDs.push(G)}this.index.finish()}findMatches(a,f,v){const S=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),T=Vs/Math.pow(2,f.canonical.z-this.tileID.canonical.z),N=f.canonical.x*o.EXTENT,z=f.canonical.y*o.EXTENT;for(let G=0;G<a.length;G++){const ee=a.get(G);if(ee.crossTileID)continue;const{key:te,tileAnchorX:ge,tileAnchorY:Ae}=ee,Le=Math.floor((N+ge)*T),Xe=Math.floor((z+Ae)*T),Ue=this.index.range(Le-S,Xe-S,Le+S,Xe+S);for(const Ze of Ue){const _e=this.crossTileIDs[Ze];if(this.keys[Ze]===te&&!v.has(_e)){v.add(_e),ee.crossTileID=_e;break}}}}}class Bc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ho{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const f=Math.round((a-this.lng)/360);if(f!==0)for(const v in this.indexes){const S=this.indexes[v],T={};for(const N in S){const z=S[N];z.tileID=z.tileID.unwrapTo(z.tileID.wrap+f),T[z.tileID.key]=z}this.indexes[v]=T}this.lng=a}addBucket(a,f,v){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let T=0;T<f.symbolInstances.length;T++)f.symbolInstances.get(T).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]=new Set);const S=this.usedCrossTileIDs[a.overscaledZ];for(const T in this.indexes){const N=this.indexes[T];if(Number(T)>a.overscaledZ)for(const z in N){const G=N[z];G.tileID.isChildOf(a)&&G.findMatches(f.symbolInstances,a,S)}else{const z=N[a.scaledTo(Number(T)).key];z&&z.findMatches(f.symbolInstances,a,S)}}for(let T=0;T<f.symbolInstances.length;T++){const N=f.symbolInstances.get(T);N.crossTileID||(N.crossTileID=v.generate(),S.add(N.crossTileID))}return this.indexes[a.overscaledZ]===void 0&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new Bo(a,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(a,f){for(const v of f.crossTileIDs)this.usedCrossTileIDs[a].delete(v)}removeStaleBuckets(a){let f=!1;for(const v in this.indexes){const S=this.indexes[v];for(const T in S)a[S[T].bucketInstanceId]||(this.removeBucketCrossTileIDs(v,S[T]),delete S[T],f=!0)}return f}}class ya{constructor(){this.layerIndexes={},this.crossTileIDs=new Bc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,f,v,S){let T=this.layerIndexes[a.id];T===void 0&&(T=this.layerIndexes[a.id]=new Ho);let N=!1;const z={};S.name!=="globe"&&T.handleWrapJump(v);for(const G of f){const ee=G.getBucket(a);ee&&a.id===ee.layerIds[0]&&(ee.bucketInstanceId||(ee.bucketInstanceId=++this.maxBucketInstanceId),T.addBucket(G.tileID,ee,this.crossTileIDs)&&(N=!0),z[ee.bucketInstanceId]=!0)}return T.removeStaleBuckets(z)&&(N=!0),N}pruneUnusedLayers(a){const f={};a.forEach((v=>{f[v]=!0}));for(const v in this.layerIndexes)f[v]||delete this.layerIndexes[v]}}const Ja=(y,a)=>o.emitValidationErrors(y,a&&a.filter((f=>f.identifier!=="source.canvas"))),ll=o.pick(Wi,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),ru=o.pick(Wi,["setCenter","setZoom","setBearing","setPitch"]),vc={version:8,layers:[],sources:{}},qs={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Ti extends o.Evented{constructor(a,f={}){super(),this.map=a,this.dispatcher=new xe(ga(),this),this.imageManager=new H,this.imageManager.setEventedParent(this),this.glyphManager=new o.GlyphManager(a._requestManager,f.localFontFamily?o.LocalGlyphMode.all:f.localIdeographFontFamily?o.LocalGlyphMode.ideographs:o.LocalGlyphMode.none,f.localFontFamily||f.localIdeographFontFamily),this.crossTileSymbolIndex=new ya,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const v=this;this._rtlTextPluginCallback=Ti.registerForPluginStateChange((S=>{v.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:S.pluginStatus,pluginURL:S.pluginURL},((T,N)=>{if(o.triggerPluginCompletionEvent(T),N&&N.every((z=>z)))for(const z in v._sourceCaches){const G=v._sourceCaches[z],ee=G.getSource().type;ee!=="vector"&&ee!=="geojson"||G.reload()}}))})),this.on("data",(S=>{if(S.dataType!=="source"||S.sourceDataType!=="metadata")return;const T=this.getSource(S.sourceId);if(T&&T.vectorLayerIds)for(const N in this._layers){const z=this._layers[N];z.source===T.id&&this._validateLayer(z)}}))}loadURL(a,f={}){this.fire(new o.Event("dataloading",{dataType:"style"}));const v=typeof f.validate=="boolean"?f.validate:!o.isMapboxURL(a);a=this.map._requestManager.normalizeStyleURL(a,f.accessToken);const S=this.map._requestManager.transformRequest(a,o.ResourceType.Style);this._request=o.getJSON(S,((T,N)=>{this._request=null,T?this.fire(new o.ErrorEvent(T)):N&&this._load(N,v)}))}loadJSON(a,f={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame((()=>{this._request=null,this._load(a,f.validate!==!1)}))}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(vc,!1)}_updateLayerCount(a,f){const v=f?1:-1;a.is3D()&&(this._num3DLayers+=v),a.type==="circle"&&(this._numCircleLayers+=v),a.type==="symbol"&&(this._numSymbolLayers+=v)}_load(a,f){if(f&&Ja(this,o.validateStyle(a)))return;this._loaded=!0,this.stylesheet=o.clone$1(a),this._updateMapProjection();for(const S in a.sources)this.addSource(S,a.sources[S],{validate:!1});this._changed=!1,a.sprite?this._loadSprite(a.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(a.glyphs);const v=sl(this.stylesheet.layers);this._order=v.map((S=>S.id)),this._layers={},this._serializedLayers={};for(const S of v){const T=o.createStyleLayer(S);T.setEventedParent(this,{layer:{id:T.id}}),this._layers[T.id]=T,this._serializedLayers[T.id]=T.serialize(),this._updateLayerCount(T,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new be(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(a){a?this.stylesheet.projection=a:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(a){this._spriteRequest=(function(f,v,S){let T,N,z;const G=o.exported.devicePixelRatio>1?"@2x":"";let ee=o.getJSON(v.transformRequest(v.normalizeSpriteURL(f,G,".json"),o.ResourceType.SpriteJSON),((Ae,Le)=>{ee=null,z||(z=Ae,T=Le,ge())})),te=o.getImage(v.transformRequest(v.normalizeSpriteURL(f,G,".png"),o.ResourceType.SpriteImage),((Ae,Le)=>{te=null,z||(z=Ae,N=Le,ge())}));function ge(){if(z)S(z);else if(T&&N){const Ae=o.exported.getImageData(N),Le={};for(const Xe in T){const{width:Ue,height:Ze,x:_e,y:$e,sdf:it,pixelRatio:ot,stretchX:bt,stretchY:wt,content:vt}=T[Xe],Rt=new o.RGBAImage({width:Ue,height:Ze});o.RGBAImage.copy(Ae,Rt,{x:_e,y:$e},{x:0,y:0},{width:Ue,height:Ze}),Le[Xe]={data:Rt,pixelRatio:ot,sdf:it,stretchX:bt,stretchY:wt,content:vt}}S(null,Le)}}return{cancel(){ee&&(ee.cancel(),ee=null),te&&(te.cancel(),te=null)}}})(a,this.map._requestManager,((f,v)=>{if(this._spriteRequest=null,f)this.fire(new o.ErrorEvent(f));else if(v)for(const S in v)this.imageManager.addImage(S,v[S]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new o.Event("data",{dataType:"style"}))}))}_validateLayer(a){const f=this.getSource(a.source);if(!f)return;const v=a.sourceLayer;v&&(f.type==="geojson"||f.vectorLayerIds&&f.vectorLayerIds.indexOf(v)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${v}" does not exist on source "${f.id}" as specified by style layer "${a.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const a in this._sourceCaches)if(!this._sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(a){const f=[];for(const v of a){const S=this._layers[v];S.type!=="custom"&&f.push(S.serialize())}return f}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const a in this._sourceCaches)if(this._sourceCaches[a].hasTransition())return!0;for(const a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(a){return!!this.terrain&&(typeof a.isLayerDraped=="function"?a.isLayerDraped():qs[a.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(a){if(!this._loaded)return;const f=this._changed;if(this._changed){const S=Object.keys(this._updatedLayers),T=Object.keys(this._removedLayers);(S.length||T.length)&&this._updateWorkerLayers(S,T);for(const N in this._updatedSources){const z=this._updatedSources[N];z==="reload"?this._reloadSource(N):z==="clear"&&this._clearSource(N)}this._updateTilesForChangedImages();for(const N in this._updatedPaintProps)this._layers[N].updateTransitions(a);this.light.updateTransitions(a),this.fog&&this.fog.updateTransitions(a),this._resetUpdates()}const v={};for(const S in this._sourceCaches){const T=this._sourceCaches[S];v[S]=T.used,T.used=!1}for(const S of this._order){const T=this._layers[S];if(T.recalculate(a,this._availableImages),!T.isHidden(a.zoom)){const z=this._getLayerSourceCache(T);z&&(z.used=!0)}const N=this.map.painter;if(N){const z=T.getProgramIds();if(!z)continue;const G=T.getProgramConfiguration(a.zoom);for(const ee of z)N.useProgram(ee,G)}}for(const S in v){const T=this._sourceCaches[S];v[S]!==T.used&&T.getSource().fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:T.getSource().id}))}this.light.recalculate(a),this.terrain&&this.terrain.recalculate(a),this.fog&&this.fog.recalculate(a),this.z=a.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),f&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const a=Object.keys(this._changedImages);if(a.length){for(const f in this._sourceCaches)this._sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}}_updateWorkerLayers(a,f){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(a),removedIds:f})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(a){if(this._checkLoaded(),Ja(this,o.validateStyle(a)))return!1;(a=o.clone$1(a)).layers=sl(a.layers);const f=(function(S,T){if(!S)return[{command:Wi.setStyle,args:[T]}];let N=[];try{if(!b(S.version,T.version))return[{command:Wi.setStyle,args:[T]}];b(S.center,T.center)||N.push({command:Wi.setCenter,args:[T.center]}),b(S.zoom,T.zoom)||N.push({command:Wi.setZoom,args:[T.zoom]}),b(S.bearing,T.bearing)||N.push({command:Wi.setBearing,args:[T.bearing]}),b(S.pitch,T.pitch)||N.push({command:Wi.setPitch,args:[T.pitch]}),b(S.sprite,T.sprite)||N.push({command:Wi.setSprite,args:[T.sprite]}),b(S.glyphs,T.glyphs)||N.push({command:Wi.setGlyphs,args:[T.glyphs]}),b(S.transition,T.transition)||N.push({command:Wi.setTransition,args:[T.transition]}),b(S.light,T.light)||N.push({command:Wi.setLight,args:[T.light]}),b(S.fog,T.fog)||N.push({command:Wi.setFog,args:[T.fog]}),b(S.projection,T.projection)||N.push({command:Wi.setProjection,args:[T.projection]});const z={},G=[];(function(ge,Ae,Le,Xe){let Ue;for(Ue in Ae=Ae||{},ge=ge||{})ge.hasOwnProperty(Ue)&&(Ae.hasOwnProperty(Ue)||Lu(Ue,Le,Xe));for(Ue in Ae){if(!Ae.hasOwnProperty(Ue))continue;const Ze=Ae[Ue];ge.hasOwnProperty(Ue)?b(ge[Ue],Ze)||(ge[Ue].type==="geojson"&&Ze.type==="geojson"&&fu(ge,Ae,Ue)?Le.push({command:Wi.setGeoJSONSourceData,args:[Ue,Ze.data]}):Eo(Ue,Ae,Le,Xe)):Jl(Ue,Ae,Le)}})(S.sources,T.sources,G,z);const ee=[];S.layers&&S.layers.forEach((ge=>{ge.source&&z[ge.source]?N.push({command:Wi.removeLayer,args:[ge.id]}):ee.push(ge)}));let te=S.terrain;te&&z[te.source]&&(N.push({command:Wi.setTerrain,args:[void 0]}),te=void 0),N=N.concat(G),b(te,T.terrain)||N.push({command:Wi.setTerrain,args:[T.terrain]}),(function(ge,Ae,Le){Ae=Ae||[];const Xe=(ge=ge||[]).map(Ko),Ue=Ae.map(Ko),Ze=ge.reduce(Xa,{}),_e=Ae.reduce(Xa,{}),$e=Xe.slice(),it=Object.create(null);let ot,bt,wt,vt,Rt,Lt,zt;for(ot=0,bt=0;ot<Xe.length;ot++)wt=Xe[ot],_e.hasOwnProperty(wt)?bt++:(Le.push({command:Wi.removeLayer,args:[wt]}),$e.splice($e.indexOf(wt,bt),1));for(ot=0,bt=0;ot<Ue.length;ot++)wt=Ue[Ue.length-1-ot],$e[$e.length-1-ot]!==wt&&(Ze.hasOwnProperty(wt)?(Le.push({command:Wi.removeLayer,args:[wt]}),$e.splice($e.lastIndexOf(wt,$e.length-bt),1)):bt++,Lt=$e[$e.length-ot],Le.push({command:Wi.addLayer,args:[_e[wt],Lt]}),$e.splice($e.length-ot,0,wt),it[wt]=!0);for(ot=0;ot<Ue.length;ot++)if(wt=Ue[ot],vt=Ze[wt],Rt=_e[wt],!it[wt]&&!b(vt,Rt))if(b(vt.source,Rt.source)&&b(vt["source-layer"],Rt["source-layer"])&&b(vt.type,Rt.type)){for(zt in Ea(vt.layout,Rt.layout,Le,wt,null,Wi.setLayoutProperty),Ea(vt.paint,Rt.paint,Le,wt,null,Wi.setPaintProperty),b(vt.filter,Rt.filter)||Le.push({command:Wi.setFilter,args:[wt,Rt.filter]}),b(vt.minzoom,Rt.minzoom)&&b(vt.maxzoom,Rt.maxzoom)||Le.push({command:Wi.setLayerZoomRange,args:[wt,Rt.minzoom,Rt.maxzoom]}),vt)vt.hasOwnProperty(zt)&&zt!=="layout"&&zt!=="paint"&&zt!=="filter"&&zt!=="metadata"&&zt!=="minzoom"&&zt!=="maxzoom"&&(zt.indexOf("paint.")===0?Ea(vt[zt],Rt[zt],Le,wt,zt.slice(6),Wi.setPaintProperty):b(vt[zt],Rt[zt])||Le.push({command:Wi.setLayerProperty,args:[wt,zt,Rt[zt]]}));for(zt in Rt)Rt.hasOwnProperty(zt)&&!vt.hasOwnProperty(zt)&&zt!=="layout"&&zt!=="paint"&&zt!=="filter"&&zt!=="metadata"&&zt!=="minzoom"&&zt!=="maxzoom"&&(zt.indexOf("paint.")===0?Ea(vt[zt],Rt[zt],Le,wt,zt.slice(6),Wi.setPaintProperty):b(vt[zt],Rt[zt])||Le.push({command:Wi.setLayerProperty,args:[wt,zt,Rt[zt]]}))}else Le.push({command:Wi.removeLayer,args:[wt]}),Lt=$e[$e.lastIndexOf(wt)+1],Le.push({command:Wi.addLayer,args:[Rt,Lt]})})(ee,T.layers,N)}catch(z){console.warn("Unable to compute style diff:",z),N=[{command:Wi.setStyle,args:[T]}]}return N})(this.serialize(),a).filter((S=>!(S.command in ru)));if(f.length===0)return!1;const v=f.filter((S=>!(S.command in ll)));if(v.length>0)throw new Error(`Unimplemented: ${v.map((S=>S.command)).join(", ")}.`);return f.forEach((S=>{S.command!=="setTransition"&&S.command!=="setProjection"&&this[S.command].apply(this,S.args)})),this.stylesheet=a,this._updateMapProjection(),!0}addImage(a,f){return this.getImage(a)?this.fire(new o.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(a,f),this._afterImageUpdated(a),this)}updateImage(a,f){this.imageManager.updateImage(a,f)}getImage(a){return this.imageManager.getImage(a)}removeImage(a){return this.getImage(a)?(this.imageManager.removeImage(a),this._afterImageUpdated(a),this):this.fire(new o.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(a,f,v={}){if(this._checkLoaded(),this.getSource(a)!==void 0)throw new Error("There is already a source with this ID");if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(o.validateSource,`sources.${a}`,f,null,v))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const S=Ar(a,f,this.dispatcher,this);S.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(a),source:S.serialize(),sourceId:a})));const T=N=>{const z=(N?"symbol:":"other:")+a,G=this._sourceCaches[z]=new o.SourceCache(z,S,N);(N?this._symbolSourceCaches:this._otherSourceCaches)[a]=G,G.style=this,G.onAdd(this.map)};T(!1),f.type!=="vector"&&f.type!=="geojson"||T(!0),S.onAdd&&S.onAdd(this.map),this._changed=!0}removeSource(a){this._checkLoaded();const f=this.getSource(a);if(!f)throw new Error("There is no source with this ID");for(const S in this._layers)if(this._layers[S].source===a)return this.fire(new o.ErrorEvent(new Error(`Source "${a}" cannot be removed while layer "${S}" is using it.`)));if(this.terrain&&this.terrain.get().source===a)return this.fire(new o.ErrorEvent(new Error(`Source "${a}" cannot be removed while terrain is using it.`)));const v=this._getSourceCaches(a);for(const S of v)delete this._sourceCaches[S.id],delete this._updatedSources[S.id],S.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:S.getSource().id})),S.setEventedParent(null),S.clearTiles();return delete this._otherSourceCaches[a],delete this._symbolSourceCaches[a],f.setEventedParent(null),f.onRemove&&f.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(a,f){this._checkLoaded(),this.getSource(a).setData(f),this._changed=!0}getSource(a){const f=this._getSourceCache(a);return f&&f.getSource()}_getSources(){const a=[];for(const f in this._otherSourceCaches){const v=this._getSourceCache(f);v&&a.push(v.getSource())}return a}addLayer(a,f,v={}){this._checkLoaded();const S=a.id;if(this.getLayer(S))return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${S}" already exists on this map`)));let T;if(a.type==="custom"){if(Ja(this,o.validateCustomStyleLayer(a)))return;T=o.createStyleLayer(a)}else{if(typeof a.source=="object"&&(this.addSource(S,a.source),a=o.clone$1(a),a=o.extend(a,{source:S})),this._validate(o.validateLayer,`layers.${S}`,a,{arrayIndex:-1},v))return;T=o.createStyleLayer(a),this._validateLayer(T),T.setEventedParent(this,{layer:{id:S}}),this._serializedLayers[T.id]=T.serialize(),this._updateLayerCount(T,!0)}const N=f?this._order.indexOf(f):this._order.length;if(f&&N===-1)return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${f}" does not exist on this map.`)));this._order.splice(N,0,S),this._layerOrderChanged=!0,this._layers[S]=T;const z=this._getLayerSourceCache(T);if(this._removedLayers[S]&&T.source&&z&&T.type!=="custom"){const G=this._removedLayers[S];delete this._removedLayers[S],G.type!==T.type?this._updatedSources[T.source]="clear":(this._updatedSources[T.source]="reload",z.pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(a,f){if(this._checkLoaded(),this._changed=!0,!this._layers[a])return void this.fire(new o.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be moved.`)));if(a===f)return;const v=this._order.indexOf(a);this._order.splice(v,1);const S=f?this._order.indexOf(f):this._order.length;f&&S===-1?this.fire(new o.ErrorEvent(new Error(`Layer with id "${f}" does not exist on this map.`))):(this._order.splice(S,0,a),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(a){this._checkLoaded();const f=this._layers[a];if(!f)return void this.fire(new o.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be removed.`)));f.setEventedParent(null),this._updateLayerCount(f,!1);const v=this._order.indexOf(a);this._order.splice(v,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=f,delete this._layers[a],delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],f.onRemove&&f.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(a){return this._layers[a]}hasLayer(a){return a in this._layers}hasLayerType(a){for(const f in this._layers)if(this._layers[f].type===a)return!0;return!1}setLayerZoomRange(a,f,v){this._checkLoaded();const S=this.getLayer(a);S?S.minzoom===f&&S.maxzoom===v||(f!=null&&(S.minzoom=f),v!=null&&(S.maxzoom=v),this._updateLayer(S)):this.fire(new o.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(a,f,v={}){this._checkLoaded();const S=this.getLayer(a);if(S){if(!b(S.filter,f))return f==null?(S.filter=void 0,void this._updateLayer(S)):void(this._validate(o.validateFilter,`layers.${S.id}.filter`,f,{layerType:S.type},v)||(S.filter=o.clone$1(f),this._updateLayer(S)))}else this.fire(new o.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be filtered.`)))}getFilter(a){const f=this.getLayer(a);return f&&o.clone$1(f.filter)}setLayoutProperty(a,f,v,S={}){this._checkLoaded();const T=this.getLayer(a);T?b(T.getLayoutProperty(f),v)||(T.setLayoutProperty(f,v,S),this._updateLayer(T)):this.fire(new o.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(a,f){const v=this.getLayer(a);if(v)return v.getLayoutProperty(f);this.fire(new o.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style.`)))}setPaintProperty(a,f,v,S={}){this._checkLoaded();const T=this.getLayer(a);T?b(T.getPaintProperty(f),v)||(T.setPaintProperty(f,v,S)&&this._updateLayer(T),this._changed=!0,this._updatedPaintProps[a]=!0):this.fire(new o.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(a,f){const v=this.getLayer(a);return v&&v.getPaintProperty(f)}setFeatureState(a,f){this._checkLoaded();const v=a.source,S=a.sourceLayer,T=this.getSource(v);if(!T)return void this.fire(new o.ErrorEvent(new Error(`The source '${v}' does not exist in the map's style.`)));const N=T.type;if(N==="geojson"&&S)return void this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(N==="vector"&&!S)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));a.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided.")));const z=this._getSourceCaches(v);for(const G of z)G.setFeatureState(S,a.id,f)}removeFeatureState(a,f){this._checkLoaded();const v=a.source,S=this.getSource(v);if(!S)return void this.fire(new o.ErrorEvent(new Error(`The source '${v}' does not exist in the map's style.`)));const T=S.type,N=T==="vector"?a.sourceLayer:void 0;if(T==="vector"&&!N)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(f&&typeof a.id!="string"&&typeof a.id!="number")return void this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const z=this._getSourceCaches(v);for(const G of z)G.removeFeatureState(N,a.id,f)}getFeatureState(a){this._checkLoaded();const f=a.source,v=a.sourceLayer,S=this.getSource(f);if(S){if(S.type!=="vector"||v)return a.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(f)[0].getFeatureState(v,a.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const a={};for(const f in this._sourceCaches){const v=this._sourceCaches[f].getSource();a[v.id]||(a[v.id]=v.serialize())}return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:a,layers:this._serializeLayers(this._order)},(f=>f!==void 0))}_updateLayer(a){this._updatedLayers[a.id]=!0;const f=this._getLayerSourceCache(a);a.source&&!this._updatedSources[a.source]&&f&&f.getSource().type!=="raster"&&(this._updatedSources[a.source]="reload",f.pause()),this._changed=!0,a.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(a){const f=N=>this._layers[N].type==="fill-extrusion",v={},S=[];for(let N=this._order.length-1;N>=0;N--){const z=this._order[N];if(f(z)){v[z]=N;for(const G of a){const ee=G[z];if(ee)for(const te of ee)S.push(te)}}}S.sort(((N,z)=>z.intersectionZ-N.intersectionZ));const T=[];for(let N=this._order.length-1;N>=0;N--){const z=this._order[N];if(f(z))for(let G=S.length-1;G>=0;G--){const ee=S[G].feature;if(v[ee.layer.id]<N)break;T.push(ee),S.pop()}else for(const G of a){const ee=G[z];if(ee)for(const te of ee)T.push(te.feature)}}return T}queryRenderedFeatures(a,f,v){f&&f.filter&&this._validate(o.validateFilter,"queryRenderedFeatures.filter",f.filter,null,f);const S={};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const G of f.layers){const ee=this._layers[G];if(!ee)return this.fire(new o.ErrorEvent(new Error(`The layer '${G}' does not exist in the map's style and cannot be queried for features.`))),[];S[ee.source]=!0}}const T=[];f.availableImages=this._availableImages;const N=f&&f.layers?f.layers.some((G=>{const ee=this.getLayer(G);return ee&&ee.is3D()})):this.has3DLayers(),z=De.createFromScreenPoints(a,v);for(const G in this._sourceCaches){const ee=this._sourceCaches[G].getSource().id;f.layers&&!S[ee]||T.push(no(this._sourceCaches[G],this._layers,this._serializedLayers,z,f,v,N,!!this.map._showQueryGeometry))}return this.placement&&T.push((function(G,ee,te,ge,Ae,Le,Xe){const Ue={},Ze=Le.queryRenderedSymbols(ge),_e=[];for(const $e of Object.keys(Ze).map(Number))_e.push(Xe[$e]);_e.sort($o);for(const $e of _e){const it=$e.featureIndex.lookupSymbolFeatures(Ze[$e.bucketInstanceId],ee,$e.bucketIndex,$e.sourceLayerIndex,Ae.filter,Ae.layers,Ae.availableImages,G);for(const ot in it){const bt=Ue[ot]=Ue[ot]||[],wt=it[ot];wt.sort(((vt,Rt)=>{const Lt=$e.featureSortOrder;if(Lt){const zt=Lt.indexOf(vt.featureIndex);return Lt.indexOf(Rt.featureIndex)-zt}return Rt.featureIndex-vt.featureIndex}));for(const vt of wt)bt.push(vt)}}for(const $e in Ue)Ue[$e].forEach((it=>{const ot=it.feature,bt=te(G[$e]);if(!bt)return;const wt=bt.getFeatureState(ot.layer["source-layer"],ot.id);ot.source=ot.layer.source,ot.layer["source-layer"]&&(ot.sourceLayer=ot.layer["source-layer"]),ot.state=wt}));return Ue})(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),z.screenGeometry,f,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(T)}querySourceFeatures(a,f){f&&f.filter&&this._validate(o.validateFilter,"querySourceFeatures.filter",f.filter,null,f);const v=this._getSourceCaches(a);let S=[];for(const T of v)S=S.concat(yo(T,f));return S}addSourceType(a,f,v){return Ti.getSourceType(a)?v(new Error(`A source type called "${a}" already exists.`)):(Ti.setSourceType(a,f),f.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:f.workerSourceURL},v):v(null,null))}getLight(){return this.light.getLight()}setLight(a,f={}){this._checkLoaded();const v=this.light.getLight();let S=!1;for(const N in a)if(!b(a[N],v[N])){S=!0;break}if(!S)return;const T=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(a,f),this.light.updateTransitions(T)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(a,f=1){if(this._checkLoaded(),!a)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let v=a;if(f===1){if(typeof v.source=="object"){const S="terrain-dem-src";this.addSource(S,v.source),v=o.clone$1(v),v=o.extend(v,{source:S})}if(this._validate(o.validateTerrain,"terrain",v))return}if(!this.terrain||this.terrain&&f!==this.terrain.drapeRenderMode){if(!v)return;this._createTerrain(v,f)}else{const S=this.terrain,T=S.get();for(const N of Object.keys(o.spec.terrain))!v.hasOwnProperty(N)&&o.spec.terrain[N].default&&(v[N]=o.spec.terrain[N].default);for(const N in v)if(!b(v[N],T[N])){S.set(v),this.stylesheet.terrain=v;const z=this._setTransitionParameters({duration:0});S.updateTransitions(z);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(a){const f=this.fog=new nt(a,this.map.transform);this.stylesheet.fog=a;const v=this._setTransitionParameters({duration:0});f.updateTransitions(v)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask((()=>{for(const a of this.map._markers)a._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(a){if(this._checkLoaded(),!a)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const f=this.fog,v=f.get();Object.keys(a).length===0&&f.set(a);for(const S in a)if(!b(a[S],v[S])){f.set(a),this.stylesheet.fog=a;const T=this._setTransitionParameters({duration:0});f.updateTransitions(T);break}}else this._createFog(a);this._markersNeedUpdate=!0}_setTransitionParameters(a){return{now:o.exported.now(),transition:o.extend(a,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const a=this._order.filter((v=>this.isLayerDraped(this._layers[v]))),f=this._order.filter((v=>!this.isLayerDraped(this._layers[v])));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...a),this._drapedFirstOrder.push(...f)}_createTerrain(a,f){const v=this.terrain=new Oe(a,f);this.stylesheet.terrain=a,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const S=this._setTransitionParameters({duration:0});v.updateTransitions(S)}_force3DLayerUpdate(){for(const a in this._layers){const f=this._layers[a];f.type==="fill-extrusion"&&this._updateLayer(f)}}_forceSymbolLayerUpdate(){for(const a in this._layers){const f=this._layers[a];f.type==="symbol"&&this._updateLayer(f)}}_validate(a,f,v,S,T={}){return(!T||T.validate!==!1)&&Ja(this,a.call(o.validateStyle,o.extend({key:f,style:this.serialize(),value:v,styleSpec:o.spec},S)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this._sourceCaches)this._sourceCaches[a].clearTiles(),this._sourceCaches[a].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(a){const f=this._getSourceCaches(a);for(const v of f)v.clearTiles()}_reloadSource(a){const f=this._getSourceCaches(a);for(const v of f)v.resume(),v.reload()}_reloadSources(){for(const a of this._getSources())a.reload&&a.reload()}_updateSources(a){for(const f in this._sourceCaches)this._sourceCaches[f].update(a)}_generateCollisionBoxes(){for(const a in this._sourceCaches){const f=this._sourceCaches[a];f.resume(),f.reload()}}_updatePlacement(a,f,v,S,T=!1){let N=!1,z=!1;const G={};for(const ee of this._order){const te=this._layers[ee];if(te.type!=="symbol")continue;if(!G[te.source]){const Ae=this._getLayerSourceCache(te);if(!Ae)continue;G[te.source]=Ae.getRenderableIds(!0).map((Le=>Ae.getTileByID(Le))).sort(((Le,Xe)=>Xe.tileID.overscaledZ-Le.tileID.overscaledZ||(Le.tileID.isLessThan(Xe.tileID)?-1:1)))}const ge=this.crossTileSymbolIndex.addLayer(te,G[te.source],a.center.lng,a.projection);N=N||ge}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),T=T||this._layerOrderChanged||v===0,this._layerOrderChanged&&this.fire(new o.Event("neworder")),(T||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),a.zoom))&&(this.pauseablePlacement=new Oa(a,this._order,T,f,v,S,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,G),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),z=!0),N&&this.pauseablePlacement.placement.setStale()),z||N)for(const ee of this._order){const te=this._layers[ee];te.type==="symbol"&&this.placement.updateLayerOpacities(te,G[te.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const a in this._sourceCaches)this._sourceCaches[a].releaseSymbolFadeTiles()}getImages(a,f,v){this.imageManager.getImages(f.icons,v),this._updateTilesForChangedImages();const S=T=>{T&&T.setDependencies(f.tileID.key,f.type,f.icons)};S(this._otherSourceCaches[f.source]),S(this._symbolSourceCaches[f.source])}getGlyphs(a,f,v){this.glyphManager.getGlyphs(f.stacks,v)}getResource(a,f,v){return o.makeRequest(f,v)}_getSourceCache(a){return this._otherSourceCaches[a]}_getLayerSourceCache(a){return a.type==="symbol"?this._symbolSourceCaches[a.source]:this._otherSourceCaches[a.source]}_getSourceCaches(a){const f=[];return this._otherSourceCaches[a]&&f.push(this._otherSourceCaches[a]),this._symbolSourceCaches[a]&&f.push(this._symbolSourceCaches[a]),f}_isSourceCacheLoaded(a){const f=this._getSourceCaches(a);return f.length===0?(this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${a}'`))),!1):f.every((v=>v.loaded()))}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ti.getSourceType=function(y){return Vr[y]},Ti.setSourceType=function(y,a){Vr[y]=a},Ti.registerForPluginStateChange=o.registerForPluginStateChange;var Ss=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,$s="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",aa=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,la=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,cl=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let Gs={},Hs={};const xc=[];qt(Ss,xc),qt(aa,xc),qt(la,xc),qt(cl,xc),Gs=Zt("",aa),Hs=Zt(cl,la);const W=Zt(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Ce=Ss,pt=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var yt={background:Zt(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Zt(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Zt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Zt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Zt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Zt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Zt("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Zt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Zt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Zt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Zt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Zt(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Zt(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Zt(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Zt(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Zt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Zt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Zt(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Zt(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Zt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Zt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Zt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Zt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Zt(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:Zt(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Zt(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,$s),skyboxGradient:Zt(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,$s),skyboxCapture:Zt(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Zt(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Zt(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function qt(y,a){const f=y.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let v of f)if(v=v.trim(),v[0]==="#"&&v.includes("if")&&!v.includes("endif")){v=v.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const S=v.split(" ");for(const T of S)a.includes(T)||a.push(T)}}function Zt(y,a){const f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,v=a.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),S={},T=[...xc];return qt(y,T),qt(a,T),{fragmentSource:y=y.replace(f,((N,z,G,ee,te)=>(S[te]=!0,z==="define"?`
#ifndef HAS_UNIFORM_u_${te}
varying ${G} ${ee} ${te};
#else
uniform ${G} ${ee} u_${te};
#endif
`:`
#ifdef HAS_UNIFORM_u_${te}
    ${G} ${ee} ${te} = u_${te};
#endif
`))),vertexSource:a=a.replace(f,((N,z,G,ee,te)=>{const ge=ee==="float"?"vec2":"vec4",Ae=te.match(/color/)?"color":ge;return S[te]?z==="define"?`
#ifndef HAS_UNIFORM_u_${te}
uniform lowp float u_${te}_t;
attribute ${G} ${ge} a_${te};
varying ${G} ${ee} ${te};
#else
uniform ${G} ${ee} u_${te};
#endif
`:Ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${te}
    ${te} = a_${te};
#else
    ${G} ${ee} ${te} = u_${te};
#endif
`:`
#ifndef HAS_UNIFORM_u_${te}
    ${te} = unpack_mix_${Ae}(a_${te}, u_${te}_t);
#else
    ${G} ${ee} ${te} = u_${te};
#endif
`:z==="define"?`
#ifndef HAS_UNIFORM_u_${te}
uniform lowp float u_${te}_t;
attribute ${G} ${ge} a_${te};
#else
uniform ${G} ${ee} u_${te};
#endif
`:Ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${te}
    ${G} ${ee} ${te} = a_${te};
#else
    ${G} ${ee} ${te} = u_${te};
#endif
`:`
#ifndef HAS_UNIFORM_u_${te}
    ${G} ${ee} ${te} = unpack_mix_${Ae}(a_${te}, u_${te}_t);
#else
    ${G} ${ee} ${te} = u_${te};
#endif
`})),staticAttributes:v,usedDefines:T}}class Fn{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(a,f,v,S,T,N,z){this.context=a;let G=this.boundPaintVertexBuffers.length!==S.length;for(let te=0;!G&&te<S.length;te++)this.boundPaintVertexBuffers[te]!==S[te]&&(G=!0);let ee=this.boundDynamicVertexBuffers.length!==z.length;for(let te=0;!ee&&te<z.length;te++)this.boundDynamicVertexBuffers[te]!==z[te]&&(ee=!0);if(!a.extVertexArrayObject||!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==v||G||ee||this.boundIndexBuffer!==T||this.boundVertexOffset!==N)this.freshBind(f,v,S,T,N,z);else{a.bindVertexArrayOES.set(this.vao);for(const te of z)te&&te.bind();T&&T.dynamicDraw&&T.bind()}}freshBind(a,f,v,S,T,N){let z;const G=a.numAttributes,ee=this.context,te=ee.gl;if(ee.extVertexArrayObject)this.vao&&this.destroy(),this.vao=ee.extVertexArrayObject.createVertexArrayOES(),ee.bindVertexArrayOES.set(this.vao),z=0,this.boundProgram=a,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=v,this.boundIndexBuffer=S,this.boundVertexOffset=T,this.boundDynamicVertexBuffers=N;else{z=ee.currentNumAttributes||0;for(let ge=G;ge<z;ge++)te.disableVertexAttribArray(ge)}f.enableAttributes(te,a),f.bind(),f.setVertexAttribPointers(te,a,T);for(const ge of v)ge.enableAttributes(te,a),ge.bind(),ge.setVertexAttribPointers(te,a,T);for(const ge of N)ge&&(ge.enableAttributes(te,a),ge.bind(),ge.setVertexAttribPointers(te,a,T));S&&S.bind(),ee.currentNumAttributes=G}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Dr(y,a){const f=Math.pow(2,a.canonical.z),v=a.canonical.y;return[new o.MercatorCoordinate(0,v/f).toLngLat().lat,new o.MercatorCoordinate(0,(v+1)/f).toLngLat().lat]}function Xr(y,a,f,v,S,T,N){const z=y.context,G=z.gl,ee=f.fbo;if(!ee)return;y.prepareDrawTile();const te=y.useProgram("hillshade");z.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_2D,ee.colorAttachment.get());const ge=((Ue,Ze,_e,$e)=>{const it=_e.paint.get("hillshade-shadow-color"),ot=_e.paint.get("hillshade-highlight-color"),bt=_e.paint.get("hillshade-accent-color");let wt=_e.paint.get("hillshade-illumination-direction")*(Math.PI/180);_e.paint.get("hillshade-illumination-anchor")==="viewport"&&(wt-=Ue.transform.angle);const vt=!Ue.options.moving;return{u_matrix:$e||Ue.transform.calculateProjMatrix(Ze.tileID.toUnwrapped(),vt),u_image:0,u_latrange:Dr(0,Ze.tileID),u_light:[_e.paint.get("hillshade-exaggeration"),wt],u_shadow:it,u_highlight:ot,u_accent:bt}})(y,f,v,y.terrain?a.projMatrix:null);y.prepareDrawProgram(z,te,a.toUnwrapped());const{tileBoundsBuffer:Ae,tileBoundsIndexBuffer:Le,tileBoundsSegments:Xe}=y.getTileBoundsBuffers(f);te.draw(z,G.TRIANGLES,S,T,N,o.CullFaceMode.disabled,ge,v.id,Ae,Le,Xe)}function yi(y,a,f){if(!a.needsDEMTextureUpload)return;const v=y.context,S=v.gl;v.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||y.getTileTexture(f.stride);const T=f.getPixels();a.demTexture?a.demTexture.update(T,{premultiply:!1}):a.demTexture=new o.Texture(v,T,S.RGBA,{premultiply:!1}),a.needsDEMTextureUpload=!1}function Ii(y,a,f,v,S,T){const N=y.context,z=N.gl;if(!a.dem)return;const G=a.dem;if(N.activeTexture.set(z.TEXTURE1),yi(y,a,G),!a.demTexture)return;a.demTexture.bind(z.NEAREST,z.CLAMP_TO_EDGE);const ee=G.dim;N.activeTexture.set(z.TEXTURE0);let te=a.fbo;if(!te){const Xe=new o.Texture(N,{width:ee,height:ee,data:null},z.RGBA);Xe.bind(z.LINEAR,z.CLAMP_TO_EDGE),te=a.fbo=N.createFramebuffer(ee,ee,!0),te.colorAttachment.set(Xe.texture)}N.bindFramebuffer.set(te.framebuffer),N.viewport.set([0,0,ee,ee]);const{tileBoundsBuffer:ge,tileBoundsIndexBuffer:Ae,tileBoundsSegments:Le}=y.getMercatorTileBoundsBuffers();y.useProgram("hillshadePrepare").draw(N,z.TRIANGLES,v,S,T,o.CullFaceMode.disabled,((Xe,Ue)=>{const Ze=Ue.stride,_e=o.create();return o.ortho(_e,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(_e,_e,[0,-o.EXTENT,0]),{u_matrix:_e,u_image:1,u_dimension:[Ze,Ze],u_zoom:Xe.overscaledZ,u_unpack:Ue.unpackVector}})(a.tileID,G),f.id,ge,Ae,Le),a.needsHillshadePrepare=!1}const xo=y=>({u_matrix:new o.UniformMatrix4f(y),u_image0:new o.Uniform1i(y),u_skirt_height:new o.Uniform1f(y)}),bo=(y,a)=>({u_matrix:y,u_image0:0,u_skirt_height:a}),Yo=(y,a,f,v,S,T,N,z,G,ee,te,ge,Ae,Le,Xe)=>({u_proj_matrix:Float32Array.from(y),u_globe_matrix:a,u_normalize_matrix:Float32Array.from(v),u_merc_matrix:f,u_zoom_transition:S,u_merc_center:T,u_image0:0,u_frustum_tl:N,u_frustum_tr:z,u_frustum_br:G,u_frustum_bl:ee,u_globe_pos:te,u_globe_radius:ge,u_viewport:Ae,u_grid_matrix:Xe?Float32Array.from(Xe):new Float32Array(9),u_skirt_height:Le});function Ro(y,a){return y!=null&&a!=null&&!(!y.hasData()||!a.hasData())&&y.demTexture!=null&&a.demTexture!=null&&y.tileID.key!==a.tileID.key}const zo=new class{constructor(){this.operations={}}newMorphing(y,a,f,v,S){if(y in this.operations){const T=this.operations[y];T.to.tileID.key!==f.tileID.key&&(T.queued=f)}else this.operations[y]={startTime:v,phase:0,duration:S,from:a,to:f,queued:null}}getMorphValuesForProxy(y){if(!(y in this.operations))return null;const a=this.operations[y];return{from:a.from,to:a.to,phase:a.phase}}update(y){for(const a in this.operations){const f=this.operations[a];for(f.phase=(y-f.startTime)/f.duration;f.phase>=1||!this._validOp(f);)if(!this._nextOp(f,y)){delete this.operations[a];break}}}_nextOp(y,a){return!!y.queued&&(y.from=y.to,y.to=y.queued,y.queued=null,y.phase=0,y.startTime=a,!0)}_validOp(y){return y.from.hasData()&&y.to.hasData()}},Jo={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function us(y){return 6*Math.pow(1.5,22-y)}function jo(y,a){const f=1<<y.z;return!a&&(y.x===0||y.x===f-1)||y.y===0||y.y===f-1}const Es=y=>({u_matrix:y});function zc(y,a,f,v,S){if(S>0){const T=o.exported.now(),N=(T-y.timeAdded)/S,z=a?(T-a.timeAdded)/S:-1,G=f.getSource(),ee=v.coveringZoomLevel({tileSize:G.tileSize,roundZoom:G.roundZoom}),te=!a||Math.abs(a.tileID.overscaledZ-ee)>Math.abs(y.tileID.overscaledZ-ee),ge=te&&y.refreshedUponExpiration?1:o.clamp(te?N:1-z,0,1);return y.refreshedUponExpiration&&N>=1&&(y.refreshedUponExpiration=!1),a?{opacity:1,mix:1-ge}:{opacity:ge,mix:0}}return{opacity:1,mix:0}}class Qa extends o.SourceCache{constructor(a){const f={type:"raster-dem",maxzoom:a.transform.maxZoom},v=new xe(ga(),null),S=Ar("mock-dem",f,v,a.style);super("mock-dem",S,!1),S.setEventedParent(this),this._sourceLoaded=!0}_loadTile(a,f){a.state="loaded",f(null)}}class L extends o.SourceCache{constructor(a){const f=Ar("proxy",{type:"geojson",maxzoom:a.transform.maxZoom},new xe(ga(),null),a.style);super("proxy",f,!1),f.setEventedParent(this),this.map=this.getSource().map=a,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(a,f,v){if(a.freezeTileCoverage)return;this.transform=a;const S=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((T,N)=>{if(T[N.key]="",!this._tiles[N.key]){const z=new o.Tile(N,this._source.tileSize*N.overscaleFactor(),a.tileZoom);z.state="loaded",this._tiles[N.key]=z}return T}),{});for(const T in this._tiles)T in S||(this.freeFBO(T),this._tiles[T].unloadVectorData(),delete this._tiles[T])}freeFBO(a){const f=this.proxyCachedFBO[a];if(f!==void 0){const v=Object.values(f);this.renderCachePool.push(...v),delete this.proxyCachedFBO[a]}}deallocRenderCache(){this.renderCache.forEach((a=>a.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class ae extends o.OverscaledTileID{constructor(a,f,v){super(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y),this.proxyTileKey=f,this.projMatrix=v}}class ve extends o.Elevation{constructor(a,f){super(),this.painter=a,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[v,S,T]=(function(G){const ee=new o.StructArrayLayout2i4,te=new o.StructArrayLayout3ui6,ge=131;ee.reserve(17161),te.reserve(33800);const Ae=o.EXTENT/128,Le=o.EXTENT+Ae/2,Xe=Le+Ae;for(let Ze=-Ae;Ze<Xe;Ze+=Ae)for(let _e=-Ae;_e<Xe;_e+=Ae){const $e=_e<0||_e>Le||Ze<0||Ze>Le?24575:0,it=o.clamp(Math.round(_e),0,o.EXTENT),ot=o.clamp(Math.round(Ze),0,o.EXTENT);ee.emplaceBack(it+$e,ot)}const Ue=(Ze,_e)=>{const $e=_e*ge+Ze;te.emplaceBack($e+1,$e,$e+ge),te.emplaceBack($e+ge,$e+ge+1,$e+1)};for(let Ze=1;Ze<129;Ze++)for(let _e=1;_e<129;_e++)Ue(_e,Ze);return[0,129].forEach((Ze=>{for(let _e=0;_e<130;_e++)Ue(_e,Ze),Ue(Ze,_e)})),[ee,te,32768]})(),N=a.context;this.gridBuffer=N.createVertexBuffer(v,o.posAttributes.members),this.gridIndexBuffer=N.createIndexBuffer(S),this.gridSegments=o.SegmentVector.simpleSegment(0,0,v.length,S.length),this.gridNoSkirtSegments=o.SegmentVector.simpleSegment(0,0,v.length,T),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new L(f.map),this.orthoMatrix=o.create(),o.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.EXTENT,0,o.EXTENT,0,1);const z=N.gl;this._overlapStencilMode=new o.StencilMode({func:z.GEQUAL,mask:255},0,255,z.KEEP,z.KEEP,z.REPLACE),this._previousZoom=a.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=f,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Qa(f.map)}set style(a){a.on("data",this._onStyleDataEvent.bind(this)),a.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=a,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(a,f,v){if(a&&a.terrain){this._style!==a&&(this.style=a),this.enabled=!0;const S=a.terrain.properties;this.sourceCache=a.terrain.drapeRenderMode===0?this._mockSourceCache:a._getSourceCache(S.get("source")),this._exaggeration=S.get("exaggeration");const T=()=>{this.sourceCache.used&&o.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const N=this.getScaledDemTileSize();this.sourceCache.update(f,N,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,T(),this._initializing=!0),T(),f.updateElevation(!0,v),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(f),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(a){this._findCoveringTileCache[a]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const a=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||a.efficiency!==100&&o.warnOnce(`Terrain render cache efficiency is not optimal (${a.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${a.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(a){a.coord&&a.dataType==="source"?this._clearRenderCacheForTile(a.sourceCacheId,a.coord):a.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const a in this._style._sourceCaches)this._style._sourceCaches[a].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach((a=>a.fb.destroy())),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const a=2*this.proxySourceCache.getSource().tileSize;return[a,a]}set useVertexMorphing(a){this._useVertexMorphing=a}updateTileBinding(a){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const f=this.proxySourceCache,v=this.painter.transform;this._initializing&&(this._initializing=v._centerAltitude===0&&this.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(v.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const S=this.proxyCoords=f.getIds().map((G=>{const ee=f.getTileByID(G).tileID;return ee.projMatrix=v.calculateProjMatrix(ee.toUnwrapped()),ee}));(function(G,ee){const te=ee.transform.pointCoordinate(ee.transform.getCameraPoint()),ge=new o.Point(te.x,te.y);G.sort(((Ae,Le)=>{if(Le.overscaledZ-Ae.overscaledZ)return Le.overscaledZ-Ae.overscaledZ;const Xe=new o.Point(Ae.canonical.x+(1<<Ae.canonical.z)*Ae.wrap,Ae.canonical.y),Ue=new o.Point(Le.canonical.x+(1<<Le.canonical.z)*Le.wrap,Le.canonical.y),Ze=ge.mult(1<<Ae.canonical.z);return Ze.x-=.5,Ze.y-=.5,Ze.distSqr(Xe)-Ze.distSqr(Ue)}))})(S,this.painter),this._previousZoom=v.zoom;const T=this.proxyToSource||{};this.proxyToSource={},S.forEach((G=>{this.proxyToSource[G.key]={}})),this.terrainTileForTile={};const N=this._style._sourceCaches;for(const G in N){const ee=N[G];if(!ee.used||(ee!==this.sourceCache&&this.resetTileLookupCache(ee.id),this._setupProxiedCoordsForOrtho(ee,a[G],T),ee.usedForTerrain))continue;const te=a[G];ee.getSource().reparseOverscaled&&this._assignTerrainTiles(te)}this.proxiedCoords[f.id]=S.map((G=>new ae(G,G.key,this.orthoMatrix))),this._assignTerrainTiles(S),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(T),this.renderingToTexture=!1,this._updateTimestamp=o.exported.now();const z={};this._visibleDemTiles=[];for(const G of this.proxyCoords){const ee=this.terrainTileForTile[G.key];if(!ee)continue;const te=ee.tileID.key;te in z||(this._visibleDemTiles.push(ee),z[te]=te)}}_assignTerrainTiles(a){this._initializing||a.forEach((f=>{if(this.terrainTileForTile[f.key])return;const v=this._findTileCoveringTileID(f,this.sourceCache);v&&(this.terrainTileForTile[f.key]=v)}))}_prepareDEMTextures(){const a=this.painter.context,f=a.gl;for(const v in this.terrainTileForTile){const S=this.terrainTileForTile[v],T=S.dem;!T||S.demTexture&&!S.needsDEMTextureUpload||(a.activeTexture.set(f.TEXTURE1),yi(this.painter,S,T))}}_prepareDemTileUniforms(a,f,v,S){if(!f||f.demTexture==null)return!1;const T=a.tileID.canonical,N=Math.pow(2,f.tileID.canonical.z-T.z),z=S||"";return v[`u_dem_tl${z}`]=[T.x*N%1,T.y*N%1],v[`u_dem_scale${z}`]=N,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const a=this.painter.context,f=a.gl;if(!this._emptyDepthBufferTexture){const v=new o.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new o.Texture(a,v,f.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let a=0;const f=this._visibleDemTiles.reduce(((v,S)=>{if(!S.dem)return v;const T=S.dem.tree.minimums[0];return T>0&&a++,v+T}),0);return a?f/a:0}_updateEmptyDEMTexture(){const a=this.painter.context,f=a.gl;a.activeTexture.set(f.TEXTURE2);const v=this._getLoadedAreaMinimum(),S=new o.RGBAImage({width:1,height:1},new Uint8Array(o.DEMData.pack(v,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let T=this._emptyDEMTexture;return T?T.update(S,{premultiply:!1}):T=this._emptyDEMTexture=new o.Texture(a,S,f.RGBA,{premultiply:!1}),T}setupElevationDraw(a,f,v){const S=this.painter.context,T=S.gl,N=(z=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:o.DEMData.getUnpackVector(z),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var z;N.u_dem_size=this.sourceCache.getSource().tileSize,N.u_exaggeration=this.exaggeration();let G=null,ee=null,te=1;if(v&&v.morphing&&this._useVertexMorphing){const ge=v.morphing.srcDemTile,Ae=v.morphing.dstDemTile;te=v.morphing.phase,ge&&Ae&&(this._prepareDemTileUniforms(a,ge,N,"_prev")&&(ee=ge),this._prepareDemTileUniforms(a,Ae,N)&&(G=Ae))}if(ee&&G?(S.activeTexture.set(T.TEXTURE2),G.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE,T.NEAREST),S.activeTexture.set(T.TEXTURE4),ee.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE,T.NEAREST),N.u_dem_lerp=te):(G=this.terrainTileForTile[a.tileID.key],S.activeTexture.set(T.TEXTURE2),(this._prepareDemTileUniforms(a,G,N)?G.demTexture:this.emptyDEMTexture).bind(T.NEAREST,T.CLAMP_TO_EDGE)),S.activeTexture.set(T.TEXTURE3),v&&v.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),this._depthFBO&&(N.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),N.u_depth_size_inv=[1,1]),v&&v.useMeterToDem&&G){const ge=(1<<G.tileID.canonical.z)*o.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;N.u_meter_to_dem=ge}if(v&&v.labelPlaneMatrixInv&&(N.u_label_plane_matrix_inv=v.labelPlaneMatrixInv),f.setTerrainUniformValues(S,N),this.painter.transform.projection.name==="globe"){const ge=this.globeUniformValues(this.painter.transform,a.tileID.canonical,v&&v.useDenormalizedUpVectorScale);f.setGlobeUniformValues(S,ge)}}globeUniformValues(a,f,v){const S=a.projection;return{u_tile_tl_up:S.upVector(f,0,0),u_tile_tr_up:S.upVector(f,o.EXTENT,0),u_tile_br_up:S.upVector(f,o.EXTENT,o.EXTENT),u_tile_bl_up:S.upVector(f,0,o.EXTENT),u_tile_up_scale:v?o.globeMetersToEcef(1):S.upVectorScale(f,a.center.lat,a.worldSize).metersToTile}}renderToBackBuffer(a){const f=this.painter,v=this.painter.context;a.length!==0&&(v.bindFramebuffer.set(null),v.viewport.set([0,0,f.width,f.height]),f.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(S,T,N,z,G){if(S.transform.projection.name==="globe")(function(ee,te,ge,Ae,Le){const Xe=ee.context,Ue=Xe.gl;let Ze,_e;const $e=ee.options.showTerrainWireframe?2:0,it=ee.transform,ot=o.globeUseCustomAntiAliasing(ee,Xe,it),bt=(Cn,jt)=>{if(_e===Cn)return;const on=[Jo[Cn],"PROJECTION_GLOBE_VIEW"];ot&&on.push("CUSTOM_ANTIALIASING"),jt&&on.push(Jo[$e]),Ze=ee.useProgram("globeRaster",null,on),_e=Cn},wt=ee.colorModeForRenderPass(),vt=new o.DepthMode(Ue.LEQUAL,o.DepthMode.ReadWrite,ee.depthRangeFor3D);zo.update(Le);const Rt=o.calculateGlobeMercatorMatrix(it),Lt=[o.mercatorXfromLng(it.center.lng),o.mercatorYfromLat(it.center.lat)],zt=$e?[!1,!0]:[!1],mn=ee.globeSharedBuffers,Ut=[it.width*o.exported.devicePixelRatio,it.height*o.exported.devicePixelRatio],an=Float32Array.from(it.globeMatrix),Ht={useDenormalizedUpVectorScale:!0};if(zt.forEach((Cn=>{const jt=ee.transform,on=us(jt.zoom)*te.exaggeration();_e=-1;const In=Cn?Ue.LINES:Ue.TRIANGLES;for(const xn of Ae){const bn=ge.getTile(xn),pr=o.StencilMode.disabled,Fr=te.prevTerrainTileForTile[xn.key],sr=te.terrainTileForTile[xn.key];Ro(Fr,sr)&&zo.newMorphing(xn.key,Fr,sr,Le,250),Xe.activeTexture.set(Ue.TEXTURE0),bn.texture.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE);const fr=zo.getMorphValuesForProxy(xn.key),$r=fr?1:0;fr&&o.extend$1(Ht,{morphing:{srcDemTile:fr.from,dstDemTile:fr.to,phase:o.easeCubicInOut(fr.phase)}});const gi=o.tileCornersToBounds(xn.canonical),Sr=o.getLatitudinalLod(gi.getCenter().lat),ki=o.getGridMatrix(xn.canonical,gi,Sr,jt.worldSize/jt._pixelsPerMercatorPixel),Ci=o.globeNormalizeECEF(o.globeTileBounds(xn.canonical)),co=Yo(jt.projMatrix,an,Rt,Ci,o.globeToMercatorTransition(jt.zoom),Lt,jt.frustumCorners.TL,jt.frustumCorners.TR,jt.frustumCorners.BR,jt.frustumCorners.BL,jt.globeCenterInViewSpace,jt.globeRadius,Ut,on,ki);if(bt($r,Cn),te.setupElevationDraw(bn,Ze,Ht),ee.prepareDrawProgram(Xe,Ze,xn.toUnwrapped()),mn){const[Ri,ba,ts]=Cn?mn.getWirefameBuffers(ee.context,Sr):mn.getGridBuffers(Sr,on!==0);Ze.draw(Xe,In,vt,pr,wt,o.CullFaceMode.backCCW,co,"globe_raster",Ri,ba,ts)}}})),mn){const Cn=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ot&&Cn.push("CUSTOM_ANTIALIASING"),Ze=ee.useProgram("globeRaster",null,Cn);for(const jt of Ae){const{x:on,y:In,z:xn}=jt.canonical,bn=In===0,pr=In===(1<<xn)-1,[Fr,sr,fr,$r]=mn.getPoleBuffers(xn);if($r&&(bn||pr)){const gi=ge.getTile(jt);Xe.activeTexture.set(Ue.TEXTURE0),gi.texture.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE);let Sr=o.globePoleMatrixForTile(xn,on,it);const ki=o.globeNormalizeECEF(o.globeTileBounds(jt.canonical)),Ci=(co,Ri)=>co.draw(Xe,Ue.TRIANGLES,vt,o.StencilMode.disabled,wt,o.CullFaceMode.disabled,Yo(it.projMatrix,Sr,Sr,ki,0,Lt,it.frustumCorners.TL,it.frustumCorners.TR,it.frustumCorners.BR,it.frustumCorners.BL,it.globeCenterInViewSpace,it.globeRadius,Ut,0),"globe_pole_raster",Ri,fr,$r);te.setupElevationDraw(gi,Ze,Ht),ee.prepareDrawProgram(Xe,Ze,jt.toUnwrapped()),bn&&Ci(Ze,Fr),pr&&(Sr=o.scale(o.create(),Sr,[1,-1,1]),Ci(Ze,sr))}}}})(S,T,N,z,G);else{const ee=S.context,te=ee.gl;let ge,Ae;const Le=S.options.showTerrainWireframe?2:0,Xe=(it,ot)=>{if(Ae===it)return;const bt=[Jo[it]];ot&&bt.push(Jo[Le]),ge=S.useProgram("terrainRaster",null,bt),Ae=it},Ue=S.colorModeForRenderPass(),Ze=new o.DepthMode(te.LEQUAL,o.DepthMode.ReadWrite,S.depthRangeFor3D);zo.update(G);const _e=S.transform,$e=us(_e.zoom)*T.exaggeration();(Le?[!1,!0]:[!1]).forEach((it=>{Ae=-1;const ot=it?te.LINES:te.TRIANGLES,[bt,wt]=it?T.getWirefameBuffer():[T.gridIndexBuffer,T.gridSegments];for(const vt of z){const Rt=N.getTile(vt),Lt=o.StencilMode.disabled,zt=T.prevTerrainTileForTile[vt.key],mn=T.terrainTileForTile[vt.key];Ro(zt,mn)&&zo.newMorphing(vt.key,zt,mn,G,250),ee.activeTexture.set(te.TEXTURE0),Rt.texture.bind(te.LINEAR,te.CLAMP_TO_EDGE,te.LINEAR_MIPMAP_NEAREST);const Ut=zo.getMorphValuesForProxy(vt.key),an=Ut?1:0;let Ht;Ut&&(Ht={morphing:{srcDemTile:Ut.from,dstDemTile:Ut.to,phase:o.easeCubicInOut(Ut.phase)}});const Cn=bo(vt.projMatrix,jo(vt.canonical,_e.renderWorldCopies)?$e/10:$e);Xe(an,it),T.setupElevationDraw(Rt,ge,Ht),S.prepareDrawProgram(ee,ge,vt.toUnwrapped()),ge.draw(ee,ot,Ze,Lt,Ue,o.CullFaceMode.backCCW,Cn,"terrain_raster",T.gridBuffer,bt,wt)}}))}})(f,this,this.proxySourceCache,a,this._updateTimestamp),this.renderingToTexture=!0,f.gpuTimingDeferredRenderEnd(),a.splice(0,a.length))}renderBatch(a){if(this._drapedRenderBatches.length===0)return a+1;this.renderingToTexture=!0;const f=this.painter,v=this.painter.context,S=this.proxySourceCache,T=this.proxiedCoords[S.id],N=this._drapedRenderBatches.shift(),z=[],G=f.style.order;let ee=0;for(const te of T){const ge=S.getTileByID(te.proxyTileKey),Ae=S.proxyCachedFBO[te.key]?S.proxyCachedFBO[te.key][a]:void 0,Le=Ae!==void 0?S.renderCache[Ae]:this.pool[ee++],Xe=Ae!==void 0;if(ge.texture=Le.tex,Xe&&!Le.dirty){z.push(ge.tileID);continue}let Ue;v.bindFramebuffer.set(Le.fb.framebuffer),this.renderedToTile=!1,Le.dirty&&(v.clear({color:o.Color.transparent,stencil:0}),Le.dirty=!1);for(let Ze=N.start;Ze<=N.end;++Ze){const _e=f.style._layers[G[Ze]];if(_e.isHidden(f.transform.zoom))continue;const $e=f.style._getLayerSourceCache(_e),it=$e?this.proxyToSource[te.key][$e.id]:[te];if(!it)continue;const ot=it;v.viewport.set([0,0,Le.fb.width,Le.fb.height]),Ue!==($e?$e.id:null)&&(this._setupStencil(Le,it,_e,$e),Ue=$e?$e.id:null),f.renderLayer(f,$e,_e,ot)}this.renderedToTile?(Le.dirty=!0,z.push(ge.tileID)):Xe||--ee,ee===5&&(ee=0,this.renderToBackBuffer(z))}return this.renderToBackBuffer(z),this.renderingToTexture=!1,v.bindFramebuffer.set(null),v.viewport.set([0,0,f.width,f.height]),N.end+1}postRender(){}renderCacheEfficiency(a){const f=a.order.length;if(f===0)return{efficiency:100};let v,S=0,T=0,N=!1;for(let z=0;z<f;++z){const G=a._layers[a.order[z]];this._style.isLayerDraped(G)?(N&&++S,++T):N||(N=!0,v=G.id)}return T===0?{efficiency:100}:{efficiency:100*(1-S/T),firstUndrapedLayer:v}}getMinElevationBelowMSL(){let a=0;return this._visibleDemTiles.filter((f=>f.dem)).forEach((f=>{a=Math.min(a,f.dem.tree.minimums[0])})),a===0?a:(a-30)*this._exaggeration}raycast(a,f,v){if(!this._visibleDemTiles)return null;const S=this._visibleDemTiles.filter((T=>T.dem)).map((T=>{const N=T.tileID,z=1<<N.overscaledZ,{x:G,y:ee}=N.canonical,te=G/z,ge=(G+1)/z,Ae=ee/z,Le=(ee+1)/z;return{minx:te,miny:Ae,maxx:ge,maxy:Le,t:T.dem.tree.raycastRoot(te,Ae,ge,Le,a,f,v),tile:T}}));S.sort(((T,N)=>(T.t!==null?T.t:Number.MAX_VALUE)-(N.t!==null?N.t:Number.MAX_VALUE)));for(const T of S){if(T.t==null)return null;const N=T.tile.dem.tree.raycast(T.minx,T.miny,T.maxx,T.maxy,a,f,v);if(N!=null)return N}return null}_createFBO(){const a=this.painter.context,f=a.gl,v=this.drapeBufferSize;a.activeTexture.set(f.TEXTURE0);const S=new o.Texture(a,{width:v[0],height:v[1],data:null},f.RGBA);S.bind(f.LINEAR,f.CLAMP_TO_EDGE);const T=a.createFramebuffer(v[0],v[1],!1);return T.colorAttachment.set(S.texture),T.depthAttachment=new Et(a,T.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=a.createRenderbuffer(a.gl.DEPTH_STENCIL,v[0],v[1]),this._stencilRef=0,T.depthAttachment.set(this._sharedDepthStencil),a.clear({stencil:0})):T.depthAttachment.set(this._sharedDepthStencil),a.extTextureFilterAnisotropic&&!a.extTextureFilterAnisotropicForceOff&&f.texParameterf(f.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax),{fb:T,tex:S,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const a in this._style._sourceCaches)if(this._style._sourceCaches[a].hasTransition())return!0;return this._style.order.some((a=>{const f=this._style._layers[a],v=f.isHidden(this.painter.transform.zoom);return f.type==="custom"?!v&&f.shouldRedrape():!v&&f.hasTransition()}))}_clearLineLayersFromRenderCache(){let a=!1;for(const v of this._style._getSources())if(v instanceof Bn){a=!0;break}if(!a)return;const f={};for(let v=0;v<this._style.order.length;++v){const S=this._style._layers[this._style.order[v]],T=this._style._getLayerSourceCache(S);if(T&&!f[T.id]&&!S.isHidden(this.painter.transform.zoom)&&S.type==="line"&&S.widthExpression()instanceof o.ZoomDependentExpression){f[T.id]=!0;for(const N of this.proxyCoords){const z=this.proxyToSource[N.key][T.id];if(z)for(const G of z)this._clearRenderCacheForTile(T.id,G)}}}}_clearRasterLayersFromRenderCache(){let a=!1;for(const v in this._style._sourceCaches)if(this._style._sourceCaches[v]._source instanceof Tn){a=!0;break}if(!a)return;const f={};for(let v=0;v<this._style.order.length;++v){const S=this._style._layers[this._style.order[v]],T=this._style._getLayerSourceCache(S);if(!T||f[T.id]||S.isHidden(this.painter.transform.zoom)||S.type!=="raster")continue;const N=S.paint.get("raster-fade-duration");for(const z of this.proxyCoords){const G=this.proxyToSource[z.key][T.id];if(G)for(const ee of G){const te=zc(T.getTile(ee),T.findLoadedParent(ee,0),T,this.painter.transform,N);(te.opacity!==1||te.mix!==0)&&this._clearRenderCacheForTile(T.id,ee)}}}}_setupDrapedRenderBatches(){const a=this._style.order,f=a.length;if(f===0)return;const v=[];let S,T=0,N=this._style._layers[a[T]];for(;!this._style.isLayerDraped(N)&&N.isHidden(this.painter.transform.zoom)&&++T<f;)N=this._style._layers[a[T]];for(;T<f;++T){const z=this._style._layers[a[T]];z.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(z)?S===void 0&&(S=T):S!==void 0&&(v.push({start:S,end:T-1}),S=void 0))}S!==void 0&&v.push({start:S,end:T-1}),this._drapedRenderBatches=v}_setupRenderCache(a){const f=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,f.renderCache.length>f.renderCachePool.length){const N=Object.values(f.proxyCachedFBO);f.proxyCachedFBO={};for(let z=0;z<N.length;++z){const G=Object.values(N[z]);f.renderCachePool.push(...G)}}return}this._clearRasterLayersFromRenderCache();const v=this.proxyCoords,S=this._tilesDirty;for(let N=v.length-1;N>=0;N--){const z=v[N];if(f.getTileByID(z.key),f.proxyCachedFBO[z.key]!==void 0){const G=a[z.key],ee=this.proxyToSource[z.key];let te=0;for(const ge in ee){const Ae=ee[ge],Le=G[ge];if(!Le||Le.length!==Ae.length||Ae.some(((Xe,Ue)=>Xe!==Le[Ue]||S[ge]&&S[ge].hasOwnProperty(Xe.key)))){te=-1;break}++te}for(const ge in f.proxyCachedFBO[z.key])f.renderCache[f.proxyCachedFBO[z.key][ge]].dirty=te<0||te!==Object.values(G).length}}const T=[...this._drapedRenderBatches];T.sort(((N,z)=>z.end-z.start-(N.end-N.start)));for(const N of T)for(const z of v){if(f.proxyCachedFBO[z.key])continue;let G=f.renderCachePool.pop();G===void 0&&f.renderCache.length<50&&(G=f.renderCache.length,f.renderCache.push(this._createFBO())),G!==void 0&&(f.proxyCachedFBO[z.key]={},f.proxyCachedFBO[z.key][N.start]=G,f.renderCache[G].dirty=!0)}this._tilesDirty={}}_setupStencil(a,f,v,S){if(!S||!this._sourceTilesOverlap[S.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const T=this.painter.context,N=T.gl;if(f.length<=1)return void(this._overlapStencilType=!1);let z;if(v.isTileClipped())z=f.length,this._overlapStencilMode.test={func:N.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(f[0].overscaledZ>f[f.length-1].overscaledZ))return void(this._overlapStencilType=!1);z=1,this._overlapStencilMode.test={func:N.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+z>255&&(T.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=z,this._overlapStencilMode.ref=this._stencilRef,v.isTileClipped()&&this._renderTileClippingMasks(f,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(a){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[a.key]),this._overlapStencilMode):o.StencilMode.disabled}_renderTileClippingMasks(a,f){const v=this.painter,S=this.painter.context,T=S.gl;v._tileClippingMaskIDs={},S.setColorMode(o.ColorMode.disabled),S.setDepthMode(o.DepthMode.disabled);const N=v.useProgram("clippingMask");for(const z of a){const G=v._tileClippingMaskIDs[z.key]=--f;N.draw(S,T.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:T.ALWAYS,mask:0},G,255,T.KEEP,T.KEEP,T.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,Es(z.projMatrix),"$clipping",v.tileExtentBuffer,v.quadTriangleIndexBuffer,v.tileExtentSegments)}}pointCoordinate(a){const f=this.painter.transform;if(a.x<0||a.x>f.width||a.y<0||a.y>f.height)return null;const v=[a.x,a.y,1,1];o.transformMat4$1(v,v,f.pixelMatrixInverse),o.scale$1(v,v,1/v[3]),v[0]/=f.worldSize,v[1]/=f.worldSize;const S=f._camera.position,T=o.mercatorZfromAltitude(1,f.center.lat),N=[S[0],S[1],S[2]/T,0],z=o.subtract([],v.slice(0,3),N);o.normalize(z,z);const G=this.raycast(N,z,this._exaggeration);return G!==null&&G?(o.scaleAndAdd(N,N,z,G),N[3]=N[2],N[2]*=T,N):null}drawDepth(){const a=this.painter,f=a.context,v=this.proxySourceCache,S=Math.ceil(a.width),T=Math.ceil(a.height);if(!this._depthFBO||this._depthFBO.width===S&&this._depthFBO.height===T||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const N=f.gl,z=f.createFramebuffer(S,T,!0);f.activeTexture.set(N.TEXTURE0);const G=new o.Texture(f,{width:S,height:T,data:null},N.RGBA);G.bind(N.NEAREST,N.CLAMP_TO_EDGE),z.colorAttachment.set(G.texture);const ee=f.createRenderbuffer(f.gl.DEPTH_COMPONENT16,S,T);z.depthAttachment.set(ee),this._depthFBO=z,this._depthTexture=G}f.bindFramebuffer.set(this._depthFBO.framebuffer),f.viewport.set([0,0,S,T]),(function(N,z,G,ee){if(N.transform.projection.name==="globe")return;const te=N.context,ge=te.gl;te.clear({depth:1});const Ae=N.useProgram("terrainDepth"),Le=new o.DepthMode(ge.LESS,o.DepthMode.ReadWrite,N.depthRangeFor3D);for(const Xe of ee){const Ue=G.getTile(Xe),Ze=bo(Xe.projMatrix,0);z.setupElevationDraw(Ue,Ae),Ae.draw(te,ge.TRIANGLES,Le,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.backCCW,Ze,"terrain_depth",z.gridBuffer,z.gridIndexBuffer,z.gridNoSkirtSegments)}})(a,this,v,this.proxyCoords)}_setupProxiedCoordsForOrtho(a,f,v){if(a.getSource()instanceof Lr)return this._setupProxiedCoordsForImageSource(a,f,v);this._findCoveringTileCache[a.id]=this._findCoveringTileCache[a.id]||{};const S=this.proxiedCoords[a.id]=[],T=this.proxyCoords;for(let z=0;z<T.length;z++){const G=T[z],ee=this._findTileCoveringTileID(G,a);if(ee){const te=this._createProxiedId(G,ee,v[G.key]&&v[G.key][a.id]);S.push(te),this.proxyToSource[G.key][a.id]=[te]}}let N=!1;for(let z=0;z<f.length;z++){const G=a.getTile(f[z]);if(!G||!G.hasData())continue;const ee=this._findTileCoveringTileID(G.tileID,this.proxySourceCache);if(ee&&ee.tileID.canonical.z!==G.tileID.canonical.z){const te=this.proxyToSource[ee.tileID.key][a.id],ge=this._createProxiedId(ee.tileID,G,v[ee.tileID.key]&&v[ee.tileID.key][a.id]);te?te.splice(te.length-1,0,ge):this.proxyToSource[ee.tileID.key][a.id]=[ge],S.push(ge),N=!0}}this._sourceTilesOverlap[a.id]=N}_setupProxiedCoordsForImageSource(a,f,v){if(!a.getSource().loaded())return;const S=this.proxiedCoords[a.id]=[],T=this.proxyCoords,N=a.getSource(),z=new o.Point(N.tileID.x,N.tileID.y)._div(1<<N.tileID.z),G=N.coordinates.map(o.MercatorCoordinate.fromLngLat).reduce(((te,ge)=>(te.min.x=Math.min(te.min.x,ge.x-z.x),te.min.y=Math.min(te.min.y,ge.y-z.y),te.max.x=Math.max(te.max.x,ge.x-z.x),te.max.y=Math.max(te.max.y,ge.y-z.y),te)),{min:new o.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),ee=(te,ge)=>{const Ae=te.wrap+te.canonical.x/(1<<te.canonical.z),Le=te.canonical.y/(1<<te.canonical.z),Xe=o.EXTENT/(1<<te.canonical.z),Ue=ge.wrap+ge.canonical.x/(1<<ge.canonical.z),Ze=ge.canonical.y/(1<<ge.canonical.z);return Ae+Xe<Ue+G.min.x||Ae>Ue+G.max.x||Le+Xe<Ze+G.min.y||Le>Ze+G.max.y};for(let te=0;te<T.length;te++){const ge=T[te];for(let Ae=0;Ae<f.length;Ae++){const Le=a.getTile(f[Ae]);if(!Le||!Le.hasData()||ee(ge,Le.tileID))continue;const Xe=this._createProxiedId(ge,Le,v[ge.key]&&v[ge.key][a.id]),Ue=this.proxyToSource[ge.key][a.id];Ue?Ue.push(Xe):this.proxyToSource[ge.key][a.id]=[Xe],S.push(Xe)}}}_createProxiedId(a,f,v){let S=this.orthoMatrix;if(v){const T=v.find((N=>N.key===f.tileID.key));if(T)return T}if(f.tileID.key!==a.key){const T=a.canonical.z-f.tileID.canonical.z;let N,z,G;S=o.create();const ee=f.tileID.wrap-a.wrap<<a.overscaledZ;T>0?(N=o.EXTENT>>T,z=N*((f.tileID.canonical.x<<T)-a.canonical.x+ee),G=N*((f.tileID.canonical.y<<T)-a.canonical.y)):(N=o.EXTENT<<-T,z=o.EXTENT*(f.tileID.canonical.x-(a.canonical.x+ee<<-T)),G=o.EXTENT*(f.tileID.canonical.y-(a.canonical.y<<-T))),o.ortho(S,0,N,0,N,0,1),o.translate(S,S,[z,G,0])}return new ae(f.tileID,a.key,S)}_findTileCoveringTileID(a,f){let v=f.getTile(a);if(v&&v.hasData())return v;const S=this._findCoveringTileCache[f.id],T=S[a.key];if(v=T?f.getTileByID(T):null,v&&v.hasData()||T===null)return v;let N=v?v.tileID:a,z=N.overscaledZ;const G=f.getSource().minzoom,ee=[];if(!T){const ge=f.getSource().maxzoom;if(a.canonical.z>=ge){const Ae=a.canonical.z-ge;f.getSource().reparseOverscaled?(z=Math.max(a.canonical.z+2,f.transform.tileZoom),N=new o.OverscaledTileID(z,a.wrap,ge,a.canonical.x>>Ae,a.canonical.y>>Ae)):Ae!==0&&(z=ge,N=new o.OverscaledTileID(z,a.wrap,ge,a.canonical.x>>Ae,a.canonical.y>>Ae))}N.key!==a.key&&(ee.push(N.key),v=f.getTile(N))}const te=ge=>{ee.forEach((Ae=>{S[Ae]=ge})),ee.length=0};for(z-=1;z>=G&&(!v||!v.hasData());z--){v&&te(v.tileID.key);const ge=N.calculateScaledKey(z);if(v=f.getTileByID(ge),v&&v.hasData())break;const Ae=S[ge];if(Ae===null)break;Ae===void 0?ee.push(ge):v=f.getTileByID(Ae)}return te(v?v.tileID.key:null),v&&v.hasData()?v:null}findDEMTileFor(a){return this.enabled?this._findTileCoveringTileID(a,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(a,f){let v=this._tilesDirty[a];v||(v=this._tilesDirty[a]={}),v[f.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const a=(function(f){let v=0;const S=new o.StructArrayLayout2ui4,T=131;for(let N=1;N<129;N++){for(let z=1;z<129;z++)v=N*T+z,S.emplaceBack(v,v+1),S.emplaceBack(v,v+T),S.emplaceBack(v+1,v+T),N===128&&S.emplaceBack(v+T,v+T+1);S.emplaceBack(v+1,v+1+T)}return S})();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(a),this.wireframeSegments=o.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,a.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Ge{static cacheKey(a,f,v,S){let T=`${f}${S?S.cacheKey:""}`;for(const N of v)a.usedDefines.includes(N)&&(T+=`/${N}`);return T}constructor(a,f,v,S,T,N){const z=a.gl;this.program=z.createProgram();const G=(function(_e){const $e=[];for(let it=0;it<_e.length;it++){if(_e[it]===null)continue;const ot=_e[it].split(" ");$e.push(ot.pop())}return $e})(v.staticAttributes),ee=S?S.getBinderAttributes():[],te=G.concat(ee);let ge=S?S.defines():[];ge=ge.concat(N.map((_e=>`#define ${_e}`)));const Ae=a.isWebGL2?`#version 300 es
`:"",Le=Ae+ge.concat(a.extStandardDerivatives&&Ae.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(pt):pt,pt,Ce,W.fragmentSource,Hs.fragmentSource,v.fragmentSource).join(`
`),Xe=Ae+ge.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Ce,W.vertexSource,Hs.vertexSource,Gs.vertexSource,v.vertexSource).join(`
`),Ue=z.createShader(z.FRAGMENT_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);z.shaderSource(Ue,Le),z.compileShader(Ue),z.attachShader(this.program,Ue);const Ze=z.createShader(z.VERTEX_SHADER);if(z.isContextLost())this.failedToCreate=!0;else{z.shaderSource(Ze,Xe),z.compileShader(Ze),z.attachShader(this.program,Ze),this.attributes={},this.numAttributes=te.length;for(let _e=0;_e<this.numAttributes;_e++)te[_e]&&(z.bindAttribLocation(this.program,_e,te[_e]),this.attributes[te[_e]]=_e);z.linkProgram(this.program),z.deleteShader(Ze),z.deleteShader(Ue),this.fixedUniforms=T(a),this.binderUniforms=S?S.getUniforms(a):[],N.includes("TERRAIN")&&(this.terrainUniforms=(_e=>({u_dem:new o.Uniform1i(_e),u_dem_prev:new o.Uniform1i(_e),u_dem_unpack:new o.Uniform4f(_e),u_dem_tl:new o.Uniform2f(_e),u_dem_scale:new o.Uniform1f(_e),u_dem_tl_prev:new o.Uniform2f(_e),u_dem_scale_prev:new o.Uniform1f(_e),u_dem_size:new o.Uniform1f(_e),u_dem_lerp:new o.Uniform1f(_e),u_exaggeration:new o.Uniform1f(_e),u_depth:new o.Uniform1i(_e),u_depth_size_inv:new o.Uniform2f(_e),u_meter_to_dem:new o.Uniform1f(_e),u_label_plane_matrix_inv:new o.UniformMatrix4f(_e)}))(a)),N.includes("GLOBE")&&(this.globeUniforms=(_e=>({u_tile_tl_up:new o.Uniform3f(_e),u_tile_tr_up:new o.Uniform3f(_e),u_tile_br_up:new o.Uniform3f(_e),u_tile_bl_up:new o.Uniform3f(_e),u_tile_up_scale:new o.Uniform1f(_e)}))(a)),N.includes("FOG")&&(this.fogUniforms=(_e=>({u_fog_matrix:new o.UniformMatrix4f(_e),u_fog_range:new o.Uniform2f(_e),u_fog_color:new o.Uniform4f(_e),u_fog_horizon_blend:new o.Uniform1f(_e),u_fog_temporal_offset:new o.Uniform1f(_e),u_frustum_tl:new o.Uniform3f(_e),u_frustum_tr:new o.Uniform3f(_e),u_frustum_br:new o.Uniform3f(_e),u_frustum_bl:new o.Uniform3f(_e),u_globe_pos:new o.Uniform3f(_e),u_globe_radius:new o.Uniform1f(_e),u_globe_transition:new o.Uniform1f(_e),u_is_globe:new o.Uniform1i(_e),u_viewport:new o.Uniform2f(_e)}))(a))}}setTerrainUniformValues(a,f){if(!this.terrainUniforms)return;const v=this.terrainUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const S in f)v[S]&&v[S].set(this.program,S,f[S])}}setGlobeUniformValues(a,f){if(!this.globeUniforms)return;const v=this.globeUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const S in f)v[S]&&v[S].set(this.program,S,f[S])}}setFogUniformValues(a,f){if(!this.fogUniforms)return;const v=this.fogUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const S in f)v[S].set(this.program,S,f[S])}}draw(a,f,v,S,T,N,z,G,ee,te,ge,Ae,Le,Xe,Ue){const Ze=a.gl;if(this.failedToCreate)return;a.program.set(this.program),a.setDepthMode(v),a.setStencilMode(S),a.setColorMode(T),a.setCullFace(N);for(const $e of Object.keys(this.fixedUniforms))this.fixedUniforms[$e].set(this.program,$e,z[$e]);Xe&&Xe.setUniforms(this.program,a,this.binderUniforms,Ae,{zoom:Le});const _e={[Ze.LINES]:2,[Ze.TRIANGLES]:3,[Ze.LINE_STRIP]:1}[f];for(const $e of ge.get()){const it=$e.vaos||($e.vaos={});(it[G]||(it[G]=new Fn)).bind(a,this,ee,Xe?Xe.getPaintVertexBuffers():[],te,$e.vertexOffset,Ue||[]),Ze.drawElements(f,$e.primitiveLength*_e,Ze.UNSIGNED_SHORT,$e.primitiveOffset*_e*2)}}}function Xt(y,a){const f=Math.pow(2,a.tileID.overscaledZ),v=a.tileSize*Math.pow(2,y.transform.tileZoom)/f,S=v*(a.tileID.canonical.x+a.tileID.wrap*f),T=v*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_tile_units_to_pixels:1/le(a,1,y.transform.tileZoom),u_pixel_coord_upper:[S>>16,T>>16],u_pixel_coord_lower:[65535&S,65535&T]}}const hn=o.create(),ar=(y,a,f,v,S,T,N,z,G,ee,te)=>{const ge=a.style.light,Ae=ge.properties.get("position"),Le=[Ae.x,Ae.y,Ae.z],Xe=o.create$1();ge.properties.get("anchor")==="viewport"&&(o.fromRotation(Xe,-a.transform.angle),o.transformMat3(Le,Le,Xe));const Ue=ge.properties.get("color"),Ze=a.transform,_e={u_matrix:y,u_lightpos:Le,u_lightintensity:ge.properties.get("intensity"),u_lightcolor:[Ue.r,Ue.g,Ue.b],u_vertical_gradient:+f,u_opacity:v,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:hn,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:S,u_edge_radius:T};return Ze.projection.name==="globe"&&(_e.u_tile_id=[N.canonical.x,N.canonical.y,1<<N.canonical.z],_e.u_zoom_transition=G,_e.u_inv_rot_matrix=te,_e.u_merc_center=ee,_e.u_up_dir=Ze.projection.upVector(new o.CanonicalTileID(0,0,0),ee[0]*o.EXTENT,ee[1]*o.EXTENT),_e.u_height_lift=z),_e},so=(y,a,f,v,S,T,N,z,G,ee,te,ge)=>{const Ae=ar(y,a,f,v,S,T,N,G,ee,te,ge),Le={u_height_factor:-Math.pow(2,N.overscaledZ)/z.tileSize/8};return o.extend(Ae,Xt(a,z),Le)},Fo=y=>({u_matrix:y}),Ki=(y,a,f)=>o.extend(Fo(y),Xt(a,f)),zi=(y,a)=>({u_matrix:y,u_world:a}),Mo=(y,a,f,v)=>o.extend(Ki(y,a,f),{u_world:v}),ca=o.create(),Lo=(y,a,f,v,S,T)=>{const N=y.transform,z=N.projection.name==="globe";let G;if(T.paint.get("circle-pitch-alignment")==="map")if(z){const te=o.globePixelsToTileUnits(N.zoom,a.canonical)*N._pixelsPerMercatorPixel;G=Float32Array.from([te,0,0,te])}else G=N.calculatePixelsToTileUnitsMatrix(f);else G=new Float32Array([N.pixelsToGLUnits[0],0,0,N.pixelsToGLUnits[1]]);const ee={u_camera_to_center_distance:N.cameraToCenterDistance,u_matrix:y.translatePosMatrix(a.projMatrix,f,T.paint.get("circle-translate"),T.paint.get("circle-translate-anchor")),u_device_pixel_ratio:o.exported.devicePixelRatio,u_extrude_scale:G,u_inv_rot_matrix:ca,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(z){ee.u_inv_rot_matrix=v,ee.u_merc_center=S,ee.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],ee.u_zoom_transition=o.globeToMercatorTransition(N.zoom);const te=S[0]*o.EXTENT,ge=S[1]*o.EXTENT;ee.u_up_dir=N.projection.upVector(new o.CanonicalTileID(0,0,0),te,ge)}return ee},Bi=y=>{const a=[];return y.paint.get("circle-pitch-alignment")==="map"&&a.push("PITCH_WITH_MAP"),y.paint.get("circle-pitch-scale")==="map"&&a.push("SCALE_WITH_MAP"),a},Fl=(y,a,f,v)=>{const S=o.EXTENT/f.tileSize;return{u_matrix:y,u_camera_to_center_distance:a.getCameraToCenterDistance(v),u_extrude_scale:[a.pixelsToGLUnits[0]/S,a.pixelsToGLUnits[1]/S]}},ua=(y,a,f=1)=>({u_matrix:y,u_color:a,u_overlay:0,u_overlay_scale:f}),Ru=o.create(),ul=(y,a,f,v,S,T,N)=>{const z=y.transform,G=z.projection.name==="globe",ee=G?o.globePixelsToTileUnits(z.zoom,a.canonical)*z._pixelsPerMercatorPixel:le(f,1,T),te={u_matrix:a.projMatrix,u_extrude_scale:ee,u_intensity:N,u_inv_rot_matrix:Ru,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(G){te.u_inv_rot_matrix=v,te.u_merc_center=S,te.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],te.u_zoom_transition=o.globeToMercatorTransition(z.zoom);const ge=S[0]*o.EXTENT,Ae=S[1]*o.EXTENT;te.u_up_dir=z.projection.upVector(new o.CanonicalTileID(0,0,0),ge,Ae)}return te},bc=(y,a,f,v,S,T,N)=>{const z=y.transform,G=z.calculatePixelsToTileUnitsMatrix(a);return{u_matrix:gu(y,a,f,v),u_pixels_to_tile_units:G,u_device_pixel_ratio:T,u_units_to_pixels:[1/z.pixelsToGLUnits[0],1/z.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:S,u_texsize:Qo(f)?a.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:_a(a,y.transform),u_alpha_discard_threshold:0,u_trim_offset:N}},Ps=(y,a,f,v,S)=>{const T=y.transform;return{u_matrix:gu(y,a,f,v),u_texsize:a.imageAtlasTexture.size,u_pixels_to_tile_units:T.calculatePixelsToTileUnitsMatrix(a),u_device_pixel_ratio:S,u_image:0,u_tile_units_to_pixels:_a(a,T),u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function _a(y,a){return 1/le(y,1,a.tileZoom)}function gu(y,a,f,v){return y.translatePosMatrix(v||a.tileID.projMatrix,a,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}function Qo(y){const a=y.paint.get("line-dasharray").value;return a.value||a.kind!=="constant"}const Ws=(y,a,f,v,S,T)=>{return{u_matrix:y,u_tl_parent:a,u_scale_parent:f,u_fade_t:v.mix,u_opacity:v.opacity*S.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:S.paint.get("raster-brightness-min"),u_brightness_high:S.paint.get("raster-brightness-max"),u_saturation_factor:(z=S.paint.get("raster-saturation"),z>0?1-1/(1.001-z):-z),u_contrast_factor:(N=S.paint.get("raster-contrast"),N>0?1/(1-N):1+N),u_spin_weights:Ba(S.paint.get("raster-hue-rotate")),u_perspective_transform:T};var N,z};function Ba(y){y*=Math.PI/180;const a=Math.sin(y),f=Math.cos(y);return[(2*f+1)/3,(-Math.sqrt(3)*a-f+1)/3,(Math.sqrt(3)*a-f+1)/3]}const Ol=o.create(),_s=(y,a,f,v,S,T,N,z,G,ee,te,ge,Ae,Le,Xe,Ue)=>{const Ze=S.transform,_e={u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:Ze.cameraToCenterDistance,u_rotate_symbol:+f,u_aspect_ratio:Ze.width/Ze.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_matrix:T,u_label_plane_matrix:N,u_coord_matrix:z,u_is_text:+G,u_pitch_with_map:+v,u_texsize:ee,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ol,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Ol,u_up_vector:[0,-1,0]};return Ue.name==="globe"&&(_e.u_tile_id=[te.canonical.x,te.canonical.y,1<<te.canonical.z],_e.u_zoom_transition=ge,_e.u_inv_rot_matrix=Le,_e.u_merc_center=Ae,_e.u_camera_forward=Ze._camera.forward(),_e.u_ecef_origin=o.globeECEFOrigin(Ze.globeMatrix,te.toUnwrapped()),_e.u_tile_matrix=Float32Array.from(Ze.globeMatrix),_e.u_up_vector=Xe),_e},Uo=(y,a,f,v,S,T,N,z,G,ee,te,ge,Ae,Le,Xe,Ue,Ze)=>o.extend(_s(y,a,f,v,S,T,N,z,G,ee,ge,Ae,Le,Xe,Ue,Ze),{u_gamma_scale:v?S.transform.cameraToCenterDistance*Math.cos(S.terrain?0:S.transform._pitch):1,u_device_pixel_ratio:o.exported.devicePixelRatio,u_is_halo:1}),Ia=(y,a,f,v,S,T,N,z,G,ee,te,ge,Ae,Le,Xe,Ue)=>o.extend(Uo(y,a,f,v,S,T,N,z,!0,G,!0,te,ge,Ae,Le,Xe,Ue),{u_texsize_icon:ee,u_texture_icon:1}),Ks=(y,a,f)=>({u_matrix:y,u_opacity:a,u_color:f}),yu=(y,a,f,v,S)=>o.extend((function(T,N,z){const G=N.imageManager.getPattern(T.toString()),{width:ee,height:te}=N.imageManager.getPixelSize(),ge=Math.pow(2,z.tileID.overscaledZ),Ae=z.tileSize*Math.pow(2,N.transform.tileZoom)/ge,Le=Ae*(z.tileID.canonical.x+z.tileID.wrap*ge),Xe=Ae*z.tileID.canonical.y;return{u_image:0,u_pattern_tl:G.tl,u_pattern_br:G.br,u_texsize:[ee,te],u_pattern_size:G.displaySize,u_tile_units_to_pixels:1/le(z,1,N.transform.tileZoom),u_pixel_coord_upper:[Le>>16,Xe>>16],u_pixel_coord_lower:[65535&Le,65535&Xe]}})(v,f,S),{u_matrix:y,u_opacity:a}),wc={fillExtrusion:y=>({u_matrix:new o.UniformMatrix4f(y),u_lightpos:new o.Uniform3f(y),u_lightintensity:new o.Uniform1f(y),u_lightcolor:new o.Uniform3f(y),u_vertical_gradient:new o.Uniform1f(y),u_opacity:new o.Uniform1f(y),u_edge_radius:new o.Uniform1f(y),u_ao:new o.Uniform2f(y),u_tile_id:new o.Uniform3f(y),u_zoom_transition:new o.Uniform1f(y),u_inv_rot_matrix:new o.UniformMatrix4f(y),u_merc_center:new o.Uniform2f(y),u_up_dir:new o.Uniform3f(y),u_height_lift:new o.Uniform1f(y)}),fillExtrusionPattern:y=>({u_matrix:new o.UniformMatrix4f(y),u_lightpos:new o.Uniform3f(y),u_lightintensity:new o.Uniform1f(y),u_lightcolor:new o.Uniform3f(y),u_vertical_gradient:new o.Uniform1f(y),u_height_factor:new o.Uniform1f(y),u_edge_radius:new o.Uniform1f(y),u_ao:new o.Uniform2f(y),u_tile_id:new o.Uniform3f(y),u_zoom_transition:new o.Uniform1f(y),u_inv_rot_matrix:new o.UniformMatrix4f(y),u_merc_center:new o.Uniform2f(y),u_up_dir:new o.Uniform3f(y),u_height_lift:new o.Uniform1f(y),u_image:new o.Uniform1i(y),u_texsize:new o.Uniform2f(y),u_pixel_coord_upper:new o.Uniform2f(y),u_pixel_coord_lower:new o.Uniform2f(y),u_tile_units_to_pixels:new o.Uniform1f(y),u_opacity:new o.Uniform1f(y)}),fill:y=>({u_matrix:new o.UniformMatrix4f(y)}),fillPattern:y=>({u_matrix:new o.UniformMatrix4f(y),u_image:new o.Uniform1i(y),u_texsize:new o.Uniform2f(y),u_pixel_coord_upper:new o.Uniform2f(y),u_pixel_coord_lower:new o.Uniform2f(y),u_tile_units_to_pixels:new o.Uniform1f(y)}),fillOutline:y=>({u_matrix:new o.UniformMatrix4f(y),u_world:new o.Uniform2f(y)}),fillOutlinePattern:y=>({u_matrix:new o.UniformMatrix4f(y),u_world:new o.Uniform2f(y),u_image:new o.Uniform1i(y),u_texsize:new o.Uniform2f(y),u_pixel_coord_upper:new o.Uniform2f(y),u_pixel_coord_lower:new o.Uniform2f(y),u_tile_units_to_pixels:new o.Uniform1f(y)}),circle:y=>({u_camera_to_center_distance:new o.Uniform1f(y),u_extrude_scale:new o.UniformMatrix2f(y),u_device_pixel_ratio:new o.Uniform1f(y),u_matrix:new o.UniformMatrix4f(y),u_inv_rot_matrix:new o.UniformMatrix4f(y),u_merc_center:new o.Uniform2f(y),u_tile_id:new o.Uniform3f(y),u_zoom_transition:new o.Uniform1f(y),u_up_dir:new o.Uniform3f(y)}),collisionBox:y=>({u_matrix:new o.UniformMatrix4f(y),u_camera_to_center_distance:new o.Uniform1f(y),u_extrude_scale:new o.Uniform2f(y)}),collisionCircle:y=>({u_matrix:new o.UniformMatrix4f(y),u_inv_matrix:new o.UniformMatrix4f(y),u_camera_to_center_distance:new o.Uniform1f(y),u_viewport_size:new o.Uniform2f(y)}),debug:y=>({u_color:new o.UniformColor(y),u_matrix:new o.UniformMatrix4f(y),u_overlay:new o.Uniform1i(y),u_overlay_scale:new o.Uniform1f(y)}),clippingMask:y=>({u_matrix:new o.UniformMatrix4f(y)}),heatmap:y=>({u_extrude_scale:new o.Uniform1f(y),u_intensity:new o.Uniform1f(y),u_matrix:new o.UniformMatrix4f(y),u_inv_rot_matrix:new o.UniformMatrix4f(y),u_merc_center:new o.Uniform2f(y),u_tile_id:new o.Uniform3f(y),u_zoom_transition:new o.Uniform1f(y),u_up_dir:new o.Uniform3f(y)}),heatmapTexture:y=>({u_image:new o.Uniform1i(y),u_color_ramp:new o.Uniform1i(y),u_opacity:new o.Uniform1f(y)}),hillshade:y=>({u_matrix:new o.UniformMatrix4f(y),u_image:new o.Uniform1i(y),u_latrange:new o.Uniform2f(y),u_light:new o.Uniform2f(y),u_shadow:new o.UniformColor(y),u_highlight:new o.UniformColor(y),u_accent:new o.UniformColor(y)}),hillshadePrepare:y=>({u_matrix:new o.UniformMatrix4f(y),u_image:new o.Uniform1i(y),u_dimension:new o.Uniform2f(y),u_zoom:new o.Uniform1f(y),u_unpack:new o.Uniform4f(y)}),line:y=>({u_matrix:new o.UniformMatrix4f(y),u_pixels_to_tile_units:new o.UniformMatrix2f(y),u_device_pixel_ratio:new o.Uniform1f(y),u_units_to_pixels:new o.Uniform2f(y),u_dash_image:new o.Uniform1i(y),u_gradient_image:new o.Uniform1i(y),u_image_height:new o.Uniform1f(y),u_texsize:new o.Uniform2f(y),u_tile_units_to_pixels:new o.Uniform1f(y),u_alpha_discard_threshold:new o.Uniform1f(y),u_trim_offset:new o.Uniform2f(y)}),linePattern:y=>({u_matrix:new o.UniformMatrix4f(y),u_texsize:new o.Uniform2f(y),u_pixels_to_tile_units:new o.UniformMatrix2f(y),u_device_pixel_ratio:new o.Uniform1f(y),u_image:new o.Uniform1i(y),u_units_to_pixels:new o.Uniform2f(y),u_tile_units_to_pixels:new o.Uniform1f(y),u_alpha_discard_threshold:new o.Uniform1f(y)}),raster:y=>({u_matrix:new o.UniformMatrix4f(y),u_tl_parent:new o.Uniform2f(y),u_scale_parent:new o.Uniform1f(y),u_fade_t:new o.Uniform1f(y),u_opacity:new o.Uniform1f(y),u_image0:new o.Uniform1i(y),u_image1:new o.Uniform1i(y),u_brightness_low:new o.Uniform1f(y),u_brightness_high:new o.Uniform1f(y),u_saturation_factor:new o.Uniform1f(y),u_contrast_factor:new o.Uniform1f(y),u_spin_weights:new o.Uniform3f(y),u_perspective_transform:new o.Uniform2f(y)}),symbolIcon:y=>({u_is_size_zoom_constant:new o.Uniform1i(y),u_is_size_feature_constant:new o.Uniform1i(y),u_size_t:new o.Uniform1f(y),u_size:new o.Uniform1f(y),u_camera_to_center_distance:new o.Uniform1f(y),u_rotate_symbol:new o.Uniform1i(y),u_aspect_ratio:new o.Uniform1f(y),u_fade_change:new o.Uniform1f(y),u_matrix:new o.UniformMatrix4f(y),u_label_plane_matrix:new o.UniformMatrix4f(y),u_coord_matrix:new o.UniformMatrix4f(y),u_is_text:new o.Uniform1i(y),u_pitch_with_map:new o.Uniform1i(y),u_texsize:new o.Uniform2f(y),u_tile_id:new o.Uniform3f(y),u_zoom_transition:new o.Uniform1f(y),u_inv_rot_matrix:new o.UniformMatrix4f(y),u_merc_center:new o.Uniform2f(y),u_camera_forward:new o.Uniform3f(y),u_tile_matrix:new o.UniformMatrix4f(y),u_up_vector:new o.Uniform3f(y),u_ecef_origin:new o.Uniform3f(y),u_texture:new o.Uniform1i(y)}),symbolSDF:y=>({u_is_size_zoom_constant:new o.Uniform1i(y),u_is_size_feature_constant:new o.Uniform1i(y),u_size_t:new o.Uniform1f(y),u_size:new o.Uniform1f(y),u_camera_to_center_distance:new o.Uniform1f(y),u_rotate_symbol:new o.Uniform1i(y),u_aspect_ratio:new o.Uniform1f(y),u_fade_change:new o.Uniform1f(y),u_matrix:new o.UniformMatrix4f(y),u_label_plane_matrix:new o.UniformMatrix4f(y),u_coord_matrix:new o.UniformMatrix4f(y),u_is_text:new o.Uniform1i(y),u_pitch_with_map:new o.Uniform1i(y),u_texsize:new o.Uniform2f(y),u_texture:new o.Uniform1i(y),u_gamma_scale:new o.Uniform1f(y),u_device_pixel_ratio:new o.Uniform1f(y),u_tile_id:new o.Uniform3f(y),u_zoom_transition:new o.Uniform1f(y),u_inv_rot_matrix:new o.UniformMatrix4f(y),u_merc_center:new o.Uniform2f(y),u_camera_forward:new o.Uniform3f(y),u_tile_matrix:new o.UniformMatrix4f(y),u_up_vector:new o.Uniform3f(y),u_ecef_origin:new o.Uniform3f(y),u_is_halo:new o.Uniform1i(y)}),symbolTextAndIcon:y=>({u_is_size_zoom_constant:new o.Uniform1i(y),u_is_size_feature_constant:new o.Uniform1i(y),u_size_t:new o.Uniform1f(y),u_size:new o.Uniform1f(y),u_camera_to_center_distance:new o.Uniform1f(y),u_rotate_symbol:new o.Uniform1i(y),u_aspect_ratio:new o.Uniform1f(y),u_fade_change:new o.Uniform1f(y),u_matrix:new o.UniformMatrix4f(y),u_label_plane_matrix:new o.UniformMatrix4f(y),u_coord_matrix:new o.UniformMatrix4f(y),u_is_text:new o.Uniform1i(y),u_pitch_with_map:new o.Uniform1i(y),u_texsize:new o.Uniform2f(y),u_texsize_icon:new o.Uniform2f(y),u_texture:new o.Uniform1i(y),u_texture_icon:new o.Uniform1i(y),u_gamma_scale:new o.Uniform1f(y),u_device_pixel_ratio:new o.Uniform1f(y),u_is_halo:new o.Uniform1i(y)}),background:y=>({u_matrix:new o.UniformMatrix4f(y),u_opacity:new o.Uniform1f(y),u_color:new o.UniformColor(y)}),backgroundPattern:y=>({u_matrix:new o.UniformMatrix4f(y),u_opacity:new o.Uniform1f(y),u_image:new o.Uniform1i(y),u_pattern_tl:new o.Uniform2f(y),u_pattern_br:new o.Uniform2f(y),u_texsize:new o.Uniform2f(y),u_pattern_size:new o.Uniform2f(y),u_pixel_coord_upper:new o.Uniform2f(y),u_pixel_coord_lower:new o.Uniform2f(y),u_tile_units_to_pixels:new o.Uniform1f(y)}),terrainRaster:xo,terrainDepth:xo,skybox:y=>({u_matrix:new o.UniformMatrix4f(y),u_sun_direction:new o.Uniform3f(y),u_cubemap:new o.Uniform1i(y),u_opacity:new o.Uniform1f(y),u_temporal_offset:new o.Uniform1f(y)}),skyboxGradient:y=>({u_matrix:new o.UniformMatrix4f(y),u_color_ramp:new o.Uniform1i(y),u_center_direction:new o.Uniform3f(y),u_radius:new o.Uniform1f(y),u_opacity:new o.Uniform1f(y),u_temporal_offset:new o.Uniform1f(y)}),skyboxCapture:y=>({u_matrix_3f:new o.UniformMatrix3f(y),u_sun_direction:new o.Uniform3f(y),u_sun_intensity:new o.Uniform1f(y),u_color_tint_r:new o.Uniform4f(y),u_color_tint_m:new o.Uniform4f(y),u_luminance:new o.Uniform1f(y)}),globeRaster:y=>({u_proj_matrix:new o.UniformMatrix4f(y),u_globe_matrix:new o.UniformMatrix4f(y),u_normalize_matrix:new o.UniformMatrix4f(y),u_merc_matrix:new o.UniformMatrix4f(y),u_zoom_transition:new o.Uniform1f(y),u_merc_center:new o.Uniform2f(y),u_image0:new o.Uniform1i(y),u_grid_matrix:new o.UniformMatrix3f(y),u_skirt_height:new o.Uniform1f(y),u_frustum_tl:new o.Uniform3f(y),u_frustum_tr:new o.Uniform3f(y),u_frustum_br:new o.Uniform3f(y),u_frustum_bl:new o.Uniform3f(y),u_globe_pos:new o.Uniform3f(y),u_globe_radius:new o.Uniform1f(y),u_viewport:new o.Uniform2f(y)}),globeAtmosphere:y=>({u_frustum_tl:new o.Uniform3f(y),u_frustum_tr:new o.Uniform3f(y),u_frustum_br:new o.Uniform3f(y),u_frustum_bl:new o.Uniform3f(y),u_horizon:new o.Uniform1f(y),u_transition:new o.Uniform1f(y),u_fadeout_range:new o.Uniform1f(y),u_color:new o.Uniform4f(y),u_high_color:new o.Uniform4f(y),u_space_color:new o.Uniform4f(y),u_star_intensity:new o.Uniform1f(y),u_star_density:new o.Uniform1f(y),u_star_size:new o.Uniform1f(y),u_temporal_offset:new o.Uniform1f(y),u_horizon_angle:new o.Uniform1f(y),u_rotation_matrix:new o.UniformMatrix4f(y)})};let iu;function za(y,a,f,v,S,T,N){const z=y.context,G=z.gl,ee=y.transform,te=y.useProgram("collisionBox"),ge=[];let Ae=0,Le=0;for(let ot=0;ot<v.length;ot++){const bt=v[ot],wt=a.getTile(bt),vt=wt.getBucket(f);if(!vt)continue;const Rt=fs(bt,vt,ee);let Lt=Rt;S[0]===0&&S[1]===0||(Lt=y.translatePosMatrix(Rt,wt,S,T));const zt=N?vt.textCollisionBox:vt.iconCollisionBox,mn=vt.collisionCircleArray;if(mn.length>0){const Ut=o.create(),an=Lt;o.mul(Ut,vt.placementInvProjMatrix,ee.glCoordMatrix),o.mul(Ut,Ut,vt.placementViewportMatrix),ge.push({circleArray:mn,circleOffset:Le,transform:an,invTransform:Ut,projection:vt.getProjection()}),Ae+=mn.length/4,Le=Ae}zt&&(y.terrain&&y.terrain.setupElevationDraw(wt,te),te.draw(z,G.LINES,o.DepthMode.disabled,o.StencilMode.disabled,y.colorModeForRenderPass(),o.CullFaceMode.disabled,Fl(Lt,ee,wt,vt.getProjection()),f.id,zt.layoutVertexBuffer,zt.indexBuffer,zt.segments,null,ee.zoom,null,[zt.collisionVertexBuffer,zt.collisionVertexBufferExt]))}if(!N||!ge.length)return;const Xe=y.useProgram("collisionCircle"),Ue=new o.StructArrayLayout2f1f2i16;Ue.resize(4*Ae),Ue._trim();let Ze=0;for(const ot of ge)for(let bt=0;bt<ot.circleArray.length/4;bt++){const wt=4*bt,vt=ot.circleArray[wt+0],Rt=ot.circleArray[wt+1],Lt=ot.circleArray[wt+2],zt=ot.circleArray[wt+3];Ue.emplace(Ze++,vt,Rt,Lt,zt,0),Ue.emplace(Ze++,vt,Rt,Lt,zt,1),Ue.emplace(Ze++,vt,Rt,Lt,zt,2),Ue.emplace(Ze++,vt,Rt,Lt,zt,3)}(!iu||iu.length<2*Ae)&&(iu=(function(ot){const bt=2*ot,wt=new o.StructArrayLayout3ui6;wt.resize(bt),wt._trim();for(let vt=0;vt<bt;vt++){const Rt=6*vt;wt.uint16[Rt+0]=4*vt+0,wt.uint16[Rt+1]=4*vt+1,wt.uint16[Rt+2]=4*vt+2,wt.uint16[Rt+3]=4*vt+2,wt.uint16[Rt+4]=4*vt+3,wt.uint16[Rt+5]=4*vt+0}return wt})(Ae));const _e=z.createIndexBuffer(iu,!0),$e=z.createVertexBuffer(Ue,o.collisionCircleLayout.members,!0);for(const ot of ge){const bt={u_matrix:ot.transform,u_inv_matrix:ot.invTransform,u_camera_to_center_distance:(it=ee).getCameraToCenterDistance(ot.projection),u_viewport_size:[it.width,it.height]};Xe.draw(z,G.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,y.colorModeForRenderPass(),o.CullFaceMode.disabled,bt,f.id,$e,_e,o.SegmentVector.simpleSegment(0,2*ot.circleOffset,ot.circleArray.length,ot.circleArray.length/2),null,ee.zoom)}var it;$e.destroy(),_e.destroy()}const nc=o.create();function _l({width:y,height:a,anchor:f,textOffset:v,textScale:S},T){const{horizontalAlign:N,verticalAlign:z}=o.getAnchorAlignment(f),G=-(N-.5)*y,ee=-(z-.5)*a,te=o.evaluateVariableOffset(f,v);return new o.Point((G/S+te[0])*T,(ee/S+te[1])*T)}function Bl(y,a,f,v,S,T,N,z,G,ee,te){const ge=y.text.placedSymbolArray,Ae=y.text.dynamicLayoutVertexArray,Le=y.icon.dynamicLayoutVertexArray,Xe={},Ue=y.getProjection(),Ze=Ui(z,Ue,T),_e=T.elevation,$e=Ue.upVectorScale(z.canonical,T.center.lat,T.worldSize).metersToTile;Ae.clear();for(let it=0;it<ge.length;it++){const ot=ge.get(it),{tileAnchorX:bt,tileAnchorY:wt,numGlyphs:vt}=ot,Rt=ot.hidden||!ot.crossTileID||y.allowVerticalPlacement&&!ot.placedOrientation?null:v[ot.crossTileID];if(Rt){let Lt=0,zt=0,mn=0;if(_e){const bn=_e?_e.getAtTileOffset(z,bt,wt):0,[pr,Fr,sr]=Ue.upVector(z.canonical,bt,wt);Lt=bn*pr*$e,zt=bn*Fr*$e,mn=bn*sr*$e}let[Ut,an,Ht,Cn]=xi(ot.projectedAnchorX+Lt,ot.projectedAnchorY+zt,ot.projectedAnchorZ+mn,f?Ze:N);const jt=pu(T.getCameraToCenterDistance(Ue),Cn);let on=S.evaluateSizeForFeature(y.textSizeData,ee,ot)*jt/o.ONE_EM;f&&(on*=y.tilePixelRatio/G);const In=_l(Rt,on);f?({x:Ut,y:an,z:Ht}=Ue.projectTilePoint(bt+In.x,wt+In.y,z.canonical),[Ut,an,Ht]=xi(Ut+Lt,an+zt,Ht+mn,N)):(a&&In._rotate(-T.angle),Ut+=In.x,an+=In.y,Ht=0);const xn=y.allowVerticalPlacement&&ot.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let bn=0;bn<vt;bn++)o.addDynamicAttributes(Ae,Ut,an,Ht,xn);te&&ot.associatedIconIndex>=0&&(Xe[ot.associatedIconIndex]={x:Ut,y:an,z:Ht,angle:xn})}else Ta(vt,Ae)}if(te){Le.clear();const it=y.icon.placedSymbolArray;for(let ot=0;ot<it.length;ot++){const bt=it.get(ot),{numGlyphs:wt}=bt,vt=Xe[ot];if(bt.hidden||!vt)Ta(wt,Le);else{const{x:Rt,y:Lt,z:zt,angle:mn}=vt;for(let Ut=0;Ut<wt;Ut++)o.addDynamicAttributes(Le,Rt,Lt,zt,mn)}}y.icon.dynamicLayoutVertexBuffer.updateData(Le)}y.text.dynamicLayoutVertexBuffer.updateData(Ae)}function zl(y,a,f){return f.iconsInText&&a?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function vl(y,a,f,v,S,T,N,z,G,ee,te,ge){const Ae=y.context,Le=Ae.gl,Xe=y.transform,Ue=z==="map",Ze=G==="map",_e=Ue&&f.layout.get("symbol-placement")!=="point",$e=Ue&&!Ze&&!_e,it=f.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ot=!1;const bt=y.depthModeForSublayer(0,o.DepthMode.ReadOnly),wt=[o.mercatorXfromLng(Xe.center.lng),o.mercatorYfromLat(Xe.center.lat)],vt=f.layout.get("text-variable-anchor"),Rt=Xe.projection.name==="globe",Lt=[],zt=[0,-1,0];let mn=zt;!Rt&&!Xe.mercatorFromTransition||Ue||(mn=(function(Ut){const an=Ut._camera.getWorldToCamera(Ut.worldSize,1),Ht=o.multiply([],an,Ut.globeMatrix);o.invert(Ht,Ht);const Cn=[0,0,0],jt=[0,1,0,0];return o.transformMat4$1(jt,jt,Ht),Cn[0]=jt[0],Cn[1]=jt[1],Cn[2]=jt[2],o.normalize(Cn,Cn),Cn})(Xe));for(const Ut of v){const an=a.getTile(Ut),Ht=an.getBucket(f);if(!Ht||Ht.projection.name==="mercator"&&Rt)continue;const Cn=S?Ht.text:Ht.icon;if(!Cn||Ht.fullyClipped||!Cn.segments.get().length)continue;const jt=Cn.programConfigurations.get(f.id),on=S||Ht.sdfIcons,In=S?Ht.textSizeData:Ht.iconSizeData,xn=Ze||Xe.pitch!==0,bn=o.evaluateSizeForZoom(In,Xe.zoom);let pr,Fr,sr,fr,$r=[0,0],gi=null;if(S)Fr=an.glyphAtlasTexture,sr=Le.LINEAR,pr=an.glyphAtlasTexture.size,Ht.iconsInText&&($r=an.imageAtlasTexture.size,gi=an.imageAtlasTexture,fr=xn||y.options.rotating||y.options.zooming||In.kind==="composite"||In.kind==="camera"?Le.LINEAR:Le.NEAREST);else{const $l=f.layout.get("icon-size").constantOr(0)!==1||Ht.iconsNeedLinear;Fr=an.imageAtlasTexture,sr=on||y.options.rotating||y.options.zooming||$l||xn?Le.LINEAR:Le.NEAREST,pr=an.imageAtlasTexture.size}const Sr=Ht.projection.name==="globe",ki=Sr?mn:zt,Ci=Sr?o.globeToMercatorTransition(Xe.zoom):0,co=Ui(Ut,Ht.getProjection(),Xe),Ri=Xe.calculatePixelsToTileUnitsMatrix(an),ba=dn(co,an.tileID.canonical,Ze,Ue,Xe,Ht.getProjection(),Ri),ts=y.terrain&&Ze&&_e?o.invert(o.create(),ba):nc,cc=ss(co,an.tileID.canonical,Ze,Ue,Xe,Ht.getProjection(),Ri),Cc=vt&&Ht.hasTextData(),Li=f.layout.get("icon-text-fit")!=="none"&&Cc&&Ht.hasIconData();if(_e){const $l=Xe.elevation,Il=$l?$l.getAtTileOffsetFunc(Ut,Xe.center.lat,Xe.worldSize,Ht.getProjection()):null,ka=Xo(co,an.tileID.canonical,Ze,Ue,Xe,Ht.getProjection(),Ri);Ya(Ht,co,y,S,ka,cc,Ze,ee,Il,Ut)}const eo=_e||S&&vt||Li,uo=y.translatePosMatrix(co,an,T,N),Ms=eo?nc:ba,qa=y.translatePosMatrix(cc,an,T,N,!0),ns=Ht.getProjection().createInversionMatrix(Xe,Ut.canonical),As=[];y.terrainRenderModeElevated()&&Ze&&As.push("PITCH_WITH_MAP_TERRAIN"),Sr&&As.push("PROJECTION_GLOBE_VIEW"),eo&&As.push("PROJECTED_POS_ON_VIEWPORT");const hs=on&&f.paint.get(S?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let xs;xs=on?Ht.iconsInText?Ia(In.kind,bn,$e,Ze,y,uo,Ms,qa,pr,$r,Ut,Ci,wt,ns,ki,Ht.getProjection()):Uo(In.kind,bn,$e,Ze,y,uo,Ms,qa,S,pr,!0,Ut,Ci,wt,ns,ki,Ht.getProjection()):_s(In.kind,bn,$e,Ze,y,uo,Ms,qa,S,pr,Ut,Ci,wt,ns,ki,Ht.getProjection());const ls={program:y.useProgram(zl(on,S,Ht),jt,As),buffers:Cn,uniformValues:xs,atlasTexture:Fr,atlasTextureIcon:gi,atlasInterpolation:sr,atlasInterpolationIcon:fr,isSDF:on,hasHalo:hs,tile:an,labelPlaneMatrixInv:ts};if(it&&Ht.canOverlap){ot=!0;const $l=Cn.segments.get();for(const Il of $l)Lt.push({segments:new o.SegmentVector([Il]),sortKey:Il.sortKey,state:ls})}else Lt.push({segments:Cn.segments,sortKey:0,state:ls})}ot&&Lt.sort(((Ut,an)=>Ut.sortKey-an.sortKey));for(const Ut of Lt){const an=Ut.state;if(y.terrain&&y.terrain.setupElevationDraw(an.tile,an.program,{useDepthForOcclusion:!Rt,labelPlaneMatrixInv:an.labelPlaneMatrixInv}),Ae.activeTexture.set(Le.TEXTURE0),an.atlasTexture.bind(an.atlasInterpolation,Le.CLAMP_TO_EDGE),an.atlasTextureIcon&&(Ae.activeTexture.set(Le.TEXTURE1),an.atlasTextureIcon&&an.atlasTextureIcon.bind(an.atlasInterpolationIcon,Le.CLAMP_TO_EDGE)),an.isSDF){const Ht=an.uniformValues;an.hasHalo&&(Ht.u_is_halo=1,el(an.buffers,Ut.segments,f,y,an.program,bt,te,ge,Ht)),Ht.u_is_halo=0}el(an.buffers,Ut.segments,f,y,an.program,bt,te,ge,an.uniformValues)}}function el(y,a,f,v,S,T,N,z,G){const ee=v.context,te=[y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer,y.globeExtVertexBuffer];S.draw(ee,ee.gl.TRIANGLES,T,N,z,o.CullFaceMode.disabled,G,f.id,y.layoutVertexBuffer,y.indexBuffer,a,f.paint,v.transform.zoom,y.programConfigurations.get(f.id),te)}function ks(y,a,f,v,S,T,N){const z=y.context.gl,G=f.paint.get("fill-pattern"),ee=G&&G.constantOr(1);let te,ge,Ae,Le,Xe;N?(ge=ee&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",te=z.LINES):(ge=ee?"fillPattern":"fill",te=z.TRIANGLES);for(const Ue of v){const Ze=a.getTile(Ue);if(ee&&!Ze.patternsLoaded())continue;const _e=Ze.getBucket(f);if(!_e)continue;y.prepareDrawTile();const $e=_e.programConfigurations.get(f.id),it=y.useProgram(ge,$e);ee&&(y.context.activeTexture.set(z.TEXTURE0),Ze.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),$e.updatePaintBuffers());const ot=G.constantOr(null);if(ot&&Ze.imageAtlas){const wt=Ze.imageAtlas.patternPositions[ot.toString()];wt&&$e.setConstantPatternPositions(wt)}const bt=y.translatePosMatrix(Ue.projMatrix,Ze,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));if(N){Le=_e.indexBuffer2,Xe=_e.segments2;const wt=y.terrain&&y.terrain.renderingToTexture?y.terrain.drapeBufferSize:[z.drawingBufferWidth,z.drawingBufferHeight];Ae=ge==="fillOutlinePattern"&&ee?Mo(bt,y,Ze,wt):zi(bt,wt)}else Le=_e.indexBuffer,Xe=_e.segments,Ae=ee?Ki(bt,y,Ze):Fo(bt);y.prepareDrawProgram(y.context,it,Ue.toUnwrapped()),it.draw(y.context,te,S,y.stencilModeForClipping(Ue),T,o.CullFaceMode.disabled,Ae,f.id,_e.layoutVertexBuffer,Le,Xe,f.paint,y.transform.zoom,$e)}}function No(y,a,f,v,S,T,N){const z=y.context,G=z.gl,ee=y.transform,te=f.paint.get("fill-extrusion-pattern"),ge=te.constantOr(1),Ae=f.paint.get("fill-extrusion-opacity"),Le=[f.paint.get("fill-extrusion-ambient-occlusion-intensity"),f.paint.get("fill-extrusion-ambient-occlusion-radius")],Xe=f.layout.get("fill-extrusion-edge-radius"),Ue=Xe>0&&!f.paint.get("fill-extrusion-rounded-roof"),Ze=Ue?0:Xe,_e=ee.projection.name==="globe"?o.fillExtrusionHeightLift():0,$e=ee.projection.name==="globe",it=$e?o.globeToMercatorTransition(ee.zoom):0,ot=[o.mercatorXfromLng(ee.center.lng),o.mercatorYfromLat(ee.center.lat)],bt=[];$e&&bt.push("PROJECTION_GLOBE_VIEW"),Le[0]>0&&bt.push("FAUX_AO"),Ue&&bt.push("ZERO_ROOF_RADIUS");for(const wt of v){const vt=a.getTile(wt),Rt=vt.getBucket(f);if(!Rt||Rt.projection.name!==ee.projection.name)continue;const Lt=Rt.programConfigurations.get(f.id),zt=y.useProgram(ge?"fillExtrusionPattern":"fillExtrusion",Lt,bt);if(y.terrain){const on=y.terrain;if(y.style.terrainSetForDrapingOnly())on.setupElevationDraw(vt,zt,{useMeterToDem:!0});else{if(!Rt.enableTerrain)continue;if(on.setupElevationDraw(vt,zt,{useMeterToDem:!0}),Wo(z,a,wt,Rt,f,on),!Rt.centroidVertexBuffer){const In=zt.attributes.a_centroid_pos;In!==void 0&&G.vertexAttrib2f(In,0,0)}}}ge&&(y.context.activeTexture.set(G.TEXTURE0),vt.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),Lt.updatePaintBuffers());const mn=te.constantOr(null);if(mn&&vt.imageAtlas){const on=vt.imageAtlas.patternPositions[mn.toString()];on&&Lt.setConstantPatternPositions(on)}const Ut=y.translatePosMatrix(wt.projMatrix,vt,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),an=ee.projection.createInversionMatrix(ee,wt.canonical),Ht=f.paint.get("fill-extrusion-vertical-gradient"),Cn=ge?so(Ut,y,Ht,Ae,Le,Ze,wt,vt,_e,it,ot,an):ar(Ut,y,Ht,Ae,Le,Ze,wt,_e,it,ot,an);y.prepareDrawProgram(z,zt,wt.toUnwrapped());const jt=[];y.terrain&&jt.push(Rt.centroidVertexBuffer),$e&&jt.push(Rt.layoutVertexExtBuffer),zt.draw(z,z.gl.TRIANGLES,S,T,N,o.CullFaceMode.backCCW,Cn,f.id,Rt.layoutVertexBuffer,Rt.indexBuffer,Rt.segments,f.paint,y.transform.zoom,Lt,jt)}}function Wo(y,a,f,v,S,T){const N=[_e=>{let $e=_e.canonical.x-1,it=_e.wrap;return $e<0&&($e=(1<<_e.canonical.z)-1,it--),new o.OverscaledTileID(_e.overscaledZ,it,_e.canonical.z,$e,_e.canonical.y)},_e=>{let $e=_e.canonical.x+1,it=_e.wrap;return $e===1<<_e.canonical.z&&($e=0,it++),new o.OverscaledTileID(_e.overscaledZ,it,_e.canonical.z,$e,_e.canonical.y)},_e=>new o.OverscaledTileID(_e.overscaledZ,_e.wrap,_e.canonical.z,_e.canonical.x,(_e.canonical.y===0?1<<_e.canonical.z:_e.canonical.y)-1),_e=>new o.OverscaledTileID(_e.overscaledZ,_e.wrap,_e.canonical.z,_e.canonical.x,_e.canonical.y===(1<<_e.canonical.z)-1?0:_e.canonical.y+1)],z=_e=>{const $e=a.getSource().minzoom,it=bt=>{const wt=a.getTileByID(bt);if(wt&&wt.hasData())return wt.getBucket(S)},ot=[0,-1,1];for(const bt of ot){if(_e.overscaledZ+bt<$e)continue;const wt=it(_e.calculateScaledKey(_e.overscaledZ+bt));if(wt)return wt}},G=[0,0,0],ee=(_e,$e)=>(G[0]=Math.min(_e.min.y,$e.min.y),G[1]=Math.max(_e.max.y,$e.max.y),G[2]=o.EXTENT-$e.min.x>_e.max.x?$e.min.x-o.EXTENT:_e.max.x,G),te=(_e,$e)=>(G[0]=Math.min(_e.min.x,$e.min.x),G[1]=Math.max(_e.max.x,$e.max.x),G[2]=o.EXTENT-$e.min.y>_e.max.y?$e.min.y-o.EXTENT:_e.max.y,G),ge=[(_e,$e)=>ee(_e,$e),(_e,$e)=>ee($e,_e),(_e,$e)=>te(_e,$e),(_e,$e)=>te($e,_e)],Ae=new o.Point(0,0);let Le,Xe,Ue;const Ze=(_e,$e,it,ot,bt)=>{const wt=[[ot?it:_e,ot?_e:it,0],[ot?it:$e,ot?$e:it,0]],vt=bt<0?o.EXTENT+bt:bt,Rt=[ot?vt:(_e+$e)/2,ot?(_e+$e)/2:vt,0];return it===0&&bt<0||it!==0&&bt>0?T.getForTilePoints(Ue,[Rt],!0,Xe):wt.push(Rt),T.getForTilePoints(f,wt,!0,Le),Math.max(wt[0][2],wt[1][2],Rt[2])/T.exaggeration()};for(let _e=0;_e<4;_e++){const $e=(_e<2?1:5)-_e,it=v.borders[_e];if(it.length===0)continue;const ot=Ue=N[_e](f),bt=z(ot);if(!(bt&&bt instanceof o.FillExtrusionBucket&&bt.enableTerrain)||v.borderDoneWithNeighborZ[_e]===bt.canonical.z&&bt.borderDoneWithNeighborZ[$e]===v.canonical.z||(Xe=T.findDEMTileFor(ot),!Xe||!Xe.dem))continue;if(!Le){const Lt=T.findDEMTileFor(f);if(!Lt||!Lt.dem)return;Le=Lt}const wt=bt.borders[$e];let vt=0;const Rt=bt.borderDoneWithNeighborZ[$e]!==v.canonical.z;if(v.canonical.z===bt.canonical.z){for(let Lt=0;Lt<it.length;Lt++){const zt=v.featuresOnBorder[it[Lt]],mn=zt.borders[_e];let Ut;for(;vt<wt.length&&(Ut=bt.featuresOnBorder[wt[vt]],!(Ut.borders[$e][1]>mn[0]+3));)Rt&&bt.encodeCentroid(void 0,Ut,!1),vt++;if(Ut&&vt<wt.length){const an=vt;let Ht=0;for(;!(Ut.borders[$e][0]>mn[1]-3)&&(Ht++,++vt!==wt.length);)Ut=bt.featuresOnBorder[wt[vt]];if(Ut=bt.featuresOnBorder[wt[an]],zt.intersectsCount()>1||Ut.intersectsCount()>1||Ht!==1){Ht!==1&&(vt=an),v.encodeCentroid(void 0,zt,!1),Rt&&bt.encodeCentroid(void 0,Ut,!1);continue}const Cn=ge[_e](zt,Ut),jt=_e%2?o.EXTENT-1:0;Ae.x=Ze(Cn[0],Math.min(o.EXTENT-1,Cn[1]),jt,_e<2,Cn[2]),Ae.y=0,v.encodeCentroid(Ae,zt,!1),Rt&&bt.encodeCentroid(Ae,Ut,!1)}else v.encodeCentroid(void 0,zt,!1)}v.borderDoneWithNeighborZ[_e]=bt.canonical.z,v.needsCentroidUpdate=!0,Rt&&(bt.borderDoneWithNeighborZ[$e]=v.canonical.z,bt.needsCentroidUpdate=!0)}else{for(const Lt of it)v.encodeCentroid(void 0,v.featuresOnBorder[Lt],!1);if(Rt){for(const Lt of wt)bt.encodeCentroid(void 0,bt.featuresOnBorder[Lt],!1);bt.borderDoneWithNeighborZ[$e]=v.canonical.z,bt.needsCentroidUpdate=!0}v.borderDoneWithNeighborZ[_e]=bt.canonical.z,v.needsCentroidUpdate=!0}}(v.needsCentroidUpdate||!v.centroidVertexBuffer&&v.centroidVertexArray.length!==0)&&v.uploadCentroid(y)}const Vo=new o.Color(1,0,0,1),vs=new o.Color(0,1,0,1),Ca=new o.Color(0,0,1,1),Sc=new o.Color(1,0,1,1),zh=new o.Color(0,1,1,1);function Ch(y,a,f){const v=y.context,S=y.transform,T=v.gl,N=S.projection.name==="globe",z=N?["PROJECTION_GLOBE_VIEW"]:null;let G=f.projMatrix;if(N&&o.globeToMercatorTransition(S.zoom)>0){const zt=o.transitionTileAABBinECEF(f.canonical,S),mn=o.globeDenormalizeECEF(zt);G=o.multiply(new Float32Array(16),S.globeMatrix,mn),o.multiply(G,S.projMatrix,G)}const ee=y.useProgram("debug",null,z),te=a.getTileByID(f.key);y.terrain&&y.terrain.setupElevationDraw(te,ee);const ge=o.DepthMode.disabled,Ae=o.StencilMode.disabled,Le=y.colorModeForRenderPass(),Xe="$debug";v.activeTexture.set(T.TEXTURE0),y.emptyTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),N?te._makeGlobeTileDebugBuffers(y.context,S):te._makeDebugTileBoundsBuffers(y.context,S.projection);const Ue=te._tileDebugBuffer||y.debugBuffer,Ze=te._tileDebugIndexBuffer||y.debugIndexBuffer,_e=te._tileDebugSegments||y.debugSegments;ee.draw(v,T.LINE_STRIP,ge,Ae,Le,o.CullFaceMode.disabled,ua(G,o.Color.red),Xe,Ue,Ze,_e,null,null,null,[te._globeTileDebugBorderBuffer]);const $e=te.latestRawTileData,it=Math.floor(($e&&$e.byteLength||0)/1024),ot=a.getTile(f).tileSize,bt=512/Math.min(ot,512)*(f.overscaledZ/S.zoom)*.5;let wt=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(wt+=` => ${f.overscaledZ}`),wt+=` ${it}kb`,(function(zt,mn){zt.initDebugOverlayCanvas();const Ut=zt.debugOverlayCanvas,an=zt.context.gl,Ht=zt.debugOverlayCanvas.getContext("2d");Ht.clearRect(0,0,Ut.width,Ut.height),Ht.shadowColor="white",Ht.shadowBlur=2,Ht.lineWidth=1.5,Ht.strokeStyle="white",Ht.textBaseline="top",Ht.font="bold 36px Open Sans, sans-serif",Ht.fillText(mn,5,5),Ht.strokeText(mn,5,5),zt.debugOverlayTexture.update(Ut),zt.debugOverlayTexture.bind(an.LINEAR,an.CLAMP_TO_EDGE)})(y,wt);const vt=te._tileDebugTextBuffer||y.debugBuffer,Rt=te._tileDebugTextIndexBuffer||y.quadTriangleIndexBuffer,Lt=te._tileDebugTextSegments||y.debugSegments;ee.draw(v,T.TRIANGLES,ge,Ae,o.ColorMode.alphaBlended,o.CullFaceMode.disabled,ua(G,o.Color.transparent,bt),Xe,vt,Rt,Lt,null,null,null,[te._globeTileDebugTextBuffer])}function rc(y,a,f,v){Ec(y,0,a+f/2,y.transform.width,f,v)}function eh(y,a,f,v){Ec(y,a-f/2,0,f,y.transform.height,v)}function Ec(y,a,f,v,S,T){const N=y.context,z=N.gl;z.enable(z.SCISSOR_TEST),z.scissor(a*o.exported.devicePixelRatio,f*o.exported.devicePixelRatio,v*o.exported.devicePixelRatio,S*o.exported.devicePixelRatio),N.clear({color:T}),z.disable(z.SCISSOR_TEST)}const td=o.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:jh}=td;function ic(y,a,f,v){y.emplaceBack(a,f,v)}class jc{constructor(a){this.vertexArray=new o.StructArrayLayout3f12,this.indices=new o.StructArrayLayout3ui6,ic(this.vertexArray,-1,-1,1),ic(this.vertexArray,1,-1,1),ic(this.vertexArray,-1,1,1),ic(this.vertexArray,1,1,1),ic(this.vertexArray,-1,-1,-1),ic(this.vertexArray,1,-1,-1),ic(this.vertexArray,-1,1,-1),ic(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=a.createVertexBuffer(this.vertexArray,jh),this.indexBuffer=a.createIndexBuffer(this.indices),this.segment=o.SegmentVector.simpleSegment(0,0,36,12)}}function La(y,a,f,v,S,T){const N=y.gl,z=a.paint.get("sky-atmosphere-color"),G=a.paint.get("sky-atmosphere-halo-color"),ee=a.paint.get("sky-atmosphere-sun-intensity"),te=((ge,Ae,Le,Xe,Ue)=>({u_matrix_3f:ge,u_sun_direction:Ae,u_sun_intensity:Le,u_color_tint_r:[Xe.r,Xe.g,Xe.b,Xe.a],u_color_tint_m:[Ue.r,Ue.g,Ue.b,Ue.a],u_luminance:5e-5}))(o.fromMat4(o.create$1(),v),S,ee,z,G);N.framebufferTexture2D(N.FRAMEBUFFER,N.COLOR_ATTACHMENT0,N.TEXTURE_CUBE_MAP_POSITIVE_X+T,a.skyboxTexture,0),f.draw(y,N.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.frontCW,te,"skyboxCapture",a.skyboxGeometry.vertexBuffer,a.skyboxGeometry.indexBuffer,a.skyboxGeometry.segment)}const Uc=o.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Mu{constructor(a){const f=new o.StructArrayLayout5f20;f.emplaceBack(-1,1,1,0,0),f.emplaceBack(1,1,1,1,0),f.emplaceBack(1,-1,1,1,1),f.emplaceBack(-1,-1,1,0,1);const v=new o.StructArrayLayout3ui6;v.emplaceBack(0,1,2),v.emplaceBack(2,3,0),this.vertexBuffer=a.createVertexBuffer(f,Uc.members),this.indexBuffer=a.createIndexBuffer(v),this.segments=o.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const xl={symbol:function(y,a,f,v,S){if(y.renderPass!=="translucent")return;const T=o.StencilMode.disabled,N=y.colorModeForRenderPass();f.layout.get("text-variable-anchor")&&(function(z,G,ee,te,ge,Ae,Le){const Xe=G.transform,Ue=ge==="map",Ze=Ae==="map";for(const _e of z){const $e=te.getTile(_e),it=$e.getBucket(ee);if(!it||!it.text||!it.text.segments.get().length)continue;const ot=o.evaluateSizeForZoom(it.textSizeData,Xe.zoom),bt=Ui(_e,it.getProjection(),Xe),wt=Xe.calculatePixelsToTileUnitsMatrix($e),vt=dn(bt,$e.tileID.canonical,Ze,Ue,Xe,it.getProjection(),wt),Rt=ee.layout.get("icon-text-fit")!=="none"&&it.hasIconData();if(ot){const Lt=Math.pow(2,Xe.zoom-$e.tileID.overscaledZ);Bl(it,Ue,Ze,Le,o.symbolSize,Xe,vt,_e,Lt,ot,Rt)}}})(v,y,f,a,f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),S),f.paint.get("icon-opacity").constantOr(1)!==0&&vl(y,a,f,v,!1,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),f.layout.get("icon-rotation-alignment"),f.layout.get("icon-pitch-alignment"),f.layout.get("icon-keep-upright"),T,N),f.paint.get("text-opacity").constantOr(1)!==0&&vl(y,a,f,v,!0,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),f.layout.get("text-keep-upright"),T,N),a.map.showCollisionBoxes&&(za(y,a,f,v,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),!0),za(y,a,f,v,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),!1))},circle:function(y,a,f,v){if(y.renderPass!=="translucent")return;const S=f.paint.get("circle-opacity"),T=f.paint.get("circle-stroke-width"),N=f.paint.get("circle-stroke-opacity"),z=f.layout.get("circle-sort-key").constantOr(1)!==void 0;if(S.constantOr(1)===0&&(T.constantOr(1)===0||N.constantOr(1)===0))return;const G=y.context,ee=G.gl,te=y.transform,ge=y.depthModeForSublayer(0,o.DepthMode.ReadOnly),Ae=o.StencilMode.disabled,Le=y.colorModeForRenderPass(),Xe=te.projection.name==="globe",Ue=[o.mercatorXfromLng(te.center.lng),o.mercatorYfromLat(te.center.lat)],Ze=[];for(let $e=0;$e<v.length;$e++){const it=v[$e],ot=a.getTile(it),bt=ot.getBucket(f);if(!bt||bt.projection.name!==te.projection.name)continue;const wt=bt.programConfigurations.get(f.id),vt=Bi(f);Xe&&vt.push("PROJECTION_GLOBE_VIEW");const Rt=y.useProgram("circle",wt,vt),Lt=bt.layoutVertexBuffer,zt=bt.globeExtVertexBuffer,mn=bt.indexBuffer,Ut=te.projection.createInversionMatrix(te,it.canonical),an={programConfiguration:wt,program:Rt,layoutVertexBuffer:Lt,globeExtVertexBuffer:zt,indexBuffer:mn,uniformValues:Lo(y,it,ot,Ut,Ue,f),tile:ot};if(z){const Ht=bt.segments.get();for(const Cn of Ht)Ze.push({segments:new o.SegmentVector([Cn]),sortKey:Cn.sortKey,state:an})}else Ze.push({segments:bt.segments,sortKey:0,state:an})}z&&Ze.sort((($e,it)=>$e.sortKey-it.sortKey));const _e={useDepthForOcclusion:!Xe};for(const $e of Ze){const{programConfiguration:it,program:ot,layoutVertexBuffer:bt,globeExtVertexBuffer:wt,indexBuffer:vt,uniformValues:Rt,tile:Lt}=$e.state,zt=$e.segments;y.terrain&&y.terrain.setupElevationDraw(Lt,ot,_e),y.prepareDrawProgram(G,ot,Lt.tileID.toUnwrapped()),ot.draw(G,ee.TRIANGLES,ge,Ae,Le,o.CullFaceMode.disabled,Rt,f.id,bt,vt,zt,f.paint,te.zoom,it,[wt])}},heatmap:function(y,a,f,v){if(f.paint.get("heatmap-opacity")!==0)if(y.renderPass==="offscreen"){const S=y.context,T=S.gl,N=o.StencilMode.disabled,z=new o.ColorMode([T.ONE,T.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(Le,Xe,Ue,Ze){const _e=Le.gl,$e=Xe.width*Ze,it=Xe.height*Ze;Le.activeTexture.set(_e.TEXTURE1),Le.viewport.set([0,0,$e,it]);let ot=Ue.heatmapFbo;if(!ot||ot&&(ot.width!==$e||ot.height!==it)){ot&&ot.destroy();const bt=_e.createTexture();_e.bindTexture(_e.TEXTURE_2D,bt),_e.texParameteri(_e.TEXTURE_2D,_e.TEXTURE_WRAP_S,_e.CLAMP_TO_EDGE),_e.texParameteri(_e.TEXTURE_2D,_e.TEXTURE_WRAP_T,_e.CLAMP_TO_EDGE),_e.texParameteri(_e.TEXTURE_2D,_e.TEXTURE_MIN_FILTER,_e.LINEAR),_e.texParameteri(_e.TEXTURE_2D,_e.TEXTURE_MAG_FILTER,_e.LINEAR),ot=Ue.heatmapFbo=Le.createFramebuffer($e,it,!1),(function(wt,vt,Rt,Lt,zt,mn){const Ut=wt.gl;Ut.texImage2D(Ut.TEXTURE_2D,0,wt.isWebGL2&&wt.extRenderToTextureHalfFloat?Ut.RGBA16F:Ut.RGBA,zt,mn,0,Ut.RGBA,wt.extRenderToTextureHalfFloat?wt.isWebGL2?Ut.HALF_FLOAT:wt.extTextureHalfFloat.HALF_FLOAT_OES:Ut.UNSIGNED_BYTE,null),Lt.colorAttachment.set(Rt)})(Le,0,bt,ot,$e,it)}else _e.bindTexture(_e.TEXTURE_2D,ot.colorAttachment.get()),Le.bindFramebuffer.set(ot.framebuffer)})(S,y,f,y.transform.projection.name==="globe"?.5:.25),S.clear({color:o.Color.transparent});const G=y.transform,ee=G.projection.name==="globe",te=ee?["PROJECTION_GLOBE_VIEW"]:null,ge=ee?o.CullFaceMode.frontCCW:o.CullFaceMode.disabled,Ae=[o.mercatorXfromLng(G.center.lng),o.mercatorYfromLat(G.center.lat)];for(let Le=0;Le<v.length;Le++){const Xe=v[Le];if(a.hasRenderableParent(Xe))continue;const Ue=a.getTile(Xe),Ze=Ue.getBucket(f);if(!Ze||Ze.projection.name!==G.projection.name)continue;const _e=Ze.programConfigurations.get(f.id),$e=y.useProgram("heatmap",_e,te),{zoom:it}=y.transform;y.terrain&&y.terrain.setupElevationDraw(Ue,$e),y.prepareDrawProgram(S,$e,Xe.toUnwrapped());const ot=G.projection.createInversionMatrix(G,Xe.canonical);$e.draw(S,T.TRIANGLES,o.DepthMode.disabled,N,z,ge,ul(y,Xe,Ue,ot,Ae,it,f.paint.get("heatmap-intensity")),f.id,Ze.layoutVertexBuffer,Ze.indexBuffer,Ze.segments,f.paint,y.transform.zoom,_e,ee?[Ze.globeExtVertexBuffer]:null)}S.viewport.set([0,0,y.width,y.height])}else y.renderPass==="translucent"&&(y.context.setColorMode(y.colorModeForRenderPass()),(function(S,T){const N=S.context,z=N.gl,G=T.heatmapFbo;if(!G)return;N.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,G.colorAttachment.get()),N.activeTexture.set(z.TEXTURE1);let ee=T.colorRampTexture;ee||(ee=T.colorRampTexture=new o.Texture(N,T.colorRamp,z.RGBA)),ee.bind(z.LINEAR,z.CLAMP_TO_EDGE),S.useProgram("heatmapTexture").draw(N,z.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,S.colorModeForRenderPass(),o.CullFaceMode.disabled,((te,ge,Ae,Le)=>({u_image:0,u_color_ramp:1,u_opacity:ge.paint.get("heatmap-opacity")}))(0,T),T.id,S.viewportBuffer,S.quadTriangleIndexBuffer,S.viewportSegments,T.paint,S.transform.zoom)})(y,f))},line:function(y,a,f,v){if(y.renderPass!=="translucent")return;const S=f.paint.get("line-opacity"),T=f.paint.get("line-width");if(S.constantOr(1)===0||T.constantOr(1)===0)return;const N=y.depthModeForSublayer(0,o.DepthMode.ReadOnly),z=y.colorModeForRenderPass(),G=y.terrain&&y.terrain.renderingToTexture?1:o.exported.devicePixelRatio,ee=f.paint.get("line-dasharray"),te=ee.constantOr(1),ge=f.layout.get("line-cap"),Ae=f.paint.get("line-pattern"),Le=Ae.constantOr(1),Xe=f.paint.get("line-gradient"),Ue=Le?"linePattern":"line",Ze=y.context,_e=Ze.gl,$e=(ot=>{const bt=[];Qo(ot)&&bt.push("RENDER_LINE_DASH"),ot.paint.get("line-gradient")&&bt.push("RENDER_LINE_GRADIENT");const wt=ot.paint.get("line-trim-offset");wt[0]===0&&wt[1]===0||bt.push("RENDER_LINE_TRIM_OFFSET");const vt=ot.paint.get("line-pattern").constantOr(1),Rt=ot.paint.get("line-opacity").constantOr(1)!==1;return!vt&&Rt&&bt.push("RENDER_LINE_ALPHA_DISCARD"),bt})(f);let it=$e.includes("RENDER_LINE_ALPHA_DISCARD");y.terrain&&y.terrain.clipOrMaskOverlapStencilType()&&(it=!1);for(const ot of v){const bt=a.getTile(ot);if(Le&&!bt.patternsLoaded())continue;const wt=bt.getBucket(f);if(!wt)continue;y.prepareDrawTile();const vt=wt.programConfigurations.get(f.id),Rt=y.useProgram(Ue,vt,$e),Lt=Ae.constantOr(null);if(Lt&&bt.imageAtlas){const on=bt.imageAtlas.patternPositions[Lt.toString()];on&&vt.setConstantPatternPositions(on)}const zt=ee.constantOr(null),mn=ge.constantOr(null);if(!Le&&zt&&mn&&bt.lineAtlas){const on=bt.lineAtlas.getDash(zt,mn);on&&vt.setConstantPatternPositions(on)}let[Ut,an]=f.paint.get("line-trim-offset");(mn==="round"||mn==="square")&&Ut!==an&&(Ut===0&&(Ut-=1),an===1&&(an+=1));const Ht=y.terrain?ot.projMatrix:null,Cn=Le?Ps(y,bt,f,Ht,G):bc(y,bt,f,Ht,wt.lineClipsArray.length,G,[Ut,an]);if(Xe){const on=wt.gradients[f.id];let In=on.texture;if(f.gradientVersion!==on.version){let xn=256;if(f.stepInterpolant){const bn=a.getSource().maxzoom,pr=ot.canonical.z===bn?Math.ceil(1<<y.transform.maxZoom-ot.canonical.z):1;xn=o.clamp(o.nextPowerOfTwo(wt.maxLineLength/o.EXTENT*1024*pr),256,Ze.maxTextureSize)}on.gradient=o.renderColorRamp({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:xn,image:on.gradient||void 0,clips:wt.lineClipsArray}),on.texture?on.texture.update(on.gradient):on.texture=new o.Texture(Ze,on.gradient,_e.RGBA),on.version=f.gradientVersion,In=on.texture}Ze.activeTexture.set(_e.TEXTURE1),In.bind(f.stepInterpolant?_e.NEAREST:_e.LINEAR,_e.CLAMP_TO_EDGE)}te&&(Ze.activeTexture.set(_e.TEXTURE0),bt.lineAtlasTexture.bind(_e.LINEAR,_e.REPEAT),vt.updatePaintBuffers()),Le&&(Ze.activeTexture.set(_e.TEXTURE0),bt.imageAtlasTexture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE),vt.updatePaintBuffers()),y.prepareDrawProgram(Ze,Rt,ot.toUnwrapped());const jt=on=>{Rt.draw(Ze,_e.TRIANGLES,N,on,z,o.CullFaceMode.disabled,Cn,f.id,wt.layoutVertexBuffer,wt.indexBuffer,wt.segments,f.paint,y.transform.zoom,vt,[wt.layoutVertexBuffer2])};if(it){const on=y.stencilModeForClipping(ot).ref;on===0&&y.terrain&&Ze.clear({stencil:0});const In={func:_e.EQUAL,mask:255};Cn.u_alpha_discard_threshold=.8,jt(new o.StencilMode(In,on,255,_e.KEEP,_e.KEEP,_e.INVERT)),Cn.u_alpha_discard_threshold=0,jt(new o.StencilMode(In,on,255,_e.KEEP,_e.KEEP,_e.KEEP))}else jt(y.stencilModeForClipping(ot))}it&&(y.resetStencilClippingMasks(),y.terrain&&Ze.clear({stencil:0}))},fill:function(y,a,f,v){const S=f.paint.get("fill-color"),T=f.paint.get("fill-opacity");if(T.constantOr(1)===0)return;const N=y.colorModeForRenderPass(),z=f.paint.get("fill-pattern"),G=y.opaquePassEnabledForLayer()&&!z.constantOr(1)&&S.constantOr(o.Color.transparent).a===1&&T.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===G){const ee=y.depthModeForSublayer(1,y.renderPass==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly);ks(y,a,f,v,ee,N,!1)}if(y.renderPass==="translucent"&&f.paint.get("fill-antialias")){const ee=y.depthModeForSublayer(f.getPaintProperty("fill-outline-color")?2:0,o.DepthMode.ReadOnly);ks(y,a,f,v,ee,N,!0)}},"fill-extrusion":function(y,a,f,v){const S=f.paint.get("fill-extrusion-opacity");if(S!==0&&y.renderPass==="translucent"){const T=new o.DepthMode(y.context.gl.LEQUAL,o.DepthMode.ReadWrite,y.depthRangeFor3D);if(S!==1||f.paint.get("fill-extrusion-pattern").constantOr(1))No(y,a,f,v,T,o.StencilMode.disabled,o.ColorMode.disabled),No(y,a,f,v,T,y.stencilModeFor3D(),y.colorModeForRenderPass()),y.resetStencilClippingMasks();else{const N=y.colorModeForRenderPass();No(y,a,f,v,T,o.StencilMode.disabled,N)}}},hillshade:function(y,a,f,v){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;const S=y.context,T=y.depthModeForSublayer(0,o.DepthMode.ReadOnly),N=y.colorModeForRenderPass(),z=y.terrain&&y.terrain.renderingToTexture,[G,ee]=y.renderPass!=="translucent"||z?[{},v]:y.stencilConfigForOverlap(v);for(const te of ee){const ge=a.getTile(te);if(ge.needsHillshadePrepare&&y.renderPass==="offscreen")Ii(y,ge,f,T,o.StencilMode.disabled,N);else if(y.renderPass==="translucent"){const Ae=z&&y.terrain?y.terrain.stencilModeForRTTOverlap(te):G[te.overscaledZ];Xr(y,te,ge,f,T,Ae,N)}}S.viewport.set([0,0,y.width,y.height]),y.resetStencilClippingMasks()},raster:function(y,a,f,v,S,T){if(y.renderPass!=="translucent"||f.paint.get("raster-opacity")===0||!v.length)return;const N=y.context,z=N.gl,G=a.getSource(),ee=y.useProgram("raster"),te=y.colorModeForRenderPass(),ge=y.terrain&&y.terrain.renderingToTexture,[Ae,Le]=G instanceof Lr||ge?[{},v]:y.stencilConfigForOverlap(v),Xe=Le[Le.length-1].overscaledZ,Ue=!y.options.moving;for(const Ze of Le){const _e=ge?o.DepthMode.disabled:y.depthModeForSublayer(Ze.overscaledZ-Xe,f.paint.get("raster-opacity")===1?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly,z.LESS),$e=Ze.toUnwrapped(),it=a.getTile(Ze);if(ge&&(!it||!it.hasData()))continue;const ot=ge?Ze.projMatrix:y.transform.calculateProjMatrix($e,Ue),bt=y.terrain&&ge?y.terrain.stencilModeForRTTOverlap(Ze):Ae[Ze.overscaledZ],wt=T?0:f.paint.get("raster-fade-duration");it.registerFadeDuration(wt);const vt=a.findLoadedParent(Ze,0),Rt=zc(it,vt,a,y.transform,wt);let Lt,zt;y.terrain&&y.terrain.prepareDrawTile();const mn=f.paint.get("raster-resampling")==="nearest"?z.NEAREST:z.LINEAR;N.activeTexture.set(z.TEXTURE0),it.texture.bind(mn,z.CLAMP_TO_EDGE),N.activeTexture.set(z.TEXTURE1),vt?(vt.texture.bind(mn,z.CLAMP_TO_EDGE),Lt=Math.pow(2,vt.tileID.overscaledZ-it.tileID.overscaledZ),zt=[it.tileID.canonical.x*Lt%1,it.tileID.canonical.y*Lt%1]):it.texture.bind(mn,z.CLAMP_TO_EDGE),it.texture.useMipmap&&N.extTextureFilterAnisotropic&&y.transform.pitch>20&&z.texParameterf(z.TEXTURE_2D,N.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,N.extTextureFilterAnisotropicMax);const Ut=Ws(ot,zt||[0,0],Lt||1,Rt,f,G instanceof Lr?G.perspectiveTransform:[0,0]);if(y.prepareDrawProgram(N,ee,$e),G instanceof Lr)G.boundsBuffer&&G.boundsSegments&&ee.draw(N,z.TRIANGLES,_e,o.StencilMode.disabled,te,o.CullFaceMode.disabled,Ut,f.id,G.boundsBuffer,y.quadTriangleIndexBuffer,G.boundsSegments);else{const{tileBoundsBuffer:an,tileBoundsIndexBuffer:Ht,tileBoundsSegments:Cn}=y.getTileBoundsBuffers(it);ee.draw(N,z.TRIANGLES,_e,bt,te,o.CullFaceMode.disabled,Ut,f.id,an,Ht,Cn)}}y.resetStencilClippingMasks()},background:function(y,a,f,v){const S=f.paint.get("background-color"),T=f.paint.get("background-opacity");if(T===0)return;const N=y.context,z=N.gl,G=y.transform,ee=G.tileSize,te=f.paint.get("background-pattern");if(y.isPatternMissing(te))return;const ge=!te&&S.a===1&&T===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==ge)return;const Ae=o.StencilMode.disabled,Le=y.depthModeForSublayer(0,ge==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly),Xe=y.colorModeForRenderPass(),Ue=y.useProgram(te?"backgroundPattern":"background");let Ze,_e=v;_e||(Ze=y.getBackgroundTiles(),_e=Object.values(Ze).map(($e=>$e.tileID))),te&&(N.activeTexture.set(z.TEXTURE0),y.imageManager.bind(y.context));for(const $e of _e){const it=$e.toUnwrapped(),ot=v?$e.projMatrix:y.transform.calculateProjMatrix(it);y.prepareDrawTile();const bt=a?a.getTile($e):Ze?Ze[$e.key]:new o.Tile($e,ee,G.zoom,y),wt=te?yu(ot,T,y,te,{tileID:$e,tileSize:ee}):Ks(ot,T,S);y.prepareDrawProgram(N,Ue,it);const{tileBoundsBuffer:vt,tileBoundsIndexBuffer:Rt,tileBoundsSegments:Lt}=y.getTileBoundsBuffers(bt);Ue.draw(N,z.TRIANGLES,Le,Ae,Xe,o.CullFaceMode.disabled,wt,f.id,vt,Rt,Lt)}},sky:function(y,a,f){const v=y.transform,S=v.projection.name==="mercator"||v.projection.name==="globe"?1:o.smoothstep(7,8,v.zoom),T=f.paint.get("sky-opacity")*S;if(T===0)return;const N=y.context,z=f.paint.get("sky-type"),G=new o.DepthMode(N.gl.LEQUAL,o.DepthMode.ReadOnly,[0,1]),ee=y.frameCounter/1e3%1;z==="atmosphere"?y.renderPass==="offscreen"?f.needsSkyboxCapture(y)&&((function(te,ge,Ae,Le){const Xe=te.context,Ue=Xe.gl;let Ze=ge.skyboxFbo;if(!Ze){Ze=ge.skyboxFbo=Xe.createFramebuffer(32,32,!1),ge.skyboxGeometry=new jc(Xe),ge.skyboxTexture=Xe.gl.createTexture(),Ue.bindTexture(Ue.TEXTURE_CUBE_MAP,ge.skyboxTexture),Ue.texParameteri(Ue.TEXTURE_CUBE_MAP,Ue.TEXTURE_WRAP_S,Ue.CLAMP_TO_EDGE),Ue.texParameteri(Ue.TEXTURE_CUBE_MAP,Ue.TEXTURE_WRAP_T,Ue.CLAMP_TO_EDGE),Ue.texParameteri(Ue.TEXTURE_CUBE_MAP,Ue.TEXTURE_MIN_FILTER,Ue.LINEAR),Ue.texParameteri(Ue.TEXTURE_CUBE_MAP,Ue.TEXTURE_MAG_FILTER,Ue.LINEAR);for(let ot=0;ot<6;++ot)Ue.texImage2D(Ue.TEXTURE_CUBE_MAP_POSITIVE_X+ot,0,Ue.RGBA,32,32,0,Ue.RGBA,Ue.UNSIGNED_BYTE,null)}Xe.bindFramebuffer.set(Ze.framebuffer),Xe.viewport.set([0,0,32,32]);const _e=ge.getCenter(te,!0),$e=te.useProgram("skyboxCapture"),it=new Float64Array(16);o.identity(it),o.rotateY(it,it,.5*-Math.PI),La(Xe,ge,$e,it,_e,0),o.identity(it),o.rotateY(it,it,.5*Math.PI),La(Xe,ge,$e,it,_e,1),o.identity(it),o.rotateX(it,it,.5*-Math.PI),La(Xe,ge,$e,it,_e,2),o.identity(it),o.rotateX(it,it,.5*Math.PI),La(Xe,ge,$e,it,_e,3),o.identity(it),La(Xe,ge,$e,it,_e,4),o.identity(it),o.rotateY(it,it,Math.PI),La(Xe,ge,$e,it,_e,5),Xe.viewport.set([0,0,te.width,te.height])})(y,f),f.markSkyboxValid(y)):y.renderPass==="sky"&&(function(te,ge,Ae,Le,Xe){const Ue=te.context,Ze=Ue.gl,_e=te.transform,$e=te.useProgram("skybox");Ue.activeTexture.set(Ze.TEXTURE0),Ze.bindTexture(Ze.TEXTURE_CUBE_MAP,ge.skyboxTexture);const it=((ot,bt,wt,vt,Rt)=>({u_matrix:ot,u_sun_direction:bt,u_cubemap:0,u_opacity:vt,u_temporal_offset:Rt}))(_e.skyboxMatrix,ge.getCenter(te,!1),0,Le,Xe);te.prepareDrawProgram(Ue,$e),$e.draw(Ue,Ze.TRIANGLES,Ae,o.StencilMode.disabled,te.colorModeForRenderPass(),o.CullFaceMode.backCW,it,"skybox",ge.skyboxGeometry.vertexBuffer,ge.skyboxGeometry.indexBuffer,ge.skyboxGeometry.segment)})(y,f,G,T,ee):z==="gradient"&&y.renderPass==="sky"&&(function(te,ge,Ae,Le,Xe){const Ue=te.context,Ze=Ue.gl,_e=te.transform,$e=te.useProgram("skyboxGradient");ge.skyboxGeometry||(ge.skyboxGeometry=new jc(Ue)),Ue.activeTexture.set(Ze.TEXTURE0);let it=ge.colorRampTexture;it||(it=ge.colorRampTexture=new o.Texture(Ue,ge.colorRamp,Ze.RGBA)),it.bind(Ze.LINEAR,Ze.CLAMP_TO_EDGE);const ot=((bt,wt,vt,Rt,Lt)=>({u_matrix:bt,u_color_ramp:0,u_center_direction:wt,u_radius:o.degToRad(vt),u_opacity:Rt,u_temporal_offset:Lt}))(_e.skyboxMatrix,ge.getCenter(te,!1),ge.paint.get("sky-gradient-radius"),Le,Xe);te.prepareDrawProgram(Ue,$e),$e.draw(Ue,Ze.TRIANGLES,Ae,o.StencilMode.disabled,te.colorModeForRenderPass(),o.CullFaceMode.backCW,ot,"skyboxGradient",ge.skyboxGeometry.vertexBuffer,ge.skyboxGeometry.indexBuffer,ge.skyboxGeometry.segment)})(y,f,G,T,ee)},debug:function(y,a,f){for(let v=0;v<f.length;v++)Ch(y,a,f[v])},custom:function(y,a,f,v){const S=y.context,T=f.implementation;if(!y.transform.projection.unsupportedLayers||!y.transform.projection.unsupportedLayers.includes("custom")||y.terrain&&(y.terrain.renderingToTexture||y.renderPass==="offscreen")&&f.isLayerDraped()){if(y.renderPass==="offscreen"){const N=T.prerender;if(N){if(y.setCustomLayerDefaults(),S.setColorMode(y.colorModeForRenderPass()),y.transform.projection.name==="globe"){const z=y.transform.pointMerc;N.call(T,S.gl,y.transform.customLayerMatrix(),y.transform.getProjection(),y.transform.globeToMercatorMatrix(),o.globeToMercatorTransition(y.transform.zoom),[z.x,z.y],y.transform.pixelsPerMeterRatio)}else N.call(T,S.gl,y.transform.customLayerMatrix());S.setDirty(),y.setBaseState()}}else if(y.renderPass==="translucent"){if(y.terrain&&y.terrain.renderingToTexture){const z=T.renderToTile;if(z){const G=v[0].canonical,ee=new o.MercatorCoordinate(G.x+v[0].wrap*(1<<G.z),G.y,G.z);S.setDepthMode(o.DepthMode.disabled),S.setStencilMode(o.StencilMode.disabled),S.setColorMode(y.colorModeForRenderPass()),y.setCustomLayerDefaults(),z.call(T,S.gl,ee),S.setDirty(),y.setBaseState()}return}y.setCustomLayerDefaults(),S.setColorMode(y.colorModeForRenderPass()),S.setStencilMode(o.StencilMode.disabled);const N=T.renderingMode==="3d"?new o.DepthMode(y.context.gl.LEQUAL,o.DepthMode.ReadWrite,y.depthRangeFor3D):y.depthModeForSublayer(0,o.DepthMode.ReadOnly);if(S.setDepthMode(N),y.transform.projection.name==="globe"){const z=y.transform.pointMerc;T.render(S.gl,y.transform.customLayerMatrix(),y.transform.getProjection(),y.transform.globeToMercatorMatrix(),o.globeToMercatorTransition(y.transform.zoom),[z.x,z.y],y.transform.pixelsPerMeterRatio)}else T.render(S.gl,y.transform.customLayerMatrix());S.setDirty(),y.setBaseState(),S.bindFramebuffer.set(null)}}else o.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class bl{constructor(a,f,v=!1){this.context=new vn(a,v),this.transform=f,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=o.SourceCache.maxUnderzooming+o.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(a,f){const v=!!a&&!!a.terrain&&this.transform.projection.supportsTerrain;if(!(v||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new ve(this,a));const S=this._terrain;this.transform.elevation=v?S:null,S.update(a,this.transform,f)}_updateFog(a){const f=a.fog;if(!f||this.transform.projection.name==="globe"||f.getOpacity(this.transform.pitch)<1||f.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[v,S]=f.getFovAdjustedRange(this.transform._fov);if(v>S)return void(this.transform.fogCullDistSq=null);const T=v+.78*(S-v);this.transform.fogCullDistSq=T*T}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(a,f){if(this.width=a*o.exported.devicePixelRatio,this.height=f*o.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const v of this.style.order)this.style._layers[v].resize()}setup(){const a=this.context,f=new o.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(o.EXTENT,0),f.emplaceBack(0,o.EXTENT),f.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=a.createVertexBuffer(f,o.posAttributes.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const v=new o.StructArrayLayout2i4;v.emplaceBack(0,0),v.emplaceBack(o.EXTENT,0),v.emplaceBack(0,o.EXTENT),v.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=a.createVertexBuffer(v,o.posAttributes.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const S=new o.StructArrayLayout2i4;S.emplaceBack(-1,-1),S.emplaceBack(1,-1),S.emplaceBack(-1,1),S.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(S,o.posAttributes.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const T=new o.StructArrayLayout4i8;T.emplaceBack(0,0,0,0),T.emplaceBack(o.EXTENT,0,o.EXTENT,0),T.emplaceBack(0,o.EXTENT,0,o.EXTENT),T.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.mercatorBoundsBuffer=a.createVertexBuffer(T,o.boundsAttributes.members),this.mercatorBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const N=new o.StructArrayLayout3ui6;N.emplaceBack(0,1,2),N.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(N);const z=new o.StructArrayLayout1ui2;for(const ee of[0,1,3,2,0])z.emplaceBack(ee);this.debugIndexBuffer=a.createIndexBuffer(z),this.emptyTexture=new o.Texture(a,new o.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),a.gl.RGBA),this.identityMat=o.create();const G=this.context.gl;this.stencilClearMode=new o.StencilMode({func:G.ALWAYS,mask:0},0,255,G.ZERO,G.ZERO,G.ZERO),this.loadTimeStamps.push(o.window.performance.now()),this.atmosphereBuffer=new Mu(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(a){return a._makeTileBoundsBuffers(this.context,this.transform.projection),a._tileBoundsBuffer?{tileBoundsBuffer:a._tileBoundsBuffer,tileBoundsIndexBuffer:a._tileBoundsIndexBuffer,tileBoundsSegments:a._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const a=this.context,f=a.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(a,f.TRIANGLES,o.DepthMode.disabled,this.stencilClearMode,o.ColorMode.disabled,o.CullFaceMode.disabled,Es(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(a,f,v){if(!f||this.currentStencilSource===f.id||!a.isTileClipped()||!v||v.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let z=!1;for(const G of v)if(this._tileClippingMaskIDs[G.key]===void 0){z=!0;break}if(!z)return}this.currentStencilSource=f.id;const S=this.context,T=S.gl;this.nextStencilID+v.length>256&&this.clearStencil(),S.setColorMode(o.ColorMode.disabled),S.setDepthMode(o.DepthMode.disabled);const N=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const z of v){const G=f.getTile(z),ee=this._tileClippingMaskIDs[z.key]=this.nextStencilID++,{tileBoundsBuffer:te,tileBoundsIndexBuffer:ge,tileBoundsSegments:Ae}=this.getTileBoundsBuffers(G);N.draw(S,T.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:T.ALWAYS,mask:0},ee,255,T.KEEP,T.KEEP,T.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,Es(z.projMatrix),"$clipping",te,ge,Ae)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,f=this.context.gl;return new o.StencilMode({func:f.NOTEQUAL,mask:255},a,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(a){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(a);const f=this.context.gl;return new o.StencilMode({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,f.KEEP,f.KEEP,f.REPLACE)}stencilConfigForOverlap(a){const f=this.context.gl,v=a.sort(((N,z)=>z.overscaledZ-N.overscaledZ)),S=v[v.length-1].overscaledZ,T=v[0].overscaledZ-S+1;if(T>1){this.currentStencilSource=void 0,this.nextStencilID+T>256&&this.clearStencil();const N={};for(let z=0;z<T;z++)N[z+S]=new o.StencilMode({func:f.GEQUAL,mask:255},z+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=T,[N,v]}return[{[S]:o.StencilMode.disabled},v]}colorModeForRenderPass(){const a=this.context.gl;return this._showOverdrawInspector?new o.ColorMode([a.CONSTANT_COLOR,a.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?o.ColorMode.unblended:o.ColorMode.alphaBlended}depthModeForSublayer(a,f,v){if(!this.opaquePassEnabledForLayer())return o.DepthMode.disabled;const S=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new o.DepthMode(v||this.context.gl.LEQUAL,f,[S,S])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(a,f){this.style=a,this.options=f,this.imageManager=a.imageManager,this.glyphManager=a.glyphManager,this.symbolFadeChange=a.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const v=this.style.order,S=this.style._sourceCaches;for(const ee in S){const te=S[ee];te.used&&te.prepare(this.context)}const T={},N={},z={};for(const ee in S){const te=S[ee];T[ee]=te.getVisibleCoordinates(),N[ee]=T[ee].slice().reverse(),z[ee]=te.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let ee=0;ee<v.length;ee++)if(this.style._layers[v[ee]].is3D()){this.opaquePassCutoff=ee;break}if(this.terrain&&(this.terrain.updateTileBinding(z),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.GlobeSharedBuffers(this.context)),!o.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const ee of v){const te=this.style._layers[ee],ge=a._getLayerSourceCache(te);if(!te.hasOffscreenPass()||te.isHidden(this.transform.zoom))continue;const Ae=ge?N[ge.id]:void 0;(te.type==="custom"||te.isSky()||Ae&&Ae.length)&&this.renderLayer(this,ge,te,Ae)}this.depthRangeFor3D=[0,1-(a.order.length+2)*this.numSublayers*this.depthEpsilon];const G=this.terrain;if(G&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&G.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:f.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){const ee=this.style._layers[v[this.currentLayer]],te=a._getLayerSourceCache(ee);if(ee.isSky())continue;const ge=te?N[te.id]:void 0;this._renderTileClippingMasks(ee,te,ge),this.renderLayer(this,te,ee,ge)}if(this.style.fog&&this.transform.projection.supportsFog&&(function(ee,te){const ge=ee.context,Ae=ge.gl,Le=ee.transform,Xe=new o.DepthMode(Ae.LEQUAL,o.DepthMode.ReadOnly,[0,1]),Ue=ee.useProgram("globeAtmosphere",null,Le.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Ze=o.globeToMercatorTransition(Le.zoom),_e=te.properties.get("color").toArray01(),$e=te.properties.get("high-color").toArray01(),it=te.properties.get("space-color").toArray01PremultipliedAlpha(),ot=o.identity$1([]);o.rotateY$1(ot,ot,-o.degToRad(Le._center.lng)),o.rotateX$1(ot,ot,o.degToRad(Le._center.lat)),o.rotateZ$1(ot,ot,Le.angle),o.rotateX$1(ot,ot,-Le._pitch);const bt=o.fromQuat(new Float32Array(16),ot),wt=o.mapValue(te.properties.get("star-intensity"),0,1,0,.25),vt=5e-4,Rt=o.mapValue(te.properties.get("horizon-blend"),0,1,vt,.25),Lt=o.globeUseCustomAntiAliasing(ee,ge,Le)&&Rt===vt?Le.worldSize/(2*Math.PI*1.025)-1:Le.globeRadius,zt=ee.frameCounter/1e3%1,mn=o.length(Le.globeCenterInViewSpace),Ut=Math.sqrt(Math.pow(mn,2)-Math.pow(Lt,2)),an=Math.acos(Ut/mn),Ht=((jt,on,In,xn,bn,pr,Fr,sr,fr,$r,gi,Sr,ki,Ci)=>({u_frustum_tl:jt,u_frustum_tr:on,u_frustum_br:In,u_frustum_bl:xn,u_horizon:bn,u_transition:pr,u_fadeout_range:Fr,u_color:sr,u_high_color:fr,u_space_color:$r,u_star_intensity:gi,u_star_size:5*o.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Sr,u_horizon_angle:ki,u_rotation_matrix:Ci}))(Le.frustumCorners.TL,Le.frustumCorners.TR,Le.frustumCorners.BR,Le.frustumCorners.BL,Le.frustumCorners.horizon,Ze,Rt,_e,$e,it,wt,zt,an,bt);ee.prepareDrawProgram(ge,Ue);const Cn=ee.atmosphereBuffer;Cn&&Ue.draw(ge,Ae.TRIANGLES,Xe,o.StencilMode.disabled,o.ColorMode.alphaBlended,o.CullFaceMode.backCW,Ht,"skybox",Cn.vertexBuffer,Cn.indexBuffer,Cn.segments)})(this,this.style.fog),this.renderPass="sky",(o.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){const ee=this.style._layers[v[this.currentLayer]],te=a._getLayerSourceCache(ee);ee.isSky()&&this.renderLayer(this,te,ee,te?N[te.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<v.length;){const ee=this.style._layers[v[this.currentLayer]],te=a._getLayerSourceCache(ee);if(ee.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(ee)){if(ee.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const ge=te?(ee.type==="symbol"?z:N)[te.id]:void 0;this._renderTileClippingMasks(ee,te,te?T[te.id]:void 0),this.renderLayer(this,te,ee,ge),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let ee=null;o.values(this.style._layers).forEach((te=>{const ge=a._getLayerSourceCache(te);ge&&!te.isHidden(this.transform.zoom)&&(!ee||ee.getSource().maxzoom<ge.getSource().maxzoom)&&(ee=ge)})),ee&&this.options.showTileBoundaries&&xl.debug(this,ee,ee.getVisibleCoordinates())}this.options.showPadding&&(function(ee){const te=ee.transform.padding;rc(ee,ee.transform.height-(te.top||0),3,Vo),rc(ee,te.bottom||0,3,vs),eh(ee,te.left||0,3,Ca),eh(ee,ee.transform.width-(te.right||0),3,Sc);const ge=ee.transform.centerPoint;(function(Ae,Le,Xe,Ue){Ec(Ae,Le-1,Xe-10,2,20,Ue),Ec(Ae,Le-10,Xe-1,20,2,Ue)})(ee,ge.x,ee.transform.height-ge.y,zh)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(o.window.performance.now()),this.saveCanvasCopy())}renderLayer(a,f,v,S){v.isHidden(this.transform.zoom)||(v.type==="background"||v.type==="sky"||v.type==="custom"||S&&S.length)&&(this.id=v.id,this.gpuTimingStart(v),(!a.transform.projection.unsupportedLayers||!a.transform.projection.unsupportedLayers.includes(v.type)||a.terrain&&v.type==="custom")&&xl[v.type](a,f,v,S,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(a){if(!this.options.gpuTiming)return;const f=this.context.extTimerQuery;let v=this.gpuTimers[a.id];v||(v=this.gpuTimers[a.id]={calls:0,cpuTime:0,query:f.createQueryEXT()}),v.calls++,f.beginQueryEXT(f.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const a=this.context.extTimerQuery,f=a.createQueryEXT();this.deferredRenderGpuTimeQueries.push(f),a.beginQueryEXT(a.TIME_ELAPSED_EXT,f)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}collectGpuTimers(){const a=this.gpuTimers;return this.gpuTimers={},a}collectDeferredRenderGpuQueries(){const a=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],a}queryGpuTimers(a){const f={};for(const v in a){const S=a[v],T=this.context.extTimerQuery,N=T.getQueryObjectEXT(S.query,T.QUERY_RESULT_EXT)/1e6;T.deleteQueryEXT(S.query),f[v]=N}return f}queryGpuTimeDeferredRender(a){if(!this.options.gpuTimingDeferredRender)return 0;const f=this.context.extTimerQuery;let v=0;for(const S of a)v+=f.getQueryObjectEXT(S,f.QUERY_RESULT_EXT)/1e6,f.deleteQueryEXT(S);return v}translatePosMatrix(a,f,v,S,T){if(!v[0]&&!v[1])return a;const N=T?S==="map"?this.transform.angle:0:S==="viewport"?-this.transform.angle:0;if(N){const ee=Math.sin(N),te=Math.cos(N);v=[v[0]*te-v[1]*ee,v[0]*ee+v[1]*te]}const z=[T?v[0]:le(f,v[0],this.transform.zoom),T?v[1]:le(f,v[1],this.transform.zoom),0],G=new Float32Array(16);return o.translate(G,a,z),G}saveTileTexture(a){const f=this._tileTextures[a.size[0]];f?f.push(a):this._tileTextures[a.size[0]]=[a]}getTileTexture(a){const f=this._tileTextures[a];return f&&f.length>0?f.pop():null}isPatternMissing(a){return a===null||a!==void 0&&!this.imageManager.getPattern(a.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const a=this.terrain&&this.terrain.renderingToTexture,f=this.terrain&&this.terrain.exaggeration()===0,v=this.style&&this.style.fog,S=[];return this.terrainRenderModeElevated()&&S.push("TERRAIN"),this.transform.projection.name==="globe"&&S.push("GLOBE"),f&&S.push("ZERO_EXAGGERATION"),v&&!a&&v.getOpacity(this.transform.pitch)!==0&&S.push("FOG"),a&&S.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&S.push("OVERDRAW_INSPECTOR"),S}useProgram(a,f,v){this.cache=this.cache||{};const S=v||[],T=this.currentGlobalDefines().concat(S),N=Ge.cacheKey(yt[a],a,T,f);return this.cache[N]||(this.cache[N]=new Ge(this.context,a,yt[a],f,wc[a],T)),this.cache[N]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(a,f,v){if(this.terrain&&this.terrain.renderingToTexture)return;const S=this.style.fog;if(S){const T=S.getOpacity(this.transform.pitch),N=((z,G,ee,te,ge,Ae,Le,Xe,Ue,Ze,_e)=>{const $e=z.transform,it=G.properties.get("color").toArray01();it[3]=te;const ot=z.frameCounter/1e3%1;return{u_fog_matrix:ee?$e.calculateFogTileMatrix(ee):z.identityMat,u_fog_range:G.getFovAdjustedRange($e._fov),u_fog_color:it,u_fog_horizon_blend:G.properties.get("horizon-blend"),u_fog_temporal_offset:ot,u_frustum_tl:ge,u_frustum_tr:Ae,u_frustum_br:Le,u_frustum_bl:Xe,u_globe_pos:Ue,u_globe_radius:Ze,u_viewport:_e,u_globe_transition:o.globeToMercatorTransition($e.zoom),u_is_globe:+($e.projection.name==="globe")}})(this,S,v,T,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.exported.devicePixelRatio,this.transform.height*o.exported.devicePixelRatio]);f.setFogUniformValues(a,N)}}setTileLoadedFlag(a){this.tileLoaded=a}saveCanvasCopy(){const a=this.canvasCopy();a&&(this.frameCopies.push(a),this.tileLoaded=!1)}canvasCopy(){const a=this.context.gl,f=a.createTexture();return a.bindTexture(a.TEXTURE_2D,f),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,a.drawingBufferWidth,a.drawingBufferHeight,0),f}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const a=this.style&&this.style.fog;return!!a&&a.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const a=this._backgroundTiles,f=this._backgroundTiles={},v=this.transform.coveringTiles({tileSize:512});for(const S of v)f[S.key]=a[S.key]||new o.Tile(S,512,this.transform.tileZoom,this);return f}clearBackgroundTiles(){this._backgroundTiles={}}}class Xs{constructor(a=0,f=0,v=0,S=0){if(isNaN(a)||a<0||isNaN(f)||f<0||isNaN(v)||v<0||isNaN(S)||S<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=f,this.left=v,this.right=S}interpolate(a,f,v){return f.top!=null&&a.top!=null&&(this.top=o.number(a.top,f.top,v)),f.bottom!=null&&a.bottom!=null&&(this.bottom=o.number(a.bottom,f.bottom,v)),f.left!=null&&a.left!=null&&(this.left=o.number(a.left,f.left,v)),f.right!=null&&a.right!=null&&(this.right=o.number(a.right,f.right,v)),this}getCenter(a,f){const v=o.clamp((this.left+a-this.right)/2,0,a),S=o.clamp((this.top+f-this.bottom)/2,0,f);return new o.Point(v,S)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new Xs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function th(y,a){const f=o.getColumn(y,3);o.fromQuat(y,a),o.setColumn(y,3,f)}function Jn(y,a){const f=o.identity$1([]);return o.rotateZ$1(f,f,-a),o.rotateX$1(f,f,-y),f}function Nu(y,a){const f=[y[0],y[1],0],v=[a[0],a[1],0];if(o.length(f)>=1e-15){const N=o.normalize([],f);o.scale$2(v,N,o.dot(v,N)),a[0]=v[0],a[1]=v[1]}const S=o.cross([],a,y);if(o.len(S)<1e-15)return null;const T=Math.atan2(-S[1],S[0]);return Jn(Math.atan2(Math.sqrt(y[0]*y[0]+y[1]*y[1]),-y[2]),T)}class Ac{constructor(a,f){this.position=a,this.orientation=f}get position(){return this._position}set position(a){if(a){const f=a instanceof o.MercatorCoordinate?a:new o.MercatorCoordinate(a[0],a[1],a[2]);this._renderWorldCopies&&(f.x=o.wrap(f.x,0,1)),this._position=f}else this._position=null}lookAtPoint(a,f){if(this.orientation=null,!this.position)return;const v=this.position,S=this._elevation?this._elevation.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(a)):0,T=o.MercatorCoordinate.fromLngLat(a,S),N=[T.x-v.x,T.y-v.y,T.z-v.z];f||(f=[0,0,1]),f[2]=Math.abs(f[2]),this.orientation=Nu(N,f)}setPitchBearing(a,f){this.orientation=Jn(o.degToRad(a),o.degToRad(-f))}}class hl{constructor(a,f){this._transform=o.identity([]),this.orientation=f,this.position=a}get mercatorPosition(){const a=this.position;return new o.MercatorCoordinate(a[0],a[1],a[2])}get position(){const a=o.getColumn(this._transform,3);return[a[0],a[1],a[2]]}set position(a){var f;a&&o.setColumn(this._transform,3,[(f=a)[0],f[1],f[2],1])}get orientation(){return this._orientation}set orientation(a){this._orientation=a||o.identity$1([]),a&&th(this._transform,this._orientation)}getPitchBearing(){const a=this.forward(),f=this.right();return{bearing:Math.atan2(-f[1],f[0]),pitch:Math.atan2(Math.sqrt(a[0]*a[0]+a[1]*a[1]),-a[2])}}setPitchBearing(a,f){this._orientation=Jn(a,f),th(this._transform,this._orientation)}forward(){const a=o.getColumn(this._transform,2);return[-a[0],-a[1],-a[2]]}up(){const a=o.getColumn(this._transform,1);return[-a[0],-a[1],-a[2]]}right(){const a=o.getColumn(this._transform,0);return[a[0],a[1],a[2]]}getCameraToWorld(a,f){const v=new Float64Array(16);return o.invert(v,this.getWorldToCamera(a,f)),v}getWorldToCameraPosition(a,f,v){const S=this.position;o.scale$2(S,S,-a);const T=new Float64Array(16);return o.fromScaling(T,[v,v,v]),o.translate(T,T,S),T[10]*=f,T}getWorldToCamera(a,f){const v=new Float64Array(16),S=new Float64Array(4),T=this.position;return o.conjugate(S,this._orientation),o.scale$2(T,T,-a),o.fromQuat(v,S),o.translate(v,v,T),v[1]*=-1,v[5]*=-1,v[9]*=-1,v[13]*=-1,v[8]*=f,v[9]*=f,v[10]*=f,v[11]*=f,v}getCameraToClipPerspective(a,f,v,S){const T=new Float64Array(16);return o.perspective(T,a,f,v,S),T}getDistanceToElevation(a,f=!1){const v=a===0?0:o.mercatorZfromAltitude(a,f?o.latFromMercatorY(this.position[1]):this.position[1]),S=this.forward();return(v-this.position[2])/S[2]}clone(){return new hl([...this.position],[...this.orientation])}}function as(y,a){const f=Vc(y.projection,y.zoom,y.width,y.height),v=(function(T,N,z,G,ee){const te=new o.LngLat(z.lng-180*ha,z.lat),ge=new o.LngLat(z.lng+180*ha,z.lat),Ae=T.project(te.lng,te.lat),Le=T.project(ge.lng,ge.lat),Xe=-Math.atan2(Le.y-Ae.y,Le.x-Ae.x),Ue=o.MercatorCoordinate.fromLngLat(z);Ue.y=o.clamp(Ue.y,-1+ha,1-ha);const Ze=Ue.toLngLat(),_e=T.project(Ze.lng,Ze.lat),$e=o.MercatorCoordinate.fromLngLat(Ze);$e.x+=ha;const it=$e.toLngLat(),ot=T.project(it.lng,it.lat),bt=qc(ot.x-_e.x,ot.y-_e.y,Xe),wt=o.MercatorCoordinate.fromLngLat(Ze);wt.y+=ha;const vt=wt.toLngLat(),Rt=T.project(vt.lng,vt.lat),Lt=qc(Rt.x-_e.x,Rt.y-_e.y,Xe),zt=Math.abs(bt.x)/Math.abs(Lt.y),mn=o.identity([]);o.rotateZ(mn,mn,-Xe*(1-(ee?0:G)));const Ut=o.identity([]);return o.scale(Ut,Ut,[1,1-(1-zt)*G,1]),Ut[4]=-Lt.x/Lt.y*G,o.rotateZ(Ut,Ut,Xe),o.multiply(Ut,mn,Ut),Ut})(y.projection,0,y.center,f,a),S=Tc(y);return o.scale(v,v,[S,S,1]),v}function Tc(y){const a=y.projection,f=Vc(y.projection,y.zoom,y.width,y.height),v=Du(a,y.center),S=Du(a,o.LngLat.convert(a.center));return Math.pow(2,v*f+(1-f)*S)}function Vc(y,a,f,v,S=1/0){const T=y.range;if(!T)return 0;const N=Math.min(S,Math.max(f,v)),z=Math.log(N/1024)/Math.LN2;return o.smoothstep(T[0]+z,T[1]+z,a)}const ha=1/4e4;function Du(y,a){const f=o.clamp(a.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),v=new o.LngLat(a.lng-180*ha,f),S=new o.LngLat(a.lng+180*ha,f),T=y.project(v.lng,f),N=y.project(S.lng,f),z=o.MercatorCoordinate.fromLngLat(v),G=o.MercatorCoordinate.fromLngLat(S),ee=N.x-T.x,te=N.y-T.y,ge=G.x-z.x,Ae=G.y-z.y,Le=Math.sqrt((ge*ge+Ae*Ae)/(ee*ee+te*te));return Math.log(Le)/Math.LN2}function qc(y,a,f){const v=Math.cos(f),S=Math.sin(f);return{x:y*v-a*S,y:y*S+a*v}}class oc{constructor(a,f,v,S,T,N,z){this.tileSize=512,this._renderWorldCopies=T===void 0||T,this._minZoom=a||0,this._maxZoom=f||22,this._minPitch=v??0,this._maxPitch=S??60,this.setProjection(N),this.setMaxBounds(z),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Xs,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new hl,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const a=new oc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return a._elevation=this._elevation,a._centerAltitude=this._centerAltitude,a._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,a.tileSize=this.tileSize,a.mercatorFromTransition=this.mercatorFromTransition,a.width=this.width,a.height=this.height,a.cameraElevationReference=this.cameraElevationReference,a._center=this._center,a._setZoom(this.zoom),a._seaLevelZoom=this._seaLevelZoom,a.angle=this.angle,a._fov=this._fov,a._pitch=this._pitch,a._nearZ=this._nearZ,a._farZ=this._farZ,a._averageElevation=this._averageElevation,a._unmodified=this._unmodified,a._edgeInsets=this._edgeInsets.clone(),a._camera=this._camera.clone(),a._calcMatrices(),a.freezeTileCoverage=this.freezeTileCoverage,a.frustumCorners=this.frustumCorners,a}get elevation(){return this._elevation}set elevation(a){this._elevation!==a&&(this._elevation=a,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(a,f=!1){const v=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||v)&&this._updateCameraOnTerrain(),(a||v)&&this._constrainCamera(f),this._calcMatrices()}getProjection(){return o.pick(this.projection,["name","center","parallels"])}setProjection(a){this.projectionOptions=a||{name:"mercator"};const f=this.projection?this.getProjection():void 0;this.projection=o.getProjection(this.projectionOptions);const v=!b(f,this.getProjection());return v&&this._calcMatrices(),this.mercatorFromTransition=!1,v}setMercatorFromTransition(){const a=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.getProjection({name:"mercator"});const f=a!==this.projection.name;return f&&this._calcMatrices(),f}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(a){a===void 0?a=!0:a===null&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get cameraWorldSize(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.Point(this.width,this.height)}get bearing(){return o.wrap(this.rotation,-180,180)}set bearing(a){this.rotation=a}get rotation(){return-this.angle/Math.PI*180}set rotation(a){const f=-a*Math.PI/180;var v;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=(v=new o.ARRAY_TYPE(4),o.ARRAY_TYPE!=Float32Array&&(v[1]=0,v[2]=0),v[0]=1,v[3]=1,v),(function(S,T,N){var z=T[0],G=T[1],ee=T[2],te=T[3],ge=Math.sin(N),Ae=Math.cos(N);S[0]=z*Ae+ee*ge,S[1]=G*Ae+te*ge,S[2]=z*-ge+ee*Ae,S[3]=G*-ge+te*Ae})(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(a){const f=o.clamp(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const a=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/a)}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=o.degToRad(a),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(a){this._averageElevation=a,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(a){const f=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._setZoom(f),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(a){this._zoom=a,this.scale=this.zoomScale(a),this.tileZoom=Math.floor(a),this.zoomFraction=a-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const a=this._elevation;this._centerAltitude=a.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=a.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const a=this._elevation,f=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],v=this.horizonLineFromTop();let S=0,T=0;for(let N=0;N<f.length;N++){const z=new o.Point(f[N][0]*this.width,v+f[N][1]*(this.height-v)),G=a.pointCoordinate(z);if(!G)continue;const ee=1/Math.hypot(G[0]-this._camera.position[0],G[1]-this._camera.position[1]);S+=G[3]*ee,T+=ee}return T===0?NaN:S/T}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const a=this._seaLevelZoom,f=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),v=this.pixelsPerMeter/this.worldSize*f,S=this._mercatorZfromZoom(a),T=this._mercatorZfromZoom(this._maxZoom),N=Math.max(S-v,T);this._setZoom(this._zoomFromMercatorZ(N))}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}computeZoomRelativeTo(a){const f=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,a.toAltitude()));let v;v=a.z<this._camera.position[2]?[f.x,f.y,f.z]:[a.x,a.y,a.z];const S=o.length(o.sub([],this._camera.position,v));return o.clamp(this._zoomFromMercatorZ(S),this._minZoom,this._maxZoom)}setFreeCameraOptions(a){if(!this.height||!a.position&&!a.orientation)return;this._updateCameraState();let f=!1;if(a.orientation&&!o.exactEquals(a.orientation,this._camera.orientation)&&(f=this._setCameraOrientation(a.orientation)),a.position){const v=[a.position.x,a.position.y,a.position.z];o.exactEquals$1(v,this._camera.position)||(this._setCameraPosition(v),f=!0)}f&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const a=this._camera.position,f=new Ac;return f.position=new o.MercatorCoordinate(a[0],a[1],a[2]),f.orientation=this._camera.orientation,f._elevation=this.elevation,f._renderWorldCopies=this.renderWorldCopies,f}_setCameraOrientation(a){if(!o.length$1(a))return!1;o.normalize$1(a,a);const f=o.transformQuat([],[0,0,-1],a),v=o.transformQuat([],[0,-1,0],a);if(v[2]<0)return!1;const S=Nu(f,v);return!!S&&(this._camera.orientation=S,!0)}_setCameraPosition(a){const f=this.zoomScale(this.minZoom)*this.tileSize,v=this.zoomScale(this.maxZoom)*this.tileSize,S=this.cameraToCenterDistance;a[2]=o.clamp(a[2],S/v,S/f),this._camera.position=a}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,f,v){this._unmodified=!1,this._edgeInsets.interpolate(a,f,v),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){const f=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,f)}getVisibleUnwrappedCoordinates(a){const f=[new o.UnwrappedTileID(0,a)];if(this.renderWorldCopies){const v=this.pointCoordinate(new o.Point(0,0)),S=this.pointCoordinate(new o.Point(this.width,0)),T=this.pointCoordinate(new o.Point(this.width,this.height)),N=this.pointCoordinate(new o.Point(0,this.height)),z=Math.floor(Math.min(v.x,S.x,T.x,N.x)),G=Math.floor(Math.max(v.x,S.x,T.x,N.x)),ee=1;for(let te=z-ee;te<=G+ee;te++)te!==0&&f.push(new o.UnwrappedTileID(te,a))}return f}coveringTiles(a){let f=this.coveringZoomLevel(a);const v=f,S=this.elevation&&!a.isTerrainDEM,T=this.projection.name==="mercator";if(a.minzoom!==void 0&&f<a.minzoom)return[];a.maxzoom!==void 0&&f>a.maxzoom&&(f=a.maxzoom);const N=this.locationCoordinate(this.center),z=this.center.lat,G=1<<f,ee=[G*N.x,G*N.y,0],te=this.projection.name==="globe",ge=!te,Ae=o.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f,ge),Le=te?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Xe=G*o.mercatorZfromAltitude(1,this.center.lat),Ue=this._camera.position[2]/o.mercatorZfromAltitude(1,this.center.lat),Ze=[G*Le.x,G*Le.y,Ue*(ge?1:Xe)],_e=this.cameraToCenterDistance/a.tileSize*(a.roundZoom?1:.502),$e=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?f:0,it=a.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ot=a.isTerrainDEM?-it:this._elevation?this._elevation.getMinElevationBelowMSL():0,bt=this.projection.isReprojectedInTileSpace?Tc(this):1,wt=jt=>{const In=new o.MercatorCoordinate(jt.x+25e-6,jt.y,jt.z),xn=new o.MercatorCoordinate(jt.x,jt.y+25e-6,jt.z),bn=jt.toLngLat(),pr=In.toLngLat(),Fr=xn.toLngLat(),sr=this.locationCoordinate(bn),fr=this.locationCoordinate(pr),$r=this.locationCoordinate(Fr),gi=Math.hypot(fr.x-sr.x,fr.y-sr.y),Sr=Math.hypot($r.x-sr.x,$r.y-sr.y);return Math.sqrt(gi*Sr)*bt/25e-6},vt=jt=>{const on=it,In=ot;return{aabb:o.tileAABB(this,G,0,0,0,jt,In,on,this.projection),zoom:0,x:0,y:0,minZ:In,maxZ:on,wrap:jt,fullyVisible:!1}},Rt=[];let Lt=[];const zt=f,mn=a.reparseOverscaled?v:f,Ut=jt=>jt*jt,an=Ut((Ue-this._centerAltitude)*Xe),Ht=jt=>{if(!this._elevation||!jt.tileID||!T)return;const on=this._elevation.getMinMaxForTile(jt.tileID),In=jt.aabb;on?(In.min[2]=on.min,In.max[2]=on.max,In.center[2]=(In.min[2]+In.max[2])/2):(jt.shouldSplit=Cn(jt),jt.shouldSplit||(In.min[2]=In.max[2]=In.center[2]=this._centerAltitude))},Cn=jt=>{if(jt.zoom<$e)return!0;if(jt.zoom===zt)return!1;if(jt.shouldSplit!=null)return jt.shouldSplit;const on=jt.aabb.distanceX(Ze),In=jt.aabb.distanceY(Ze);let xn=an,bn=1;if(te){xn=Ut(jt.aabb.distanceZ(Ze));const sr=Math.pow(2,jt.zoom),fr=o.latFromMercatorY((jt.y+1)/sr),$r=o.latFromMercatorY(jt.y/sr),gi=Math.min(Math.max(z,fr),$r),Sr=o.circumferenceAtLatitude(gi)/o.circumferenceAtLatitude(z);if(bn=gi===z?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Sr/this._mercatorScaleRatio),this.zoom<=o.GLOBE_ZOOM_THRESHOLD_MIN&&jt.zoom===zt-1&&Sr>=.9)return!0}else if(S&&(xn=Ut(jt.aabb.distanceZ(Ze)*Xe)),this.projection.isReprojectedInTileSpace&&v<=5){const sr=Math.pow(2,jt.zoom),fr=wt(new o.MercatorCoordinate((jt.x+.5)/sr,(jt.y+.5)/sr));bn=fr>.85?1:fr}const pr=on*on+In*In+xn,Fr=Ut((1<<zt-jt.zoom)*_e*bn*((sr,fr)=>{if(fr*Ut(.707)<sr)return 1;const $r=Math.sqrt(fr/sr);return $r/(1.4144271570014144+(Math.pow(1.1,$r-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(xn,an),pr));return pr<Fr};if(this.renderWorldCopies)for(let jt=1;jt<=3;jt++)Rt.push(vt(-jt)),Rt.push(vt(jt));for(Rt.push(vt(0));Rt.length>0;){const jt=Rt.pop(),on=jt.x,In=jt.y;let xn=jt.fullyVisible;if(!xn){const bn=jt.aabb.intersects(Ae);if(bn===0)continue;xn=bn===2}if(jt.zoom!==zt&&Cn(jt))for(let bn=0;bn<4;bn++){const pr=(on<<1)+bn%2,Fr=(In<<1)+(bn>>1),sr={aabb:T?jt.aabb.quadrant(bn):o.tileAABB(this,G,jt.zoom+1,pr,Fr,jt.wrap,jt.minZ,jt.maxZ,this.projection),zoom:jt.zoom+1,x:pr,y:Fr,wrap:jt.wrap,fullyVisible:xn,tileID:void 0,shouldSplit:void 0,minZ:jt.minZ,maxZ:jt.maxZ};S&&!te&&(sr.tileID=new o.OverscaledTileID(jt.zoom+1===zt?mn:jt.zoom+1,jt.wrap,jt.zoom+1,pr,Fr),Ht(sr)),Rt.push(sr)}else{const bn=jt.zoom===zt?mn:jt.zoom;if(a.minzoom&&a.minzoom>bn)continue;const pr=ee[0]-(.5+on+(jt.wrap<<jt.zoom))*(1<<f-jt.zoom),Fr=ee[1]-.5-In,sr=jt.tileID?jt.tileID:new o.OverscaledTileID(bn,jt.wrap,jt.zoom,on,In);Lt.push({tileID:sr,distanceSq:pr*pr+Fr*Fr})}}if(this.fogCullDistSq){const jt=this.fogCullDistSq,on=this.horizonLineFromTop();Lt=Lt.filter((In=>{const xn=[0,0,0,1],bn=[o.EXTENT,o.EXTENT,0,1],pr=this.calculateFogTileMatrix(In.tileID.toUnwrapped());o.transformMat4$1(xn,xn,pr),o.transformMat4$1(bn,bn,pr);const Fr=o.getAABBPointSquareDist(xn,bn);if(Fr===0)return!0;let sr=!1;const fr=this._elevation;if(fr&&Fr>jt&&on!==0){const $r=this.calculateProjMatrix(In.tileID.toUnwrapped());let gi;a.isTerrainDEM||(gi=fr.getMinMaxForTile(In.tileID)),gi||(gi={min:ot,max:it});const Sr=o.furthestTileCorner(this.rotation),ki=[Sr[0]*o.EXTENT,Sr[1]*o.EXTENT,gi.max];o.transformMat4(ki,ki,$r),sr=(1-ki[1])*this.height*.5<on}return Fr<jt||sr}))}return Lt.sort(((jt,on)=>jt.distanceSq-on.distanceSq)).map((jt=>jt.tileID))}resize(a,f){this.width=a,this.height=f,this.pixelsToGLUnits=[2/a,-2/f],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){const f=o.clamp(a.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),v=this.projection.project(a.lng,f);return new o.Point(v.x*this.worldSize,v.y*this.worldSize)}unproject(a){return this.projection.unproject(a.x/this.worldSize,a.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(a,f){let v,S;const T=this.centerPoint;if(this.projection.name==="globe"){const z=this.worldSize;v=(f.x-T.x)/z,S=(f.y-T.y)/z}else{const z=this.pointCoordinate(f),G=this.pointCoordinate(T);v=z.x-G.x,S=z.y-G.y}const N=this.locationCoordinate(a);this.setLocation(new o.MercatorCoordinate(N.x-v,N.y-S))}setLocation(a){this.center=this.coordinateLocation(a),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(a){return this.projection.locationPoint(this,a)}locationPoint3D(a){return this.projection.locationPoint(this,a,!0)}pointLocation(a){return this.coordinateLocation(this.pointCoordinate(a))}pointLocation3D(a){return this.coordinateLocation(this.pointCoordinate3D(a))}locationCoordinate(a,f){const v=f?o.mercatorZfromAltitude(f,a.lat):void 0,S=this.projection.project(a.lng,a.lat);return new o.MercatorCoordinate(S.x,S.y,v)}coordinateLocation(a){return this.projection.unproject(a.x,a.y)}pointRayIntersection(a,f){const v=f??this._centerAltitude,S=[a.x,a.y,0,1],T=[a.x,a.y,1,1];o.transformMat4$1(S,S,this.pixelMatrixInverse),o.transformMat4$1(T,T,this.pixelMatrixInverse);const N=T[3];o.scale$1(S,S,1/S[3]),o.scale$1(T,T,1/N);const z=S[2],G=T[2];return{p0:S,p1:T,t:z===G?0:(v-z)/(G-z)}}screenPointToMercatorRay(a){const f=[a.x,a.y,0,1],v=[a.x,a.y,1,1];return o.transformMat4$1(f,f,this.pixelMatrixInverse),o.transformMat4$1(v,v,this.pixelMatrixInverse),o.scale$1(f,f,1/f[3]),o.scale$1(v,v,1/v[3]),f[2]=o.mercatorZfromAltitude(f[2],this._center.lat)*this.worldSize,v[2]=o.mercatorZfromAltitude(v[2],this._center.lat)*this.worldSize,o.scale$1(f,f,1/this.worldSize),o.scale$1(v,v,1/this.worldSize),new o.Ray([f[0],f[1],f[2]],o.normalize([],o.sub([],v,f)))}rayIntersectionCoordinate(a){const{p0:f,p1:v,t:S}=a,T=o.mercatorZfromAltitude(f[2],this._center.lat),N=o.mercatorZfromAltitude(v[2],this._center.lat);return new o.MercatorCoordinate(o.number(f[0],v[0],S)/this.worldSize,o.number(f[1],v[1],S)/this.worldSize,o.number(T,N,S))}pointCoordinate(a,f=this._centerAltitude){return this.projection.pointCoordinate(this,a.x,a.y,f)}pointCoordinate3D(a){if(!this.elevation)return this.pointCoordinate(a);let f=this.projection.pointCoordinate3D(this,a.x,a.y);if(f)return new o.MercatorCoordinate(f[0],f[1],f[2]);let v=0,S=this.horizonLineFromTop();if(a.y>S)return this.pointCoordinate(a);const T=.02*S,N=a.clone();for(let z=0;z<10&&S-v>T;z++){N.y=o.number(v,S,.66);const G=this.projection.pointCoordinate3D(this,N.x,N.y);G?(S=N.y,f=G):v=N.y}return f?new o.MercatorCoordinate(f[0],f[1],f[2]):this.pointCoordinate(a)}isPointAboveHorizon(a){return this.projection.isPointAboveHorizon(this,a)}isPointOnSurface(a){if(a.y<0||a.y>this.height||a.x<0||a.x>this.width)return!1;if(this.elevation||this.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(a);const f=this.pointCoordinate(a);return f.y>=0&&f.y<=1}_coordinatePoint(a,f){const v=f&&this.elevation?this.elevation.getAtPointOrZero(a,this._centerAltitude):this._centerAltitude,S=[a.x*this.worldSize,a.y*this.worldSize,v+a.toAltitude(),1];return o.transformMat4$1(S,S,this.pixelMatrix),S[3]>0?new o.Point(S[0]/S[3],S[1]/S[3]):new o.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:a,left:f}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,T=this.pointLocation3D(new o.Point(f,a)),N=this.pointLocation3D(new o.Point(S,a)),z=this.pointLocation3D(new o.Point(S,v)),G=this.pointLocation3D(new o.Point(f,v));let ee=Math.min(T.lng,N.lng,z.lng,G.lng),te=Math.max(T.lng,N.lng,z.lng,G.lng),ge=Math.min(T.lat,N.lat,z.lat,G.lat),Ae=Math.max(T.lat,N.lat,z.lat,G.lat);const Le=Math.pow(2,-this.zoom)/16*270,Xe=this.projection.name==="globe"?1:4,Ue=(Ze,_e,$e,it,ot)=>{const bt=(Ze+$e)/2,wt=(_e+it)/2,vt=new o.Point(bt,wt),{lng:Rt,lat:Lt}=this.pointLocation3D(vt),zt=Math.max(0,ee-Rt,ge-Lt,Rt-te,Lt-Ae);ee=Math.min(ee,Rt),te=Math.max(te,Rt),ge=Math.min(ge,Lt),Ae=Math.max(Ae,Lt),(ot<Xe||zt>Le)&&(Ue(Ze,_e,bt,wt,ot+1),Ue(bt,wt,$e,it,ot+1))};if(Ue(f,a,S,a,1),Ue(S,a,S,v,1),Ue(S,v,f,v,1),Ue(f,v,f,a,1),this.projection.name==="globe"){const[Ze,_e]=o.polesInViewport(this);Ze?(Ae=90,te=180,ee=-180):_e&&(ge=-90,te=180,ee=-180)}return new o.LngLatBounds(new o.LngLat(ee,ge),new o.LngLat(te,Ae))}_getBoundsRectangular(a,f){const{top:v,left:S}=this._edgeInsets,T=this.height-this._edgeInsets.bottom,N=this.width-this._edgeInsets.right,z=new o.Point(S,v),G=new o.Point(N,v),ee=new o.Point(N,T),te=new o.Point(S,T);let ge=this.pointCoordinate(z,a),Ae=this.pointCoordinate(G,a);const Le=this.pointCoordinate(ee,f),Xe=this.pointCoordinate(te,f),Ue=(Ze,_e)=>(_e.y-Ze.y)/(_e.x-Ze.x);return ge.y>1&&Ae.y>=0?ge=new o.MercatorCoordinate((1-Xe.y)/Ue(Xe,ge)+Xe.x,1):ge.y<0&&Ae.y<=1&&(ge=new o.MercatorCoordinate(-Xe.y/Ue(Xe,ge)+Xe.x,0)),Ae.y>1&&ge.y>=0?Ae=new o.MercatorCoordinate((1-Le.y)/Ue(Le,Ae)+Le.x,1):Ae.y<0&&ge.y<=1&&(Ae=new o.MercatorCoordinate(-Le.y/Ue(Le,Ae)+Le.x,0)),new o.LngLatBounds().extend(this.coordinateLocation(ge)).extend(this.coordinateLocation(Ae)).extend(this.coordinateLocation(Xe)).extend(this.coordinateLocation(Le))}_getBoundsRectangularTerrain(){const a=this.elevation;if(!a.visibleDemTiles.length||a.isUsingMockSource())return this._getBoundsRectangular(0,0);const f=a.visibleDemTiles.reduce(((v,S)=>{if(S.dem){const T=S.dem.tree;v.min=Math.min(v.min,T.minimums[0]),v.max=Math.max(v.max,T.maximums[0])}return v}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(f.min*a.exaggeration(),f.max*a.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(a=!0){const f=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,v=this.height/2-f*(1-this._horizonShift);return a?Math.max(0,v):v}getMaxBounds(){return this.maxBounds}setMaxBounds(a){this.maxBounds=a,this.minLat=-o.MAX_MERCATOR_LATITUDE,this.maxLat=o.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,a&&(this.minLat=a.getSouth(),this.maxLat=a.getNorth(),this.minLng=a.getWest(),this.maxLng=a.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=o.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=o.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=o.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(a,f){return this.projection.createTileMatrix(this,f,a)}calculateDistanceTileData(a){const f=a.key,v=this._distanceTileDataCache;if(v[f])return v[f];const S=a.canonical,T=1/this.height,N=this.cameraWorldSize,z=N/this.zoomScale(S.z),G=(S.x+Math.pow(2,S.z)*a.wrap)*z,ee=S.y*z,te=this.point;te.x*=N/this.worldSize,te.y*=N/this.worldSize;const ge=this.angle,Ae=Math.sin(-ge),Le=-Math.cos(-ge);return v[f]={bearing:[Ae,Le],center:[(te.x-G)*T,(te.y-ee)*T],scale:z/o.EXTENT*T},v[f]}calculateFogTileMatrix(a){const f=a.key,v=this._fogTileMatrixCache;if(v[f])return v[f];const S=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,a);return o.multiply(S,this.worldToFogMatrix,S),v[f]=new Float32Array(S),v[f]}calculateProjMatrix(a,f=!1){const v=a.key,S=f?this._alignedProjMatrixCache:this._projMatrixCache;if(S[v])return S[v];const T=this.calculatePosMatrix(a,this.worldSize);return o.multiply(T,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:f?this.alignedProjMatrix:this.projMatrix,T),S[v]=new Float32Array(T),S[v]}calculatePixelsToTileUnitsMatrix(a){const f=a.tileID.key,v=this._pixelsToTileUnitsCache;if(v[f])return v[f];const S=(function(T,N){const{scale:z}=T.tileTransform,G=z*o.EXTENT/(T.tileSize*Math.pow(2,N.zoom-T.tileID.overscaledZ+T.tileID.canonical.z));return ee=new Float32Array(4),Ae=(te=N.inverseAdjustmentMatrix)[1],Le=te[2],Xe=te[3],Ze=(ge=[G,G])[1],ee[0]=te[0]*(Ue=ge[0]),ee[1]=Ae*Ue,ee[2]=Le*Ze,ee[3]=Xe*Ze,ee;var ee,te,ge,Ae,Le,Xe,Ue,Ze})(a,this);return v[f]=S,v[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const a=1/this.worldSize,f=o.fromScaling([],[a,a,a]);return o.multiply(f,f,this.globeMatrix),f}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const a=this._elevation;this._updateCameraState();const f=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(f),S=this._camera.forward(),T=o.mercatorZfromAltitude(1,this._center.lat);v[2]/=T,S[2]/=T,o.normalize(S,S);const N=a.raycast(v,S,a.exaggeration());if(N){const z=o.scaleAndAdd([],v,S,N),G=new o.MercatorCoordinate(z[0],z[1],o.mercatorZfromAltitude(z[2],o.latFromMercatorY(z[1]))),ee=(G.z+o.length([G.x-v[0],G.y-v[1],G.z-v[2]*T]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(ee),this._centerAltitude=G.toAltitude(),this._center=this.coordinateLocation(G),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(a=!1){if(!this._elevation)return;const f=this._elevation,v=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,S=this._computeCameraPosition(v),T=f.getAtPointOrZero(new o.MercatorCoordinate(...S)),N=this.pixelsPerMeter/this.worldSize*T,z=this._minimumHeightOverTerrain(),G=S[2]-N;if(G<=z)if(G<0||a){const ee=this.locationCoordinate(this._center,this._centerAltitude),te=[S[0],S[1],ee.z-S[2]],ge=o.length(te);te[2]-=(z-G)/this._pixelsPerMercatorPixel;const Ae=o.length(te);if(Ae===0)return;o.scale$2(te,te,ge/Ae*this._pixelsPerMercatorPixel),this._camera.position=[S[0],S[1],ee.z*this._pixelsPerMercatorPixel-te[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const a=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||a){const Ae=this.center;return Ae.lat=o.clamp(Ae.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!a)&&(Ae.lng=o.clamp(Ae.lng,this.minLng,this.maxLng)),this.center=Ae,void(this._constraining=!1)}const f=this._unmodified,{x:v,y:S}=this.point;let T=0,N=v,z=S;const G=this.width/2,ee=this.height/2,te=this.worldMinY*this.scale,ge=this.worldMaxY*this.scale;if(S-ee<te&&(z=te+ee),S+ee>ge&&(z=ge-ee),ge-te<this.height&&(T=Math.max(T,this.height/(ge-te)),z=(ge+te)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Ae=this.worldMinX*this.scale,Le=this.worldMaxX*this.scale,Xe=this.worldSize/2-(Ae+Le)/2;N=(v+Xe+this.worldSize)%this.worldSize-Xe,N-G<Ae&&(N=Ae+G),N+G>Le&&(N=Le-G),Le-Ae<this.width&&(T=Math.max(T,this.width/(Le-Ae)),N=(Le+Ae)/2)}N===v&&z===S||(this.center=this.unproject(new o.Point(N,z))),T&&(this.zoom+=this.scaleZoom(T)),this._constrainCamera(),this._unmodified=f,this._constraining=!1}_minZoomForBounds(){let a=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(a=Math.max(a,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),a}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const a=this.centerOffset,f=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.mercatorZfromAltitude(1,this.center.lat)/o.mercatorZfromAltitude(1,o.GLOBE_SCALE_MATCH_LATITUDE));const v=Vc(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const S=this.projection.zAxisUnit==="meters"?f:1,T=this._camera.getWorldToCamera(this.worldSize,S),N=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);N[8]=2*-a.x/this.width,N[9]=2*a.y/this.height;let z=o.mul([],N,T);if(this.projection.isReprojectedInTileSpace){const wt=this.locationCoordinate(this.center),vt=o.identity([]);o.translate(vt,vt,[wt.x*this.worldSize,wt.y*this.worldSize,0]),o.multiply(vt,vt,as(this)),o.translate(vt,vt,[-wt.x*this.worldSize,-wt.y*this.worldSize,0]),o.multiply(z,z,vt),this.inverseAdjustmentMatrix=(function(Rt){const Lt=as(Rt,!0);return q([],[Lt[0],Lt[1],Lt[4],Lt[5]])})(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=o.scale([],z,[this.worldSize,this.worldSize,this.worldSize/S,1]),this.projMatrix=z,this.invProjMatrix=o.invert(new Float64Array(16),this.projMatrix);const G=o.invert([],N);this.frustumCorners=o.FrustumCorners.fromInvProjectionMatrix(G,this.horizonLineFromTop(),this.height);const ee=new Float32Array(16);o.identity(ee),o.scale(ee,ee,[1,-1,1]),o.rotateX(ee,ee,this._pitch),o.rotateZ(ee,ee,this.angle);const te=o.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),ge=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;te[8]=2*-a.x/this.width,te[9]=2*(a.y+ge)/this.height,this.skyboxMatrix=o.multiply(ee,te,ee);const Ae=this.point,Le=Ae.x,Xe=Ae.y,Ue=this.width%2/2,Ze=this.height%2/2,_e=Math.cos(this.angle),$e=Math.sin(this.angle),it=Le-Math.round(Le)+_e*Ue+$e*Ze,ot=Xe-Math.round(Xe)+_e*Ze+$e*Ue,bt=new Float64Array(z);if(o.translate(bt,bt,[it>.5?it-1:it,ot>.5?ot-1:ot,0]),this.alignedProjMatrix=bt,z=o.create(),o.scale(z,z,[this.width/2,-this.height/2,1]),o.translate(z,z,[1,-1,0]),this.labelPlaneMatrix=z,z=o.create(),o.scale(z,z,[1,-1,1]),o.translate(z,z,[-1,-1,0]),o.scale(z,z,[2/this.width,2/this.height,1]),this.glCoordMatrix=z,this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},z=o.invert(new Float64Array(16),this.pixelMatrix),!z)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=z,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.calculateGlobeMatrix(this);const wt=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.transformMat4(wt,wt,T),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=z;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const a=this.cameraWorldSizeForFog,f=this.cameraPixelsPerMeter,v=this._camera.position,S=1/this.height/this._pixelsPerMercatorPixel,T=[a,a,f];o.scale$2(T,T,S),o.scale$2(v,v,-1),o.multiply$2(v,v,T);const N=o.create();o.translate(N,N,v),o.scale(N,N,T),this.mercatorFogMatrix=N,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(a,f,S)}_computeCameraPosition(a){const f=(a=a||this.pixelsPerMeter)/this.pixelsPerMeter,v=this._camera.forward(),S=this.point,T=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*f-a/this.worldSize*this._centerAltitude;return[S.x/this.worldSize-v[0]*T,S.y/this.worldSize-v[1]*T,a/this.worldSize*this._centerAltitude-v[2]*T]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(a){const f=this._maxCameraBoundsDistance()*Math.cos(this._pitch),v=this._camera.position[2],S=a[2];let T=1;this.projection.wrap&&(this.center=this.center.wrap()),S>0&&(T=Math.min((f-v)/S,1)),this._camera.position=o.scaleAndAdd([],this._camera.position,a,T),this._updateStateFromCamera()}_updateStateFromCamera(){const a=this._camera.position,f=this._camera.forward(),{pitch:v,bearing:S}=this._camera.getPitchBearing(),T=o.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,N=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.degToRad(this._maxPitch)),z=Math.max((a[2]-T)/Math.cos(v),N),G=this._zoomFromMercatorZ(z);o.scaleAndAdd(a,a,f,z),this._pitch=o.clamp(v,o.degToRad(this.minPitch),o.degToRad(this.maxPitch)),this.angle=o.wrap(S,-Math.PI,Math.PI),this._setZoom(o.clamp(G,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.MercatorCoordinate(a[0],a[1],a[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(a){return Math.pow(2,a)*this.tileSize}_mercatorZfromZoom(a){return this.cameraToCenterDistance/this._worldSizeFromZoom(a)}_minimumHeightOverTerrain(){const a=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(a)}_zoomFromMercatorZ(a){return this.scaleZoom(this.cameraToCenterDistance/(a*this.tileSize))}zoomFromMercatorZAdjusted(a){let f=0,v=o.GLOBE_ZOOM_THRESHOLD_MAX,S=0,T=1/0;for(;v-f>1e-6&&v>f;){const N=f+.5*(v-f),z=this.tileSize*Math.pow(2,N),G=this.getCameraToCenterDistance(this.projection,N,z),ee=this.scaleZoom(G/(a*this.tileSize)),te=Math.abs(N-ee);te<T&&(T=te,S=N),N<ee?f=N:v=N}return S}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(a,f){const v=Math.min(a.x,f.x),S=Math.max(a.x,f.x),T=Math.min(a.y,f.y),N=Math.max(a.y,f.y);if(T<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const z=[new o.Point(v,T),new o.Point(S,N),new o.Point(v,N),new o.Point(S,T)],G=this.renderWorldCopies?-3:0,ee=this.renderWorldCopies?4:1;for(const te of z){const ge=this.pointRayIntersection(te);if(ge.t<0)return!0;const Ae=this.rayIntersectionCoordinate(ge);if(Ae.x<G||Ae.y<0||Ae.x>ee||Ae.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.Point(0,0),new o.Point(this.width,this.height))}zoomDeltaToMovement(a,f){const v=o.length(o.sub([],this._camera.position,a)),S=this._zoomFromMercatorZ(v)+f;return v-this._mercatorZfromZoom(S)}getCameraPoint(){if(this.projection.name==="globe"){const a=(function([f,v,S],T){const N=[f,v,S,1];o.transformMat4$1(N,N,T);const z=N[3]=Math.max(N[3],1e-6);return N[0]/=z,N[1]/=z,N[2]/=z,N})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.Point(a[0],a[1])}{const a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.Point(0,a))}}getCameraToCenterDistance(a,f=this.zoom,v=this.worldSize){const S=Vc(a,f,this.width,this.height,1024),T=a.pixelSpaceConversion(this.center.lat,v,S);return .5/Math.tan(.5*this._fov)*this.height*T}getWorldToCameraMatrix(){const a=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.multiply(a,a,this.globeMatrix),a}}function qn(y,a){let f=!1,v=null;const S=()=>{v=null,f&&(y(),v=setTimeout(S,a),f=!1)};return()=>(f=!0,v||S(),v)}class jl{constructor(a){this._hashName=a&&encodeURIComponent(a),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=qn(this._updateHashUnthrottled.bind(this),300)}addTo(a){return this._map=a,o.window.addEventListener("hashchange",this._onHashChange,!1),a.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),o.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const a=this._map;if(!a)return"";const f=va(a);if(this._hashName){const v=this._hashName;let S=!1;const T=o.window.location.hash.slice(1).split("&").map((N=>{const z=N.split("=")[0];return z===v?(S=!0,`${z}=${f}`):N})).filter((N=>N));return S||T.push(`${v}=${f}`),`#${T.join("&")}`}return`#${f}`}_getCurrentHash(){const a=o.window.location.hash.replace("#","");if(this._hashName){let f;return a.split("&").map((v=>v.split("="))).forEach((v=>{v[0]===this._hashName&&(f=v)})),(f&&f[1]||"").split("/")}return a.split("/")}_onHashChange(){const a=this._map;if(!a)return!1;const f=this._getCurrentHash();if(f.length>=3&&!f.some((v=>isNaN(v)))){const v=a.dragRotate.isEnabled()&&a.touchZoomRotate.isEnabled()?+(f[3]||0):a.getBearing();return a.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:v,pitch:+(f[4]||0)}),!0}return!1}_updateHashUnthrottled(){const a=o.window.location.href.replace(/(#.+)?$/,this.getHashString());o.window.history.replaceState(o.window.history.state,null,a)}}function va(y,a){const f=y.getCenter(),v=Math.round(100*y.getZoom())/100,S=Math.ceil((v*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,S),N=Math.round(f.lng*T)/T,z=Math.round(f.lat*T)/T,G=y.getBearing(),ee=y.getPitch();let te=a?`/${N}/${z}/${v}`:`${v}/${z}/${N}`;return(G||ee)&&(te+="/"+Math.round(10*G)/10),ee&&(te+=`/${Math.round(ee)}`),te}const $c={linearity:.3,easing:o.bezier(0,0,.3,1)},ou=o.extend({deceleration:2500,maxSpeed:1400},$c),su=o.extend({deceleration:20,maxSpeed:1400},$c),lr=o.extend({deceleration:1e3,maxSpeed:360},$c),li=o.extend({deceleration:1e3,maxSpeed:90},$c);class ja{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,f=o.exported.now();for(;a.length>0&&f-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const f={zoom:0,bearing:0,pitch:0,pan:new o.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:T}of this._inertiaBuffer)f.zoom+=T.zoomDelta||0,f.bearing+=T.bearingDelta||0,f.pitch+=T.pitchDelta||0,T.panDelta&&f.pan._add(T.panDelta),T.around&&(f.around=T.around),T.pinchAround&&(f.pinchAround=T.pinchAround);const v=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,S={};if(f.pan.mag()){const T=Ul(f.pan.mag(),v,o.extend({},ou,a||{}));S.offset=f.pan.mult(T.amount/f.pan.mag()),S.center=this._map.transform.center,es(S,T)}if(f.zoom){const T=Ul(f.zoom,v,su);S.zoom=this._map.transform.zoom+T.amount,es(S,T)}if(f.bearing){const T=Ul(f.bearing,v,lr);S.bearing=this._map.transform.bearing+o.clamp(T.amount,-179,179),es(S,T)}if(f.pitch){const T=Ul(f.pitch,v,li);S.pitch=this._map.transform.pitch+T.amount,es(S,T)}if(S.zoom||S.bearing){const T=f.pinchAround===void 0?f.around:f.pinchAround;S.around=T?this._map.unproject(T):this._map.getCenter()}return this.clear(),S.noMoveStart=!0,S}}function es(y,a){(!y.duration||y.duration<a.duration)&&(y.duration=a.duration,y.easing=a.easing)}function Ul(y,a,f){const{maxSpeed:v,linearity:S,deceleration:T}=f,N=o.clamp(y*S/(a/1e3),-v,v),z=Math.abs(N)/(T*S);return{easing:f.easing,duration:1e3*z,amount:N*(z/2)}}class Do extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,f,v,S={}){const T=je(f.getCanvasContainer(),v),N=f.unproject(T);super(a,o.extend({point:T,lngLat:N,originalEvent:v},S)),this._defaultPrevented=!1,this.target=f}}class ao extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,f,v){const S=a==="touchend"?v.changedTouches:v.touches,T=pe(f.getCanvasContainer(),S),N=T.map((G=>f.unproject(G))),z=T.reduce(((G,ee,te,ge)=>G.add(ee.div(ge.length))),new o.Point(0,0));super(a,{points:T,point:z,lngLats:N,lngLat:f.unproject(z),originalEvent:v}),this._defaultPrevented=!1}}class Zs extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,f,v){super(a,{originalEvent:v}),this._defaultPrevented=!1}}class Lh{constructor(a,f){this._map=a,this._clickTolerance=f.clickTolerance}reset(){this._mousedownPos=void 0}wheel(a){return this._firePreventable(new Zs(a.type,this._map,a))}mousedown(a,f){return this._mousedownPos=f,this._firePreventable(new Do(a.type,this._map,a))}mouseup(a){this._map.fire(new Do(a.type,this._map,a))}preclick(a){const f=o.extend({},a);f.type="preclick",this._map.fire(new Do(f.type,this._map,f))}click(a,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||(this.preclick(a),this._map.fire(new Do(a.type,this._map,a)))}dblclick(a){return this._firePreventable(new Do(a.type,this._map,a))}mouseover(a){this._map.fire(new Do(a.type,this._map,a))}mouseout(a){this._map.fire(new Do(a.type,this._map,a))}touchstart(a){return this._firePreventable(new ao(a.type,this._map,a))}touchmove(a){this._map.fire(new ao(a.type,this._map,a))}touchend(a){this._map.fire(new ao(a.type,this._map,a))}touchcancel(a){this._map.fire(new ao(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ph{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(a){this._map.fire(new Do(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Do("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._map.fire(new Do(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ni{constructor(a,f){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,f){this.isEnabled()&&a.shiftKey&&a.button===0&&(ne(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(a,f){if(!this._active)return;const v=f,S=this._startPos,T=this._lastPos;if(!S||!T||T.equals(v)||!this._box&&v.dist(S)<this._clickTolerance)return;this._lastPos=v,this._box||(this._box=k("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",a));const N=Math.min(S.x,v.x),z=Math.max(S.x,v.x),G=Math.min(S.y,v.y),ee=Math.max(S.y,v.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${N}px,${G}px)`,this._box.style.width=z-N+"px",this._box.style.height=ee-G+"px")}))}mouseupWindow(a,f){if(!this._active)return;const v=this._startPos,S=f;if(v&&a.button===0){if(this.reset(),ke(),v.x!==S.x||v.y!==S.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:a})),{cameraAnimation:T=>T.fitScreenCoordinates(v,S,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",a)}}keydown(a){this._active&&a.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",a))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),me(),delete this._startPos,delete this._lastPos}_fireEvent(a,f){return this._map.fire(new o.Event(a,{originalEvent:f}))}}function nh(y,a){const f={};for(let v=0;v<y.length;v++)f[y[v].identifier]=a[v];return f}class rh{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(a,f,v){(this.centroid||v.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=a.timeStamp),v.length===this.numTouches&&(this.centroid=(function(S){const T=new o.Point(0,0);for(const N of S)T._add(N);return T.div(S.length)})(f),this.touches=nh(v,f)))}touchmove(a,f,v){if(this.aborted||!this.centroid)return;const S=nh(v,f);for(const T in this.touches){const N=S[T];(!N||N.dist(this.touches[T])>30)&&(this.aborted=!0)}}touchend(a,f,v){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),v.length===0){const S=!this.aborted&&this.centroid;if(this.reset(),S)return S}}}class dl{constructor(a){this.singleTap=new rh(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(a,f,v){this.singleTap.touchstart(a,f,v)}touchmove(a,f,v){this.singleTap.touchmove(a,f,v)}touchend(a,f,v){const S=this.singleTap.touchend(a,f,v);if(S){const T=a.timeStamp-this.lastTime<500,N=!this.lastTap||this.lastTap.dist(S)<30;if(T&&N||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=S,this.count===this.numTaps)return this.reset(),S}}}class wl{constructor(){this._zoomIn=new dl({numTouches:1,numTaps:2}),this._zoomOut=new dl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,f,v){this._zoomIn.touchstart(a,f,v),this._zoomOut.touchstart(a,f,v)}touchmove(a,f,v){this._zoomIn.touchmove(a,f,v),this._zoomOut.touchmove(a,f,v)}touchend(a,f,v){const S=this._zoomIn.touchend(a,f,v),T=this._zoomOut.touchend(a,f,v);return S?(this._active=!0,a.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:N=>N.easeTo({duration:300,zoom:N.getZoom()+1,around:N.unproject(S)},{originalEvent:a})}):T?(this._active=!0,a.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:N=>N.easeTo({duration:300,zoom:N.getZoom()-1,around:N.unproject(T)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Uh={0:1,2:2};class Sl{constructor(a){this.reset(),this._clickTolerance=a.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(a,f){return!1}_move(a,f){return{}}mousedown(a,f){if(this._lastPoint)return;const v=U(a);this._correctButton(a,v)&&(this._lastPoint=f,this._eventButton=v)}mousemoveWindow(a,f){const v=this._lastPoint;if(v){if(a.preventDefault(),this._eventButton!=null&&(function(S,T){const N=Uh[T];return S.buttons===void 0||(S.buttons&N)!==N})(a,this._eventButton))this.reset();else if(this._moved||!(f.dist(v)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(v,f)}}mouseupWindow(a){this._lastPoint&&U(a)===this._eventButton&&(this._moved&&ke(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ih extends Sl{mousedown(a,f){super.mousedown(a,f),this._lastPoint&&(this._active=!0)}_correctButton(a,f){return f===0&&!a.ctrlKey}_move(a,f){return{around:f,panDelta:f.sub(a)}}}class El extends Sl{_correctButton(a,f){return f===0&&a.ctrlKey||f===2}_move(a,f){const v=.8*(f.x-a.x);if(v)return this._active=!0,{bearingDelta:v}}contextmenu(a){a.preventDefault()}}class Al extends Sl{_correctButton(a,f){return f===0&&a.ctrlKey||f===2}_move(a,f){const v=-.5*(f.y-a.y);if(v)return this._active=!0,{pitchDelta:v}}contextmenu(a){a.preventDefault()}}class Ni{constructor(a,f){this._map=a,this._el=a.getCanvasContainer(),this._minTouches=1,this._clickTolerance=f.clickTolerance||1,this.reset(),o.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.Point(0,0)}touchstart(a,f,v){return this._calculateTransform(a,f,v)}touchmove(a,f,v){if(this._active&&!(v.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(v.length===1&&!o.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return a.cancelable&&a.preventDefault(),this._calculateTransform(a,f,v)}}touchend(a,f,v){this._calculateTransform(a,f,v),this._active&&v.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,f,v){v.length>0&&(this._active=!0);const S=nh(v,f),T=new o.Point(0,0),N=new o.Point(0,0);let z=0;for(const ee in S){const te=S[ee],ge=this._touches[ee];ge&&(T._add(te),N._add(te.sub(ge)),z++,S[ee]=te)}if(this._touches=S,z<this._minTouches||!N.mag())return;const G=N.div(z);return this._sum._add(G),this._sum.mag()<this._clickTolerance?void 0:{around:T.div(z),panDelta:G}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=k("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")}),500)}}class Ua{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(a){}_move(a,f,v){return{}}touchstart(a,f,v){this._firstTwoTouches||v.length<2||(this._firstTwoTouches=[v[0].identifier,v[1].identifier],this._start([f[0],f[1]]))}touchmove(a,f,v){const S=this._firstTwoTouches;if(!S)return;a.preventDefault();const[T,N]=S,z=Vl(v,f,T),G=Vl(v,f,N);if(!z||!G)return;const ee=this._aroundCenter?null:z.add(G).div(2);return this._move([z,G],ee,a)}touchend(a,f,v){if(!this._firstTwoTouches)return;const[S,T]=this._firstTwoTouches,N=Vl(v,f,S),z=Vl(v,f,T);N&&z||(this._active&&ke(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&a.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Vl(y,a,f){for(let v=0;v<y.length;v++)if(y[v].identifier===f)return a[v]}function Va(y,a){return Math.log(y/a)/Math.LN2}class lo extends Ua{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,f){const v=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(Va(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Va(this._distance,v),pinchAround:f}}}function vd(y,a){return 180*y.angleWith(a)/Math.PI}class nd extends Ua{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,f){const v=this._vector;if(this._vector=a[0].sub(a[1]),v&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:vd(this._vector,v),pinchAround:f}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const f=25/(Math.PI*this._minDiameter)*360,v=this._startVector;if(!v)return!1;const S=vd(a,v);return Math.abs(S)<f}}function ql(y){return Math.abs(y.y)>Math.abs(y.x)}class _u extends Ua{constructor(a){super(),this._map=a}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(a){this._lastPoints=a,ql(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,f,v){const S=this._lastPoints;if(!S)return;const T=a[0].sub(S[0]),N=a[1].sub(S[1]);return this._map._cooperativeGestures&&!o.isFullscreen()&&v.touches.length<3||(this._valid=this.gestureBeginsVertically(T,N,v.timeStamp),!this._valid)?void 0:(this._lastPoints=a,this._active=!0,{pitchDelta:(T.y+N.y)/2*-.5})}gestureBeginsVertically(a,f,v){if(this._valid!==void 0)return this._valid;const S=a.mag()>=2,T=f.mag()>=2;if(!S&&!T)return;if(!S||!T)return this._firstMove==null&&(this._firstMove=v),v-this._firstMove<100&&void 0;const N=a.y>0==f.y>0;return ql(a)&&ql(f)&&N}}const xa={panStep:100,bearingStep:15,pitchStep:10};class vu{constructor(){const a=xa;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let f=0,v=0,S=0,T=0,N=0;switch(a.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:a.shiftKey?v=-1:(a.preventDefault(),T=-1);break;case 39:a.shiftKey?v=1:(a.preventDefault(),T=1);break;case 38:a.shiftKey?S=1:(a.preventDefault(),N=-1);break;case 40:a.shiftKey?S=-1:(a.preventDefault(),N=1);break;default:return}return this._rotationDisabled&&(v=0,S=0),{cameraAnimation:z=>{const G=z.getZoom();z.easeTo({duration:300,easeId:"keyboardHandler",easing:xd,zoom:f?Math.round(G)+f*(a.shiftKey?2:1):G,bearing:z.getBearing()+v*this._bearingStep,pitch:z.getPitch()+S*this._pitchStep,offset:[-T*this._panStep,-N*this._panStep],center:z.getCenter()},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function xd(y){return y*(2-y)}const sc=4.000244140625;class Pa{constructor(a,f){this._map=a,this._el=a.getCanvasContainer(),this._handler=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&a.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(a){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(a.ctrlKey||a.metaKey||this.isZooming()||o.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let f=a.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const v=o.exported.now(),S=v-(this._lastWheelEventTime||0);this._lastWheelEventTime=v,f!==0&&f%sc==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":S>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(S*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),a.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=a,this._delta-=f,this._active||this._start(a)),a.preventDefault()}_onTimeout(a){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=je(this._el,a);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:f,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._map.transform;this._type==="wheel"&&a.projection.wrap&&(a._center.lng>=180||a._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const f=()=>a._terrainEnabled()&&this._aroundCoord?a.computeZoomRelativeTo(this._aroundCoord):a.zoom;if(this._delta!==0){const G=this._type==="wheel"&&Math.abs(this._delta)>sc?this._wheelZoomRate:this._defaultZoomRate;let ee=2/(1+Math.exp(-Math.abs(this._delta*G)));this._delta<0&&ee!==0&&(ee=1/ee);const te=f(),ge=Math.pow(2,te),Ae=typeof this._targetZoom=="number"?a.zoomScale(this._targetZoom):ge;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(Ae*ee))),this._type==="wheel"&&(this._startZoom=te,this._easing=this._smoothOutEasing(200)),this._delta=0}const v=typeof this._targetZoom=="number"?this._targetZoom:f(),S=this._startZoom,T=this._easing;let N,z=!1;if(this._type==="wheel"&&S&&T){const G=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),ee=T(G);N=o.number(S,v,ee),G<1?this._frameId||(this._frameId=!0):z=!0}else N=v,z=!0;return this._active=!0,z&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!z,zoomDelta:N-f(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let f=o.ease;if(this._prevEase){const v=this._prevEase,S=(o.exported.now()-v.start)/v.duration,T=v.easing(S+.01)-v.easing(S),N=.27/Math.sqrt(T*T+1e-4)*.01,z=Math.sqrt(.0729-N*N);f=o.bezier(N,z,.25,1)}return this._prevEase={start:o.exported.now(),duration:a,easing:f},f}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=k("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(o.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")}),200)}}class qo{constructor(a,f){this._clickZoom=a,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Hi{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(a,f){return a.preventDefault(),{cameraAnimation:v=>{v.easeTo({duration:300,zoom:v.getZoom()+(a.shiftKey?-1:1),around:v.unproject(f)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xu{constructor(){this._tap=new dl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(a,f,v){this._swipePoint||(this._tapTime&&a.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?v.length>0&&(this._swipePoint=f[0],this._swipeTouch=v[0].identifier):this._tap.touchstart(a,f,v))}touchmove(a,f,v){if(this._tapTime){if(this._swipePoint){if(v[0].identifier!==this._swipeTouch)return;const S=f[0],T=S.y-this._swipePoint.y;return this._swipePoint=S,a.preventDefault(),this._active=!0,{zoomDelta:T/128}}}else this._tap.touchmove(a,f,v)}touchend(a,f,v){this._tapTime?this._swipePoint&&v.length===0&&this.reset():this._tap.touchend(a,f,v)&&(this._tapTime=a.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Rs{constructor(a,f,v){this._el=a,this._mousePan=f,this._touchPan=v}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ac{constructor(a,f,v){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=f,this._mousePitch=v}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class oh{constructor(a,f,v,S){this._el=a,this._touchZoom=f,this._touchRotate=v,this._tapDragZoom=S,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const tl=y=>y.zoom||y.drag||y.pitch||y.rotate;class nl extends o.Event{}class Fu{constructor(){this.constants=[1,1,.01],this.radius=0}setup(a,f){const v=o.sub([],f,a);this.radius=o.length(v[2]<0?o.div([],v,this.constants):[v[0],v[1],0])}projectRay(a){o.div(a,a,this.constants),o.normalize(a,a),o.mul$1(a,a,this.constants);const f=o.scale$2([],a,this.radius);if(f[2]>0){const v=o.scale$2([],[0,0,1],o.dot(f,[0,0,1])),S=o.scale$2([],o.normalize([],[f[0],f[1],0]),this.radius),T=o.add([],f,o.scale$2([],o.sub([],o.add([],S,v),f),2));f[0]=T[0],f[1]=T[1]}return f}}function Ic(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class lc{constructor(a,f){this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ja(a),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Fu,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(f),o.bindAll(["handleEvent","handleWindowEvent"],this);const v=this._el;this._listeners=[[v,"touchstart",{passive:!0}],[v,"touchmove",{passive:!1}],[v,"touchend",void 0],[v,"touchcancel",void 0],[v,"mousedown",void 0],[v,"mousemove",void 0],[v,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[v,"mouseover",void 0],[v,"mouseout",void 0],[v,"dblclick",void 0],[v,"click",void 0],[v,"keydown",{capture:!1}],[v,"keyup",void 0],[v,"wheel",{passive:!1}],[v,"contextmenu",void 0],[o.window,"blur",void 0]];for(const[S,T,N]of this._listeners)S.addEventListener(T,S===o.window.document?this.handleWindowEvent:this.handleEvent,N)}destroy(){for(const[a,f,v]of this._listeners)a.removeEventListener(f,a===o.window.document?this.handleWindowEvent:this.handleEvent,v)}_addDefaultHandlers(a){const f=this._map,v=f.getCanvasContainer();this._add("mapEvent",new Lh(f,a));const S=f.boxZoom=new ni(f,a);this._add("boxZoom",S);const T=new wl,N=new Hi;f.doubleClickZoom=new qo(N,T),this._add("tapZoom",T),this._add("clickZoom",N);const z=new xu;this._add("tapDragZoom",z);const G=f.touchPitch=new _u(f);this._add("touchPitch",G);const ee=new El(a),te=new Al(a);f.dragRotate=new ac(a,ee,te),this._add("mouseRotate",ee,["mousePitch"]),this._add("mousePitch",te,["mouseRotate"]);const ge=new ih(a),Ae=new Ni(f,a);f.dragPan=new Rs(v,ge,Ae),this._add("mousePan",ge),this._add("touchPan",Ae,["touchZoom","touchRotate"]);const Le=new nd,Xe=new lo;f.touchZoomRotate=new oh(v,Xe,Le,z),this._add("touchRotate",Le,["touchPan","touchZoom"]),this._add("touchZoom",Xe,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ph(f));const Ue=f.scrollZoom=new Pa(f,this);this._add("scrollZoom",Ue,["mousePan"]);const Ze=f.keyboard=new vu;this._add("keyboard",Ze);for(const _e of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])a.interactive&&a[_e]&&f[_e].enable(a[_e])}_add(a,f,v){this._handlers.push({handlerName:a,handler:f,allowed:v}),this._handlersById[a]=f}stop(a){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[]}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!tl(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(a,f,v){for(const S in a)if(S!==v&&(!f||f.indexOf(S)<0))return!0;return!1}handleWindowEvent(a){this.handleEvent(a,`${a.type}Window`)}_getMapTouches(a){const f=[];for(const v of a)this._el.contains(v.target)&&f.push(v);return f}handleEvent(a,f){this._updatingCamera=!0;const v=a.type==="renderFrame",S=v?void 0:a,T={needsRenderFrame:!1},N={},z={},G=a.touches?this._getMapTouches(a.touches):void 0,ee=G?pe(this._el,G):v?void 0:je(this._el,a);for(const{handlerName:Ae,handler:Le,allowed:Xe}of this._handlers){if(!Le.isEnabled())continue;let Ue;this._blockedByActive(z,Xe,Ae)?Le.reset():Le[f||a.type]&&(Ue=Le[f||a.type](a,ee,G),this.mergeHandlerResult(T,N,Ue,Ae,S),Ue&&Ue.needsRenderFrame&&this._triggerRenderFrame()),(Ue||Le.isActive())&&(z[Ae]=Le)}const te={};for(const Ae in this._previousActiveHandlers)z[Ae]||(te[Ae]=S);this._previousActiveHandlers=z,(Object.keys(te).length||Ic(T))&&(this._changes.push([T,N,te]),this._triggerRenderFrame()),(Object.keys(z).length||Ic(T))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ge}=T;ge&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ge(this._map))}mergeHandlerResult(a,f,v,S,T){if(!v)return;o.extend(a,v);const N={handlerName:S,originalEvent:v.originalEvent||T};v.zoomDelta!==void 0&&(f.zoom=N),v.panDelta!==void 0&&(f.drag=N),v.pitchDelta!==void 0&&(f.pitch=N),v.bearingDelta!==void 0&&(f.rotate=N)}_applyChanges(){const a={},f={},v={};for(const[S,T,N]of this._changes)S.panDelta&&(a.panDelta=(a.panDelta||new o.Point(0,0))._add(S.panDelta)),S.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+S.zoomDelta),S.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+S.bearingDelta),S.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+S.pitchDelta),S.around!==void 0&&(a.around=S.around),S.aroundCoord!==void 0&&(a.aroundCoord=S.aroundCoord),S.pinchAround!==void 0&&(a.pinchAround=S.pinchAround),S.noInertia&&(a.noInertia=S.noInertia),o.extend(f,T),o.extend(v,N);this._updateMapTransform(a,f,v),this._changes=[]}_updateMapTransform(a,f,v){const S=this._map,T=S.transform,N=$e=>[$e.x,$e.y,$e.z];if(($e=>{const it=this._eventsInProgress.drag;return it&&!this._handlersById[it.handlerName].isActive()})()&&!Ic(a)){const $e=T.zoom;T.cameraElevationReference="sea",T.recenterOnTerrain(),T.cameraElevationReference="ground",$e!==T.zoom&&this._map._update(!0)}if(T._isCameraConstrained&&S._stop(!0),!Ic(a))return void this._fireEvents(f,v,!0);let{panDelta:z,zoomDelta:G,bearingDelta:ee,pitchDelta:te,around:ge,aroundCoord:Ae,pinchAround:Le}=a;T._isCameraConstrained&&(G>0&&(G=0),T._isCameraConstrained=!1),Le!==void 0&&(ge=Le),(G||($e=>f[$e]&&!this._eventsInProgress[$e])("drag"))&&ge&&(this._dragOrigin=N(T.pointCoordinate3D(ge)),this._trackingEllipsoid.setup(T._camera.position,this._dragOrigin)),T.cameraElevationReference="sea",S._stop(!0),ge=ge||S.transform.centerPoint,ee&&(T.bearing+=ee),te&&(T.pitch+=te),T._updateCameraState();const Xe=[0,0,0];if(z)if(T.projection.name==="mercator"){const $e=this._trackingEllipsoid.projectRay(T.screenPointToMercatorRay(ge).dir),it=this._trackingEllipsoid.projectRay(T.screenPointToMercatorRay(ge.sub(z)).dir);Xe[0]=it[0]-$e[0],Xe[1]=it[1]-$e[1]}else{const $e=T.pointCoordinate(ge);if(T.projection.name==="globe"){z=z.rotate(-T.angle);const it=T._pixelsPerMercatorPixel/T.worldSize;Xe[0]=-z.x*o.mercatorScale(o.latFromMercatorY($e.y))*it,Xe[1]=-z.y*o.mercatorScale(T.center.lat)*it}else{const it=T.pointCoordinate(ge.sub(z));$e&&it&&(Xe[0]=it.x-$e.x,Xe[1]=it.y-$e.y)}}const Ue=T.zoom,Ze=[0,0,0];if(G){const $e=N(Ae||T.pointCoordinate3D(ge)),it={dir:o.normalize([],o.sub([],$e,T._camera.position))};if(it.dir[2]<0){const ot=T.zoomDeltaToMovement($e,G);o.scale$2(Ze,it.dir,ot)}}const _e=o.add(Xe,Xe,Ze);T._translateCameraConstrained(_e),G&&Math.abs(T.zoom-Ue)>1e-4&&T.recenterOnTerrain(),T.cameraElevationReference="ground",this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(f,v,!0)}_fireEvents(a,f,v){const S=tl(this._eventsInProgress),T=tl(a),N={};for(const te in a){const{originalEvent:ge}=a[te];this._eventsInProgress[te]||(N[`${te}start`]=ge),this._eventsInProgress[te]=a[te]}!S&&T&&this._fireEvent("movestart",T.originalEvent);for(const te in N)this._fireEvent(te,N[te]);T&&this._fireEvent("move",T.originalEvent);for(const te in a){const{originalEvent:ge}=a[te];this._fireEvent(te,ge)}const z={};let G;for(const te in this._eventsInProgress){const{handlerName:ge,originalEvent:Ae}=this._eventsInProgress[te];this._handlersById[ge].isActive()||(delete this._eventsInProgress[te],G=f[ge]||Ae,z[`${te}end`]=G)}for(const te in z)this._fireEvent(te,z[te]);const ee=tl(this._eventsInProgress);if(v&&(S||T)&&!ee){this._updatingCamera=!0;const te=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ge=Ae=>Ae!==0&&-this._bearingSnap<Ae&&Ae<this._bearingSnap;te?(ge(te.bearing||this._map.getBearing())&&(te.bearing=0),this._map.easeTo(te,{originalEvent:G})):(this._map.fire(new o.Event("moveend",{originalEvent:G})),ge(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(a,f){this._map.fire(new o.Event(a,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((a=>{this._frameId=void 0,this.handleEvent(new nl("renderFrame",{timeStamp:a})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Tl="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class sh extends o.Evented{constructor(a,f){super(),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=f.bearingSnap,this._respectPrefersReducedMotion=f.respectPrefersReducedMotion!==!1,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(a,f){return this.jumpTo({center:a},f)}panBy(a,f,v){return a=o.Point.convert(a).mult(-1),this.panTo(this.transform.center,o.extend({offset:a},f),v)}panTo(a,f,v){return this.easeTo(o.extend({center:a},f),v)}getZoom(){return this.transform.zoom}setZoom(a,f){return this.jumpTo({zoom:a},f),this}zoomTo(a,f,v){return this.easeTo(o.extend({zoom:a},f),v)}zoomIn(a,f){return this.zoomTo(this.getZoom()+1,a,f),this}zoomOut(a,f){return this.zoomTo(this.getZoom()-1,a,f),this}getBearing(){return this.transform.bearing}setBearing(a,f){return this.jumpTo({bearing:a},f),this}getPadding(){return this.transform.padding}setPadding(a,f){return this.jumpTo({padding:a},f),this}rotateTo(a,f,v){return this.easeTo(o.extend({bearing:a},f),v)}resetNorth(a,f){return this.rotateTo(0,o.extend({duration:1e3},a),f),this}resetNorthPitch(a,f){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},a),f),this}snapToNorth(a,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,f):this}getPitch(){return this.transform.pitch}setPitch(a,f){return this.jumpTo({pitch:a},f),this}cameraForBounds(a,f){a=o.LngLatBounds.convert(a);const v=f&&f.bearing||0,S=f&&f.pitch||0,T=a.getNorthWest(),N=a.getSouthEast();return this._cameraForBounds(this.transform,T,N,v,S,f)}_extendCameraOptions(a){const f={top:0,bottom:0,right:0,left:0};if(typeof(a=o.extend({padding:f,offset:[0,0],maxZoom:this.transform.maxZoom},a)).padding=="number"){const v=a.padding;a.padding={top:v,bottom:v,right:v,left:v}}return a.padding=o.extend(f,a.padding),a}_minimumAABBFrustumDistance(a,f){const v=f.max[0]-f.min[0],S=f.max[1]-f.min[1];return v/S>a.aspect?v/(2*Math.tan(.5*a.fovX)*a.aspect):S/(2*Math.tan(.5*a.fovY)*a.aspect)}_cameraForBoundsOnGlobe(a,f,v,S,T,N){const z=a.clone(),G=this._extendCameraOptions(N);z.bearing=S,z.pitch=T;const ee=o.LngLat.convert(f),te=o.LngLat.convert(v),ge=.5*(ee.lat+te.lat),Ae=.5*(ee.lng+te.lng),Le=o.latLngToECEF(ge,Ae),Xe=o.normalize([],Le),Ue=o.normalize([],o.cross([],Xe,[0,1,0])),Ze=o.cross([],Ue,Xe),_e=[Ue[0],Ue[1],Ue[2],0,Ze[0],Ze[1],Ze[2],0,Xe[0],Xe[1],Xe[2],0,0,0,0,1],$e=[Le,o.latLngToECEF(ee.lat,ee.lng),o.latLngToECEF(te.lat,ee.lng),o.latLngToECEF(te.lat,te.lng),o.latLngToECEF(ee.lat,te.lng),o.latLngToECEF(ge,ee.lng),o.latLngToECEF(ge,te.lng),o.latLngToECEF(ee.lat,Ae),o.latLngToECEF(te.lat,Ae)];let it=o.Aabb.fromPoints($e.map((xn=>[o.dot(Ue,xn),o.dot(Ze,xn),o.dot(Xe,xn)])));const ot=o.transformMat4([],it.center,_e);o.squaredLength(ot)===0&&o.set(ot,0,0,1),o.normalize(ot,ot),o.scale$2(ot,ot,o.GLOBE_RADIUS),z.center=o.ecefToLatLng(ot);const bt=z.getWorldToCameraMatrix(),wt=o.invert(new Float64Array(16),bt);it=o.Aabb.applyTransform(it,o.multiply([],bt,_e)),o.transformMat4(ot,ot,bt);const vt=.5*(it.max[2]-it.min[2]),Rt=this._minimumAABBFrustumDistance(z,it),Lt=o.scale$2([],[0,0,1],vt),zt=o.add(Lt,ot,Lt),mn=Rt+(z.pitch===0?0:o.distance(ot,zt)),Ut=z.globeCenterInViewSpace,an=o.sub([],ot,[Ut[0],Ut[1],Ut[2]]);o.normalize(an,an),o.scale$2(an,an,mn);const Ht=o.add([],ot,an);o.transformMat4(Ht,Ht,wt);const Cn=o.earthRadius/o.GLOBE_RADIUS,jt=o.length(Ht),on=o.mercatorZfromAltitude(Math.max(jt*Cn-o.earthRadius,Number.EPSILON),0),In=Math.min(z.zoomFromMercatorZAdjusted(on),G.maxZoom);return In>.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(z.setProjection({name:"mercator"}),z.zoom=In,this._cameraForBounds(z,f,v,S,T,N)):{center:z.center,zoom:In,bearing:S,pitch:T}}queryTerrainElevation(a,f){const v=this.transform.elevation;return v?(f=o.extend({},{exaggerated:!0},f),v.getAtPoint(o.MercatorCoordinate.fromLngLat(a),null,f.exaggerated)):null}_cameraForBounds(a,f,v,S,T,N){if(a.projection.name==="globe")return this._cameraForBoundsOnGlobe(a,f,v,S,T,N);const z=a.clone(),G=this._extendCameraOptions(N),ee=z.padding;z.bearing=S,z.pitch=T;const te=o.LngLat.convert(f),ge=o.LngLat.convert(v),Ae=new o.LngLat(te.lng,ge.lat),Le=new o.LngLat(ge.lng,te.lat),Xe=z.project(te),Ue=z.project(ge),Ze=this.queryTerrainElevation(te),_e=this.queryTerrainElevation(ge),$e=this.queryTerrainElevation(Ae),it=this.queryTerrainElevation(Le),ot=[[Xe.x,Xe.y,Math.min(Ze||0,_e||0,$e||0,it||0)],[Ue.x,Ue.y,Math.max(Ze||0,_e||0,$e||0,it||0)]];let bt=o.Aabb.fromPoints(ot);const wt=z.getWorldToCameraMatrix(),vt=o.invert(new Float64Array(16),wt);bt=o.Aabb.applyTransform(bt,wt);const Rt=o.sub([],bt.max,bt.min),Lt=ee.left||0,zt=ee.right||0,mn=ee.bottom||0,Ut=ee.top||0,{left:an,right:Ht,top:Cn,bottom:jt}=G.padding,on=.5*(Lt+zt),In=.5*(Ut+mn),xn=Math.min(z.scaleZoom(z.scale*Math.min((z.width-(Lt+zt+an+Ht))/Rt[0],(z.height-(mn+Ut+jt+Cn))/Rt[1])),G.maxZoom),bn=z.scale/z.zoomScale(xn);bt=new o.Aabb([bt.min[0]-(an+on)*bn,bt.min[1]-(jt+In)*bn,bt.min[2]],[bt.max[0]+(Ht+on)*bn,bt.max[1]+(Cn+In)*bn,bt.max[2]]);const pr=.5*Rt[2],Fr=this._minimumAABBFrustumDistance(z,bt),sr=[0,0,1,0];o.transformMat4$1(sr,sr,wt),o.normalize$2(sr,sr);const fr=o.scale$2([],sr,Fr+pr),$r=o.add([],bt.center,fr),gi=(typeof G.offset.x=="number"&&typeof G.offset.y=="number"?new o.Point(G.offset.x,G.offset.y):o.Point.convert(G.offset)).rotate(-o.degToRad(S));bt.center[0]-=gi.x*bn,bt.center[1]+=gi.y*bn,o.transformMat4(bt.center,bt.center,vt),o.transformMat4($r,$r,vt);const Sr=[bt.center[0],bt.center[1],$r[2]*z.pixelsPerMeter];o.scale$2(Sr,Sr,1/z.worldSize);const ki=o.lngFromMercatorX(Sr[0]),Ci=o.latFromMercatorY(Sr[1]),co=Math.min(z._zoomFromMercatorZ(Sr[2]),G.maxZoom),Ri=new o.LngLat(ki,Ci);return z.mercatorFromTransition&&co<.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(z.setProjection({name:"globe"}),z.zoom=co,this._cameraForBounds(z,f,v,S,T,N)):{center:Ri,zoom:co,bearing:S,pitch:T}}fitBounds(a,f,v){const S=this.cameraForBounds(a,f);return this._fitInternal(S,f,v)}fitScreenCoordinates(a,f,v,S,T){const N=o.Point.convert(a),z=o.Point.convert(f),G=new o.Point(Math.min(N.x,z.x),Math.min(N.y,z.y)),ee=new o.Point(Math.max(N.x,z.x),Math.max(N.y,z.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(N,z))return this;const te=this.transform.pointLocation3D(G),ge=this.transform.pointLocation3D(ee),Ae=this.transform.pointLocation3D(new o.Point(G.x,ee.y)),Le=this.transform.pointLocation3D(new o.Point(ee.x,G.y)),Xe=[Math.min(te.lng,ge.lng,Ae.lng,Le.lng),Math.min(te.lat,ge.lat,Ae.lat,Le.lat)],Ue=[Math.max(te.lng,ge.lng,Ae.lng,Le.lng),Math.max(te.lat,ge.lat,Ae.lat,Le.lat)],Ze=S&&S.pitch?S.pitch:this.getPitch(),_e=this._cameraForBounds(this.transform,Xe,Ue,v,Ze,S);return this._fitInternal(_e,S,T)}_fitInternal(a,f,v){return a?(delete(f=o.extend(a,f)).padding,f.linear?this.easeTo(f,v):this.flyTo(f,v)):this}jumpTo(a,f){this.stop();const v=a.preloadOnly?this.transform.clone():this.transform;let S=!1,T=!1,N=!1;return"zoom"in a&&v.zoom!==+a.zoom&&(S=!0,v.zoom=+a.zoom),a.center!==void 0&&(v.center=o.LngLat.convert(a.center)),"bearing"in a&&v.bearing!==+a.bearing&&(T=!0,v.bearing=+a.bearing),"pitch"in a&&v.pitch!==+a.pitch&&(N=!0,v.pitch=+a.pitch),a.padding==null||v.isPaddingEqual(a.padding)||(v.padding=a.padding),a.preloadOnly?(this._preloadTiles(v),this):(this.fire(new o.Event("movestart",f)).fire(new o.Event("move",f)),S&&this.fire(new o.Event("zoomstart",f)).fire(new o.Event("zoom",f)).fire(new o.Event("zoomend",f)),T&&this.fire(new o.Event("rotatestart",f)).fire(new o.Event("rotate",f)).fire(new o.Event("rotateend",f)),N&&this.fire(new o.Event("pitchstart",f)).fire(new o.Event("pitch",f)).fire(new o.Event("pitchend",f)),this.fire(new o.Event("moveend",f)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.warnOnce(Tl),this.transform.getFreeCameraOptions()}setFreeCameraOptions(a,f){const v=this.transform;if(!v.projection.supportsFreeCamera)return o.warnOnce(Tl),this;this.stop();const S=v.zoom,T=v.pitch,N=v.bearing;v.setFreeCameraOptions(a);const z=S!==v.zoom,G=T!==v.pitch,ee=N!==v.bearing;return this.fire(new o.Event("movestart",f)).fire(new o.Event("move",f)),z&&this.fire(new o.Event("zoomstart",f)).fire(new o.Event("zoom",f)).fire(new o.Event("zoomend",f)),ee&&this.fire(new o.Event("rotatestart",f)).fire(new o.Event("rotate",f)).fire(new o.Event("rotateend",f)),G&&this.fire(new o.Event("pitchstart",f)).fire(new o.Event("pitch",f)).fire(new o.Event("pitchend",f)),this.fire(new o.Event("moveend",f)),this}easeTo(a,f){this._stop(!1,a.easeId),((a=o.extend({offset:[0,0],duration:500,easing:o.ease},a)).animate===!1||this._prefersReducedMotion(a))&&(a.duration=0);const v=this.transform,S=this.getZoom(),T=this.getBearing(),N=this.getPitch(),z=this.getPadding(),G="zoom"in a?+a.zoom:S,ee="bearing"in a?this._normalizeBearing(a.bearing,T):T,te="pitch"in a?+a.pitch:N,ge="padding"in a?a.padding:v.padding,Ae=o.Point.convert(a.offset);let Le,Xe,Ue;if(v.projection.name==="globe"){const Lt=o.MercatorCoordinate.fromLngLat(v.center),zt=Ae.rotate(-v.angle);Lt.x+=zt.x/v.worldSize,Lt.y+=zt.y/v.worldSize;const mn=Lt.toLngLat(),Ut=o.LngLat.convert(a.center||mn);this._normalizeCenter(Ut),Le=v.centerPoint.add(zt),Xe=new o.Point(Lt.x,Lt.y).mult(v.worldSize),Ue=new o.Point(o.mercatorXfromLng(Ut.lng),o.mercatorYfromLat(Ut.lat)).mult(v.worldSize).sub(Xe)}else{Le=v.centerPoint.add(Ae);const Lt=v.pointLocation(Le),zt=o.LngLat.convert(a.center||Lt);this._normalizeCenter(zt),Xe=v.project(Lt),Ue=v.project(zt).sub(Xe)}const Ze=v.zoomScale(G-S);let _e,$e;a.around&&(_e=o.LngLat.convert(a.around),$e=v.locationPoint(_e));const it=this._zooming||G!==S,ot=this._rotating||T!==ee,bt=this._pitching||te!==N,wt=!v.isPaddingEqual(ge),vt=Lt=>zt=>{if(it&&(Lt.zoom=o.number(S,G,zt)),ot&&(Lt.bearing=o.number(T,ee,zt)),bt&&(Lt.pitch=o.number(N,te,zt)),wt&&(Lt.interpolatePadding(z,ge,zt),Le=Lt.centerPoint.add(Ae)),_e)Lt.setLocationAtPoint(_e,$e);else{const mn=Lt.zoomScale(Lt.zoom-S),Ut=G>S?Math.min(2,Ze):Math.max(.5,Ze),an=Math.pow(Ut,1-zt),Ht=Lt.unproject(Xe.add(Ue.mult(zt*an)).mult(mn));Lt.setLocationAtPoint(Lt.renderWorldCopies?Ht.wrap():Ht,Le)}return a.preloadOnly||this._fireMoveEvents(f),Lt};if(a.preloadOnly){const Lt=this._emulate(vt,a.duration,v);return this._preloadTiles(Lt),this}const Rt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=it,this._rotating=ot,this._pitching=bt,this._padding=wt,this._easeId=a.easeId,this._prepareEase(f,a.noMoveStart,Rt),this._ease(vt(v),(Lt=>{v.recenterOnTerrain(),this._afterEase(f,Lt)}),a),this}_prepareEase(a,f,v={}){this._moving=!0,this.transform.cameraElevationReference="sea",f||v.moving||this.fire(new o.Event("movestart",a)),this._zooming&&!v.zooming&&this.fire(new o.Event("zoomstart",a)),this._rotating&&!v.rotating&&this.fire(new o.Event("rotatestart",a)),this._pitching&&!v.pitching&&this.fire(new o.Event("pitchstart",a))}_fireMoveEvents(a){this.fire(new o.Event("move",a)),this._zooming&&this.fire(new o.Event("zoom",a)),this._rotating&&this.fire(new o.Event("rotate",a)),this._pitching&&this.fire(new o.Event("pitch",a))}_afterEase(a,f){if(this._easeId&&f&&this._easeId===f)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const v=this._zooming,S=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,v&&this.fire(new o.Event("zoomend",a)),S&&this.fire(new o.Event("rotateend",a)),T&&this.fire(new o.Event("pitchend",a)),this.fire(new o.Event("moveend",a))}flyTo(a,f){if(this._prefersReducedMotion(a)){const xn=o.pick(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(xn,f)}this.stop(),a=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},a);const v=this.transform,S=this.getZoom(),T=this.getBearing(),N=this.getPitch(),z=this.getPadding(),G="zoom"in a?o.clamp(+a.zoom,v.minZoom,v.maxZoom):S,ee="bearing"in a?this._normalizeBearing(a.bearing,T):T,te="pitch"in a?+a.pitch:N,ge="padding"in a?a.padding:v.padding,Ae=v.zoomScale(G-S),Le=o.Point.convert(a.offset);let Xe=v.centerPoint.add(Le);const Ue=v.pointLocation(Xe),Ze=o.LngLat.convert(a.center||Ue);this._normalizeCenter(Ze);const _e=v.project(Ue),$e=v.project(Ze).sub(_e);let it=a.curve;const ot=Math.max(v.width,v.height),bt=ot/Ae,wt=$e.mag();if("minZoom"in a){const xn=o.clamp(Math.min(a.minZoom,S,G),v.minZoom,v.maxZoom),bn=ot/v.zoomScale(xn-S);it=Math.sqrt(bn/wt*2)}const vt=it*it;function Rt(xn){const bn=(bt*bt-ot*ot+(xn?-1:1)*vt*vt*wt*wt)/(2*(xn?bt:ot)*vt*wt);return Math.log(Math.sqrt(bn*bn+1)-bn)}function Lt(xn){return(Math.exp(xn)-Math.exp(-xn))/2}function zt(xn){return(Math.exp(xn)+Math.exp(-xn))/2}const mn=Rt(0);let Ut=function(xn){return zt(mn)/zt(mn+it*xn)},an=function(xn){return ot*((zt(mn)*(Lt(bn=mn+it*xn)/zt(bn))-Lt(mn))/vt)/wt;var bn},Ht=(Rt(1)-mn)/it;if(Math.abs(wt)<1e-6||!isFinite(Ht)){if(Math.abs(ot-bt)<1e-6)return this.easeTo(a,f);const xn=bt<ot?-1:1;Ht=Math.abs(Math.log(bt/ot))/it,an=function(){return 0},Ut=function(bn){return Math.exp(xn*it*bn)}}a.duration="duration"in a?+a.duration:1e3*Ht/("screenSpeed"in a?+a.screenSpeed/it:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0);const Cn=T!==ee,jt=te!==N,on=!v.isPaddingEqual(ge),In=xn=>bn=>{const pr=bn*Ht,Fr=1/Ut(pr);xn.zoom=bn===1?G:S+xn.scaleZoom(Fr),Cn&&(xn.bearing=o.number(T,ee,bn)),jt&&(xn.pitch=o.number(N,te,bn)),on&&(xn.interpolatePadding(z,ge,bn),Xe=xn.centerPoint.add(Le));const sr=bn===1?Ze:xn.unproject(_e.add($e.mult(an(pr))).mult(Fr));return xn.setLocationAtPoint(xn.renderWorldCopies?sr.wrap():sr,Xe),xn._updateCameraOnTerrain(),a.preloadOnly||this._fireMoveEvents(f),xn};if(a.preloadOnly){const xn=this._emulate(In,a.duration,v);return this._preloadTiles(xn),this}return this._zooming=!0,this._rotating=Cn,this._pitching=jt,this._padding=on,this._prepareEase(f,!1),this._ease(In(v),(()=>this._afterEase(f)),a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(a,f){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const v=this._onEaseEnd;this._onEaseEnd=void 0,v.call(this,f)}if(!a){const v=this.handlers;v&&v.stop(!1)}return this}_ease(a,f,v){v.animate===!1||v.duration===0?(a(1),f()):(this._easeStart=o.exported.now(),this._easeOptions=v,this._onEaseFrame=a,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const a=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1),f=this._onEaseFrame;f&&f(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(a,f){a=o.wrap(a,-180,180);const v=Math.abs(a-f);return Math.abs(a-360-f)<v&&(a-=360),Math.abs(a+360-f)<v&&(a+=360),a}_normalizeCenter(a){const f=this.transform;if(!f.renderWorldCopies||f.maxBounds)return;const v=a.lng-f.center.lng;a.lng+=v>180?-360:v<-180?360:0}_prefersReducedMotion(a){return this._respectPrefersReducedMotion&&o.exported.prefersReducedMotion&&!(a&&a.essential)}_emulate(a,f,v){const S=Math.ceil(15*f/1e3),T=[],N=a(v.clone());for(let z=0;z<=S;z++){const G=N(z/S);T.push(G.clone())}return T}}class hr{constructor(a={}){this.options=a,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(a){const f=this.options&&this.options.compact;return this._map=a,this._container=k("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=k("button","mapboxgl-ctrl-attrib-button",this._container),k("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=k("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(a,f){const v=this._map._getUIString(`AttributionControl.${f}`);a.setAttribute("aria-label",v),a.removeAttribute("title"),a.firstElementChild&&a.firstElementChild.setAttribute("title",v)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let a=this._editLink;a||(a=this._editLink=this._container.querySelector(".mapbox-improve-map"));const f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(a){const v=f.reduce(((S,T,N)=>(T.value&&(S+=`${T.key}=${T.value}${N<f.length-1?"&":""}`),S)),"?");a.href=`${o.config.FEEDBACK_URL}/${v}#${va(this._map,!0)}`,a.rel="noopener nofollow",this._setElementTitle(a,"MapFeedback")}}_updateData(a){!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let a=[];if(this._map.style.stylesheet){const S=this._map.style.stylesheet;this.styleOwner=S.owner,this.styleId=S.id}const f=this._map.style._sourceCaches;for(const S in f){const T=f[S];if(T.used){const N=T.getSource();N.attribution&&a.indexOf(N.attribution)<0&&a.push(N.attribution)}}a.sort(((S,T)=>S.length-T.length)),a=a.filter(((S,T)=>{for(let N=T+1;N<a.length;N++)if(a[N].indexOf(S)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=[...this.options.customAttribution,...a]:a.unshift(this.options.customAttribution));const v=a.join(" | ");v!==this._attribHTML&&(this._attribHTML=v,a.length?(this._innerContainer.innerHTML=v,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ah{constructor(){o.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(a){this._map=a,this._container=k("div","mapboxgl-ctrl");const f=k("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(a){a&&a.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const a=this._map.style._sourceCaches;if(Object.entries(a).length===0)return!0;for(const f in a){const v=a[f].getSource();if(v.hasOwnProperty("mapbox_logo")&&!v.mapbox_logo)return!1}return!0}_updateCompact(){const a=this._container.children;if(a.length){const f=a[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}}}class C{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const f=++this._id;return this._queue.push({callback:a,id:f,cancelled:!1}),f}remove(a){const f=this._currentlyRunning,v=f?this._queue.concat(f):this._queue;for(const S of v)if(S.id===a)return void(S.cancelled=!0)}run(a=0){const f=this._currentlyRunning=this._queue;this._queue=[];for(const v of f)if(!v.cancelled&&(v.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function B(y,a,f){if(y=new o.LngLat(y.lng,y.lat),a){const v=new o.LngLat(y.lng-360,y.lat),S=new o.LngLat(y.lng+360,y.lat),T=360*Math.ceil(Math.abs(y.lng-f.center.lng)/360),N=f.locationPoint(y).distSqr(a),z=a.x<0||a.y<0||a.x>f.width||a.y>f.height;f.locationPoint(v).distSqr(a)<N&&(z||Math.abs(v.lng-f.center.lng)<T)?y=v:f.locationPoint(S).distSqr(a)<N&&(z||Math.abs(S.lng-f.center.lng)<T)&&(y=S)}for(;Math.abs(y.lng-f.center.lng)>180;){const v=f.locationPoint(y);if(v.x>=0&&v.y>=0&&v.x<=f.width&&v.y<=f.height)break;y.lng>f.center.lng?y.lng-=360:y.lng+=360}return y}const Q={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class oe extends o.Evented{constructor(a,f){if(super(),(a instanceof o.window.HTMLElement||f)&&(a=o.extend({element:a},f)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=a&&a.occludedOpacity||.2,a&&a.element)this._element=a.element,this._offset=o.Point.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=k("div");const S=41,T=27,N=ie("svg",{display:"block",height:S*this._scale+"px",width:T*this._scale+"px",viewBox:`0 0 ${T} ${S}`},this._element),z=ie("radialGradient",{id:"shadowGradient"},ie("defs",{},N));ie("stop",{offset:"10%","stop-opacity":.4},z),ie("stop",{offset:"100%","stop-opacity":.05},z),ie("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},N),ie("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},N),ie("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},N),ie("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},N),this._offset=o.Point.convert(a&&a.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(S=>{S.preventDefault()})),this._element.addEventListener("mousedown",(S=>{S.preventDefault()}));const v=this._element.classList;for(const S in Q)v.remove(`mapboxgl-marker-anchor-${S}`);v.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(a){return a===this._map||(this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._updateMoving),a.on("moveend",this._update),a.on("remove",this._clearFadeTimer),a._addMarker(this),this.setDraggable(this._draggable),this._update(),a.on("click",this._onMapClick)),this}remove(){const a=this._map;return a&&(a.off("click",this._onMapClick),a.off("move",this._updateMoving),a.off("moveend",this._update),a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler),a.off("mouseup",this._onUp),a.off("touchend",this._onUp),a.off("mousemove",this._onMove),a.off("touchmove",this._onMove),a.off("remove",this._clearFadeTimer),a._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=o.LngLat.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const S=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[S,-1*(38.1-13.5+S)],"bottom-right":[-S,-1*(38.1-13.5+S)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=a,a._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(a){const f=a.code,v=a.charCode||a.keyCode;f!=="Space"&&f!=="Enter"&&v!==32&&v!==13||this.togglePopup()}_onMapClick(a){const f=a.originalEvent.target,v=this._element;this._popup&&(f===v||v.contains(f))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const a=this._popup;return a?(a.isOpen()?(a.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(a.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const a=this._map,f=this._pos;if(!a||!f)return!1;const v=a.unproject(f),S=a.getFreeCameraOptions();if(!S.position)return!1;const T=S.position.toLngLat();return T.distanceTo(v)<.9*T.distanceTo(this._lngLat)}_evaluateOpacity(){const a=this._map;if(!a)return;const f=this._pos;if(!f||f.x<0||f.x>a.transform.width||f.y<0||f.y>a.transform.height)return void this._clearFadeTimer();const v=a.unproject(f);let S;a._showingGlobe()&&o.isLngLatBehindGlobe(a.transform,this._lngLat)?S=0:(S=1-a._queryFogOpacity(v),a.transform._terrainEnabled()&&a.getTerrain()&&this._behindTerrain()&&(S*=this._occludedOpacity)),this._element.style.opacity=`${S}`,this._element.style.pointerEvents=S>0?"auto":"none",this._popup&&this._popup._setOpacity(S),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const a=this._pos;if(!a||!this._map)return;const f=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${a.x}px,${a.y}px)
            ${Q[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${f.x}px,${f.y}px)
        `}_calculateXYTransform(){const a=this._pos,f=this._map,v=this.getPitchAlignment();if(!f||!a||v!=="map")return"";if(!f._showingGlobe()){const G=f.getPitch();return G?`rotateX(${G}deg)`:""}const S=o.radToDeg(o.globeTiltAtLngLat(f.transform,this._lngLat)),T=a.sub(o.globeCenterToScreenPoint(f.transform)),N=Math.abs(T.x)+Math.abs(T.y);if(N===0)return"";const z=S/N;return`rotateX(${-T.y*z}deg) rotateY(${T.x*z}deg)`}_calculateZTransform(){const a=this._pos,f=this._map;if(!f||!a)return"";let v=0;const S=this.getRotationAlignment();if(S==="map")if(f._showingGlobe()){const T=f.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),N=f.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(T);v=o.radToDeg(Math.atan2(N.y,N.x))-90}else v=-f.getBearing();else if(S==="horizon"){const T=o.smoothstep(4,6,f.getZoom()),N=o.globeCenterToScreenPoint(f.transform);N.y+=T*f.transform.height;const z=a.sub(N),G=o.radToDeg(Math.atan2(z.y,z.x));v=(G>90?G-270:G+90)*(1-T)}return v+=this._rotation,v?`rotateZ(${v}deg)`:""}_update(a){o.window.cancelAnimationFrame(this._updateFrameId);const f=this._map;f&&(f.transform.renderWorldCopies&&(this._lngLat=B(this._lngLat,this._pos,f.transform)),this._pos=f.project(this._lngLat),a===!0?this._updateFrameId=o.window.requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),f._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(f._showingGlobe()||f.getTerrain()||f.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(a){return this._offset=o.Point.convert(a),this._update(),this}_onMove(a){const f=this._map;if(!f)return;const v=this._pointerdownPos,S=this._positionDelta;if(v&&S){if(!this._isDragging){const T=this._clickTolerance||f._clickTolerance;if(a.point.dist(v)<T)return;this._isDragging=!0}this._pos=a.point.sub(S),this._lngLat=f.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const a=this._map;a&&(a.off("mousemove",this._onMove),a.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(a){const f=this._map,v=this._pos;f&&v&&this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(v),this._pointerdownPos=a.point,this._state="pending",f.on("mousemove",this._onMove),f.on("touchmove",this._onMove),f.once("mouseup",this._onUp),f.once("touchend",this._onUp))}setDraggable(a){this._draggable=!!a;const f=this._map;return f&&(a?(f.on("mousedown",this._addDragHandler),f.on("touchstart",this._addDragHandler)):(f.off("mousedown",this._addDragHandler),f.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(a){return this._occludedOpacity=a||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Pe={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},qe=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function He(y=new o.Point(0,0),a="bottom"){if(typeof y=="number"){const f=Math.round(Math.sqrt(.5*Math.pow(y,2)));switch(a){case"top":return new o.Point(0,y);case"top-left":return new o.Point(f,f);case"top-right":return new o.Point(-f,f);case"bottom":return new o.Point(0,-y);case"bottom-left":return new o.Point(f,-f);case"bottom-right":return new o.Point(-f,-f);case"left":return new o.Point(y,0);case"right":return new o.Point(-y,0)}return new o.Point(0,0)}return y instanceof o.Point||Array.isArray(y)?o.Point.convert(y):o.Point.convert(y[a]||[0,0])}class Je{constructor(a){this.jumpTo(a)}getValue(a){if(a<=this._startTime)return this._start;if(a>=this._endTime)return this._end;const f=o.easeCubicInOut((a-this._startTime)/(this._endTime-this._startTime));return this._start*(1-f)+this._end*f}isEasing(a){return a>=this._startTime&&a<=this._endTime}jumpTo(a){this._startTime=-1/0,this._endTime=-1/0,this._start=a,this._end=a}easeTo(a,f,v){this._start=this.getValue(f),this._end=a,this._startTime=f,this._endTime=f+v}}const et={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},dt={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},Nt={showCompass:!0,showZoom:!0,visualizePitch:!1};class tn{constructor(a,f,v=!1){this._clickTolerance=10,this.element=f,this.mouseRotate=new El({clickTolerance:a.dragRotate._mouseRotate._clickTolerance}),this.map=a,v&&(this.mousePitch=new Al({clickTolerance:a.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),f.addEventListener("mousedown",this.mousedown),f.addEventListener("touchstart",this.touchstart,{passive:!1}),f.addEventListener("touchmove",this.touchmove),f.addEventListener("touchend",this.touchend),f.addEventListener("touchcancel",this.reset)}down(a,f){this.mouseRotate.mousedown(a,f),this.mousePitch&&this.mousePitch.mousedown(a,f),ne()}move(a,f){const v=this.map,S=this.mouseRotate.mousemoveWindow(a,f),T=S&&S.bearingDelta;if(T&&v.setBearing(v.getBearing()+T),this.mousePitch){const N=this.mousePitch.mousemoveWindow(a,f),z=N&&N.pitchDelta;z&&v.setPitch(v.getPitch()+z)}}off(){const a=this.element;a.removeEventListener("mousedown",this.mousedown),a.removeEventListener("touchstart",this.touchstart,{passive:!1}),a.removeEventListener("touchmove",this.touchmove),a.removeEventListener("touchend",this.touchend),a.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){me(),o.window.removeEventListener("mousemove",this.mousemove),o.window.removeEventListener("mouseup",this.mouseup)}mousedown(a){this.down(o.extend({},a,{ctrlKey:!0,preventDefault:()=>a.preventDefault()}),je(this.element,a)),o.window.addEventListener("mousemove",this.mousemove),o.window.addEventListener("mouseup",this.mouseup)}mousemove(a){this.move(a,je(this.element,a))}mouseup(a){this.mouseRotate.mouseupWindow(a),this.mousePitch&&this.mousePitch.mouseupWindow(a),this.offTemp()}touchstart(a){a.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=pe(this.element,a.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>a.preventDefault()},this._startPos))}touchmove(a){a.targetTouches.length!==1?this.reset():(this._lastPos=pe(this.element,a.targetTouches)[0],this.move({preventDefault:()=>a.preventDefault()},this._lastPos))}touchend(a){a.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const ct={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Ft={maxWidth:100,unit:"metric"},Qt={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},En={version:o.version,supported:I,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends sh{constructor(y){if(o.LivePerformanceUtils.mark(o.PerformanceMarkers.create),(y=o.extend({},dt,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(y.antialias&&o.isSafariWithAntialiasingBug(o.window)&&(y.antialias=!1,o.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new oc(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies),y),this._interactive=y.interactive,this._minTileCacheSize=y.minTileCacheSize,this._maxTileCacheSize=y.maxTileCacheSize,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._useWebGL2=y.useWebGL2,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=y.crossSourceCollisions,this._collectResourceTiming=y.collectResourceTiming,this._optimizeForTerrain=y.optimizeForTerrain,this._language=this._parseLanguage(y.language),this._worldview=y.worldview,this._renderTaskQueue=new C,this._domRenderTaskQueue=new C,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.uniqueId(),this._locale=o.extend({},et,y.locale),this._clickTolerance=y.clickTolerance,this._cooperativeGestures=y.cooperativeGestures,this._performanceMetricsCollection=y.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Je(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new o.RequestManager(y.transformRequest,y.accessToken,y.testMode),this._silenceAuthErrors=!!y.testMode,typeof y.container=="string"){if(this._container=o.window.document.getElementById(y.container),!this._container)throw new Error(`Container '${y.container}' not found.`)}else{if(!(y.container instanceof o.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(this._container.childNodes.length>0&&o.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),y.maxBounds&&this.setMaxBounds(y.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1),o.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new lc(this,y),this._localFontFamily=y.localFontFamily,this._localIdeographFontFamily=y.localIdeographFontFamily,y.style&&this.setStyle(y.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),y.projection&&this.setProjection(y.projection),this._hash=y.hash&&new jl(typeof y.hash=="string"&&y.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}),y.bounds&&(this.resize(),this.fitBounds(y.bounds,o.extend({},y.fitBoundsOptions,{duration:0})))),this.resize(),y.attributionControl&&this.addControl(new hr({customAttribution:y.customAttribution})),this._logoControl=new ah,this.addControl(this._logoControl,y.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(a=>{this._update(a.dataType==="style"),this.fire(new o.Event(`${a.dataType}data`,a))})),this.on("dataloading",(a=>{this.fire(new o.Event(`${a.dataType}dataloading`,a))}))}_getMapId(){return this._mapId}addControl(y,a){if(a===void 0&&(a=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=y.onAdd(this);this._controls.push(y);const v=this._controlPositions[a];return a.indexOf("bottom")!==-1?v.insertBefore(f,v.firstChild):v.appendChild(f),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(y);return a>-1&&this._controls.splice(a,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(y){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const a=!this._moving;return a&&this.fire(new o.Event("movestart",y)).fire(new o.Event("move",y)),this.fire(new o.Event("resize",y)),a&&this.fire(new o.Event("moveend",y)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(y){return this.transform.setMaxBounds(o.LngLatBounds.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y?this.setZoom(y):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y?this.setZoom(y):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y?this.setPitch(y):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y?this.setPitch(y):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(y){return y==="auto"?o.window.navigator.language:Array.isArray(y)?y.length===0?void 0:y.map((a=>a==="auto"?o.window.navigator.language:a)):y}setLanguage(y){const a=this._parseLanguage(y);if(!this.style||a===this._language)return this;this._language=a,this.style._reloadSources();for(const f of this._controls)f._setLanguage&&f._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(y){return this.style&&y!==this._worldview?(this._worldview=y,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(y){return this._lazyInitEmptyStyle(),y?typeof y=="string"&&(y={name:y}):y=null,this._useExplicitProjection=!!y,this._prioritizeAndUpdateProjection(y,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const y=this.transform,a=y.projection.name;let f;a==="globe"&&y.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?(y.setMercatorFromTransition(),f=!0):a==="mercator"&&y.zoom<o.GLOBE_ZOOM_THRESHOLD_MAX&&(y.setProjection({name:"globe"}),f=!0),f&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(y,a){return this._updateProjection(y||a||{name:"mercator"})}_updateProjection(y){let a;if(a=y.name==="globe"&&this.transform.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(y),this.style.applyProjectionUpdate(),a){this.painter.clearBackgroundTiles();for(const f in this.style._sourceCaches)this.style._sourceCaches[f].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(y){return this.transform.locationPoint3D(o.LngLat.convert(y))}unproject(y){return this.transform.pointLocation3D(o.Point.convert(y))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(y,a,f){if(y==="mouseenter"||y==="mouseover"){let v=!1;const S=N=>{const z=a.filter((ee=>this.getLayer(ee))),G=z.length?this.queryRenderedFeatures(N.point,{layers:z}):[];G.length?v||(v=!0,f.call(this,new Do(y,this,N.originalEvent,{features:G}))):v=!1},T=()=>{v=!1};return{layers:new Set(a),listener:f,delegates:{mousemove:S,mouseout:T}}}if(y==="mouseleave"||y==="mouseout"){let v=!1;const S=N=>{const z=a.filter((G=>this.getLayer(G)));(z.length?this.queryRenderedFeatures(N.point,{layers:z}):[]).length?v=!0:v&&(v=!1,f.call(this,new Do(y,this,N.originalEvent)))},T=N=>{v&&(v=!1,f.call(this,new Do(y,this,N.originalEvent)))};return{layers:new Set(a),listener:f,delegates:{mousemove:S,mouseout:T}}}{const v=S=>{const T=a.filter((z=>this.getLayer(z))),N=T.length?this.queryRenderedFeatures(S.point,{layers:T}):[];N.length&&(S.features=N,f.call(this,S),delete S.features)};return{layers:new Set(a),listener:f,delegates:{[y]:v}}}}on(y,a,f){if(f===void 0)return super.on(y,a);Array.isArray(a)||(a=[a]);const v=this._createDelegatedListener(y,a,f);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(v);for(const S in v.delegates)this.on(S,v.delegates[S]);return this}once(y,a,f){if(f===void 0)return super.once(y,a);Array.isArray(a)||(a=[a]);const v=this._createDelegatedListener(y,a,f);for(const S in v.delegates)this.once(S,v.delegates[S]);return this}off(y,a,f){if(f===void 0)return super.off(y,a);a=new Set(Array.isArray(a)?a:[a]);const v=(T,N)=>{if(T.size!==N.size)return!1;for(const z of T)if(!N.has(z))return!1;return!0},S=this._delegatedListeners?this._delegatedListeners[y]:void 0;return S&&(T=>{for(let N=0;N<T.length;N++){const z=T[N];if(z.listener===f&&v(z.layers,a)){for(const G in z.delegates)this.off(G,z.delegates[G]);return T.splice(N,1),this}}})(S),this}queryRenderedFeatures(y,a){return this.style?(a!==void 0||y===void 0||y instanceof o.Point||Array.isArray(y)||(a=y,y=void 0),this.style.queryRenderedFeatures(y=y||[[0,0],[this.transform.width,this.transform.height]],a=a||{},this.transform)):[]}querySourceFeatures(y,a){return this.style.querySourceFeatures(y,a)}isPointOnSurface(y){const{name:a}=this.transform.projection;return a!=="globe"&&a!=="mercator"&&o.warnOnce(`${a} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.Point.convert(y))}setStyle(y,a){return(a=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},a)).diff!==!1&&a.localIdeographFontFamily===this._localIdeographFontFamily&&a.localFontFamily===this._localFontFamily&&this.style&&y?(this._diffStyle(y,a),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._localFontFamily=a.localFontFamily,this._updateStyle(y,a))}_getUIString(y){const a=this._locale[y];if(a==null)throw new Error(`Missing UI string '${y}'`);return a}_updateStyle(y,a){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),y&&(this.style=new Ti(this,a||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y):this.style.loadJSON(y)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ti(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,a){if(typeof y=="string"){const f=this._requestManager.normalizeStyleURL(y),v=this._requestManager.transformRequest(f,o.ResourceType.Style);o.getJSON(v,((S,T)=>{S?this.fire(new o.ErrorEvent(S)):T&&this._updateDiff(T,a)}))}else typeof y=="object"&&this._updateDiff(y,a)}_updateDiff(y,a){try{this.style.setState(y)&&this._update(!0)}catch(f){o.warnOnce(`Unable to perform style diff: ${f.message||f.error||f}.  Rebuilding the style from scratch.`),this._updateStyle(y,a)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.warnOnce("There is no style added to the map."),!1)}addSource(y,a){return this._lazyInitEmptyStyle(),this.style.addSource(y,a),this._update(!0)}isSourceLoaded(y){return!!this.style&&this.style._isSourceCacheLoaded(y)}areTilesLoaded(){const y=this.style&&this.style._sourceCaches;for(const a in y){const f=y[a]._tiles;for(const v in f){const S=f[v];if(S.state!=="loaded"&&S.state!=="errored")return!1}}return!0}addSourceType(y,a,f){this._lazyInitEmptyStyle(),this.style.addSourceType(y,a,f)}removeSource(y){return this.style.removeSource(y),this._updateTerrain(),this._update(!0)}getSource(y){return this.style.getSource(y)}addImage(y,a,{pixelRatio:f=1,sdf:v=!1,stretchX:S,stretchY:T,content:N}={}){if(this._lazyInitEmptyStyle(),a instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&a instanceof o.window.ImageBitmap){const{width:z,height:G,data:ee}=o.exported.getImageData(a);this.style.addImage(y,{data:new o.RGBAImage({width:z,height:G},ee),pixelRatio:f,stretchX:S,stretchY:T,content:N,sdf:v,version:0})}else if(a.width===void 0||a.height===void 0)this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:z,height:G}=a,ee=a;this.style.addImage(y,{data:new o.RGBAImage({width:z,height:G},new Uint8Array(ee.data)),pixelRatio:f,stretchX:S,stretchY:T,content:N,sdf:v,version:0,userImage:ee}),ee.onAdd&&ee.onAdd(this,y)}}updateImage(y,a){const f=this.style.getImage(y);if(!f)return void this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const v=a instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&a instanceof o.window.ImageBitmap?o.exported.getImageData(a):a,{width:S,height:T}=v;S!==void 0&&T!==void 0?S===f.data.width&&T===f.data.height?(f.data.replace(v.data,!(a instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&a instanceof o.window.ImageBitmap)),this.style.updateImage(y,f)):this.fire(new o.ErrorEvent(new Error(`The width and height of the updated image (${S}, ${T})
                must be that same as the previous version of the image
                (${f.data.width}, ${f.data.height})`))):this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y,a){o.getImage(this._requestManager.transformRequest(y,o.ResourceType.Image),((f,v)=>{a(f,v instanceof o.window.HTMLImageElement?o.exported.getImageData(v):v)}))}listImages(){return this.style.listImages()}addLayer(y,a){return this._lazyInitEmptyStyle(),this.style.addLayer(y,a),this._update(!0)}moveLayer(y,a){return this.style.moveLayer(y,a),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}setLayerZoomRange(y,a,f){return this.style.setLayerZoomRange(y,a,f),this._update(!0)}setFilter(y,a,f={}){return this.style.setFilter(y,a,f),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,a,f,v={}){return this.style.setPaintProperty(y,a,f,v),this._update(!0)}getPaintProperty(y,a){return this.style.getPaintProperty(y,a)}setLayoutProperty(y,a,f,v={}){return this.style.setLayoutProperty(y,a,f,v),this._update(!0)}getLayoutProperty(y,a){return this.style.getLayoutProperty(y,a)}setLight(y,a={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,a),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(y){return this._lazyInitEmptyStyle(),!y&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(y),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(y){return this._lazyInitEmptyStyle(),this.style.setFog(y),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(y){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.LngLat.convert(y),this.transform):0}setFeatureState(y,a){return this.style.setFeatureState(y,a),this._update()}removeFeatureState(y,a){return this.style.removeFeatureState(y,a),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}_updateContainerDimensions(){if(!this._container)return;const y=this._container.getBoundingClientRect().width||400,a=this._container.getBoundingClientRect().height||300;let f,v,S,T=this._container;for(;T&&(!v||!S);){const N=o.window.getComputedStyle(T).transform;N&&N!=="none"&&(f=N.match(/matrix.*\((.+)\)/)[1].split(", "),f[0]&&f[0]!=="0"&&f[0]!=="1"&&(v=f[0]),f[3]&&f[3]!=="0"&&f[3]!=="1"&&(S=f[3])),T=T.parentElement}this._containerWidth=v?Math.abs(y/v):y,this._containerHeight=S?Math.abs(a/S):a}_detectMissingCSS(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const y=this._container;y.classList.add("mapboxgl-map"),(this._missingCSSCanary=k("div","mapboxgl-canary",y)).style.visibility="hidden",this._detectMissingCSS();const a=this._canvasContainer=k("div","mapboxgl-canvas-container",y);this._interactive&&a.classList.add("mapboxgl-interactive"),this._canvas=k("canvas","mapboxgl-canvas",a),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const f=this._controlContainer=k("div","mapboxgl-control-container",y),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((S=>{v[S]=k("div",`mapboxgl-ctrl-${S}`,f)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,a){const f=o.exported.devicePixelRatio||1;this._canvas.width=f*Math.ceil(y),this._canvas.height=f*Math.ceil(a),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${a}px`}_addMarker(y){this._markers.push(y)}_removeMarker(y){const a=this._markers.indexOf(y);a!==-1&&this._markers.splice(a,1)}_addPopup(y){this._popups.push(y)}_removePopup(y){const a=this._popups.indexOf(y);a!==-1&&this._popups.splice(a,1)}_setupPainter(){const y=o.extend({},I.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),a=this._useWebGL2&&this._canvas.getContext("webgl2",y),f=a||this._canvas.getContext("webgl",y)||this._canvas.getContext("experimental-webgl",y);f?(this._useWebGL2&&!a&&o.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),o.storeAuthState(f,!0),this.painter=new bl(f,this.transform,!!a),this.on("data",(v=>{v.dataType==="source"&&this.painter.setTileLoadedFlag(!0)})),o.exported$1.testSupport(f)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(y){y.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:y}))}_contextRestored(y){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:y}))}_onMapScroll(y){if(y.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_requestDomTask(y){!this.loaded()||this.loaded()&&!this.isMoving()?y():this._domRenderTaskQueue.add(y)}_render(y){let a;const f=this.painter.context.extTimerQuery,v=o.exported.now();if(this.listens("gpu-timing-frame")&&(a=f.createQueryEXT(),f.beginQueryEXT(f.TIME_ELAPSED_EXT,a)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],o.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],o.window.performance.now())),this._renderTaskQueue.run(y),this._domRenderTaskQueue.run(y),this._removed)return;this._updateProjectionTransition();const S=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const z=this.transform.zoom,G=this.transform.pitch,ee=o.exported.now(),te=new o.EvaluationParameters(z,{now:ee,fadeDuration:S,pitch:G,transition:this.style.getTransition()});this.style.update(te)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(v),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):T=this._updateAverageElevation(v),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,S,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:S,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),a){const z=o.exported.now()-v;f.endQueryEXT(f.TIME_ELAPSED_EXT,a),setTimeout((()=>{const G=f.getQueryObjectEXT(a,f.QUERY_RESULT_EXT)/1e6;f.deleteQueryEXT(a),this.fire(new o.Event("gpu-timing-frame",{cpuTime:z,gpuTime:G})),o.window.performance.mark("frame-gpu",{startTime:v,detail:{gpuTime:G}})}),50)}if(this.listens("gpu-timing-layer")){const z=this.painter.collectGpuTimers();setTimeout((()=>{const G=this.painter.queryGpuTimers(z);this.fire(new o.Event("gpu-timing-layer",{layerTimes:G}))}),50)}if(this.listens("gpu-timing-deferred-render")){const z=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const G=this.painter.queryGpuTimeDeferredRender(z);this.fire(new o.Event("gpu-timing-deferred-render",{gpuTime:G}))}),50)}const N=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(N||this._repaint)this.triggerRepaint();else{const z=!this.isMoving()&&this.loaded();if(z&&(T=this._updateAverageElevation(v,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),z&&(this.fire(new o.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const G=this._calculateSpeedIndex();this.fire(new o.Event("speedindexcompleted",{speedIndex:G})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||N||(this._fullyLoaded=!0,o.LivePerformanceUtils.mark(o.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&o.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(y){for(const a of this._markers)y&&!this.getRenderWorldCopies()&&(a._lngLat=a._lngLat.wrap()),a._update();for(const a of this._popups)!y||this.getRenderWorldCopies()||a._trackPointer||(a._lngLat=a._lngLat.wrap()),a._update()}_updateAverageElevation(y,a=!1){const f=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&f(0);if((a||y-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(y)){const v=this.transform.averageElevation;let S=this.transform.sampleAverageElevation(),T=!1;this.transform.elevation&&(T=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(S)?S=0:this._averageElevationLastSampledAt=y;const N=Math.abs(v-S);if(N>1){if(this._isInitialLoad||T)return this._averageElevation.jumpTo(S),f(S);this._averageElevation.easeTo(S,y,300)}else if(N>1e-4)return this._averageElevation.jumpTo(S),f(S)}return!!this._averageElevation.isEasing(y)&&f(this._averageElevation.getValue(y))}_authenticate(){o.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(y=>{if(y&&(y.message===o.AUTH_ERR_MSG||y.status===401)){const a=this.painter.context.gl;o.storeAuthState(a,!1),this._logoControl instanceof ah&&this._logoControl._updateLogo(),a&&a.clear(a.DEPTH_BUFFER_BIT|a.COLOR_BUFFER_BIT|a.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),o.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_updateTerrain(){const y=this._isDragging();this.painter.updateTerrain(this.style,y)}_calculateSpeedIndex(){const y=this.painter.canvasCopy(),a=this.painter.getCanvasCopiesAndTimestamps();a.timeStamps.push(performance.now());const f=this.painter.context.gl,v=f.createFramebuffer();function S(T){f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,T,0);const N=new Uint8Array(f.drawingBufferWidth*f.drawingBufferHeight*4);return f.readPixels(0,0,f.drawingBufferWidth,f.drawingBufferHeight,f.RGBA,f.UNSIGNED_BYTE,N),N}return f.bindFramebuffer(f.FRAMEBUFFER,v),this._canvasPixelComparison(S(y),a.canvasCopies.map(S),a.timeStamps)}_canvasPixelComparison(y,a,f){let v=f[1]-f[0];const S=y.length/4;for(let T=0;T<a.length;T++){const N=a[T];let z=0;for(let G=0;G<N.length;G+=4)N[G]===y[G]&&N[G+1]===y[G+1]&&N[G+2]===y[G+2]&&N[G+3]===y[G+3]&&(z+=1);v+=(f[T+2]-f[T+1])*(1-z/S)}return v}remove(){this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1),o.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const y=this.painter.context.gl.getExtension("WEBGL_lose_context");y&&y.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),o.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(y){this._renderNextFrame=this._renderNextFrame||y,this.style&&!this._frame&&(this._frame=o.exported.frame((a=>{const f=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,f&&this._render(a)})))}_preloadTiles(y){const a=this.style?Object.values(this.style._sourceCaches):[];return o.asyncAll(a,((f,v)=>f._preloadTiles(y,v)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(y){this._trackResize&&this.resize({originalEvent:y})._update()}_onVisibilityChange(){o.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(y){this._showTerrainWireframe!==y&&(this._showTerrainWireframe=y,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(y){this._speedIndexTiming!==y&&(this._speedIndexTiming=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(y){this._showTileAABBs!==y&&(this._showTileAABBs=y,y&&this._update())}_setCacheLimits(y,a){o.setCacheLimits(y,a)}get version(){return o.version}},NavigationControl:class{constructor(y){this.options=o.extend({},Nt,y),this._container=k("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(a=>a.preventDefault())),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(a=>{this._map&&this._map.zoomIn({},{originalEvent:a})})),k("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(a=>{this._map&&this._map.zoomOut({},{originalEvent:a})})),k("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(a=>{const f=this._map;f&&(this.options.visualizePitch?f.resetNorthPitch({},{originalEvent:a}):f.resetNorth({},{originalEvent:a}))})),this._compassIcon=k("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const y=this._map;if(!y)return;const a=y.getZoom(),f=a===y.getMaxZoom(),v=a===y.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=v,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",v.toString())}_rotateCompassArrow(){const y=this._map;if(!y)return;const a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(y.transform.pitch*(Math.PI/180)),.5)}) rotateX(${y.transform.pitch}deg) rotateZ(${y.transform.angle*(180/Math.PI)}deg)`:`rotate(${y.transform.angle*(180/Math.PI)}deg)`;y._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=a)}))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),y.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&y.on("pitch",this._rotateCompassArrow),y.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new tn(y,this._compass,this.options.visualizePitch)),this._container}onRemove(){const y=this._map;y&&(this._container.remove(),this.options.showZoom&&y.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&y.off("pitch",this._rotateCompassArrow),y.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(y,a){const f=k("button",y,this._container);return f.type="button",f.addEventListener("click",a),f}_setButtonTitle(y,a){if(!this._map)return;const f=this._map._getUIString(`NavigationControl.${a}`);y.setAttribute("aria-label",f),y.firstElementChild&&y.firstElementChild.setAttribute("title",f)}},GeolocateControl:class extends o.Evented{constructor(y){super(),this.options=o.extend({geolocation:o.window.navigator.geolocation},ct,y),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=qn(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(y){return this._map=y,this._container=k("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(y){const a=(f=!!this.options.geolocation)=>{this._supportsGeolocation=f,y(f)};this._supportsGeolocation!==void 0?y(this._supportsGeolocation):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then((f=>a(f.state!=="denied"))).catch((()=>a())):a()}_isOutOfMapMaxBounds(y){const a=this._map.getMaxBounds(),f=y.coords;return!!a&&(f.longitude<a.getWest()||f.longitude>a.getEast()||f.latitude<a.getSouth()||f.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(y){if(this._map){if(this._isOutOfMapMaxBounds(y))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",y)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=y,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(y),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(y),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",y)),this._finish()}}_updateCamera(y){const a=new o.LngLat(y.coords.longitude,y.coords.latitude),f=y.coords.accuracy,v=this._map.getBearing(),S=o.extend({bearing:v},this.options.fitBoundsOptions);this._map.fitBounds(a.toBounds(f),S,{geolocateSource:!0})}_updateMarker(y){if(y){const a=new o.LngLat(y.coords.longitude,y.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=y.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const y=this._map.transform,a=o.mercatorZfromAltitude(1,y._center.lat)*y.worldSize,f=Math.ceil(2*this._accuracy*a);this._circleElement.style.width=`${f}px`,this._circleElement.style.height=`${f}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(y){if(this._map){if(this.options.trackUserLocation)if(y.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(y.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",y)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(y){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",(a=>a.preventDefault())),this._geolocateButton=k("button","mapboxgl-ctrl-geolocate",this._container),k("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",y===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=k("div","mapboxgl-user-location"),this._dotElement.appendChild(k("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(k("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new oe({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=k("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new oe({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(a=>{a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a.originalEvent&&a.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))}))}}_onDeviceOrientation(y){this._userLocationDotMarker&&(y.webkitCompassHeading?this._heading=y.webkitCompassHeading:y.absolute===!0&&(this._heading=-1*y.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(y={maximumAge:6e5,timeout:0},this._noTimeout=!0):(y=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,y),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const y=()=>{o.window.addEventListener("ondeviceorientationabsolute"in o.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};o.window.DeviceMotionEvent!==void 0&&typeof o.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then((a=>{a==="granted"&&y()})).catch(console.error):y()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),o.window.removeEventListener("deviceorientation",this._onDeviceOrientation),o.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:hr,ScaleControl:class{constructor(y){this.options=o.extend({},Ft,y),this._isNumberFormatSupported=(function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}})(),o.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const y=this.options.maxWidth||100,a=this._map,f=a._containerHeight/2,v=a._containerWidth/2-y/2,S=a.unproject([v,f]),T=a.unproject([v+y,f]),N=S.distanceTo(T);if(this.options.unit==="imperial"){const z=3.2808*N;z>5280?this._setScale(y,z/5280,"mile"):this._setScale(y,z,"foot")}else this.options.unit==="nautical"?this._setScale(y,N/1852,"nautical-mile"):N>=1e3?this._setScale(y,N/1e3,"kilometer"):this._setScale(y,N,"meter")}_setScale(y,a,f){this._map._requestDomTask((()=>{const v=(function(T){const N=Math.pow(10,`${Math.floor(T)}`.length-1);let z=T/N;return z=z>=10?10:z>=5?5:z>=3?3:z>=2?2:z>=1?1:(function(G){const ee=Math.pow(10,Math.ceil(-Math.log(G)/Math.LN10));return Math.round(G*ee)/ee})(z),N*z})(a),S=v/a;this._container.innerHTML=this._isNumberFormatSupported&&f!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:f}).format(v):`${v}&nbsp;${Qt[f]}`,this._container.style.width=y*S+"px"}))}onAdd(y){return this._map=y,this._language=y.getLanguage(),this._container=k("div","mapboxgl-ctrl mapboxgl-ctrl-scale",y.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(y){this._language=y,this._update()}setUnit(y){this.options.unit=y,this._update()}},FullscreenControl:class{constructor(y){this._fullscreen=!1,y&&y.container&&(y.container instanceof o.window.HTMLElement?this._container=y.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in o.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=k("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!o.window.document.fullscreenEnabled&&!o.window.document.webkitFullscreenEnabled)}_setupUI(){const y=this._fullscreenButton=k("button","mapboxgl-ctrl-fullscreen",this._controlContainer);k("span","mapboxgl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",y)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(o.window.document.fullscreenElement||o.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.Evented{constructor(y){super(),this.options=o.extend(Object.create(Pe),y),o.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(y&&y.className?y.className.trim().split(/\s+/):[])}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&y.on("preclick",this._onClose),this.options.closeOnMove&&y.on("move",this._onClose),y.on("remove",this.remove),this._update(),y._addPopup(this),this._focusFirstElement(),this._trackPointer?(y.on("mousemove",this._onMouseEvent),y.on("mouseup",this._onMouseEvent),y._canvasContainer.classList.add("mapboxgl-track-pointer")):y.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const y=this._map;return y&&(y.off("move",this._update),y.off("move",this._onClose),y.off("preclick",this._onClose),y.off("click",this._onClose),y.off("remove",this.remove),y.off("mousemove",this._onMouseEvent),y.off("mouseup",this._onMouseEvent),y.off("drag",this._onMouseEvent),y._canvasContainer&&y._canvasContainer.classList.remove("mapboxgl-track-pointer"),y._removePopup(this),this._map=void 0),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(y){this._lngLat=o.LngLat.convert(y),this._pos=null,this._trackPointer=!1,this._update();const a=this._map;return a&&(a.on("move",this._update),a.off("mousemove",this._onMouseEvent),a._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const y=this._map;return y&&(y.off("move",this._update),y.on("mousemove",this._onMouseEvent),y.on("drag",this._onMouseEvent),y._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(o.window.document.createTextNode(y))}setHTML(y){const a=o.window.document.createDocumentFragment(),f=o.window.document.createElement("body");let v;for(f.innerHTML=y;v=f.firstChild,v;)a.appendChild(v);return this.setDOMContent(a)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){let a=this._content;if(a)for(;a.hasChildNodes();)a.firstChild&&a.removeChild(a.firstChild);else a=this._content=k("div","mapboxgl-popup-content",this._container||void 0);if(a.appendChild(y),this.options.closeButton){const f=this._closeButton=k("button","mapboxgl-popup-close-button",a);f.type="button",f.setAttribute("aria-label","Close popup"),f.setAttribute("aria-hidden","true"),f.innerHTML="&#215;",f.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(y){return this._classList.add(y),this._updateClassList(),this}removeClassName(y){return this._classList.delete(y),this._updateClassList(),this}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){let a;return this._classList.delete(y)?a=!1:(this._classList.add(y),a=!0),this._updateClassList(),a}_onMouseEvent(y){this._update(y.point)}_getAnchor(y){if(this.options.anchor)return this.options.anchor;const a=this._map,f=this._container,v=this._pos;if(!a||!f||!v)return"bottom";const S=f.offsetWidth,T=f.offsetHeight,N=v.x<S/2,z=v.x>a.transform.width-S/2;if(v.y+y<T)return N?"top-left":z?"top-right":"top";if(v.y>a.transform.height-T){if(N)return"bottom-left";if(z)return"bottom-right"}return N?"left":z?"right":"bottom"}_updateClassList(){const y=this._container;if(!y)return;const a=[...this._classList];a.push("mapboxgl-popup"),this._anchor&&a.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&a.push("mapboxgl-popup-track-pointer"),y.className=a.join(" ")}_update(y){const a=this._map,f=this._content;if(!a||!this._lngLat&&!this._trackPointer||!f)return;let v=this._container;if(v||(v=this._container=k("div","mapboxgl-popup",a.getContainer()),this._tip=k("div","mapboxgl-popup-tip",v),v.appendChild(f)),this.options.maxWidth&&v.style.maxWidth!==this.options.maxWidth&&(v.style.maxWidth=this.options.maxWidth),a.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=B(this._lngLat,this._pos,a.transform)),!this._trackPointer||y){const S=this._pos=this._trackPointer&&y?y:a.project(this._lngLat),T=He(this.options.offset),N=this._anchor=this._getAnchor(T.y),z=He(this.options.offset,N),G=S.add(z).round();a._requestDomTask((()=>{this._container&&N&&(this._container.style.transform=`${Q[N]} translate(${G.x}px,${G.y}px)`)}))}if(!this._marker&&a._showingGlobe()){const S=o.isLngLatBehindGlobe(a.transform,this._lngLat)?0:1;this._setOpacity(S)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(qe);y&&y.focus()}_onClose(){this.remove()}_setOpacity(y){this._container&&(this._container.style.opacity=`${y}`),this._content&&(this._content.style.pointerEvents=y?"auto":"none")}},Marker:oe,Style:Ti,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.Point,MercatorCoordinate:o.MercatorCoordinate,FreeCameraOptions:Ac,Evented:o.Evented,config:o.config,prewarm:function(){ga().acquire(ys)},clearPrewarmedResources:function(){const y=Is;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(ys),Is=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(y){o.config.ACCESS_TOKEN=y},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(y){o.config.API_URL=y},get workerCount(){return io.workerCount},set workerCount(y){io.workerCount=y},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(y){o.config.MAX_PARALLEL_IMAGE_REQUESTS=y},clearStorage(y){o.clearTileCache(y)},workerUrl:"",workerClass:null,setNow:o.exported.setNow,restoreNow:o.exported.restoreNow};return En}));var _=u;return _}))})(z1)),z1.exports}var D7=N7();const kd=Zv(D7),F7="modulepreload",O7=function(n){return"/StakeholderMap/"+n},M2={},fb=function(e,t,i){let c=Promise.resolve();if(t&&t.length>0){let o=function(b){return Promise.all(b.map(I=>Promise.resolve(I).then(M=>({status:"fulfilled",value:M}),M=>({status:"rejected",reason:M}))))};document.getElementsByTagName("link");const m=document.querySelector("meta[property=csp-nonce]"),_=m?.nonce||m?.getAttribute("nonce");c=o(t.map(b=>{if(b=O7(b),b in M2)return;M2[b]=!0;const I=b.endsWith(".css"),M=I?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${b}"]${M}`))return;const V=document.createElement("link");if(V.rel=I?"stylesheet":F7,I||(V.as="script"),V.crossOrigin="",V.href=b,_&&V.setAttribute("nonce",_),document.head.appendChild(V),I)return new Promise((k,ie)=>{V.addEventListener("load",k),V.addEventListener("error",()=>ie(new Error(`Unable to preload CSS for ${b}`)))})}))}function u(m){const _=new Event("vite:preloadError",{cancelable:!0});if(_.payload=m,window.dispatchEvent(_),!_.defaultPrevented)throw m}return c.then(m=>{for(const _ of m||[])_.status==="rejected"&&u(_.reason);return e().catch(u)})};function wa(n){"@babel/helpers - typeof";return wa=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wa(n)}var of=Uint8Array,yd=Uint16Array,xw=Int32Array,bw=new of([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ww=new of([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),N2=new of([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),a6=function(n,e){for(var t=new yd(31),i=0;i<31;++i)t[i]=e+=1<<n[i-1];for(var c=new xw(t[30]),i=1;i<30;++i)for(var u=t[i];u<t[i+1];++u)c[u]=u-t[i]<<5|i;return{b:t,r:c}},l6=a6(bw,2),B7=l6.b,g5=l6.r;B7[28]=258,g5[258]=28;var z7=a6(ww,0),D2=z7.r,y5=new yd(32768);for(var ml=0;ml<32768;++ml){var Hp=(ml&43690)>>1|(ml&21845)<<1;Hp=(Hp&52428)>>2|(Hp&13107)<<2,Hp=(Hp&61680)>>4|(Hp&3855)<<4,y5[ml]=((Hp&65280)>>8|(Hp&255)<<8)>>1}var Vy=(function(n,e,t){for(var i=n.length,c=0,u=new yd(e);c<i;++c)n[c]&&++u[n[c]-1];var m=new yd(e);for(c=1;c<e;++c)m[c]=m[c-1]+u[c-1]<<1;var _;if(t){_=new yd(1<<e);var o=15-e;for(c=0;c<i;++c)if(n[c])for(var b=c<<4|n[c],I=e-n[c],M=m[n[c]-1]++<<I,V=M|(1<<I)-1;M<=V;++M)_[y5[M]>>o]=b}else for(_=new yd(i),c=0;c<i;++c)n[c]&&(_[c]=y5[m[n[c]-1]++]>>15-n[c]);return _}),tg=new of(288);for(var ml=0;ml<144;++ml)tg[ml]=8;for(var ml=144;ml<256;++ml)tg[ml]=9;for(var ml=256;ml<280;++ml)tg[ml]=7;for(var ml=280;ml<288;++ml)tg[ml]=8;var fv=new of(32);for(var ml=0;ml<32;++ml)fv[ml]=5;var j7=Vy(tg,9,0),U7=Vy(fv,5,0),c6=function(n){return(n+7)/8|0},V7=function(n,e,t){return(t==null||t>n.length)&&(t=n.length),new of(n.subarray(e,t))},hp=function(n,e,t){t<<=e&7;var i=e/8|0;n[i]|=t,n[i+1]|=t>>8},wy=function(n,e,t){t<<=e&7;var i=e/8|0;n[i]|=t,n[i+1]|=t>>8,n[i+2]|=t>>16},pb=function(n,e){for(var t=[],i=0;i<n.length;++i)n[i]&&t.push({s:i,f:n[i]});var c=t.length,u=t.slice();if(!c)return{t:h6,l:0};if(c==1){var m=new of(t[0].s+1);return m[t[0].s]=1,{t:m,l:1}}t.sort(function(ke,je){return ke.f-je.f}),t.push({s:-1,f:25001});var _=t[0],o=t[1],b=0,I=1,M=2;for(t[0]={s:-1,f:_.f+o.f,l:_,r:o};I!=c-1;)_=t[t[b].f<t[M].f?b++:M++],o=t[b!=I&&t[b].f<t[M].f?b++:M++],t[I++]={s:-1,f:_.f+o.f,l:_,r:o};for(var V=u[0].s,i=1;i<c;++i)u[i].s>V&&(V=u[i].s);var k=new yd(V+1),ie=_5(t[I-1],k,0);if(ie>e){var i=0,se=0,fe=ie-e,J=1<<fe;for(u.sort(function(je,pe){return k[pe.s]-k[je.s]||je.f-pe.f});i<c;++i){var ne=u[i].s;if(k[ne]>e)se+=J-(1<<ie-k[ne]),k[ne]=e;else break}for(se>>=fe;se>0;){var me=u[i].s;k[me]<e?se-=1<<e-k[me]++-1:++i}for(;i>=0&&se;--i){var ue=u[i].s;k[ue]==e&&(--k[ue],++se)}ie=e}return{t:new of(k),l:ie}},_5=function(n,e,t){return n.s==-1?Math.max(_5(n.l,e,t+1),_5(n.r,e,t+1)):e[n.s]=t},F2=function(n){for(var e=n.length;e&&!n[--e];);for(var t=new yd(++e),i=0,c=n[0],u=1,m=function(o){t[i++]=o},_=1;_<=e;++_)if(n[_]==c&&_!=e)++u;else{if(!c&&u>2){for(;u>138;u-=138)m(32754);u>2&&(m(u>10?u-11<<5|28690:u-3<<5|12305),u=0)}else if(u>3){for(m(c),--u;u>6;u-=6)m(8304);u>2&&(m(u-3<<5|8208),u=0)}for(;u--;)m(c);u=1,c=n[_]}return{c:t.subarray(0,i),n:e}},Sy=function(n,e){for(var t=0,i=0;i<e.length;++i)t+=n[i]*e[i];return t},u6=function(n,e,t){var i=t.length,c=c6(e+2);n[c]=i&255,n[c+1]=i>>8,n[c+2]=n[c]^255,n[c+3]=n[c+1]^255;for(var u=0;u<i;++u)n[c+u+4]=t[u];return(c+4+i)*8},O2=function(n,e,t,i,c,u,m,_,o,b,I){hp(e,I++,t),++c[256];for(var M=pb(c,15),V=M.t,k=M.l,ie=pb(u,15),se=ie.t,fe=ie.l,J=F2(V),ne=J.c,me=J.n,ue=F2(se),ke=ue.c,je=ue.n,pe=new yd(19),U=0;U<ne.length;++U)++pe[ne[U]&31];for(var U=0;U<ke.length;++U)++pe[ke[U]&31];for(var F=pb(pe,7),q=F.t,j=F.l,H=19;H>4&&!q[N2[H-1]];--H);var Z=b+5<<3,be=Sy(c,tg)+Sy(u,fv)+m,Re=Sy(c,V)+Sy(u,se)+m+14+3*H+Sy(pe,q)+2*pe[16]+3*pe[17]+7*pe[18];if(o>=0&&Z<=be&&Z<=Re)return u6(e,I,n.subarray(o,o+b));var Oe,Ne,we,Fe;if(hp(e,I,1+(Re<be)),I+=2,Re<be){Oe=Vy(V,k,0),Ne=V,we=Vy(se,fe,0),Fe=se;var nt=Vy(q,j,0);hp(e,I,me-257),hp(e,I+5,je-1),hp(e,I+10,H-4),I+=14;for(var U=0;U<H;++U)hp(e,I+3*U,q[N2[U]]);I+=3*H;for(var xe=[ne,ke],le=0;le<2;++le)for(var De=xe[le],U=0;U<De.length;++U){var Be=De[U]&31;hp(e,I,nt[Be]),I+=q[Be],Be>15&&(hp(e,I,De[U]>>5&127),I+=De[U]>>12)}}else Oe=j7,Ne=tg,we=U7,Fe=fv;for(var U=0;U<_;++U){var Ye=i[U];if(Ye>255){var Be=Ye>>18&31;wy(e,I,Oe[Be+257]),I+=Ne[Be+257],Be>7&&(hp(e,I,Ye>>23&31),I+=bw[Be]);var rt=Ye&31;wy(e,I,we[rt]),I+=Fe[rt],rt>3&&(wy(e,I,Ye>>5&8191),I+=ww[rt])}else wy(e,I,Oe[Ye]),I+=Ne[Ye]}return wy(e,I,Oe[256]),I+Ne[256]},q7=new xw([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),h6=new of(0),$7=function(n,e,t,i,c,u){var m=u.z||n.length,_=new of(i+m+5*(1+Math.ceil(m/7e3))+c),o=_.subarray(i,_.length-c),b=u.l,I=(u.r||0)&7;if(e){I&&(o[0]=u.r>>3);for(var M=q7[e-1],V=M>>13,k=M&8191,ie=(1<<t)-1,se=u.p||new yd(32768),fe=u.h||new yd(ie+1),J=Math.ceil(t/3),ne=2*J,me=function(Gt){return(n[Gt]^n[Gt+1]<<J^n[Gt+2]<<ne)&ie},ue=new xw(25e3),ke=new yd(288),je=new yd(32),pe=0,U=0,F=u.i||0,q=0,j=u.w||0,H=0;F+2<m;++F){var Z=me(F),be=F&32767,Re=fe[Z];if(se[be]=Re,fe[Z]=be,j<=F){var Oe=m-F;if((pe>7e3||q>24576)&&(Oe>423||!b)){I=O2(n,o,0,ue,ke,je,U,q,H,F-H,I),q=pe=U=0,H=F;for(var Ne=0;Ne<286;++Ne)ke[Ne]=0;for(var Ne=0;Ne<30;++Ne)je[Ne]=0}var we=2,Fe=0,nt=k,xe=be-Re&32767;if(Oe>2&&Z==me(F-xe))for(var le=Math.min(V,Oe)-1,De=Math.min(32767,F),Be=Math.min(258,Oe);xe<=De&&--nt&&be!=Re;){if(n[F+we]==n[F+we-xe]){for(var Ye=0;Ye<Be&&n[F+Ye]==n[F+Ye-xe];++Ye);if(Ye>we){if(we=Ye,Fe=xe,Ye>le)break;for(var rt=Math.min(xe,Ye-2),mt=0,Ne=0;Ne<rt;++Ne){var ft=F-xe+Ne&32767,Dt=se[ft],Yt=ft-Dt&32767;Yt>mt&&(mt=Yt,Re=ft)}}}be=Re,Re=se[be],xe+=be-Re&32767}if(Fe){ue[q++]=268435456|g5[we]<<18|D2[Fe];var cn=g5[we]&31,gn=D2[Fe]&31;U+=bw[cn]+ww[gn],++ke[257+cn],++je[gn],j=F+we,++pe}else ue[q++]=n[F],++ke[n[F]]}}for(F=Math.max(F,j);F<m;++F)ue[q++]=n[F],++ke[n[F]];I=O2(n,o,b,ue,ke,je,U,q,H,F-H,I),b||(u.r=I&7|o[I/8|0]<<3,I-=7,u.h=fe,u.p=se,u.i=F,u.w=j)}else{for(var F=u.w||0;F<m+b;F+=65535){var Mn=F+65535;Mn>=m&&(o[I/8|0]=b,Mn=m),I=u6(o,I+1,n.subarray(F,Mn))}u.i=m}return V7(_,0,i+c6(I)+c)},d6=function(){var n=1,e=0;return{p:function(t){for(var i=n,c=e,u=t.length|0,m=0;m!=u;){for(var _=Math.min(m+2655,u);m<_;++m)c+=i+=t[m];i=(i&65535)+15*(i>>16),c=(c&65535)+15*(c>>16)}n=i,e=c},d:function(){return n%=65521,e%=65521,(n&255)<<24|(n&65280)<<8|(e&255)<<8|e>>8}}},G7=function(n,e,t,i,c){if(!c&&(c={l:1},e.dictionary)){var u=e.dictionary.subarray(-32768),m=new of(u.length+n.length);m.set(u),m.set(n,u.length),n=m,c.w=u.length}return $7(n,e.level==null?6:e.level,e.mem==null?c.l?Math.ceil(Math.max(8,Math.min(13,Math.log(n.length)))*1.5):20:12+e.mem,t,i,c)},f6=function(n,e,t){for(;t;++e)n[e]=t,t>>>=8},H7=function(n,e){var t=e.level,i=t==0?0:t<6?1:t==9?3:2;if(n[0]=120,n[1]=i<<6|(e.dictionary&&32),n[1]|=31-(n[0]<<8|n[1])%31,e.dictionary){var c=d6();c.p(e.dictionary),f6(n,2,c.d())}};function v5(n,e){e||(e={});var t=d6();t.p(n);var i=G7(n,e,e.dictionary?6:2,4);return H7(i,e),f6(i,i.length-4,t.d()),i}var W7=typeof TextDecoder<"u"&&new TextDecoder,K7=0;try{W7.decode(h6,{stream:!0}),K7=1}catch{}function X7(n){if(Array.isArray(n))return n}function Z7(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var i,c,u,m,_=[],o=!0,b=!1;try{if(u=(t=t.call(n)).next,e!==0)for(;!(o=(i=u.call(t)).done)&&(_.push(i.value),_.length!==e);o=!0);}catch(I){b=!0,c=I}finally{try{if(!o&&t.return!=null&&(m=t.return(),Object(m)!==m))return}finally{if(b)throw c}}return _}}function B2(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=Array(e);t<e;t++)i[t]=n[t];return i}function Y7(n,e){if(n){if(typeof n=="string")return B2(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?B2(n,e):void 0}}function J7(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function z2(n,e){return X7(n)||Z7(n,e)||Y7(n,e)||J7()}function j2(n,e="utf8"){return new TextDecoder(e).decode(n)}const Q7=new TextEncoder;function ek(n){return Q7.encode(n)}const tk=1024*8,nk=(()=>{const n=new Uint8Array(4),e=new Uint32Array(n.buffer);return!((e[0]=1)&n[0])})(),mb={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class Sw{buffer;byteLength;byteOffset;length;offset;lastWrittenByte;littleEndian;_data;_mark;_marks;constructor(e=tk,t={}){let i=!1;typeof e=="number"?e=new ArrayBuffer(e):(i=!0,this.lastWrittenByte=e.byteLength);const c=t.offset?t.offset>>>0:0,u=e.byteLength-c;let m=c;(ArrayBuffer.isView(e)||e instanceof Sw)&&(e.byteLength!==e.buffer.byteLength&&(m=e.byteOffset+c),e=e.buffer),i?this.lastWrittenByte=u:this.lastWrittenByte=0,this.buffer=e,this.length=u,this.byteLength=u,this.byteOffset=m,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,m,u),this._mark=0,this._marks=[]}available(e=1){return this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e=1){return this.offset+=e,this}back(e=1){return this.offset-=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(e===void 0)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e=1){if(!this.available(e)){const i=(this.offset+e)*2,c=new Uint8Array(i);c.set(new Uint8Array(this.buffer)),this.buffer=c.buffer,this.length=i,this.byteLength=i,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e=1){return this.readArray(e,"uint8")}readArray(e,t){const i=mb[t].BYTES_PER_ELEMENT*e,c=this.byteOffset+this.offset,u=this.buffer.slice(c,c+i);if(this.littleEndian===nk&&t!=="uint8"&&t!=="int8"){const _=new Uint8Array(this.buffer.slice(c,c+i));_.reverse();const o=new mb[t](_.buffer);return this.offset+=i,o.reverse(),o}const m=new mb[t](u);return this.offset+=i,m}readInt16(){const e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){const e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){const e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){const e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){const e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){const e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readBigInt64(){const e=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,e}readBigUint64(){const e=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){let t="";for(let i=0;i<e;i++)t+=this.readChar();return t}readUtf8(e=1){return j2(this.readBytes(e))}decodeText(e=1,t="utf8"){return j2(this.readBytes(e),t)}writeBoolean(e){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(let t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(e){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(e){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(let t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this}writeUtf8(e){return this.writeBytes(ek(e))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function D0(n){let e=n.length;for(;--e>=0;)n[e]=0}const rk=3,ik=258,p6=29,ok=256,sk=ok+1+p6,m6=30,ak=512,lk=new Array((sk+2)*2);D0(lk);const ck=new Array(m6*2);D0(ck);const uk=new Array(ak);D0(uk);const hk=new Array(ik-rk+1);D0(hk);const dk=new Array(p6);D0(dk);const fk=new Array(m6);D0(fk);const pk=(n,e,t,i)=>{let c=n&65535|0,u=n>>>16&65535|0,m=0;for(;t!==0;){m=t>2e3?2e3:t,t-=m;do c=c+e[i++]|0,u=u+c|0;while(--m);c%=65521,u%=65521}return c|u<<16|0};var x5=pk;const mk=()=>{let n,e=[];for(var t=0;t<256;t++){n=t;for(var i=0;i<8;i++)n=n&1?3988292384^n>>>1:n>>>1;e[t]=n}return e},gk=new Uint32Array(mk()),yk=(n,e,t,i)=>{const c=gk,u=i+t;n^=-1;for(let m=i;m<u;m++)n=n>>>8^c[(n^e[m])&255];return n^-1};var Ef=yk,b5={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},g6={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const _k=(n,e)=>Object.prototype.hasOwnProperty.call(n,e);var vk=function(n){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const t=e.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(const i in t)_k(t,i)&&(n[i]=t[i])}}return n},xk=n=>{let e=0;for(let i=0,c=n.length;i<c;i++)e+=n[i].length;const t=new Uint8Array(e);for(let i=0,c=0,u=n.length;i<u;i++){let m=n[i];t.set(m,c),c+=m.length}return t},y6={assign:vk,flattenChunks:xk};let _6=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{_6=!1}const i_=new Uint8Array(256);for(let n=0;n<256;n++)i_[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;i_[254]=i_[254]=1;var bk=n=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(n);let e,t,i,c,u,m=n.length,_=0;for(c=0;c<m;c++)t=n.charCodeAt(c),(t&64512)===55296&&c+1<m&&(i=n.charCodeAt(c+1),(i&64512)===56320&&(t=65536+(t-55296<<10)+(i-56320),c++)),_+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(_),u=0,c=0;u<_;c++)t=n.charCodeAt(c),(t&64512)===55296&&c+1<m&&(i=n.charCodeAt(c+1),(i&64512)===56320&&(t=65536+(t-55296<<10)+(i-56320),c++)),t<128?e[u++]=t:t<2048?(e[u++]=192|t>>>6,e[u++]=128|t&63):t<65536?(e[u++]=224|t>>>12,e[u++]=128|t>>>6&63,e[u++]=128|t&63):(e[u++]=240|t>>>18,e[u++]=128|t>>>12&63,e[u++]=128|t>>>6&63,e[u++]=128|t&63);return e};const wk=(n,e)=>{if(e<65534&&n.subarray&&_6)return String.fromCharCode.apply(null,n.length===e?n:n.subarray(0,e));let t="";for(let i=0;i<e;i++)t+=String.fromCharCode(n[i]);return t};var Sk=(n,e)=>{const t=e||n.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(n.subarray(0,e));let i,c;const u=new Array(t*2);for(c=0,i=0;i<t;){let m=n[i++];if(m<128){u[c++]=m;continue}let _=i_[m];if(_>4){u[c++]=65533,i+=_-1;continue}for(m&=_===2?31:_===3?15:7;_>1&&i<t;)m=m<<6|n[i++]&63,_--;if(_>1){u[c++]=65533;continue}m<65536?u[c++]=m:(m-=65536,u[c++]=55296|m>>10&1023,u[c++]=56320|m&1023)}return wk(u,c)},Ek=(n,e)=>{e=e||n.length,e>n.length&&(e=n.length);let t=e-1;for(;t>=0&&(n[t]&192)===128;)t--;return t<0||t===0?e:t+i_[n[t]]>e?t:e},w5={string2buf:bk,buf2string:Sk,utf8border:Ek};function Ak(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Tk=Ak;const h1=16209,Ik=16191;var Ck=function(e,t){let i,c,u,m,_,o,b,I,M,V,k,ie,se,fe,J,ne,me,ue,ke,je,pe,U,F,q;const j=e.state;i=e.next_in,F=e.input,c=i+(e.avail_in-5),u=e.next_out,q=e.output,m=u-(t-e.avail_out),_=u+(e.avail_out-257),o=j.dmax,b=j.wsize,I=j.whave,M=j.wnext,V=j.window,k=j.hold,ie=j.bits,se=j.lencode,fe=j.distcode,J=(1<<j.lenbits)-1,ne=(1<<j.distbits)-1;e:do{ie<15&&(k+=F[i++]<<ie,ie+=8,k+=F[i++]<<ie,ie+=8),me=se[k&J];t:for(;;){if(ue=me>>>24,k>>>=ue,ie-=ue,ue=me>>>16&255,ue===0)q[u++]=me&65535;else if(ue&16){ke=me&65535,ue&=15,ue&&(ie<ue&&(k+=F[i++]<<ie,ie+=8),ke+=k&(1<<ue)-1,k>>>=ue,ie-=ue),ie<15&&(k+=F[i++]<<ie,ie+=8,k+=F[i++]<<ie,ie+=8),me=fe[k&ne];n:for(;;){if(ue=me>>>24,k>>>=ue,ie-=ue,ue=me>>>16&255,ue&16){if(je=me&65535,ue&=15,ie<ue&&(k+=F[i++]<<ie,ie+=8,ie<ue&&(k+=F[i++]<<ie,ie+=8)),je+=k&(1<<ue)-1,je>o){e.msg="invalid distance too far back",j.mode=h1;break e}if(k>>>=ue,ie-=ue,ue=u-m,je>ue){if(ue=je-ue,ue>I&&j.sane){e.msg="invalid distance too far back",j.mode=h1;break e}if(pe=0,U=V,M===0){if(pe+=b-ue,ue<ke){ke-=ue;do q[u++]=V[pe++];while(--ue);pe=u-je,U=q}}else if(M<ue){if(pe+=b+M-ue,ue-=M,ue<ke){ke-=ue;do q[u++]=V[pe++];while(--ue);if(pe=0,M<ke){ue=M,ke-=ue;do q[u++]=V[pe++];while(--ue);pe=u-je,U=q}}}else if(pe+=M-ue,ue<ke){ke-=ue;do q[u++]=V[pe++];while(--ue);pe=u-je,U=q}for(;ke>2;)q[u++]=U[pe++],q[u++]=U[pe++],q[u++]=U[pe++],ke-=3;ke&&(q[u++]=U[pe++],ke>1&&(q[u++]=U[pe++]))}else{pe=u-je;do q[u++]=q[pe++],q[u++]=q[pe++],q[u++]=q[pe++],ke-=3;while(ke>2);ke&&(q[u++]=q[pe++],ke>1&&(q[u++]=q[pe++]))}}else if((ue&64)===0){me=fe[(me&65535)+(k&(1<<ue)-1)];continue n}else{e.msg="invalid distance code",j.mode=h1;break e}break}}else if((ue&64)===0){me=se[(me&65535)+(k&(1<<ue)-1)];continue t}else if(ue&32){j.mode=Ik;break e}else{e.msg="invalid literal/length code",j.mode=h1;break e}break}}while(i<c&&u<_);ke=ie>>3,i-=ke,ie-=ke<<3,k&=(1<<ie)-1,e.next_in=i,e.next_out=u,e.avail_in=i<c?5+(c-i):5-(i-c),e.avail_out=u<_?257+(_-u):257-(u-_),j.hold=k,j.bits=ie};const $g=15,U2=852,V2=592,q2=0,gb=1,$2=2,Lk=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Pk=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),kk=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Rk=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),Mk=(n,e,t,i,c,u,m,_)=>{const o=_.bits;let b=0,I=0,M=0,V=0,k=0,ie=0,se=0,fe=0,J=0,ne=0,me,ue,ke,je,pe,U=null,F;const q=new Uint16Array($g+1),j=new Uint16Array($g+1);let H=null,Z,be,Re;for(b=0;b<=$g;b++)q[b]=0;for(I=0;I<i;I++)q[e[t+I]]++;for(k=o,V=$g;V>=1&&q[V]===0;V--);if(k>V&&(k=V),V===0)return c[u++]=1<<24|64<<16|0,c[u++]=1<<24|64<<16|0,_.bits=1,0;for(M=1;M<V&&q[M]===0;M++);for(k<M&&(k=M),fe=1,b=1;b<=$g;b++)if(fe<<=1,fe-=q[b],fe<0)return-1;if(fe>0&&(n===q2||V!==1))return-1;for(j[1]=0,b=1;b<$g;b++)j[b+1]=j[b]+q[b];for(I=0;I<i;I++)e[t+I]!==0&&(m[j[e[t+I]]++]=I);if(n===q2?(U=H=m,F=20):n===gb?(U=Lk,H=Pk,F=257):(U=kk,H=Rk,F=0),ne=0,I=0,b=M,pe=u,ie=k,se=0,ke=-1,J=1<<k,je=J-1,n===gb&&J>U2||n===$2&&J>V2)return 1;for(;;){Z=b-se,m[I]+1<F?(be=0,Re=m[I]):m[I]>=F?(be=H[m[I]-F],Re=U[m[I]-F]):(be=96,Re=0),me=1<<b-se,ue=1<<ie,M=ue;do ue-=me,c[pe+(ne>>se)+ue]=Z<<24|be<<16|Re|0;while(ue!==0);for(me=1<<b-1;ne&me;)me>>=1;if(me!==0?(ne&=me-1,ne+=me):ne=0,I++,--q[b]===0){if(b===V)break;b=e[t+m[I]]}if(b>k&&(ne&je)!==ke){for(se===0&&(se=k),pe+=M,ie=b-se,fe=1<<ie;ie+se<V&&(fe-=q[ie+se],!(fe<=0));)ie++,fe<<=1;if(J+=1<<ie,n===gb&&J>U2||n===$2&&J>V2)return 1;ke=ne&je,c[ke]=k<<24|ie<<16|pe-u|0}}return ne!==0&&(c[pe+ne]=b-se<<24|64<<16|0),_.bits=k,0};var qy=Mk;const Nk=0,v6=1,x6=2,{Z_FINISH:G2,Z_BLOCK:Dk,Z_TREES:d1,Z_OK:ng,Z_STREAM_END:Fk,Z_NEED_DICT:Ok,Z_STREAM_ERROR:Dd,Z_DATA_ERROR:b6,Z_MEM_ERROR:w6,Z_BUF_ERROR:Bk,Z_DEFLATED:H2}=g6,Qv=16180,W2=16181,K2=16182,X2=16183,Z2=16184,Y2=16185,J2=16186,Q2=16187,eS=16188,tS=16189,pv=16190,dp=16191,yb=16192,nS=16193,_b=16194,rS=16195,iS=16196,oS=16197,sS=16198,f1=16199,p1=16200,aS=16201,lS=16202,cS=16203,uS=16204,hS=16205,vb=16206,dS=16207,fS=16208,Rl=16209,S6=16210,E6=16211,zk=852,jk=592,Uk=15,Vk=Uk,pS=n=>(n>>>24&255)+(n>>>8&65280)+((n&65280)<<8)+((n&255)<<24);function qk(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const fg=n=>{if(!n)return 1;const e=n.state;return!e||e.strm!==n||e.mode<Qv||e.mode>E6?1:0},A6=n=>{if(fg(n))return Dd;const e=n.state;return n.total_in=n.total_out=e.total=0,n.msg="",e.wrap&&(n.adler=e.wrap&1),e.mode=Qv,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(zk),e.distcode=e.distdyn=new Int32Array(jk),e.sane=1,e.back=-1,ng},T6=n=>{if(fg(n))return Dd;const e=n.state;return e.wsize=0,e.whave=0,e.wnext=0,A6(n)},I6=(n,e)=>{let t;if(fg(n))return Dd;const i=n.state;return e<0?(t=0,e=-e):(t=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?Dd:(i.window!==null&&i.wbits!==e&&(i.window=null),i.wrap=t,i.wbits=e,T6(n))},C6=(n,e)=>{if(!n)return Dd;const t=new qk;n.state=t,t.strm=n,t.window=null,t.mode=Qv;const i=I6(n,e);return i!==ng&&(n.state=null),i},$k=n=>C6(n,Vk);let mS=!0,xb,bb;const Gk=n=>{if(mS){xb=new Int32Array(512),bb=new Int32Array(32);let e=0;for(;e<144;)n.lens[e++]=8;for(;e<256;)n.lens[e++]=9;for(;e<280;)n.lens[e++]=7;for(;e<288;)n.lens[e++]=8;for(qy(v6,n.lens,0,288,xb,0,n.work,{bits:9}),e=0;e<32;)n.lens[e++]=5;qy(x6,n.lens,0,32,bb,0,n.work,{bits:5}),mS=!1}n.lencode=xb,n.lenbits=9,n.distcode=bb,n.distbits=5},L6=(n,e,t,i)=>{let c;const u=n.state;return u.window===null&&(u.wsize=1<<u.wbits,u.wnext=0,u.whave=0,u.window=new Uint8Array(u.wsize)),i>=u.wsize?(u.window.set(e.subarray(t-u.wsize,t),0),u.wnext=0,u.whave=u.wsize):(c=u.wsize-u.wnext,c>i&&(c=i),u.window.set(e.subarray(t-i,t-i+c),u.wnext),i-=c,i?(u.window.set(e.subarray(t-i,t),0),u.wnext=i,u.whave=u.wsize):(u.wnext+=c,u.wnext===u.wsize&&(u.wnext=0),u.whave<u.wsize&&(u.whave+=c))),0},Hk=(n,e)=>{let t,i,c,u,m,_,o,b,I,M,V,k,ie,se,fe=0,J,ne,me,ue,ke,je,pe,U;const F=new Uint8Array(4);let q,j;const H=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(fg(n)||!n.output||!n.input&&n.avail_in!==0)return Dd;t=n.state,t.mode===dp&&(t.mode=yb),m=n.next_out,c=n.output,o=n.avail_out,u=n.next_in,i=n.input,_=n.avail_in,b=t.hold,I=t.bits,M=_,V=o,U=ng;e:for(;;)switch(t.mode){case Qv:if(t.wrap===0){t.mode=yb;break}for(;I<16;){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}if(t.wrap&2&&b===35615){t.wbits===0&&(t.wbits=15),t.check=0,F[0]=b&255,F[1]=b>>>8&255,t.check=Ef(t.check,F,2,0),b=0,I=0,t.mode=W2;break}if(t.head&&(t.head.done=!1),!(t.wrap&1)||(((b&255)<<8)+(b>>8))%31){n.msg="incorrect header check",t.mode=Rl;break}if((b&15)!==H2){n.msg="unknown compression method",t.mode=Rl;break}if(b>>>=4,I-=4,pe=(b&15)+8,t.wbits===0&&(t.wbits=pe),pe>15||pe>t.wbits){n.msg="invalid window size",t.mode=Rl;break}t.dmax=1<<t.wbits,t.flags=0,n.adler=t.check=1,t.mode=b&512?tS:dp,b=0,I=0;break;case W2:for(;I<16;){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}if(t.flags=b,(t.flags&255)!==H2){n.msg="unknown compression method",t.mode=Rl;break}if(t.flags&57344){n.msg="unknown header flags set",t.mode=Rl;break}t.head&&(t.head.text=b>>8&1),t.flags&512&&t.wrap&4&&(F[0]=b&255,F[1]=b>>>8&255,t.check=Ef(t.check,F,2,0)),b=0,I=0,t.mode=K2;case K2:for(;I<32;){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}t.head&&(t.head.time=b),t.flags&512&&t.wrap&4&&(F[0]=b&255,F[1]=b>>>8&255,F[2]=b>>>16&255,F[3]=b>>>24&255,t.check=Ef(t.check,F,4,0)),b=0,I=0,t.mode=X2;case X2:for(;I<16;){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}t.head&&(t.head.xflags=b&255,t.head.os=b>>8),t.flags&512&&t.wrap&4&&(F[0]=b&255,F[1]=b>>>8&255,t.check=Ef(t.check,F,2,0)),b=0,I=0,t.mode=Z2;case Z2:if(t.flags&1024){for(;I<16;){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}t.length=b,t.head&&(t.head.extra_len=b),t.flags&512&&t.wrap&4&&(F[0]=b&255,F[1]=b>>>8&255,t.check=Ef(t.check,F,2,0)),b=0,I=0}else t.head&&(t.head.extra=null);t.mode=Y2;case Y2:if(t.flags&1024&&(k=t.length,k>_&&(k=_),k&&(t.head&&(pe=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(i.subarray(u,u+k),pe)),t.flags&512&&t.wrap&4&&(t.check=Ef(t.check,i,k,u)),_-=k,u+=k,t.length-=k),t.length))break e;t.length=0,t.mode=J2;case J2:if(t.flags&2048){if(_===0)break e;k=0;do pe=i[u+k++],t.head&&pe&&t.length<65536&&(t.head.name+=String.fromCharCode(pe));while(pe&&k<_);if(t.flags&512&&t.wrap&4&&(t.check=Ef(t.check,i,k,u)),_-=k,u+=k,pe)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=Q2;case Q2:if(t.flags&4096){if(_===0)break e;k=0;do pe=i[u+k++],t.head&&pe&&t.length<65536&&(t.head.comment+=String.fromCharCode(pe));while(pe&&k<_);if(t.flags&512&&t.wrap&4&&(t.check=Ef(t.check,i,k,u)),_-=k,u+=k,pe)break e}else t.head&&(t.head.comment=null);t.mode=eS;case eS:if(t.flags&512){for(;I<16;){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}if(t.wrap&4&&b!==(t.check&65535)){n.msg="header crc mismatch",t.mode=Rl;break}b=0,I=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),n.adler=t.check=0,t.mode=dp;break;case tS:for(;I<32;){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}n.adler=t.check=pS(b),b=0,I=0,t.mode=pv;case pv:if(t.havedict===0)return n.next_out=m,n.avail_out=o,n.next_in=u,n.avail_in=_,t.hold=b,t.bits=I,Ok;n.adler=t.check=1,t.mode=dp;case dp:if(e===Dk||e===d1)break e;case yb:if(t.last){b>>>=I&7,I-=I&7,t.mode=vb;break}for(;I<3;){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}switch(t.last=b&1,b>>>=1,I-=1,b&3){case 0:t.mode=nS;break;case 1:if(Gk(t),t.mode=f1,e===d1){b>>>=2,I-=2;break e}break;case 2:t.mode=iS;break;case 3:n.msg="invalid block type",t.mode=Rl}b>>>=2,I-=2;break;case nS:for(b>>>=I&7,I-=I&7;I<32;){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}if((b&65535)!==(b>>>16^65535)){n.msg="invalid stored block lengths",t.mode=Rl;break}if(t.length=b&65535,b=0,I=0,t.mode=_b,e===d1)break e;case _b:t.mode=rS;case rS:if(k=t.length,k){if(k>_&&(k=_),k>o&&(k=o),k===0)break e;c.set(i.subarray(u,u+k),m),_-=k,u+=k,o-=k,m+=k,t.length-=k;break}t.mode=dp;break;case iS:for(;I<14;){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}if(t.nlen=(b&31)+257,b>>>=5,I-=5,t.ndist=(b&31)+1,b>>>=5,I-=5,t.ncode=(b&15)+4,b>>>=4,I-=4,t.nlen>286||t.ndist>30){n.msg="too many length or distance symbols",t.mode=Rl;break}t.have=0,t.mode=oS;case oS:for(;t.have<t.ncode;){for(;I<3;){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}t.lens[H[t.have++]]=b&7,b>>>=3,I-=3}for(;t.have<19;)t.lens[H[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,q={bits:t.lenbits},U=qy(Nk,t.lens,0,19,t.lencode,0,t.work,q),t.lenbits=q.bits,U){n.msg="invalid code lengths set",t.mode=Rl;break}t.have=0,t.mode=sS;case sS:for(;t.have<t.nlen+t.ndist;){for(;fe=t.lencode[b&(1<<t.lenbits)-1],J=fe>>>24,ne=fe>>>16&255,me=fe&65535,!(J<=I);){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}if(me<16)b>>>=J,I-=J,t.lens[t.have++]=me;else{if(me===16){for(j=J+2;I<j;){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}if(b>>>=J,I-=J,t.have===0){n.msg="invalid bit length repeat",t.mode=Rl;break}pe=t.lens[t.have-1],k=3+(b&3),b>>>=2,I-=2}else if(me===17){for(j=J+3;I<j;){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}b>>>=J,I-=J,pe=0,k=3+(b&7),b>>>=3,I-=3}else{for(j=J+7;I<j;){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}b>>>=J,I-=J,pe=0,k=11+(b&127),b>>>=7,I-=7}if(t.have+k>t.nlen+t.ndist){n.msg="invalid bit length repeat",t.mode=Rl;break}for(;k--;)t.lens[t.have++]=pe}}if(t.mode===Rl)break;if(t.lens[256]===0){n.msg="invalid code -- missing end-of-block",t.mode=Rl;break}if(t.lenbits=9,q={bits:t.lenbits},U=qy(v6,t.lens,0,t.nlen,t.lencode,0,t.work,q),t.lenbits=q.bits,U){n.msg="invalid literal/lengths set",t.mode=Rl;break}if(t.distbits=6,t.distcode=t.distdyn,q={bits:t.distbits},U=qy(x6,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,q),t.distbits=q.bits,U){n.msg="invalid distances set",t.mode=Rl;break}if(t.mode=f1,e===d1)break e;case f1:t.mode=p1;case p1:if(_>=6&&o>=258){n.next_out=m,n.avail_out=o,n.next_in=u,n.avail_in=_,t.hold=b,t.bits=I,Ck(n,V),m=n.next_out,c=n.output,o=n.avail_out,u=n.next_in,i=n.input,_=n.avail_in,b=t.hold,I=t.bits,t.mode===dp&&(t.back=-1);break}for(t.back=0;fe=t.lencode[b&(1<<t.lenbits)-1],J=fe>>>24,ne=fe>>>16&255,me=fe&65535,!(J<=I);){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}if(ne&&(ne&240)===0){for(ue=J,ke=ne,je=me;fe=t.lencode[je+((b&(1<<ue+ke)-1)>>ue)],J=fe>>>24,ne=fe>>>16&255,me=fe&65535,!(ue+J<=I);){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}b>>>=ue,I-=ue,t.back+=ue}if(b>>>=J,I-=J,t.back+=J,t.length=me,ne===0){t.mode=hS;break}if(ne&32){t.back=-1,t.mode=dp;break}if(ne&64){n.msg="invalid literal/length code",t.mode=Rl;break}t.extra=ne&15,t.mode=aS;case aS:if(t.extra){for(j=t.extra;I<j;){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}t.length+=b&(1<<t.extra)-1,b>>>=t.extra,I-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=lS;case lS:for(;fe=t.distcode[b&(1<<t.distbits)-1],J=fe>>>24,ne=fe>>>16&255,me=fe&65535,!(J<=I);){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}if((ne&240)===0){for(ue=J,ke=ne,je=me;fe=t.distcode[je+((b&(1<<ue+ke)-1)>>ue)],J=fe>>>24,ne=fe>>>16&255,me=fe&65535,!(ue+J<=I);){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}b>>>=ue,I-=ue,t.back+=ue}if(b>>>=J,I-=J,t.back+=J,ne&64){n.msg="invalid distance code",t.mode=Rl;break}t.offset=me,t.extra=ne&15,t.mode=cS;case cS:if(t.extra){for(j=t.extra;I<j;){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}t.offset+=b&(1<<t.extra)-1,b>>>=t.extra,I-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){n.msg="invalid distance too far back",t.mode=Rl;break}t.mode=uS;case uS:if(o===0)break e;if(k=V-o,t.offset>k){if(k=t.offset-k,k>t.whave&&t.sane){n.msg="invalid distance too far back",t.mode=Rl;break}k>t.wnext?(k-=t.wnext,ie=t.wsize-k):ie=t.wnext-k,k>t.length&&(k=t.length),se=t.window}else se=c,ie=m-t.offset,k=t.length;k>o&&(k=o),o-=k,t.length-=k;do c[m++]=se[ie++];while(--k);t.length===0&&(t.mode=p1);break;case hS:if(o===0)break e;c[m++]=t.length,o--,t.mode=p1;break;case vb:if(t.wrap){for(;I<32;){if(_===0)break e;_--,b|=i[u++]<<I,I+=8}if(V-=o,n.total_out+=V,t.total+=V,t.wrap&4&&V&&(n.adler=t.check=t.flags?Ef(t.check,c,V,m-V):x5(t.check,c,V,m-V)),V=o,t.wrap&4&&(t.flags?b:pS(b))!==t.check){n.msg="incorrect data check",t.mode=Rl;break}b=0,I=0}t.mode=dS;case dS:if(t.wrap&&t.flags){for(;I<32;){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}if(t.wrap&4&&b!==(t.total&4294967295)){n.msg="incorrect length check",t.mode=Rl;break}b=0,I=0}t.mode=fS;case fS:U=Fk;break e;case Rl:U=b6;break e;case S6:return w6;case E6:default:return Dd}return n.next_out=m,n.avail_out=o,n.next_in=u,n.avail_in=_,t.hold=b,t.bits=I,(t.wsize||V!==n.avail_out&&t.mode<Rl&&(t.mode<vb||e!==G2))&&L6(n,n.output,n.next_out,V-n.avail_out),M-=n.avail_in,V-=n.avail_out,n.total_in+=M,n.total_out+=V,t.total+=V,t.wrap&4&&V&&(n.adler=t.check=t.flags?Ef(t.check,c,V,n.next_out-V):x5(t.check,c,V,n.next_out-V)),n.data_type=t.bits+(t.last?64:0)+(t.mode===dp?128:0)+(t.mode===f1||t.mode===_b?256:0),(M===0&&V===0||e===G2)&&U===ng&&(U=Bk),U},Wk=n=>{if(fg(n))return Dd;let e=n.state;return e.window&&(e.window=null),n.state=null,ng},Kk=(n,e)=>{if(fg(n))return Dd;const t=n.state;return(t.wrap&2)===0?Dd:(t.head=e,e.done=!1,ng)},Xk=(n,e)=>{const t=e.length;let i,c,u;return fg(n)||(i=n.state,i.wrap!==0&&i.mode!==pv)?Dd:i.mode===pv&&(c=1,c=x5(c,e,t,0),c!==i.check)?b6:(u=L6(n,e,t,t),u?(i.mode=S6,w6):(i.havedict=1,ng))};var Zk=T6,Yk=I6,Jk=A6,Qk=$k,eR=C6,tR=Hk,nR=Wk,rR=Kk,iR=Xk,oR="pako inflate (from Nodeca project)",gp={inflateReset:Zk,inflateReset2:Yk,inflateResetKeep:Jk,inflateInit:Qk,inflateInit2:eR,inflate:tR,inflateEnd:nR,inflateGetHeader:rR,inflateSetDictionary:iR,inflateInfo:oR};function sR(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var aR=sR;const P6=Object.prototype.toString,{Z_NO_FLUSH:lR,Z_FINISH:cR,Z_OK:o_,Z_STREAM_END:wb,Z_NEED_DICT:Sb,Z_STREAM_ERROR:uR,Z_DATA_ERROR:gS,Z_MEM_ERROR:hR}=g6;function b_(n){this.options=y6.assign({chunkSize:1024*64,windowBits:15,to:""},n||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(n&&n.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15)===0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Tk,this.strm.avail_out=0;let t=gp.inflateInit2(this.strm,e.windowBits);if(t!==o_)throw new Error(b5[t]);if(this.header=new aR,gp.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=w5.string2buf(e.dictionary):P6.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=gp.inflateSetDictionary(this.strm,e.dictionary),t!==o_)))throw new Error(b5[t])}b_.prototype.push=function(n,e){const t=this.strm,i=this.options.chunkSize,c=this.options.dictionary;let u,m,_;if(this.ended)return!1;for(e===~~e?m=e:m=e===!0?cR:lR,P6.call(n)==="[object ArrayBuffer]"?t.input=new Uint8Array(n):t.input=n,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(i),t.next_out=0,t.avail_out=i),u=gp.inflate(t,m),u===Sb&&c&&(u=gp.inflateSetDictionary(t,c),u===o_?u=gp.inflate(t,m):u===gS&&(u=Sb));t.avail_in>0&&u===wb&&t.state.wrap>0&&n[t.next_in]!==0;)gp.inflateReset(t),u=gp.inflate(t,m);switch(u){case uR:case gS:case Sb:case hR:return this.onEnd(u),this.ended=!0,!1}if(_=t.avail_out,t.next_out&&(t.avail_out===0||u===wb))if(this.options.to==="string"){let o=w5.utf8border(t.output,t.next_out),b=t.next_out-o,I=w5.buf2string(t.output,o);t.next_out=b,t.avail_out=i-b,b&&t.output.set(t.output.subarray(o,o+b),0),this.onData(I)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(u===o_&&_===0)){if(u===wb)return u=gp.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};b_.prototype.onData=function(n){this.chunks.push(n)};b_.prototype.onEnd=function(n){n===o_&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=y6.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};function dR(n,e){const t=new b_(e);if(t.push(n),t.err)throw t.msg||b5[t.err];return t.result}var fR=b_,pR=dR,mR={Inflate:fR,inflate:pR};const{Inflate:gR,inflate:yR}=mR;var yS=gR,_R=yR;const k6=[];for(let n=0;n<256;n++){let e=n;for(let t=0;t<8;t++)e&1?e=3988292384^e>>>1:e=e>>>1;k6[n]=e}const _S=4294967295;function vR(n,e,t){let i=n;for(let c=0;c<t;c++)i=k6[(i^e[c])&255]^i>>>8;return i}function xR(n,e){return(vR(_S,n,e)^_S)>>>0}function vS(n,e,t){const i=n.readUint32(),c=xR(new Uint8Array(n.buffer,n.byteOffset+n.offset-e-4,e),e);if(c!==i)throw new Error(`CRC mismatch for chunk ${t}. Expected ${i}, found ${c}`)}function R6(n,e,t){for(let i=0;i<t;i++)e[i]=n[i]}function M6(n,e,t,i){let c=0;for(;c<i;c++)e[c]=n[c];for(;c<t;c++)e[c]=n[c]+e[c-i]&255}function N6(n,e,t,i){let c=0;if(t.length===0)for(;c<i;c++)e[c]=n[c];else for(;c<i;c++)e[c]=n[c]+t[c]&255}function D6(n,e,t,i,c){let u=0;if(t.length===0){for(;u<c;u++)e[u]=n[u];for(;u<i;u++)e[u]=n[u]+(e[u-c]>>1)&255}else{for(;u<c;u++)e[u]=n[u]+(t[u]>>1)&255;for(;u<i;u++)e[u]=n[u]+(e[u-c]+t[u]>>1)&255}}function F6(n,e,t,i,c){let u=0;if(t.length===0){for(;u<c;u++)e[u]=n[u];for(;u<i;u++)e[u]=n[u]+e[u-c]&255}else{for(;u<c;u++)e[u]=n[u]+t[u]&255;for(;u<i;u++)e[u]=n[u]+bR(e[u-c],t[u],t[u-c])&255}}function bR(n,e,t){const i=n+e-t,c=Math.abs(i-n),u=Math.abs(i-e),m=Math.abs(i-t);return c<=u&&c<=m?n:u<=m?e:t}function wR(n,e,t,i,c,u){switch(n){case 0:R6(e,t,c);break;case 1:M6(e,t,c,u);break;case 2:N6(e,t,i,c);break;case 3:D6(e,t,i,c,u);break;case 4:F6(e,t,i,c,u);break;default:throw new Error(`Unsupported filter: ${n}`)}}const SR=new Uint16Array([255]),ER=new Uint8Array(SR.buffer),AR=ER[0]===255;function TR(n){const{data:e,width:t,height:i,channels:c,depth:u}=n,m=[{x:0,y:0,xStep:8,yStep:8},{x:4,y:0,xStep:8,yStep:8},{x:0,y:4,xStep:4,yStep:8},{x:2,y:0,xStep:4,yStep:4},{x:0,y:2,xStep:2,yStep:4},{x:1,y:0,xStep:2,yStep:2},{x:0,y:1,xStep:1,yStep:2}],_=Math.ceil(u/8)*c,o=new Uint8Array(i*t*_);let b=0;for(let I=0;I<7;I++){const M=m[I],V=Math.ceil((t-M.x)/M.xStep),k=Math.ceil((i-M.y)/M.yStep);if(V<=0||k<=0)continue;const ie=V*_,se=new Uint8Array(ie);for(let fe=0;fe<k;fe++){const J=e[b++],ne=e.subarray(b,b+ie);b+=ie;const me=new Uint8Array(ie);wR(J,ne,me,se,ie,_),se.set(me);for(let ue=0;ue<V;ue++){const ke=M.x+ue*M.xStep,je=M.y+fe*M.yStep;if(!(ke>=t||je>=i))for(let pe=0;pe<_;pe++)o[(je*t+ke)*_+pe]=me[ue*_+pe]}}}if(u===16){const I=new Uint16Array(o.buffer);if(AR)for(let M=0;M<I.length;M++)I[M]=IR(I[M]);return I}else return o}function IR(n){return(n&255)<<8|n>>8&255}const CR=new Uint16Array([255]),LR=new Uint8Array(CR.buffer),PR=LR[0]===255,kR=new Uint8Array(0);function xS(n){const{data:e,width:t,height:i,channels:c,depth:u}=n,m=Math.ceil(u/8)*c,_=Math.ceil(u/8*c*t),o=new Uint8Array(i*_);let b=kR,I=0,M,V;for(let k=0;k<i;k++){switch(M=e.subarray(I+1,I+1+_),V=o.subarray(k*_,(k+1)*_),e[I]){case 0:R6(M,V,_);break;case 1:M6(M,V,_,m);break;case 2:N6(M,V,b,_);break;case 3:D6(M,V,b,_,m);break;case 4:F6(M,V,b,_,m);break;default:throw new Error(`Unsupported filter: ${e[I]}`)}b=V,I+=_+1}if(u===16){const k=new Uint16Array(o.buffer);if(PR)for(let ie=0;ie<k.length;ie++)k[ie]=RR(k[ie]);return k}else return o}function RR(n){return(n&255)<<8|n>>8&255}const j1=Uint8Array.of(137,80,78,71,13,10,26,10);function bS(n){if(!MR(n.readBytes(j1.length)))throw new Error("wrong PNG signature")}function MR(n){if(n.length<j1.length)return!1;for(let e=0;e<j1.length;e++)if(n[e]!==j1[e])return!1;return!0}const NR="tEXt",DR=0,O6=new TextDecoder("latin1");function FR(n){if(BR(n),n.length===0||n.length>79)throw new Error("keyword length must be between 1 and 79")}const OR=/^[\u0000-\u00FF]*$/;function BR(n){if(!OR.test(n))throw new Error("invalid latin1 text")}function zR(n,e,t){const i=B6(e);n[i]=jR(e,t-i.length-1)}function B6(n){for(n.mark();n.readByte()!==DR;);const e=n.offset;n.reset();const t=O6.decode(n.readBytes(e-n.offset-1));return n.skip(1),FR(t),t}function jR(n,e){return O6.decode(n.readBytes(e))}const dd={UNKNOWN:-1,GREYSCALE:0,TRUECOLOUR:2,INDEXED_COLOUR:3,GREYSCALE_ALPHA:4,TRUECOLOUR_ALPHA:6},Eb={UNKNOWN:-1,DEFLATE:0},wS={UNKNOWN:-1,ADAPTIVE:0},Ab={UNKNOWN:-1,NO_INTERLACE:0,ADAM7:1},m1={NONE:0,BACKGROUND:1,PREVIOUS:2},Tb={SOURCE:0,OVER:1};class UR extends Sw{_checkCrc;_inflator;_png;_apng;_end;_hasPalette;_palette;_hasTransparency;_transparency;_compressionMethod;_filterMethod;_interlaceMethod;_colorType;_isAnimated;_numberOfFrames;_numberOfPlays;_frames;_writingDataChunks;constructor(e,t={}){super(e);const{checkCrc:i=!1}=t;this._checkCrc=i,this._inflator=new yS,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._apng={width:-1,height:-1,channels:-1,depth:1,numberOfFrames:1,numberOfPlays:0,text:{},frames:[]},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=Eb.UNKNOWN,this._filterMethod=wS.UNKNOWN,this._interlaceMethod=Ab.UNKNOWN,this._colorType=dd.UNKNOWN,this._isAnimated=!1,this._numberOfFrames=1,this._numberOfPlays=0,this._frames=[],this._writingDataChunks=!1,this.setBigEndian()}decode(){for(bS(this);!this._end;){const e=this.readUint32(),t=this.readChars(4);this.decodeChunk(e,t)}return this.decodeImage(),this._png}decodeApng(){for(bS(this);!this._end;){const e=this.readUint32(),t=this.readChars(4);this.decodeApngChunk(e,t)}return this.decodeApngImage(),this._apng}decodeChunk(e,t){const i=this.offset;switch(t){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(e);break;case"IDAT":this.decodeIDAT(e);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(e);break;case"iCCP":this.decodeiCCP(e);break;case NR:zR(this._png.text,this,e);break;case"pHYs":this.decodepHYs();break;default:this.skip(e);break}if(this.offset-i!==e)throw new Error(`Length mismatch while decoding chunk ${t}`);this._checkCrc?vS(this,e+4,t):this.skip(4)}decodeApngChunk(e,t){const i=this.offset;switch(t!=="fdAT"&&t!=="IDAT"&&this._writingDataChunks&&this.pushDataToFrame(),t){case"acTL":this.decodeACTL();break;case"fcTL":this.decodeFCTL();break;case"fdAT":this.decodeFDAT(e);break;default:this.decodeChunk(e,t),this.offset=i+e;break}if(this.offset-i!==e)throw new Error(`Length mismatch while decoding chunk ${t}`);this._checkCrc?vS(this,e+4,t):this.skip(4)}decodeIHDR(){const e=this._png;e.width=this.readUint32(),e.height=this.readUint32(),e.depth=VR(this.readUint8());const t=this.readUint8();this._colorType=t;let i;switch(t){case dd.GREYSCALE:i=1;break;case dd.TRUECOLOUR:i=3;break;case dd.INDEXED_COLOUR:i=1;break;case dd.GREYSCALE_ALPHA:i=2;break;case dd.TRUECOLOUR_ALPHA:i=4;break;case dd.UNKNOWN:default:throw new Error(`Unknown color type: ${t}`)}if(this._png.channels=i,this._compressionMethod=this.readUint8(),this._compressionMethod!==Eb.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodeACTL(){this._numberOfFrames=this.readUint32(),this._numberOfPlays=this.readUint32(),this._isAnimated=!0}decodeFCTL(){const e={sequenceNumber:this.readUint32(),width:this.readUint32(),height:this.readUint32(),xOffset:this.readUint32(),yOffset:this.readUint32(),delayNumber:this.readUint16(),delayDenominator:this.readUint16(),disposeOp:this.readUint8(),blendOp:this.readUint8(),data:new Uint8Array(0)};this._frames.push(e)}decodePLTE(e){if(e%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${e}`);const t=e/3;this._hasPalette=!0;const i=[];this._palette=i;for(let c=0;c<t;c++)i.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(e){this._writingDataChunks=!0;const t=e,i=this.offset+this.byteOffset;if(this._inflator.push(new Uint8Array(this.buffer,i,t)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(e)}decodeFDAT(e){this._writingDataChunks=!0;let t=e,i=this.offset+this.byteOffset;if(i+=4,t-=4,this._inflator.push(new Uint8Array(this.buffer,i,t)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(e)}decodetRNS(e){switch(this._colorType){case dd.GREYSCALE:case dd.TRUECOLOUR:{if(e%2!==0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${e}`);if(e/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${e/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(e/2);for(let t=0;t<e/2;t++)this._transparency[t]=this.readUint16();break}case dd.INDEXED_COLOUR:{if(e>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${e} vs ${this._palette.length})`);let t=0;for(;t<e;t++){const i=this.readByte();this._palette[t].push(i)}for(;t<this._palette.length;t++)this._palette[t].push(255);break}case dd.UNKNOWN:case dd.GREYSCALE_ALPHA:case dd.TRUECOLOUR_ALPHA:default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(e){const t=B6(this),i=this.readUint8();if(i!==Eb.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${i}`);const c=this.readBytes(e-t.length-2);this._png.iccEmbeddedProfile={name:t,profile:_R(c)}}decodepHYs(){const e=this.readUint32(),t=this.readUint32(),i=this.readByte();this._png.resolution={x:e,y:t,unit:i}}decodeApngImage(){this._apng.width=this._png.width,this._apng.height=this._png.height,this._apng.channels=this._png.channels,this._apng.depth=this._png.depth,this._apng.numberOfFrames=this._numberOfFrames,this._apng.numberOfPlays=this._numberOfPlays,this._apng.text=this._png.text,this._apng.resolution=this._png.resolution;for(let e=0;e<this._numberOfFrames;e++){const t={sequenceNumber:this._frames[e].sequenceNumber,delayNumber:this._frames[e].delayNumber,delayDenominator:this._frames[e].delayDenominator,data:this._apng.depth===8?new Uint8Array(this._apng.width*this._apng.height*this._apng.channels):new Uint16Array(this._apng.width*this._apng.height*this._apng.channels)},i=this._frames.at(e);if(i){if(i.data=xS({data:i.data,width:i.width,height:i.height,channels:this._apng.channels,depth:this._apng.depth}),this._hasPalette&&(this._apng.palette=this._palette),this._hasTransparency&&(this._apng.transparency=this._transparency),e===0||i.xOffset===0&&i.yOffset===0&&i.width===this._png.width&&i.height===this._png.height)t.data=i.data;else{const c=this._apng.frames.at(e-1);this.disposeFrame(i,c,t),this.addFrameDataToCanvas(t,i)}this._apng.frames.push(t)}}return this._apng}disposeFrame(e,t,i){switch(e.disposeOp){case m1.NONE:break;case m1.BACKGROUND:for(let c=0;c<this._png.height;c++)for(let u=0;u<this._png.width;u++){const m=(c*e.width+u)*this._png.channels;for(let _=0;_<this._png.channels;_++)i.data[m+_]=0}break;case m1.PREVIOUS:i.data.set(t.data);break;default:throw new Error("Unknown disposeOp")}}addFrameDataToCanvas(e,t){const i=1<<this._png.depth,c=(u,m)=>{const _=((u+t.yOffset)*this._png.width+t.xOffset+m)*this._png.channels,o=(u*t.width+m)*this._png.channels;return{index:_,frameIndex:o}};switch(t.blendOp){case Tb.SOURCE:for(let u=0;u<t.height;u++)for(let m=0;m<t.width;m++){const{index:_,frameIndex:o}=c(u,m);for(let b=0;b<this._png.channels;b++)e.data[_+b]=t.data[o+b]}break;case Tb.OVER:for(let u=0;u<t.height;u++)for(let m=0;m<t.width;m++){const{index:_,frameIndex:o}=c(u,m);for(let b=0;b<this._png.channels;b++){const I=t.data[o+this._png.channels-1]/i,M=b%(this._png.channels-1)===0?1:t.data[o+b],V=Math.floor(I*M+(1-I)*e.data[_+b]);e.data[_+b]+=V}}break;default:throw new Error("Unknown blendOp")}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const e=this._isAnimated?(this._frames?.at(0)).data:this._inflator.result;if(this._filterMethod!==wS.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===Ab.NO_INTERLACE)this._png.data=xS({data:e,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else if(this._interlaceMethod===Ab.ADAM7)this._png.data=TR({data:e,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}pushDataToFrame(){const e=this._inflator.result,t=this._frames.at(-1);t?t.data=e:this._frames.push({sequenceNumber:0,width:this._png.width,height:this._png.height,xOffset:0,yOffset:0,delayNumber:0,delayDenominator:0,disposeOp:m1.NONE,blendOp:Tb.SOURCE,data:e}),this._inflator=new yS,this._writingDataChunks=!1}}function VR(n){if(n!==1&&n!==2&&n!==4&&n!==8&&n!==16)throw new Error(`invalid bit depth: ${n}`);return n}var SS;(function(n){n[n.UNKNOWN=0]="UNKNOWN",n[n.METRE=1]="METRE"})(SS||(SS={}));function qR(n,e){return new UR(n,e).decode()}var oo=(function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this})();function Ib(){oo.console&&typeof oo.console.log=="function"&&oo.console.log.apply(oo.console,arguments)}var Ka={log:Ib,warn:function(n){oo.console&&(typeof oo.console.warn=="function"?oo.console.warn.apply(oo.console,arguments):Ib.call(null,arguments))},error:function(n){oo.console&&(typeof oo.console.error=="function"?oo.console.error.apply(oo.console,arguments):Ib(n))}};function Cb(n,e,t){var i=new XMLHttpRequest;i.open("GET",n),i.responseType="blob",i.onload=function(){$m(i.response,e,t)},i.onerror=function(){Ka.error("could not download file")},i.send()}function ES(n){var e=new XMLHttpRequest;e.open("HEAD",n,!1);try{e.send()}catch{}return e.status>=200&&e.status<=299}function g1(n){try{n.dispatchEvent(new MouseEvent("click"))}catch{var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),n.dispatchEvent(e)}}var $m=oo.saveAs||((typeof window>"u"?"undefined":wa(window))!=="object"||window!==oo?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(n,e,t){var i=oo.URL||oo.webkitURL,c=document.createElement("a");e=e||n.name||"download",c.download=e,c.rel="noopener",typeof n=="string"?(c.href=n,c.origin!==location.origin?ES(c.href)?Cb(n,e,t):g1(c,c.target="_blank"):g1(c)):(c.href=i.createObjectURL(n),setTimeout(function(){i.revokeObjectURL(c.href)},4e4),setTimeout(function(){g1(c)},0))}:"msSaveOrOpenBlob"in navigator?function(n,e,t){if(e=e||n.name||"download",typeof n=="string")if(ES(n))Cb(n,e,t);else{var i=document.createElement("a");i.href=n,i.target="_blank",setTimeout(function(){g1(i)})}else navigator.msSaveOrOpenBlob((function(c,u){return u===void 0?u={autoBom:!1}:wa(u)!=="object"&&(Ka.warn("Deprecated: Expected third argument to be a object"),u={autoBom:!u}),u.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(c.type)?new Blob(["\uFEFF",c],{type:c.type}):c})(n,t),e)}:function(n,e,t,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),typeof n=="string")return Cb(n,e,t);var c=n.type==="application/octet-stream",u=/constructor/i.test(oo.HTMLElement)||oo.safari,m=/CriOS\/[\d]+/.test(navigator.userAgent);if((m||c&&u)&&(typeof FileReader>"u"?"undefined":wa(FileReader))==="object"){var _=new FileReader;_.onloadend=function(){var I=_.result;I=m?I:I.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=I:location=I,i=null},_.readAsDataURL(n)}else{var o=oo.URL||oo.webkitURL,b=o.createObjectURL(n);i?i.location=b:location.href=b,i=null,setTimeout(function(){o.revokeObjectURL(b)},4e4)}});/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
 * @license Use it if you like it
 */function z6(n){var e;n=n||"",this.ok=!1,n.charAt(0)=="#"&&(n=n.substr(1,6)),n={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[n=(n=n.replace(/ /g,"")).toLowerCase()]||n;for(var t=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(_){return[parseInt(_[1]),parseInt(_[2]),parseInt(_[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(_){return[parseInt(_[1],16),parseInt(_[2],16),parseInt(_[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(_){return[parseInt(_[1]+_[1],16),parseInt(_[2]+_[2],16),parseInt(_[3]+_[3],16)]}}],i=0;i<t.length;i++){var c=t[i].re,u=t[i].process,m=c.exec(n);m&&(e=u(m),this.r=e[0],this.g=e[1],this.b=e[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var _=this.r.toString(16),o=this.g.toString(16),b=this.b.toString(16);return _.length==1&&(_="0"+_),o.length==1&&(o="0"+o),b.length==1&&(b="0"+b),"#"+_+o+b}}var U1=oo.atob.bind(oo),AS=oo.btoa.bind(oo);/**
 * @license
 * Joseph Myers does not specify a particular license for his work.
 *
 * Author: Joseph Myers
 * Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
 *
 * Modified by: Owen Leong
 */function Lb(n,e){var t=n[0],i=n[1],c=n[2],u=n[3];t=yh(t,i,c,u,e[0],7,-680876936),u=yh(u,t,i,c,e[1],12,-389564586),c=yh(c,u,t,i,e[2],17,606105819),i=yh(i,c,u,t,e[3],22,-1044525330),t=yh(t,i,c,u,e[4],7,-176418897),u=yh(u,t,i,c,e[5],12,1200080426),c=yh(c,u,t,i,e[6],17,-1473231341),i=yh(i,c,u,t,e[7],22,-45705983),t=yh(t,i,c,u,e[8],7,1770035416),u=yh(u,t,i,c,e[9],12,-1958414417),c=yh(c,u,t,i,e[10],17,-42063),i=yh(i,c,u,t,e[11],22,-1990404162),t=yh(t,i,c,u,e[12],7,1804603682),u=yh(u,t,i,c,e[13],12,-40341101),c=yh(c,u,t,i,e[14],17,-1502002290),t=_h(t,i=yh(i,c,u,t,e[15],22,1236535329),c,u,e[1],5,-165796510),u=_h(u,t,i,c,e[6],9,-1069501632),c=_h(c,u,t,i,e[11],14,643717713),i=_h(i,c,u,t,e[0],20,-373897302),t=_h(t,i,c,u,e[5],5,-701558691),u=_h(u,t,i,c,e[10],9,38016083),c=_h(c,u,t,i,e[15],14,-660478335),i=_h(i,c,u,t,e[4],20,-405537848),t=_h(t,i,c,u,e[9],5,568446438),u=_h(u,t,i,c,e[14],9,-1019803690),c=_h(c,u,t,i,e[3],14,-187363961),i=_h(i,c,u,t,e[8],20,1163531501),t=_h(t,i,c,u,e[13],5,-1444681467),u=_h(u,t,i,c,e[2],9,-51403784),c=_h(c,u,t,i,e[7],14,1735328473),t=vh(t,i=_h(i,c,u,t,e[12],20,-1926607734),c,u,e[5],4,-378558),u=vh(u,t,i,c,e[8],11,-2022574463),c=vh(c,u,t,i,e[11],16,1839030562),i=vh(i,c,u,t,e[14],23,-35309556),t=vh(t,i,c,u,e[1],4,-1530992060),u=vh(u,t,i,c,e[4],11,1272893353),c=vh(c,u,t,i,e[7],16,-155497632),i=vh(i,c,u,t,e[10],23,-1094730640),t=vh(t,i,c,u,e[13],4,681279174),u=vh(u,t,i,c,e[0],11,-358537222),c=vh(c,u,t,i,e[3],16,-722521979),i=vh(i,c,u,t,e[6],23,76029189),t=vh(t,i,c,u,e[9],4,-640364487),u=vh(u,t,i,c,e[12],11,-421815835),c=vh(c,u,t,i,e[15],16,530742520),t=xh(t,i=vh(i,c,u,t,e[2],23,-995338651),c,u,e[0],6,-198630844),u=xh(u,t,i,c,e[7],10,1126891415),c=xh(c,u,t,i,e[14],15,-1416354905),i=xh(i,c,u,t,e[5],21,-57434055),t=xh(t,i,c,u,e[12],6,1700485571),u=xh(u,t,i,c,e[3],10,-1894986606),c=xh(c,u,t,i,e[10],15,-1051523),i=xh(i,c,u,t,e[1],21,-2054922799),t=xh(t,i,c,u,e[8],6,1873313359),u=xh(u,t,i,c,e[15],10,-30611744),c=xh(c,u,t,i,e[6],15,-1560198380),i=xh(i,c,u,t,e[13],21,1309151649),t=xh(t,i,c,u,e[4],6,-145523070),u=xh(u,t,i,c,e[11],10,-1120210379),c=xh(c,u,t,i,e[2],15,718787259),i=xh(i,c,u,t,e[9],21,-343485551),n[0]=tm(t,n[0]),n[1]=tm(i,n[1]),n[2]=tm(c,n[2]),n[3]=tm(u,n[3])}function ex(n,e,t,i,c,u){return e=tm(tm(e,n),tm(i,u)),tm(e<<c|e>>>32-c,t)}function yh(n,e,t,i,c,u,m){return ex(e&t|~e&i,n,e,c,u,m)}function _h(n,e,t,i,c,u,m){return ex(e&i|t&~i,n,e,c,u,m)}function vh(n,e,t,i,c,u,m){return ex(e^t^i,n,e,c,u,m)}function xh(n,e,t,i,c,u,m){return ex(t^(e|~i),n,e,c,u,m)}function j6(n){var e,t=n.length,i=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=n.length;e+=64)Lb(i,$R(n.substring(e-64,e)));n=n.substring(e-64);var c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<n.length;e++)c[e>>2]|=n.charCodeAt(e)<<(e%4<<3);if(c[e>>2]|=128<<(e%4<<3),e>55)for(Lb(i,c),e=0;e<16;e++)c[e]=0;return c[14]=8*t,Lb(i,c),i}function $R(n){var e,t=[];for(e=0;e<64;e+=4)t[e>>2]=n.charCodeAt(e)+(n.charCodeAt(e+1)<<8)+(n.charCodeAt(e+2)<<16)+(n.charCodeAt(e+3)<<24);return t}var TS="0123456789abcdef".split("");function GR(n){for(var e="",t=0;t<4;t++)e+=TS[n>>8*t+4&15]+TS[n>>8*t&15];return e}function HR(n){return String.fromCharCode(255&n,(65280&n)>>8,(16711680&n)>>16,(4278190080&n)>>24)}function S5(n){return j6(n).map(HR).join("")}var WR=(function(n){for(var e=0;e<n.length;e++)n[e]=GR(n[e]);return n.join("")})(j6("hello"))!="5d41402abc4b2a76b9719d911017c592";function tm(n,e){if(WR){var t=(65535&n)+(65535&e);return(n>>16)+(e>>16)+(t>>16)<<16|65535&t}return n+e&4294967295}/**
 * @license
 * FPDF is released under a permissive license: there is no usage restriction.
 * You may embed it freely in your application (commercial or not), with or
 * without modifications.
 *
 * Reference: http://www.fpdf.org/en/script/script37.php
 */function E5(n,e){var t,i,c,u;if(n!==t){for(var m=(c=n,u=1+(256/n.length|0),new Array(u+1).join(c)),_=[],o=0;o<256;o++)_[o]=o;var b=0;for(o=0;o<256;o++){var I=_[o];b=(b+I+m.charCodeAt(o))%256,_[o]=_[b],_[b]=I}t=n,i=_}else _=i;var M=e.length,V=0,k=0,ie="";for(o=0;o<M;o++)k=(k+(I=_[V=(V+1)%256]))%256,_[V]=_[k],_[k]=I,m=_[(_[V]+_[k])%256],ie+=String.fromCharCode(e.charCodeAt(o)^m);return ie}/**
 * @license
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 * Author: Owen Leong (@owenl131)
 * Date: 15 Oct 2020
 * References:
 * https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
 * https://github.com/foliojs/pdfkit/blob/master/lib/security.js
 * http://www.fpdf.org/en/script/script37.php
 */var IS={print:4,modify:8,copy:16,"annot-forms":32};function e0(n,e,t,i){this.v=1,this.r=2;var c=192;n.forEach(function(_){if(IS.perm!==void 0)throw new Error("Invalid permission: "+_);c+=IS[_]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var u=(e+this.padding).substr(0,32),m=(t+this.padding).substr(0,32);this.O=this.processOwnerPassword(u,m),this.P=-(1+(255^c)),this.encryptionKey=S5(u+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(i)).substr(0,5),this.U=E5(this.encryptionKey,this.padding)}function t0(n){if(/[^\u0000-\u00ff]/.test(n))throw new Error("Invalid PDF Name Object: "+n+", Only accept ASCII characters.");for(var e="",t=n.length,i=0;i<t;i++){var c=n.charCodeAt(i);e+=c<33||c===35||c===37||c===40||c===41||c===47||c===60||c===62||c===91||c===93||c===123||c===125||c>126?"#"+("0"+c.toString(16)).slice(-2):n[i]}return e}function CS(n){if(wa(n)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var e={};this.subscribe=function(t,i,c){if(c=c||!1,typeof t!="string"||typeof i!="function"||typeof c!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");e.hasOwnProperty(t)||(e[t]={});var u=Math.random().toString(35);return e[t][u]=[i,!!c],u},this.unsubscribe=function(t){for(var i in e)if(e[i][t])return delete e[i][t],Object.keys(e[i]).length===0&&delete e[i],!0;return!1},this.publish=function(t){if(e.hasOwnProperty(t)){var i=Array.prototype.slice.call(arguments,1),c=[];for(var u in e[t]){var m=e[t][u];try{m[0].apply(n,i)}catch(_){oo.console&&Ka.error("jsPDF PubSub Error",_.message,_)}m[1]&&c.push(u)}c.length&&c.forEach(this.unsubscribe)}},this.getTopics=function(){return e}}function mv(n){if(!(this instanceof mv))return new mv(n);var e="opacity,stroke-opacity".split(",");for(var t in n)n.hasOwnProperty(t)&&e.indexOf(t)>=0&&(this[t]=n[t]);this.id="",this.objectNumber=-1}function U6(n,e){this.gState=n,this.matrix=e,this.id="",this.objectNumber=-1}function Km(n,e,t,i,c){if(!(this instanceof Km))return new Km(n,e,t,i,c);this.type=n==="axial"?2:3,this.coords=e,this.colors=t,U6.call(this,i,c)}function a0(n,e,t,i,c){if(!(this instanceof a0))return new a0(n,e,t,i,c);this.boundingBox=n,this.xStep=e,this.yStep=t,this.stream="",this.cloneIndex=0,U6.call(this,i,c)}function Si(n){var e,t=typeof arguments[0]=="string"?arguments[0]:"p",i=arguments[1],c=arguments[2],u=arguments[3],m=[],_=1,o=16,b="S",I=null;wa(n=n||{})==="object"&&(t=n.orientation,i=n.unit||i,c=n.format||c,u=n.compress||n.compressPdf||u,(I=n.encryption||null)!==null&&(I.userPassword=I.userPassword||"",I.ownerPassword=I.ownerPassword||"",I.userPermissions=I.userPermissions||[]),_=typeof n.userUnit=="number"?Math.abs(n.userUnit):1,n.precision!==void 0&&(e=n.precision),n.floatPrecision!==void 0&&(o=n.floatPrecision),b=n.defaultPathOperation||"S"),m=n.filters||(u===!0?["FlateEncode"]:m),i=i||"mm",t=(""+(t||"P")).toLowerCase();var M=n.putOnlyUsedFonts||!1,V={},k={internal:{},__private__:{}};k.__private__.PubSub=CS;var ie="1.3",se=k.__private__.getPdfVersion=function(){return ie};k.__private__.setPdfVersion=function(W){ie=W};var fe={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};k.__private__.getPageFormats=function(){return fe};var J=k.__private__.getPageFormat=function(W){return fe[W]};c=c||"a4";var ne="compat",me="advanced",ue=ne;function ke(){this.saveGraphicsState(),st(new Pt(Ir,0,0,-Ir,0,Hs()*Ir).toString()+" cm"),this.setFontSize(this.getFontSize()/Ir),b="n",ue=me}function je(){this.restoreGraphicsState(),b="S",ue=ne}var pe=k.__private__.combineFontStyleAndFontWeight=function(W,Ce){if(W=="bold"&&Ce=="normal"||W=="bold"&&Ce==400||W=="normal"&&Ce=="italic"||W=="bold"&&Ce=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return Ce&&(W=Ce==400||Ce==="normal"?W==="italic"?"italic":"normal":Ce!=700&&Ce!=="bold"||W!=="normal"?(Ce==700?"bold":Ce)+""+W:"bold"),W};k.advancedAPI=function(W){var Ce=ue===ne;return Ce&&ke.call(this),typeof W!="function"||(W(this),Ce&&je.call(this)),this},k.compatAPI=function(W){var Ce=ue===me;return Ce&&je.call(this),typeof W!="function"||(W(this),Ce&&ke.call(this)),this},k.isAdvancedAPI=function(){return ue===me};var U,F=function(W){if(ue!==me)throw new Error(W+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},q=k.roundToPrecision=k.__private__.roundToPrecision=function(W,Ce){var pt=e||Ce;if(isNaN(W)||isNaN(pt))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return W.toFixed(pt).replace(/0+$/,"")};U=k.hpf=k.__private__.hpf=typeof o=="number"?function(W){if(isNaN(W))throw new Error("Invalid argument passed to jsPDF.hpf");return q(W,o)}:o==="smart"?function(W){if(isNaN(W))throw new Error("Invalid argument passed to jsPDF.hpf");return q(W,W>-1&&W<1?16:5)}:function(W){if(isNaN(W))throw new Error("Invalid argument passed to jsPDF.hpf");return q(W,16)};var j=k.f2=k.__private__.f2=function(W){if(isNaN(W))throw new Error("Invalid argument passed to jsPDF.f2");return q(W,2)},H=k.__private__.f3=function(W){if(isNaN(W))throw new Error("Invalid argument passed to jsPDF.f3");return q(W,3)},Z=k.scale=k.__private__.scale=function(W){if(isNaN(W))throw new Error("Invalid argument passed to jsPDF.scale");return ue===ne?W*Ir:ue===me?W:void 0},be=function(W){return Z((function(Ce){return ue===ne?Hs()-Ce:ue===me?Ce:void 0})(W))};k.__private__.setPrecision=k.setPrecision=function(W){typeof parseInt(W,10)=="number"&&(e=parseInt(W,10))};var Re,Oe="00000000000000000000000000000000",Ne=k.__private__.getFileId=function(){return Oe},we=k.__private__.setFileId=function(W){return Oe=W!==void 0&&/^[a-fA-F0-9]{32}$/.test(W)?W.toUpperCase():Oe.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),I!==null&&(zr=new e0(I.userPermissions,I.userPassword,I.ownerPassword,Oe)),Oe};k.setFileId=function(W){return we(W),this},k.getFileId=function(){return Ne()};var Fe=k.__private__.convertDateToPDFDate=function(W){var Ce=W.getTimezoneOffset(),pt=Ce<0?"+":"-",yt=Math.floor(Math.abs(Ce/60)),qt=Math.abs(Ce%60),Zt=[pt,Be(yt),"'",Be(qt),"'"].join("");return["D:",W.getFullYear(),Be(W.getMonth()+1),Be(W.getDate()),Be(W.getHours()),Be(W.getMinutes()),Be(W.getSeconds()),Zt].join("")},nt=k.__private__.convertPDFDateToDate=function(W){var Ce=parseInt(W.substr(2,4),10),pt=parseInt(W.substr(6,2),10)-1,yt=parseInt(W.substr(8,2),10),qt=parseInt(W.substr(10,2),10),Zt=parseInt(W.substr(12,2),10),Fn=parseInt(W.substr(14,2),10);return new Date(Ce,pt,yt,qt,Zt,Fn,0)},xe=k.__private__.setCreationDate=function(W){var Ce;if(W===void 0&&(W=new Date),W instanceof Date)Ce=Fe(W);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(W))throw new Error("Invalid argument passed to jsPDF.setCreationDate");Ce=W}return Re=Ce},le=k.__private__.getCreationDate=function(W){var Ce=Re;return W==="jsDate"&&(Ce=nt(Re)),Ce};k.setCreationDate=function(W){return xe(W),this},k.getCreationDate=function(W){return le(W)};var De,Be=k.__private__.padd2=function(W){return("0"+parseInt(W)).slice(-2)},Ye=k.__private__.padd2Hex=function(W){return("00"+(W=W.toString())).substr(W.length)},rt=0,mt=[],ft=[],Dt=0,Yt=[],cn=[],gn=!1,Mn=ft;k.__private__.setCustomOutputDestination=function(W){gn=!0,Mn=W};var Gt=function(W){gn||(Mn=W)};k.__private__.resetCustomOutputDestination=function(){gn=!1,Mn=ft};var st=k.__private__.out=function(W){return W=W.toString(),Dt+=W.length+1,Mn.push(W),Mn},mr=k.__private__.write=function(W){return st(arguments.length===1?W.toString():Array.prototype.join.call(arguments," "))},Er=k.__private__.getArrayBuffer=function(W){for(var Ce=W.length,pt=new ArrayBuffer(Ce),yt=new Uint8Array(pt);Ce--;)yt[Ce]=W.charCodeAt(Ce);return pt},Cr=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];k.__private__.getStandardFonts=function(){return Cr};var Ln=n.fontSize||16;k.__private__.setFontSize=k.setFontSize=function(W){return Ln=ue===me?W/Ir:W,this};var ir,er=k.__private__.getFontSize=k.getFontSize=function(){return ue===ne?Ln:Ln*Ir},Yr=n.R2L||!1;k.__private__.setR2L=k.setR2L=function(W){return Yr=W,this},k.__private__.getR2L=k.getR2L=function(){return Yr};var Vt,Pn=k.__private__.setZoomMode=function(W){if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(W))ir=W;else if(isNaN(W)){if([void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(W)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+W+'" is not recognized.');ir=W}else ir=parseInt(W,10)};k.__private__.getZoomMode=function(){return ir};var Gn,Dn=k.__private__.setPageMode=function(W){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(W)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+W+'" is not recognized.');Vt=W};k.__private__.getPageMode=function(){return Vt};var Mr=k.__private__.setLayoutMode=function(W){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(W)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+W+'" is not recognized.');Gn=W};k.__private__.getLayoutMode=function(){return Gn},k.__private__.setDisplayMode=k.setDisplayMode=function(W,Ce,pt){return Pn(W),Mr(Ce),Dn(pt),this};var wr={title:"",subject:"",author:"",keywords:"",creator:""};k.__private__.getDocumentProperty=function(W){if(Object.keys(wr).indexOf(W)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return wr[W]},k.__private__.getDocumentProperties=function(){return wr},k.__private__.setDocumentProperties=k.setProperties=k.setDocumentProperties=function(W){for(var Ce in wr)wr.hasOwnProperty(Ce)&&W[Ce]&&(wr[Ce]=W[Ce]);return this},k.__private__.setDocumentProperty=function(W,Ce){if(Object.keys(wr).indexOf(W)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return wr[W]=Ce};var Tr,Ir,Pr,Ei,Pi,or={},oi={},Kr=[],Br={},di={},si={},ut={},Ee=null,Ie=0,Qe=[],ht=new CS(k),Ct=n.hotfixes||[],Mt={},Bt={},Et=[],Pt=function W(Ce,pt,yt,qt,Zt,Fn){if(!(this instanceof W))return new W(Ce,pt,yt,qt,Zt,Fn);isNaN(Ce)&&(Ce=1),isNaN(pt)&&(pt=0),isNaN(yt)&&(yt=0),isNaN(qt)&&(qt=1),isNaN(Zt)&&(Zt=0),isNaN(Fn)&&(Fn=0),this._matrix=[Ce,pt,yt,qt,Zt,Fn]};Object.defineProperty(Pt.prototype,"sx",{get:function(){return this._matrix[0]},set:function(W){this._matrix[0]=W}}),Object.defineProperty(Pt.prototype,"shy",{get:function(){return this._matrix[1]},set:function(W){this._matrix[1]=W}}),Object.defineProperty(Pt.prototype,"shx",{get:function(){return this._matrix[2]},set:function(W){this._matrix[2]=W}}),Object.defineProperty(Pt.prototype,"sy",{get:function(){return this._matrix[3]},set:function(W){this._matrix[3]=W}}),Object.defineProperty(Pt.prototype,"tx",{get:function(){return this._matrix[4]},set:function(W){this._matrix[4]=W}}),Object.defineProperty(Pt.prototype,"ty",{get:function(){return this._matrix[5]},set:function(W){this._matrix[5]=W}}),Object.defineProperty(Pt.prototype,"a",{get:function(){return this._matrix[0]},set:function(W){this._matrix[0]=W}}),Object.defineProperty(Pt.prototype,"b",{get:function(){return this._matrix[1]},set:function(W){this._matrix[1]=W}}),Object.defineProperty(Pt.prototype,"c",{get:function(){return this._matrix[2]},set:function(W){this._matrix[2]=W}}),Object.defineProperty(Pt.prototype,"d",{get:function(){return this._matrix[3]},set:function(W){this._matrix[3]=W}}),Object.defineProperty(Pt.prototype,"e",{get:function(){return this._matrix[4]},set:function(W){this._matrix[4]=W}}),Object.defineProperty(Pt.prototype,"f",{get:function(){return this._matrix[5]},set:function(W){this._matrix[5]=W}}),Object.defineProperty(Pt.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(Pt.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(Pt.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(Pt.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),Pt.prototype.join=function(W){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(U).join(W)},Pt.prototype.multiply=function(W){var Ce=W.sx*this.sx+W.shy*this.shx,pt=W.sx*this.shy+W.shy*this.sy,yt=W.shx*this.sx+W.sy*this.shx,qt=W.shx*this.shy+W.sy*this.sy,Zt=W.tx*this.sx+W.ty*this.shx+this.tx,Fn=W.tx*this.shy+W.ty*this.sy+this.ty;return new Pt(Ce,pt,yt,qt,Zt,Fn)},Pt.prototype.decompose=function(){var W=this.sx,Ce=this.shy,pt=this.shx,yt=this.sy,qt=this.tx,Zt=this.ty,Fn=Math.sqrt(W*W+Ce*Ce),Dr=(W/=Fn)*pt+(Ce/=Fn)*yt;pt-=W*Dr,yt-=Ce*Dr;var Xr=Math.sqrt(pt*pt+yt*yt);return Dr/=Xr,W*(yt/=Xr)<Ce*(pt/=Xr)&&(W=-W,Ce=-Ce,Dr=-Dr,Fn=-Fn),{scale:new Pt(Fn,0,0,Xr,0,0),translate:new Pt(1,0,0,1,qt,Zt),rotate:new Pt(W,Ce,-Ce,W,0,0),skew:new Pt(1,0,Dr,1,0,0)}},Pt.prototype.toString=function(W){return this.join(" ")},Pt.prototype.inversed=function(){var W=this.sx,Ce=this.shy,pt=this.shx,yt=this.sy,qt=this.tx,Zt=this.ty,Fn=1/(W*yt-Ce*pt),Dr=yt*Fn,Xr=-Ce*Fn,yi=-pt*Fn,Ii=W*Fn;return new Pt(Dr,Xr,yi,Ii,-Dr*qt-yi*Zt,-Xr*qt-Ii*Zt)},Pt.prototype.applyToPoint=function(W){var Ce=W.x*this.sx+W.y*this.shx+this.tx,pt=W.x*this.shy+W.y*this.sy+this.ty;return new ll(Ce,pt)},Pt.prototype.applyToRectangle=function(W){var Ce=this.applyToPoint(W),pt=this.applyToPoint(new ll(W.x+W.w,W.y+W.h));return new ru(Ce.x,Ce.y,pt.x-Ce.x,pt.y-Ce.y)},Pt.prototype.clone=function(){var W=this.sx,Ce=this.shy,pt=this.shx,yt=this.sy,qt=this.tx,Zt=this.ty;return new Pt(W,Ce,pt,yt,qt,Zt)},k.Matrix=Pt;var vn=k.matrixMult=function(W,Ce){return Ce.multiply(W)},Bn=new Pt(1,0,0,1,0,0);k.unitMatrix=k.identityMatrix=Bn;var Tn=function(W,Ce){if(!di[W]){var pt=(Ce instanceof Km?"Sh":"P")+(Object.keys(Br).length+1).toString(10);Ce.id=pt,di[W]=pt,Br[pt]=Ce,ht.publish("addPattern",Ce)}};k.ShadingPattern=Km,k.TilingPattern=a0,k.addShadingPattern=function(W,Ce){return F("addShadingPattern()"),Tn(W,Ce),this},k.beginTilingPattern=function(W){F("beginTilingPattern()"),qs(W.boundingBox[0],W.boundingBox[1],W.boundingBox[2]-W.boundingBox[0],W.boundingBox[3]-W.boundingBox[1],W.matrix)},k.endTilingPattern=function(W,Ce){F("endTilingPattern()"),Ce.stream=cn[De].join(`
`),Tn(W,Ce),ht.publish("endTilingPattern",Ce),Et.pop().restore()};var kr,Lr=k.__private__.newObject=function(){var W=Vr();return Ar(W,!0),W},Vr=k.__private__.newObjectDeferred=function(){return rt++,mt[rt]=function(){return Dt},rt},Ar=function(W,Ce){return Ce=typeof Ce=="boolean"&&Ce,mt[W]=Dt,Ce&&st(W+" 0 obj"),W},Ai=k.__private__.newAdditionalObject=function(){var W={objId:Vr(),content:""};return Yt.push(W),W},no=Vr(),yo=Vr(),$o=k.__private__.decodeColorString=function(W){var Ce=W.split(" ");if(Ce.length!==2||Ce[1]!=="g"&&Ce[1]!=="G")Ce.length!==5||Ce[4]!=="k"&&Ce[4]!=="K"||(Ce=[(1-Ce[0])*(1-Ce[3]),(1-Ce[1])*(1-Ce[3]),(1-Ce[2])*(1-Ce[3]),"r"]);else{var pt=parseFloat(Ce[0]);Ce=[pt,pt,pt,"r"]}for(var yt="#",qt=0;qt<3;qt++)yt+=("0"+Math.floor(255*parseFloat(Ce[qt])).toString(16)).slice(-2);return yt},ro=k.__private__.encodeColorString=function(W){var Ce;typeof W=="string"&&(W={ch1:W});var pt=W.ch1,yt=W.ch2,qt=W.ch3,Zt=W.ch4,Fn=W.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof pt=="string"&&pt.charAt(0)!=="#"){var Dr=new z6(pt);if(Dr.ok)pt=Dr.toHex();else if(!/^\d*\.?\d*$/.test(pt))throw new Error('Invalid color "'+pt+'" passed to jsPDF.encodeColorString.')}if(typeof pt=="string"&&/^#[0-9A-Fa-f]{3}$/.test(pt)&&(pt="#"+pt[1]+pt[1]+pt[2]+pt[2]+pt[3]+pt[3]),typeof pt=="string"&&/^#[0-9A-Fa-f]{6}$/.test(pt)){var Xr=parseInt(pt.substr(1),16);pt=Xr>>16&255,yt=Xr>>8&255,qt=255&Xr}if(yt===void 0||Zt===void 0&&pt===yt&&yt===qt)Ce=typeof pt=="string"?pt+" "+Fn[0]:W.precision===2?j(pt/255)+" "+Fn[0]:H(pt/255)+" "+Fn[0];else if(Zt===void 0||wa(Zt)==="object"){if(Zt&&!isNaN(Zt.a)&&Zt.a===0)return["1.","1.","1.",Fn[1]].join(" ");Ce=typeof pt=="string"?[pt,yt,qt,Fn[1]].join(" "):W.precision===2?[j(pt/255),j(yt/255),j(qt/255),Fn[1]].join(" "):[H(pt/255),H(yt/255),H(qt/255),Fn[1]].join(" ")}else Ce=typeof pt=="string"?[pt,yt,qt,Zt,Fn[2]].join(" "):W.precision===2?[j(pt),j(yt),j(qt),j(Zt),Fn[2]].join(" "):[H(pt),H(yt),H(qt),H(Zt),Fn[2]].join(" ");return Ce},ys=k.__private__.getFilters=function(){return m},io=k.__private__.putStream=function(W){var Ce=(W=W||{}).data||"",pt=W.filters||ys(),yt=W.alreadyAppliedFilters||[],qt=W.addLength1||!1,Zt=Ce.length,Fn=W.objectId,Dr=function(zo){return zo};if(I!==null&&Fn===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");I!==null&&(Dr=zr.encryptor(Fn,0));var Xr={};pt===!0&&(pt=["FlateEncode"]);var yi=W.additionalKeyValues||[],Ii=(Xr=Si.API.processDataByFilters!==void 0?Si.API.processDataByFilters(Ce,pt):{data:Ce,reverseChain:[]}).reverseChain+(Array.isArray(yt)?yt.join(" "):yt.toString());if(Xr.data.length!==0&&(yi.push({key:"Length",value:Xr.data.length}),qt===!0&&yi.push({key:"Length1",value:Zt})),Ii.length!=0)if(Ii.split("/").length-1==1)yi.push({key:"Filter",value:Ii});else{yi.push({key:"Filter",value:"["+Ii+"]"});for(var xo=0;xo<yi.length;xo+=1)if(yi[xo].key==="DecodeParms"){for(var bo=[],Yo=0;Yo<Xr.reverseChain.split("/").length-1;Yo+=1)bo.push("null");bo.push(yi[xo].value),yi[xo].value="["+bo.join(" ")+"]"}}st("<<");for(var Ro=0;Ro<yi.length;Ro++)st("/"+yi[Ro].key+" "+yi[Ro].value);st(">>"),Xr.data.length!==0&&(st("stream"),st(Dr(Xr.data)),st("endstream"))},Is=k.__private__.putPage=function(W){var Ce=W.number,pt=W.data,yt=W.objId,qt=W.contentsObjId;Ar(yt,!0),st("<</Type /Page"),st("/Parent "+W.rootDictionaryObjId+" 0 R"),st("/Resources "+W.resourceDictionaryObjId+" 0 R"),st("/MediaBox ["+parseFloat(U(W.mediaBox.bottomLeftX))+" "+parseFloat(U(W.mediaBox.bottomLeftY))+" "+U(W.mediaBox.topRightX)+" "+U(W.mediaBox.topRightY)+"]"),W.cropBox!==null&&st("/CropBox ["+U(W.cropBox.bottomLeftX)+" "+U(W.cropBox.bottomLeftY)+" "+U(W.cropBox.topRightX)+" "+U(W.cropBox.topRightY)+"]"),W.bleedBox!==null&&st("/BleedBox ["+U(W.bleedBox.bottomLeftX)+" "+U(W.bleedBox.bottomLeftY)+" "+U(W.bleedBox.topRightX)+" "+U(W.bleedBox.topRightY)+"]"),W.trimBox!==null&&st("/TrimBox ["+U(W.trimBox.bottomLeftX)+" "+U(W.trimBox.bottomLeftY)+" "+U(W.trimBox.topRightX)+" "+U(W.trimBox.topRightY)+"]"),W.artBox!==null&&st("/ArtBox ["+U(W.artBox.bottomLeftX)+" "+U(W.artBox.bottomLeftY)+" "+U(W.artBox.topRightX)+" "+U(W.artBox.topRightY)+"]"),typeof W.userUnit=="number"&&W.userUnit!==1&&st("/UserUnit "+W.userUnit),ht.publish("putPage",{objId:yt,pageContext:Qe[Ce],pageNumber:Ce,page:pt}),st("/Contents "+qt+" 0 R"),st(">>"),st("endobj");var Zt=pt.join(`
`);return ue===me&&(Zt+=`
Q`),Ar(qt,!0),io({data:Zt,filters:ys(),objectId:qt}),st("endobj"),yt},ga=k.__private__.putPages=function(){var W,Ce,pt=[];for(W=1;W<=Ie;W++)Qe[W].objId=Vr(),Qe[W].contentsObjId=Vr();for(W=1;W<=Ie;W++)pt.push(Is({number:W,data:cn[W],objId:Qe[W].objId,contentsObjId:Qe[W].contentsObjId,mediaBox:Qe[W].mediaBox,cropBox:Qe[W].cropBox,bleedBox:Qe[W].bleedBox,trimBox:Qe[W].trimBox,artBox:Qe[W].artBox,userUnit:Qe[W].userUnit,rootDictionaryObjId:no,resourceDictionaryObjId:yo}));Ar(no,!0),st("<</Type /Pages");var yt="/Kids [";for(Ce=0;Ce<Ie;Ce++)yt+=pt[Ce]+" 0 R ";st(yt+"]"),st("/Count "+Ie),st(">>"),st("endobj"),ht.publish("postPutPages")},gl=function(W){ht.publish("putFont",{font:W,out:st,newObject:Lr,putStream:io}),W.isAlreadyPutted!==!0&&(W.objectNumber=Lr(),st("<<"),st("/Type /Font"),st("/BaseFont /"+t0(W.postScriptName)),st("/Subtype /Type1"),typeof W.encoding=="string"&&st("/Encoding /"+W.encoding),st("/FirstChar 32"),st("/LastChar 255"),st(">>"),st("endobj"))},sl=function(W){W.objectNumber=Lr();var Ce=[];Ce.push({key:"Type",value:"/XObject"}),Ce.push({key:"Subtype",value:"/Form"}),Ce.push({key:"BBox",value:"["+[U(W.x),U(W.y),U(W.x+W.width),U(W.y+W.height)].join(" ")+"]"}),Ce.push({key:"Matrix",value:"["+W.matrix.toString()+"]"});var pt=W.pages[1].join(`
`);io({data:pt,additionalKeyValues:Ce,objectId:W.objectNumber}),st("endobj")},Wi=function(W,Ce){Ce||(Ce=21);var pt=Lr(),yt=(function(Fn,Dr){var Xr,yi=[],Ii=1/(Dr-1);for(Xr=0;Xr<1;Xr+=Ii)yi.push(Xr);if(yi.push(1),Fn[0].offset!=0){var xo={offset:0,color:Fn[0].color};Fn.unshift(xo)}if(Fn[Fn.length-1].offset!=1){var bo={offset:1,color:Fn[Fn.length-1].color};Fn.push(bo)}for(var Yo="",Ro=0,zo=0;zo<yi.length;zo++){for(Xr=yi[zo];Xr>Fn[Ro+1].offset;)Ro++;var Jo=Fn[Ro].offset,us=(Xr-Jo)/(Fn[Ro+1].offset-Jo),jo=Fn[Ro].color,Es=Fn[Ro+1].color;Yo+=Ye(Math.round((1-us)*jo[0]+us*Es[0]).toString(16))+Ye(Math.round((1-us)*jo[1]+us*Es[1]).toString(16))+Ye(Math.round((1-us)*jo[2]+us*Es[2]).toString(16))}return Yo.trim()})(W.colors,Ce),qt=[];qt.push({key:"FunctionType",value:"0"}),qt.push({key:"Domain",value:"[0.0 1.0]"}),qt.push({key:"Size",value:"["+Ce+"]"}),qt.push({key:"BitsPerSample",value:"8"}),qt.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),qt.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),io({data:yt,additionalKeyValues:qt,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:pt}),st("endobj"),W.objectNumber=Lr(),st("<< /ShadingType "+W.type),st("/ColorSpace /DeviceRGB");var Zt="/Coords ["+U(parseFloat(W.coords[0]))+" "+U(parseFloat(W.coords[1]))+" ";W.type===2?Zt+=U(parseFloat(W.coords[2]))+" "+U(parseFloat(W.coords[3])):Zt+=U(parseFloat(W.coords[2]))+" "+U(parseFloat(W.coords[3]))+" "+U(parseFloat(W.coords[4]))+" "+U(parseFloat(W.coords[5])),st(Zt+="]"),W.matrix&&st("/Matrix ["+W.matrix.toString()+"]"),st("/Function "+pt+" 0 R"),st("/Extend [true true]"),st(">>"),st("endobj")},Jl=function(W,Ce){var pt=Vr(),yt=Lr();Ce.push({resourcesOid:pt,objectOid:yt}),W.objectNumber=yt;var qt=[];qt.push({key:"Type",value:"/Pattern"}),qt.push({key:"PatternType",value:"1"}),qt.push({key:"PaintType",value:"1"}),qt.push({key:"TilingType",value:"1"}),qt.push({key:"BBox",value:"["+W.boundingBox.map(U).join(" ")+"]"}),qt.push({key:"XStep",value:U(W.xStep)}),qt.push({key:"YStep",value:U(W.yStep)}),qt.push({key:"Resources",value:pt+" 0 R"}),W.matrix&&qt.push({key:"Matrix",value:"["+W.matrix.toString()+"]"}),io({data:W.stream,additionalKeyValues:qt,objectId:W.objectNumber}),st("endobj")},Lu=function(W){for(var Ce in W.objectNumber=Lr(),st("<<"),W)switch(Ce){case"opacity":st("/ca "+j(W[Ce]));break;case"stroke-opacity":st("/CA "+j(W[Ce]))}st(">>"),st("endobj")},Eo=function(W){Ar(W.resourcesOid,!0),st("<<"),st("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),(function(){for(var Ce in st("/Font <<"),or)or.hasOwnProperty(Ce)&&(M===!1||M===!0&&V.hasOwnProperty(Ce))&&st("/"+Ce+" "+or[Ce].objectNumber+" 0 R");st(">>")})(),(function(){if(Object.keys(Br).length>0){for(var Ce in st("/Shading <<"),Br)Br.hasOwnProperty(Ce)&&Br[Ce]instanceof Km&&Br[Ce].objectNumber>=0&&st("/"+Ce+" "+Br[Ce].objectNumber+" 0 R");ht.publish("putShadingPatternDict"),st(">>")}})(),(function(Ce){if(Object.keys(Br).length>0){for(var pt in st("/Pattern <<"),Br)Br.hasOwnProperty(pt)&&Br[pt]instanceof k.TilingPattern&&Br[pt].objectNumber>=0&&Br[pt].objectNumber<Ce&&st("/"+pt+" "+Br[pt].objectNumber+" 0 R");ht.publish("putTilingPatternDict"),st(">>")}})(W.objectOid),(function(){if(Object.keys(si).length>0){var Ce;for(Ce in st("/ExtGState <<"),si)si.hasOwnProperty(Ce)&&si[Ce].objectNumber>=0&&st("/"+Ce+" "+si[Ce].objectNumber+" 0 R");ht.publish("putGStateDict"),st(">>")}})(),(function(){for(var Ce in st("/XObject <<"),Mt)Mt.hasOwnProperty(Ce)&&Mt[Ce].objectNumber>=0&&st("/"+Ce+" "+Mt[Ce].objectNumber+" 0 R");ht.publish("putXobjectDict"),st(">>")})(),st(">>"),st("endobj")},fu=function(W){oi[W.fontName]=oi[W.fontName]||{},oi[W.fontName][W.fontStyle]=W.id},Ea=function(W,Ce,pt,yt,qt){var Zt={id:"F"+(Object.keys(or).length+1).toString(10),postScriptName:W,fontName:Ce,fontStyle:pt,encoding:yt,isStandardFont:qt||!1,metadata:{}};return ht.publish("addFont",{font:Zt,instance:this}),or[Zt.id]=Zt,fu(Zt),Zt.id},Ko=k.__private__.pdfEscape=k.pdfEscape=function(W,Ce){return(function(pt,yt){var qt,Zt,Fn,Dr,Xr,yi,Ii,xo,bo;if(Fn=(yt=yt||{}).sourceEncoding||"Unicode",Xr=yt.outputEncoding,(yt.autoencode||Xr)&&or[Tr].metadata&&or[Tr].metadata[Fn]&&or[Tr].metadata[Fn].encoding&&(Dr=or[Tr].metadata[Fn].encoding,!Xr&&or[Tr].encoding&&(Xr=or[Tr].encoding),!Xr&&Dr.codePages&&(Xr=Dr.codePages[0]),typeof Xr=="string"&&(Xr=Dr[Xr]),Xr)){for(Ii=!1,yi=[],qt=0,Zt=pt.length;qt<Zt;qt++)(xo=Xr[pt.charCodeAt(qt)])?yi.push(String.fromCharCode(xo)):yi.push(pt[qt]),yi[qt].charCodeAt(0)>>8&&(Ii=!0);pt=yi.join("")}for(qt=pt.length;Ii===void 0&&qt!==0;)pt.charCodeAt(qt-1)>>8&&(Ii=!0),qt--;if(!Ii)return pt;for(yi=yt.noBOM?[]:[254,255],qt=0,Zt=pt.length;qt<Zt;qt++){if((bo=(xo=pt.charCodeAt(qt))>>8)>>8)throw new Error("Character at position "+qt+" of string '"+pt+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");yi.push(bo),yi.push(xo-(bo<<8))}return String.fromCharCode.apply(void 0,yi)})(W,Ce).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Xa=k.__private__.beginPage=function(W){cn[++Ie]=[],Qe[Ie]={objId:0,contentsObjId:0,userUnit:Number(_),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(W[0]),topRightY:Number(W[1])}},Aa(Ie),Gt(cn[De])},Nl=function(W,Ce){var pt,yt,qt;switch(t=Ce||t,typeof W=="string"&&(pt=J(W.toLowerCase()),Array.isArray(pt)&&(yt=pt[0],qt=pt[1])),Array.isArray(W)&&(yt=W[0]*Ir,qt=W[1]*Ir),isNaN(yt)&&(yt=c[0],qt=c[1]),(yt>14400||qt>14400)&&(Ka.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),yt=Math.min(14400,yt),qt=Math.min(14400,qt)),c=[yt,qt],t.substr(0,1)){case"l":qt>yt&&(c=[qt,yt]);break;case"p":yt>qt&&(c=[qt,yt])}Xa(c),Zo(Fa),st(vo),Ho!==0&&st(Ho+" J"),ya!==0&&st(ya+" j"),ht.publish("addPage",{pageNumber:Ie})},Ql=function(W){W>0&&W<=Ie&&(cn.splice(W,1),Qe.splice(W,1),Ie--,De>Ie&&(De=Ie),this.setPage(De))},Aa=function(W){W>0&&W<=Ie&&(De=W)},sa=k.__private__.getNumberOfPages=k.getNumberOfPages=function(){return cn.length-1},dn=function(W,Ce,pt){var yt,qt=void 0;return pt=pt||{},W=W!==void 0?W:or[Tr].fontName,Ce=Ce!==void 0?Ce:or[Tr].fontStyle,yt=W.toLowerCase(),oi[yt]!==void 0&&oi[yt][Ce]!==void 0?qt=oi[yt][Ce]:oi[W]!==void 0&&oi[W][Ce]!==void 0?qt=oi[W][Ce]:pt.disableWarning===!1&&Ka.warn("Unable to look up font label for font '"+W+"', '"+Ce+"'. Refer to getFontList() for available fonts."),qt||pt.noFallback||(qt=oi.times[Ce])==null&&(qt=oi.times.normal),qt},Xo=k.__private__.putInfo=function(){var W=Lr(),Ce=function(yt){return yt};for(var pt in I!==null&&(Ce=zr.encryptor(W,0)),st("<<"),st("/Producer ("+Ko(Ce("jsPDF "+Si.version))+")"),wr)wr.hasOwnProperty(pt)&&wr[pt]&&st("/"+pt.substr(0,1).toUpperCase()+pt.substr(1)+" ("+Ko(Ce(wr[pt]))+")");st("/CreationDate ("+Ko(Ce(Re))+")"),st(">>"),st("endobj")},ss=k.__private__.putCatalog=function(W){var Ce=(W=W||{}).rootDictionaryObjId||no;switch(Lr(),st("<<"),st("/Type /Catalog"),st("/Pages "+Ce+" 0 R"),ir||(ir="fullwidth"),ir){case"fullwidth":st("/OpenAction [3 0 R /FitH null]");break;case"fullheight":st("/OpenAction [3 0 R /FitV null]");break;case"fullpage":st("/OpenAction [3 0 R /Fit]");break;case"original":st("/OpenAction [3 0 R /XYZ null null 1]");break;default:var pt=""+ir;pt.substr(pt.length-1)==="%"&&(ir=parseInt(ir)/100),typeof ir=="number"&&st("/OpenAction [3 0 R /XYZ null null "+j(ir)+"]")}switch(Gn||(Gn="continuous"),Gn){case"continuous":st("/PageLayout /OneColumn");break;case"single":st("/PageLayout /SinglePage");break;case"two":case"twoleft":st("/PageLayout /TwoColumnLeft");break;case"tworight":st("/PageLayout /TwoColumnRight")}Vt&&st("/PageMode /"+Vt),ht.publish("putCatalog"),st(">>"),st("endobj")},xi=k.__private__.putTrailer=function(){st("trailer"),st("<<"),st("/Size "+(rt+1)),st("/Root "+rt+" 0 R"),st("/Info "+(rt-1)+" 0 R"),I!==null&&st("/Encrypt "+zr.oid+" 0 R"),st("/ID [ <"+Oe+"> <"+Oe+"> ]"),st(">>")},pu=k.__private__.putHeader=function(){st("%PDF-"+ie),st("%")},Za=k.__private__.putXRef=function(){var W="0000000000";st("xref"),st("0 "+(rt+1)),st("0000000000 65535 f ");for(var Ce=1;Ce<=rt;Ce++)typeof mt[Ce]=="function"?st((W+mt[Ce]()).slice(-10)+" 00000 n "):mt[Ce]!==void 0?st((W+mt[Ce]).slice(-10)+" 00000 n "):st("0000000000 00000 n ")},Ya=k.__private__.buildDocument=function(){var W;rt=0,Dt=0,ft=[],mt=[],Yt=[],no=Vr(),yo=Vr(),Gt(ft),ht.publish("buildDocument"),pu(),ga(),(function(){ht.publish("putAdditionalObjects");for(var pt=0;pt<Yt.length;pt++){var yt=Yt[pt];Ar(yt.objId,!0),st(yt.content),st("endobj")}ht.publish("postPutAdditionalObjects")})(),W=[],(function(){for(var pt in or)or.hasOwnProperty(pt)&&(M===!1||M===!0&&V.hasOwnProperty(pt))&&gl(or[pt])})(),(function(){var pt;for(pt in si)si.hasOwnProperty(pt)&&Lu(si[pt])})(),(function(){for(var pt in Mt)Mt.hasOwnProperty(pt)&&sl(Mt[pt])})(),(function(pt){var yt;for(yt in Br)Br.hasOwnProperty(yt)&&(Br[yt]instanceof Km?Wi(Br[yt]):Br[yt]instanceof a0&&Jl(Br[yt],pt))})(W),ht.publish("putResources"),W.forEach(Eo),Eo({resourcesOid:yo,objectOid:Number.MAX_SAFE_INTEGER}),ht.publish("postPutResources"),I!==null&&(zr.oid=Lr(),st("<<"),st("/Filter /Standard"),st("/V "+zr.v),st("/R "+zr.r),st("/U <"+zr.toHexString(zr.U)+">"),st("/O <"+zr.toHexString(zr.O)+">"),st("/P "+zr.P),st(">>"),st("endobj")),Xo(),ss();var Ce=Dt;return Za(),xi(),st("startxref"),st(""+Ce),st("%%EOF"),Gt(cn[De]),ft.join(`
`)},al=k.__private__.getBlob=function(W){return new Blob([Er(W)],{type:"application/pdf"})},Cs=k.output=k.__private__.output=(kr=function(W,Ce){switch(typeof(Ce=Ce||{})=="string"?Ce={filename:Ce}:Ce.filename=Ce.filename||"generated.pdf",W){case void 0:return Ya();case"save":k.save(Ce.filename);break;case"arraybuffer":return Er(Ya());case"blob":return al(Ya());case"bloburi":case"bloburl":if(oo.URL!==void 0&&typeof oo.URL.createObjectURL=="function")return oo.URL&&oo.URL.createObjectURL(al(Ya()))||void 0;Ka.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var pt="",yt=Ya();try{pt=AS(yt)}catch{pt=AS(unescape(encodeURIComponent(yt)))}return"data:application/pdf;filename="+Ce.filename+";base64,"+pt;case"pdfobjectnewwindow":if(Object.prototype.toString.call(oo)==="[object Window]"){var qt="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",Zt=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';Ce.pdfObjectUrl&&(qt=Ce.pdfObjectUrl,Zt="");var Fn='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+qt+'"'+Zt+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(Ce)+");<\/script></body></html>",Dr=oo.open();return Dr!==null&&Dr.document.write(Fn),Dr}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(oo)==="[object Window]"){var Xr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(Ce.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+Ce.filename+'" width="500px" height="400px" /></body></html>',yi=oo.open();if(yi!==null){yi.document.write(Xr);var Ii=this;yi.document.documentElement.querySelector("#pdfViewer").onload=function(){yi.document.title=Ce.filename,yi.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(Ii.output("bloburl"))}}return yi}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(oo)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var xo='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",Ce)+'"></iframe></body></html>',bo=oo.open();if(bo!==null&&(bo.document.write(xo),bo.document.title=Ce.filename),bo||typeof safari>"u")return bo;break;case"datauri":case"dataurl":return oo.document.location.href=this.output("datauristring",Ce);default:return null}},kr.foo=function(){try{return kr.apply(this,arguments)}catch(pt){var W=pt.stack||"";~W.indexOf(" at ")&&(W=W.split(" at ")[1]);var Ce="Error in function "+W.split(`
`)[0].split("<")[0]+": "+pt.message;if(!oo.console)throw new Error(Ce);oo.console.error(Ce,pt),oo.alert&&alert(Ce)}},kr.foo.bar=kr,kr.foo),tr=function(W){return Array.isArray(Ct)===!0&&Ct.indexOf(W)>-1};switch(i){case"pt":Ir=1;break;case"mm":Ir=72/25.4;break;case"cm":Ir=72/2.54;break;case"in":Ir=72;break;case"px":Ir=tr("px_scaling")==1?.75:96/72;break;case"pc":case"em":Ir=12;break;case"ex":Ir=6;break;default:if(typeof i!="number")throw new Error("Invalid unit: "+i);Ir=i}var zr=null;xe(),we();var Nr=k.__private__.getPageInfo=k.getPageInfo=function(W){if(isNaN(W)||W%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:Qe[W].objId,pageNumber:W,pageContext:Qe[W]}},js=k.__private__.getPageInfoByObjId=function(W){if(isNaN(W)||W%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var Ce in Qe)if(Qe[Ce].objId===W)break;return Nr(Ce)},Ta=k.__private__.getCurrentPageInfo=k.getCurrentPageInfo=function(){return{objId:Qe[De].objId,pageNumber:De,pageContext:Qe[De]}};k.addPage=function(){return Nl.apply(this,arguments),this},k.setPage=function(){return Aa.apply(this,arguments),Gt.call(this,cn[De]),this},k.insertPage=function(W){return this.addPage(),this.movePage(De,W),this},k.movePage=function(W,Ce){var pt,yt;if(W>Ce){pt=cn[W],yt=Qe[W];for(var qt=W;qt>Ce;qt--)cn[qt]=cn[qt-1],Qe[qt]=Qe[qt-1];cn[Ce]=pt,Qe[Ce]=yt,this.setPage(Ce)}else if(W<Ce){pt=cn[W],yt=Qe[W];for(var Zt=W;Zt<Ce;Zt++)cn[Zt]=cn[Zt+1],Qe[Zt]=Qe[Zt+1];cn[Ce]=pt,Qe[Ce]=yt,this.setPage(Ce)}return this},k.deletePage=function(){return Ql.apply(this,arguments),this},k.__private__.text=k.text=function(W,Ce,pt,yt,qt){var Zt,Fn,Dr,Xr,yi,Ii,xo,bo,Yo,Ro=(yt=yt||{}).scope||this;if(typeof W=="number"&&typeof Ce=="number"&&(typeof pt=="string"||Array.isArray(pt))){var zo=pt;pt=Ce,Ce=W,W=zo}if(arguments[3]instanceof Pt==0?(Dr=arguments[4],Xr=arguments[5],wa(xo=arguments[3])==="object"&&xo!==null||(typeof Dr=="string"&&(Xr=Dr,Dr=null),typeof xo=="string"&&(Xr=xo,xo=null),typeof xo=="number"&&(Dr=xo,xo=null),yt={flags:xo,angle:Dr,align:Xr})):(F("The transform parameter of text() with a Matrix value"),Yo=qt),isNaN(Ce)||isNaN(pt)||W==null)throw new Error("Invalid arguments passed to jsPDF.text");if(W.length===0)return Ro;var Jo,us="",jo=typeof yt.lineHeightFactor=="number"?yt.lineHeightFactor:Vi,Es=Ro.internal.scaleFactor;function zc(Wo){return Wo=Wo.split("	").join(Array(yt.TabLen||9).join(" ")),Ko(Wo,xo)}function Qa(Wo){for(var Vo,vs=Wo.concat(),Ca=[],Sc=vs.length;Sc--;)typeof(Vo=vs.shift())=="string"?Ca.push(Vo):Array.isArray(Wo)&&(Vo.length===1||Vo[1]===void 0&&Vo[2]===void 0)?Ca.push(Vo[0]):Ca.push([Vo[0],Vo[1],Vo[2]]);return Ca}function L(Wo,Vo){var vs;if(typeof Wo=="string")vs=Vo(Wo)[0];else if(Array.isArray(Wo)){for(var Ca,Sc,zh=Wo.concat(),Ch=[],rc=zh.length;rc--;)typeof(Ca=zh.shift())=="string"?Ch.push(Vo(Ca)[0]):Array.isArray(Ca)&&typeof Ca[0]=="string"&&(Sc=Vo(Ca[0],Ca[1],Ca[2]),Ch.push([Sc[0],Sc[1],Sc[2]]));vs=Ch}return vs}var ae=!1,ve=!0;if(typeof W=="string")ae=!0;else if(Array.isArray(W)){var Ge=W.concat();Fn=[];for(var Xt,hn=Ge.length;hn--;)(typeof(Xt=Ge.shift())!="string"||Array.isArray(Xt)&&typeof Xt[0]!="string")&&(ve=!1);ae=ve}if(ae===!1)throw new Error('Type of text must be string or Array. "'+W+'" is not recognized.');typeof W=="string"&&(W=W.match(/[\r?\n]/)?W.split(/\r\n|\r|\n/g):[W]);var ar=Ln/Ro.internal.scaleFactor,so=ar*(jo-1);switch(yt.baseline){case"bottom":pt-=so;break;case"top":pt+=ar-so;break;case"hanging":pt+=ar-2*so;break;case"middle":pt+=ar/2-so}if((Ii=yt.maxWidth||0)>0&&(typeof W=="string"?W=Ro.splitTextToSize(W,Ii):Object.prototype.toString.call(W)==="[object Array]"&&(W=W.reduce(function(Wo,Vo){return Wo.concat(Ro.splitTextToSize(Vo,Ii))},[]))),Zt={text:W,x:Ce,y:pt,options:yt,mutex:{pdfEscape:Ko,activeFontKey:Tr,fonts:or,activeFontSize:Ln}},ht.publish("preProcessText",Zt),W=Zt.text,Dr=(yt=Zt.options).angle,Yo instanceof Pt==0&&Dr&&typeof Dr=="number"){Dr*=Math.PI/180,yt.rotationDirection===0&&(Dr=-Dr),ue===me&&(Dr=-Dr);var Fo=Math.cos(Dr),Ki=Math.sin(Dr);Yo=new Pt(Fo,Ki,-Ki,Fo,0,0)}else Dr&&Dr instanceof Pt&&(Yo=Dr);ue!==me||Yo||(Yo=Bn),(yi=yt.charSpace||Bo)!==void 0&&(us+=U(Z(yi))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(bo=yt.horizontalScale)!==void 0&&(us+=U(100*bo)+` Tz
`),yt.lang;var zi=-1,Mo=yt.renderingMode!==void 0?yt.renderingMode:yt.stroke,ca=Ro.internal.getCurrentPageInfo().pageContext;switch(Mo){case 0:case!1:case"fill":zi=0;break;case 1:case!0:case"stroke":zi=1;break;case 2:case"fillThenStroke":zi=2;break;case 3:case"invisible":zi=3;break;case 4:case"fillAndAddForClipping":zi=4;break;case 5:case"strokeAndAddPathForClipping":zi=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":zi=6;break;case 7:case"addToPathForClipping":zi=7}var Lo=ca.usedRenderingMode!==void 0?ca.usedRenderingMode:-1;zi!==-1?us+=zi+` Tr
`:Lo!==-1&&(us+=`0 Tr
`),zi!==-1&&(ca.usedRenderingMode=zi),Xr=yt.align||"left";var Bi,Fl=Ln*jo,ua=Ro.internal.pageSize.getWidth(),Ru=or[Tr];yi=yt.charSpace||Bo,Ii=yt.maxWidth||0,xo=Object.assign({autoencode:!0,noBOM:!0},yt.flags);var ul=[],bc=function(Wo){return Ro.getStringUnitWidth(Wo,{font:Ru,charSpace:yi,fontSize:Ln,doKerning:!1})*Ln/Es};if(Object.prototype.toString.call(W)==="[object Array]"){var Ps;Fn=Qa(W),Xr!=="left"&&(Bi=Fn.map(bc));var _a,gu=0;if(Xr==="right"){Ce-=Bi[0],W=[],hn=Fn.length;for(var Qo=0;Qo<hn;Qo++)Qo===0?(_a=_o(Ce),Ps=Us(pt)):(_a=Z(gu-Bi[Qo]),Ps=-Fl),W.push([Fn[Qo],_a,Ps]),gu=Bi[Qo]}else if(Xr==="center"){Ce-=Bi[0]/2,W=[],hn=Fn.length;for(var Ws=0;Ws<hn;Ws++)Ws===0?(_a=_o(Ce),Ps=Us(pt)):(_a=Z((gu-Bi[Ws])/2),Ps=-Fl),W.push([Fn[Ws],_a,Ps]),gu=Bi[Ws]}else if(Xr==="left"){W=[],hn=Fn.length;for(var Ba=0;Ba<hn;Ba++)W.push(Fn[Ba])}else if(Xr==="justify"&&Ru.encoding==="Identity-H"){W=[],hn=Fn.length,Ii=Ii!==0?Ii:ua;for(var Ol=0,_s=0;_s<hn;_s++)if(Ps=_s===0?Us(pt):-Fl,_a=_s===0?_o(Ce):Ol,_s<hn-1){var Uo=Z((Ii-Bi[_s])/(Fn[_s].split(" ").length-1)),Ia=Fn[_s].split(" ");W.push([Ia[0]+" ",_a,Ps]),Ol=0;for(var Ks=1;Ks<Ia.length;Ks++){var yu=(bc(Ia[Ks-1]+" "+Ia[Ks])-bc(Ia[Ks]))*Es+Uo;Ks==Ia.length-1?W.push([Ia[Ks],yu,0]):W.push([Ia[Ks]+" ",yu,0]),Ol-=yu}}else W.push([Fn[_s],_a,Ps]);W.push(["",Ol,0])}else{if(Xr!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(W=[],hn=Fn.length,Ii=Ii!==0?Ii:ua,_s=0;_s<hn;_s++){Ps=_s===0?Us(pt):-Fl,_a=_s===0?_o(Ce):0;var wc=Fn[_s].split(" ").length-1,iu=wc>0?(Ii-Bi[_s])/wc:0;_s<hn-1?ul.push(U(Z(iu))):ul.push(0),W.push([Fn[_s],_a,Ps])}}}(typeof yt.R2L=="boolean"?yt.R2L:Yr)===!0&&(W=L(W,function(Wo,Vo,vs){return[Wo.split("").reverse().join(""),Vo,vs]})),Zt={text:W,x:Ce,y:pt,options:yt,mutex:{pdfEscape:Ko,activeFontKey:Tr,fonts:or,activeFontSize:Ln}},ht.publish("postProcessText",Zt),W=Zt.text,Jo=Zt.mutex.isHex||!1;var za=or[Tr].encoding;za!=="WinAnsiEncoding"&&za!=="StandardEncoding"||(W=L(W,function(Wo,Vo,vs){return[zc(Wo),Vo,vs]})),Fn=Qa(W),W=[];for(var nc,_l,Bl,zl=Array.isArray(Fn[0])?1:0,vl="",el=function(Wo,Vo,vs){var Ca="";return vs instanceof Pt?(vs=typeof yt.angle=="number"?vn(vs,new Pt(1,0,0,1,Wo,Vo)):vn(new Pt(1,0,0,1,Wo,Vo),vs),ue===me&&(vs=vn(new Pt(1,0,0,-1,0,0),vs)),Ca=vs.join(" ")+` Tm
`):Ca=U(Wo)+" "+U(Vo)+` Td
`,Ca},ks=0;ks<Fn.length;ks++){switch(vl="",zl){case 1:Bl=(Jo?"<":"(")+Fn[ks][0]+(Jo?">":")"),nc=parseFloat(Fn[ks][1]),_l=parseFloat(Fn[ks][2]);break;case 0:Bl=(Jo?"<":"(")+Fn[ks]+(Jo?">":")"),nc=_o(Ce),_l=Us(pt)}ul!==void 0&&ul[ks]!==void 0&&(vl=ul[ks]+` Tw
`),ks===0?W.push(vl+el(nc,_l,Yo)+Bl):zl===0?W.push(vl+Bl):zl===1&&W.push(vl+el(nc,_l,Yo)+Bl)}W=zl===0?W.join(` Tj
T* `):W.join(` Tj
`),W+=` Tj
`;var No=`BT
/`;return No+=Tr+" "+Ln+` Tf
`,No+=U(Ln*jo)+` TL
`,No+=Oa+`
`,No+=us,No+=W,st(No+="ET"),V[Tr]=!0,Ro};var bi=k.__private__.clip=k.clip=function(W){return st(W==="evenodd"?"W*":"W"),this};k.clipEvenOdd=function(){return bi("evenodd")},k.__private__.discardPath=k.discardPath=function(){return st("n"),this};var Mi=k.__private__.isValidStyle=function(W){var Ce=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(W)!==-1&&(Ce=!0),Ce};k.__private__.setDefaultPathOperation=k.setDefaultPathOperation=function(W){return Mi(W)&&(b=W),this};var yl=k.__private__.getStyle=k.getStyle=function(W){var Ce=b;switch(W){case"D":case"S":Ce="S";break;case"F":Ce="f";break;case"FD":case"DF":Ce="B";break;case"f":case"f*":case"B":case"B*":Ce=W}return Ce},Gi=k.close=function(){return st("h"),this};k.stroke=function(){return st("S"),this},k.fill=function(W){return fs("f",W),this},k.fillEvenOdd=function(W){return fs("f*",W),this},k.fillStroke=function(W){return fs("B",W),this},k.fillStrokeEvenOdd=function(W){return fs("B*",W),this};var fs=function(W,Ce){wa(Ce)==="object"?ec(Ce,W):st(W)},Ui=function(W){W===null||ue===me&&W===void 0||(W=yl(W),st(W))};function mu(W,Ce,pt,yt,qt){var Zt=new a0(Ce||this.boundingBox,pt||this.xStep,yt||this.yStep,this.gState,qt||this.matrix);Zt.stream=this.stream;var Fn=W+"$$"+this.cloneIndex+++"$$";return Tn(Fn,Zt),Zt}var ec=function(W,Ce){var pt=di[W.key],yt=Br[pt];if(yt instanceof Km)st("q"),st(nu(Ce)),yt.gState&&k.setGState(yt.gState),st(W.matrix.toString()+" cm"),st("/"+pt+" sh"),st("Q");else if(yt instanceof a0){var qt=new Pt(1,0,0,-1,0,Hs());W.matrix&&(qt=qt.multiply(W.matrix||Bn),pt=mu.call(yt,W.key,W.boundingBox,W.xStep,W.yStep,qt).id),st("q"),st("/Pattern cs"),st("/"+pt+" scn"),yt.gState&&k.setGState(yt.gState),st(Ce),st("Q")}},nu=function(W){switch(W){case"f":case"F":case"n":return"W n";case"f*":return"W* n";case"B":case"S":return"W S";case"B*":return"W* S"}},_c=k.moveTo=function(W,Ce){return st(U(Z(W))+" "+U(be(Ce))+" m"),this},tc=k.lineTo=function(W,Ce){return st(U(Z(W))+" "+U(be(Ce))+" l"),this},Da=k.curveTo=function(W,Ce,pt,yt,qt,Zt){return st([U(Z(W)),U(be(Ce)),U(Z(pt)),U(be(yt)),U(Z(qt)),U(be(Zt)),"c"].join(" ")),this};k.__private__.line=k.line=function(W,Ce,pt,yt,qt){if(isNaN(W)||isNaN(Ce)||isNaN(pt)||isNaN(yt)||!Mi(qt))throw new Error("Invalid arguments passed to jsPDF.line");return ue===ne?this.lines([[pt-W,yt-Ce]],W,Ce,[1,1],qt||"S"):this.lines([[pt-W,yt-Ce]],W,Ce,[1,1]).stroke()},k.__private__.lines=k.lines=function(W,Ce,pt,yt,qt,Zt){var Fn,Dr,Xr,yi,Ii,xo,bo,Yo,Ro,zo,Jo,us;if(typeof W=="number"&&(us=pt,pt=Ce,Ce=W,W=us),yt=yt||[1,1],Zt=Zt||!1,isNaN(Ce)||isNaN(pt)||!Array.isArray(W)||!Array.isArray(yt)||!Mi(qt)||typeof Zt!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(_c(Ce,pt),Fn=yt[0],Dr=yt[1],yi=W.length,zo=Ce,Jo=pt,Xr=0;Xr<yi;Xr++)(Ii=W[Xr]).length===2?(zo=Ii[0]*Fn+zo,Jo=Ii[1]*Dr+Jo,tc(zo,Jo)):(xo=Ii[0]*Fn+zo,bo=Ii[1]*Dr+Jo,Yo=Ii[2]*Fn+zo,Ro=Ii[3]*Dr+Jo,zo=Ii[4]*Fn+zo,Jo=Ii[5]*Dr+Jo,Da(xo,bo,Yo,Ro,zo,Jo));return Zt&&Gi(),Ui(qt),this},k.path=function(W){for(var Ce=0;Ce<W.length;Ce++){var pt=W[Ce],yt=pt.c;switch(pt.op){case"m":_c(yt[0],yt[1]);break;case"l":tc(yt[0],yt[1]);break;case"c":Da.apply(this,yt);break;case"h":Gi()}}return this},k.__private__.rect=k.rect=function(W,Ce,pt,yt,qt){if(isNaN(W)||isNaN(Ce)||isNaN(pt)||isNaN(yt)||!Mi(qt))throw new Error("Invalid arguments passed to jsPDF.rect");return ue===ne&&(yt=-yt),st([U(Z(W)),U(be(Ce)),U(Z(pt)),U(Z(yt)),"re"].join(" ")),Ui(qt),this},k.__private__.triangle=k.triangle=function(W,Ce,pt,yt,qt,Zt,Fn){if(isNaN(W)||isNaN(Ce)||isNaN(pt)||isNaN(yt)||isNaN(qt)||isNaN(Zt)||!Mi(Fn))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[pt-W,yt-Ce],[qt-pt,Zt-yt],[W-qt,Ce-Zt]],W,Ce,[1,1],Fn,!0),this},k.__private__.roundedRect=k.roundedRect=function(W,Ce,pt,yt,qt,Zt,Fn){if(isNaN(W)||isNaN(Ce)||isNaN(pt)||isNaN(yt)||isNaN(qt)||isNaN(Zt)||!Mi(Fn))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var Dr=4/3*(Math.SQRT2-1);return qt=Math.min(qt,.5*pt),Zt=Math.min(Zt,.5*yt),this.lines([[pt-2*qt,0],[qt*Dr,0,qt,Zt-Zt*Dr,qt,Zt],[0,yt-2*Zt],[0,Zt*Dr,-qt*Dr,Zt,-qt,Zt],[2*qt-pt,0],[-qt*Dr,0,-qt,-Zt*Dr,-qt,-Zt],[0,2*Zt-yt],[0,-Zt*Dr,qt*Dr,-Zt,qt,-Zt]],W+qt,Ce,[1,1],Fn,!0),this},k.__private__.ellipse=k.ellipse=function(W,Ce,pt,yt,qt){if(isNaN(W)||isNaN(Ce)||isNaN(pt)||isNaN(yt)||!Mi(qt))throw new Error("Invalid arguments passed to jsPDF.ellipse");var Zt=4/3*(Math.SQRT2-1)*pt,Fn=4/3*(Math.SQRT2-1)*yt;return _c(W+pt,Ce),Da(W+pt,Ce-Fn,W+Zt,Ce-yt,W,Ce-yt),Da(W-Zt,Ce-yt,W-pt,Ce-Fn,W-pt,Ce),Da(W-pt,Ce+Fn,W-Zt,Ce+yt,W,Ce+yt),Da(W+Zt,Ce+yt,W+pt,Ce+Fn,W+pt,Ce),Ui(qt),this},k.__private__.circle=k.circle=function(W,Ce,pt,yt){if(isNaN(W)||isNaN(Ce)||isNaN(pt)||!Mi(yt))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(W,Ce,pt,pt,yt)},k.setFont=function(W,Ce,pt){return pt&&(Ce=pe(Ce,pt)),Tr=dn(W,Ce,{disableWarning:!1}),this};var Ls=k.__private__.getFont=k.getFont=function(){return or[dn.apply(k,arguments)]};k.__private__.getFontList=k.getFontList=function(){var W,Ce,pt={};for(W in oi)if(oi.hasOwnProperty(W))for(Ce in pt[W]=[],oi[W])oi[W].hasOwnProperty(Ce)&&pt[W].push(Ce);return pt},k.addFont=function(W,Ce,pt,yt,qt){var Zt=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&Zt.indexOf(arguments[3])!==-1?qt=arguments[3]:arguments[3]&&Zt.indexOf(arguments[3])==-1&&(pt=pe(pt,yt)),Ea.call(this,W,Ce,pt,qt=qt||"Identity-H")};var Vi,Fa=n.lineWidth||.200025,ai=k.__private__.getLineWidth=k.getLineWidth=function(){return Fa},Zo=k.__private__.setLineWidth=k.setLineWidth=function(W){return Fa=W,st(U(Z(W))+" w"),this};k.__private__.setLineDash=Si.API.setLineDash=Si.API.setLineDashPattern=function(W,Ce){if(W=W||[],Ce=Ce||0,isNaN(Ce)||!Array.isArray(W))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return W=W.map(function(pt){return U(Z(pt))}).join(" "),Ce=U(Z(Ce)),st("["+W+"] "+Ce+" d"),this};var Ao=k.__private__.getLineHeight=k.getLineHeight=function(){return Ln*Vi};k.__private__.getLineHeight=k.getLineHeight=function(){return Ln*Vi};var Ih=k.__private__.setLineHeightFactor=k.setLineHeightFactor=function(W){return typeof(W=W||1.15)=="number"&&(Vi=W),this},Pu=k.__private__.getLineHeightFactor=k.getLineHeightFactor=function(){return Vi};Ih(n.lineHeight);var _o=k.__private__.getHorizontalCoordinate=function(W){return Z(W)},Us=k.__private__.getVerticalCoordinate=function(W){return ue===me?W:Qe[De].mediaBox.topRightY-Qe[De].mediaBox.bottomLeftY-Z(W)},ku=k.__private__.getHorizontalCoordinateString=k.getHorizontalCoordinateString=function(W){return U(_o(W))},Go=k.__private__.getVerticalCoordinateString=k.getVerticalCoordinateString=function(W){return U(Us(W))},vo=n.strokeColor||"0 G";k.__private__.getStrokeColor=k.getDrawColor=function(){return $o(vo)},k.__private__.setStrokeColor=k.setDrawColor=function(W,Ce,pt,yt){return vo=ro({ch1:W,ch2:Ce,ch3:pt,ch4:yt,pdfColorType:"draw",precision:2}),st(vo),this};var Dl=n.fillColor||"0 g";k.__private__.getFillColor=k.getFillColor=function(){return $o(Dl)},k.__private__.setFillColor=k.setFillColor=function(W,Ce,pt,yt){return Dl=ro({ch1:W,ch2:Ce,ch3:pt,ch4:yt,pdfColorType:"fill",precision:2}),st(Dl),this};var Oa=n.textColor||"0 g",Vs=k.__private__.getTextColor=k.getTextColor=function(){return $o(Oa)};k.__private__.setTextColor=k.setTextColor=function(W,Ce,pt,yt){return Oa=ro({ch1:W,ch2:Ce,ch3:pt,ch4:yt,pdfColorType:"text",precision:3}),this};var Bo=n.charSpace,Bc=k.__private__.getCharSpace=k.getCharSpace=function(){return parseFloat(Bo||0)};k.__private__.setCharSpace=k.setCharSpace=function(W){if(isNaN(W))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Bo=W,this};var Ho=0;k.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},k.__private__.setLineCap=k.setLineCap=function(W){var Ce=k.CapJoinStyles[W];if(Ce===void 0)throw new Error("Line cap style of '"+W+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Ho=Ce,st(Ce+" J"),this};var ya=0;k.__private__.setLineJoin=k.setLineJoin=function(W){var Ce=k.CapJoinStyles[W];if(Ce===void 0)throw new Error("Line join style of '"+W+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return ya=Ce,st(Ce+" j"),this},k.__private__.setLineMiterLimit=k.__private__.setMiterLimit=k.setLineMiterLimit=k.setMiterLimit=function(W){if(W=W||0,isNaN(W))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return st(U(Z(W))+" M"),this},k.GState=mv,k.setGState=function(W){(W=typeof W=="string"?si[ut[W]]:Ja(null,W)).equals(Ee)||(st("/"+W.id+" gs"),Ee=W)};var Ja=function(W,Ce){if(!W||!ut[W]){var pt=!1;for(var yt in si)if(si.hasOwnProperty(yt)&&si[yt].equals(Ce)){pt=!0;break}if(pt)Ce=si[yt];else{var qt="GS"+(Object.keys(si).length+1).toString(10);si[qt]=Ce,Ce.id=qt}return W&&(ut[W]=Ce.id),ht.publish("addGState",Ce),Ce}};k.addGState=function(W,Ce){return Ja(W,Ce),this},k.saveGraphicsState=function(){return st("q"),Kr.push({key:Tr,size:Ln,color:Oa}),this},k.restoreGraphicsState=function(){st("Q");var W=Kr.pop();return Tr=W.key,Ln=W.size,Oa=W.color,Ee=null,this},k.setCurrentTransformationMatrix=function(W){return st(W.toString()+" cm"),this},k.comment=function(W){return st("#"+W),this};var ll=function(W,Ce){var pt=W||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return pt},set:function(Zt){isNaN(Zt)||(pt=parseFloat(Zt))}});var yt=Ce||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return yt},set:function(Zt){isNaN(Zt)||(yt=parseFloat(Zt))}});var qt="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return qt},set:function(Zt){qt=Zt.toString()}}),this},ru=function(W,Ce,pt,yt){ll.call(this,W,Ce),this.type="rect";var qt=pt||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return qt},set:function(Fn){isNaN(Fn)||(qt=parseFloat(Fn))}});var Zt=yt||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return Zt},set:function(Fn){isNaN(Fn)||(Zt=parseFloat(Fn))}}),this},vc=function(){this.page=Ie,this.currentPage=De,this.pages=cn.slice(0),this.pagesContext=Qe.slice(0),this.x=Pr,this.y=Ei,this.matrix=Pi,this.width=Ss(De),this.height=aa(De),this.outputDestination=Mn,this.id="",this.objectNumber=-1};vc.prototype.restore=function(){Ie=this.page,De=this.currentPage,Qe=this.pagesContext,cn=this.pages,Pr=this.x,Ei=this.y,Pi=this.matrix,$s(De,this.width),la(De,this.height),Mn=this.outputDestination};var qs=function(W,Ce,pt,yt,qt){Et.push(new vc),Ie=De=0,cn=[],Pr=W,Ei=Ce,Pi=qt,Xa([pt,yt])};for(var Ti in k.beginFormObject=function(W,Ce,pt,yt,qt){return qs(W,Ce,pt,yt,qt),this},k.endFormObject=function(W){return(function(Ce){if(Bt[Ce])Et.pop().restore();else{var pt=new vc,yt="Xo"+(Object.keys(Mt).length+1).toString(10);pt.id=yt,Bt[Ce]=yt,Mt[yt]=pt,ht.publish("addFormObject",pt),Et.pop().restore()}})(W),this},k.doFormObject=function(W,Ce){var pt=Mt[Bt[W]];return st("q"),st(Ce.toString()+" cm"),st("/"+pt.id+" Do"),st("Q"),this},k.getFormObject=function(W){var Ce=Mt[Bt[W]];return{x:Ce.x,y:Ce.y,width:Ce.width,height:Ce.height,matrix:Ce.matrix}},k.save=function(W,Ce){return W=W||"generated.pdf",(Ce=Ce||{}).returnPromise=Ce.returnPromise||!1,Ce.returnPromise===!1?($m(al(Ya()),W),typeof $m.unload=="function"&&oo.setTimeout&&setTimeout($m.unload,911),this):new Promise(function(pt,yt){try{var qt=$m(al(Ya()),W);typeof $m.unload=="function"&&oo.setTimeout&&setTimeout($m.unload,911),pt(qt)}catch(Zt){yt(Zt.message)}})},Si.API)Si.API.hasOwnProperty(Ti)&&(Ti==="events"&&Si.API.events.length?(function(W,Ce){var pt,yt,qt;for(qt=Ce.length-1;qt!==-1;qt--)pt=Ce[qt][0],yt=Ce[qt][1],W.subscribe.apply(W,[pt].concat(typeof yt=="function"?[yt]:yt))})(ht,Si.API.events):k[Ti]=Si.API[Ti]);function Ss(W){return Qe[W].mediaBox.topRightX-Qe[W].mediaBox.bottomLeftX}function $s(W,Ce){Qe[W].mediaBox.topRightX=Ce+Qe[W].mediaBox.bottomLeftX}function aa(W){return Qe[W].mediaBox.topRightY-Qe[W].mediaBox.bottomLeftY}function la(W,Ce){Qe[W].mediaBox.topRightY=Ce+Qe[W].mediaBox.bottomLeftY}var cl=k.getPageWidth=function(W){return Ss(W=W||De)/Ir},Gs=k.setPageWidth=function(W,Ce){$s(W,Ce*Ir)},Hs=k.getPageHeight=function(W){return aa(W=W||De)/Ir},xc=k.setPageHeight=function(W,Ce){la(W,Ce*Ir)};return k.internal={pdfEscape:Ko,getStyle:yl,getFont:Ls,getFontSize:er,getCharSpace:Bc,getTextColor:Vs,getLineHeight:Ao,getLineHeightFactor:Pu,getLineWidth:ai,write:mr,getHorizontalCoordinate:_o,getVerticalCoordinate:Us,getCoordinateString:ku,getVerticalCoordinateString:Go,collections:{},newObject:Lr,newAdditionalObject:Ai,newObjectDeferred:Vr,newObjectDeferredBegin:Ar,getFilters:ys,putStream:io,events:ht,scaleFactor:Ir,pageSize:{getWidth:function(){return cl(De)},setWidth:function(W){Gs(De,W)},getHeight:function(){return Hs(De)},setHeight:function(W){xc(De,W)}},encryptionOptions:I,encryption:zr,getEncryptor:function(W){return I!==null?zr.encryptor(W,0):function(Ce){return Ce}},output:Cs,getNumberOfPages:sa,pages:cn,out:st,f2:j,f3:H,getPageInfo:Nr,getPageInfoByObjId:js,getCurrentPageInfo:Ta,getPDFVersion:se,Point:ll,Rectangle:ru,Matrix:Pt,hasHotfix:tr},Object.defineProperty(k.internal.pageSize,"width",{get:function(){return cl(De)},set:function(W){Gs(De,W)},enumerable:!0,configurable:!0}),Object.defineProperty(k.internal.pageSize,"height",{get:function(){return Hs(De)},set:function(W){xc(De,W)},enumerable:!0,configurable:!0}),(function(W){for(var Ce=0,pt=Cr.length;Ce<pt;Ce++){var yt=Ea.call(this,W[Ce][0],W[Ce][1],W[Ce][2],Cr[Ce][3],!0);M===!1&&(V[yt]=!0);var qt=W[Ce][0].split("-");fu({id:yt,fontName:qt[0],fontStyle:qt[1]||""})}ht.publish("addFonts",{fonts:or,dictionary:oi})}).call(k,Cr),Tr="F1",Nl(c,t),ht.publish("initialized"),k}e0.prototype.lsbFirstWord=function(n){return String.fromCharCode(255&n,n>>8&255,n>>16&255,n>>24&255)},e0.prototype.toHexString=function(n){return n.split("").map(function(e){return("0"+(255&e.charCodeAt(0)).toString(16)).slice(-2)}).join("")},e0.prototype.hexToBytes=function(n){for(var e=[],t=0;t<n.length;t+=2)e.push(String.fromCharCode(parseInt(n.substr(t,2),16)));return e.join("")},e0.prototype.processOwnerPassword=function(n,e){return E5(S5(e).substr(0,5),n)},e0.prototype.encryptor=function(n,e){var t=S5(this.encryptionKey+String.fromCharCode(255&n,n>>8&255,n>>16&255,255&e,e>>8&255)).substr(0,10);return function(i){return E5(t,i)}},mv.prototype.equals=function(n){var e,t="id,objectNumber,equals";if(!n||wa(n)!==wa(this))return!1;var i=0;for(e in this)if(!(t.indexOf(e)>=0)){if(this.hasOwnProperty(e)&&!n.hasOwnProperty(e)||this[e]!==n[e])return!1;i++}for(e in n)n.hasOwnProperty(e)&&t.indexOf(e)<0&&i--;return i===0},Si.API={events:[]},Si.version="3.0.3";var yc=Si.API,Ew=1,pg=function(n){return n.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Gg=function(n){return n.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},To=function(n){return n.toFixed(2)},Wp=function(n){return n.toFixed(5)};yc.__acroform__={};var ed=function(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n},LS=function(n){return n*Ew},Tf=function(n){var e=new q6,t=mi.internal.getHeight(n)||0,i=mi.internal.getWidth(n)||0;return e.BBox=[0,0,Number(To(i)),Number(To(t))],e},KR=yc.__acroform__.setBit=function(n,e){if(n=n||0,e=e||0,isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return n|1<<e},XR=yc.__acroform__.clearBit=function(n,e){if(n=n||0,e=e||0,isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return n&~(1<<e)},ZR=yc.__acroform__.getBit=function(n,e){if(isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return n&1<<e?1:0},Dc=yc.__acroform__.getBitForPdf=function(n,e){if(isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return ZR(n,e-1)},Fc=yc.__acroform__.setBitForPdf=function(n,e){if(isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return KR(n,e-1)},Oc=yc.__acroform__.clearBitForPdf=function(n,e){if(isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return XR(n,e-1)},YR=yc.__acroform__.calculateCoordinates=function(n,e){var t=e.internal.getHorizontalCoordinate,i=e.internal.getVerticalCoordinate,c=n[0],u=n[1],m=n[2],_=n[3],o={};return o.lowerLeft_X=t(c)||0,o.lowerLeft_Y=i(u+_)||0,o.upperRight_X=t(c+m)||0,o.upperRight_Y=i(u)||0,[Number(To(o.lowerLeft_X)),Number(To(o.lowerLeft_Y)),Number(To(o.upperRight_X)),Number(To(o.upperRight_Y))]},JR=function(n){if(n.appearanceStreamContent)return n.appearanceStreamContent;if(n.V||n.DV){var e=[],t=n._V||n.DV,i=A5(n,t),c=n.scope.internal.getFont(n.fontName,n.fontStyle).id;e.push("/Tx BMC"),e.push("q"),e.push("BT"),e.push(n.scope.__private__.encodeColorString(n.color)),e.push("/"+c+" "+To(i.fontSize)+" Tf"),e.push("1 0 0 1 0 0 Tm"),e.push(i.text),e.push("ET"),e.push("Q"),e.push("EMC");var u=Tf(n);return u.scope=n.scope,u.stream=e.join(`
`),u}},A5=function(n,e){var t=n.fontSize===0?n.maxFontSize:n.fontSize,i={text:"",fontSize:""},c=(e=(e=e.substr(0,1)=="("?e.substr(1):e).substr(e.length-1)==")"?e.substr(0,e.length-1):e).split(" ");c=n.multiline?c.map(function(j){return j.split(`
`)}):c.map(function(j){return[j]});var u=t,m=mi.internal.getHeight(n)||0;m=m<0?-m:m;var _=mi.internal.getWidth(n)||0;_=_<0?-_:_;var o=function(j,H,Z){if(j+1<c.length){var be=H+" "+c[j+1][0];return y1(be,n,Z).width<=_-4}return!1};u++;e:for(;u>0;){e="",u--;var b,I,M=y1("3",n,u).height,V=n.multiline?m-u:(m-M)/2,k=V+=2,ie=0,se=0,fe=0;if(u<=0){e=`(...) Tj
`,e+="% Width of Text: "+y1(e,n,u=12).width+", FieldWidth:"+_+`
`;break}for(var J="",ne=0,me=0;me<c.length;me++)if(c.hasOwnProperty(me)){var ue=!1;if(c[me].length!==1&&fe!==c[me].length-1){if((M+2)*(ne+2)+2>m)continue e;J+=c[me][fe],ue=!0,se=me,me--}else{J=(J+=c[me][fe]+" ").substr(J.length-1)==" "?J.substr(0,J.length-1):J;var ke=parseInt(me),je=o(ke,J,u),pe=me>=c.length-1;if(je&&!pe){J+=" ",fe=0;continue}if(je||pe){if(pe)se=ke;else if(n.multiline&&(M+2)*(ne+2)+2>m)continue e}else{if(!n.multiline||(M+2)*(ne+2)+2>m)continue e;se=ke}}for(var U="",F=ie;F<=se;F++){var q=c[F];if(n.multiline){if(F===se){U+=q[fe]+" ",fe=(fe+1)%q.length;continue}if(F===ie){U+=q[q.length-1]+" ";continue}}U+=q[0]+" "}switch(U=U.substr(U.length-1)==" "?U.substr(0,U.length-1):U,I=y1(U,n,u).width,n.textAlign){case"right":b=_-I-2;break;case"center":b=(_-I)/2;break;default:b=2}e+=To(b)+" "+To(k)+` Td
`,e+="("+pg(U)+`) Tj
`,e+=-To(b)+` 0 Td
`,k=-(u+2),I=0,ie=ue?se:se+1,ne++,J=""}break}return i.text=e,i.fontSize=u,i},y1=function(n,e,t){var i=e.scope.internal.getFont(e.fontName,e.fontStyle),c=e.scope.getStringUnitWidth(n,{font:i,fontSize:parseFloat(t),charSpace:0})*parseFloat(t);return{height:e.scope.getStringUnitWidth("3",{font:i,fontSize:parseFloat(t),charSpace:0})*parseFloat(t)*1.5,width:c}},QR={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},eM=function(n,e){var t={type:"reference",object:n};e.internal.getPageInfo(n.page).pageContext.annotations.find(function(i){return i.type===t.type&&i.object===t.object})===void 0&&e.internal.getPageInfo(n.page).pageContext.annotations.push(t)},tM=function(n,e){if(e.scope=n,n.internal!==void 0&&(n.internal.acroformPlugin===void 0||n.internal.acroformPlugin.isInitialized===!1)){if(af.FieldNum=0,n.internal.acroformPlugin=JSON.parse(JSON.stringify(QR)),n.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");Ew=n.internal.scaleFactor,n.internal.acroformPlugin.acroFormDictionaryRoot=new $6,n.internal.acroformPlugin.acroFormDictionaryRoot.scope=n,n.internal.acroformPlugin.acroFormDictionaryRoot._eventID=n.internal.events.subscribe("postPutResources",function(){(function(t){t.internal.events.unsubscribe(t.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete t.internal.acroformPlugin.acroFormDictionaryRoot._eventID,t.internal.acroformPlugin.printedOut=!0})(n)}),n.internal.events.subscribe("buildDocument",function(){(function(t){t.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var i=t.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var c in i)if(i.hasOwnProperty(c)){var u=i[c];u.objId=void 0,u.hasAnnotation&&eM(u,t)}})(n)}),n.internal.events.subscribe("putCatalog",function(){(function(t){if(t.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");t.internal.write("/AcroForm "+t.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(n)}),n.internal.events.subscribe("postPutPages",function(t){(function(i,c){var u=!i;for(var m in i||(c.internal.newObjectDeferredBegin(c.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),c.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),i=i||c.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(i.hasOwnProperty(m)){var _=i[m],o=[],b=_.Rect;if(_.Rect&&(_.Rect=YR(_.Rect,c)),c.internal.newObjectDeferredBegin(_.objId,!0),_.DA=mi.createDefaultAppearanceStream(_),wa(_)==="object"&&typeof _.getKeyValueListForStream=="function"&&(o=_.getKeyValueListForStream()),_.Rect=b,_.hasAppearanceStream&&!_.appearanceStreamContent){var I=JR(_);o.push({key:"AP",value:"<</N "+I+">>"}),c.internal.acroformPlugin.xForms.push(I)}if(_.appearanceStreamContent){var M="";for(var V in _.appearanceStreamContent)if(_.appearanceStreamContent.hasOwnProperty(V)){var k=_.appearanceStreamContent[V];if(M+="/"+V+" ",M+="<<",Object.keys(k).length>=1||Array.isArray(k)){for(var m in k)if(k.hasOwnProperty(m)){var ie=k[m];typeof ie=="function"&&(ie=ie.call(c,_)),M+="/"+m+" "+ie+" ",c.internal.acroformPlugin.xForms.indexOf(ie)>=0||c.internal.acroformPlugin.xForms.push(ie)}}else typeof(ie=k)=="function"&&(ie=ie.call(c,_)),M+="/"+m+" "+ie,c.internal.acroformPlugin.xForms.indexOf(ie)>=0||c.internal.acroformPlugin.xForms.push(ie);M+=">>"}o.push({key:"AP",value:`<<
`+M+">>"})}c.internal.putStream({additionalKeyValues:o,objectId:_.objId}),c.internal.out("endobj")}u&&(function(se,fe){for(var J in se)if(se.hasOwnProperty(J)){var ne=J,me=se[J];fe.internal.newObjectDeferredBegin(me.objId,!0),wa(me)==="object"&&typeof me.putStream=="function"&&me.putStream(),delete se[ne]}})(c.internal.acroformPlugin.xForms,c)})(t,n)}),n.internal.acroformPlugin.isInitialized=!0}},V6=yc.__acroform__.arrayToPdfArray=function(n,e,t){var i=function(m){return m};if(Array.isArray(n)){for(var c="[",u=0;u<n.length;u++)switch(u!==0&&(c+=" "),wa(n[u])){case"boolean":case"number":case"object":c+=n[u].toString();break;case"string":n[u].substr(0,1)!=="/"?(e!==void 0&&t&&(i=t.internal.getEncryptor(e)),c+="("+pg(i(n[u].toString()))+")"):c+=n[u].toString()}return c+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},Pb=function(n,e,t){var i=function(c){return c};return e!==void 0&&t&&(i=t.internal.getEncryptor(e)),(n=n||"").toString(),"("+pg(i(n))+")"},Df=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(n){this._objId=n}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};Df.prototype.toString=function(){return this.objId+" 0 R"},Df.prototype.putStream=function(){var n=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:n,objectId:this.objId}),this.scope.internal.out("endobj")},Df.prototype.getKeyValueListForStream=function(){var n=[],e=Object.getOwnPropertyNames(this).filter(function(u){return u!="content"&&u!="appearanceStreamContent"&&u!="scope"&&u!="objId"&&u.substring(0,1)!="_"});for(var t in e)if(Object.getOwnPropertyDescriptor(this,e[t]).configurable===!1){var i=e[t],c=this[i];c&&(Array.isArray(c)?n.push({key:i,value:V6(c,this.objId,this.scope)}):c instanceof Df?(c.scope=this.scope,n.push({key:i,value:c.objId+" 0 R"})):typeof c!="function"&&n.push({key:i,value:c}))}return n};var q6=function(){Df.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var n,e=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(t){n=t.trim()},get:function(){return n||null}})};ed(q6,Df);var $6=function(){Df.call(this);var n,e=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return e.length>0?e:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return e}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(n){var t=function(i){return i};return this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),"("+pg(t(n))+")"}},set:function(t){n=t}})};ed($6,Df);var af=function n(){Df.call(this);var e=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return e},set:function(J){if(isNaN(J))throw new Error('Invalid value "'+J+'" for attribute F supplied.');e=J}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!Dc(e,3)},set:function(J){J?this.F=Fc(e,3):this.F=Oc(e,3)}});var t=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return t},set:function(J){if(isNaN(J))throw new Error('Invalid value "'+J+'" for attribute Ff supplied.');t=J}});var i=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(i.length!==0)return i},set:function(J){i=J!==void 0?J:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[0])?0:i[0]},set:function(J){i[0]=J}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[1])?0:i[1]},set:function(J){i[1]=J}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[2])?0:i[2]},set:function(J){i[2]=J}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[3])?0:i[3]},set:function(J){i[3]=J}});var c="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return c},set:function(J){switch(J){case"/Btn":case"/Tx":case"/Ch":case"/Sig":c=J;break;default:throw new Error('Invalid value "'+J+'" for attribute FT supplied.')}}});var u=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!u||u.length<1){if(this instanceof gv)return;u="FieldObject"+n.FieldNum++}var J=function(ne){return ne};return this.scope&&(J=this.scope.internal.getEncryptor(this.objId)),"("+pg(J(u))+")"},set:function(J){u=J.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return u},set:function(J){u=J}});var m="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return m},set:function(J){m=J}});var _="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return _},set:function(J){_=J}});var o=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return o},set:function(J){o=J}});var b=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return b===void 0?50/Ew:b},set:function(J){b=J}});var I="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return I},set:function(J){I=J}});var M="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!M||this instanceof gv||this instanceof Qm))return Pb(M,this.objId,this.scope)},set:function(J){J=J.toString(),M=J}});var V=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(V)return this instanceof Iu==0?Pb(V,this.objId,this.scope):V},set:function(J){J=J.toString(),V=this instanceof Iu==0?J.substr(0,1)==="("?Gg(J.substr(1,J.length-2)):Gg(J):J}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Iu==1?Gg(V.substr(1,V.length-1)):V},set:function(J){J=J.toString(),V=this instanceof Iu==1?"/"+J:J}});var k=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(k)return k},set:function(J){this.V=J}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(k)return this instanceof Iu==0?Pb(k,this.objId,this.scope):k},set:function(J){J=J.toString(),k=this instanceof Iu==0?J.substr(0,1)==="("?Gg(J.substr(1,J.length-2)):Gg(J):J}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Iu==1?Gg(k.substr(1,k.length-1)):k},set:function(J){J=J.toString(),k=this instanceof Iu==1?"/"+J:J}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var ie,se=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return se},set:function(J){J=!!J,se=J}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(ie)return ie},set:function(J){ie=J}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!Dc(this.Ff,1)},set:function(J){J?this.Ff=Fc(this.Ff,1):this.Ff=Oc(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!Dc(this.Ff,2)},set:function(J){J?this.Ff=Fc(this.Ff,2):this.Ff=Oc(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!Dc(this.Ff,3)},set:function(J){J?this.Ff=Fc(this.Ff,3):this.Ff=Oc(this.Ff,3)}});var fe=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(fe!==null)return fe},set:function(J){if([0,1,2].indexOf(J)===-1)throw new Error('Invalid value "'+J+'" for attribute Q supplied.');fe=J}}),Object.defineProperty(this,"textAlign",{get:function(){var J;switch(fe){case 0:default:J="left";break;case 1:J="center";break;case 2:J="right"}return J},configurable:!0,enumerable:!0,set:function(J){switch(J){case"right":case 2:fe=2;break;case"center":case 1:fe=1;break;default:fe=0}}})};ed(af,Df);var f0=function(){af.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var n=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return n},set:function(t){n=t}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return n},set:function(t){n=t}});var e=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return V6(e,this.objId,this.scope)},set:function(t){var i,c;c=[],typeof(i=t)=="string"&&(c=(function(u,m,_){_||(_=1);for(var o,b=[];o=m.exec(u);)b.push(o[_]);return b})(i,/\((.*?)\)/g)),e=c}}),this.getOptions=function(){return e},this.setOptions=function(t){e=t,this.sort&&e.sort()},this.addOption=function(t){t=(t=t||"").toString(),e.push(t),this.sort&&e.sort()},this.removeOption=function(t,i){for(i=i||!1,t=(t=t||"").toString();e.indexOf(t)!==-1&&(e.splice(e.indexOf(t),1),i!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!Dc(this.Ff,18)},set:function(t){t?this.Ff=Fc(this.Ff,18):this.Ff=Oc(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!Dc(this.Ff,19)},set:function(t){this.combo===!0&&(t?this.Ff=Fc(this.Ff,19):this.Ff=Oc(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!Dc(this.Ff,20)},set:function(t){t?(this.Ff=Fc(this.Ff,20),e.sort()):this.Ff=Oc(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!Dc(this.Ff,22)},set:function(t){t?this.Ff=Fc(this.Ff,22):this.Ff=Oc(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Dc(this.Ff,23)},set:function(t){t?this.Ff=Fc(this.Ff,23):this.Ff=Oc(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!Dc(this.Ff,27)},set:function(t){t?this.Ff=Fc(this.Ff,27):this.Ff=Oc(this.Ff,27)}}),this.hasAppearanceStream=!1};ed(f0,af);var p0=function(){f0.call(this),this.fontName="helvetica",this.combo=!1};ed(p0,f0);var m0=function(){p0.call(this),this.combo=!0};ed(m0,p0);var V1=function(){m0.call(this),this.edit=!0};ed(V1,m0);var Iu=function(){af.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!Dc(this.Ff,15)},set:function(t){t?this.Ff=Fc(this.Ff,15):this.Ff=Oc(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!Dc(this.Ff,16)},set:function(t){t?this.Ff=Fc(this.Ff,16):this.Ff=Oc(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!Dc(this.Ff,17)},set:function(t){t?this.Ff=Fc(this.Ff,17):this.Ff=Oc(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!Dc(this.Ff,26)},set:function(t){t?this.Ff=Fc(this.Ff,26):this.Ff=Oc(this.Ff,26)}});var n,e={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var t=function(u){return u};if(this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),Object.keys(e).length!==0){var i,c=[];for(i in c.push("<<"),e)c.push("/"+i+" ("+pg(t(e[i]))+")");return c.push(">>"),c.join(`
`)}},set:function(t){wa(t)==="object"&&(e=t)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return e.CA||""},set:function(t){typeof t=="string"&&(e.CA=t)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return n},set:function(t){n=t}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return n.substr(1,n.length-1)},set:function(t){n="/"+t}})};ed(Iu,af);var q1=function(){Iu.call(this),this.pushButton=!0};ed(q1,Iu);var g0=function(){Iu.call(this),this.radio=!0,this.pushButton=!1;var n=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return n},set:function(e){n=e!==void 0?e:[]}})};ed(g0,Iu);var gv=function(){var n,e;af.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return n},set:function(c){n=c}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return e},set:function(c){e=c}});var t,i={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var c=function(_){return _};this.scope&&(c=this.scope.internal.getEncryptor(this.objId));var u,m=[];for(u in m.push("<<"),i)m.push("/"+u+" ("+pg(c(i[u]))+")");return m.push(">>"),m.join(`
`)},set:function(c){wa(c)==="object"&&(i=c)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return i.CA||""},set:function(c){typeof c=="string"&&(i.CA=c)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return t},set:function(c){t=c}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return t.substr(1,t.length-1)},set:function(c){t="/"+c}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=mi.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};ed(gv,af),g0.prototype.setAppearance=function(n){if(!("createAppearanceStream"in n)||!("getCA"in n))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var e in this.Kids)if(this.Kids.hasOwnProperty(e)){var t=this.Kids[e];t.appearanceStreamContent=n.createAppearanceStream(t.optionName),t.caption=n.getCA()}},g0.prototype.createOption=function(n){var e=new gv;return e.Parent=this,e.optionName=n,this.Kids.push(e),nM.call(this.scope,e),e};var $1=function(){Iu.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=mi.CheckBox.createAppearanceStream()};ed($1,Iu);var Qm=function(){af.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!Dc(this.Ff,13)},set:function(e){e?this.Ff=Fc(this.Ff,13):this.Ff=Oc(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!Dc(this.Ff,21)},set:function(e){e?this.Ff=Fc(this.Ff,21):this.Ff=Oc(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Dc(this.Ff,23)},set:function(e){e?this.Ff=Fc(this.Ff,23):this.Ff=Oc(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!Dc(this.Ff,24)},set:function(e){e?this.Ff=Fc(this.Ff,24):this.Ff=Oc(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!Dc(this.Ff,25)},set:function(e){e?this.Ff=Fc(this.Ff,25):this.Ff=Oc(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!Dc(this.Ff,26)},set:function(e){e?this.Ff=Fc(this.Ff,26):this.Ff=Oc(this.Ff,26)}});var n=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return n},set:function(e){n=e}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return n},set:function(e){Number.isInteger(e)&&(n=e)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};ed(Qm,af);var G1=function(){Qm.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!Dc(this.Ff,14)},set:function(n){n?this.Ff=Fc(this.Ff,14):this.Ff=Oc(this.Ff,14)}}),this.password=!0};ed(G1,Qm);var mi={CheckBox:{createAppearanceStream:function(){return{N:{On:mi.CheckBox.YesNormal},D:{On:mi.CheckBox.YesPushDown,Off:mi.CheckBox.OffPushDown}}},YesPushDown:function(n){var e=Tf(n);e.scope=n.scope;var t=[],i=n.scope.internal.getFont(n.fontName,n.fontStyle).id,c=n.scope.__private__.encodeColorString(n.color),u=A5(n,n.caption);return t.push("0.749023 g"),t.push("0 0 "+To(mi.internal.getWidth(n))+" "+To(mi.internal.getHeight(n))+" re"),t.push("f"),t.push("BMC"),t.push("q"),t.push("0 0 1 rg"),t.push("/"+i+" "+To(u.fontSize)+" Tf "+c),t.push("BT"),t.push(u.text),t.push("ET"),t.push("Q"),t.push("EMC"),e.stream=t.join(`
`),e},YesNormal:function(n){var e=Tf(n);e.scope=n.scope;var t=n.scope.internal.getFont(n.fontName,n.fontStyle).id,i=n.scope.__private__.encodeColorString(n.color),c=[],u=mi.internal.getHeight(n),m=mi.internal.getWidth(n),_=A5(n,n.caption);return c.push("1 g"),c.push("0 0 "+To(m)+" "+To(u)+" re"),c.push("f"),c.push("q"),c.push("0 0 1 rg"),c.push("0 0 "+To(m-1)+" "+To(u-1)+" re"),c.push("W"),c.push("n"),c.push("0 g"),c.push("BT"),c.push("/"+t+" "+To(_.fontSize)+" Tf "+i),c.push(_.text),c.push("ET"),c.push("Q"),e.stream=c.join(`
`),e},OffPushDown:function(n){var e=Tf(n);e.scope=n.scope;var t=[];return t.push("0.749023 g"),t.push("0 0 "+To(mi.internal.getWidth(n))+" "+To(mi.internal.getHeight(n))+" re"),t.push("f"),e.stream=t.join(`
`),e}},RadioButton:{Circle:{createAppearanceStream:function(n){var e={D:{Off:mi.RadioButton.Circle.OffPushDown},N:{}};return e.N[n]=mi.RadioButton.Circle.YesNormal,e.D[n]=mi.RadioButton.Circle.YesPushDown,e},getCA:function(){return"l"},YesNormal:function(n){var e=Tf(n);e.scope=n.scope;var t=[],i=mi.internal.getWidth(n)<=mi.internal.getHeight(n)?mi.internal.getWidth(n)/4:mi.internal.getHeight(n)/4;i=Number((.9*i).toFixed(5));var c=mi.internal.Bezier_C,u=Number((i*c).toFixed(5));return t.push("q"),t.push("1 0 0 1 "+Wp(mi.internal.getWidth(n)/2)+" "+Wp(mi.internal.getHeight(n)/2)+" cm"),t.push(i+" 0 m"),t.push(i+" "+u+" "+u+" "+i+" 0 "+i+" c"),t.push("-"+u+" "+i+" -"+i+" "+u+" -"+i+" 0 c"),t.push("-"+i+" -"+u+" -"+u+" -"+i+" 0 -"+i+" c"),t.push(u+" -"+i+" "+i+" -"+u+" "+i+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e},YesPushDown:function(n){var e=Tf(n);e.scope=n.scope;var t=[],i=mi.internal.getWidth(n)<=mi.internal.getHeight(n)?mi.internal.getWidth(n)/4:mi.internal.getHeight(n)/4;i=Number((.9*i).toFixed(5));var c=Number((2*i).toFixed(5)),u=Number((c*mi.internal.Bezier_C).toFixed(5)),m=Number((i*mi.internal.Bezier_C).toFixed(5));return t.push("0.749023 g"),t.push("q"),t.push("1 0 0 1 "+Wp(mi.internal.getWidth(n)/2)+" "+Wp(mi.internal.getHeight(n)/2)+" cm"),t.push(c+" 0 m"),t.push(c+" "+u+" "+u+" "+c+" 0 "+c+" c"),t.push("-"+u+" "+c+" -"+c+" "+u+" -"+c+" 0 c"),t.push("-"+c+" -"+u+" -"+u+" -"+c+" 0 -"+c+" c"),t.push(u+" -"+c+" "+c+" -"+u+" "+c+" 0 c"),t.push("f"),t.push("Q"),t.push("0 g"),t.push("q"),t.push("1 0 0 1 "+Wp(mi.internal.getWidth(n)/2)+" "+Wp(mi.internal.getHeight(n)/2)+" cm"),t.push(i+" 0 m"),t.push(i+" "+m+" "+m+" "+i+" 0 "+i+" c"),t.push("-"+m+" "+i+" -"+i+" "+m+" -"+i+" 0 c"),t.push("-"+i+" -"+m+" -"+m+" -"+i+" 0 -"+i+" c"),t.push(m+" -"+i+" "+i+" -"+m+" "+i+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e},OffPushDown:function(n){var e=Tf(n);e.scope=n.scope;var t=[],i=mi.internal.getWidth(n)<=mi.internal.getHeight(n)?mi.internal.getWidth(n)/4:mi.internal.getHeight(n)/4;i=Number((.9*i).toFixed(5));var c=Number((2*i).toFixed(5)),u=Number((c*mi.internal.Bezier_C).toFixed(5));return t.push("0.749023 g"),t.push("q"),t.push("1 0 0 1 "+Wp(mi.internal.getWidth(n)/2)+" "+Wp(mi.internal.getHeight(n)/2)+" cm"),t.push(c+" 0 m"),t.push(c+" "+u+" "+u+" "+c+" 0 "+c+" c"),t.push("-"+u+" "+c+" -"+c+" "+u+" -"+c+" 0 c"),t.push("-"+c+" -"+u+" -"+u+" -"+c+" 0 -"+c+" c"),t.push(u+" -"+c+" "+c+" -"+u+" "+c+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e}},Cross:{createAppearanceStream:function(n){var e={D:{Off:mi.RadioButton.Cross.OffPushDown},N:{}};return e.N[n]=mi.RadioButton.Cross.YesNormal,e.D[n]=mi.RadioButton.Cross.YesPushDown,e},getCA:function(){return"8"},YesNormal:function(n){var e=Tf(n);e.scope=n.scope;var t=[],i=mi.internal.calculateCross(n);return t.push("q"),t.push("1 1 "+To(mi.internal.getWidth(n)-2)+" "+To(mi.internal.getHeight(n)-2)+" re"),t.push("W"),t.push("n"),t.push(To(i.x1.x)+" "+To(i.x1.y)+" m"),t.push(To(i.x2.x)+" "+To(i.x2.y)+" l"),t.push(To(i.x4.x)+" "+To(i.x4.y)+" m"),t.push(To(i.x3.x)+" "+To(i.x3.y)+" l"),t.push("s"),t.push("Q"),e.stream=t.join(`
`),e},YesPushDown:function(n){var e=Tf(n);e.scope=n.scope;var t=mi.internal.calculateCross(n),i=[];return i.push("0.749023 g"),i.push("0 0 "+To(mi.internal.getWidth(n))+" "+To(mi.internal.getHeight(n))+" re"),i.push("f"),i.push("q"),i.push("1 1 "+To(mi.internal.getWidth(n)-2)+" "+To(mi.internal.getHeight(n)-2)+" re"),i.push("W"),i.push("n"),i.push(To(t.x1.x)+" "+To(t.x1.y)+" m"),i.push(To(t.x2.x)+" "+To(t.x2.y)+" l"),i.push(To(t.x4.x)+" "+To(t.x4.y)+" m"),i.push(To(t.x3.x)+" "+To(t.x3.y)+" l"),i.push("s"),i.push("Q"),e.stream=i.join(`
`),e},OffPushDown:function(n){var e=Tf(n);e.scope=n.scope;var t=[];return t.push("0.749023 g"),t.push("0 0 "+To(mi.internal.getWidth(n))+" "+To(mi.internal.getHeight(n))+" re"),t.push("f"),e.stream=t.join(`
`),e}}},createDefaultAppearanceStream:function(n){var e=n.scope.internal.getFont(n.fontName,n.fontStyle).id,t=n.scope.__private__.encodeColorString(n.color);return"/"+e+" "+n.fontSize+" Tf "+t}};mi.internal={Bezier_C:.551915024494,calculateCross:function(n){var e=mi.internal.getWidth(n),t=mi.internal.getHeight(n),i=Math.min(e,t);return{x1:{x:(e-i)/2,y:(t-i)/2+i},x2:{x:(e-i)/2+i,y:(t-i)/2},x3:{x:(e-i)/2,y:(t-i)/2},x4:{x:(e-i)/2+i,y:(t-i)/2+i}}}},mi.internal.getWidth=function(n){var e=0;return wa(n)==="object"&&(e=LS(n.Rect[2])),e},mi.internal.getHeight=function(n){var e=0;return wa(n)==="object"&&(e=LS(n.Rect[3])),e};var nM=yc.addField=function(n){if(tM(this,n),!(n instanceof af))throw new Error("Invalid argument passed to jsPDF.addField.");var e;return(e=n).scope.internal.acroformPlugin.printedOut&&(e.scope.internal.acroformPlugin.printedOut=!1,e.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),e.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(e),n.page=n.scope.internal.getCurrentPageInfo().pageNumber,this};yc.AcroFormChoiceField=f0,yc.AcroFormListBox=p0,yc.AcroFormComboBox=m0,yc.AcroFormEditBox=V1,yc.AcroFormButton=Iu,yc.AcroFormPushButton=q1,yc.AcroFormRadioButton=g0,yc.AcroFormCheckBox=$1,yc.AcroFormTextField=Qm,yc.AcroFormPasswordField=G1,yc.AcroFormAppearance=mi,yc.AcroForm={ChoiceField:f0,ListBox:p0,ComboBox:m0,EditBox:V1,Button:Iu,PushButton:q1,RadioButton:g0,CheckBox:$1,TextField:Qm,PasswordField:G1,Appearance:mi},Si.AcroForm={ChoiceField:f0,ListBox:p0,ComboBox:m0,EditBox:V1,Button:Iu,PushButton:q1,RadioButton:g0,CheckBox:$1,TextField:Qm,PasswordField:G1,Appearance:mi};Si.AcroForm;function G6(n){return n.reduce(function(e,t,i){return e[t]=i,e},{})}(function(n){var e="addImage_";n.__addimage__={};var t="UNKNOWN",i={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},c=n.__addimage__.getImageFileTypeByImageData=function(j,H){var Z,be,Re,Oe,Ne,we=t;if((H=H||t)==="RGBA"||j.data!==void 0&&j.data instanceof Uint8ClampedArray&&"height"in j&&"width"in j)return"RGBA";if(je(j))for(Ne in i)for(Re=i[Ne],Z=0;Z<Re.length;Z+=1){for(Oe=!0,be=0;be<Re[Z].length;be+=1)if(Re[Z][be]!==void 0&&Re[Z][be]!==j[be]){Oe=!1;break}if(Oe===!0){we=Ne;break}}else for(Ne in i)for(Re=i[Ne],Z=0;Z<Re.length;Z+=1){for(Oe=!0,be=0;be<Re[Z].length;be+=1)if(Re[Z][be]!==void 0&&Re[Z][be]!==j.charCodeAt(be)){Oe=!1;break}if(Oe===!0){we=Ne;break}}return we===t&&H!==t&&(we=H),we},u=function j(H){for(var Z=this.internal.write,be=this.internal.putStream,Re=(0,this.internal.getFilters)();Re.indexOf("FlateEncode")!==-1;)Re.splice(Re.indexOf("FlateEncode"),1);H.objectId=this.internal.newObject();var Oe=[];if(Oe.push({key:"Type",value:"/XObject"}),Oe.push({key:"Subtype",value:"/Image"}),Oe.push({key:"Width",value:H.width}),Oe.push({key:"Height",value:H.height}),H.colorSpace===J.INDEXED?Oe.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(H.palette.length/3-1)+" "+("sMask"in H&&H.sMask!==void 0?H.objectId+2:H.objectId+1)+" 0 R]"}):(Oe.push({key:"ColorSpace",value:"/"+H.colorSpace}),H.colorSpace===J.DEVICE_CMYK&&Oe.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),Oe.push({key:"BitsPerComponent",value:H.bitsPerComponent}),"decodeParameters"in H&&H.decodeParameters!==void 0&&Oe.push({key:"DecodeParms",value:"<<"+H.decodeParameters+">>"}),"transparency"in H&&Array.isArray(H.transparency)&&H.transparency.length>0){for(var Ne="",we=0,Fe=H.transparency.length;we<Fe;we++)Ne+=H.transparency[we]+" "+H.transparency[we]+" ";Oe.push({key:"Mask",value:"["+Ne+"]"})}H.sMask!==void 0&&Oe.push({key:"SMask",value:H.objectId+1+" 0 R"});var nt=H.filter!==void 0?["/"+H.filter]:void 0;if(be({data:H.data,additionalKeyValues:Oe,alreadyAppliedFilters:nt,objectId:H.objectId}),Z("endobj"),"sMask"in H&&H.sMask!==void 0){var xe,le=(xe=H.sMaskBitsPerComponent)!==null&&xe!==void 0?xe:H.bitsPerComponent,De={width:H.width,height:H.height,colorSpace:"DeviceGray",bitsPerComponent:le,data:H.sMask};"filter"in H&&(De.decodeParameters="/Predictor ".concat(H.predictor," /Colors 1 /BitsPerComponent ").concat(le," /Columns ").concat(H.width),De.filter=H.filter),j.call(this,De)}if(H.colorSpace===J.INDEXED){var Be=this.internal.newObject();be({data:U(new Uint8Array(H.palette)),objectId:Be}),Z("endobj")}},m=function(){var j=this.internal.collections[e+"images"];for(var H in j)u.call(this,j[H])},_=function(){var j,H=this.internal.collections[e+"images"],Z=this.internal.write;for(var be in H)Z("/I"+(j=H[be]).index,j.objectId,"0","R")},o=function(){this.internal.collections[e+"images"]||(this.internal.collections[e+"images"]={},this.internal.events.subscribe("putResources",m),this.internal.events.subscribe("putXobjectDict",_))},b=function(){var j=this.internal.collections[e+"images"];return o.call(this),j},I=function(){return Object.keys(this.internal.collections[e+"images"]).length},M=function(j){return typeof n["process"+j.toUpperCase()]=="function"},V=function(j){return wa(j)==="object"&&j.nodeType===1},k=function(j,H){if(j.nodeName==="IMG"&&j.hasAttribute("src")){var Z=""+j.getAttribute("src");if(Z.indexOf("data:image/")===0)return U1(unescape(Z).split("base64,").pop());var be=n.loadFile(Z,!0);if(be!==void 0)return be}if(j.nodeName==="CANVAS"){if(j.width===0||j.height===0)throw new Error("Given canvas must have data. Canvas width: "+j.width+", height: "+j.height);var Re;switch(H){case"PNG":Re="image/png";break;case"WEBP":Re="image/webp";break;default:Re="image/jpeg"}return U1(j.toDataURL(Re,1).split("base64,").pop())}},ie=function(j){var H=this.internal.collections[e+"images"];if(H){for(var Z in H)if(j===H[Z].alias)return H[Z]}},se=function(j,H,Z){return j||H||(j=-96,H=-96),j<0&&(j=-1*Z.width*72/j/this.internal.scaleFactor),H<0&&(H=-1*Z.height*72/H/this.internal.scaleFactor),j===0&&(j=H*Z.width/Z.height),H===0&&(H=j*Z.height/Z.width),[j,H]},fe=function(j,H,Z,be,Re,Oe){var Ne=se.call(this,Z,be,Re),we=this.internal.getCoordinateString,Fe=this.internal.getVerticalCoordinateString,nt=b.call(this);if(Z=Ne[0],be=Ne[1],nt[Re.index]=Re,Oe){Oe*=Math.PI/180;var xe=Math.cos(Oe),le=Math.sin(Oe),De=function(Ye){return Ye.toFixed(4)},Be=[De(xe),De(le),De(-1*le),De(xe),0,0,"cm"]}this.internal.write("q"),Oe?(this.internal.write([1,"0","0",1,we(j),Fe(H+be),"cm"].join(" ")),this.internal.write(Be.join(" ")),this.internal.write([we(Z),"0","0",we(be),"0","0","cm"].join(" "))):this.internal.write([we(Z),"0","0",we(be),we(j),Fe(H+be),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+Re.index+" Do"),this.internal.write("Q")},J=n.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};n.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var ne=n.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},me=n.__addimage__.sHashCode=function(j){var H,Z,be=0;if(typeof j=="string")for(Z=j.length,H=0;H<Z;H++)be=(be<<5)-be+j.charCodeAt(H),be|=0;else if(je(j))for(Z=j.byteLength/2,H=0;H<Z;H++)be=(be<<5)-be+j[H],be|=0;return be},ue=n.__addimage__.validateStringAsBase64=function(j){(j=j||"").toString().trim();var H=!0;return j.length===0&&(H=!1),j.length%4!=0&&(H=!1),/^[A-Za-z0-9+/]+$/.test(j.substr(0,j.length-2))===!1&&(H=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(j.substr(-2))===!1&&(H=!1),H},ke=n.__addimage__.extractImageFromDataUrl=function(j){if(j==null||!(j=j.trim()).startsWith("data:"))return null;var H=j.indexOf(",");return H<0?null:j.substring(0,H).trim().endsWith("base64")?j.substring(H+1):null};n.__addimage__.isArrayBuffer=function(j){return j instanceof ArrayBuffer};var je=n.__addimage__.isArrayBufferView=function(j){return j instanceof Int8Array||j instanceof Uint8Array||j instanceof Uint8ClampedArray||j instanceof Int16Array||j instanceof Uint16Array||j instanceof Int32Array||j instanceof Uint32Array||j instanceof Float32Array||j instanceof Float64Array},pe=n.__addimage__.binaryStringToUint8Array=function(j){for(var H=j.length,Z=new Uint8Array(H),be=0;be<H;be++)Z[be]=j.charCodeAt(be);return Z},U=n.__addimage__.arrayBufferToBinaryString=function(j){for(var H="",Z=je(j)?j:new Uint8Array(j),be=0;be<Z.length;be+=8192)H+=String.fromCharCode.apply(null,Z.subarray(be,be+8192));return H};n.addImage=function(){var j,H,Z,be,Re,Oe,Ne,we,Fe;if(typeof arguments[1]=="number"?(H=t,Z=arguments[1],be=arguments[2],Re=arguments[3],Oe=arguments[4],Ne=arguments[5],we=arguments[6],Fe=arguments[7]):(H=arguments[1],Z=arguments[2],be=arguments[3],Re=arguments[4],Oe=arguments[5],Ne=arguments[6],we=arguments[7],Fe=arguments[8]),wa(j=arguments[0])==="object"&&!V(j)&&"imageData"in j){var nt=j;j=nt.imageData,H=nt.format||H||t,Z=nt.x||Z||0,be=nt.y||be||0,Re=nt.w||nt.width||Re,Oe=nt.h||nt.height||Oe,Ne=nt.alias||Ne,we=nt.compression||we,Fe=nt.rotation||nt.angle||Fe}var xe=this.internal.getFilters();if(we===void 0&&xe.indexOf("FlateEncode")!==-1&&(we="SLOW"),isNaN(Z)||isNaN(be))throw new Error("Invalid coordinates passed to jsPDF.addImage");o.call(this);var le=F.call(this,j,H,Ne,we);return fe.call(this,Z,be,Re,Oe,le,Fe),this};var F=function(j,H,Z,be){var Re,Oe,Ne;if(typeof j=="string"&&c(j)===t){j=unescape(j);var we=q(j,!1);(we!==""||(we=n.loadFile(j,!0))!==void 0)&&(j=we)}if(V(j)&&(j=k(j,H)),H=c(j,H),!M(H))throw new Error("addImage does not support files of type '"+H+"', please ensure that a plugin for '"+H+"' support is added.");if(((Ne=Z)==null||Ne.length===0)&&(Z=(function(Fe){return typeof Fe=="string"||je(Fe)?me(Fe):je(Fe.data)?me(Fe.data):null})(j)),(Re=ie.call(this,Z))||(j instanceof Uint8Array||H==="RGBA"||(Oe=j,j=pe(j)),Re=this["process"+H.toUpperCase()](j,I.call(this),Z,(function(Fe){return Fe&&typeof Fe=="string"&&(Fe=Fe.toUpperCase()),Fe in n.image_compression?Fe:ne.NONE})(be),Oe)),!Re)throw new Error("An unknown error occurred whilst processing the image.");return Re},q=n.__addimage__.convertBase64ToBinaryString=function(j,H){H=typeof H!="boolean"||H;var Z,be="";if(typeof j=="string"){var Re;Z=(Re=ke(j))!==null&&Re!==void 0?Re:j;try{be=U1(Z)}catch(Oe){if(H)throw ue(Z)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+Oe.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return be};n.getImageProperties=function(j){var H,Z,be="";if(V(j)&&(j=k(j)),typeof j=="string"&&c(j)===t&&((be=q(j,!1))===""&&(be=n.loadFile(j)||""),j=be),Z=c(j),!M(Z))throw new Error("addImage does not support files of type '"+Z+"', please ensure that a plugin for '"+Z+"' support is added.");if(j instanceof Uint8Array||(j=pe(j)),!(H=this["process"+Z.toUpperCase()](j)))throw new Error("An unknown error occurred whilst processing the image");return H.fileType=Z,H}})(Si.API),(function(n){var e=function(t){if(t!==void 0&&t!="")return!0};Si.API.events.push(["addPage",function(t){this.internal.getPageInfo(t.pageNumber).pageContext.annotations=[]}]),n.events.push(["putPage",function(t){for(var i,c,u,m=this.internal.getCoordinateString,_=this.internal.getVerticalCoordinateString,o=this.internal.getPageInfoByObjId(t.objId),b=t.pageContext.annotations,I=!1,M=0;M<b.length&&!I;M++)switch((i=b[M]).type){case"link":(e(i.options.url)||e(i.options.pageNumber))&&(I=!0);break;case"reference":case"text":case"freetext":I=!0}if(I!=0){this.internal.write("/Annots [");for(var V=0;V<b.length;V++){i=b[V];var k=this.internal.pdfEscape,ie=this.internal.getEncryptor(t.objId);switch(i.type){case"reference":this.internal.write(" "+i.object.objId+" 0 R ");break;case"text":var se=this.internal.newAdditionalObject(),fe=this.internal.newAdditionalObject(),J=this.internal.getEncryptor(se.objId),ne=i.title||"Note";u="<</Type /Annot /Subtype /Text "+(c="/Rect ["+m(i.bounds.x)+" "+_(i.bounds.y+i.bounds.h)+" "+m(i.bounds.x+i.bounds.w)+" "+_(i.bounds.y)+"] ")+"/Contents ("+k(J(i.contents))+")",u+=" /Popup "+fe.objId+" 0 R",u+=" /P "+o.objId+" 0 R",u+=" /T ("+k(J(ne))+") >>",se.content=u;var me=se.objId+" 0 R";u="<</Type /Annot /Subtype /Popup "+(c="/Rect ["+m(i.bounds.x+30)+" "+_(i.bounds.y+i.bounds.h)+" "+m(i.bounds.x+i.bounds.w+30)+" "+_(i.bounds.y)+"] ")+" /Parent "+me,i.open&&(u+=" /Open true"),u+=" >>",fe.content=u,this.internal.write(se.objId,"0 R",fe.objId,"0 R");break;case"freetext":c="/Rect ["+m(i.bounds.x)+" "+_(i.bounds.y)+" "+m(i.bounds.x+i.bounds.w)+" "+_(i.bounds.y+i.bounds.h)+"] ";var ue=i.color||"#000000";u="<</Type /Annot /Subtype /FreeText "+c+"/Contents ("+k(ie(i.contents))+")",u+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+ue+")",u+=" /Border [0 0 0]",u+=" >>",this.internal.write(u);break;case"link":if(i.options.name){var ke=this.annotations._nameMap[i.options.name];i.options.pageNumber=ke.page,i.options.top=ke.y}else i.options.top||(i.options.top=0);if(c="/Rect ["+i.finalBounds.x+" "+i.finalBounds.y+" "+i.finalBounds.w+" "+i.finalBounds.h+"] ",u="",i.options.url)u="<</Type /Annot /Subtype /Link "+c+"/Border [0 0 0] /A <</S /URI /URI ("+k(ie(i.options.url))+") >>";else if(i.options.pageNumber)switch(u="<</Type /Annot /Subtype /Link "+c+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(i.options.pageNumber).objId+" 0 R",i.options.magFactor=i.options.magFactor||"XYZ",i.options.magFactor){case"Fit":u+=" /Fit]";break;case"FitH":u+=" /FitH "+i.options.top+"]";break;case"FitV":i.options.left=i.options.left||0,u+=" /FitV "+i.options.left+"]";break;default:var je=_(i.options.top);i.options.left=i.options.left||0,i.options.zoom===void 0&&(i.options.zoom=0),u+=" /XYZ "+i.options.left+" "+je+" "+i.options.zoom+"]"}u!=""&&(u+=" >>",this.internal.write(u))}}this.internal.write("]")}}]),n.createAnnotation=function(t){var i=this.internal.getCurrentPageInfo();switch(t.type){case"link":this.link(t.bounds.x,t.bounds.y,t.bounds.w,t.bounds.h,t);break;case"text":case"freetext":i.pageContext.annotations.push(t)}},n.link=function(t,i,c,u,m){var _=this.internal.getCurrentPageInfo(),o=this.internal.getCoordinateString,b=this.internal.getVerticalCoordinateString;_.pageContext.annotations.push({finalBounds:{x:o(t),y:b(i),w:o(t+c),h:b(i+u)},options:m,type:"link"})},n.textWithLink=function(t,i,c,u){var m,_,o=this.getTextWidth(t),b=this.internal.getLineHeight()/this.internal.scaleFactor;if(u.maxWidth!==void 0){_=u.maxWidth;var I=this.splitTextToSize(t,_).length;m=Math.ceil(b*I)}else _=o,m=b;return this.text(t,i,c,u),c+=.2*b,u.align==="center"&&(i-=o/2),u.align==="right"&&(i-=o),this.link(i,c-b,_,m,u),o},n.getTextWidth=function(t){var i=this.internal.getFontSize();return this.getStringUnitWidth(t)*i/this.internal.scaleFactor}})(Si.API),(function(n){var e={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},t={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},i={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},c=[1570,1571,1573,1575];n.__arabicParser__={};var u=n.__arabicParser__.isInArabicSubstitutionA=function(se){return e[se.charCodeAt(0)]!==void 0},m=n.__arabicParser__.isArabicLetter=function(se){return typeof se=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(se)},_=n.__arabicParser__.isArabicEndLetter=function(se){return m(se)&&u(se)&&e[se.charCodeAt(0)].length<=2},o=n.__arabicParser__.isArabicAlfLetter=function(se){return m(se)&&c.indexOf(se.charCodeAt(0))>=0};n.__arabicParser__.arabicLetterHasIsolatedForm=function(se){return m(se)&&u(se)&&e[se.charCodeAt(0)].length>=1};var b=n.__arabicParser__.arabicLetterHasFinalForm=function(se){return m(se)&&u(se)&&e[se.charCodeAt(0)].length>=2};n.__arabicParser__.arabicLetterHasInitialForm=function(se){return m(se)&&u(se)&&e[se.charCodeAt(0)].length>=3};var I=n.__arabicParser__.arabicLetterHasMedialForm=function(se){return m(se)&&u(se)&&e[se.charCodeAt(0)].length==4},M=n.__arabicParser__.resolveLigatures=function(se){var fe=0,J=t,ne="",me=0;for(fe=0;fe<se.length;fe+=1)J[se.charCodeAt(fe)]!==void 0?(me++,typeof(J=J[se.charCodeAt(fe)])=="number"&&(ne+=String.fromCharCode(J),J=t,me=0),fe===se.length-1&&(J=t,ne+=se.charAt(fe-(me-1)),fe-=me-1,me=0)):(J=t,ne+=se.charAt(fe-me),fe-=me,me=0);return ne};n.__arabicParser__.isArabicDiacritic=function(se){return se!==void 0&&i[se.charCodeAt(0)]!==void 0};var V=n.__arabicParser__.getCorrectForm=function(se,fe,J){return m(se)?u(se)===!1?-1:!b(se)||!m(fe)&&!m(J)||!m(J)&&_(fe)||_(se)&&!m(fe)||_(se)&&o(fe)||_(se)&&_(fe)?0:I(se)&&m(fe)&&!_(fe)&&m(J)&&b(J)?3:_(se)||!m(J)?1:2:-1},k=function(se){var fe=0,J=0,ne=0,me="",ue="",ke="",je=(se=se||"").split("\\s+"),pe=[];for(fe=0;fe<je.length;fe+=1){for(pe.push(""),J=0;J<je[fe].length;J+=1)me=je[fe][J],ue=je[fe][J-1],ke=je[fe][J+1],m(me)?(ne=V(me,ue,ke),pe[fe]+=ne!==-1?String.fromCharCode(e[me.charCodeAt(0)][ne]):me):pe[fe]+=me;pe[fe]=M(pe[fe])}return pe.join(" ")},ie=n.__arabicParser__.processArabic=n.processArabic=function(){var se,fe=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,J=[];if(Array.isArray(fe)){var ne=0;for(J=[],ne=0;ne<fe.length;ne+=1)Array.isArray(fe[ne])?J.push([k(fe[ne][0]),fe[ne][1],fe[ne][2]]):J.push([k(fe[ne])]);se=J}else se=k(fe);return typeof arguments[0]=="string"?se:(arguments[0].text=se,arguments[0])};n.events.push(["preProcessText",ie])})(Si.API),Si.API.autoPrint=function(n){var e;return(n=n||{}).variant=n.variant||"non-conform",n.variant==="javascript"?this.addJS("print({});"):(this.internal.events.subscribe("postPutResources",function(){e=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+e+" 0 R")})),this},(function(n){var e=function(){var t=void 0;Object.defineProperty(this,"pdf",{get:function(){return t},set:function(_){t=_}});var i=150;Object.defineProperty(this,"width",{get:function(){return i},set:function(_){i=isNaN(_)||Number.isInteger(_)===!1||_<0?150:_,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=i+1)}});var c=300;Object.defineProperty(this,"height",{get:function(){return c},set:function(_){c=isNaN(_)||Number.isInteger(_)===!1||_<0?300:_,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=c+1)}});var u=[];Object.defineProperty(this,"childNodes",{get:function(){return u},set:function(_){u=_}});var m={};Object.defineProperty(this,"style",{get:function(){return m},set:function(_){m=_}}),Object.defineProperty(this,"parentNode",{})};e.prototype.getContext=function(t,i){var c;if((t=t||"2d")!=="2d")return null;for(c in i)this.pdf.context2d.hasOwnProperty(c)&&(this.pdf.context2d[c]=i[c]);return this.pdf.context2d._canvas=this,this.pdf.context2d},e.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},n.events.push(["initialized",function(){this.canvas=new e,this.canvas.pdf=this}])})(Si.API),(function(n){var e={left:0,top:0,bottom:0,right:0},t=!1,i=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},e),this.internal.__cell__.margins.width=this.getPageWidth(),c.call(this))},c=function(){this.internal.__cell__.lastCell=new u,this.internal.__cell__.pages=1},u=function(){var o=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return o},set:function(se){o=se}});var b=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return b},set:function(se){b=se}});var I=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return I},set:function(se){I=se}});var M=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return M},set:function(se){M=se}});var V=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return V},set:function(se){V=se}});var k=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return k},set:function(se){k=se}});var ie=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return ie},set:function(se){ie=se}}),this};u.prototype.clone=function(){return new u(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},u.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},n.setHeaderFunction=function(o){return i.call(this),this.internal.__cell__.headerFunction=typeof o=="function"?o:void 0,this},n.getTextDimensions=function(o,b){i.call(this);var I=(b=b||{}).fontSize||this.getFontSize(),M=b.font||this.getFont(),V=b.scaleFactor||this.internal.scaleFactor,k=0,ie=0,se=0,fe=this;if(!Array.isArray(o)&&typeof o!="string"){if(typeof o!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");o=String(o)}var J=b.maxWidth;J>0?typeof o=="string"?o=this.splitTextToSize(o,J):Object.prototype.toString.call(o)==="[object Array]"&&(o=o.reduce(function(me,ue){return me.concat(fe.splitTextToSize(ue,J))},[])):o=Array.isArray(o)?o:[o];for(var ne=0;ne<o.length;ne++)k<(se=this.getStringUnitWidth(o[ne],{font:M})*I)&&(k=se);return k!==0&&(ie=o.length),{w:k/=V,h:Math.max((ie*I*this.getLineHeightFactor()-I*(this.getLineHeightFactor()-1))/V,0)}},n.cellAddPage=function(){i.call(this),this.addPage();var o=this.internal.__cell__.margins||e;return this.internal.__cell__.lastCell=new u(o.left,o.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var m=n.cell=function(){var o;o=arguments[0]instanceof u?arguments[0]:new u(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),i.call(this);var b=this.internal.__cell__.lastCell,I=this.internal.__cell__.padding,M=this.internal.__cell__.margins||e,V=this.internal.__cell__.tableHeaderRow,k=this.internal.__cell__.printHeaders;return b.lineNumber!==void 0&&(b.lineNumber===o.lineNumber?(o.x=(b.x||0)+(b.width||0),o.y=b.y||0):b.y+b.height+o.height+M.bottom>this.getPageHeight()?(this.cellAddPage(),o.y=M.top,k&&V&&(this.printHeaderRow(o.lineNumber,!0),o.y+=V[0].height)):o.y=b.y+b.height||o.y),o.text[0]!==void 0&&(this.rect(o.x,o.y,o.width,o.height,t===!0?"FD":void 0),o.align==="right"?this.text(o.text,o.x+o.width-I,o.y+I,{align:"right",baseline:"top"}):o.align==="center"?this.text(o.text,o.x+o.width/2,o.y+I,{align:"center",baseline:"top",maxWidth:o.width-I-I}):this.text(o.text,o.x+I,o.y+I,{align:"left",baseline:"top",maxWidth:o.width-I-I})),this.internal.__cell__.lastCell=o,this};n.table=function(o,b,I,M,V){if(i.call(this),!I)throw new Error("No data for PDF table.");var k,ie,se,fe,J=[],ne=[],me=[],ue={},ke={},je=[],pe=[],U=(V=V||{}).autoSize||!1,F=V.printHeaders!==!1,q=V.css&&V.css["font-size"]!==void 0?16*V.css["font-size"]:V.fontSize||12,j=V.margins||Object.assign({width:this.getPageWidth()},e),H=typeof V.padding=="number"?V.padding:3,Z=V.headerBackgroundColor||"#c8c8c8",be=V.headerTextColor||"#000";if(c.call(this),this.internal.__cell__.printHeaders=F,this.internal.__cell__.margins=j,this.internal.__cell__.table_font_size=q,this.internal.__cell__.padding=H,this.internal.__cell__.headerBackgroundColor=Z,this.internal.__cell__.headerTextColor=be,this.setFontSize(q),M==null)ne=J=Object.keys(I[0]),me=J.map(function(){return"left"});else if(Array.isArray(M)&&wa(M[0])==="object")for(J=M.map(function(nt){return nt.name}),ne=M.map(function(nt){return nt.prompt||nt.name||""}),me=M.map(function(nt){return nt.align||"left"}),k=0;k<M.length;k+=1)ke[M[k].name]=.7499990551181103*M[k].width;else Array.isArray(M)&&typeof M[0]=="string"&&(ne=J=M,me=J.map(function(){return"left"}));if(U||Array.isArray(M)&&typeof M[0]=="string")for(k=0;k<J.length;k+=1){for(ue[fe=J[k]]=I.map(function(nt){return nt[fe]}),this.setFont(void 0,"bold"),je.push(this.getTextDimensions(ne[k],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),ie=ue[fe],this.setFont(void 0,"normal"),se=0;se<ie.length;se+=1)je.push(this.getTextDimensions(ie[se],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);ke[fe]=Math.max.apply(null,je)+H+H,je=[]}if(F){var Re={};for(k=0;k<J.length;k+=1)Re[J[k]]={},Re[J[k]].text=ne[k],Re[J[k]].align=me[k];var Oe=_.call(this,Re,ke);pe=J.map(function(nt){return new u(o,b,ke[nt],Oe,Re[nt].text,void 0,Re[nt].align)}),this.setTableHeaderRow(pe),this.printHeaderRow(1,!1)}var Ne=M.reduce(function(nt,xe){return nt[xe.name]=xe.align,nt},{});for(k=0;k<I.length;k+=1){"rowStart"in V&&V.rowStart instanceof Function&&V.rowStart({row:k,data:I[k]},this);var we=_.call(this,I[k],ke);for(se=0;se<J.length;se+=1){var Fe=I[k][J[se]];"cellStart"in V&&V.cellStart instanceof Function&&V.cellStart({row:k,col:se,data:Fe},this),m.call(this,new u(o,b,ke[J[se]],we,Fe,k+2,Ne[J[se]]))}}return this.internal.__cell__.table_x=o,this.internal.__cell__.table_y=b,this};var _=function(o,b){var I=this.internal.__cell__.padding,M=this.internal.__cell__.table_font_size,V=this.internal.scaleFactor;return Object.keys(o).map(function(k){var ie=o[k];return this.splitTextToSize(ie.hasOwnProperty("text")?ie.text:ie,b[k]-I-I)},this).map(function(k){return this.getLineHeightFactor()*k.length*M/V+I+I},this).reduce(function(k,ie){return Math.max(k,ie)},0)};n.setTableHeaderRow=function(o){i.call(this),this.internal.__cell__.tableHeaderRow=o},n.printHeaderRow=function(o,b){if(i.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var I;if(t=!0,typeof this.internal.__cell__.headerFunction=="function"){var M=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new u(M[0],M[1],M[2],M[3],void 0,-1)}this.setFont(void 0,"bold");for(var V=[],k=0;k<this.internal.__cell__.tableHeaderRow.length;k+=1){I=this.internal.__cell__.tableHeaderRow[k].clone(),b&&(I.y=this.internal.__cell__.margins.top||0,V.push(I)),I.lineNumber=o;var ie=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),m.call(this,I),this.setTextColor(ie)}V.length>0&&this.setTableHeaderRow(V),this.setFont(void 0,"normal"),t=!1}})(Si.API);var H6={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},W6=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],T5=G6(W6),K6=[100,200,300,400,500,600,700,800,900],rM=G6(K6);function kb(n){var e=n.family.replace(/"|'/g,"").toLowerCase(),t=(function(u){return H6[u=u||"normal"]?u:"normal"})(n.style),i=(function(u){return u?typeof u=="number"?u>=100&&u<=900&&u%100==0?u:400:/^\d00$/.test(u)?parseInt(u):u==="bold"?700:400:400})(n.weight),c=(function(u){return typeof T5[u=u||"normal"]=="number"?u:"normal"})(n.stretch);return{family:e,style:t,weight:i,stretch:c,src:n.src||[],ref:n.ref||{name:e,style:[c,t,i].join(" ")}}}function PS(n,e,t,i){var c;for(c=t;c>=0&&c<e.length;c+=i)if(n[e[c]])return n[e[c]];for(c=t;c>=0&&c<e.length;c-=i)if(n[e[c]])return n[e[c]]}var iM={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},kS={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function RS(n){return[n.stretch,n.style,n.weight,n.family].join(" ")}function MS(n){return n.trimLeft()}function oM(n,e){for(var t=0;t<n.length;){if(n.charAt(t)===e)return[n.substring(0,t),n.substring(t+1)];t+=1}return null}function sM(n){var e=n.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return e===null?null:[e[0],n.substring(e[0].length)]}var _1,NS,DS,Hg,v1,FS,OS,BS,Rb=["times"];function zS(n,e,t,i,c){var u=4,m=US;switch(c){case Si.API.image_compression.FAST:u=1,m=jS;break;case Si.API.image_compression.MEDIUM:u=6,m=VS;break;case Si.API.image_compression.SLOW:u=9,m=qS}n=(function(o,b,I,M){for(var V,k=o.length/b,ie=new Uint8Array(o.length+k),se=[aM,jS,US,VS,qS],fe=0;fe<k;fe+=1){var J=fe*b,ne=o.subarray(J,J+b);if(M)ie.set(M(ne,I,V),J+fe);else{for(var me=se.length,ue=[],ke=0;ke<me;ke+=1)ue[ke]=se[ke](ne,I,V);var je=cM(ue.concat());ie.set(ue[je],J+fe)}V=ne}return ie})(n,e,Math.ceil(t*i/8),m);var _=v5(n,{level:u});return Si.API.__addimage__.arrayBufferToBinaryString(_)}function aM(n){var e=Array.apply([],n);return e.unshift(0),e}function jS(n,e){var t=n.length,i=[];i[0]=1;for(var c=0;c<t;c+=1){var u=n[c-e]||0;i[c+1]=n[c]-u+256&255}return i}function US(n,e,t){var i=n.length,c=[];c[0]=2;for(var u=0;u<i;u+=1){var m=t&&t[u]||0;c[u+1]=n[u]-m+256&255}return c}function VS(n,e,t){var i=n.length,c=[];c[0]=3;for(var u=0;u<i;u+=1){var m=n[u-e]||0,_=t&&t[u]||0;c[u+1]=n[u]+256-(m+_>>>1)&255}return c}function qS(n,e,t){var i=n.length,c=[];c[0]=4;for(var u=0;u<i;u+=1){var m=lM(n[u-e]||0,t&&t[u]||0,t&&t[u-e]||0);c[u+1]=n[u]-m+256&255}return c}function lM(n,e,t){if(n===e&&e===t)return n;var i=Math.abs(e-t),c=Math.abs(n-t),u=Math.abs(n+e-t-t);return i<=c&&i<=u?n:c<=u?e:t}function cM(n){var e=n.map(function(t){return t.reduce(function(i,c){return i+Math.abs(c)},0)});return e.indexOf(Math.min.apply(null,e))}function Mb(n,e,t){var i=e*t,c=Math.floor(i/8),u=16-(i-8*c+t),m=(1<<t)-1;return X6(n,c)>>u&m}function $S(n,e,t,i){var c=t*i,u=Math.floor(c/8),m=16-(c-8*u+i),_=(1<<i)-1,o=(e&_)<<m;(function(b,I,M){if(I+1<b.byteLength)b.setUint16(I,M,!1);else{var V=M>>8&255;b.setUint8(I,V)}})(n,u,X6(n,u)&~(_<<m)&65535|o)}function X6(n,e){return e+1<n.byteLength?n.getUint16(e,!1):n.getUint8(e)<<8}function uM(n){var e=0;if(n[e++]!==71||n[e++]!==73||n[e++]!==70||n[e++]!==56||(n[e++]+1&253)!=56||n[e++]!==97)throw new Error("Invalid GIF 87a/89a header.");var t=n[e++]|n[e++]<<8,i=n[e++]|n[e++]<<8,c=n[e++],u=c>>7,m=1<<1+(7&c);n[e++],n[e++];var _=null,o=null;u&&(_=e,o=m,e+=3*m);var b=!0,I=[],M=0,V=null,k=0,ie=null;for(this.width=t,this.height=i;b&&e<n.length;)switch(n[e++]){case 33:switch(n[e++]){case 255:if(n[e]!==11||n[e+1]==78&&n[e+2]==69&&n[e+3]==84&&n[e+4]==83&&n[e+5]==67&&n[e+6]==65&&n[e+7]==80&&n[e+8]==69&&n[e+9]==50&&n[e+10]==46&&n[e+11]==48&&n[e+12]==3&&n[e+13]==1&&n[e+16]==0)e+=14,ie=n[e++]|n[e++]<<8,e++;else for(e+=12;;){if(!((j=n[e++])>=0))throw Error("Invalid block size");if(j===0)break;e+=j}break;case 249:if(n[e++]!==4||n[e+4]!==0)throw new Error("Invalid graphics extension block.");var se=n[e++];M=n[e++]|n[e++]<<8,V=n[e++],1&se||(V=null),k=se>>2&7,e++;break;case 254:for(;;){if(!((j=n[e++])>=0))throw Error("Invalid block size");if(j===0)break;e+=j}break;default:throw new Error("Unknown graphic control label: 0x"+n[e-1].toString(16))}break;case 44:var fe=n[e++]|n[e++]<<8,J=n[e++]|n[e++]<<8,ne=n[e++]|n[e++]<<8,me=n[e++]|n[e++]<<8,ue=n[e++],ke=ue>>6&1,je=1<<1+(7&ue),pe=_,U=o,F=!1;ue>>7&&(F=!0,pe=e,U=je,e+=3*je);var q=e;for(e++;;){var j;if(!((j=n[e++])>=0))throw Error("Invalid block size");if(j===0)break;e+=j}I.push({x:fe,y:J,width:ne,height:me,has_local_palette:F,palette_offset:pe,palette_size:U,data_offset:q,data_length:e-q,transparent_index:V,interlaced:!!ke,delay:M,disposal:k});break;case 59:b=!1;break;default:throw new Error("Unknown gif block: 0x"+n[e-1].toString(16))}this.numFrames=function(){return I.length},this.loopCount=function(){return ie},this.frameInfo=function(H){if(H<0||H>=I.length)throw new Error("Frame index out of range.");return I[H]},this.decodeAndBlitFrameBGRA=function(H,Z){var be=this.frameInfo(H),Re=be.width*be.height,Oe=new Uint8Array(Re);GS(n,be.data_offset,Oe,Re);var Ne=be.palette_offset,we=be.transparent_index;we===null&&(we=256);var Fe=be.width,nt=t-Fe,xe=Fe,le=4*(be.y*t+be.x),De=4*((be.y+be.height)*t+be.x),Be=le,Ye=4*nt;be.interlaced===!0&&(Ye+=4*t*7);for(var rt=8,mt=0,ft=Oe.length;mt<ft;++mt){var Dt=Oe[mt];if(xe===0&&(xe=Fe,(Be+=Ye)>=De&&(Ye=4*nt+4*t*(rt-1),Be=le+(Fe+nt)*(rt<<1),rt>>=1)),Dt===we)Be+=4;else{var Yt=n[Ne+3*Dt],cn=n[Ne+3*Dt+1],gn=n[Ne+3*Dt+2];Z[Be++]=gn,Z[Be++]=cn,Z[Be++]=Yt,Z[Be++]=255}--xe}},this.decodeAndBlitFrameRGBA=function(H,Z){var be=this.frameInfo(H),Re=be.width*be.height,Oe=new Uint8Array(Re);GS(n,be.data_offset,Oe,Re);var Ne=be.palette_offset,we=be.transparent_index;we===null&&(we=256);var Fe=be.width,nt=t-Fe,xe=Fe,le=4*(be.y*t+be.x),De=4*((be.y+be.height)*t+be.x),Be=le,Ye=4*nt;be.interlaced===!0&&(Ye+=4*t*7);for(var rt=8,mt=0,ft=Oe.length;mt<ft;++mt){var Dt=Oe[mt];if(xe===0&&(xe=Fe,(Be+=Ye)>=De&&(Ye=4*nt+4*t*(rt-1),Be=le+(Fe+nt)*(rt<<1),rt>>=1)),Dt===we)Be+=4;else{var Yt=n[Ne+3*Dt],cn=n[Ne+3*Dt+1],gn=n[Ne+3*Dt+2];Z[Be++]=Yt,Z[Be++]=cn,Z[Be++]=gn,Z[Be++]=255}--xe}}}function GS(n,e,t,i){for(var c=n[e++],u=1<<c,m=u+1,_=m+1,o=c+1,b=(1<<o)-1,I=0,M=0,V=0,k=n[e++],ie=new Int32Array(4096),se=null;;){for(;I<16&&k!==0;)M|=n[e++]<<I,I+=8,k===1?k=n[e++]:--k;if(I<o)break;var fe=M&b;if(M>>=o,I-=o,fe!==u){if(fe===m)break;for(var J=fe<_?fe:se,ne=0,me=J;me>u;)me=ie[me]>>8,++ne;var ue=me;if(V+ne+(J!==fe?1:0)>i)return void Ka.log("Warning, gif stream longer than expected.");t[V++]=ue;var ke=V+=ne;for(J!==fe&&(t[V++]=ue),me=J;ne--;)me=ie[me],t[--ke]=255&me,me>>=8;se!==null&&_<4096&&(ie[_++]=se<<8|ue,_>=b+1&&o<12&&(++o,b=b<<1|1)),se=fe}else _=m+1,b=(1<<(o=c+1))-1,se=null}return V!==i&&Ka.log("Warning, gif stream shorter than expected."),t}/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function Nb(n){var e,t,i,c,u,m=Math.floor,_=new Array(64),o=new Array(64),b=new Array(64),I=new Array(64),M=new Array(65535),V=new Array(65535),k=new Array(64),ie=new Array(64),se=[],fe=0,J=7,ne=new Array(64),me=new Array(64),ue=new Array(64),ke=new Array(256),je=new Array(2048),pe=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],U=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],F=[0,1,2,3,4,5,6,7,8,9,10,11],q=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],j=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],H=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],Z=[0,1,2,3,4,5,6,7,8,9,10,11],be=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],Re=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function Oe(le,De){for(var Be=0,Ye=0,rt=new Array,mt=1;mt<=16;mt++){for(var ft=1;ft<=le[mt];ft++)rt[De[Ye]]=[],rt[De[Ye]][0]=Be,rt[De[Ye]][1]=mt,Ye++,Be++;Be*=2}return rt}function Ne(le){for(var De=le[0],Be=le[1]-1;Be>=0;)De&1<<Be&&(fe|=1<<J),Be--,--J<0&&(fe==255?(we(255),we(0)):we(fe),J=7,fe=0)}function we(le){se.push(le)}function Fe(le){we(le>>8&255),we(255&le)}function nt(le,De,Be,Ye,rt){for(var mt,ft=rt[0],Dt=rt[240],Yt=(function(Ln,ir){var er,Yr,Vt,Pn,Gn,Dn,Mr,wr,Tr,Ir,Pr=0;for(Tr=0;Tr<8;++Tr){er=Ln[Pr],Yr=Ln[Pr+1],Vt=Ln[Pr+2],Pn=Ln[Pr+3],Gn=Ln[Pr+4],Dn=Ln[Pr+5],Mr=Ln[Pr+6];var Ei=er+(wr=Ln[Pr+7]),Pi=er-wr,or=Yr+Mr,oi=Yr-Mr,Kr=Vt+Dn,Br=Vt-Dn,di=Pn+Gn,si=Pn-Gn,ut=Ei+di,Ee=Ei-di,Ie=or+Kr,Qe=or-Kr;Ln[Pr]=ut+Ie,Ln[Pr+4]=ut-Ie;var ht=.707106781*(Qe+Ee);Ln[Pr+2]=Ee+ht,Ln[Pr+6]=Ee-ht;var Ct=.382683433*((ut=si+Br)-(Qe=oi+Pi)),Mt=.5411961*ut+Ct,Bt=1.306562965*Qe+Ct,Et=.707106781*(Ie=Br+oi),Pt=Pi+Et,vn=Pi-Et;Ln[Pr+5]=vn+Mt,Ln[Pr+3]=vn-Mt,Ln[Pr+1]=Pt+Bt,Ln[Pr+7]=Pt-Bt,Pr+=8}for(Pr=0,Tr=0;Tr<8;++Tr){er=Ln[Pr],Yr=Ln[Pr+8],Vt=Ln[Pr+16],Pn=Ln[Pr+24],Gn=Ln[Pr+32],Dn=Ln[Pr+40],Mr=Ln[Pr+48];var Bn=er+(wr=Ln[Pr+56]),Tn=er-wr,kr=Yr+Mr,Lr=Yr-Mr,Vr=Vt+Dn,Ar=Vt-Dn,Ai=Pn+Gn,no=Pn-Gn,yo=Bn+Ai,$o=Bn-Ai,ro=kr+Vr,ys=kr-Vr;Ln[Pr]=yo+ro,Ln[Pr+32]=yo-ro;var io=.707106781*(ys+$o);Ln[Pr+16]=$o+io,Ln[Pr+48]=$o-io;var Is=.382683433*((yo=no+Ar)-(ys=Lr+Tn)),ga=.5411961*yo+Is,gl=1.306562965*ys+Is,sl=.707106781*(ro=Ar+Lr),Wi=Tn+sl,Jl=Tn-sl;Ln[Pr+40]=Jl+ga,Ln[Pr+24]=Jl-ga,Ln[Pr+8]=Wi+gl,Ln[Pr+56]=Wi-gl,Pr++}for(Tr=0;Tr<64;++Tr)Ir=Ln[Tr]*ir[Tr],k[Tr]=Ir>0?Ir+.5|0:Ir-.5|0;return k})(le,De),cn=0;cn<64;++cn)ie[pe[cn]]=Yt[cn];var gn=ie[0]-Be;Be=ie[0],gn==0?Ne(Ye[0]):(Ne(Ye[V[mt=32767+gn]]),Ne(M[mt]));for(var Mn=63;Mn>0&&ie[Mn]==0;)Mn--;if(Mn==0)return Ne(ft),Be;for(var Gt,st=1;st<=Mn;){for(var mr=st;ie[st]==0&&st<=Mn;)++st;var Er=st-mr;if(Er>=16){Gt=Er>>4;for(var Cr=1;Cr<=Gt;++Cr)Ne(Dt);Er&=15}mt=32767+ie[st],Ne(rt[(Er<<4)+V[mt]]),Ne(M[mt]),st++}return Mn!=63&&Ne(ft),Be}function xe(le){le=Math.min(Math.max(le,1),100),u!=le&&((function(De){for(var Be=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],Ye=0;Ye<64;Ye++){var rt=m((Be[Ye]*De+50)/100);rt=Math.min(Math.max(rt,1),255),_[pe[Ye]]=rt}for(var mt=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],ft=0;ft<64;ft++){var Dt=m((mt[ft]*De+50)/100);Dt=Math.min(Math.max(Dt,1),255),o[pe[ft]]=Dt}for(var Yt=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],cn=0,gn=0;gn<8;gn++)for(var Mn=0;Mn<8;Mn++)b[cn]=1/(_[pe[cn]]*Yt[gn]*Yt[Mn]*8),I[cn]=1/(o[pe[cn]]*Yt[gn]*Yt[Mn]*8),cn++})(le<50?Math.floor(5e3/le):Math.floor(200-2*le)),u=le)}this.encode=function(le,De){De&&xe(De),se=new Array,fe=0,J=7,Fe(65496),Fe(65504),Fe(16),we(74),we(70),we(73),we(70),we(0),we(1),we(1),we(0),Fe(1),Fe(1),we(0),we(0),(function(){Fe(65499),Fe(132),we(0);for(var Yr=0;Yr<64;Yr++)we(_[Yr]);we(1);for(var Vt=0;Vt<64;Vt++)we(o[Vt])})(),(function(Yr,Vt){Fe(65472),Fe(17),we(8),Fe(Vt),Fe(Yr),we(3),we(1),we(17),we(0),we(2),we(17),we(1),we(3),we(17),we(1)})(le.width,le.height),(function(){Fe(65476),Fe(418),we(0);for(var Yr=0;Yr<16;Yr++)we(U[Yr+1]);for(var Vt=0;Vt<=11;Vt++)we(F[Vt]);we(16);for(var Pn=0;Pn<16;Pn++)we(q[Pn+1]);for(var Gn=0;Gn<=161;Gn++)we(j[Gn]);we(1);for(var Dn=0;Dn<16;Dn++)we(H[Dn+1]);for(var Mr=0;Mr<=11;Mr++)we(Z[Mr]);we(17);for(var wr=0;wr<16;wr++)we(be[wr+1]);for(var Tr=0;Tr<=161;Tr++)we(Re[Tr])})(),Fe(65498),Fe(12),we(3),we(1),we(0),we(2),we(17),we(3),we(17),we(0),we(63),we(0);var Be=0,Ye=0,rt=0;fe=0,J=7,this.encode.displayName="_encode_";for(var mt,ft,Dt,Yt,cn,gn,Mn,Gt,st,mr=le.data,Er=le.width,Cr=le.height,Ln=4*Er,ir=0;ir<Cr;){for(mt=0;mt<Ln;){for(cn=Ln*ir+mt,Mn=-1,Gt=0,st=0;st<64;st++)gn=cn+(Gt=st>>3)*Ln+(Mn=4*(7&st)),ir+Gt>=Cr&&(gn-=Ln*(ir+1+Gt-Cr)),mt+Mn>=Ln&&(gn-=mt+Mn-Ln+4),ft=mr[gn++],Dt=mr[gn++],Yt=mr[gn++],ne[st]=(je[ft]+je[Dt+256|0]+je[Yt+512|0]>>16)-128,me[st]=(je[ft+768|0]+je[Dt+1024|0]+je[Yt+1280|0]>>16)-128,ue[st]=(je[ft+1280|0]+je[Dt+1536|0]+je[Yt+1792|0]>>16)-128;Be=nt(ne,b,Be,e,i),Ye=nt(me,I,Ye,t,c),rt=nt(ue,I,rt,t,c),mt+=32}ir+=8}if(J>=0){var er=[];er[1]=J+1,er[0]=(1<<J+1)-1,Ne(er)}return Fe(65497),new Uint8Array(se)},n=n||50,(function(){for(var le=String.fromCharCode,De=0;De<256;De++)ke[De]=le(De)})(),e=Oe(U,F),t=Oe(H,Z),i=Oe(q,j),c=Oe(be,Re),(function(){for(var le=1,De=2,Be=1;Be<=15;Be++){for(var Ye=le;Ye<De;Ye++)V[32767+Ye]=Be,M[32767+Ye]=[],M[32767+Ye][1]=Be,M[32767+Ye][0]=Ye;for(var rt=-(De-1);rt<=-le;rt++)V[32767+rt]=Be,M[32767+rt]=[],M[32767+rt][1]=Be,M[32767+rt][0]=De-1+rt;le<<=1,De<<=1}})(),(function(){for(var le=0;le<256;le++)je[le]=19595*le,je[le+256|0]=38470*le,je[le+512|0]=7471*le+32768,je[le+768|0]=-11059*le,je[le+1024|0]=-21709*le,je[le+1280|0]=32768*le+8421375,je[le+1536|0]=-27439*le,je[le+1792|0]=-5329*le})(),xe(n)}/**
 * @license
 * Copyright (c) 2017 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */function Wd(n,e){if(this.pos=0,this.buffer=n,this.datav=new DataView(n.buffer),this.is_with_alpha=!!e,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function HS(n){function e(F){if(!F)throw Error("assert :P")}function t(F,q,j){for(var H=0;4>H;H++)if(F[q+H]!=j.charCodeAt(H))return!0;return!1}function i(F,q,j,H,Z){for(var be=0;be<Z;be++)F[q+be]=j[H+be]}function c(F,q,j,H){for(var Z=0;Z<H;Z++)F[q+Z]=j}function u(F){return new Int32Array(F)}function m(F,q){for(var j=[],H=0;H<F;H++)j.push(new q);return j}function _(F,q){var j=[];return(function H(Z,be,Re){for(var Oe=Re[be],Ne=0;Ne<Oe&&(Z.push(Re.length>be+1?[]:new q),!(Re.length<be+1));Ne++)H(Z[Ne],be+1,Re)})(j,0,F),j}var o=function(){var F=this;function q(C,B){for(var Q=1<<B-1>>>0;C&Q;)Q>>>=1;return Q?(C&Q-1)+Q:C}function j(C,B,Q,oe,Pe){e(!(oe%Q));do C[B+(oe-=Q)]=Pe;while(0<oe)}function H(C,B,Q,oe,Pe){if(e(2328>=Pe),512>=Pe)var qe=u(512);else if((qe=u(Pe))==null)return 0;return(function(He,Je,et,dt,Nt,tn){var ct,Ft,Qt=Je,En=1<<et,y=u(16),a=u(16);for(e(Nt!=0),e(dt!=null),e(He!=null),e(0<et),Ft=0;Ft<Nt;++Ft){if(15<dt[Ft])return 0;++y[dt[Ft]]}if(y[0]==Nt)return 0;for(a[1]=0,ct=1;15>ct;++ct){if(y[ct]>1<<ct)return 0;a[ct+1]=a[ct]+y[ct]}for(Ft=0;Ft<Nt;++Ft)ct=dt[Ft],0<dt[Ft]&&(tn[a[ct]++]=Ft);if(a[15]==1)return(dt=new Z).g=0,dt.value=tn[0],j(He,Qt,1,En,dt),En;var f,v=-1,S=En-1,T=0,N=1,z=1,G=1<<et;for(Ft=0,ct=1,Nt=2;ct<=et;++ct,Nt<<=1){if(N+=z<<=1,0>(z-=y[ct]))return 0;for(;0<y[ct];--y[ct])(dt=new Z).g=ct,dt.value=tn[Ft++],j(He,Qt+T,Nt,G,dt),T=q(T,ct)}for(ct=et+1,Nt=2;15>=ct;++ct,Nt<<=1){if(N+=z<<=1,0>(z-=y[ct]))return 0;for(;0<y[ct];--y[ct]){if(dt=new Z,(T&S)!=v){for(Qt+=G,f=1<<(v=ct)-et;15>v&&!(0>=(f-=y[v]));)++v,f<<=1;En+=G=1<<(f=v-et),He[Je+(v=T&S)].g=f+et,He[Je+v].value=Qt-Je-v}dt.g=ct-et,dt.value=tn[Ft++],j(He,Qt+(T>>et),Nt,G,dt),T=q(T,ct)}}return N!=2*a[15]-1?0:En})(C,B,Q,oe,Pe,qe)}function Z(){this.value=this.g=0}function be(){this.value=this.g=0}function Re(){this.G=m(5,Z),this.H=u(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=m(bc,be)}function Oe(C,B,Q,oe){e(C!=null),e(B!=null),e(2147483648>oe),C.Ca=254,C.I=0,C.b=-8,C.Ka=0,C.oa=B,C.pa=Q,C.Jd=B,C.Yc=Q+oe,C.Zc=4<=oe?Q+oe-4+1:Q,ft(C)}function Ne(C,B){for(var Q=0;0<B--;)Q|=Yt(C,128)<<B;return Q}function we(C,B){var Q=Ne(C,B);return Dt(C)?-Q:Q}function Fe(C,B,Q,oe){var Pe,qe=0;for(e(C!=null),e(B!=null),e(4294967288>oe),C.Sb=oe,C.Ra=0,C.u=0,C.h=0,4<oe&&(oe=4),Pe=0;Pe<oe;++Pe)qe+=B[Q+Pe]<<8*Pe;C.Ra=qe,C.bb=oe,C.oa=B,C.pa=Q}function nt(C){for(;8<=C.u&&C.bb<C.Sb;)C.Ra>>>=8,C.Ra+=C.oa[C.pa+C.bb]<<gu-8>>>0,++C.bb,C.u-=8;Ye(C)&&(C.h=1,C.u=0)}function xe(C,B){if(e(0<=B),!C.h&&B<=_a){var Q=Be(C)&Ps[B];return C.u+=B,nt(C),Q}return C.h=1,C.u=0}function le(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function De(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function Be(C){return C.Ra>>>(C.u&gu-1)>>>0}function Ye(C){return e(C.bb<=C.Sb),C.h||C.bb==C.Sb&&C.u>gu}function rt(C,B){C.u=B,C.h=Ye(C)}function mt(C){C.u>=Qo&&(e(C.u>=Qo),nt(C))}function ft(C){e(C!=null&&C.oa!=null),C.pa<C.Zc?(C.I=(C.oa[C.pa++]|C.I<<8)>>>0,C.b+=8):(e(C!=null&&C.oa!=null),C.pa<C.Yc?(C.b+=8,C.I=C.oa[C.pa++]|C.I<<8):C.Ka?C.b=0:(C.I<<=8,C.b+=8,C.Ka=1))}function Dt(C){return Ne(C,1)}function Yt(C,B){var Q=C.Ca;0>C.b&&ft(C);var oe=C.b,Pe=Q*B>>>8,qe=(C.I>>>oe>Pe)+0;for(qe?(Q-=Pe,C.I-=Pe+1<<oe>>>0):Q=Pe+1,oe=Q,Pe=0;256<=oe;)Pe+=8,oe>>=8;return oe=7^Pe+Ws[oe],C.b-=oe,C.Ca=(Q<<oe)-1,qe}function cn(C,B,Q){C[B+0]=Q>>24&255,C[B+1]=Q>>16&255,C[B+2]=Q>>8&255,C[B+3]=255&Q}function gn(C,B){return C[B+0]|C[B+1]<<8}function Mn(C,B){return gn(C,B)|C[B+2]<<16}function Gt(C,B){return gn(C,B)|gn(C,B+2)<<16}function st(C,B){var Q=1<<B;return e(C!=null),e(0<B),C.X=u(Q),C.X==null?0:(C.Mb=32-B,C.Xa=B,1)}function mr(C,B){e(C!=null),e(B!=null),e(C.Xa==B.Xa),i(B.X,0,C.X,0,1<<B.Xa)}function Er(){this.X=[],this.Xa=this.Mb=0}function Cr(C,B,Q,oe){e(Q!=null),e(oe!=null);var Pe=Q[0],qe=oe[0];return Pe==0&&(Pe=(C*qe+B/2)/B),qe==0&&(qe=(B*Pe+C/2)/C),0>=Pe||0>=qe?0:(Q[0]=Pe,oe[0]=qe,1)}function Ln(C,B){return C+(1<<B)-1>>>B}function ir(C,B){return((4278255360&C)+(4278255360&B)>>>0&4278255360)+((16711935&C)+(16711935&B)>>>0&16711935)>>>0}function er(C,B){F[B]=function(Q,oe,Pe,qe,He,Je,et){var dt;for(dt=0;dt<He;++dt){var Nt=F[C](Je[et+dt-1],Pe,qe+dt);Je[et+dt]=ir(Q[oe+dt],Nt)}}}function Yr(){this.ud=this.hd=this.jd=0}function Vt(C,B){return((4278124286&(C^B))>>>1)+(C&B)>>>0}function Pn(C){return 0<=C&&256>C?C:0>C?0:255<C?255:void 0}function Gn(C,B){return Pn(C+(C-B+.5>>1))}function Dn(C,B,Q){return Math.abs(B-Q)-Math.abs(C-Q)}function Mr(C,B,Q,oe,Pe,qe,He){for(oe=qe[He-1],Q=0;Q<Pe;++Q)qe[He+Q]=oe=ir(C[B+Q],oe)}function wr(C,B,Q,oe,Pe){var qe;for(qe=0;qe<Q;++qe){var He=C[B+qe],Je=He>>8&255,et=16711935&(et=(et=16711935&He)+((Je<<16)+Je));oe[Pe+qe]=(4278255360&He)+et>>>0}}function Tr(C,B){B.jd=255&C,B.hd=C>>8&255,B.ud=C>>16&255}function Ir(C,B,Q,oe,Pe,qe){var He;for(He=0;He<oe;++He){var Je=B[Q+He],et=Je>>>8,dt=Je,Nt=255&(Nt=(Nt=Je>>>16)+((C.jd<<24>>24)*(et<<24>>24)>>>5));dt=255&(dt=(dt+=(C.hd<<24>>24)*(et<<24>>24)>>>5)+((C.ud<<24>>24)*(Nt<<24>>24)>>>5)),Pe[qe+He]=(4278255360&Je)+(Nt<<16)+dt}}function Pr(C,B,Q,oe,Pe){F[B]=function(qe,He,Je,et,dt,Nt,tn,ct,Ft){for(et=tn;et<ct;++et)for(tn=0;tn<Ft;++tn)dt[Nt++]=Pe(Je[oe(qe[He++])])},F[C]=function(qe,He,Je,et,dt,Nt,tn){var ct=8>>qe.b,Ft=qe.Ea,Qt=qe.K[0],En=qe.w;if(8>ct)for(qe=(1<<qe.b)-1,En=(1<<ct)-1;He<Je;++He){var y,a=0;for(y=0;y<Ft;++y)y&qe||(a=oe(et[dt++])),Nt[tn++]=Pe(Qt[a&En]),a>>=ct}else F["VP8LMapColor"+Q](et,dt,Qt,En,Nt,tn,He,Je,Ft)}}function Ei(C,B,Q,oe,Pe){for(Q=B+Q;B<Q;){var qe=C[B++];oe[Pe++]=qe>>16&255,oe[Pe++]=qe>>8&255,oe[Pe++]=255&qe}}function Pi(C,B,Q,oe,Pe){for(Q=B+Q;B<Q;){var qe=C[B++];oe[Pe++]=qe>>16&255,oe[Pe++]=qe>>8&255,oe[Pe++]=255&qe,oe[Pe++]=qe>>24&255}}function or(C,B,Q,oe,Pe){for(Q=B+Q;B<Q;){var qe=(He=C[B++])>>16&240|He>>12&15,He=240&He|He>>28&15;oe[Pe++]=qe,oe[Pe++]=He}}function oi(C,B,Q,oe,Pe){for(Q=B+Q;B<Q;){var qe=(He=C[B++])>>16&248|He>>13&7,He=He>>5&224|He>>3&31;oe[Pe++]=qe,oe[Pe++]=He}}function Kr(C,B,Q,oe,Pe){for(Q=B+Q;B<Q;){var qe=C[B++];oe[Pe++]=255&qe,oe[Pe++]=qe>>8&255,oe[Pe++]=qe>>16&255}}function Br(C,B,Q,oe,Pe,qe){if(qe==0)for(Q=B+Q;B<Q;)cn(oe,((qe=C[B++])[0]>>24|qe[1]>>8&65280|qe[2]<<8&16711680|qe[3]<<24)>>>0),Pe+=32;else i(oe,Pe,C,B,Q)}function di(C,B){F[B][0]=F[C+"0"],F[B][1]=F[C+"1"],F[B][2]=F[C+"2"],F[B][3]=F[C+"3"],F[B][4]=F[C+"4"],F[B][5]=F[C+"5"],F[B][6]=F[C+"6"],F[B][7]=F[C+"7"],F[B][8]=F[C+"8"],F[B][9]=F[C+"9"],F[B][10]=F[C+"10"],F[B][11]=F[C+"11"],F[B][12]=F[C+"12"],F[B][13]=F[C+"13"],F[B][14]=F[C+"0"],F[B][15]=F[C+"0"]}function si(C){return C==va||C==$c||C==ou||C==su}function ut(){this.eb=[],this.size=this.A=this.fb=0}function Ee(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function Ie(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new ut,this.f.kb=new Ee,this.sd=null}function Qe(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function ht(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function Ct(C){return alert("todo:WebPSamplerProcessPlane"),C.T}function Mt(C,B){var Q=C.T,oe=B.ba.f.RGBA,Pe=oe.eb,qe=oe.fb+C.ka*oe.A,He=lo[B.ba.S],Je=C.y,et=C.O,dt=C.f,Nt=C.N,tn=C.ea,ct=C.W,Ft=B.cc,Qt=B.dc,En=B.Mc,y=B.Nc,a=C.ka,f=C.ka+C.T,v=C.U,S=v+1>>1;for(a==0?He(Je,et,null,null,dt,Nt,tn,ct,dt,Nt,tn,ct,Pe,qe,null,null,v):(He(B.ec,B.fc,Je,et,Ft,Qt,En,y,dt,Nt,tn,ct,Pe,qe-oe.A,Pe,qe,v),++Q);a+2<f;a+=2)Ft=dt,Qt=Nt,En=tn,y=ct,Nt+=C.Rc,ct+=C.Rc,qe+=2*oe.A,He(Je,(et+=2*C.fa)-C.fa,Je,et,Ft,Qt,En,y,dt,Nt,tn,ct,Pe,qe-oe.A,Pe,qe,v);return et+=C.fa,C.j+f<C.o?(i(B.ec,B.fc,Je,et,v),i(B.cc,B.dc,dt,Nt,S),i(B.Mc,B.Nc,tn,ct,S),Q--):1&f||He(Je,et,null,null,dt,Nt,tn,ct,dt,Nt,tn,ct,Pe,qe+oe.A,null,null,v),Q}function Bt(C,B,Q){var oe=C.F,Pe=[C.J];if(oe!=null){var qe=C.U,He=B.ba.S,Je=He==oc||He==ou;B=B.ba.f.RGBA;var et=[0],dt=C.ka;et[0]=C.T,C.Kb&&(dt==0?--et[0]:(--dt,Pe[0]-=C.width),C.j+C.ka+C.T==C.o&&(et[0]=C.o-C.j-dt));var Nt=B.eb;dt=B.fb+dt*B.A,C=Mu(oe,Pe[0],C.width,qe,et,Nt,dt+(Je?0:3),B.A),e(Q==et),C&&si(He)&&La(Nt,dt,Je,qe,et,B.A)}return 0}function Et(C){var B=C.ma,Q=B.ba.S,oe=11>Q,Pe=Q==ha||Q==qc||Q==oc||Q==qn||Q==12||si(Q);if(B.memory=null,B.Ib=null,B.Jb=null,B.Nd=null,!ua(B.Oa,C,Pe?11:12))return 0;if(Pe&&si(Q)&&zc(),C.da)alert("todo:use_scaling");else{if(oe){if(B.Ib=Ct,C.Kb){if(Q=C.U+1>>1,B.memory=u(C.U+2*Q),B.memory==null)return 0;B.ec=B.memory,B.fc=0,B.cc=B.ec,B.dc=B.fc+C.U,B.Mc=B.cc,B.Nc=B.dc+Q,B.Ib=Mt,zc()}}else alert("todo:EmitYUV");Pe&&(B.Jb=Bt,oe&&jo())}if(oe&&!Rs){for(C=0;256>C;++C)ac[C]=89858*(C-128)+Pa>>sc,nl[C]=-22014*(C-128)+Pa,tl[C]=-45773*(C-128),oh[C]=113618*(C-128)+Pa>>sc;for(C=qo;C<Hi;++C)B=76283*(C-16)+Pa>>sc,Fu[C-qo]=zi(B,255),Ic[C-qo]=zi(B+8>>4,15);Rs=1}return 1}function Pt(C){var B=C.ma,Q=C.U,oe=C.T;return e(!(1&C.ka)),0>=Q||0>=oe?0:(Q=B.Ib(C,B),B.Jb!=null&&B.Jb(C,B,Q),B.Dc+=Q,1)}function vn(C){C.ma.memory=null}function Bn(C,B,Q,oe){return xe(C,8)!=47?0:(B[0]=xe(C,14)+1,Q[0]=xe(C,14)+1,oe[0]=xe(C,1),xe(C,3)!=0?0:!C.h)}function Tn(C,B){if(4>C)return C+1;var Q=C-2>>1;return(2+(1&C)<<Q)+xe(B,Q)+1}function kr(C,B){return 120<B?B-120:1<=(Q=((Q=Do[B-1])>>4)*C+(8-(15&Q)))?Q:1;var Q}function Lr(C,B,Q){var oe=Be(Q),Pe=C[B+=255&oe].g-8;return 0<Pe&&(rt(Q,Q.u+8),oe=Be(Q),B+=C[B].value,B+=oe&(1<<Pe)-1),rt(Q,Q.u+C[B].g),C[B].value}function Vr(C,B,Q){return Q.g+=C.g,Q.value+=C.value<<B>>>0,e(8>=Q.g),C.g}function Ar(C,B,Q){var oe=C.xc;return e((B=oe==0?0:C.vc[C.md*(Q>>oe)+(B>>oe)])<C.Wb),C.Ya[B]}function Ai(C,B,Q,oe){var Pe=C.ab,qe=C.c*B,He=C.C;B=He+B;var Je=Q,et=oe;for(oe=C.Ta,Q=C.Ua;0<Pe--;){var dt=C.gc[Pe],Nt=He,tn=B,ct=Je,Ft=et,Qt=(et=oe,Je=Q,dt.Ea);switch(e(Nt<tn),e(tn<=dt.nc),dt.hc){case 2:_s(ct,Ft,(tn-Nt)*Qt,et,Je);break;case 0:var En=Nt,y=tn,a=et,f=Je,v=(G=dt).Ea;En==0&&(Ba(ct,Ft,null,null,1,a,f),Mr(ct,Ft+1,0,0,v-1,a,f+1),Ft+=v,f+=v,++En);for(var S=1<<G.b,T=S-1,N=Ln(v,G.b),z=G.K,G=G.w+(En>>G.b)*N;En<y;){var ee=z,te=G,ge=1;for(Ol(ct,Ft,a,f-v,1,a,f);ge<v;){var Ae=(ge&~T)+S;Ae>v&&(Ae=v),(0,wc[ee[te++]>>8&15])(ct,Ft+ +ge,a,f+ge-v,Ae-ge,a,f+ge),ge=Ae}Ft+=v,f+=v,++En&T||(G+=N)}tn!=dt.nc&&i(et,Je-Qt,et,Je+(tn-Nt-1)*Qt,Qt);break;case 1:for(Qt=ct,y=Ft,v=(ct=dt.Ea)-(f=ct&~(a=(Ft=1<<dt.b)-1)),En=Ln(ct,dt.b),S=dt.K,dt=dt.w+(Nt>>dt.b)*En;Nt<tn;){for(T=S,N=dt,z=new Yr,G=y+f,ee=y+ct;y<G;)Tr(T[N++],z),iu(z,Qt,y,Ft,et,Je),y+=Ft,Je+=Ft;y<ee&&(Tr(T[N++],z),iu(z,Qt,y,v,et,Je),y+=v,Je+=v),++Nt&a||(dt+=En)}break;case 3:if(ct==et&&Ft==Je&&0<dt.b){for(y=et,ct=Qt=Je+(tn-Nt)*Qt-(f=(tn-Nt)*Ln(dt.Ea,dt.b)),Ft=et,a=Je,En=[],f=(v=f)-1;0<=f;--f)En[f]=Ft[a+f];for(f=v-1;0<=f;--f)y[ct+f]=En[f];Uo(dt,Nt,tn,et,Qt,et,Je)}else Uo(dt,Nt,tn,ct,Ft,et,Je)}Je=oe,et=Q}et!=Q&&i(oe,Q,Je,et,qe)}function no(C,B){var Q=C.V,oe=C.Ba+C.c*C.C,Pe=B-C.C;if(e(B<=C.l.o),e(16>=Pe),0<Pe){var qe=C.l,He=C.Ta,Je=C.Ua,et=qe.width;if(Ai(C,Pe,Q,oe),Pe=Je=[Je],e((Q=C.C)<(oe=B)),e(qe.v<qe.va),oe>qe.o&&(oe=qe.o),Q<qe.j){var dt=qe.j-Q;Q=qe.j,Pe[0]+=dt*et}if(Q>=oe?Q=0:(Pe[0]+=4*qe.v,qe.ka=Q-qe.j,qe.U=qe.va-qe.v,qe.T=oe-Q,Q=1),Q){if(Je=Je[0],11>(Q=C.ca).S){var Nt=Q.f.RGBA,tn=(oe=Q.S,Pe=qe.U,qe=qe.T,dt=Nt.eb,Nt.A),ct=qe;for(Nt=Nt.fb+C.Ma*Nt.A;0<ct--;){var Ft=He,Qt=Je,En=Pe,y=dt,a=Nt;switch(oe){case Vc:za(Ft,Qt,En,y,a);break;case ha:nc(Ft,Qt,En,y,a);break;case va:nc(Ft,Qt,En,y,a),La(y,a,0,En,1,0);break;case Du:zl(Ft,Qt,En,y,a);break;case qc:Br(Ft,Qt,En,y,a,1);break;case $c:Br(Ft,Qt,En,y,a,1),La(y,a,0,En,1,0);break;case oc:Br(Ft,Qt,En,y,a,0);break;case ou:Br(Ft,Qt,En,y,a,0),La(y,a,1,En,1,0);break;case qn:_l(Ft,Qt,En,y,a);break;case su:_l(Ft,Qt,En,y,a),Uc(y,a,En,1,0);break;case jl:Bl(Ft,Qt,En,y,a);break;default:e(0)}Je+=et,Nt+=tn}C.Ma+=qe}else alert("todo:EmitRescaledRowsYUVA");e(C.Ma<=Q.height)}}C.C=B,e(C.C<=C.i)}function yo(C){var B;if(0<C.ua)return 0;for(B=0;B<C.Wb;++B){var Q=C.Ya[B].G,oe=C.Ya[B].H;if(0<Q[1][oe[1]+0].g||0<Q[2][oe[2]+0].g||0<Q[3][oe[3]+0].g)return 0}return 1}function $o(C,B,Q,oe,Pe,qe){if(C.Z!=0){var He=C.qd,Je=C.rd;for(e(Va[C.Z]!=null);B<Q;++B)Va[C.Z](He,Je,oe,Pe,oe,Pe,qe),He=oe,Je=Pe,Pe+=qe;C.qd=He,C.rd=Je}}function ro(C,B){var Q=C.l.ma,oe=Q.Z==0||Q.Z==1?C.l.j:C.C;if(oe=C.C<oe?oe:C.C,e(B<=C.l.o),B>oe){var Pe=C.l.width,qe=Q.ca,He=Q.tb+Pe*oe,Je=C.V,et=C.Ba+C.c*oe,dt=C.gc;e(C.ab==1),e(dt[0].hc==3),Ks(dt[0],oe,B,Je,et,qe,He),$o(Q,oe,B,qe,He,Pe)}C.C=C.Ma=B}function ys(C,B,Q,oe,Pe,qe,He){var Je=C.$/oe,et=C.$%oe,dt=C.m,Nt=C.s,tn=Q+C.$,ct=tn;Pe=Q+oe*Pe;var Ft=Q+oe*qe,Qt=280+Nt.ua,En=C.Pb?Je:16777216,y=0<Nt.ua?Nt.Wa:null,a=Nt.wc,f=tn<Ft?Ar(Nt,et,Je):null;e(C.C<qe),e(Ft<=Pe);var v=!1;e:for(;;){for(;v||tn<Ft;){var S=0;if(Je>=En){var T=tn-Q;e((En=C).Pb),En.wd=En.m,En.xd=T,0<En.s.ua&&mr(En.s.Wa,En.s.vb),En=Je+Zs}if(et&a||(f=Ar(Nt,et,Je)),e(f!=null),f.Qb&&(B[tn]=f.qb,v=!0),!v)if(mt(dt),f.jc){S=dt,T=B;var N=tn,z=f.pd[Be(S)&bc-1];e(f.jc),256>z.g?(rt(S,S.u+z.g),T[N]=z.value,S=0):(rt(S,S.u+z.g-256),e(256<=z.value),S=z.value),S==0&&(v=!0)}else S=Lr(f.G[0],f.H[0],dt);if(dt.h)break;if(v||256>S){if(!v)if(f.nd)B[tn]=(f.qb|S<<8)>>>0;else{if(mt(dt),v=Lr(f.G[1],f.H[1],dt),mt(dt),T=Lr(f.G[2],f.H[2],dt),N=Lr(f.G[3],f.H[3],dt),dt.h)break;B[tn]=(N<<24|v<<16|S<<8|T)>>>0}if(v=!1,++tn,++et>=oe&&(et=0,++Je,He!=null&&Je<=qe&&!(Je%16)&&He(C,Je),y!=null))for(;ct<tn;)S=B[ct++],y.X[(506832829*S&4294967295)>>>y.Mb]=S}else if(280>S){if(S=Tn(S-256,dt),T=Lr(f.G[4],f.H[4],dt),mt(dt),T=kr(oe,T=Tn(T,dt)),dt.h)break;if(tn-Q<T||Pe-tn<S)break e;for(N=0;N<S;++N)B[tn+N]=B[tn+N-T];for(tn+=S,et+=S;et>=oe;)et-=oe,++Je,He!=null&&Je<=qe&&!(Je%16)&&He(C,Je);if(e(tn<=Pe),et&a&&(f=Ar(Nt,et,Je)),y!=null)for(;ct<tn;)S=B[ct++],y.X[(506832829*S&4294967295)>>>y.Mb]=S}else{if(!(S<Qt))break e;for(v=S-280,e(y!=null);ct<tn;)S=B[ct++],y.X[(506832829*S&4294967295)>>>y.Mb]=S;S=tn,e(!(v>>>(T=y).Xa)),B[S]=T.X[v],v=!0}v||e(dt.h==Ye(dt))}if(C.Pb&&dt.h&&tn<Pe)e(C.m.h),C.a=5,C.m=C.wd,C.$=C.xd,0<C.s.ua&&mr(C.s.vb,C.s.Wa);else{if(dt.h)break e;He?.(C,Je>qe?qe:Je),C.a=0,C.$=tn-Q}return 1}return C.a=3,0}function io(C){e(C!=null),C.vc=null,C.yc=null,C.Ya=null;var B=C.Wa;B!=null&&(B.X=null),C.vb=null,e(C!=null)}function Is(){var C=new Xr;return C==null?null:(C.a=0,C.xb=Vl,di("Predictor","VP8LPredictors"),di("Predictor","VP8LPredictors_C"),di("PredictorAdd","VP8LPredictorsAdd"),di("PredictorAdd","VP8LPredictorsAdd_C"),_s=wr,iu=Ir,za=Ei,nc=Pi,_l=or,Bl=oi,zl=Kr,F.VP8LMapColor32b=Ia,F.VP8LMapColor8b=yu,C)}function ga(C,B,Q,oe,Pe){var qe=1,He=[C],Je=[B],et=oe.m,dt=oe.s,Nt=null,tn=0;e:for(;;){if(Q)for(;qe&&xe(et,1);){var ct=He,Ft=Je,Qt=oe,En=1,y=Qt.m,a=Qt.gc[Qt.ab],f=xe(y,2);if(Qt.Oc&1<<f)qe=0;else{switch(Qt.Oc|=1<<f,a.hc=f,a.Ea=ct[0],a.nc=Ft[0],a.K=[null],++Qt.ab,e(4>=Qt.ab),f){case 0:case 1:a.b=xe(y,3)+2,En=ga(Ln(a.Ea,a.b),Ln(a.nc,a.b),0,Qt,a.K),a.K=a.K[0];break;case 3:var v,S=xe(y,8)+1,T=16<S?0:4<S?1:2<S?2:3;if(ct[0]=Ln(a.Ea,T),a.b=T,v=En=ga(S,1,0,Qt,a.K)){var N,z=S,G=a,ee=1<<(8>>G.b),te=u(ee);if(te==null)v=0;else{var ge=G.K[0],Ae=G.w;for(te[0]=G.K[0][0],N=1;N<1*z;++N)te[N]=ir(ge[Ae+N],te[N-1]);for(;N<4*ee;++N)te[N]=0;G.K[0]=null,G.K[0]=te,v=1}}En=v;break;case 2:break;default:e(0)}qe=En}}if(He=He[0],Je=Je[0],qe&&xe(et,1)&&!(qe=1<=(tn=xe(et,4))&&11>=tn)){oe.a=3;break e}var Le;if(Le=qe)t:{var Xe,Ue,Ze,_e=oe,$e=He,it=Je,ot=tn,bt=Q,wt=_e.m,vt=_e.s,Rt=[null],Lt=1,zt=0,mn=ao[ot];n:for(;;){if(bt&&xe(wt,1)){var Ut=xe(wt,3)+2,an=Ln($e,Ut),Ht=Ln(it,Ut),Cn=an*Ht;if(!ga(an,Ht,0,_e,Rt))break n;for(Rt=Rt[0],vt.xc=Ut,Xe=0;Xe<Cn;++Xe){var jt=Rt[Xe]>>8&65535;Rt[Xe]=jt,jt>=Lt&&(Lt=jt+1)}}if(wt.h)break n;for(Ue=0;5>Ue;++Ue){var on=ja[Ue];!Ue&&0<ot&&(on+=1<<ot),zt<on&&(zt=on)}var In=m(Lt*mn,Z),xn=Lt,bn=m(xn,Re);if(bn==null)var pr=null;else e(65536>=xn),pr=bn;var Fr=u(zt);if(pr==null||Fr==null||In==null){_e.a=1;break n}var sr=In;for(Xe=Ze=0;Xe<Lt;++Xe){var fr=pr[Xe],$r=fr.G,gi=fr.H,Sr=0,ki=1,Ci=0;for(Ue=0;5>Ue;++Ue){on=ja[Ue],$r[Ue]=sr,gi[Ue]=Ze,!Ue&&0<ot&&(on+=1<<ot);i:{var co,Ri=on,ba=_e,ts=Fr,cc=sr,Cc=Ze,Li=0,eo=ba.m,uo=xe(eo,1);if(c(ts,0,0,Ri),uo){var Ms=xe(eo,1)+1,qa=xe(eo,1),ns=xe(eo,qa==0?1:8);ts[ns]=1,Ms==2&&(ts[ns=xe(eo,8)]=1);var As=1}else{var hs=u(19),xs=xe(eo,4)+4;if(19<xs){ba.a=3;var ls=0;break i}for(co=0;co<xs;++co)hs[Ul[co]]=xe(eo,3);var $l=void 0,Il=void 0,ka=ba,rd=hs,Ys=Ri,Vh=ts,bd=0,Ou=ka.m,Bu=8,Lc=m(128,Z);r:for(;H(Lc,0,7,rd,19);){if(xe(Ou,1)){var qh=2+2*xe(Ou,3);if(($l=2+xe(Ou,qh))>Ys)break r}else $l=Ys;for(Il=0;Il<Ys&&$l--;){mt(Ou);var id=Lc[0+(127&Be(Ou))];rt(Ou,Ou.u+id.g);var zu=id.value;if(16>zu)Vh[Il++]=zu,zu!=0&&(Bu=zu);else{var Fd=zu==16,Pc=zu-16,ju=li[Pc],wd=xe(Ou,lr[Pc])+ju;if(Il+wd>Ys)break r;for(var Od=Fd?Bu:0;0<wd--;)Vh[Il++]=Od}}bd=1;break r}bd||(ka.a=3),As=bd}(As=As&&!eo.h)&&(Li=H(cc,Cc,8,ts,Ri)),As&&Li!=0?ls=Li:(ba.a=3,ls=0)}if(ls==0)break n;if(ki&&es[Ue]==1&&(ki=sr[Ze].g==0),Sr+=sr[Ze].g,Ze+=ls,3>=Ue){var lh,cf=Fr[0];for(lh=1;lh<on;++lh)Fr[lh]>cf&&(cf=Fr[lh]);Ci+=cf}}if(fr.nd=ki,fr.Qb=0,ki&&(fr.qb=($r[3][gi[3]+0].value<<24|$r[1][gi[1]+0].value<<16|$r[2][gi[2]+0].value)>>>0,Sr==0&&256>$r[0][gi[0]+0].value&&(fr.Qb=1,fr.qb+=$r[0][gi[0]+0].value<<8)),fr.jc=!fr.Qb&&6>Ci,fr.jc){var kh,kc=fr;for(kh=0;kh<bc;++kh){var uc=kh,$a=kc.pd[uc],Rc=kc.G[0][kc.H[0]+uc];256<=Rc.value?($a.g=Rc.g+256,$a.value=Rc.value):($a.g=0,$a.value=0,uc>>=Vr(Rc,8,$a),uc>>=Vr(kc.G[1][kc.H[1]+uc],16,$a),uc>>=Vr(kc.G[2][kc.H[2]+uc],0,$a),Vr(kc.G[3][kc.H[3]+uc],24,$a))}}}vt.vc=Rt,vt.Wb=Lt,vt.Ya=pr,vt.yc=In,Le=1;break t}Le=0}if(!(qe=Le)){oe.a=3;break e}if(0<tn){if(dt.ua=1<<tn,!st(dt.Wa,tn)){oe.a=1,qe=0;break e}}else dt.ua=0;var Gc=oe,Uu=He,ch=Je,Vu=Gc.s,uf=Vu.xc;if(Gc.c=Uu,Gc.i=ch,Vu.md=Ln(Uu,uf),Vu.wc=uf==0?-1:(1<<uf)-1,Q){oe.xb=Ua;break e}if((Nt=u(He*Je))==null){oe.a=1,qe=0;break e}qe=(qe=ys(oe,Nt,0,He,Je,Je,null))&&!et.h;break e}return qe?(Pe!=null?Pe[0]=Nt:(e(Nt==null),e(Q)),oe.$=0,Q||io(dt)):io(dt),qe}function gl(C,B){var Q=C.c*C.i,oe=Q+B+16*B;return e(C.c<=B),C.V=u(oe),C.V==null?(C.Ta=null,C.Ua=0,C.a=1,0):(C.Ta=C.V,C.Ua=C.Ba+Q+B,1)}function sl(C,B){var Q=C.C,oe=B-Q,Pe=C.V,qe=C.Ba+C.c*Q;for(e(B<=C.l.o);0<oe;){var He=16<oe?16:oe,Je=C.l.ma,et=C.l.width,dt=et*He,Nt=Je.ca,tn=Je.tb+et*Q,ct=C.Ta,Ft=C.Ua;Ai(C,He,Pe,qe),xl(ct,Ft,Nt,tn,dt),$o(Je,Q,Q+He,Nt,tn,et),oe-=He,Pe+=He*C.c,Q+=He}e(Q==B),C.C=C.Ma=B}function Wi(){this.ub=this.yd=this.td=this.Rb=0}function Jl(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function Lu(){this.Fb=this.Bb=this.Cb=0,this.Zb=u(4),this.Lb=u(4)}function Eo(){this.Yb=(function(){var C=[];return(function B(Q,oe,Pe){for(var qe=Pe[oe],He=0;He<qe&&(Q.push(Pe.length>oe+1?[]:0),!(Pe.length<oe+1));He++)B(Q[He],oe+1,Pe)})(C,0,[3,11]),C})()}function fu(){this.jb=u(3),this.Wc=_([4,8],Eo),this.Xc=_([4,17],Eo)}function Ea(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new u(4),this.od=new u(4)}function Ko(){this.ld=this.La=this.dd=this.tc=0}function Xa(){this.Na=this.la=0}function Nl(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function Ql(){this.ad=u(384),this.Za=0,this.Ob=u(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function Aa(){this.uc=this.M=this.Nb=0,this.wa=Array(new Ko),this.Y=0,this.ya=Array(new Ql),this.aa=0,this.l=new Xo}function sa(){this.y=u(16),this.f=u(8),this.ea=u(8)}function dn(){this.cb=this.a=0,this.sc="",this.m=new le,this.Od=new Wi,this.Kc=new Jl,this.ed=new Ea,this.Qa=new Lu,this.Ic=this.$c=this.Aa=0,this.D=new Aa,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=m(8,le),this.ia=0,this.pb=m(4,Nl),this.Pa=new fu,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new sa),this.Hd=0,this.rb=Array(new Xa),this.sb=0,this.wa=Array(new Ko),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new Ql),this.L=this.aa=0,this.gd=_([4,2],Ko),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function Xo(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function ss(){var C=new dn;return C!=null&&(C.a=0,C.sc="OK",C.cb=0,C.Xb=0,ni||(ni=Ya)),C}function xi(C,B,Q){return C.a==0&&(C.a=B,C.sc=Q,C.cb=0),0}function pu(C,B,Q){return 3<=Q&&C[B+0]==157&&C[B+1]==1&&C[B+2]==42}function Za(C,B){if(C==null)return 0;if(C.a=0,C.sc="OK",B==null)return xi(C,2,"null VP8Io passed to VP8GetHeaders()");var Q=B.data,oe=B.w,Pe=B.ha;if(4>Pe)return xi(C,7,"Truncated header.");var qe=Q[oe+0]|Q[oe+1]<<8|Q[oe+2]<<16,He=C.Od;if(He.Rb=!(1&qe),He.td=qe>>1&7,He.yd=qe>>4&1,He.ub=qe>>5,3<He.td)return xi(C,3,"Incorrect keyframe parameters.");if(!He.yd)return xi(C,4,"Frame not displayable.");oe+=3,Pe-=3;var Je=C.Kc;if(He.Rb){if(7>Pe)return xi(C,7,"cannot parse picture header");if(!pu(Q,oe,Pe))return xi(C,3,"Bad code word");Je.c=16383&(Q[oe+4]<<8|Q[oe+3]),Je.Td=Q[oe+4]>>6,Je.i=16383&(Q[oe+6]<<8|Q[oe+5]),Je.Ud=Q[oe+6]>>6,oe+=7,Pe-=7,C.za=Je.c+15>>4,C.Ub=Je.i+15>>4,B.width=Je.c,B.height=Je.i,B.Da=0,B.j=0,B.v=0,B.va=B.width,B.o=B.height,B.da=0,B.ib=B.width,B.hb=B.height,B.U=B.width,B.T=B.height,c((qe=C.Pa).jb,0,255,qe.jb.length),e((qe=C.Qa)!=null),qe.Cb=0,qe.Bb=0,qe.Fb=1,c(qe.Zb,0,0,qe.Zb.length),c(qe.Lb,0,0,qe.Lb)}if(He.ub>Pe)return xi(C,7,"bad partition length");Oe(qe=C.m,Q,oe,He.ub),oe+=He.ub,Pe-=He.ub,He.Rb&&(Je.Ld=Dt(qe),Je.Kd=Dt(qe)),Je=C.Qa;var et,dt=C.Pa;if(e(qe!=null),e(Je!=null),Je.Cb=Dt(qe),Je.Cb){if(Je.Bb=Dt(qe),Dt(qe)){for(Je.Fb=Dt(qe),et=0;4>et;++et)Je.Zb[et]=Dt(qe)?we(qe,7):0;for(et=0;4>et;++et)Je.Lb[et]=Dt(qe)?we(qe,6):0}if(Je.Bb)for(et=0;3>et;++et)dt.jb[et]=Dt(qe)?Ne(qe,8):255}else Je.Bb=0;if(qe.Ka)return xi(C,3,"cannot parse segment header");if((Je=C.ed).zd=Dt(qe),Je.Tb=Ne(qe,6),Je.wb=Ne(qe,3),Je.Pc=Dt(qe),Je.Pc&&Dt(qe)){for(dt=0;4>dt;++dt)Dt(qe)&&(Je.vd[dt]=we(qe,6));for(dt=0;4>dt;++dt)Dt(qe)&&(Je.od[dt]=we(qe,6))}if(C.L=Je.Tb==0?0:Je.zd?1:2,qe.Ka)return xi(C,3,"cannot parse filter header");var Nt=Pe;if(Pe=et=oe,oe=et+Nt,Je=Nt,C.Xb=(1<<Ne(C.m,2))-1,Nt<3*(dt=C.Xb))Q=7;else{for(et+=3*dt,Je-=3*dt,Nt=0;Nt<dt;++Nt){var tn=Q[Pe+0]|Q[Pe+1]<<8|Q[Pe+2]<<16;tn>Je&&(tn=Je),Oe(C.Jc[+Nt],Q,et,tn),et+=tn,Je-=tn,Pe+=3}Oe(C.Jc[+dt],Q,et,Je),Q=et<oe?0:5}if(Q!=0)return xi(C,Q,"cannot parse partitions");for(Q=Ne(et=C.m,7),Pe=Dt(et)?we(et,4):0,oe=Dt(et)?we(et,4):0,Je=Dt(et)?we(et,4):0,dt=Dt(et)?we(et,4):0,et=Dt(et)?we(et,4):0,Nt=C.Qa,tn=0;4>tn;++tn){if(Nt.Cb){var ct=Nt.Zb[tn];Nt.Fb||(ct+=Q)}else{if(0<tn){C.pb[tn]=C.pb[0];continue}ct=Q}var Ft=C.pb[tn];Ft.Sc[0]=Lh[zi(ct+Pe,127)],Ft.Sc[1]=Ph[zi(ct+0,127)],Ft.Eb[0]=2*Lh[zi(ct+oe,127)],Ft.Eb[1]=101581*Ph[zi(ct+Je,127)]>>16,8>Ft.Eb[1]&&(Ft.Eb[1]=8),Ft.Qc[0]=Lh[zi(ct+dt,117)],Ft.Qc[1]=Ph[zi(ct+et,127)],Ft.lc=ct+et}if(!He.Rb)return xi(C,4,"Not a key frame.");for(Dt(qe),He=C.Pa,Q=0;4>Q;++Q){for(Pe=0;8>Pe;++Pe)for(oe=0;3>oe;++oe)for(Je=0;11>Je;++Je)dt=Yt(qe,Sl[Q][Pe][oe][Je])?Ne(qe,8):wl[Q][Pe][oe][Je],He.Wc[Q][Pe].Yb[oe][Je]=dt;for(Pe=0;17>Pe;++Pe)He.Xc[Q][Pe]=He.Wc[Q][ih[Pe]]}return C.kc=Dt(qe),C.kc&&(C.Bd=Ne(qe,8)),C.cb=1}function Ya(C,B,Q,oe,Pe,qe,He){var Je=B[Pe].Yb[Q];for(Q=0;16>Pe;++Pe){if(!Yt(C,Je[Q+0]))return Pe;for(;!Yt(C,Je[Q+1]);)if(Je=B[++Pe].Yb[0],Q=0,Pe==16)return 16;var et=B[Pe+1].Yb;if(Yt(C,Je[Q+2])){var dt=C,Nt=0;if(Yt(dt,(ct=Je)[(tn=Q)+3]))if(Yt(dt,ct[tn+6])){for(Je=0,tn=2*(Nt=Yt(dt,ct[tn+8]))+(ct=Yt(dt,ct[tn+9+Nt])),Nt=0,ct=nh[tn];ct[Je];++Je)Nt+=Nt+Yt(dt,ct[Je]);Nt+=3+(8<<tn)}else Yt(dt,ct[tn+7])?(Nt=7+2*Yt(dt,165),Nt+=Yt(dt,145)):Nt=5+Yt(dt,159);else Nt=Yt(dt,ct[tn+4])?3+Yt(dt,ct[tn+5]):2;Je=et[2]}else Nt=1,Je=et[1];et=He+rh[Pe],0>(dt=C).b&&ft(dt);var tn,ct=dt.b,Ft=(tn=dt.Ca>>1)-(dt.I>>ct)>>31;--dt.b,dt.Ca+=Ft,dt.Ca|=1,dt.I-=(tn+1&Ft)<<ct,qe[et]=((Nt^Ft)-Ft)*oe[(0<Pe)+0]}return 16}function al(C){var B=C.rb[C.sb-1];B.la=0,B.Na=0,c(C.zc,0,0,C.zc.length),C.ja=0}function Cs(C,B,Q,oe,Pe){Pe=C[B+Q+32*oe]+(Pe>>3),C[B+Q+32*oe]=-256&Pe?0>Pe?0:255:Pe}function tr(C,B,Q,oe,Pe,qe){Cs(C,B,0,Q,oe+Pe),Cs(C,B,1,Q,oe+qe),Cs(C,B,2,Q,oe-qe),Cs(C,B,3,Q,oe-Pe)}function zr(C){return(20091*C>>16)+C}function Nr(C,B,Q,oe){var Pe,qe=0,He=u(16);for(Pe=0;4>Pe;++Pe){var Je=C[B+0]+C[B+8],et=C[B+0]-C[B+8],dt=(35468*C[B+4]>>16)-zr(C[B+12]),Nt=zr(C[B+4])+(35468*C[B+12]>>16);He[qe+0]=Je+Nt,He[qe+1]=et+dt,He[qe+2]=et-dt,He[qe+3]=Je-Nt,qe+=4,B++}for(Pe=qe=0;4>Pe;++Pe)Je=(C=He[qe+0]+4)+He[qe+8],et=C-He[qe+8],dt=(35468*He[qe+4]>>16)-zr(He[qe+12]),Cs(Q,oe,0,0,Je+(Nt=zr(He[qe+4])+(35468*He[qe+12]>>16))),Cs(Q,oe,1,0,et+dt),Cs(Q,oe,2,0,et-dt),Cs(Q,oe,3,0,Je-Nt),qe++,oe+=32}function js(C,B,Q,oe){var Pe=C[B+0]+4,qe=35468*C[B+4]>>16,He=zr(C[B+4]),Je=35468*C[B+1]>>16;tr(Q,oe,0,Pe+He,C=zr(C[B+1]),Je),tr(Q,oe,1,Pe+qe,C,Je),tr(Q,oe,2,Pe-qe,C,Je),tr(Q,oe,3,Pe-He,C,Je)}function Ta(C,B,Q,oe,Pe){Nr(C,B,Q,oe),Pe&&Nr(C,B+16,Q,oe+4)}function bi(C,B,Q,oe){el(C,B+0,Q,oe,1),el(C,B+32,Q,oe+128,1)}function Mi(C,B,Q,oe){var Pe;for(C=C[B+0]+4,Pe=0;4>Pe;++Pe)for(B=0;4>B;++B)Cs(Q,oe,B,Pe,C)}function yl(C,B,Q,oe){C[B+0]&&Wo(C,B+0,Q,oe),C[B+16]&&Wo(C,B+16,Q,oe+4),C[B+32]&&Wo(C,B+32,Q,oe+128),C[B+48]&&Wo(C,B+48,Q,oe+128+4)}function Gi(C,B,Q,oe){var Pe,qe=u(16);for(Pe=0;4>Pe;++Pe){var He=C[B+0+Pe]+C[B+12+Pe],Je=C[B+4+Pe]+C[B+8+Pe],et=C[B+4+Pe]-C[B+8+Pe],dt=C[B+0+Pe]-C[B+12+Pe];qe[0+Pe]=He+Je,qe[8+Pe]=He-Je,qe[4+Pe]=dt+et,qe[12+Pe]=dt-et}for(Pe=0;4>Pe;++Pe)He=(C=qe[0+4*Pe]+3)+qe[3+4*Pe],Je=qe[1+4*Pe]+qe[2+4*Pe],et=qe[1+4*Pe]-qe[2+4*Pe],dt=C-qe[3+4*Pe],Q[oe+0]=He+Je>>3,Q[oe+16]=dt+et>>3,Q[oe+32]=He-Je>>3,Q[oe+48]=dt-et>>3,oe+=64}function fs(C,B,Q){var oe,Pe=B-32,qe=as,He=255-C[Pe-1];for(oe=0;oe<Q;++oe){var Je,et=qe,dt=He+C[B-1];for(Je=0;Je<Q;++Je)C[B+Je]=et[dt+C[Pe+Je]];B+=32}}function Ui(C,B){fs(C,B,4)}function mu(C,B){fs(C,B,8)}function ec(C,B){fs(C,B,16)}function nu(C,B){var Q;for(Q=0;16>Q;++Q)i(C,B+32*Q,C,B-32,16)}function _c(C,B){var Q;for(Q=16;0<Q;--Q)c(C,B,C[B-1],16),B+=32}function tc(C,B,Q){var oe;for(oe=0;16>oe;++oe)c(B,Q+32*oe,C,16)}function Da(C,B){var Q,oe=16;for(Q=0;16>Q;++Q)oe+=C[B-1+32*Q]+C[B+Q-32];tc(oe>>5,C,B)}function Ls(C,B){var Q,oe=8;for(Q=0;16>Q;++Q)oe+=C[B-1+32*Q];tc(oe>>4,C,B)}function Vi(C,B){var Q,oe=8;for(Q=0;16>Q;++Q)oe+=C[B+Q-32];tc(oe>>4,C,B)}function Fa(C,B){tc(128,C,B)}function ai(C,B,Q){return C+2*B+Q+2>>2}function Zo(C,B){var Q,oe=B-32;for(oe=new Uint8Array([ai(C[oe-1],C[oe+0],C[oe+1]),ai(C[oe+0],C[oe+1],C[oe+2]),ai(C[oe+1],C[oe+2],C[oe+3]),ai(C[oe+2],C[oe+3],C[oe+4])]),Q=0;4>Q;++Q)i(C,B+32*Q,oe,0,oe.length)}function Ao(C,B){var Q=C[B-1],oe=C[B-1+32],Pe=C[B-1+64],qe=C[B-1+96];cn(C,B+0,16843009*ai(C[B-1-32],Q,oe)),cn(C,B+32,16843009*ai(Q,oe,Pe)),cn(C,B+64,16843009*ai(oe,Pe,qe)),cn(C,B+96,16843009*ai(Pe,qe,qe))}function Ih(C,B){var Q,oe=4;for(Q=0;4>Q;++Q)oe+=C[B+Q-32]+C[B-1+32*Q];for(oe>>=3,Q=0;4>Q;++Q)c(C,B+32*Q,oe,4)}function Pu(C,B){var Q=C[B-1+0],oe=C[B-1+32],Pe=C[B-1+64],qe=C[B-1-32],He=C[B+0-32],Je=C[B+1-32],et=C[B+2-32],dt=C[B+3-32];C[B+0+96]=ai(oe,Pe,C[B-1+96]),C[B+1+96]=C[B+0+64]=ai(Q,oe,Pe),C[B+2+96]=C[B+1+64]=C[B+0+32]=ai(qe,Q,oe),C[B+3+96]=C[B+2+64]=C[B+1+32]=C[B+0+0]=ai(He,qe,Q),C[B+3+64]=C[B+2+32]=C[B+1+0]=ai(Je,He,qe),C[B+3+32]=C[B+2+0]=ai(et,Je,He),C[B+3+0]=ai(dt,et,Je)}function _o(C,B){var Q=C[B+1-32],oe=C[B+2-32],Pe=C[B+3-32],qe=C[B+4-32],He=C[B+5-32],Je=C[B+6-32],et=C[B+7-32];C[B+0+0]=ai(C[B+0-32],Q,oe),C[B+1+0]=C[B+0+32]=ai(Q,oe,Pe),C[B+2+0]=C[B+1+32]=C[B+0+64]=ai(oe,Pe,qe),C[B+3+0]=C[B+2+32]=C[B+1+64]=C[B+0+96]=ai(Pe,qe,He),C[B+3+32]=C[B+2+64]=C[B+1+96]=ai(qe,He,Je),C[B+3+64]=C[B+2+96]=ai(He,Je,et),C[B+3+96]=ai(Je,et,et)}function Us(C,B){var Q=C[B-1+0],oe=C[B-1+32],Pe=C[B-1+64],qe=C[B-1-32],He=C[B+0-32],Je=C[B+1-32],et=C[B+2-32],dt=C[B+3-32];C[B+0+0]=C[B+1+64]=qe+He+1>>1,C[B+1+0]=C[B+2+64]=He+Je+1>>1,C[B+2+0]=C[B+3+64]=Je+et+1>>1,C[B+3+0]=et+dt+1>>1,C[B+0+96]=ai(Pe,oe,Q),C[B+0+64]=ai(oe,Q,qe),C[B+0+32]=C[B+1+96]=ai(Q,qe,He),C[B+1+32]=C[B+2+96]=ai(qe,He,Je),C[B+2+32]=C[B+3+96]=ai(He,Je,et),C[B+3+32]=ai(Je,et,dt)}function ku(C,B){var Q=C[B+0-32],oe=C[B+1-32],Pe=C[B+2-32],qe=C[B+3-32],He=C[B+4-32],Je=C[B+5-32],et=C[B+6-32],dt=C[B+7-32];C[B+0+0]=Q+oe+1>>1,C[B+1+0]=C[B+0+64]=oe+Pe+1>>1,C[B+2+0]=C[B+1+64]=Pe+qe+1>>1,C[B+3+0]=C[B+2+64]=qe+He+1>>1,C[B+0+32]=ai(Q,oe,Pe),C[B+1+32]=C[B+0+96]=ai(oe,Pe,qe),C[B+2+32]=C[B+1+96]=ai(Pe,qe,He),C[B+3+32]=C[B+2+96]=ai(qe,He,Je),C[B+3+64]=ai(He,Je,et),C[B+3+96]=ai(Je,et,dt)}function Go(C,B){var Q=C[B-1+0],oe=C[B-1+32],Pe=C[B-1+64],qe=C[B-1+96];C[B+0+0]=Q+oe+1>>1,C[B+2+0]=C[B+0+32]=oe+Pe+1>>1,C[B+2+32]=C[B+0+64]=Pe+qe+1>>1,C[B+1+0]=ai(Q,oe,Pe),C[B+3+0]=C[B+1+32]=ai(oe,Pe,qe),C[B+3+32]=C[B+1+64]=ai(Pe,qe,qe),C[B+3+64]=C[B+2+64]=C[B+0+96]=C[B+1+96]=C[B+2+96]=C[B+3+96]=qe}function vo(C,B){var Q=C[B-1+0],oe=C[B-1+32],Pe=C[B-1+64],qe=C[B-1+96],He=C[B-1-32],Je=C[B+0-32],et=C[B+1-32],dt=C[B+2-32];C[B+0+0]=C[B+2+32]=Q+He+1>>1,C[B+0+32]=C[B+2+64]=oe+Q+1>>1,C[B+0+64]=C[B+2+96]=Pe+oe+1>>1,C[B+0+96]=qe+Pe+1>>1,C[B+3+0]=ai(Je,et,dt),C[B+2+0]=ai(He,Je,et),C[B+1+0]=C[B+3+32]=ai(Q,He,Je),C[B+1+32]=C[B+3+64]=ai(oe,Q,He),C[B+1+64]=C[B+3+96]=ai(Pe,oe,Q),C[B+1+96]=ai(qe,Pe,oe)}function Dl(C,B){var Q;for(Q=0;8>Q;++Q)i(C,B+32*Q,C,B-32,8)}function Oa(C,B){var Q;for(Q=0;8>Q;++Q)c(C,B,C[B-1],8),B+=32}function Vs(C,B,Q){var oe;for(oe=0;8>oe;++oe)c(B,Q+32*oe,C,8)}function Bo(C,B){var Q,oe=8;for(Q=0;8>Q;++Q)oe+=C[B+Q-32]+C[B-1+32*Q];Vs(oe>>4,C,B)}function Bc(C,B){var Q,oe=4;for(Q=0;8>Q;++Q)oe+=C[B+Q-32];Vs(oe>>3,C,B)}function Ho(C,B){var Q,oe=4;for(Q=0;8>Q;++Q)oe+=C[B-1+32*Q];Vs(oe>>3,C,B)}function ya(C,B){Vs(128,C,B)}function Ja(C,B,Q){var oe=C[B-Q],Pe=C[B+0],qe=3*(Pe-oe)+Ac[1020+C[B-2*Q]-C[B+Q]],He=hl[112+(qe+4>>3)];C[B-Q]=as[255+oe+hl[112+(qe+3>>3)]],C[B+0]=as[255+Pe-He]}function ll(C,B,Q,oe){var Pe=C[B+0],qe=C[B+Q];return Tc[255+C[B-2*Q]-C[B-Q]]>oe||Tc[255+qe-Pe]>oe}function ru(C,B,Q,oe){return 4*Tc[255+C[B-Q]-C[B+0]]+Tc[255+C[B-2*Q]-C[B+Q]]<=oe}function vc(C,B,Q,oe,Pe){var qe=C[B-3*Q],He=C[B-2*Q],Je=C[B-Q],et=C[B+0],dt=C[B+Q],Nt=C[B+2*Q],tn=C[B+3*Q];return 4*Tc[255+Je-et]+Tc[255+He-dt]>oe?0:Tc[255+C[B-4*Q]-qe]<=Pe&&Tc[255+qe-He]<=Pe&&Tc[255+He-Je]<=Pe&&Tc[255+tn-Nt]<=Pe&&Tc[255+Nt-dt]<=Pe&&Tc[255+dt-et]<=Pe}function qs(C,B,Q,oe){var Pe=2*oe+1;for(oe=0;16>oe;++oe)ru(C,B+oe,Q,Pe)&&Ja(C,B+oe,Q)}function Ti(C,B,Q,oe){var Pe=2*oe+1;for(oe=0;16>oe;++oe)ru(C,B+oe*Q,1,Pe)&&Ja(C,B+oe*Q,1)}function Ss(C,B,Q,oe){var Pe;for(Pe=3;0<Pe;--Pe)qs(C,B+=4*Q,Q,oe)}function $s(C,B,Q,oe){var Pe;for(Pe=3;0<Pe;--Pe)Ti(C,B+=4,Q,oe)}function aa(C,B,Q,oe,Pe,qe,He,Je){for(qe=2*qe+1;0<Pe--;){if(vc(C,B,Q,qe,He))if(ll(C,B,Q,Je))Ja(C,B,Q);else{var et=C,dt=B,Nt=Q,tn=et[dt-2*Nt],ct=et[dt-Nt],Ft=et[dt+0],Qt=et[dt+Nt],En=et[dt+2*Nt],y=27*(f=Ac[1020+3*(Ft-ct)+Ac[1020+tn-Qt]])+63>>7,a=18*f+63>>7,f=9*f+63>>7;et[dt-3*Nt]=as[255+et[dt-3*Nt]+f],et[dt-2*Nt]=as[255+tn+a],et[dt-Nt]=as[255+ct+y],et[dt+0]=as[255+Ft-y],et[dt+Nt]=as[255+Qt-a],et[dt+2*Nt]=as[255+En-f]}B+=oe}}function la(C,B,Q,oe,Pe,qe,He,Je){for(qe=2*qe+1;0<Pe--;){if(vc(C,B,Q,qe,He))if(ll(C,B,Q,Je))Ja(C,B,Q);else{var et=C,dt=B,Nt=Q,tn=et[dt-Nt],ct=et[dt+0],Ft=et[dt+Nt],Qt=hl[112+(4+(En=3*(ct-tn))>>3)],En=hl[112+(En+3>>3)],y=Qt+1>>1;et[dt-2*Nt]=as[255+et[dt-2*Nt]+y],et[dt-Nt]=as[255+tn+En],et[dt+0]=as[255+ct-Qt],et[dt+Nt]=as[255+Ft-y]}B+=oe}}function cl(C,B,Q,oe,Pe,qe){aa(C,B,Q,1,16,oe,Pe,qe)}function Gs(C,B,Q,oe,Pe,qe){aa(C,B,1,Q,16,oe,Pe,qe)}function Hs(C,B,Q,oe,Pe,qe){var He;for(He=3;0<He;--He)la(C,B+=4*Q,Q,1,16,oe,Pe,qe)}function xc(C,B,Q,oe,Pe,qe){var He;for(He=3;0<He;--He)la(C,B+=4,1,Q,16,oe,Pe,qe)}function W(C,B,Q,oe,Pe,qe,He,Je){aa(C,B,Pe,1,8,qe,He,Je),aa(Q,oe,Pe,1,8,qe,He,Je)}function Ce(C,B,Q,oe,Pe,qe,He,Je){aa(C,B,1,Pe,8,qe,He,Je),aa(Q,oe,1,Pe,8,qe,He,Je)}function pt(C,B,Q,oe,Pe,qe,He,Je){la(C,B+4*Pe,Pe,1,8,qe,He,Je),la(Q,oe+4*Pe,Pe,1,8,qe,He,Je)}function yt(C,B,Q,oe,Pe,qe,He,Je){la(C,B+4,1,Pe,8,qe,He,Je),la(Q,oe+4,1,Pe,8,qe,He,Je)}function qt(){this.ba=new Ie,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new ht,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function Zt(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function Fn(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function Dr(){this.ua=0,this.Wa=new Er,this.vb=new Er,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new Re,this.yc=new Z}function Xr(){this.xb=this.a=0,this.l=new Xo,this.ca=new Ie,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new De,this.Pb=0,this.wd=new De,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new Dr,this.ab=0,this.gc=m(4,Fn),this.Oc=0}function yi(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new Xo,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function Ii(C,B,Q,oe,Pe,qe,He){for(C=C==null?0:C[B+0],B=0;B<He;++B)Pe[qe+B]=C+Q[oe+B]&255,C=Pe[qe+B]}function xo(C,B,Q,oe,Pe,qe,He){var Je;if(C==null)Ii(null,null,Q,oe,Pe,qe,He);else for(Je=0;Je<He;++Je)Pe[qe+Je]=C[B+Je]+Q[oe+Je]&255}function bo(C,B,Q,oe,Pe,qe,He){if(C==null)Ii(null,null,Q,oe,Pe,qe,He);else{var Je,et=C[B+0],dt=et,Nt=et;for(Je=0;Je<He;++Je)dt=Nt+(et=C[B+Je])-dt,Nt=Q[oe+Je]+(-256&dt?0>dt?0:255:dt)&255,dt=et,Pe[qe+Je]=Nt}}function Yo(C,B,Q,oe){var Pe=B.width,qe=B.o;if(e(C!=null&&B!=null),0>Q||0>=oe||Q+oe>qe)return null;if(!C.Cc){if(C.ga==null){var He;if(C.ga=new yi,(He=C.ga==null)||(He=B.width*B.o,e(C.Gb.length==0),C.Gb=u(He),C.Uc=0,C.Gb==null?He=0:(C.mb=C.Gb,C.nb=C.Uc,C.rc=null,He=1),He=!He),!He){He=C.ga;var Je=C.Fa,et=C.P,dt=C.qc,Nt=C.mb,tn=C.nb,ct=et+1,Ft=dt-1,Qt=He.l;if(e(Je!=null&&Nt!=null&&B!=null),Va[0]=null,Va[1]=Ii,Va[2]=xo,Va[3]=bo,He.ca=Nt,He.tb=tn,He.c=B.width,He.i=B.height,e(0<He.c&&0<He.i),1>=dt)B=0;else if(He.$a=3&Je[et+0],He.Z=Je[et+0]>>2&3,He.Lc=Je[et+0]>>4&3,et=Je[et+0]>>6&3,0>He.$a||1<He.$a||4<=He.Z||1<He.Lc||et)B=0;else if(Qt.put=Pt,Qt.ac=Et,Qt.bc=vn,Qt.ma=He,Qt.width=B.width,Qt.height=B.height,Qt.Da=B.Da,Qt.v=B.v,Qt.va=B.va,Qt.j=B.j,Qt.o=B.o,He.$a)e:{e(He.$a==1),B=Is();t:for(;;){if(B==null){B=0;break e}if(e(He!=null),He.mc=B,B.c=He.c,B.i=He.i,B.l=He.l,B.l.ma=He,B.l.width=He.c,B.l.height=He.i,B.a=0,Fe(B.m,Je,ct,Ft),!ga(He.c,He.i,1,B,null)||(B.ab==1&&B.gc[0].hc==3&&yo(B.s)?(He.ic=1,Je=B.c*B.i,B.Ta=null,B.Ua=0,B.V=u(Je),B.Ba=0,B.V==null?(B.a=1,B=0):B=1):(He.ic=0,B=gl(B,He.c)),!B))break t;B=1;break e}He.mc=null,B=0}else B=Ft>=He.c*He.i;He=!B}if(He)return null;C.ga.Lc!=1?C.Ga=0:oe=qe-Q}e(C.ga!=null),e(Q+oe<=qe);e:{if(B=(Je=C.ga).c,qe=Je.l.o,Je.$a==0){if(ct=C.rc,Ft=C.Vc,Qt=C.Fa,et=C.P+1+Q*B,dt=C.mb,Nt=C.nb+Q*B,e(et<=C.P+C.qc),Je.Z!=0)for(e(Va[Je.Z]!=null),He=0;He<oe;++He)Va[Je.Z](ct,Ft,Qt,et,dt,Nt,B),ct=dt,Ft=Nt,Nt+=B,et+=B;else for(He=0;He<oe;++He)i(dt,Nt,Qt,et,B),ct=dt,Ft=Nt,Nt+=B,et+=B;C.rc=ct,C.Vc=Ft}else{if(e(Je.mc!=null),B=Q+oe,e((He=Je.mc)!=null),e(B<=He.i),He.C>=B)B=1;else if(Je.ic||jo(),Je.ic){Je=He.V,ct=He.Ba,Ft=He.c;var En=He.i,y=(Qt=1,et=He.$/Ft,dt=He.$%Ft,Nt=He.m,tn=He.s,He.$),a=Ft*En,f=Ft*B,v=tn.wc,S=y<f?Ar(tn,dt,et):null;e(y<=a),e(B<=En),e(yo(tn));t:for(;;){for(;!Nt.h&&y<f;){if(dt&v||(S=Ar(tn,dt,et)),e(S!=null),mt(Nt),256>(En=Lr(S.G[0],S.H[0],Nt)))Je[ct+y]=En,++y,++dt>=Ft&&(dt=0,++et<=B&&!(et%16)&&ro(He,et));else{if(!(280>En)){Qt=0;break t}En=Tn(En-256,Nt);var T,N=Lr(S.G[4],S.H[4],Nt);if(mt(Nt),!(y>=(N=kr(Ft,N=Tn(N,Nt)))&&a-y>=En)){Qt=0;break t}for(T=0;T<En;++T)Je[ct+y+T]=Je[ct+y+T-N];for(y+=En,dt+=En;dt>=Ft;)dt-=Ft,++et<=B&&!(et%16)&&ro(He,et);y<f&&dt&v&&(S=Ar(tn,dt,et))}e(Nt.h==Ye(Nt))}ro(He,et>B?B:et);break t}!Qt||Nt.h&&y<a?(Qt=0,He.a=Nt.h?5:3):He.$=y,B=Qt}else B=ys(He,He.V,He.Ba,He.c,He.i,B,sl);if(!B){oe=0;break e}}Q+oe>=qe&&(C.Cc=1),oe=1}if(!oe)return null;if(C.Cc&&((oe=C.ga)!=null&&(oe.mc=null),C.ga=null,0<C.Ga))return alert("todo:WebPDequantizeLevels"),null}return C.nb+Q*Pe}function Ro(C,B,Q,oe,Pe,qe){for(;0<Pe--;){var He,Je=C,et=B+(Q?1:0),dt=C,Nt=B+(Q?0:3);for(He=0;He<oe;++He){var tn=dt[Nt+4*He];tn!=255&&(tn*=32897,Je[et+4*He+0]=Je[et+4*He+0]*tn>>23,Je[et+4*He+1]=Je[et+4*He+1]*tn>>23,Je[et+4*He+2]=Je[et+4*He+2]*tn>>23)}B+=qe}}function zo(C,B,Q,oe,Pe){for(;0<oe--;){var qe;for(qe=0;qe<Q;++qe){var He=C[B+2*qe+0],Je=15&(dt=C[B+2*qe+1]),et=4369*Je,dt=(240&dt|dt>>4)*et>>16;C[B+2*qe+0]=(240&He|He>>4)*et>>16&240|(15&He|He<<4)*et>>16>>4&15,C[B+2*qe+1]=240&dt|Je}B+=Pe}}function Jo(C,B,Q,oe,Pe,qe,He,Je){var et,dt,Nt=255;for(dt=0;dt<Pe;++dt){for(et=0;et<oe;++et){var tn=C[B+et];qe[He+4*et]=tn,Nt&=tn}B+=Q,He+=Je}return Nt!=255}function us(C,B,Q,oe,Pe){var qe;for(qe=0;qe<Pe;++qe)Q[oe+qe]=C[B+qe]>>8}function jo(){La=Ro,Uc=zo,Mu=Jo,xl=us}function Es(C,B,Q){F[C]=function(oe,Pe,qe,He,Je,et,dt,Nt,tn,ct,Ft,Qt,En,y,a,f,v){var S,T=v-1>>1,N=Je[et+0]|dt[Nt+0]<<16,z=tn[ct+0]|Ft[Qt+0]<<16;e(oe!=null);var G=3*N+z+131074>>2;for(B(oe[Pe+0],255&G,G>>16,En,y),qe!=null&&(G=3*z+N+131074>>2,B(qe[He+0],255&G,G>>16,a,f)),S=1;S<=T;++S){var ee=Je[et+S]|dt[Nt+S]<<16,te=tn[ct+S]|Ft[Qt+S]<<16,ge=N+ee+z+te+524296,Ae=ge+2*(ee+z)>>3;G=Ae+N>>1,N=(ge=ge+2*(N+te)>>3)+ee>>1,B(oe[Pe+2*S-1],255&G,G>>16,En,y+(2*S-1)*Q),B(oe[Pe+2*S-0],255&N,N>>16,En,y+(2*S-0)*Q),qe!=null&&(G=ge+z>>1,N=Ae+te>>1,B(qe[He+2*S-1],255&G,G>>16,a,f+(2*S-1)*Q),B(qe[He+2*S+0],255&N,N>>16,a,f+(2*S+0)*Q)),N=ee,z=te}1&v||(G=3*N+z+131074>>2,B(oe[Pe+v-1],255&G,G>>16,En,y+(v-1)*Q),qe!=null&&(G=3*z+N+131074>>2,B(qe[He+v-1],255&G,G>>16,a,f+(v-1)*Q)))}}function zc(){lo[Vc]=vd,lo[ha]=ql,lo[Du]=nd,lo[qc]=_u,lo[oc]=xa,lo[qn]=vu,lo[jl]=xd,lo[va]=ql,lo[$c]=_u,lo[ou]=xa,lo[su]=vu}function Qa(C){return C&-16384?0>C?0:255:C>>xu}function L(C,B){return Qa((19077*C>>8)+(26149*B>>8)-14234)}function ae(C,B,Q){return Qa((19077*C>>8)-(6419*B>>8)-(13320*Q>>8)+8708)}function ve(C,B){return Qa((19077*C>>8)+(33050*B>>8)-17685)}function Ge(C,B,Q,oe,Pe){oe[Pe+0]=L(C,Q),oe[Pe+1]=ae(C,B,Q),oe[Pe+2]=ve(C,B)}function Xt(C,B,Q,oe,Pe){oe[Pe+0]=ve(C,B),oe[Pe+1]=ae(C,B,Q),oe[Pe+2]=L(C,Q)}function hn(C,B,Q,oe,Pe){var qe=ae(C,B,Q);B=qe<<3&224|ve(C,B)>>3,oe[Pe+0]=248&L(C,Q)|qe>>5,oe[Pe+1]=B}function ar(C,B,Q,oe,Pe){var qe=240&ve(C,B)|15;oe[Pe+0]=240&L(C,Q)|ae(C,B,Q)>>4,oe[Pe+1]=qe}function so(C,B,Q,oe,Pe){oe[Pe+0]=255,Ge(C,B,Q,oe,Pe+1)}function Fo(C,B,Q,oe,Pe){Xt(C,B,Q,oe,Pe),oe[Pe+3]=255}function Ki(C,B,Q,oe,Pe){Ge(C,B,Q,oe,Pe),oe[Pe+3]=255}function zi(C,B){return 0>C?0:C>B?B:C}function Mo(C,B,Q){F[C]=function(oe,Pe,qe,He,Je,et,dt,Nt,tn){for(var ct=Nt+(-2&tn)*Q;Nt!=ct;)B(oe[Pe+0],qe[He+0],Je[et+0],dt,Nt),B(oe[Pe+1],qe[He+0],Je[et+0],dt,Nt+Q),Pe+=2,++He,++et,Nt+=2*Q;1&tn&&B(oe[Pe+0],qe[He+0],Je[et+0],dt,Nt)}}function ca(C,B,Q){return Q==0?C==0?B==0?6:5:B==0?4:0:Q}function Lo(C,B,Q,oe,Pe){switch(C>>>30){case 3:el(B,Q,oe,Pe,0);break;case 2:ks(B,Q,oe,Pe);break;case 1:Wo(B,Q,oe,Pe)}}function Bi(C,B){var Q,oe,Pe=B.M,qe=B.Nb,He=C.oc,Je=C.pc+40,et=C.oc,dt=C.pc+584,Nt=C.oc,tn=C.pc+600;for(Q=0;16>Q;++Q)He[Je+32*Q-1]=129;for(Q=0;8>Q;++Q)et[dt+32*Q-1]=129,Nt[tn+32*Q-1]=129;for(0<Pe?He[Je-1-32]=et[dt-1-32]=Nt[tn-1-32]=129:(c(He,Je-32-1,127,21),c(et,dt-32-1,127,9),c(Nt,tn-32-1,127,9)),oe=0;oe<C.za;++oe){var ct=B.ya[B.aa+oe];if(0<oe){for(Q=-1;16>Q;++Q)i(He,Je+32*Q-4,He,Je+32*Q+12,4);for(Q=-1;8>Q;++Q)i(et,dt+32*Q-4,et,dt+32*Q+4,4),i(Nt,tn+32*Q-4,Nt,tn+32*Q+4,4)}var Ft=C.Gd,Qt=C.Hd+oe,En=ct.ad,y=ct.Hc;if(0<Pe&&(i(He,Je-32,Ft[Qt].y,0,16),i(et,dt-32,Ft[Qt].f,0,8),i(Nt,tn-32,Ft[Qt].ea,0,8)),ct.Za){var a=He,f=Je-32+16;for(0<Pe&&(oe>=C.za-1?c(a,f,Ft[Qt].y[15],4):i(a,f,Ft[Qt+1].y,0,4)),Q=0;4>Q;Q++)a[f+128+Q]=a[f+256+Q]=a[f+384+Q]=a[f+0+Q];for(Q=0;16>Q;++Q,y<<=2)a=He,f=Je+lc[Q],Al[ct.Ob[Q]](a,f),Lo(y,En,16*+Q,a,f)}else if(a=ca(oe,Pe,ct.Ob[0]),El[a](He,Je),y!=0)for(Q=0;16>Q;++Q,y<<=2)Lo(y,En,16*+Q,He,Je+lc[Q]);for(Q=ct.Gc,a=ca(oe,Pe,ct.Dd),Ni[a](et,dt),Ni[a](Nt,tn),y=En,a=et,f=dt,255&(ct=0|Q)&&(170&ct?No(y,256,a,f):Vo(y,256,a,f)),ct=Nt,y=tn,255&(Q>>=8)&&(170&Q?No(En,320,ct,y):Vo(En,320,ct,y)),Pe<C.Ub-1&&(i(Ft[Qt].y,0,He,Je+480,16),i(Ft[Qt].f,0,et,dt+224,8),i(Ft[Qt].ea,0,Nt,tn+224,8)),Q=8*qe*C.B,Ft=C.sa,Qt=C.ta+16*oe+16*qe*C.R,En=C.qa,ct=C.ra+8*oe+Q,y=C.Ha,a=C.Ia+8*oe+Q,Q=0;16>Q;++Q)i(Ft,Qt+Q*C.R,He,Je+32*Q,16);for(Q=0;8>Q;++Q)i(En,ct+Q*C.B,et,dt+32*Q,8),i(y,a+Q*C.B,Nt,tn+32*Q,8)}}function Fl(C,B,Q,oe,Pe,qe,He,Je,et){var dt=[0],Nt=[0],tn=0,ct=et!=null?et.kd:0,Ft=et??new Zt;if(C==null||12>Q)return 7;Ft.data=C,Ft.w=B,Ft.ha=Q,B=[B],Q=[Q],Ft.gb=[Ft.gb];e:{var Qt=B,En=Q,y=Ft.gb;if(e(C!=null),e(En!=null),e(y!=null),y[0]=0,12<=En[0]&&!t(C,Qt[0],"RIFF")){if(t(C,Qt[0]+8,"WEBP")){y=3;break e}var a=Gt(C,Qt[0]+4);if(12>a||4294967286<a){y=3;break e}if(ct&&a>En[0]-8){y=7;break e}y[0]=a,Qt[0]+=12,En[0]-=12}y=0}if(y!=0)return y;for(a=0<Ft.gb[0],Q=Q[0];;){e:{var f=C;En=B,y=Q;var v=dt,S=Nt,T=Qt=[0];if((G=tn=[tn])[0]=0,8>y[0])y=7;else{if(!t(f,En[0],"VP8X")){if(Gt(f,En[0]+4)!=10){y=3;break e}if(18>y[0]){y=7;break e}var N=Gt(f,En[0]+8),z=1+Mn(f,En[0]+12);if(2147483648<=z*(f=1+Mn(f,En[0]+15))){y=3;break e}T!=null&&(T[0]=N),v!=null&&(v[0]=z),S!=null&&(S[0]=f),En[0]+=18,y[0]-=18,G[0]=1}y=0}}if(tn=tn[0],Qt=Qt[0],y!=0)return y;if(En=!!(2&Qt),!a&&tn)return 3;if(qe!=null&&(qe[0]=!!(16&Qt)),He!=null&&(He[0]=En),Je!=null&&(Je[0]=0),He=dt[0],Qt=Nt[0],tn&&En&&et==null){y=0;break}if(4>Q){y=7;break}if(a&&tn||!a&&!tn&&!t(C,B[0],"ALPH")){Q=[Q],Ft.na=[Ft.na],Ft.P=[Ft.P],Ft.Sa=[Ft.Sa];e:{N=C,y=B,a=Q;var G=Ft.gb;v=Ft.na,S=Ft.P,T=Ft.Sa,z=22,e(N!=null),e(a!=null),f=y[0];var ee=a[0];for(e(v!=null),e(T!=null),v[0]=null,S[0]=null,T[0]=0;;){if(y[0]=f,a[0]=ee,8>ee){y=7;break e}var te=Gt(N,f+4);if(4294967286<te){y=3;break e}var ge=8+te+1&-2;if(z+=ge,0<G&&z>G){y=3;break e}if(!t(N,f,"VP8 ")||!t(N,f,"VP8L")){y=0;break e}if(ee[0]<ge){y=7;break e}t(N,f,"ALPH")||(v[0]=N,S[0]=f+8,T[0]=te),f+=ge,ee-=ge}}if(Q=Q[0],Ft.na=Ft.na[0],Ft.P=Ft.P[0],Ft.Sa=Ft.Sa[0],y!=0)break}Q=[Q],Ft.Ja=[Ft.Ja],Ft.xa=[Ft.xa];e:if(G=C,y=B,a=Q,v=Ft.gb[0],S=Ft.Ja,T=Ft.xa,N=y[0],f=!t(G,N,"VP8 "),z=!t(G,N,"VP8L"),e(G!=null),e(a!=null),e(S!=null),e(T!=null),8>a[0])y=7;else{if(f||z){if(G=Gt(G,N+4),12<=v&&G>v-12){y=3;break e}if(ct&&G>a[0]-8){y=7;break e}S[0]=G,y[0]+=8,a[0]-=8,T[0]=z}else T[0]=5<=a[0]&&G[N+0]==47&&!(G[N+4]>>5),S[0]=a[0];y=0}if(Q=Q[0],Ft.Ja=Ft.Ja[0],Ft.xa=Ft.xa[0],B=B[0],y!=0)break;if(4294967286<Ft.Ja)return 3;if(Je==null||En||(Je[0]=Ft.xa?2:1),He=[He],Qt=[Qt],Ft.xa){if(5>Q){y=7;break}Je=He,ct=Qt,En=qe,C==null||5>Q?C=0:5<=Q&&C[B+0]==47&&!(C[B+4]>>5)?(a=[0],G=[0],v=[0],Fe(S=new De,C,B,Q),Bn(S,a,G,v)?(Je!=null&&(Je[0]=a[0]),ct!=null&&(ct[0]=G[0]),En!=null&&(En[0]=v[0]),C=1):C=0):C=0}else{if(10>Q){y=7;break}Je=Qt,C==null||10>Q||!pu(C,B+3,Q-3)?C=0:(ct=C[B+0]|C[B+1]<<8|C[B+2]<<16,En=16383&(C[B+7]<<8|C[B+6]),C=16383&(C[B+9]<<8|C[B+8]),1&ct||3<(ct>>1&7)||!(ct>>4&1)||ct>>5>=Ft.Ja||!En||!C?C=0:(He&&(He[0]=En),Je&&(Je[0]=C),C=1))}if(!C||(He=He[0],Qt=Qt[0],tn&&(dt[0]!=He||Nt[0]!=Qt)))return 3;et!=null&&(et[0]=Ft,et.offset=B-et.w,e(4294967286>B-et.w),e(et.offset==et.ha-Q));break}return y==0||y==7&&tn&&et==null?(qe!=null&&(qe[0]|=Ft.na!=null&&0<Ft.na.length),oe!=null&&(oe[0]=He),Pe!=null&&(Pe[0]=Qt),0):y}function ua(C,B,Q){var oe=B.width,Pe=B.height,qe=0,He=0,Je=oe,et=Pe;if(B.Da=C!=null&&0<C.Da,B.Da&&(Je=C.cd,et=C.bd,qe=C.v,He=C.j,11>Q||(qe&=-2,He&=-2),0>qe||0>He||0>=Je||0>=et||qe+Je>oe||He+et>Pe))return 0;if(B.v=qe,B.j=He,B.va=qe+Je,B.o=He+et,B.U=Je,B.T=et,B.da=C!=null&&0<C.da,B.da){if(!Cr(Je,et,Q=[C.ib],qe=[C.hb]))return 0;B.ib=Q[0],B.hb=qe[0]}return B.ob=C!=null&&C.ob,B.Kb=C==null||!C.Sd,B.da&&(B.ob=B.ib<3*oe/4&&B.hb<3*Pe/4,B.Kb=0),1}function Ru(C){if(C==null)return 2;if(11>C.S){var B=C.f.RGBA;B.fb+=(C.height-1)*B.A,B.A=-B.A}else B=C.f.kb,C=C.height,B.O+=(C-1)*B.fa,B.fa=-B.fa,B.N+=(C-1>>1)*B.Ab,B.Ab=-B.Ab,B.W+=(C-1>>1)*B.Db,B.Db=-B.Db,B.F!=null&&(B.J+=(C-1)*B.lb,B.lb=-B.lb);return 0}function ul(C,B,Q,oe){if(oe==null||0>=C||0>=B)return 2;if(Q!=null){if(Q.Da){var Pe=Q.cd,qe=Q.bd,He=-2&Q.v,Je=-2&Q.j;if(0>He||0>Je||0>=Pe||0>=qe||He+Pe>C||Je+qe>B)return 2;C=Pe,B=qe}if(Q.da){if(!Cr(C,B,Pe=[Q.ib],qe=[Q.hb]))return 2;C=Pe[0],B=qe[0]}}oe.width=C,oe.height=B;e:{var et=oe.width,dt=oe.height;if(C=oe.S,0>=et||0>=dt||!(C>=Vc&&13>C))C=2;else{if(0>=oe.Rd&&oe.sd==null){He=qe=Pe=B=0;var Nt=(Je=et*ah[C])*dt;if(11>C||(qe=(dt+1)/2*(B=(et+1)/2),C==12&&(He=(Pe=et)*dt)),(dt=u(Nt+2*qe+He))==null){C=1;break e}oe.sd=dt,11>C?((et=oe.f.RGBA).eb=dt,et.fb=0,et.A=Je,et.size=Nt):((et=oe.f.kb).y=dt,et.O=0,et.fa=Je,et.Fd=Nt,et.f=dt,et.N=0+Nt,et.Ab=B,et.Cd=qe,et.ea=dt,et.W=0+Nt+qe,et.Db=B,et.Ed=qe,C==12&&(et.F=dt,et.J=0+Nt+2*qe),et.Tc=He,et.lb=Pe)}if(B=1,Pe=oe.S,qe=oe.width,He=oe.height,Pe>=Vc&&13>Pe)if(11>Pe)C=oe.f.RGBA,B&=(Je=Math.abs(C.A))*(He-1)+qe<=C.size,B&=Je>=qe*ah[Pe],B&=C.eb!=null;else{C=oe.f.kb,Je=(qe+1)/2,Nt=(He+1)/2,et=Math.abs(C.fa),dt=Math.abs(C.Ab);var tn=Math.abs(C.Db),ct=Math.abs(C.lb),Ft=ct*(He-1)+qe;B&=et*(He-1)+qe<=C.Fd,B&=dt*(Nt-1)+Je<=C.Cd,B=(B&=tn*(Nt-1)+Je<=C.Ed)&et>=qe&dt>=Je&tn>=Je,B&=C.y!=null,B&=C.f!=null,B&=C.ea!=null,Pe==12&&(B&=ct>=qe,B&=Ft<=C.Tc,B&=C.F!=null)}else B=0;C=B?0:2}}return C!=0||Q!=null&&Q.fd&&(C=Ru(oe)),C}var bc=64,Ps=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],_a=24,gu=32,Qo=8,Ws=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];er("Predictor0","PredictorAdd0"),F.Predictor0=function(){return 4278190080},F.Predictor1=function(C){return C},F.Predictor2=function(C,B,Q){return B[Q+0]},F.Predictor3=function(C,B,Q){return B[Q+1]},F.Predictor4=function(C,B,Q){return B[Q-1]},F.Predictor5=function(C,B,Q){return Vt(Vt(C,B[Q+1]),B[Q+0])},F.Predictor6=function(C,B,Q){return Vt(C,B[Q-1])},F.Predictor7=function(C,B,Q){return Vt(C,B[Q+0])},F.Predictor8=function(C,B,Q){return Vt(B[Q-1],B[Q+0])},F.Predictor9=function(C,B,Q){return Vt(B[Q+0],B[Q+1])},F.Predictor10=function(C,B,Q){return Vt(Vt(C,B[Q-1]),Vt(B[Q+0],B[Q+1]))},F.Predictor11=function(C,B,Q){var oe=B[Q+0];return 0>=Dn(oe>>24&255,C>>24&255,(B=B[Q-1])>>24&255)+Dn(oe>>16&255,C>>16&255,B>>16&255)+Dn(oe>>8&255,C>>8&255,B>>8&255)+Dn(255&oe,255&C,255&B)?oe:C},F.Predictor12=function(C,B,Q){var oe=B[Q+0];return(Pn((C>>24&255)+(oe>>24&255)-((B=B[Q-1])>>24&255))<<24|Pn((C>>16&255)+(oe>>16&255)-(B>>16&255))<<16|Pn((C>>8&255)+(oe>>8&255)-(B>>8&255))<<8|Pn((255&C)+(255&oe)-(255&B)))>>>0},F.Predictor13=function(C,B,Q){var oe=B[Q-1];return(Gn((C=Vt(C,B[Q+0]))>>24&255,oe>>24&255)<<24|Gn(C>>16&255,oe>>16&255)<<16|Gn(C>>8&255,oe>>8&255)<<8|Gn(255&C,255&oe))>>>0};var Ba=F.PredictorAdd0;F.PredictorAdd1=Mr,er("Predictor2","PredictorAdd2"),er("Predictor3","PredictorAdd3"),er("Predictor4","PredictorAdd4"),er("Predictor5","PredictorAdd5"),er("Predictor6","PredictorAdd6"),er("Predictor7","PredictorAdd7"),er("Predictor8","PredictorAdd8"),er("Predictor9","PredictorAdd9"),er("Predictor10","PredictorAdd10"),er("Predictor11","PredictorAdd11"),er("Predictor12","PredictorAdd12"),er("Predictor13","PredictorAdd13");var Ol=F.PredictorAdd2;Pr("ColorIndexInverseTransform","MapARGB","32b",function(C){return C>>8&255},function(C){return C}),Pr("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(C){return C},function(C){return C>>8&255});var _s,Uo=F.ColorIndexInverseTransform,Ia=F.MapARGB,Ks=F.VP8LColorIndexInverseTransformAlpha,yu=F.MapAlpha,wc=F.VP8LPredictorsAdd=[];wc.length=16,(F.VP8LPredictors=[]).length=16,(F.VP8LPredictorsAdd_C=[]).length=16,(F.VP8LPredictors_C=[]).length=16;var iu,za,nc,_l,Bl,zl,vl,el,ks,No,Wo,Vo,vs,Ca,Sc,zh,Ch,rc,eh,Ec,td,jh,ic,jc,La,Uc,Mu,xl,bl=u(511),Xs=u(2041),th=u(225),Jn=u(767),Nu=0,Ac=Xs,hl=th,as=Jn,Tc=bl,Vc=0,ha=1,Du=2,qc=3,oc=4,qn=5,jl=6,va=7,$c=8,ou=9,su=10,lr=[2,3,7],li=[3,3,11],ja=[280,256,256,256,40],es=[0,1,1,1,0],Ul=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],Do=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],ao=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],Zs=8,Lh=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],Ph=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],ni=null,nh=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],rh=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],dl=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],wl=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],Uh=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],Sl=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],ih=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],El=[],Al=[],Ni=[],Ua=1,Vl=2,Va=[],lo=[];Es("UpsampleRgbLinePair",Ge,3),Es("UpsampleBgrLinePair",Xt,3),Es("UpsampleRgbaLinePair",Ki,4),Es("UpsampleBgraLinePair",Fo,4),Es("UpsampleArgbLinePair",so,4),Es("UpsampleRgba4444LinePair",ar,2),Es("UpsampleRgb565LinePair",hn,2);var vd=F.UpsampleRgbLinePair,nd=F.UpsampleBgrLinePair,ql=F.UpsampleRgbaLinePair,_u=F.UpsampleBgraLinePair,xa=F.UpsampleArgbLinePair,vu=F.UpsampleRgba4444LinePair,xd=F.UpsampleRgb565LinePair,sc=16,Pa=1<<sc-1,qo=-227,Hi=482,xu=6,Rs=0,ac=u(256),oh=u(256),tl=u(256),nl=u(256),Fu=u(Hi-qo),Ic=u(Hi-qo);Mo("YuvToRgbRow",Ge,3),Mo("YuvToBgrRow",Xt,3),Mo("YuvToRgbaRow",Ki,4),Mo("YuvToBgraRow",Fo,4),Mo("YuvToArgbRow",so,4),Mo("YuvToRgba4444Row",ar,2),Mo("YuvToRgb565Row",hn,2);var lc=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],Tl=[0,2,8],sh=[8,7,6,4,4,2,2,2,1,1,1,1],hr=1;this.WebPDecodeRGBA=function(C,B,Q,oe,Pe){var qe=ha,He=new qt,Je=new Ie;He.ba=Je,Je.S=qe,Je.width=[Je.width],Je.height=[Je.height];var et=Je.width,dt=Je.height,Nt=new Qe;if(Nt==null||C==null)var tn=2;else e(Nt!=null),tn=Fl(C,B,Q,Nt.width,Nt.height,Nt.Pd,Nt.Qd,Nt.format,null);if(tn!=0?et=0:(et!=null&&(et[0]=Nt.width[0]),dt!=null&&(dt[0]=Nt.height[0]),et=1),et){Je.width=Je.width[0],Je.height=Je.height[0],oe!=null&&(oe[0]=Je.width),Pe!=null&&(Pe[0]=Je.height);e:{if(oe=new Xo,(Pe=new Zt).data=C,Pe.w=B,Pe.ha=Q,Pe.kd=1,B=[0],e(Pe!=null),((C=Fl(Pe.data,Pe.w,Pe.ha,null,null,null,B,null,Pe))==0||C==7)&&B[0]&&(C=4),(B=C)==0){if(e(He!=null),oe.data=Pe.data,oe.w=Pe.w+Pe.offset,oe.ha=Pe.ha-Pe.offset,oe.put=Pt,oe.ac=Et,oe.bc=vn,oe.ma=He,Pe.xa){if((C=Is())==null){He=1;break e}if((function(ct,Ft){var Qt=[0],En=[0],y=[0];t:for(;;){if(ct==null)return 0;if(Ft==null)return ct.a=2,0;if(ct.l=Ft,ct.a=0,Fe(ct.m,Ft.data,Ft.w,Ft.ha),!Bn(ct.m,Qt,En,y)){ct.a=3;break t}if(ct.xb=Vl,Ft.width=Qt[0],Ft.height=En[0],!ga(Qt[0],En[0],1,ct,null))break t;return 1}return e(ct.a!=0),0})(C,oe)){if(oe=(B=ul(oe.width,oe.height,He.Oa,He.ba))==0){t:{oe=C;n:for(;;){if(oe==null){oe=0;break t}if(e(oe.s.yc!=null),e(oe.s.Ya!=null),e(0<oe.s.Wb),e((Q=oe.l)!=null),e((Pe=Q.ma)!=null),oe.xb!=0){if(oe.ca=Pe.ba,oe.tb=Pe.tb,e(oe.ca!=null),!ua(Pe.Oa,Q,qc)){oe.a=2;break n}if(!gl(oe,Q.width)||Q.da)break n;if((Q.da||si(oe.ca.S))&&jo(),11>oe.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),oe.ca.f.kb.F!=null&&jo()),oe.Pb&&0<oe.s.ua&&oe.s.vb.X==null&&!st(oe.s.vb,oe.s.Wa.Xa)){oe.a=1;break n}oe.xb=0}if(!ys(oe,oe.V,oe.Ba,oe.c,oe.i,Q.o,no))break n;Pe.Dc=oe.Ma,oe=1;break t}e(oe.a!=0),oe=0}oe=!oe}oe&&(B=C.a)}else B=C.a}else{if((C=new ss)==null){He=1;break e}if(C.Fa=Pe.na,C.P=Pe.P,C.qc=Pe.Sa,Za(C,oe)){if((B=ul(oe.width,oe.height,He.Oa,He.ba))==0){if(C.Aa=0,Q=He.Oa,e((Pe=C)!=null),Q!=null){if(0<(et=0>(et=Q.Md)?0:100<et?255:255*et/100)){for(dt=Nt=0;4>dt;++dt)12>(tn=Pe.pb[dt]).lc&&(tn.ia=et*sh[0>tn.lc?0:tn.lc]>>3),Nt|=tn.ia;Nt&&(alert("todo:VP8InitRandom"),Pe.ia=1)}Pe.Ga=Q.Id,100<Pe.Ga?Pe.Ga=100:0>Pe.Ga&&(Pe.Ga=0)}(function(ct,Ft){if(ct==null)return 0;if(Ft==null)return xi(ct,2,"NULL VP8Io parameter in VP8Decode().");if(!ct.cb&&!Za(ct,Ft))return 0;if(e(ct.cb),Ft.ac==null||Ft.ac(Ft)){Ft.ob&&(ct.L=0);var Qt=Tl[ct.L];if(ct.L==2?(ct.yb=0,ct.zb=0):(ct.yb=Ft.v-Qt>>4,ct.zb=Ft.j-Qt>>4,0>ct.yb&&(ct.yb=0),0>ct.zb&&(ct.zb=0)),ct.Va=Ft.o+15+Qt>>4,ct.Hb=Ft.va+15+Qt>>4,ct.Hb>ct.za&&(ct.Hb=ct.za),ct.Va>ct.Ub&&(ct.Va=ct.Ub),0<ct.L){var En=ct.ed;for(Qt=0;4>Qt;++Qt){var y;if(ct.Qa.Cb){var a=ct.Qa.Lb[Qt];ct.Qa.Fb||(a+=En.Tb)}else a=En.Tb;for(y=0;1>=y;++y){var f=ct.gd[Qt][y],v=a;if(En.Pc&&(v+=En.vd[0],y&&(v+=En.od[0])),0<(v=0>v?0:63<v?63:v)){var S=v;0<En.wb&&(S=4<En.wb?S>>2:S>>1)>9-En.wb&&(S=9-En.wb),1>S&&(S=1),f.dd=S,f.tc=2*v+S,f.ld=40<=v?2:15<=v?1:0}else f.tc=0;f.La=y}}}Qt=0}else xi(ct,6,"Frame setup failed"),Qt=ct.a;if(Qt=Qt==0){if(Qt){ct.$c=0,0<ct.Aa||(ct.Ic=hr);t:{Qt=ct.Ic,En=4*(S=ct.za);var T=32*S,N=S+1,z=0<ct.L?S*(0<ct.Aa?2:1):0,G=(ct.Aa==2?2:1)*S;if((f=En+832+(y=3*(16*Qt+Tl[ct.L])/2*T)+(a=ct.Fa!=null&&0<ct.Fa.length?ct.Kc.c*ct.Kc.i:0))!=f)Qt=0;else{if(f>ct.Vb){if(ct.Vb=0,ct.Ec=u(f),ct.Fc=0,ct.Ec==null){Qt=xi(ct,1,"no memory during frame initialization.");break t}ct.Vb=f}f=ct.Ec,v=ct.Fc,ct.Ac=f,ct.Bc=v,v+=En,ct.Gd=m(T,sa),ct.Hd=0,ct.rb=m(N+1,Xa),ct.sb=1,ct.wa=z?m(z,Ko):null,ct.Y=0,ct.D.Nb=0,ct.D.wa=ct.wa,ct.D.Y=ct.Y,0<ct.Aa&&(ct.D.Y+=S),e(!0),ct.oc=f,ct.pc=v,v+=832,ct.ya=m(G,Ql),ct.aa=0,ct.D.ya=ct.ya,ct.D.aa=ct.aa,ct.Aa==2&&(ct.D.aa+=S),ct.R=16*S,ct.B=8*S,S=(T=Tl[ct.L])*ct.R,T=T/2*ct.B,ct.sa=f,ct.ta=v+S,ct.qa=ct.sa,ct.ra=ct.ta+16*Qt*ct.R+T,ct.Ha=ct.qa,ct.Ia=ct.ra+8*Qt*ct.B+T,ct.$c=0,v+=y,ct.mb=a?f:null,ct.nb=a?v:null,e(v+a<=ct.Fc+ct.Vb),al(ct),c(ct.Ac,ct.Bc,0,En),Qt=1}}if(Qt){if(Ft.ka=0,Ft.y=ct.sa,Ft.O=ct.ta,Ft.f=ct.qa,Ft.N=ct.ra,Ft.ea=ct.Ha,Ft.Vd=ct.Ia,Ft.fa=ct.R,Ft.Rc=ct.B,Ft.F=null,Ft.J=0,!Nu){for(Qt=-255;255>=Qt;++Qt)bl[255+Qt]=0>Qt?-Qt:Qt;for(Qt=-1020;1020>=Qt;++Qt)Xs[1020+Qt]=-128>Qt?-128:127<Qt?127:Qt;for(Qt=-112;112>=Qt;++Qt)th[112+Qt]=-16>Qt?-16:15<Qt?15:Qt;for(Qt=-255;510>=Qt;++Qt)Jn[255+Qt]=0>Qt?0:255<Qt?255:Qt;Nu=1}vl=Gi,el=Ta,No=bi,Wo=Mi,Vo=yl,ks=js,vs=cl,Ca=Gs,Sc=W,zh=Ce,Ch=Hs,rc=xc,eh=pt,Ec=yt,td=qs,jh=Ti,ic=Ss,jc=$s,Al[0]=Ih,Al[1]=Ui,Al[2]=Zo,Al[3]=Ao,Al[4]=Pu,Al[5]=Us,Al[6]=_o,Al[7]=ku,Al[8]=vo,Al[9]=Go,El[0]=Da,El[1]=ec,El[2]=nu,El[3]=_c,El[4]=Ls,El[5]=Vi,El[6]=Fa,Ni[0]=Bo,Ni[1]=mu,Ni[2]=Dl,Ni[3]=Oa,Ni[4]=Ho,Ni[5]=Bc,Ni[6]=ya,Qt=1}else Qt=0}Qt&&(Qt=(function(ee,te){for(ee.M=0;ee.M<ee.Va;++ee.M){var ge,Ae=ee.Jc[ee.M&ee.Xb],Le=ee.m,Xe=ee;for(ge=0;ge<Xe.za;++ge){var Ue=Le,Ze=Xe,_e=Ze.Ac,$e=Ze.Bc+4*ge,it=Ze.zc,ot=Ze.ya[Ze.aa+ge];if(Ze.Qa.Bb?ot.$b=Yt(Ue,Ze.Pa.jb[0])?2+Yt(Ue,Ze.Pa.jb[2]):Yt(Ue,Ze.Pa.jb[1]):ot.$b=0,Ze.kc&&(ot.Ad=Yt(Ue,Ze.Bd)),ot.Za=!Yt(Ue,145)+0,ot.Za){var bt=ot.Ob,wt=0;for(Ze=0;4>Ze;++Ze){var vt,Rt=it[0+Ze];for(vt=0;4>vt;++vt){Rt=Uh[_e[$e+vt]][Rt];for(var Lt=dl[Yt(Ue,Rt[0])];0<Lt;)Lt=dl[2*Lt+Yt(Ue,Rt[Lt])];Rt=-Lt,_e[$e+vt]=Rt}i(bt,wt,_e,$e,4),wt+=4,it[0+Ze]=Rt}}else Rt=Yt(Ue,156)?Yt(Ue,128)?1:3:Yt(Ue,163)?2:0,ot.Ob[0]=Rt,c(_e,$e,Rt,4),c(it,0,Rt,4);ot.Dd=Yt(Ue,142)?Yt(Ue,114)?Yt(Ue,183)?1:3:2:0}if(Xe.m.Ka)return xi(ee,7,"Premature end-of-partition0 encountered.");for(;ee.ja<ee.za;++ee.ja){if(Xe=Ae,Ue=(Le=ee).rb[Le.sb-1],_e=Le.rb[Le.sb+Le.ja],ge=Le.ya[Le.aa+Le.ja],$e=Le.kc?ge.Ad:0)Ue.la=_e.la=0,ge.Za||(Ue.Na=_e.Na=0),ge.Hc=0,ge.Gc=0,ge.ia=0;else{var zt,mn;if(Ue=_e,_e=Xe,$e=Le.Pa.Xc,it=Le.ya[Le.aa+Le.ja],ot=Le.pb[it.$b],Ze=it.ad,bt=0,wt=Le.rb[Le.sb-1],Rt=vt=0,c(Ze,bt,0,384),it.Za)var Ut=0,an=$e[3];else{Lt=u(16);var Ht=Ue.Na+wt.Na;if(Ht=ni(_e,$e[1],Ht,ot.Eb,0,Lt,0),Ue.Na=wt.Na=(0<Ht)+0,1<Ht)vl(Lt,0,Ze,bt);else{var Cn=Lt[0]+3>>3;for(Lt=0;256>Lt;Lt+=16)Ze[bt+Lt]=Cn}Ut=1,an=$e[0]}var jt=15&Ue.la,on=15&wt.la;for(Lt=0;4>Lt;++Lt){var In=1&on;for(Cn=mn=0;4>Cn;++Cn)jt=jt>>1|(In=(Ht=ni(_e,an,Ht=In+(1&jt),ot.Sc,Ut,Ze,bt))>Ut)<<7,mn=mn<<2|(3<Ht?3:1<Ht?2:Ze[bt+0]!=0),bt+=16;jt>>=4,on=on>>1|In<<7,vt=(vt<<8|mn)>>>0}for(an=jt,Ut=on>>4,zt=0;4>zt;zt+=2){for(mn=0,jt=Ue.la>>4+zt,on=wt.la>>4+zt,Lt=0;2>Lt;++Lt){for(In=1&on,Cn=0;2>Cn;++Cn)Ht=In+(1&jt),jt=jt>>1|(In=0<(Ht=ni(_e,$e[2],Ht,ot.Qc,0,Ze,bt)))<<3,mn=mn<<2|(3<Ht?3:1<Ht?2:Ze[bt+0]!=0),bt+=16;jt>>=2,on=on>>1|In<<5}Rt|=mn<<4*zt,an|=jt<<4<<zt,Ut|=(240&on)<<zt}Ue.la=an,wt.la=Ut,it.Hc=vt,it.Gc=Rt,it.ia=43690&Rt?0:ot.ia,$e=!(vt|Rt)}if(0<Le.L&&(Le.wa[Le.Y+Le.ja]=Le.gd[ge.$b][ge.Za],Le.wa[Le.Y+Le.ja].La|=!$e),Xe.Ka)return xi(ee,7,"Premature end-of-file encountered.")}if(al(ee),Le=te,Xe=1,ge=(Ae=ee).D,Ue=0<Ae.L&&Ae.M>=Ae.zb&&Ae.M<=Ae.Va,Ae.Aa==0)t:{if(ge.M=Ae.M,ge.uc=Ue,Bi(Ae,ge),Xe=1,ge=(mn=Ae.D).Nb,Ue=(Rt=Tl[Ae.L])*Ae.R,_e=Rt/2*Ae.B,Lt=16*ge*Ae.R,Cn=8*ge*Ae.B,$e=Ae.sa,it=Ae.ta-Ue+Lt,ot=Ae.qa,Ze=Ae.ra-_e+Cn,bt=Ae.Ha,wt=Ae.Ia-_e+Cn,on=(jt=mn.M)==0,vt=jt>=Ae.Va-1,Ae.Aa==2&&Bi(Ae,mn),mn.uc)for(In=(Ht=Ae).D.M,e(Ht.D.uc),mn=Ht.yb;mn<Ht.Hb;++mn){Ut=mn,an=In;var xn=(bn=(Ci=Ht).D).Nb;zt=Ci.R;var bn=bn.wa[bn.Y+Ut],pr=Ci.sa,Fr=Ci.ta+16*xn*zt+16*Ut,sr=bn.dd,fr=bn.tc;if(fr!=0)if(e(3<=fr),Ci.L==1)0<Ut&&jh(pr,Fr,zt,fr+4),bn.La&&jc(pr,Fr,zt,fr),0<an&&td(pr,Fr,zt,fr+4),bn.La&&ic(pr,Fr,zt,fr);else{var $r=Ci.B,gi=Ci.qa,Sr=Ci.ra+8*xn*$r+8*Ut,ki=Ci.Ha,Ci=Ci.Ia+8*xn*$r+8*Ut;xn=bn.ld,0<Ut&&(Ca(pr,Fr,zt,fr+4,sr,xn),zh(gi,Sr,ki,Ci,$r,fr+4,sr,xn)),bn.La&&(rc(pr,Fr,zt,fr,sr,xn),Ec(gi,Sr,ki,Ci,$r,fr,sr,xn)),0<an&&(vs(pr,Fr,zt,fr+4,sr,xn),Sc(gi,Sr,ki,Ci,$r,fr+4,sr,xn)),bn.La&&(Ch(pr,Fr,zt,fr,sr,xn),eh(gi,Sr,ki,Ci,$r,fr,sr,xn))}}if(Ae.ia&&alert("todo:DitherRow"),Le.put!=null){if(mn=16*jt,jt=16*(jt+1),on?(Le.y=Ae.sa,Le.O=Ae.ta+Lt,Le.f=Ae.qa,Le.N=Ae.ra+Cn,Le.ea=Ae.Ha,Le.W=Ae.Ia+Cn):(mn-=Rt,Le.y=$e,Le.O=it,Le.f=ot,Le.N=Ze,Le.ea=bt,Le.W=wt),vt||(jt-=Rt),jt>Le.o&&(jt=Le.o),Le.F=null,Le.J=null,Ae.Fa!=null&&0<Ae.Fa.length&&mn<jt&&(Le.J=Yo(Ae,Le,mn,jt-mn),Le.F=Ae.mb,Le.F==null&&Le.F.length==0)){Xe=xi(Ae,3,"Could not decode alpha data.");break t}mn<Le.j&&(Rt=Le.j-mn,mn=Le.j,e(!(1&Rt)),Le.O+=Ae.R*Rt,Le.N+=Ae.B*(Rt>>1),Le.W+=Ae.B*(Rt>>1),Le.F!=null&&(Le.J+=Le.width*Rt)),mn<jt&&(Le.O+=Le.v,Le.N+=Le.v>>1,Le.W+=Le.v>>1,Le.F!=null&&(Le.J+=Le.v),Le.ka=mn-Le.j,Le.U=Le.va-Le.v,Le.T=jt-mn,Xe=Le.put(Le))}ge+1!=Ae.Ic||vt||(i(Ae.sa,Ae.ta-Ue,$e,it+16*Ae.R,Ue),i(Ae.qa,Ae.ra-_e,ot,Ze+8*Ae.B,_e),i(Ae.Ha,Ae.Ia-_e,bt,wt+8*Ae.B,_e))}if(!Xe)return xi(ee,6,"Output aborted.")}return 1})(ct,Ft)),Ft.bc!=null&&Ft.bc(Ft),Qt&=1}return Qt?(ct.cb=0,Qt):0})(C,oe)||(B=C.a)}}else B=C.a}B==0&&He.Oa!=null&&He.Oa.fd&&(B=Ru(He.ba))}He=B}qe=He!=0?null:11>qe?Je.f.RGBA.eb:Je.f.kb.y}else qe=null;return qe};var ah=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function b(F,q){for(var j="",H=0;H<4;H++)j+=String.fromCharCode(F[q++]);return j}function I(F,q){return F[q+0]|F[q+1]<<8}function M(F,q){return(F[q+0]|F[q+1]<<8|F[q+2]<<16)>>>0}function V(F,q){return(F[q+0]|F[q+1]<<8|F[q+2]<<16|F[q+3]<<24)>>>0}new o;var k=[0],ie=[0],se=[],fe=new o,J=n,ne=(function(F,q){var j={},H=0,Z=!1,be=0,Re=0;if(j.frames=[],!(function(le,De){for(var Be=0;Be<4;Be++)if(le[De+Be]!="RIFF".charCodeAt(Be))return!0;return!1})(F,q)){for(V(F,q+=4),q+=8;q<F.length;){var Oe=b(F,q),Ne=V(F,q+=4);q+=4;var we=Ne+(1&Ne);switch(Oe){case"VP8 ":case"VP8L":j.frames[H]===void 0&&(j.frames[H]={}),(xe=j.frames[H]).src_off=Z?Re:q-8,xe.src_size=be+Ne+8,H++,Z&&(Z=!1,be=0,Re=0);break;case"VP8X":(xe=j.header={}).feature_flags=F[q];var Fe=q+4;xe.canvas_width=1+M(F,Fe),Fe+=3,xe.canvas_height=1+M(F,Fe),Fe+=3;break;case"ALPH":Z=!0,be=we+8,Re=q-8;break;case"ANIM":(xe=j.header).bgcolor=V(F,q),Fe=q+4,xe.loop_count=I(F,Fe),Fe+=2;break;case"ANMF":var nt,xe;(xe=j.frames[H]={}).offset_x=2*M(F,q),q+=3,xe.offset_y=2*M(F,q),q+=3,xe.width=1+M(F,q),q+=3,xe.height=1+M(F,q),q+=3,xe.duration=M(F,q),q+=3,nt=F[q++],xe.dispose=1&nt,xe.blend=nt>>1&1}Oe!="ANMF"&&(q+=we)}return j}})(J,0);ne.response=J,ne.rgbaoutput=!0,ne.dataurl=!1;var me=ne.header?ne.header:null,ue=ne.frames?ne.frames:null;if(me){me.loop_counter=me.loop_count,k=[me.canvas_height],ie=[me.canvas_width];for(var ke=0;ke<ue.length&&ue[ke].blend!=0;ke++);}var je=ue[0],pe=fe.WebPDecodeRGBA(J,je.src_off,je.src_size,ie,k);je.rgba=pe,je.imgwidth=ie[0],je.imgheight=k[0];for(var U=0;U<ie[0]*k[0]*4;U++)se[U]=pe[U];return this.width=ie,this.height=k,this.data=se,this}(function(n){var e,t,i,c,u,m,_,o,b,I=function(le){return le=le||{},this.isStrokeTransparent=le.isStrokeTransparent||!1,this.strokeOpacity=le.strokeOpacity||1,this.strokeStyle=le.strokeStyle||"#000000",this.fillStyle=le.fillStyle||"#000000",this.isFillTransparent=le.isFillTransparent||!1,this.fillOpacity=le.fillOpacity||1,this.font=le.font||"10px sans-serif",this.textBaseline=le.textBaseline||"alphabetic",this.textAlign=le.textAlign||"left",this.lineWidth=le.lineWidth||1,this.lineJoin=le.lineJoin||"miter",this.lineCap=le.lineCap||"butt",this.path=le.path||[],this.transform=le.transform!==void 0?le.transform.clone():new o,this.globalCompositeOperation=le.globalCompositeOperation||"normal",this.globalAlpha=le.globalAlpha||1,this.clip_path=le.clip_path||[],this.currentPoint=le.currentPoint||new m,this.miterLimit=le.miterLimit||10,this.lastPoint=le.lastPoint||new m,this.lineDashOffset=le.lineDashOffset||0,this.lineDash=le.lineDash||[],this.margin=le.margin||[0,0,0,0],this.prevPageLastElemOffset=le.prevPageLastElemOffset||0,this.ignoreClearRect=typeof le.ignoreClearRect!="boolean"||le.ignoreClearRect,this};n.events.push(["initialized",function(){this.context2d=new M(this),e=this.internal.f2,t=this.internal.getCoordinateString,i=this.internal.getVerticalCoordinateString,c=this.internal.getHorizontalCoordinate,u=this.internal.getVerticalCoordinate,m=this.internal.Point,_=this.internal.Rectangle,o=this.internal.Matrix,b=new I}]);var M=function(le){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var De=le;Object.defineProperty(this,"pdf",{get:function(){return De}});var Be=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return Be},set:function(Gt){Be=!!Gt}});var Ye=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return Ye},set:function(Gt){Ye=!!Gt}});var rt=0;Object.defineProperty(this,"posX",{get:function(){return rt},set:function(Gt){isNaN(Gt)||(rt=Gt)}});var mt=0;Object.defineProperty(this,"posY",{get:function(){return mt},set:function(Gt){isNaN(Gt)||(mt=Gt)}}),Object.defineProperty(this,"margin",{get:function(){return b.margin},set:function(Gt){var st;typeof Gt=="number"?st=[Gt,Gt,Gt,Gt]:((st=new Array(4))[0]=Gt[0],st[1]=Gt.length>=2?Gt[1]:st[0],st[2]=Gt.length>=3?Gt[2]:st[0],st[3]=Gt.length>=4?Gt[3]:st[1]),b.margin=st}});var ft=!1;Object.defineProperty(this,"autoPaging",{get:function(){return ft},set:function(Gt){ft=Gt}});var Dt=0;Object.defineProperty(this,"lastBreak",{get:function(){return Dt},set:function(Gt){Dt=Gt}});var Yt=[];Object.defineProperty(this,"pageBreaks",{get:function(){return Yt},set:function(Gt){Yt=Gt}}),Object.defineProperty(this,"ctx",{get:function(){return b},set:function(Gt){Gt instanceof I&&(b=Gt)}}),Object.defineProperty(this,"path",{get:function(){return b.path},set:function(Gt){b.path=Gt}});var cn=[];Object.defineProperty(this,"ctxStack",{get:function(){return cn},set:function(Gt){cn=Gt}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(Gt){var st;st=V(Gt),this.ctx.fillStyle=st.style,this.ctx.isFillTransparent=st.a===0,this.ctx.fillOpacity=st.a,this.pdf.setFillColor(st.r,st.g,st.b,{a:st.a}),this.pdf.setTextColor(st.r,st.g,st.b,{a:st.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(Gt){var st=V(Gt);this.ctx.strokeStyle=st.style,this.ctx.isStrokeTransparent=st.a===0,this.ctx.strokeOpacity=st.a,st.a===0?this.pdf.setDrawColor(255,255,255):(st.a,this.pdf.setDrawColor(st.r,st.g,st.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(Gt){["butt","round","square"].indexOf(Gt)!==-1&&(this.ctx.lineCap=Gt,this.pdf.setLineCap(Gt))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(Gt){isNaN(Gt)||(this.ctx.lineWidth=Gt,this.pdf.setLineWidth(Gt))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(Gt){["bevel","round","miter"].indexOf(Gt)!==-1&&(this.ctx.lineJoin=Gt,this.pdf.setLineJoin(Gt))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(Gt){isNaN(Gt)||(this.ctx.miterLimit=Gt,this.pdf.setMiterLimit(Gt))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(Gt){this.ctx.textBaseline=Gt}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(Gt){["right","end","center","left","start"].indexOf(Gt)!==-1&&(this.ctx.textAlign=Gt)}});var gn=null,Mn=null;Object.defineProperty(this,"fontFaces",{get:function(){return Mn},set:function(Gt){gn=null,Mn=Gt}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(Gt){var st;if(this.ctx.font=Gt,(st=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(Gt))!==null){var mr=st[1];st[2];var Er=st[3],Cr=st[4];st[5];var Ln=st[6],ir=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(Cr)[2];Cr=Math.floor(ir==="px"?parseFloat(Cr)*this.pdf.internal.scaleFactor:ir==="em"?parseFloat(Cr)*this.pdf.getFontSize():parseFloat(Cr)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(Cr);var er=(function(Ir){var Pr,Ei,Pi=[],or=Ir.trim();if(or==="")return Rb;if(or in kS)return[kS[or]];for(;or!=="";){switch(Ei=null,Pr=(or=MS(or)).charAt(0)){case'"':case"'":Ei=oM(or.substring(1),Pr);break;default:Ei=sM(or)}if(Ei===null||(Pi.push(Ei[0]),(or=MS(Ei[1]))!==""&&or.charAt(0)!==","))return Rb;or=or.replace(/^,/,"")}return Pi})(Ln);if(this.fontFaces){var Yr=(function(Ir,Pr){if(gn===null){var Ei=(function(Pi){var or=[];return Object.keys(Pi).forEach(function(oi){Pi[oi].forEach(function(Kr){var Br=null;switch(Kr){case"bold":Br={family:oi,weight:"bold"};break;case"italic":Br={family:oi,style:"italic"};break;case"bolditalic":Br={family:oi,weight:"bold",style:"italic"};break;case"":case"normal":Br={family:oi}}Br!==null&&(Br.ref={name:oi,style:Kr},or.push(Br))})}),or})(Ir.getFontList());gn=(function(Pi){for(var or={},oi=0;oi<Pi.length;++oi){var Kr=kb(Pi[oi]),Br=Kr.family,di=Kr.stretch,si=Kr.style,ut=Kr.weight;or[Br]=or[Br]||{},or[Br][di]=or[Br][di]||{},or[Br][di][si]=or[Br][di][si]||{},or[Br][di][si][ut]=Kr}return or})(Ei.concat(Pr))}return gn})(this.pdf,this.fontFaces),Vt=er.map(function(Ir){return{family:Ir,stretch:"normal",weight:Er,style:mr}}),Pn=(function(Ir,Pr,Ei){for(var Pi=(Ei=Ei||{}).defaultFontFamily||"times",or=Object.assign({},iM,Ei.genericFontFamilies||{}),oi=null,Kr=null,Br=0;Br<Pr.length;++Br)if(or[(oi=kb(Pr[Br])).family]&&(oi.family=or[oi.family]),Ir.hasOwnProperty(oi.family)){Kr=Ir[oi.family];break}if(!(Kr=Kr||Ir[Pi]))throw new Error("Could not find a font-family for the rule '"+RS(oi)+"' and default family '"+Pi+"'.");if(Kr=(function(di,si){if(si[di])return si[di];var ut=T5[di],Ee=ut<=T5.normal?-1:1,Ie=PS(si,W6,ut,Ee);if(!Ie)throw new Error("Could not find a matching font-stretch value for "+di);return Ie})(oi.stretch,Kr),Kr=(function(di,si){if(si[di])return si[di];for(var ut=H6[di],Ee=0;Ee<ut.length;++Ee)if(si[ut[Ee]])return si[ut[Ee]];throw new Error("Could not find a matching font-style for "+di)})(oi.style,Kr),!(Kr=(function(di,si){if(si[di])return si[di];if(di===400&&si[500])return si[500];if(di===500&&si[400])return si[400];var ut=rM[di],Ee=PS(si,K6,ut,di<400?-1:1);if(!Ee)throw new Error("Could not find a matching font-weight for value "+di);return Ee})(oi.weight,Kr)))throw new Error("Failed to resolve a font for the rule '"+RS(oi)+"'.");return Kr})(Yr,Vt);this.pdf.setFont(Pn.ref.name,Pn.ref.style)}else{var Gn="";(Er==="bold"||parseInt(Er,10)>=700||mr==="bold")&&(Gn="bold"),mr==="italic"&&(Gn+="italic"),Gn.length===0&&(Gn="normal");for(var Dn="",Mr={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},wr=0;wr<er.length;wr++){if(this.pdf.internal.getFont(er[wr],Gn,{noFallback:!0,disableWarning:!0})!==void 0){Dn=er[wr];break}if(Gn==="bolditalic"&&this.pdf.internal.getFont(er[wr],"bold",{noFallback:!0,disableWarning:!0})!==void 0)Dn=er[wr],Gn="bold";else if(this.pdf.internal.getFont(er[wr],"normal",{noFallback:!0,disableWarning:!0})!==void 0){Dn=er[wr],Gn="normal";break}}if(Dn===""){for(var Tr=0;Tr<er.length;Tr++)if(Mr[er[Tr]]){Dn=Mr[er[Tr]];break}}Dn=Dn===""?"Times":Dn,this.pdf.setFont(Dn,Gn)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(Gt){this.ctx.globalCompositeOperation=Gt}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(Gt){this.ctx.globalAlpha=Gt}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(Gt){this.ctx.lineDashOffset=Gt,xe.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(Gt){this.ctx.lineDash=Gt,xe.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(Gt){this.ctx.ignoreClearRect=!!Gt}})};M.prototype.setLineDash=function(le){this.lineDash=le},M.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},M.prototype.fill=function(){ue.call(this,"fill",!1)},M.prototype.stroke=function(){ue.call(this,"stroke",!1)},M.prototype.beginPath=function(){this.path=[{type:"begin"}]},M.prototype.moveTo=function(le,De){if(isNaN(le)||isNaN(De))throw Ka.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var Be=this.ctx.transform.applyToPoint(new m(le,De));this.path.push({type:"mt",x:Be.x,y:Be.y}),this.ctx.lastPoint=new m(le,De)},M.prototype.closePath=function(){var le=new m(0,0),De=0;for(De=this.path.length-1;De!==-1;De--)if(this.path[De].type==="begin"&&wa(this.path[De+1])==="object"&&typeof this.path[De+1].x=="number"){le=new m(this.path[De+1].x,this.path[De+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new m(le.x,le.y)},M.prototype.lineTo=function(le,De){if(isNaN(le)||isNaN(De))throw Ka.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var Be=this.ctx.transform.applyToPoint(new m(le,De));this.path.push({type:"lt",x:Be.x,y:Be.y}),this.ctx.lastPoint=new m(Be.x,Be.y)},M.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),ue.call(this,null,!0)},M.prototype.quadraticCurveTo=function(le,De,Be,Ye){if(isNaN(Be)||isNaN(Ye)||isNaN(le)||isNaN(De))throw Ka.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var rt=this.ctx.transform.applyToPoint(new m(Be,Ye)),mt=this.ctx.transform.applyToPoint(new m(le,De));this.path.push({type:"qct",x1:mt.x,y1:mt.y,x:rt.x,y:rt.y}),this.ctx.lastPoint=new m(rt.x,rt.y)},M.prototype.bezierCurveTo=function(le,De,Be,Ye,rt,mt){if(isNaN(rt)||isNaN(mt)||isNaN(le)||isNaN(De)||isNaN(Be)||isNaN(Ye))throw Ka.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var ft=this.ctx.transform.applyToPoint(new m(rt,mt)),Dt=this.ctx.transform.applyToPoint(new m(le,De)),Yt=this.ctx.transform.applyToPoint(new m(Be,Ye));this.path.push({type:"bct",x1:Dt.x,y1:Dt.y,x2:Yt.x,y2:Yt.y,x:ft.x,y:ft.y}),this.ctx.lastPoint=new m(ft.x,ft.y)},M.prototype.arc=function(le,De,Be,Ye,rt,mt){if(isNaN(le)||isNaN(De)||isNaN(Be)||isNaN(Ye)||isNaN(rt))throw Ka.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(mt=!!mt,!this.ctx.transform.isIdentity){var ft=this.ctx.transform.applyToPoint(new m(le,De));le=ft.x,De=ft.y;var Dt=this.ctx.transform.applyToPoint(new m(0,Be)),Yt=this.ctx.transform.applyToPoint(new m(0,0));Be=Math.sqrt(Math.pow(Dt.x-Yt.x,2)+Math.pow(Dt.y-Yt.y,2))}Math.abs(rt-Ye)>=2*Math.PI&&(Ye=0,rt=2*Math.PI),this.path.push({type:"arc",x:le,y:De,radius:Be,startAngle:Ye,endAngle:rt,counterclockwise:mt})},M.prototype.arcTo=function(le,De,Be,Ye,rt){throw new Error("arcTo not implemented.")},M.prototype.rect=function(le,De,Be,Ye){if(isNaN(le)||isNaN(De)||isNaN(Be)||isNaN(Ye))throw Ka.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(le,De),this.lineTo(le+Be,De),this.lineTo(le+Be,De+Ye),this.lineTo(le,De+Ye),this.lineTo(le,De),this.lineTo(le+Be,De),this.lineTo(le,De)},M.prototype.fillRect=function(le,De,Be,Ye){if(isNaN(le)||isNaN(De)||isNaN(Be)||isNaN(Ye))throw Ka.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!k.call(this)){var rt={};this.lineCap!=="butt"&&(rt.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(rt.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(le,De,Be,Ye),this.fill(),rt.hasOwnProperty("lineCap")&&(this.lineCap=rt.lineCap),rt.hasOwnProperty("lineJoin")&&(this.lineJoin=rt.lineJoin)}},M.prototype.strokeRect=function(le,De,Be,Ye){if(isNaN(le)||isNaN(De)||isNaN(Be)||isNaN(Ye))throw Ka.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");ie.call(this)||(this.beginPath(),this.rect(le,De,Be,Ye),this.stroke())},M.prototype.clearRect=function(le,De,Be,Ye){if(isNaN(le)||isNaN(De)||isNaN(Be)||isNaN(Ye))throw Ka.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(le,De,Be,Ye))},M.prototype.save=function(le){le=typeof le!="boolean"||le;for(var De=this.pdf.internal.getCurrentPageInfo().pageNumber,Be=0;Be<this.pdf.internal.getNumberOfPages();Be++)this.pdf.setPage(Be+1),this.pdf.internal.out("q");if(this.pdf.setPage(De),le){this.ctx.fontSize=this.pdf.internal.getFontSize();var Ye=new I(this.ctx);this.ctxStack.push(this.ctx),this.ctx=Ye}},M.prototype.restore=function(le){le=typeof le!="boolean"||le;for(var De=this.pdf.internal.getCurrentPageInfo().pageNumber,Be=0;Be<this.pdf.internal.getNumberOfPages();Be++)this.pdf.setPage(Be+1),this.pdf.internal.out("Q");this.pdf.setPage(De),le&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},M.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var V=function(le){var De,Be,Ye,rt;if(le.isCanvasGradient===!0&&(le=le.getColor()),!le)return{r:0,g:0,b:0,a:0,style:le};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(le))De=0,Be=0,Ye=0,rt=0;else{var mt=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(le);if(mt!==null)De=parseInt(mt[1]),Be=parseInt(mt[2]),Ye=parseInt(mt[3]),rt=1;else if((mt=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(le))!==null)De=parseInt(mt[1]),Be=parseInt(mt[2]),Ye=parseInt(mt[3]),rt=parseFloat(mt[4]);else{if(rt=1,typeof le=="string"&&le.charAt(0)!=="#"){var ft=new z6(le);le=ft.ok?ft.toHex():"#000000"}le.length===4?(De=le.substring(1,2),De+=De,Be=le.substring(2,3),Be+=Be,Ye=le.substring(3,4),Ye+=Ye):(De=le.substring(1,3),Be=le.substring(3,5),Ye=le.substring(5,7)),De=parseInt(De,16),Be=parseInt(Be,16),Ye=parseInt(Ye,16)}}return{r:De,g:Be,b:Ye,a:rt,style:le}},k=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},ie=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};M.prototype.fillText=function(le,De,Be,Ye){if(isNaN(De)||isNaN(Be)||typeof le!="string")throw Ka.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(Ye=isNaN(Ye)?void 0:Ye,!k.call(this)){var rt=we(this.ctx.transform.rotation),mt=this.ctx.transform.scaleX;H.call(this,{text:le,x:De,y:Be,scale:mt,angle:rt,align:this.textAlign,maxWidth:Ye})}},M.prototype.strokeText=function(le,De,Be,Ye){if(isNaN(De)||isNaN(Be)||typeof le!="string")throw Ka.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!ie.call(this)){Ye=isNaN(Ye)?void 0:Ye;var rt=we(this.ctx.transform.rotation),mt=this.ctx.transform.scaleX;H.call(this,{text:le,x:De,y:Be,scale:mt,renderingMode:"stroke",angle:rt,align:this.textAlign,maxWidth:Ye})}},M.prototype.measureText=function(le){if(typeof le!="string")throw Ka.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var De=this.pdf,Be=this.pdf.internal.scaleFactor,Ye=De.internal.getFontSize(),rt=De.getStringUnitWidth(le)*Ye/De.internal.scaleFactor;return new function(mt){var ft=(mt=mt||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return ft}}),this}({width:rt*=Math.round(96*Be/72*1e4)/1e4})},M.prototype.scale=function(le,De){if(isNaN(le)||isNaN(De))throw Ka.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var Be=new o(le,0,0,De,0,0);this.ctx.transform=this.ctx.transform.multiply(Be)},M.prototype.rotate=function(le){if(isNaN(le))throw Ka.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var De=new o(Math.cos(le),Math.sin(le),-Math.sin(le),Math.cos(le),0,0);this.ctx.transform=this.ctx.transform.multiply(De)},M.prototype.translate=function(le,De){if(isNaN(le)||isNaN(De))throw Ka.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var Be=new o(1,0,0,1,le,De);this.ctx.transform=this.ctx.transform.multiply(Be)},M.prototype.transform=function(le,De,Be,Ye,rt,mt){if(isNaN(le)||isNaN(De)||isNaN(Be)||isNaN(Ye)||isNaN(rt)||isNaN(mt))throw Ka.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var ft=new o(le,De,Be,Ye,rt,mt);this.ctx.transform=this.ctx.transform.multiply(ft)},M.prototype.setTransform=function(le,De,Be,Ye,rt,mt){le=isNaN(le)?1:le,De=isNaN(De)?0:De,Be=isNaN(Be)?0:Be,Ye=isNaN(Ye)?1:Ye,rt=isNaN(rt)?0:rt,mt=isNaN(mt)?0:mt,this.ctx.transform=new o(le,De,Be,Ye,rt,mt)};var se=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};M.prototype.drawImage=function(le,De,Be,Ye,rt,mt,ft,Dt,Yt){var cn=this.pdf.getImageProperties(le),gn=1,Mn=1,Gt=1,st=1;Ye!==void 0&&Dt!==void 0&&(Gt=Dt/Ye,st=Yt/rt,gn=cn.width/Ye*Dt/Ye,Mn=cn.height/rt*Yt/rt),mt===void 0&&(mt=De,ft=Be,De=0,Be=0),Ye!==void 0&&Dt===void 0&&(Dt=Ye,Yt=rt),Ye===void 0&&Dt===void 0&&(Dt=cn.width,Yt=cn.height);for(var mr,Er=this.ctx.transform.decompose(),Cr=we(Er.rotate.shx),Ln=new o,ir=(Ln=(Ln=(Ln=Ln.multiply(Er.translate)).multiply(Er.skew)).multiply(Er.scale)).applyToRectangle(new _(mt-De*Gt,ft-Be*st,Ye*gn,rt*Mn)),er=fe.call(this,ir),Yr=[],Vt=0;Vt<er.length;Vt+=1)Yr.indexOf(er[Vt])===-1&&Yr.push(er[Vt]);if(me(Yr),this.autoPaging)for(var Pn=Yr[0],Gn=Yr[Yr.length-1],Dn=Pn;Dn<Gn+1;Dn++){this.pdf.setPage(Dn);var Mr=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],wr=Dn===1?this.posY+this.margin[0]:this.margin[0],Tr=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Ir=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Pr=Dn===1?0:Tr+(Dn-2)*Ir;if(this.ctx.clip_path.length!==0){var Ei=this.path;mr=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=ne(mr,this.posX+this.margin[3],-Pr+wr+this.ctx.prevPageLastElemOffset),ke.call(this,"fill",!0),this.path=Ei}var Pi=JSON.parse(JSON.stringify(ir));Pi=ne([Pi],this.posX+this.margin[3],-Pr+wr+this.ctx.prevPageLastElemOffset)[0];var or=(Dn>Pn||Dn<Gn)&&se.call(this);or&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Mr,Ir,null).clip().discardPath()),this.pdf.addImage(le,"JPEG",Pi.x,Pi.y,Pi.w,Pi.h,null,null,Cr),or&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(le,"JPEG",ir.x,ir.y,ir.w,ir.h,null,null,Cr)};var fe=function(le,De,Be){var Ye=[];De=De||this.pdf.internal.pageSize.width,Be=Be||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var rt=this.posY+this.ctx.prevPageLastElemOffset;switch(le.type){default:case"mt":case"lt":Ye.push(Math.floor((le.y+rt)/Be)+1);break;case"arc":Ye.push(Math.floor((le.y+rt-le.radius)/Be)+1),Ye.push(Math.floor((le.y+rt+le.radius)/Be)+1);break;case"qct":var mt=Fe(this.ctx.lastPoint.x,this.ctx.lastPoint.y,le.x1,le.y1,le.x,le.y);Ye.push(Math.floor((mt.y+rt)/Be)+1),Ye.push(Math.floor((mt.y+mt.h+rt)/Be)+1);break;case"bct":var ft=nt(this.ctx.lastPoint.x,this.ctx.lastPoint.y,le.x1,le.y1,le.x2,le.y2,le.x,le.y);Ye.push(Math.floor((ft.y+rt)/Be)+1),Ye.push(Math.floor((ft.y+ft.h+rt)/Be)+1);break;case"rect":Ye.push(Math.floor((le.y+rt)/Be)+1),Ye.push(Math.floor((le.y+le.h+rt)/Be)+1)}for(var Dt=0;Dt<Ye.length;Dt+=1)for(;this.pdf.internal.getNumberOfPages()<Ye[Dt];)J.call(this);return Ye},J=function(){var le=this.fillStyle,De=this.strokeStyle,Be=this.font,Ye=this.lineCap,rt=this.lineWidth,mt=this.lineJoin;this.pdf.addPage(),this.fillStyle=le,this.strokeStyle=De,this.font=Be,this.lineCap=Ye,this.lineWidth=rt,this.lineJoin=mt},ne=function(le,De,Be){for(var Ye=0;Ye<le.length;Ye++)switch(le[Ye].type){case"bct":le[Ye].x2+=De,le[Ye].y2+=Be;case"qct":le[Ye].x1+=De,le[Ye].y1+=Be;default:le[Ye].x+=De,le[Ye].y+=Be}return le},me=function(le){return le.sort(function(De,Be){return De-Be})},ue=function(le,De){for(var Be,Ye,rt=this.fillStyle,mt=this.strokeStyle,ft=this.lineCap,Dt=this.lineWidth,Yt=Math.abs(Dt*this.ctx.transform.scaleX),cn=this.lineJoin,gn=JSON.parse(JSON.stringify(this.path)),Mn=JSON.parse(JSON.stringify(this.path)),Gt=[],st=0;st<Mn.length;st++)if(Mn[st].x!==void 0)for(var mr=fe.call(this,Mn[st]),Er=0;Er<mr.length;Er+=1)Gt.indexOf(mr[Er])===-1&&Gt.push(mr[Er]);for(var Cr=0;Cr<Gt.length;Cr++)for(;this.pdf.internal.getNumberOfPages()<Gt[Cr];)J.call(this);if(me(Gt),this.autoPaging)for(var Ln=Gt[0],ir=Gt[Gt.length-1],er=Ln;er<ir+1;er++){this.pdf.setPage(er),this.fillStyle=rt,this.strokeStyle=mt,this.lineCap=ft,this.lineWidth=Yt,this.lineJoin=cn;var Yr=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Vt=er===1?this.posY+this.margin[0]:this.margin[0],Pn=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Gn=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Dn=er===1?0:Pn+(er-2)*Gn;if(this.ctx.clip_path.length!==0){var Mr=this.path;Be=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=ne(Be,this.posX+this.margin[3],-Dn+Vt+this.ctx.prevPageLastElemOffset),ke.call(this,le,!0),this.path=Mr}if(Ye=JSON.parse(JSON.stringify(gn)),this.path=ne(Ye,this.posX+this.margin[3],-Dn+Vt+this.ctx.prevPageLastElemOffset),De===!1||er===0){var wr=(er>Ln||er<ir)&&se.call(this);wr&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Yr,Gn,null).clip().discardPath()),ke.call(this,le,De),wr&&this.pdf.restoreGraphicsState()}this.lineWidth=Dt}else this.lineWidth=Yt,ke.call(this,le,De),this.lineWidth=Dt;this.path=gn},ke=function(le,De){if((le!=="stroke"||De||!ie.call(this))&&(le==="stroke"||De||!k.call(this))){for(var Be,Ye,rt=[],mt=this.path,ft=0;ft<mt.length;ft++){var Dt=mt[ft];switch(Dt.type){case"begin":rt.push({begin:!0});break;case"close":rt.push({close:!0});break;case"mt":rt.push({start:Dt,deltas:[],abs:[]});break;case"lt":var Yt=rt.length;if(mt[ft-1]&&!isNaN(mt[ft-1].x)&&(Be=[Dt.x-mt[ft-1].x,Dt.y-mt[ft-1].y],Yt>0)){for(;Yt>=0;Yt--)if(rt[Yt-1].close!==!0&&rt[Yt-1].begin!==!0){rt[Yt-1].deltas.push(Be),rt[Yt-1].abs.push(Dt);break}}break;case"bct":Be=[Dt.x1-mt[ft-1].x,Dt.y1-mt[ft-1].y,Dt.x2-mt[ft-1].x,Dt.y2-mt[ft-1].y,Dt.x-mt[ft-1].x,Dt.y-mt[ft-1].y],rt[rt.length-1].deltas.push(Be);break;case"qct":var cn=mt[ft-1].x+2/3*(Dt.x1-mt[ft-1].x),gn=mt[ft-1].y+2/3*(Dt.y1-mt[ft-1].y),Mn=Dt.x+2/3*(Dt.x1-Dt.x),Gt=Dt.y+2/3*(Dt.y1-Dt.y),st=Dt.x,mr=Dt.y;Be=[cn-mt[ft-1].x,gn-mt[ft-1].y,Mn-mt[ft-1].x,Gt-mt[ft-1].y,st-mt[ft-1].x,mr-mt[ft-1].y],rt[rt.length-1].deltas.push(Be);break;case"arc":rt.push({deltas:[],abs:[],arc:!0}),Array.isArray(rt[rt.length-1].abs)&&rt[rt.length-1].abs.push(Dt)}}Ye=De?null:le==="stroke"?"stroke":"fill";for(var Er=!1,Cr=0;Cr<rt.length;Cr++)if(rt[Cr].arc)for(var Ln=rt[Cr].abs,ir=0;ir<Ln.length;ir++){var er=Ln[ir];er.type==="arc"?U.call(this,er.x,er.y,er.radius,er.startAngle,er.endAngle,er.counterclockwise,void 0,De,!Er):Z.call(this,er.x,er.y),Er=!0}else if(rt[Cr].close===!0)this.pdf.internal.out("h"),Er=!1;else if(rt[Cr].begin!==!0){var Yr=rt[Cr].start.x,Vt=rt[Cr].start.y;be.call(this,rt[Cr].deltas,Yr,Vt),Er=!0}Ye&&F.call(this,Ye),De&&q.call(this)}},je=function(le){var De=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,Be=De*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return le-Be;case"top":return le+De-Be;case"hanging":return le+De-2*Be;case"middle":return le+De/2-Be;default:return le}},pe=function(le){return le+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};M.prototype.createLinearGradient=function(){var le=function(){};return le.colorStops=[],le.addColorStop=function(De,Be){this.colorStops.push([De,Be])},le.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},le.isCanvasGradient=!0,le},M.prototype.createPattern=function(){return this.createLinearGradient()},M.prototype.createRadialGradient=function(){return this.createLinearGradient()};var U=function(le,De,Be,Ye,rt,mt,ft,Dt,Yt){for(var cn=Oe.call(this,Be,Ye,rt,mt),gn=0;gn<cn.length;gn++){var Mn=cn[gn];gn===0&&(Yt?j.call(this,Mn.x1+le,Mn.y1+De):Z.call(this,Mn.x1+le,Mn.y1+De)),Re.call(this,le,De,Mn.x2,Mn.y2,Mn.x3,Mn.y3,Mn.x4,Mn.y4)}Dt?q.call(this):F.call(this,ft)},F=function(le){switch(le){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},q=function(){this.pdf.clip(),this.pdf.discardPath()},j=function(le,De){this.pdf.internal.out(t(le)+" "+i(De)+" m")},H=function(le){var De;switch(le.align){case"right":case"end":De="right";break;case"center":De="center";break;default:De="left"}var Be=this.pdf.getTextDimensions(le.text),Ye=je.call(this,le.y),rt=pe.call(this,Ye)-Be.h,mt=this.ctx.transform.applyToPoint(new m(le.x,Ye)),ft=this.ctx.transform.decompose(),Dt=new o;Dt=(Dt=(Dt=Dt.multiply(ft.translate)).multiply(ft.skew)).multiply(ft.scale);for(var Yt,cn,gn,Mn=this.ctx.transform.applyToRectangle(new _(le.x,Ye,Be.w,Be.h)),Gt=Dt.applyToRectangle(new _(le.x,rt,Be.w,Be.h)),st=fe.call(this,Gt),mr=[],Er=0;Er<st.length;Er+=1)mr.indexOf(st[Er])===-1&&mr.push(st[Er]);if(me(mr),this.autoPaging)for(var Cr=mr[0],Ln=mr[mr.length-1],ir=Cr;ir<Ln+1;ir++){this.pdf.setPage(ir);var er=ir===1?this.posY+this.margin[0]:this.margin[0],Yr=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Vt=this.pdf.internal.pageSize.height-this.margin[2],Pn=Vt-this.margin[0],Gn=this.pdf.internal.pageSize.width-this.margin[1],Dn=Gn-this.margin[3],Mr=ir===1?0:Yr+(ir-2)*Pn;if(this.ctx.clip_path.length!==0){var wr=this.path;Yt=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=ne(Yt,this.posX+this.margin[3],-1*Mr+er),ke.call(this,"fill",!0),this.path=wr}var Tr=ne([JSON.parse(JSON.stringify(Gt))],this.posX+this.margin[3],-Mr+er+this.ctx.prevPageLastElemOffset)[0];le.scale>=.01&&(cn=this.pdf.internal.getFontSize(),this.pdf.setFontSize(cn*le.scale),gn=this.lineWidth,this.lineWidth=gn*le.scale);var Ir=this.autoPaging!=="text";if(Ir||Tr.y+Tr.h<=Vt){if(Ir||Tr.y>=er&&Tr.x<=Gn){var Pr=Ir?le.text:this.pdf.splitTextToSize(le.text,le.maxWidth||Gn-Tr.x)[0],Ei=ne([JSON.parse(JSON.stringify(Mn))],this.posX+this.margin[3],-Mr+er+this.ctx.prevPageLastElemOffset)[0],Pi=Ir&&(ir>Cr||ir<Ln)&&se.call(this);Pi&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Dn,Pn,null).clip().discardPath()),this.pdf.text(Pr,Ei.x,Ei.y,{angle:le.angle,align:De,renderingMode:le.renderingMode}),Pi&&this.pdf.restoreGraphicsState()}}else Tr.y<Vt&&(this.ctx.prevPageLastElemOffset+=Vt-Tr.y);le.scale>=.01&&(this.pdf.setFontSize(cn),this.lineWidth=gn)}else le.scale>=.01&&(cn=this.pdf.internal.getFontSize(),this.pdf.setFontSize(cn*le.scale),gn=this.lineWidth,this.lineWidth=gn*le.scale),this.pdf.text(le.text,mt.x+this.posX,mt.y+this.posY,{angle:le.angle,align:De,renderingMode:le.renderingMode,maxWidth:le.maxWidth}),le.scale>=.01&&(this.pdf.setFontSize(cn),this.lineWidth=gn)},Z=function(le,De,Be,Ye){Be=Be||0,Ye=Ye||0,this.pdf.internal.out(t(le+Be)+" "+i(De+Ye)+" l")},be=function(le,De,Be){return this.pdf.lines(le,De,Be,null,null)},Re=function(le,De,Be,Ye,rt,mt,ft,Dt){this.pdf.internal.out([e(c(Be+le)),e(u(Ye+De)),e(c(rt+le)),e(u(mt+De)),e(c(ft+le)),e(u(Dt+De)),"c"].join(" "))},Oe=function(le,De,Be,Ye){for(var rt=2*Math.PI,mt=Math.PI/2;De>Be;)De-=rt;var ft=Math.abs(Be-De);ft<rt&&Ye&&(ft=rt-ft);for(var Dt=[],Yt=Ye?-1:1,cn=De;ft>1e-5;){var gn=cn+Yt*Math.min(ft,mt);Dt.push(Ne.call(this,le,cn,gn)),ft-=Math.abs(gn-cn),cn=gn}return Dt},Ne=function(le,De,Be){var Ye=(Be-De)/2,rt=le*Math.cos(Ye),mt=le*Math.sin(Ye),ft=rt,Dt=-mt,Yt=ft*ft+Dt*Dt,cn=Yt+ft*rt+Dt*mt,gn=4/3*(Math.sqrt(2*Yt*cn)-cn)/(ft*mt-Dt*rt),Mn=ft-gn*Dt,Gt=Dt+gn*ft,st=Mn,mr=-Gt,Er=Ye+De,Cr=Math.cos(Er),Ln=Math.sin(Er);return{x1:le*Math.cos(De),y1:le*Math.sin(De),x2:Mn*Cr-Gt*Ln,y2:Mn*Ln+Gt*Cr,x3:st*Cr-mr*Ln,y3:st*Ln+mr*Cr,x4:le*Math.cos(Be),y4:le*Math.sin(Be)}},we=function(le){return 180*le/Math.PI},Fe=function(le,De,Be,Ye,rt,mt){var ft=le+.5*(Be-le),Dt=De+.5*(Ye-De),Yt=rt+.5*(Be-rt),cn=mt+.5*(Ye-mt),gn=Math.min(le,rt,ft,Yt),Mn=Math.max(le,rt,ft,Yt),Gt=Math.min(De,mt,Dt,cn),st=Math.max(De,mt,Dt,cn);return new _(gn,Gt,Mn-gn,st-Gt)},nt=function(le,De,Be,Ye,rt,mt,ft,Dt){var Yt,cn,gn,Mn,Gt,st,mr,Er,Cr,Ln,ir,er,Yr,Vt,Pn=Be-le,Gn=Ye-De,Dn=rt-Be,Mr=mt-Ye,wr=ft-rt,Tr=Dt-mt;for(cn=0;cn<41;cn++)Cr=(mr=(gn=le+(Yt=cn/40)*Pn)+Yt*((Gt=Be+Yt*Dn)-gn))+Yt*(Gt+Yt*(rt+Yt*wr-Gt)-mr),Ln=(Er=(Mn=De+Yt*Gn)+Yt*((st=Ye+Yt*Mr)-Mn))+Yt*(st+Yt*(mt+Yt*Tr-st)-Er),cn==0?(ir=Cr,er=Ln,Yr=Cr,Vt=Ln):(ir=Math.min(ir,Cr),er=Math.min(er,Ln),Yr=Math.max(Yr,Cr),Vt=Math.max(Vt,Ln));return new _(Math.round(ir),Math.round(er),Math.round(Yr-ir),Math.round(Vt-er))},xe=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var le,De,Be=(le=this.ctx.lineDash,De=this.ctx.lineDashOffset,JSON.stringify({lineDash:le,lineDashOffset:De}));this.prevLineDash!==Be&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=Be)}}})(Si.API),(function(n){var e=function(m){var _,o,b,I,M,V,k,ie,se,fe;for(o=[],b=0,I=(m+=_="\0\0\0\0".slice(m.length%4||4)).length;I>b;b+=4)(M=(m.charCodeAt(b)<<24)+(m.charCodeAt(b+1)<<16)+(m.charCodeAt(b+2)<<8)+m.charCodeAt(b+3))!==0?(V=(M=((M=((M=((M=(M-(fe=M%85))/85)-(se=M%85))/85)-(ie=M%85))/85)-(k=M%85))/85)%85,o.push(V+33,k+33,ie+33,se+33,fe+33)):o.push(122);return(function(J,ne){for(var me=ne;me>0;me--)J.pop()})(o,_.length),String.fromCharCode.apply(String,o)+"~>"},t=function(m){var _,o,b,I,M,V=String,k="length",ie=255,se="charCodeAt",fe="slice",J="replace";for(m[fe](-2),m=m[fe](0,-2)[J](/\s/g,"")[J]("z","!!!!!"),b=[],I=0,M=(m+=_="uuuuu"[fe](m[k]%5||5))[k];M>I;I+=5)o=52200625*(m[se](I)-33)+614125*(m[se](I+1)-33)+7225*(m[se](I+2)-33)+85*(m[se](I+3)-33)+(m[se](I+4)-33),b.push(ie&o>>24,ie&o>>16,ie&o>>8,ie&o);return(function(ne,me){for(var ue=me;ue>0;ue--)ne.pop()})(b,_[k]),V.fromCharCode.apply(V,b)},i=function(m){return m.split("").map(function(_){return("0"+_.charCodeAt().toString(16)).slice(-2)}).join("")+">"},c=function(m){var _=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((m=m.replace(/\s/g,"")).indexOf(">")!==-1&&(m=m.substr(0,m.indexOf(">"))),m.length%2&&(m+="0"),_.test(m)===!1)return"";for(var o="",b=0;b<m.length;b+=2)o+=String.fromCharCode("0x"+(m[b]+m[b+1]));return o},u=function(m){for(var _=new Uint8Array(m.length),o=m.length;o--;)_[o]=m.charCodeAt(o);return(_=v5(_)).reduce(function(b,I){return b+String.fromCharCode(I)},"")};n.processDataByFilters=function(m,_){var o=0,b=m||"",I=[];for(typeof(_=_||[])=="string"&&(_=[_]),o=0;o<_.length;o+=1)switch(_[o]){case"ASCII85Decode":case"/ASCII85Decode":b=t(b),I.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":b=e(b),I.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":b=c(b),I.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":b=i(b),I.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":b=u(b),I.push("/FlateDecode");break;default:throw new Error('The filter: "'+_[o]+'" is not implemented')}return{data:b,reverseChain:I.reverse().join(" ")}}})(Si.API),(function(n){n.loadFile=function(e,t,i){return(function(c,u,m){u=u!==!1,m=typeof m=="function"?m:function(){};var _=void 0;try{_=(function(o,b,I){var M=new XMLHttpRequest,V=0,k=function(ie){var se=ie.length,fe=[],J=String.fromCharCode;for(V=0;V<se;V+=1)fe.push(J(255&ie.charCodeAt(V)));return fe.join("")};if(M.open("GET",o,!b),M.overrideMimeType("text/plain; charset=x-user-defined"),b===!1&&(M.onload=function(){M.status===200?I(k(this.responseText)):I(void 0)}),M.send(null),b&&M.status===200)return k(M.responseText)})(c,u,m)}catch{}return _})(e,t,i)},n.loadImageFile=n.loadFile})(Si.API),(function(n){function e(){return(oo.html2canvas?Promise.resolve(oo.html2canvas):fb(()=>import("./html2canvas.esm-B0tyYwQk.js"),[])).catch(function(_){return Promise.reject(new Error("Could not load html2canvas: "+_))}).then(function(_){return _.default?_.default:_})}function t(){return(oo.DOMPurify?Promise.resolve(oo.DOMPurify):fb(()=>import("./purify.es-B6FQ9oRL.js"),[])).catch(function(_){return Promise.reject(new Error("Could not load dompurify: "+_))}).then(function(_){return _.default?_.default:_})}var i=function(_){var o=wa(_);return o==="undefined"?"undefined":o==="string"||_ instanceof String?"string":o==="number"||_ instanceof Number?"number":o==="function"||_ instanceof Function?"function":_&&_.constructor===Array?"array":_&&_.nodeType===1?"element":o==="object"?"object":"unknown"},c=function(_,o){var b=document.createElement(_);for(var I in o.className&&(b.className=o.className),o.innerHTML&&o.dompurify&&(b.innerHTML=o.dompurify.sanitize(o.innerHTML)),o.style)b.style[I]=o.style[I];return b},u=function _(o,b){for(var I=o.nodeType===3?document.createTextNode(o.nodeValue):o.cloneNode(!1),M=o.firstChild;M;M=M.nextSibling)b!==!0&&M.nodeType===1&&M.nodeName==="SCRIPT"||I.appendChild(_(M,b));return o.nodeType===1&&(o.nodeName==="CANVAS"?(I.width=o.width,I.height=o.height,I.getContext("2d").drawImage(o,0,0)):o.nodeName!=="TEXTAREA"&&o.nodeName!=="SELECT"||(I.value=o.value),I.addEventListener("load",function(){I.scrollTop=o.scrollTop,I.scrollLeft=o.scrollLeft},!0)),I},m=function _(o){var b=Object.assign(_.convert(Promise.resolve()),JSON.parse(JSON.stringify(_.template))),I=_.convert(Promise.resolve(),b);return(I=I.setProgress(1,_,1,[_])).set(o)};(m.prototype=Object.create(Promise.prototype)).constructor=m,m.convert=function(_,o){return _.__proto__=o||m.prototype,_},m.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},m.prototype.from=function(_,o){return this.then(function(){switch(o=o||(function(b){switch(i(b)){case"string":return"string";case"element":return b.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}})(_),o){case"string":return this.then(t).then(function(b){return this.set({src:c("div",{innerHTML:_,dompurify:b})})});case"element":return this.set({src:_});case"canvas":return this.set({canvas:_});case"img":return this.set({img:_});default:return this.error("Unknown source type.")}})},m.prototype.to=function(_){switch(_){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},m.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var _={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},o=u(this.prop.src,this.opt.html2canvas.javascriptEnabled);o.tagName==="BODY"&&(_.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=c("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=c("div",{className:"html2pdf__container",style:_}),this.prop.container.appendChild(o),this.prop.container.firstChild.appendChild(c("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},m.prototype.toCanvas=function(){var _=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(_).then(e).then(function(o){var b=Object.assign({},this.opt.html2canvas);return delete b.onrendered,o(this.prop.container,b)}).then(function(o){(this.opt.html2canvas.onrendered||function(){})(o),this.prop.canvas=o,document.body.removeChild(this.prop.overlay)})},m.prototype.toContext2d=function(){var _=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(_).then(e).then(function(o){var b=this.opt.jsPDF,I=this.opt.fontFaces,M=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,V=Object.assign({async:!0,allowTaint:!0,scale:M,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete V.onrendered,b.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,b.context2d.posX=this.opt.x,b.context2d.posY=this.opt.y,b.context2d.margin=this.opt.margin,b.context2d.fontFaces=I,I)for(var k=0;k<I.length;++k){var ie=I[k],se=ie.src.find(function(fe){return fe.format==="truetype"});se&&b.addFont(se.url,ie.ref.name,ie.ref.style)}return V.windowHeight=V.windowHeight||0,V.windowHeight=V.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):V.windowHeight,b.context2d.save(!0),o(this.prop.container,V)}).then(function(o){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(o),this.prop.canvas=o,document.body.removeChild(this.prop.overlay)})},m.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var _=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=_})},m.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},m.prototype.output=function(_,o,b){return(b=b||"pdf").toLowerCase()==="img"||b.toLowerCase()==="image"?this.outputImg(_,o):this.outputPdf(_,o)},m.prototype.outputPdf=function(_,o){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(_,o)})},m.prototype.outputImg=function(_){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(_){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+_+'" is not supported.'}})},m.prototype.save=function(_){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(_?{filename:_}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},m.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},m.prototype.set=function(_){if(i(_)!=="object")return this;var o=Object.keys(_||{}).map(function(b){if(b in m.template.prop)return function(){this.prop[b]=_[b]};switch(b){case"margin":return this.setMargin.bind(this,_.margin);case"jsPDF":return function(){return this.opt.jsPDF=_.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,_.pageSize);default:return function(){this.opt[b]=_[b]}}},this);return this.then(function(){return this.thenList(o)})},m.prototype.get=function(_,o){return this.then(function(){var b=_ in m.template.prop?this.prop[_]:this.opt[_];return o?o(b):b})},m.prototype.setMargin=function(_){return this.then(function(){switch(i(_)){case"number":_=[_,_,_,_];case"array":if(_.length===2&&(_=[_[0],_[1],_[0],_[1]]),_.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=_}).then(this.setPageSize)},m.prototype.setPageSize=function(_){function o(b,I){return Math.floor(b*I/72*96)}return this.then(function(){(_=_||Si.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(_.inner={width:_.width-this.opt.margin[1]-this.opt.margin[3],height:_.height-this.opt.margin[0]-this.opt.margin[2]},_.inner.px={width:o(_.inner.width,_.k),height:o(_.inner.height,_.k)},_.inner.ratio=_.inner.height/_.inner.width),this.prop.pageSize=_})},m.prototype.setProgress=function(_,o,b,I){return _!=null&&(this.progress.val=_),o!=null&&(this.progress.state=o),b!=null&&(this.progress.n=b),I!=null&&(this.progress.stack=I),this.progress.ratio=this.progress.val/this.progress.state,this},m.prototype.updateProgress=function(_,o,b,I){return this.setProgress(_?this.progress.val+_:null,o||null,b?this.progress.n+b:null,I?this.progress.stack.concat(I):null)},m.prototype.then=function(_,o){var b=this;return this.thenCore(_,o,function(I,M){return b.updateProgress(null,null,1,[I]),Promise.prototype.then.call(this,function(V){return b.updateProgress(null,I),V}).then(I,M).then(function(V){return b.updateProgress(1),V})})},m.prototype.thenCore=function(_,o,b){b=b||Promise.prototype.then;var I=this;_&&(_=_.bind(I)),o&&(o=o.bind(I));var M=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?I:m.convert(Object.assign({},I),Promise.prototype),V=b.call(M,_,o);return m.convert(V,I.__proto__)},m.prototype.thenExternal=function(_,o){return Promise.prototype.then.call(this,_,o)},m.prototype.thenList=function(_){var o=this;return _.forEach(function(b){o=o.thenCore(b)}),o},m.prototype.catch=function(_){_&&(_=_.bind(this));var o=Promise.prototype.catch.call(this,_);return m.convert(o,this)},m.prototype.catchExternal=function(_){return Promise.prototype.catch.call(this,_)},m.prototype.error=function(_){return this.then(function(){throw new Error(_)})},m.prototype.using=m.prototype.set,m.prototype.saveAs=m.prototype.save,m.prototype.export=m.prototype.output,m.prototype.run=m.prototype.then,Si.getPageSize=function(_,o,b){if(wa(_)==="object"){var I=_;_=I.orientation,o=I.unit||o,b=I.format||b}o=o||"mm",b=b||"a4",_=(""+(_||"P")).toLowerCase();var M,V=(""+b).toLowerCase(),k={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(o){case"pt":M=1;break;case"mm":M=72/25.4;break;case"cm":M=72/2.54;break;case"in":M=72;break;case"px":M=.75;break;case"pc":case"em":M=12;break;case"ex":M=6;break;default:throw"Invalid unit: "+o}var ie,se=0,fe=0;if(k.hasOwnProperty(V))se=k[V][1]/M,fe=k[V][0]/M;else try{se=b[1],fe=b[0]}catch{throw new Error("Invalid format: "+b)}if(_==="p"||_==="portrait")_="p",fe>se&&(ie=fe,fe=se,se=ie);else{if(_!=="l"&&_!=="landscape")throw"Invalid orientation: "+_;_="l",se>fe&&(ie=fe,fe=se,se=ie)}return{width:fe,height:se,unit:o,k:M,orientation:_}},n.html=function(_,o){(o=o||{}).callback=o.callback||function(){},o.html2canvas=o.html2canvas||{},o.html2canvas.canvas=o.html2canvas.canvas||this.canvas,o.jsPDF=o.jsPDF||this,o.fontFaces=o.fontFaces?o.fontFaces.map(kb):null;var b=new m(o);return o.worker?b:b.from(_).doCallback()}})(Si.API),Si.API.addJS=function(n){return DS=n,this.internal.events.subscribe("postPutResources",function(){_1=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(_1+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),NS=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+DS+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){_1!==void 0&&NS!==void 0&&this.internal.out("/Names <</JavaScript "+_1+" 0 R>>")}),this},(function(n){var e;n.events.push(["postPutResources",function(){var t=this,i=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var c=t.outline.render().split(/\r\n/),u=0;u<c.length;u++){var m=c[u],_=i.exec(m);if(_!=null){var o=_[1];t.internal.newObjectDeferredBegin(o,!1)}t.internal.write(m)}if(this.outline.createNamedDestinations){var b=this.internal.pages.length,I=[];for(u=0;u<b;u++){var M=t.internal.newObject();I.push(M);var V=t.internal.getPageInfo(u+1);t.internal.write("<< /D["+V.objId+" 0 R /XYZ null null null]>> endobj")}var k=t.internal.newObject();for(t.internal.write("<< /Names [ "),u=0;u<I.length;u++)t.internal.write("(page_"+(u+1)+")"+I[u]+" 0 R");t.internal.write(" ] >>","endobj"),e=t.internal.newObject(),t.internal.write("<< /Dests "+k+" 0 R"),t.internal.write(">>","endobj")}}]),n.events.push(["putCatalog",function(){var t=this;t.outline.root.children.length>0&&(t.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&t.internal.write("/Names "+e+" 0 R"))}]),n.events.push(["initialized",function(){var t=this;t.outline={createNamedDestinations:!1,root:{children:[]}},t.outline.add=function(i,c,u){var m={title:c,options:u,children:[]};return i==null&&(i=this.root),i.children.push(m),m},t.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=t,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},t.outline.genIds_r=function(i){i.id=t.internal.newObjectDeferred();for(var c=0;c<i.children.length;c++)this.genIds_r(i.children[c])},t.outline.renderRoot=function(i){this.objStart(i),this.line("/Type /Outlines"),i.children.length>0&&(this.line("/First "+this.makeRef(i.children[0])),this.line("/Last "+this.makeRef(i.children[i.children.length-1]))),this.line("/Count "+this.count_r({count:0},i)),this.objEnd()},t.outline.renderItems=function(i){for(var c=this.ctx.pdf.internal.getVerticalCoordinateString,u=0;u<i.children.length;u++){var m=i.children[u];this.objStart(m),this.line("/Title "+this.makeString(m.title)),this.line("/Parent "+this.makeRef(i)),u>0&&this.line("/Prev "+this.makeRef(i.children[u-1])),u<i.children.length-1&&this.line("/Next "+this.makeRef(i.children[u+1])),m.children.length>0&&(this.line("/First "+this.makeRef(m.children[0])),this.line("/Last "+this.makeRef(m.children[m.children.length-1])));var _=this.count=this.count_r({count:0},m);if(_>0&&this.line("/Count "+_),m.options&&m.options.pageNumber){var o=t.internal.getPageInfo(m.options.pageNumber);this.line("/Dest ["+o.objId+" 0 R /XYZ 0 "+c(0)+" 0]")}this.objEnd()}for(var b=0;b<i.children.length;b++)this.renderItems(i.children[b])},t.outline.line=function(i){this.ctx.val+=i+`\r
`},t.outline.makeRef=function(i){return i.id+" 0 R"},t.outline.makeString=function(i){return"("+t.internal.pdfEscape(i)+")"},t.outline.objStart=function(i){this.ctx.val+=`\r
`+i.id+` 0 obj\r
<<\r
`},t.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},t.outline.count_r=function(i,c){for(var u=0;u<c.children.length;u++)i.count++,this.count_r(i,c.children[u]);return i.count}}])})(Si.API),(function(n){var e=[192,193,194,195,196,197,198,199];n.processJPEG=function(t,i,c,u,m,_){var o,b=this.decode.DCT_DECODE,I=null;if(typeof t=="string"||this.__addimage__.isArrayBuffer(t)||this.__addimage__.isArrayBufferView(t)){switch(t=m||t,t=this.__addimage__.isArrayBuffer(t)?new Uint8Array(t):t,o=(function(M){for(var V,k=256*M.charCodeAt(4)+M.charCodeAt(5),ie=M.length,se={width:0,height:0,numcomponents:1},fe=4;fe<ie;fe+=2){if(fe+=k,e.indexOf(M.charCodeAt(fe+1))!==-1){V=256*M.charCodeAt(fe+5)+M.charCodeAt(fe+6),se={width:256*M.charCodeAt(fe+7)+M.charCodeAt(fe+8),height:V,numcomponents:M.charCodeAt(fe+9)};break}k=256*M.charCodeAt(fe+2)+M.charCodeAt(fe+3)}return se})(t=this.__addimage__.isArrayBufferView(t)?this.__addimage__.arrayBufferToBinaryString(t):t),o.numcomponents){case 1:_=this.color_spaces.DEVICE_GRAY;break;case 4:_=this.color_spaces.DEVICE_CMYK;break;case 3:_=this.color_spaces.DEVICE_RGB}I={data:t,width:o.width,height:o.height,colorSpace:_,bitsPerComponent:8,filter:b,index:i,alias:c}}return I}})(Si.API),Si.API.processPNG=function(n,e,t,i){if(this.__addimage__.isArrayBuffer(n)&&(n=new Uint8Array(n)),this.__addimage__.isArrayBufferView(n)){var c,u=qR(n,{checkCrc:!0}),m=u.width,_=u.height,o=u.channels,b=u.palette,I=u.depth;c=b&&o===1?(function(U){for(var F=U.width,q=U.height,j=U.data,H=U.palette,Z=U.depth,be=!1,Re=[],Oe=[],Ne=void 0,we=!1,Fe=0,nt=0;nt<H.length;nt++){var xe=z2(H[nt],4),le=xe[0],De=xe[1],Be=xe[2],Ye=xe[3];Re.push(le,De,Be),Ye!=null&&(Ye===0?(Fe++,Oe.length<1&&Oe.push(nt)):Ye<255&&(we=!0))}if(we||Fe>1){be=!0,Oe=void 0;var rt=F*q;Ne=new Uint8Array(rt);for(var mt=new DataView(j.buffer),ft=0;ft<rt;ft++){var Dt=Mb(mt,ft,Z),Yt=z2(H[Dt],4)[3];Ne[ft]=Yt}}else Fe===0&&(Oe=void 0);return{colorSpace:"Indexed",colorsPerPixel:1,sMaskBitsPerComponent:be?8:void 0,colorBytes:j,alphaBytes:Ne,needSMask:be,palette:Re,mask:Oe}})(u):o===2||o===4?(function(U){for(var F=U.data,q=U.width,j=U.height,H=U.channels,Z=U.depth,be=H===2?"DeviceGray":"DeviceRGB",Re=H-1,Oe=q*j,Ne=Re,we=Oe*Ne,Fe=1*Oe,nt=Math.ceil(we*Z/8),xe=Math.ceil(Fe*Z/8),le=new Uint8Array(nt),De=new Uint8Array(xe),Be=new DataView(F.buffer),Ye=new DataView(le.buffer),rt=new DataView(De.buffer),mt=!1,ft=0;ft<Oe;ft++){for(var Dt=ft*H,Yt=0;Yt<Ne;Yt++)$S(Ye,Mb(Be,Dt+Yt,Z),ft*Ne+Yt,Z);var cn=Mb(Be,Dt+Ne,Z);cn<(1<<Z)-1&&(mt=!0),$S(rt,cn,1*ft,Z)}return{colorSpace:be,colorsPerPixel:Re,sMaskBitsPerComponent:mt?Z:void 0,colorBytes:le,alphaBytes:De,needSMask:mt}})(u):(function(U){var F=U.data,q=U.channels===1?"DeviceGray":"DeviceRGB";return{colorSpace:q,colorsPerPixel:q==="DeviceGray"?1:3,colorBytes:F instanceof Uint16Array?(function(j){for(var H=j.length,Z=new Uint8Array(2*H),be=new DataView(Z.buffer,Z.byteOffset,Z.byteLength),Re=0;Re<H;Re++)be.setUint16(2*Re,j[Re],!1);return Z})(F):F,needSMask:!1}})(u);var M,V,k,ie=c,se=ie.colorSpace,fe=ie.colorsPerPixel,J=ie.sMaskBitsPerComponent,ne=ie.colorBytes,me=ie.alphaBytes,ue=ie.needSMask,ke=ie.palette,je=ie.mask,pe=null;return i!==Si.API.image_compression.NONE&&typeof v5=="function"?(pe=(function(U){var F;switch(U){case Si.API.image_compression.FAST:F=11;break;case Si.API.image_compression.MEDIUM:F=13;break;case Si.API.image_compression.SLOW:F=14;break;default:F=12}return F})(i),M=this.decode.FLATE_DECODE,V="/Predictor ".concat(pe," /Colors ").concat(fe," /BitsPerComponent ").concat(I," /Columns ").concat(m),n=zS(ne,Math.ceil(m*fe*I/8),fe,I,i),ue&&(k=zS(me,Math.ceil(m*J/8),1,J,i))):(M=void 0,V=void 0,n=ne,ue&&(k=me)),(this.__addimage__.isArrayBuffer(n)||this.__addimage__.isArrayBufferView(n))&&(n=this.__addimage__.arrayBufferToBinaryString(n)),(k&&this.__addimage__.isArrayBuffer(k)||this.__addimage__.isArrayBufferView(k))&&(k=this.__addimage__.arrayBufferToBinaryString(k)),{alias:t,data:n,index:e,filter:M,decodeParameters:V,transparency:je,palette:ke,sMask:k,predictor:pe,width:m,height:_,bitsPerComponent:I,sMaskBitsPerComponent:J,colorSpace:se}}},(function(n){n.processGIF89A=function(e,t,i,c){var u=new uM(e),m=u.width,_=u.height,o=[];u.decodeAndBlitFrameRGBA(0,o);var b={data:o,width:m,height:_},I=new Nb(100).encode(b,100);return n.processJPEG.call(this,I,t,i,c)},n.processGIF87A=n.processGIF89A})(Si.API),Wd.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var n=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(n);for(var e=0;e<n;e++){var t=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),c=this.datav.getUint8(this.pos++,!0),u=this.datav.getUint8(this.pos++,!0);this.palette[e]={red:c,green:i,blue:t,quad:u}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},Wd.prototype.parseBGR=function(){this.pos=this.offset;try{var n="bit"+this.bitPP,e=this.width*this.height*4;this.data=new Uint8Array(e),this[n]()}catch(t){Ka.log("bit decode error:"+t)}},Wd.prototype.bit1=function(){var n,e=Math.ceil(this.width/8),t=e%4;for(n=this.height-1;n>=0;n--){for(var i=this.bottom_up?n:this.height-1-n,c=0;c<e;c++)for(var u=this.datav.getUint8(this.pos++,!0),m=i*this.width*4+8*c*4,_=0;_<8&&8*c+_<this.width;_++){var o=this.palette[u>>7-_&1];this.data[m+4*_]=o.blue,this.data[m+4*_+1]=o.green,this.data[m+4*_+2]=o.red,this.data[m+4*_+3]=255}t!==0&&(this.pos+=4-t)}},Wd.prototype.bit4=function(){for(var n=Math.ceil(this.width/2),e=n%4,t=this.height-1;t>=0;t--){for(var i=this.bottom_up?t:this.height-1-t,c=0;c<n;c++){var u=this.datav.getUint8(this.pos++,!0),m=i*this.width*4+2*c*4,_=u>>4,o=15&u,b=this.palette[_];if(this.data[m]=b.blue,this.data[m+1]=b.green,this.data[m+2]=b.red,this.data[m+3]=255,2*c+1>=this.width)break;b=this.palette[o],this.data[m+4]=b.blue,this.data[m+4+1]=b.green,this.data[m+4+2]=b.red,this.data[m+4+3]=255}e!==0&&(this.pos+=4-e)}},Wd.prototype.bit8=function(){for(var n=this.width%4,e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,i=0;i<this.width;i++){var c=this.datav.getUint8(this.pos++,!0),u=t*this.width*4+4*i;if(c<this.palette.length){var m=this.palette[c];this.data[u]=m.red,this.data[u+1]=m.green,this.data[u+2]=m.blue,this.data[u+3]=255}else this.data[u]=255,this.data[u+1]=255,this.data[u+2]=255,this.data[u+3]=255}n!==0&&(this.pos+=4-n)}},Wd.prototype.bit15=function(){for(var n=this.width%3,e=parseInt("11111",2),t=this.height-1;t>=0;t--){for(var i=this.bottom_up?t:this.height-1-t,c=0;c<this.width;c++){var u=this.datav.getUint16(this.pos,!0);this.pos+=2;var m=(u&e)/e*255|0,_=(u>>5&e)/e*255|0,o=(u>>10&e)/e*255|0,b=u>>15?255:0,I=i*this.width*4+4*c;this.data[I]=o,this.data[I+1]=_,this.data[I+2]=m,this.data[I+3]=b}this.pos+=n}},Wd.prototype.bit16=function(){for(var n=this.width%3,e=parseInt("11111",2),t=parseInt("111111",2),i=this.height-1;i>=0;i--){for(var c=this.bottom_up?i:this.height-1-i,u=0;u<this.width;u++){var m=this.datav.getUint16(this.pos,!0);this.pos+=2;var _=(m&e)/e*255|0,o=(m>>5&t)/t*255|0,b=(m>>11)/e*255|0,I=c*this.width*4+4*u;this.data[I]=b,this.data[I+1]=o,this.data[I+2]=_,this.data[I+3]=255}this.pos+=n}},Wd.prototype.bit24=function(){for(var n=this.height-1;n>=0;n--){for(var e=this.bottom_up?n:this.height-1-n,t=0;t<this.width;t++){var i=this.datav.getUint8(this.pos++,!0),c=this.datav.getUint8(this.pos++,!0),u=this.datav.getUint8(this.pos++,!0),m=e*this.width*4+4*t;this.data[m]=u,this.data[m+1]=c,this.data[m+2]=i,this.data[m+3]=255}this.pos+=this.width%4}},Wd.prototype.bit32=function(){for(var n=this.height-1;n>=0;n--)for(var e=this.bottom_up?n:this.height-1-n,t=0;t<this.width;t++){var i=this.datav.getUint8(this.pos++,!0),c=this.datav.getUint8(this.pos++,!0),u=this.datav.getUint8(this.pos++,!0),m=this.datav.getUint8(this.pos++,!0),_=e*this.width*4+4*t;this.data[_]=u,this.data[_+1]=c,this.data[_+2]=i,this.data[_+3]=m}},Wd.prototype.getData=function(){return this.data},(function(n){n.processBMP=function(e,t,i,c){var u=new Wd(e,!1),m=u.width,_=u.height,o={data:u.getData(),width:m,height:_},b=new Nb(100).encode(o,100);return n.processJPEG.call(this,b,t,i,c)}})(Si.API),HS.prototype.getData=function(){return this.data},(function(n){n.processWEBP=function(e,t,i,c){var u=new HS(e),m=u.width,_=u.height,o={data:u.getData(),width:m,height:_},b=new Nb(100).encode(o,100);return n.processJPEG.call(this,b,t,i,c)}})(Si.API),Si.API.processRGBA=function(n,e,t){for(var i=n.data,c=i.length,u=new Uint8Array(c/4*3),m=new Uint8Array(c/4),_=0,o=0,b=0;b<c;b+=4){var I=i[b],M=i[b+1],V=i[b+2],k=i[b+3];u[_++]=I,u[_++]=M,u[_++]=V,m[o++]=k}var ie=this.__addimage__.arrayBufferToBinaryString(u);return{alpha:this.__addimage__.arrayBufferToBinaryString(m),data:ie,index:e,alias:t,colorSpace:"DeviceRGB",bitsPerComponent:8,width:n.width,height:n.height}},Si.API.setLanguage=function(n){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[n]!==void 0&&(this.internal.languageSettings.languageCode=n,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},Hg=Si.API,v1=Hg.getCharWidthsArray=function(n,e){var t,i,c=(e=e||{}).font||this.internal.getFont(),u=e.fontSize||this.internal.getFontSize(),m=e.charSpace||this.internal.getCharSpace(),_=e.widths?e.widths:c.metadata.Unicode.widths,o=_.fof?_.fof:1,b=e.kerning?e.kerning:c.metadata.Unicode.kerning,I=b.fof?b.fof:1,M=e.doKerning!==!1,V=0,k=n.length,ie=0,se=_[0]||o,fe=[];for(t=0;t<k;t++)i=n.charCodeAt(t),typeof c.metadata.widthOfString=="function"?fe.push((c.metadata.widthOfGlyph(c.metadata.characterToGlyph(i))+m*(1e3/u)||0)/1e3):(V=M&&wa(b[i])==="object"&&!isNaN(parseInt(b[i][ie],10))?b[i][ie]/I:0,fe.push((_[i]||se)/o+V)),ie=i;return fe},FS=Hg.getStringUnitWidth=function(n,e){var t=(e=e||{}).fontSize||this.internal.getFontSize(),i=e.font||this.internal.getFont(),c=e.charSpace||this.internal.getCharSpace();return Hg.processArabic&&(n=Hg.processArabic(n)),typeof i.metadata.widthOfString=="function"?i.metadata.widthOfString(n,t,c)/t:v1.apply(this,arguments).reduce(function(u,m){return u+m},0)},OS=function(n,e,t,i){for(var c=[],u=0,m=n.length,_=0;u!==m&&_+e[u]<t;)_+=e[u],u++;c.push(n.slice(0,u));var o=u;for(_=0;u!==m;)_+e[u]>i&&(c.push(n.slice(o,u)),_=0,o=u),_+=e[u],u++;return o!==u&&c.push(n.slice(o,u)),c},BS=function(n,e,t){t||(t={});var i,c,u,m,_,o,b,I=[],M=[I],V=t.textIndent||0,k=0,ie=0,se=n.split(" "),fe=v1.apply(this,[" ",t])[0];if(o=t.lineIndent===-1?se[0].length+2:t.lineIndent||0){var J=Array(o).join(" "),ne=[];se.map(function(ue){(ue=ue.split(/\s*\n/)).length>1?ne=ne.concat(ue.map(function(ke,je){return(je&&ke.length?`
`:"")+ke})):ne.push(ue[0])}),se=ne,o=FS.apply(this,[J,t])}for(u=0,m=se.length;u<m;u++){var me=0;if(i=se[u],o&&i[0]==`
`&&(i=i.substr(1),me=1),V+k+(ie=(c=v1.apply(this,[i,t])).reduce(function(ue,ke){return ue+ke},0))>e||me){if(ie>e){for(_=OS.apply(this,[i,c,e-(V+k),e]),I.push(_.shift()),I=[_.pop()];_.length;)M.push([_.shift()]);ie=c.slice(i.length-(I[0]?I[0].length:0)).reduce(function(ue,ke){return ue+ke},0)}else I=[i];M.push(I),V=ie+o,k=fe}else I.push(i),V+=k+ie,k=fe}return b=o?function(ue,ke){return(ke?J:"")+ue.join(" ")}:function(ue){return ue.join(" ")},M.map(b)},Hg.splitTextToSize=function(n,e,t){var i,c=(t=t||{}).fontSize||this.internal.getFontSize(),u=(function(I){if(I.widths&&I.kerning)return{widths:I.widths,kerning:I.kerning};var M=this.internal.getFont(I.fontName,I.fontStyle),V="Unicode";return M.metadata[V]?{widths:M.metadata[V].widths||{0:1},kerning:M.metadata[V].kerning||{}}:{font:M.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,t);i=Array.isArray(n)?n:String(n).split(/\r?\n/);var m=1*this.internal.scaleFactor*e/c;u.textIndent=t.textIndent?1*t.textIndent*this.internal.scaleFactor/c:0,u.lineIndent=t.lineIndent;var _,o,b=[];for(_=0,o=i.length;_<o;_++)b=b.concat(BS.apply(this,[i[_],m,u]));return b},(function(n){n.__fontmetrics__=n.__fontmetrics__||{};for(var e="0123456789abcdef",t="klmnopqrstuvwxyz",i={},c={},u=0;u<16;u++)i[t[u]]=e[u],c[e[u]]=t[u];var m=function(V){return"0x"+parseInt(V,10).toString(16)},_=n.__fontmetrics__.compress=function(V){var k,ie,se,fe,J=["{"];for(var ne in V){if(k=V[ne],isNaN(parseInt(ne,10))?ie="'"+ne+"'":(ne=parseInt(ne,10),ie=(ie=m(ne).slice(2)).slice(0,-1)+c[ie.slice(-1)]),typeof k=="number")k<0?(se=m(k).slice(3),fe="-"):(se=m(k).slice(2),fe=""),se=fe+se.slice(0,-1)+c[se.slice(-1)];else{if(wa(k)!=="object")throw new Error("Don't know what to do with value type "+wa(k)+".");se=_(k)}J.push(ie+se)}return J.push("}"),J.join("")},o=n.__fontmetrics__.uncompress=function(V){if(typeof V!="string")throw new Error("Invalid argument passed to uncompress.");for(var k,ie,se,fe,J={},ne=1,me=J,ue=[],ke="",je="",pe=V.length-1,U=1;U<pe;U+=1)(fe=V[U])=="'"?k?(se=k.join(""),k=void 0):k=[]:k?k.push(fe):fe=="{"?(ue.push([me,se]),me={},se=void 0):fe=="}"?((ie=ue.pop())[0][ie[1]]=me,se=void 0,me=ie[0]):fe=="-"?ne=-1:se===void 0?i.hasOwnProperty(fe)?(ke+=i[fe],se=parseInt(ke,16)*ne,ne=1,ke=""):ke+=fe:i.hasOwnProperty(fe)?(je+=i[fe],me[se]=parseInt(je,16)*ne,ne=1,se=void 0,je=""):je+=fe;return J},b={codePages:["WinAnsiEncoding"],WinAnsiEncoding:o("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},I={Unicode:{Courier:b,"Courier-Bold":b,"Courier-BoldOblique":b,"Courier-Oblique":b,Helvetica:b,"Helvetica-Bold":b,"Helvetica-BoldOblique":b,"Helvetica-Oblique":b,"Times-Roman":b,"Times-Bold":b,"Times-BoldItalic":b,"Times-Italic":b}},M={Unicode:{"Courier-Oblique":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":o("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":o("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":o("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:o("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:o("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":o("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:o("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":o("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":o("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":o("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};n.events.push(["addFont",function(V){var k=V.font,ie=M.Unicode[k.postScriptName];ie&&(k.metadata.Unicode={},k.metadata.Unicode.widths=ie.widths,k.metadata.Unicode.kerning=ie.kerning);var se=I.Unicode[k.postScriptName];se&&(k.metadata.Unicode.encoding=se,k.encoding=se.codePages[0])}])})(Si.API),(function(n){var e=function(t){for(var i=t.length,c=new Uint8Array(i),u=0;u<i;u++)c[u]=t.charCodeAt(u);return c};n.API.events.push(["addFont",function(t){var i=void 0,c=t.font,u=t.instance;if(!c.isStandardFont){if(u===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+c.postScriptName+"').");if(typeof(i=u.existsFileInVFS(c.postScriptName)===!1?u.loadFile(c.postScriptName):u.getFileFromVFS(c.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+c.postScriptName+"').");(function(m,_){_=/^\x00\x01\x00\x00/.test(_)?e(_):e(U1(_)),m.metadata=n.API.TTFFont.open(_),m.metadata.Unicode=m.metadata.Unicode||{encoding:{},kerning:{},widths:[]},m.metadata.glyIdsUsed=[0]})(c,i)}}])})(Si),Si.API.addSvgAsImage=function(n,e,t,i,c,u,m,_){if(isNaN(e)||isNaN(t))throw Ka.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(i)||isNaN(c))throw Ka.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var o=document.createElement("canvas");o.width=i,o.height=c;var b=o.getContext("2d");b.fillStyle="#fff",b.fillRect(0,0,o.width,o.height);var I={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},M=this;return(oo.canvg?Promise.resolve(oo.canvg):fb(()=>import("./index.es-CLp13mUJ.js"),[])).catch(function(V){return Promise.reject(new Error("Could not load canvg: "+V))}).then(function(V){return V.default?V.default:V}).then(function(V){return V.fromString(b,n,I)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(V){return V.render(I)}).then(function(){M.addImage(o.toDataURL("image/jpeg",1),e,t,i,c,m,_)})},Si.API.putTotalPages=function(n){var e,t=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(e=new RegExp(n,"g"),t=this.internal.getNumberOfPages()):(e=new RegExp(this.pdfEscape16(n,this.internal.getFont()),"g"),t=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var i=1;i<=this.internal.getNumberOfPages();i++)for(var c=0;c<this.internal.pages[i].length;c++)this.internal.pages[i][c]=this.internal.pages[i][c].replace(e,t);return this},Si.API.viewerPreferences=function(n,e){var t;n=n||{},e=e||!1;var i,c,u,m={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},_=Object.keys(m),o=[],b=0,I=0,M=0;function V(ie,se){var fe,J=!1;for(fe=0;fe<ie.length;fe+=1)ie[fe]===se&&(J=!0);return J}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(m)),this.internal.viewerpreferences.isSubscribed=!1),t=this.internal.viewerpreferences.configuration,n==="reset"||e===!0){var k=_.length;for(M=0;M<k;M+=1)t[_[M]].value=t[_[M]].defaultValue,t[_[M]].explicitSet=!1}if(wa(n)==="object"){for(c in n)if(u=n[c],V(_,c)&&u!==void 0){if(t[c].type==="boolean"&&typeof u=="boolean")t[c].value=u;else if(t[c].type==="name"&&V(t[c].valueSet,u))t[c].value=u;else if(t[c].type==="integer"&&Number.isInteger(u))t[c].value=u;else if(t[c].type==="array"){for(b=0;b<u.length;b+=1)if(i=!0,u[b].length===1&&typeof u[b][0]=="number")o.push(String(u[b]-1));else if(u[b].length>1){for(I=0;I<u[b].length;I+=1)typeof u[b][I]!="number"&&(i=!1);i===!0&&o.push([u[b][0]-1,u[b][1]-1].join(" "))}t[c].value="["+o.join(" ")+"]"}else t[c].value=t[c].defaultValue;t[c].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var ie,se=[];for(ie in t)t[ie].explicitSet===!0&&(t[ie].type==="name"?se.push("/"+ie+" /"+t[ie].value):se.push("/"+ie+" "+t[ie].value));se.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+se.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=t,this},(function(n){var e=function(){var i='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',c=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),u=unescape(encodeURIComponent(i)),m=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),_=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),o=unescape(encodeURIComponent("</x:xmpmeta>")),b=u.length+m.length+_.length+c.length+o.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+b+" >>"),this.internal.write("stream"),this.internal.write(c+u+m+_+o),this.internal.write("endstream"),this.internal.write("endobj")},t=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};n.addMetadata=function(i,c){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:i,namespaceuri:c||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",t),this.internal.events.subscribe("postPutResources",e)),this}})(Si.API),(function(n){var e=n.API,t=e.pdfEscape16=function(u,m){for(var _,o=m.metadata.Unicode.widths,b=["","0","00","000","0000"],I=[""],M=0,V=u.length;M<V;++M){if(_=m.metadata.characterToGlyph(u.charCodeAt(M)),m.metadata.glyIdsUsed.push(_),m.metadata.toUnicode[_]=u.charCodeAt(M),o.indexOf(_)==-1&&(o.push(_),o.push([parseInt(m.metadata.widthOfGlyph(_),10)])),_=="0")return I.join("");_=_.toString(16),I.push(b[4-_.length],_)}return I.join("")},i=function(u){var m,_,o,b,I,M,V;for(I=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,o=[],M=0,V=(_=Object.keys(u).sort(function(k,ie){return k-ie})).length;M<V;M++)m=_[M],o.length>=100&&(I+=`
`+o.length+` beginbfchar
`+o.join(`
`)+`
endbfchar`,o=[]),u[m]!==void 0&&u[m]!==null&&typeof u[m].toString=="function"&&(b=("0000"+u[m].toString(16)).slice(-4),m=("0000"+(+m).toString(16)).slice(-4),o.push("<"+m+"><"+b+">"));return o.length&&(I+=`
`+o.length+` beginbfchar
`+o.join(`
`)+`
endbfchar
`),I+`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};e.events.push(["putFont",function(u){(function(m){var _=m.font,o=m.out,b=m.newObject,I=m.putStream;if(_.metadata instanceof n.API.TTFFont&&_.encoding==="Identity-H"){for(var M=_.metadata.Unicode.widths,V=_.metadata.subset.encode(_.metadata.glyIdsUsed,1),k="",ie=0;ie<V.length;ie++)k+=String.fromCharCode(V[ie]);var se=b();I({data:k,addLength1:!0,objectId:se}),o("endobj");var fe=b();I({data:i(_.metadata.toUnicode),addLength1:!0,objectId:fe}),o("endobj");var J=b();o("<<"),o("/Type /FontDescriptor"),o("/FontName /"+t0(_.fontName)),o("/FontFile2 "+se+" 0 R"),o("/FontBBox "+n.API.PDFObject.convert(_.metadata.bbox)),o("/Flags "+_.metadata.flags),o("/StemV "+_.metadata.stemV),o("/ItalicAngle "+_.metadata.italicAngle),o("/Ascent "+_.metadata.ascender),o("/Descent "+_.metadata.decender),o("/CapHeight "+_.metadata.capHeight),o(">>"),o("endobj");var ne=b();o("<<"),o("/Type /Font"),o("/BaseFont /"+t0(_.fontName)),o("/FontDescriptor "+J+" 0 R"),o("/W "+n.API.PDFObject.convert(M)),o("/CIDToGIDMap /Identity"),o("/DW 1000"),o("/Subtype /CIDFontType2"),o("/CIDSystemInfo"),o("<<"),o("/Supplement 0"),o("/Registry (Adobe)"),o("/Ordering ("+_.encoding+")"),o(">>"),o(">>"),o("endobj"),_.objectNumber=b(),o("<<"),o("/Type /Font"),o("/Subtype /Type0"),o("/ToUnicode "+fe+" 0 R"),o("/BaseFont /"+t0(_.fontName)),o("/Encoding /"+_.encoding),o("/DescendantFonts ["+ne+" 0 R]"),o(">>"),o("endobj"),_.isAlreadyPutted=!0}})(u)}]),e.events.push(["putFont",function(u){(function(m){var _=m.font,o=m.out,b=m.newObject,I=m.putStream;if(_.metadata instanceof n.API.TTFFont&&_.encoding==="WinAnsiEncoding"){for(var M=_.metadata.rawData,V="",k=0;k<M.length;k++)V+=String.fromCharCode(M[k]);var ie=b();I({data:V,addLength1:!0,objectId:ie}),o("endobj");var se=b();I({data:i(_.metadata.toUnicode),addLength1:!0,objectId:se}),o("endobj");var fe=b();o("<<"),o("/Descent "+_.metadata.decender),o("/CapHeight "+_.metadata.capHeight),o("/StemV "+_.metadata.stemV),o("/Type /FontDescriptor"),o("/FontFile2 "+ie+" 0 R"),o("/Flags 96"),o("/FontBBox "+n.API.PDFObject.convert(_.metadata.bbox)),o("/FontName /"+t0(_.fontName)),o("/ItalicAngle "+_.metadata.italicAngle),o("/Ascent "+_.metadata.ascender),o(">>"),o("endobj"),_.objectNumber=b();for(var J=0;J<_.metadata.hmtx.widths.length;J++)_.metadata.hmtx.widths[J]=parseInt(_.metadata.hmtx.widths[J]*(1e3/_.metadata.head.unitsPerEm));o("<</Subtype/TrueType/Type/Font/ToUnicode "+se+" 0 R/BaseFont/"+t0(_.fontName)+"/FontDescriptor "+fe+" 0 R/Encoding/"+_.encoding+" /FirstChar 29 /LastChar 255 /Widths "+n.API.PDFObject.convert(_.metadata.hmtx.widths)+">>"),o("endobj"),_.isAlreadyPutted=!0}})(u)}]);var c=function(u){var m,_=u.text||"",o=u.x,b=u.y,I=u.options||{},M=u.mutex||{},V=M.pdfEscape,k=M.activeFontKey,ie=M.fonts,se=k,fe="",J=0,ne="",me=ie[se].encoding;if(ie[se].encoding!=="Identity-H")return{text:_,x:o,y:b,options:I,mutex:M};for(ne=_,se=k,Array.isArray(_)&&(ne=_[0]),J=0;J<ne.length;J+=1)ie[se].metadata.hasOwnProperty("cmap")&&(m=ie[se].metadata.cmap.unicode.codeMap[ne[J].charCodeAt(0)]),m||ne[J].charCodeAt(0)<256&&ie[se].metadata.hasOwnProperty("Unicode")?fe+=ne[J]:fe+="";var ue="";return parseInt(se.slice(1))<14||me==="WinAnsiEncoding"?ue=V(fe,se).split("").map(function(ke){return ke.charCodeAt(0).toString(16)}).join(""):me==="Identity-H"&&(ue=t(fe,ie[se])),M.isHex=!0,{text:ue,x:o,y:b,options:I,mutex:M}};e.events.push(["postProcessText",function(u){var m=u.text||"",_=[],o={text:m,x:u.x,y:u.y,options:u.options,mutex:u.mutex};if(Array.isArray(m)){var b=0;for(b=0;b<m.length;b+=1)Array.isArray(m[b])&&m[b].length===3?_.push([c(Object.assign({},o,{text:m[b][0]})).text,m[b][1],m[b][2]]):_.push(c(Object.assign({},o,{text:m[b]})).text);u.text=_}else u.text=c(Object.assign({},o,{text:m})).text}])})(Si),(function(n){var e=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};n.existsFileInVFS=function(t){return e.call(this),this.internal.vFS[t]!==void 0},n.addFileToVFS=function(t,i){return e.call(this),this.internal.vFS[t]=i,this},n.getFileFromVFS=function(t){return e.call(this),this.internal.vFS[t]!==void 0?this.internal.vFS[t]:null}})(Si.API),(function(n){n.__bidiEngine__=n.prototype.__bidiEngine__=function(i){var c,u,m,_,o,b,I,M=e,V=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],k=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],ie={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},se={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},fe=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],J=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),ne=!1,me=0;this.__bidiEngine__={};var ue=function(j){var H=j.charCodeAt(),Z=H>>8,be=se[Z];return be!==void 0?M[256*be+(255&H)]:Z===252||Z===253?"AL":J.test(Z)?"L":Z===8?"R":"N"},ke=function(j){for(var H,Z=0;Z<j.length;Z++){if((H=ue(j.charAt(Z)))==="L")return!1;if(H==="R")return!0}return!1},je=function(j,H,Z,be){var Re,Oe,Ne,we,Fe=H[be];switch(Fe){case"L":case"R":case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":ne=!1;break;case"N":case"AN":break;case"EN":ne&&(Fe="AN");break;case"AL":ne=!0,Fe="R";break;case"WS":case"BN":Fe="N";break;case"CS":be<1||be+1>=H.length||(Re=Z[be-1])!=="EN"&&Re!=="AN"||(Oe=H[be+1])!=="EN"&&Oe!=="AN"?Fe="N":ne&&(Oe="AN"),Fe=Oe===Re?Oe:"N";break;case"ES":Fe=(Re=be>0?Z[be-1]:"B")==="EN"&&be+1<H.length&&H[be+1]==="EN"?"EN":"N";break;case"ET":if(be>0&&Z[be-1]==="EN"){Fe="EN";break}if(ne){Fe="N";break}for(Ne=be+1,we=H.length;Ne<we&&H[Ne]==="ET";)Ne++;Fe=Ne<we&&H[Ne]==="EN"?"EN":"N";break;case"NSM":if(m&&!_){for(we=H.length,Ne=be+1;Ne<we&&H[Ne]==="NSM";)Ne++;if(Ne<we){var nt=j[be],xe=nt>=1425&&nt<=2303||nt===64286;if(Re=H[Ne],xe&&(Re==="R"||Re==="AL")){Fe="R";break}}}Fe=be<1||(Re=H[be-1])==="B"?"N":Z[be-1];break;case"B":ne=!1,c=!0,Fe=me;break;case"S":u=!0,Fe="N"}return Fe},pe=function(j,H,Z){var be=j.split("");return Z&&U(be,Z,{hiLevel:me}),be.reverse(),H&&H.reverse(),be.join("")},U=function(j,H,Z){var be,Re,Oe,Ne,we,Fe=-1,nt=j.length,xe=0,le=[],De=me?k:V,Be=[];for(ne=!1,c=!1,u=!1,Re=0;Re<nt;Re++)Be[Re]=ue(j[Re]);for(Oe=0;Oe<nt;Oe++){if(we=xe,le[Oe]=je(j,Be,le,Oe),be=240&(xe=De[we][ie[le[Oe]]]),xe&=15,H[Oe]=Ne=De[xe][5],be>0)if(be===16){for(Re=Fe;Re<Oe;Re++)H[Re]=1;Fe=-1}else Fe=-1;if(De[xe][6])Fe===-1&&(Fe=Oe);else if(Fe>-1){for(Re=Fe;Re<Oe;Re++)H[Re]=Ne;Fe=-1}Be[Oe]==="B"&&(H[Oe]=0),Z.hiLevel|=Ne}u&&(function(Ye,rt,mt){for(var ft=0;ft<mt;ft++)if(Ye[ft]==="S"){rt[ft]=me;for(var Dt=ft-1;Dt>=0&&Ye[Dt]==="WS";Dt--)rt[Dt]=me}})(Be,H,nt)},F=function(j,H,Z,be,Re){if(!(Re.hiLevel<j)){if(j===1&&me===1&&!c)return H.reverse(),void(Z&&Z.reverse());for(var Oe,Ne,we,Fe,nt=H.length,xe=0;xe<nt;){if(be[xe]>=j){for(we=xe+1;we<nt&&be[we]>=j;)we++;for(Fe=xe,Ne=we-1;Fe<Ne;Fe++,Ne--)Oe=H[Fe],H[Fe]=H[Ne],H[Ne]=Oe,Z&&(Oe=Z[Fe],Z[Fe]=Z[Ne],Z[Ne]=Oe);xe=we}xe++}}},q=function(j,H,Z){var be=j.split(""),Re={hiLevel:me};return Z||(Z=[]),U(be,Z,Re),(function(Oe,Ne,we){if(we.hiLevel!==0&&I)for(var Fe,nt=0;nt<Oe.length;nt++)Ne[nt]===1&&(Fe=fe.indexOf(Oe[nt]))>=0&&(Oe[nt]=fe[Fe+1])})(be,Z,Re),F(2,be,H,Z,Re),F(1,be,H,Z,Re),be.join("")};return this.__bidiEngine__.doBidiReorder=function(j,H,Z){if((function(Re,Oe){if(Oe)for(var Ne=0;Ne<Re.length;Ne++)Oe[Ne]=Ne;_===void 0&&(_=ke(Re)),b===void 0&&(b=ke(Re))})(j,H),m||!o||b)if(m&&o&&_^b)me=_?1:0,j=pe(j,H,Z);else if(!m&&o&&b)me=_?1:0,j=q(j,H,Z),j=pe(j,H);else if(!m||_||o||b){if(m&&!o&&_^b)j=pe(j,H),_?(me=0,j=q(j,H,Z)):(me=1,j=q(j,H,Z),j=pe(j,H));else if(m&&_&&!o&&b)me=1,j=q(j,H,Z),j=pe(j,H);else if(!m&&!o&&_^b){var be=I;_?(me=1,j=q(j,H,Z),me=0,I=!1,j=q(j,H,Z),I=be):(me=0,j=q(j,H,Z),j=pe(j,H),me=1,I=!1,j=q(j,H,Z),I=be,j=pe(j,H))}}else me=0,j=q(j,H,Z);else me=_?1:0,j=q(j,H,Z);return j},this.__bidiEngine__.setOptions=function(j){j&&(m=j.isInputVisual,o=j.isOutputVisual,_=j.isInputRtl,b=j.isOutputRtl,I=j.isSymmetricSwapping)},this.__bidiEngine__.setOptions(i),this.__bidiEngine__};var e=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],t=new n.__bidiEngine__({isInputVisual:!0});n.API.events.push(["postProcessText",function(i){var c=i.text;i.x,i.y;var u=i.options||{};i.mutex,u.lang;var m=[];if(u.isInputVisual=typeof u.isInputVisual!="boolean"||u.isInputVisual,t.setOptions(u),Object.prototype.toString.call(c)==="[object Array]"){var _=0;for(m=[],_=0;_<c.length;_+=1)Object.prototype.toString.call(c[_])==="[object Array]"?m.push([t.doBidiReorder(c[_][0]),c[_][1],c[_][2]]):m.push([t.doBidiReorder(c[_])]);i.text=m}else i.text=t.doBidiReorder(c);t.setOptions({isInputVisual:!0})}])})(Si),Si.API.TTFFont=(function(){function n(e){var t;if(this.rawData=e,t=this.contents=new dm(e),this.contents.pos=4,t.readString(4)==="ttcf")throw new Error("TTCF not supported.");t.pos=0,this.parse(),this.subset=new AM(this),this.registerTTF()}return n.open=function(e){return new n(e)},n.prototype.parse=function(){return this.directory=new hM(this.contents),this.head=new fM(this),this.name=new _M(this),this.cmap=new Z6(this),this.toUnicode={},this.hhea=new pM(this),this.maxp=new vM(this),this.hmtx=new xM(this),this.post=new gM(this),this.os2=new mM(this),this.loca=new EM(this),this.glyf=new bM(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},n.prototype.registerTTF=function(){var e,t,i,c,u;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var m,_,o,b;for(b=[],m=0,_=(o=this.bbox).length;m<_;m++)e=o[m],b.push(Math.round(e*this.scaleFactor));return b}).call(this),this.stemV=0,this.post.exists?(i=255&(c=this.post.italic_angle),32768&(t=c>>16)&&(t=-(1+(65535^t))),this.italicAngle=+(t+"."+i)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(u=this.familyClass)===1||u===2||u===3||u===4||u===5||u===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},n.prototype.characterToGlyph=function(e){var t;return((t=this.cmap.unicode)!=null?t.codeMap[e]:void 0)||0},n.prototype.widthOfGlyph=function(e){var t;return t=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(e).advance*t},n.prototype.widthOfString=function(e,t,i){var c,u,m,_;for(m=0,u=0,_=(e=""+e).length;0<=_?u<_:u>_;u=0<=_?++u:--u)c=e.charCodeAt(u),m+=this.widthOfGlyph(this.characterToGlyph(c))+i*(1e3/t)||0;return m*(t/1e3)},n.prototype.lineHeight=function(e,t){var i;return t==null&&(t=!1),i=t?this.lineGap:0,(this.ascender+i-this.decender)/1e3*e},n})();var lf,dm=(function(){function n(e){this.data=e??[],this.pos=0,this.length=this.data.length}return n.prototype.readByte=function(){return this.data[this.pos++]},n.prototype.writeByte=function(e){return this.data[this.pos++]=e},n.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},n.prototype.writeUInt32=function(e){return this.writeByte(e>>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e)},n.prototype.readInt32=function(){var e;return(e=this.readUInt32())>=2147483648?e-4294967296:e},n.prototype.writeInt32=function(e){return e<0&&(e+=4294967296),this.writeUInt32(e)},n.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},n.prototype.writeUInt16=function(e){return this.writeByte(e>>8&255),this.writeByte(255&e)},n.prototype.readInt16=function(){var e;return(e=this.readUInt16())>=32768?e-65536:e},n.prototype.writeInt16=function(e){return e<0&&(e+=65536),this.writeUInt16(e)},n.prototype.readString=function(e){var t,i;for(i=[],t=0;0<=e?t<e:t>e;t=0<=e?++t:--t)i[t]=String.fromCharCode(this.readByte());return i.join("")},n.prototype.writeString=function(e){var t,i,c;for(c=[],t=0,i=e.length;0<=i?t<i:t>i;t=0<=i?++t:--t)c.push(this.writeByte(e.charCodeAt(t)));return c},n.prototype.readShort=function(){return this.readInt16()},n.prototype.writeShort=function(e){return this.writeInt16(e)},n.prototype.readLongLong=function(){var e,t,i,c,u,m,_,o;return e=this.readByte(),t=this.readByte(),i=this.readByte(),c=this.readByte(),u=this.readByte(),m=this.readByte(),_=this.readByte(),o=this.readByte(),128&e?-1*(72057594037927940*(255^e)+281474976710656*(255^t)+1099511627776*(255^i)+4294967296*(255^c)+16777216*(255^u)+65536*(255^m)+256*(255^_)+(255^o)+1):72057594037927940*e+281474976710656*t+1099511627776*i+4294967296*c+16777216*u+65536*m+256*_+o},n.prototype.writeLongLong=function(e){var t,i;return t=Math.floor(e/4294967296),i=4294967295&e,this.writeByte(t>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t),this.writeByte(i>>24&255),this.writeByte(i>>16&255),this.writeByte(i>>8&255),this.writeByte(255&i)},n.prototype.readInt=function(){return this.readInt32()},n.prototype.writeInt=function(e){return this.writeInt32(e)},n.prototype.read=function(e){var t,i;for(t=[],i=0;0<=e?i<e:i>e;i=0<=e?++i:--i)t.push(this.readByte());return t},n.prototype.write=function(e){var t,i,c,u;for(u=[],i=0,c=e.length;i<c;i++)t=e[i],u.push(this.writeByte(t));return u},n})(),hM=(function(){var n;function e(t){var i,c,u;for(this.scalarType=t.readInt(),this.tableCount=t.readShort(),this.searchRange=t.readShort(),this.entrySelector=t.readShort(),this.rangeShift=t.readShort(),this.tables={},c=0,u=this.tableCount;0<=u?c<u:c>u;c=0<=u?++c:--c)i={tag:t.readString(4),checksum:t.readInt(),offset:t.readInt(),length:t.readInt()},this.tables[i.tag]=i}return e.prototype.encode=function(t){var i,c,u,m,_,o,b,I,M,V,k,ie,se;for(se in k=Object.keys(t).length,o=Math.log(2),M=16*Math.floor(Math.log(k)/o),m=Math.floor(M/o),I=16*k-M,(c=new dm).writeInt(this.scalarType),c.writeShort(k),c.writeShort(M),c.writeShort(m),c.writeShort(I),u=16*k,b=c.pos+u,_=null,ie=[],t)for(V=t[se],c.writeString(se),c.writeInt(n(V)),c.writeInt(b),c.writeInt(V.length),ie=ie.concat(V),se==="head"&&(_=b),b+=V.length;b%4;)ie.push(0),b++;return c.write(ie),i=2981146554-n(c.data),c.pos=_+8,c.writeUInt32(i),c.data},n=function(t){var i,c,u,m;for(t=Y6.call(t);t.length%4;)t.push(0);for(u=new dm(t),c=0,i=0,m=t.length;i<m;i=i+=4)c+=u.readUInt32();return 4294967295&c},e})(),dM={}.hasOwnProperty,Zf=function(n,e){for(var t in e)dM.call(e,t)&&(n[t]=e[t]);function i(){this.constructor=n}return i.prototype=e.prototype,n.prototype=new i,n.__super__=e.prototype,n};lf=(function(){function n(e){var t;this.file=e,t=this.file.directory.tables[this.tag],this.exists=!!t,t&&(this.offset=t.offset,this.length=t.length,this.parse(this.file.contents))}return n.prototype.parse=function(){},n.prototype.encode=function(){},n.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},n})();var fM=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Zf(n,lf),n.prototype.tag="head",n.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.revision=e.readInt(),this.checkSumAdjustment=e.readInt(),this.magicNumber=e.readInt(),this.flags=e.readShort(),this.unitsPerEm=e.readShort(),this.created=e.readLongLong(),this.modified=e.readLongLong(),this.xMin=e.readShort(),this.yMin=e.readShort(),this.xMax=e.readShort(),this.yMax=e.readShort(),this.macStyle=e.readShort(),this.lowestRecPPEM=e.readShort(),this.fontDirectionHint=e.readShort(),this.indexToLocFormat=e.readShort(),this.glyphDataFormat=e.readShort()},n.prototype.encode=function(e){var t;return(t=new dm).writeInt(this.version),t.writeInt(this.revision),t.writeInt(this.checkSumAdjustment),t.writeInt(this.magicNumber),t.writeShort(this.flags),t.writeShort(this.unitsPerEm),t.writeLongLong(this.created),t.writeLongLong(this.modified),t.writeShort(this.xMin),t.writeShort(this.yMin),t.writeShort(this.xMax),t.writeShort(this.yMax),t.writeShort(this.macStyle),t.writeShort(this.lowestRecPPEM),t.writeShort(this.fontDirectionHint),t.writeShort(e),t.writeShort(this.glyphDataFormat),t.data},n})(),WS=(function(){function n(e,t){var i,c,u,m,_,o,b,I,M,V,k,ie,se,fe,J,ne,me;switch(this.platformID=e.readUInt16(),this.encodingID=e.readShort(),this.offset=t+e.readInt(),M=e.pos,e.pos=this.offset,this.format=e.readUInt16(),this.length=e.readUInt16(),this.language=e.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(o=0;o<256;++o)this.codeMap[o]=e.readByte();break;case 4:for(k=e.readUInt16(),V=k/2,e.pos+=6,u=(function(){var ue,ke;for(ke=[],o=ue=0;0<=V?ue<V:ue>V;o=0<=V?++ue:--ue)ke.push(e.readUInt16());return ke})(),e.pos+=2,se=(function(){var ue,ke;for(ke=[],o=ue=0;0<=V?ue<V:ue>V;o=0<=V?++ue:--ue)ke.push(e.readUInt16());return ke})(),b=(function(){var ue,ke;for(ke=[],o=ue=0;0<=V?ue<V:ue>V;o=0<=V?++ue:--ue)ke.push(e.readUInt16());return ke})(),I=(function(){var ue,ke;for(ke=[],o=ue=0;0<=V?ue<V:ue>V;o=0<=V?++ue:--ue)ke.push(e.readUInt16());return ke})(),c=(this.length-e.pos+this.offset)/2,_=(function(){var ue,ke;for(ke=[],o=ue=0;0<=c?ue<c:ue>c;o=0<=c?++ue:--ue)ke.push(e.readUInt16());return ke})(),o=J=0,me=u.length;J<me;o=++J)for(fe=u[o],i=ne=ie=se[o];ie<=fe?ne<=fe:ne>=fe;i=ie<=fe?++ne:--ne)I[o]===0?m=i+b[o]:(m=_[I[o]/2+(i-ie)-(V-o)]||0)!==0&&(m+=b[o]),this.codeMap[i]=65535&m}e.pos=M}return n.encode=function(e,t){var i,c,u,m,_,o,b,I,M,V,k,ie,se,fe,J,ne,me,ue,ke,je,pe,U,F,q,j,H,Z,be,Re,Oe,Ne,we,Fe,nt,xe,le,De,Be,Ye,rt,mt,ft,Dt,Yt,cn,gn;switch(be=new dm,m=Object.keys(e).sort(function(Mn,Gt){return Mn-Gt}),t){case"macroman":for(se=0,fe=(function(){var Mn=[];for(ie=0;ie<256;++ie)Mn.push(0);return Mn})(),ne={0:0},u={},Re=0,Fe=m.length;Re<Fe;Re++)ne[Dt=e[c=m[Re]]]==null&&(ne[Dt]=++se),u[c]={old:e[c],new:ne[e[c]]},fe[c]=ne[e[c]];return be.writeUInt16(1),be.writeUInt16(0),be.writeUInt32(12),be.writeUInt16(0),be.writeUInt16(262),be.writeUInt16(0),be.write(fe),{charMap:u,subtable:be.data,maxGlyphID:se+1};case"unicode":for(H=[],M=[],me=0,ne={},i={},J=b=null,Oe=0,nt=m.length;Oe<nt;Oe++)ne[ke=e[c=m[Oe]]]==null&&(ne[ke]=++me),i[c]={old:ke,new:ne[ke]},_=ne[ke]-c,J!=null&&_===b||(J&&M.push(J),H.push(c),b=_),J=c;for(J&&M.push(J),M.push(65535),H.push(65535),q=2*(F=H.length),U=2*Math.pow(Math.log(F)/Math.LN2,2),V=Math.log(U/2)/Math.LN2,pe=2*F-U,o=[],je=[],k=[],ie=Ne=0,xe=H.length;Ne<xe;ie=++Ne){if(j=H[ie],I=M[ie],j===65535){o.push(0),je.push(0);break}if(j-(Z=i[j].new)>=32768)for(o.push(0),je.push(2*(k.length+F-ie)),c=we=j;j<=I?we<=I:we>=I;c=j<=I?++we:--we)k.push(i[c].new);else o.push(Z-j),je.push(0)}for(be.writeUInt16(3),be.writeUInt16(1),be.writeUInt32(12),be.writeUInt16(4),be.writeUInt16(16+8*F+2*k.length),be.writeUInt16(0),be.writeUInt16(q),be.writeUInt16(U),be.writeUInt16(V),be.writeUInt16(pe),mt=0,le=M.length;mt<le;mt++)c=M[mt],be.writeUInt16(c);for(be.writeUInt16(0),ft=0,De=H.length;ft<De;ft++)c=H[ft],be.writeUInt16(c);for(Yt=0,Be=o.length;Yt<Be;Yt++)_=o[Yt],be.writeUInt16(_);for(cn=0,Ye=je.length;cn<Ye;cn++)ue=je[cn],be.writeUInt16(ue);for(gn=0,rt=k.length;gn<rt;gn++)se=k[gn],be.writeUInt16(se);return{charMap:i,subtable:be.data,maxGlyphID:me+1}}},n})(),Z6=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Zf(n,lf),n.prototype.tag="cmap",n.prototype.parse=function(e){var t,i,c;for(e.pos=this.offset,this.version=e.readUInt16(),c=e.readUInt16(),this.tables=[],this.unicode=null,i=0;0<=c?i<c:i>c;i=0<=c?++i:--i)t=new WS(e,this.offset),this.tables.push(t),t.isUnicode&&this.unicode==null&&(this.unicode=t);return!0},n.encode=function(e,t){var i,c;return t==null&&(t="macroman"),i=WS.encode(e,t),(c=new dm).writeUInt16(0),c.writeUInt16(1),i.table=c.data.concat(i.subtable),i},n})(),pM=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Zf(n,lf),n.prototype.tag="hhea",n.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.ascender=e.readShort(),this.decender=e.readShort(),this.lineGap=e.readShort(),this.advanceWidthMax=e.readShort(),this.minLeftSideBearing=e.readShort(),this.minRightSideBearing=e.readShort(),this.xMaxExtent=e.readShort(),this.caretSlopeRise=e.readShort(),this.caretSlopeRun=e.readShort(),this.caretOffset=e.readShort(),e.pos+=8,this.metricDataFormat=e.readShort(),this.numberOfMetrics=e.readUInt16()},n})(),mM=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Zf(n,lf),n.prototype.tag="OS/2",n.prototype.parse=function(e){if(e.pos=this.offset,this.version=e.readUInt16(),this.averageCharWidth=e.readShort(),this.weightClass=e.readUInt16(),this.widthClass=e.readUInt16(),this.type=e.readShort(),this.ySubscriptXSize=e.readShort(),this.ySubscriptYSize=e.readShort(),this.ySubscriptXOffset=e.readShort(),this.ySubscriptYOffset=e.readShort(),this.ySuperscriptXSize=e.readShort(),this.ySuperscriptYSize=e.readShort(),this.ySuperscriptXOffset=e.readShort(),this.ySuperscriptYOffset=e.readShort(),this.yStrikeoutSize=e.readShort(),this.yStrikeoutPosition=e.readShort(),this.familyClass=e.readShort(),this.panose=(function(){var t,i;for(i=[],t=0;t<10;++t)i.push(e.readByte());return i})(),this.charRange=(function(){var t,i;for(i=[],t=0;t<4;++t)i.push(e.readInt());return i})(),this.vendorID=e.readString(4),this.selection=e.readShort(),this.firstCharIndex=e.readShort(),this.lastCharIndex=e.readShort(),this.version>0&&(this.ascent=e.readShort(),this.descent=e.readShort(),this.lineGap=e.readShort(),this.winAscent=e.readShort(),this.winDescent=e.readShort(),this.codePageRange=(function(){var t,i;for(i=[],t=0;t<2;t=++t)i.push(e.readInt());return i})(),this.version>1))return this.xHeight=e.readShort(),this.capHeight=e.readShort(),this.defaultChar=e.readShort(),this.breakChar=e.readShort(),this.maxContext=e.readShort()},n})(),gM=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Zf(n,lf),n.prototype.tag="post",n.prototype.parse=function(e){var t,i,c;switch(e.pos=this.offset,this.format=e.readInt(),this.italicAngle=e.readInt(),this.underlinePosition=e.readShort(),this.underlineThickness=e.readShort(),this.isFixedPitch=e.readInt(),this.minMemType42=e.readInt(),this.maxMemType42=e.readInt(),this.minMemType1=e.readInt(),this.maxMemType1=e.readInt(),this.format){case 65536:case 196608:break;case 131072:var u;for(i=e.readUInt16(),this.glyphNameIndex=[],u=0;0<=i?u<i:u>i;u=0<=i?++u:--u)this.glyphNameIndex.push(e.readUInt16());for(this.names=[],c=[];e.pos<this.offset+this.length;)t=e.readByte(),c.push(this.names.push(e.readString(t)));return c;case 151552:return i=e.readUInt16(),this.offsets=e.read(i);case 262144:return this.map=(function(){var m,_,o;for(o=[],u=m=0,_=this.file.maxp.numGlyphs;0<=_?m<_:m>_;u=0<=_?++m:--m)o.push(e.readUInt32());return o}).call(this)}},n})(),yM=function(n,e){this.raw=n,this.length=n.length,this.platformID=e.platformID,this.encodingID=e.encodingID,this.languageID=e.languageID},_M=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Zf(n,lf),n.prototype.tag="name",n.prototype.parse=function(e){var t,i,c,u,m,_,o,b,I,M,V;for(e.pos=this.offset,e.readShort(),t=e.readShort(),_=e.readShort(),i=[],u=0;0<=t?u<t:u>t;u=0<=t?++u:--u)i.push({platformID:e.readShort(),encodingID:e.readShort(),languageID:e.readShort(),nameID:e.readShort(),length:e.readShort(),offset:this.offset+_+e.readShort()});for(o={},u=I=0,M=i.length;I<M;u=++I)c=i[u],e.pos=c.offset,b=e.readString(c.length),m=new yM(b,c),o[V=c.nameID]==null&&(o[V]=[]),o[c.nameID].push(m);this.strings=o,this.copyright=o[0],this.fontFamily=o[1],this.fontSubfamily=o[2],this.uniqueSubfamily=o[3],this.fontName=o[4],this.version=o[5];try{this.postscriptName=o[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=o[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=o[7],this.manufacturer=o[8],this.designer=o[9],this.description=o[10],this.vendorUrl=o[11],this.designerUrl=o[12],this.license=o[13],this.licenseUrl=o[14],this.preferredFamily=o[15],this.preferredSubfamily=o[17],this.compatibleFull=o[18],this.sampleText=o[19]},n})(),vM=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Zf(n,lf),n.prototype.tag="maxp",n.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.numGlyphs=e.readUInt16(),this.maxPoints=e.readUInt16(),this.maxContours=e.readUInt16(),this.maxCompositePoints=e.readUInt16(),this.maxComponentContours=e.readUInt16(),this.maxZones=e.readUInt16(),this.maxTwilightPoints=e.readUInt16(),this.maxStorage=e.readUInt16(),this.maxFunctionDefs=e.readUInt16(),this.maxInstructionDefs=e.readUInt16(),this.maxStackElements=e.readUInt16(),this.maxSizeOfInstructions=e.readUInt16(),this.maxComponentElements=e.readUInt16(),this.maxComponentDepth=e.readUInt16()},n})(),xM=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Zf(n,lf),n.prototype.tag="hmtx",n.prototype.parse=function(e){var t,i,c,u,m,_,o;for(e.pos=this.offset,this.metrics=[],t=0,_=this.file.hhea.numberOfMetrics;0<=_?t<_:t>_;t=0<=_?++t:--t)this.metrics.push({advance:e.readUInt16(),lsb:e.readInt16()});for(c=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=(function(){var b,I;for(I=[],t=b=0;0<=c?b<c:b>c;t=0<=c?++b:--b)I.push(e.readInt16());return I})(),this.widths=(function(){var b,I,M,V;for(V=[],b=0,I=(M=this.metrics).length;b<I;b++)u=M[b],V.push(u.advance);return V}).call(this),i=this.widths[this.widths.length-1],o=[],t=m=0;0<=c?m<c:m>c;t=0<=c?++m:--m)o.push(this.widths.push(i));return o},n.prototype.forGlyph=function(e){return e in this.metrics?this.metrics[e]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[e-this.metrics.length]}},n})(),Y6=[].slice,bM=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Zf(n,lf),n.prototype.tag="glyf",n.prototype.parse=function(){return this.cache={}},n.prototype.glyphFor=function(e){var t,i,c,u,m,_,o,b,I,M;return e in this.cache?this.cache[e]:(u=this.file.loca,t=this.file.contents,i=u.indexOf(e),(c=u.lengthOf(e))===0?this.cache[e]=null:(t.pos=this.offset+i,m=(_=new dm(t.read(c))).readShort(),b=_.readShort(),M=_.readShort(),o=_.readShort(),I=_.readShort(),this.cache[e]=m===-1?new SM(_,b,M,o,I):new wM(_,m,b,M,o,I),this.cache[e]))},n.prototype.encode=function(e,t,i){var c,u,m,_,o;for(m=[],u=[],_=0,o=t.length;_<o;_++)c=e[t[_]],u.push(m.length),c&&(m=m.concat(c.encode(i)));return u.push(m.length),{table:m,offsets:u}},n})(),wM=(function(){function n(e,t,i,c,u,m){this.raw=e,this.numberOfContours=t,this.xMin=i,this.yMin=c,this.xMax=u,this.yMax=m,this.compound=!1}return n.prototype.encode=function(){return this.raw.data},n})(),SM=(function(){function n(e,t,i,c,u){var m,_;for(this.raw=e,this.xMin=t,this.yMin=i,this.xMax=c,this.yMax=u,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],m=this.raw;_=m.readShort(),this.glyphOffsets.push(m.pos),this.glyphIDs.push(m.readUInt16()),32&_;)m.pos+=1&_?4:2,128&_?m.pos+=8:64&_?m.pos+=4:8&_&&(m.pos+=2)}return n.prototype.encode=function(){var e,t,i;for(t=new dm(Y6.call(this.raw.data)),e=0,i=this.glyphIDs.length;e<i;++e)t.pos=this.glyphOffsets[e];return t.data},n})(),EM=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Zf(n,lf),n.prototype.tag="loca",n.prototype.parse=function(e){var t,i;return e.pos=this.offset,t=this.file.head.indexToLocFormat,this.offsets=t===0?(function(){var c,u;for(u=[],i=0,c=this.length;i<c;i+=2)u.push(2*e.readUInt16());return u}).call(this):(function(){var c,u;for(u=[],i=0,c=this.length;i<c;i+=4)u.push(e.readUInt32());return u}).call(this)},n.prototype.indexOf=function(e){return this.offsets[e]},n.prototype.lengthOf=function(e){return this.offsets[e+1]-this.offsets[e]},n.prototype.encode=function(e,t){for(var i=new Uint32Array(this.offsets.length),c=0,u=0,m=0;m<i.length;++m)if(i[m]=c,u<t.length&&t[u]==m){++u,i[m]=c;var _=this.offsets[m],o=this.offsets[m+1]-_;o>0&&(c+=o)}for(var b=new Array(4*i.length),I=0;I<i.length;++I)b[4*I+3]=255&i[I],b[4*I+2]=(65280&i[I])>>8,b[4*I+1]=(16711680&i[I])>>16,b[4*I]=(4278190080&i[I])>>24;return b},n})(),AM=(function(){function n(e){this.font=e,this.subset={},this.unicodes={},this.next=33}return n.prototype.generateCmap=function(){var e,t,i,c,u;for(t in c=this.font.cmap.tables[0].codeMap,e={},u=this.subset)i=u[t],e[t]=c[i];return e},n.prototype.glyphsFor=function(e){var t,i,c,u,m,_,o;for(c={},m=0,_=e.length;m<_;m++)c[u=e[m]]=this.font.glyf.glyphFor(u);for(u in t=[],c)(i=c[u])!=null&&i.compound&&t.push.apply(t,i.glyphIDs);if(t.length>0)for(u in o=this.glyphsFor(t))i=o[u],c[u]=i;return c},n.prototype.encode=function(e,t){var i,c,u,m,_,o,b,I,M,V,k,ie,se,fe,J;for(c in i=Z6.encode(this.generateCmap(),"unicode"),m=this.glyphsFor(e),k={0:0},J=i.charMap)k[(o=J[c]).old]=o.new;for(ie in V=i.maxGlyphID,m)ie in k||(k[ie]=V++);return I=(function(ne){var me,ue;for(me in ue={},ne)ue[ne[me]]=me;return ue})(k),M=Object.keys(I).sort(function(ne,me){return ne-me}),se=(function(){var ne,me,ue;for(ue=[],ne=0,me=M.length;ne<me;ne++)_=M[ne],ue.push(I[_]);return ue})(),u=this.font.glyf.encode(m,se,k),b=this.font.loca.encode(u.offsets,se),fe={cmap:this.font.cmap.raw(),glyf:u.table,loca:b,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(t)},this.font.os2.exists&&(fe["OS/2"]=this.font.os2.raw()),this.font.directory.encode(fe)},n})();Si.API.PDFObject=(function(){var n;function e(){}return n=function(t,i){return(Array(i+1).join("0")+t).slice(-i)},e.convert=function(t){var i,c,u,m;if(Array.isArray(t))return"["+(function(){var _,o,b;for(b=[],_=0,o=t.length;_<o;_++)i=t[_],b.push(e.convert(i));return b})().join(" ")+"]";if(typeof t=="string")return"/"+t;if(t?.isString)return"("+t+")";if(t instanceof Date)return"(D:"+n(t.getUTCFullYear(),4)+n(t.getUTCMonth(),2)+n(t.getUTCDate(),2)+n(t.getUTCHours(),2)+n(t.getUTCMinutes(),2)+n(t.getUTCSeconds(),2)+"Z)";if({}.toString.call(t)==="[object Object]"){for(c in u=["<<"],t)m=t[c],u.push("/"+c+" "+e.convert(m));return u.push(">>"),u.join(`
`)}return""+t},e})();var KS={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J6=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let c=n.charCodeAt(i);c<128?e[t++]=c:c<2048?(e[t++]=c>>6|192,e[t++]=c&63|128):(c&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(c=65536+((c&1023)<<10)+(n.charCodeAt(++i)&1023),e[t++]=c>>18|240,e[t++]=c>>12&63|128,e[t++]=c>>6&63|128,e[t++]=c&63|128):(e[t++]=c>>12|224,e[t++]=c>>6&63|128,e[t++]=c&63|128)}return e},TM=function(n){const e=[];let t=0,i=0;for(;t<n.length;){const c=n[t++];if(c<128)e[i++]=String.fromCharCode(c);else if(c>191&&c<224){const u=n[t++];e[i++]=String.fromCharCode((c&31)<<6|u&63)}else if(c>239&&c<365){const u=n[t++],m=n[t++],_=n[t++],o=((c&7)<<18|(u&63)<<12|(m&63)<<6|_&63)-65536;e[i++]=String.fromCharCode(55296+(o>>10)),e[i++]=String.fromCharCode(56320+(o&1023))}else{const u=n[t++],m=n[t++];e[i++]=String.fromCharCode((c&15)<<12|(u&63)<<6|m&63)}}return e.join("")},Q6={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let c=0;c<n.length;c+=3){const u=n[c],m=c+1<n.length,_=m?n[c+1]:0,o=c+2<n.length,b=o?n[c+2]:0,I=u>>2,M=(u&3)<<4|_>>4;let V=(_&15)<<2|b>>6,k=b&63;o||(k=64,m||(V=64)),i.push(t[I],t[M],t[V],t[k])}return i.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(J6(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):TM(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let c=0;c<n.length;){const u=t[n.charAt(c++)],_=c<n.length?t[n.charAt(c)]:0;++c;const b=c<n.length?t[n.charAt(c)]:64;++c;const M=c<n.length?t[n.charAt(c)]:64;if(++c,u==null||_==null||b==null||M==null)throw new IM;const V=u<<2|_>>4;if(i.push(V),b!==64){const k=_<<4&240|b>>2;if(i.push(k),M!==64){const ie=b<<6&192|M;i.push(ie)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class IM extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const CM=function(n){const e=J6(n);return Q6.encodeByteArray(e,!0)},yv=function(n){return CM(n).replace(/\./g,"")},e9=function(n){try{return Q6.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LM(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PM=()=>LM().__FIREBASE_DEFAULTS__,kM=()=>{if(typeof process>"u"||typeof KS>"u")return;const n=KS.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},RM=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&e9(n[1]);return e&&JSON.parse(e)},tx=()=>{try{return PM()||kM()||RM()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},t9=n=>{var e,t;return(t=(e=tx())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},MM=n=>{const e=t9(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),i]:[e.substring(0,t),i]},n9=()=>{var n;return(n=tx())===null||n===void 0?void 0:n.config},r9=n=>{var e;return(e=tx())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NM{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,i))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DM(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},i=e||"demo-project",c=n.iat||0,u=n.sub||n.user_id;if(!u)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const m=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:c,exp:c+3600,auth_time:c,sub:u,user_id:u,firebase:{sign_in_provider:"custom",identities:{}}},n);return[yv(JSON.stringify(t)),yv(JSON.stringify(m)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Th(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function FM(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Th())}function OM(){var n;const e=(n=tx())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function BM(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function zM(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function jM(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function UM(){const n=Th();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function VM(){return!OM()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function qM(){try{return typeof indexedDB=="object"}catch{return!1}}function $M(){return new Promise((n,e)=>{try{let t=!0;const i="validate-browser-context-for-indexeddb-analytics-module",c=self.indexedDB.open(i);c.onsuccess=()=>{c.result.close(),t||self.indexedDB.deleteDatabase(i),n(!0)},c.onupgradeneeded=()=>{t=!1},c.onerror=()=>{var u;e(((u=c.error)===null||u===void 0?void 0:u.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GM="FirebaseError";class Pp extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name=GM,Object.setPrototypeOf(this,Pp.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,w_.prototype.create)}}class w_{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){const i=t[0]||{},c=`${this.service}/${e}`,u=this.errors[e],m=u?HM(u,i):"Error",_=`${this.serviceName}: ${m} (${c}).`;return new Pp(c,_,i)}}function HM(n,e){return n.replace(WM,(t,i)=>{const c=e[i];return c!=null?String(c):`<${i}?>`})}const WM=/\{\$([^}]+)}/g;function KM(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function _v(n,e){if(n===e)return!0;const t=Object.keys(n),i=Object.keys(e);for(const c of t){if(!i.includes(c))return!1;const u=n[c],m=e[c];if(XS(u)&&XS(m)){if(!_v(u,m))return!1}else if(u!==m)return!1}for(const c of i)if(!t.includes(c))return!1;return!0}function XS(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S_(n){const e=[];for(const[t,i]of Object.entries(n))Array.isArray(i)?i.forEach(c=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(c))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}function XM(n,e){const t=new ZM(n,e);return t.subscribe.bind(t)}class ZM{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(i=>{this.error(i)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,i){let c;if(e===void 0&&t===void 0&&i===void 0)throw new Error("Missing Observer.");YM(e,["next","error","complete"])?c=e:c={next:e,error:t,complete:i},c.next===void 0&&(c.next=Db),c.error===void 0&&(c.error=Db),c.complete===void 0&&(c.complete=Db);const u=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?c.error(this.finalError):c.complete()}catch{}}),this.observers.push(c),u}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function YM(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Db(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bh(n){return n&&n._delegate?n._delegate:n}class rg{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gm="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JM{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const i=new NM;if(this.instancesDeferred.set(t,i),this.isInitialized(t)||this.shouldAutoInitialize())try{const c=this.getOrInitializeService({instanceIdentifier:t});c&&i.resolve(c)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const i=this.normalizeInstanceIdentifier(e?.identifier),c=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(u){if(c)return null;throw u}else{if(c)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(eN(e))try{this.getOrInitializeService({instanceIdentifier:Gm})}catch{}for(const[t,i]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(t);try{const u=this.getOrInitializeService({instanceIdentifier:c});i.resolve(u)}catch{}}}}clearInstance(e=Gm){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Gm){return this.instances.has(e)}getOptions(e=Gm){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const c=this.getOrInitializeService({instanceIdentifier:i,options:t});for(const[u,m]of this.instancesDeferred.entries()){const _=this.normalizeInstanceIdentifier(u);i===_&&m.resolve(c)}return c}onInit(e,t){var i;const c=this.normalizeInstanceIdentifier(t),u=(i=this.onInitCallbacks.get(c))!==null&&i!==void 0?i:new Set;u.add(e),this.onInitCallbacks.set(c,u);const m=this.instances.get(c);return m&&e(m,c),()=>{u.delete(e)}}invokeOnInitCallbacks(e,t){const i=this.onInitCallbacks.get(t);if(i)for(const c of i)try{c(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:QM(e),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=Gm){return this.component?this.component.multipleInstances?e:Gm:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function QM(n){return n===Gm?void 0:n}function eN(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tN{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new JM(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var gs;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(gs||(gs={}));const nN={debug:gs.DEBUG,verbose:gs.VERBOSE,info:gs.INFO,warn:gs.WARN,error:gs.ERROR,silent:gs.SILENT},rN=gs.INFO,iN={[gs.DEBUG]:"log",[gs.VERBOSE]:"log",[gs.INFO]:"info",[gs.WARN]:"warn",[gs.ERROR]:"error"},oN=(n,e,...t)=>{if(e<n.logLevel)return;const i=new Date().toISOString(),c=iN[e];if(c)console[c](`[${i}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Aw{constructor(e){this.name=e,this._logLevel=rN,this._logHandler=oN,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in gs))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?nN[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,gs.DEBUG,...e),this._logHandler(this,gs.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,gs.VERBOSE,...e),this._logHandler(this,gs.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,gs.INFO,...e),this._logHandler(this,gs.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,gs.WARN,...e),this._logHandler(this,gs.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,gs.ERROR,...e),this._logHandler(this,gs.ERROR,...e)}}const sN=(n,e)=>e.some(t=>n instanceof t);let ZS,YS;function aN(){return ZS||(ZS=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function lN(){return YS||(YS=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const i9=new WeakMap,I5=new WeakMap,o9=new WeakMap,Fb=new WeakMap,Tw=new WeakMap;function cN(n){const e=new Promise((t,i)=>{const c=()=>{n.removeEventListener("success",u),n.removeEventListener("error",m)},u=()=>{t(om(n.result)),c()},m=()=>{i(n.error),c()};n.addEventListener("success",u),n.addEventListener("error",m)});return e.then(t=>{t instanceof IDBCursor&&i9.set(t,n)}).catch(()=>{}),Tw.set(e,n),e}function uN(n){if(I5.has(n))return;const e=new Promise((t,i)=>{const c=()=>{n.removeEventListener("complete",u),n.removeEventListener("error",m),n.removeEventListener("abort",m)},u=()=>{t(),c()},m=()=>{i(n.error||new DOMException("AbortError","AbortError")),c()};n.addEventListener("complete",u),n.addEventListener("error",m),n.addEventListener("abort",m)});I5.set(n,e)}let C5={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return I5.get(n);if(e==="objectStoreNames")return n.objectStoreNames||o9.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return om(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function hN(n){C5=n(C5)}function dN(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const i=n.call(Ob(this),e,...t);return o9.set(i,e.sort?e.sort():[e]),om(i)}:lN().includes(n)?function(...e){return n.apply(Ob(this),e),om(i9.get(this))}:function(...e){return om(n.apply(Ob(this),e))}}function fN(n){return typeof n=="function"?dN(n):(n instanceof IDBTransaction&&uN(n),sN(n,aN())?new Proxy(n,C5):n)}function om(n){if(n instanceof IDBRequest)return cN(n);if(Fb.has(n))return Fb.get(n);const e=fN(n);return e!==n&&(Fb.set(n,e),Tw.set(e,n)),e}const Ob=n=>Tw.get(n);function pN(n,e,{blocked:t,upgrade:i,blocking:c,terminated:u}={}){const m=indexedDB.open(n,e),_=om(m);return i&&m.addEventListener("upgradeneeded",o=>{i(om(m.result),o.oldVersion,o.newVersion,om(m.transaction),o)}),t&&m.addEventListener("blocked",o=>t(o.oldVersion,o.newVersion,o)),_.then(o=>{u&&o.addEventListener("close",()=>u()),c&&o.addEventListener("versionchange",b=>c(b.oldVersion,b.newVersion,b))}).catch(()=>{}),_}const mN=["get","getKey","getAll","getAllKeys","count"],gN=["put","add","delete","clear"],Bb=new Map;function JS(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Bb.get(e))return Bb.get(e);const t=e.replace(/FromIndex$/,""),i=e!==t,c=gN.includes(t);if(!(t in(i?IDBIndex:IDBObjectStore).prototype)||!(c||mN.includes(t)))return;const u=async function(m,..._){const o=this.transaction(m,c?"readwrite":"readonly");let b=o.store;return i&&(b=b.index(_.shift())),(await Promise.all([b[t](..._),c&&o.done]))[0]};return Bb.set(e,u),u}hN(n=>({...n,get:(e,t,i)=>JS(e,t)||n.get(e,t,i),has:(e,t)=>!!JS(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yN{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(_N(t)){const i=t.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(t=>t).join(" ")}}function _N(n){const e=n.getComponent();return e?.type==="VERSION"}const L5="@firebase/app",QS="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ap=new Aw("@firebase/app"),vN="@firebase/app-compat",xN="@firebase/analytics-compat",bN="@firebase/analytics",wN="@firebase/app-check-compat",SN="@firebase/app-check",EN="@firebase/auth",AN="@firebase/auth-compat",TN="@firebase/database",IN="@firebase/data-connect",CN="@firebase/database-compat",LN="@firebase/functions",PN="@firebase/functions-compat",kN="@firebase/installations",RN="@firebase/installations-compat",MN="@firebase/messaging",NN="@firebase/messaging-compat",DN="@firebase/performance",FN="@firebase/performance-compat",ON="@firebase/remote-config",BN="@firebase/remote-config-compat",zN="@firebase/storage",jN="@firebase/storage-compat",UN="@firebase/firestore",VN="@firebase/vertexai-preview",qN="@firebase/firestore-compat",$N="firebase",GN="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P5="[DEFAULT]",HN={[L5]:"fire-core",[vN]:"fire-core-compat",[bN]:"fire-analytics",[xN]:"fire-analytics-compat",[SN]:"fire-app-check",[wN]:"fire-app-check-compat",[EN]:"fire-auth",[AN]:"fire-auth-compat",[TN]:"fire-rtdb",[IN]:"fire-data-connect",[CN]:"fire-rtdb-compat",[LN]:"fire-fn",[PN]:"fire-fn-compat",[kN]:"fire-iid",[RN]:"fire-iid-compat",[MN]:"fire-fcm",[NN]:"fire-fcm-compat",[DN]:"fire-perf",[FN]:"fire-perf-compat",[ON]:"fire-rc",[BN]:"fire-rc-compat",[zN]:"fire-gcs",[jN]:"fire-gcs-compat",[UN]:"fire-fst",[qN]:"fire-fst-compat",[VN]:"fire-vertex","fire-js":"fire-js",[$N]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vv=new Map,WN=new Map,k5=new Map;function eE(n,e){try{n.container.addComponent(e)}catch(t){Ap.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function w0(n){const e=n.name;if(k5.has(e))return Ap.debug(`There were multiple attempts to register component ${e}.`),!1;k5.set(e,n);for(const t of vv.values())eE(t,n);for(const t of WN.values())eE(t,n);return!0}function Iw(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Ff(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KN={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},sm=new w_("app","Firebase",KN);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XN{constructor(e,t,i){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new rg("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw sm.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F0=GN;function s9(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const i=Object.assign({name:P5,automaticDataCollectionEnabled:!1},e),c=i.name;if(typeof c!="string"||!c)throw sm.create("bad-app-name",{appName:String(c)});if(t||(t=n9()),!t)throw sm.create("no-options");const u=vv.get(c);if(u){if(_v(t,u.options)&&_v(i,u.config))return u;throw sm.create("duplicate-app",{appName:c})}const m=new tN(c);for(const o of k5.values())m.addComponent(o);const _=new XN(t,i,m);return vv.set(c,_),_}function a9(n=P5){const e=vv.get(n);if(!e&&n===P5&&n9())return s9();if(!e)throw sm.create("no-app",{appName:n});return e}function am(n,e,t){var i;let c=(i=HN[n])!==null&&i!==void 0?i:n;t&&(c+=`-${t}`);const u=c.match(/\s|\//),m=e.match(/\s|\//);if(u||m){const _=[`Unable to register library "${c}" with version "${e}":`];u&&_.push(`library name "${c}" contains illegal characters (whitespace or "/")`),u&&m&&_.push("and"),m&&_.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ap.warn(_.join(" "));return}w0(new rg(`${c}-version`,()=>({library:c,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZN="firebase-heartbeat-database",YN=1,s_="firebase-heartbeat-store";let zb=null;function l9(){return zb||(zb=pN(ZN,YN,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(s_)}catch(t){console.warn(t)}}}}).catch(n=>{throw sm.create("idb-open",{originalErrorMessage:n.message})})),zb}async function JN(n){try{const t=(await l9()).transaction(s_),i=await t.objectStore(s_).get(c9(n));return await t.done,i}catch(e){if(e instanceof Pp)Ap.warn(e.message);else{const t=sm.create("idb-get",{originalErrorMessage:e?.message});Ap.warn(t.message)}}}async function tE(n,e){try{const i=(await l9()).transaction(s_,"readwrite");await i.objectStore(s_).put(e,c9(n)),await i.done}catch(t){if(t instanceof Pp)Ap.warn(t.message);else{const i=sm.create("idb-set",{originalErrorMessage:t?.message});Ap.warn(i.message)}}}function c9(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QN=1024,eD=720*60*60*1e3;class tD{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new rD(t),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){var e,t;try{const c=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),u=nE();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===u||this._heartbeatsCache.heartbeats.some(m=>m.date===u)?void 0:(this._heartbeatsCache.heartbeats.push({date:u,agent:c}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(m=>{const _=new Date(m.date).valueOf();return Date.now()-_<=eD}),this._storage.overwrite(this._heartbeatsCache))}catch(i){Ap.warn(i)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=nE(),{heartbeatsToSend:i,unsentEntries:c}=nD(this._heartbeatsCache.heartbeats),u=yv(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=t,c.length>0?(this._heartbeatsCache.heartbeats=c,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),u}catch(t){return Ap.warn(t),""}}}function nE(){return new Date().toISOString().substring(0,10)}function nD(n,e=QN){const t=[];let i=n.slice();for(const c of n){const u=t.find(m=>m.agent===c.agent);if(u){if(u.dates.push(c.date),rE(t)>e){u.dates.pop();break}}else if(t.push({agent:c.agent,dates:[c.date]}),rE(t)>e){t.pop();break}i=i.slice(1)}return{heartbeatsToSend:t,unsentEntries:i}}class rD{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return qM()?$M().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await JN(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const c=await this.read();return tE(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:c.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const c=await this.read();return tE(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:c.lastSentHeartbeatDate,heartbeats:[...c.heartbeats,...e.heartbeats]})}else return}}function rE(n){return yv(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iD(n){w0(new rg("platform-logger",e=>new yN(e),"PRIVATE")),w0(new rg("heartbeat",e=>new tD(e),"PRIVATE")),am(L5,QS,n),am(L5,QS,"esm2017"),am("fire-js","")}iD("");var oD="firebase",sD="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */am(oD,sD,"app");var iE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var eg,u9;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(pe,U){function F(){}F.prototype=U.prototype,pe.D=U.prototype,pe.prototype=new F,pe.prototype.constructor=pe,pe.C=function(q,j,H){for(var Z=Array(arguments.length-2),be=2;be<arguments.length;be++)Z[be-2]=arguments[be];return U.prototype[j].apply(q,Z)}}function t(){this.blockSize=-1}function i(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(i,t),i.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function c(pe,U,F){F||(F=0);var q=Array(16);if(typeof U=="string")for(var j=0;16>j;++j)q[j]=U.charCodeAt(F++)|U.charCodeAt(F++)<<8|U.charCodeAt(F++)<<16|U.charCodeAt(F++)<<24;else for(j=0;16>j;++j)q[j]=U[F++]|U[F++]<<8|U[F++]<<16|U[F++]<<24;U=pe.g[0],F=pe.g[1],j=pe.g[2];var H=pe.g[3],Z=U+(H^F&(j^H))+q[0]+3614090360&4294967295;U=F+(Z<<7&4294967295|Z>>>25),Z=H+(j^U&(F^j))+q[1]+3905402710&4294967295,H=U+(Z<<12&4294967295|Z>>>20),Z=j+(F^H&(U^F))+q[2]+606105819&4294967295,j=H+(Z<<17&4294967295|Z>>>15),Z=F+(U^j&(H^U))+q[3]+3250441966&4294967295,F=j+(Z<<22&4294967295|Z>>>10),Z=U+(H^F&(j^H))+q[4]+4118548399&4294967295,U=F+(Z<<7&4294967295|Z>>>25),Z=H+(j^U&(F^j))+q[5]+1200080426&4294967295,H=U+(Z<<12&4294967295|Z>>>20),Z=j+(F^H&(U^F))+q[6]+2821735955&4294967295,j=H+(Z<<17&4294967295|Z>>>15),Z=F+(U^j&(H^U))+q[7]+4249261313&4294967295,F=j+(Z<<22&4294967295|Z>>>10),Z=U+(H^F&(j^H))+q[8]+1770035416&4294967295,U=F+(Z<<7&4294967295|Z>>>25),Z=H+(j^U&(F^j))+q[9]+2336552879&4294967295,H=U+(Z<<12&4294967295|Z>>>20),Z=j+(F^H&(U^F))+q[10]+4294925233&4294967295,j=H+(Z<<17&4294967295|Z>>>15),Z=F+(U^j&(H^U))+q[11]+2304563134&4294967295,F=j+(Z<<22&4294967295|Z>>>10),Z=U+(H^F&(j^H))+q[12]+1804603682&4294967295,U=F+(Z<<7&4294967295|Z>>>25),Z=H+(j^U&(F^j))+q[13]+4254626195&4294967295,H=U+(Z<<12&4294967295|Z>>>20),Z=j+(F^H&(U^F))+q[14]+2792965006&4294967295,j=H+(Z<<17&4294967295|Z>>>15),Z=F+(U^j&(H^U))+q[15]+1236535329&4294967295,F=j+(Z<<22&4294967295|Z>>>10),Z=U+(j^H&(F^j))+q[1]+4129170786&4294967295,U=F+(Z<<5&4294967295|Z>>>27),Z=H+(F^j&(U^F))+q[6]+3225465664&4294967295,H=U+(Z<<9&4294967295|Z>>>23),Z=j+(U^F&(H^U))+q[11]+643717713&4294967295,j=H+(Z<<14&4294967295|Z>>>18),Z=F+(H^U&(j^H))+q[0]+3921069994&4294967295,F=j+(Z<<20&4294967295|Z>>>12),Z=U+(j^H&(F^j))+q[5]+3593408605&4294967295,U=F+(Z<<5&4294967295|Z>>>27),Z=H+(F^j&(U^F))+q[10]+38016083&4294967295,H=U+(Z<<9&4294967295|Z>>>23),Z=j+(U^F&(H^U))+q[15]+3634488961&4294967295,j=H+(Z<<14&4294967295|Z>>>18),Z=F+(H^U&(j^H))+q[4]+3889429448&4294967295,F=j+(Z<<20&4294967295|Z>>>12),Z=U+(j^H&(F^j))+q[9]+568446438&4294967295,U=F+(Z<<5&4294967295|Z>>>27),Z=H+(F^j&(U^F))+q[14]+3275163606&4294967295,H=U+(Z<<9&4294967295|Z>>>23),Z=j+(U^F&(H^U))+q[3]+4107603335&4294967295,j=H+(Z<<14&4294967295|Z>>>18),Z=F+(H^U&(j^H))+q[8]+1163531501&4294967295,F=j+(Z<<20&4294967295|Z>>>12),Z=U+(j^H&(F^j))+q[13]+2850285829&4294967295,U=F+(Z<<5&4294967295|Z>>>27),Z=H+(F^j&(U^F))+q[2]+4243563512&4294967295,H=U+(Z<<9&4294967295|Z>>>23),Z=j+(U^F&(H^U))+q[7]+1735328473&4294967295,j=H+(Z<<14&4294967295|Z>>>18),Z=F+(H^U&(j^H))+q[12]+2368359562&4294967295,F=j+(Z<<20&4294967295|Z>>>12),Z=U+(F^j^H)+q[5]+4294588738&4294967295,U=F+(Z<<4&4294967295|Z>>>28),Z=H+(U^F^j)+q[8]+2272392833&4294967295,H=U+(Z<<11&4294967295|Z>>>21),Z=j+(H^U^F)+q[11]+1839030562&4294967295,j=H+(Z<<16&4294967295|Z>>>16),Z=F+(j^H^U)+q[14]+4259657740&4294967295,F=j+(Z<<23&4294967295|Z>>>9),Z=U+(F^j^H)+q[1]+2763975236&4294967295,U=F+(Z<<4&4294967295|Z>>>28),Z=H+(U^F^j)+q[4]+1272893353&4294967295,H=U+(Z<<11&4294967295|Z>>>21),Z=j+(H^U^F)+q[7]+4139469664&4294967295,j=H+(Z<<16&4294967295|Z>>>16),Z=F+(j^H^U)+q[10]+3200236656&4294967295,F=j+(Z<<23&4294967295|Z>>>9),Z=U+(F^j^H)+q[13]+681279174&4294967295,U=F+(Z<<4&4294967295|Z>>>28),Z=H+(U^F^j)+q[0]+3936430074&4294967295,H=U+(Z<<11&4294967295|Z>>>21),Z=j+(H^U^F)+q[3]+3572445317&4294967295,j=H+(Z<<16&4294967295|Z>>>16),Z=F+(j^H^U)+q[6]+76029189&4294967295,F=j+(Z<<23&4294967295|Z>>>9),Z=U+(F^j^H)+q[9]+3654602809&4294967295,U=F+(Z<<4&4294967295|Z>>>28),Z=H+(U^F^j)+q[12]+3873151461&4294967295,H=U+(Z<<11&4294967295|Z>>>21),Z=j+(H^U^F)+q[15]+530742520&4294967295,j=H+(Z<<16&4294967295|Z>>>16),Z=F+(j^H^U)+q[2]+3299628645&4294967295,F=j+(Z<<23&4294967295|Z>>>9),Z=U+(j^(F|~H))+q[0]+4096336452&4294967295,U=F+(Z<<6&4294967295|Z>>>26),Z=H+(F^(U|~j))+q[7]+1126891415&4294967295,H=U+(Z<<10&4294967295|Z>>>22),Z=j+(U^(H|~F))+q[14]+2878612391&4294967295,j=H+(Z<<15&4294967295|Z>>>17),Z=F+(H^(j|~U))+q[5]+4237533241&4294967295,F=j+(Z<<21&4294967295|Z>>>11),Z=U+(j^(F|~H))+q[12]+1700485571&4294967295,U=F+(Z<<6&4294967295|Z>>>26),Z=H+(F^(U|~j))+q[3]+2399980690&4294967295,H=U+(Z<<10&4294967295|Z>>>22),Z=j+(U^(H|~F))+q[10]+4293915773&4294967295,j=H+(Z<<15&4294967295|Z>>>17),Z=F+(H^(j|~U))+q[1]+2240044497&4294967295,F=j+(Z<<21&4294967295|Z>>>11),Z=U+(j^(F|~H))+q[8]+1873313359&4294967295,U=F+(Z<<6&4294967295|Z>>>26),Z=H+(F^(U|~j))+q[15]+4264355552&4294967295,H=U+(Z<<10&4294967295|Z>>>22),Z=j+(U^(H|~F))+q[6]+2734768916&4294967295,j=H+(Z<<15&4294967295|Z>>>17),Z=F+(H^(j|~U))+q[13]+1309151649&4294967295,F=j+(Z<<21&4294967295|Z>>>11),Z=U+(j^(F|~H))+q[4]+4149444226&4294967295,U=F+(Z<<6&4294967295|Z>>>26),Z=H+(F^(U|~j))+q[11]+3174756917&4294967295,H=U+(Z<<10&4294967295|Z>>>22),Z=j+(U^(H|~F))+q[2]+718787259&4294967295,j=H+(Z<<15&4294967295|Z>>>17),Z=F+(H^(j|~U))+q[9]+3951481745&4294967295,pe.g[0]=pe.g[0]+U&4294967295,pe.g[1]=pe.g[1]+(j+(Z<<21&4294967295|Z>>>11))&4294967295,pe.g[2]=pe.g[2]+j&4294967295,pe.g[3]=pe.g[3]+H&4294967295}i.prototype.u=function(pe,U){U===void 0&&(U=pe.length);for(var F=U-this.blockSize,q=this.B,j=this.h,H=0;H<U;){if(j==0)for(;H<=F;)c(this,pe,H),H+=this.blockSize;if(typeof pe=="string"){for(;H<U;)if(q[j++]=pe.charCodeAt(H++),j==this.blockSize){c(this,q),j=0;break}}else for(;H<U;)if(q[j++]=pe[H++],j==this.blockSize){c(this,q),j=0;break}}this.h=j,this.o+=U},i.prototype.v=function(){var pe=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);pe[0]=128;for(var U=1;U<pe.length-8;++U)pe[U]=0;var F=8*this.o;for(U=pe.length-8;U<pe.length;++U)pe[U]=F&255,F/=256;for(this.u(pe),pe=Array(16),U=F=0;4>U;++U)for(var q=0;32>q;q+=8)pe[F++]=this.g[U]>>>q&255;return pe};function u(pe,U){var F=_;return Object.prototype.hasOwnProperty.call(F,pe)?F[pe]:F[pe]=U(pe)}function m(pe,U){this.h=U;for(var F=[],q=!0,j=pe.length-1;0<=j;j--){var H=pe[j]|0;q&&H==U||(F[j]=H,q=!1)}this.g=F}var _={};function o(pe){return-128<=pe&&128>pe?u(pe,function(U){return new m([U|0],0>U?-1:0)}):new m([pe|0],0>pe?-1:0)}function b(pe){if(isNaN(pe)||!isFinite(pe))return M;if(0>pe)return fe(b(-pe));for(var U=[],F=1,q=0;pe>=F;q++)U[q]=pe/F|0,F*=4294967296;return new m(U,0)}function I(pe,U){if(pe.length==0)throw Error("number format error: empty string");if(U=U||10,2>U||36<U)throw Error("radix out of range: "+U);if(pe.charAt(0)=="-")return fe(I(pe.substring(1),U));if(0<=pe.indexOf("-"))throw Error('number format error: interior "-" character');for(var F=b(Math.pow(U,8)),q=M,j=0;j<pe.length;j+=8){var H=Math.min(8,pe.length-j),Z=parseInt(pe.substring(j,j+H),U);8>H?(H=b(Math.pow(U,H)),q=q.j(H).add(b(Z))):(q=q.j(F),q=q.add(b(Z)))}return q}var M=o(0),V=o(1),k=o(16777216);n=m.prototype,n.m=function(){if(se(this))return-fe(this).m();for(var pe=0,U=1,F=0;F<this.g.length;F++){var q=this.i(F);pe+=(0<=q?q:4294967296+q)*U,U*=4294967296}return pe},n.toString=function(pe){if(pe=pe||10,2>pe||36<pe)throw Error("radix out of range: "+pe);if(ie(this))return"0";if(se(this))return"-"+fe(this).toString(pe);for(var U=b(Math.pow(pe,6)),F=this,q="";;){var j=ue(F,U).g;F=J(F,j.j(U));var H=((0<F.g.length?F.g[0]:F.h)>>>0).toString(pe);if(F=j,ie(F))return H+q;for(;6>H.length;)H="0"+H;q=H+q}},n.i=function(pe){return 0>pe?0:pe<this.g.length?this.g[pe]:this.h};function ie(pe){if(pe.h!=0)return!1;for(var U=0;U<pe.g.length;U++)if(pe.g[U]!=0)return!1;return!0}function se(pe){return pe.h==-1}n.l=function(pe){return pe=J(this,pe),se(pe)?-1:ie(pe)?0:1};function fe(pe){for(var U=pe.g.length,F=[],q=0;q<U;q++)F[q]=~pe.g[q];return new m(F,~pe.h).add(V)}n.abs=function(){return se(this)?fe(this):this},n.add=function(pe){for(var U=Math.max(this.g.length,pe.g.length),F=[],q=0,j=0;j<=U;j++){var H=q+(this.i(j)&65535)+(pe.i(j)&65535),Z=(H>>>16)+(this.i(j)>>>16)+(pe.i(j)>>>16);q=Z>>>16,H&=65535,Z&=65535,F[j]=Z<<16|H}return new m(F,F[F.length-1]&-2147483648?-1:0)};function J(pe,U){return pe.add(fe(U))}n.j=function(pe){if(ie(this)||ie(pe))return M;if(se(this))return se(pe)?fe(this).j(fe(pe)):fe(fe(this).j(pe));if(se(pe))return fe(this.j(fe(pe)));if(0>this.l(k)&&0>pe.l(k))return b(this.m()*pe.m());for(var U=this.g.length+pe.g.length,F=[],q=0;q<2*U;q++)F[q]=0;for(q=0;q<this.g.length;q++)for(var j=0;j<pe.g.length;j++){var H=this.i(q)>>>16,Z=this.i(q)&65535,be=pe.i(j)>>>16,Re=pe.i(j)&65535;F[2*q+2*j]+=Z*Re,ne(F,2*q+2*j),F[2*q+2*j+1]+=H*Re,ne(F,2*q+2*j+1),F[2*q+2*j+1]+=Z*be,ne(F,2*q+2*j+1),F[2*q+2*j+2]+=H*be,ne(F,2*q+2*j+2)}for(q=0;q<U;q++)F[q]=F[2*q+1]<<16|F[2*q];for(q=U;q<2*U;q++)F[q]=0;return new m(F,0)};function ne(pe,U){for(;(pe[U]&65535)!=pe[U];)pe[U+1]+=pe[U]>>>16,pe[U]&=65535,U++}function me(pe,U){this.g=pe,this.h=U}function ue(pe,U){if(ie(U))throw Error("division by zero");if(ie(pe))return new me(M,M);if(se(pe))return U=ue(fe(pe),U),new me(fe(U.g),fe(U.h));if(se(U))return U=ue(pe,fe(U)),new me(fe(U.g),U.h);if(30<pe.g.length){if(se(pe)||se(U))throw Error("slowDivide_ only works with positive integers.");for(var F=V,q=U;0>=q.l(pe);)F=ke(F),q=ke(q);var j=je(F,1),H=je(q,1);for(q=je(q,2),F=je(F,2);!ie(q);){var Z=H.add(q);0>=Z.l(pe)&&(j=j.add(F),H=Z),q=je(q,1),F=je(F,1)}return U=J(pe,j.j(U)),new me(j,U)}for(j=M;0<=pe.l(U);){for(F=Math.max(1,Math.floor(pe.m()/U.m())),q=Math.ceil(Math.log(F)/Math.LN2),q=48>=q?1:Math.pow(2,q-48),H=b(F),Z=H.j(U);se(Z)||0<Z.l(pe);)F-=q,H=b(F),Z=H.j(U);ie(H)&&(H=V),j=j.add(H),pe=J(pe,Z)}return new me(j,pe)}n.A=function(pe){return ue(this,pe).h},n.and=function(pe){for(var U=Math.max(this.g.length,pe.g.length),F=[],q=0;q<U;q++)F[q]=this.i(q)&pe.i(q);return new m(F,this.h&pe.h)},n.or=function(pe){for(var U=Math.max(this.g.length,pe.g.length),F=[],q=0;q<U;q++)F[q]=this.i(q)|pe.i(q);return new m(F,this.h|pe.h)},n.xor=function(pe){for(var U=Math.max(this.g.length,pe.g.length),F=[],q=0;q<U;q++)F[q]=this.i(q)^pe.i(q);return new m(F,this.h^pe.h)};function ke(pe){for(var U=pe.g.length+1,F=[],q=0;q<U;q++)F[q]=pe.i(q)<<1|pe.i(q-1)>>>31;return new m(F,pe.h)}function je(pe,U){var F=U>>5;U%=32;for(var q=pe.g.length-F,j=[],H=0;H<q;H++)j[H]=0<U?pe.i(H+F)>>>U|pe.i(H+F+1)<<32-U:pe.i(H+F);return new m(j,pe.h)}i.prototype.digest=i.prototype.v,i.prototype.reset=i.prototype.s,i.prototype.update=i.prototype.u,u9=i,m.prototype.add=m.prototype.add,m.prototype.multiply=m.prototype.j,m.prototype.modulo=m.prototype.A,m.prototype.compare=m.prototype.l,m.prototype.toNumber=m.prototype.m,m.prototype.toString=m.prototype.toString,m.prototype.getBits=m.prototype.i,m.fromNumber=b,m.fromString=I,eg=m}).apply(typeof iE<"u"?iE:typeof self<"u"?self:typeof window<"u"?window:{});var x1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var h9,Py,d9,H1,R5,f9,p9,m9;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(L,ae,ve){return L==Array.prototype||L==Object.prototype||(L[ae]=ve.value),L};function t(L){L=[typeof globalThis=="object"&&globalThis,L,typeof window=="object"&&window,typeof self=="object"&&self,typeof x1=="object"&&x1];for(var ae=0;ae<L.length;++ae){var ve=L[ae];if(ve&&ve.Math==Math)return ve}throw Error("Cannot find global object")}var i=t(this);function c(L,ae){if(ae)e:{var ve=i;L=L.split(".");for(var Ge=0;Ge<L.length-1;Ge++){var Xt=L[Ge];if(!(Xt in ve))break e;ve=ve[Xt]}L=L[L.length-1],Ge=ve[L],ae=ae(Ge),ae!=Ge&&ae!=null&&e(ve,L,{configurable:!0,writable:!0,value:ae})}}function u(L,ae){L instanceof String&&(L+="");var ve=0,Ge=!1,Xt={next:function(){if(!Ge&&ve<L.length){var hn=ve++;return{value:ae(hn,L[hn]),done:!1}}return Ge=!0,{done:!0,value:void 0}}};return Xt[Symbol.iterator]=function(){return Xt},Xt}c("Array.prototype.values",function(L){return L||function(){return u(this,function(ae,ve){return ve})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var m=m||{},_=this||self;function o(L){var ae=typeof L;return ae=ae!="object"?ae:L?Array.isArray(L)?"array":ae:"null",ae=="array"||ae=="object"&&typeof L.length=="number"}function b(L){var ae=typeof L;return ae=="object"&&L!=null||ae=="function"}function I(L,ae,ve){return L.call.apply(L.bind,arguments)}function M(L,ae,ve){if(!L)throw Error();if(2<arguments.length){var Ge=Array.prototype.slice.call(arguments,2);return function(){var Xt=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Xt,Ge),L.apply(ae,Xt)}}return function(){return L.apply(ae,arguments)}}function V(L,ae,ve){return V=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?I:M,V.apply(null,arguments)}function k(L,ae){var ve=Array.prototype.slice.call(arguments,1);return function(){var Ge=ve.slice();return Ge.push.apply(Ge,arguments),L.apply(this,Ge)}}function ie(L,ae){function ve(){}ve.prototype=ae.prototype,L.aa=ae.prototype,L.prototype=new ve,L.prototype.constructor=L,L.Qb=function(Ge,Xt,hn){for(var ar=Array(arguments.length-2),so=2;so<arguments.length;so++)ar[so-2]=arguments[so];return ae.prototype[Xt].apply(Ge,ar)}}function se(L){const ae=L.length;if(0<ae){const ve=Array(ae);for(let Ge=0;Ge<ae;Ge++)ve[Ge]=L[Ge];return ve}return[]}function fe(L,ae){for(let ve=1;ve<arguments.length;ve++){const Ge=arguments[ve];if(o(Ge)){const Xt=L.length||0,hn=Ge.length||0;L.length=Xt+hn;for(let ar=0;ar<hn;ar++)L[Xt+ar]=Ge[ar]}else L.push(Ge)}}class J{constructor(ae,ve){this.i=ae,this.j=ve,this.h=0,this.g=null}get(){let ae;return 0<this.h?(this.h--,ae=this.g,this.g=ae.next,ae.next=null):ae=this.i(),ae}}function ne(L){return/^[\s\xa0]*$/.test(L)}function me(){var L=_.navigator;return L&&(L=L.userAgent)?L:""}function ue(L){return ue[" "](L),L}ue[" "]=function(){};var ke=me().indexOf("Gecko")!=-1&&!(me().toLowerCase().indexOf("webkit")!=-1&&me().indexOf("Edge")==-1)&&!(me().indexOf("Trident")!=-1||me().indexOf("MSIE")!=-1)&&me().indexOf("Edge")==-1;function je(L,ae,ve){for(const Ge in L)ae.call(ve,L[Ge],Ge,L)}function pe(L,ae){for(const ve in L)ae.call(void 0,L[ve],ve,L)}function U(L){const ae={};for(const ve in L)ae[ve]=L[ve];return ae}const F="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function q(L,ae){let ve,Ge;for(let Xt=1;Xt<arguments.length;Xt++){Ge=arguments[Xt];for(ve in Ge)L[ve]=Ge[ve];for(let hn=0;hn<F.length;hn++)ve=F[hn],Object.prototype.hasOwnProperty.call(Ge,ve)&&(L[ve]=Ge[ve])}}function j(L){var ae=1;L=L.split(":");const ve=[];for(;0<ae&&L.length;)ve.push(L.shift()),ae--;return L.length&&ve.push(L.join(":")),ve}function H(L){_.setTimeout(()=>{throw L},0)}function Z(){var L=Fe;let ae=null;return L.g&&(ae=L.g,L.g=L.g.next,L.g||(L.h=null),ae.next=null),ae}class be{constructor(){this.h=this.g=null}add(ae,ve){const Ge=Re.get();Ge.set(ae,ve),this.h?this.h.next=Ge:this.g=Ge,this.h=Ge}}var Re=new J(()=>new Oe,L=>L.reset());class Oe{constructor(){this.next=this.g=this.h=null}set(ae,ve){this.h=ae,this.g=ve,this.next=null}reset(){this.next=this.g=this.h=null}}let Ne,we=!1,Fe=new be,nt=()=>{const L=_.Promise.resolve(void 0);Ne=()=>{L.then(xe)}};var xe=()=>{for(var L;L=Z();){try{L.h.call(L.g)}catch(ve){H(ve)}var ae=Re;ae.j(L),100>ae.h&&(ae.h++,L.next=ae.g,ae.g=L)}we=!1};function le(){this.s=this.s,this.C=this.C}le.prototype.s=!1,le.prototype.ma=function(){this.s||(this.s=!0,this.N())},le.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function De(L,ae){this.type=L,this.g=this.target=ae,this.defaultPrevented=!1}De.prototype.h=function(){this.defaultPrevented=!0};var Be=(function(){if(!_.addEventListener||!Object.defineProperty)return!1;var L=!1,ae=Object.defineProperty({},"passive",{get:function(){L=!0}});try{const ve=()=>{};_.addEventListener("test",ve,ae),_.removeEventListener("test",ve,ae)}catch{}return L})();function Ye(L,ae){if(De.call(this,L?L.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,L){var ve=this.type=L.type,Ge=L.changedTouches&&L.changedTouches.length?L.changedTouches[0]:null;if(this.target=L.target||L.srcElement,this.g=ae,ae=L.relatedTarget){if(ke){e:{try{ue(ae.nodeName);var Xt=!0;break e}catch{}Xt=!1}Xt||(ae=null)}}else ve=="mouseover"?ae=L.fromElement:ve=="mouseout"&&(ae=L.toElement);this.relatedTarget=ae,Ge?(this.clientX=Ge.clientX!==void 0?Ge.clientX:Ge.pageX,this.clientY=Ge.clientY!==void 0?Ge.clientY:Ge.pageY,this.screenX=Ge.screenX||0,this.screenY=Ge.screenY||0):(this.clientX=L.clientX!==void 0?L.clientX:L.pageX,this.clientY=L.clientY!==void 0?L.clientY:L.pageY,this.screenX=L.screenX||0,this.screenY=L.screenY||0),this.button=L.button,this.key=L.key||"",this.ctrlKey=L.ctrlKey,this.altKey=L.altKey,this.shiftKey=L.shiftKey,this.metaKey=L.metaKey,this.pointerId=L.pointerId||0,this.pointerType=typeof L.pointerType=="string"?L.pointerType:rt[L.pointerType]||"",this.state=L.state,this.i=L,L.defaultPrevented&&Ye.aa.h.call(this)}}ie(Ye,De);var rt={2:"touch",3:"pen",4:"mouse"};Ye.prototype.h=function(){Ye.aa.h.call(this);var L=this.i;L.preventDefault?L.preventDefault():L.returnValue=!1};var mt="closure_listenable_"+(1e6*Math.random()|0),ft=0;function Dt(L,ae,ve,Ge,Xt){this.listener=L,this.proxy=null,this.src=ae,this.type=ve,this.capture=!!Ge,this.ha=Xt,this.key=++ft,this.da=this.fa=!1}function Yt(L){L.da=!0,L.listener=null,L.proxy=null,L.src=null,L.ha=null}function cn(L){this.src=L,this.g={},this.h=0}cn.prototype.add=function(L,ae,ve,Ge,Xt){var hn=L.toString();L=this.g[hn],L||(L=this.g[hn]=[],this.h++);var ar=Mn(L,ae,Ge,Xt);return-1<ar?(ae=L[ar],ve||(ae.fa=!1)):(ae=new Dt(ae,this.src,hn,!!Ge,Xt),ae.fa=ve,L.push(ae)),ae};function gn(L,ae){var ve=ae.type;if(ve in L.g){var Ge=L.g[ve],Xt=Array.prototype.indexOf.call(Ge,ae,void 0),hn;(hn=0<=Xt)&&Array.prototype.splice.call(Ge,Xt,1),hn&&(Yt(ae),L.g[ve].length==0&&(delete L.g[ve],L.h--))}}function Mn(L,ae,ve,Ge){for(var Xt=0;Xt<L.length;++Xt){var hn=L[Xt];if(!hn.da&&hn.listener==ae&&hn.capture==!!ve&&hn.ha==Ge)return Xt}return-1}var Gt="closure_lm_"+(1e6*Math.random()|0),st={};function mr(L,ae,ve,Ge,Xt){if(Array.isArray(ae)){for(var hn=0;hn<ae.length;hn++)mr(L,ae[hn],ve,Ge,Xt);return null}return ve=Gn(ve),L&&L[mt]?L.K(ae,ve,b(Ge)?!!Ge.capture:!1,Xt):Er(L,ae,ve,!1,Ge,Xt)}function Er(L,ae,ve,Ge,Xt,hn){if(!ae)throw Error("Invalid event type");var ar=b(Xt)?!!Xt.capture:!!Xt,so=Vt(L);if(so||(L[Gt]=so=new cn(L)),ve=so.add(ae,ve,Ge,ar,hn),ve.proxy)return ve;if(Ge=Cr(),ve.proxy=Ge,Ge.src=L,Ge.listener=ve,L.addEventListener)Be||(Xt=ar),Xt===void 0&&(Xt=!1),L.addEventListener(ae.toString(),Ge,Xt);else if(L.attachEvent)L.attachEvent(er(ae.toString()),Ge);else if(L.addListener&&L.removeListener)L.addListener(Ge);else throw Error("addEventListener and attachEvent are unavailable.");return ve}function Cr(){function L(ve){return ae.call(L.src,L.listener,ve)}const ae=Yr;return L}function Ln(L,ae,ve,Ge,Xt){if(Array.isArray(ae))for(var hn=0;hn<ae.length;hn++)Ln(L,ae[hn],ve,Ge,Xt);else Ge=b(Ge)?!!Ge.capture:!!Ge,ve=Gn(ve),L&&L[mt]?(L=L.i,ae=String(ae).toString(),ae in L.g&&(hn=L.g[ae],ve=Mn(hn,ve,Ge,Xt),-1<ve&&(Yt(hn[ve]),Array.prototype.splice.call(hn,ve,1),hn.length==0&&(delete L.g[ae],L.h--)))):L&&(L=Vt(L))&&(ae=L.g[ae.toString()],L=-1,ae&&(L=Mn(ae,ve,Ge,Xt)),(ve=-1<L?ae[L]:null)&&ir(ve))}function ir(L){if(typeof L!="number"&&L&&!L.da){var ae=L.src;if(ae&&ae[mt])gn(ae.i,L);else{var ve=L.type,Ge=L.proxy;ae.removeEventListener?ae.removeEventListener(ve,Ge,L.capture):ae.detachEvent?ae.detachEvent(er(ve),Ge):ae.addListener&&ae.removeListener&&ae.removeListener(Ge),(ve=Vt(ae))?(gn(ve,L),ve.h==0&&(ve.src=null,ae[Gt]=null)):Yt(L)}}}function er(L){return L in st?st[L]:st[L]="on"+L}function Yr(L,ae){if(L.da)L=!0;else{ae=new Ye(ae,this);var ve=L.listener,Ge=L.ha||L.src;L.fa&&ir(L),L=ve.call(Ge,ae)}return L}function Vt(L){return L=L[Gt],L instanceof cn?L:null}var Pn="__closure_events_fn_"+(1e9*Math.random()>>>0);function Gn(L){return typeof L=="function"?L:(L[Pn]||(L[Pn]=function(ae){return L.handleEvent(ae)}),L[Pn])}function Dn(){le.call(this),this.i=new cn(this),this.M=this,this.F=null}ie(Dn,le),Dn.prototype[mt]=!0,Dn.prototype.removeEventListener=function(L,ae,ve,Ge){Ln(this,L,ae,ve,Ge)};function Mr(L,ae){var ve,Ge=L.F;if(Ge)for(ve=[];Ge;Ge=Ge.F)ve.push(Ge);if(L=L.M,Ge=ae.type||ae,typeof ae=="string")ae=new De(ae,L);else if(ae instanceof De)ae.target=ae.target||L;else{var Xt=ae;ae=new De(Ge,L),q(ae,Xt)}if(Xt=!0,ve)for(var hn=ve.length-1;0<=hn;hn--){var ar=ae.g=ve[hn];Xt=wr(ar,Ge,!0,ae)&&Xt}if(ar=ae.g=L,Xt=wr(ar,Ge,!0,ae)&&Xt,Xt=wr(ar,Ge,!1,ae)&&Xt,ve)for(hn=0;hn<ve.length;hn++)ar=ae.g=ve[hn],Xt=wr(ar,Ge,!1,ae)&&Xt}Dn.prototype.N=function(){if(Dn.aa.N.call(this),this.i){var L=this.i,ae;for(ae in L.g){for(var ve=L.g[ae],Ge=0;Ge<ve.length;Ge++)Yt(ve[Ge]);delete L.g[ae],L.h--}}this.F=null},Dn.prototype.K=function(L,ae,ve,Ge){return this.i.add(String(L),ae,!1,ve,Ge)},Dn.prototype.L=function(L,ae,ve,Ge){return this.i.add(String(L),ae,!0,ve,Ge)};function wr(L,ae,ve,Ge){if(ae=L.i.g[String(ae)],!ae)return!0;ae=ae.concat();for(var Xt=!0,hn=0;hn<ae.length;++hn){var ar=ae[hn];if(ar&&!ar.da&&ar.capture==ve){var so=ar.listener,Fo=ar.ha||ar.src;ar.fa&&gn(L.i,ar),Xt=so.call(Fo,Ge)!==!1&&Xt}}return Xt&&!Ge.defaultPrevented}function Tr(L,ae,ve){if(typeof L=="function")ve&&(L=V(L,ve));else if(L&&typeof L.handleEvent=="function")L=V(L.handleEvent,L);else throw Error("Invalid listener argument");return 2147483647<Number(ae)?-1:_.setTimeout(L,ae||0)}function Ir(L){L.g=Tr(()=>{L.g=null,L.i&&(L.i=!1,Ir(L))},L.l);const ae=L.h;L.h=null,L.m.apply(null,ae)}class Pr extends le{constructor(ae,ve){super(),this.m=ae,this.l=ve,this.h=null,this.i=!1,this.g=null}j(ae){this.h=arguments,this.g?this.i=!0:Ir(this)}N(){super.N(),this.g&&(_.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ei(L){le.call(this),this.h=L,this.g={}}ie(Ei,le);var Pi=[];function or(L){je(L.g,function(ae,ve){this.g.hasOwnProperty(ve)&&ir(ae)},L),L.g={}}Ei.prototype.N=function(){Ei.aa.N.call(this),or(this)},Ei.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var oi=_.JSON.stringify,Kr=_.JSON.parse,Br=class{stringify(L){return _.JSON.stringify(L,void 0)}parse(L){return _.JSON.parse(L,void 0)}};function di(){}di.prototype.h=null;function si(L){return L.h||(L.h=L.i())}function ut(){}var Ee={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ie(){De.call(this,"d")}ie(Ie,De);function Qe(){De.call(this,"c")}ie(Qe,De);var ht={},Ct=null;function Mt(){return Ct=Ct||new Dn}ht.La="serverreachability";function Bt(L){De.call(this,ht.La,L)}ie(Bt,De);function Et(L){const ae=Mt();Mr(ae,new Bt(ae))}ht.STAT_EVENT="statevent";function Pt(L,ae){De.call(this,ht.STAT_EVENT,L),this.stat=ae}ie(Pt,De);function vn(L){const ae=Mt();Mr(ae,new Pt(ae,L))}ht.Ma="timingevent";function Bn(L,ae){De.call(this,ht.Ma,L),this.size=ae}ie(Bn,De);function Tn(L,ae){if(typeof L!="function")throw Error("Fn must not be null and must be a function");return _.setTimeout(function(){L()},ae)}function kr(){this.g=!0}kr.prototype.xa=function(){this.g=!1};function Lr(L,ae,ve,Ge,Xt,hn){L.info(function(){if(L.g)if(hn)for(var ar="",so=hn.split("&"),Fo=0;Fo<so.length;Fo++){var Ki=so[Fo].split("=");if(1<Ki.length){var zi=Ki[0];Ki=Ki[1];var Mo=zi.split("_");ar=2<=Mo.length&&Mo[1]=="type"?ar+(zi+"="+Ki+"&"):ar+(zi+"=redacted&")}}else ar=null;else ar=hn;return"XMLHTTP REQ ("+Ge+") [attempt "+Xt+"]: "+ae+`
`+ve+`
`+ar})}function Vr(L,ae,ve,Ge,Xt,hn,ar){L.info(function(){return"XMLHTTP RESP ("+Ge+") [ attempt "+Xt+"]: "+ae+`
`+ve+`
`+hn+" "+ar})}function Ar(L,ae,ve,Ge){L.info(function(){return"XMLHTTP TEXT ("+ae+"): "+no(L,ve)+(Ge?" "+Ge:"")})}function Ai(L,ae){L.info(function(){return"TIMEOUT: "+ae})}kr.prototype.info=function(){};function no(L,ae){if(!L.g)return ae;if(!ae)return null;try{var ve=JSON.parse(ae);if(ve){for(L=0;L<ve.length;L++)if(Array.isArray(ve[L])){var Ge=ve[L];if(!(2>Ge.length)){var Xt=Ge[1];if(Array.isArray(Xt)&&!(1>Xt.length)){var hn=Xt[0];if(hn!="noop"&&hn!="stop"&&hn!="close")for(var ar=1;ar<Xt.length;ar++)Xt[ar]=""}}}}return oi(ve)}catch{return ae}}var yo={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},$o={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},ro;function ys(){}ie(ys,di),ys.prototype.g=function(){return new XMLHttpRequest},ys.prototype.i=function(){return{}},ro=new ys;function io(L,ae,ve,Ge){this.j=L,this.i=ae,this.l=ve,this.R=Ge||1,this.U=new Ei(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Is}function Is(){this.i=null,this.g="",this.h=!1}var ga={},gl={};function sl(L,ae,ve){L.L=1,L.v=yl(Nr(ae)),L.m=ve,L.P=!0,Wi(L,null)}function Wi(L,ae){L.F=Date.now(),Eo(L),L.A=Nr(L.v);var ve=L.A,Ge=L.R;Array.isArray(Ge)||(Ge=[String(Ge)]),ai(ve.i,"t",Ge),L.C=0,ve=L.j.J,L.h=new Is,L.g=zo(L.j,ve?ae:null,!L.m),0<L.O&&(L.M=new Pr(V(L.Y,L,L.g),L.O)),ae=L.U,ve=L.g,Ge=L.ca;var Xt="readystatechange";Array.isArray(Xt)||(Xt&&(Pi[0]=Xt.toString()),Xt=Pi);for(var hn=0;hn<Xt.length;hn++){var ar=mr(ve,Xt[hn],Ge||ae.handleEvent,!1,ae.h||ae);if(!ar)break;ae.g[ar.key]=ar}ae=L.H?U(L.H):{},L.m?(L.u||(L.u="POST"),ae["Content-Type"]="application/x-www-form-urlencoded",L.g.ea(L.A,L.u,L.m,ae)):(L.u="GET",L.g.ea(L.A,L.u,null,ae)),Et(),Lr(L.i,L.u,L.A,L.l,L.R,L.m)}io.prototype.ca=function(L){L=L.target;const ae=this.M;ae&&Ss(L)==3?ae.j():this.Y(L)},io.prototype.Y=function(L){try{if(L==this.g)e:{const Mo=Ss(this.g);var ae=this.g.Ba();const ca=this.g.Z();if(!(3>Mo)&&(Mo!=3||this.g&&(this.h.h||this.g.oa()||$s(this.g)))){this.J||Mo!=4||ae==7||(ae==8||0>=ca?Et(3):Et(2)),Ea(this);var ve=this.g.Z();this.X=ve;t:if(Jl(this)){var Ge=$s(this.g);L="";var Xt=Ge.length,hn=Ss(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Xa(this),Ko(this);var ar="";break t}this.h.i=new _.TextDecoder}for(ae=0;ae<Xt;ae++)this.h.h=!0,L+=this.h.i.decode(Ge[ae],{stream:!(hn&&ae==Xt-1)});Ge.length=0,this.h.g+=L,this.C=0,ar=this.h.g}else ar=this.g.oa();if(this.o=ve==200,Vr(this.i,this.u,this.A,this.l,this.R,Mo,ve),this.o){if(this.T&&!this.K){t:{if(this.g){var so,Fo=this.g;if((so=Fo.g?Fo.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!ne(so)){var Ki=so;break t}}Ki=null}if(ve=Ki)Ar(this.i,this.l,ve,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Nl(this,ve);else{this.o=!1,this.s=3,vn(12),Xa(this),Ko(this);break e}}if(this.P){ve=!0;let Lo;for(;!this.J&&this.C<ar.length;)if(Lo=Lu(this,ar),Lo==gl){Mo==4&&(this.s=4,vn(14),ve=!1),Ar(this.i,this.l,null,"[Incomplete Response]");break}else if(Lo==ga){this.s=4,vn(15),Ar(this.i,this.l,ar,"[Invalid Chunk]"),ve=!1;break}else Ar(this.i,this.l,Lo,null),Nl(this,Lo);if(Jl(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Mo!=4||ar.length!=0||this.h.h||(this.s=1,vn(16),ve=!1),this.o=this.o&&ve,!ve)Ar(this.i,this.l,ar,"[Invalid Chunked Response]"),Xa(this),Ko(this);else if(0<ar.length&&!this.W){this.W=!0;var zi=this.j;zi.g==this&&zi.ba&&!zi.M&&(zi.j.info("Great, no buffering proxy detected. Bytes received: "+ar.length),Dr(zi),zi.M=!0,vn(11))}}else Ar(this.i,this.l,ar,null),Nl(this,ar);Mo==4&&Xa(this),this.o&&!this.J&&(Mo==4?Ii(this.j,this):(this.o=!1,Eo(this)))}else aa(this.g),ve==400&&0<ar.indexOf("Unknown SID")?(this.s=3,vn(12)):(this.s=0,vn(13)),Xa(this),Ko(this)}}}catch{}finally{}};function Jl(L){return L.g?L.u=="GET"&&L.L!=2&&L.j.Ca:!1}function Lu(L,ae){var ve=L.C,Ge=ae.indexOf(`
`,ve);return Ge==-1?gl:(ve=Number(ae.substring(ve,Ge)),isNaN(ve)?ga:(Ge+=1,Ge+ve>ae.length?gl:(ae=ae.slice(Ge,Ge+ve),L.C=Ge+ve,ae)))}io.prototype.cancel=function(){this.J=!0,Xa(this)};function Eo(L){L.S=Date.now()+L.I,fu(L,L.I)}function fu(L,ae){if(L.B!=null)throw Error("WatchDog timer not null");L.B=Tn(V(L.ba,L),ae)}function Ea(L){L.B&&(_.clearTimeout(L.B),L.B=null)}io.prototype.ba=function(){this.B=null;const L=Date.now();0<=L-this.S?(Ai(this.i,this.A),this.L!=2&&(Et(),vn(17)),Xa(this),this.s=2,Ko(this)):fu(this,this.S-L)};function Ko(L){L.j.G==0||L.J||Ii(L.j,L)}function Xa(L){Ea(L);var ae=L.M;ae&&typeof ae.ma=="function"&&ae.ma(),L.M=null,or(L.U),L.g&&(ae=L.g,L.g=null,ae.abort(),ae.ma())}function Nl(L,ae){try{var ve=L.j;if(ve.G!=0&&(ve.g==L||Xo(ve.h,L))){if(!L.K&&Xo(ve.h,L)&&ve.G==3){try{var Ge=ve.Da.g.parse(ae)}catch{Ge=null}if(Array.isArray(Ge)&&Ge.length==3){var Xt=Ge;if(Xt[0]==0){e:if(!ve.u){if(ve.g)if(ve.g.F+3e3<L.F)yi(ve),Hs(ve);else break e;Fn(ve),vn(18)}}else ve.za=Xt[1],0<ve.za-ve.T&&37500>Xt[2]&&ve.F&&ve.v==0&&!ve.C&&(ve.C=Tn(V(ve.Za,ve),6e3));if(1>=dn(ve.h)&&ve.ca){try{ve.ca()}catch{}ve.ca=void 0}}else bo(ve,11)}else if((L.K||ve.g==L)&&yi(ve),!ne(ae))for(Xt=ve.Da.g.parse(ae),ae=0;ae<Xt.length;ae++){let Ki=Xt[ae];if(ve.T=Ki[0],Ki=Ki[1],ve.G==2)if(Ki[0]=="c"){ve.K=Ki[1],ve.ia=Ki[2];const zi=Ki[3];zi!=null&&(ve.la=zi,ve.j.info("VER="+ve.la));const Mo=Ki[4];Mo!=null&&(ve.Aa=Mo,ve.j.info("SVER="+ve.Aa));const ca=Ki[5];ca!=null&&typeof ca=="number"&&0<ca&&(Ge=1.5*ca,ve.L=Ge,ve.j.info("backChannelRequestTimeoutMs_="+Ge)),Ge=ve;const Lo=L.g;if(Lo){const Bi=Lo.g?Lo.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Bi){var hn=Ge.h;hn.g||Bi.indexOf("spdy")==-1&&Bi.indexOf("quic")==-1&&Bi.indexOf("h2")==-1||(hn.j=hn.l,hn.g=new Set,hn.h&&(ss(hn,hn.h),hn.h=null))}if(Ge.D){const Fl=Lo.g?Lo.g.getResponseHeader("X-HTTP-Session-Id"):null;Fl&&(Ge.ya=Fl,Mi(Ge.I,Ge.D,Fl))}}ve.G=3,ve.l&&ve.l.ua(),ve.ba&&(ve.R=Date.now()-L.F,ve.j.info("Handshake RTT: "+ve.R+"ms")),Ge=ve;var ar=L;if(Ge.qa=Ro(Ge,Ge.J?Ge.ia:null,Ge.W),ar.K){xi(Ge.h,ar);var so=ar,Fo=Ge.L;Fo&&(so.I=Fo),so.B&&(Ea(so),Eo(so)),Ge.g=ar}else Zt(Ge);0<ve.i.length&&W(ve)}else Ki[0]!="stop"&&Ki[0]!="close"||bo(ve,7);else ve.G==3&&(Ki[0]=="stop"||Ki[0]=="close"?Ki[0]=="stop"?bo(ve,7):Gs(ve):Ki[0]!="noop"&&ve.l&&ve.l.ta(Ki),ve.v=0)}}Et(4)}catch{}}var Ql=class{constructor(L,ae){this.g=L,this.map=ae}};function Aa(L){this.l=L||10,_.PerformanceNavigationTiming?(L=_.performance.getEntriesByType("navigation"),L=0<L.length&&(L[0].nextHopProtocol=="hq"||L[0].nextHopProtocol=="h2")):L=!!(_.chrome&&_.chrome.loadTimes&&_.chrome.loadTimes()&&_.chrome.loadTimes().wasFetchedViaSpdy),this.j=L?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function sa(L){return L.h?!0:L.g?L.g.size>=L.j:!1}function dn(L){return L.h?1:L.g?L.g.size:0}function Xo(L,ae){return L.h?L.h==ae:L.g?L.g.has(ae):!1}function ss(L,ae){L.g?L.g.add(ae):L.h=ae}function xi(L,ae){L.h&&L.h==ae?L.h=null:L.g&&L.g.has(ae)&&L.g.delete(ae)}Aa.prototype.cancel=function(){if(this.i=pu(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const L of this.g.values())L.cancel();this.g.clear()}};function pu(L){if(L.h!=null)return L.i.concat(L.h.D);if(L.g!=null&&L.g.size!==0){let ae=L.i;for(const ve of L.g.values())ae=ae.concat(ve.D);return ae}return se(L.i)}function Za(L){if(L.V&&typeof L.V=="function")return L.V();if(typeof Map<"u"&&L instanceof Map||typeof Set<"u"&&L instanceof Set)return Array.from(L.values());if(typeof L=="string")return L.split("");if(o(L)){for(var ae=[],ve=L.length,Ge=0;Ge<ve;Ge++)ae.push(L[Ge]);return ae}ae=[],ve=0;for(Ge in L)ae[ve++]=L[Ge];return ae}function Ya(L){if(L.na&&typeof L.na=="function")return L.na();if(!L.V||typeof L.V!="function"){if(typeof Map<"u"&&L instanceof Map)return Array.from(L.keys());if(!(typeof Set<"u"&&L instanceof Set)){if(o(L)||typeof L=="string"){var ae=[];L=L.length;for(var ve=0;ve<L;ve++)ae.push(ve);return ae}ae=[],ve=0;for(const Ge in L)ae[ve++]=Ge;return ae}}}function al(L,ae){if(L.forEach&&typeof L.forEach=="function")L.forEach(ae,void 0);else if(o(L)||typeof L=="string")Array.prototype.forEach.call(L,ae,void 0);else for(var ve=Ya(L),Ge=Za(L),Xt=Ge.length,hn=0;hn<Xt;hn++)ae.call(void 0,Ge[hn],ve&&ve[hn],L)}var Cs=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function tr(L,ae){if(L){L=L.split("&");for(var ve=0;ve<L.length;ve++){var Ge=L[ve].indexOf("="),Xt=null;if(0<=Ge){var hn=L[ve].substring(0,Ge);Xt=L[ve].substring(Ge+1)}else hn=L[ve];ae(hn,Xt?decodeURIComponent(Xt.replace(/\+/g," ")):"")}}}function zr(L){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,L instanceof zr){this.h=L.h,js(this,L.j),this.o=L.o,this.g=L.g,Ta(this,L.s),this.l=L.l;var ae=L.i,ve=new Da;ve.i=ae.i,ae.g&&(ve.g=new Map(ae.g),ve.h=ae.h),bi(this,ve),this.m=L.m}else L&&(ae=String(L).match(Cs))?(this.h=!1,js(this,ae[1]||"",!0),this.o=Gi(ae[2]||""),this.g=Gi(ae[3]||"",!0),Ta(this,ae[4]),this.l=Gi(ae[5]||"",!0),bi(this,ae[6]||"",!0),this.m=Gi(ae[7]||"")):(this.h=!1,this.i=new Da(null,this.h))}zr.prototype.toString=function(){var L=[],ae=this.j;ae&&L.push(fs(ae,mu,!0),":");var ve=this.g;return(ve||ae=="file")&&(L.push("//"),(ae=this.o)&&L.push(fs(ae,mu,!0),"@"),L.push(encodeURIComponent(String(ve)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),ve=this.s,ve!=null&&L.push(":",String(ve))),(ve=this.l)&&(this.g&&ve.charAt(0)!="/"&&L.push("/"),L.push(fs(ve,ve.charAt(0)=="/"?nu:ec,!0))),(ve=this.i.toString())&&L.push("?",ve),(ve=this.m)&&L.push("#",fs(ve,tc)),L.join("")};function Nr(L){return new zr(L)}function js(L,ae,ve){L.j=ve?Gi(ae,!0):ae,L.j&&(L.j=L.j.replace(/:$/,""))}function Ta(L,ae){if(ae){if(ae=Number(ae),isNaN(ae)||0>ae)throw Error("Bad port number "+ae);L.s=ae}else L.s=null}function bi(L,ae,ve){ae instanceof Da?(L.i=ae,Ao(L.i,L.h)):(ve||(ae=fs(ae,_c)),L.i=new Da(ae,L.h))}function Mi(L,ae,ve){L.i.set(ae,ve)}function yl(L){return Mi(L,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),L}function Gi(L,ae){return L?ae?decodeURI(L.replace(/%25/g,"%2525")):decodeURIComponent(L):""}function fs(L,ae,ve){return typeof L=="string"?(L=encodeURI(L).replace(ae,Ui),ve&&(L=L.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),L):null}function Ui(L){return L=L.charCodeAt(0),"%"+(L>>4&15).toString(16)+(L&15).toString(16)}var mu=/[#\/\?@]/g,ec=/[#\?:]/g,nu=/[#\?]/g,_c=/[#\?@]/g,tc=/#/g;function Da(L,ae){this.h=this.g=null,this.i=L||null,this.j=!!ae}function Ls(L){L.g||(L.g=new Map,L.h=0,L.i&&tr(L.i,function(ae,ve){L.add(decodeURIComponent(ae.replace(/\+/g," ")),ve)}))}n=Da.prototype,n.add=function(L,ae){Ls(this),this.i=null,L=Zo(this,L);var ve=this.g.get(L);return ve||this.g.set(L,ve=[]),ve.push(ae),this.h+=1,this};function Vi(L,ae){Ls(L),ae=Zo(L,ae),L.g.has(ae)&&(L.i=null,L.h-=L.g.get(ae).length,L.g.delete(ae))}function Fa(L,ae){return Ls(L),ae=Zo(L,ae),L.g.has(ae)}n.forEach=function(L,ae){Ls(this),this.g.forEach(function(ve,Ge){ve.forEach(function(Xt){L.call(ae,Xt,Ge,this)},this)},this)},n.na=function(){Ls(this);const L=Array.from(this.g.values()),ae=Array.from(this.g.keys()),ve=[];for(let Ge=0;Ge<ae.length;Ge++){const Xt=L[Ge];for(let hn=0;hn<Xt.length;hn++)ve.push(ae[Ge])}return ve},n.V=function(L){Ls(this);let ae=[];if(typeof L=="string")Fa(this,L)&&(ae=ae.concat(this.g.get(Zo(this,L))));else{L=Array.from(this.g.values());for(let ve=0;ve<L.length;ve++)ae=ae.concat(L[ve])}return ae},n.set=function(L,ae){return Ls(this),this.i=null,L=Zo(this,L),Fa(this,L)&&(this.h-=this.g.get(L).length),this.g.set(L,[ae]),this.h+=1,this},n.get=function(L,ae){return L?(L=this.V(L),0<L.length?String(L[0]):ae):ae};function ai(L,ae,ve){Vi(L,ae),0<ve.length&&(L.i=null,L.g.set(Zo(L,ae),se(ve)),L.h+=ve.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const L=[],ae=Array.from(this.g.keys());for(var ve=0;ve<ae.length;ve++){var Ge=ae[ve];const hn=encodeURIComponent(String(Ge)),ar=this.V(Ge);for(Ge=0;Ge<ar.length;Ge++){var Xt=hn;ar[Ge]!==""&&(Xt+="="+encodeURIComponent(String(ar[Ge]))),L.push(Xt)}}return this.i=L.join("&")};function Zo(L,ae){return ae=String(ae),L.j&&(ae=ae.toLowerCase()),ae}function Ao(L,ae){ae&&!L.j&&(Ls(L),L.i=null,L.g.forEach(function(ve,Ge){var Xt=Ge.toLowerCase();Ge!=Xt&&(Vi(this,Ge),ai(this,Xt,ve))},L)),L.j=ae}function Ih(L,ae){const ve=new kr;if(_.Image){const Ge=new Image;Ge.onload=k(_o,ve,"TestLoadImage: loaded",!0,ae,Ge),Ge.onerror=k(_o,ve,"TestLoadImage: error",!1,ae,Ge),Ge.onabort=k(_o,ve,"TestLoadImage: abort",!1,ae,Ge),Ge.ontimeout=k(_o,ve,"TestLoadImage: timeout",!1,ae,Ge),_.setTimeout(function(){Ge.ontimeout&&Ge.ontimeout()},1e4),Ge.src=L}else ae(!1)}function Pu(L,ae){const ve=new kr,Ge=new AbortController,Xt=setTimeout(()=>{Ge.abort(),_o(ve,"TestPingServer: timeout",!1,ae)},1e4);fetch(L,{signal:Ge.signal}).then(hn=>{clearTimeout(Xt),hn.ok?_o(ve,"TestPingServer: ok",!0,ae):_o(ve,"TestPingServer: server error",!1,ae)}).catch(()=>{clearTimeout(Xt),_o(ve,"TestPingServer: error",!1,ae)})}function _o(L,ae,ve,Ge,Xt){try{Xt&&(Xt.onload=null,Xt.onerror=null,Xt.onabort=null,Xt.ontimeout=null),Ge(ve)}catch{}}function Us(){this.g=new Br}function ku(L,ae,ve){const Ge=ve||"";try{al(L,function(Xt,hn){let ar=Xt;b(Xt)&&(ar=oi(Xt)),ae.push(Ge+hn+"="+encodeURIComponent(ar))})}catch(Xt){throw ae.push(Ge+"type="+encodeURIComponent("_badmap")),Xt}}function Go(L){this.l=L.Ub||null,this.j=L.eb||!1}ie(Go,di),Go.prototype.g=function(){return new vo(this.l,this.j)},Go.prototype.i=(function(L){return function(){return L}})({});function vo(L,ae){Dn.call(this),this.D=L,this.o=ae,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}ie(vo,Dn),n=vo.prototype,n.open=function(L,ae){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=L,this.A=ae,this.readyState=1,Vs(this)},n.send=function(L){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const ae={headers:this.u,method:this.B,credentials:this.m,cache:void 0};L&&(ae.body=L),(this.D||_).fetch(new Request(this.A,ae)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Oa(this)),this.readyState=0},n.Sa=function(L){if(this.g&&(this.l=L,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=L.headers,this.readyState=2,Vs(this)),this.g&&(this.readyState=3,Vs(this),this.g)))if(this.responseType==="arraybuffer")L.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof _.ReadableStream<"u"&&"body"in L){if(this.j=L.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Dl(this)}else L.text().then(this.Ra.bind(this),this.ga.bind(this))};function Dl(L){L.j.read().then(L.Pa.bind(L)).catch(L.ga.bind(L))}n.Pa=function(L){if(this.g){if(this.o&&L.value)this.response.push(L.value);else if(!this.o){var ae=L.value?L.value:new Uint8Array(0);(ae=this.v.decode(ae,{stream:!L.done}))&&(this.response=this.responseText+=ae)}L.done?Oa(this):Vs(this),this.readyState==3&&Dl(this)}},n.Ra=function(L){this.g&&(this.response=this.responseText=L,Oa(this))},n.Qa=function(L){this.g&&(this.response=L,Oa(this))},n.ga=function(){this.g&&Oa(this)};function Oa(L){L.readyState=4,L.l=null,L.j=null,L.v=null,Vs(L)}n.setRequestHeader=function(L,ae){this.u.append(L,ae)},n.getResponseHeader=function(L){return this.h&&this.h.get(L.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const L=[],ae=this.h.entries();for(var ve=ae.next();!ve.done;)ve=ve.value,L.push(ve[0]+": "+ve[1]),ve=ae.next();return L.join(`\r
`)};function Vs(L){L.onreadystatechange&&L.onreadystatechange.call(L)}Object.defineProperty(vo.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(L){this.m=L?"include":"same-origin"}});function Bo(L){let ae="";return je(L,function(ve,Ge){ae+=Ge,ae+=":",ae+=ve,ae+=`\r
`}),ae}function Bc(L,ae,ve){e:{for(Ge in ve){var Ge=!1;break e}Ge=!0}Ge||(ve=Bo(ve),typeof L=="string"?ve!=null&&encodeURIComponent(String(ve)):Mi(L,ae,ve))}function Ho(L){Dn.call(this),this.headers=new Map,this.o=L||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}ie(Ho,Dn);var ya=/^https?$/i,Ja=["POST","PUT"];n=Ho.prototype,n.Ha=function(L){this.J=L},n.ea=function(L,ae,ve,Ge){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+L);ae=ae?ae.toUpperCase():"GET",this.D=L,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():ro.g(),this.v=this.o?si(this.o):si(ro),this.g.onreadystatechange=V(this.Ea,this);try{this.B=!0,this.g.open(ae,String(L),!0),this.B=!1}catch(hn){ll(this,hn);return}if(L=ve||"",ve=new Map(this.headers),Ge)if(Object.getPrototypeOf(Ge)===Object.prototype)for(var Xt in Ge)ve.set(Xt,Ge[Xt]);else if(typeof Ge.keys=="function"&&typeof Ge.get=="function")for(const hn of Ge.keys())ve.set(hn,Ge.get(hn));else throw Error("Unknown input type for opt_headers: "+String(Ge));Ge=Array.from(ve.keys()).find(hn=>hn.toLowerCase()=="content-type"),Xt=_.FormData&&L instanceof _.FormData,!(0<=Array.prototype.indexOf.call(Ja,ae,void 0))||Ge||Xt||ve.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[hn,ar]of ve)this.g.setRequestHeader(hn,ar);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Ti(this),this.u=!0,this.g.send(L),this.u=!1}catch(hn){ll(this,hn)}};function ll(L,ae){L.h=!1,L.g&&(L.j=!0,L.g.abort(),L.j=!1),L.l=ae,L.m=5,ru(L),qs(L)}function ru(L){L.A||(L.A=!0,Mr(L,"complete"),Mr(L,"error"))}n.abort=function(L){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=L||7,Mr(this,"complete"),Mr(this,"abort"),qs(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),qs(this,!0)),Ho.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?vc(this):this.bb())},n.bb=function(){vc(this)};function vc(L){if(L.h&&typeof m<"u"&&(!L.v[1]||Ss(L)!=4||L.Z()!=2)){if(L.u&&Ss(L)==4)Tr(L.Ea,0,L);else if(Mr(L,"readystatechange"),Ss(L)==4){L.h=!1;try{const ar=L.Z();e:switch(ar){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var ae=!0;break e;default:ae=!1}var ve;if(!(ve=ae)){var Ge;if(Ge=ar===0){var Xt=String(L.D).match(Cs)[1]||null;!Xt&&_.self&&_.self.location&&(Xt=_.self.location.protocol.slice(0,-1)),Ge=!ya.test(Xt?Xt.toLowerCase():"")}ve=Ge}if(ve)Mr(L,"complete"),Mr(L,"success");else{L.m=6;try{var hn=2<Ss(L)?L.g.statusText:""}catch{hn=""}L.l=hn+" ["+L.Z()+"]",ru(L)}}finally{qs(L)}}}}function qs(L,ae){if(L.g){Ti(L);const ve=L.g,Ge=L.v[0]?()=>{}:null;L.g=null,L.v=null,ae||Mr(L,"ready");try{ve.onreadystatechange=Ge}catch{}}}function Ti(L){L.I&&(_.clearTimeout(L.I),L.I=null)}n.isActive=function(){return!!this.g};function Ss(L){return L.g?L.g.readyState:0}n.Z=function(){try{return 2<Ss(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(L){if(this.g){var ae=this.g.responseText;return L&&ae.indexOf(L)==0&&(ae=ae.substring(L.length)),Kr(ae)}};function $s(L){try{if(!L.g)return null;if("response"in L.g)return L.g.response;switch(L.H){case"":case"text":return L.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in L.g)return L.g.mozResponseArrayBuffer}return null}catch{return null}}function aa(L){const ae={};L=(L.g&&2<=Ss(L)&&L.g.getAllResponseHeaders()||"").split(`\r
`);for(let Ge=0;Ge<L.length;Ge++){if(ne(L[Ge]))continue;var ve=j(L[Ge]);const Xt=ve[0];if(ve=ve[1],typeof ve!="string")continue;ve=ve.trim();const hn=ae[Xt]||[];ae[Xt]=hn,hn.push(ve)}pe(ae,function(Ge){return Ge.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function la(L,ae,ve){return ve&&ve.internalChannelParams&&ve.internalChannelParams[L]||ae}function cl(L){this.Aa=0,this.i=[],this.j=new kr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=la("failFast",!1,L),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=la("baseRetryDelayMs",5e3,L),this.cb=la("retryDelaySeedMs",1e4,L),this.Wa=la("forwardChannelMaxRetries",2,L),this.wa=la("forwardChannelRequestTimeoutMs",2e4,L),this.pa=L&&L.xmlHttpFactory||void 0,this.Xa=L&&L.Tb||void 0,this.Ca=L&&L.useFetchStreams||!1,this.L=void 0,this.J=L&&L.supportsCrossDomainXhr||!1,this.K="",this.h=new Aa(L&&L.concurrentRequestLimit),this.Da=new Us,this.P=L&&L.fastHandshake||!1,this.O=L&&L.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=L&&L.Rb||!1,L&&L.xa&&this.j.xa(),L&&L.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&L&&L.detectBufferingProxy||!1,this.ja=void 0,L&&L.longPollingTimeout&&0<L.longPollingTimeout&&(this.ja=L.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=cl.prototype,n.la=8,n.G=1,n.connect=function(L,ae,ve,Ge){vn(0),this.W=L,this.H=ae||{},ve&&Ge!==void 0&&(this.H.OSID=ve,this.H.OAID=Ge),this.F=this.X,this.I=Ro(this,null,this.W),W(this)};function Gs(L){if(xc(L),L.G==3){var ae=L.U++,ve=Nr(L.I);if(Mi(ve,"SID",L.K),Mi(ve,"RID",ae),Mi(ve,"TYPE","terminate"),yt(L,ve),ae=new io(L,L.j,ae),ae.L=2,ae.v=yl(Nr(ve)),ve=!1,_.navigator&&_.navigator.sendBeacon)try{ve=_.navigator.sendBeacon(ae.v.toString(),"")}catch{}!ve&&_.Image&&(new Image().src=ae.v,ve=!0),ve||(ae.g=zo(ae.j,null),ae.g.ea(ae.v)),ae.F=Date.now(),Eo(ae)}Yo(L)}function Hs(L){L.g&&(Dr(L),L.g.cancel(),L.g=null)}function xc(L){Hs(L),L.u&&(_.clearTimeout(L.u),L.u=null),yi(L),L.h.cancel(),L.s&&(typeof L.s=="number"&&_.clearTimeout(L.s),L.s=null)}function W(L){if(!sa(L.h)&&!L.s){L.s=!0;var ae=L.Ga;Ne||nt(),we||(Ne(),we=!0),Fe.add(ae,L),L.B=0}}function Ce(L,ae){return dn(L.h)>=L.h.j-(L.s?1:0)?!1:L.s?(L.i=ae.D.concat(L.i),!0):L.G==1||L.G==2||L.B>=(L.Va?0:L.Wa)?!1:(L.s=Tn(V(L.Ga,L,ae),xo(L,L.B)),L.B++,!0)}n.Ga=function(L){if(this.s)if(this.s=null,this.G==1){if(!L){this.U=Math.floor(1e5*Math.random()),L=this.U++;const Xt=new io(this,this.j,L);let hn=this.o;if(this.S&&(hn?(hn=U(hn),q(hn,this.S)):hn=this.S),this.m!==null||this.O||(Xt.H=hn,hn=null),this.P)e:{for(var ae=0,ve=0;ve<this.i.length;ve++){t:{var Ge=this.i[ve];if("__data__"in Ge.map&&(Ge=Ge.map.__data__,typeof Ge=="string")){Ge=Ge.length;break t}Ge=void 0}if(Ge===void 0)break;if(ae+=Ge,4096<ae){ae=ve;break e}if(ae===4096||ve===this.i.length-1){ae=ve+1;break e}}ae=1e3}else ae=1e3;ae=qt(this,Xt,ae),ve=Nr(this.I),Mi(ve,"RID",L),Mi(ve,"CVER",22),this.D&&Mi(ve,"X-HTTP-Session-Id",this.D),yt(this,ve),hn&&(this.O?ae="headers="+encodeURIComponent(String(Bo(hn)))+"&"+ae:this.m&&Bc(ve,this.m,hn)),ss(this.h,Xt),this.Ua&&Mi(ve,"TYPE","init"),this.P?(Mi(ve,"$req",ae),Mi(ve,"SID","null"),Xt.T=!0,sl(Xt,ve,null)):sl(Xt,ve,ae),this.G=2}}else this.G==3&&(L?pt(this,L):this.i.length==0||sa(this.h)||pt(this))};function pt(L,ae){var ve;ae?ve=ae.l:ve=L.U++;const Ge=Nr(L.I);Mi(Ge,"SID",L.K),Mi(Ge,"RID",ve),Mi(Ge,"AID",L.T),yt(L,Ge),L.m&&L.o&&Bc(Ge,L.m,L.o),ve=new io(L,L.j,ve,L.B+1),L.m===null&&(ve.H=L.o),ae&&(L.i=ae.D.concat(L.i)),ae=qt(L,ve,1e3),ve.I=Math.round(.5*L.wa)+Math.round(.5*L.wa*Math.random()),ss(L.h,ve),sl(ve,Ge,ae)}function yt(L,ae){L.H&&je(L.H,function(ve,Ge){Mi(ae,Ge,ve)}),L.l&&al({},function(ve,Ge){Mi(ae,Ge,ve)})}function qt(L,ae,ve){ve=Math.min(L.i.length,ve);var Ge=L.l?V(L.l.Na,L.l,L):null;e:{var Xt=L.i;let hn=-1;for(;;){const ar=["count="+ve];hn==-1?0<ve?(hn=Xt[0].g,ar.push("ofs="+hn)):hn=0:ar.push("ofs="+hn);let so=!0;for(let Fo=0;Fo<ve;Fo++){let Ki=Xt[Fo].g;const zi=Xt[Fo].map;if(Ki-=hn,0>Ki)hn=Math.max(0,Xt[Fo].g-100),so=!1;else try{ku(zi,ar,"req"+Ki+"_")}catch{Ge&&Ge(zi)}}if(so){Ge=ar.join("&");break e}}}return L=L.i.splice(0,ve),ae.D=L,Ge}function Zt(L){if(!L.g&&!L.u){L.Y=1;var ae=L.Fa;Ne||nt(),we||(Ne(),we=!0),Fe.add(ae,L),L.v=0}}function Fn(L){return L.g||L.u||3<=L.v?!1:(L.Y++,L.u=Tn(V(L.Fa,L),xo(L,L.v)),L.v++,!0)}n.Fa=function(){if(this.u=null,Xr(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var L=2*this.R;this.j.info("BP detection timer enabled: "+L),this.A=Tn(V(this.ab,this),L)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,vn(10),Hs(this),Xr(this))};function Dr(L){L.A!=null&&(_.clearTimeout(L.A),L.A=null)}function Xr(L){L.g=new io(L,L.j,"rpc",L.Y),L.m===null&&(L.g.H=L.o),L.g.O=0;var ae=Nr(L.qa);Mi(ae,"RID","rpc"),Mi(ae,"SID",L.K),Mi(ae,"AID",L.T),Mi(ae,"CI",L.F?"0":"1"),!L.F&&L.ja&&Mi(ae,"TO",L.ja),Mi(ae,"TYPE","xmlhttp"),yt(L,ae),L.m&&L.o&&Bc(ae,L.m,L.o),L.L&&(L.g.I=L.L);var ve=L.g;L=L.ia,ve.L=1,ve.v=yl(Nr(ae)),ve.m=null,ve.P=!0,Wi(ve,L)}n.Za=function(){this.C!=null&&(this.C=null,Hs(this),Fn(this),vn(19))};function yi(L){L.C!=null&&(_.clearTimeout(L.C),L.C=null)}function Ii(L,ae){var ve=null;if(L.g==ae){yi(L),Dr(L),L.g=null;var Ge=2}else if(Xo(L.h,ae))ve=ae.D,xi(L.h,ae),Ge=1;else return;if(L.G!=0){if(ae.o)if(Ge==1){ve=ae.m?ae.m.length:0,ae=Date.now()-ae.F;var Xt=L.B;Ge=Mt(),Mr(Ge,new Bn(Ge,ve)),W(L)}else Zt(L);else if(Xt=ae.s,Xt==3||Xt==0&&0<ae.X||!(Ge==1&&Ce(L,ae)||Ge==2&&Fn(L)))switch(ve&&0<ve.length&&(ae=L.h,ae.i=ae.i.concat(ve)),Xt){case 1:bo(L,5);break;case 4:bo(L,10);break;case 3:bo(L,6);break;default:bo(L,2)}}}function xo(L,ae){let ve=L.Ta+Math.floor(Math.random()*L.cb);return L.isActive()||(ve*=2),ve*ae}function bo(L,ae){if(L.j.info("Error code "+ae),ae==2){var ve=V(L.fb,L),Ge=L.Xa;const Xt=!Ge;Ge=new zr(Ge||"//www.google.com/images/cleardot.gif"),_.location&&_.location.protocol=="http"||js(Ge,"https"),yl(Ge),Xt?Ih(Ge.toString(),ve):Pu(Ge.toString(),ve)}else vn(2);L.G=0,L.l&&L.l.sa(ae),Yo(L),xc(L)}n.fb=function(L){L?(this.j.info("Successfully pinged google.com"),vn(2)):(this.j.info("Failed to ping google.com"),vn(1))};function Yo(L){if(L.G=0,L.ka=[],L.l){const ae=pu(L.h);(ae.length!=0||L.i.length!=0)&&(fe(L.ka,ae),fe(L.ka,L.i),L.h.i.length=0,se(L.i),L.i.length=0),L.l.ra()}}function Ro(L,ae,ve){var Ge=ve instanceof zr?Nr(ve):new zr(ve);if(Ge.g!="")ae&&(Ge.g=ae+"."+Ge.g),Ta(Ge,Ge.s);else{var Xt=_.location;Ge=Xt.protocol,ae=ae?ae+"."+Xt.hostname:Xt.hostname,Xt=+Xt.port;var hn=new zr(null);Ge&&js(hn,Ge),ae&&(hn.g=ae),Xt&&Ta(hn,Xt),ve&&(hn.l=ve),Ge=hn}return ve=L.D,ae=L.ya,ve&&ae&&Mi(Ge,ve,ae),Mi(Ge,"VER",L.la),yt(L,Ge),Ge}function zo(L,ae,ve){if(ae&&!L.J)throw Error("Can't create secondary domain capable XhrIo object.");return ae=L.Ca&&!L.pa?new Ho(new Go({eb:ve})):new Ho(L.pa),ae.Ha(L.J),ae}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Jo(){}n=Jo.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function us(){}us.prototype.g=function(L,ae){return new jo(L,ae)};function jo(L,ae){Dn.call(this),this.g=new cl(ae),this.l=L,this.h=ae&&ae.messageUrlParams||null,L=ae&&ae.messageHeaders||null,ae&&ae.clientProtocolHeaderRequired&&(L?L["X-Client-Protocol"]="webchannel":L={"X-Client-Protocol":"webchannel"}),this.g.o=L,L=ae&&ae.initMessageHeaders||null,ae&&ae.messageContentType&&(L?L["X-WebChannel-Content-Type"]=ae.messageContentType:L={"X-WebChannel-Content-Type":ae.messageContentType}),ae&&ae.va&&(L?L["X-WebChannel-Client-Profile"]=ae.va:L={"X-WebChannel-Client-Profile":ae.va}),this.g.S=L,(L=ae&&ae.Sb)&&!ne(L)&&(this.g.m=L),this.v=ae&&ae.supportsCrossDomainXhr||!1,this.u=ae&&ae.sendRawJson||!1,(ae=ae&&ae.httpSessionIdParam)&&!ne(ae)&&(this.g.D=ae,L=this.h,L!==null&&ae in L&&(L=this.h,ae in L&&delete L[ae])),this.j=new Qa(this)}ie(jo,Dn),jo.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},jo.prototype.close=function(){Gs(this.g)},jo.prototype.o=function(L){var ae=this.g;if(typeof L=="string"){var ve={};ve.__data__=L,L=ve}else this.u&&(ve={},ve.__data__=oi(L),L=ve);ae.i.push(new Ql(ae.Ya++,L)),ae.G==3&&W(ae)},jo.prototype.N=function(){this.g.l=null,delete this.j,Gs(this.g),delete this.g,jo.aa.N.call(this)};function Es(L){Ie.call(this),L.__headers__&&(this.headers=L.__headers__,this.statusCode=L.__status__,delete L.__headers__,delete L.__status__);var ae=L.__sm__;if(ae){e:{for(const ve in ae){L=ve;break e}L=void 0}(this.i=L)&&(L=this.i,ae=ae!==null&&L in ae?ae[L]:void 0),this.data=ae}else this.data=L}ie(Es,Ie);function zc(){Qe.call(this),this.status=1}ie(zc,Qe);function Qa(L){this.g=L}ie(Qa,Jo),Qa.prototype.ua=function(){Mr(this.g,"a")},Qa.prototype.ta=function(L){Mr(this.g,new Es(L))},Qa.prototype.sa=function(L){Mr(this.g,new zc)},Qa.prototype.ra=function(){Mr(this.g,"b")},us.prototype.createWebChannel=us.prototype.g,jo.prototype.send=jo.prototype.o,jo.prototype.open=jo.prototype.m,jo.prototype.close=jo.prototype.close,m9=function(){return new us},p9=function(){return Mt()},f9=ht,R5={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},yo.NO_ERROR=0,yo.TIMEOUT=8,yo.HTTP_ERROR=6,H1=yo,$o.COMPLETE="complete",d9=$o,ut.EventType=Ee,Ee.OPEN="a",Ee.CLOSE="b",Ee.ERROR="c",Ee.MESSAGE="d",Dn.prototype.listen=Dn.prototype.K,Py=ut,Ho.prototype.listenOnce=Ho.prototype.L,Ho.prototype.getLastError=Ho.prototype.Ka,Ho.prototype.getLastErrorCode=Ho.prototype.Ba,Ho.prototype.getStatus=Ho.prototype.Z,Ho.prototype.getResponseJson=Ho.prototype.Oa,Ho.prototype.getResponseText=Ho.prototype.oa,Ho.prototype.send=Ho.prototype.ea,Ho.prototype.setWithCredentials=Ho.prototype.Ha,h9=Ho}).apply(typeof x1<"u"?x1:typeof self<"u"?self:typeof window<"u"?window:{});const oE="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eh{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Eh.UNAUTHENTICATED=new Eh(null),Eh.GOOGLE_CREDENTIALS=new Eh("google-credentials-uid"),Eh.FIRST_PARTY=new Eh("first-party-uid"),Eh.MOCK_USER=new Eh("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let O0="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ig=new Aw("@firebase/firestore");function Ey(){return ig.logLevel}function vi(n,...e){if(ig.logLevel<=gs.DEBUG){const t=e.map(Cw);ig.debug(`Firestore (${O0}): ${n}`,...t)}}function Tp(n,...e){if(ig.logLevel<=gs.ERROR){const t=e.map(Cw);ig.error(`Firestore (${O0}): ${n}`,...t)}}function S0(n,...e){if(ig.logLevel<=gs.WARN){const t=e.map(Cw);ig.warn(`Firestore (${O0}): ${n}`,...t)}}function Cw(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(t){return JSON.stringify(t)})(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function go(n="Unexpected state"){const e=`FIRESTORE (${O0}) INTERNAL ASSERTION FAILED: `+n;throw Tp(e),new Error(e)}function Sa(n,e){n||go()}function Co(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yn={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class hi extends Pp{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bp{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g9{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class aD{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Eh.UNAUTHENTICATED)))}shutdown(){}}class lD{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class cD{constructor(e){this.t=e,this.currentUser=Eh.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Sa(this.o===void 0);let i=this.i;const c=o=>this.i!==i?(i=this.i,t(o)):Promise.resolve();let u=new bp;this.o=()=>{this.i++,this.currentUser=this.u(),u.resolve(),u=new bp,e.enqueueRetryable((()=>c(this.currentUser)))};const m=()=>{const o=u;e.enqueueRetryable((async()=>{await o.promise,await c(this.currentUser)}))},_=o=>{vi("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=o,this.o&&(this.auth.addAuthTokenListener(this.o),m())};this.t.onInit((o=>_(o))),setTimeout((()=>{if(!this.auth){const o=this.t.getImmediate({optional:!0});o?_(o):(vi("FirebaseAuthCredentialsProvider","Auth not yet detected"),u.resolve(),u=new bp)}}),0),m()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((i=>this.i!==e?(vi("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(Sa(typeof i.accessToken=="string"),new g9(i.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Sa(e===null||typeof e=="string"),new Eh(e)}}class uD{constructor(e,t,i){this.l=e,this.h=t,this.P=i,this.type="FirstParty",this.user=Eh.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class hD{constructor(e,t,i){this.l=e,this.h=t,this.P=i}getToken(){return Promise.resolve(new uD(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable((()=>t(Eh.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class dD{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class fD{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){Sa(this.o===void 0);const i=u=>{u.error!=null&&vi("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${u.error.message}`);const m=u.token!==this.R;return this.R=u.token,vi("FirebaseAppCheckTokenProvider",`Received ${m?"new":"existing"} token.`),m?t(u.token):Promise.resolve()};this.o=u=>{e.enqueueRetryable((()=>i(u)))};const c=u=>{vi("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=u,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit((u=>c(u))),setTimeout((()=>{if(!this.appCheck){const u=this.A.getImmediate({optional:!0});u?c(u):vi("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(Sa(typeof t.token=="string"),this.R=t.token,new dD(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pD(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let i=0;i<n;i++)t[i]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y9{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let i="";for(;i.length<20;){const c=pD(40);for(let u=0;u<c.length;++u)i.length<20&&c[u]<t&&(i+=e.charAt(c[u]%e.length))}return i}}function zs(n,e){return n<e?-1:n>e?1:0}function E0(n,e,t){return n.length===e.length&&n.every(((i,c)=>t(i,e[c])))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class du{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new hi(Yn.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new hi(Yn.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new hi(Yn.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new hi(Yn.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return du.fromMillis(Date.now())}static fromDate(e){return du.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),i=Math.floor(1e6*(e-1e3*t));return new du(t,i)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?zs(this.nanoseconds,e.nanoseconds):zs(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Io{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Io(e)}static min(){return new Io(new du(0,0))}static max(){return new Io(new du(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a_{constructor(e,t,i){t===void 0?t=0:t>e.length&&go(),i===void 0?i=e.length-t:i>e.length-t&&go(),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return a_.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof a_?e.forEach((i=>{t.push(i)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const i=Math.min(e.length,t.length);for(let c=0;c<i;c++){const u=e.get(c),m=t.get(c);if(u<m)return-1;if(u>m)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class pl extends a_{construct(e,t,i){return new pl(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const i of e){if(i.indexOf("//")>=0)throw new hi(Yn.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter((c=>c.length>0)))}return new pl(t)}static emptyPath(){return new pl([])}}const mD=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Yu extends a_{construct(e,t,i){return new Yu(e,t,i)}static isValidIdentifier(e){return mD.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Yu.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Yu(["__name__"])}static fromServerFormat(e){const t=[];let i="",c=0;const u=()=>{if(i.length===0)throw new hi(Yn.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""};let m=!1;for(;c<e.length;){const _=e[c];if(_==="\\"){if(c+1===e.length)throw new hi(Yn.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const o=e[c+1];if(o!=="\\"&&o!=="."&&o!=="`")throw new hi(Yn.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=o,c+=2}else _==="`"?(m=!m,c++):_!=="."||m?(i+=_,c++):(u(),c++)}if(u(),m)throw new hi(Yn.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Yu(t)}static emptyPath(){return new Yu([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $i{constructor(e){this.path=e}static fromPath(e){return new $i(pl.fromString(e))}static fromName(e){return new $i(pl.fromString(e).popFirst(5))}static empty(){return new $i(pl.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&pl.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return pl.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new $i(new pl(e.slice()))}}function gD(n,e){const t=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,c=Io.fromTimestamp(i===1e9?new du(t+1,0):new du(t,i));return new fm(c,$i.empty(),e)}function yD(n){return new fm(n.readTime,n.key,-1)}class fm{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new fm(Io.min(),$i.empty(),-1)}static max(){return new fm(Io.max(),$i.empty(),-1)}}function _D(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=$i.comparator(n.documentKey,e.documentKey),t!==0?t:zs(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vD="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class xD{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function E_(n){if(n.code!==Yn.FAILED_PRECONDITION||n.message!==vD)throw n;vi("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ur{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&go(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new ur(((i,c)=>{this.nextCallback=u=>{this.wrapSuccess(e,u).next(i,c)},this.catchCallback=u=>{this.wrapFailure(t,u).next(i,c)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof ur?t:ur.resolve(t)}catch(t){return ur.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):ur.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):ur.reject(t)}static resolve(e){return new ur(((t,i)=>{t(e)}))}static reject(e){return new ur(((t,i)=>{i(e)}))}static waitFor(e){return new ur(((t,i)=>{let c=0,u=0,m=!1;e.forEach((_=>{++c,_.next((()=>{++u,m&&u===c&&t()}),(o=>i(o)))})),m=!0,u===c&&t()}))}static or(e){let t=ur.resolve(!1);for(const i of e)t=t.next((c=>c?ur.resolve(c):i()));return t}static forEach(e,t){const i=[];return e.forEach(((c,u)=>{i.push(t.call(this,c,u))})),this.waitFor(i)}static mapArray(e,t){return new ur(((i,c)=>{const u=e.length,m=new Array(u);let _=0;for(let o=0;o<u;o++){const b=o;t(e[b]).next((I=>{m[b]=I,++_,_===u&&i(m)}),(I=>c(I)))}}))}static doWhile(e,t){return new ur(((i,c)=>{const u=()=>{e()===!0?t().next((()=>{u()}),c):i()};u()}))}}function bD(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function A_(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lw{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=i=>this.ie(i),this.se=i=>t.writeSequenceNumber(i))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}Lw.oe=-1;function nx(n){return n==null}function xv(n){return n===0&&1/n==-1/0}function wD(n){return typeof n=="number"&&Number.isInteger(n)&&!xv(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sE(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function B0(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function _9(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yl{constructor(e,t){this.comparator=e,this.root=t||Zu.EMPTY}insert(e,t){return new Yl(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Zu.BLACK,null,null))}remove(e){return new Yl(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Zu.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const i=this.comparator(e,t.key);if(i===0)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){const c=this.comparator(e,i.key);if(c===0)return t+i.left.size;c<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,i)=>(e(t,i),!1)))}toString(){const e=[];return this.inorderTraversal(((t,i)=>(e.push(`${t}:${i}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new b1(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new b1(this.root,e,this.comparator,!1)}getReverseIterator(){return new b1(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new b1(this.root,e,this.comparator,!0)}}class b1{constructor(e,t,i,c){this.isReverse=c,this.nodeStack=[];let u=1;for(;!e.isEmpty();)if(u=t?i(e.key,t):1,t&&c&&(u*=-1),u<0)e=this.isReverse?e.left:e.right;else{if(u===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Zu{constructor(e,t,i,c,u){this.key=e,this.value=t,this.color=i??Zu.RED,this.left=c??Zu.EMPTY,this.right=u??Zu.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,i,c,u){return new Zu(e??this.key,t??this.value,i??this.color,c??this.left,u??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let c=this;const u=i(e,c.key);return c=u<0?c.copy(null,null,null,c.left.insert(e,t,i),null):u===0?c.copy(null,t,null,null,null):c.copy(null,null,null,null,c.right.insert(e,t,i)),c.fixUp()}removeMin(){if(this.left.isEmpty())return Zu.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let i,c=this;if(t(e,c.key)<0)c.left.isEmpty()||c.left.isRed()||c.left.left.isRed()||(c=c.moveRedLeft()),c=c.copy(null,null,null,c.left.remove(e,t),null);else{if(c.left.isRed()&&(c=c.rotateRight()),c.right.isEmpty()||c.right.isRed()||c.right.left.isRed()||(c=c.moveRedRight()),t(e,c.key)===0){if(c.right.isEmpty())return Zu.EMPTY;i=c.right.min(),c=c.copy(i.key,i.value,null,null,c.right.removeMin())}c=c.copy(null,null,null,null,c.right.remove(e,t))}return c.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Zu.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Zu.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw go();const e=this.left.check();if(e!==this.right.check())throw go();return e+(this.isRed()?0:1)}}Zu.EMPTY=null,Zu.RED=!0,Zu.BLACK=!1;Zu.EMPTY=new class{constructor(){this.size=0}get key(){throw go()}get value(){throw go()}get color(){throw go()}get left(){throw go()}get right(){throw go()}copy(e,t,i,c,u){return this}insert(e,t,i){return new Zu(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ju{constructor(e){this.comparator=e,this.data=new Yl(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,i)=>(e(t),!1)))}forEachInRange(e,t){const i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){const c=i.getNext();if(this.comparator(c.key,e[1])>=0)return;t(c.key)}}forEachWhile(e,t){let i;for(i=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new aE(this.data.getIterator())}getIteratorFrom(e){return new aE(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((i=>{t=t.add(i)})),t}isEqual(e){if(!(e instanceof Ju)||this.size!==e.size)return!1;const t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){const c=t.getNext().key,u=i.getNext().key;if(this.comparator(c,u)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Ju(this.comparator);return t.data=e,t}}class aE{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tf{constructor(e){this.fields=e,e.sort(Yu.comparator)}static empty(){return new tf([])}unionWith(e){let t=new Ju(Yu.comparator);for(const i of this.fields)t=t.add(i);for(const i of e)t=t.add(i);return new tf(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return E0(this.fields,e.fields,((t,i)=>t.isEqual(i)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v9 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qu{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(c){try{return atob(c)}catch(u){throw typeof DOMException<"u"&&u instanceof DOMException?new v9("Invalid base64 string: "+u):u}})(e);return new Qu(t)}static fromUint8Array(e){const t=(function(c){let u="";for(let m=0;m<c.length;++m)u+=String.fromCharCode(c[m]);return u})(e);return new Qu(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const i=new Uint8Array(t.length);for(let c=0;c<t.length;c++)i[c]=t.charCodeAt(c);return i})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return zs(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Qu.EMPTY_BYTE_STRING=new Qu("");const SD=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function pm(n){if(Sa(!!n),typeof n=="string"){let e=0;const t=SD.exec(n);if(Sa(!!t),t[1]){let c=t[1];c=(c+"000000000").substr(0,9),e=Number(c)}const i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Nc(n.seconds),nanos:Nc(n.nanos)}}function Nc(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function og(n){return typeof n=="string"?Qu.fromBase64String(n):Qu.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pw(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function kw(n){const e=n.mapValue.fields.__previous_value__;return Pw(e)?kw(e):e}function l_(n){const e=pm(n.mapValue.fields.__local_write_time__.timestampValue);return new du(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ED{constructor(e,t,i,c,u,m,_,o,b){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=c,this.ssl=u,this.forceLongPolling=m,this.autoDetectLongPolling=_,this.longPollingOptions=o,this.useFetchStreams=b}}class c_{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new c_("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof c_&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w1={mapValue:{}};function sg(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Pw(n)?4:TD(n)?9007199254740991:AD(n)?10:11:go()}function Hf(n,e){if(n===e)return!0;const t=sg(n);if(t!==sg(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return l_(n).isEqual(l_(e));case 3:return(function(c,u){if(typeof c.timestampValue=="string"&&typeof u.timestampValue=="string"&&c.timestampValue.length===u.timestampValue.length)return c.timestampValue===u.timestampValue;const m=pm(c.timestampValue),_=pm(u.timestampValue);return m.seconds===_.seconds&&m.nanos===_.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(c,u){return og(c.bytesValue).isEqual(og(u.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(c,u){return Nc(c.geoPointValue.latitude)===Nc(u.geoPointValue.latitude)&&Nc(c.geoPointValue.longitude)===Nc(u.geoPointValue.longitude)})(n,e);case 2:return(function(c,u){if("integerValue"in c&&"integerValue"in u)return Nc(c.integerValue)===Nc(u.integerValue);if("doubleValue"in c&&"doubleValue"in u){const m=Nc(c.doubleValue),_=Nc(u.doubleValue);return m===_?xv(m)===xv(_):isNaN(m)&&isNaN(_)}return!1})(n,e);case 9:return E0(n.arrayValue.values||[],e.arrayValue.values||[],Hf);case 10:case 11:return(function(c,u){const m=c.mapValue.fields||{},_=u.mapValue.fields||{};if(sE(m)!==sE(_))return!1;for(const o in m)if(m.hasOwnProperty(o)&&(_[o]===void 0||!Hf(m[o],_[o])))return!1;return!0})(n,e);default:return go()}}function u_(n,e){return(n.values||[]).find((t=>Hf(t,e)))!==void 0}function A0(n,e){if(n===e)return 0;const t=sg(n),i=sg(e);if(t!==i)return zs(t,i);switch(t){case 0:case 9007199254740991:return 0;case 1:return zs(n.booleanValue,e.booleanValue);case 2:return(function(u,m){const _=Nc(u.integerValue||u.doubleValue),o=Nc(m.integerValue||m.doubleValue);return _<o?-1:_>o?1:_===o?0:isNaN(_)?isNaN(o)?0:-1:1})(n,e);case 3:return lE(n.timestampValue,e.timestampValue);case 4:return lE(l_(n),l_(e));case 5:return zs(n.stringValue,e.stringValue);case 6:return(function(u,m){const _=og(u),o=og(m);return _.compareTo(o)})(n.bytesValue,e.bytesValue);case 7:return(function(u,m){const _=u.split("/"),o=m.split("/");for(let b=0;b<_.length&&b<o.length;b++){const I=zs(_[b],o[b]);if(I!==0)return I}return zs(_.length,o.length)})(n.referenceValue,e.referenceValue);case 8:return(function(u,m){const _=zs(Nc(u.latitude),Nc(m.latitude));return _!==0?_:zs(Nc(u.longitude),Nc(m.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return cE(n.arrayValue,e.arrayValue);case 10:return(function(u,m){var _,o,b,I;const M=u.fields||{},V=m.fields||{},k=(_=M.value)===null||_===void 0?void 0:_.arrayValue,ie=(o=V.value)===null||o===void 0?void 0:o.arrayValue,se=zs(((b=k?.values)===null||b===void 0?void 0:b.length)||0,((I=ie?.values)===null||I===void 0?void 0:I.length)||0);return se!==0?se:cE(k,ie)})(n.mapValue,e.mapValue);case 11:return(function(u,m){if(u===w1.mapValue&&m===w1.mapValue)return 0;if(u===w1.mapValue)return 1;if(m===w1.mapValue)return-1;const _=u.fields||{},o=Object.keys(_),b=m.fields||{},I=Object.keys(b);o.sort(),I.sort();for(let M=0;M<o.length&&M<I.length;++M){const V=zs(o[M],I[M]);if(V!==0)return V;const k=A0(_[o[M]],b[I[M]]);if(k!==0)return k}return zs(o.length,I.length)})(n.mapValue,e.mapValue);default:throw go()}}function lE(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return zs(n,e);const t=pm(n),i=pm(e),c=zs(t.seconds,i.seconds);return c!==0?c:zs(t.nanos,i.nanos)}function cE(n,e){const t=n.values||[],i=e.values||[];for(let c=0;c<t.length&&c<i.length;++c){const u=A0(t[c],i[c]);if(u)return u}return zs(t.length,i.length)}function T0(n){return M5(n)}function M5(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const i=pm(t);return`time(${i.seconds},${i.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return og(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return $i.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let i="[",c=!0;for(const u of t.values||[])c?c=!1:i+=",",i+=M5(u);return i+"]"})(n.arrayValue):"mapValue"in n?(function(t){const i=Object.keys(t.fields||{}).sort();let c="{",u=!0;for(const m of i)u?u=!1:c+=",",c+=`${m}:${M5(t.fields[m])}`;return c+"}"})(n.mapValue):go()}function uE(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function N5(n){return!!n&&"integerValue"in n}function Rw(n){return!!n&&"arrayValue"in n}function hE(n){return!!n&&"nullValue"in n}function dE(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function W1(n){return!!n&&"mapValue"in n}function AD(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function $y(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return B0(n.mapValue.fields,((t,i)=>e.mapValue.fields[t]=$y(i))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=$y(n.arrayValue.values[t]);return e}return Object.assign({},n)}function TD(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rd{constructor(e){this.value=e}static empty(){return new Rd({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!W1(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=$y(t)}setAll(e){let t=Yu.emptyPath(),i={},c=[];e.forEach(((m,_)=>{if(!t.isImmediateParentOf(_)){const o=this.getFieldsMap(t);this.applyChanges(o,i,c),i={},c=[],t=_.popLast()}m?i[_.lastSegment()]=$y(m):c.push(_.lastSegment())}));const u=this.getFieldsMap(t);this.applyChanges(u,i,c)}delete(e){const t=this.field(e.popLast());W1(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Hf(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let c=t.mapValue.fields[e.get(i)];W1(c)&&c.mapValue.fields||(c={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=c),t=c}return t.mapValue.fields}applyChanges(e,t,i){B0(t,((c,u)=>e[c]=u));for(const c of i)delete e[c]}clone(){return new Rd($y(this.value))}}function x9(n){const e=[];return B0(n.fields,((t,i)=>{const c=new Yu([t]);if(W1(i)){const u=x9(i.mapValue).fields;if(u.length===0)e.push(c);else for(const m of u)e.push(c.child(m))}else e.push(c)})),new tf(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ah{constructor(e,t,i,c,u,m,_){this.key=e,this.documentType=t,this.version=i,this.readTime=c,this.createTime=u,this.data=m,this.documentState=_}static newInvalidDocument(e){return new Ah(e,0,Io.min(),Io.min(),Io.min(),Rd.empty(),0)}static newFoundDocument(e,t,i,c){return new Ah(e,1,t,Io.min(),i,c,0)}static newNoDocument(e,t){return new Ah(e,2,t,Io.min(),Io.min(),Rd.empty(),0)}static newUnknownDocument(e,t){return new Ah(e,3,t,Io.min(),Io.min(),Rd.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Io.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Rd.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Rd.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Io.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Ah&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ah(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bv{constructor(e,t){this.position=e,this.inclusive=t}}function fE(n,e,t){let i=0;for(let c=0;c<n.position.length;c++){const u=e[c],m=n.position[c];if(u.field.isKeyField()?i=$i.comparator($i.fromName(m.referenceValue),t.key):i=A0(m,t.data.field(u.field)),u.dir==="desc"&&(i*=-1),i!==0)break}return i}function pE(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Hf(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wv{constructor(e,t="asc"){this.field=e,this.dir=t}}function ID(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b9{}class eu extends b9{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,i):new LD(e,t,i):t==="array-contains"?new RD(e,i):t==="in"?new MD(e,i):t==="not-in"?new ND(e,i):t==="array-contains-any"?new DD(e,i):new eu(e,t,i)}static createKeyFieldInFilter(e,t,i){return t==="in"?new PD(e,i):new kD(e,i)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(A0(t,this.value)):t!==null&&sg(this.value)===sg(t)&&this.matchesComparison(A0(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return go()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class sf extends b9{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new sf(e,t)}matches(e){return w9(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function w9(n){return n.op==="and"}function S9(n){return CD(n)&&w9(n)}function CD(n){for(const e of n.filters)if(e instanceof sf)return!1;return!0}function D5(n){if(n instanceof eu)return n.field.canonicalString()+n.op.toString()+T0(n.value);if(S9(n))return n.filters.map((e=>D5(e))).join(",");{const e=n.filters.map((t=>D5(t))).join(",");return`${n.op}(${e})`}}function E9(n,e){return n instanceof eu?(function(i,c){return c instanceof eu&&i.op===c.op&&i.field.isEqual(c.field)&&Hf(i.value,c.value)})(n,e):n instanceof sf?(function(i,c){return c instanceof sf&&i.op===c.op&&i.filters.length===c.filters.length?i.filters.reduce(((u,m,_)=>u&&E9(m,c.filters[_])),!0):!1})(n,e):void go()}function A9(n){return n instanceof eu?(function(t){return`${t.field.canonicalString()} ${t.op} ${T0(t.value)}`})(n):n instanceof sf?(function(t){return t.op.toString()+" {"+t.getFilters().map(A9).join(" ,")+"}"})(n):"Filter"}class LD extends eu{constructor(e,t,i){super(e,t,i),this.key=$i.fromName(i.referenceValue)}matches(e){const t=$i.comparator(e.key,this.key);return this.matchesComparison(t)}}class PD extends eu{constructor(e,t){super(e,"in",t),this.keys=T9("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class kD extends eu{constructor(e,t){super(e,"not-in",t),this.keys=T9("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function T9(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map((i=>$i.fromName(i.referenceValue)))}class RD extends eu{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Rw(t)&&u_(t.arrayValue,this.value)}}class MD extends eu{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&u_(this.value.arrayValue,t)}}class ND extends eu{constructor(e,t){super(e,"not-in",t)}matches(e){if(u_(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!u_(this.value.arrayValue,t)}}class DD extends eu{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Rw(t)||!t.arrayValue.values)&&t.arrayValue.values.some((i=>u_(this.value.arrayValue,i)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FD{constructor(e,t=null,i=[],c=[],u=null,m=null,_=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=c,this.limit=u,this.startAt=m,this.endAt=_,this.ue=null}}function mE(n,e=null,t=[],i=[],c=null,u=null,m=null){return new FD(n,e,t,i,c,u,m)}function Mw(n){const e=Co(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((i=>D5(i))).join(","),t+="|ob:",t+=e.orderBy.map((i=>(function(u){return u.field.canonicalString()+u.dir})(i))).join(","),nx(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((i=>T0(i))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((i=>T0(i))).join(",")),e.ue=t}return e.ue}function Nw(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!ID(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!E9(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!pE(n.startAt,e.startAt)&&pE(n.endAt,e.endAt)}function F5(n){return $i.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T_{constructor(e,t=null,i=[],c=[],u=null,m="F",_=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=c,this.limit=u,this.limitType=m,this.startAt=_,this.endAt=o,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function OD(n,e,t,i,c,u,m,_){return new T_(n,e,t,i,c,u,m,_)}function rx(n){return new T_(n)}function gE(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function I9(n){return n.collectionGroup!==null}function Gy(n){const e=Co(n);if(e.ce===null){e.ce=[];const t=new Set;for(const u of e.explicitOrderBy)e.ce.push(u),t.add(u.field.canonicalString());const i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(m){let _=new Ju(Yu.comparator);return m.filters.forEach((o=>{o.getFlattenedFilters().forEach((b=>{b.isInequality()&&(_=_.add(b.field))}))})),_})(e).forEach((u=>{t.has(u.canonicalString())||u.isKeyField()||e.ce.push(new wv(u,i))})),t.has(Yu.keyField().canonicalString())||e.ce.push(new wv(Yu.keyField(),i))}return e.ce}function jf(n){const e=Co(n);return e.le||(e.le=BD(e,Gy(n))),e.le}function BD(n,e){if(n.limitType==="F")return mE(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((c=>{const u=c.dir==="desc"?"asc":"desc";return new wv(c.field,u)}));const t=n.endAt?new bv(n.endAt.position,n.endAt.inclusive):null,i=n.startAt?new bv(n.startAt.position,n.startAt.inclusive):null;return mE(n.path,n.collectionGroup,e,n.filters,n.limit,t,i)}}function O5(n,e){const t=n.filters.concat([e]);return new T_(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function B5(n,e,t){return new T_(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function ix(n,e){return Nw(jf(n),jf(e))&&n.limitType===e.limitType}function C9(n){return`${Mw(jf(n))}|lt:${n.limitType}`}function n0(n){return`Query(target=${(function(t){let i=t.path.canonicalString();return t.collectionGroup!==null&&(i+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(i+=`, filters: [${t.filters.map((c=>A9(c))).join(", ")}]`),nx(t.limit)||(i+=", limit: "+t.limit),t.orderBy.length>0&&(i+=`, orderBy: [${t.orderBy.map((c=>(function(m){return`${m.field.canonicalString()} (${m.dir})`})(c))).join(", ")}]`),t.startAt&&(i+=", startAt: ",i+=t.startAt.inclusive?"b:":"a:",i+=t.startAt.position.map((c=>T0(c))).join(",")),t.endAt&&(i+=", endAt: ",i+=t.endAt.inclusive?"a:":"b:",i+=t.endAt.position.map((c=>T0(c))).join(",")),`Target(${i})`})(jf(n))}; limitType=${n.limitType})`}function ox(n,e){return e.isFoundDocument()&&(function(i,c){const u=c.key.path;return i.collectionGroup!==null?c.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(u):$i.isDocumentKey(i.path)?i.path.isEqual(u):i.path.isImmediateParentOf(u)})(n,e)&&(function(i,c){for(const u of Gy(i))if(!u.field.isKeyField()&&c.data.field(u.field)===null)return!1;return!0})(n,e)&&(function(i,c){for(const u of i.filters)if(!u.matches(c))return!1;return!0})(n,e)&&(function(i,c){return!(i.startAt&&!(function(m,_,o){const b=fE(m,_,o);return m.inclusive?b<=0:b<0})(i.startAt,Gy(i),c)||i.endAt&&!(function(m,_,o){const b=fE(m,_,o);return m.inclusive?b>=0:b>0})(i.endAt,Gy(i),c))})(n,e)}function zD(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function L9(n){return(e,t)=>{let i=!1;for(const c of Gy(n)){const u=jD(c,e,t);if(u!==0)return u;i=i||c.field.isKeyField()}return 0}}function jD(n,e,t){const i=n.field.isKeyField()?$i.comparator(e.key,t.key):(function(u,m,_){const o=m.data.field(u),b=_.data.field(u);return o!==null&&b!==null?A0(o,b):go()})(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return go()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z0{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i!==void 0){for(const[c,u]of i)if(this.equalsFn(c,e))return u}}has(e){return this.get(e)!==void 0}set(e,t){const i=this.mapKeyFn(e),c=this.inner[i];if(c===void 0)return this.inner[i]=[[e,t]],void this.innerSize++;for(let u=0;u<c.length;u++)if(this.equalsFn(c[u][0],e))return void(c[u]=[e,t]);c.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i===void 0)return!1;for(let c=0;c<i.length;c++)if(this.equalsFn(i[c][0],e))return i.length===1?delete this.inner[t]:i.splice(c,1),this.innerSize--,!0;return!1}forEach(e){B0(this.inner,((t,i)=>{for(const[c,u]of i)e(c,u)}))}isEmpty(){return _9(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UD=new Yl($i.comparator);function Ip(){return UD}const P9=new Yl($i.comparator);function ky(...n){let e=P9;for(const t of n)e=e.insert(t.key,t);return e}function k9(n){let e=P9;return n.forEach(((t,i)=>e=e.insert(t,i.overlayedDocument))),e}function Xm(){return Hy()}function R9(){return Hy()}function Hy(){return new z0((n=>n.toString()),((n,e)=>n.isEqual(e)))}const VD=new Yl($i.comparator),qD=new Ju($i.comparator);function ds(...n){let e=qD;for(const t of n)e=e.add(t);return e}const $D=new Ju(zs);function GD(){return $D}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dw(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:xv(e)?"-0":e}}function M9(n){return{integerValue:""+n}}function HD(n,e){return wD(e)?M9(e):Dw(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sx{constructor(){this._=void 0}}function WD(n,e,t){return n instanceof h_?(function(c,u){const m={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:c.seconds,nanos:c.nanoseconds}}}};return u&&Pw(u)&&(u=kw(u)),u&&(m.fields.__previous_value__=u),{mapValue:m}})(t,e):n instanceof d_?D9(n,e):n instanceof f_?F9(n,e):(function(c,u){const m=N9(c,u),_=yE(m)+yE(c.Pe);return N5(m)&&N5(c.Pe)?M9(_):Dw(c.serializer,_)})(n,e)}function KD(n,e,t){return n instanceof d_?D9(n,e):n instanceof f_?F9(n,e):t}function N9(n,e){return n instanceof Sv?(function(i){return N5(i)||(function(u){return!!u&&"doubleValue"in u})(i)})(e)?e:{integerValue:0}:null}class h_ extends sx{}class d_ extends sx{constructor(e){super(),this.elements=e}}function D9(n,e){const t=O9(e);for(const i of n.elements)t.some((c=>Hf(c,i)))||t.push(i);return{arrayValue:{values:t}}}class f_ extends sx{constructor(e){super(),this.elements=e}}function F9(n,e){let t=O9(e);for(const i of n.elements)t=t.filter((c=>!Hf(c,i)));return{arrayValue:{values:t}}}class Sv extends sx{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function yE(n){return Nc(n.integerValue||n.doubleValue)}function O9(n){return Rw(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XD{constructor(e,t){this.field=e,this.transform=t}}function ZD(n,e){return n.field.isEqual(e.field)&&(function(i,c){return i instanceof d_&&c instanceof d_||i instanceof f_&&c instanceof f_?E0(i.elements,c.elements,Hf):i instanceof Sv&&c instanceof Sv?Hf(i.Pe,c.Pe):i instanceof h_&&c instanceof h_})(n.transform,e.transform)}class YD{constructor(e,t){this.version=e,this.transformResults=t}}class Uf{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Uf}static exists(e){return new Uf(void 0,e)}static updateTime(e){return new Uf(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function K1(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class ax{}function B9(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new j9(n.key,Uf.none()):new I_(n.key,n.data,Uf.none());{const t=n.data,i=Rd.empty();let c=new Ju(Yu.comparator);for(let u of e.fields)if(!c.has(u)){let m=t.field(u);m===null&&u.length>1&&(u=u.popLast(),m=t.field(u)),m===null?i.delete(u):i.set(u,m),c=c.add(u)}return new mg(n.key,i,new tf(c.toArray()),Uf.none())}}function JD(n,e,t){n instanceof I_?(function(c,u,m){const _=c.value.clone(),o=vE(c.fieldTransforms,u,m.transformResults);_.setAll(o),u.convertToFoundDocument(m.version,_).setHasCommittedMutations()})(n,e,t):n instanceof mg?(function(c,u,m){if(!K1(c.precondition,u))return void u.convertToUnknownDocument(m.version);const _=vE(c.fieldTransforms,u,m.transformResults),o=u.data;o.setAll(z9(c)),o.setAll(_),u.convertToFoundDocument(m.version,o).setHasCommittedMutations()})(n,e,t):(function(c,u,m){u.convertToNoDocument(m.version).setHasCommittedMutations()})(0,e,t)}function Wy(n,e,t,i){return n instanceof I_?(function(u,m,_,o){if(!K1(u.precondition,m))return _;const b=u.value.clone(),I=xE(u.fieldTransforms,o,m);return b.setAll(I),m.convertToFoundDocument(m.version,b).setHasLocalMutations(),null})(n,e,t,i):n instanceof mg?(function(u,m,_,o){if(!K1(u.precondition,m))return _;const b=xE(u.fieldTransforms,o,m),I=m.data;return I.setAll(z9(u)),I.setAll(b),m.convertToFoundDocument(m.version,I).setHasLocalMutations(),_===null?null:_.unionWith(u.fieldMask.fields).unionWith(u.fieldTransforms.map((M=>M.field)))})(n,e,t,i):(function(u,m,_){return K1(u.precondition,m)?(m.convertToNoDocument(m.version).setHasLocalMutations(),null):_})(n,e,t)}function QD(n,e){let t=null;for(const i of n.fieldTransforms){const c=e.data.field(i.field),u=N9(i.transform,c||null);u!=null&&(t===null&&(t=Rd.empty()),t.set(i.field,u))}return t||null}function _E(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(i,c){return i===void 0&&c===void 0||!(!i||!c)&&E0(i,c,((u,m)=>ZD(u,m)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class I_ extends ax{constructor(e,t,i,c=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=c,this.type=0}getFieldMask(){return null}}class mg extends ax{constructor(e,t,i,c,u=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=c,this.fieldTransforms=u,this.type=1}getFieldMask(){return this.fieldMask}}function z9(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const i=n.data.field(t);e.set(t,i)}})),e}function vE(n,e,t){const i=new Map;Sa(n.length===t.length);for(let c=0;c<t.length;c++){const u=n[c],m=u.transform,_=e.data.field(u.field);i.set(u.field,KD(m,_,t[c]))}return i}function xE(n,e,t){const i=new Map;for(const c of n){const u=c.transform,m=t.data.field(c.field);i.set(c.field,WD(u,m,e))}return i}class j9 extends ax{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class eF extends ax{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tF{constructor(e,t,i,c){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=c}applyToRemoteDocument(e,t){const i=t.mutationResults;for(let c=0;c<this.mutations.length;c++){const u=this.mutations[c];u.key.isEqual(e.key)&&JD(u,e,i[c])}}applyToLocalView(e,t){for(const i of this.baseMutations)i.key.isEqual(e.key)&&(t=Wy(i,e,t,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(e.key)&&(t=Wy(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const i=R9();return this.mutations.forEach((c=>{const u=e.get(c.key),m=u.overlayedDocument;let _=this.applyToLocalView(m,u.mutatedFields);_=t.has(c.key)?null:_;const o=B9(m,_);o!==null&&i.set(c.key,o),m.isValidDocument()||m.convertToNoDocument(Io.min())})),i}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),ds())}isEqual(e){return this.batchId===e.batchId&&E0(this.mutations,e.mutations,((t,i)=>_E(t,i)))&&E0(this.baseMutations,e.baseMutations,((t,i)=>_E(t,i)))}}class Fw{constructor(e,t,i,c){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=c}static from(e,t,i){Sa(e.mutations.length===i.length);let c=(function(){return VD})();const u=e.mutations;for(let m=0;m<u.length;m++)c=c.insert(u[m].key,i[m].version);return new Fw(e,t,i,c)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nF{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rF{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Jc,ws;function iF(n){switch(n){default:return go();case Yn.CANCELLED:case Yn.UNKNOWN:case Yn.DEADLINE_EXCEEDED:case Yn.RESOURCE_EXHAUSTED:case Yn.INTERNAL:case Yn.UNAVAILABLE:case Yn.UNAUTHENTICATED:return!1;case Yn.INVALID_ARGUMENT:case Yn.NOT_FOUND:case Yn.ALREADY_EXISTS:case Yn.PERMISSION_DENIED:case Yn.FAILED_PRECONDITION:case Yn.ABORTED:case Yn.OUT_OF_RANGE:case Yn.UNIMPLEMENTED:case Yn.DATA_LOSS:return!0}}function U9(n){if(n===void 0)return Tp("GRPC error has no .code"),Yn.UNKNOWN;switch(n){case Jc.OK:return Yn.OK;case Jc.CANCELLED:return Yn.CANCELLED;case Jc.UNKNOWN:return Yn.UNKNOWN;case Jc.DEADLINE_EXCEEDED:return Yn.DEADLINE_EXCEEDED;case Jc.RESOURCE_EXHAUSTED:return Yn.RESOURCE_EXHAUSTED;case Jc.INTERNAL:return Yn.INTERNAL;case Jc.UNAVAILABLE:return Yn.UNAVAILABLE;case Jc.UNAUTHENTICATED:return Yn.UNAUTHENTICATED;case Jc.INVALID_ARGUMENT:return Yn.INVALID_ARGUMENT;case Jc.NOT_FOUND:return Yn.NOT_FOUND;case Jc.ALREADY_EXISTS:return Yn.ALREADY_EXISTS;case Jc.PERMISSION_DENIED:return Yn.PERMISSION_DENIED;case Jc.FAILED_PRECONDITION:return Yn.FAILED_PRECONDITION;case Jc.ABORTED:return Yn.ABORTED;case Jc.OUT_OF_RANGE:return Yn.OUT_OF_RANGE;case Jc.UNIMPLEMENTED:return Yn.UNIMPLEMENTED;case Jc.DATA_LOSS:return Yn.DATA_LOSS;default:return go()}}(ws=Jc||(Jc={}))[ws.OK=0]="OK",ws[ws.CANCELLED=1]="CANCELLED",ws[ws.UNKNOWN=2]="UNKNOWN",ws[ws.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ws[ws.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ws[ws.NOT_FOUND=5]="NOT_FOUND",ws[ws.ALREADY_EXISTS=6]="ALREADY_EXISTS",ws[ws.PERMISSION_DENIED=7]="PERMISSION_DENIED",ws[ws.UNAUTHENTICATED=16]="UNAUTHENTICATED",ws[ws.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ws[ws.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ws[ws.ABORTED=10]="ABORTED",ws[ws.OUT_OF_RANGE=11]="OUT_OF_RANGE",ws[ws.UNIMPLEMENTED=12]="UNIMPLEMENTED",ws[ws.INTERNAL=13]="INTERNAL",ws[ws.UNAVAILABLE=14]="UNAVAILABLE",ws[ws.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oF(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sF=new eg([4294967295,4294967295],0);function bE(n){const e=oF().encode(n),t=new u9;return t.update(e),new Uint8Array(t.digest())}function wE(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),i=e.getUint32(4,!0),c=e.getUint32(8,!0),u=e.getUint32(12,!0);return[new eg([t,i],0),new eg([c,u],0)]}class Ow{constructor(e,t,i){if(this.bitmap=e,this.padding=t,this.hashCount=i,t<0||t>=8)throw new Ry(`Invalid padding: ${t}`);if(i<0)throw new Ry(`Invalid hash count: ${i}`);if(e.length>0&&this.hashCount===0)throw new Ry(`Invalid hash count: ${i}`);if(e.length===0&&t!==0)throw new Ry(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=eg.fromNumber(this.Ie)}Ee(e,t,i){let c=e.add(t.multiply(eg.fromNumber(i)));return c.compare(sF)===1&&(c=new eg([c.getBits(0),c.getBits(1)],0)),c.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=bE(e),[i,c]=wE(t);for(let u=0;u<this.hashCount;u++){const m=this.Ee(i,c,u);if(!this.de(m))return!1}return!0}static create(e,t,i){const c=e%8==0?0:8-e%8,u=new Uint8Array(Math.ceil(e/8)),m=new Ow(u,c,t);return i.forEach((_=>m.insert(_))),m}insert(e){if(this.Ie===0)return;const t=bE(e),[i,c]=wE(t);for(let u=0;u<this.hashCount;u++){const m=this.Ee(i,c,u);this.Ae(m)}}Ae(e){const t=Math.floor(e/8),i=e%8;this.bitmap[t]|=1<<i}}class Ry extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lx{constructor(e,t,i,c,u){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=i,this.documentUpdates=c,this.resolvedLimboDocuments=u}static createSynthesizedRemoteEventForCurrentChange(e,t,i){const c=new Map;return c.set(e,C_.createSynthesizedTargetChangeForCurrentChange(e,t,i)),new lx(Io.min(),c,new Yl(zs),Ip(),ds())}}class C_{constructor(e,t,i,c,u){this.resumeToken=e,this.current=t,this.addedDocuments=i,this.modifiedDocuments=c,this.removedDocuments=u}static createSynthesizedTargetChangeForCurrentChange(e,t,i){return new C_(i,t,ds(),ds(),ds())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X1{constructor(e,t,i,c){this.Re=e,this.removedTargetIds=t,this.key=i,this.Ve=c}}class V9{constructor(e,t){this.targetId=e,this.me=t}}class q9{constructor(e,t,i=Qu.EMPTY_BYTE_STRING,c=null){this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=c}}class SE{constructor(){this.fe=0,this.ge=AE(),this.pe=Qu.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=ds(),t=ds(),i=ds();return this.ge.forEach(((c,u)=>{switch(u){case 0:e=e.add(c);break;case 2:t=t.add(c);break;case 1:i=i.add(c);break;default:go()}})),new C_(this.pe,this.ye,e,t,i)}Ce(){this.we=!1,this.ge=AE()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Sa(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class aF{constructor(e){this.Le=e,this.Be=new Map,this.ke=Ip(),this.qe=EE(),this.Qe=new Yl(zs)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,(t=>{const i=this.Ge(t);switch(e.state){case 0:this.ze(t)&&i.De(e.resumeToken);break;case 1:i.Oe(),i.Se||i.Ce(),i.De(e.resumeToken);break;case 2:i.Oe(),i.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(i.Ne(),i.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),i.De(e.resumeToken));break;default:go()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach(((i,c)=>{this.ze(c)&&t(c)}))}He(e){const t=e.targetId,i=e.me.count,c=this.Je(t);if(c){const u=c.target;if(F5(u))if(i===0){const m=new $i(u.path);this.Ue(t,m,Ah.newNoDocument(m,Io.min()))}else Sa(i===1);else{const m=this.Ye(t);if(m!==i){const _=this.Ze(e),o=_?this.Xe(_,e,m):1;if(o!==0){this.je(t);const b=o===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,b)}}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:i="",padding:c=0},hashCount:u=0}=t;let m,_;try{m=og(i).toUint8Array()}catch(o){if(o instanceof v9)return S0("Decoding the base64 bloom filter in existence filter failed ("+o.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw o}try{_=new Ow(m,c,u)}catch(o){return S0(o instanceof Ry?"BloomFilter error: ":"Applying bloom filter failed: ",o),null}return _.Ie===0?null:_}Xe(e,t,i){return t.me.count===i-this.nt(e,t.targetId)?0:2}nt(e,t){const i=this.Le.getRemoteKeysForTarget(t);let c=0;return i.forEach((u=>{const m=this.Le.tt(),_=`projects/${m.projectId}/databases/${m.database}/documents/${u.path.canonicalString()}`;e.mightContain(_)||(this.Ue(t,u,null),c++)})),c}rt(e){const t=new Map;this.Be.forEach(((u,m)=>{const _=this.Je(m);if(_){if(u.current&&F5(_.target)){const o=new $i(_.target.path);this.ke.get(o)!==null||this.it(m,o)||this.Ue(m,o,Ah.newNoDocument(o,e))}u.be&&(t.set(m,u.ve()),u.Ce())}}));let i=ds();this.qe.forEach(((u,m)=>{let _=!0;m.forEachWhile((o=>{const b=this.Je(o);return!b||b.purpose==="TargetPurposeLimboResolution"||(_=!1,!1)})),_&&(i=i.add(u))})),this.ke.forEach(((u,m)=>m.setReadTime(e)));const c=new lx(e,t,this.Qe,this.ke,i);return this.ke=Ip(),this.qe=EE(),this.Qe=new Yl(zs),c}$e(e,t){if(!this.ze(e))return;const i=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,i),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,i){if(!this.ze(e))return;const c=this.Ge(e);this.it(e,t)?c.Fe(t,1):c.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),i&&(this.ke=this.ke.insert(t,i))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new SE,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Ju(zs),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||vi("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new SE),this.Le.getRemoteKeysForTarget(e).forEach((t=>{this.Ue(e,t,null)}))}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function EE(){return new Yl($i.comparator)}function AE(){return new Yl($i.comparator)}const lF={asc:"ASCENDING",desc:"DESCENDING"},cF={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},uF={and:"AND",or:"OR"};class hF{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function z5(n,e){return n.useProto3Json||nx(e)?e:{value:e}}function Ev(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function $9(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function dF(n,e){return Ev(n,e.toTimestamp())}function Vf(n){return Sa(!!n),Io.fromTimestamp((function(t){const i=pm(t);return new du(i.seconds,i.nanos)})(n))}function Bw(n,e){return j5(n,e).canonicalString()}function j5(n,e){const t=(function(c){return new pl(["projects",c.projectId,"databases",c.database])})(n).child("documents");return e===void 0?t:t.child(e)}function G9(n){const e=pl.fromString(n);return Sa(Z9(e)),e}function U5(n,e){return Bw(n.databaseId,e.path)}function jb(n,e){const t=G9(e);if(t.get(1)!==n.databaseId.projectId)throw new hi(Yn.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new hi(Yn.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new $i(W9(t))}function H9(n,e){return Bw(n.databaseId,e)}function fF(n){const e=G9(n);return e.length===4?pl.emptyPath():W9(e)}function V5(n){return new pl(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function W9(n){return Sa(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function TE(n,e,t){return{name:U5(n,e),fields:t.value.mapValue.fields}}function pF(n,e){let t;if("targetChange"in e){e.targetChange;const i=(function(b){return b==="NO_CHANGE"?0:b==="ADD"?1:b==="REMOVE"?2:b==="CURRENT"?3:b==="RESET"?4:go()})(e.targetChange.targetChangeType||"NO_CHANGE"),c=e.targetChange.targetIds||[],u=(function(b,I){return b.useProto3Json?(Sa(I===void 0||typeof I=="string"),Qu.fromBase64String(I||"")):(Sa(I===void 0||I instanceof Buffer||I instanceof Uint8Array),Qu.fromUint8Array(I||new Uint8Array))})(n,e.targetChange.resumeToken),m=e.targetChange.cause,_=m&&(function(b){const I=b.code===void 0?Yn.UNKNOWN:U9(b.code);return new hi(I,b.message||"")})(m);t=new q9(i,c,u,_||null)}else if("documentChange"in e){e.documentChange;const i=e.documentChange;i.document,i.document.name,i.document.updateTime;const c=jb(n,i.document.name),u=Vf(i.document.updateTime),m=i.document.createTime?Vf(i.document.createTime):Io.min(),_=new Rd({mapValue:{fields:i.document.fields}}),o=Ah.newFoundDocument(c,u,m,_),b=i.targetIds||[],I=i.removedTargetIds||[];t=new X1(b,I,o.key,o)}else if("documentDelete"in e){e.documentDelete;const i=e.documentDelete;i.document;const c=jb(n,i.document),u=i.readTime?Vf(i.readTime):Io.min(),m=Ah.newNoDocument(c,u),_=i.removedTargetIds||[];t=new X1([],_,m.key,m)}else if("documentRemove"in e){e.documentRemove;const i=e.documentRemove;i.document;const c=jb(n,i.document),u=i.removedTargetIds||[];t=new X1([],u,c,null)}else{if(!("filter"in e))return go();{e.filter;const i=e.filter;i.targetId;const{count:c=0,unchangedNames:u}=i,m=new rF(c,u),_=i.targetId;t=new V9(_,m)}}return t}function mF(n,e){let t;if(e instanceof I_)t={update:TE(n,e.key,e.value)};else if(e instanceof j9)t={delete:U5(n,e.key)};else if(e instanceof mg)t={update:TE(n,e.key,e.data),updateMask:EF(e.fieldMask)};else{if(!(e instanceof eF))return go();t={verify:U5(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((i=>(function(u,m){const _=m.transform;if(_ instanceof h_)return{fieldPath:m.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(_ instanceof d_)return{fieldPath:m.field.canonicalString(),appendMissingElements:{values:_.elements}};if(_ instanceof f_)return{fieldPath:m.field.canonicalString(),removeAllFromArray:{values:_.elements}};if(_ instanceof Sv)return{fieldPath:m.field.canonicalString(),increment:_.Pe};throw go()})(0,i)))),e.precondition.isNone||(t.currentDocument=(function(c,u){return u.updateTime!==void 0?{updateTime:dF(c,u.updateTime)}:u.exists!==void 0?{exists:u.exists}:go()})(n,e.precondition)),t}function gF(n,e){return n&&n.length>0?(Sa(e!==void 0),n.map((t=>(function(c,u){let m=c.updateTime?Vf(c.updateTime):Vf(u);return m.isEqual(Io.min())&&(m=Vf(u)),new YD(m,c.transformResults||[])})(t,e)))):[]}function yF(n,e){return{documents:[H9(n,e.path)]}}function _F(n,e){const t={structuredQuery:{}},i=e.path;let c;e.collectionGroup!==null?(c=i,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(c=i.popLast(),t.structuredQuery.from=[{collectionId:i.lastSegment()}]),t.parent=H9(n,c);const u=(function(b){if(b.length!==0)return X9(sf.create(b,"and"))})(e.filters);u&&(t.structuredQuery.where=u);const m=(function(b){if(b.length!==0)return b.map((I=>(function(V){return{field:r0(V.field),direction:bF(V.dir)}})(I)))})(e.orderBy);m&&(t.structuredQuery.orderBy=m);const _=z5(n,e.limit);return _!==null&&(t.structuredQuery.limit=_),e.startAt&&(t.structuredQuery.startAt=(function(b){return{before:b.inclusive,values:b.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(b){return{before:!b.inclusive,values:b.position}})(e.endAt)),{_t:t,parent:c}}function vF(n){let e=fF(n.parent);const t=n.structuredQuery,i=t.from?t.from.length:0;let c=null;if(i>0){Sa(i===1);const I=t.from[0];I.allDescendants?c=I.collectionId:e=e.child(I.collectionId)}let u=[];t.where&&(u=(function(M){const V=K9(M);return V instanceof sf&&S9(V)?V.getFilters():[V]})(t.where));let m=[];t.orderBy&&(m=(function(M){return M.map((V=>(function(ie){return new wv(i0(ie.field),(function(fe){switch(fe){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(ie.direction))})(V)))})(t.orderBy));let _=null;t.limit&&(_=(function(M){let V;return V=typeof M=="object"?M.value:M,nx(V)?null:V})(t.limit));let o=null;t.startAt&&(o=(function(M){const V=!!M.before,k=M.values||[];return new bv(k,V)})(t.startAt));let b=null;return t.endAt&&(b=(function(M){const V=!M.before,k=M.values||[];return new bv(k,V)})(t.endAt)),OD(e,c,m,u,_,"F",o,b)}function xF(n,e){const t=(function(c){switch(c){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return go()}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function K9(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const i=i0(t.unaryFilter.field);return eu.create(i,"==",{doubleValue:NaN});case"IS_NULL":const c=i0(t.unaryFilter.field);return eu.create(c,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const u=i0(t.unaryFilter.field);return eu.create(u,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const m=i0(t.unaryFilter.field);return eu.create(m,"!=",{nullValue:"NULL_VALUE"});default:return go()}})(n):n.fieldFilter!==void 0?(function(t){return eu.create(i0(t.fieldFilter.field),(function(c){switch(c){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return go()}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return sf.create(t.compositeFilter.filters.map((i=>K9(i))),(function(c){switch(c){case"AND":return"and";case"OR":return"or";default:return go()}})(t.compositeFilter.op))})(n):go()}function bF(n){return lF[n]}function wF(n){return cF[n]}function SF(n){return uF[n]}function r0(n){return{fieldPath:n.canonicalString()}}function i0(n){return Yu.fromServerFormat(n.fieldPath)}function X9(n){return n instanceof eu?(function(t){if(t.op==="=="){if(dE(t.value))return{unaryFilter:{field:r0(t.field),op:"IS_NAN"}};if(hE(t.value))return{unaryFilter:{field:r0(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(dE(t.value))return{unaryFilter:{field:r0(t.field),op:"IS_NOT_NAN"}};if(hE(t.value))return{unaryFilter:{field:r0(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:r0(t.field),op:wF(t.op),value:t.value}}})(n):n instanceof sf?(function(t){const i=t.getFilters().map((c=>X9(c)));return i.length===1?i[0]:{compositeFilter:{op:SF(t.op),filters:i}}})(n):go()}function EF(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function Z9(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nm{constructor(e,t,i,c,u=Io.min(),m=Io.min(),_=Qu.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=i,this.sequenceNumber=c,this.snapshotVersion=u,this.lastLimboFreeSnapshotVersion=m,this.resumeToken=_,this.expectedCount=o}withSequenceNumber(e){return new nm(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new nm(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new nm(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new nm(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AF{constructor(e){this.ct=e}}function TF(n){const e=vF({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?B5(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IF{constructor(){this.un=new CF}addToCollectionParentIndex(e,t){return this.un.add(t),ur.resolve()}getCollectionParents(e,t){return ur.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return ur.resolve()}deleteFieldIndex(e,t){return ur.resolve()}deleteAllFieldIndexes(e){return ur.resolve()}createTargetIndexes(e,t){return ur.resolve()}getDocumentsMatchingTarget(e,t){return ur.resolve(null)}getIndexType(e,t){return ur.resolve(0)}getFieldIndexes(e,t){return ur.resolve([])}getNextCollectionGroupToUpdate(e){return ur.resolve(null)}getMinOffset(e,t){return ur.resolve(fm.min())}getMinOffsetFromCollectionGroup(e,t){return ur.resolve(fm.min())}updateCollectionGroup(e,t,i){return ur.resolve()}updateIndexEntries(e,t){return ur.resolve()}}class CF{constructor(){this.index={}}add(e){const t=e.lastSegment(),i=e.popLast(),c=this.index[t]||new Ju(pl.comparator),u=!c.has(i);return this.index[t]=c.add(i),u}has(e){const t=e.lastSegment(),i=e.popLast(),c=this.index[t];return c&&c.has(i)}getEntries(e){return(this.index[e]||new Ju(pl.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I0{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new I0(0)}static kn(){return new I0(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LF{constructor(){this.changes=new z0((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ah.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const i=this.changes.get(t);return i!==void 0?ur.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PF{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kF{constructor(e,t,i,c){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=c}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next((c=>(i=c,this.remoteDocumentCache.getEntry(e,t)))).next((c=>(i!==null&&Wy(i.mutation,c,tf.empty(),du.now()),c)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((i=>this.getLocalViewOfDocuments(e,i,ds()).next((()=>i))))}getLocalViewOfDocuments(e,t,i=ds()){const c=Xm();return this.populateOverlays(e,c,t).next((()=>this.computeViews(e,t,c,i).next((u=>{let m=ky();return u.forEach(((_,o)=>{m=m.insert(_,o.overlayedDocument)})),m}))))}getOverlayedDocuments(e,t){const i=Xm();return this.populateOverlays(e,i,t).next((()=>this.computeViews(e,t,i,ds())))}populateOverlays(e,t,i){const c=[];return i.forEach((u=>{t.has(u)||c.push(u)})),this.documentOverlayCache.getOverlays(e,c).next((u=>{u.forEach(((m,_)=>{t.set(m,_)}))}))}computeViews(e,t,i,c){let u=Ip();const m=Hy(),_=(function(){return Hy()})();return t.forEach(((o,b)=>{const I=i.get(b.key);c.has(b.key)&&(I===void 0||I.mutation instanceof mg)?u=u.insert(b.key,b):I!==void 0?(m.set(b.key,I.mutation.getFieldMask()),Wy(I.mutation,b,I.mutation.getFieldMask(),du.now())):m.set(b.key,tf.empty())})),this.recalculateAndSaveOverlays(e,u).next((o=>(o.forEach(((b,I)=>m.set(b,I))),t.forEach(((b,I)=>{var M;return _.set(b,new PF(I,(M=m.get(b))!==null&&M!==void 0?M:null))})),_)))}recalculateAndSaveOverlays(e,t){const i=Hy();let c=new Yl(((m,_)=>m-_)),u=ds();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((m=>{for(const _ of m)_.keys().forEach((o=>{const b=t.get(o);if(b===null)return;let I=i.get(o)||tf.empty();I=_.applyToLocalView(b,I),i.set(o,I);const M=(c.get(_.batchId)||ds()).add(o);c=c.insert(_.batchId,M)}))})).next((()=>{const m=[],_=c.getReverseIterator();for(;_.hasNext();){const o=_.getNext(),b=o.key,I=o.value,M=R9();I.forEach((V=>{if(!u.has(V)){const k=B9(t.get(V),i.get(V));k!==null&&M.set(V,k),u=u.add(V)}})),m.push(this.documentOverlayCache.saveOverlays(e,b,M))}return ur.waitFor(m)})).next((()=>i))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((i=>this.recalculateAndSaveOverlays(e,i)))}getDocumentsMatchingQuery(e,t,i,c){return(function(m){return $i.isDocumentKey(m.path)&&m.collectionGroup===null&&m.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):I9(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i,c):this.getDocumentsMatchingCollectionQuery(e,t,i,c)}getNextDocuments(e,t,i,c){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,c).next((u=>{const m=c-u.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,c-u.size):ur.resolve(Xm());let _=-1,o=u;return m.next((b=>ur.forEach(b,((I,M)=>(_<M.largestBatchId&&(_=M.largestBatchId),u.get(I)?ur.resolve():this.remoteDocumentCache.getEntry(e,I).next((V=>{o=o.insert(I,V)}))))).next((()=>this.populateOverlays(e,b,u))).next((()=>this.computeViews(e,o,b,ds()))).next((I=>({batchId:_,changes:k9(I)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new $i(t)).next((i=>{let c=ky();return i.isFoundDocument()&&(c=c.insert(i.key,i)),c}))}getDocumentsMatchingCollectionGroupQuery(e,t,i,c){const u=t.collectionGroup;let m=ky();return this.indexManager.getCollectionParents(e,u).next((_=>ur.forEach(_,(o=>{const b=(function(M,V){return new T_(V,null,M.explicitOrderBy.slice(),M.filters.slice(),M.limit,M.limitType,M.startAt,M.endAt)})(t,o.child(u));return this.getDocumentsMatchingCollectionQuery(e,b,i,c).next((I=>{I.forEach(((M,V)=>{m=m.insert(M,V)}))}))})).next((()=>m))))}getDocumentsMatchingCollectionQuery(e,t,i,c){let u;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId).next((m=>(u=m,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,i,u,c)))).next((m=>{u.forEach(((o,b)=>{const I=b.getKey();m.get(I)===null&&(m=m.insert(I,Ah.newInvalidDocument(I)))}));let _=ky();return m.forEach(((o,b)=>{const I=u.get(o);I!==void 0&&Wy(I.mutation,b,tf.empty(),du.now()),ox(t,b)&&(_=_.insert(o,b))})),_}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RF{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return ur.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,(function(c){return{id:c.id,version:c.version,createTime:Vf(c.createTime)}})(t)),ur.resolve()}getNamedQuery(e,t){return ur.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,(function(c){return{name:c.name,query:TF(c.bundledQuery),readTime:Vf(c.readTime)}})(t)),ur.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MF{constructor(){this.overlays=new Yl($i.comparator),this.Ir=new Map}getOverlay(e,t){return ur.resolve(this.overlays.get(t))}getOverlays(e,t){const i=Xm();return ur.forEach(t,(c=>this.getOverlay(e,c).next((u=>{u!==null&&i.set(c,u)})))).next((()=>i))}saveOverlays(e,t,i){return i.forEach(((c,u)=>{this.ht(e,t,u)})),ur.resolve()}removeOverlaysForBatchId(e,t,i){const c=this.Ir.get(i);return c!==void 0&&(c.forEach((u=>this.overlays=this.overlays.remove(u))),this.Ir.delete(i)),ur.resolve()}getOverlaysForCollection(e,t,i){const c=Xm(),u=t.length+1,m=new $i(t.child("")),_=this.overlays.getIteratorFrom(m);for(;_.hasNext();){const o=_.getNext().value,b=o.getKey();if(!t.isPrefixOf(b.path))break;b.path.length===u&&o.largestBatchId>i&&c.set(o.getKey(),o)}return ur.resolve(c)}getOverlaysForCollectionGroup(e,t,i,c){let u=new Yl(((b,I)=>b-I));const m=this.overlays.getIterator();for(;m.hasNext();){const b=m.getNext().value;if(b.getKey().getCollectionGroup()===t&&b.largestBatchId>i){let I=u.get(b.largestBatchId);I===null&&(I=Xm(),u=u.insert(b.largestBatchId,I)),I.set(b.getKey(),b)}}const _=Xm(),o=u.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach(((b,I)=>_.set(b,I))),!(_.size()>=c)););return ur.resolve(_)}ht(e,t,i){const c=this.overlays.get(i.key);if(c!==null){const m=this.Ir.get(c.largestBatchId).delete(i.key);this.Ir.set(c.largestBatchId,m)}this.overlays=this.overlays.insert(i.key,new nF(t,i));let u=this.Ir.get(t);u===void 0&&(u=ds(),this.Ir.set(t,u)),this.Ir.set(t,u.add(i.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NF{constructor(){this.sessionToken=Qu.EMPTY_BYTE_STRING}getSessionToken(e){return ur.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,ur.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zw{constructor(){this.Tr=new Ju(Tu.Er),this.dr=new Ju(Tu.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const i=new Tu(e,t);this.Tr=this.Tr.add(i),this.dr=this.dr.add(i)}Rr(e,t){e.forEach((i=>this.addReference(i,t)))}removeReference(e,t){this.Vr(new Tu(e,t))}mr(e,t){e.forEach((i=>this.removeReference(i,t)))}gr(e){const t=new $i(new pl([])),i=new Tu(t,e),c=new Tu(t,e+1),u=[];return this.dr.forEachInRange([i,c],(m=>{this.Vr(m),u.push(m.key)})),u}pr(){this.Tr.forEach((e=>this.Vr(e)))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new $i(new pl([])),i=new Tu(t,e),c=new Tu(t,e+1);let u=ds();return this.dr.forEachInRange([i,c],(m=>{u=u.add(m.key)})),u}containsKey(e){const t=new Tu(e,0),i=this.Tr.firstAfterOrEqual(t);return i!==null&&e.isEqual(i.key)}}class Tu{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return $i.comparator(e.key,t.key)||zs(e.wr,t.wr)}static Ar(e,t){return zs(e.wr,t.wr)||$i.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DF{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new Ju(Tu.Er)}checkEmpty(e){return ur.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,i,c){const u=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const m=new tF(u,t,i,c);this.mutationQueue.push(m);for(const _ of c)this.br=this.br.add(new Tu(_.key,u)),this.indexManager.addToCollectionParentIndex(e,_.key.path.popLast());return ur.resolve(m)}lookupMutationBatch(e,t){return ur.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const i=t+1,c=this.vr(i),u=c<0?0:c;return ur.resolve(this.mutationQueue.length>u?this.mutationQueue[u]:null)}getHighestUnacknowledgedBatchId(){return ur.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return ur.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const i=new Tu(t,0),c=new Tu(t,Number.POSITIVE_INFINITY),u=[];return this.br.forEachInRange([i,c],(m=>{const _=this.Dr(m.wr);u.push(_)})),ur.resolve(u)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new Ju(zs);return t.forEach((c=>{const u=new Tu(c,0),m=new Tu(c,Number.POSITIVE_INFINITY);this.br.forEachInRange([u,m],(_=>{i=i.add(_.wr)}))})),ur.resolve(this.Cr(i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,c=i.length+1;let u=i;$i.isDocumentKey(u)||(u=u.child(""));const m=new Tu(new $i(u),0);let _=new Ju(zs);return this.br.forEachWhile((o=>{const b=o.key.path;return!!i.isPrefixOf(b)&&(b.length===c&&(_=_.add(o.wr)),!0)}),m),ur.resolve(this.Cr(_))}Cr(e){const t=[];return e.forEach((i=>{const c=this.Dr(i);c!==null&&t.push(c)})),t}removeMutationBatch(e,t){Sa(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let i=this.br;return ur.forEach(t.mutations,(c=>{const u=new Tu(c.key,t.batchId);return i=i.delete(u),this.referenceDelegate.markPotentiallyOrphaned(e,c.key)})).next((()=>{this.br=i}))}On(e){}containsKey(e,t){const i=new Tu(t,0),c=this.br.firstAfterOrEqual(i);return ur.resolve(t.isEqual(c&&c.key))}performConsistencyCheck(e){return this.mutationQueue.length,ur.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FF{constructor(e){this.Mr=e,this.docs=(function(){return new Yl($i.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const i=t.key,c=this.docs.get(i),u=c?c.size:0,m=this.Mr(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:m}),this.size+=m-u,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const i=this.docs.get(t);return ur.resolve(i?i.document.mutableCopy():Ah.newInvalidDocument(t))}getEntries(e,t){let i=Ip();return t.forEach((c=>{const u=this.docs.get(c);i=i.insert(c,u?u.document.mutableCopy():Ah.newInvalidDocument(c))})),ur.resolve(i)}getDocumentsMatchingQuery(e,t,i,c){let u=Ip();const m=t.path,_=new $i(m.child("")),o=this.docs.getIteratorFrom(_);for(;o.hasNext();){const{key:b,value:{document:I}}=o.getNext();if(!m.isPrefixOf(b.path))break;b.path.length>m.length+1||_D(yD(I),i)<=0||(c.has(I.key)||ox(t,I))&&(u=u.insert(I.key,I.mutableCopy()))}return ur.resolve(u)}getAllFromCollectionGroup(e,t,i,c){go()}Or(e,t){return ur.forEach(this.docs,(i=>t(i)))}newChangeBuffer(e){return new OF(this)}getSize(e){return ur.resolve(this.size)}}class OF extends LF{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach(((i,c)=>{c.isValidDocument()?t.push(this.cr.addEntry(e,c)):this.cr.removeEntry(i)})),ur.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BF{constructor(e){this.persistence=e,this.Nr=new z0((t=>Mw(t)),Nw),this.lastRemoteSnapshotVersion=Io.min(),this.highestTargetId=0,this.Lr=0,this.Br=new zw,this.targetCount=0,this.kr=I0.Bn()}forEachTarget(e,t){return this.Nr.forEach(((i,c)=>t(c))),ur.resolve()}getLastRemoteSnapshotVersion(e){return ur.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ur.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),ur.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this.Lr&&(this.Lr=t),ur.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new I0(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,ur.resolve()}updateTargetData(e,t){return this.Kn(t),ur.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,ur.resolve()}removeTargets(e,t,i){let c=0;const u=[];return this.Nr.forEach(((m,_)=>{_.sequenceNumber<=t&&i.get(_.targetId)===null&&(this.Nr.delete(m),u.push(this.removeMatchingKeysForTargetId(e,_.targetId)),c++)})),ur.waitFor(u).next((()=>c))}getTargetCount(e){return ur.resolve(this.targetCount)}getTargetData(e,t){const i=this.Nr.get(t)||null;return ur.resolve(i)}addMatchingKeys(e,t,i){return this.Br.Rr(t,i),ur.resolve()}removeMatchingKeys(e,t,i){this.Br.mr(t,i);const c=this.persistence.referenceDelegate,u=[];return c&&t.forEach((m=>{u.push(c.markPotentiallyOrphaned(e,m))})),ur.waitFor(u)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),ur.resolve()}getMatchingKeysForTargetId(e,t){const i=this.Br.yr(t);return ur.resolve(i)}containsKey(e,t){return ur.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zF{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Lw(0),this.Kr=!1,this.Kr=!0,this.$r=new NF,this.referenceDelegate=e(this),this.Ur=new BF(this),this.indexManager=new IF,this.remoteDocumentCache=(function(c){return new FF(c)})((i=>this.referenceDelegate.Wr(i))),this.serializer=new AF(t),this.Gr=new RF(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new MF,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this.qr[e.toKey()];return i||(i=new DF(t,this.referenceDelegate),this.qr[e.toKey()]=i),i}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,i){vi("MemoryPersistence","Starting transaction:",e);const c=new jF(this.Qr.next());return this.referenceDelegate.zr(),i(c).next((u=>this.referenceDelegate.jr(c).next((()=>u)))).toPromise().then((u=>(c.raiseOnCommittedEvent(),u)))}Hr(e,t){return ur.or(Object.values(this.qr).map((i=>()=>i.containsKey(e,t))))}}class jF extends xD{constructor(e){super(),this.currentSequenceNumber=e}}class jw{constructor(e){this.persistence=e,this.Jr=new zw,this.Yr=null}static Zr(e){return new jw(e)}get Xr(){if(this.Yr)return this.Yr;throw go()}addReference(e,t,i){return this.Jr.addReference(i,t),this.Xr.delete(i.toString()),ur.resolve()}removeReference(e,t,i){return this.Jr.removeReference(i,t),this.Xr.add(i.toString()),ur.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),ur.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach((c=>this.Xr.add(c.toString())));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next((c=>{c.forEach((u=>this.Xr.add(u.toString())))})).next((()=>i.removeTargetData(e,t)))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ur.forEach(this.Xr,(i=>{const c=$i.fromPath(i);return this.ei(e,c).next((u=>{u||t.removeEntry(c,Io.min())}))})).next((()=>(this.Yr=null,t.apply(e))))}updateLimboDocument(e,t){return this.ei(e,t).next((i=>{i?this.Xr.delete(t.toString()):this.Xr.add(t.toString())}))}Wr(e){return 0}ei(e,t){return ur.or([()=>ur.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uw{constructor(e,t,i,c){this.targetId=e,this.fromCache=t,this.$i=i,this.Ui=c}static Wi(e,t){let i=ds(),c=ds();for(const u of t.docChanges)switch(u.type){case 0:i=i.add(u.doc.key);break;case 1:c=c.add(u.doc.key)}return new Uw(e,t.fromCache,i,c)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UF{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VF{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=(function(){return VM()?8:bD(Th())>0?6:4})()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,i,c){const u={result:null};return this.Yi(e,t).next((m=>{u.result=m})).next((()=>{if(!u.result)return this.Zi(e,t,c,i).next((m=>{u.result=m}))})).next((()=>{if(u.result)return;const m=new UF;return this.Xi(e,t,m).next((_=>{if(u.result=_,this.zi)return this.es(e,t,m,_.size)}))})).next((()=>u.result))}es(e,t,i,c){return i.documentReadCount<this.ji?(Ey()<=gs.DEBUG&&vi("QueryEngine","SDK will not create cache indexes for query:",n0(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),ur.resolve()):(Ey()<=gs.DEBUG&&vi("QueryEngine","Query:",n0(t),"scans",i.documentReadCount,"local documents and returns",c,"documents as results."),i.documentReadCount>this.Hi*c?(Ey()<=gs.DEBUG&&vi("QueryEngine","The SDK decides to create cache indexes for query:",n0(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,jf(t))):ur.resolve())}Yi(e,t){if(gE(t))return ur.resolve(null);let i=jf(t);return this.indexManager.getIndexType(e,i).next((c=>c===0?null:(t.limit!==null&&c===1&&(t=B5(t,null,"F"),i=jf(t)),this.indexManager.getDocumentsMatchingTarget(e,i).next((u=>{const m=ds(...u);return this.Ji.getDocuments(e,m).next((_=>this.indexManager.getMinOffset(e,i).next((o=>{const b=this.ts(t,_);return this.ns(t,b,m,o.readTime)?this.Yi(e,B5(t,null,"F")):this.rs(e,b,t,o)}))))})))))}Zi(e,t,i,c){return gE(t)||c.isEqual(Io.min())?ur.resolve(null):this.Ji.getDocuments(e,i).next((u=>{const m=this.ts(t,u);return this.ns(t,m,i,c)?ur.resolve(null):(Ey()<=gs.DEBUG&&vi("QueryEngine","Re-using previous result from %s to execute query: %s",c.toString(),n0(t)),this.rs(e,m,t,gD(c,-1)).next((_=>_)))}))}ts(e,t){let i=new Ju(L9(e));return t.forEach(((c,u)=>{ox(e,u)&&(i=i.add(u))})),i}ns(e,t,i,c){if(e.limit===null)return!1;if(i.size!==t.size)return!0;const u=e.limitType==="F"?t.last():t.first();return!!u&&(u.hasPendingWrites||u.version.compareTo(c)>0)}Xi(e,t,i){return Ey()<=gs.DEBUG&&vi("QueryEngine","Using full collection scan to execute query:",n0(t)),this.Ji.getDocumentsMatchingQuery(e,t,fm.min(),i)}rs(e,t,i,c){return this.Ji.getDocumentsMatchingQuery(e,i,c).next((u=>(t.forEach((m=>{u=u.insert(m.key,m)})),u)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qF{constructor(e,t,i,c){this.persistence=e,this.ss=t,this.serializer=c,this.os=new Yl(zs),this._s=new z0((u=>Mw(u)),Nw),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(i)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new kF(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.os)))}}function $F(n,e,t,i){return new qF(n,e,t,i)}async function Y9(n,e){const t=Co(n);return await t.persistence.runTransaction("Handle user change","readonly",(i=>{let c;return t.mutationQueue.getAllMutationBatches(i).next((u=>(c=u,t.ls(e),t.mutationQueue.getAllMutationBatches(i)))).next((u=>{const m=[],_=[];let o=ds();for(const b of c){m.push(b.batchId);for(const I of b.mutations)o=o.add(I.key)}for(const b of u){_.push(b.batchId);for(const I of b.mutations)o=o.add(I.key)}return t.localDocuments.getDocuments(i,o).next((b=>({hs:b,removedBatchIds:m,addedBatchIds:_})))}))}))}function GF(n,e){const t=Co(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(i=>{const c=e.batch.keys(),u=t.cs.newChangeBuffer({trackRemovals:!0});return(function(_,o,b,I){const M=b.batch,V=M.keys();let k=ur.resolve();return V.forEach((ie=>{k=k.next((()=>I.getEntry(o,ie))).next((se=>{const fe=b.docVersions.get(ie);Sa(fe!==null),se.version.compareTo(fe)<0&&(M.applyToRemoteDocument(se,b),se.isValidDocument()&&(se.setReadTime(b.commitVersion),I.addEntry(se)))}))})),k.next((()=>_.mutationQueue.removeMutationBatch(o,M)))})(t,i,e,u).next((()=>u.apply(i))).next((()=>t.mutationQueue.performConsistencyCheck(i))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(i,c,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,(function(_){let o=ds();for(let b=0;b<_.mutationResults.length;++b)_.mutationResults[b].transformResults.length>0&&(o=o.add(_.batch.mutations[b].key));return o})(e)))).next((()=>t.localDocuments.getDocuments(i,c)))}))}function J9(n){const e=Co(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Ur.getLastRemoteSnapshotVersion(t)))}function HF(n,e){const t=Co(n),i=e.snapshotVersion;let c=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(u=>{const m=t.cs.newChangeBuffer({trackRemovals:!0});c=t.os;const _=[];e.targetChanges.forEach(((I,M)=>{const V=c.get(M);if(!V)return;_.push(t.Ur.removeMatchingKeys(u,I.removedDocuments,M).next((()=>t.Ur.addMatchingKeys(u,I.addedDocuments,M))));let k=V.withSequenceNumber(u.currentSequenceNumber);e.targetMismatches.get(M)!==null?k=k.withResumeToken(Qu.EMPTY_BYTE_STRING,Io.min()).withLastLimboFreeSnapshotVersion(Io.min()):I.resumeToken.approximateByteSize()>0&&(k=k.withResumeToken(I.resumeToken,i)),c=c.insert(M,k),(function(se,fe,J){return se.resumeToken.approximateByteSize()===0||fe.snapshotVersion.toMicroseconds()-se.snapshotVersion.toMicroseconds()>=3e8?!0:J.addedDocuments.size+J.modifiedDocuments.size+J.removedDocuments.size>0})(V,k,I)&&_.push(t.Ur.updateTargetData(u,k))}));let o=Ip(),b=ds();if(e.documentUpdates.forEach((I=>{e.resolvedLimboDocuments.has(I)&&_.push(t.persistence.referenceDelegate.updateLimboDocument(u,I))})),_.push(WF(u,m,e.documentUpdates).next((I=>{o=I.Ps,b=I.Is}))),!i.isEqual(Io.min())){const I=t.Ur.getLastRemoteSnapshotVersion(u).next((M=>t.Ur.setTargetsMetadata(u,u.currentSequenceNumber,i)));_.push(I)}return ur.waitFor(_).next((()=>m.apply(u))).next((()=>t.localDocuments.getLocalViewOfDocuments(u,o,b))).next((()=>o))})).then((u=>(t.os=c,u)))}function WF(n,e,t){let i=ds(),c=ds();return t.forEach((u=>i=i.add(u))),e.getEntries(n,i).next((u=>{let m=Ip();return t.forEach(((_,o)=>{const b=u.get(_);o.isFoundDocument()!==b.isFoundDocument()&&(c=c.add(_)),o.isNoDocument()&&o.version.isEqual(Io.min())?(e.removeEntry(_,o.readTime),m=m.insert(_,o)):!b.isValidDocument()||o.version.compareTo(b.version)>0||o.version.compareTo(b.version)===0&&b.hasPendingWrites?(e.addEntry(o),m=m.insert(_,o)):vi("LocalStore","Ignoring outdated watch update for ",_,". Current version:",b.version," Watch version:",o.version)})),{Ps:m,Is:c}}))}function KF(n,e){const t=Co(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(i=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(i,e))))}function XF(n,e){const t=Co(n);return t.persistence.runTransaction("Allocate target","readwrite",(i=>{let c;return t.Ur.getTargetData(i,e).next((u=>u?(c=u,ur.resolve(c)):t.Ur.allocateTargetId(i).next((m=>(c=new nm(e,m,"TargetPurposeListen",i.currentSequenceNumber),t.Ur.addTargetData(i,c).next((()=>c)))))))})).then((i=>{const c=t.os.get(i.targetId);return(c===null||i.snapshotVersion.compareTo(c.snapshotVersion)>0)&&(t.os=t.os.insert(i.targetId,i),t._s.set(e,i.targetId)),i}))}async function q5(n,e,t){const i=Co(n),c=i.os.get(e),u=t?"readwrite":"readwrite-primary";try{t||await i.persistence.runTransaction("Release target",u,(m=>i.persistence.referenceDelegate.removeTarget(m,c)))}catch(m){if(!A_(m))throw m;vi("LocalStore",`Failed to update sequence numbers for target ${e}: ${m}`)}i.os=i.os.remove(e),i._s.delete(c.target)}function IE(n,e,t){const i=Co(n);let c=Io.min(),u=ds();return i.persistence.runTransaction("Execute query","readwrite",(m=>(function(o,b,I){const M=Co(o),V=M._s.get(I);return V!==void 0?ur.resolve(M.os.get(V)):M.Ur.getTargetData(b,I)})(i,m,jf(e)).next((_=>{if(_)return c=_.lastLimboFreeSnapshotVersion,i.Ur.getMatchingKeysForTargetId(m,_.targetId).next((o=>{u=o}))})).next((()=>i.ss.getDocumentsMatchingQuery(m,e,t?c:Io.min(),t?u:ds()))).next((_=>(ZF(i,zD(e),_),{documents:_,Ts:u})))))}function ZF(n,e,t){let i=n.us.get(e)||Io.min();t.forEach(((c,u)=>{u.readTime.compareTo(i)>0&&(i=u.readTime)})),n.us.set(e,i)}class CE{constructor(){this.activeTargetIds=GD()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class YF{constructor(){this.so=new CE,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,i){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new CE,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JF{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LE{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){vi("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){vi("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let S1=null;function Ub(){return S1===null?S1=(function(){return 268435456+Math.round(2147483648*Math.random())})():S1++,"0x"+S1.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QF={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eO{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bh="WebChannelConnection";class tO extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const i=t.ssl?"https":"http",c=encodeURIComponent(this.databaseId.projectId),u=encodeURIComponent(this.databaseId.database);this.Do=i+"://"+t.host,this.vo=`projects/${c}/databases/${u}`,this.Co=this.databaseId.database==="(default)"?`project_id=${c}`:`project_id=${c}&database_id=${u}`}get Fo(){return!1}Mo(t,i,c,u,m){const _=Ub(),o=this.xo(t,i.toUriEncodedString());vi("RestConnection",`Sending RPC '${t}' ${_}:`,o,c);const b={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(b,u,m),this.No(t,o,b,c).then((I=>(vi("RestConnection",`Received RPC '${t}' ${_}: `,I),I)),(I=>{throw S0("RestConnection",`RPC '${t}' ${_} failed with error: `,I,"url: ",o,"request:",c),I}))}Lo(t,i,c,u,m,_){return this.Mo(t,i,c,u,m)}Oo(t,i,c){t["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+O0})(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),i&&i.headers.forEach(((u,m)=>t[m]=u)),c&&c.headers.forEach(((u,m)=>t[m]=u))}xo(t,i){const c=QF[t];return`${this.Do}/v1/${i}:${c}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,i,c){const u=Ub();return new Promise(((m,_)=>{const o=new h9;o.setWithCredentials(!0),o.listenOnce(d9.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case H1.NO_ERROR:const I=o.getResponseJson();vi(bh,`XHR for RPC '${e}' ${u} received:`,JSON.stringify(I)),m(I);break;case H1.TIMEOUT:vi(bh,`RPC '${e}' ${u} timed out`),_(new hi(Yn.DEADLINE_EXCEEDED,"Request time out"));break;case H1.HTTP_ERROR:const M=o.getStatus();if(vi(bh,`RPC '${e}' ${u} failed with status:`,M,"response text:",o.getResponseText()),M>0){let V=o.getResponseJson();Array.isArray(V)&&(V=V[0]);const k=V?.error;if(k&&k.status&&k.message){const ie=(function(fe){const J=fe.toLowerCase().replace(/_/g,"-");return Object.values(Yn).indexOf(J)>=0?J:Yn.UNKNOWN})(k.status);_(new hi(ie,k.message))}else _(new hi(Yn.UNKNOWN,"Server responded with status "+o.getStatus()))}else _(new hi(Yn.UNAVAILABLE,"Connection failed."));break;default:go()}}finally{vi(bh,`RPC '${e}' ${u} completed.`)}}));const b=JSON.stringify(c);vi(bh,`RPC '${e}' ${u} sending request:`,c),o.send(t,"POST",b,i,15)}))}Bo(e,t,i){const c=Ub(),u=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],m=m9(),_=p9(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},b=this.longPollingOptions.timeoutSeconds;b!==void 0&&(o.longPollingTimeout=Math.round(1e3*b)),this.useFetchStreams&&(o.useFetchStreams=!0),this.Oo(o.initMessageHeaders,t,i),o.encodeInitMessageHeaders=!0;const I=u.join("");vi(bh,`Creating RPC '${e}' stream ${c}: ${I}`,o);const M=m.createWebChannel(I,o);let V=!1,k=!1;const ie=new eO({Io:fe=>{k?vi(bh,`Not sending because RPC '${e}' stream ${c} is closed:`,fe):(V||(vi(bh,`Opening RPC '${e}' stream ${c} transport.`),M.open(),V=!0),vi(bh,`RPC '${e}' stream ${c} sending:`,fe),M.send(fe))},To:()=>M.close()}),se=(fe,J,ne)=>{fe.listen(J,(me=>{try{ne(me)}catch(ue){setTimeout((()=>{throw ue}),0)}}))};return se(M,Py.EventType.OPEN,(()=>{k||(vi(bh,`RPC '${e}' stream ${c} transport opened.`),ie.yo())})),se(M,Py.EventType.CLOSE,(()=>{k||(k=!0,vi(bh,`RPC '${e}' stream ${c} transport closed`),ie.So())})),se(M,Py.EventType.ERROR,(fe=>{k||(k=!0,S0(bh,`RPC '${e}' stream ${c} transport errored:`,fe),ie.So(new hi(Yn.UNAVAILABLE,"The operation could not be completed")))})),se(M,Py.EventType.MESSAGE,(fe=>{var J;if(!k){const ne=fe.data[0];Sa(!!ne);const me=ne,ue=me.error||((J=me[0])===null||J===void 0?void 0:J.error);if(ue){vi(bh,`RPC '${e}' stream ${c} received error:`,ue);const ke=ue.status;let je=(function(F){const q=Jc[F];if(q!==void 0)return U9(q)})(ke),pe=ue.message;je===void 0&&(je=Yn.INTERNAL,pe="Unknown error status: "+ke+" with message "+ue.message),k=!0,ie.So(new hi(je,pe)),M.close()}else vi(bh,`RPC '${e}' stream ${c} received:`,ne),ie.bo(ne)}})),se(_,f9.STAT_EVENT,(fe=>{fe.stat===R5.PROXY?vi(bh,`RPC '${e}' stream ${c} detected buffering proxy`):fe.stat===R5.NOPROXY&&vi(bh,`RPC '${e}' stream ${c} detected no buffering proxy`)})),setTimeout((()=>{ie.wo()}),0),ie}}function Vb(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cx(n){return new hF(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q9{constructor(e,t,i=1e3,c=1.5,u=6e4){this.ui=e,this.timerId=t,this.ko=i,this.qo=c,this.Qo=u,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),i=Math.max(0,Date.now()-this.Uo),c=Math.max(0,t-i);c>0&&vi("ExponentialBackoff",`Backing off for ${c} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,c,(()=>(this.Uo=Date.now(),e()))),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eI{constructor(e,t,i,c,u,m,_,o){this.ui=e,this.Ho=i,this.Jo=c,this.connection=u,this.authCredentialsProvider=m,this.appCheckCredentialsProvider=_,this.listener=o,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Q9(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,(()=>this.__())))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===Yn.RESOURCE_EXHAUSTED?(Tp(t.toString()),Tp("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===Yn.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([i,c])=>{this.Yo===t&&this.P_(i,c)}),(i=>{e((()=>{const c=new hi(Yn.UNKNOWN,"Fetching auth token failed: "+i.message);return this.I_(c)}))}))}P_(e,t){const i=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo((()=>{i((()=>this.listener.Eo()))})),this.stream.Ro((()=>{i((()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,(()=>(this.r_()&&(this.state=3),Promise.resolve()))),this.listener.Ro())))})),this.stream.mo((c=>{i((()=>this.I_(c)))})),this.stream.onMessage((c=>{i((()=>++this.e_==1?this.E_(c):this.onNext(c)))}))}i_(){this.state=5,this.t_.Go((async()=>{this.state=0,this.start()}))}I_(e){return vi("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget((()=>this.Yo===e?t():(vi("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class nO extends eI{constructor(e,t,i,c,u,m){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,i,c,m),this.serializer=u}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=pF(this.serializer,e),i=(function(u){if(!("targetChange"in u))return Io.min();const m=u.targetChange;return m.targetIds&&m.targetIds.length?Io.min():m.readTime?Vf(m.readTime):Io.min()})(e);return this.listener.d_(t,i)}A_(e){const t={};t.database=V5(this.serializer),t.addTarget=(function(u,m){let _;const o=m.target;if(_=F5(o)?{documents:yF(u,o)}:{query:_F(u,o)._t},_.targetId=m.targetId,m.resumeToken.approximateByteSize()>0){_.resumeToken=$9(u,m.resumeToken);const b=z5(u,m.expectedCount);b!==null&&(_.expectedCount=b)}else if(m.snapshotVersion.compareTo(Io.min())>0){_.readTime=Ev(u,m.snapshotVersion.toTimestamp());const b=z5(u,m.expectedCount);b!==null&&(_.expectedCount=b)}return _})(this.serializer,e);const i=xF(this.serializer,e);i&&(t.labels=i),this.a_(t)}R_(e){const t={};t.database=V5(this.serializer),t.removeTarget=e,this.a_(t)}}class rO extends eI{constructor(e,t,i,c,u,m){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,c,m),this.serializer=u}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return Sa(!!e.streamToken),this.lastStreamToken=e.streamToken,Sa(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Sa(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=gF(e.writeResults,e.commitTime),i=Vf(e.commitTime);return this.listener.g_(i,t)}p_(){const e={};e.database=V5(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map((i=>mF(this.serializer,i)))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iO extends class{}{constructor(e,t,i,c){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=i,this.serializer=c,this.y_=!1}w_(){if(this.y_)throw new hi(Yn.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,i,c){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([u,m])=>this.connection.Mo(e,j5(t,i),c,u,m))).catch((u=>{throw u.name==="FirebaseError"?(u.code===Yn.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),u):new hi(Yn.UNKNOWN,u.toString())}))}Lo(e,t,i,c,u){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([m,_])=>this.connection.Lo(e,j5(t,i),c,m,_,u))).catch((m=>{throw m.name==="FirebaseError"?(m.code===Yn.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),m):new hi(Yn.UNKNOWN,m.toString())}))}terminate(){this.y_=!0,this.connection.terminate()}}class oO{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve()))))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Tp(t),this.D_=!1):vi("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sO{constructor(e,t,i,c,u){this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=u,this.k_._o((m=>{i.enqueueAndForget((async()=>{gg(this)&&(vi("RemoteStore","Restarting streams for network reachability change."),await(async function(o){const b=Co(o);b.L_.add(4),await L_(b),b.q_.set("Unknown"),b.L_.delete(4),await ux(b)})(this))}))})),this.q_=new oO(i,c)}}async function ux(n){if(gg(n))for(const e of n.B_)await e(!0)}async function L_(n){for(const e of n.B_)await e(!1)}function tI(n,e){const t=Co(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Gw(t)?$w(t):j0(t).r_()&&qw(t,e))}function Vw(n,e){const t=Co(n),i=j0(t);t.N_.delete(e),i.r_()&&nI(t,e),t.N_.size===0&&(i.r_()?i.o_():gg(t)&&t.q_.set("Unknown"))}function qw(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Io.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}j0(n).A_(e)}function nI(n,e){n.Q_.xe(e),j0(n).R_(e)}function $w(n){n.Q_=new aF({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),j0(n).start(),n.q_.v_()}function Gw(n){return gg(n)&&!j0(n).n_()&&n.N_.size>0}function gg(n){return Co(n).L_.size===0}function rI(n){n.Q_=void 0}async function aO(n){n.q_.set("Online")}async function lO(n){n.N_.forEach(((e,t)=>{qw(n,e)}))}async function cO(n,e){rI(n),Gw(n)?(n.q_.M_(e),$w(n)):n.q_.set("Unknown")}async function uO(n,e,t){if(n.q_.set("Online"),e instanceof q9&&e.state===2&&e.cause)try{await(async function(c,u){const m=u.cause;for(const _ of u.targetIds)c.N_.has(_)&&(await c.remoteSyncer.rejectListen(_,m),c.N_.delete(_),c.Q_.removeTarget(_))})(n,e)}catch(i){vi("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),i),await Av(n,i)}else if(e instanceof X1?n.Q_.Ke(e):e instanceof V9?n.Q_.He(e):n.Q_.We(e),!t.isEqual(Io.min()))try{const i=await J9(n.localStore);t.compareTo(i)>=0&&await(function(u,m){const _=u.Q_.rt(m);return _.targetChanges.forEach(((o,b)=>{if(o.resumeToken.approximateByteSize()>0){const I=u.N_.get(b);I&&u.N_.set(b,I.withResumeToken(o.resumeToken,m))}})),_.targetMismatches.forEach(((o,b)=>{const I=u.N_.get(o);if(!I)return;u.N_.set(o,I.withResumeToken(Qu.EMPTY_BYTE_STRING,I.snapshotVersion)),nI(u,o);const M=new nm(I.target,o,b,I.sequenceNumber);qw(u,M)})),u.remoteSyncer.applyRemoteEvent(_)})(n,t)}catch(i){vi("RemoteStore","Failed to raise snapshot:",i),await Av(n,i)}}async function Av(n,e,t){if(!A_(e))throw e;n.L_.add(1),await L_(n),n.q_.set("Offline"),t||(t=()=>J9(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{vi("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await ux(n)}))}function iI(n,e){return e().catch((t=>Av(n,t,e)))}async function hx(n){const e=Co(n),t=mm(e);let i=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;hO(e);)try{const c=await KF(e.localStore,i);if(c===null){e.O_.length===0&&t.o_();break}i=c.batchId,dO(e,c)}catch(c){await Av(e,c)}oI(e)&&sI(e)}function hO(n){return gg(n)&&n.O_.length<10}function dO(n,e){n.O_.push(e);const t=mm(n);t.r_()&&t.V_&&t.m_(e.mutations)}function oI(n){return gg(n)&&!mm(n).n_()&&n.O_.length>0}function sI(n){mm(n).start()}async function fO(n){mm(n).p_()}async function pO(n){const e=mm(n);for(const t of n.O_)e.m_(t.mutations)}async function mO(n,e,t){const i=n.O_.shift(),c=Fw.from(i,e,t);await iI(n,(()=>n.remoteSyncer.applySuccessfulWrite(c))),await hx(n)}async function gO(n,e){e&&mm(n).V_&&await(async function(i,c){if((function(m){return iF(m)&&m!==Yn.ABORTED})(c.code)){const u=i.O_.shift();mm(i).s_(),await iI(i,(()=>i.remoteSyncer.rejectFailedWrite(u.batchId,c))),await hx(i)}})(n,e),oI(n)&&sI(n)}async function PE(n,e){const t=Co(n);t.asyncQueue.verifyOperationInProgress(),vi("RemoteStore","RemoteStore received new credentials");const i=gg(t);t.L_.add(3),await L_(t),i&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await ux(t)}async function yO(n,e){const t=Co(n);e?(t.L_.delete(2),await ux(t)):e||(t.L_.add(2),await L_(t),t.q_.set("Unknown"))}function j0(n){return n.K_||(n.K_=(function(t,i,c){const u=Co(t);return u.w_(),new nO(i,u.connection,u.authCredentials,u.appCheckCredentials,u.serializer,c)})(n.datastore,n.asyncQueue,{Eo:aO.bind(null,n),Ro:lO.bind(null,n),mo:cO.bind(null,n),d_:uO.bind(null,n)}),n.B_.push((async e=>{e?(n.K_.s_(),Gw(n)?$w(n):n.q_.set("Unknown")):(await n.K_.stop(),rI(n))}))),n.K_}function mm(n){return n.U_||(n.U_=(function(t,i,c){const u=Co(t);return u.w_(),new rO(i,u.connection,u.authCredentials,u.appCheckCredentials,u.serializer,c)})(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:fO.bind(null,n),mo:gO.bind(null,n),f_:pO.bind(null,n),g_:mO.bind(null,n)}),n.B_.push((async e=>{e?(n.U_.s_(),await hx(n)):(await n.U_.stop(),n.O_.length>0&&(vi("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))}))),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hw{constructor(e,t,i,c,u){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=c,this.removalCallback=u,this.deferred=new bp,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((m=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,i,c,u){const m=Date.now()+i,_=new Hw(e,t,m,c,u);return _.start(i),_}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new hi(Yn.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ww(n,e){if(Tp("AsyncQueue",`${e}: ${n}`),A_(n))return new hi(Yn.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y0{constructor(e){this.comparator=e?(t,i)=>e(t,i)||$i.comparator(t.key,i.key):(t,i)=>$i.comparator(t.key,i.key),this.keyedMap=ky(),this.sortedSet=new Yl(this.comparator)}static emptySet(e){return new y0(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,i)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof y0)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;t.hasNext();){const c=t.getNext().key,u=i.getNext().key;if(!c.isEqual(u))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const i=new y0;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=t,i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kE{constructor(){this.W_=new Yl($i.comparator)}track(e){const t=e.doc.key,i=this.W_.get(t);i?e.type!==0&&i.type===3?this.W_=this.W_.insert(t,e):e.type===3&&i.type!==1?this.W_=this.W_.insert(t,{type:i.type,doc:e.doc}):e.type===2&&i.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&i.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&i.type===0?this.W_=this.W_.remove(t):e.type===1&&i.type===2?this.W_=this.W_.insert(t,{type:1,doc:i.doc}):e.type===0&&i.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):go():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal(((t,i)=>{e.push(i)})),e}}class C0{constructor(e,t,i,c,u,m,_,o,b){this.query=e,this.docs=t,this.oldDocs=i,this.docChanges=c,this.mutatedKeys=u,this.fromCache=m,this.syncStateChanged=_,this.excludesMetadataChanges=o,this.hasCachedResults=b}static fromInitialDocuments(e,t,i,c,u){const m=[];return t.forEach((_=>{m.push({type:0,doc:_})})),new C0(e,t,y0.emptySet(t),m,i,c,!0,!1,u)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ix(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,i=e.docChanges;if(t.length!==i.length)return!1;for(let c=0;c<t.length;c++)if(t[c].type!==i[c].type||!t[c].doc.isEqual(i[c].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _O{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some((e=>e.J_()))}}class vO{constructor(){this.queries=RE(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,i){const c=Co(t),u=c.queries;c.queries=RE(),u.forEach(((m,_)=>{for(const o of _.j_)o.onError(i)}))})(this,new hi(Yn.ABORTED,"Firestore shutting down"))}}function RE(){return new z0((n=>C9(n)),ix)}async function Kw(n,e){const t=Co(n);let i=3;const c=e.query;let u=t.queries.get(c);u?!u.H_()&&e.J_()&&(i=2):(u=new _O,i=e.J_()?0:1);try{switch(i){case 0:u.z_=await t.onListen(c,!0);break;case 1:u.z_=await t.onListen(c,!1);break;case 2:await t.onFirstRemoteStoreListen(c)}}catch(m){const _=Ww(m,`Initialization of query '${n0(e.query)}' failed`);return void e.onError(_)}t.queries.set(c,u),u.j_.push(e),e.Z_(t.onlineState),u.z_&&e.X_(u.z_)&&Zw(t)}async function Xw(n,e){const t=Co(n),i=e.query;let c=3;const u=t.queries.get(i);if(u){const m=u.j_.indexOf(e);m>=0&&(u.j_.splice(m,1),u.j_.length===0?c=e.J_()?0:1:!u.H_()&&e.J_()&&(c=2))}switch(c){case 0:return t.queries.delete(i),t.onUnlisten(i,!0);case 1:return t.queries.delete(i),t.onUnlisten(i,!1);case 2:return t.onLastRemoteStoreUnlisten(i);default:return}}function xO(n,e){const t=Co(n);let i=!1;for(const c of e){const u=c.query,m=t.queries.get(u);if(m){for(const _ of m.j_)_.X_(c)&&(i=!0);m.z_=c}}i&&Zw(t)}function bO(n,e,t){const i=Co(n),c=i.queries.get(e);if(c)for(const u of c.j_)u.onError(t);i.queries.delete(e)}function Zw(n){n.Y_.forEach((e=>{e.next()}))}var $5,ME;(ME=$5||($5={})).ea="default",ME.Cache="cache";class Yw{constructor(e,t,i){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=i||{}}X_(e){if(!this.options.includeMetadataChanges){const i=[];for(const c of e.docChanges)c.type!==3&&i.push(c);e=new C0(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const i=t!=="Offline";return(!this.options._a||!i)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=C0.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==$5.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aI{constructor(e){this.key=e}}class lI{constructor(e){this.key=e}}class wO{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=ds(),this.mutatedKeys=ds(),this.Aa=L9(e),this.Ra=new y0(this.Aa)}get Va(){return this.Ta}ma(e,t){const i=t?t.fa:new kE,c=t?t.Ra:this.Ra;let u=t?t.mutatedKeys:this.mutatedKeys,m=c,_=!1;const o=this.query.limitType==="F"&&c.size===this.query.limit?c.last():null,b=this.query.limitType==="L"&&c.size===this.query.limit?c.first():null;if(e.inorderTraversal(((I,M)=>{const V=c.get(I),k=ox(this.query,M)?M:null,ie=!!V&&this.mutatedKeys.has(V.key),se=!!k&&(k.hasLocalMutations||this.mutatedKeys.has(k.key)&&k.hasCommittedMutations);let fe=!1;V&&k?V.data.isEqual(k.data)?ie!==se&&(i.track({type:3,doc:k}),fe=!0):this.ga(V,k)||(i.track({type:2,doc:k}),fe=!0,(o&&this.Aa(k,o)>0||b&&this.Aa(k,b)<0)&&(_=!0)):!V&&k?(i.track({type:0,doc:k}),fe=!0):V&&!k&&(i.track({type:1,doc:V}),fe=!0,(o||b)&&(_=!0)),fe&&(k?(m=m.add(k),u=se?u.add(I):u.delete(I)):(m=m.delete(I),u=u.delete(I)))})),this.query.limit!==null)for(;m.size>this.query.limit;){const I=this.query.limitType==="F"?m.last():m.first();m=m.delete(I.key),u=u.delete(I.key),i.track({type:1,doc:I})}return{Ra:m,fa:i,ns:_,mutatedKeys:u}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,i,c){const u=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const m=e.fa.G_();m.sort(((I,M)=>(function(k,ie){const se=fe=>{switch(fe){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return go()}};return se(k)-se(ie)})(I.type,M.type)||this.Aa(I.doc,M.doc))),this.pa(i),c=c!=null&&c;const _=t&&!c?this.ya():[],o=this.da.size===0&&this.current&&!c?1:0,b=o!==this.Ea;return this.Ea=o,m.length!==0||b?{snapshot:new C0(this.query,e.Ra,u,m,e.mutatedKeys,o===0,b,!1,!!i&&i.resumeToken.approximateByteSize()>0),wa:_}:{wa:_}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new kE,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach((t=>this.Ta=this.Ta.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ta=this.Ta.delete(t))),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=ds(),this.Ra.forEach((i=>{this.Sa(i.key)&&(this.da=this.da.add(i.key))}));const t=[];return e.forEach((i=>{this.da.has(i)||t.push(new lI(i))})),this.da.forEach((i=>{e.has(i)||t.push(new aI(i))})),t}ba(e){this.Ta=e.Ts,this.da=ds();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return C0.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class SO{constructor(e,t,i){this.query=e,this.targetId=t,this.view=i}}class EO{constructor(e){this.key=e,this.va=!1}}class AO{constructor(e,t,i,c,u,m){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=c,this.currentUser=u,this.maxConcurrentLimboResolutions=m,this.Ca={},this.Fa=new z0((_=>C9(_)),ix),this.Ma=new Map,this.xa=new Set,this.Oa=new Yl($i.comparator),this.Na=new Map,this.La=new zw,this.Ba={},this.ka=new Map,this.qa=I0.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function TO(n,e,t=!0){const i=pI(n);let c;const u=i.Fa.get(e);return u?(i.sharedClientState.addLocalQueryTarget(u.targetId),c=u.view.Da()):c=await cI(i,e,t,!0),c}async function IO(n,e){const t=pI(n);await cI(t,e,!0,!1)}async function cI(n,e,t,i){const c=await XF(n.localStore,jf(e)),u=c.targetId,m=n.sharedClientState.addLocalQueryTarget(u,t);let _;return i&&(_=await CO(n,e,u,m==="current",c.resumeToken)),n.isPrimaryClient&&t&&tI(n.remoteStore,c),_}async function CO(n,e,t,i,c){n.Ka=(M,V,k)=>(async function(se,fe,J,ne){let me=fe.view.ma(J);me.ns&&(me=await IE(se.localStore,fe.query,!1).then((({documents:pe})=>fe.view.ma(pe,me))));const ue=ne&&ne.targetChanges.get(fe.targetId),ke=ne&&ne.targetMismatches.get(fe.targetId)!=null,je=fe.view.applyChanges(me,se.isPrimaryClient,ue,ke);return DE(se,fe.targetId,je.wa),je.snapshot})(n,M,V,k);const u=await IE(n.localStore,e,!0),m=new wO(e,u.Ts),_=m.ma(u.documents),o=C_.createSynthesizedTargetChangeForCurrentChange(t,i&&n.onlineState!=="Offline",c),b=m.applyChanges(_,n.isPrimaryClient,o);DE(n,t,b.wa);const I=new SO(e,t,m);return n.Fa.set(e,I),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),b.snapshot}async function LO(n,e,t){const i=Co(n),c=i.Fa.get(e),u=i.Ma.get(c.targetId);if(u.length>1)return i.Ma.set(c.targetId,u.filter((m=>!ix(m,e)))),void i.Fa.delete(e);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(c.targetId),i.sharedClientState.isActiveQueryTarget(c.targetId)||await q5(i.localStore,c.targetId,!1).then((()=>{i.sharedClientState.clearQueryState(c.targetId),t&&Vw(i.remoteStore,c.targetId),G5(i,c.targetId)})).catch(E_)):(G5(i,c.targetId),await q5(i.localStore,c.targetId,!0))}async function PO(n,e){const t=Co(n),i=t.Fa.get(e),c=t.Ma.get(i.targetId);t.isPrimaryClient&&c.length===1&&(t.sharedClientState.removeLocalQueryTarget(i.targetId),Vw(t.remoteStore,i.targetId))}async function kO(n,e,t){const i=BO(n);try{const c=await(function(m,_){const o=Co(m),b=du.now(),I=_.reduce(((k,ie)=>k.add(ie.key)),ds());let M,V;return o.persistence.runTransaction("Locally write mutations","readwrite",(k=>{let ie=Ip(),se=ds();return o.cs.getEntries(k,I).next((fe=>{ie=fe,ie.forEach(((J,ne)=>{ne.isValidDocument()||(se=se.add(J))}))})).next((()=>o.localDocuments.getOverlayedDocuments(k,ie))).next((fe=>{M=fe;const J=[];for(const ne of _){const me=QD(ne,M.get(ne.key).overlayedDocument);me!=null&&J.push(new mg(ne.key,me,x9(me.value.mapValue),Uf.exists(!0)))}return o.mutationQueue.addMutationBatch(k,b,J,_)})).next((fe=>{V=fe;const J=fe.applyToLocalDocumentSet(M,se);return o.documentOverlayCache.saveOverlays(k,fe.batchId,J)}))})).then((()=>({batchId:V.batchId,changes:k9(M)})))})(i.localStore,e);i.sharedClientState.addPendingMutation(c.batchId),(function(m,_,o){let b=m.Ba[m.currentUser.toKey()];b||(b=new Yl(zs)),b=b.insert(_,o),m.Ba[m.currentUser.toKey()]=b})(i,c.batchId,t),await P_(i,c.changes),await hx(i.remoteStore)}catch(c){const u=Ww(c,"Failed to persist write");t.reject(u)}}async function uI(n,e){const t=Co(n);try{const i=await HF(t.localStore,e);e.targetChanges.forEach(((c,u)=>{const m=t.Na.get(u);m&&(Sa(c.addedDocuments.size+c.modifiedDocuments.size+c.removedDocuments.size<=1),c.addedDocuments.size>0?m.va=!0:c.modifiedDocuments.size>0?Sa(m.va):c.removedDocuments.size>0&&(Sa(m.va),m.va=!1))})),await P_(t,i,e)}catch(i){await E_(i)}}function NE(n,e,t){const i=Co(n);if(i.isPrimaryClient&&t===0||!i.isPrimaryClient&&t===1){const c=[];i.Fa.forEach(((u,m)=>{const _=m.view.Z_(e);_.snapshot&&c.push(_.snapshot)})),(function(m,_){const o=Co(m);o.onlineState=_;let b=!1;o.queries.forEach(((I,M)=>{for(const V of M.j_)V.Z_(_)&&(b=!0)})),b&&Zw(o)})(i.eventManager,e),c.length&&i.Ca.d_(c),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function RO(n,e,t){const i=Co(n);i.sharedClientState.updateQueryState(e,"rejected",t);const c=i.Na.get(e),u=c&&c.key;if(u){let m=new Yl($i.comparator);m=m.insert(u,Ah.newNoDocument(u,Io.min()));const _=ds().add(u),o=new lx(Io.min(),new Map,new Yl(zs),m,_);await uI(i,o),i.Oa=i.Oa.remove(u),i.Na.delete(e),Jw(i)}else await q5(i.localStore,e,!1).then((()=>G5(i,e,t))).catch(E_)}async function MO(n,e){const t=Co(n),i=e.batch.batchId;try{const c=await GF(t.localStore,e);dI(t,i,null),hI(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),await P_(t,c)}catch(c){await E_(c)}}async function NO(n,e,t){const i=Co(n);try{const c=await(function(m,_){const o=Co(m);return o.persistence.runTransaction("Reject batch","readwrite-primary",(b=>{let I;return o.mutationQueue.lookupMutationBatch(b,_).next((M=>(Sa(M!==null),I=M.keys(),o.mutationQueue.removeMutationBatch(b,M)))).next((()=>o.mutationQueue.performConsistencyCheck(b))).next((()=>o.documentOverlayCache.removeOverlaysForBatchId(b,I,_))).next((()=>o.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(b,I))).next((()=>o.localDocuments.getDocuments(b,I)))}))})(i.localStore,e);dI(i,e,t),hI(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),await P_(i,c)}catch(c){await E_(c)}}function hI(n,e){(n.ka.get(e)||[]).forEach((t=>{t.resolve()})),n.ka.delete(e)}function dI(n,e,t){const i=Co(n);let c=i.Ba[i.currentUser.toKey()];if(c){const u=c.get(e);u&&(t?u.reject(t):u.resolve(),c=c.remove(e)),i.Ba[i.currentUser.toKey()]=c}}function G5(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const i of n.Ma.get(e))n.Fa.delete(i),t&&n.Ca.$a(i,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach((i=>{n.La.containsKey(i)||fI(n,i)}))}function fI(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(Vw(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),Jw(n))}function DE(n,e,t){for(const i of t)i instanceof aI?(n.La.addReference(i.key,e),DO(n,i)):i instanceof lI?(vi("SyncEngine","Document no longer in limbo: "+i.key),n.La.removeReference(i.key,e),n.La.containsKey(i.key)||fI(n,i.key)):go()}function DO(n,e){const t=e.key,i=t.path.canonicalString();n.Oa.get(t)||n.xa.has(i)||(vi("SyncEngine","New document in limbo: "+t),n.xa.add(i),Jw(n))}function Jw(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new $i(pl.fromString(e)),i=n.qa.next();n.Na.set(i,new EO(t)),n.Oa=n.Oa.insert(t,i),tI(n.remoteStore,new nm(jf(rx(t.path)),i,"TargetPurposeLimboResolution",Lw.oe))}}async function P_(n,e,t){const i=Co(n),c=[],u=[],m=[];i.Fa.isEmpty()||(i.Fa.forEach(((_,o)=>{m.push(i.Ka(o,e,t).then((b=>{var I;if((b||t)&&i.isPrimaryClient){const M=b?!b.fromCache:(I=t?.targetChanges.get(o.targetId))===null||I===void 0?void 0:I.current;i.sharedClientState.updateQueryState(o.targetId,M?"current":"not-current")}if(b){c.push(b);const M=Uw.Wi(o.targetId,b);u.push(M)}})))})),await Promise.all(m),i.Ca.d_(c),await(async function(o,b){const I=Co(o);try{await I.persistence.runTransaction("notifyLocalViewChanges","readwrite",(M=>ur.forEach(b,(V=>ur.forEach(V.$i,(k=>I.persistence.referenceDelegate.addReference(M,V.targetId,k))).next((()=>ur.forEach(V.Ui,(k=>I.persistence.referenceDelegate.removeReference(M,V.targetId,k)))))))))}catch(M){if(!A_(M))throw M;vi("LocalStore","Failed to update sequence numbers: "+M)}for(const M of b){const V=M.targetId;if(!M.fromCache){const k=I.os.get(V),ie=k.snapshotVersion,se=k.withLastLimboFreeSnapshotVersion(ie);I.os=I.os.insert(V,se)}}})(i.localStore,u))}async function FO(n,e){const t=Co(n);if(!t.currentUser.isEqual(e)){vi("SyncEngine","User change. New user:",e.toKey());const i=await Y9(t.localStore,e);t.currentUser=e,(function(u,m){u.ka.forEach((_=>{_.forEach((o=>{o.reject(new hi(Yn.CANCELLED,m))}))})),u.ka.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),await P_(t,i.hs)}}function OO(n,e){const t=Co(n),i=t.Na.get(e);if(i&&i.va)return ds().add(i.key);{let c=ds();const u=t.Ma.get(e);if(!u)return c;for(const m of u){const _=t.Fa.get(m);c=c.unionWith(_.view.Va)}return c}}function pI(n){const e=Co(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=uI.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=OO.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=RO.bind(null,e),e.Ca.d_=xO.bind(null,e.eventManager),e.Ca.$a=bO.bind(null,e.eventManager),e}function BO(n){const e=Co(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=MO.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=NO.bind(null,e),e}class Tv{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=cx(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return $F(this.persistence,new VF,e.initialUser,this.serializer)}Ga(e){return new zF(jw.Zr,this.serializer)}Wa(e){return new YF}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Tv.provider={build:()=>new Tv};class H5{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>NE(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=FO.bind(null,this.syncEngine),await yO(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new vO})()}createDatastore(e){const t=cx(e.databaseInfo.databaseId),i=(function(u){return new tO(u)})(e.databaseInfo);return(function(u,m,_,o){return new iO(u,m,_,o)})(e.authCredentials,e.appCheckCredentials,i,t)}createRemoteStore(e){return(function(i,c,u,m,_){return new sO(i,c,u,m,_)})(this.localStore,this.datastore,e.asyncQueue,(t=>NE(this.syncEngine,t,0)),(function(){return LE.D()?new LE:new JF})())}createSyncEngine(e,t){return(function(c,u,m,_,o,b,I){const M=new AO(c,u,m,_,o,b);return I&&(M.Qa=!0),M})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await(async function(c){const u=Co(c);vi("RemoteStore","RemoteStore shutting down."),u.L_.add(5),await L_(u),u.k_.shutdown(),u.q_.set("Unknown")})(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}H5.provider={build:()=>new H5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qw{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Tp("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zO{constructor(e,t,i,c,u){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this.databaseInfo=c,this.user=Eh.UNAUTHENTICATED,this.clientId=y9.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=u,this.authCredentials.start(i,(async m=>{vi("FirestoreClient","Received user=",m.uid),await this.authCredentialListener(m),this.user=m})),this.appCheckCredentials.start(i,(m=>(vi("FirestoreClient","Received new app check token=",m),this.appCheckCredentialListener(m,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new bp;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const i=Ww(t,"Failed to shutdown persistence");e.reject(i)}})),e.promise}}async function qb(n,e){n.asyncQueue.verifyOperationInProgress(),vi("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let i=t.initialUser;n.setCredentialChangeListener((async c=>{i.isEqual(c)||(await Y9(e.localStore,c),i=c)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function FE(n,e){n.asyncQueue.verifyOperationInProgress();const t=await jO(n);vi("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((i=>PE(e.remoteStore,i))),n.setAppCheckTokenChangeListener(((i,c)=>PE(e.remoteStore,c))),n._onlineComponents=e}async function jO(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){vi("FirestoreClient","Using user provided OfflineComponentProvider");try{await qb(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(c){return c.name==="FirebaseError"?c.code===Yn.FAILED_PRECONDITION||c.code===Yn.UNIMPLEMENTED:!(typeof DOMException<"u"&&c instanceof DOMException)||c.code===22||c.code===20||c.code===11})(t))throw t;S0("Error using user provided cache. Falling back to memory cache: "+t),await qb(n,new Tv)}}else vi("FirestoreClient","Using default OfflineComponentProvider"),await qb(n,new Tv);return n._offlineComponents}async function mI(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(vi("FirestoreClient","Using user provided OnlineComponentProvider"),await FE(n,n._uninitializedComponentsProvider._online)):(vi("FirestoreClient","Using default OnlineComponentProvider"),await FE(n,new H5))),n._onlineComponents}function UO(n){return mI(n).then((e=>e.syncEngine))}async function Iv(n){const e=await mI(n),t=e.eventManager;return t.onListen=TO.bind(null,e.syncEngine),t.onUnlisten=LO.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=IO.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=PO.bind(null,e.syncEngine),t}function VO(n,e,t={}){const i=new bp;return n.asyncQueue.enqueueAndForget((async()=>(function(u,m,_,o,b){const I=new Qw({next:V=>{I.Za(),m.enqueueAndForget((()=>Xw(u,M)));const k=V.docs.has(_);!k&&V.fromCache?b.reject(new hi(Yn.UNAVAILABLE,"Failed to get document because the client is offline.")):k&&V.fromCache&&o&&o.source==="server"?b.reject(new hi(Yn.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):b.resolve(V)},error:V=>b.reject(V)}),M=new Yw(rx(_.path),I,{includeMetadataChanges:!0,_a:!0});return Kw(u,M)})(await Iv(n),n.asyncQueue,e,t,i))),i.promise}function qO(n,e,t={}){const i=new bp;return n.asyncQueue.enqueueAndForget((async()=>(function(u,m,_,o,b){const I=new Qw({next:V=>{I.Za(),m.enqueueAndForget((()=>Xw(u,M))),V.fromCache&&o.source==="server"?b.reject(new hi(Yn.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):b.resolve(V)},error:V=>b.reject(V)}),M=new Yw(_,I,{includeMetadataChanges:!0,_a:!0});return Kw(u,M)})(await Iv(n),n.asyncQueue,e,t,i))),i.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gI(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OE=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yI(n,e,t){if(!t)throw new hi(Yn.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function $O(n,e,t,i){if(e===!0&&i===!0)throw new hi(Yn.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function BE(n){if(!$i.isDocumentKey(n))throw new hi(Yn.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function zE(n){if($i.isDocumentKey(n))throw new hi(Yn.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function dx(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(i){return i.constructor?i.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":go()}function nf(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new hi(Yn.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=dx(n);throw new hi(Yn.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jE{constructor(e){var t,i;if(e.host===void 0){if(e.ssl!==void 0)throw new hi(Yn.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new hi(Yn.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}$O("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=gI((i=e.experimentalLongPollingOptions)!==null&&i!==void 0?i:{}),(function(u){if(u.timeoutSeconds!==void 0){if(isNaN(u.timeoutSeconds))throw new hi(Yn.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (must not be NaN)`);if(u.timeoutSeconds<5)throw new hi(Yn.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (minimum allowed value is 5)`);if(u.timeoutSeconds>30)throw new hi(Yn.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(i,c){return i.timeoutSeconds===c.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class fx{constructor(e,t,i,c){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=c,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new jE({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new hi(Yn.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new hi(Yn.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new jE(e),e.credentials!==void 0&&(this._authCredentials=(function(i){if(!i)return new aD;switch(i.type){case"firstParty":return new hD(i.sessionIndex||"0",i.iamToken||null,i.authTokenFactory||null);case"provider":return i.client;default:throw new hi(Yn.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const i=OE.get(t);i&&(vi("ComponentProvider","Removing Datastore"),OE.delete(t),i.terminate())})(this),Promise.resolve()}}function GO(n,e,t,i={}){var c;const u=(n=nf(n,fx))._getSettings(),m=`${e}:${t}`;if(u.host!=="firestore.googleapis.com"&&u.host!==m&&S0("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},u),{host:m,ssl:!1})),i.mockUserToken){let _,o;if(typeof i.mockUserToken=="string")_=i.mockUserToken,o=Eh.MOCK_USER;else{_=DM(i.mockUserToken,(c=n._app)===null||c===void 0?void 0:c.options.projectId);const b=i.mockUserToken.sub||i.mockUserToken.user_id;if(!b)throw new hi(Yn.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");o=new Eh(b)}n._authCredentials=new lD(new g9(_,o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yg{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new yg(this.firestore,e,this._query)}}class Oh{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new lm(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Oh(this.firestore,e,this._key)}}class lm extends yg{constructor(e,t,i){super(e,t,rx(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Oh(this.firestore,null,new $i(e))}withConverter(e){return new lm(this.firestore,e,this._path)}}function Bm(n,e,...t){if(n=Bh(n),yI("collection","path",e),n instanceof fx){const i=pl.fromString(e,...t);return zE(i),new lm(n,null,i)}{if(!(n instanceof Oh||n instanceof lm))throw new hi(Yn.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(pl.fromString(e,...t));return zE(i),new lm(n.firestore,null,i)}}function l0(n,e,...t){if(n=Bh(n),arguments.length===1&&(e=y9.newId()),yI("doc","path",e),n instanceof fx){const i=pl.fromString(e,...t);return BE(i),new Oh(n,null,new $i(i))}{if(!(n instanceof Oh||n instanceof lm))throw new hi(Yn.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(pl.fromString(e,...t));return BE(i),new Oh(n.firestore,n instanceof lm?n.converter:null,new $i(i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UE{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Q9(this,"async_queue_retry"),this.Vu=()=>{const i=Vb();i&&vi("AsyncQueue","Visibility state changed to "+i.visibilityState),this.t_.jo()},this.mu=e;const t=Vb();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=Vb();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise((()=>{}));const t=new bp;return this.gu((()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Pu.push(e),this.pu())))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!A_(e))throw e;vi("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go((()=>this.pu()))}}gu(e){const t=this.mu.then((()=>(this.du=!0,e().catch((i=>{this.Eu=i,this.du=!1;const c=(function(m){let _=m.message||"";return m.stack&&(_=m.stack.includes(m.message)?m.stack:m.message+`
`+m.stack),_})(i);throw Tp("INTERNAL UNHANDLED ERROR: ",c),i})).then((i=>(this.du=!1,i))))));return this.mu=t,t}enqueueAfterDelay(e,t,i){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const c=Hw.createAndSchedule(this,e,t,i,(u=>this.yu(u)));return this.Tu.push(c),c}fu(){this.Eu&&go()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then((()=>{this.Tu.sort(((t,i)=>t.targetTimeMs-i.targetTimeMs));for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()}))}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function VE(n){return(function(t,i){if(typeof t!="object"||t===null)return!1;const c=t;for(const u of i)if(u in c&&typeof c[u]=="function")return!0;return!1})(n,["next","error","complete"])}class ag extends fx{constructor(e,t,i,c){super(e,t,i,c),this.type="firestore",this._queue=new UE,this._persistenceKey=c?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new UE(e),this._firestoreClient=void 0,await e}}}function HO(n,e){const t=typeof n=="object"?n:a9(),i=typeof n=="string"?n:"(default)",c=Iw(t,"firestore").getImmediate({identifier:i});if(!c._initialized){const u=MM("firestore");u&&GO(c,...u)}return c}function px(n){if(n._terminated)throw new hi(Yn.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||WO(n),n._firestoreClient}function WO(n){var e,t,i;const c=n._freezeSettings(),u=(function(_,o,b,I){return new ED(_,o,b,I.host,I.ssl,I.experimentalForceLongPolling,I.experimentalAutoDetectLongPolling,gI(I.experimentalLongPollingOptions),I.useFetchStreams)})(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,c);n._componentsProvider||!((t=c.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((i=c.localCache)===null||i===void 0)&&i._onlineComponentProvider)&&(n._componentsProvider={_offline:c.localCache._offlineComponentProvider,_online:c.localCache._onlineComponentProvider}),n._firestoreClient=new zO(n._authCredentials,n._appCheckCredentials,n._queue,u,n._componentsProvider&&(function(_){const o=_?._online.build();return{_offline:_?._offline.build(o),_online:o}})(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L0{constructor(e){this._byteString=e}static fromBase64String(e){try{return new L0(Qu.fromBase64String(e))}catch(t){throw new hi(Yn.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new L0(Qu.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e3{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new hi(Yn.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Yu(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t3{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mx{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new hi(Yn.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new hi(Yn.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return zs(this._lat,e._lat)||zs(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n3{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(i,c){if(i.length!==c.length)return!1;for(let u=0;u<i.length;++u)if(i[u]!==c[u])return!1;return!0})(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KO=/^__.*__$/;class XO{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return this.fieldMask!==null?new mg(e,this.data,this.fieldMask,t,this.fieldTransforms):new I_(e,this.data,t,this.fieldTransforms)}}function _I(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw go()}}class r3{constructor(e,t,i,c,u,m){this.settings=e,this.databaseId=t,this.serializer=i,this.ignoreUndefinedProperties=c,u===void 0&&this.vu(),this.fieldTransforms=u||[],this.fieldMask=m||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new r3(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const i=(t=this.path)===null||t===void 0?void 0:t.child(e),c=this.Fu({path:i,xu:!1});return c.Ou(e),c}Nu(e){var t;const i=(t=this.path)===null||t===void 0?void 0:t.child(e),c=this.Fu({path:i,xu:!1});return c.vu(),c}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Cv(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(_I(this.Cu)&&KO.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class ZO{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=i||cx(e)}Qu(e,t,i,c=!1){return new r3({Cu:e,methodName:t,qu:i,path:Yu.emptyPath(),xu:!1,ku:c},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function i3(n){const e=n._freezeSettings(),t=cx(n._databaseId);return new ZO(n._databaseId,!!e.ignoreUndefinedProperties,t)}function vI(n,e,t,i,c,u={}){const m=n.Qu(u.merge||u.mergeFields?2:0,e,t,c);wI("Data must be an object, but it was:",m,i);const _=xI(i,m);let o,b;if(u.merge)o=new tf(m.fieldMask),b=m.fieldTransforms;else if(u.mergeFields){const I=[];for(const M of u.mergeFields){const V=JO(e,M,t);if(!m.contains(V))throw new hi(Yn.INVALID_ARGUMENT,`Field '${V}' is specified in your field mask but missing from your input data.`);eB(I,V)||I.push(V)}o=new tf(I),b=m.fieldTransforms.filter((M=>o.covers(M.field)))}else o=null,b=m.fieldTransforms;return new XO(new Rd(_),o,b)}class o3 extends t3{_toFieldTransform(e){return new XD(e.path,new h_)}isEqual(e){return e instanceof o3}}function YO(n,e,t,i=!1){return s3(t,n.Qu(i?4:3,e))}function s3(n,e){if(bI(n=Bh(n)))return wI("Unsupported field value:",e,n),xI(n,e);if(n instanceof t3)return(function(i,c){if(!_I(c.Cu))throw c.Bu(`${i._methodName}() can only be used with update() and set()`);if(!c.path)throw c.Bu(`${i._methodName}() is not currently supported inside arrays`);const u=i._toFieldTransform(c);u&&c.fieldTransforms.push(u)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return(function(i,c){const u=[];let m=0;for(const _ of i){let o=s3(_,c.Lu(m));o==null&&(o={nullValue:"NULL_VALUE"}),u.push(o),m++}return{arrayValue:{values:u}}})(n,e)}return(function(i,c){if((i=Bh(i))===null)return{nullValue:"NULL_VALUE"};if(typeof i=="number")return HD(c.serializer,i);if(typeof i=="boolean")return{booleanValue:i};if(typeof i=="string")return{stringValue:i};if(i instanceof Date){const u=du.fromDate(i);return{timestampValue:Ev(c.serializer,u)}}if(i instanceof du){const u=new du(i.seconds,1e3*Math.floor(i.nanoseconds/1e3));return{timestampValue:Ev(c.serializer,u)}}if(i instanceof mx)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof L0)return{bytesValue:$9(c.serializer,i._byteString)};if(i instanceof Oh){const u=c.databaseId,m=i.firestore._databaseId;if(!m.isEqual(u))throw c.Bu(`Document reference is for database ${m.projectId}/${m.database} but should be for database ${u.projectId}/${u.database}`);return{referenceValue:Bw(i.firestore._databaseId||c.databaseId,i._key.path)}}if(i instanceof n3)return(function(m,_){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:m.toArray().map((o=>{if(typeof o!="number")throw _.Bu("VectorValues must only contain numeric values.");return Dw(_.serializer,o)}))}}}}}})(i,c);throw c.Bu(`Unsupported field value: ${dx(i)}`)})(n,e)}function xI(n,e){const t={};return _9(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):B0(n,((i,c)=>{const u=s3(c,e.Mu(i));u!=null&&(t[i]=u)})),{mapValue:{fields:t}}}function bI(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof du||n instanceof mx||n instanceof L0||n instanceof Oh||n instanceof t3||n instanceof n3)}function wI(n,e,t){if(!bI(t)||!(function(c){return typeof c=="object"&&c!==null&&(Object.getPrototypeOf(c)===Object.prototype||Object.getPrototypeOf(c)===null)})(t)){const i=dx(t);throw i==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+i)}}function JO(n,e,t){if((e=Bh(e))instanceof e3)return e._internalPath;if(typeof e=="string")return SI(n,e);throw Cv("Field path arguments must be of type string or ",n,!1,void 0,t)}const QO=new RegExp("[~\\*/\\[\\]]");function SI(n,e,t){if(e.search(QO)>=0)throw Cv(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new e3(...e.split("."))._internalPath}catch{throw Cv(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Cv(n,e,t,i,c){const u=i&&!i.isEmpty(),m=c!==void 0;let _=`Function ${e}() called with invalid data`;t&&(_+=" (via `toFirestore()`)"),_+=". ";let o="";return(u||m)&&(o+=" (found",u&&(o+=` in field ${i}`),m&&(o+=` in document ${c}`),o+=")"),new hi(Yn.INVALID_ARGUMENT,_+n+o)}function eB(n,e){return n.some((t=>t.isEqual(e)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EI{constructor(e,t,i,c,u){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=c,this._converter=u}get id(){return this._key.path.lastSegment()}get ref(){return new Oh(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new tB(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(a3("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class tB extends EI{data(){return super.data()}}function a3(n,e){return typeof e=="string"?SI(n,e):e instanceof e3?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AI(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new hi(Yn.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class l3{}class nB extends l3{}function qE(n,e,...t){let i=[];e instanceof l3&&i.push(e),i=i.concat(t),(function(u){const m=u.filter((o=>o instanceof c3)).length,_=u.filter((o=>o instanceof gx)).length;if(m>1||m>0&&_>0)throw new hi(Yn.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(i);for(const c of i)n=c._apply(n);return n}class gx extends nB{constructor(e,t,i){super(),this._field=e,this._op=t,this._value=i,this.type="where"}static _create(e,t,i){return new gx(e,t,i)}_apply(e){const t=this._parse(e);return TI(e._query,t),new yg(e.firestore,e.converter,O5(e._query,t))}_parse(e){const t=i3(e.firestore);return(function(u,m,_,o,b,I,M){let V;if(b.isKeyField()){if(I==="array-contains"||I==="array-contains-any")throw new hi(Yn.INVALID_ARGUMENT,`Invalid Query. You can't perform '${I}' queries on documentId().`);if(I==="in"||I==="not-in"){GE(M,I);const k=[];for(const ie of M)k.push($E(o,u,ie));V={arrayValue:{values:k}}}else V=$E(o,u,M)}else I!=="in"&&I!=="not-in"&&I!=="array-contains-any"||GE(M,I),V=YO(_,m,M,I==="in"||I==="not-in");return eu.create(b,I,V)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function rB(n,e,t){const i=e,c=a3("where",n);return gx._create(c,i,t)}class c3 extends l3{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new c3(e,t)}_parse(e){const t=this._queryConstraints.map((i=>i._parse(e))).filter((i=>i.getFilters().length>0));return t.length===1?t[0]:sf.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(c,u){let m=c;const _=u.getFlattenedFilters();for(const o of _)TI(m,o),m=O5(m,o)})(e._query,t),new yg(e.firestore,e.converter,O5(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function $E(n,e,t){if(typeof(t=Bh(t))=="string"){if(t==="")throw new hi(Yn.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!I9(e)&&t.indexOf("/")!==-1)throw new hi(Yn.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const i=e.path.child(pl.fromString(t));if(!$i.isDocumentKey(i))throw new hi(Yn.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return uE(n,new $i(i))}if(t instanceof Oh)return uE(n,t._key);throw new hi(Yn.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${dx(t)}.`)}function GE(n,e){if(!Array.isArray(n)||n.length===0)throw new hi(Yn.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function TI(n,e){const t=(function(c,u){for(const m of c)for(const _ of m.getFlattenedFilters())if(u.indexOf(_.op)>=0)return _.op;return null})(n.filters,(function(c){switch(c){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new hi(Yn.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new hi(Yn.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class iB{convertValue(e,t="none"){switch(sg(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Nc(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(og(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw go()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const i={};return B0(e,((c,u)=>{i[c]=this.convertValue(u,t)})),i}convertVectorValue(e){var t,i,c;const u=(c=(i=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||i===void 0?void 0:i.values)===null||c===void 0?void 0:c.map((m=>Nc(m.doubleValue)));return new n3(u)}convertGeoPoint(e){return new mx(Nc(e.latitude),Nc(e.longitude))}convertArray(e,t){return(e.values||[]).map((i=>this.convertValue(i,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const i=kw(e);return i==null?null:this.convertValue(i,t);case"estimate":return this.convertTimestamp(l_(e));default:return null}}convertTimestamp(e){const t=pm(e);return new du(t.seconds,t.nanos)}convertDocumentKey(e,t){const i=pl.fromString(e);Sa(Z9(i));const c=new c_(i.get(1),i.get(3)),u=new $i(i.popFirst(5));return c.isEqual(t)||Tp(`Document ${u} contains a document reference within a different database (${c.projectId}/${c.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function II(n,e,t){let i;return i=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class My{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class CI extends EI{constructor(e,t,i,c,u,m){super(e,t,i,c,m),this._firestore=e,this._firestoreImpl=e,this.metadata=u}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Z1(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const i=this._document.data.field(a3("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}}class Z1 extends CI{data(e={}){return super.data(e)}}class LI{constructor(e,t,i,c){this._firestore=e,this._userDataWriter=t,this._snapshot=c,this.metadata=new My(c.hasPendingWrites,c.fromCache),this.query=i}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((i=>{e.call(t,new Z1(this._firestore,this._userDataWriter,i.key,i,new My(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new hi(Yn.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(c,u){if(c._snapshot.oldDocs.isEmpty()){let m=0;return c._snapshot.docChanges.map((_=>{const o=new Z1(c._firestore,c._userDataWriter,_.doc.key,_.doc,new My(c._snapshot.mutatedKeys.has(_.doc.key),c._snapshot.fromCache),c.query.converter);return _.doc,{type:"added",doc:o,oldIndex:-1,newIndex:m++}}))}{let m=c._snapshot.oldDocs;return c._snapshot.docChanges.filter((_=>u||_.type!==3)).map((_=>{const o=new Z1(c._firestore,c._userDataWriter,_.doc.key,_.doc,new My(c._snapshot.mutatedKeys.has(_.doc.key),c._snapshot.fromCache),c.query.converter);let b=-1,I=-1;return _.type!==0&&(b=m.indexOf(_.doc.key),m=m.delete(_.doc.key)),_.type!==1&&(m=m.add(_.doc),I=m.indexOf(_.doc.key)),{type:oB(_.type),doc:o,oldIndex:b,newIndex:I}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function oB(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return go()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HE(n){n=nf(n,Oh);const e=nf(n.firestore,ag);return VO(px(e),n._key).then((t=>kI(e,n,t)))}class u3 extends iB{constructor(e){super(),this.firestore=e}convertBytes(e){return new L0(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Oh(this.firestore,null,t)}}function E1(n){n=nf(n,yg);const e=nf(n.firestore,ag),t=px(e),i=new u3(e);return AI(n._query),qO(t,n._query).then((c=>new LI(e,i,n,c)))}function W5(n,e,t){n=nf(n,Oh);const i=nf(n.firestore,ag),c=II(n.converter,e,t);return PI(i,[vI(i3(i),"setDoc",n._key,c,n.converter!==null,t).toMutation(n._key,Uf.none())])}function WE(n,e){const t=nf(n.firestore,ag),i=l0(n),c=II(n.converter,e);return PI(t,[vI(i3(n.firestore),"addDoc",i._key,c,n.converter!==null,{}).toMutation(i._key,Uf.exists(!1))]).then((()=>i))}function sB(n,...e){var t,i,c;n=Bh(n);let u={includeMetadataChanges:!1,source:"default"},m=0;typeof e[m]!="object"||VE(e[m])||(u=e[m],m++);const _={includeMetadataChanges:u.includeMetadataChanges,source:u.source};if(VE(e[m])){const M=e[m];e[m]=(t=M.next)===null||t===void 0?void 0:t.bind(M),e[m+1]=(i=M.error)===null||i===void 0?void 0:i.bind(M),e[m+2]=(c=M.complete)===null||c===void 0?void 0:c.bind(M)}let o,b,I;if(n instanceof Oh)b=nf(n.firestore,ag),I=rx(n._key.path),o={next:M=>{e[m]&&e[m](kI(b,n,M))},error:e[m+1],complete:e[m+2]};else{const M=nf(n,yg);b=nf(M.firestore,ag),I=M._query;const V=new u3(b);o={next:k=>{e[m]&&e[m](new LI(b,V,M,k))},error:e[m+1],complete:e[m+2]},AI(n._query)}return(function(V,k,ie,se){const fe=new Qw(se),J=new Yw(k,fe,ie);return V.asyncQueue.enqueueAndForget((async()=>Kw(await Iv(V),J))),()=>{fe.Za(),V.asyncQueue.enqueueAndForget((async()=>Xw(await Iv(V),J)))}})(px(b),I,_,o)}function PI(n,e){return(function(i,c){const u=new bp;return i.asyncQueue.enqueueAndForget((async()=>kO(await UO(i),c,u))),u.promise})(px(n),e)}function kI(n,e,t){const i=t.docs.get(e._key),c=new u3(n);return new CI(n,c,e._key,i,new My(t.hasPendingWrites,t.fromCache),e.converter)}function A1(){return new o3("serverTimestamp")}(function(e,t=!0){(function(c){O0=c})(F0),w0(new rg("firestore",((i,{instanceIdentifier:c,options:u})=>{const m=i.getProvider("app").getImmediate(),_=new ag(new cD(i.getProvider("auth-internal")),new fD(i.getProvider("app-check-internal")),(function(b,I){if(!Object.prototype.hasOwnProperty.apply(b.options,["projectId"]))throw new hi(Yn.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new c_(b.options.projectId,I)})(m,c),m);return u=Object.assign({useFetchStreams:t},u),_._setSettings(u),_}),"PUBLIC").setMultipleInstances(!0)),am(oE,"4.7.3",e),am(oE,"4.7.3","esm2017")})();function h3(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,i=Object.getOwnPropertySymbols(n);c<i.length;c++)e.indexOf(i[c])<0&&Object.prototype.propertyIsEnumerable.call(n,i[c])&&(t[i[c]]=n[i[c]]);return t}function RI(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const aB=RI,MI=new w_("auth","Firebase",RI());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lv=new Aw("@firebase/auth");function lB(n,...e){Lv.logLevel<=gs.WARN&&Lv.warn(`Auth (${F0}): ${n}`,...e)}function Y1(n,...e){Lv.logLevel<=gs.ERROR&&Lv.error(`Auth (${F0}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wf(n,...e){throw f3(n,...e)}function rf(n,...e){return f3(n,...e)}function d3(n,e,t){const i=Object.assign(Object.assign({},aB()),{[e]:t});return new w_("auth","Firebase",i).create(e,{appName:n.name})}function cm(n){return d3(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function NI(n,e,t){const i=t;if(!(e instanceof i))throw i.name!==e.constructor.name&&Wf(n,"argument-error"),d3(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function f3(n,...e){if(typeof n!="string"){const t=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(t,...i)}return MI.create(n,...e)}function mo(n,e,...t){if(!n)throw f3(e,...t)}function yp(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Y1(e),new Error(e)}function Cp(n,e){n||yp(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K5(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function cB(){return KE()==="http:"||KE()==="https:"}function KE(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uB(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(cB()||zM()||"connection"in navigator)?navigator.onLine:!0}function hB(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k_{constructor(e,t){this.shortDelay=e,this.longDelay=t,Cp(t>e,"Short delay should be less than long delay!"),this.isMobile=FM()||jM()}get(){return uB()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p3(n,e){Cp(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DI{static initialize(e,t,i){this.fetchImpl=e,t&&(this.headersImpl=t),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;yp("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;yp("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;yp("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dB={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fB=new k_(3e4,6e4);function m3(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function U0(n,e,t,i,c={}){return FI(n,c,async()=>{let u={},m={};i&&(e==="GET"?m=i:u={body:JSON.stringify(i)});const _=S_(Object.assign({key:n.config.apiKey},m)).slice(1),o=await n._getAdditionalHeaders();o["Content-Type"]="application/json",n.languageCode&&(o["X-Firebase-Locale"]=n.languageCode);const b=Object.assign({method:e,headers:o},u);return BM()||(b.referrerPolicy="no-referrer"),DI.fetch()(OI(n,n.config.apiHost,t,_),b)})}async function FI(n,e,t){n._canInitEmulator=!1;const i=Object.assign(Object.assign({},dB),e);try{const c=new mB(n),u=await Promise.race([t(),c.promise]);c.clearNetworkTimeout();const m=await u.json();if("needConfirmation"in m)throw T1(n,"account-exists-with-different-credential",m);if(u.ok&&!("errorMessage"in m))return m;{const _=u.ok?m.errorMessage:m.error.message,[o,b]=_.split(" : ");if(o==="FEDERATED_USER_ID_ALREADY_LINKED")throw T1(n,"credential-already-in-use",m);if(o==="EMAIL_EXISTS")throw T1(n,"email-already-in-use",m);if(o==="USER_DISABLED")throw T1(n,"user-disabled",m);const I=i[o]||o.toLowerCase().replace(/[_\s]+/g,"-");if(b)throw d3(n,I,b);Wf(n,I)}}catch(c){if(c instanceof Pp)throw c;Wf(n,"network-request-failed",{message:String(c)})}}async function pB(n,e,t,i,c={}){const u=await U0(n,e,t,i,c);return"mfaPendingCredential"in u&&Wf(n,"multi-factor-auth-required",{_serverResponse:u}),u}function OI(n,e,t,i){const c=`${e}${t}?${i}`;return n.config.emulator?p3(n.config,c):`${n.config.apiScheme}://${c}`}class mB{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,i)=>{this.timer=setTimeout(()=>i(rf(this.auth,"network-request-failed")),fB.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function T1(n,e,t){const i={appName:n.name};t.email&&(i.email=t.email),t.phoneNumber&&(i.phoneNumber=t.phoneNumber);const c=rf(n,e,i);return c.customData._tokenResponse=t,c}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gB(n,e){return U0(n,"POST","/v1/accounts:delete",e)}async function BI(n,e){return U0(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ky(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function yB(n,e=!1){const t=Bh(n),i=await t.getIdToken(e),c=g3(i);mo(c&&c.exp&&c.auth_time&&c.iat,t.auth,"internal-error");const u=typeof c.firebase=="object"?c.firebase:void 0,m=u?.sign_in_provider;return{claims:c,token:i,authTime:Ky($b(c.auth_time)),issuedAtTime:Ky($b(c.iat)),expirationTime:Ky($b(c.exp)),signInProvider:m||null,signInSecondFactor:u?.sign_in_second_factor||null}}function $b(n){return Number(n)*1e3}function g3(n){const[e,t,i]=n.split(".");if(e===void 0||t===void 0||i===void 0)return Y1("JWT malformed, contained fewer than 3 sections"),null;try{const c=e9(t);return c?JSON.parse(c):(Y1("Failed to decode base64 JWT payload"),null)}catch(c){return Y1("Caught error parsing JWT payload as JSON",c?.toString()),null}}function XE(n){const e=g3(n);return mo(e,"internal-error"),mo(typeof e.exp<"u","internal-error"),mo(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function p_(n,e,t=!1){if(t)return e;try{return await e}catch(i){throw i instanceof Pp&&_B(i)&&n.auth.currentUser===n&&await n.auth.signOut(),i}}function _B({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vB{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const i=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),i}else{this.errorBackoff=3e4;const c=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,c)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X5{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ky(this.lastLoginAt),this.creationTime=Ky(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Pv(n){var e;const t=n.auth,i=await n.getIdToken(),c=await p_(n,BI(t,{idToken:i}));mo(c?.users.length,t,"internal-error");const u=c.users[0];n._notifyReloadListener(u);const m=!((e=u.providerUserInfo)===null||e===void 0)&&e.length?zI(u.providerUserInfo):[],_=bB(n.providerData,m),o=n.isAnonymous,b=!(n.email&&u.passwordHash)&&!_?.length,I=o?b:!1,M={uid:u.localId,displayName:u.displayName||null,photoURL:u.photoUrl||null,email:u.email||null,emailVerified:u.emailVerified||!1,phoneNumber:u.phoneNumber||null,tenantId:u.tenantId||null,providerData:_,metadata:new X5(u.createdAt,u.lastLoginAt),isAnonymous:I};Object.assign(n,M)}async function xB(n){const e=Bh(n);await Pv(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function bB(n,e){return[...n.filter(i=>!e.some(c=>c.providerId===i.providerId)),...e]}function zI(n){return n.map(e=>{var{providerId:t}=e,i=h3(e,["providerId"]);return{providerId:t,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wB(n,e){const t=await FI(n,{},async()=>{const i=S_({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:c,apiKey:u}=n.config,m=OI(n,c,"/v1/token",`key=${u}`),_=await n._getAdditionalHeaders();return _["Content-Type"]="application/x-www-form-urlencoded",DI.fetch()(m,{method:"POST",headers:_,body:i})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function SB(n,e){return U0(n,"POST","/v2/accounts:revokeToken",m3(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _0{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){mo(e.idToken,"internal-error"),mo(typeof e.idToken<"u","internal-error"),mo(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):XE(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){mo(e.length!==0,"internal-error");const t=XE(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(mo(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:i,refreshToken:c,expiresIn:u}=await wB(e,t);this.updateTokensAndExpiration(i,c,Number(u))}updateTokensAndExpiration(e,t,i){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(e,t){const{refreshToken:i,accessToken:c,expirationTime:u}=t,m=new _0;return i&&(mo(typeof i=="string","internal-error",{appName:e}),m.refreshToken=i),c&&(mo(typeof c=="string","internal-error",{appName:e}),m.accessToken=c),u&&(mo(typeof u=="number","internal-error",{appName:e}),m.expirationTime=u),m}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new _0,this.toJSON())}_performRefresh(){return yp("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kp(n,e){mo(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class _p{constructor(e){var{uid:t,auth:i,stsTokenManager:c}=e,u=h3(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new vB(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=i,this.stsTokenManager=c,this.accessToken=c.accessToken,this.displayName=u.displayName||null,this.email=u.email||null,this.emailVerified=u.emailVerified||!1,this.phoneNumber=u.phoneNumber||null,this.photoURL=u.photoURL||null,this.isAnonymous=u.isAnonymous||!1,this.tenantId=u.tenantId||null,this.providerData=u.providerData?[...u.providerData]:[],this.metadata=new X5(u.createdAt||void 0,u.lastLoginAt||void 0)}async getIdToken(e){const t=await p_(this,this.stsTokenManager.getToken(this.auth,e));return mo(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return yB(this,e)}reload(){return xB(this)}_assign(e){this!==e&&(mo(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new _p(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){mo(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let i=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),i=!0),t&&await Pv(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ff(this.auth.app))return Promise.reject(cm(this.auth));const e=await this.getIdToken();return await p_(this,gB(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var i,c,u,m,_,o,b,I;const M=(i=t.displayName)!==null&&i!==void 0?i:void 0,V=(c=t.email)!==null&&c!==void 0?c:void 0,k=(u=t.phoneNumber)!==null&&u!==void 0?u:void 0,ie=(m=t.photoURL)!==null&&m!==void 0?m:void 0,se=(_=t.tenantId)!==null&&_!==void 0?_:void 0,fe=(o=t._redirectEventId)!==null&&o!==void 0?o:void 0,J=(b=t.createdAt)!==null&&b!==void 0?b:void 0,ne=(I=t.lastLoginAt)!==null&&I!==void 0?I:void 0,{uid:me,emailVerified:ue,isAnonymous:ke,providerData:je,stsTokenManager:pe}=t;mo(me&&pe,e,"internal-error");const U=_0.fromJSON(this.name,pe);mo(typeof me=="string",e,"internal-error"),Kp(M,e.name),Kp(V,e.name),mo(typeof ue=="boolean",e,"internal-error"),mo(typeof ke=="boolean",e,"internal-error"),Kp(k,e.name),Kp(ie,e.name),Kp(se,e.name),Kp(fe,e.name),Kp(J,e.name),Kp(ne,e.name);const F=new _p({uid:me,auth:e,email:V,emailVerified:ue,displayName:M,isAnonymous:ke,photoURL:ie,phoneNumber:k,tenantId:se,stsTokenManager:U,createdAt:J,lastLoginAt:ne});return je&&Array.isArray(je)&&(F.providerData=je.map(q=>Object.assign({},q))),fe&&(F._redirectEventId=fe),F}static async _fromIdTokenResponse(e,t,i=!1){const c=new _0;c.updateFromServerResponse(t);const u=new _p({uid:t.localId,auth:e,stsTokenManager:c,isAnonymous:i});return await Pv(u),u}static async _fromGetAccountInfoResponse(e,t,i){const c=t.users[0];mo(c.localId!==void 0,"internal-error");const u=c.providerUserInfo!==void 0?zI(c.providerUserInfo):[],m=!(c.email&&c.passwordHash)&&!u?.length,_=new _0;_.updateFromIdToken(i);const o=new _p({uid:c.localId,auth:e,stsTokenManager:_,isAnonymous:m}),b={uid:c.localId,displayName:c.displayName||null,photoURL:c.photoUrl||null,email:c.email||null,emailVerified:c.emailVerified||!1,phoneNumber:c.phoneNumber||null,tenantId:c.tenantId||null,providerData:u,metadata:new X5(c.createdAt,c.lastLoginAt),isAnonymous:!(c.email&&c.passwordHash)&&!u?.length};return Object.assign(o,b),o}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZE=new Map;function vp(n){Cp(n instanceof Function,"Expected a class definition");let e=ZE.get(n);return e?(Cp(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,ZE.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jI{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}jI.type="NONE";const YE=jI;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function J1(n,e,t){return`firebase:${n}:${e}:${t}`}class v0{constructor(e,t,i){this.persistence=e,this.auth=t,this.userKey=i;const{config:c,name:u}=this.auth;this.fullUserKey=J1(this.userKey,c.apiKey,u),this.fullPersistenceKey=J1("persistence",c.apiKey,u),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?_p._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,i="authUser"){if(!t.length)return new v0(vp(YE),e,i);const c=(await Promise.all(t.map(async b=>{if(await b._isAvailable())return b}))).filter(b=>b);let u=c[0]||vp(YE);const m=J1(i,e.config.apiKey,e.name);let _=null;for(const b of t)try{const I=await b._get(m);if(I){const M=_p._fromJSON(e,I);b!==u&&(_=M),u=b;break}}catch{}const o=c.filter(b=>b._shouldAllowMigration);return!u._shouldAllowMigration||!o.length?new v0(u,e,i):(u=o[0],_&&await u._set(m,_.toJSON()),await Promise.all(t.map(async b=>{if(b!==u)try{await b._remove(m)}catch{}})),new v0(u,e,i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JE(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if($I(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(UI(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(HI(e))return"Blackberry";if(WI(e))return"Webos";if(VI(e))return"Safari";if((e.includes("chrome/")||qI(e))&&!e.includes("edge/"))return"Chrome";if(GI(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=n.match(t);if(i?.length===2)return i[1]}return"Other"}function UI(n=Th()){return/firefox\//i.test(n)}function VI(n=Th()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function qI(n=Th()){return/crios\//i.test(n)}function $I(n=Th()){return/iemobile/i.test(n)}function GI(n=Th()){return/android/i.test(n)}function HI(n=Th()){return/blackberry/i.test(n)}function WI(n=Th()){return/webos/i.test(n)}function y3(n=Th()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function EB(n=Th()){var e;return y3(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function AB(){return UM()&&document.documentMode===10}function KI(n=Th()){return y3(n)||GI(n)||WI(n)||HI(n)||/windows phone/i.test(n)||$I(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XI(n,e=[]){let t;switch(n){case"Browser":t=JE(Th());break;case"Worker":t=`${JE(Th())}-${n}`;break;default:t=n}const i=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${F0}/${i}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TB{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const i=u=>new Promise((m,_)=>{try{const o=e(u);m(o)}catch(o){_(o)}});i.onAbort=t,this.queue.push(i);const c=this.queue.length-1;return()=>{this.queue[c]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const i of this.queue)await i(e),i.onAbort&&t.push(i.onAbort)}catch(i){t.reverse();for(const c of t)try{c()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i?.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function IB(n,e={}){return U0(n,"GET","/v2/passwordPolicy",m3(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CB=6;class LB{constructor(e){var t,i,c,u;const m=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=m.minPasswordLength)!==null&&t!==void 0?t:CB,m.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=m.maxPasswordLength),m.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=m.containsLowercaseCharacter),m.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=m.containsUppercaseCharacter),m.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=m.containsNumericCharacter),m.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=m.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(c=(i=e.allowedNonAlphanumericCharacters)===null||i===void 0?void 0:i.join(""))!==null&&c!==void 0?c:"",this.forceUpgradeOnSignin=(u=e.forceUpgradeOnSignin)!==null&&u!==void 0?u:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,i,c,u,m,_;const o={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,o),this.validatePasswordCharacterOptions(e,o),o.isValid&&(o.isValid=(t=o.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),o.isValid&&(o.isValid=(i=o.meetsMaxPasswordLength)!==null&&i!==void 0?i:!0),o.isValid&&(o.isValid=(c=o.containsLowercaseLetter)!==null&&c!==void 0?c:!0),o.isValid&&(o.isValid=(u=o.containsUppercaseLetter)!==null&&u!==void 0?u:!0),o.isValid&&(o.isValid=(m=o.containsNumericCharacter)!==null&&m!==void 0?m:!0),o.isValid&&(o.isValid=(_=o.containsNonAlphanumericCharacter)!==null&&_!==void 0?_:!0),o}validatePasswordLengthOptions(e,t){const i=this.customStrengthOptions.minPasswordLength,c=this.customStrengthOptions.maxPasswordLength;i&&(t.meetsMinPasswordLength=e.length>=i),c&&(t.meetsMaxPasswordLength=e.length<=c)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let i;for(let c=0;c<e.length;c++)i=e.charAt(c),this.updatePasswordCharacterOptionsStatuses(t,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(e,t,i,c,u){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=c)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PB{constructor(e,t,i,c){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=i,this.config=c,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new QE(this),this.idTokenSubscription=new QE(this),this.beforeStateQueue=new TB(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=MI,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=c.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=vp(t)),this._initializationPromise=this.queue(async()=>{var i,c;if(!this._deleted&&(this.persistenceManager=await v0.create(this,e),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((c=this.currentUser)===null||c===void 0?void 0:c.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await BI(this,{idToken:e}),i=await _p._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(i)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(Ff(this.app)){const m=this.app.settings.authIdToken;return m?new Promise(_=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(m).then(_,_))}):this.directlySetCurrentUser(null)}const i=await this.assertedPersistence.getCurrentUser();let c=i,u=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const m=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,_=c?._redirectEventId,o=await this.tryRedirectSignIn(e);(!m||m===_)&&o?.user&&(c=o.user,u=!0)}if(!c)return this.directlySetCurrentUser(null);if(!c._redirectEventId){if(u)try{await this.beforeStateQueue.runMiddleware(c)}catch(m){c=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(m))}return c?this.reloadAndSetCurrentUserOrClear(c):this.directlySetCurrentUser(null)}return mo(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===c._redirectEventId?this.directlySetCurrentUser(c):this.reloadAndSetCurrentUserOrClear(c)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Pv(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=hB()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Ff(this.app))return Promise.reject(cm(this));const t=e?Bh(e):null;return t&&mo(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&mo(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Ff(this.app)?Promise.reject(cm(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Ff(this.app)?Promise.reject(cm(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(vp(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await IB(this),t=new LB(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new w_("auth","Firebase",e())}onAuthStateChanged(e,t,i){return this.registerStateListener(this.authStateSubscription,e,t,i)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,i){return this.registerStateListener(this.idTokenSubscription,e,t,i)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const i=this.onAuthStateChanged(()=>{i(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(i.tenantId=this.tenantId),await SB(this,i)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const i=await this.getOrInitRedirectPersistenceManager(t);return e===null?i.removeCurrentUser():i.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&vp(e)||this._popupRedirectResolver;mo(t,this,"argument-error"),this.redirectPersistenceManager=await v0.create(this,[vp(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,i;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const i=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,i,c){if(this._deleted)return()=>{};const u=typeof t=="function"?t:t.next.bind(t);let m=!1;const _=this._isInitialized?Promise.resolve():this._initializationPromise;if(mo(_,this,"internal-error"),_.then(()=>{m||u(this.currentUser)}),typeof t=="function"){const o=e.addObserver(t,i,c);return()=>{m=!0,o()}}else{const o=e.addObserver(t);return()=>{m=!0,o()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return mo(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=XI(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const i=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());i&&(t["X-Firebase-Client"]=i);const c=await this._getAppCheckToken();return c&&(t["X-Firebase-AppCheck"]=c),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t?.error&&lB(`Error while retrieving App Check token: ${t.error}`),t?.token}}function V0(n){return Bh(n)}class QE{constructor(e){this.auth=e,this.observer=null,this.addObserver=XM(t=>this.observer=t)}get next(){return mo(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _3={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function kB(n){_3=n}function RB(n){return _3.loadJS(n)}function MB(){return _3.gapiScript}function NB(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DB(n,e){const t=Iw(n,"auth");if(t.isInitialized()){const c=t.getImmediate(),u=t.getOptions();if(_v(u,e??{}))return c;Wf(c,"already-initialized")}return t.initialize({options:e})}function FB(n,e){const t=e?.persistence||[],i=(Array.isArray(t)?t:[t]).map(vp);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(i,e?.popupRedirectResolver)}function OB(n,e,t){const i=V0(n);mo(i._canInitEmulator,i,"emulator-config-failed"),mo(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");const c=!1,u=ZI(e),{host:m,port:_}=BB(e),o=_===null?"":`:${_}`;i.config.emulator={url:`${u}//${m}${o}/`},i.settings.appVerificationDisabledForTesting=!0,i.emulatorConfig=Object.freeze({host:m,port:_,protocol:u.replace(":",""),options:Object.freeze({disableWarnings:c})}),zB()}function ZI(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function BB(n){const e=ZI(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const i=t[2].split("@").pop()||"",c=/^(\[[^\]]+\])(:|$)/.exec(i);if(c){const u=c[1];return{host:u,port:eA(i.substr(u.length+1))}}else{const[u,m]=i.split(":");return{host:u,port:eA(m)}}}function eA(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function zB(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YI{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return yp("not implemented")}_getIdTokenResponse(e){return yp("not implemented")}_linkToIdToken(e,t){return yp("not implemented")}_getReauthenticationResolver(e){return yp("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function x0(n,e){return pB(n,"POST","/v1/accounts:signInWithIdp",m3(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jB="http://localhost";class lg extends YI{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new lg(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Wf("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:i,signInMethod:c}=t,u=h3(t,["providerId","signInMethod"]);if(!i||!c)return null;const m=new lg(i,c);return m.idToken=u.idToken||void 0,m.accessToken=u.accessToken||void 0,m.secret=u.secret,m.nonce=u.nonce,m.pendingToken=u.pendingToken||null,m}_getIdTokenResponse(e){const t=this.buildRequest();return x0(e,t)}_linkToIdToken(e,t){const i=this.buildRequest();return i.idToken=t,x0(e,i)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,x0(e,t)}buildRequest(){const e={requestUri:jB,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=S_(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yx{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R_ extends yx{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jp extends R_{constructor(){super("facebook.com")}static credential(e){return lg._fromParams({providerId:Jp.PROVIDER_ID,signInMethod:Jp.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Jp.credentialFromTaggedObject(e)}static credentialFromError(e){return Jp.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Jp.credential(e.oauthAccessToken)}catch{return null}}}Jp.FACEBOOK_SIGN_IN_METHOD="facebook.com";Jp.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nf extends R_{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return lg._fromParams({providerId:Nf.PROVIDER_ID,signInMethod:Nf.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Nf.credentialFromTaggedObject(e)}static credentialFromError(e){return Nf.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:i}=e;if(!t&&!i)return null;try{return Nf.credential(t,i)}catch{return null}}}Nf.GOOGLE_SIGN_IN_METHOD="google.com";Nf.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qp extends R_{constructor(){super("github.com")}static credential(e){return lg._fromParams({providerId:Qp.PROVIDER_ID,signInMethod:Qp.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Qp.credentialFromTaggedObject(e)}static credentialFromError(e){return Qp.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Qp.credential(e.oauthAccessToken)}catch{return null}}}Qp.GITHUB_SIGN_IN_METHOD="github.com";Qp.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class em extends R_{constructor(){super("twitter.com")}static credential(e,t){return lg._fromParams({providerId:em.PROVIDER_ID,signInMethod:em.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return em.credentialFromTaggedObject(e)}static credentialFromError(e){return em.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:i}=e;if(!t||!i)return null;try{return em.credential(t,i)}catch{return null}}}em.TWITTER_SIGN_IN_METHOD="twitter.com";em.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P0{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,i,c=!1){const u=await _p._fromIdTokenResponse(e,i,c),m=tA(i);return new P0({user:u,providerId:m,_tokenResponse:i,operationType:t})}static async _forOperation(e,t,i){await e._updateTokensIfNecessary(i,!0);const c=tA(i);return new P0({user:e,providerId:c,_tokenResponse:i,operationType:t})}}function tA(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kv extends Pp{constructor(e,t,i,c){var u;super(t.code,t.message),this.operationType=i,this.user=c,Object.setPrototypeOf(this,kv.prototype),this.customData={appName:e.name,tenantId:(u=e.tenantId)!==null&&u!==void 0?u:void 0,_serverResponse:t.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(e,t,i,c){return new kv(e,t,i,c)}}function JI(n,e,t,i){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(u=>{throw u.code==="auth/multi-factor-auth-required"?kv._fromErrorAndOperation(n,u,e,i):u})}async function UB(n,e,t=!1){const i=await p_(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return P0._forOperation(n,"link",i)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function VB(n,e,t=!1){const{auth:i}=n;if(Ff(i.app))return Promise.reject(cm(i));const c="reauthenticate";try{const u=await p_(n,JI(i,c,e,n),t);mo(u.idToken,i,"internal-error");const m=g3(u.idToken);mo(m,i,"internal-error");const{sub:_}=m;return mo(n.uid===_,i,"user-mismatch"),P0._forOperation(n,c,u)}catch(u){throw u?.code==="auth/user-not-found"&&Wf(i,"user-mismatch"),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qB(n,e,t=!1){if(Ff(n.app))return Promise.reject(cm(n));const i="signIn",c=await JI(n,i,e),u=await P0._fromIdTokenResponse(n,i,c);return t||await n._updateCurrentUser(u.user),u}function $B(n,e,t,i){return Bh(n).onIdTokenChanged(e,t,i)}function GB(n,e,t){return Bh(n).beforeAuthStateChanged(e,t)}function HB(n,e,t,i){return Bh(n).onAuthStateChanged(e,t,i)}function WB(n){return Bh(n).signOut()}const Rv="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QI{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Rv,"1"),this.storage.removeItem(Rv),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KB=1e3,XB=10;class e8 extends QI{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=KI(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const i=this.storage.getItem(t),c=this.localCache[t];i!==c&&e(t,c,i)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((m,_,o)=>{this.notifyListeners(m,o)});return}const i=e.key;t?this.detachListener():this.stopPolling();const c=()=>{const m=this.storage.getItem(i);!t&&this.localCache[i]===m||this.notifyListeners(i,m)},u=this.storage.getItem(i);AB()&&u!==e.newValue&&e.newValue!==e.oldValue?setTimeout(c,XB):c()}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const c of Array.from(i))c(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:i}),!0)})},KB)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}e8.type="LOCAL";const ZB=e8;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t8 extends QI{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}t8.type="SESSION";const n8=t8;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YB(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _x{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(c=>c.isListeningto(e));if(t)return t;const i=new _x(e);return this.receivers.push(i),i}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:i,eventType:c,data:u}=t.data,m=this.handlersMap[c];if(!m?.size)return;t.ports[0].postMessage({status:"ack",eventId:i,eventType:c});const _=Array.from(m).map(async b=>b(t.origin,u)),o=await YB(_);t.ports[0].postMessage({status:"done",eventId:i,eventType:c,response:o})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}_x.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v3(n="",e=10){let t="";for(let i=0;i<e;i++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JB{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,i=50){const c=typeof MessageChannel<"u"?new MessageChannel:null;if(!c)throw new Error("connection_unavailable");let u,m;return new Promise((_,o)=>{const b=v3("",20);c.port1.start();const I=setTimeout(()=>{o(new Error("unsupported_event"))},i);m={messageChannel:c,onMessage(M){const V=M;if(V.data.eventId===b)switch(V.data.status){case"ack":clearTimeout(I),u=setTimeout(()=>{o(new Error("timeout"))},3e3);break;case"done":clearTimeout(u),_(V.data.response);break;default:clearTimeout(I),clearTimeout(u),o(new Error("invalid_response"));break}}},this.handlers.add(m),c.port1.addEventListener("message",m.onMessage),this.target.postMessage({eventType:e,eventId:b,data:t},[c.port2])}).finally(()=>{m&&this.removeMessageHandler(m)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qf(){return window}function QB(n){qf().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r8(){return typeof qf().WorkerGlobalScope<"u"&&typeof qf().importScripts=="function"}async function ez(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function tz(){var n;return((n=navigator?.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function nz(){return r8()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i8="firebaseLocalStorageDb",rz=1,Mv="firebaseLocalStorage",o8="fbase_key";class M_{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function vx(n,e){return n.transaction([Mv],e?"readwrite":"readonly").objectStore(Mv)}function iz(){const n=indexedDB.deleteDatabase(i8);return new M_(n).toPromise()}function Z5(){const n=indexedDB.open(i8,rz);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const i=n.result;try{i.createObjectStore(Mv,{keyPath:o8})}catch(c){t(c)}}),n.addEventListener("success",async()=>{const i=n.result;i.objectStoreNames.contains(Mv)?e(i):(i.close(),await iz(),e(await Z5()))})})}async function nA(n,e,t){const i=vx(n,!0).put({[o8]:e,value:t});return new M_(i).toPromise()}async function oz(n,e){const t=vx(n,!1).get(e),i=await new M_(t).toPromise();return i===void 0?null:i.value}function rA(n,e){const t=vx(n,!0).delete(e);return new M_(t).toPromise()}const sz=800,az=3;class s8{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Z5(),this.db)}async _withRetries(e){let t=0;for(;;)try{const i=await this._openDb();return await e(i)}catch(i){if(t++>az)throw i;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return r8()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=_x._getInstance(nz()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await ez(),!this.activeServiceWorker)return;this.sender=new JB(this.activeServiceWorker);const i=await this.sender._send("ping",{},800);i&&!((e=i[0])===null||e===void 0)&&e.fulfilled&&!((t=i[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||tz()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Z5();return await nA(e,Rv,"1"),await rA(e,Rv),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(i=>nA(i,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(i=>oz(i,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>rA(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(c=>{const u=vx(c,!1).getAll();return new M_(u).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],i=new Set;if(e.length!==0)for(const{fbase_key:c,value:u}of e)i.add(c),JSON.stringify(this.localCache[c])!==JSON.stringify(u)&&(this.notifyListeners(c,u),t.push(c));for(const c of Object.keys(this.localCache))this.localCache[c]&&!i.has(c)&&(this.notifyListeners(c,null),t.push(c));return t}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const c of Array.from(i))c(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),sz)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}s8.type="LOCAL";const lz=s8;new k_(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x3(n,e){return e?vp(e):(mo(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b3 extends YI{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return x0(e,this._buildIdpRequest())}_linkToIdToken(e,t){return x0(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return x0(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function cz(n){return qB(n.auth,new b3(n),n.bypassAuthState)}function uz(n){const{auth:e,user:t}=n;return mo(t,e,"internal-error"),VB(t,new b3(n),n.bypassAuthState)}async function hz(n){const{auth:e,user:t}=n;return mo(t,e,"internal-error"),UB(t,new b3(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a8{constructor(e,t,i,c,u=!1){this.auth=e,this.resolver=i,this.user=c,this.bypassAuthState=u,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:i,postBody:c,tenantId:u,error:m,type:_}=e;if(m){this.reject(m);return}const o={auth:this.auth,requestUri:t,sessionId:i,tenantId:u||void 0,postBody:c||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(_)(o))}catch(b){this.reject(b)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return cz;case"linkViaPopup":case"linkViaRedirect":return hz;case"reauthViaPopup":case"reauthViaRedirect":return uz;default:Wf(this.auth,"internal-error")}}resolve(e){Cp(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Cp(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dz=new k_(2e3,1e4);async function fz(n,e,t){if(Ff(n.app))return Promise.reject(rf(n,"operation-not-supported-in-this-environment"));const i=V0(n);NI(n,e,yx);const c=x3(i,t);return new Zm(i,"signInViaPopup",e,c).executeNotNull()}class Zm extends a8{constructor(e,t,i,c,u){super(e,t,c,u),this.provider=i,this.authWindow=null,this.pollId=null,Zm.currentPopupAction&&Zm.currentPopupAction.cancel(),Zm.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return mo(e,this.auth,"internal-error"),e}async onExecution(){Cp(this.filter.length===1,"Popup operations only handle one event");const e=v3();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(rf(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(rf(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Zm.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,i;if(!((i=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||i===void 0)&&i.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(rf(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,dz.get())};e()}}Zm.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pz="pendingRedirect",Q1=new Map;class mz extends a8{constructor(e,t,i=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,i),this.eventId=null}async execute(){let e=Q1.get(this.auth._key());if(!e){try{const i=await gz(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(i)}catch(t){e=()=>Promise.reject(t)}Q1.set(this.auth._key(),e)}return this.bypassAuthState||Q1.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function gz(n,e){const t=c8(e),i=l8(n);if(!await i._isAvailable())return!1;const c=await i._get(t)==="true";return await i._remove(t),c}async function yz(n,e){return l8(n)._set(c8(e),"true")}function _z(n,e){Q1.set(n._key(),e)}function l8(n){return vp(n._redirectPersistence)}function c8(n){return J1(pz,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vz(n,e,t){return xz(n,e,t)}async function xz(n,e,t){if(Ff(n.app))return Promise.reject(cm(n));const i=V0(n);NI(n,e,yx),await i._initializationPromise;const c=x3(i,t);return await yz(c,i),c._openRedirect(i,e,"signInViaRedirect")}async function bz(n,e){return await V0(n)._initializationPromise,u8(n,e,!1)}async function u8(n,e,t=!1){if(Ff(n.app))return Promise.reject(cm(n));const i=V0(n),c=x3(i,e),m=await new mz(i,c,t).execute();return m&&!t&&(delete m.user._redirectEventId,await i._persistUserIfCurrent(m.user),await i._setRedirectUser(null,e)),m}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wz=600*1e3;class Sz{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(e,i)&&(t=!0,this.sendToConsumer(e,i),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Ez(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var i;if(e.error&&!h8(e)){const c=((i=e.error.code)===null||i===void 0?void 0:i.split("auth/")[1])||"internal-error";t.onError(rf(this.auth,c))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const i=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&i}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=wz&&this.cachedEventUids.clear(),this.cachedEventUids.has(iA(e))}saveEventToCache(e){this.cachedEventUids.add(iA(e)),this.lastProcessedEventTime=Date.now()}}function iA(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function h8({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function Ez(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return h8(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Az(n,e={}){return U0(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tz=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Iz=/^https?/;async function Cz(n){if(n.config.emulator)return;const{authorizedDomains:e}=await Az(n);for(const t of e)try{if(Lz(t))return}catch{}Wf(n,"unauthorized-domain")}function Lz(n){const e=K5(),{protocol:t,hostname:i}=new URL(e);if(n.startsWith("chrome-extension://")){const m=new URL(n);return m.hostname===""&&i===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&m.hostname===i}if(!Iz.test(t))return!1;if(Tz.test(n))return i===n;const c=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+c+"|"+c+")$","i").test(i)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pz=new k_(3e4,6e4);function oA(){const n=qf().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function kz(n){return new Promise((e,t)=>{var i,c,u;function m(){oA(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{oA(),t(rf(n,"network-request-failed"))},timeout:Pz.get()})}if(!((c=(i=qf().gapi)===null||i===void 0?void 0:i.iframes)===null||c===void 0)&&c.Iframe)e(gapi.iframes.getContext());else if(!((u=qf().gapi)===null||u===void 0)&&u.load)m();else{const _=NB("iframefcb");return qf()[_]=()=>{gapi.load?m():t(rf(n,"network-request-failed"))},RB(`${MB()}?onload=${_}`).catch(o=>t(o))}}).catch(e=>{throw ev=null,e})}let ev=null;function Rz(n){return ev=ev||kz(n),ev}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mz=new k_(5e3,15e3),Nz="__/auth/iframe",Dz="emulator/auth/iframe",Fz={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Oz=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Bz(n){const e=n.config;mo(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?p3(e,Dz):`https://${n.config.authDomain}/${Nz}`,i={apiKey:e.apiKey,appName:n.name,v:F0},c=Oz.get(n.config.apiHost);c&&(i.eid=c);const u=n._getFrameworks();return u.length&&(i.fw=u.join(",")),`${t}?${S_(i).slice(1)}`}async function zz(n){const e=await Rz(n),t=qf().gapi;return mo(t,n,"internal-error"),e.open({where:document.body,url:Bz(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Fz,dontclear:!0},i=>new Promise(async(c,u)=>{await i.restyle({setHideOnLeave:!1});const m=rf(n,"network-request-failed"),_=qf().setTimeout(()=>{u(m)},Mz.get());function o(){qf().clearTimeout(_),c(i)}i.ping(o).then(o,()=>{u(m)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jz={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Uz=500,Vz=600,qz="_blank",$z="http://localhost";class sA{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Gz(n,e,t,i=Uz,c=Vz){const u=Math.max((window.screen.availHeight-c)/2,0).toString(),m=Math.max((window.screen.availWidth-i)/2,0).toString();let _="";const o=Object.assign(Object.assign({},jz),{width:i.toString(),height:c.toString(),top:u,left:m}),b=Th().toLowerCase();t&&(_=qI(b)?qz:t),UI(b)&&(e=e||$z,o.scrollbars="yes");const I=Object.entries(o).reduce((V,[k,ie])=>`${V}${k}=${ie},`,"");if(EB(b)&&_!=="_self")return Hz(e||"",_),new sA(null);const M=window.open(e||"",_,I);mo(M,n,"popup-blocked");try{M.focus()}catch{}return new sA(M)}function Hz(n,e){const t=document.createElement("a");t.href=n,t.target=e;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wz="__/auth/handler",Kz="emulator/auth/handler",Xz=encodeURIComponent("fac");async function aA(n,e,t,i,c,u){mo(n.config.authDomain,n,"auth-domain-config-required"),mo(n.config.apiKey,n,"invalid-api-key");const m={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:i,v:F0,eventId:c};if(e instanceof yx){e.setDefaultLanguage(n.languageCode),m.providerId=e.providerId||"",KM(e.getCustomParameters())||(m.customParameters=JSON.stringify(e.getCustomParameters()));for(const[I,M]of Object.entries({}))m[I]=M}if(e instanceof R_){const I=e.getScopes().filter(M=>M!=="");I.length>0&&(m.scopes=I.join(","))}n.tenantId&&(m.tid=n.tenantId);const _=m;for(const I of Object.keys(_))_[I]===void 0&&delete _[I];const o=await n._getAppCheckToken(),b=o?`#${Xz}=${encodeURIComponent(o)}`:"";return`${Zz(n)}?${S_(_).slice(1)}${b}`}function Zz({config:n}){return n.emulator?p3(n,Kz):`https://${n.authDomain}/${Wz}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gb="webStorageSupport";class Yz{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=n8,this._completeRedirectFn=u8,this._overrideRedirectResult=_z}async _openPopup(e,t,i,c){var u;Cp((u=this.eventManagers[e._key()])===null||u===void 0?void 0:u.manager,"_initialize() not called before _openPopup()");const m=await aA(e,t,i,K5(),c);return Gz(e,m,v3())}async _openRedirect(e,t,i,c){await this._originValidation(e);const u=await aA(e,t,i,K5(),c);return QB(u),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:c,promise:u}=this.eventManagers[t];return c?Promise.resolve(c):(Cp(u,"If manager is not set, promise should be"),u)}const i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}async initAndGetManager(e){const t=await zz(e),i=new Sz(e);return t.register("authEvent",c=>(mo(c?.authEvent,e,"invalid-auth-event"),{status:i.onEvent(c.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:i},this.iframes[e._key()]=t,i}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Gb,{type:Gb},c=>{var u;const m=(u=c?.[0])===null||u===void 0?void 0:u[Gb];m!==void 0&&t(!!m),Wf(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Cz(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return KI()||VI()||y3()}}const Jz=Yz;var lA="@firebase/auth",cA="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qz{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(i=>{e(i?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){mo(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ej(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function tj(n){w0(new rg("auth",(e,{options:t})=>{const i=e.getProvider("app").getImmediate(),c=e.getProvider("heartbeat"),u=e.getProvider("app-check-internal"),{apiKey:m,authDomain:_}=i.options;mo(m&&!m.includes(":"),"invalid-api-key",{appName:i.name});const o={apiKey:m,authDomain:_,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:XI(n)},b=new PB(i,c,u,o);return FB(b,t),b},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,i)=>{e.getProvider("auth-internal").initialize()})),w0(new rg("auth-internal",e=>{const t=V0(e.getProvider("auth").getImmediate());return(i=>new Qz(i))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),am(lA,cA,ej(n)),am(lA,cA,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nj=300,rj=r9("authIdTokenMaxAge")||nj;let uA=null;const ij=n=>async e=>{const t=e&&await e.getIdTokenResult(),i=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(i&&i>rj)return;const c=t?.token;uA!==c&&(uA=c,await fetch(n,{method:c?"POST":"DELETE",headers:c?{Authorization:`Bearer ${c}`}:{}}))};function tv(n=a9()){const e=Iw(n,"auth");if(e.isInitialized())return e.getImmediate();const t=DB(n,{popupRedirectResolver:Jz,persistence:[lz,ZB,n8]}),i=r9("authTokenSyncURL");if(i&&typeof isSecureContext=="boolean"&&isSecureContext){const u=new URL(i,location.origin);if(location.origin===u.origin){const m=ij(u.toString());GB(t,m,()=>m(t.currentUser)),$B(t,_=>m(_))}}const c=t9("auth");return c&&OB(t,`http://${c}`),t}function oj(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}kB({loadJS(n){return new Promise((e,t)=>{const i=document.createElement("script");i.setAttribute("src",n),i.onload=e,i.onerror=c=>{const u=rf("internal-error");u.customData=c,t(u)},i.type="text/javascript",i.charset="UTF-8",oj().appendChild(i)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});tj("Browser");const sj={apiKey:"AIzaSyDqdNAi8z3vx8TJcbVwUN37GJtt4vGH_Cs",authDomain:"stakeholder-map-a4bdc.firebaseapp.com",projectId:"stakeholder-map-a4bdc",storageBucket:"stakeholder-map-a4bdc.firebasestorage.app",messagingSenderId:"201968932417",appId:"1:201968932417:web:c6053a304f5dc5f2ffd8c0",measurementId:"G-BEB17GFMBJ"},d8=s9(sj),Sh=HO(d8);tv(d8);new Nf;const aj=[{value:5,label:"5 - Excellent"},{value:4,label:"4 - Good"},{value:3,label:"3 - Adequate"},{value:2,label:"2 - Poor"},{value:1,label:"1 - Very Poor"},{value:0,label:"0 - Not Set"}],hA={buildingName:"",notes:"",scores:{architecture:{exterior:0,entrances:0,interiorFinishes:0,lifeSafety:0,codesAndAccessibility:0},engineering:{superstructure:0,conveyingSystems:0,fireProtection:0,plumbing:0,mechanical:0,power:0,lighting:0},functionality:{telecomm:0,fireAlarm:0,spaceSize:0,technology:0}}},lj=({buildingId:n,assessments:e,onClose:t,onSave:i,universityId:c,panelPos:u,isAdminRole:m})=>{const[_,o]=Nn.useState(hA);Nn.useEffect(()=>{if(n&&e){const k=e[n]||{...hA,buildingName:n};o(k)}},[n,e]);const b=(k,ie,se)=>{o(fe=>({...fe,scores:{...fe.scores,[k]:{...fe.scores[k],[ie]:Number(se)}}}))},I=k=>{o(ie=>({...ie,notes:k.target.value}))},M=async()=>{if(!m){alert("Save failed: you are not signed in as an admin.");return}if(!n||!c)return;const k=n.replace(/\//g,"__"),ie=l0(Sh,"universities",c,"buildingAssessments",k),se={..._,originalId:n};try{await W5(ie,se),i(se),alert("Assessment saved successfully!"),t()}catch(fe){console.error("Error saving assessment:",fe),alert("Failed to save assessment. See console for details.")}};if(!n)return null;const V=u?{position:"absolute",left:u.x??80,top:u.y??160,zIndex:6}:void 0;return Y.jsxs("div",{className:"assessment-panel",style:V,children:[Y.jsxs("div",{className:"panel-header",children:[Y.jsx("h3",{children:"Technical Assessment"}),Y.jsx("button",{onClick:t,className:"close-button",children:""})]}),Y.jsxs("div",{className:"panel-content",children:[Y.jsx("h4",{children:_.buildingName||n}),_.scores&&Object.entries(_.scores).map(([k,ie])=>Y.jsxs("div",{className:"category-section",children:[Y.jsx("h5",{children:k.charAt(0).toUpperCase()+k.slice(1)}),Object.entries(ie).map(([se,fe])=>Y.jsxs("div",{className:"score-item",children:[Y.jsx("label",{children:se.replace(/([A-Z])/g," $1").trim()}),Y.jsx("select",{value:fe,onChange:J=>b(k,se,J.target.value),children:aj.map(J=>Y.jsx("option",{value:J.value,children:J.label},J.value))})]},se))]},k)),Y.jsxs("div",{className:"notes-section",children:[Y.jsx("h5",{children:"Notes"}),Y.jsx("textarea",{value:_.notes||"",onChange:I,rows:"4"})]}),Y.jsx("button",{className:"save-button",onClick:M,children:"Save Changes"})]})]})},cj=({buildingId:n,buildingName:e,currentCondition:t,onSave:i,onOpenTechnical:c,onClose:u,floorplans:m,onSelectFloorplan:_})=>{const[o,b]=Nn.useState(t??"");Nn.useEffect(()=>{b(t??"")},[n,t]);const I=()=>{n&&o&&i(n,o)},M=(o||"")!==(t||"");return Y.jsxs("div",{className:"interaction-panel",children:[Y.jsx("button",{className:"close-button",onClick:u,children:""}),Y.jsx("h4",{children:e||n}),Y.jsxs("div",{className:"control-section",children:[Y.jsx("h5",{children:"Stakeholder Condition"}),Y.jsxs("select",{value:o,onChange:V=>b(V.target.value),children:[Y.jsx("option",{value:"",disabled:!0,children:"Select condition..."}),Y.jsx("option",{value:"5",children:"5 = Excellent"}),Y.jsx("option",{value:"4",children:"4 = Good"}),Y.jsx("option",{value:"3",children:"3 = Adequate"}),Y.jsx("option",{value:"2",children:"2 = Poor"}),Y.jsx("option",{value:"1",children:"1 = Very Poor"})]}),Y.jsx("div",{className:"button-row",style:{marginTop:8},children:Y.jsx("button",{onClick:I,disabled:!M||!o,children:"Save Stakeholder Condition"})})]}),Y.jsx("div",{className:"button-row",style:{marginTop:8},children:Y.jsx("button",{onClick:c,children:"Technical Assessment"})}),m&&m.length>0&&Y.jsxs("div",{className:"control-section",children:[Y.jsx("h5",{children:"Floor Plans"}),Y.jsx("div",{className:"floorplan-buttons",children:m.map((V,k)=>Y.jsx("button",{onClick:()=>_?.(V),children:V.name},k))})]})]})},dA={"This is one of my go-to study spots":"#006400","This is a go-to hangout spot for me and my friends":"#008000","I would like to use this space more, but it needs improvement":"#9cdef1ff","This space feels outdated or run-down":"#f4e806ff","The furniture in this space is uncomfortable or not functional":"#e9a804ff","The lighting or temperature in this space makes it uncomfortable":"#f29008ff","I rarely or never use this space":"#f05555ff","I do not feel safe in this space":"#e00905bc","Just leave a comment about this space":"#9E9E9E"},uj={"This space supports my teaching and/or professional work effectively":"#007330ff","I wish this space were more flexible or adaptable for different uses":"#31f579ff","I would like to use this space more, but it needs some improvement":"#94d2bd","The layout or furniture is not functional for my needs":"#e9d8a6","The technology in this space is inadequate or unreliable":"#f4d804ff","This space lacks the privacy needed for my work":"#f97c3eff","I rarely or never use this space":"#f25f54ff","I do not feel safe in this space":"#ae2012","Just leave a comment about this space":"#9E9E9E"},I1={student:dA,staff:uj,default:dA};var Ku=63710088e-1,f8={centimeters:Ku*100,centimetres:Ku*100,degrees:360/(2*Math.PI),feet:Ku*3.28084,inches:Ku*39.37,kilometers:Ku/1e3,kilometres:Ku/1e3,meters:Ku,metres:Ku,miles:Ku/1609.344,millimeters:Ku*1e3,millimetres:Ku*1e3,nauticalmiles:Ku/1852,radians:1,yards:Ku*1.0936};function w3(n,e,t={}){const i={type:"Feature"};return(t.id===0||t.id)&&(i.id=t.id),t.bbox&&(i.bbox=t.bbox),i.properties=e||{},i.geometry=n,i}function ms(n,e,t={}){if(!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!fA(n[0])||!fA(n[1]))throw new Error("coordinates must contain numbers");return w3({type:"Point",coordinates:n},e,t)}function S3(n,e,t={}){for(const c of n){if(c.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(c[c.length-1].length!==c[0].length)throw new Error("First and last Position are not equivalent.");for(let u=0;u<c[c.length-1].length;u++)if(c[c.length-1][u]!==c[0][u])throw new Error("First and last Position are not equivalent.")}return w3({type:"Polygon",coordinates:n},e,t)}function E3(n,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=n,t}function hj(n,e,t={}){return w3({type:"MultiPolygon",coordinates:n},e,t)}function p8(n,e="kilometers"){const t=f8[e];if(!t)throw new Error(e+" units is invalid");return n*t}function dj(n,e="kilometers"){const t=f8[e];if(!t)throw new Error(e+" units is invalid");return n/t}function m8(n){return n%(2*Math.PI)*180/Math.PI}function _d(n){return n%360*Math.PI/180}function g8(n,e="kilometers",t="kilometers"){if(!(n>=0))throw new Error("length must be a positive number");return p8(dj(n,e),t)}function fA(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function A3(n){return n!==null&&typeof n=="object"&&!Array.isArray(n)}function Qh(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function T3(n){if(Array.isArray(n))return n;if(n.type==="Feature"){if(n.geometry!==null)return n.geometry.coordinates}else if(n.coordinates)return n.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function fj(n){return n.type==="Feature"?n.geometry:n}function y8(n,e){return n.type==="FeatureCollection"?"FeatureCollection":n.type==="GeometryCollection"?"GeometryCollection":n.type==="Feature"&&n.geometry!==null?n.geometry.type:n.type}function Hm(n,e,t={}){if(t.final===!0)return pj(n,e);const i=Qh(n),c=Qh(e),u=_d(i[0]),m=_d(c[0]),_=_d(i[1]),o=_d(c[1]),b=Math.sin(m-u)*Math.cos(o),I=Math.cos(_)*Math.sin(o)-Math.sin(_)*Math.cos(o)*Math.cos(m-u);return m8(Math.atan2(b,I))}function pj(n,e){let t=Hm(e,n);return t=(t+180)%360,t}function Mf(n,e,t={}){var i=Qh(n),c=Qh(e),u=_d(c[1]-i[1]),m=_d(c[0]-i[0]),_=_d(i[1]),o=_d(c[1]),b=Math.pow(Math.sin(u/2),2)+Math.pow(Math.sin(m/2),2)*Math.cos(_)*Math.cos(o);return p8(2*Math.atan2(Math.sqrt(b),Math.sqrt(1-b)),t.units)}function _8(n,e,t={}){let i;return t.final?i=pA(Qh(e),Qh(n)):i=pA(Qh(n),Qh(e)),i>180?-(360-i):i}function pA(n,e){const t=_d(n[1]),i=_d(e[1]);let c=_d(e[0]-n[0]);c>Math.PI&&(c-=2*Math.PI),c<-Math.PI&&(c+=2*Math.PI);const u=Math.log(Math.tan(i/2+Math.PI/4)/Math.tan(t/2+Math.PI/4)),m=Math.atan2(c,u);return(m8(m)+360)%360}function ym(n,e,t){if(n!==null)for(var i,c,u,m,_,o,b,I=0,M=0,V,k=n.type,ie=k==="FeatureCollection",se=k==="Feature",fe=ie?n.features.length:1,J=0;J<fe;J++){b=ie?n.features[J].geometry:se?n.geometry:n,V=b?b.type==="GeometryCollection":!1,_=V?b.geometries.length:1;for(var ne=0;ne<_;ne++){var me=0,ue=0;if(m=V?b.geometries[ne]:b,m!==null){o=m.coordinates;var ke=m.type;switch(I=t&&(ke==="Polygon"||ke==="MultiPolygon")?1:0,ke){case null:break;case"Point":if(e(o,M,J,me,ue)===!1)return!1;M++,me++;break;case"LineString":case"MultiPoint":for(i=0;i<o.length;i++){if(e(o[i],M,J,me,ue)===!1)return!1;M++,ke==="MultiPoint"&&me++}ke==="LineString"&&me++;break;case"Polygon":case"MultiLineString":for(i=0;i<o.length;i++){for(c=0;c<o[i].length-I;c++){if(e(o[i][c],M,J,me,ue)===!1)return!1;M++}ke==="MultiLineString"&&me++,ke==="Polygon"&&ue++}ke==="Polygon"&&me++;break;case"MultiPolygon":for(i=0;i<o.length;i++){for(ue=0,c=0;c<o[i].length;c++){for(u=0;u<o[i][c].length-I;u++){if(e(o[i][c][u],M,J,me,ue)===!1)return!1;M++}ue++}me++}break;case"GeometryCollection":for(i=0;i<m.geometries.length;i++)if(ym(m.geometries[i],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function mj(n,e){if(n.type==="Feature")e(n,0);else if(n.type==="FeatureCollection")for(var t=0;t<n.features.length&&e(n.features[t],t)!==!1;t++);}function v8(n,e){var t,i,c,u,m,_,o,b,I,M,V=0,k=n.type==="FeatureCollection",ie=n.type==="Feature",se=k?n.features.length:1;for(t=0;t<se;t++){for(_=k?n.features[t].geometry:ie?n.geometry:n,b=k?n.features[t].properties:ie?n.properties:{},I=k?n.features[t].bbox:ie?n.bbox:void 0,M=k?n.features[t].id:ie?n.id:void 0,o=_?_.type==="GeometryCollection":!1,m=o?_.geometries.length:1,c=0;c<m;c++){if(u=o?_.geometries[c]:_,u===null){if(e(null,V,b,I,M)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(u,V,b,I,M)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<u.geometries.length;i++)if(e(u.geometries[i],V,b,I,M)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}V++}}function gj(n,e,t){var i=t;return v8(n,function(c,u,m,_,o){i=e(i,c,u,m,_,o)}),i}function mA(n){return gj(n,(e,t)=>e+yj(t),0)}function yj(n){let e=0,t;switch(n.type){case"Polygon":return gA(n.coordinates);case"MultiPolygon":for(t=0;t<n.coordinates.length;t++)e+=gA(n.coordinates[t]);return e;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function gA(n){let e=0;if(n&&n.length>0){e+=Math.abs(yA(n[0]));for(let t=1;t<n.length;t++)e-=Math.abs(yA(n[t]))}return e}var _j=Ku*Ku/2,Hb=Math.PI/180;function yA(n){const e=n.length-1;if(e<=2)return 0;let t=0,i=0;for(;i<e;){const c=n[i],u=n[i+1===e?0:i+1],m=n[i+2>=e?(i+2)%e:i+2],_=c[0]*Hb,o=u[1]*Hb,b=m[0]*Hb;t+=(b-_)*Math.sin(o),i++}return t*_j}function Cu(n,e={}){if(n.bbox!=null&&e.recompute!==!0)return n.bbox;const t=[1/0,1/0,-1/0,-1/0];return ym(n,i=>{t[0]>i[0]&&(t[0]=i[0]),t[1]>i[1]&&(t[1]=i[1]),t[2]<i[0]&&(t[2]=i[0]),t[3]<i[1]&&(t[3]=i[1])}),t}const wp=11102230246251565e-32,wh=134217729,vj=(3+8*wp)*wp;function Wb(n,e,t,i,c){let u,m,_,o,b=e[0],I=i[0],M=0,V=0;I>b==I>-b?(u=b,b=e[++M]):(u=I,I=i[++V]);let k=0;if(M<n&&V<t)for(I>b==I>-b?(m=b+u,_=u-(m-b),b=e[++M]):(m=I+u,_=u-(m-I),I=i[++V]),u=m,_!==0&&(c[k++]=_);M<n&&V<t;)I>b==I>-b?(m=u+b,o=m-u,_=u-(m-o)+(b-o),b=e[++M]):(m=u+I,o=m-u,_=u-(m-o)+(I-o),I=i[++V]),u=m,_!==0&&(c[k++]=_);for(;M<n;)m=u+b,o=m-u,_=u-(m-o)+(b-o),b=e[++M],u=m,_!==0&&(c[k++]=_);for(;V<t;)m=u+I,o=m-u,_=u-(m-o)+(I-o),I=i[++V],u=m,_!==0&&(c[k++]=_);return(u!==0||k===0)&&(c[k++]=u),k}function xj(n,e){let t=e[0];for(let i=1;i<n;i++)t+=e[i];return t}function N_(n){return new Float64Array(n)}const bj=(3+16*wp)*wp,wj=(2+12*wp)*wp,Sj=(9+64*wp)*wp*wp,Wg=N_(4),_A=N_(8),vA=N_(12),xA=N_(16),Dh=N_(4);function Ej(n,e,t,i,c,u,m){let _,o,b,I,M,V,k,ie,se,fe,J,ne,me,ue,ke,je,pe,U;const F=n-c,q=t-c,j=e-u,H=i-u;ue=F*H,V=wh*F,k=V-(V-F),ie=F-k,V=wh*H,se=V-(V-H),fe=H-se,ke=ie*fe-(ue-k*se-ie*se-k*fe),je=j*q,V=wh*j,k=V-(V-j),ie=j-k,V=wh*q,se=V-(V-q),fe=q-se,pe=ie*fe-(je-k*se-ie*se-k*fe),J=ke-pe,M=ke-J,Wg[0]=ke-(J+M)+(M-pe),ne=ue+J,M=ne-ue,me=ue-(ne-M)+(J-M),J=me-je,M=me-J,Wg[1]=me-(J+M)+(M-je),U=ne+J,M=U-ne,Wg[2]=ne-(U-M)+(J-M),Wg[3]=U;let Z=xj(4,Wg),be=wj*m;if(Z>=be||-Z>=be||(M=n-F,_=n-(F+M)+(M-c),M=t-q,b=t-(q+M)+(M-c),M=e-j,o=e-(j+M)+(M-u),M=i-H,I=i-(H+M)+(M-u),_===0&&o===0&&b===0&&I===0)||(be=Sj*m+vj*Math.abs(Z),Z+=F*I+H*_-(j*b+q*o),Z>=be||-Z>=be))return Z;ue=_*H,V=wh*_,k=V-(V-_),ie=_-k,V=wh*H,se=V-(V-H),fe=H-se,ke=ie*fe-(ue-k*se-ie*se-k*fe),je=o*q,V=wh*o,k=V-(V-o),ie=o-k,V=wh*q,se=V-(V-q),fe=q-se,pe=ie*fe-(je-k*se-ie*se-k*fe),J=ke-pe,M=ke-J,Dh[0]=ke-(J+M)+(M-pe),ne=ue+J,M=ne-ue,me=ue-(ne-M)+(J-M),J=me-je,M=me-J,Dh[1]=me-(J+M)+(M-je),U=ne+J,M=U-ne,Dh[2]=ne-(U-M)+(J-M),Dh[3]=U;const Re=Wb(4,Wg,4,Dh,_A);ue=F*I,V=wh*F,k=V-(V-F),ie=F-k,V=wh*I,se=V-(V-I),fe=I-se,ke=ie*fe-(ue-k*se-ie*se-k*fe),je=j*b,V=wh*j,k=V-(V-j),ie=j-k,V=wh*b,se=V-(V-b),fe=b-se,pe=ie*fe-(je-k*se-ie*se-k*fe),J=ke-pe,M=ke-J,Dh[0]=ke-(J+M)+(M-pe),ne=ue+J,M=ne-ue,me=ue-(ne-M)+(J-M),J=me-je,M=me-J,Dh[1]=me-(J+M)+(M-je),U=ne+J,M=U-ne,Dh[2]=ne-(U-M)+(J-M),Dh[3]=U;const Oe=Wb(Re,_A,4,Dh,vA);ue=_*I,V=wh*_,k=V-(V-_),ie=_-k,V=wh*I,se=V-(V-I),fe=I-se,ke=ie*fe-(ue-k*se-ie*se-k*fe),je=o*b,V=wh*o,k=V-(V-o),ie=o-k,V=wh*b,se=V-(V-b),fe=b-se,pe=ie*fe-(je-k*se-ie*se-k*fe),J=ke-pe,M=ke-J,Dh[0]=ke-(J+M)+(M-pe),ne=ue+J,M=ne-ue,me=ue-(ne-M)+(J-M),J=me-je,M=me-J,Dh[1]=me-(J+M)+(M-je),U=ne+J,M=U-ne,Dh[2]=ne-(U-M)+(J-M),Dh[3]=U;const Ne=Wb(Oe,vA,4,Dh,xA);return xA[Ne-1]}function Aj(n,e,t,i,c,u){const m=(e-u)*(t-c),_=(n-c)*(i-u),o=m-_,b=Math.abs(m+_);return Math.abs(o)>=bj*b?o:-Ej(n,e,t,i,c,u,b)}function Tj(n,e){var t,i,c=0,u,m,_,o,b,I,M,V=n[0],k=n[1],ie=e.length;for(t=0;t<ie;t++){i=0;var se=e[t],fe=se.length-1;if(I=se[0],I[0]!==se[fe][0]&&I[1]!==se[fe][1])throw new Error("First and last coordinates in a ring must be the same");for(m=I[0]-V,_=I[1]-k,i;i<fe;i++){if(M=se[i+1],o=M[0]-V,b=M[1]-k,_===0&&b===0){if(o<=0&&m>=0||m<=0&&o>=0)return 0}else if(b>=0&&_<=0||b<=0&&_>=0){if(u=Aj(m,o,_,b,0,0),u===0)return 0;(u>0&&b>0&&_<=0||u<0&&b<=0&&_>0)&&c++}I=M,_=b,m=o}}return c%2!==0}function Ij(n,e,t={}){if(!n)throw new Error("point is required");if(!e)throw new Error("polygon is required");const i=Qh(n),c=fj(e),u=c.type,m=e.bbox;let _=c.coordinates;if(m&&Cj(i,m)===!1)return!1;u==="Polygon"&&(_=[_]);let o=!1;for(var b=0;b<_.length;++b){const I=Tj(i,_[b]);if(I===0)return!t.ignoreBoundary;I&&(o=!0)}return o}function Cj(n,e){return e[0]<=n[0]&&e[1]<=n[1]&&e[2]>=n[0]&&e[3]>=n[1]}function Lj(n,e={}){const t=Cu(n),i=(t[0]+t[2])/2,c=(t[1]+t[3])/2;return ms([i,c],e.properties,e)}function Ml(n,e={}){let t=0,i=0,c=0;return ym(n,function(u){t+=u[0],i+=u[1],c++},!0),ms([t/c,i/c],e.properties)}var C1={exports:{}},nv={exports:{}},Pj=nv.exports,bA;function kj(){return bA||(bA=1,(function(n,e){(function(t,i){n.exports=i()})(Pj,function(){function t(ne,me,ue,ke,je){(function pe(U,F,q,j,H){for(;j>q;){if(j-q>600){var Z=j-q+1,be=F-q+1,Re=Math.log(Z),Oe=.5*Math.exp(2*Re/3),Ne=.5*Math.sqrt(Re*Oe*(Z-Oe)/Z)*(be-Z/2<0?-1:1),we=Math.max(q,Math.floor(F-be*Oe/Z+Ne)),Fe=Math.min(j,Math.floor(F+(Z-be)*Oe/Z+Ne));pe(U,F,we,Fe,H)}var nt=U[F],xe=q,le=j;for(i(U,q,F),H(U[j],nt)>0&&i(U,q,j);xe<le;){for(i(U,xe,le),xe++,le--;H(U[xe],nt)<0;)xe++;for(;H(U[le],nt)>0;)le--}H(U[q],nt)===0?i(U,q,le):i(U,++le,j),le<=F&&(q=le+1),F<=le&&(j=le-1)}})(ne,me,ue||0,ke||ne.length-1,je||c)}function i(ne,me,ue){var ke=ne[me];ne[me]=ne[ue],ne[ue]=ke}function c(ne,me){return ne<me?-1:ne>me?1:0}var u=function(ne){ne===void 0&&(ne=9),this._maxEntries=Math.max(4,ne),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function m(ne,me,ue){if(!ue)return me.indexOf(ne);for(var ke=0;ke<me.length;ke++)if(ue(ne,me[ke]))return ke;return-1}function _(ne,me){o(ne,0,ne.children.length,me,ne)}function o(ne,me,ue,ke,je){je||(je=fe(null)),je.minX=1/0,je.minY=1/0,je.maxX=-1/0,je.maxY=-1/0;for(var pe=me;pe<ue;pe++){var U=ne.children[pe];b(je,ne.leaf?ke(U):U)}return je}function b(ne,me){return ne.minX=Math.min(ne.minX,me.minX),ne.minY=Math.min(ne.minY,me.minY),ne.maxX=Math.max(ne.maxX,me.maxX),ne.maxY=Math.max(ne.maxY,me.maxY),ne}function I(ne,me){return ne.minX-me.minX}function M(ne,me){return ne.minY-me.minY}function V(ne){return(ne.maxX-ne.minX)*(ne.maxY-ne.minY)}function k(ne){return ne.maxX-ne.minX+(ne.maxY-ne.minY)}function ie(ne,me){return ne.minX<=me.minX&&ne.minY<=me.minY&&me.maxX<=ne.maxX&&me.maxY<=ne.maxY}function se(ne,me){return me.minX<=ne.maxX&&me.minY<=ne.maxY&&me.maxX>=ne.minX&&me.maxY>=ne.minY}function fe(ne){return{children:ne,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function J(ne,me,ue,ke,je){for(var pe=[me,ue];pe.length;)if(!((ue=pe.pop())-(me=pe.pop())<=ke)){var U=me+Math.ceil((ue-me)/ke/2)*ke;t(ne,U,me,ue,je),pe.push(me,U,U,ue)}}return u.prototype.all=function(){return this._all(this.data,[])},u.prototype.search=function(ne){var me=this.data,ue=[];if(!se(ne,me))return ue;for(var ke=this.toBBox,je=[];me;){for(var pe=0;pe<me.children.length;pe++){var U=me.children[pe],F=me.leaf?ke(U):U;se(ne,F)&&(me.leaf?ue.push(U):ie(ne,F)?this._all(U,ue):je.push(U))}me=je.pop()}return ue},u.prototype.collides=function(ne){var me=this.data;if(!se(ne,me))return!1;for(var ue=[];me;){for(var ke=0;ke<me.children.length;ke++){var je=me.children[ke],pe=me.leaf?this.toBBox(je):je;if(se(ne,pe)){if(me.leaf||ie(ne,pe))return!0;ue.push(je)}}me=ue.pop()}return!1},u.prototype.load=function(ne){if(!ne||!ne.length)return this;if(ne.length<this._minEntries){for(var me=0;me<ne.length;me++)this.insert(ne[me]);return this}var ue=this._build(ne.slice(),0,ne.length-1,0);if(this.data.children.length)if(this.data.height===ue.height)this._splitRoot(this.data,ue);else{if(this.data.height<ue.height){var ke=this.data;this.data=ue,ue=ke}this._insert(ue,this.data.height-ue.height-1,!0)}else this.data=ue;return this},u.prototype.insert=function(ne){return ne&&this._insert(ne,this.data.height-1),this},u.prototype.clear=function(){return this.data=fe([]),this},u.prototype.remove=function(ne,me){if(!ne)return this;for(var ue,ke,je,pe=this.data,U=this.toBBox(ne),F=[],q=[];pe||F.length;){if(pe||(pe=F.pop(),ke=F[F.length-1],ue=q.pop(),je=!0),pe.leaf){var j=m(ne,pe.children,me);if(j!==-1)return pe.children.splice(j,1),F.push(pe),this._condense(F),this}je||pe.leaf||!ie(pe,U)?ke?(ue++,pe=ke.children[ue],je=!1):pe=null:(F.push(pe),q.push(ue),ue=0,ke=pe,pe=pe.children[0])}return this},u.prototype.toBBox=function(ne){return ne},u.prototype.compareMinX=function(ne,me){return ne.minX-me.minX},u.prototype.compareMinY=function(ne,me){return ne.minY-me.minY},u.prototype.toJSON=function(){return this.data},u.prototype.fromJSON=function(ne){return this.data=ne,this},u.prototype._all=function(ne,me){for(var ue=[];ne;)ne.leaf?me.push.apply(me,ne.children):ue.push.apply(ue,ne.children),ne=ue.pop();return me},u.prototype._build=function(ne,me,ue,ke){var je,pe=ue-me+1,U=this._maxEntries;if(pe<=U)return _(je=fe(ne.slice(me,ue+1)),this.toBBox),je;ke||(ke=Math.ceil(Math.log(pe)/Math.log(U)),U=Math.ceil(pe/Math.pow(U,ke-1))),(je=fe([])).leaf=!1,je.height=ke;var F=Math.ceil(pe/U),q=F*Math.ceil(Math.sqrt(U));J(ne,me,ue,q,this.compareMinX);for(var j=me;j<=ue;j+=q){var H=Math.min(j+q-1,ue);J(ne,j,H,F,this.compareMinY);for(var Z=j;Z<=H;Z+=F){var be=Math.min(Z+F-1,H);je.children.push(this._build(ne,Z,be,ke-1))}}return _(je,this.toBBox),je},u.prototype._chooseSubtree=function(ne,me,ue,ke){for(;ke.push(me),!me.leaf&&ke.length-1!==ue;){for(var je=1/0,pe=1/0,U=void 0,F=0;F<me.children.length;F++){var q=me.children[F],j=V(q),H=(Z=ne,be=q,(Math.max(be.maxX,Z.maxX)-Math.min(be.minX,Z.minX))*(Math.max(be.maxY,Z.maxY)-Math.min(be.minY,Z.minY))-j);H<pe?(pe=H,je=j<je?j:je,U=q):H===pe&&j<je&&(je=j,U=q)}me=U||me.children[0]}var Z,be;return me},u.prototype._insert=function(ne,me,ue){var ke=ue?ne:this.toBBox(ne),je=[],pe=this._chooseSubtree(ke,this.data,me,je);for(pe.children.push(ne),b(pe,ke);me>=0&&je[me].children.length>this._maxEntries;)this._split(je,me),me--;this._adjustParentBBoxes(ke,je,me)},u.prototype._split=function(ne,me){var ue=ne[me],ke=ue.children.length,je=this._minEntries;this._chooseSplitAxis(ue,je,ke);var pe=this._chooseSplitIndex(ue,je,ke),U=fe(ue.children.splice(pe,ue.children.length-pe));U.height=ue.height,U.leaf=ue.leaf,_(ue,this.toBBox),_(U,this.toBBox),me?ne[me-1].children.push(U):this._splitRoot(ue,U)},u.prototype._splitRoot=function(ne,me){this.data=fe([ne,me]),this.data.height=ne.height+1,this.data.leaf=!1,_(this.data,this.toBBox)},u.prototype._chooseSplitIndex=function(ne,me,ue){for(var ke,je,pe,U,F,q,j,H=1/0,Z=1/0,be=me;be<=ue-me;be++){var Re=o(ne,0,be,this.toBBox),Oe=o(ne,be,ue,this.toBBox),Ne=(je=Re,pe=Oe,U=void 0,F=void 0,q=void 0,j=void 0,U=Math.max(je.minX,pe.minX),F=Math.max(je.minY,pe.minY),q=Math.min(je.maxX,pe.maxX),j=Math.min(je.maxY,pe.maxY),Math.max(0,q-U)*Math.max(0,j-F)),we=V(Re)+V(Oe);Ne<H?(H=Ne,ke=be,Z=we<Z?we:Z):Ne===H&&we<Z&&(Z=we,ke=be)}return ke||ue-me},u.prototype._chooseSplitAxis=function(ne,me,ue){var ke=ne.leaf?this.compareMinX:I,je=ne.leaf?this.compareMinY:M;this._allDistMargin(ne,me,ue,ke)<this._allDistMargin(ne,me,ue,je)&&ne.children.sort(ke)},u.prototype._allDistMargin=function(ne,me,ue,ke){ne.children.sort(ke);for(var je=this.toBBox,pe=o(ne,0,me,je),U=o(ne,ue-me,ue,je),F=k(pe)+k(U),q=me;q<ue-me;q++){var j=ne.children[q];b(pe,ne.leaf?je(j):j),F+=k(pe)}for(var H=ue-me-1;H>=me;H--){var Z=ne.children[H];b(U,ne.leaf?je(Z):Z),F+=k(U)}return F},u.prototype._adjustParentBBoxes=function(ne,me,ue){for(var ke=ue;ke>=0;ke--)b(me[ke],ne)},u.prototype._condense=function(ne){for(var me=ne.length-1,ue=void 0;me>=0;me--)ne[me].children.length===0?me>0?(ue=ne[me-1].children).splice(ue.indexOf(ne[me]),1):this.clear():_(ne[me],this.toBBox)},u})})(nv)),nv.exports}class Rj{constructor(e=[],t=Mj){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:i}=this,c=t[e];for(;e>0;){const u=e-1>>1,m=t[u];if(i(c,m)>=0)break;t[e]=m,e=u}t[e]=c}_down(e){const{data:t,compare:i}=this,c=this.length>>1,u=t[e];for(;e<c;){let m=(e<<1)+1,_=t[m];const o=m+1;if(o<this.length&&i(t[o],_)<0&&(m=o,_=t[o]),i(_,u)>=0)break;t[e]=_,e=m}t[e]=u}}function Mj(n,e){return n<e?-1:n>e?1:0}const Nj=Object.freeze(Object.defineProperty({__proto__:null,default:Rj},Symbol.toStringTag,{value:"Module"})),Dj=ZL(Nj);var Ay={exports:{}},Kb,wA;function Fj(){return wA||(wA=1,Kb=function(e,t,i,c){var u=e[0],m=e[1],_=!1;i===void 0&&(i=0),c===void 0&&(c=t.length);for(var o=(c-i)/2,b=0,I=o-1;b<o;I=b++){var M=t[i+b*2+0],V=t[i+b*2+1],k=t[i+I*2+0],ie=t[i+I*2+1],se=V>m!=ie>m&&u<(k-M)*(m-V)/(ie-V)+M;se&&(_=!_)}return _}),Kb}var Xb,SA;function Oj(){return SA||(SA=1,Xb=function(e,t,i,c){var u=e[0],m=e[1],_=!1;i===void 0&&(i=0),c===void 0&&(c=t.length);for(var o=c-i,b=0,I=o-1;b<o;I=b++){var M=t[b+i][0],V=t[b+i][1],k=t[I+i][0],ie=t[I+i][1],se=V>m!=ie>m&&u<(k-M)*(m-V)/(ie-V)+M;se&&(_=!_)}return _}),Xb}var EA;function Bj(){if(EA)return Ay.exports;EA=1;var n=Fj(),e=Oj();return Ay.exports=function(i,c,u,m){return c.length>0&&Array.isArray(c[0])?e(i,c,u,m):n(i,c,u,m)},Ay.exports.nested=e,Ay.exports.flat=n,Ay.exports}var Ny={exports:{}},zj=Ny.exports,AA;function jj(){return AA||(AA=1,(function(n,e){(function(t,i){i(e)})(zj,function(t){const c=33306690738754706e-32;function u(se,fe,J,ne,me){let ue,ke,je,pe,U=fe[0],F=ne[0],q=0,j=0;F>U==F>-U?(ue=U,U=fe[++q]):(ue=F,F=ne[++j]);let H=0;if(q<se&&j<J)for(F>U==F>-U?(je=ue-((ke=U+ue)-U),U=fe[++q]):(je=ue-((ke=F+ue)-F),F=ne[++j]),ue=ke,je!==0&&(me[H++]=je);q<se&&j<J;)F>U==F>-U?(je=ue-((ke=ue+U)-(pe=ke-ue))+(U-pe),U=fe[++q]):(je=ue-((ke=ue+F)-(pe=ke-ue))+(F-pe),F=ne[++j]),ue=ke,je!==0&&(me[H++]=je);for(;q<se;)je=ue-((ke=ue+U)-(pe=ke-ue))+(U-pe),U=fe[++q],ue=ke,je!==0&&(me[H++]=je);for(;j<J;)je=ue-((ke=ue+F)-(pe=ke-ue))+(F-pe),F=ne[++j],ue=ke,je!==0&&(me[H++]=je);return ue===0&&H!==0||(me[H++]=ue),H}function m(se){return new Float64Array(se)}const _=33306690738754716e-32,o=22204460492503146e-32,b=11093356479670487e-47,I=m(4),M=m(8),V=m(12),k=m(16),ie=m(4);t.orient2d=function(se,fe,J,ne,me,ue){const ke=(fe-ue)*(J-me),je=(se-me)*(ne-ue),pe=ke-je;if(ke===0||je===0||ke>0!=je>0)return pe;const U=Math.abs(ke+je);return Math.abs(pe)>=_*U?pe:-(function(F,q,j,H,Z,be,Re){let Oe,Ne,we,Fe,nt,xe,le,De,Be,Ye,rt,mt,ft,Dt,Yt,cn,gn,Mn;const Gt=F-Z,st=j-Z,mr=q-be,Er=H-be;nt=(Yt=(De=Gt-(le=(xe=134217729*Gt)-(xe-Gt)))*(Ye=Er-(Be=(xe=134217729*Er)-(xe-Er)))-((Dt=Gt*Er)-le*Be-De*Be-le*Ye))-(rt=Yt-(gn=(De=mr-(le=(xe=134217729*mr)-(xe-mr)))*(Ye=st-(Be=(xe=134217729*st)-(xe-st)))-((cn=mr*st)-le*Be-De*Be-le*Ye))),I[0]=Yt-(rt+nt)+(nt-gn),nt=(ft=Dt-((mt=Dt+rt)-(nt=mt-Dt))+(rt-nt))-(rt=ft-cn),I[1]=ft-(rt+nt)+(nt-cn),nt=(Mn=mt+rt)-mt,I[2]=mt-(Mn-nt)+(rt-nt),I[3]=Mn;let Cr=(function(Vt,Pn){let Gn=Pn[0];for(let Dn=1;Dn<Vt;Dn++)Gn+=Pn[Dn];return Gn})(4,I),Ln=o*Re;if(Cr>=Ln||-Cr>=Ln||(Oe=F-(Gt+(nt=F-Gt))+(nt-Z),we=j-(st+(nt=j-st))+(nt-Z),Ne=q-(mr+(nt=q-mr))+(nt-be),Fe=H-(Er+(nt=H-Er))+(nt-be),Oe===0&&Ne===0&&we===0&&Fe===0)||(Ln=b*Re+c*Math.abs(Cr),(Cr+=Gt*Fe+Er*Oe-(mr*we+st*Ne))>=Ln||-Cr>=Ln))return Cr;nt=(Yt=(De=Oe-(le=(xe=134217729*Oe)-(xe-Oe)))*(Ye=Er-(Be=(xe=134217729*Er)-(xe-Er)))-((Dt=Oe*Er)-le*Be-De*Be-le*Ye))-(rt=Yt-(gn=(De=Ne-(le=(xe=134217729*Ne)-(xe-Ne)))*(Ye=st-(Be=(xe=134217729*st)-(xe-st)))-((cn=Ne*st)-le*Be-De*Be-le*Ye))),ie[0]=Yt-(rt+nt)+(nt-gn),nt=(ft=Dt-((mt=Dt+rt)-(nt=mt-Dt))+(rt-nt))-(rt=ft-cn),ie[1]=ft-(rt+nt)+(nt-cn),nt=(Mn=mt+rt)-mt,ie[2]=mt-(Mn-nt)+(rt-nt),ie[3]=Mn;const ir=u(4,I,4,ie,M);nt=(Yt=(De=Gt-(le=(xe=134217729*Gt)-(xe-Gt)))*(Ye=Fe-(Be=(xe=134217729*Fe)-(xe-Fe)))-((Dt=Gt*Fe)-le*Be-De*Be-le*Ye))-(rt=Yt-(gn=(De=mr-(le=(xe=134217729*mr)-(xe-mr)))*(Ye=we-(Be=(xe=134217729*we)-(xe-we)))-((cn=mr*we)-le*Be-De*Be-le*Ye))),ie[0]=Yt-(rt+nt)+(nt-gn),nt=(ft=Dt-((mt=Dt+rt)-(nt=mt-Dt))+(rt-nt))-(rt=ft-cn),ie[1]=ft-(rt+nt)+(nt-cn),nt=(Mn=mt+rt)-mt,ie[2]=mt-(Mn-nt)+(rt-nt),ie[3]=Mn;const er=u(ir,M,4,ie,V);nt=(Yt=(De=Oe-(le=(xe=134217729*Oe)-(xe-Oe)))*(Ye=Fe-(Be=(xe=134217729*Fe)-(xe-Fe)))-((Dt=Oe*Fe)-le*Be-De*Be-le*Ye))-(rt=Yt-(gn=(De=Ne-(le=(xe=134217729*Ne)-(xe-Ne)))*(Ye=we-(Be=(xe=134217729*we)-(xe-we)))-((cn=Ne*we)-le*Be-De*Be-le*Ye))),ie[0]=Yt-(rt+nt)+(nt-gn),nt=(ft=Dt-((mt=Dt+rt)-(nt=mt-Dt))+(rt-nt))-(rt=ft-cn),ie[1]=ft-(rt+nt)+(nt-cn),nt=(Mn=mt+rt)-mt,ie[2]=mt-(Mn-nt)+(rt-nt),ie[3]=Mn;const Yr=u(er,V,4,ie,k);return k[Yr-1]})(se,fe,J,ne,me,ue,U)},t.orient2dfast=function(se,fe,J,ne,me,ue){return(fe-ue)*(J-me)-(se-me)*(ne-ue)},Object.defineProperty(t,"__esModule",{value:!0})})})(Ny,Ny.exports)),Ny.exports}var TA;function Uj(){if(TA)return C1.exports;TA=1;var n=kj(),e=Dj,t=Bj(),i=jj().orient2d;e.default&&(e=e.default),C1.exports=c,C1.exports.default=c;function c(ue,ke,je){ke=Math.max(0,ke===void 0?2:ke),je=je||0;var pe=k(ue),U=new n(16);U.toBBox=function(le){return{minX:le[0],minY:le[1],maxX:le[0],maxY:le[1]}},U.compareMinX=function(le,De){return le[0]-De[0]},U.compareMinY=function(le,De){return le[1]-De[1]},U.load(ue);for(var F=[],q=0,j;q<pe.length;q++){var H=pe[q];U.remove(H),j=ie(H,j),F.push(j)}var Z=new n(16);for(q=0;q<F.length;q++)Z.insert(V(F[q]));for(var be=ke*ke,Re=je*je;F.length;){var Oe=F.shift(),Ne=Oe.p,we=Oe.next.p,Fe=se(Ne,we);if(!(Fe<Re)){var nt=Fe/be;H=u(U,Oe.prev.p,Ne,we,Oe.next.next.p,nt,Z),H&&Math.min(se(H,Ne),se(H,we))<=nt&&(F.push(Oe),F.push(ie(H,Oe)),U.remove(H),Z.remove(Oe),Z.insert(V(Oe)),Z.insert(V(Oe.next)))}}Oe=j;var xe=[];do xe.push(Oe.p),Oe=Oe.next;while(Oe!==j);return xe.push(Oe.p),xe}function u(ue,ke,je,pe,U,F,q){for(var j=new e([],m),H=ue.data;H;){for(var Z=0;Z<H.children.length;Z++){var be=H.children[Z],Re=H.leaf?fe(be,je,pe):_(je,pe,be);Re>F||j.push({node:be,dist:Re})}for(;j.length&&!j.peek().node.children;){var Oe=j.pop(),Ne=Oe.node,we=fe(Ne,ke,je),Fe=fe(Ne,pe,U);if(Oe.dist<we&&Oe.dist<Fe&&b(je,Ne,q)&&b(pe,Ne,q))return Ne}H=j.pop(),H&&(H=H.node)}return null}function m(ue,ke){return ue.dist-ke.dist}function _(ue,ke,je){if(o(ue,je)||o(ke,je))return 0;var pe=J(ue[0],ue[1],ke[0],ke[1],je.minX,je.minY,je.maxX,je.minY);if(pe===0)return 0;var U=J(ue[0],ue[1],ke[0],ke[1],je.minX,je.minY,je.minX,je.maxY);if(U===0)return 0;var F=J(ue[0],ue[1],ke[0],ke[1],je.maxX,je.minY,je.maxX,je.maxY);if(F===0)return 0;var q=J(ue[0],ue[1],ke[0],ke[1],je.minX,je.maxY,je.maxX,je.maxY);return q===0?0:Math.min(pe,U,F,q)}function o(ue,ke){return ue[0]>=ke.minX&&ue[0]<=ke.maxX&&ue[1]>=ke.minY&&ue[1]<=ke.maxY}function b(ue,ke,je){for(var pe=Math.min(ue[0],ke[0]),U=Math.min(ue[1],ke[1]),F=Math.max(ue[0],ke[0]),q=Math.max(ue[1],ke[1]),j=je.search({minX:pe,minY:U,maxX:F,maxY:q}),H=0;H<j.length;H++)if(M(j[H].p,j[H].next.p,ue,ke))return!1;return!0}function I(ue,ke,je){return i(ue[0],ue[1],ke[0],ke[1],je[0],je[1])}function M(ue,ke,je,pe){return ue!==pe&&ke!==je&&I(ue,ke,je)>0!=I(ue,ke,pe)>0&&I(je,pe,ue)>0!=I(je,pe,ke)>0}function V(ue){var ke=ue.p,je=ue.next.p;return ue.minX=Math.min(ke[0],je[0]),ue.minY=Math.min(ke[1],je[1]),ue.maxX=Math.max(ke[0],je[0]),ue.maxY=Math.max(ke[1],je[1]),ue}function k(ue){for(var ke=ue[0],je=ue[0],pe=ue[0],U=ue[0],F=0;F<ue.length;F++){var q=ue[F];q[0]<ke[0]&&(ke=q),q[0]>pe[0]&&(pe=q),q[1]<je[1]&&(je=q),q[1]>U[1]&&(U=q)}var j=[ke,je,pe,U],H=j.slice();for(F=0;F<ue.length;F++)t(ue[F],j)||H.push(ue[F]);return me(H)}function ie(ue,ke){var je={p:ue,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return ke?(je.next=ke.next,je.prev=ke,ke.next.prev=je,ke.next=je):(je.prev=je,je.next=je),je}function se(ue,ke){var je=ue[0]-ke[0],pe=ue[1]-ke[1];return je*je+pe*pe}function fe(ue,ke,je){var pe=ke[0],U=ke[1],F=je[0]-pe,q=je[1]-U;if(F!==0||q!==0){var j=((ue[0]-pe)*F+(ue[1]-U)*q)/(F*F+q*q);j>1?(pe=je[0],U=je[1]):j>0&&(pe+=F*j,U+=q*j)}return F=ue[0]-pe,q=ue[1]-U,F*F+q*q}function J(ue,ke,je,pe,U,F,q,j){var H=je-ue,Z=pe-ke,be=q-U,Re=j-F,Oe=ue-U,Ne=ke-F,we=H*H+Z*Z,Fe=H*be+Z*Re,nt=be*be+Re*Re,xe=H*Oe+Z*Ne,le=be*Oe+Re*Ne,De=we*nt-Fe*Fe,Be,Ye,rt,mt,ft=De,Dt=De;De===0?(Ye=0,ft=1,mt=le,Dt=nt):(Ye=Fe*le-nt*xe,mt=we*le-Fe*xe,Ye<0?(Ye=0,mt=le,Dt=nt):Ye>ft&&(Ye=ft,mt=le+Fe,Dt=nt)),mt<0?(mt=0,-xe<0?Ye=0:-xe>we?Ye=ft:(Ye=-xe,ft=we)):mt>Dt&&(mt=Dt,-xe+Fe<0?Ye=0:-xe+Fe>we?Ye=ft:(Ye=-xe+Fe,ft=we)),Be=Ye===0?0:Ye/ft,rt=mt===0?0:mt/Dt;var Yt=(1-Be)*ue+Be*je,cn=(1-Be)*ke+Be*pe,gn=(1-rt)*U+rt*q,Mn=(1-rt)*F+rt*j,Gt=gn-Yt,st=Mn-cn;return Gt*Gt+st*st}function ne(ue,ke){return ue[0]===ke[0]?ue[1]-ke[1]:ue[0]-ke[0]}function me(ue){ue.sort(ne);for(var ke=[],je=0;je<ue.length;je++){for(;ke.length>=2&&I(ke[ke.length-2],ke[ke.length-1],ue[je])<=0;)ke.pop();ke.push(ue[je])}for(var pe=[],U=ue.length-1;U>=0;U--){for(;pe.length>=2&&I(pe[pe.length-2],pe[pe.length-1],ue[U])<=0;)pe.pop();pe.push(ue[U])}return pe.pop(),ke.pop(),ke.concat(pe)}return C1.exports}var Vj=Uj();const qj=Zv(Vj);function x8(n,e={}){e.concavity=e.concavity||1/0;const t=[];if(ym(n,c=>{t.push([c[0],c[1]])}),!t.length)return null;const i=qj(t,e.concavity);return i.length>3?S3([i]):null}function b8(n,e={}){switch(y8(n)){case"Point":return ms(Qh(n),e.properties);case"Polygon":var t=[];ym(n,function(ue){t.push(ue)});var i=Ml(n,{properties:e.properties}),c=i.geometry.coordinates,u=0,m=0,_=0,o,b,I,M,V,k,ie,se,fe=t.map(function(ue){return[ue[0]-c[0],ue[1]-c[1]]});for(o=0;o<t.length-1;o++)b=fe[o],M=b[0],k=b[1],I=fe[o+1],V=I[0],ie=I[1],se=M*ie-V*k,_+=se,u+=(M+V)*se,m+=(k+ie)*se;if(_===0)return i;var J=_*.5,ne=1/(6*J);return ms([c[0]+ne*u,c[1]+ne*m],e.properties);default:var me=x8(n);return me?b8(me,{properties:e.properties}):Ml(n,{properties:e.properties})}}function I3(n){if(!n)throw new Error("geojson is required");switch(n.type){case"Feature":return w8(n);case"FeatureCollection":return $j(n);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return C3(n);default:throw new Error("unknown GeoJSON type")}}function w8(n){const e={type:"Feature"};return Object.keys(n).forEach(t=>{switch(t){case"type":case"properties":case"geometry":return;default:e[t]=n[t]}}),e.properties=S8(n.properties),n.geometry==null?e.geometry=null:e.geometry=C3(n.geometry),e}function S8(n){const e={};return n&&Object.keys(n).forEach(t=>{const i=n[t];typeof i=="object"?i===null?e[t]=null:Array.isArray(i)?e[t]=i.map(c=>c):e[t]=S8(i):e[t]=i}),e}function $j(n){const e={type:"FeatureCollection"};return Object.keys(n).forEach(t=>{switch(t){case"type":case"features":return;default:e[t]=n[t]}}),e.features=n.features.map(t=>w8(t)),e}function C3(n){const e={type:n.type};return n.bbox&&(e.bbox=n.bbox),n.type==="GeometryCollection"?(e.geometries=n.geometries.map(t=>C3(t)),e):(e.coordinates=E8(n.coordinates),e)}function E8(n){const e=n;return typeof e[0]!="object"?e.slice():e.map(t=>E8(t))}var Gj=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,Zb=Math.ceil,Ld=Math.floor,Zh="[BigNumber Error] ",IA=Zh+"Number primitive has more than 15 significant digits: ",Kd=1e14,Po=14,Yb=9007199254740991,Jb=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],Xp=1e7,Eu=1e9;function A8(n){var e,t,i,c=ne.prototype={constructor:ne,toString:null,valueOf:null},u=new ne(1),m=20,_=4,o=-7,b=21,I=-1e7,M=1e7,V=!1,k=1,ie=0,se={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"",suffix:""},fe="0123456789abcdefghijklmnopqrstuvwxyz",J=!0;function ne(U,F){var q,j,H,Z,be,Re,Oe,Ne,we=this;if(!(we instanceof ne))return new ne(U,F);if(F==null){if(U&&U._isBigNumber===!0){we.s=U.s,!U.c||U.e>M?we.c=we.e=null:U.e<I?we.c=[we.e=0]:(we.e=U.e,we.c=U.c.slice());return}if((Re=typeof U=="number")&&U*0==0){if(we.s=1/U<0?(U=-U,-1):1,U===~~U){for(Z=0,be=U;be>=10;be/=10,Z++);Z>M?we.c=we.e=null:(we.e=Z,we.c=[U]);return}Ne=String(U)}else{if(!Gj.test(Ne=String(U)))return i(we,Ne,Re);we.s=Ne.charCodeAt(0)==45?(Ne=Ne.slice(1),-1):1}(Z=Ne.indexOf("."))>-1&&(Ne=Ne.replace(".","")),(be=Ne.search(/e/i))>0?(Z<0&&(Z=be),Z+=+Ne.slice(be+1),Ne=Ne.substring(0,be)):Z<0&&(Z=Ne.length)}else{if(Xl(F,2,fe.length,"Base"),F==10&&J)return we=new ne(U),je(we,m+we.e+1,_);if(Ne=String(U),Re=typeof U=="number"){if(U*0!=0)return i(we,Ne,Re,F);if(we.s=1/U<0?(Ne=Ne.slice(1),-1):1,ne.DEBUG&&Ne.replace(/^0\.0*|\./,"").length>15)throw Error(IA+U)}else we.s=Ne.charCodeAt(0)===45?(Ne=Ne.slice(1),-1):1;for(q=fe.slice(0,F),Z=be=0,Oe=Ne.length;be<Oe;be++)if(q.indexOf(j=Ne.charAt(be))<0){if(j=="."){if(be>Z){Z=Oe;continue}}else if(!H&&(Ne==Ne.toUpperCase()&&(Ne=Ne.toLowerCase())||Ne==Ne.toLowerCase()&&(Ne=Ne.toUpperCase()))){H=!0,be=-1,Z=0;continue}return i(we,String(U),Re,F)}Re=!1,Ne=t(Ne,F,10,we.s),(Z=Ne.indexOf("."))>-1?Ne=Ne.replace(".",""):Z=Ne.length}for(be=0;Ne.charCodeAt(be)===48;be++);for(Oe=Ne.length;Ne.charCodeAt(--Oe)===48;);if(Ne=Ne.slice(be,++Oe)){if(Oe-=be,Re&&ne.DEBUG&&Oe>15&&(U>Yb||U!==Ld(U)))throw Error(IA+we.s*U);if((Z=Z-be-1)>M)we.c=we.e=null;else if(Z<I)we.c=[we.e=0];else{if(we.e=Z,we.c=[],be=(Z+1)%Po,Z<0&&(be+=Po),be<Oe){for(be&&we.c.push(+Ne.slice(0,be)),Oe-=Po;be<Oe;)we.c.push(+Ne.slice(be,be+=Po));be=Po-(Ne=Ne.slice(be)).length}else be-=Oe;for(;be--;Ne+="0");we.c.push(+Ne)}}else we.c=[we.e=0]}ne.clone=A8,ne.ROUND_UP=0,ne.ROUND_DOWN=1,ne.ROUND_CEIL=2,ne.ROUND_FLOOR=3,ne.ROUND_HALF_UP=4,ne.ROUND_HALF_DOWN=5,ne.ROUND_HALF_EVEN=6,ne.ROUND_HALF_CEIL=7,ne.ROUND_HALF_FLOOR=8,ne.EUCLID=9,ne.config=ne.set=function(U){var F,q;if(U!=null)if(typeof U=="object"){if(U.hasOwnProperty(F="DECIMAL_PLACES")&&(q=U[F],Xl(q,0,Eu,F),m=q),U.hasOwnProperty(F="ROUNDING_MODE")&&(q=U[F],Xl(q,0,8,F),_=q),U.hasOwnProperty(F="EXPONENTIAL_AT")&&(q=U[F],q&&q.pop?(Xl(q[0],-Eu,0,F),Xl(q[1],0,Eu,F),o=q[0],b=q[1]):(Xl(q,-Eu,Eu,F),o=-(b=q<0?-q:q))),U.hasOwnProperty(F="RANGE"))if(q=U[F],q&&q.pop)Xl(q[0],-Eu,-1,F),Xl(q[1],1,Eu,F),I=q[0],M=q[1];else if(Xl(q,-Eu,Eu,F),q)I=-(M=q<0?-q:q);else throw Error(Zh+F+" cannot be zero: "+q);if(U.hasOwnProperty(F="CRYPTO"))if(q=U[F],q===!!q)if(q)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))V=q;else throw V=!q,Error(Zh+"crypto unavailable");else V=q;else throw Error(Zh+F+" not true or false: "+q);if(U.hasOwnProperty(F="MODULO_MODE")&&(q=U[F],Xl(q,0,9,F),k=q),U.hasOwnProperty(F="POW_PRECISION")&&(q=U[F],Xl(q,0,Eu,F),ie=q),U.hasOwnProperty(F="FORMAT"))if(q=U[F],typeof q=="object")se=q;else throw Error(Zh+F+" not an object: "+q);if(U.hasOwnProperty(F="ALPHABET"))if(q=U[F],typeof q=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(q))J=q.slice(0,10)=="0123456789",fe=q;else throw Error(Zh+F+" invalid: "+q)}else throw Error(Zh+"Object expected: "+U);return{DECIMAL_PLACES:m,ROUNDING_MODE:_,EXPONENTIAL_AT:[o,b],RANGE:[I,M],CRYPTO:V,MODULO_MODE:k,POW_PRECISION:ie,FORMAT:se,ALPHABET:fe}},ne.isBigNumber=function(U){if(!U||U._isBigNumber!==!0)return!1;if(!ne.DEBUG)return!0;var F,q,j=U.c,H=U.e,Z=U.s;e:if({}.toString.call(j)=="[object Array]"){if((Z===1||Z===-1)&&H>=-Eu&&H<=Eu&&H===Ld(H)){if(j[0]===0){if(H===0&&j.length===1)return!0;break e}if(F=(H+1)%Po,F<1&&(F+=Po),String(j[0]).length==F){for(F=0;F<j.length;F++)if(q=j[F],q<0||q>=Kd||q!==Ld(q))break e;if(q!==0)return!0}}}else if(j===null&&H===null&&(Z===null||Z===1||Z===-1))return!0;throw Error(Zh+"Invalid BigNumber: "+U)},ne.maximum=ne.max=function(){return ue(arguments,-1)},ne.minimum=ne.min=function(){return ue(arguments,1)},ne.random=(function(){var U=9007199254740992,F=Math.random()*U&2097151?function(){return Ld(Math.random()*U)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(q){var j,H,Z,be,Re,Oe=0,Ne=[],we=new ne(u);if(q==null?q=m:Xl(q,0,Eu),be=Zb(q/Po),V)if(crypto.getRandomValues){for(j=crypto.getRandomValues(new Uint32Array(be*=2));Oe<be;)Re=j[Oe]*131072+(j[Oe+1]>>>11),Re>=9e15?(H=crypto.getRandomValues(new Uint32Array(2)),j[Oe]=H[0],j[Oe+1]=H[1]):(Ne.push(Re%1e14),Oe+=2);Oe=be/2}else if(crypto.randomBytes){for(j=crypto.randomBytes(be*=7);Oe<be;)Re=(j[Oe]&31)*281474976710656+j[Oe+1]*1099511627776+j[Oe+2]*4294967296+j[Oe+3]*16777216+(j[Oe+4]<<16)+(j[Oe+5]<<8)+j[Oe+6],Re>=9e15?crypto.randomBytes(7).copy(j,Oe):(Ne.push(Re%1e14),Oe+=7);Oe=be/7}else throw V=!1,Error(Zh+"crypto unavailable");if(!V)for(;Oe<be;)Re=F(),Re<9e15&&(Ne[Oe++]=Re%1e14);for(be=Ne[--Oe],q%=Po,be&&q&&(Re=Jb[Po-q],Ne[Oe]=Ld(be/Re)*Re);Ne[Oe]===0;Ne.pop(),Oe--);if(Oe<0)Ne=[Z=0];else{for(Z=-1;Ne[0]===0;Ne.splice(0,1),Z-=Po);for(Oe=1,Re=Ne[0];Re>=10;Re/=10,Oe++);Oe<Po&&(Z-=Po-Oe)}return we.e=Z,we.c=Ne,we}})(),ne.sum=function(){for(var U=1,F=arguments,q=new ne(F[0]);U<F.length;)q=q.plus(F[U++]);return q},t=(function(){var U="0123456789";function F(q,j,H,Z){for(var be,Re=[0],Oe,Ne=0,we=q.length;Ne<we;){for(Oe=Re.length;Oe--;Re[Oe]*=j);for(Re[0]+=Z.indexOf(q.charAt(Ne++)),be=0;be<Re.length;be++)Re[be]>H-1&&(Re[be+1]==null&&(Re[be+1]=0),Re[be+1]+=Re[be]/H|0,Re[be]%=H)}return Re.reverse()}return function(q,j,H,Z,be){var Re,Oe,Ne,we,Fe,nt,xe,le,De=q.indexOf("."),Be=m,Ye=_;for(De>=0&&(we=ie,ie=0,q=q.replace(".",""),le=new ne(j),nt=le.pow(q.length-De),ie=we,le.c=F(fp(Cd(nt.c),nt.e,"0"),10,H,U),le.e=le.c.length),xe=F(q,j,H,be?(Re=fe,U):(Re=U,fe)),Ne=we=xe.length;xe[--we]==0;xe.pop());if(!xe[0])return Re.charAt(0);if(De<0?--Ne:(nt.c=xe,nt.e=Ne,nt.s=Z,nt=e(nt,le,Be,Ye,H),xe=nt.c,Fe=nt.r,Ne=nt.e),Oe=Ne+Be+1,De=xe[Oe],we=H/2,Fe=Fe||Oe<0||xe[Oe+1]!=null,Fe=Ye<4?(De!=null||Fe)&&(Ye==0||Ye==(nt.s<0?3:2)):De>we||De==we&&(Ye==4||Fe||Ye==6&&xe[Oe-1]&1||Ye==(nt.s<0?8:7)),Oe<1||!xe[0])q=Fe?fp(Re.charAt(1),-Be,Re.charAt(0)):Re.charAt(0);else{if(xe.length=Oe,Fe)for(--H;++xe[--Oe]>H;)xe[Oe]=0,Oe||(++Ne,xe=[1].concat(xe));for(we=xe.length;!xe[--we];);for(De=0,q="";De<=we;q+=Re.charAt(xe[De++]));q=fp(q,Ne,Re.charAt(0))}return q}})(),e=(function(){function U(j,H,Z){var be,Re,Oe,Ne,we=0,Fe=j.length,nt=H%Xp,xe=H/Xp|0;for(j=j.slice();Fe--;)Oe=j[Fe]%Xp,Ne=j[Fe]/Xp|0,be=xe*Oe+Ne*nt,Re=nt*Oe+be%Xp*Xp+we,we=(Re/Z|0)+(be/Xp|0)+xe*Ne,j[Fe]=Re%Z;return we&&(j=[we].concat(j)),j}function F(j,H,Z,be){var Re,Oe;if(Z!=be)Oe=Z>be?1:-1;else for(Re=Oe=0;Re<Z;Re++)if(j[Re]!=H[Re]){Oe=j[Re]>H[Re]?1:-1;break}return Oe}function q(j,H,Z,be){for(var Re=0;Z--;)j[Z]-=Re,Re=j[Z]<H[Z]?1:0,j[Z]=Re*be+j[Z]-H[Z];for(;!j[0]&&j.length>1;j.splice(0,1));}return function(j,H,Z,be,Re){var Oe,Ne,we,Fe,nt,xe,le,De,Be,Ye,rt,mt,ft,Dt,Yt,cn,gn,Mn=j.s==H.s?1:-1,Gt=j.c,st=H.c;if(!Gt||!Gt[0]||!st||!st[0])return new ne(!j.s||!H.s||(Gt?st&&Gt[0]==st[0]:!st)?NaN:Gt&&Gt[0]==0||!st?Mn*0:Mn/0);for(De=new ne(Mn),Be=De.c=[],Ne=j.e-H.e,Mn=Z+Ne+1,Re||(Re=Kd,Ne=Pd(j.e/Po)-Pd(H.e/Po),Mn=Mn/Po|0),we=0;st[we]==(Gt[we]||0);we++);if(st[we]>(Gt[we]||0)&&Ne--,Mn<0)Be.push(1),Fe=!0;else{for(Dt=Gt.length,cn=st.length,we=0,Mn+=2,nt=Ld(Re/(st[0]+1)),nt>1&&(st=U(st,nt,Re),Gt=U(Gt,nt,Re),cn=st.length,Dt=Gt.length),ft=cn,Ye=Gt.slice(0,cn),rt=Ye.length;rt<cn;Ye[rt++]=0);gn=st.slice(),gn=[0].concat(gn),Yt=st[0],st[1]>=Re/2&&Yt++;do{if(nt=0,Oe=F(st,Ye,cn,rt),Oe<0){if(mt=Ye[0],cn!=rt&&(mt=mt*Re+(Ye[1]||0)),nt=Ld(mt/Yt),nt>1)for(nt>=Re&&(nt=Re-1),xe=U(st,nt,Re),le=xe.length,rt=Ye.length;F(xe,Ye,le,rt)==1;)nt--,q(xe,cn<le?gn:st,le,Re),le=xe.length,Oe=1;else nt==0&&(Oe=nt=1),xe=st.slice(),le=xe.length;if(le<rt&&(xe=[0].concat(xe)),q(Ye,xe,rt,Re),rt=Ye.length,Oe==-1)for(;F(st,Ye,cn,rt)<1;)nt++,q(Ye,cn<rt?gn:st,rt,Re),rt=Ye.length}else Oe===0&&(nt++,Ye=[0]);Be[we++]=nt,Ye[0]?Ye[rt++]=Gt[ft]||0:(Ye=[Gt[ft]],rt=1)}while((ft++<Dt||Ye[0]!=null)&&Mn--);Fe=Ye[0]!=null,Be[0]||Be.splice(0,1)}if(Re==Kd){for(we=1,Mn=Be[0];Mn>=10;Mn/=10,we++);je(De,Z+(De.e=we+Ne*Po-1)+1,be,Fe)}else De.e=Ne,De.r=+Fe;return De}})();function me(U,F,q,j){var H,Z,be,Re,Oe;if(q==null?q=_:Xl(q,0,8),!U.c)return U.toString();if(H=U.c[0],be=U.e,F==null)Oe=Cd(U.c),Oe=j==1||j==2&&(be<=o||be>=b)?P1(Oe,be):fp(Oe,be,"0");else if(U=je(new ne(U),F,q),Z=U.e,Oe=Cd(U.c),Re=Oe.length,j==1||j==2&&(F<=Z||Z<=o)){for(;Re<F;Oe+="0",Re++);Oe=P1(Oe,Z)}else if(F-=be+(j===2&&Z>be),Oe=fp(Oe,Z,"0"),Z+1>Re){if(--F>0)for(Oe+=".";F--;Oe+="0");}else if(F+=Z-Re,F>0)for(Z+1==Re&&(Oe+=".");F--;Oe+="0");return U.s<0&&H?"-"+Oe:Oe}function ue(U,F){for(var q,j,H=1,Z=new ne(U[0]);H<U.length;H++)j=new ne(U[H]),(!j.s||(q=zm(Z,j))===F||q===0&&Z.s===F)&&(Z=j);return Z}function ke(U,F,q){for(var j=1,H=F.length;!F[--H];F.pop());for(H=F[0];H>=10;H/=10,j++);return(q=j+q*Po-1)>M?U.c=U.e=null:q<I?U.c=[U.e=0]:(U.e=q,U.c=F),U}i=(function(){var U=/^(-?)0([xbo])(?=\w[\w.]*$)/i,F=/^([^.]+)\.$/,q=/^\.([^.]+)$/,j=/^-?(Infinity|NaN)$/,H=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(Z,be,Re,Oe){var Ne,we=Re?be:be.replace(H,"");if(j.test(we))Z.s=isNaN(we)?null:we<0?-1:1;else{if(!Re&&(we=we.replace(U,function(Fe,nt,xe){return Ne=(xe=xe.toLowerCase())=="x"?16:xe=="b"?2:8,!Oe||Oe==Ne?nt:Fe}),Oe&&(Ne=Oe,we=we.replace(F,"$1").replace(q,"0.$1")),be!=we))return new ne(we,Ne);if(ne.DEBUG)throw Error(Zh+"Not a"+(Oe?" base "+Oe:"")+" number: "+be);Z.s=null}Z.c=Z.e=null}})();function je(U,F,q,j){var H,Z,be,Re,Oe,Ne,we,Fe=U.c,nt=Jb;if(Fe){e:{for(H=1,Re=Fe[0];Re>=10;Re/=10,H++);if(Z=F-H,Z<0)Z+=Po,be=F,Oe=Fe[Ne=0],we=Ld(Oe/nt[H-be-1]%10);else if(Ne=Zb((Z+1)/Po),Ne>=Fe.length)if(j){for(;Fe.length<=Ne;Fe.push(0));Oe=we=0,H=1,Z%=Po,be=Z-Po+1}else break e;else{for(Oe=Re=Fe[Ne],H=1;Re>=10;Re/=10,H++);Z%=Po,be=Z-Po+H,we=be<0?0:Ld(Oe/nt[H-be-1]%10)}if(j=j||F<0||Fe[Ne+1]!=null||(be<0?Oe:Oe%nt[H-be-1]),j=q<4?(we||j)&&(q==0||q==(U.s<0?3:2)):we>5||we==5&&(q==4||j||q==6&&(Z>0?be>0?Oe/nt[H-be]:0:Fe[Ne-1])%10&1||q==(U.s<0?8:7)),F<1||!Fe[0])return Fe.length=0,j?(F-=U.e+1,Fe[0]=nt[(Po-F%Po)%Po],U.e=-F||0):Fe[0]=U.e=0,U;if(Z==0?(Fe.length=Ne,Re=1,Ne--):(Fe.length=Ne+1,Re=nt[Po-Z],Fe[Ne]=be>0?Ld(Oe/nt[H-be]%nt[be])*Re:0),j)for(;;)if(Ne==0){for(Z=1,be=Fe[0];be>=10;be/=10,Z++);for(be=Fe[0]+=Re,Re=1;be>=10;be/=10,Re++);Z!=Re&&(U.e++,Fe[0]==Kd&&(Fe[0]=1));break}else{if(Fe[Ne]+=Re,Fe[Ne]!=Kd)break;Fe[Ne--]=0,Re=1}for(Z=Fe.length;Fe[--Z]===0;Fe.pop());}U.e>M?U.c=U.e=null:U.e<I&&(U.c=[U.e=0])}return U}function pe(U){var F,q=U.e;return q===null?U.toString():(F=Cd(U.c),F=q<=o||q>=b?P1(F,q):fp(F,q,"0"),U.s<0?"-"+F:F)}return c.absoluteValue=c.abs=function(){var U=new ne(this);return U.s<0&&(U.s=1),U},c.comparedTo=function(U,F){return zm(this,new ne(U,F))},c.decimalPlaces=c.dp=function(U,F){var q,j,H,Z=this;if(U!=null)return Xl(U,0,Eu),F==null?F=_:Xl(F,0,8),je(new ne(Z),U+Z.e+1,F);if(!(q=Z.c))return null;if(j=((H=q.length-1)-Pd(this.e/Po))*Po,H=q[H])for(;H%10==0;H/=10,j--);return j<0&&(j=0),j},c.dividedBy=c.div=function(U,F){return e(this,new ne(U,F),m,_)},c.dividedToIntegerBy=c.idiv=function(U,F){return e(this,new ne(U,F),0,1)},c.exponentiatedBy=c.pow=function(U,F){var q,j,H,Z,be,Re,Oe,Ne,we,Fe=this;if(U=new ne(U),U.c&&!U.isInteger())throw Error(Zh+"Exponent not an integer: "+pe(U));if(F!=null&&(F=new ne(F)),Re=U.e>14,!Fe.c||!Fe.c[0]||Fe.c[0]==1&&!Fe.e&&Fe.c.length==1||!U.c||!U.c[0])return we=new ne(Math.pow(+pe(Fe),Re?U.s*(2-L1(U)):+pe(U))),F?we.mod(F):we;if(Oe=U.s<0,F){if(F.c?!F.c[0]:!F.s)return new ne(NaN);j=!Oe&&Fe.isInteger()&&F.isInteger(),j&&(Fe=Fe.mod(F))}else{if(U.e>9&&(Fe.e>0||Fe.e<-1||(Fe.e==0?Fe.c[0]>1||Re&&Fe.c[1]>=24e7:Fe.c[0]<8e13||Re&&Fe.c[0]<=9999975e7)))return Z=Fe.s<0&&L1(U)?-0:0,Fe.e>-1&&(Z=1/Z),new ne(Oe?1/Z:Z);ie&&(Z=Zb(ie/Po+2))}for(Re?(q=new ne(.5),Oe&&(U.s=1),Ne=L1(U)):(H=Math.abs(+pe(U)),Ne=H%2),we=new ne(u);;){if(Ne){if(we=we.times(Fe),!we.c)break;Z?we.c.length>Z&&(we.c.length=Z):j&&(we=we.mod(F))}if(H){if(H=Ld(H/2),H===0)break;Ne=H%2}else if(U=U.times(q),je(U,U.e+1,1),U.e>14)Ne=L1(U);else{if(H=+pe(U),H===0)break;Ne=H%2}Fe=Fe.times(Fe),Z?Fe.c&&Fe.c.length>Z&&(Fe.c.length=Z):j&&(Fe=Fe.mod(F))}return j?we:(Oe&&(we=u.div(we)),F?we.mod(F):Z?je(we,ie,_,be):we)},c.integerValue=function(U){var F=new ne(this);return U==null?U=_:Xl(U,0,8),je(F,F.e+1,U)},c.isEqualTo=c.eq=function(U,F){return zm(this,new ne(U,F))===0},c.isFinite=function(){return!!this.c},c.isGreaterThan=c.gt=function(U,F){return zm(this,new ne(U,F))>0},c.isGreaterThanOrEqualTo=c.gte=function(U,F){return(F=zm(this,new ne(U,F)))===1||F===0},c.isInteger=function(){return!!this.c&&Pd(this.e/Po)>this.c.length-2},c.isLessThan=c.lt=function(U,F){return zm(this,new ne(U,F))<0},c.isLessThanOrEqualTo=c.lte=function(U,F){return(F=zm(this,new ne(U,F)))===-1||F===0},c.isNaN=function(){return!this.s},c.isNegative=function(){return this.s<0},c.isPositive=function(){return this.s>0},c.isZero=function(){return!!this.c&&this.c[0]==0},c.minus=function(U,F){var q,j,H,Z,be=this,Re=be.s;if(U=new ne(U,F),F=U.s,!Re||!F)return new ne(NaN);if(Re!=F)return U.s=-F,be.plus(U);var Oe=be.e/Po,Ne=U.e/Po,we=be.c,Fe=U.c;if(!Oe||!Ne){if(!we||!Fe)return we?(U.s=-F,U):new ne(Fe?be:NaN);if(!we[0]||!Fe[0])return Fe[0]?(U.s=-F,U):new ne(we[0]?be:_==3?-0:0)}if(Oe=Pd(Oe),Ne=Pd(Ne),we=we.slice(),Re=Oe-Ne){for((Z=Re<0)?(Re=-Re,H=we):(Ne=Oe,H=Fe),H.reverse(),F=Re;F--;H.push(0));H.reverse()}else for(j=(Z=(Re=we.length)<(F=Fe.length))?Re:F,Re=F=0;F<j;F++)if(we[F]!=Fe[F]){Z=we[F]<Fe[F];break}if(Z&&(H=we,we=Fe,Fe=H,U.s=-U.s),F=(j=Fe.length)-(q=we.length),F>0)for(;F--;we[q++]=0);for(F=Kd-1;j>Re;){if(we[--j]<Fe[j]){for(q=j;q&&!we[--q];we[q]=F);--we[q],we[j]+=Kd}we[j]-=Fe[j]}for(;we[0]==0;we.splice(0,1),--Ne);return we[0]?ke(U,we,Ne):(U.s=_==3?-1:1,U.c=[U.e=0],U)},c.modulo=c.mod=function(U,F){var q,j,H=this;return U=new ne(U,F),!H.c||!U.s||U.c&&!U.c[0]?new ne(NaN):!U.c||H.c&&!H.c[0]?new ne(H):(k==9?(j=U.s,U.s=1,q=e(H,U,0,3),U.s=j,q.s*=j):q=e(H,U,0,k),U=H.minus(q.times(U)),!U.c[0]&&k==1&&(U.s=H.s),U)},c.multipliedBy=c.times=function(U,F){var q,j,H,Z,be,Re,Oe,Ne,we,Fe,nt,xe,le,De,Be,Ye=this,rt=Ye.c,mt=(U=new ne(U,F)).c;if(!rt||!mt||!rt[0]||!mt[0])return!Ye.s||!U.s||rt&&!rt[0]&&!mt||mt&&!mt[0]&&!rt?U.c=U.e=U.s=null:(U.s*=Ye.s,!rt||!mt?U.c=U.e=null:(U.c=[0],U.e=0)),U;for(j=Pd(Ye.e/Po)+Pd(U.e/Po),U.s*=Ye.s,Oe=rt.length,Fe=mt.length,Oe<Fe&&(le=rt,rt=mt,mt=le,H=Oe,Oe=Fe,Fe=H),H=Oe+Fe,le=[];H--;le.push(0));for(De=Kd,Be=Xp,H=Fe;--H>=0;){for(q=0,nt=mt[H]%Be,xe=mt[H]/Be|0,be=Oe,Z=H+be;Z>H;)Ne=rt[--be]%Be,we=rt[be]/Be|0,Re=xe*Ne+we*nt,Ne=nt*Ne+Re%Be*Be+le[Z]+q,q=(Ne/De|0)+(Re/Be|0)+xe*we,le[Z--]=Ne%De;le[Z]=q}return q?++j:le.splice(0,1),ke(U,le,j)},c.negated=function(){var U=new ne(this);return U.s=-U.s||null,U},c.plus=function(U,F){var q,j=this,H=j.s;if(U=new ne(U,F),F=U.s,!H||!F)return new ne(NaN);if(H!=F)return U.s=-F,j.minus(U);var Z=j.e/Po,be=U.e/Po,Re=j.c,Oe=U.c;if(!Z||!be){if(!Re||!Oe)return new ne(H/0);if(!Re[0]||!Oe[0])return Oe[0]?U:new ne(Re[0]?j:H*0)}if(Z=Pd(Z),be=Pd(be),Re=Re.slice(),H=Z-be){for(H>0?(be=Z,q=Oe):(H=-H,q=Re),q.reverse();H--;q.push(0));q.reverse()}for(H=Re.length,F=Oe.length,H-F<0&&(q=Oe,Oe=Re,Re=q,F=H),H=0;F;)H=(Re[--F]=Re[F]+Oe[F]+H)/Kd|0,Re[F]=Kd===Re[F]?0:Re[F]%Kd;return H&&(Re=[H].concat(Re),++be),ke(U,Re,be)},c.precision=c.sd=function(U,F){var q,j,H,Z=this;if(U!=null&&U!==!!U)return Xl(U,1,Eu),F==null?F=_:Xl(F,0,8),je(new ne(Z),U,F);if(!(q=Z.c))return null;if(H=q.length-1,j=H*Po+1,H=q[H]){for(;H%10==0;H/=10,j--);for(H=q[0];H>=10;H/=10,j++);}return U&&Z.e+1>j&&(j=Z.e+1),j},c.shiftedBy=function(U){return Xl(U,-Yb,Yb),this.times("1e"+U)},c.squareRoot=c.sqrt=function(){var U,F,q,j,H,Z=this,be=Z.c,Re=Z.s,Oe=Z.e,Ne=m+4,we=new ne("0.5");if(Re!==1||!be||!be[0])return new ne(!Re||Re<0&&(!be||be[0])?NaN:be?Z:1/0);if(Re=Math.sqrt(+pe(Z)),Re==0||Re==1/0?(F=Cd(be),(F.length+Oe)%2==0&&(F+="0"),Re=Math.sqrt(+F),Oe=Pd((Oe+1)/2)-(Oe<0||Oe%2),Re==1/0?F="5e"+Oe:(F=Re.toExponential(),F=F.slice(0,F.indexOf("e")+1)+Oe),q=new ne(F)):q=new ne(Re+""),q.c[0]){for(Oe=q.e,Re=Oe+Ne,Re<3&&(Re=0);;)if(H=q,q=we.times(H.plus(e(Z,H,Ne,1))),Cd(H.c).slice(0,Re)===(F=Cd(q.c)).slice(0,Re))if(q.e<Oe&&--Re,F=F.slice(Re-3,Re+1),F=="9999"||!j&&F=="4999"){if(!j&&(je(H,H.e+m+2,0),H.times(H).eq(Z))){q=H;break}Ne+=4,Re+=4,j=1}else{(!+F||!+F.slice(1)&&F.charAt(0)=="5")&&(je(q,q.e+m+2,1),U=!q.times(q).eq(Z));break}}return je(q,q.e+m+1,_,U)},c.toExponential=function(U,F){return U!=null&&(Xl(U,0,Eu),U++),me(this,U,F,1)},c.toFixed=function(U,F){return U!=null&&(Xl(U,0,Eu),U=U+this.e+1),me(this,U,F)},c.toFormat=function(U,F,q){var j,H=this;if(q==null)U!=null&&F&&typeof F=="object"?(q=F,F=null):U&&typeof U=="object"?(q=U,U=F=null):q=se;else if(typeof q!="object")throw Error(Zh+"Argument not an object: "+q);if(j=H.toFixed(U,F),H.c){var Z,be=j.split("."),Re=+q.groupSize,Oe=+q.secondaryGroupSize,Ne=q.groupSeparator||"",we=be[0],Fe=be[1],nt=H.s<0,xe=nt?we.slice(1):we,le=xe.length;if(Oe&&(Z=Re,Re=Oe,Oe=Z,le-=Z),Re>0&&le>0){for(Z=le%Re||Re,we=xe.substr(0,Z);Z<le;Z+=Re)we+=Ne+xe.substr(Z,Re);Oe>0&&(we+=Ne+xe.slice(Z)),nt&&(we="-"+we)}j=Fe?we+(q.decimalSeparator||"")+((Oe=+q.fractionGroupSize)?Fe.replace(new RegExp("\\d{"+Oe+"}\\B","g"),"$&"+(q.fractionGroupSeparator||"")):Fe):we}return(q.prefix||"")+j+(q.suffix||"")},c.toFraction=function(U){var F,q,j,H,Z,be,Re,Oe,Ne,we,Fe,nt,xe=this,le=xe.c;if(U!=null&&(Re=new ne(U),!Re.isInteger()&&(Re.c||Re.s!==1)||Re.lt(u)))throw Error(Zh+"Argument "+(Re.isInteger()?"out of range: ":"not an integer: ")+pe(Re));if(!le)return new ne(xe);for(F=new ne(u),Ne=q=new ne(u),j=Oe=new ne(u),nt=Cd(le),Z=F.e=nt.length-xe.e-1,F.c[0]=Jb[(be=Z%Po)<0?Po+be:be],U=!U||Re.comparedTo(F)>0?Z>0?F:Ne:Re,be=M,M=1/0,Re=new ne(nt),Oe.c[0]=0;we=e(Re,F,0,1),H=q.plus(we.times(j)),H.comparedTo(U)!=1;)q=j,j=H,Ne=Oe.plus(we.times(H=Ne)),Oe=H,F=Re.minus(we.times(H=F)),Re=H;return H=e(U.minus(q),j,0,1),Oe=Oe.plus(H.times(Ne)),q=q.plus(H.times(j)),Oe.s=Ne.s=xe.s,Z=Z*2,Fe=e(Ne,j,Z,_).minus(xe).abs().comparedTo(e(Oe,q,Z,_).minus(xe).abs())<1?[Ne,j]:[Oe,q],M=be,Fe},c.toNumber=function(){return+pe(this)},c.toPrecision=function(U,F){return U!=null&&Xl(U,1,Eu),me(this,U,F,2)},c.toString=function(U){var F,q=this,j=q.s,H=q.e;return H===null?j?(F="Infinity",j<0&&(F="-"+F)):F="NaN":(U==null?F=H<=o||H>=b?P1(Cd(q.c),H):fp(Cd(q.c),H,"0"):U===10&&J?(q=je(new ne(q),m+H+1,_),F=fp(Cd(q.c),q.e,"0")):(Xl(U,2,fe.length,"Base"),F=t(fp(Cd(q.c),H,"0"),10,U,j,!0)),j<0&&q.c[0]&&(F="-"+F)),F},c.valueOf=c.toJSON=function(){return pe(this)},c._isBigNumber=!0,c[Symbol.toStringTag]="BigNumber",c[Symbol.for("nodejs.util.inspect.custom")]=c.valueOf,n!=null&&ne.set(n),ne}function Pd(n){var e=n|0;return n>0||n===e?e:e-1}function Cd(n){for(var e,t,i=1,c=n.length,u=n[0]+"";i<c;){for(e=n[i++]+"",t=Po-e.length;t--;e="0"+e);u+=e}for(c=u.length;u.charCodeAt(--c)===48;);return u.slice(0,c+1||1)}function zm(n,e){var t,i,c=n.c,u=e.c,m=n.s,_=e.s,o=n.e,b=e.e;if(!m||!_)return null;if(t=c&&!c[0],i=u&&!u[0],t||i)return t?i?0:-_:m;if(m!=_)return m;if(t=m<0,i=o==b,!c||!u)return i?0:!c^t?1:-1;if(!i)return o>b^t?1:-1;for(_=(o=c.length)<(b=u.length)?o:b,m=0;m<_;m++)if(c[m]!=u[m])return c[m]>u[m]^t?1:-1;return o==b?0:o>b^t?1:-1}function Xl(n,e,t,i){if(n<e||n>t||n!==Ld(n))throw Error(Zh+(i||"Argument")+(typeof n=="number"?n<e||n>t?" out of range: ":" not an integer: ":" not a primitive number: ")+String(n))}function L1(n){var e=n.c.length-1;return Pd(n.e/Po)==e&&n.c[e]%2!=0}function P1(n,e){return(n.length>1?n.charAt(0)+"."+n.slice(1):n)+(e<0?"e":"e+")+e}function fp(n,e,t){var i,c;if(e<0){for(c=t+".";++e;c+=t);n=c+n}else if(i=n.length,++e>i){for(c=t,e-=i;--e;c+=t);n+=c}else e<i&&(n=n.slice(0,e)+"."+n.slice(e));return n}var Of=A8(),Hj=class{key;left=null;right=null;constructor(n){this.key=n}},Ty=class extends Hj{constructor(n){super(n)}},Wj=class{size=0;modificationCount=0;splayCount=0;splay(n){const e=this.root;if(e==null)return this.compare(n,n),-1;let t=null,i=null,c=null,u=null,m=e;const _=this.compare;let o;for(;;)if(o=_(m.key,n),o>0){let b=m.left;if(b==null||(o=_(b.key,n),o>0&&(m.left=b.right,b.right=m,m=b,b=m.left,b==null)))break;t==null?i=m:t.left=m,t=m,m=b}else if(o<0){let b=m.right;if(b==null||(o=_(b.key,n),o<0&&(m.right=b.left,b.left=m,m=b,b=m.right,b==null)))break;c==null?u=m:c.right=m,c=m,m=b}else break;return c!=null&&(c.right=m.left,m.left=u),t!=null&&(t.left=m.right,m.right=i),this.root!==m&&(this.root=m,this.splayCount++),o}splayMin(n){let e=n,t=e.left;for(;t!=null;){const i=t;e.left=i.right,i.right=e,e=i,t=e.left}return e}splayMax(n){let e=n,t=e.right;for(;t!=null;){const i=t;e.right=i.left,i.left=e,e=i,t=e.right}return e}_delete(n){if(this.root==null||this.splay(n)!=0)return null;let t=this.root;const i=t,c=t.left;if(this.size--,c==null)this.root=t.right;else{const u=t.right;t=this.splayMax(c),t.right=u,this.root=t}return this.modificationCount++,i}addNewRoot(n,e){this.size++,this.modificationCount++;const t=this.root;if(t==null){this.root=n;return}e<0?(n.left=t,n.right=t.right,t.right=null):(n.right=t,n.left=t.left,t.left=null),this.root=n}_first(){const n=this.root;return n==null?null:(this.root=this.splayMin(n),this.root)}_last(){const n=this.root;return n==null?null:(this.root=this.splayMax(n),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(n){return this.validKey(n)&&this.splay(n)==0}defaultCompare(){return(n,e)=>n<e?-1:n>e?1:0}wrap(){return{getRoot:()=>this.root,setRoot:n=>{this.root=n},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:n=>{this.splayCount=n},splay:n=>this.splay(n),has:n=>this.has(n)}}},Nv=class Dy extends Wj{root=null;compare;validKey;constructor(e,t){super(),this.compare=e??this.defaultCompare(),this.validKey=t??(i=>i!=null&&i!=null)}delete(e){return this.validKey(e)?this._delete(e)!=null:!1}deleteAll(e){for(const t of e)this.delete(t)}forEach(e){const t=this[Symbol.iterator]();let i;for(;i=t.next(),!i.done;)e(i.value,i.value,this)}add(e){const t=this.splay(e);return t!=0&&this.addNewRoot(new Ty(e),t),this}addAndReturn(e){const t=this.splay(e);return t!=0&&this.addNewRoot(new Ty(e),t),this.root.key}addAll(e){for(const t of e)this.add(t)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)<0)return this.root.key;let i=this.root.left;if(i==null)return null;let c=i.right;for(;c!=null;)i=c,c=i.right;return i.key}firstAfter(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)>0)return this.root.key;let i=this.root.right;if(i==null)return null;let c=i.left;for(;c!=null;)i=c,c=i.left;return i.key}retainAll(e){const t=new Dy(this.compare,this.validKey),i=this.modificationCount;for(const c of e){if(i!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(c)&&this.splay(c)==0&&t.add(this.root.key)}t.size!=this.size&&(this.root=t.root,this.size=t.size,this.modificationCount++)}lookup(e){return!this.validKey(e)||this.splay(e)!=0?null:this.root.key}intersection(e){const t=new Dy(this.compare,this.validKey);for(const i of this)e.has(i)&&t.add(i);return t}difference(e){const t=new Dy(this.compare,this.validKey);for(const i of this)e.has(i)||t.add(i);return t}union(e){const t=this.clone();return t.addAll(e),t}clone(){const e=new Dy(this.compare,this.validKey);return e.size=this.size,e.root=this.copyNode(this.root),e}copyNode(e){if(e==null)return null;function t(c,u){let m,_;do{if(m=c.left,_=c.right,m!=null){const o=new Ty(m.key);u.left=o,t(m,o)}if(_!=null){const o=new Ty(_.key);u.right=o,c=_,u=o}}while(_!=null)}const i=new Ty(e.key);return t(e,i),i}toSet(){return this.clone()}entries(){return new Xj(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[Symbol.iterator](){return new Kj(this.wrap())}[Symbol.toStringTag]="[object Set]"},T8=class{tree;path=new Array;modificationCount=null;splayCount;constructor(n){this.tree=n,this.splayCount=n.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;const n=this.path[this.path.length-1];return this.getValue(n)}rebuildPath(n){this.path.splice(0,this.path.length),this.tree.splay(n),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(n){for(;n!=null;)this.path.push(n),n=n.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let t=this.tree.getRoot();for(;t!=null;)this.path.push(t),t=t.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let n=this.path[this.path.length-1],e=n.right;if(e!=null){for(;e!=null;)this.path.push(e),e=e.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===n;)n=this.path.pop();return this.path.length>0}},Kj=class extends T8{getValue(n){return n.key}},Xj=class extends T8{getValue(n){return[n.key,n.key]}},I8=n=>()=>n,Y5=n=>{const e=n?(t,i)=>i.minus(t).abs().isLessThanOrEqualTo(n):I8(!1);return(t,i)=>e(t,i)?0:t.comparedTo(i)};function Zj(n){const e=n?(t,i,c,u,m)=>t.exponentiatedBy(2).isLessThanOrEqualTo(u.minus(i).exponentiatedBy(2).plus(m.minus(c).exponentiatedBy(2)).times(n)):I8(!1);return(t,i,c)=>{const u=t.x,m=t.y,_=c.x,o=c.y,b=m.minus(o).times(i.x.minus(_)).minus(u.minus(_).times(i.y.minus(o)));return e(b,u,m,_,o)?0:b.comparedTo(0)}}var Yj=n=>n,Jj=n=>{if(n){const e=new Nv(Y5(n)),t=new Nv(Y5(n)),i=(u,m)=>m.addAndReturn(u),c=u=>({x:i(u.x,e),y:i(u.y,t)});return c({x:new Of(0),y:new Of(0)}),c}return Yj},J5=n=>({set:e=>{Lp=J5(e)},reset:()=>J5(n),compare:Y5(n),snap:Jj(n),orient:Zj(n)}),Lp=J5(),Iy=(n,e)=>n.ll.x.isLessThanOrEqualTo(e.x)&&e.x.isLessThanOrEqualTo(n.ur.x)&&n.ll.y.isLessThanOrEqualTo(e.y)&&e.y.isLessThanOrEqualTo(n.ur.y),Q5=(n,e)=>{if(e.ur.x.isLessThan(n.ll.x)||n.ur.x.isLessThan(e.ll.x)||e.ur.y.isLessThan(n.ll.y)||n.ur.y.isLessThan(e.ll.y))return null;const t=n.ll.x.isLessThan(e.ll.x)?e.ll.x:n.ll.x,i=n.ur.x.isLessThan(e.ur.x)?n.ur.x:e.ur.x,c=n.ll.y.isLessThan(e.ll.y)?e.ll.y:n.ll.y,u=n.ur.y.isLessThan(e.ur.y)?n.ur.y:e.ur.y;return{ll:{x:t,y:c},ur:{x:i,y:u}}},rv=(n,e)=>n.x.times(e.y).minus(n.y.times(e.x)),C8=(n,e)=>n.x.times(e.x).plus(n.y.times(e.y)),Dv=n=>C8(n,n).sqrt(),Qj=(n,e,t)=>{const i={x:e.x.minus(n.x),y:e.y.minus(n.y)},c={x:t.x.minus(n.x),y:t.y.minus(n.y)};return rv(c,i).div(Dv(c)).div(Dv(i))},eU=(n,e,t)=>{const i={x:e.x.minus(n.x),y:e.y.minus(n.y)},c={x:t.x.minus(n.x),y:t.y.minus(n.y)};return C8(c,i).div(Dv(c)).div(Dv(i))},CA=(n,e,t)=>e.y.isZero()?null:{x:n.x.plus(e.x.div(e.y).times(t.minus(n.y))),y:t},LA=(n,e,t)=>e.x.isZero()?null:{x:t,y:n.y.plus(e.y.div(e.x).times(t.minus(n.x)))},tU=(n,e,t,i)=>{if(e.x.isZero())return LA(t,i,n.x);if(i.x.isZero())return LA(n,e,t.x);if(e.y.isZero())return CA(t,i,n.y);if(i.y.isZero())return CA(n,e,t.y);const c=rv(e,i);if(c.isZero())return null;const u={x:t.x.minus(n.x),y:t.y.minus(n.y)},m=rv(u,e).div(c),_=rv(u,i).div(c),o=n.x.plus(_.times(e.x)),b=t.x.plus(m.times(i.x)),I=n.y.plus(_.times(e.y)),M=t.y.plus(m.times(i.y)),V=o.plus(b).div(2),k=I.plus(M).div(2);return{x:V,y:k}},kf=class L8{point;isLeft;segment;otherSE;consumedBy;static compare(e,t){const i=L8.comparePoints(e.point,t.point);return i!==0?i:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:Fv.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x.isLessThan(t.x)?-1:e.x.isGreaterThan(t.x)?1:e.y.isLessThan(t.y)?-1:e.y.isGreaterThan(t.y)?1:0}constructor(e,t){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let i=0,c=t.length;i<c;i++){const u=t[i];this.point.events.push(u),u.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const i=this.point.events[t];if(i.segment.consumedBy===void 0)for(let c=t+1;c<e;c++){const u=this.point.events[c];u.consumedBy===void 0&&i.otherSE.point.events===u.otherSE.point.events&&i.segment.consume(u.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,i=this.point.events.length;t<i;t++){const c=this.point.events[t];c!==this&&!c.segment.ringOut&&c.segment.isInResult()&&e.push(c)}return e}getLeftmostComparator(e){const t=new Map,i=c=>{const u=c.otherSE;t.set(c,{sine:Qj(this.point,e.point,u.point),cosine:eU(this.point,e.point,u.point)})};return(c,u)=>{t.has(c)||i(c),t.has(u)||i(u);const{sine:m,cosine:_}=t.get(c),{sine:o,cosine:b}=t.get(u);return m.isGreaterThanOrEqualTo(0)&&o.isGreaterThanOrEqualTo(0)?_.isLessThan(b)?1:_.isGreaterThan(b)?-1:0:m.isLessThan(0)&&o.isLessThan(0)?_.isLessThan(b)?-1:_.isGreaterThan(b)?1:0:o.isLessThan(m)?-1:o.isGreaterThan(m)?1:0}}},nU=class ew{events;poly;_isExteriorRing;_enclosingRing;static factory(e){const t=[];for(let i=0,c=e.length;i<c;i++){const u=e[i];if(!u.isInResult()||u.ringOut)continue;let m=null,_=u.leftSE,o=u.rightSE;const b=[_],I=_.point,M=[];for(;m=_,_=o,b.push(_),_.point!==I;)for(;;){const V=_.getAvailableLinkedEvents();if(V.length===0){const se=b[0].point,fe=b[b.length-1].point;throw new Error(`Unable to complete output ring starting at [${se.x}, ${se.y}]. Last matching segment found ends at [${fe.x}, ${fe.y}].`)}if(V.length===1){o=V[0].otherSE;break}let k=null;for(let se=0,fe=M.length;se<fe;se++)if(M[se].point===_.point){k=se;break}if(k!==null){const se=M.splice(k)[0],fe=b.splice(se.index);fe.unshift(fe[0].otherSE),t.push(new ew(fe.reverse()));continue}M.push({index:b.length,point:_.point});const ie=_.getLeftmostComparator(m);o=V.sort(ie)[0].otherSE;break}t.push(new ew(b))}return t}constructor(e){this.events=e;for(let t=0,i=e.length;t<i;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const t=[e];for(let b=1,I=this.events.length-1;b<I;b++){const M=this.events[b].point,V=this.events[b+1].point;Lp.orient(M,e,V)!==0&&(t.push(M),e=M)}if(t.length===1)return null;const i=t[0],c=t[1];Lp.orient(i,e,c)===0&&t.shift(),t.push(t[0]);const u=this.isExteriorRing()?1:-1,m=this.isExteriorRing()?0:t.length-1,_=this.isExteriorRing()?t.length:-1,o=[];for(let b=m;b!=_;b+=u)o.push([t[b].x.toNumber(),t[b].y.toNumber()]);return o}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let c=1,u=this.events.length;c<u;c++){const m=this.events[c];kf.compare(e,m)>0&&(e=m)}let t=e.segment.prevInResult(),i=t?t.prevInResult():null;for(;;){if(!t)return null;if(!i)return t.ringOut;if(i.ringOut!==t.ringOut)return i.ringOut?.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut?.enclosingRing();t=i.prevInResult(),i=t?t.prevInResult():null}}},PA=class{exteriorRing;interiorRings;constructor(n){this.exteriorRing=n,n.poly=this,this.interiorRings=[]}addInterior(n){this.interiorRings.push(n),n.poly=this}getGeom(){const n=this.exteriorRing.getGeom();if(n===null)return null;const e=[n];for(let t=0,i=this.interiorRings.length;t<i;t++){const c=this.interiorRings[t].getGeom();c!==null&&e.push(c)}return e}},rU=class{rings;polys;constructor(n){this.rings=n,this.polys=this._composePolys(n)}getGeom(){const n=[];for(let e=0,t=this.polys.length;e<t;e++){const i=this.polys[e].getGeom();i!==null&&n.push(i)}return n}_composePolys(n){const e=[];for(let t=0,i=n.length;t<i;t++){const c=n[t];if(!c.poly)if(c.isExteriorRing())e.push(new PA(c));else{const u=c.enclosingRing();u?.poly||e.push(new PA(u)),u?.poly?.addInterior(c)}}return e}},iU=class{queue;tree;segments;constructor(n,e=Fv.compare){this.queue=n,this.tree=new Nv(e),this.segments=[]}process(n){const e=n.segment,t=[];if(n.consumedBy)return n.isLeft?this.queue.delete(n.otherSE):this.tree.delete(e),t;n.isLeft&&this.tree.add(e);let i=e,c=e;do i=this.tree.lastBefore(i);while(i!=null&&i.consumedBy!=null);do c=this.tree.firstAfter(c);while(c!=null&&c.consumedBy!=null);if(n.isLeft){let u=null;if(i){const _=i.getIntersection(e);if(_!==null&&(e.isAnEndpoint(_)||(u=_),!i.isAnEndpoint(_))){const o=this._splitSafely(i,_);for(let b=0,I=o.length;b<I;b++)t.push(o[b])}}let m=null;if(c){const _=c.getIntersection(e);if(_!==null&&(e.isAnEndpoint(_)||(m=_),!c.isAnEndpoint(_))){const o=this._splitSafely(c,_);for(let b=0,I=o.length;b<I;b++)t.push(o[b])}}if(u!==null||m!==null){let _=null;u===null?_=m:m===null?_=u:_=kf.comparePoints(u,m)<=0?u:m,this.queue.delete(e.rightSE),t.push(e.rightSE);const o=e.split(_);for(let b=0,I=o.length;b<I;b++)t.push(o[b])}t.length>0?(this.tree.delete(e),t.push(n)):(this.segments.push(e),e.prev=i)}else{if(i&&c){const u=i.getIntersection(c);if(u!==null){if(!i.isAnEndpoint(u)){const m=this._splitSafely(i,u);for(let _=0,o=m.length;_<o;_++)t.push(m[_])}if(!c.isAnEndpoint(u)){const m=this._splitSafely(c,u);for(let _=0,o=m.length;_<o;_++)t.push(m[_])}}}this.tree.delete(e)}return t}_splitSafely(n,e){this.tree.delete(n);const t=n.rightSE;this.queue.delete(t);const i=n.split(e);return i.push(t),n.consumedBy===void 0&&this.tree.add(n),i}},oU=class{type;numMultiPolys;run(n,e,t){Fy.type=n;const i=[new RA(e,!0)];for(let b=0,I=t.length;b<I;b++)i.push(new RA(t[b],!1));if(Fy.numMultiPolys=i.length,Fy.type==="difference"){const b=i[0];let I=1;for(;I<i.length;)Q5(i[I].bbox,b.bbox)!==null?I++:i.splice(I,1)}if(Fy.type==="intersection")for(let b=0,I=i.length;b<I;b++){const M=i[b];for(let V=b+1,k=i.length;V<k;V++)if(Q5(M.bbox,i[V].bbox)===null)return[]}const c=new Nv(kf.compare);for(let b=0,I=i.length;b<I;b++){const M=i[b].getSweepEvents();for(let V=0,k=M.length;V<k;V++)c.add(M[V])}const u=new iU(c);let m=null;for(c.size!=0&&(m=c.first(),c.delete(m));m;){const b=u.process(m);for(let I=0,M=b.length;I<M;I++){const V=b[I];V.consumedBy===void 0&&c.add(V)}c.size!=0?(m=c.first(),c.delete(m)):m=null}Lp.reset();const _=nU.factory(u.segments);return new rU(_).getGeom()}},Fy=new oU,tw=Fy,sU=0,Fv=class iv{id;leftSE;rightSE;rings;windings;ringOut;consumedBy;prev;_prevInResult;_beforeState;_afterState;_isInResult;static compare(e,t){const i=e.leftSE.point.x,c=t.leftSE.point.x,u=e.rightSE.point.x,m=t.rightSE.point.x;if(m.isLessThan(i))return 1;if(u.isLessThan(c))return-1;const _=e.leftSE.point.y,o=t.leftSE.point.y,b=e.rightSE.point.y,I=t.rightSE.point.y;if(i.isLessThan(c)){if(o.isLessThan(_)&&o.isLessThan(b))return 1;if(o.isGreaterThan(_)&&o.isGreaterThan(b))return-1;const M=e.comparePoint(t.leftSE.point);if(M<0)return 1;if(M>0)return-1;const V=t.comparePoint(e.rightSE.point);return V!==0?V:-1}if(i.isGreaterThan(c)){if(_.isLessThan(o)&&_.isLessThan(I))return-1;if(_.isGreaterThan(o)&&_.isGreaterThan(I))return 1;const M=t.comparePoint(e.leftSE.point);if(M!==0)return M;const V=e.comparePoint(t.rightSE.point);return V<0?1:V>0?-1:1}if(_.isLessThan(o))return-1;if(_.isGreaterThan(o))return 1;if(u.isLessThan(m)){const M=t.comparePoint(e.rightSE.point);if(M!==0)return M}if(u.isGreaterThan(m)){const M=e.comparePoint(t.rightSE.point);if(M<0)return 1;if(M>0)return-1}if(!u.eq(m)){const M=b.minus(_),V=u.minus(i),k=I.minus(o),ie=m.minus(c);if(M.isGreaterThan(V)&&k.isLessThan(ie))return 1;if(M.isLessThan(V)&&k.isGreaterThan(ie))return-1}return u.isGreaterThan(m)?1:u.isLessThan(m)||b.isLessThan(I)?-1:b.isGreaterThan(I)?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,i,c){this.id=++sU,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=i,this.windings=c}static fromRing(e,t,i){let c,u,m;const _=kf.comparePoints(e,t);if(_<0)c=e,u=t,m=1;else if(_>0)c=t,u=e,m=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const o=new kf(c,!0),b=new kf(u,!1);return new iv(o,b,[i],[m])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e.isLessThan(t)?e:t},ur:{x:this.rightSE.point.x,y:e.isGreaterThan(t)?e:t}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(e){return e.x.eq(this.leftSE.point.x)&&e.y.eq(this.leftSE.point.y)||e.x.eq(this.rightSE.point.x)&&e.y.eq(this.rightSE.point.y)}comparePoint(e){return Lp.orient(this.leftSE.point,e,this.rightSE.point)}getIntersection(e){const t=this.bbox(),i=e.bbox(),c=Q5(t,i);if(c===null)return null;const u=this.leftSE.point,m=this.rightSE.point,_=e.leftSE.point,o=e.rightSE.point,b=Iy(t,_)&&this.comparePoint(_)===0,I=Iy(i,u)&&e.comparePoint(u)===0,M=Iy(t,o)&&this.comparePoint(o)===0,V=Iy(i,m)&&e.comparePoint(m)===0;if(I&&b)return V&&!M?m:!V&&M?o:null;if(I)return M&&u.x.eq(o.x)&&u.y.eq(o.y)?null:u;if(b)return V&&m.x.eq(_.x)&&m.y.eq(_.y)?null:_;if(V&&M)return null;if(V)return m;if(M)return o;const k=tU(u,this.vector(),_,e.vector());return k===null||!Iy(c,k)?null:Lp.snap(k)}split(e){const t=[],i=e.events!==void 0,c=new kf(e,!0),u=new kf(e,!1),m=this.rightSE;this.replaceRightSE(u),t.push(u),t.push(c);const _=new iv(c,m,this.rings.slice(),this.windings.slice());return kf.comparePoints(_.leftSE.point,_.rightSE.point)>0&&_.swapEvents(),kf.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(c.checkForConsuming(),u.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,i=this.windings.length;t<i;t++)this.windings[t]*=-1}consume(e){let t=this,i=e;for(;t.consumedBy;)t=t.consumedBy;for(;i.consumedBy;)i=i.consumedBy;const c=iv.compare(t,i);if(c!==0){if(c>0){const u=t;t=i,i=u}if(t.prev===i){const u=t;t=i,i=u}for(let u=0,m=i.rings.length;u<m;u++){const _=i.rings[u],o=i.windings[u],b=t.rings.indexOf(_);b===-1?(t.rings.push(_),t.windings.push(o)):t.windings[b]+=o}i.rings=null,i.windings=null,i.consumedBy=t,i.leftSE.consumedBy=t.leftSE,i.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,i=this._afterState.windings,c=this._afterState.multiPolys;for(let _=0,o=this.rings.length;_<o;_++){const b=this.rings[_],I=this.windings[_],M=t.indexOf(b);M===-1?(t.push(b),i.push(I)):i[M]+=I}const u=[],m=[];for(let _=0,o=t.length;_<o;_++){if(i[_]===0)continue;const b=t[_],I=b.poly;if(m.indexOf(I)===-1)if(b.isExterior)u.push(I);else{m.indexOf(I)===-1&&m.push(I);const M=u.indexOf(b.poly);M!==-1&&u.splice(M,1)}}for(let _=0,o=u.length;_<o;_++){const b=u[_].multiPoly;c.indexOf(b)===-1&&c.push(b)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(tw.type){case"union":{const i=e.length===0,c=t.length===0;this._isInResult=i!==c;break}case"intersection":{let i,c;e.length<t.length?(i=e.length,c=t.length):(i=t.length,c=e.length),this._isInResult=c===tw.numMultiPolys&&i<c;break}case"xor":{const i=Math.abs(e.length-t.length);this._isInResult=i%2===1;break}case"difference":{const i=c=>c.length===1&&c[0].isSubject;this._isInResult=i(e)!==i(t);break}}return this._isInResult}},kA=class{poly;isExterior;segments;bbox;constructor(n,e,t){if(!Array.isArray(n)||n.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=t,this.segments=[],typeof n[0][0]!="number"||typeof n[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const i=Lp.snap({x:new Of(n[0][0]),y:new Of(n[0][1])});this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};let c=i;for(let u=1,m=n.length;u<m;u++){if(typeof n[u][0]!="number"||typeof n[u][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const _=Lp.snap({x:new Of(n[u][0]),y:new Of(n[u][1])});_.x.eq(c.x)&&_.y.eq(c.y)||(this.segments.push(Fv.fromRing(c,_,this)),_.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=_.x),_.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=_.y),_.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=_.x),_.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=_.y),c=_)}(!i.x.eq(c.x)||!i.y.eq(c.y))&&this.segments.push(Fv.fromRing(c,i,this))}getSweepEvents(){const n=[];for(let e=0,t=this.segments.length;e<t;e++){const i=this.segments[e];n.push(i.leftSE),n.push(i.rightSE)}return n}},aU=class{multiPoly;exteriorRing;interiorRings;bbox;constructor(n,e){if(!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new kA(n[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let t=1,i=n.length;t<i;t++){const c=new kA(n[t],this,!1);c.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=c.bbox.ll.x),c.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=c.bbox.ll.y),c.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=c.bbox.ur.x),c.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=c.bbox.ur.y),this.interiorRings.push(c)}this.multiPoly=e}getSweepEvents(){const n=this.exteriorRing.getSweepEvents();for(let e=0,t=this.interiorRings.length;e<t;e++){const i=this.interiorRings[e].getSweepEvents();for(let c=0,u=i.length;c<u;c++)n.push(i[c])}return n}},RA=class{isSubject;polys;bbox;constructor(n,e){if(!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof n[0][0][0]=="number"&&(n=[n])}catch{}this.polys=[],this.bbox={ll:{x:new Of(Number.POSITIVE_INFINITY),y:new Of(Number.POSITIVE_INFINITY)},ur:{x:new Of(Number.NEGATIVE_INFINITY),y:new Of(Number.NEGATIVE_INFINITY)}};for(let t=0,i=n.length;t<i;t++){const c=new aU(n[t],this);c.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=c.bbox.ll.x),c.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=c.bbox.ll.y),c.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=c.bbox.ur.x),c.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=c.bbox.ur.y),this.polys.push(c)}this.isSubject=e}getSweepEvents(){const n=[];for(let e=0,t=this.polys.length;e<t;e++){const i=this.polys[e].getSweepEvents();for(let c=0,u=i.length;c<u;c++)n.push(i[c])}return n}},lU=(n,...e)=>tw.run("intersection",n,e);Lp.set;function L3(n,e,t,i={}){const c=e<0;let u=g8(Math.abs(e),i.units,"meters");c&&(u=-Math.abs(u));const m=Qh(n),_=cU(m,u,t);return _[0]+=_[0]-m[0]>180?-360:m[0]-_[0]>180?360:0,ms(_,i.properties)}function cU(n,e,t,i){i=i===void 0?Ku:Number(i);const c=e/i,u=n[0]*Math.PI/180,m=_d(n[1]),_=_d(t),o=c*Math.cos(_);let b=m+o;Math.abs(b)>Math.PI/2&&(b=b>0?Math.PI-b:-Math.PI-b);const I=Math.log(Math.tan(b/2+Math.PI/4)/Math.tan(m/2+Math.PI/4)),M=Math.abs(I)>1e-11?o/I:Math.cos(m),V=c*Math.sin(_)/M;return[((u+V)*180/Math.PI+540)%360-180,b*180/Math.PI]}function P8(n,e,t={}){const i=Qh(n),c=Qh(e);c[0]+=c[0]-i[0]>180?-360:i[0]-c[0]>180?360:0;const u=uU(i,c);return g8(u,"meters",t.units)}function uU(n,e,t){t=t===void 0?Ku:Number(t);const i=t,c=n[1]*Math.PI/180,u=e[1]*Math.PI/180,m=u-c;let _=Math.abs(e[0]-n[0])*Math.PI/180;_>Math.PI&&(_-=2*Math.PI);const o=Math.log(Math.tan(u/2+Math.PI/4)/Math.tan(c/2+Math.PI/4)),b=Math.abs(o)>1e-11?m/o:Math.cos(c);return Math.sqrt(m*m+b*b*_*_)*i}function Yh(n,e,t){if(t=t||{},!A3(t))throw new Error("options is invalid");const i=t.pivot,c=t.mutate;if(!n)throw new Error("geojson is required");if(e==null||isNaN(e))throw new Error("angle is required");if(e===0)return n;const u=i??Ml(n);return(c===!1||c===void 0)&&(n=I3(n)),ym(n,function(m){const o=_8(u,m)+e,b=P8(u,m),I=T3(L3(u,b,o));m[0]=I[0],m[1]=I[1]}),n}function k8(n,e={}){const t=[];if(v8(n,c=>{t.push(c.coordinates)}),t.length<2)throw new Error("Must specify at least 2 geometries");const i=lU(t[0],...t.slice(1));return i.length===0?null:i.length===1?S3(i[0],e.properties):hj(i,e.properties)}function cg(n,e,t){if(t=t||{},!A3(t))throw new Error("options is invalid");const i=t.origin||"centroid",c=t.mutate||!1;if(!n)throw new Error("geojson required");if(typeof e!="number"||e<=0)throw new Error("invalid factor");const u=Array.isArray(i)||typeof i=="object";return c!==!0&&(n=I3(n)),n.type==="FeatureCollection"&&!u?(mj(n,function(m,_){n.features[_]=MA(m,e,i)}),n):MA(n,e,i)}function MA(n,e,t){const i=y8(n)==="Point",c=hU(n,t);return e===1||i||(ym(n,function(u){const m=P8(c,u),_=_8(c,u),o=m*e,b=T3(L3(c,o,_));u[0]=b[0],u[1]=b[1],u.length===3&&(u[2]*=e)}),delete n.bbox),n}function hU(n,e){if(e==null&&(e="centroid"),Array.isArray(e)||typeof e=="object")return Qh(e);const t=n.bbox?n.bbox:Cu(n,{recompute:!0}),i=t[0],c=t[1],u=t[2],m=t[3];switch(e){case"sw":case"southwest":case"westsouth":case"bottomleft":return ms([i,c]);case"se":case"southeast":case"eastsouth":case"bottomright":return ms([u,c]);case"nw":case"northwest":case"westnorth":case"topleft":return ms([i,m]);case"ne":case"northeast":case"eastnorth":case"topright":return ms([u,m]);case"center":return Lj(n);case void 0:case null:case"centroid":return Ml(n);default:throw new Error("invalid origin")}}function Ym(n,e,t,i){if(i=i||{},!A3(i))throw new Error("options is invalid");var c=i.units,u=i.zTranslation,m=i.mutate;if(!n)throw new Error("geojson is required");if(e==null||isNaN(e))throw new Error("distance is required");if(u&&typeof u!="number"&&isNaN(u))throw new Error("zTranslation is not a number");if(u=u!==void 0?u:0,e===0&&u===0)return n;if(t==null||isNaN(t))throw new Error("direction is required");return e<0&&(e=-e,t=t+180),(m===!1||m===void 0)&&(n=I3(n)),ym(n,function(_){var o=T3(L3(_,e,t,{units:c}));_[0]=o[0],_[1]=o[1],u&&_.length===3&&(_[2]+=u)}),n}function tu(n){return String(n??"").trim().toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,"")||"na"}function pp(n){return tu(n)}function Na(n){return tu(n)}function Jd(...n){if(!n?.length)return"na";const e=n.flatMap(t=>Array.isArray(t)?t:[t]).map(t=>t==null?"":String(t)).map(t=>t.trim()).filter(Boolean);if(!e.length)return"na";if(e.length===1){const t=e[0];return t.match(/^\d+$/)?t:tu(t)}return tu(e.join("_"))}const P3={"Academic Support":"#f68a69",Admissions:"#b3b3b3","Admin-General":"#dcf4b4","Alumni & Foundation":"#4CAF50",Art:"#ea0ea0",Athletics:"#ea550a",Biology:"#17becf","Bronco Blend":"#5a4b22","Business Economics":"#d77cf8","Business Office":"#C44E52","Career Services":"#ff7f50",Chaplain:"#7B7F9E",Chemistry:"#f24516",Classroom:"#c20583",CFO:"#789051",CIO:"#2282bd",Communication:"#109014","Creighton Coll of Nursing":"#76C7C0","Digital Art":"#ffb347",Esports:"#00B894",Facilities:"#2CA02C","Financial Aid":"#8C564B",Forensics:"#aef2e1","Health Center":"#f50909","History, Religion, Philosophy":"#649515",Housing:"#f54d4d",HR:"#3498DB",IR:"#3b580e",IT:"#836377","Languages & Literatures":"#4a64b9",Library:"#079c29","Maintenance & Facilities":"#a6a6a6",Math:"#427b75",Music:"#9467bd",Offline:"#515250",OMC:"#9273f7",Open:"#95A5A6","Physical Education":"#a6d854",PM:"#d7a0fa","President Office":"#d884d8",Psychology:"#2bf087",Registrar:"#F1C40F","Service Learning/Chaplain":"#66c2a5","Student Accounts":"#86e6ed","Student Engagement":"#1584ed","Student Union":"#7cb0ef","Teacher Education":"#2E86AB",Theatre:"#f1374c",Unknown:"#8d776c",VPAA:"#1568f9","VPAA - Academic Admin":"#dde80d",Physics:"#ff24ab"},NA=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"];function dU(n){let e=0;for(let t=0;t<n.length;t++)e=e*31+n.charCodeAt(t)>>>0;return e}function ef(n){if(!n)return"#AAAAAA";const e=P3[n];if(e)return e;const t=dU(n)%NA.length;return NA[t]}function DA(n){const e=n||{},t=Array.isArray(e.features)?e.features:[];let i=0,c=0,u=0,m=0;const _=new Map;for(const I of t){const M=I.properties||{},V=M.__areaSf??M.Area_SF??M.Area_SF??M.area??M.Area??M.SF??M["Area (SF)"]??M.NetArea??0,k=Number(V);if(!Number.isFinite(k)||k<=0)continue;c+=1,i+=k;const ie=String(M.__roomType??M.NCES_Type??"").trim(),se=M.Name??M.Room??M["Room Name"]??"",fe=String(se).toUpperCase(),J=ie.toUpperCase();(J.includes("CLASSROOM")||J.includes("LECTURE")||fe.includes("CLASSROOM")||fe.includes("LECTURE"))&&(m+=1,u+=k);const me=M.__dept??M.NCES_Department??M.NCES_Department??M.NCES_Dept??M["NCES Dept"]??M.department??M.Department??M.Dept??"",ue=String(me).trim();ue&&_.set(ue,(_.get(ue)||0)+k)}const o=Array.from(_.entries()).sort((I,M)=>M[1]-I[1]).slice(0,12).map(([I,M])=>({name:I,sf:M,color:ef(I)})),b=Object.fromEntries(_);return{totalSf:i,rooms:c,classroomSf:u,classroomCount:m,totalsByDept:b,keyDepts:o}}const fU=n=>Number.isFinite(n)?Math.max(0,Math.min(n,100)):null,pU=n=>Number.isFinite(n)?`${Math.round(n)}%`:"--",FA=({label:n,value:e,color:t,compact:i})=>{if(!Number.isFinite(e))return Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8,alignItems:"center"},children:[Y.jsx("div",{style:{fontSize:i?11:12,color:"#344054"},children:n}),Y.jsx("div",{style:{fontSize:i?11:12,color:"#667085"},children:"--"})]});const c=fU(e),u=i?6:8;return Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8,alignItems:"center"},children:[Y.jsxs("div",{children:[Y.jsx("div",{style:{fontSize:i?11:12,color:"#344054",marginBottom:3},children:n}),Y.jsx("div",{style:{height:u,background:"#e4e7ec",borderRadius:999,overflow:"hidden"},children:Y.jsx("div",{style:{width:`${c}%`,height:"100%",background:t}})})]}),Y.jsx("div",{style:{fontSize:i?11:12,color:"#475467",fontWeight:600},children:pU(e)})]})};function R8({timePct:n,seatPct:e,compact:t=!1}){return Number.isFinite(n)||Number.isFinite(e)?Y.jsxs("div",{style:{display:"grid",gap:t?6:10},children:[Y.jsx(FA,{label:"Time Utilization",value:n,color:"#3b82f6",compact:t}),Y.jsx(FA,{label:"Seat Utilization",value:e,color:"#f59e0b",compact:t})]}):null}function mU({buildingName:n,stats:e,keyDepts:t=[],floors:i=[],selectedFloor:c,onChangeFloor:u,onLoadFloorplan:m,onClose:_,onExportPDF:o,onExportCSV:b,onExplainBuilding:I,explainBuildingLoading:M=!1,explainBuildingDisabled:V=!1,explainBuildingError:k="",utilization:ie,dragHandleProps:se}){const fe=pe=>Number.isFinite(pe)?Math.round(pe).toLocaleString():"-",J=pe=>Number.isFinite(pe)?Number(pe).toLocaleString():"-",ne=!!se,{style:me,...ue}=se||{},ke=ie&&(Number.isFinite(ie.timeUtilization)||Number.isFinite(ie.seatUtilization)),je={display:"flex",justifyContent:"space-between",alignItems:"center",paddingRight:6,...ne?{cursor:"grab",userSelect:"none",touchAction:"none"}:{},...me||{}};return Y.jsxs("div",{style:{minWidth:320,maxWidth:360,padding:12,fontSize:13},children:[Y.jsxs("div",{style:je,...ue,children:[Y.jsx("div",{style:{fontWeight:700},children:n}),Y.jsx("button",{onClick:_,"aria-label":"Close",style:{marginRight:4},children:""})]}),Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(0, 1fr) minmax(0, 1fr)",gap:8,marginTop:8},children:[Y.jsxs("div",{children:[Y.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"BUILDING TOTALS"}),Y.jsxs("div",{children:[Y.jsx("b",{children:"Total SF:"})," ",fe(e?.totalSf)]}),Y.jsxs("div",{children:[Y.jsx("b",{children:"Rooms:"})," ",J(e?.rooms)]}),Y.jsxs("div",{children:[Y.jsx("b",{children:"Classroom SF:"})," ",fe(e?.classroomSf)]}),Y.jsxs("div",{children:[Y.jsx("b",{children:"Classrooms:"})," ",J(e?.classroomCount)]}),Y.jsxs("div",{children:[Y.jsx("b",{children:"Levels:"})," ",i?.length??0]})]}),Y.jsxs("div",{children:[Y.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"Key Departments"}),t.length===0?Y.jsx("div",{style:{color:"#666"},children:""}):t.map(pe=>Y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4,fontSize:12,lineHeight:1.25},children:[Y.jsx("div",{style:{width:14,height:14,borderRadius:3,background:ef(pe.name),border:"1px solid #999"}}),Y.jsxs("div",{style:{flex:1},children:[pe.name," ",Number.isFinite(pe.areaSf||pe.Area||pe.sf)?` (${Math.round(pe.areaSf||pe.Area||pe.sf).toLocaleString()} SF)`:""]})]},pe.name))]})]}),ke?Y.jsxs("div",{style:{marginTop:10},children:[Y.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"Classroom Utilization"}),Y.jsx(R8,{timePct:ie.timeUtilization,seatPct:ie.seatUtilization,compact:!0})]}):null,Y.jsxs("div",{style:{marginTop:12,display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[Y.jsx("div",{children:Y.jsx("b",{children:"Floor"})}),Y.jsx("select",{value:c??"",onChange:pe=>u?.(pe.target.value),children:i.map(pe=>Y.jsx("option",{value:pe,children:pe},pe))}),Y.jsx("button",{className:"btn primary",onClick:m,children:"Load"}),Y.jsx("button",{className:"btn secondary",onClick:o,children:"Export to PDF"}),Y.jsx("button",{className:"btn",onClick:b,children:"Export CSV"}),Y.jsx("button",{className:"btn",onClick:I,disabled:V||M,children:M?"Explaining...":" Explain this building"})]}),k?Y.jsx("div",{style:{color:"crimson",marginTop:6,fontSize:12},children:k}):null]})}function gU({buildingName:n,floorLabel:e,stats:t,legendItems:i=[],floors:c=[],selectedFloor:u,onChangeFloor:m,onLoadFloorplan:_,onUnloadFloorplan:o,onClose:b,onExportPDF:I,onExportCSV:M,colorMode:V="department",onChangeColorMode:k,legendTitle:ie="Key Departments",legendSelection:se,onLegendClick:fe,onExplainFloor:J,explainLoading:ne=!1,explainDisabled:me=!1,explainError:ue="",moveScenarioMode:ke=!1,onToggleMoveScenarioMode:je,rotateActive:pe=!1,moveActive:U=!1,rotateValue:F=0,scaleValue:q=1,rotateNotice:j="",rotateStored:H=!1,adjustDebugInfo:Z=null,onStartRotate:be,onStartMove:Re,onCancelRotate:Oe,onClearRotate:Ne,onScaleChange:we,onSaveAdjust:Fe,saveAdjustDisabled:nt=!1,dragHandleProps:xe}){const le=ft=>Number.isFinite(ft)?Math.round(ft).toLocaleString():"-",De=ft=>Number.isFinite(ft)?Number(ft).toLocaleString():"-",Be=!!xe,{style:Ye,...rt}=xe||{},mt={display:"flex",justifyContent:"space-between",...Be?{cursor:"grab",userSelect:"none",touchAction:"none"}:{},...Ye||{}};return Y.jsxs("div",{style:{minWidth:340,maxWidth:380,padding:12,fontSize:13},children:[Y.jsxs("div",{style:mt,...rt,children:[Y.jsx("div",{style:{fontWeight:700},children:n}),Y.jsx("button",{onClick:b,"aria-label":"Close",children:""})]}),Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(0, 0.95fr) minmax(0, 1.05fr)",gap:10,marginTop:8},children:[Y.jsxs("div",{children:[Y.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"FLOOR TOTALS"}),Y.jsxs("div",{children:[Y.jsx("b",{children:"Floor:"})," ",e??"-"]}),Y.jsxs("div",{children:[Y.jsx("b",{children:"Total SF:"})," ",le(t?.totalSf)]}),Y.jsxs("div",{children:[Y.jsx("b",{children:"Rooms:"})," ",De(t?.rooms)]}),Y.jsxs("div",{children:[Y.jsx("b",{children:"Classroom SF:"})," ",le(t?.classroomSf)]}),Y.jsxs("div",{children:[Y.jsx("b",{children:"Classrooms:"})," ",De(t?.classroomCount)]})]}),Y.jsxs("div",{children:[Y.jsx("div",{style:{fontWeight:600,marginBottom:6},children:ie}),i.length===0?Y.jsx("div",{style:{color:"#666"},children:""}):Y.jsx("div",{style:{maxHeight:"46vh",overflowY:"auto"},children:i.map(ft=>Y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4,padding:"2px 0",borderRadius:4,cursor:fe?"pointer":"default",background:se===ft.name?"#f0f4ff":"transparent",fontSize:12,lineHeight:1.25},onClick:()=>fe?.(ft.name),children:[Y.jsx("div",{style:{width:14,height:14,borderRadius:3,background:ft.color||ef(ft.name),border:"1px solid #999"}}),Y.jsxs("div",{style:{flex:1},children:[ft.name," ",Number.isFinite(ft.areaSf||ft.Area||ft.sf)?` (${Math.round(ft.areaSf||ft.Area||ft.sf).toLocaleString()} SF)`:""]})]},ft.name))})]})]}),Y.jsxs("div",{style:{marginTop:12,display:"flex",flexDirection:"column",gap:10},children:[Y.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[Y.jsx("div",{children:Y.jsx("b",{children:"Floor"})}),Y.jsx("select",{value:u??"",onChange:ft=>m?.(ft.target.value),children:c.map(ft=>Y.jsx("option",{value:ft,children:ft},ft))}),Y.jsx("button",{className:"btn primary",onClick:_,children:"Load"}),o?Y.jsx("button",{className:"btn",onClick:o,children:"Unload"}):null]}),Y.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginTop:6},children:[Y.jsx("button",{className:"btn secondary",onClick:I,children:"Export to PDF"}),M?Y.jsx("button",{className:"btn",onClick:M,children:"Export CSV"}):null,Y.jsx("button",{className:"btn",onClick:J,disabled:me||ne,children:ne?"Explaining...":" Explain this floor"})]}),ue?Y.jsx("div",{style:{color:"crimson",fontSize:12},children:ue}):null,Y.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[Y.jsx("div",{style:{fontWeight:600},children:"Highlight By"}),Y.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:6},children:[{key:"department",label:"Department"},{key:"type",label:"Type"},{key:"occupancy",label:"Occupancy"}].map(ft=>Y.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,fontSize:13},children:[Y.jsx("input",{type:"radio",name:"highlight-mode",value:ft.key,checked:V===ft.key,onChange:Dt=>k?.(Dt.target.value)}),ft.label]},ft.key))}),je?Y.jsxs("div",{style:{marginTop:6},children:[Y.jsxs("button",{className:"btn",style:{width:"100%",fontWeight:600},onClick:je,children:["Move Scenario Mode ",ke?"ON":"OFF"]}),Y.jsx("div",{style:{marginTop:4,fontSize:11,color:"#555",textAlign:"center"},children:"Click rooms to add/remove them from a what-if scenario. Real data is not changed."})]}):null,be?Y.jsxs("div",{style:{marginTop:10,paddingTop:8,borderTop:"1px solid #e5e5e5"},children:[Y.jsx("div",{style:{fontWeight:600},children:"Adjust Floorplan"}),Y.jsx("div",{style:{fontSize:12,color:"#555",marginTop:2},children:pe||U?"Drag on the map. Release to save.":"Use Rotate or Move, then drag on the map to adjust rooms + linework together."}),Y.jsxs("div",{style:{fontSize:12,marginTop:2},children:["Rotation: ",Number.isFinite(F)?`${F.toFixed(1)}`:"0","  Scale: ",Number.isFinite(q)?q.toFixed(2):"1.00"]}),Y.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginTop:6},children:[Y.jsx("button",{className:"btn",onClick:pe?Oe:be,children:pe?"Cancel Rotate":"Rotate"}),Re?Y.jsx("button",{className:"btn",onClick:U?Oe:Re,children:U?"Cancel Move":"Move"}):null,we?Y.jsxs(Y.Fragment,{children:[Y.jsx("button",{className:"btn",onClick:()=>we(-.02),children:"- Scale"}),Y.jsx("button",{className:"btn",onClick:()=>we(.02),children:"+ Scale"})]}):null,Fe?Y.jsx("button",{className:"btn primary",onClick:Fe,disabled:nt,children:"Save Adjust"}):null,Ne?Y.jsx("button",{className:"btn",onClick:Ne,disabled:!H,children:"Clear Adjust"}):null]}),j?Y.jsx("div",{style:{color:"crimson",fontSize:12,marginTop:4},children:j}):null,null]}):null]})]})]})}function OA({label:n,value:e,onChange:t,options:i,placeholder:c}){const[u,m]=Nn.useState(!1),[_,o]=Nn.useState(""),b=Nn.useRef(null),I=Nn.useMemo(()=>{const ie=new Set,se=[];return(i||[]).forEach(fe=>{const J=typeof fe=="string"?{value:fe,label:fe}:fe;!J||!J.value||ie.has(J.value)||(ie.add(J.value),se.push({value:J.value,label:J.label??J.value}))}),se},[i]),M=Nn.useMemo(()=>I.find(se=>se.value===e)?.label??e??"",[I,e]),V=Nn.useMemo(()=>{const ie=(_||"").toLowerCase();return ie?I.filter(se=>{const fe=(se.label??"").toLowerCase(),J=(se.value??"").toLowerCase();return fe.includes(ie)||J.includes(ie)}):I},[I,_]),k=_||M||"";return Y.jsxs("div",{className:"mf-form-row",style:{position:"relative"},children:[Y.jsx("label",{children:n}),Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8},children:[Y.jsx("input",{ref:b,className:"mf-input",placeholder:c,value:k,onChange:ie=>{const se=ie.target.value;o(se),t?.(se)},onFocus:()=>m(!0)}),Y.jsx("button",{type:"button",className:"mf-input",style:{width:34,padding:0,display:"grid",placeItems:"center"},onClick:()=>{m(ie=>{const se=!ie;return se&&b.current?.focus(),se})},title:"Toggle options",children:""})]}),u&&Y.jsx("div",{style:{position:"absolute",zIndex:9999,left:0,right:0,top:"100%",background:"#fff",border:"1px solid #ddd",borderRadius:8,maxHeight:240,overflow:"auto",marginTop:6,boxShadow:"0 8px 24px rgba(0,0,0,.12)"},onMouseDown:ie=>ie.preventDefault(),children:V.length===0?Y.jsx("div",{style:{padding:10,color:"#777"},children:"No matches"}):V.map(ie=>Y.jsx("div",{style:{padding:"8px 10px",cursor:"pointer"},onClick:()=>{t?.(ie.value),o(""),m(!1)},children:ie.label},ie.value))})]})}function k1(n,e=8){if(!n)return[];const t=Object.entries(n);return t.sort((i,c)=>(c[1]||0)-(i[1]||0)),t.slice(0,e).map(([i,c])=>({name:i,areaSf:c}))}const yU=n=>{const e=Number(n||0);return Number.isFinite(e)?Math.round(e).toLocaleString():"0"},_U=({label:n,value:e})=>Y.jsxs("div",{style:{background:"#f9fafb",border:"1px solid #e4e7ec",borderRadius:8,padding:8},children:[Y.jsx("div",{style:{fontSize:10,textTransform:"uppercase",letterSpacing:.4,color:"#667085"},children:n}),Y.jsx("div",{style:{fontSize:16,fontWeight:800,color:"#1d2939"},children:e})]}),Qb=({children:n,style:e})=>Y.jsx("div",{style:{background:"#f9fafb",border:"1px solid #e4e7ec",borderRadius:8,padding:8,...e},children:n}),vU=({pct:n,occupied:e=0,vacant:t=0,unknown:i=0,scopeLabel:c=""})=>{const u=Number.isFinite(n)?Math.max(0,Math.min(1,n)):null,m=-90+(u||0)*180,_=u==null?"--":`${Math.round(u*100)}%`;return Y.jsxs("div",{className:"mf-gauge",children:[Y.jsx("div",{className:"mf-gauge-title",children:"OFFICE OCCUPANCY"}),c?Y.jsx("div",{style:{fontSize:11,color:"#667085",marginTop:-2,marginBottom:6},children:c}):null,Y.jsxs("svg",{width:"170",height:"110",viewBox:"0 0 200 130","aria-label":"Office Occupancy",children:[Y.jsx("path",{d:"M 20 110 A 80 80 0 0 1 80 30",fill:"none",stroke:"#d64545",strokeWidth:"16",strokeLinecap:"round"}),Y.jsx("path",{d:"M 80 30 A 80 80 0 0 1 120 30",fill:"none",stroke:"#f0a23b",strokeWidth:"16",strokeLinecap:"round"}),Y.jsx("path",{d:"M 120 30 A 80 80 0 0 1 180 110",fill:"none",stroke:"#2aa84a",strokeWidth:"16",strokeLinecap:"round"}),Y.jsxs("g",{transform:`translate(100 110) rotate(${m})`,children:[Y.jsx("line",{x1:"0",y1:"0",x2:"0",y2:"-70",stroke:"#222",strokeWidth:"3"}),Y.jsx("circle",{cx:"0",cy:"0",r:"6",fill:"#222"})]}),Y.jsx("text",{x:"20",y:"125",fontSize:"11",fill:"#666",children:"low"}),Y.jsx("text",{x:"92",y:"20",fontSize:"11",fill:"#666",children:"mid"}),Y.jsx("text",{x:"168",y:"125",fontSize:"11",fill:"#666",children:"high"}),Y.jsx("text",{x:"100",y:"90",textAnchor:"middle",fontSize:"16",fontWeight:"700",fill:"#1d2939",children:_})]}),Y.jsxs("div",{className:"mf-gauge-meta",children:[u==null?Y.jsx("div",{className:"muted",children:"No occupancy data"}):Y.jsxs("div",{children:[Y.jsx("b",{children:_})," occupied"]}),Y.jsxs("div",{className:"muted",children:["Occ: ",e," | Vac: ",t," | Unk: ",i]})]})]})},xU=({entries:n=[],maxSlices:e=8})=>{const t=n.slice(0,e),i=n.slice(e).reduce((V,k)=>V+Number(k?.sf||0),0),c=i>0?[...t,{name:"Other",sf:i}]:t,u=c.reduce((V,k)=>V+Number(k?.sf||0),0)||1,m="#94a3b8";let _=0;const o=60,b=60,I=50,M=c.map((V,k)=>{const ie=V?.name||"Unknown",se=Number(V?.sf||0),fe=se/u,J=_+fe*Math.PI*2,ne=o+I*Math.cos(_),me=b+I*Math.sin(_),ue=o+I*Math.cos(J),ke=b+I*Math.sin(J),je=fe>.5?1:0,pe=[`M ${o} ${b}`,`L ${ne} ${me}`,`A ${I} ${I} 0 ${je} 1 ${ue} ${ke}`,"Z"].join(" "),U=ie==="Other"?m:ef(ie);return _=J,{d:pe,name:ie,sf:se,color:U}});return Y.jsxs("div",{className:"mf-pie",children:[Y.jsx("div",{className:"mf-section-title",children:"Departments (SF)"}),Y.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[Y.jsx("svg",{width:"120",height:"120",viewBox:"0 0 120 120","aria-label":"Department share by SF",children:M.map((V,k)=>Y.jsx("path",{d:V.d,fill:V.color,stroke:"#fff",strokeWidth:"1"},k))}),Y.jsx("div",{className:"mf-pie-legend",children:M.slice(0,6).map((V,k)=>Y.jsxs("div",{className:"mf-legend-row",children:[Y.jsx("span",{className:"mf-swatch",style:{background:V.color}}),Y.jsx("span",{className:"mf-legend-name",title:V.name,children:V.name}),Y.jsx("span",{className:"mf-legend-sf",children:Math.round(V.sf).toLocaleString()})]},k))})]})]})};function bU({title:n,metrics:e,loading:t,error:i,scopeLabel:c,utilization:u,utilizationScopeLabel:m,heatmapOn:_,onToggleHeatmap:o}){const b=e?.officeOccupancy||{},I=u&&(Number.isFinite(u.timeUtilization)||Number.isFinite(u.seatUtilization));return Y.jsxs("div",{style:{padding:6,width:"100%",display:"flex",flexDirection:"column",height:"100%"},children:[Y.jsx("div",{style:{fontWeight:800,fontSize:13,marginBottom:6},children:n}),t&&Y.jsx("div",{style:{fontSize:12,color:"#667085"},children:"Loading dashboard..."}),i&&Y.jsx("div",{style:{fontSize:12,color:"#b00020"},children:String(i)}),!t&&!i&&e&&Y.jsxs(Y.Fragment,{children:[Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(0, 1fr) 1.3fr",gap:6},children:[Y.jsx(_U,{label:"Total SF",value:yU(e.totalSf)}),Y.jsx(Qb,{children:Y.jsx(vU,{pct:b.pct,occupied:b.occupied,vacant:b.vacant,unknown:b.unknown,scopeLabel:c})})]}),Y.jsxs("div",{style:{flex:1,overflowY:"auto",paddingRight:4,marginTop:8},children:[Y.jsx(Qb,{children:Y.jsx(xU,{entries:e.byDept||[]})}),I?Y.jsxs(Qb,{style:{marginTop:8},children:[Y.jsx("div",{className:"mf-section-title",children:"Classroom Utilization"}),m?Y.jsx("div",{style:{fontSize:11,color:"#667085",marginTop:-2,marginBottom:6},children:m}):null,Y.jsx(R8,{timePct:u.timeUtilization,seatPct:u.seatUtilization,compact:!0}),Y.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,marginTop:8,fontSize:12},children:[Y.jsx("input",{type:"checkbox",checked:!!_,onChange:M=>o?.(M.target.checked)}),"Classroom Utilization Heat Map"]})]}):null]})]})]})}function M8(n={}){const e=n.area??n.Area??n["Area (SF)"]??n.SF??n.NetArea??n.Area_SF??n.Area_SF??0,t=Number(e);return!Number.isFinite(t)||t<=0?null:t}function k3(n={}){const e=n.occupancyStatus??n["Occupancy Status"]??n.vacancy??n.Vacancy??n.Vacant??n.Occupancy??n.OccupancyStatus??n.Status??"",t=String(e).trim().toUpperCase(),i=typeof e=="string"&&t.length>0||typeof e=="boolean"||typeof e=="number",c=e===!0||t==="VACANT"||t.includes("VACANT")||t.includes("UNOCCUPIED")||t.includes("AVAILABLE"),u=e===!1||t==="OCCUPIED"||t.includes("OCCUPIED");return i?c&&!u?"Vacant":u?"Occupied":"Unknown":(n.occupant??n.Occupant??n.AssignedTo??n.Assignee??"").toString().trim().length>0?"Occupied":"Unknown"}const wU=["Office - Staff","Office - Prof and Admin","Office - Prof & Admin","Office - Prof/Admin","Office - Faculty","Office - Adjunct Faculty","Office - Emeritus Faculty"],N8=n=>String(n||"").toLowerCase().replace(/[^a-z0-9]+/g," ").replace(/\b(and|&)\b/g," ").replace(/\s+/g," ").trim(),SU=new Set(wU.map(N8).filter(Boolean));function EU(n={}){const e=(n.NCES_Type??n.NCES_Type_Desc??n.__roomType??n.RoomTypeName??n.RoomType??n.Type??n.type??"").toString().toLowerCase();return SU.has(N8(e))}function AU(n){const e=Array.isArray(n)?n:Array.isArray(n?.features)?n.features:[];let t=0,i=0,c=0;for(const u of e){const m=u?.properties||{};if(!EU(m))continue;const _=k3(m);_==="Occupied"?t+=1:_==="Vacant"?i+=1:c+=1}return{pct:t+i>0?t/(t+i):null,occupied:t,vacant:i,unknown:c,totalOffices:t+i+c}}function TU(n={}){const e=M8(n);if(!e)return null;const t=(n.NCES_Department??n.department??n.Department??n.Dept??"").toString().trim()||"Unspecified",i=(n.NCES_Type??n.NCES_Type_Desc??n.RoomTypeName??n.RoomType??n.Type??n.type??"").toString().trim()||"Unknown",c=k3(n);return{sf:e,dept:t,type:i,occupancy:c}}function IU(n){const e=Array.isArray(n)?n:Array.isArray(n?.features)?n.features:[];let t=0,i=0,c=0,u=0,m=0,_=0;for(const I of e){const M=I?.properties||{},V=M8(M);if(!V)continue;const k=k3(M);k==="Vacant"?(i+=V,m+=1):k==="Occupied"?(t+=V,u+=1):(c+=V,_+=1)}const o=t+i+c,b=u+m+_;return{totalSF:o,totalRooms:b,occupiedSF:t,vacantSF:i,unknownSF:c,occupiedRooms:u,vacantRooms:m,unknownRooms:_,occupancyRate:o>0?t/o:null}}function CU(n=[]){let e=0,t=0;const i=new Map,c=new Map,u=new Map,m=I=>{const M=String(I||"").trim();if(!M)return!1;const V=M.toUpperCase();return/^rec[a-z0-9]{6,}$/i.test(M)?!1:V!=="UNSPECIFIED"&&V!=="UNKNOWN"&&V!=="N/A"&&V!=="NA"};for(const I of n){const M=TU(I?.properties||{});M&&(t+=1,e+=M.sf,m(M.dept)&&i.set(M.dept,(i.get(M.dept)||0)+M.sf),c.set(M.type,(c.get(M.type)||0)+M.sf),u.set(M.occupancy,(u.get(M.occupancy)||0)+M.sf))}const _=(I,M=10)=>Array.from(I.entries()).map(([V,k])=>({name:V,sf:k})).sort((V,k)=>k.sf-V.sf).slice(0,M),o=IU(n),b=AU(n);return{totalSf:e,roomCount:t,byDept:_(i,10),byType:_(c,10),byOccupancy:_(u,6),occupancySummary:o,officeOccupancy:b}}const LU={},{useRef:So,useEffect:ui,useState:jn,useCallback:nr,useMemo:Wa}=tP,PU="https://github-stakeholder-ai.onrender.com";function D8(){const n="".trim();return n||(typeof window<"u"&&window.location.hostname.includes("github.io")?PU:"")}function kU(){const n=[];for(const[e,t]of Object.entries(P3))n.push(e,t);return["match",["coalesce",["feature-state","department"],["get","department"],["get","Department"],["get","Dept"],["get","NCES_Department"],["get","NCES_Dept"]],...n,"#e6e6e6"]}const RU=n=>{let e=0;for(let t=0;t<n.length;t++)e=e*31+n.charCodeAt(t)>>>0;return e},BA=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],nw=n=>n?String(n).trim().toLowerCase()==="public corridor"?"#D9D9D9":BA[RU(String(n).toLowerCase())%BA.length]:"#CCCCCC";function MU(n){return n?.length?n.map(e=>{const t=e.dept||e.name||e.Dept||e.Department;return t?`<div style="display:flex;align-items:center;gap:8px;margin:3px 0;">
        <span style="width:14px;height:14px;border-radius:3px;background:${ef(t)};border:1px solid #00000022"></span>
        <span>${t}</span>
      </div>`:""}).filter(Boolean).join(""):""}const zA=(n,e,t)=>Math.max(e,Math.min(n,t)),NU=n=>n instanceof Element?!!n.closest('button, a, input, select, textarea, [role="button"]'):!1,Cy=(n,e,t,i)=>{if(n.button!==0||NU(n.target))return;const c=e.current;if(!c||!i)return;const u=i();if(!u)return;n.preventDefault(),n.stopPropagation();const m=c.getBoundingClientRect(),_=n.clientX-m.left,o=n.clientY-m.top,b=8,I=document.body.style.userSelect,M=(ie,se)=>{const fe=ie-u.left-_,J=se-u.top-o,ne=Math.max(b,u.width-m.width-b),me=Math.max(b,u.height-m.height-b);t({x:zA(fe,b,ne),y:zA(J,b,me)})},V=ie=>{M(ie.clientX,ie.clientY)},k=()=>{window.removeEventListener("pointermove",V),window.removeEventListener("pointerup",k),window.removeEventListener("pointercancel",k),document.body.style.userSelect=I};document.body.style.userSelect="none",window.addEventListener("pointermove",V),window.addEventListener("pointerup",k),window.addEventListener("pointercancel",k)},DU=["Classroom - General (111)","Classroom - Lecture Hall","Classroom - Indoor Amphitheater / Auditorium","Classroom - Multipurpose","Classroom - Service","Classroom - Seminar","Classroom - Dist Ed / Interactive","Classroom - Computer","Classroom - Collaborative","Laboratory - Class","Laboratory - Computer (non-scheduled)","Laboratory - Studio","Laboratory - Service","Laboratory - Open (non-scheduled)","Laboratory - Music Practice (non-scheduled)","Laboratory - Special Nonclass","Special Nonclass Lab Svs","Office - Prof and Admin (310)","Office - Staff (311)","Office - Faculty","Office - Adjunct Faculty","Office - Graduate / Post Doc Students","Office - Service","Office - Research / Non-Faculty","Office - Emeritus Faculty","Office - Other","Office - Waiting / Reception","Office - Student / Organization","Office - Pantry / Kitchenette","Office - Lounge / Lunch Room","Office - File Room","Office - Work Room","Office - Mail Room","Office - Vault","Office - Department / Suite Circulation","Office - Conference Room","Office - Conference Room Service","Office - Library / Reference Room","Office - Collaborative Work Space","Library - Study / Collaborative Area","Library / Testing / Study Room Service","Training / Tutorial Room","Library - Resource Room","Library Circulation or Reference","Library - Stack","Library / Testing / Study - Storage","Library - Open Stack, Study Area","Library - Processing Room","Academic Assistance","Academic Testing","Interview Room","Departmental Library","Recreation - Health or Physical Education","Athletics - Intercollegiate Sports","Spectator Seating","Fitness Area","Recreation - Service","Athletics - Intercollegiate Sports Service","Ice Rink","Swimming Pool","Athletics - Locker Room or Shower Area","Media - Multi Media Production","Media - Television Studio","Media - Radio Station","Media - Newspaper or Publications","Media - Service","Clinic - (Non-Health care)","Clinic - Observation Room (Non-Health care)","Clinic - Service (Non-Health care)","Clinic - Interview Room (Non-Health care)","Demonstration","Demonstration Service","Special Use - Other (All Purpose)","Public Performance / Assembly","Auditorium","Multi-Purpose Room","Dressing Room","Checkroom","Assembly Room Service (All Types)","Gallery","Museum","Exhibition / Display","Museum / Display / Exhibit Service","Dining / Food Facility","Vending","Dining / Food Service","Kitchen","Dry Food Storage","Cold Food Storage","Lounge - Public","Lounge - Faculty","Lounge - Staff","Lounge - Student","Lounge - Service","Merchandising","Bookstore","Merchandising Service","Recreation - General Use","Recreation Service - General Use","General - Locker Room","General - Locker Room (All Gender)","General - Locker Room Service","Computing or Networking (Central)","Telecom Room (Central)","Telecom / Audio / Video Room","Server Room","IT / Telecom / Network Service","Shop","Shop Service","Storage Room - Central","Storage Room - General","Vehicle / Equipment Storage","Vehicle / Equipment Storage Service","Central Services","Laundry - Central","Central Service Support","Hazardous Materials","Hazardous Materials Service","Parking Garage","Parking Garage Service","Patient Bedroom","Patient Bedroom Service","Health Care - Nurse Station","Utility Room","Record Room","Health Care - Recovery Room","Health Care - Treatment / Examination","Procedure Room","Health Care - Examining Room","Health Care - Therapy Room","Recreation Room","Health Care - Treatment / Examination Service","Health Care - X-Ray Treatment Room","Pharmacy","Health Care - Miscellaneous Storage","Health Care - Patient Reception","Dorm - Sleep / Study NO Toilet & Bath","Dorm - Bedroom Closet","Dorm - Lounge / Study Room","Dorm - Hallway","Dorm - Living Room","Dorm - Toilet or Bath","Sleep / Study WITH Toilet & Bath","Staff Quarters With Bath","Sleep / Study Service","Residence - Laundry","Residence - Storage Room","Apartment - Whole Building","Apartment - Whole Unit","Apartment - Bedroom","Apartment - Closet","Apartment - Living Room","Apartment - Service","Apartment - Kitchen","Apartment - Hallway","Apartment - Bathroom","Apartment - Storage","House","Rental House","Visiting/Special Residence","Other University Residence","Vacant - Assigned","Inactive Area","Available Unassigned","Alteration or Conversion Area","Unfinished Area","Clear Story (open to below)","Leased to Others","Unknown / No Data","Public Corridor","Non-Public Corridor","Lobby","Stairway","Escalator","Elevators","Vestibule","Ramp","Receiving / Loading Dock","Exterior Space - Covered","Commons Area","Custodial Area","Custodial Storage","Custodial Locker Room","Utility Room","Building Storage","Women's Restroom","Men's Restroom","Single Stall Restroom","Private Restroom","Trash / Recycle Room","Nursing / Lactation Room","Emergency Management Command Room","Mechanical Area","Mechanical Duct / Chase or Shaft Area","Interior Incinerator","Central Utility Plant Facility","Electrical Equipment Area","Structural Area","Storage Room - General","Testing"],R3=["Teacher Education","Business Office","Registrar","VPAA - Academic Admin","Chaplain","Financial Aid","Facilities","HR","Music","Open","Physical Education","Admissions","IT","Library","Student Accounts","Student Engagement","Health Center","Biology","Chemistry","Physics","Psychology","History, Religion, Philosophy","Languages & Literatures","Math","Art","Digital Art","Communication","Academic Support","Athletics","Esports","Forensics","CIO","CFO","President Office","Alumni & Foundation","Business Economics","Classroom","Creighton Coll of Nursing","Admin-General","Bronco Blend"],oa=n=>(n??"").toString().trim(),c0=n=>{if(n==null)return"";if(typeof n=="string"||typeof n=="number")return String(n).trim();if(typeof n=="object"){const e=n.id??n.floorId??n.floor??n.name??n.label??n.value??"";return e!=null?String(e).trim():""}return String(n).trim()},Kg=(n,e)=>{if(!n)return null;const t=typeof n=="object"?n.id??n.buildingId??n.name??n.label??n.value??"":n;return t?e(t):null};function Xy(n={}){return n.Department||n.department||n.Dept||n.NCES_Department||n.NCES_Department||n["Department Owner Text"]||""}function $f(n={},e=[]){if(!n||!Array.isArray(e))return null;for(const t of e){const i=n[t];if(i!=null&&String(i).trim()!=="")return i}return null}function FU(n,e,t){const i=(n||"").toString().trim(),c=oa(e),u=oa(t);return c&&u?`${c} - ${u} ${i}`.trim():c?`${c} ${i}`.trim():i||""}function F8(n,e={}){const t=oa(n);if(!t)return null;const i=oa(e.typeDesc??e.typeLabel??e.typeName),c=FU(i||t,e.categoryCode,e.typeCode)||t;return{value:t,label:c}}function OU(n=[]){const e=new Map;return(n||[]).forEach(t=>{const i=F8(t);i&&e.set(i.value,i)}),Array.from(e.values()).sort((t,i)=>t.label.localeCompare(i.label))}function BU(n=[],e=[]){const t=new Map;return(n||[]).forEach(i=>{i?.value&&t.set(i.value,i)}),(e||[]).forEach(i=>{i?.value&&t.set(i.value,i)}),Array.from(t.values()).sort((i,c)=>i.label.localeCompare(c.label))}function O8(n,e=.35){if(!n)return`rgba(255,165,0,${e})`;const t=n.replace("#","");if(!/^[0-9a-fA-F]+$/.test(t))return`rgba(255,165,0,${e})`;const i=parseInt(t,16);if(Number.isNaN(i))return`rgba(255,165,0,${e})`;const c=i>>16&255,u=i>>8&255,m=i&255;return`rgba(${c},${u},${m},${e})`}function B8(n={}){const e=$f(n,["RoomCategory","Category","CategoryCode","rm_cat","rm_cat_id","NCES_Category","NCES Category","NCES_Category_Code","NCES Category Code"]);return e?String(e).trim():null}function e5(n={}){const e=n.seatCount??n.SeatCount??n["Seat Count"]??n.Seats??n.Capacity??n.rm_seats??n.SeatingCapacity??n["NCES_Seat Count"]??n.NCES_Seat_Count??n["NCES_Seat Count"]??n.NCES_SeatCount??null,t=Number(e);return Number.isFinite(t)&&t>0?t:null}function z8(n){if(!n)return!1;const e=String(n).trim();return e.length>0&&e.startsWith("3")}function zU(n){if(!n)return!1;const t=String(n).trim().charAt(0);return t==="1"||t==="2"}function j8(n={}){const e=$f(n,["RoomType","roomType","Name","type","RoomTypeName","NCES_Type Description_Sh","NCES_Type Description","NCES Type Description","NCES_Type Description_Short"])??"",t=String(e).toLowerCase(),i=t.includes("office"),c=t.includes("classroom")||t.includes("lab")||t.includes("studio");return{norm:t,isOfficeText:i,isTeachingText:c}}function b0(n={}){const e=$f(n,["FeatureClass","featureClass","Layer","layer","Type","type","Feature","feature","Name","name"])??"",t=String(e).toLowerCase();return t.includes("door")||t.includes("entrance")?"door":t.includes("stair")?"stair":"room"}function jU(n){const e=new Map,t=new Set(R3.map(oa)),i=_=>$f(_,["NCES_Category","NCES Category","NCES_Category_Code","NCES Category Code"]),c=_=>$f(_,["NCES_Type","NCES Type","NCES_Type_Code","NCES Type Code"]),u=_=>$f(_,["NCES_Type Description_Sh","NCES_Type Description","NCES Type Description","NCES_Type Description_Short"]),m=(_,o={})=>{const b=F8(_,o);b&&e.set(b.value,b)};for(const _ of n||[]){const o=_.properties||{},b=oa(gd(o)),I=oa(o.department??o.Department??o.Dept),M=i(o),V=c(o),k=u(o);b&&m(b,{categoryCode:M,typeCode:V,typeDesc:k}),I&&t.add(I)}return{typeOptions:Array.from(e.values()).sort((_,o)=>_.label.localeCompare(o.label)),deptOptions:Array.from(t).filter(Boolean).sort()}}function UU(n,e={}){if(!n||!Array.isArray(n.features)||!n.features.length)return null;const t=Cu(n);if(!t||t.some(pe=>!Number.isFinite(pe)))return null;const i=720,c=t[2]-t[0],u=t[3]-t[1];if(c<=0||u<=0)return null;const m=u/c,_=Math.max(260,Math.round(i*Math.max(.33,Math.min(m,2.5)))),o=document.createElement("canvas");o.width=i,o.height=_;const b=o.getContext("2d");b.fillStyle="#ffffff",b.fillRect(0,0,i,_);const I=pe=>{const U=(pe[0]-t[0])/c*i,F=_-(pe[1]-t[1])/u*_;return[U,F]},M=pe=>{if(!Array.isArray(pe))return;b.beginPath();const U=I(pe[0]);b.moveTo(U[0],U[1]);for(let F=1;F<pe.length;F++){const q=I(pe[F]);b.lineTo(q[0],q[1])}b.closePath()},V=pe=>{if(!Array.isArray(pe))return;b.beginPath();const U=I(pe[0]);b.moveTo(U[0],U[1]);for(let F=1;F<pe.length;F++){const q=I(pe[F]);b.lineTo(q[0],q[1])}},k=pe=>oa(pe?.department??pe?.Department??pe?.Dept??"")||"",ie=pe=>{if(Number.isFinite(pe))return pe;const U=Number(pe);return Number.isFinite(U)?U:pe!=null?String(pe):null},se=new Set((e?.selectedIds||[]).map(pe=>ie(pe)).filter(pe=>pe!=null)),fe=e?.solidFill===!0,J=e?.labelOptions||{},ne=J.enabled!==!1,me=J.hideDrawing===!0,ue={font:J.font||'bold 10px "Open Sans", Arial, sans-serif',lineHeight:J.lineHeight||12,maxLines:J.maxLines||4,minWidth:J.minWidth||32,minHeight:J.minHeight||14},ke=(pe,U,F,q)=>{const j=[],H=Z=>{const be=oa(Z);be&&(me&&be.toLowerCase()==="drawing"||j.length>=ue.maxLines||j.push(be))};return H(pe?.Number??pe?.RoomNumber??pe?.number),H(gd(pe)||pe?.Name),H(U||F),q>0&&H(`${Math.round(q).toLocaleString()} SF`),j},je=(pe,U)=>{if(!ne||!U.length)return;const q=Ml(pe)?.geometry?.coordinates;if(!q)return;const j=Cu(pe);if(!j)return;const H=(j[2]-j[0])/c*i,Z=(j[3]-j[1])/u*_,be=ue.lineHeight*U.length;if(H<ue.minWidth||Z<Math.max(be,ue.minHeight))return;const[Re,Oe]=I(q),Ne=ue.lineHeight*U.length,we=Oe-Ne/2+ue.lineHeight/2;b.save(),b.font=ue.font,b.textAlign="center",b.textBaseline="middle",b.lineJoin="round",b.fillStyle="#101010",b.strokeStyle="rgba(255,255,255,0.95)",b.lineWidth=3;for(let Fe=0;Fe<U.length;Fe+=1){const nt=we+Fe*ue.lineHeight;b.strokeText(U[Fe],Re,nt),b.fillText(U[Fe],Re,nt)}b.restore()};for(const pe of n.features){const U=pe?.properties||{},F=b0(U),q=oa(U?.scenarioDepartment??U?.ScenarioDepartment??U?.scenarioDept??""),j=k(U),H=q||j,Z=U?.__roomType||gd(U)||U?.Name||"",be=(U?.occupant??U?.Occupant??"").toString().trim(),Re=e?.colorMode||"department";let Oe="#f7f7f7";Re==="type"?Oe=nw(Z):Re==="occupancy"?Oe=be?"#29b6f6":"#e0e0e0":Re==="vacancy"?Oe=be?"#29b6f6":"#ff7043":Oe=H?ef(H):"#f7f7f7";let Ne=Oe?O8(Oe,fe?1:q?.9:.4):"#f7f7f7",we="#2b2b2b",Fe=F==="room"?2.2:1.5;const nt=ie(pe?.id??U?.RevitId??U?.Revit_UniqueId??U?.RevitUniqueId??U?.Revit_UniqueID??U?.["Revit Unique Id"]??U?.["Room GUID"]??U?.roomGuid??U?.id),xe=nt!=null&&se.has(nt);F==="door"?(Ne="#1d1d1d",we="#0d0d0d",Fe=1.5):F==="stair"?(Ne="#6b6b6b",we="#3a3a3a",Fe=1.5):Oe&&(we="#202020"),xe&&(F==="room"&&(Ne="rgba(0, 200, 255, 0.35)"),we="#00c8ff",Fe=4);const le=pe?.geometry;if(!le||!le.coordinates)continue;const De=(rt,mt)=>{Array.isArray(rt)&&(mt==="Polygon"?(b.fillStyle=Ne,b.strokeStyle=we,b.lineWidth=Fe,rt.forEach(ft=>{M(ft),b.fill(),b.stroke()})):mt==="MultiPolygon"?rt.forEach(ft=>De(ft,"Polygon")):mt==="LineString"?(b.strokeStyle=we,b.lineWidth=F==="door"?2:1.5,V(rt),b.stroke()):mt==="MultiLineString"&&rt.forEach(ft=>De(ft,"LineString")))};De(le.coordinates,le.type);const Be=Number(U?.Area_SF??U?.Area??U?.["Area (SF)"]??U?.Area_sf??U?.NetArea??U?.SF??0),Ye=Number.isFinite(Be)&&Be>0?Be:0;if(F==="room"){const rt=ke(U,q,j,Ye);je(pe,rt)}}return{width:o.width,height:o.height,data:o.toDataURL("image/png")}}function Xg(n={}){const e=n?.fc??n;return e?UU(e,n):null}const gd=(n={})=>{const e=n["Room Type Description"]??n.RoomTypeDescription??n.roomTypeDescription;if(e&&String(e).trim())return String(e).trim();const t=n.NCES_Type??n["NCES Type"]??n["NCES Types"]??n.NCES_Types??n.nces_type??n.ncesType;if(t&&String(t).trim())return String(t).trim();const i=n["NCES_Type Description_Sh"]??n["NCES_Type Description"]??n["NCES Type Description"]??n["NCES_Type Description_Short"]??n["NCES Type Description Short"];return i&&String(i).trim()?String(i).trim():(n["Room Type"]||n.RoomType||n.RoomTypeName||n.Type||n.type||n.Category||n.category||n.Name||n["Room Name"]||"").toString().trim()};function M3(n={}){return(n.NCES_Type??n["NCES Types"]??n.NCES_Types??n.nces_type??n.ncesType??"").toString().trim()}function U8(n={}){return(n.NCES_Department??n.NCES_Department??n.NCES_Dept??n["NCES Dept"]??n.department??n.Department??n.Dept??"").toString().trim()}function V8(n={}){const e=n.Area_SF??n.Area_SF??n.area??n.Area??n.SF??n["Area (SF)"]??n.NetArea??0,t=Number(e);return Number.isFinite(t)?t:0}function VU(n){if(!n?.features?.length)return n;const e=n.features.map(t=>{const i=t?.properties||{};if("__roomType"in i)return t;const c=M3(i),u=c&&String(c).trim();return u?{...t,properties:{...i,__roomType:u}}:t});return{...n,features:e}}function q8(n){if(!n)return null;const e=n.anchor_feet||n.anchorFeet||n.anchor;return[n.target_lon??n.targetLon,n.target_lat??n.targetLat,n.rotation_deg_cw??n.rotation_deg,n.scale_deg_per_foot??n.scale_deg_per_ft??n.scale,Array.isArray(e)?e.join(","):""].map(i=>i==null?"":String(i)).join("|")}const qU="mfDrawingAlign:",Zy=new Map,$8="mfFloorAdjust:",G8="mfFloorAdjustUrl:",H8="mfFloorAdjustFloor:",Yy=new Map,Jy=new Map,Qy=new Map;function N3(n,e){const t=tu(n||""),i=Na(e||"");return`${qU}${t}/${i}`}function xx(n,e){const t=tu(n||""),i=Na(e||"");return`${$8}${t}/${i}`}function bx(n){const e=tu(n||"");return`${G8}${e}`}function wx(n,e){const t=n?Md(n):"",i=tu(t||n||""),c=Na(e||"");return`${H8}${i}/${c}`}function W8(n){return n?[n.rotationDeg,n.scale,Array.isArray(n.pivot)?n.pivot.join(","):"",Array.isArray(n.target)?n.target.join(","):""].map(t=>t==null?"":String(t)).join("|"):null}function K8(n,e){const t=N3(n,e);if(!t)return null;if(Zy.has(t))return Zy.get(t);if(typeof window>"u"||!window.localStorage)return null;try{const i=window.localStorage.getItem(t);if(!i)return null;const c=JSON.parse(i);return!c||!Array.isArray(c.pivot)||!Array.isArray(c.target)?null:(Zy.set(t,c),c)}catch{return null}}function Wm(n,e){const t=xx(n,e);if(!t)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};if(Yy.has(t))return Yy.get(t);if(typeof window>"u"||!window.localStorage)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};try{const i=window.localStorage.getItem(t);if(!i)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};const c=JSON.parse(i),u=Number(c?.rotationDeg),m=Number(c?.scale),_=Array.isArray(c?.translateMeters)?c.translateMeters:[0,0],o=Array.isArray(c?.translateLngLat)?c.translateLngLat:null,b=Number(c?.savedAt),I=Array.isArray(c?.pivot)?c.pivot:null,M=Array.isArray(c?.anchorLngLat)?c.anchorLngLat:null,V={rotationDeg:Number.isFinite(u)?u:0,scale:Number.isFinite(m)&&m>0?m:1,translateMeters:[Number.isFinite(_[0])?_[0]:0,Number.isFinite(_[1])?_[1]:0],translateLngLat:Array.isArray(o)?[Number.isFinite(o[0])?o[0]:0,Number.isFinite(o[1])?o[1]:0]:null,anchorLngLat:Array.isArray(M)?[Number.isFinite(M[0])?M[0]:0,Number.isFinite(M[1])?M[1]:0]:null,savedAt:Number.isFinite(b)?b:0,pivot:Array.isArray(I)&&I.length>=2?I:null};return Yy.set(t,V),V}catch{return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0}}}function Oy(n){const e=bx(n);if(!e)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};if(Jy.has(e))return Jy.get(e);if(typeof window>"u"||!window.localStorage)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};try{const t=window.localStorage.getItem(e);if(!t)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};const i=JSON.parse(t),c=Number(i?.rotationDeg),u=Number(i?.scale),m=Array.isArray(i?.translateMeters)?i.translateMeters:[0,0],_=Array.isArray(i?.translateLngLat)?i.translateLngLat:null,o=Number(i?.savedAt),b=Array.isArray(i?.pivot)?i.pivot:null,I=Array.isArray(i?.anchorLngLat)?i.anchorLngLat:null,M={rotationDeg:Number.isFinite(c)?c:0,scale:Number.isFinite(u)&&u>0?u:1,translateMeters:[Number.isFinite(m[0])?m[0]:0,Number.isFinite(m[1])?m[1]:0],translateLngLat:Array.isArray(_)?[Number.isFinite(_[0])?_[0]:0,Number.isFinite(_[1])?_[1]:0]:null,anchorLngLat:Array.isArray(I)?[Number.isFinite(I[0])?I[0]:0,Number.isFinite(I[1])?I[1]:0]:null,savedAt:Number.isFinite(o)?o:0,pivot:Array.isArray(b)&&b.length>=2?b:null};return Jy.set(e,M),M}catch{return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0}}}function By(n,e){const t=wx(n,e);if(!t)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};if(Qy.has(t))return Qy.get(t);if(typeof window>"u"||!window.localStorage)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};try{const i=window.localStorage.getItem(t);if(!i)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};const c=JSON.parse(i),u=Number(c?.rotationDeg),m=Number(c?.scale),_=Array.isArray(c?.translateMeters)?c.translateMeters:[0,0],o=Array.isArray(c?.translateLngLat)?c.translateLngLat:null,b=Number(c?.savedAt),I=Array.isArray(c?.pivot)?c.pivot:null,M=Array.isArray(c?.anchorLngLat)?c.anchorLngLat:null,V={rotationDeg:Number.isFinite(u)?u:0,scale:Number.isFinite(m)&&m>0?m:1,translateMeters:[Number.isFinite(_[0])?_[0]:0,Number.isFinite(_[1])?_[1]:0],translateLngLat:Array.isArray(o)?[Number.isFinite(o[0])?o[0]:0,Number.isFinite(o[1])?o[1]:0]:null,anchorLngLat:Array.isArray(M)?[Number.isFinite(M[0])?M[0]:0,Number.isFinite(M[1])?M[1]:0]:null,savedAt:Number.isFinite(b)?b:0,pivot:Array.isArray(I)&&I.length>=2?I:null};return Qy.set(t,V),V}catch{return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0}}}function $U(n,e,t){const i=N3(n,e);if(!i||!t||typeof window>"u"||!window.localStorage)return!1;try{return window.localStorage.setItem(i,JSON.stringify(t)),Zy.set(i,t),!0}catch{return!1}}function R1(n,e,t){const i=xx(n,e);if(!i||!t||typeof window>"u"||!window.localStorage)return!1;const c=Array.isArray(t.pivot)?t.pivot:null,u=Array.isArray(t.translateLngLat)?t.translateLngLat:null,m=Array.isArray(t.anchorLngLat)?t.anchorLngLat:null,_={rotationDeg:Number.isFinite(t.rotationDeg)?t.rotationDeg:0,scale:Number.isFinite(t.scale)&&t.scale>0?t.scale:1,translateMeters:Array.isArray(t.translateMeters)?[Number.isFinite(t.translateMeters[0])?t.translateMeters[0]:0,Number.isFinite(t.translateMeters[1])?t.translateMeters[1]:0]:[0,0],translateLngLat:Array.isArray(u)?[Number.isFinite(u[0])?u[0]:0,Number.isFinite(u[1])?u[1]:0]:null,anchorLngLat:Array.isArray(m)?[Number.isFinite(m[0])?m[0]:0,Number.isFinite(m[1])?m[1]:0]:null,savedAt:Date.now(),pivot:Array.isArray(c)&&c.length>=2?c:null};try{return window.localStorage.setItem(i,JSON.stringify(_)),Yy.set(i,_),!0}catch{return!1}}function M1(n,e){const t=bx(n);if(!t||!e||typeof window>"u"||!window.localStorage)return!1;const i=Array.isArray(e.pivot)?e.pivot:null,c=Array.isArray(e.translateLngLat)?e.translateLngLat:null,u=Array.isArray(e.anchorLngLat)?e.anchorLngLat:null,m={rotationDeg:Number.isFinite(e.rotationDeg)?e.rotationDeg:0,scale:Number.isFinite(e.scale)&&e.scale>0?e.scale:1,translateMeters:Array.isArray(e.translateMeters)?[Number.isFinite(e.translateMeters[0])?e.translateMeters[0]:0,Number.isFinite(e.translateMeters[1])?e.translateMeters[1]:0]:[0,0],translateLngLat:Array.isArray(c)?[Number.isFinite(c[0])?c[0]:0,Number.isFinite(c[1])?c[1]:0]:null,anchorLngLat:Array.isArray(u)?[Number.isFinite(u[0])?u[0]:0,Number.isFinite(u[1])?u[1]:0]:null,savedAt:Date.now(),pivot:Array.isArray(i)&&i.length>=2?i:null};try{return window.localStorage.setItem(t,JSON.stringify(m)),Jy.set(t,m),!0}catch{return!1}}function N1(n,e,t){const i=wx(n,e);if(!i||!t||typeof window>"u"||!window.localStorage)return!1;const c=Array.isArray(t.pivot)?t.pivot:null,u=Array.isArray(t.translateLngLat)?t.translateLngLat:null,m=Array.isArray(t.anchorLngLat)?t.anchorLngLat:null,_={rotationDeg:Number.isFinite(t.rotationDeg)?t.rotationDeg:0,scale:Number.isFinite(t.scale)&&t.scale>0?t.scale:1,translateMeters:Array.isArray(t.translateMeters)?[Number.isFinite(t.translateMeters[0])?t.translateMeters[0]:0,Number.isFinite(t.translateMeters[1])?t.translateMeters[1]:0]:[0,0],translateLngLat:Array.isArray(u)?[Number.isFinite(u[0])?u[0]:0,Number.isFinite(u[1])?u[1]:0]:null,anchorLngLat:Array.isArray(m)?[Number.isFinite(m[0])?m[0]:0,Number.isFinite(m[1])?m[1]:0]:null,savedAt:Date.now(),pivot:Array.isArray(c)&&c.length>=2?c:null};try{return window.localStorage.setItem(i,JSON.stringify(_)),Qy.set(i,_),!0}catch{return!1}}function GU(n,e){const t=N3(n,e);if(t&&(Zy.delete(t),!(typeof window>"u"||!window.localStorage)))try{window.localStorage.removeItem(t)}catch{}}function HU(n,e){const t=xx(n,e);if(t&&(Yy.delete(t),!(typeof window>"u"||!window.localStorage)))try{window.localStorage.removeItem(t)}catch{}}function WU(n){const e=bx(n);if(e&&(Jy.delete(e),!(typeof window>"u"||!window.localStorage)))try{window.localStorage.removeItem(e)}catch{}}function KU(n,e){const t=wx(n,e);if(t&&(Qy.delete(t),!(typeof window>"u"||!window.localStorage)))try{window.localStorage.removeItem(t)}catch{}}function XU(n,e){if(!n?.features?.length||!e)return n;const t=W8(e);if(t&&n.__mfDrawingAlignSignature===t)return n;const i=Array.isArray(e.pivot)?e.pivot:null,c=Array.isArray(e.target)?e.target:null;if(!i||!c)return n;const u=Number.isFinite(e.scale)?e.scale:1,_=(Number.isFinite(e.rotationDeg)?e.rotationDeg:0)*Math.PI/180,o=Math.cos(_),b=Math.sin(_),[I,M]=i,[V,k]=c,ie=J=>{const ne=J[0]-I,me=J[1]-M,ue=(ne*o-me*b)*u,ke=(ne*b+me*o)*u;return[V+ue,k+ke]},se=n.features.map(J=>!Fh(J?.properties||{})||!J?.geometry?J:{...J,geometry:{...J.geometry,coordinates:Bf(J.geometry.coordinates,ie)}}),fe={...n,features:se};return t&&(fe.__mfDrawingAlignSignature=t),fe}function Ov({buildingLabel:n,buildingId:e,floorBasePath:t,fitBuilding:i}={}){const c=n||e||i?.properties?.id||i?.properties?.name||"",u=Lf(c)||c;if(u)return u;if(t){const m=Md(t);if(m)return d0?.[m]||m}return""}function ZU({buildingLabel:n,buildingId:e,floorBasePath:t,fitBuilding:i}={}){const c=t?Md(t):null;return c||Ov({buildingLabel:n,buildingId:e,floorBasePath:t,fitBuilding:i})}function Bv(n){return n?[n.rotationDeg,n.scale,Array.isArray(n.translateMeters)?n.translateMeters.join(","):"",Array.isArray(n.translateLngLat)?n.translateLngLat.join(","):"",Array.isArray(n.anchorLngLat)?n.anchorLngLat.join(","):""].map(t=>t==null?"":String(t)).join("|"):null}function mp(n){return n?Math.abs(n.rotationDeg||0)>1e-6||Math.abs((n.scale||1)-1)>1e-6||Math.abs(n.translateMeters?.[0]||0)>1e-6||Math.abs(n.translateMeters?.[1]||0)>1e-6||Math.abs(n.translateLngLat?.[0]||0)>1e-12||Math.abs(n.translateLngLat?.[1]||0)>1e-12||Math.abs(n.anchorLngLat?.[0]||0)>1e-12||Math.abs(n.anchorLngLat?.[1]||0)>1e-12:!1}function rw({base:n,url:e,label:t}){const i=[{source:"basePath",adjust:n},{source:"url",adjust:e},{source:"label",adjust:t}].filter(m=>m.adjust),c=i.filter(m=>mp(m.adjust));if(c.length){let m=null;for(const _ of c){const o=Number(_.adjust?.savedAt)||0;(!m||o>m.savedAt)&&(m={..._,savedAt:o})}if(m)return m}return i.find(m=>m.source==="label")||i[0]||{source:"label",adjust:null,savedAt:0}}function ov(n){if(!n?.features?.length)return null;try{const e=Ml(n)?.geometry?.coordinates||null;return!Array.isArray(e)||e.length<2||!Number.isFinite(e[0])||!Number.isFinite(e[1])?null:e}catch{return null}}function YU(n,e,t){if(!n?.features?.length||!e)return{fc:n,fitTransform:t};const i=Bv(e);if(i&&n.__mfUserAdjustSignature===i)return{fc:n,fitTransform:t};const c=Number.isFinite(e.rotationDeg)?e.rotationDeg:0,u=Number.isFinite(e.scale)?e.scale:1,m=Array.isArray(e.translateMeters)?e.translateMeters:[0,0],_=Array.isArray(e.translateLngLat)?e.translateLngLat:null,o=Array.isArray(e.anchorLngLat)?e.anchorLngLat:null;let b=n;const I=(Array.isArray(e.pivot)?e.pivot:null)||t?.scaleOrigin||t?.rotationPivot||Ml(b)?.geometry?.coordinates||null;if(Number.isFinite(u)&&Math.abs(u-1)>1e-6&&I&&(b=cg(b,u,{origin:I})),Number.isFinite(c)&&Math.abs(c)>1e-6&&I&&(b=Yh(b,c,{pivot:I})),_&&(Math.abs(_[0]||0)>1e-12||Math.abs(_[1]||0)>1e-12)?b=ow(b,_):m&&(Math.abs(m[0]||0)>1e-6||Math.abs(m[1]||0)>1e-6)&&(b=F3(b,m)),o&&Number.isFinite(o[0])&&Number.isFinite(o[1])){const V=ov(b);if(V){const k=o[0]-V[0],ie=o[1]-V[1];(Math.abs(k)>1e-12||Math.abs(ie)>1e-12)&&(b=ow(b,[k,ie]))}}b&&typeof b=="object"&&(b.__mfUserAdjustSignature=i);let M=t;if((Number.isFinite(u)||Number.isFinite(c)||Array.isArray(m))&&(M=M||{rotationDeg:0,rotationPivot:I,scale:1,scaleOrigin:I,translateKm:0,translateBearing:0,nudgeMeters:[0,0],refineRotationDeg:0,refineRotationPivot:I},I&&(Array.isArray(M.rotationPivot)||(M.rotationPivot=I),Array.isArray(M.scaleOrigin)||(M.scaleOrigin=I),Array.isArray(M.refineRotationPivot)||(M.refineRotationPivot=I)),Number.isFinite(u)&&Math.abs(u-1)>1e-6&&(M.scale=(Number.isFinite(M.scale)?M.scale:1)*u),Number.isFinite(c)&&Math.abs(c)>1e-6&&(M.rotationDeg=(Number.isFinite(M.rotationDeg)?M.rotationDeg:0)+c),Array.isArray(m))){const V=Array.isArray(M.nudgeMeters)?M.nudgeMeters:[0,0];M.nudgeMeters=[(Number(V[0])||0)+(Number(m[0])||0),(Number(V[1])||0)+(Number(m[1])||0)]}return{fc:b,fitTransform:M}}function Fh(n={}){return n?String(n.type??n.Type??"").toLowerCase()==="drawing"?!0:n.interactive===!1:!1}function JU(n,e){if(!n?.geometry||!Array.isArray(e))return e;const t=Nd(n.geometry,4e3);if(!t.length)return e;let i=e,c=1/0;for(const[u,m]of t){const _=u-e[0],o=m-e[1],b=_*_+o*o;b<c&&(c=b,i=[u,m])}return i}function QU(n,e=4e3){let t=1/0,i=1/0,c=-1/0,u=-1/0,m=0;const _=o=>{if(!(!Array.isArray(o)||m>=e)){if(o.length>=2&&typeof o[0]=="number"&&typeof o[1]=="number"){const b=o[0],I=o[1];b<t&&(t=b),I<i&&(i=I),b>c&&(c=b),I>u&&(u=I),m+=1;return}o.forEach(_)}};return _(n),m?{minX:t,minY:i,maxX:c,maxY:u}:null}function eV(n,e=.12){if(!n?.features?.length)return n;const t=n.features.filter(J=>!Fh(J?.properties||{}));if(!t.length)return n;let i=1/0,c=1/0,u=-1/0,m=-1/0,_=0;for(const J of t){const ne=Nd(J?.geometry,4e3);for(const[me,ue]of ne)me<i&&(i=me),ue<c&&(c=ue),me>u&&(u=me),ue>m&&(m=ue),_+=1;if(_>2e4)break}if(!_)return n;const o=Math.max(1e-9,u-i),b=Math.max(1e-9,m-c),I=o*e,M=b*e,V=i-I,k=c-M,ie=u+I,se=m+M,fe=[];for(const J of n.features){if(!Fh(J?.properties||{})){fe.push(J);continue}const ne=QU(J?.geometry?.coordinates,4e3);if(!ne)continue;!(ne.maxX<V||ne.minX>ie||ne.maxY<k||ne.minY>se)&&fe.push(J)}return fe.length===n.features.length?n:{...n,features:fe}}function tV(n,e={}){if(!n?.features?.length||n.__mfAutoDrawingAlign)return n;const t=n.features.filter(fe=>Fh(fe?.properties||{})),i=n.features.filter(fe=>!Fh(fe?.properties||{}));if(!t.length||!i.length)return n;const c=(fe,J=2e4)=>{let ne=1/0,me=1/0,ue=-1/0,ke=-1/0,je=0;for(const pe of fe){const U=Nd(pe?.geometry,Math.max(0,J-je));je+=U.length;for(const[F,q]of U)F<ne&&(ne=F),q<me&&(me=q),F>ue&&(ue=F),q>ke&&(ke=q);if(je>=J)break}return!Number.isFinite(ne)||!Number.isFinite(me)||!Number.isFinite(ue)||!Number.isFinite(ke)?null:{minX:ne,minY:me,maxX:ue,maxY:ke,spanX:ue-ne,spanY:ke-me,cx:(ne+ue)/2,cy:(me+ke)/2}},u=c(i),m=c(t);if(!u||!m||!(m.maxX<u.minX||m.minX>u.maxX||m.maxY<u.minY||m.minY>u.maxY))return n;const o=u.spanX>0?m.spanX/u.spanX:0,b=u.spanY>0?m.spanY/u.spanY:0;if(o<.5||o>2||b<.5||b>2)return n;const I=oq(e.buildingLabel,e.floorId);let M=n.features;if(I){const fe=[m.cx,m.cy];M=M.map(J=>!Fh(J?.properties||{})||!J?.geometry?J:{...J,geometry:{...J.geometry,coordinates:Bf(J.geometry.coordinates,ne=>zy(ne,fe,180))}})}const V=c(M.filter(fe=>Fh(fe?.properties||{})));if(!V)return n;const k=u.cx-V.cx,ie=u.cy-V.cy;if(!Number.isFinite(k)||!Number.isFinite(ie))return n;const se={...n,features:M.map(fe=>!Fh(fe?.properties||{})||!fe?.geometry?fe:{...fe,geometry:{...fe.geometry,coordinates:Bf(fe.geometry.coordinates,([J,ne])=>[J+k,ne+ie])}})};return se.__mfAutoDrawingAlign=!0,se}function t5({map:n,fc:e,isDrawing:t,screenPoint:i,maxPixels:c,maxPoints:u}){if(!n||!e?.features?.length||!i)return null;const m=Number.isFinite(c)?c:null,_=Number.isFinite(u)?u:8e3;let o=null,b=1/0,I=0;for(const M of e.features){const V=M?.properties||{},k=Fh(V),ie=M?.geometry?.type||"",fe=k||(ie==="LineString"||ie==="MultiLineString");if((t?!fe:fe)||!M?.geometry)continue;const J=Nd(M.geometry,Math.max(0,_-I));I+=J.length;for(const[ne,me]of J){const ue=n.project({lng:ne,lat:me}),ke=ue.x-i.x,je=ue.y-i.y,pe=ke*ke+je*je;pe<b&&(b=pe,o=[ne,me])}if(I>=_)break}return o&&(m==null||b<=m*m)?o:null}function nV(n){if(!n||!Array.isArray(n.features)||n.features.length===0)return n;const e=n.features.filter(t=>!Fh(t?.properties||{}));return e.length===0||e.length===n.features.length?n:{...n,features:e,__mfFitCandidate:!0}}const jA=[{key:"roomA",label:"Click room point A (rooms layer)"},{key:"roomB",label:"Click room point B (rooms layer)"},{key:"drawingA",label:"Click drawing point A (linework)"},{key:"drawingB",label:"Click drawing point B (linework)"}],rV=40,iV=140,n5=12e3,X8=LU?"/StakeholderMap/":"/",Qd=n=>`${X8}${n}`.replace(/\/{2,}/g,"/"),sv=Qd("floorplans/manifest.json"),iw="Hastings",oV=!1,u0=["==",["get","Element"],"Room"];async function m_(n){try{const e=await fetch(n,{cache:"no-store"});if(!e.ok)return null;const t=(e.headers.get("content-type")||"").toLowerCase(),i=await e.text();if(t.includes("text/html"))return null;const c=i.replace(/^\uFEFF/,"");try{return JSON.parse(c)}catch{return null}}catch{return null}}async function Z8(n){if(!n)return null;try{const e=await fetch(n,{cache:"no-store"});if(!e.ok)return null;const t=(e.headers.get("content-type")||"").toLowerCase(),i=await e.text();if(t.includes("text/html"))return null;try{const c=i.replace(/^\uFEFF/,"");return JSON.parse(c)}catch{return null}}catch{return null}}function D3(n){return n?n.type==="FeatureCollection"&&Array.isArray(n.features)?n:Array.isArray(n.features)?{type:"FeatureCollection",features:n.features}:n.type==="Feature"?{type:"FeatureCollection",features:[n]}:null:null}function av(n,e){if(!n||!e||n.__mfAffineApplied||AV(n))return n;const t=Q8(n,e);return t&&typeof t=="object"&&(t.__mfAffineApplied=!0,t.__mfAffineSignature=q8(e)),t}function Y8(n,e,t){if(!n||!Number.isFinite(e)||Math.abs(e)<1e-6||n.__mfRotationOverride===e)return n;try{const i=Array.isArray(t)&&t.length>=2?t:t?.geometry?.coordinates||Ml(n)?.geometry?.coordinates||null,c=Yh(n,e,i?{pivot:i}:void 0);if(c&&typeof c=="object")return c.__mfRotationOverride=e,i&&(c.__mfRotationPivot=i),n.__mfFitTransform&&(c.__mfFitTransform=n.__mfFitTransform),n.__mfFitted&&(c.__mfFitted=n.__mfFitted),n.__mfFittedBuilding&&(c.__mfFittedBuilding=n.__mfFittedBuilding),n.__mfAffineApplied&&(c.__mfAffineApplied=n.__mfAffineApplied),c}catch{}return n}function r5(n){if(!n)return null;const e=String(n).split("?")[0],t=e.lastIndexOf("/Rooms/");if(t>=0)return e.slice(0,t);const i=e.lastIndexOf("/");return i>0?e.slice(0,i):null}function F3(n,e){if(!n||!Array.isArray(e)||e.length<2)return n;const t=Number(e[0]),i=Number(e[1]);let c=n;if(Number.isFinite(t)&&Math.abs(t)>1e-6){const u=Math.abs(t)/1e3,m=t>=0?90:270;c=Ym(c,u,m,{units:"kilometers"})}if(Number.isFinite(i)&&Math.abs(i)>1e-6){const u=Math.abs(i)/1e3,m=i>=0?0:180;c=Ym(c,u,m,{units:"kilometers"})}return c}function ow(n,e){if(!n||!Array.isArray(e)||e.length<2)return n;const t=Number(e[0]),i=Number(e[1]);if(!Number.isFinite(t)&&!Number.isFinite(i))return n;const c=u=>[u[0]+(Number.isFinite(t)?t:0),u[1]+(Number.isFinite(i)?i:0)];return{...n,features:(n.features||[]).map(u=>({...u,geometry:u.geometry?{...u.geometry,coordinates:Bf(u.geometry.coordinates,c)}:u.geometry}))}}function J8(n,e){if(!n||!e||n.__mfFitTransformApplied)return n;let t=n;try{const{rotationDeg:i,rotationPivot:c,scale:u,scaleOrigin:m,translateKm:_,translateBearing:o,nudgeMeters:b,refineRotationDeg:I,refineRotationPivot:M}=e;Number.isFinite(i)&&Math.abs(i)>1e-6&&Array.isArray(c)&&(t=Yh(t,i,{pivot:c})),Number.isFinite(u)&&u>0&&Math.abs(u-1)>1e-6&&Array.isArray(m)&&(t=cg(t,u,{origin:m})),Number.isFinite(_)&&Number.isFinite(o)&&Math.abs(_)>1e-9&&(t=Ym(t,_,o,{units:"kilometers"})),Array.isArray(b)&&(t=F3(t,b)),Number.isFinite(I)&&Math.abs(I)>1e-6&&Array.isArray(M)&&(t=Yh(t,I,{pivot:M}))}catch{}return t&&typeof t=="object"&&(t.__mfFitTransformApplied=!0),t}function lv(n,e){if(!n||!e)return null;try{const t=n.getSource("buildings");let c=(t?._data||t?.serialize?.().data||null)?.features||[];if(!c.length&&typeof n.querySourceFeatures=="function")try{c=n.querySourceFeatures("buildings")||[]}catch{}return Cf(c,e)}catch{return null}}function sV(n,e){if(!n||!Number.isFinite(e)||Math.abs(e)<1e-6||!Array.isArray(n.features)||!n.features.length)return n;const t=Math.PI/180,i=-e*t,c=Math.cos(i),u=Math.sin(i),m=o=>{const b=o*t,I=Math.sin(b),M=Math.cos(b),V=I*c-M*u,k=I*u+M*c;return(Math.atan2(V,k)/t+360)%360};return{...n,features:n.features.map(o=>{const b=o?.properties||{},I=Number(b.bearing_deg);if(!Number.isFinite(I))return o;const M=m(I);return{...o,properties:{...b,bearing_deg:M}}})}}function aV(n,e,t,i={}){if(!n)return n;const c=i.adjustBearings&&Number.isFinite(i.bearingRotationDeg)&&Math.abs(i.bearingRotationDeg)>1e-6;if(!e&&!t&&!c||n.__mfOverlayTransformApplied)return n;let u=n;if(e?.deg!=null&&(u=Y8(u,e.deg,e.pivot)),t&&(u=J8(u,t)),i.adjustBearings){const m=(Number.isFinite(i.bearingRotationDeg)?i.bearingRotationDeg:0)+(Number.isFinite(e?.deg)?e.deg:0)+(Number.isFinite(t?.rotationDeg)?t.rotationDeg:0)+(Number.isFinite(t?.refineRotationDeg)?t.refineRotationDeg:0);u=sV(u,m)}return u&&typeof u=="object"&&(u.__mfOverlayTransformApplied=!0),u}const lV=new Set(["calvin_french_chapel/basement","kiewit/level_2"]);async function o0(n,e){if(!n||!e)return null;const t=tu(Md(n)||""),i=Na(e),u=lV.has(`${t}/${i}`)?[`${n}/${e}_Dept.affine.json`,`${n}/affine.json`]:[`${n}/affine.json`],m=Array.from(new Set([...u,...u.map(_=>{try{return encodeURI(_)}catch{return _}})]));for(const _ of m){const o=await Z8(_);if(o)return o}return null}async function cV(n){for(const e of(n||[]).filter(Boolean)){const t=await Z8(e);if(t)return{url:e,data:t}}return{url:n?.[0]||"",data:null}}async function uV({basePath:n,floorId:e,skipAffine:t=!1}){const i=[`${n}/Rooms/${e}_Dept_Rooms.geojson`,`${n}/Rooms/${e}_Dept.geojson`,`${n}/${e}_Dept_Rooms.geojson`,`${n}/${e}_Dept.geojson`],[{data:c},u]=await Promise.all([cV(i),t?Promise.resolve(null):o0(n,e)]),m=D3(c);if(!m)return{rawFC:null,patchedFC:null,affine:null};m.features=(m.features||[]).map(o=>{const b=o?.properties||{},I=M3(b),M=U8(b);return{...o,properties:{...b,__roomType:I||"",__dept:M||"",__areaSf:V8(b)}}});const _=av(m,u);return{rawFC:m,patchedFC:_,affine:u}}function hV(n,e){function t(i){if(!i)return i;if(typeof i[0]=="number"){const c=i[0],u=i[1];return[e.a*c+e.b*u+e.c,e.d*c+e.e*u+e.f]}return i.map(t)}return{...n,features:n.features.map(i=>({...i,geometry:i.geometry?{...i.geometry,coordinates:t(i.geometry.coordinates)}:i.geometry}))}}function Q8(n,e){if(!n||!e)return n;const t=e.anchor_feet||e.anchorFeet||e.anchor;if(!Array.isArray(t)||t.length<2)return n;const i=Number(e.target_lon??e.targetLon),c=Number(e.target_lat??e.targetLat);if(!Number.isFinite(i)||!Number.isFinite(c))return n;const u=Number(e.rotation_deg_cw??e.rotation_deg??0),m=e.effective_scale_deg_per_foot!=null,_=Number(m?e.effective_scale_deg_per_foot:e.scale_deg_per_foot??e.scale_deg_per_ft??e.scale);if(!Number.isFinite(_)||_===0)return n;const o=Number(e.scale_percent??100),b=m?_:_*(Number.isFinite(o)?o/100:1),I=c*Math.PI/180,M=Math.max(1e-9,Math.cos(I)),V=b/M,k=u*Math.PI/180,ie=Math.cos(k),se=Math.sin(k),[fe,J]=t,ne=V*ie,me=-V*se,ue=i-(ne*fe+me*J),ke=b*se,je=b*ie,pe=c-(ke*fe+je*J);return hV(n,{a:ne,b:me,c:ue,d:ke,e:je,f:pe})}async function eC(n){for(const e of(n||[]).filter(Boolean))try{const t=await fetch(e,{cache:"no-store"}),i=(t.headers.get("content-type")||"").toLowerCase(),c=await t.text();if(!t.ok||i.includes("text/html"))continue;try{const u=c.replace(/^\uFEFF/,""),m=JSON.parse(u);return{ok:!0,url:e,data:m}}catch{continue}}catch{continue}return{ok:!1,url:n?.[0]||"",error:"No valid JSON response from any candidate URL."}}async function dV({basePath:n,floorId:e,map:t,roomsFC:i,affine:c,rotationOverride:u,fitTransform:m}){if(!n||!e||!t)return;const _=String(e).trim(),o=[`${n}/${_}_-_Map_Export_Walls_RAW.geojson`,`${n}/${_}_Walls_RAW.geojson`,`${n}/${_}_-_Map_Export_Walls.geojson`,`${n}/${_}_Walls.geojson`],b=await pd(o);let I=D3(b);if(!I?.features?.length)return;console.log("[walls] loaded features",I.features.length);function M(se,fe=20){let J=0;const ne=me=>{if(!me||J>=fe)return!0;if(typeof me[0]=="number"&&typeof me[1]=="number"){const ue=me[0],ke=me[1];return J+=1,Math.abs(ue)<=180&&Math.abs(ke)<=90}for(const ue of me)if(!ne(ue))return!1;return!0};for(const me of se?.features||[]){if(!ne(me?.geometry?.coordinates))return!1;if(J>=fe)break}return J>0}c&&!M(I)?(I=Q8(I,c),console.log("[walls] applied affine")):c&&console.log("[walls] skipped affine (already lon/lat)"),I=aV(I,u,m,{adjustBearings:!1});const k="walls-source",ie="walls-layer";t.getSource(k)?t.getSource(k).setData(I):t.addSource(k,{type:"geojson",data:I});try{const se=Cu(I);console.log("[walls] bbox",se)}catch{console.log("[walls] first coord",I.features?.[0]?.geometry?.coordinates?.[0]?.[0])}if(!t.getLayer(ie)){const se=t.getLayer(ko)?ko:void 0;t.addLayer({id:ie,type:"line",source:k,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#000","line-width":["interpolate",["linear"],["zoom"],16,.15,18,.25,20,.45],"line-opacity":.25}},se)}}async function fV({basePath:n,floorId:e,map:t,affine:i,rotationOverride:c,fitTransform:u,roomsFC:m,buildingLabel:_}){}function UA(n,e){if(!e||!Array.isArray(n)||n.length<2)return n;const t=Number(e.target_lon??e.targetLon),i=Number(e.target_lat??e.targetLat),c=Number(e.rotation_deg_cw??e.rotation_deg??0),u=Number(e.effective_scale_deg_per_foot??e.scale_deg_per_foot??e.scale_deg_per_ft??e.scale),m=e.anchor_feet||e.anchorFeet||e.anchor;if(!Number.isFinite(t)||!Number.isFinite(i)||!Number.isFinite(u)||!Array.isArray(m))return n;const _=u,o=_/Math.max(1e-9,Math.cos(i*Math.PI/180)),[b,I]=n,M=(b-t)/o,V=(I-i)/_,k=c*Math.PI/180,ie=Math.cos(k),se=Math.sin(k),[fe,J]=m;return[ie*M+se*V+fe,-se*M+ie*V+J]}function zy(n,e,t){if(!Array.isArray(n)||n.length<2)return n;const[i,c]=n,[u,m]=e||[0,0],_=t*Math.PI/180,o=Math.cos(_),b=Math.sin(_),I=i-u,M=c-m;return[u+o*I-b*M,m+b*I+o*M]}function Bf(n,e){return n&&(typeof n[0]=="number"?e(n):n.map(t=>Bf(t,e)))}function jm(n){let e=1/0,t=1/0,i=-1/0,c=-1/0;return n.forEach(([u,m])=>{!Number.isFinite(u)||!Number.isFinite(m)||(u<e&&(e=u),m<t&&(t=m),u>i&&(i=u),m>c&&(c=m))}),{minx:e,miny:t,maxx:i,maxy:c,spanX:i-e,spanY:c-t,cx:(e+i)/2,cy:(t+c)/2}}function pV({buildingLabel:n,floorId:e,floorBasePath:t}={}){if(Na(e||"")!=="basement")return!1;if(t&&String(t).includes("/Calvin French Chapel/"))return!0;const c=ei(n);return c&&[ei("Calvin French Chapel"),ei("Calvin H. French Chapel"),ei("Calvin H. French Memorial Chapel")].includes(c)}function VA({buildingLabel:n,floorId:e,floorBasePath:t}={}){if(Na(e||"")!=="level_3")return!1;if(t&&(()=>{try{return decodeURIComponent(String(t))}catch{return String(t)}})().includes("/Babcock Hall/"))return!0;const c=ei(n);return c&&[ei("Babcock Hall"),ei("Babcock Hall Residence")].includes(c)}function qA(n){let e=0,t=0,i=0;const c=u=>{if(Array.isArray(u)){if(u.length>=2&&typeof u[0]=="number"&&typeof u[1]=="number"){e+=u[0],t+=u[1],i+=1;return}u.forEach(c)}};return(n||[]).forEach(u=>{u?.geometry?.coordinates&&c(u.geometry.coordinates)}),i?[e/i,t/i]:null}function $A(n,e,t){if(!n?.features?.length||n.__mfBabcockL3AutoRotated)return n;const i=90*Math.PI/180,c=Math.cos(i),u=Math.sin(i),m=o=>{const b=o[0],I=o[1];return[b*c-I*u,b*u+I*c]},_=n.features.map(o=>!Fh(o?.properties||{})||!o?.geometry?o:{...o,geometry:{...o.geometry,coordinates:Bf(o.geometry.coordinates,m)}});return{...n,features:_,__mfBabcockL3AutoRotated:!0}}function mV(n,e,t){if(!n?.features?.length||n.__mfBasementFixed)return n;const i=n.features.filter(xe=>Fh(xe?.properties||{})),c=n.features.filter(xe=>!Fh(xe?.properties||{}));if(i.length&&c.length){const xe={type:"FeatureCollection",features:i},le={type:"FeatureCollection",features:c},De=um(xe,1200)||xe,Be=um(le,1200)||le,Ye=s0(De,2e3),rt=s0(Be,2e3),mt=jm(Ye),ft=jm(rt),Dt=qA(i)||(mt?[mt.cx,mt.cy]:null),Yt=qA(c)||(ft?[ft.cx,ft.cy]:null);if(mt&&ft&&Dt&&Yt){const cn=Math.max(ft.spanX||0,ft.spanY||0,1e-9);if(Math.hypot(Dt[0]-Yt[0],Dt[1]-Yt[1])>cn*.18){const Gt=h0(De?.geometry)??0,st=h0(Be?.geometry)??0,mr=hv(st-Gt),Er=mt.spanX?ft.spanX/mt.spanX:1,Cr=mt.spanY?ft.spanY/mt.spanY:1;let Ln=1;Number.isFinite(Er)&&Number.isFinite(Cr)&&Er>0&&Cr>0&&(Ln=Math.min(Er,Cr)),Ln=Math.max(.2,Math.min(5,Ln||1));const ir=mr*Math.PI/180,er=Math.cos(ir),Yr=Math.sin(ir),[Vt,Pn]=Dt,[Gn,Dn]=Yt,Mr=Ir=>{const Pr=Ir[0]-Vt,Ei=Ir[1]-Pn,Pi=(Pr*er-Ei*Yr)*Ln,or=(Pr*Yr+Ei*er)*Ln;return[Gn+Pi,Dn+or]},wr=n.features.map(Ir=>!Fh(Ir?.properties||{})||!Ir?.geometry?Ir:{...Ir,geometry:{...Ir.geometry,coordinates:Bf(Ir.geometry.coordinates,Mr)}}),Tr={...n,features:wr};return Tr.__mfBasementFixed=!0,Tr}}}if(!e||!t)return n;const u=n.features.map((xe,le)=>{const De=xe?.geometry?.coordinates;if(!De)return null;const Be=Nd({coordinates:De},1e3);if(!Be.length)return null;const Ye=Be.reduce((mt,ft)=>mt+ft[0],0)/Be.length,rt=Be.reduce((mt,ft)=>mt+ft[1],0)/Be.length;return{i:le,c:[Ye,rt]}}).filter(Boolean);if(u.length<6)return n;const m=u.map(xe=>xe.c[0]).sort((xe,le)=>xe-le),_=m[Math.floor(m.length/2)],o=new Set(u.filter(xe=>xe.c[0]<=_).map(xe=>xe.i));if(!o.size||o.size===n.features.length)return n;const b={type:"FeatureCollection",features:n.features.filter((xe,le)=>o.has(le))},I=um(b,1200),M=h0(t?.geometry)??0,V=h0(I?.geometry)??0,k=Number.isFinite(M)&&Number.isFinite(V)?M-V:0,ie=Ml(t)?.geometry?.coordinates||null;if(!ie)return n;const se=xe=>zy(xe,ie,-M),fe=xe=>zy(xe,ie,M),J={type:"Feature",properties:{},geometry:{...t.geometry,coordinates:Bf(t.geometry.coordinates,se)}},ne=s0(J,4e3),me=jm(ne);if(!Number.isFinite(me.cx))return n;const ue=me.cx,ke=S3([[[ue-10,me.miny-10],[ue,me.miny-10],[ue,me.maxy+10],[ue-10,me.maxy+10],[ue-10,me.miny-10]]]),je=k8(E3([J,ke]));if(!je?.geometry)return n;const pe={type:"Feature",geometry:{...je.geometry,coordinates:Bf(je.geometry.coordinates,fe)}},U=s0(pe,4e3),F=jm(U);if(!Number.isFinite(F.minx))return n;const q=jm([UA([F.minx,F.miny],e),UA([F.maxx,F.maxy],e)]),j=s0(b,4e3),H=jm(j),Z=[H.cx,H.cy],be=j.map(xe=>zy(xe,Z,k)),Re=jm(be);if(!Number.isFinite(Re.spanX)||!Number.isFinite(Re.spanY))return n;const Oe=Math.min(q.spanX/Math.max(1e-9,Re.spanX),q.spanY/Math.max(1e-9,Re.spanY)),Ne=[q.cx-Re.cx,q.cy-Re.cy],we=xe=>{const le=zy(xe,Z,k),De=[(le[0]-Re.cx)*Oe+Re.cx,(le[1]-Re.cy)*Oe+Re.cy];return[De[0]+Ne[0],De[1]+Ne[1]]},Fe=n.features.map((xe,le)=>!o.has(le)||!xe?.geometry?.coordinates?xe:{...xe,geometry:{...xe.geometry,coordinates:Bf(xe.geometry.coordinates,we)}}),nt={...n,features:Fe};return nt.__mfBasementFixed=!0,nt}async function gV({basePath:n,floorId:e,map:t,affine:i,rotationOverride:c,fitTransform:u}){}let i5=0;function tC(n){if(!n||/^https?:\/\//i.test(n))return n;const e=D8();if(!e)return n;const t=e.replace(/\/$/,""),i=n.startsWith("/")?n:`/${n}`,c=i.startsWith("/ai/")?i.replace(/^\/ai/,""):i;return`${t}${c}`}async function Xd(n,e={}){const t=Date.now();if(t<i5)throw new Error(`Rate limited. Try again in ${Math.ceil((i5-t)/1e3)}s`);const i=Number(e.timeoutMs),c=Number.isFinite(i)&&i>0?new AbortController:null,u={...e};c&&(u.signal=c.signal),delete u.timeoutMs;let m=null;c&&(m=setTimeout(()=>c.abort(),i));let _;try{_=await fetch(tC(n),u)}finally{m&&clearTimeout(m)}if(_.status===429)throw i5=Date.now()+6e4,new Error("Rate limited (429). AI paused for 60 seconds.");return _}async function GA(n,e=iw){if(!n)return[];const t=k=>String(k||"").trim().toLowerCase().replace(/[^a-z0-9]/g,""),i=(k=[])=>{const ie=Array.isArray(k)?k:k?[k]:[];return ie.length?ie.map(se=>{if(typeof se=="string")return{id:se,url:null};if(!se)return null;const fe=c0(se.id||se.floorId||se.name||se.label),J=se.url||se.path||null;return fe?{id:fe,url:J}:null}).filter(Boolean):[]},c=encodeURIComponent(e),u=encodeURIComponent(n),m=Qd(`floorplans/${c}/${u}/manifest.json`),_=await m_(m),b=(await m_(sv))?.floorsByBuilding||{};let I=b[n];if(!I){const k=Object.keys(b).find(ie=>t(ie)===t(n));I=k?b[k]:null}const M=i(I||[]),V=i(_?.floors);if(!V.length)return M;if(M.length&&V.some(k=>!k.url)){const k=new Map(M.filter(ie=>ie?.id&&ie?.url).map(ie=>[ie.id,ie.url]));return V.map(ie=>({...ie,url:ie.url||k.get(ie.id)||null}))}return V}const yV=()=>{if(typeof window>"u")return"";const n=String(window.__MAPBOX_PUBLIC_TOKEN__??"").trim();if(n)return n;try{const e=String(window.localStorage?.getItem("MAPBOX_PUBLIC_TOKEN")??"").trim();if(e)return e}catch{}return""};kd.accessToken=yV();console.log("Mapbox token length:",(kd.accessToken||"").length);const ma="floor-source",ko="floor-fill",Jh="floor-line",zv="floor-sentiment-gradient-source",nC="floor-sentiment-light",rC="floor-sentiment-mid",iC="floor-sentiment-shade",oC="floor-sentiment-core",sC="floor-sentiment-core-2",aC="floor-sentiment-core-3",lC="floor-sentiment-core-4",cC="floor-sentiment-core-5",uC="floor-sentiment-core-6",hC="floor-sentiment-core-7",cv=[nC,rC,iC,oC,sC,aC,lC,cC,uC,hC],Sp="floor-drawing",zf="floor-highlight",ug="floor-highlight-border",Qc="floor-room-labels",jv="floor-doors",Uv="floor-stairs",Um="engagement-heat-source",Zd="engagement-heat-warm-halo-layer",Yd="engagement-heat-cool-halo-layer",Vv="walls-source",k0="walls-layer",HA="doors-source",WA="stairs-source",qv="doors-layer",$v="stairs-layer",ps=new Map,Xu=new Map,o5=new Map,_V=n=>n?/^https?:\/\//i.test(n)||n.startsWith(X8)?n:Qd(String(n).replace(/^\//,"")):null;async function vV(n){const e=_V(n);if(!e)return[];if(o5.has(e))return o5.get(e);const t=await m_(e),i=Array.isArray(t?.features)?t.features:[];return o5.set(e,i),i}async function xV(n,e,t){const i=[],c=[...n],u=Math.max(1,Number(e)||1),m=Array.from({length:u},async()=>{for(;c.length;){const _=c.shift();try{i.push(await t(_))}catch(o){console.warn("dashboard fetch failed",_,o)}}});return await Promise.all(m),i}function KA(n){if(!n)return;const e="buildings-fill";if(n.getLayer(e))try{n.setPaintProperty(e,"fill-color",fd("#ffffff")),n.setPaintProperty(e,"fill-opacity",1),n.setPaintProperty(e,"fill-outline-color","#cbd5e1")}catch{}}const bV={"fill-color":"#e6e6e6","fill-opacity":1};function sw(n,e="department",t={}){if(!n||!n.getLayer(ko))return;const i=[">",["length",["coalesce",["to-string",["get","occupant"]],["to-string",["get","Occupant"]],""]],0],u=["upcase",["to-string",["coalesce",["get","occupancyStatus"],["get","Occupancy Status"],["get","OccupancyStatus"],["get","Occupancy"],["get","Vacancy"],["get","vacancy"],["get","Vacant"],""]]],m=["upcase",["to-string",["coalesce",["get","__roomType"],["get","NCES_Type"],["get","RoomType"],["get","Room Type"],["get","Type"],["get","type"],["get","Name"],""]]],_=["to-string",["coalesce",["get","__roomType"],["get","NCES_Type"],["get","type"],["get","Type"],""]],o=["any",["in",m,["literal",uq]],[">=",["index-of","OFFICE - STAFF",m],0],[">=",["index-of","OFFICE - PROF AND ADMIN",m],0],[">=",["index-of","OFFICE - PROF & ADMIN",m],0],[">=",["index-of","OFFICE - PROF/ADMIN",m],0],[">=",["index-of","OFFICE - FACULTY",m],0],[">=",["index-of","OFFICE - ADJUNCT FACULTY",m],0],[">=",["index-of","OFFICE - EMERITUS FACULTY",m],0],["==",_,"310"],["==",_,"311"]],V=["case",[">",["length",u],0],["case",["any",[">=",["index-of","VACANT",u],0],[">=",["index-of","UNOCCUPIED",u],0],[">=",["index-of","AVAILABLE",u],0],[">=",["index-of","UNASSIGNED",u],0]],"Vacant",[">=",["index-of","OCCUPIED",u],0],"Occupied","Unknown"],i,"Occupied","Unknown"],k=["case",o,["match",V,"Occupied","#29b6f6","Vacant","#ff7043","Unknown","#e0e0e0","#e0e0e0"],"#e6e6e6"],ie=["case",o,["match",V,"Vacant","#ff7043","Occupied","#cfd8dc","Unknown","#cfd8dc","#cfd8dc"],"#e6e6e6"];try{e==="occupancy"?n.setPaintProperty(ko,"fill-color",k):e==="vacancy"?n.setPaintProperty(ko,"fill-color",ie):n.setPaintProperty(ko,"fill-color",kU()),n.setPaintProperty(ko,"fill-opacity",1)}catch{}}function wV(n){if(!(!n||n.getLayer(zf)))try{n.addLayer({id:zf,type:"fill",source:ma,paint:{"fill-color":"rgba(0,255,255,0.4)","fill-outline-color":"#00ffff"},filter:["==",["id"],-1]},ko),n.addLayer({id:ug,type:"line",source:ma,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#00ffff","line-width":6,"line-opacity":1,"line-gap-width":0},filter:["==",["id"],-1]})}catch{}}function SV(n,e,t){!n||!e||!t||(n.getSource(e)?n.getSource(e).setData(t):n.addSource(e,{type:"geojson",data:t}))}async function XA(n,e,t){if(!n||!e||!t)return;try{if(n.hasImage(e))return}catch{}const i=await new Promise((c,u)=>{n.loadImage(t,(m,_)=>m?u(m):c(_))});try{n.addImage(e,i,{sdf:!0})}catch(c){console.warn("addImage failed for",e,c)}}function EV(n){if(n)try{n.getLayer(k0)&&n.getLayer(ko)&&n.moveLayer(k0,ko),n.getLayer(Jh)&&n.getLayer(ko)&&n.moveLayer(Jh),n.getLayer(Sp)&&(n.getLayer(Qc)?n.moveLayer(Sp,Qc):n.moveLayer(Sp)),n.getLayer(qv)&&n.moveLayer(qv),n.getLayer($v)&&n.moveLayer($v),n.getLayer(Qc)&&n.moveLayer(Qc)}catch{}}function ZA(n=[],e=[]){const t=[];return n.length&&t.push(["in",["id"],["literal",n]]),e.length&&t.push(["in",["get","RevitId"],["literal",e]]),t.length?t.length===1?t[0]:["any",...t]:["==",["id"],""]}async function pd(n){const e=Array.isArray(n)?n.filter(Boolean):[n].filter(Boolean);if(!e.length)return null;const t=await eC(e);return t.ok?t.data:(console.debug("GeoJSON fetch failed",{tried:e,lastUrl:t.url,error:t.error}),null)}function AV(n){try{if(!n?.features?.length)return!1;const e=Cu(n);if(!e||e.some(o=>!Number.isFinite(o)))return!1;const[t,i,c,u]=e;if(t<-180||c>180||i<-90||u>90)return!1;const m=Math.abs(c-t),_=Math.abs(u-i);return m<=.25&&_<=.25}catch{return!1}}async function TV(n,e,t,i,c={}){if(!n||!e)return;const{buildingId:u,floor:m,roomPatches:_,onOptionsCollected:o,currentFloorContextRef:b,airtableLookup:I}=c,M=c?.roomsBasePath||c?.wallsBasePath,V=c?.roomsFloorId||c?.wallsFloorId||m||null;let k=i?.fitBuilding||null;if(!k&&u&&(k=lv(n,u)),!k&&M){const Vt=Md(M);Vt&&(k=lv(n,Vt))}if(!k&&M){const Vt=await c5();if(Vt?.features?.length){const Pn=Md(M),Gn=d0?.[Pn]||Pn;k=Cf(Vt.features,u)||Cf(Vt.features,Gn)||Cf(Vt.features,Pn)||null}}if(!k&&M){const Vt=Md(M),Pn=d0?.[Vt]||Vt,Dn=ei(u||Pn);Dn&&cw.has(Dn)&&(k=lv(n,Pn))}let ie=t_(k);const se=k?.properties?.id||k?.properties?.name||u||"",fe=Ov({buildingLabel:se,buildingId:u,floorBasePath:M,fitBuilding:k}),J=ZU({buildingLabel:se,buildingId:u,floorBasePath:M,fitBuilding:k}),ne=jV({buildingLabel:se}),me=iq(se||u||"",V||m||"")||0,ue=M&&V?By(M,V):null,ke=Oy(e),je=Wm(J,V||m),U=rw({base:ue,url:ke,label:je}).adjust,F=me;let q=null,j=null,H=ps.get(e);const Z=K8(fe,V||m),be=W8(Z);if(H&&sq(se||u||"",V||m||"")&&(ps.delete(e),Xu.delete(e),H=null),H&&ie&&(H.__mfTransformed||H.__mfFitted||H.__mfFitTransform)&&(ps.delete(e),H=null),H&&Number.isFinite(F)&&H.__mfPostRotation!==F&&(ps.delete(e),Xu.delete(e),H=null),H&&M&&V&&!ne){const Vt=await o0(M,V),Pn=q8(Vt);Pn&&H.__mfAffineSignature&&H.__mfAffineSignature!==Pn||Pn&&H.__mfAffineApplied&&!H.__mfAffineSignature?(ps.delete(e),Xu.delete(e),H=null):q=Vt}if(H&&!q&&!ne&&V){const Vt=r5(e);Vt&&(q=await o0(Vt,V))}if(H&&(H.__mfDrawingAlignSignature||be)&&H.__mfDrawingAlignSignature!==be&&(ps.delete(e),Xu.delete(e),H=null),H){const Vt=Bv(U);(Vt&&H.__mfUserAdjustSignature&&H.__mfUserAdjustSignature!==Vt||Vt&&H.__mfTransformed&&!H.__mfUserAdjustSignature)&&(ps.delete(e),Xu.delete(e),H=null)}if(!H){if(M&&V){const Vt=await uV({basePath:M,floorId:V,skipAffine:ne});if(!Vt.rawFC){console.warn("Floor summary: no data returned",`${M}/${V}_Dept.geojson`);return}if(H=Vt.rawFC,q=Vt.affine,!ne&&!q){const Pn=r5(e);Pn&&(q=await o0(Pn,V))}if(ne&&(q=null),pV({buildingLabel:u,floorId:V,floorBasePath:M})){const Pn=mV(Vt.rawFC,q,k);j=av(Pn,q)}else if(VA({buildingLabel:u,floorId:V,floorBasePath:M})){const Pn=$A(Vt.rawFC);j=av(Pn,q)}else j=Vt.patchedFC}else if(H=await pd(e),!H)return;ps.set(e,H)}if(!j){if(j=D3(H)||Au(H),!j?.features?.length)return;if(!ne&&!q&&V&&(M&&(q=await o0(M,V)),!q)){const Vt=r5(e);Vt&&(q=await o0(Vt,V))}VA({buildingLabel:u,floorId:V,floorBasePath:M})&&(j=$A(j)),j=av(j,q)}Z&&(j=XU(j,Z)),j=tV(j,{buildingLabel:se||u||"",floorId:V||m||""}),j=eV(j),j=VU(j);const Re=se||k?.properties?.id||k?.properties?.name||u||"";if(lq(Re,V||m||"")&&(j.__mfNoFit=!0),!k&&M){const Vt=await c5();if(Vt?.features?.length){const Pn=Md(M),Gn=d0?.[Pn]||Pn;k=Cf(Vt.features,u)||Cf(Vt.features,Gn)||Cf(Vt.features,Pn)||null,ie=t_(k)}}if(!k&&M){const Vt=Md(M),Pn=d0?.[Vt]||Vt,Dn=ei(u||Pn);if(Dn&&cw.has(Dn)){const Mr=await c5();Mr?.features?.length&&(k=Cf(Mr.features,Pn)||Cf(Mr.features,Vt)||null,ie=t_(k))}}const Ne=Number.isFinite(i?.rotationOverrideDeg)?i.rotationOverrideDeg:null,we=Xu.get(e)||{};ie&&delete we.fitTransform;let Fe=null;if(Ne!=null){const Vt=we.rotationPivot||Ml(j)?.geometry?.coordinates||null;Fe=Vt?{deg:Ne,pivot:Vt}:{deg:Ne},!we.rotationPivot&&Vt&&(we.rotationPivot=Vt,Xu.set(e,we));const Pn=Y8(j,Ne,Vt);Pn&&Pn!==j&&(j=Pn,ie||ps.set(e,j))}j.features.forEach((Vt,Pn)=>{Vt&&Vt.id==null&&(Vt.id=Vt.properties?.RevitId??Pn)});const nt=[],xe=[],le=[],De=[];j.features.forEach(Vt=>{if(!Vt)return;const Pn=Vt.id??Vt.properties?.RevitId??Vt.properties?.id;if(Pn==null)return;const Gn=b0(Vt.properties);Gn==="door"?(nt.push(Pn),Vt.properties?.RevitId!=null&&xe.push(Vt.properties.RevitId)):Gn==="stair"&&(le.push(Pn),Vt.properties?.RevitId!=null&&De.push(Vt.properties.RevitId))});const Be=(Vt,Pn)=>{if(!Vt)return;const Gn=Pn?.features;if(!(!Array.isArray(Gn)||Gn.length===0))try{const Dn=selectedBuildingIdRef.current||selectedBuilding||i?.fitBuilding?.properties?.id,Mr=i?.floorLabel||Gn[0]?.properties?.Floor||e?.match(/(BASEMENT|LEVEL_\\d+|LEVEL|L\\d+)/)?.[0]||"LEVEL_1";if(Dn){const Tr={...floorStatsByBuildingRef.current[Dn]||{},[Mr]:Vt};floorStatsByBuildingRef.current[Dn]=Tr,setFloorStatsByBuilding({...floorStatsByBuildingRef.current})}panelBuildingKeyRef.current&&panelBuildingKeyRef.current===Dn&&setPanelStats(wr=>({...wr||{},floor:Vt}))}catch{}};let Ye=DA(j);Be(Ye,j);const rt=nV(j),mt=rt&&rt!==j?rt:j;let ft=j?.__mfFitTransform||we.fitTransform||null;try{if(k&&HV(mt,k)){const Vt=DV(mt,k);if(Vt?.features?.length){if(ft=Vt.__mfFitTransform||null,mt!==j&&ft){const Pn=J8(j,ft);Pn?.features?.length&&(j.__mfAffineApplied&&(Pn.__mfAffineApplied=j.__mfAffineApplied),j.__mfRotationOverride!=null&&(Pn.__mfRotationOverride=j.__mfRotationOverride),j.__mfRotationPivot&&(Pn.__mfRotationPivot=j.__mfRotationPivot),Pn.__mfFitted=!0,Pn.__mfFittedBuilding=Vt.__mfFittedBuilding||"",Pn.__mfFitTransform=ft,j=Pn)}else j=Vt;H.__mfTransformed=!0,ie||ps.set(e,j)}}}catch{}const Dt=rq(se||u||"",V||m||"");if(Number.isFinite(Dt)&&Math.abs(Dt-1)>.001){const Vt=ft?.scaleOrigin||Ml(j)?.geometry?.coordinates||null;Vt&&(j=cg(j,Dt,{origin:Vt}),ft=ft||{rotationDeg:0,rotationPivot:null,scale:1,scaleOrigin:Vt,translateKm:0,translateBearing:0,nudgeMeters:null,refineRotationDeg:0,refineRotationPivot:null},ft.scale=(Number.isFinite(ft.scale)?ft.scale:1)*Dt,ft.scaleOrigin=Vt,H.__mfTransformed=!0,ie||ps.set(e,j))}if(Number.isFinite(F)&&Math.abs(F)>.001){const Vt=ft?.scaleOrigin||ft?.rotationPivot||Ml(k||j)?.geometry?.coordinates||null;Vt&&(j=Yh(j,F,{pivot:Vt}),ft=ft||{rotationDeg:0,rotationPivot:null,scale:1,scaleOrigin:Vt,translateKm:0,translateBearing:0,nudgeMeters:null,refineRotationDeg:0,refineRotationPivot:null},ft.refineRotationDeg=(Number.isFinite(ft.refineRotationDeg)?ft.refineRotationDeg:0)+F,ft.refineRotationPivot=Vt,H.__mfTransformed=!0,H.__mfPostRotation=F,ie||ps.set(e,j))}const Yt=ft?.scaleOrigin||ft?.rotationPivot||Ml(j)?.geometry?.coordinates||null;if(U&&mp(U)){const Pn=YU(j,U,ft);Pn?.fc&&Pn.fc!==j&&(j=Pn.fc,ft=Pn.fitTransform||ft,H.__mfTransformed=!0,ie||ps.set(e,j))}ft&&(we.fitTransform=ft,Xu.set(e,we)),j&&Array.isArray(j.features)&&b&&typeof b=="object"&&(b.current={url:e,buildingId:u,floor:m,fc:j,floorAdjustLabel:J,floorAdjustFloorId:V||m||"",floorAdjustBasePath:M||null,floorAdjustBasePivot:Yt||null});let cn=j,gn=[];const Mn=u&&m&&_ instanceof Map,Gt=!!I;if(Mn||Gt){const Vt=(j.features||[]).map(Pn=>{const Gn=Pn.properties||{};let Dn=Gn;if(Gt&&b0(Gn)==="room"){const wr=AC(Gn,I,u,m);wr&&(Dn=Hv(Dn,wr))}if(Mn){const wr=Pn.id??Gn.RevitId??Gn.id,Tr=Jd(u,m,wr),Ir=_.get(Tr);Ir&&(Dn=Hv(Dn,Ir))}const Mr=gd(Dn);return{...Pn,properties:{...Dn,__roomType:Mr?String(Mr).trim():Dn.__roomType||""}}});if(cn={...j,features:Vt},typeof o=="function"){const{typeOptions:Pn,deptOptions:Gn}=jU(Vt);o({typeOptions:Pn,deptOptions:Gn})}}b&&typeof b=="object"&&(b.current={...b.current||{},buildingId:u,floor:V||m||"",fc:cn}),Array.isArray(cn?.features)&&(gn=cn.features.map(Vt=>{const Pn=Vt?.properties??{},Gn=Vt?.id??Pn.RevitId??Pn.id,Dn=u&&m&&Gn!=null?Jd(u,m,Gn):null,Mr=_ instanceof Map&&Dn&&_.get(Dn)||null;return{geo:{...Pn},db:Mr?{...Mr}:null,roomId:Dn||String(Gn??"")}}));const st=Array.isArray(cn?.features)&&cn.features.length?DA(cn):null;st&&(Ye=st),Be(Ye,cn),IC(n);const mr=Wu(n,ma);if(mr?mr.setData(cn):n.addSource(ma,{type:"geojson",data:cn,promoteId:"RevitId"}),!n.getLayer(ko))n.addLayer({id:ko,type:"fill",source:ma,paint:bV,filter:u0});else try{n.setFilter(ko,u0)}catch{}if(sw(n),wV(n),!aq(se||u||"",V||m||"")&&Array.isArray(cn?.features)&&cn.features.some(Vt=>Vt?.properties?.interactive===!1||Vt?.properties?.type==="drawing")){const Vt=["downcase",["to-string",["coalesce",["get","Layer"],["get","layer"],["get","FeatureClass"],["get","featureClass"],["get","type"],["get","Type"]]]],Gn=["all",["==",["get","interactive"],!1],["!",["any",[">=",["index-of","grid",Vt],0],[">=",["index-of","area-bndy",Vt],0],[">=",["index-of","area bndy",Vt],0]]]];if(!n.getLayer(Sp))n.addLayer({id:Sp,type:"line",source:ma,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#2f2f2f","line-width":["interpolate",["linear"],["zoom"],16,.15,18,.25,20,.45],"line-opacity":.6},filter:Gn});else try{n.setFilter(Sp,Gn)}catch{}}if(!n.getLayer(Jh))n.addLayer({id:Jh,type:"line",source:ma,paint:{"line-color":"#444","line-width":["interpolate",["linear"],["zoom"],16,.4,18,.8,20,1.2],"line-opacity":.7},filter:u0});else try{n.setFilter(Jh,u0)}catch{}if(Uy(n,c?.labelMode||"department"),c?.enableWalls&&c?.wallsBasePath){const Vt=c.wallsFloorId||m||e?.match(/(BASEMENT|LEVEL_\d+|LEVEL|L\d+)/)?.[0]||null;await dV({basePath:c.wallsBasePath,floorId:Vt,map:n,roomsFC:cn,affine:q,rotationOverride:Fe,fitTransform:ft});try{n.setPaintProperty(ko,"fill-opacity",.25)}catch{}}const Ln=c?.roomsBasePath||c?.wallsBasePath,ir=u||i?.fitBuilding?.properties?.id||i?.fitBuilding?.properties?.name||null;if(Ln){const Vt=c?.roomsFloorId||c?.wallsFloorId||m||e?.match(/(BASEMENT|LEVEL_\d+|LEVEL|L\d+)/)?.[0]||null;Vt&&(await fV({basePath:Ln,floorId:Vt,map:n,affine:q,rotationOverride:Fe,fitTransform:ft||we.fitTransform||null,roomsFC:cn,buildingLabel:ir}),await gV({basePath:Ln,floorId:Vt,map:n,affine:q,rotationOverride:Fe,fitTransform:ft||we.fitTransform||null}))}EV(n);const er=ZA(nt,xe),Yr=ZA(le,De);try{n.getLayer(jv)&&n.setFilter(jv,er),n.getLayer(Uv)&&n.setFilter(Uv,Yr)}catch{}try{n.getLayer(zf)&&n.getLayer(Jh)&&n.moveLayer(zf,Jh)}catch{}if(t!=null&&n.getLayer(zf)){const Vt=Array.isArray(t)?t.filter(Gn=>Gn!=null):[t],Pn=Vt.length?["any",["in",["id"],["literal",Vt]],["in",["get","RevitId"],["literal",Vt]]]:["==",["id"],""];n.setFilter(zf,Pn),n.getLayer(ug)&&n.setFilter(ug,Pn)}try{const Vt=Cu(j);Vt&&isFinite(Vt[0])&&n.fitBounds([[Vt[0],Vt[1]],[Vt[2],Vt[3]]],{padding:40,duration:400})}catch{}return{summary:Ye,rooms:gn}}function Au(n){return n?n.type==="FeatureCollection"?n:n.type==="Feature"?{type:"FeatureCollection",features:[n]}:n.type==="GeometryCollection"?{type:"FeatureCollection",features:(n.geometries||[]).map(e=>({type:"Feature",geometry:e,properties:{}}))}:n.type&&n.coordinates?{type:"FeatureCollection",features:[{type:"Feature",geometry:n,properties:{}}]}:null:null}function IV(n){if(n==null)return 0;if(typeof n=="number")return n;const e=Number(String(n).replace(/,/g,""));return Number.isFinite(e)?e:0}function Rf(n={}){if(Number.isFinite(n.areaSF))return Number(n.areaSF);const e=n.Area_SF??n.Area??n["Area SF"];return e==null||e===""?null:IV(e)}function uv(){return{totalSf:0,rooms:0,classroomSf:0,classroomCount:0,labSf:0,labCount:0,officeSf:0,officeCount:0,deptCounts:new Map}}function CV(n={}){const e=B8(n)||"",t=String(e).trim().charAt(0),i=$f(n,["NCES_Type","NCES Type","NCES_Type_Code","NCES Type Code"]),c=String(i||"").trim().charAt(0),u=j8(n),m=(u?.norm||"").toLowerCase(),_=m.includes("classroom")||m.includes("lecture")||t==="1"||c==="1",o=m.includes("lab")||m.includes("laboratory")||m.includes("studio")||t==="2"||c==="2",b=u?.isOfficeText||z8(e);return _?"classroom":o?"lab":b?"office":"other"}function aw(n,e={}){if(!n)return;const t=Rf(e),i=Number.isFinite(t)?t:0;n.totalSf+=i,n.rooms+=1;const c=CV(e);c==="classroom"?(n.classroomSf+=i,n.classroomCount+=1):c==="lab"?(n.labSf+=i,n.labCount+=1):c==="office"&&(n.officeSf+=i,n.officeCount+=1);const u=oa(Xy(e));u&&n.deptCounts.set(u,(n.deptCounts.get(u)||0)+i)}function O3(n=[]){const e=uv();return n.forEach(t=>aw(e,t?.properties)),jy(e)}function jy(n){if(!n)return null;const t=Array.from((n.deptCounts||new Map).entries()).sort((c,u)=>u[1]-c[1]),i=Object.fromEntries(t);return{totalSf:n.totalSf||0,classroomSf:n.classroomSf||0,labSf:n.labSf||0,officeSf:n.officeSf||0,rooms:n.rooms||0,classroomCount:n.classroomCount||0,labCount:n.labCount||0,officeCount:n.officeCount||0,deptCounts:i,totalsByDept:i,keyDepts:t.slice(0,6).map(([c])=>c)}}function LV(n){const e=String(n||"").trim();if(!e||V3(e))return!1;const t=e.toUpperCase();return t!=="UNSPECIFIED"&&t!=="UNKNOWN"&&t!=="N/A"&&t!=="NA"}function B3(n){const t=Object.entries(n||{}).filter(([i])=>LV(i));return Object.fromEntries(t)}function Zg(n=[]){const e=(n||[]).map(TC).filter(Boolean);if(!e.length)return null;const t=O3(e);if(!t)return null;const i=B3(t.totalsByDept||t.deptCounts||{}),c=Object.entries(i).sort((u,m)=>(m[1]||0)-(u[1]||0));return{...t,deptCounts:i,totalsByDept:i,keyDepts:c.slice(0,6).map(([u])=>u)}}function PV(n=[]){const e=O3(n);if(!e)return null;const t=B3(e.totalsByDept||e.deptCounts||{}),i=Object.entries(t).sort((c,u)=>(u[1]||0)-(c[1]||0));return{...e,deptCounts:t,totalsByDept:t,keyDepts:i.slice(0,6).map(([c])=>c)}}function kV(n,e){const t=(e||"").trim().toLowerCase();if(!t||!Array.isArray(n))return null;let i=0,c=0;const u={},m={};for(const _ of n){const o=_?.properties||{};if(String(Xy(o)||"").trim().toLowerCase()!==t)continue;const I=gd(o)||"Unspecified",M=Rf(o),V=Number.isFinite(M)?M:Number(o.sf??o.SF??o.AreaSF??o.Area??o.area??o.areaSF??o["Area SF"]??0)||0;c+=1,i+=V,u[I]=(u[I]||0)+1,m[I]=(m[I]||0)+V}return{totalSF:i,rooms:c,roomTypes:u,sfByRoomType:m}}function s5(n,e=1200){return Array.isArray(n)?n.slice(0,e).map((i,c)=>{const u=String(i.buildingName??i.buildingLabel??i.building??"").trim(),m=String(i.floor??i.floorId??"").trim(),_=String(i.roomNumber??i.roomLabel??i.name??"").trim(),o=String(i.roomId??i.revitId??i.id??"").trim(),b=i.roomGuid??i.roomGUID??i.revitUniqueId??i.revitUniqueID??i["Room GUID"]??null,I=[u,m,_].filter(Boolean).join("|")||`room-${c}`,M=o||I,V=String(i.occupant??"").trim(),k=String(i.vacancy??(V?"Occupied":"Unknown")).trim();return{id:M,revitId:i.revitId??b??null,roomGuid:b,roomId:o||I,buildingLabel:u,floorId:m,floorName:m,roomLabel:_,type:String(i.type??i.roomType??"").trim(),sf:Number(i.sf??i.areaSF??i.area??0)||0,department:String(i.department??"").trim(),occupant:V,vacancy:k,occupancyStatus:V?"Occupied":"Vacant",occupantDept:String(i.department??"").trim()||null}}).filter(i=>i.id):null}function dC(n){return Array.isArray(n)?n.map(e=>({id:e?.id??e?.roomId??"",roomId:e?.roomId??e?.id??"",revitId:e?.revitId??e?.roomGuid??null,buildingLabel:e?.buildingLabel??e?.buildingName??e?.building??"",floorId:e?.floorId??e?.floorName??"",floorName:e?.floorName??e?.floorId??"",roomLabel:e?.roomLabel??e?.roomNumber??"",type:e?.type??e?.roomType??"",sf:Number(e?.sf??e?.area??e?.areaSF??0)||0,department:e?.department??""})).filter(e=>e.id||e.roomId):[]}function fC(n,e={}){if(!Array.isArray(n)||n.length===0)return[];const t=Number.isFinite(e.maxTotal)?e.maxTotal:700,i=Number.isFinite(e.maxPerBuilding)?e.maxPerBuilding:120,c=Number.isFinite(e.maxPerType)?e.maxPerType:30,u=dC(n);if(u.length<=t)return u;const m=new Map;for(const I of u){const M=po(I.buildingLabel||""),V=hg(I.type||"")||"other";m.has(M)||m.set(M,new Map);const k=m.get(M);k.has(V)||k.set(V,[]),k.get(V).push(I)}const _=[],o=(I,M)=>{if(!(!Array.isArray(I)||M<=0)){I.sort((V,k)=>(Number(k.sf)||0)-(Number(V.sf)||0));for(const V of I.slice(0,M))if(_.push(V),_.length>=t)return}};for(const[,I]of m.entries()){if(_.length>=t)break;let M=0;for(const V of I.values()){if(_.length>=t)break;const k=i-M;if(k<=0)break;const ie=Math.min(c,k);o(V,ie),M+=Math.min(V.length,ie)}}if(_.length>=t)return _.slice(0,t);const b=new Set(_.map(I=>I.id||I.roomId));for(const I of u){if(_.length>=t)break;const M=I.id||I.roomId;b.has(M)||(_.push(I),b.add(M))}return _.slice(0,t)}function RV(n=[]){const e={totalSF:0,rooms:0,roomTypes:{},sfByRoomType:{}};return(n||[]).forEach(t=>{const i=Number(t?.sf??0)||0,c=oa(t?.type??t?.roomType??"Unknown")||"Unknown";e.rooms+=1,e.totalSF+=i,e.roomTypes[c]=(e.roomTypes[c]||0)+1,e.sfByRoomType[c]=(e.sfByRoomType[c]||0)+i}),e}function MV(n,e,t={}){if(!Array.isArray(n)||!e)return n||[];const i=Number.isFinite(t.maxTotal)?t.maxTotal:180,c=Number.isFinite(t.minPerType)?t.minPerType:4,u=Number.isFinite(t.maxPerType)?t.maxPerType:30,m=e?.sfByRoomType||{},_=e?.roomTypes||{},o=Number(e?.totalSF??0)||0,b=Number(e?.rooms??0)||0,I=Object.entries(m).map(([J,ne])=>{const me=hg(J),ue=Number(ne||0)||0,ke=Number(_[J]||0)||0;return{key:me,label:J,sf:ue,count:ke}}).filter(J=>J.key);if(!I.length)return fC(n,{maxTotal:i,maxPerBuilding:i,maxPerType:u});I.sort((J,ne)=>(ne.sf||0)-(J.sf||0));const M=new Map;I.forEach(J=>{const ne=o>0?J.sf/o:0,me=b>0?J.count/b:0,ue=Math.round(ne*i),ke=Math.round(me*i),je=Math.max(c,ue,ke);M.set(J.key,Math.min(u,je))});const V=new Map;n.forEach(J=>{const ne=hg(J?.type??J?.roomType??"")||"other";V.has(ne)||V.set(ne,[]),V.get(ne).push(J)}),V.forEach(J=>J.sort((ne,me)=>(Number(me.sf)||0)-(Number(ne.sf)||0)));const k=[],ie=new Set,se=J=>{const ne=String(J?.roomId??J?.id??J?.revitId??"");!ne||ie.has(ne)||(k.push(J),ie.add(ne))};for(const J of I){if(k.length>=i)break;const ne=V.get(J.key)||[],me=M.get(J.key)||0;let ue=0;for(const ke of ne){if(k.length>=i||ue>=me)break;se(ke),ue+=1}}if(k.length>=i)return k.slice(0,i);const fe=[];V.forEach(J=>J.forEach(ne=>{const me=String(ne?.roomId??ne?.id??ne?.revitId??"");!me||ie.has(me)||fe.push(ne)})),fe.sort((J,ne)=>(Number(ne.sf)||0)-(Number(J.sf)||0));for(const J of fe){if(k.length>=i)break;se(J)}return k.slice(0,i)}function YA(n,e,t,i={}){if(!t||!Array.isArray(e))return{candidates:n||[],added:0};const c=Number(t.totalSF??0)||0;if(!c)return{candidates:n||[],added:0};const u=Number.isFinite(i.targetTolerance)?i.targetTolerance:.1,m=c*(1-u),_=Number.isFinite(i.maxCandidates)?i.maxCandidates:25,o=i.primaryBuilding||"",b=Array.isArray(n)?[...n]:[],I=RV(b);if(I.totalSF>=m||b.length>=_)return{candidates:b,added:0};const M=new Set(b.map(J=>String(J?.roomId??J?.id??J?.revitId??""))),V=new Map;e.forEach(J=>{const ne=String(J?.roomId??J?.id??J?.revitId??"");if(!ne||M.has(ne))return;const me=hg(J?.type??J?.roomType??"")||"other";V.has(me)||V.set(me,[]),V.get(me).push(J)}),V.forEach(J=>J.sort((ne,me)=>pC(ne,me,o)));const k=Object.entries(t.sfByRoomType||{}).map(([J,ne])=>({key:hg(J),label:J,sf:Number(ne||0)||0})).filter(J=>J.key);k.sort((J,ne)=>{const me=Gv(J.label),ue=Gv(ne.label);return me!==ue?me-ue:(ne.sf||0)-(J.sf||0)});const ie=k.map(J=>J.key);let se=0;const fe=(J,ne)=>!J||b.length>=_?!1:(b.push({roomId:J?.roomId??J?.id??"",id:J?.id??J?.roomId??"",revitId:J?.revitId??J?.roomGuid??null,buildingLabel:J?.buildingLabel??"",floorId:J?.floorId??J?.floorName??"",floorName:J?.floorName??J?.floorId??"",roomLabel:J?.roomLabel??"",type:J?.type??"",sf:Number(J?.sf??0)||0,rationale:ne||"Added to reach baseline target."}),I.totalSF+=Number(J?.sf??0)||0,se+=1,!0);for(const J of ie){if(I.totalSF>=m||b.length>=_)break;const ne=V.get(J)||[];for(;ne.length&&I.totalSF<m&&b.length<_;){const me=ne.shift();fe(me,"Added to better match baseline room-type mix.")}}if(I.totalSF<m&&b.length<_){const J=[];V.forEach(me=>me.forEach(ue=>J.push(ue)));const ne=mC(J,o);for(const me of ne){if(I.totalSF>=m||b.length>=_)break;fe(me,"Added to reach baseline total SF.")}}return{candidates:b,added:se}}function a5(n){return n&&String(n).replace(/^\s*vacant\s*[:\-]\s*/i,"").replace(/^\s*vacant\?\s*[:\-]\s*/i,"").replace(/\bvacancy status\b/ig,"availability").replace(/\bvacant\b/ig,"available")}const Gv=n=>{const e=String(n??"").toLowerCase();return e?/(office|workstation|admin|faculty|staff|suite|open office)/i.test(e)?0:/(lab|laboratory|studio|shop|clinic|research)/i.test(e)?2:/(classroom|lecture|seminar|training|teaching)/i.test(e)?3:1:1},JA=n=>/(lab|laboratory|studio|shop|clinic|research)/i.test(String(n??"")),QA=n=>/(classroom|lecture|seminar|training|teaching)/i.test(String(n??"")),eT=n=>po(n?.buildingLabel??n?.buildingName??n?.building??""),pC=(n,e,t)=>{const i=po(t||""),c=eT(n),u=eT(e);if(i){const I=c===i;if(I!==(u===i))return I?-1:1}const m=Number(n?.sf??n?.area??n?.areaSF??0)||0,_=Number(e?.sf??e?.area??e?.areaSF??0)||0;if(m!==_)return _-m;const o=Gv(n?.type??n?.roomType??""),b=Gv(e?.type??e?.roomType??"");return o!==b?o-b:0},mC=(n,e)=>{if(!Array.isArray(n))return[];const t=[...n];return t.sort((i,c)=>pC(i,c,e)),t},tT=(n=[])=>{if(!Array.isArray(n)||!n.length)return"";const e=new Map;return n.forEach(t=>{const i=oa(t?.buildingLabel||"");if(!i)return;const c=Number(t?.sf??t?.area??t?.areaSF??0)||0;e.set(i,(e.get(i)||0)+c)}),Array.from(e.entries()).sort((t,i)=>i[1]-t[1])[0]?.[0]||""};function Wu(n,e){try{const t=n?.getSource(e);return t&&typeof t.setData=="function"?t:null}catch{return null}}function NV(n,e="",t="",i=1200){return Array.isArray(n)?n.slice(0,i).map((c,u)=>{const m=c?.properties||{},_=c?.id??m.RevitId??m.id??m.roomId??m.RoomId,o=String(m.roomNumber??m.RoomNumber??m.Number??m.Room??m.Name??"").trim(),b=gd(m)||"Unknown",I=String(m.department??m.Department??m.Dept??"").trim(),M=String(m.occupant??m.Occupant??"").trim(),V=Rf(m),k=Number.isFinite(V)?V:Number(m.sf??m.SF??m.AreaSF??m.Area??m.area??0)||0,ie=[e,t||m.Floor,o||u].filter(Boolean).join("|")||`feat-${u}`,se=String(_??"").trim()||ie;return{id:se,revitId:m.RevitId??_??null,roomId:se,buildingLabel:e||String(m.buildingLabel??m.Building??m.building??"").trim(),floorId:t||String(m.floorId??m.floor??m.Floor??"").trim(),floorName:t||String(m.floorId??m.floor??m.Floor??"").trim(),roomLabel:o,type:b,sf:k,department:I,occupant:M,vacancy:M?"Occupied":"Unknown",occupancyStatus:M?"Occupied":"Vacant",occupantDept:I||null}}).filter(c=>c.id):null}const nT=async(n,e)=>{const{ensureFloorsForBuilding:t,buildFloorUrl:i,floorCache:c,fetchGeoJSON:u}=e||{},m=(n||"").trim();if(!m)return{perBuilding:{},campusTotals:null};const _=m.toLowerCase(),o={},b={totalSF:0,rooms:0,roomTypes:{},sfByRoomType:{}};for(const I of md){const M=I?.name;if(!M)continue;let V=await t(M);if(!V?.length)continue;const k={totalSF:0,rooms:0,roomTypes:{},sfByRoomType:{}};for(const ie of V){const se=i(M,ie);if(!se)continue;let fe=c.get(se);if(!fe)try{fe=await u(se),fe&&c.set(se,fe)}catch{continue}const J=Au(fe),ne=kV(J?.features||[],_);ne&&(k.totalSF+=ne.totalSF||0,k.rooms+=ne.rooms||0,Object.entries(ne.roomTypes||{}).forEach(([me,ue])=>{k.roomTypes[me]=(k.roomTypes[me]||0)+ue}),Object.entries(ne.sfByRoomType||{}).forEach(([me,ue])=>{k.sfByRoomType[me]=(k.sfByRoomType[me]||0)+ue}))}(k.rooms||k.totalSF)&&(o[M]=k,b.totalSF+=k.totalSF,b.rooms+=k.rooms,Object.entries(k.roomTypes||{}).forEach(([ie,se])=>{b.roomTypes[ie]=(b.roomTypes[ie]||0)+se}),Object.entries(k.sfByRoomType||{}).forEach(([ie,se])=>{b.sfByRoomType[ie]=(b.sfByRoomType[ie]||0)+se}))}return!b.rooms&&!b.totalSF?{perBuilding:{},campusTotals:null}:{perBuilding:o,campusTotals:b}};function Hu(n,e){if(!n)return{loading:!1,mode:e,totalSf:"-",classroomSf:"-",rooms:"-",classroomCount:"-",labSf:"-",officeSf:"-",labCount:"-",officeCount:"-",deptCount:"-",keyDepts:[]};const t=u=>Number.isFinite(u)?Math.round(u).toLocaleString():"-",i=u=>Number.isFinite(u)?Number(u).toLocaleString():"-",c=n.deptCounts?Object.keys(n.deptCounts).length:0;return{loading:!1,mode:e,totalSf:t(n.totalSf),classroomSf:t(n.classroomSf),labSf:t(n.labSf),officeSf:t(n.officeSf),rooms:i(n.rooms),classroomCount:i(n.classroomCount),labCount:i(n.labCount),officeCount:i(n.officeCount),deptCount:c?c.toString():"-",keyDepts:n.keyDepts||[]}}function DV(n,e){try{if(!n||!Array.isArray(n.features)||n.features.length===0)return n;const t=e?.type==="Feature"?e:e?.type?{type:"Feature",properties:{},geometry:e}:null;if(!t)return n;const i=t_(t);if(i){const Ne={rotationDeg:0,rotationPivot:null,scale:1,scaleOrigin:null,translateKm:0,translateBearing:0,nudgeMeters:null,refineRotationDeg:0,refineRotationPivot:null,snapCorner:i},we=$V(t),Fe=VV(t),nt=Array.isArray(Fe)?Fe[0]:null,xe=Array.isArray(Fe)?Fe[1]:null,le=!!(nt&&xe),De=qV(t);let Be=n,Ye=Ml(n);if(we!=="none"&&!le){const ht=lw(n,t);if(Number.isFinite(ht)&&Math.abs(ht)>1.5){const Ct=Ye?.geometry?.coordinates||null;Ne.rotationDeg=ht,Ne.rotationPivot=Ct;const Mt=Yh(n,ht,Ct?{pivot:Ct}:void 0);Mt?.features?.length&&(Be=Mt,Ye=Ml(Be))}}const[rt,mt,ft,Dt]=Cu(Be),[Yt,cn,gn,Mn]=Cu(t);if(![rt,mt,ft,Dt,Yt,cn,gn,Mn].every(Number.isFinite))return n;const Gt=Math.max(1e-9,ft-rt),st=Math.max(1e-9,Dt-mt),mr=Math.max(1e-9,gn-Yt),Er=Math.max(1e-9,Mn-cn),Ln=u5(t)==="directional",ir=Ln?Yp(Be):Zp([rt,mt,ft,Dt]),er=Ln?Yp(t):Zp([Yt,cn,gn,Mn]);let Yr=null,Vt=0,Pn=null,Gn=null,Dn=null,Mr=null;if(nt&&xe&&ir&&er&&(Pn=ir[nt],Gn=ir[xe],Dn=er[nt],Mr=er[xe],Pn&&Gn&&Dn&&Mr)){const ht=Mf(ms(Pn),ms(Gn),{units:"kilometers"}),Ct=Mf(ms(Dn),ms(Mr),{units:"kilometers"});Number.isFinite(ht)&&Number.isFinite(Ct)&&ht>0&&(Yr=Ct/ht);const Mt=Hm(ms(Pn),ms(Gn)),Et=(Hm(ms(Dn),ms(Mr))-Mt+540)%360-180;Number.isFinite(Et)&&(Vt=Et)}const wr=Pn||Ye?.geometry?.coordinates||null;Ne.scaleOrigin=wr;const Tr=.96,Ir=oT(t),Pr=Math.min(mr/Gt,Er/st)*Tr,Ei=De!=="legacy"&&Number.isFinite(Yr)&&Yr>0,Pi=(Ei?Yr:Pr)*Ir,oi=Ei||Math.abs(Ir-1)>1e-6||Pi<.9||Pi>1.1;Ne.scale=oi?Pi:1;let Kr=oi?cg(Be,Pi,wr?{origin:wr}:void 0):Be;const Br=UV(t),di=(Number.isFinite(Vt)?Vt:0)+(Number.isFinite(Br)?Br:0);le&&De!=="legacy"&&Number.isFinite(di)&&Math.abs(di)>1e-6&&Array.isArray(wr)&&(Kr=Yh(Kr,di,{pivot:wr}),Ne.rotationDeg=di,Ne.rotationPivot=wr);const si=Ln?null:Cu(Kr),ut=Ln?Yp(Kr):Zp(si),Ee=er||(Ln?Yp(t):Zp([Yt,cn,gn,Mn]));if(ut&&Ee){const ht=nt===i&&xe,Ct=ht?ut[nt]:ut[i],Mt=ht?Ee[nt]:Ee[i];if(Ct&&Mt){const Bt=ms(Ct),Et=ms(Mt),Pt=Mf(Bt,Et,{units:"kilometers"}),vn=Hm(Bt,Et);Number.isFinite(Pt)&&Number.isFinite(vn)&&(Kr=Pt>0?Ym(Kr,Pt,vn,{units:"kilometers"}):Kr,Ne.translateKm=Pt,Ne.translateBearing=vn)}if(le&&ht&&De!=="legacy"&&De!=="match"){const Bt=ut[nt],Et=Ee[nt];if(Bt&&Et){const Pt=Mf(ms(Bt),ms(Et),{units:"kilometers"}),vn=Hm(ms(Bt),ms(Et));Number.isFinite(Pt)&&Number.isFinite(vn)&&Pt>1e-9&&(Kr=Ym(Kr,Pt,vn,{units:"kilometers"}),Ne.translateKm=(Ne.translateKm||0)+Pt,Ne.translateBearing=vn)}}}const Ie=Dn||Ee?.[i]||null;if(le&&De==="legacy"&&Number.isFinite(di)&&Math.abs(di)>1e-6&&Ie&&(Kr=Yh(Kr,di,{pivot:Ie}),Ne.refineRotationDeg=(Ne.refineRotationDeg||0)+di,Ne.refineRotationPivot=Ie),Ie&&we!=="none"&&!le){const ht=iT(Kr,t,Ie,{maxDeg:6,stepDeg:.4,fineStep:.1,fineWindow:1.5,hullLimit:1200});ht?.fc&&(Kr=ht.fc),Ne.refineRotationDeg=ht?.angle||0,Ne.refineRotationPivot=Ie}le||Number.isFinite(Br)&&Math.abs(Br)>1e-6&&Ie&&(Kr=Yh(Kr,Br,{pivot:Ie}),Ne.refineRotationDeg=(Ne.refineRotationDeg||0)+Br,Ne.refineRotationPivot=Ie);const Qe=GV(t);return Array.isArray(Qe)&&(Kr=F3(Kr,Qe),Ne.nudgeMeters=Qe),Kr&&typeof Kr=="object"&&(Kr.__mfFitted=!0,Kr.__mfFittedBuilding=t?.properties?.id||t?.properties?.name||"",Kr.__mfFitTransform=Ne,n.__mfAffineApplied&&(Kr.__mfAffineApplied=n.__mfAffineApplied),n.__mfRotationOverride!=null&&(Kr.__mfRotationOverride=n.__mfRotationOverride),n.__mfRotationPivot&&(Kr.__mfRotationPivot=n.__mfRotationPivot),n.__mfFitTransformApplied&&(Kr.__mfFitTransformApplied=n.__mfFitTransformApplied)),Kr}let c=Ml(n);const u=Ml(t),m={rotationDeg:0,rotationPivot:null,scale:1,scaleOrigin:null,translateKm:0,translateBearing:0,nudgeMeters:null,refineRotationDeg:0,refineRotationPivot:null},_=lw(n,t);if(Number.isFinite(_)&&Math.abs(_)>1.5){const Ne=c?.geometry?.coordinates||null;m.rotationDeg=_,m.rotationPivot=Ne;const we=Yh(n,_,Ne?{pivot:Ne}:void 0);we?.features?.length&&(n=we,c=Ml(n))}const[o,b,I,M]=Cu(n),[V,k,ie,se]=Cu(t),fe=Math.max(1e-9,I-o),J=Math.max(1e-9,M-b),ne=Math.max(1e-9,ie-V),me=Math.max(1e-9,se-k),ue=.96,ke=oT(t),je=Math.min(ne/fe,me/J)*ue*ke,pe=je<.9||je>1.1,U=c?.geometry?.coordinates||null;m.scale=pe?je:1,m.scaleOrigin=U;let F=pe?cg(n,je,U?{origin:U}:void 0):n;const q=Cu(F),j=[(V+ie)/2,(k+se)/2],H=Array.isArray(q)&&q.length===4&&q.every(Ne=>Number.isFinite(Ne)),Z=Number.isFinite(j[0])&&Number.isFinite(j[1]);if(i&&H){const we=u5(t)==="directional",Fe=we?Yp(F):Zp(q),nt=we?Yp(t):Zp([V,k,ie,se]);if(Fe&&nt){const xe=Fe[i],le=nt[i];if(xe&&le){const De=ms(xe),Be=ms(le),Ye=Mf(De,Be,{units:"kilometers"}),rt=Hm(De,Be);Number.isFinite(Ye)&&Number.isFinite(rt)&&(F=Ye>0?Ym(F,Ye,rt,{units:"kilometers"}):F,m.translateKm=Ye,m.translateBearing=rt,m.snapCorner=i)}}}else{const Ne=[],we=(Fe,nt,xe)=>{if(!Array.isArray(nt)||!Array.isArray(xe))return;const le=ms(nt),De=ms(xe),Be=Mf(le,De,{units:"kilometers"}),Ye=Hm(le,De);if(!Number.isFinite(Be)||!Number.isFinite(Ye))return;const rt=Be>0?Ym(F,Be,Ye,{units:"kilometers"}):F,mt=um(rt,1200),ft=mt?e_(mt,t):0;Ne.push({label:Fe,distKm:Be,bearing:Ye,fc:rt,score:ft})};if(H&&Z){const Fe=[(q[0]+q[2])/2,(q[1]+q[3])/2];we("center",Fe,j);const xe=u5(t)==="directional",le=xe?Yp(F):Zp(q),De=xe?Yp(t):Zp([V,k,ie,se]);le&&De&&Object.keys(le).forEach(Be=>{we(`corner-${Be}`,le[Be],De[Be])})}else we("centroid",c?.geometry?.coordinates,u?.geometry?.coordinates);if(Ne.length){const Fe=Ne.reduce((nt,xe)=>!nt||xe.score>nt.score+1e-6||Math.abs(xe.score-nt.score)<=1e-6&&xe.distKm<nt.distKm?xe:nt,null);Fe?.fc&&(F=Fe.fc,m.translateKm=Fe.distKm,m.translateBearing=Fe.bearing)}}const be=u?.geometry?.coordinates||j,Re=iT(F,t,be,{maxDeg:6,stepDeg:.4,fineStep:.1,fineWindow:1.5,hullLimit:1200}),Oe=Re?.fc||F;return m.refineRotationDeg=Re?.angle||0,m.refineRotationPivot=be,Oe&&typeof Oe=="object"&&(Oe.__mfFitted=!0,Oe.__mfFittedBuilding=t?.properties?.id||t?.properties?.name||"",Oe.__mfFitTransform=m,n.__mfAffineApplied&&(Oe.__mfAffineApplied=n.__mfAffineApplied),n.__mfRotationOverride!=null&&(Oe.__mfRotationOverride=n.__mfRotationOverride),n.__mfRotationPivot&&(Oe.__mfRotationPivot=n.__mfRotationPivot),n.__mfFitTransformApplied&&(Oe.__mfFitTransformApplied=n.__mfFitTransformApplied)),Oe}catch{return n}}function Nd(n,e=1/0){const t=[];function i(c){if(!(!c||t.length>=e)){if(typeof c[0]=="number"){t.push([c[0],c[1]]);return}for(const u of c){if(t.length>=e)break;i(u)}}}return n?.type==="GeometryCollection"?(n.geometries||[]).forEach(c=>i(c.coordinates)):i(n?.coordinates),t}function s0(n,e=1/0){if(!n)return[];if(n.type==="FeatureCollection"){const t=[];for(const i of n.features||[]){if(t.length>=e)break;const c=Nd(i.geometry,e-t.length);c?.length&&t.push(...c)}return t}return n.type==="Feature"?Nd(n.geometry,e):n.type?Nd(n,e):[]}function gC(n){if(!Array.isArray(n)||n.length<2)return 0;let e=0,t=0;n.forEach(([_,o])=>{e+=_,t+=o}),e/=n.length,t/=n.length;let i=0,c=0,u=0;return n.forEach(([_,o])=>{const b=_-e,I=o-t;i+=b*b,c+=I*I,u+=b*I}),!Number.isFinite(i)||!Number.isFinite(c)||!Number.isFinite(u)?0:.5*Math.atan2(2*u,i-c)*180/Math.PI}function Jm(n){return Array.isArray(n)&&n.length>=2&&typeof n[0]=="number"&&typeof n[1]=="number"}function z3(n,e){if(Array.isArray(n)){if(n.length&&Jm(n[0])){e.push(n);return}n.forEach(t=>z3(t,e))}}function h0(n){if(!n?.coordinates)return null;const e=[];z3(n.coordinates,e);let t=0,i=null;const c=(u,m)=>Math.abs(u[0]-m[0])<1e-9&&Math.abs(u[1]-m[1])<1e-9;return e.forEach(u=>{if(!Array.isArray(u)||u.length<2)return;for(let o=0;o<u.length-1;o+=1){const b=u[o],I=u[o+1];if(!Jm(b)||!Jm(I))continue;const M=I[0]-b[0],V=I[1]-b[1],k=Math.hypot(M,V);k>t&&(t=k,i=Math.atan2(V,M)*180/Math.PI)}const m=u[u.length-1],_=u[0];if(Jm(m)&&Jm(_)&&!c(m,_)){const o=_[0]-m[0],b=_[1]-m[1],I=Math.hypot(o,b);I>t&&(t=I,i=Math.atan2(b,o)*180/Math.PI)}}),i}function rT(n){if(!n?.coordinates)return null;const e=[];z3(n.coordinates,e);let t=0,i=0,c=0;return e.forEach(m=>{if(!(!Array.isArray(m)||m.length<2))for(let _=0;_<m.length-1;_+=1){const o=m[_],b=m[_+1];if(!Jm(o)||!Jm(b))continue;const I=b[0]-o[0],M=b[1]-o[1],V=Math.hypot(I,M);if(V<=0)continue;const k=Math.atan2(M,I);i+=V*Math.cos(2*k),t+=V*Math.sin(2*k),c+=V}}),c<=0?null:.5*Math.atan2(t,i)*180/Math.PI}function hv(n){let e=(n+180)%360-180;return e>90&&(e-=180),e<-90&&(e+=180),e}function FV(n,e=2e3){if(!n?.geometry)return 0;const t=Nd(n.geometry,e);return gC(t)}function OV(n,e=4e3){if(!n?.features?.length)return 0;const t=[];for(const i of n.features){if(t.length>=e)break;const c=Nd(i.geometry,e-t.length);c?.length&&t.push(...c)}return gC(t)}function um(n,e=3e3){if(!n?.features?.length)return null;const t=[];for(const u of n.features){if(t.length>=e)break;const m=Nd(u.geometry,e-t.length);m?.length&&t.push(...m)}if(t.length<3)return null;const i=t.map(u=>ms(u));return x8(E3(i))||null}function lw(n,e){const t=um(n),i=h0(t?.geometry),c=h0(e?.geometry),u=OV(n),m=FV(e),_=rT(t?.geometry),o=rT(e?.geometry),b=[];return Number.isFinite(i)&&Number.isFinite(c)&&b.push(hv(c-i)),Number.isFinite(u)&&Number.isFinite(m)&&b.push(hv(m-u)),Number.isFinite(_)&&Number.isFinite(o)&&b.push(hv(o-_)),b.length?b.length===1?b[0]:(b.sort((I,M)=>I-M),b[Math.floor(b.length/2)]):null}function e_(n,e){try{const t=k8(E3([n,e]));if(!t)return 0;const i=mA(t),c=mA(n);return!Number.isFinite(i)||!Number.isFinite(c)||c<=0?0:i/c}catch{return 0}}function iT(n,e,t,i={}){if(!n||!e||!t)return{fc:n,angle:0};const c=Number.isFinite(i.maxDeg)?i.maxDeg:5,u=Number.isFinite(i.stepDeg)?i.stepDeg:.5,m=Number.isFinite(i.fineStep)?i.fineStep:.1,_=Number.isFinite(i.fineWindow)?i.fineWindow:1.2,o=um(n,i.hullLimit||1200);if(!o)return{fc:n,angle:0};const b=e_(o,e);let I=0,M=b;for(let k=-c;k<=c;k+=u){if(Math.abs(k)<1e-6)continue;const ie=Yh(o,k,{pivot:t}),se=e_(ie,e);se>M+1e-4&&(M=se,I=k)}if(m>0&&_>0){const k=I-_,ie=I+_;for(let se=k;se<=ie;se+=m){if(Math.abs(se)<1e-6)continue;const fe=Yh(o,se,{pivot:t}),J=e_(fe,e);J>M+1e-4&&(M=J,I=se)}}if(Math.abs(I)<.001)return{fc:n,angle:0};const V=Yh(n,I,{pivot:t});return{fc:V?.features?.length?V:n,angle:I}}function BV(n){let e=1/0,t=1/0,i=-1/0,c=-1/0;return(n?.features||[]).forEach(u=>{Nd(u.geometry).forEach(([m,_])=>{m<e&&(e=m),_<t&&(t=_),m>i&&(i=m),_>c&&(c=_)})}),[e,t,i,c]}function Zp(n){if(!Array.isArray(n)||n.length!==4)return null;const[e,t,i,c]=n;return[e,t,i,c].every(Number.isFinite)?{nw:[e,c],ne:[i,c],sw:[e,t],se:[i,t]}:null}function Yp(n,e=4e3){let t=n;if(n?.type==="FeatureCollection"){const m=um(n,e);m?.geometry&&(t=m)}const i=s0(t,e);if(!i.length)return null;const c={nw:[-1,1],ne:[1,1],sw:[-1,-1],se:[1,-1]},u={nw:{score:-1/0,pt:null},ne:{score:-1/0,pt:null},sw:{score:-1/0,pt:null},se:{score:-1/0,pt:null}};for(const[m,_]of i)if(!(!Number.isFinite(m)||!Number.isFinite(_)))for(const o of Object.keys(c)){const[b,I]=c[o],M=m*b+_*I;M>u[o].score&&(u[o]={score:M,pt:[m,_]})}return{nw:u.nw.pt,ne:u.ne.pt,sw:u.sw.pt,se:u.se.pt}}function ei(n){return String(n||"").replace(/\u00a0/g," ").trim().toLowerCase().replace(/\bthe\b/g,"").replace(/\bmemorial\b/g,"").replace(/\bresidence\b/g,"").replace(/\bresidency\b/g,"").replace(/\b[a-z]\b/g,"").replace(/theatre/g,"theater").replace(/centre/g,"center").replace(/[^a-z0-9]/g,"")}const D_=[{keys:["Morrison Reeves","Morrison-Reeves Science Center"],corner:"nw",cornerMethod:"directional",cornerPair:["nw","sw"],pairMode:"match",rotationMode:"none"},{keys:["Calvin French Chapel","Calvin H. French Chapel","French Memorial Chapel"],corner:"nw",cornerMethod:"directional",cornerPair:["nw","sw"],pairMode:"match"}];function F_(n,e){const t={};return n.forEach(i=>{!i||!i.keys||i[e]==null||i.keys.forEach(c=>{const u=ei(c);u&&(t[u]=i[e])})}),t}const zV=new Set([]),cw=new Set([ei("Calvin French Chapel"),ei("Calvin H. French Chapel"),ei("Calvin H. French Memorial Chapel"),ei("Kiewit Building"),ei("Taylor Hall"),ei("Taylor Hall Residence")]);function jV({buildingLabel:n}={}){const e=ei(n);return e&&zV.has(e)}let l5=null;async function c5(){if(l5)return l5;try{const n=[Qd("Hastings_College_Buildings.json"),"/Hastings_College_Buildings.json","Hastings_College_Buildings.json"],e=await eC(n);if(e?.ok&&e.data&&Array.isArray(e.data.features))return l5=e.data,e.data}catch{}return null}function Md(n){const t=(()=>{try{return decodeURIComponent(String(n||""))}catch{return String(n||"")}})().split("/").filter(Boolean);if(!t.length)return"";const i=t.indexOf("floorplans");return i>=0&&t.length>i+2?t[i+2]:t[t.length-1]||""}function t_(n){if(!n)return null;const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const c=ei(i);if(c&&aT[c])return aT[c]}return null}function UV(n){if(!n)return null;const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const c=ei(i);if(c&&Number.isFinite(lT[c]))return lT[c]}return null}function u5(n){if(!n)return"bbox";const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const c=ei(i);if(c&&cT[c])return cT[c]}return"bbox"}function VV(n){if(!n)return null;const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const c=ei(i);if(c&&uT[c])return uT[c]}return null}function qV(n){if(!n)return"match";const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const c=ei(i);if(c&&hT[c])return hT[c]}return"match"}function $V(n){if(!n)return"auto";const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const c=ei(i);if(c&&dT[c])return dT[c]}return"auto"}function oT(n){if(!n)return 1;const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const c=ei(i),u=JV[c];if(c&&Number.isFinite(u))return u}return 1}function GV(n){if(!n)return null;const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const c=ei(i),u=QV[c];if(c&&Array.isArray(u)&&u.length>=2)return u}return null}function Cf(n=[],e){if(!Array.isArray(n)||!n.length||!e)return null;const t=ei(e);if(!t)return null;let i=null,c=0;for(const u of n){const m=u?.properties||{},_=[ei(m.id),ei(m.name),ei(m.Name),ei(m.buildingId),ei(m.buildingName),ei(m.Building),ei(m.building)].filter(Boolean);for(const o of _){if(!o)continue;const b=o===t,I=o.includes(t)||t.includes(o);if(!b&&!I)continue;const M=o.length;M>c&&(i=u,c=M)}}return i}function HV(n,e){try{if(!n||!n.features?.length||!e||n.__mfGeoreferenced||n.__mfNoFit)return!1;const t=ei(e?.properties?.id||e?.properties?.name||"");if(t&&cw.has(t)||t_(e))return!0;if(n?.__mfFitted)return!1;const[i,c,u,m]=Cu(n),[_,o,b,I]=Cu(e);if(![i,c,u,m,_,o,b,I].every(Number.isFinite))return!1;const M=Math.max(1e-9,u-i),V=Math.max(1e-9,m-c),k=Math.max(1e-9,b-_),ie=Math.max(1e-9,I-o),se=Math.min(k/M,ie/V),fe=se<.75||se>1.35,J=Ml(n),ne=Ml(e),me=Mf(J,ne,{units:"kilometers"}),ue=Number.isFinite(me)&&me>.06,ke=Mf(ms([_,o]),ms([b,I]),{units:"kilometers"}),pe=(Number.isFinite(me)&&Number.isFinite(ke)&&ke>0?me/ke:0)>.18,U=u<_||i>b||m<o||c>I,F=lw(n,e),q=Number.isFinite(F)&&Math.abs(F)>1.5,j=um(n,1200),H=j?e_(j,e):1,Z=H>0&&H<.85;return fe||ue||U||q||pe||Z}catch{return!1}}const md=[{name:"Hurley-McDonald Hall",folder:"HurleyMcDonald"},{name:"Gray Center",folder:"Gray Center"},{name:"Morrison-Reeves Science Center",folder:"Morrison Reeves"},{name:"1882",folder:"1882"},{name:"Altman Hall",folder:"Altman Hall"},{name:"Babcock Hall",folder:"Babcock Hall"},{name:"Barrett Alumni",folder:"Barrett Alumni"},{name:"Batchelder Services Bldg",folder:"Batchelder"},{name:"Bronc Hall",folder:"Bronc Hall"},{name:"Bronco Village Apt 911",folder:"Bronco Village Apt 911"},{name:"Bronco Village Apt 915",folder:"Bronco Village Apt 915"},{name:"Bronco Village Apt 917",folder:"Bronco Village Apt 917"},{name:"Bronco Village Apt 919",folder:"Bronco Village Apt 919"},{name:"Bronco Village Apt 921",folder:"Bronco Village Apt 921"},{name:"Bronco Village Apt 923",folder:"Bronco Village Apt 923"},{name:"Calvin H. French Chapel",folder:"Calvin French Chapel"},{name:"Daugherty Student Engagement Center",folder:"Daugherty"},{name:"Farrell-Fleharty",folder:"Fleharty"},{name:"Hazelrigg Student Union",folder:"Hazzelrig"},{name:"Jackson Dinsdale Art Center",folder:"Jackson Dinsdale"},{name:"Kiewit Building",folder:"Kiewit"},{name:"Lloyd Wilson Stadium",folder:"Lloyd Wilson Stadium"},{name:"McCormick Hall",folder:"McCormick"},{name:"Perkins Library",folder:"Perkins"},{name:"Physical Fitness Facility",folder:"Physical Fitness Facility"},{name:"Scott Studio Theater",folder:"Scott Theater"},{name:"Stone Health Center",folder:"Stone Health Center"},{name:"Taylor Hall",folder:"Taylor Hall"},{name:"Wilson Center",folder:"WilsonCenter"}],rm=Object.fromEntries(md.map(n=>[n.name,n.folder])),yC=new Set(md.map(n=>n.folder)),d0=Object.fromEntries(md.map(n=>[n.folder,n.name])),_C=n=>String(n||"").replace(/\u00a0/g," ").trim().toLowerCase().replace(/theatre/g,"theater").replace(/centre/g,"center").replace(/\bmemorial\b/g,""),g_=n=>_C(n).replace(/[^a-z0-9]/g,""),uw=n=>_C(n).replace(/\b[a-z]\b/gi,"").replace(/[^a-z0-9]/g,""),WV=n=>{if(!n)return null;const e=g_(n);if(!e)return null;const t=xC?.[e];if(t&&rm[t])return t;for(const i of Object.keys(rm))if(g_(i)===e)return i;return null},Lf=n=>{if(!n)return null;if(rm[n])return n;if(yC.has(n))return d0[n]||null;const e=j3[n];if(e&&rm[e])return e;const t=g_(n),i=uw(n),c=t&&xC?.[t]||i&&KV?.[i]||null;if(c&&rm[c])return c;let u=null,m=0;for(const _ of Object.keys(rm)){const o=g_(_),b=uw(_),I=t===o||i===b,M=t&&o&&(t.includes(o)||o.includes(t))||i&&b&&(i.includes(b)||b.includes(i));if(!I&&!M)continue;const V=o.length;V>m&&(u=_,m=V)}return u},vC={1882:"The 1882 Residence Hall","Altman Hall":"Altman Hall Residency","Babcock Hall":"Babcock Hall Residence","Barrett Alumni":"Barrett Alumni Center","Batchelder Services Bldg":"Batchelder General Services","Bronc Hall":"Bronc Hall Residence","Hurley-McDonald Hall":"hurley_mcdonald","Gray Center":"gray_center","Hazelrigg Student Union":"Hazelrigg Student Union","Lloyd Wilson Stadium":"Lloyd Wilson Field/Stadium","Morrison-Reeves Science Center":"morrison_reeves","Scott Studio Theater":"Scott Studio Theatre","Stone Health Center":"The Stone Health Center","Taylor Hall":"Taylor Hall Residence","Wilson Center":"wilson_center","Farrell-Fleharty":"Lynn Farrell Arena/Fleharty Educational Center","Calvin H. French Chapel":"Calvin French Chapel","Bronco Village Apt 911":"Bronco Village Apartments 1","Bronco Village Apt 915":"Bronco Village Apartments 2","Bronco Village Apt 917":"Bronco Village Apartments 3","Bronco Village Apt 919":"Bronco Village Apartments 4","Bronco Village Apt 921":"Bronco Village Apartments 5","Bronco Village Apt 923":"Bronco Village Apartments 6"},j3={...Object.fromEntries(Object.entries(vC).map(([n,e])=>[e,n])),"Farrell Arena Fleharty Educational Center":"Farrell-Fleharty","Daugherty Center for Student Engagement":"Daugherty Student Engagement Center","Daugherty Center For Student Engagement":"Daugherty Student Engagement Center","Fleharty Center":"Farrell-Fleharty","Calvin H. French Memorial Chapel":"Calvin H. French Chapel","French Memorial Chapel":"Calvin H. French Chapel","Hazzelrig Student Union":"Hazelrigg Student Union","Hazelrigg Student Union":"Hazelrigg Student Union",Kiewit:"Kiewit Building","Scott Theatre":"Scott Studio Theater","Scott Theater":"Scott Studio Theater","Wilson Math and Computer Sci Center":"Wilson Center"},xC=Object.fromEntries(Object.entries(j3).map(([n,e])=>[g_(n),e])),KV=Object.fromEntries(Object.entries(j3).map(([n,e])=>[uw(n),e])),XV="Data/Utilization/classroom_utilization.csv",sT=n=>{const e=[];let t="",i=!1;for(let c=0;c<n.length;c+=1){const u=n[c];if(u==='"'){i&&n[c+1]==='"'?(t+='"',c+=1):i=!i;continue}if(u===","&&!i){e.push(t),t="";continue}t+=u}return e.push(t),e},Yg=n=>{const e=String(n??"").replace(/,/g,"").trim();if(!e)return null;const t=Number(e);return Number.isFinite(t)?t:null},Jg=n=>{const e=String(n??"").replace(/[%\s]/g,"").replace(/,/g,"").trim();if(!e)return null;const t=Number(e);return Number.isFinite(t)?t:null},ZV=n=>{const e=String(n??"").trim().toLowerCase();return e?/^0+\d+$/.test(e)?String(Number(e)):e:""},bC=(n,e)=>`${n}||${ZV(e)}`,YV=(n="")=>{const e=n.split(/\r?\n/).filter(ie=>ie.trim().length>0);if(!e.length)return{buildings:{},rooms:{},campus:null};const t=sT(e[0]).map(ie=>ie.trim()),i=t.findIndex(ie=>ie.toLowerCase().includes("building")),c=t.findIndex(ie=>ie.toLowerCase().includes("weekly")),u=t.findIndex(ie=>ie.toLowerCase().includes("enrollment")),m=t.findIndex(ie=>ie.toLowerCase().includes("capacity")),_=t.findIndex(ie=>ie.toLowerCase().includes("time")),o=t.findIndex(ie=>ie.toLowerCase().includes("seat")),b=t.findIndex(ie=>ie.toLowerCase().includes("overall"));if(i<0)return{buildings:{},rooms:{},campus:null};const I={},M={};let V=null,k=null;for(let ie=1;ie<e.length;ie+=1){const se=sT(e[ie]),fe=(se[i]??"").trim();if(!fe)continue;if(/^grand total$/i.test(fe)){V={weeklyHours:Yg(se[c]),finalEnrollment:Yg(se[u]),totalCapacity:Yg(se[m]),timeUtilization:Jg(se[_]),seatUtilization:Jg(se[o]),overallUtilization:Jg(se[b])},k=null;continue}const ne=WV(fe)||null,me=Yg(se[c]),ue=Yg(se[u]),ke=Yg(se[m]),je=Jg(se[_]),pe=Jg(se[o]),U=Jg(se[b]);if(ne){k=ne,I[ne]={weeklyHours:me,finalEnrollment:ue,totalCapacity:ke,timeUtilization:je,seatUtilization:pe,overallUtilization:U};continue}if(!k)continue;const F=bC(k,fe);M[F]={building:k,roomLabel:fe,weeklyHours:me,finalEnrollment:ue,totalCapacity:ke,timeUtilization:je,seatUtilization:pe,overallUtilization:U}}return{buildings:I,rooms:M,campus:V}},aT={[ei("Babcock Hall")]:"nw",[ei("Babcock Hall Residence")]:"nw",[ei("Gray Center")]:"sw",[ei("Lloyd Wilson Stadium")]:"nw",[ei("Lloyd Wilson Field/Stadium")]:"nw",[ei("Stone Health Center")]:"nw",[ei("The Stone Health Center")]:"nw",[ei("McCormick Hall")]:"nw",[ei("Jackson Dinsdale Art Center")]:"nw",[ei("Farrell-Fleharty")]:"nw",[ei("Lynn Farrell Arena/Fleharty Educational Center")]:"nw",...F_(D_,"corner")},lT={[ei("Gray Center")]:0,[ei("McCormick Hall")]:90},cT={[ei("Gray Center")]:"directional",[ei("Lloyd Wilson Stadium")]:"directional",[ei("Lloyd Wilson Field/Stadium")]:"directional",...F_(D_,"cornerMethod")},uT={[ei("Gray Center")]:["sw","nw"],[ei("Lloyd Wilson Stadium")]:["nw","sw"],[ei("Lloyd Wilson Field/Stadium")]:["nw","sw"],[ei("Stone Health Center")]:["nw","sw"],[ei("The Stone Health Center")]:["nw","sw"],[ei("Jackson Dinsdale Art Center")]:["nw","sw"],[ei("Farrell-Fleharty")]:["nw","sw"],[ei("Lynn Farrell Arena/Fleharty Educational Center")]:["nw","sw"],[ei("Daugherty Student Engagement Center")]:["nw","sw"],[ei("McCormick Hall")]:["nw","sw"],...F_(D_,"cornerPair")},hT={[ei("Lloyd Wilson Stadium")]:"match",[ei("Lloyd Wilson Field/Stadium")]:"match",[ei("Stone Health Center")]:"legacy",[ei("The Stone Health Center")]:"legacy",...F_(D_,"pairMode")},dT={[ei("Babcock Hall")]:"none",[ei("Babcock Hall Residence")]:"none",...F_(D_,"rotationMode")},JV={[ei("Gray Center")]:1.035,[ei("Lloyd Wilson Stadium")]:1,[ei("Lloyd Wilson Field/Stadium")]:1},QV={},fT={"wilson_center/basement":184.5,"wilson_center/level_1":180.5,"daugherty_student_engagement_center/basement":42,"daugherty_student_engagement_center/level_1":42,hurley_mcdonald_hall:180,"mccormick_hall/basement":84.5,"mccormick_hall/level_1":88.5,"mccormick_hall/level_2":88.5,"mccormick_hall/level_3":100,morrison_reeves_science_center:0,morrison_reeves:0,"morrison_reeves/level_1":0,"morrison_reeves/level_2":0},pT={"babcock_hall/level_2":1.12},mT={},gT=new Set(["kiewit/level_2","kiewit_building/level_2","babcock_hall/level_3","taylor_hall","taylor_hall_residence"]),yT=new Set(["calvin_french_chapel/level_2","calvin_h_french_chapel/level_2","calvin_h_french_memorial_chapel/level_2"]),eq=new Set(["bronc_hall/basement","bronc_hall_residence/basement"]),tq=new Set(["calvin_french_chapel/basement","calvin_h_french_chapel/basement","calvin_h_french_memorial_chapel/basement","kiewit/level_2","kiewit_building/level_2"]);function nq(n,e){if(!n)return null;const t=tu(n),i=e?Na(e):null;if(i){const u=`${t}/${i}`,m=fT[u];if(Number.isFinite(m))return m}const c=fT[t];return Number.isFinite(c)?c:null}function rq(n,e){if(!n||!e)return null;const t=tu(n),i=Na(e),c=`${t}/${i}`,u=pT[c]??pT[t];return Number.isFinite(u)?u:null}function iq(n,e){if(!n||!e)return null;const t=tu(n),i=Na(e),c=`${t}/${i}`,u=mT[c]??mT[t];return Number.isFinite(u)?u:null}function oq(n,e){if(!n||!e)return!1;const t=tu(n),i=Na(e);return eq.has(`${t}/${i}`)}function sq(n,e){if(!n||!e)return!1;const t=tu(n),i=Na(e);return gT.has(`${t}/${i}`)||gT.has(t)}function aq(n,e){if(!n||!e)return!1;const t=tu(n),i=Na(e);return yT.has(`${t}/${i}`)||yT.has(t)}function lq(n,e){if(!n||!e)return!1;const t=tu(n),i=Na(e);return tq.has(`${t}/${i}`)}const Hv=(n,e)=>({...n,...e}),po=n=>{const e=String(n??"").trim();if(!e)return"";const t=Lf(e)||e;return tu(t)},gm=n=>String(n||"").trim().toLowerCase().replace(/[^a-z0-9]/g,""),cq=/[0-9a-f]{8}(?:-[0-9a-f]{4}){3}-[0-9a-f]{12}/i,U3=n=>{const e=String(n||"").trim();if(!e)return[];const t=new Set,i=gm(e);i&&t.add(i);const c=e.match(cq);if(c&&c[0]){const u=gm(c[0]);u&&t.add(u)}return Array.from(t)},_T=n=>{const e=String(n||"").trim();if(!e)return"";const t=gm(e);return t?t.startsWith("room")&&t.length>4?t.slice(4):t:""},hg=n=>String(n||"").toLowerCase().replace(/[^a-z0-9]+/g," ").trim(),R0=n=>String(n||"").toLowerCase().replace(/&/g,"and").replace(/[^a-z0-9]+/g," ").trim(),n_=n=>n?.building??n?.buildingName??n?.buildingLabel??"",vT=(n=[])=>{const e=new Map;return(R3||[]).forEach(t=>{const i=R0(t);i&&e.set(i,t)}),(n||[]).forEach(t=>{const i=String(t?.department??"").trim(),c=R0(i);c&&e.set(c,i)}),Array.from(e.values())},xT=(n,e=[])=>{const t=R0(n);if(!t)return"";let i="",c=0;return(e||[]).forEach(u=>{const m=R0(u);m&&t.includes(m)&&m.length>c&&(i=u,c=m.length)}),i},Wv=n=>String(n||"").toLowerCase().replace(/&/g,"and").replace(/[^a-z0-9]+/g," ").trim(),bT=(n=[])=>{const e=new Map;return(md||[]).forEach(t=>{const i=String(t?.name||"").trim(),c=Wv(i);c&&e.set(c,i)}),(n||[]).forEach(t=>{const i=String(t?.building??t?.buildingName??t?.buildingLabel??"").trim(),c=Wv(i);c&&e.set(c,i)}),Array.from(e.values())},wT=(n,e=[])=>{const t=Wv(n);if(!t)return"";let i="",c=0;return(e||[]).forEach(u=>{const m=Wv(u);m&&t.includes(m)&&m.length>c&&(i=u,c=m.length)}),i},ST=(n=[],e="")=>{const t=R0(e);if(!t)return[];const i=new Set;return(n||[]).forEach(c=>{const u=R0(c?.department??"");if(u&&u===t){const m=n_(c);m&&i.add(m)}}),Array.from(i)},h5=n=>{if(n==null)return[];const e=new Set,t=String(n);t&&e.add(t);const i=Number(t);return Number.isFinite(i)&&e.add(i),Array.from(e)},V3=n=>/^rec[a-z0-9]{6,}$/i.test(String(n||"")),Kv=n=>Array.isArray(n)&&n.length>0&&n.every(e=>V3(e)),wC=["Office - Staff","Office - Prof and Admin","Office - Prof & Admin","Office - Prof/Admin","Office - Faculty","Office - Adjunct Faculty","Office - Emeritus Faculty"];wC.map(n=>n.toUpperCase());const SC=["Office - Staff","Office - Staff (311)","Office - Prof and Admin","Office - Prof and Admin (310)","Office - Prof & Admin","Office - Prof/Admin","Office - Faculty","Office - Adjunct Faculty","Office - Emeritus Faculty"],uq=SC.map(n=>n.toUpperCase()),hq=new Set(["310","311"]),Sx=n=>String(n||"").toLowerCase().replace(/[^a-z0-9]+/g," ").replace(/\b(and|&)\b/g," ").replace(/\s+/g," ").trim(),dq=new Set(wC.map(Sx).filter(Boolean)),fq=new Set(SC.map(Sx).filter(Boolean)),hw=n=>{const e=Sx(n);if(!e)return!1;if(dq.has(e)||e.includes("office"))return!0;const t=e.replace(/\s+/g,"");return!!(t==="310"||t==="311"||t.startsWith("310")||t.startsWith("311"))},pq=n=>{const e=Sx(n);if(!e)return!1;if(fq.has(e))return!0;const t=e.replace(/\s+/g,"");return hq.has(t)?!0:e.includes("office staff")||e.includes("office prof admin")||e.includes("office faculty")||e.includes("office adjunct faculty")||e.includes("office emeritus faculty")},mq=/^[{(]?[0-9a-f]{8}(?:-[0-9a-f]{4}){3}-[0-9a-f]{12}(?:-[0-9a-f]{2,})?[)}]?$/i,gq=/^[0-9a-f]{24,}$/i,yq=/[0-9a-f]{8}(?:-[0-9a-f]{4}){3}-[0-9a-f]{12}(?:-[0-9a-f]{2,})?/i,im=n=>{const e=String(n||"").trim();return e?!!(mq.test(e)||yq.test(e)&&e.length>=24||gq.test(e)||e.includes("|")||/^[a-f0-9-]{24,}$/i.test(e)||V3(e)):!1},q3=n=>{const e=[n?.roomNumber,n?.roomLabel,n?.number,n?.Number,n?.RoomNumber,n?.Room];for(const i of e){const c=String(i??"").trim();if(c&&!im(c))return c}const t=String(n?.roomId??"").trim();return t&&!im(t)?t:""},_q=(n="")=>{const e=String(n||"").toLowerCase();return!/\bvacan(t|cy)\b/.test(e)||!/\boffice(s)?\b/.test(e)?!1:/\b(list|show|give|display|return|all|which|what)\b/.test(e)},vq=(n="")=>{const e=String(n||"").toLowerCase();return!/\bvacan(t|cy)\b/.test(e)||!/\boffice(s)?\b/.test(e)?!1:/\bhow many\b|\bcount\b|\bnumber of\b/.test(e)},xq=(n="")=>{const e=String(n||"").toLowerCase();return/\bclassroom(s)?\b/.test(e)?/\bhow many\b|\bcount\b|\bnumber of\b/.test(e):!1},bq=n=>{const e=String(n?.occupancyStatus??n?.occupancy??n?.Vacancy??n?.vacancy??"").toLowerCase();return String(n?.occupant??"").trim()||e.includes("occupied")||e.includes("assigned")&&!e.includes("unassigned")?!1:e.includes("vacant")||e.includes("available")},ET=(n=[])=>{const e=new Set,t=[];return(n||[]).forEach(i=>{const c=String(i?.type??i?.roomType??"").trim();if(!c||!c.toLowerCase().includes("office")&&!hw(c)||!bq(i))return;const m=String(n_(i)||"").trim(),_=String(i?.floor??i?.floorName??i?.floorId??"").trim(),o=q3(i),b=gm(i?.roomGuid??i?.revitId??i?.roomId??i?.id??""),I=Number(i?.areaSF??i?.area??i?.sf??0),M=Number.isFinite(I)&&I>0?Math.round(I):"",V=[m,_,o,c,M].join("|").toLowerCase();e.has(V)||(e.add(V),t.push({Building:m||"Unknown","Room Number":o,"Room Type":c,"Square Feet":M,__lookupKey:b,__floor:_}))}),t.sort((i,c)=>String(i.Building||"").localeCompare(String(c.Building||""),void 0,{sensitivity:"base"})||String(i["Room Number"]||"").localeCompare(String(c["Room Number"]||""),void 0,{numeric:!0,sensitivity:"base"})),t},wq=n=>{if(q3(n))return!1;const t=String(n?.roomId??n?.id??"").trim();return String(n?.roomGuid??n?.revitId??n?.revitUniqueId??"").trim()||!t?!0:im(t)},Sq=n=>String(n||"").toLowerCase().replace(/[^a-z0-9]+/g," ").trim(),D1=n=>{const e=Sq(n);return e?e.includes("classroom")?!0:e.includes("laboratory class")||e.includes("laboratory studio")||e.includes("lab class")||e.includes("lab studio"):!1},Pf=n=>{const e=String(n??"").trim();if(!e)return[];const t=new Set,i=Na(e);t.add(i);const c=Number(e);return Number.isFinite(c)&&(t.add(`level_${c}`),c===0&&t.add("basement")),Array.from(t)},If=(n,e)=>{if(!e?.length)return!0;const t=Pf(n);return t.length?t.some(i=>e.includes(i)):!1},F1=(n,e=[])=>{const t=c0(n);if(!t)return"";if(e.includes(t))return t;const i=Pf(t);return i.length&&e.find(c=>If(c,i))||""};function EC(n=[]){const e=new Map,t=new Map;if(!Array.isArray(n))return{byGuid:e,byComposite:t};const i=(c,u,m)=>{if(!u)return;if(!c.has(u)){c.set(u,m);return}c.get(u)!==m&&c.set(u,null)};return n.forEach(c=>{if(!c)return;const u=c.roomGuid??c.revitId??c.revitUniqueId??c["Room GUID"]??c.roomId??"";U3(u).forEach(I=>i(e,I,c));const _=gm(c.roomId??c.roomNumber??c.roomLabel??c.id??""),o=po(c.building??c.buildingName??c.buildingLabel??""),b=po(c.floor??c.floorName??c.floorId??"");if(_&&o&&b){const I=`${o}|${b}|${_}`;t.has(I)||t.set(I,c)}}),{byGuid:e,byComposite:t}}function Eq(n=[],e=[]){if(!Array.isArray(n)||n.length===0)return[];if(!Array.isArray(e)||e.length===0)return n;const t=EC(e);return n.map(i=>{if(!i)return i;const c=i.roomGuid??i.revitId??i.roomId??i.revitUniqueId??"",m=U3(c).reduce((I,M)=>I||t.byGuid.get(M)||null,null);if(!m)return i;const _={...i};!_.roomGuid&&m.roomGuid&&(_.roomGuid=m.roomGuid),!_.roomId&&m.roomId&&(_.roomId=m.roomId);const o=String(_.roomNumber??"").trim(),b=String(_.roomLabel??"").trim();if((!o||im(o))&&m.roomNumber){const I=String(m.roomNumber).trim();I&&!im(I)&&(_.roomNumber=I)}if((!b||im(b))&&m.roomLabel){const I=String(m.roomLabel).trim();I&&!im(I)&&(_.roomLabel=I)}return!_.building&&m.building&&(_.building=m.building),!_.floor&&m.floor&&(_.floor=m.floor),(!_.type||Kv(_.type))&&m.type&&(_.type=m.type),(!_.department||Kv(_.department))&&m.department&&(_.department=m.department),(!Number.isFinite(Number(_.areaSF))||Number(_.areaSF)<=0)&&Number.isFinite(Number(m.areaSF))&&Number(m.areaSF)>0&&(_.areaSF=Number(m.areaSF)),_})}function AC(n={},e,t,i){if(!e)return null;let c=null;const u=n.Revit_UniqueId??n.RevitUniqueId??n["Room GUID"]??n.roomGuid??"";if(U3(u).forEach(k=>{c||(c=e.byGuid.get(k)||null)}),!c){const k=gm(n.Number??n.RoomNumber??n.number??n.Room??n.roomNumber??""),ie=po(t??n.Building??n.BuildingName??n.buildingId??""),se=po(i??n.Floor??n.floor??"");k&&ie&&se&&(c=e.byComposite.get(`${ie}|${se}|${k}`)||null)}if(!c)return null;const _=String(c.occupancyStatus??"").trim(),o=String(c.occupant??"").trim(),b=String(c.type??"").trim(),I=String(c.department??"").trim();if(!_&&!o&&!b&&!I)return null;const M={};_&&(M.occupancyStatus=_,M.OccupancyStatus=_,M["Occupancy Status"]=_),o&&(M.occupant=o,M.Occupant=o),b&&(M.type=b,M.Type=b,M["Room Type"]=b,M["Room Type Description"]=b),I&&(M.department=I,M.Department=I);const V=Number(c.seatCount??c.SeatCount??c["Seat Count"]??0);return Number.isFinite(V)&&V>0&&(M.seatCount=V,M.SeatCount=V,M["Seat Count"]=V),M}const Aq=n=>{const e=Number(n?.areaSF??n?.area??n?.sf??0);return Number.isFinite(e)&&e>0},Tq=(n,e)=>{if(!n)return null;const t=n?.properties||{},i=V8(t);if(!Number.isFinite(i)||i<=0)return null;const c=(t.occupancyStatus??t["Occupancy Status"]??t.OccupancyStatus??t.vacancy??t.Vacancy??t.Occupancy??t.Status??"").toString().trim(),u=(t.occupant??t.Occupant??t.AssignedTo??t.Assignee??"").toString().trim(),m=String(t.Revit_UniqueId??t.RevitUniqueId??t["Room GUID"]??"").trim(),_=String(t.Number??t.RoomNumber??t.number??t.Room??"").trim(),o=t.Floor??t.Level??t.LevelName??t["Level Name"]??"";return{building:e||"",floor:o,areaSF:i,area:i,sf:i,roomId:_||"",roomNumber:_||"",roomLabel:_||"",roomGuid:m,department:U8(t),type:M3(t),occupancyStatus:c,occupant:u}},AT=async n=>{const e=n?.floorsByBuilding||{},t=[],i=new Map;return Array.isArray(n?.buildings)?n.buildings.forEach(u=>{u?.id&&i.set(String(u.id),u?.name||u.id)}):n?.buildings&&typeof n.buildings=="object"&&Object.entries(n.buildings).forEach(([u,m])=>{u&&i.set(String(u),m?.name||u)}),Object.entries(e).forEach(([u,m])=>{const _=i.get(String(u))||u;(m||[]).forEach(o=>{const b=typeof o=="string"?o:o?.url;b&&t.push({url:b,buildingLabel:_})})}),t.length?(await xV(t,6,async u=>{const m=await vV(u.url),_=[];return(m||[]).forEach(o=>{const b=Tq(o,u.buildingLabel);b&&_.push(b)}),_})).flat():[]},TC=n=>{if(!n)return null;const e=Number(n.areaSF??n.area??n.sf??0);if(!Number.isFinite(e)||e<=0)return null;const t=String(n.department??"").trim(),i=String(n.type??"").trim(),c=String(n.occupancyStatus??"").trim(),u=String(n.occupant??"").trim();return{type:"Feature",properties:{Area_SF:e,Area:e,area:e,"Area (SF)":e,NCES_Department:t,Department:t,department:t,NCES_Type:i,__roomType:i,OccupancyStatus:c,"Occupancy Status":c,occupancyStatus:c,Occupant:u,occupant:u}}};function IC(n,e){if(n){try{n.getLayer(zf)&&n.removeLayer(zf),n.getLayer(ug)&&n.removeLayer(ug),n.getLayer(Qc)&&n.removeLayer(Qc),n.getLayer(Sp)&&n.removeLayer(Sp),n.getLayer(Jh)&&n.removeLayer(Jh),cv.forEach(t=>{n.getLayer(t)&&n.removeLayer(t)}),n.getSource(zv)&&n.removeSource(zv),n.getLayer(jv)&&n.removeLayer(jv),n.getLayer(Uv)&&n.removeLayer(Uv),n.getLayer(ko)&&n.removeLayer(ko),Wu(n,ma)&&n.removeSource(ma),n.getLayer(k0)&&n.removeLayer(k0),n.getSource(Vv)&&n.removeSource(Vv),n.getLayer(qv)&&n.removeLayer(qv),n.getSource(HA)&&n.removeSource(HA),n.getLayer($v)&&n.removeLayer($v),n.getSource(WA)&&n.removeSource(WA)}catch{}e&&(e.current=null)}}function TT(n){try{const e=Wu(n,ma),t=e?._data||e?.serialize?.()?.data,i=Au(t);if(!i)return;const c=Cu(i);c&&isFinite(c[0])&&n.fitBounds([[c[0],c[1]],[c[2],c[3]]],{padding:40,duration:500})}catch{}}function Uy(n,e="department"){if(!n)return;const t=["coalesce",["get","Number"],["get","RoomNumber"],["get","name"],["literal","-"]],i=["to-string",["coalesce",["get","occupant"],["get","Occupant"],""]],c=["concat",["to-string",["round",["coalesce",["get","Area_SF"],["get","Area"],0]]]," SF"],b=e==="occupancy"?["case",["==",["get","Element"],"Room"],["concat",t,`
`,i,`
`,c],""]:["case",["==",["get","Element"],"Room"],["concat",t,`
`,["coalesce",["get","__roomType"],["get","RoomType"],["get","Room Type"],["get","Type"],["get","type"],["get","Name"],["literal","-"]],`
`,["coalesce",["get","scenarioDepartment"],["get","department"],["get","Department"],["literal","-"]],`
`,c],""],I=["interpolate",["linear"],["zoom"],14,0,15,0,16,3,17,5,18,7,19,10];if(n.getLayer(Qc)){try{n.setLayoutProperty(Qc,"text-field",b),n.setLayoutProperty(Qc,"text-size",I),n.setLayoutProperty(Qc,"symbol-placement","point"),n.setLayoutProperty(Qc,"text-allow-overlap",!1),n.setLayoutProperty(Qc,"text-ignore-placement",!1),n.setLayoutProperty(Qc,"text-max-width",6),n.setLayoutProperty(Qc,"visibility","visible"),n.setFilter(Qc,u0)}catch{}dw(n);return}try{n.addLayer({id:Qc,type:"symbol",source:ma,filter:["all",u0,["!=",["id"],-1]],layout:{"text-field":b,"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":I,"text-line-height":1,"text-variable-anchor":["center"],"text-radial-offset":0,"text-anchor":"center","text-justify":"center","symbol-placement":"point","text-allow-overlap":!1,"text-ignore-placement":!1,"text-max-width":6,visibility:"visible"},paint:{"text-color":"#0b0b0b","text-halo-color":"rgba(255,255,255,0.95)","text-halo-width":1}},Jh),dw(n)}catch{}}function dw(n){if(n)try{n.getLayer(Qc)&&n.moveLayer(Qc)}catch{}}const Iq={5:{label:"5 = Excellent condition",color:"#4CAF50"},4:{label:"4 = Good condition",color:"#8BC34A"},3:{label:"3 = Adequate condition",color:"#FFEB3B"},2:{label:"2 = Poor condition",color:"#FF9800"},1:{label:"1 = Very poor condition",color:"#F44336"}},Cq={0:"#85474b",1:"#aed6f1",2:"#5dade2",3:"#2e86c1"},Vm="#85474b",Lq=["603 E 9th St","603 E. 9th St","607 E 9th St","MacKay House","McKay House","905 N Elm St","905 N Elm Ave","Name 1","Name1","706 E. 7th St","706 E 7th St","706 E. 7th St. Residence","710 E. 7th St.","710 E 7th St","710 E. 7th St. Residence","714 E. 7th St.","714 E 7th St","714 E. 7th St. Residence","812 N Ash St","812 N Ash Ave","906 E 9th St","Campus Safety","The 1882 Residence Hall","1882 Residence Hall","Hayes M. Fuhr Hall of Music","Hayes M Fuhr Hall of Music"],Pq=Lq.map(n=>String(n||"").toLowerCase()),kq=["downcase",["to-string",["coalesce",["get","id"],["get","name"]]]],Rq=["in",kq,["literal",Pq]],fd=(n,e="#d1d5db")=>["case",Rq,e,n],Mq=n=>Number.isFinite(n)?n>=80?"#22c55e":n>=60?"#84cc16":n>=40?"#facc15":n>=20?"#f97316":"#ef4444":"#e5e7eb",IT=n=>{const e=String(n||"").trim().replace("#",""),t=e.length===3?e.split("").map(i=>i+i).join(""):e;return/^[0-9a-f]{6}$/i.test(t)?{r:parseInt(t.slice(0,2),16),g:parseInt(t.slice(2,4),16),b:parseInt(t.slice(4,6),16)}:null},Nq=({r:n,g:e,b:t})=>`#${[n,e,t].map(i=>Math.max(0,Math.min(255,Math.round(i))).toString(16).padStart(2,"0")).join("")}`,Af=(n,e,t=.25)=>{const i=IT(n),c=IT(e);if(!i||!c)return n;const u=Math.max(0,Math.min(1,Number(t)||0));return Nq({r:i.r+(c.r-i.r)*u,g:i.g+(c.g-i.g)*u,b:i.b+(c.b-i.b)*u})},hm={study:{color:"#ef4444",heatValue:1,rgb:"255,69,69",haloRgb:"255,207,120"},hangout:{color:"#fb923c",heatValue:.95,rgb:"255,150,62",haloRgb:"255,218,140"},improve:{color:"#ffe44d",heatValue:.9,rgb:"255,228,77",haloRgb:"255,243,168"},outdated:{color:"#60a5fa",heatValue:.8,rgb:"82,148,255",haloRgb:"180,220,255"},rarely:{color:"#67e8f9",heatValue:.9,rgb:"78,228,250",haloRgb:"190,246,255"},unsafe:{color:"#1d4ed8",heatValue:1.03,rgb:"30,78,216",haloRgb:"142,181,255"},comment:{color:"#9ca3af",heatValue:0,rgb:"156,163,175",haloRgb:"125,250,255"}},Dq={study:"Go-to Study",hangout:"Go-to Hang Out",improve:"Needs Improvement",outdated:"Outdated / Run Down",rarely:"Rarely / Never Use",unsafe:"Do Not Feel Safe",comment:"Comment"},Fq=["study","hangout","improve","rarely","outdated","unsafe","comment"],fw={study:"This is a go to study spot",hangout:"This is a go to hang out spot",improve:"I would like to use this space more, but it needs improvement",rarely:"I rarely or never use this space",outdated:"This space feels outdated or run down",unsafe:"I do not feel safe in this space",comment:"Just leave a comment"},Oq=Fq.reduce((n,e)=>{const t=fw[e];return n[t]=hm[e]?.color||"#9ca3af",n},{}),d5=24,Bq=["study","hangout","improve"],zq=["outdated","rarely","unsafe"],Xv=["coalesce",["get","weight"],0],f5=[">",Xv,0],CT=!0,LT=[{category:"rarely",layerId:"engagement-heat-rarely"},{category:"outdated",layerId:"engagement-heat-outdated"},{category:"unsafe",layerId:"engagement-heat-unsafe"},{category:"improve",layerId:"engagement-heat-improve"},{category:"hangout",layerId:"engagement-heat-hangout"},{category:"study",layerId:"engagement-heat-study"}],y_=n=>{const e=String(n||"").trim().toLowerCase();return!e||/just leave a ?comment|leave a comment about this space/.test(e)?"comment":/do not feel safe|unsafe/.test(e)?"unsafe":/rarely|never/.test(e)?"rarely":/outdated|run-down|run down/.test(e)||/furniture.*uncomfortable|layout.*not functional|lighting|temperature|technology.*inadequate|unreliable|privacy/.test(e)?"outdated":/needs improvement|need improvement|more flexible|adaptable|wish this space were more flexible|improv/.test(e)?"improve":/go[- ]to hang ?out|hang ?out/.test(e)?"hangout":/go[- ]to study|study spot|supports my teaching|professional work effectively|supports .*work effectively/.test(e)?"study":"comment"},jq=n=>fw[y_(n)]||fw.comment,Uq=n=>hm[y_(n)]?.heatValue??0,PT=n=>hm[y_(n)]?.color||"#9ca3af",Vq=n=>n==="outdated"||n==="rarely"||n==="unsafe",qq=n=>{const e=hm[n]?.rgb||"156,163,175",t=hm[n]?.haloRgb||e;return Vq(n)?["interpolate",["linear"],["heatmap-density"],0,"rgba(0,0,0,0)",.03,`rgba(${t},0.12)`,.1,`rgba(${t},0.24)`,.2,`rgba(${e},0.58)`,.36,`rgba(${e},0.82)`,.62,`rgba(${e},0.93)`,1,`rgba(${e},0.995)`]:["interpolate",["linear"],["heatmap-density"],0,"rgba(0,0,0,0)",.03,`rgba(${t},0.10)`,.12,`rgba(${t},0.22)`,.24,`rgba(${t},0.40)`,.4,`rgba(${e},0.66)`,.65,`rgba(${e},0.86)`,1,`rgba(${e},0.98)`]},$q=()=>["interpolate",["linear"],["heatmap-density"],0,"rgba(0,0,0,0)",.06,"rgba(255,237,128,0.20)",.22,"rgba(255,228,77,0.40)",.48,"rgba(251,146,60,0.58)",.72,"rgba(239,68,68,0.70)",1,"rgba(220,38,38,0.82)"],Gq=()=>["interpolate",["linear"],["heatmap-density"],0,"rgba(0,0,0,0)",.05,"rgba(207,250,254,0.24)",.18,"rgba(125,250,255,0.44)",.42,"rgba(56,189,248,0.62)",.7,"rgba(59,130,246,0.78)",1,"rgba(30,64,175,0.90)"],kT=n=>{const e=["coalesce",["get","weight"],0];return n==="unsafe"?["*",e,1.08]:n==="rarely"?["*",e,.95]:n==="outdated"?["*",e,.88]:n==="improve"?["*",e,.88]:n==="hangout"?["*",e,1.02]:n==="study"?["*",e,1.12]:["*",e,1]},RT=()=>["*",Xv,["match",["coalesce",["get","heatCategory"],""],"study",1.12,"hangout",1,"improve",.74,1]],MT=(n=!1)=>n?["interpolate",["linear"],["zoom"],16,1.02,18,1.14,20,1.24,22,1.32]:["interpolate",["linear"],["zoom"],10,.86,13,.96,15,1.06,17,1.16,19,1.24],NT=(n=!1)=>n?["interpolate",["linear"],["zoom"],16,20,18,30,20,44,22,60]:["interpolate",["linear"],["zoom"],10,34,12,52,14,74,16,98,18,124,20,152],DT=(n=!1)=>n?["interpolate",["linear"],["zoom"],16,.84,18,.89,20,.94,22,.97]:["interpolate",["linear"],["zoom"],10,.68,13,.72,16,.76,19,.8],FT=(n=!1)=>n?["interpolate",["linear"],["zoom"],16,1.04,18,1.14,20,1.24,22,1.32]:["interpolate",["linear"],["zoom"],10,.9,13,1,15,1.1,17,1.18,19,1.26],OT=(n=!1)=>n?["interpolate",["linear"],["zoom"],16,18,18,28,20,40,22,54]:["interpolate",["linear"],["zoom"],10,28,12,42,14,58,16,78,18,98,20,120],BT=(n=!1)=>n?["interpolate",["linear"],["zoom"],16,.82,18,.88,20,.94,22,.97]:["interpolate",["linear"],["zoom"],10,.62,13,.68,16,.74,19,.8],zT=(n,e=!1)=>e?n==="unsafe"?["interpolate",["linear"],["zoom"],16,7,18,11,20,16,22,22]:n==="rarely"||n==="outdated"?["interpolate",["linear"],["zoom"],16,8,18,12,20,18,22,24]:n==="improve"?["interpolate",["linear"],["zoom"],16,11,18,16,20,22,22,30]:["interpolate",["linear"],["zoom"],16,11,18,18,20,24,22,34]:n==="unsafe"?["interpolate",["linear"],["zoom"],10,13,12,18,14,26,16,36,18,46,20,56]:n==="rarely"||n==="outdated"?["interpolate",["linear"],["zoom"],10,14,12,22,14,30,16,40,18,52,20,64]:n==="improve"?["interpolate",["linear"],["zoom"],10,18,12,28,14,40,16,54,18,70,20,86]:["interpolate",["linear"],["zoom"],10,20,12,30,14,44,16,58,18,76,20,94],jT=(n,e=!1)=>e?n==="unsafe"?["interpolate",["linear"],["zoom"],16,1.24,18,1.34,20,1.44,22,1.56]:n==="rarely"||n==="outdated"?["interpolate",["linear"],["zoom"],16,1.16,18,1.26,20,1.36,22,1.48]:["interpolate",["linear"],["zoom"],16,1.14,18,1.24,20,1.34,22,1.46]:n==="unsafe"?["interpolate",["linear"],["zoom"],10,1.12,13,1.22,15,1.32,17,1.44,19,1.54]:n==="rarely"||n==="outdated"?["interpolate",["linear"],["zoom"],10,1,13,1.1,15,1.2,17,1.3,19,1.38]:["interpolate",["linear"],["zoom"],10,.98,13,1.08,15,1.18,17,1.3,19,1.4],UT=(n,e=!1)=>e?n==="unsafe"?["interpolate",["linear"],["zoom"],16,1,18,1,20,1,22,1]:n==="rarely"||n==="outdated"?["interpolate",["linear"],["zoom"],16,.94,18,.97,20,.99,22,1]:["interpolate",["linear"],["zoom"],16,.97,18,.99,20,1,22,1]:n==="unsafe"?["interpolate",["linear"],["zoom"],10,.88,13,.92,16,.95,19,.97]:n==="rarely"||n==="outdated"?["interpolate",["linear"],["zoom"],10,.78,13,.83,16,.89,19,.93]:["interpolate",["linear"],["zoom"],10,.85,13,.89,16,.93,19,.96],Qg=(n,e,t)=>{try{if(!n?.getLayer(e))return;n.setLayoutProperty(e,"visibility",t?"visible":"none")}catch{}},Hq=(n,e="#f3f4f6")=>n?.length?["match",["to-string",["coalesce",["id"],["get","RevitId"],["get","id"]]],...n,e]:e,Wq=(n,e={type:"FeatureCollection",features:[]})=>{if(!n||!n.getLayer(ko))return;const t=n.getLayer(Jh)?Jh:void 0,i=[{id:nC,band:1,opacity:.1},{id:rC,band:2,opacity:.11},{id:iC,band:3,opacity:.12},{id:oC,band:4,opacity:.13},{id:sC,band:5,opacity:.14},{id:aC,band:6,opacity:.15},{id:lC,band:7,opacity:.17},{id:cC,band:8,opacity:.19},{id:uC,band:9,opacity:.22},{id:hC,band:10,opacity:.25}];try{SV(n,zv,e),i.forEach(({id:c,band:u,opacity:m})=>{n.getLayer(c)||n.addLayer({id:c,type:"fill",source:zv,filter:["==",["get","band"],u],paint:{"fill-color":["coalesce",["get","c"],"#93c5fd"],"fill-opacity":m}},t)})}catch{}},Kq=()=>{if(typeof document>"u")return"";try{const n=Array.from(document.scripts||[]).map(e=>String(e?.src||""));for(const e of n){const t=e.match(/assets\/index-([A-Za-z0-9_-]+)\.js/i);if(t?.[1])return t[1]}}catch{}return""},CC=({config:n,universityId:e,mode:t="public",persona:i,engagementMode:c=!1})=>{const u=So(null),m=So(null),_=So(null),o=So(null),b=So({}),I=So(null),M=So(null),V=So(null),[k,ie]=jn(!1),[se,fe]=jn("select"),[J,ne]=jn(t==="admin"),[me,ue]=jn([]),[ke,je]=jn({}),[pe,U]=jn({}),[F,q]=jn(null),[j,H]=jn(md[0]?.name||""),be=n?.universityName||n?.name||""||e||"Campus",Re={SPACE_DATA:"space-data",ASSESSMENT:"assessment",TECHNICAL:"technical"},Oe=c?Re.ASSESSMENT:Re.SPACE_DATA,[Ne,we]=jn(Oe),[Fe,nt]=jn(!!c),[xe,le]=jn(()=>{if(typeof window>"u")return!1;try{const O=new URLSearchParams(window.location.search||""),de=String(O.get("presentation")||"").trim().toLowerCase();return de==="1"||de==="true"||de==="yes"}catch{return!1}}),[De,Be]=jn(""),Ye=[{value:Re.SPACE_DATA,label:"Space Data"},{value:Re.ASSESSMENT,label:"Assessment Progress"},{value:Re.TECHNICAL,label:"Technical"}],rt=t==="admin"?Ye:Ye.filter(O=>O.value===Re.SPACE_DATA),[mt,ft]=jn(!0),[Dt,Yt]=jn(!1),[cn,gn]=jn(!0),[Mn,Gt]=jn(!1),[st,mr]=jn(""),[Er,Cr]=jn("");ui(()=>{c&&Be(Kq())},[c]),ui(()=>{if(!(!Mn||st))try{const O=String(window.localStorage?.getItem("MAPBOX_PUBLIC_TOKEN")??"").trim();O&&mr(O)}catch{}},[Mn,st]),ui(()=>{const O=m.current;if(!O)return()=>{};const de=()=>{O.querySelectorAll('.mapboxgl-popup-close-button[aria-hidden="true"]').forEach(tt=>tt.removeAttribute("aria-hidden"))};de();const Te=new MutationObserver(de);return Te.observe(O,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["aria-hidden"]}),()=>Te.disconnect()},[]);const[Ln,ir]=jn(!0),er=Wa(()=>OU(DU),[]),Yr=Wa(()=>Array.from(new Set([...Object.keys(P3),...R3])).sort(),[]),[Vt,Pn]=jn(null),[Gn,Dn]=jn(null),[Mr,wr]=jn(null),[Tr,Ir]=jn(null),[Pr,Ei]=jn("building"),[Pi,or]=jn(null),[oi,Kr]=jn({}),[Br,di]=jn(0),[si,ut]=jn([]),[Ee,Ie]=jn(new Map),[Qe,ht]=jn(null),Ct=So([]),[Mt,Bt]=jn(null),[Et,Pt]=jn(""),vn=So(null),Bn=So(!1),Tn=So(""),[kr,Lr]=jn(null),[Vr,Ar]=jn(""),Ai=So(null),no=So(!1),yo=So(""),$o=So(null),[ro,ys]=jn(er),[io,Is]=jn(Yr),[ga,gl]=jn(new Set),[sl,Wi]=jn("__all__"),[Jl,Lu]=jn(""),[Eo,fu]=jn("rooms"),[Ea,Ko]=jn(!1),[Xa,Nl]=jn(""),[Ql,Aa]=jn(!1),[sa,dn]=jn(!1),[Xo,ss]=jn(""),[xi,pu]=jn(null),[Za,Ya]=jn(!1),[al,Cs]=jn(!1),[tr,zr]=jn(""),[Nr,js]=jn(null),[Ta,bi]=jn(!1),[Mi,yl]=jn(!1),[Gi,fs]=jn(""),[Ui,mu]=jn(null),[ec,nu]=jn(!1),[_c,tc]=jn(!1),[Da,Ls]=jn(""),[Vi,Fa]=jn(null),[ai,Zo]=jn(!1),[Ao,Ih]=jn(""),[Pu,_o]=jn(!1),[Us,ku]=jn(""),[Go,vo]=jn(null),[Dl,Oa]=jn(!0),[Vs,Bo]=jn(!1),[Bc,Ho]=jn(!1),[ya,Ja]=jn(""),[ll,ru]=jn(!1),[vc,qs]=jn(""),[Ti,Ss]=jn(null),[$s,aa]=jn(null),[la,cl]=jn("Campus Summary"),[Gs,Hs]=jn(!1),[xc,W]=jn(null),[Ce,pt]=jn([]),[yt,qt]=jn([]),[Zt,Fn]=jn(!1),[Dr,Xr]=jn(!1),[yi,Ii]=jn(""),[xo,bo]=jn(null),[Yo,Ro]=jn({buildings:{},rooms:{},campus:null}),[zo,Jo]=jn(!1),us=So(null),jo=So(null),Es=Wa(()=>EC(Ce.length?Ce:yt),[Ce,yt]),zc=Wa(()=>Yo?.buildings||{},[Yo]),Qa=Wa(()=>Yo?.rooms||{},[Yo]),L=Yo?.campus||null,ae=Wa(()=>{const O={};return Object.entries(zc||{}).forEach(([de,Te])=>{if(!de)return;O[de]=Te;const Me=vC[de];Me&&(O[Me]=Te)}),O},[zc]),ve=nr(O=>{if(!O)return null;const de=Lf(O)||O;return zc[de]||null},[zc]),Ge=nr((O,de)=>{if(!O||!de)return null;const Te=Lf(O)||O,Me=bC(Te,de);return Qa[Me]||null},[Qa]),[Xt,hn]=jn(null),[ar,so]=jn(!1),[Fo,Ki]=jn("unknown"),zi=Fo==="down",Mo=Fo==="ok",ca=Fo==="unknown",Lo=Wa(()=>({DEPARTMENT:"department",TYPE:"type",OCCUPANCY:"occupancy",VACANCY:"vacancy",PLAIN:"plain"}),[]),[Bi,Fl]=jn("department"),[ua,Ru]=jn(!1),[ul,bc]=jn("solid"),[Ps,_a]=jn(!1),gu=(O,de)=>{const Te=new Set(O);return(de||[]).forEach(Me=>{Me&&Te.add(Me)}),Array.from(Te).sort()},Qo=nr(O=>{const de=_.current;if(!de||!de.getLayer(zf))return;const Te=Array.isArray(O)?O.filter(tt=>tt!=null):O!=null?[O]:[];Ct.current=Te;const Me=Te.length?["any",["in",["id"],["literal",Te]],["in",["get","RevitId"],["literal",Te]]]:["==",["id"],""];try{de.setFilter(zf,Me),de.getLayer(ug)&&de.setFilter(ug,Me)}catch{}},[]),[Ws,Ba]=jn(new Map),[Ol,_s]=jn(!1),[Uo,Ia]=jn(null),[Ks,yu]=jn([]),[wc,iu]=jn(null),za=So([]),nc=nr((O=[])=>(O||[]).map(de=>de?.highlightId??de?.revitId??de?.roomId??null).filter(de=>de!=null),[]),_l=nr((O=[])=>{const de=nc(O);Qo(de.length?de:null)},[nc,Qo]),Bl=nr(()=>{za.current=[],yu([]),_l([])},[_l]),zl=nr(O=>{const de=_.current,Te=Wu(de,ma);if(!Te)return;const Me=Te._data||Te.serialize?.()?.data||null,tt=Au(Me);if(!tt?.features?.length)return;const ze=new Map,Ke=new Map,At=gt=>{if(Number.isFinite(gt))return gt;const $t=Number(gt);return Number.isFinite($t)?$t:String(gt)};tt.features.forEach(gt=>{const $t=gt.properties||{},en=Rf($t);if(!Number.isFinite(en)||en<=0)return;const An=$t.__roomType??$t.NCES_Type??$t.RoomType??$t["Room Type"]??$t.Type??$t.type??$t.Name??"",yn=pq(An);let Kt="",rn="#e6e6e6";const $n=(gr={})=>{const ti=gr.occupancyStatus??gr["Occupancy Status"]??gr.OccupancyStatus??gr.Occupancy??gr.Vacancy??gr.vacancy??gr.Vacant??"",Or=String(ti??"").trim();if(Or){const _i=Or.toUpperCase();return _i.includes("VACANT")||_i.includes("UNOCCUPIED")||_i.includes("AVAILABLE")||_i.includes("UNASSIGNED")?"Vacant":_i.includes("OCCUPIED")?"Occupied":"Unknown"}return(gr.occupant??gr.Occupant??"").toString().trim()?"Occupied":"Unknown"};if(O===Lo.TYPE)Kt=($t.__roomType||"").toString().trim()||"Unknown",rn=nw(Kt);else if(O===Lo.OCCUPANCY){if(!yn)return;Kt=$n($t),rn=Kt==="Occupied"?"#29b6f6":Kt==="Vacant"?"#ff7043":"#cfd8dc"}else if(O===Lo.VACANCY){if(!yn)return;Kt=$n($t),rn=Kt==="Vacant"?"#ff7043":"#cfd8dc"}else Kt=Xy($t)||"Unspecified",rn=ef(Kt)||"#e6e6e6";const yr=ze.get(Kt)||{name:Kt,areaSf:0,color:rn};yr.areaSf+=en,yr.color=rn,ze.set(Kt,yr);const On=At(gt.id??$t.RevitId??$t.id);if(On!=null){const gr=Ke.get(Kt)||[];gr.push(On),Ke.set(Kt,gr)}});const kt=Array.from(ze.values()).map(gt=>({...gt,ids:Ke.get(gt.name)||[]})).sort((gt,$t)=>($t.areaSf||0)-(gt.areaSf||0));ut(kt),Ie(new Map(kt.map(gt=>[gt.name,gt.ids||[]])))},[Lo.OCCUPANCY,Lo.TYPE,Lo.VACANCY]),vl=nr(O=>{if(Bi===Lo.DEPARTMENT){ut(k1(B3(O?.totalsByDept))),Ie(new Map);return}ut([]),Ie(new Map),zl(Bi)},[Lo.DEPARTMENT,Bi,zl]),el=nr(O=>{const de=_.current;if(!de||!de.getLayer(ko))return;const Te=kt=>{try{Uy(de,kt)}catch{}},Me=Wu(de,ma),tt=Me&&(Me._data||Me.serialize?.().data)||null,ze=Au(tt),Ke=O===Lo.VACANCY?Lo.OCCUPANCY:O,At=c?Lo.PLAIN:Ke;if(!(c&&ua)){if(At===Lo.PLAIN)try{de.setPaintProperty(ko,"fill-color","#f3f4f6"),de.setPaintProperty(ko,"fill-opacity",.86),Te(At),ut([]),Ie(new Map),ht(null);return}catch{}if(At===Lo.DEPARTMENT&&ze?.features?.length){const kt=new Map,gt=new Map,$t=new Map,en=Kt=>{if(Number.isFinite(Kt))return Kt;const rn=Number(Kt);return Number.isFinite(rn)?rn:Kt!=null?String(Kt):null};ze.features.forEach(Kt=>{const rn=Kt.properties||{},$n=Xy(rn)||"Unspecified",yr=ef($n)||"#e6e6e6";kt.set($n,yr);const On=Rf(rn);if(Number.isFinite(On)&&On>0){const ti=gt.get($n)||0;gt.set($n,ti+On)}const gr=en(Kt.id??rn.RevitId??rn.id);if(gr!=null){const ti=$t.get($n)||[];ti.push(gr),$t.set($n,ti)}});const An=[];kt.forEach((Kt,rn)=>{An.push(rn,Kt)});const yn=["match",["coalesce",["feature-state","department"],["get","department"],["get","Department"],["get","Dept"],["get","NCES_Department"],["get","NCES_Dept"]],...An,"#e6e6e6"];try{de.setPaintProperty(ko,"fill-color",yn),de.setPaintProperty(ko,"fill-opacity",1),Te(At);const Kt=Array.from(kt.entries()).map(([rn,$n])=>({name:rn,color:$n,areaSf:gt.get(rn)||0,ids:$t.get(rn)||[]})).sort((rn,$n)=>($n.areaSf||0)-(rn.areaSf||0));ut(Kt),Ie(new Map(Kt.map(rn=>[rn.name,rn.ids||[]])));return}catch{}}if(At===Lo.TYPE&&ze?.features?.length){const kt=new Map,gt=new Map,$t=new Map,en=rn=>{if(Number.isFinite(rn))return rn;const $n=Number(rn);return Number.isFinite($n)?$n:rn!=null?String(rn):null};ze.features.forEach(rn=>{const $n=rn.properties||{},yr=($n.__roomType||"").toString().trim()||"Unknown",On=nw(yr);kt.set(yr,On);const gr=Rf($n);if(Number.isFinite(gr)&&gr>0){const Or=gt.get(yr)||0;gt.set(yr,Or+gr)}const ti=en(rn.id??$n.RevitId??$n.id);if(ti!=null){const Or=$t.get(yr)||[];Or.push(ti),$t.set(yr,Or)}});const An=[];kt.forEach((rn,$n)=>{An.push($n,rn)});const Kt=["match",["case",["any",["!",["has","__roomType"]],["==",["get","__roomType"],""]],"Unknown",["get","__roomType"]],...An,"#e6e6e6"];try{de.setPaintProperty(ko,"fill-color",Kt),de.setPaintProperty(ko,"fill-opacity",1),Te(At);const rn=Array.from(kt.entries()).map(([$n,yr])=>({name:$n,color:yr,areaSf:gt.get($n)||0,ids:$t.get($n)||[]})).sort(($n,yr)=>(yr.areaSf||0)-($n.areaSf||0));ut(rn),Ie(new Map(rn.map($n=>[$n.name,$n.ids||[]])));return}catch{}}sw(de,At),Te(At),zl(At),Fl(At)}},[Lo.OCCUPANCY,Lo.PLAIN,Lo.TYPE,Lo.VACANCY,sw,zl,c,ua]);ui(()=>{za.current=Ks},[Ks]);const ks=nr(()=>{_s(!1),Ia(null),Bl(),Qo(null),gl(new Set),iu(null)},[Bl,Qo]);ui(()=>{c&&(_s(!1),Ia(null),gl(new Set),iu(null),Bl(),Qo(null))},[c,Bl,Qo]);const No=Uo?.targets?.length?Uo.targets:Uo?[Uo]:[],vs={...(No[0]||null)?.feature?.properties||{},...Uo?.properties||{}},Ca=["Occupied","Vacant","Unknown"],Sc=(O={})=>O.occupancyStatus??O["Occupancy Status"]??O.OccupancyStatus??O.Occupancy??O.occupancy??"",zh=(O={})=>O.seatCount??O.SeatCount??O["Seat Count"]??O.Seats??O.Capacity??O.rm_seats??O.SeatingCapacity??O["NCES_Seat Count"]??O.NCES_Seat_Count??O["NCES_Seat Count"]??O.NCES_SeatCount??"",Ch=(O=[])=>{const de=Array.from(new Set((O||[]).map(Te=>(Te??"").toString().trim()).filter(Boolean)));return de.length?de.length===1?de[0]:"__MIXED__":""},rc=No.length>1,eh=Uo?.properties?.occupancyStatus,Ec=eh!=null?String(eh).trim():"",td=Ec.length>0,jh=rc?td?Ec:Ch(No.map(O=>{const de={...O?.feature?.properties||{},...O?.properties||{}};return Sc(de)})):Ec||String(Sc(vs)||"").trim(),ic=Uo?.properties?.seatCount,jc=ic!=null?String(ic).trim():"",La=rc?jc||Ch(No.map(O=>{const de={...O?.feature?.properties||{},...O?.properties||{}};return zh(de)})):jc||String(zh(vs)||"").trim(),Uc=No.length>0&&No.every(O=>{const de={...O?.feature?.properties||{},...O?.properties||{},...Uo?.properties||{}},Te=gd(de)||de.type||de["Room Type"]||de["Room Type Description"]||"";return hw(Te)}),Mu=No.length>0&&No.every(O=>{const de={...O?.feature?.properties||{},...O?.properties||{},...Uo?.properties||{}},Te=gd(de)||de.type||de["Room Type"]||de["Room Type Description"]||"";return D1(Te)});$f(vs,["NCES_Category","NCES Category","NCES_Category_Code","NCES Category Code"]),$f(vs,["NCES_Type","NCES Type","NCES_Type_Code","NCES Type Code"]),$f(vs,["NCES_Type Description_Sh","NCES_Type Description","NCES Type Description","NCES_Type Description_Short"]);const xl=So(null),bl=So(null),Xs=So(null),th=So(null),Jn=So({url:null,key:null,buildingId:null,floorId:null}),Nu=So(null),Ac=So({}),hl=So({}),as=So(new Map),Tc=So(new Map);So({});const Vc=So(""),ha=So(null),Du=So(null);So({});const[qc,oc]=jn(()=>c?"campus":"floor"),[qn,jl]=jn("LEVEL_1"),[va,$c]=jn([]),ou=So(new Map),su=So(new Map),lr=Wa(()=>{const O=n?.buildings?.features||[],de=O.find(Me=>String(Me?.properties?.id)===String(F));return de||O.find(Me=>(Me?.properties?.name||"")===(j||""))||null},[n,F,j]),li=lr?.properties?.name||j||F||"Building",ja=qn??(va?.[0]||""),es=c&&qc==="floor",Ul=nr(O=>O?ou.current.get(O)??[]:[],[]),Do=nr(O=>{if(!O)return null;const de=Lf(O);return de&&rm[de]?rm[de]:yC.has(O)?O:null},[]),ao=nr((O,de)=>{const Te=c0(de);if(!O||!Te)return null;const Me=Do(O);if(!Me||!Ul(Me).includes(Te))return null;const Ke=su.current.get(Me)?.get(Te);if(Ke)return/^https?:\/\//i.test(Ke)?Ke:Qd(Ke);const At=encodeURIComponent(iw),kt=encodeURIComponent(Me),gt=encodeURIComponent(Te);return Qd(`floorplans/${At}/${kt}/Rooms/${gt}_Dept_Rooms.geojson`)},[Ul,Do]),Zs=nr(async O=>{const de=Do(O);if(!de)return[];const Te=Ul(de),Me=su.current.has(de);if(Te.length&&Me)return Te;const tt=await GA(de),ze=(tt||[]).map(At=>c0(At?.id)).filter(Boolean),Ke=new Map((tt||[]).filter(At=>At?.id&&At?.url).map(At=>[At.id,At.url]));return ou.current.set(de,ze),su.current.set(de,Ke),ze},[Do,Ul]),[Lh,Ph]=jn([]),[ni,nh]=jn(!1);So([]);const rh=So(null),dl=Wa(()=>ao(j,qn),[j,qn,ao]);ui(()=>{rh.current=dl},[dl]),ui(()=>{vn.current=Mt,Bn.current=!!Mt},[Mt]),ui(()=>{Ai.current=kr,no.current=!!kr},[kr]),ui(()=>{if(!k||!_.current)return;const de=_.current.getCanvas();if(de){if(Mt){Tn.current=de.style.cursor||"",de.style.cursor="crosshair";return}kr||(de.style.cursor=Tn.current||"")}},[k,Mt]),ui(()=>{if(!k||!_.current)return;const de=_.current.getCanvas();if(de){if(kr){yo.current=de.style.cursor||"",de.style.cursor=kr==="move"?"move":"grab";return}Mt||(de.style.cursor=yo.current||"")}},[k,kr,Mt]),ui(()=>{if(!k||!_.current)return;const O=_.current;O.getLayer(ko)&&(el(Bi),Uy(O,Bi))},[k,Bi,el]),ui(()=>{!k||!dl||zl(Bi)},[k,dl,Bi,zl]),ui(()=>{ht(null),Qo(null)},[Bi,dl,Qo]),ui(()=>{Bl()},[F,dl,Bl]),ui(()=>{Aa(!1),dn(!1),pu(null),ss(""),Ya(!1),Cs(!1),js(null),zr(""),Zo(!1),_o(!1),vo(null),ku("")},[F,j,qn]),ui(()=>{Mt&&(Bt(null),Pt(""))},[F,j,qn]),ui(()=>{kr&&(Lr(null),Ar(""))},[F,j,qn]);const[wl,Uh]=jn(!1),[Sl,ih]=jn(new Set),[El,Al]=jn({}),[Ni,Ua]=jn(""),[Vl,Va]=jn(""),[lo,vd]=jn({totalSF:0,rooms:0,roomTypes:{},sfByRoomType:{}}),nd=Wa(()=>{const O=new Set([...Object.keys(lo.roomTypes||{}),...Object.keys(lo.sfByRoomType||{})]);return Array.from(O).map(de=>({type:de,count:lo.roomTypes?.[de]??0,sf:lo.sfByRoomType?.[de]??0}))},[lo]),[ql,_u]=jn(!1),xa=So(new Map),vu=So(new Set),[xd,sc]=jn(20),[Pa,qo]=jn(null),Hi=So(null),xu=So(null),Rs="scenario-highlight",ac="rgba(255, 159, 64, 0.9)",oh="#ff9f40",tl=nr(()=>{const O=_.current;if(O&&O.getLayer(Rs))try{O.removeLayer(Rs)}catch{}},[]),nl=nr((O=[])=>{if(!O.length)return;const de=_.current;if(!de)return;const Te=Wu(de,ma);if(!Te)return;const Me=Te._data||Te.serialize?.()?.data,tt=Au(Me);if(!tt?.features?.length)return;const ze=new Map;if(O.forEach(({revitId:gt,dept:$t})=>{gt!=null&&ze.set(String(gt),$t??null)}),!ze.size)return;let Ke=!1;const At=tt.features.map(gt=>{const $t=gt.id??gt.properties?.RevitId;if($t==null)return gt;const en=String($t);if(!ze.has(en))return gt;const An=ze.get(en),yn={...gt.properties||{}},Kt=gt.properties?.scenarioDepartment??null;An?yn.scenarioDepartment=An:delete yn.scenarioDepartment;const rn=yn.scenarioDepartment??null;return Kt===rn?gt:(Ke=!0,{...gt,properties:yn})});if(!Ke)return;const kt={...tt,features:At};try{Te.setData(kt)}catch{}Jn.current&&(Jn.current={...Jn.current||{},fc:kt})},[]),Fu=nr((O=[],de=xa.current)=>{const Te=_.current;Te&&Wu(Te,ma)&&O.forEach(Me=>{const tt=de.get(Me);if(tt?.revitId)try{h5(tt.revitId).forEach(Ke=>{Te.removeFeatureState({source:ma,id:Ke},"scenarioColor"),Te.removeFeatureState({source:ma,id:Ke},"scenarioOutlineColor"),Te.removeFeatureState({source:ma,id:Ke},"scenarioDepartment")})}catch{}})},[]),Ic=nr(()=>{const de=Array.from(xa.current.values()).filter(Te=>Te?.revitId!=null).map(Te=>({revitId:Te.revitId,dept:null}));Fu(Array.from(vu.current),xa.current),de.length&&nl(de),xa.current=new Map,vu.current=new Set,ih(new Set),Al({}),vd({totalSF:0,rooms:0,roomTypes:{},sfByRoomType:{}}),Ua(""),Va(""),_u(!1),qo(null),sc(20),Bo(!1),tl()},[Fu,tl,nl]),lc=nr(()=>{Ic()},[Ic]),Tl=nr(()=>{const O=_.current;if(!(!O||!Wu(O,ma))&&!O.getLayer(Rs))try{O.addLayer({id:Rs,type:"fill",source:ma,paint:{"fill-color":["coalesce",["feature-state","scenarioColor"],ac],"fill-outline-color":["coalesce",["feature-state","scenarioOutlineColor"],oh],"fill-opacity":1},filter:["==",["get","id"],""]}),O.getLayer(Jh)&&O.moveLayer(Rs,Jh),dw(O)}catch{}},[]),sh=nr(O=>{Tl();const de=_.current;if(!de||!de.getLayer(Rs))return;const Te=Array.isArray(O)?O.flatMap(ze=>h5(ze)):[],Me=Array.from(new Set(Te)),tt=Me.length?["any",["in",["id"],["literal",Me]],["in",["get","RevitId"],["literal",Me]],["in",["get","Revit_UniqueId"],["literal",Me]],["in",["get","Revit Unique Id"],["literal",Me]],["in",["get","Room GUID"],["literal",Me]]]:["==",["id"],""];try{de.setFilter(Rs,tt)}catch{}},[Tl]),hr=nr(O=>{const de={totalSF:0,rooms:0,roomTypes:{},sfByRoomType:{}},Te=[],Me=xa.current;return O.forEach(tt=>{const ze=Me.get(tt);if(!ze)return;const Ke=Number.isFinite(Number(ze.area))?Number(ze.area):0,At=oa(ze.roomType??ze.type??"Unknown")||"Unknown";de.rooms+=1,de.totalSF+=Ke,de.roomTypes[At]=(de.roomTypes[At]||0)+1,de.sfByRoomType[At]=(de.sfByRoomType[At]||0)+Ke,ze.revitId!=null&&Te.push(ze.revitId),ze.roomGuid&&ze.roomGuid!==ze.revitId&&Te.push(ze.roomGuid)}),{totals:de,highlightIds:Te}},[]),ah=nr((O,de)=>{const Te=O?.buildingLabel&&(O?.floorName||O?.floorId)&&O?.revitId!=null?Jd(O.buildingLabel,O.floorName||O.floorId,O.revitId):null,Me=O?.roomId||Te||O?.id||[O?.buildingLabel,O?.floorName||O?.floorId,O?.roomLabel,de].filter(Boolean).join("|")||`cand-${de}`,tt=O?.roomGuid??O?.revitUniqueId??O?.revitUniqueID??null,ze=O?.revitId??tt??null;return{roomId:Me,buildingId:O?.buildingLabel||"",buildingName:O?.buildingLabel||"",floorName:O?.floorName||O?.floorId||"",revitId:ze,roomGuid:tt,roomNumber:O?.roomLabel||"",roomType:O?.type||"Unspecified",department:O?.department||"",area:Number(O?.sf||0)||0}},[]),C=nr(O=>{Al(de=>{const Te={};return O.forEach(Me=>{de[Me]&&(Te[Me]=de[Me])}),Te})},[]),B=nr(O=>{const{totals:de,highlightIds:Te}=hr(O),Me=vu.current,tt=Array.from(Me).filter(ze=>!O.has(ze));tt.length&&Fu(tt,xa.current),vu.current=new Set(O),vd(de),_u(O.size>0),sh(Te),C(O)},[hr,sh,Fu,C]),Q=nr((O=[])=>{const de=vu.current;de?.size&&Fu(Array.from(de),xa.current),xa.current=new Map,vu.current=new Set;const Te=new Set;(O||[]).forEach((Me,tt)=>{const ze=ah(Me,tt);ze?.roomId&&(xa.current.set(ze.roomId,ze),Te.add(ze.roomId))}),ih(Te),B(Te)},[ah,Fu,B]),oe=nr(O=>{O?.roomId&&ih(de=>{const Te=new Set(de);return Te.has(O.roomId)?Te.delete(O.roomId):(Te.add(O.roomId),xa.current.set(O.roomId,O)),B(Te),Te})},[B]),Pe=nr((O,de=.35)=>O8(O,de),[]),qe=nr((O,de={})=>{const Te=xa.current.get(O);if(!Te?.revitId)return;const Me=_.current;if(!Me||!Wu(Me,ma))return;const tt={...de};if(Object.keys(tt).length)try{h5(Te.revitId).forEach(Ke=>{Me.setFeatureState({source:ma,id:Ke},tt)})}catch{}},[]),He=nr(()=>{if(!Ni||Sl.size===0)return;const O=ef(Ni)||oh,de=Pe(O,.9);Al(Me=>{const tt={...Me};return Sl.forEach(ze=>{tt[ze]=Ni,qe(ze,{scenarioColor:de,scenarioOutlineColor:O,scenarioDepartment:Ni})}),tt});const Te=[];Sl.forEach(Me=>{const tt=xa.current.get(Me);tt?.revitId!=null&&Te.push({revitId:tt.revitId,dept:Ni})}),Te.length&&nl(Te)},[Ni,Sl,qe,Pe,nl]),Je=nr(async()=>{if(!Vi){alert("No scenario comparison available yet.");return}try{const O=new Si("p","pt","letter"),de=O.internal.pageSize.getWidth(),Te=O.internal.pageSize.getHeight(),Me=36,tt=de-Me*2,ze=14;let Ke=Me;const At=(Gr=ze)=>{Ke+Gr>Te-Me&&(O.addPage(),Ke=Me)},kt=(Gr,jr={})=>{const Wr=jr.indent||0;At(ze),O.text(String(Gr),Me+Wr,Ke),Ke+=ze},gt=(Gr,jr={})=>{const Wr=jr.indent||0,Un=Math.max(50,tt-Wr);O.splitTextToSize(String(Gr),Un).forEach(pn=>kt(pn,{indent:Wr}))},$t=Gr=>{Gr&&(At(ze*1.2),O.setFont(void 0,"bold"),O.setFontSize(12),gt(Gr),O.setFont(void 0,"normal"),O.setFontSize(11))},en=(Gr=[])=>{const jr=Array.isArray(Gr)?Gr:[];jr.length&&jr.forEach(Wr=>gt(`- ${Wr}`,{indent:8}))},An=(Gr={})=>{let jr=0,Wr=0,Un=0;for(const[Jt,pn]of Object.entries(Gr||{})){const Xn=String(Jt||"").toLowerCase(),dr=Number(pn||0)||0;Xn.includes("office")?jr+=dr:Xn.includes("class")?Wr+=dr:Xn.includes("lab")&&(Un+=dr)}return{offices:jr,classrooms:Wr,labs:Un}},yn=Vi?.scenarioDept||Ni||"Scenario",Kt=Xt?.__label||"baseline",rn=li||j||F||"scenario",$n=qn?` (${qn})`:"";O.setFontSize(16),O.setFont(void 0,"bold"),kt("Scenario Comparison"),O.setFont(void 0,"normal"),O.setFontSize(11),gt(`${yn} - ${Kt} to ${rn}${$n}`),Vi.summary&&($t("Summary"),gt(Vi.summary)),$t("Totals");const yr=Xt||{},On=lo||{},gr=An(yr.roomTypes),ti=An(On.roomTypes);kt(`Baseline (${Kt})`),kt(`Total SF: ${Math.round(yr.totalSF||0).toLocaleString()}`,{indent:8}),kt(`Rooms: ${Math.round(yr.rooms||0).toLocaleString()}`,{indent:8}),(gr.offices||gr.classrooms||gr.labs)&&(kt(`Offices: ${gr.offices}`,{indent:8}),kt(`Classrooms: ${gr.classrooms}`,{indent:8}),kt(`Labs: ${gr.labs}`,{indent:8})),Ke+=ze/2,kt(`Scenario (${rn})`),kt(`Total SF: ${Math.round(On.totalSF||0).toLocaleString()}`,{indent:8}),kt(`Rooms: ${Math.round(On.rooms||0).toLocaleString()}`,{indent:8}),(ti.offices||ti.classrooms||ti.labs)&&(kt(`Offices: ${ti.offices}`,{indent:8}),kt(`Classrooms: ${ti.classrooms}`,{indent:8}),kt(`Labs: ${ti.labs}`,{indent:8}));const Or=(On.totalSF||0)-(yr.totalSF||0),Hr=(On.rooms||0)-(yr.rooms||0);kt(`Delta SF: ${Math.round(Or).toLocaleString()}`,{indent:8}),kt(`Delta Rooms: ${Math.round(Hr).toLocaleString()}`,{indent:8}),Vi?.scenarioPros?.length&&($t("Pluses"),en(Vi.scenarioPros)),Vi?.scenarioCons?.length&&($t("Minuses"),en(Vi.scenarioCons)),Vi?.risks?.length&&($t("Risks / watchouts"),en(Vi.risks)),Vi?.notes?.length&&($t("Notes"),en(Vi.notes)),Array.isArray(Vi?.data_used)&&Vi.data_used.length&&($t("Data used"),gt(Vi.data_used.join(", ")));const _i=(Gr,jr)=>{if(!Gr?.data)return;O.addPage();const Wr=36,Un=O.internal.pageSize.getWidth(),Jt=O.internal.pageSize.getHeight(),pn=jr?`Floorplan - ${jr}`:"Floorplan";O.setFont(void 0,"bold"),O.setFontSize(14),O.text(pn,Wr,Wr),O.setFont(void 0,"normal"),O.setFontSize(11);const Xn=Gr.height&&Gr.width?Gr.height/Gr.width:1;let dr=Un-Wr*2,qr=dr*Xn;const Di=Jt-Wr*2-18;qr>Di&&(qr=Di,dr=qr/(Xn||1));const Wn=Wr,qi=Wr+18;O.addImage(Gr.data,"PNG",Wn,qi,dr,qr)},vr=new Map;Sl.forEach(Gr=>{const jr=xa.current.get(Gr);if(!jr)return;const Wr=jr?.buildingName||jr?.buildingId||li||j||"",Un=jr?.floorName||jr?.floorId||qn||"";if(!Wr||!Un)return;const Jt=`${tu(Wr)}|${Na(Un)}`;vr.has(Jt)||vr.set(Jt,{buildingLabel:Wr,floorLabel:Un,ids:[]});const pn=vr.get(Jt);jr?.revitId!=null&&pn.ids.push(jr.revitId),jr?.roomGuid&&jr.roomGuid!==jr.revitId&&pn.ids.push(jr.roomGuid)});const Rr=[];if(vr.size)for(const Gr of vr.values()){const jr=await Zs(Gr.buildingLabel),Wr=F1(Gr.floorLabel,jr)||Gr.floorLabel,Un=ao(Gr.buildingLabel,Wr);if(!Un)continue;let Jt=ps.get(Un);if(!Jt)try{Jt=await pd(Un),Jt&&ps.set(Un,Jt)}catch{}const pn=Au(Jt);if(!pn?.features?.length)continue;const Xn=Xg({fc:pn,colorMode:Bi,solidFill:!0,selectedIds:Gr.ids,labelOptions:{hideDrawing:!0}});Xn?.data&&Rr.push({img:Xn,label:`${Gr.buildingLabel} - ${Wr}`})}if(Rr.length)Rr.forEach(Gr=>_i(Gr.img,Gr.label));else{const Gr=[];Sl.forEach(Un=>{const Jt=xa.current.get(Un);Jt?.revitId!=null&&Gr.push(Jt.revitId),Jt?.roomGuid&&Jt.roomGuid!==Jt.revitId&&Gr.push(Jt.roomGuid)});const jr=Jn?.current;let Wr=jr?.fc?Xg({...jr,colorMode:Bi,solidFill:!0,selectedIds:Gr,labelOptions:{hideDrawing:!0}}):null;if(!Wr?.data&&j&&qn){const Un=ao(j,qn);if(Un){let Jt=ps.get(Un);if(!Jt)try{Jt=await pd(Un),Jt&&ps.set(Un,Jt)}catch{}const pn=Au(Jt);pn?.features?.length&&(Wr=Xg({fc:pn,colorMode:Bi,solidFill:!0,selectedIds:Gr,labelOptions:{hideDrawing:!0}}))}}if(Wr?.data){const Un=jr?.floor||jr?.floorId||qn||"";_i(Wr,Un||"")}}const ji=`${yn}-scenario-compare`.replace(/\s+/g,"-").replace(/[^\w-]+/g,"").toLowerCase();O.save(`${ji}.pdf`)}catch(O){console.error("Scenario export failed",O),alert("Export failed - see console for details.")}},[Vi,Ni,Xt,lo,li,j,F,qn,Sl,Bi,Zs,F1,ao,pd]);ui(()=>{wl&&Tl()},[wl,Tl]),ui(()=>{if(!wl||Sl.size===0)return;const{highlightIds:O}=hr(Sl);sh(O)},[wl,Sl,dl,hr,sh]);const[et,dt]=jn(!1),[Nt,tn]=jn(null),[ct,Ft]=jn(null);ui(()=>{et||wl||_l(Ks)},[Ks,_l,et,wl]);const Qt=O=>{const de=m.current?.clientWidth??0,Te=m.current?.clientHeight??0,Me=de||1e3,tt=Te||800,ze=O.x+110,Ke=O.y-160,At=Math.max(8,tt*.15),kt=Math.max(At,Math.min(tt-220,tt*.65));return{x:Math.min(Math.max(ze,8),Me-260),y:Math.min(Math.max(Ke,At),kt)}},En=nr(O=>{!O||Pa||sc(()=>{const de=m.current?.clientHeight??0,Te=Math.max(360,(de||0)*.7),Me=Math.max(8,(de||800)-Te-40),tt=O.y-120;return Math.max(8,Math.min(tt,Me))})},[Pa]),y=nr(()=>{Pa||sc(O=>{const de=m.current?.clientHeight??0,Te=Math.max(360,(de||0)*.7),Me=Math.max(8,(de||800)-Te-40);return Math.max(8,Math.min(O-40,Me))})},[Pa]),[a,f]=jn(null),[v,S]=jn(!1),[T,N]=jn(!1),[z,G]=jn(!1),[ee,te]=jn([]),ge=nr(O=>O?Lf(O):null,[]),Ae=nr(async O=>{if(!O)return null;const de=[];if(typeof O=="string"&&O.endsWith("_Dept.geojson")){const Ke=O.replace(/\/([^/]+)$/,"/Rooms/$1");de.push(O.replace("_Dept.geojson","_Dept_Rooms.geojson").replace(/\/([^/]+)$/,"/Rooms/$1")),de.push(Ke),de.push(O.replace("_Dept.geojson","_Dept_Rooms.geojson")),de.push(O)}else de.push(O);for(const Ke of de)if(hl.current[Ke])return hl.current[Ke];let Te=null,Me=null;for(const Ke of de)if(Te=ps.get(Ke),Te||(Te=await pd(Ke),Te&&ps.set(Ke,Te)),Te){Me=Ke;break}if(!Te)return console.warn("Floor summary: no data returned",O),null;const tt=Au(Te);if(!Array.isArray(tt?.features))return console.warn("Floor summary: no features, skipping",Me||O),null;const ze=O3(tt.features);for(const Ke of de)hl.current[Ke]=ze;return ze},[]),Le=nr(async(O,de)=>{const Te=ao(O,de);return Te?Ae(Te):null},[ao,Ae]),Xe=nr(async O=>{if(!O)return null;const de=ge(O)||O;if(!de)return null;if(Ac.current[de])return Ac.current[de];const Te=Do(de);let Me=Te?Ul(Te):[];if(Me.length||(Me=await Zs(de)),!Me.length)return null;const tt=pp(O),ze={totalSf:0,classroomSf:0,labSf:0,officeSf:0,rooms:0,classroomCount:0,labCount:0,officeCount:0,deptCounts:new Map};for(const At of Me){const kt=ao(de,At);if(!kt)continue;const gt=Na(At),$t=`${tt}/${gt}`;let en=as.current.get($t);en||(en=hl.current[kt],en||(en=await Le(de,At)),en&&as.current.set($t,en)),en&&(ze.totalSf+=en.totalSf||0,ze.classroomSf+=en.classroomSf||0,ze.labSf+=en.labSf||0,ze.officeSf+=en.officeSf||0,ze.rooms+=en.rooms||0,ze.classroomCount+=en.classroomCount||0,ze.labCount+=en.labCount||0,ze.officeCount+=en.officeCount||0,Object.entries(en.deptCounts||{}).forEach(([An,yn])=>{ze.deptCounts.set(An,(ze.deptCounts.get(An)||0)+yn)}))}const Ke=jy(ze);return Ac.current[de]=Ke,Ke},[Le,ge,Ul,Do,ao,Zs]),Ue=nr(async O=>{if(!O)return{totalSf:void 0,rooms:void 0,classroomSf:void 0,classroomCount:void 0,labSf:void 0,labCount:void 0,officeSf:void 0,officeCount:void 0,totalsByDept:{}};if(Zt&&Array.isArray(yt)&&yt.length){const Te=po(O);if(Te){const Me=yt.filter(ze=>{const Ke=ze?.building??ze?.buildingName??ze?.buildingLabel??"";return po(Ke)===Te}),tt=Zg(Me);if(tt)return tt}}return await Xe(O)??{totalSf:void 0,rooms:void 0,classroomSf:void 0,classroomCount:void 0,labSf:void 0,labCount:void 0,officeSf:void 0,officeCount:void 0,totalsByDept:{}}},[Xe,Zt,yt]),Ze=nr(async()=>{const O=uv();return(await Promise.all(md.map(async Te=>{if(!Te?.name)return null;try{return await Ue(Te.name)}catch(Me){return console.warn("Campus summary: failed to load building stats for",Te.name,Me),null}}))).forEach(Te=>{if(!Te)return;O.totalSf+=Te.totalSf||0,O.classroomSf+=Te.classroomSf||0,O.labSf+=Te.labSf||0,O.officeSf+=Te.officeSf||0,O.rooms+=Te.rooms||0,O.classroomCount+=Te.classroomCount||0,O.labCount+=Te.labCount||0,O.officeCount+=Te.officeCount||0;const Me=Te.deptCounts||Te.totalsByDept||{};Object.entries(Me).forEach(([tt,ze])=>{const Ke=Number(ze)||0;O.deptCounts.set(tt,(O.deptCounts.get(tt)||0)+Ke)})}),jy(O)},[Ue]);ui(()=>{let O=!1;return(async()=>{try{const Te=await Ze();if(O)return;wr(Te),Ir(Hu(Te,"campus"))}catch(Te){if(O)return;console.warn("Campus summary load failed",Te),wr(null),Ir(Hu(null,"campus"))}})(),()=>{O=!0}},[Ze]);const _e=nr(async O=>{const de=Do(O);if(!de)return;let Te=Ul(de);if(Te.length||(Te=await Zs(O)),!!Te.length)try{await Promise.all(Te.map(Me=>Le(O,Me)))}catch(Me){console.warn("Floor summary prefetch failed:",Me)}},[Do,Ul,Le,Zs]),$e=nr(O=>{if(Ei("building"),Dn(null),!O){Pn(null),or(Hu(null,"building"));return}const de=ge(O)||O;if(ha.current=de,Xs.current=null,Jn.current={url:null,key:null,buildingId:null,floorId:null},or({loading:!0,mode:"building"}),Zt&&Array.isArray(yt)&&yt.length){const Te=po(O);if(Te){const Me=yt.filter(ze=>{const Ke=ze?.building??ze?.buildingName??ze?.buildingLabel??"";return po(Ke)===Te}),tt=Zg(Me);if(tt){Pn(tt),or(Hu(tt,"building"));return}}}Ue(O).then(Te=>{ha.current===de&&(Xs.current||(Pn(Te),or(Hu(Te,"building"))))}).catch(()=>{ha.current===de&&(Xs.current||(Pn(null),or(Hu(null,"building"))))})},[Ue,ge]),it=nr(O=>{if(!O)return;Ei("floor"),Xs.current=O,or({loading:!0,mode:"floor"});const de=Jn.current;if(Zt&&Array.isArray(yt)&&yt.length){const Me=de?.buildingId||F||j,tt=de?.floorLabel||qn||"",ze=yt.filter(At=>{const kt=At?.building??At?.buildingName??At?.buildingLabel??"";if(po(kt)!==po(Me))return!1;if(!tt)return!0;const gt=Pf(tt);return gt.length?If(At?.floor??At?.floorName??At?.floorId??"",gt):!0}),Ke=Zg(ze);if(Ke){const At={...Ke,floorLabel:tt};hl.current[O]=Ke,Dn(At),vl(Ke),or(Hu(Ke,"floor"));return}}const Te=hl.current[O];if(Te){const Me=de?.floorLabel||qn||"";Dn({...Te,floorLabel:Me}),vl(Te),or(Hu(Te,"floor"));return}if(de?.url===O&&de?.key){const Me=as.current.get(de.key);if(Me){const tt=de.floorLabel||qn||"";Dn({...Me,floorLabel:tt}),vl(Me),or(Hu(Me,"floor"));return}}Ae(O).then(Me=>{if(Xs.current!==O)return;const tt=Jn.current;tt?.url===O&&tt?.key&&Me&&as.current.set(tt.key,Me);const ze=tt?.floorLabel||qn||"";Dn(Me?{...Me,floorLabel:ze}:null),vl(Me),or(Hu(Me,"floor"))}).catch(()=>{Xs.current===O&&(Dn(null),or(Hu(null,"floor")))})},[Ae,qn,vl]),ot=nr(async()=>{try{const O=await Xd("/ai/api/rooms",{cache:"no-store",timeoutMs:8e3});let de=null;try{de=await O.json()}catch{}if(O.ok&&de?.ok&&Array.isArray(de.rooms))return pt(de.rooms),bo(new Date),!0}catch{}return!1},[]),bt=nr(()=>{jo.current||(jo.current=setTimeout(()=>{jo.current=null,ot()},300))},[ot]),wt=nr(async()=>{if(Dr)return;Xr(!0),Ii("");const O=await ot(),de=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});Ii(O?`Refreshed ${de}`:"Refresh failed"),Xr(!1)},[Dr,ot]);ui(()=>()=>{jo.current&&(clearTimeout(jo.current),jo.current=null)},[]);const vt=nr(async O=>{if(t!=="admin"||!v||!O||!e)return null;const{buildingId:de,buildingName:Te,floorName:Me,revitId:tt,roomId:ze,roomLabel:Ke,roomNumber:At,roomGuid:kt,properties:gt={}}=O;if(!de||!Me||tt==null)return console.warn("Missing ids for room edit",O),null;const $t=Jd(de,Me,tt);try{const en=l0(Sh,"universities",e,"buildings",de,"floors",Me,"rooms",$t),An=String(gt.type??"").trim(),yn=gd(gt)||An,Kt=hw(yn),rn=Kt?String(gt.occupancyStatus??"").trim():"",$n=String(gt.department??"").trim(),yr=gt.occupant!=null,On=String(gt.occupant??"").trim(),gr=gt.seatCount!=null,ti=gt.seatCount,Or=Number(ti),Hr=Number.isFinite(Or)&&Or>0?Or:null,_i={type:An||"",department:$n||"",comments:gt.comments||"",updatedAt:A1()};Kt&&(_i.occupant=gt.occupant||"",_i.occupancyStatus=gt.occupancyStatus||""),gr&&(_i.seatCount=Hr),await W5(en,_i,{merge:!0});const vr=gt.airtableId||gt.AirtableId||gt.airtableID||gt["Airtable ID"]||gt["Airtable Id"]||null,Rr={};rn&&(Rr.occupancyStatus=rn),An&&(Rr.type=An),$n&&(Rr.department=$n),Kt&&yr&&(Rr.occupant=On),gr&&(Rr.seatCount=Hr);const ji=String(At??gt.roomNumber??gt.RoomNumber??gt.Number??Ke??"").trim(),Gr=String(kt??gt.Revit_UniqueId??gt.revit_unique_id??gt.revitUniqueId??gt.RevitUniqueId??gt["Room GUID"]??gt.roomGuid??"").trim();let jr=!1;if(vr&&Object.keys(Rr).length)try{const Jt=await Xd(`/ai/api/rooms/${vr}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(Rr)});if(Jt.ok)jr=!0;else{const pn=await Jt.text().catch(()=>"");console.warn("Airtable update failed",Jt.status,pn)}}catch(Jt){console.warn("Airtable update failed",Jt)}if(!jr&&(Gr||ji)&&Object.keys(Rr).length)try{const Jt=String(ji||Ke||ze||"").trim(),pn=String(Ke??"").trim(),Xn=await Xd("/ai/api/rooms",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({roomId:Jt||void 0,roomGuid:Gr||void 0,roomNumber:ji||void 0,roomLabel:pn||void 0,building:de,buildingName:Te||"",floor:Me,...Rr})});if(Xn.ok)jr=!0;else{const dr=await Xn.text().catch(()=>"");console.warn("Airtable update by roomId failed",Xn.status,dr)}}catch(Jt){console.warn("Airtable update by roomId failed",Jt)}const Wr={type:gt.type||"",department:gt.department||"",occupant:Kt?gt.occupant||"":gt.occupant??"",occupancyStatus:Kt?gt.occupancyStatus||"":gt.occupancyStatus??"",comments:gt.comments||""};gr&&(Wr.seatCount=Hr,Wr.SeatCount=Hr,Wr["Seat Count"]=Hr),Ba(Jt=>{const pn=new Map(Jt||[]),Xn=ze||$t,dr=pn.get(Xn)||{};return pn.set(Xn,{...dr,...Wr}),pn});let Un=!1;qt(Jt=>{if(!Array.isArray(Jt)||!Jt.length)return Jt;const pn=gt.airtableId||gt.AirtableId||gt.airtableID||gt["Airtable ID"]||gt["Airtable Id"]||null,Xn=Qn=>String(Qn||"").trim().toLowerCase().replace(/[^a-z0-9]/g,""),dr=String(ze??"").trim(),qr=String(Ke??"").trim(),Di=tt!=null?String(tt):"",Wn=gt.area??gt.areaSF??gt["Area (SF)"]??gt.Area_SF??gt.Area??null,qi=Number(Wn)||0,wo=po(de),ho=po(Me),dc=Xn(de),Ns=Xn(Me),Ds=[];let fo=Jt.map((Qn,lu)=>{if(!Qn)return Qn;const ad=Qn.airtableId||Qn.AirtableId||Qn["Airtable ID"]||null,Mh=String(Qn.roomId??Qn.id??"").trim(),Cl=po(Qn.building??Qn.buildingName??Qn.buildingLabel??""),Js=po(Qn.floor??Qn.floorId??Qn.floorName??""),Qs=Xn(Qn.building??Qn.buildingName??Qn.buildingLabel??""),Mc=Xn(Qn.floor??Qn.floorId??Qn.floorName??""),uh=wo&&Cl===wo||dc&&Qs===dc,ff=ho&&Js===ho||Ns&&Mc===Ns,fc=pn&&ad&&String(ad)===String(pn)||dr&&Mh===dr||Di&&Mh===Di||qr&&Mh===qr;let jd=!1;if(!fc&&uh&&ff&&qr){const pc=String(Qn.roomLabel??Qn.name??Qn.number??Qn.roomNumber??"").trim(),ci=String(Qn.roomId??Qn.id??"").trim();jd=pc&&pc===qr||ci&&ci===qr}if(!fc&&!jd){if(qr&&!uh&&!ff){const pc=String(Qn.roomId??Qn.id??"").trim();pc&&pc===qr&&Ds.push(lu)}return Qn}return Un=!0,{...Qn,type:gt.type!=null?gt.type:Qn.type,department:gt.department!=null?gt.department:Qn.department,occupant:gt.occupant!=null?gt.occupant:Qn.occupant,occupancyStatus:gt.occupancyStatus!=null?gt.occupancyStatus:Qn.occupancyStatus,seatCount:gr?Hr:Qn.seatCount??Qn.SeatCount??Qn["Seat Count"],area:qi>0?qi:Qn.area??Qn.areaSF??Qn.sf??Qn.Area_SF??Qn.Area??Qn["Area (SF)"],areaSF:qi>0?qi:Qn.areaSF??Qn.sf??Qn.area??Qn.Area_SF??Qn.Area??Qn["Area (SF)"],sf:qi>0?qi:Qn.sf??Qn.areaSF??Qn.area??Qn.Area_SF??Qn.Area??Qn["Area (SF)"],roomLabel:Qn.roomLabel??Qn.name??Qn.number??Qn.roomNumber??qr,comments:gt.comments!=null?gt.comments:Qn.comments}});if(!Un&&qr&&Ds.length===1){const Qn=Ds[0];fo[Qn]&&(Un=!0,fo[Qn]={...fo[Qn],type:gt.type!=null?gt.type:fo[Qn].type,department:gt.department!=null?gt.department:fo[Qn].department,occupant:gt.occupant!=null?gt.occupant:fo[Qn].occupant,occupancyStatus:gt.occupancyStatus!=null?gt.occupancyStatus:fo[Qn].occupancyStatus,seatCount:gr?Hr:fo[Qn].seatCount??fo[Qn].SeatCount??fo[Qn]["Seat Count"],area:qi>0?qi:fo[Qn].area??fo[Qn].areaSF??fo[Qn].sf,areaSF:qi>0?qi:fo[Qn].areaSF??fo[Qn].sf??fo[Qn].area,sf:qi>0?qi:fo[Qn].sf??fo[Qn].areaSF??fo[Qn].area,roomLabel:fo[Qn].roomLabel??fo[Qn].name??fo[Qn].number??qr,comments:gt.comments!=null?gt.comments:fo[Qn].comments})}if(!Un&&qr){const Qn=Xn(qr),lu=Xn(de),ad=Xn(Me);fo.some(Cl=>{const Js=Xn(Cl?.building??Cl?.buildingName??Cl?.buildingLabel??""),Qs=Xn(Cl?.floor??Cl?.floorId??Cl?.floorName??""),Mc=Xn(Cl?.roomLabel??Cl?.name??Cl?.number??Cl?.roomNumber??Cl?.roomId??Cl?.id??"");return Mc&&Mc===Qn&&(!lu||Js===lu)&&(!ad||Qs===ad)})||(Un=!0,fo=[...fo,{roomId:qr,roomLabel:qr,building:de,floor:Me,area:qi||0,areaSF:qi||0,sf:qi||0,type:gt.type||"",department:gt.department||"",occupant:gt.occupant||"",occupancyStatus:gt.occupancyStatus||"",seatCount:gr?Hr:null,comments:gt.comments||""}])}return fo}),jr&&bt();try{const Jt=Jn.current;Jt&&Jt.url===Xs.current&&as.current.get(Jt.key)&&as.current.delete(Jt.key)}catch(Jt){console.warn("Failed to invalidate floor summary cache",Jt)}return _i}catch(en){return console.error("Failed to save room edits",en),null}},[Sh,e,bt,t,v]);ui(()=>{if(j||!md.length)return;const O=md[0].name;H(O),jl("LEVEL_1")},[]),nr(O=>{const de=_.current,Te=m.current?.clientWidth||1e3,Me=m.current?.clientHeight||800;if(!de||!O?.geometry)return null;const tt=Cu(O);if(!tt||tt.length!==4||tt.some(gt=>!Number.isFinite(gt)))return null;const ze=(tt[1]+tt[3])/2,Ke=de.project({lng:tt[2],lat:ze}),At=Math.min(Math.max(Ke.x+12,8),Te-360),kt=Math.min(Math.max(Ke.y-120,8),Me-260);return{x:At,y:kt}},[]);const Rt=nr(async O=>{await Ri(O)},[Ri]),Lt=nr(()=>{const O=li;return{buildingLabel:Ov({buildingLabel:O,buildingId:F||j||""})||O,floorId:ja||qn||""}},[li,F,j,ja,qn]),zt=nr(()=>{const O=ja||qn||"",de=Jn.current?.url||null,Te=Jn.current?.floorAdjustBasePath||null,Me=de?Md(de):null,tt=Do(F||j)||Me,ze=Jn.current?.floorAdjustLabel||null,Ke=Jn.current?.floorAdjustFloorId||null,At=li,kt=ze||tt||Ov({buildingLabel:At,buildingId:F||j||""})||At,gt=Ke&&Na(Ke)===Na(O)?Ke:O;return{buildingLabel:kt,floorId:gt,url:de,basePath:Te}},[li,F,j,ja,qn,Do]),mn=nr((O,de)=>{const Te=tu(O||""),Me=Na(de||"");return`${Te}__${Me}`},[]),Ut=nr(async(O,de)=>{if(!e||!O||!de)return null;const Te=mn(O,de);if(!Te)return null;try{const Me=l0(Sh,"universities",e,"floorAdjustments",Te),tt=await HE(Me);return tt.exists()&&tt.data()||null}catch{return null}},[Sh,e,mn]),an=nr(async(O,de,Te)=>{if(!e||!O||!de||!Te)return;const Me=mn(O,de);if(Me)try{const tt=l0(Sh,"universities",e,"floorAdjustments",Me);await W5(tt,{buildingLabel:O,floorId:de,rotationDeg:Number.isFinite(Te.rotationDeg)?Te.rotationDeg:0,scale:Number.isFinite(Te.scale)?Te.scale:1,translateMeters:Array.isArray(Te.translateMeters)?Te.translateMeters:[0,0],translateLngLat:Array.isArray(Te.translateLngLat)?Te.translateLngLat:null,anchorLngLat:Array.isArray(Te.anchorLngLat)?Te.anchorLngLat:null,pivot:Array.isArray(Te.pivot)?Te.pivot:null,updatedAt:A1(),updatedBy:a?.uid||a?.email||null},{merge:!0})}catch{}},[Sh,e,mn,a]),Ht=nr((O,de)=>{if(!Array.isArray(O)||O.length<2||!Array.isArray(de)||de.length<2)return null;const[Te,Me]=O,[tt,ze]=de,Ke=Me[0]-Te[0],At=Me[1]-Te[1],kt=ze[0]-tt[0],gt=ze[1]-tt[1],$t=Math.hypot(Ke,At),en=Math.hypot(kt,gt);if(!Number.isFinite($t)||!Number.isFinite(en)||$t<=0||en<=0)return null;const An=Math.atan2(At,Ke),yn=Math.atan2(gt,kt),Kt=(An-yn)*180/Math.PI,rn=$t/en;return{rotationDeg:Kt,scale:rn,pivot:tt,target:Te}},[]);nr(()=>{Bt(null),Pt("")},[]),nr(()=>{if(!_.current||!_.current.getLayer(ko)){alert("Load a floorplan first, then start align.");return}const{buildingLabel:O,floorId:de}=Lt();if(!O||!de){alert("Select a building and floor before aligning.");return}Pt(""),Bt({buildingLabel:O,floorId:de,roomPts:[],drawingPts:[],step:0})},[Lt]),nr(async()=>{const{buildingLabel:O,floorId:de}=Lt();if(!O||!de)return;GU(O,de),Pt("");const Te=ao(j,de);Te&&(ps.delete(Te),Xu.delete(Te)),await Ri(de)},[Lt,j,ao,Ri]);const Cn=nr(()=>{if(!_.current||!_.current.getLayer(ko)){alert("Load a floorplan first, then rotate.");return}const{buildingLabel:O,floorId:de}=zt();if(!O||!de){alert("Select a building and floor before rotating.");return}Ar(""),Lr("rotate")},[zt]),jt=nr(()=>{if(!_.current||!_.current.getLayer(ko)){alert("Load a floorplan first, then move.");return}const{buildingLabel:O,floorId:de}=zt();if(!O||!de){alert("Select a building and floor before moving.");return}Ar(""),Lr("move")},[zt]),on=nr(()=>{Lr(null),Ar("");try{_.current?.dragPan?.enable()}catch{}},[]),In=nr(async()=>{const{buildingLabel:O,floorId:de}=zt();if(!O||!de)return;const Te=Jn.current?.floorAdjustLabel||O;HU(Te,de);const Me=Jn.current?.floorAdjustBasePath||null;Me&&KU(Me,de);const tt=Jn.current?.url||ao(j,de);tt&&WU(tt);try{await an(Te,de,{rotationDeg:0,scale:1,translateMeters:[0,0],translateLngLat:null,anchorLngLat:null,pivot:null})}catch{}Ar("");const ze=tt||ao(j,de);ze&&(ps.delete(ze),Xu.delete(ze)),await Ri(de)},[zt,j,ao,Ri,an]),xn=Lt();K8(xn.buildingLabel,xn.floorId),Mt&&jA[Mt.step]?.label,Mt&&Mt.step;const bn=zt(),pr=bn.basePath?By(bn.basePath,bn.floorId):null,Fr=bn.url?Oy(bn.url):null,sr=Wm(bn.buildingLabel,bn.floorId),fr=rw({base:pr,url:Fr,label:sr}),$r=fr.adjust,gi=v?{source:fr.source,labelKey:xx(bn.buildingLabel,bn.floorId),urlKey:bn.url?bx(bn.url):null,baseKey:bn.basePath?wx(bn.basePath,bn.floorId):null,floorId:bn.floorId,url:bn.url,basePath:bn.basePath,savedAt:$r?.savedAt||0,rotationDeg:$r?.rotationDeg||0,scale:$r?.scale||1,translateMeters:$r?.translateMeters||[0,0],translateLngLat:$r?.translateLngLat||null,anchorLngLat:$r?.anchorLngLat||null,pivot:$r?.pivot||Jn.current?.floorAdjustBasePivot||null,storedKeys:(()=>{if(typeof window>"u"||!window.localStorage)return[];try{const O=Object.keys(window.localStorage).filter(Te=>Te.startsWith($8)||Te.startsWith(G8)||Te.startsWith(H8)),de=Na(bn.floorId||"");return O.filter(Te=>de&&Te.includes(`/${de}`))}catch{return[]}})()}:null,Sr=$r?.rotationDeg||0,ki=$r?.scale||1;$r?.translateMeters;const Ci=mp($r),co=nr(()=>{ja&&(ja!==qn&&jl(ja),Rt(ja))},[ja,Rt,qn]);async function Ri(O){if(!k||!_.current)return!1;const Te=!!(O&&typeof O=="object"&&("nativeEvent"in O||"target"in O||"preventDefault"in O))?null:O,Me=c0(Te||qn),tt=Kg(F,Do)||Kg(j,Do);let ze=tt?Ul(tt):va;(!ze||ze.length===0)&&tt&&(ze=await Zs(tt));let Ke=F1(Me,ze),At=null;if(!Ke&&ze?.length&&(Ke=ze[0]),!Ke&&Me&&Te&&tt&&(!ze||ze.length===0)&&(Ke=Me,At=Qd(`floorplans/${iw}/${tt}/Rooms/${Ke}_Dept_Rooms.geojson`),ze&&!ze.includes(Ke)&&(ze=[...ze,Ke],ou.current.set(tt,ze))),!Ke)return alert("This floor is not available for this building."),!1;Ke!==qn&&jl(Ke);const kt=At||ao(j,Ke);if(!kt)return alert("No file mapped for that floor."),!1;try{Ei("floor"),Dn(null),or({loading:!0,mode:"floor"});const gt=b.current?.[kt],$t=Kg(F,Do)||Kg(j,Do),en=$t?Qd(`floorplans/Hastings/${$t}`):null,An=kt?Md(kt):null,yn=tt||An||Lf(F||j||"")||F||j,Kt=en?By(en,Ke):null,rn=kt?Oy(kt):null,$n=Wm(yn,Ke),On=rw({base:Kt,url:rn,label:$n}).adjust,gr=mp(On),ti=Number(On?.savedAt)||0,Or=await Ut(yn,Ke);if(Or){const pn={rotationDeg:Number(Or.rotationDeg)||0,scale:Number(Or.scale)||1,translateMeters:Array.isArray(Or.translateMeters)?Or.translateMeters:[0,0],translateLngLat:Array.isArray(Or.translateLngLat)?Or.translateLngLat:null,anchorLngLat:Array.isArray(Or.anchorLngLat)?Or.anchorLngLat:null,pivot:Array.isArray(Or.pivot)?Or.pivot:null},Xn=mp(pn),dr=(()=>{const Di=Or.updatedAt;return Di?.toMillis?Di.toMillis():Number.isFinite(Di?.seconds)?Di.seconds*1e3:0})();(dr?dr>=ti:!gr&&Xn)&&(R1(yn,Ke,pn),kt&&M1(kt,pn),en&&N1(en,Ke,pn),kt&&(ps.delete(kt),Xu.delete(kt)))}let Hr=bl.current||null;const _i=String(F||j||"");try{const pn=ei(_i),Xn=ei(Hr?.properties?.id||Hr?.properties?.name||"");(!Xn||pn&&Xn!==pn)&&(Hr=null)}catch{}if(!Hr)try{const pn=n?.buildings?.features||[],Xn=pn.find(dr=>String(dr.properties?.id)===_i)||null;Xn?Hr=Xn:Hr=Cf(pn,_i),Hr&&(bl.current=Hr)}catch{}!Hr&&lr&&(Hr=lr,bl.current=lr),Hr||(Hr=lv(_.current,_i),Hr&&(bl.current=Hr));const vr=nq(Hr?.properties?.id||Hr?.properties?.name||F||j,Ke),Rr=t==="admin"&&oV,ji=await TV(_.current,kt,gt,{fitBuilding:Hr,rotationOverrideDeg:vr},{buildingId:F||j,floor:Ke,labelMode:Bi,roomPatches:Ws,airtableLookup:Es,currentFloorContextRef:Jn,roomsBasePath:en,roomsFloorId:Ke,enableWalls:Rr,wallsBasePath:en,wallsFloorId:Ke,onOptionsCollected:({typeOptions:pn,deptOptions:Xn})=>{pn?.length&&ys(dr=>BU(dr,pn)),Xn&&Is(dr=>gu(dr,Xn))}});if(!ji)return or(Hu(null,"floor")),!1;nh(!0),di(pn=>pn+1),Xs.current=kt,th.current=kt;const Gr=pp(F||j||""),jr=Na(Ke||""),Wr=Gr&&jr?`${Gr}/${jr}`:null;Wr&&ji.summary&&(as.current.set(Wr,ji.summary),Tc.current.set(Wr,ji.rooms)),Jn.current={...Jn.current||{},url:kt,key:Wr,buildingId:Gr,floorId:jr,floorLabel:Ke,floorAdjustLabel:yn||Jn.current?.floorAdjustLabel||null,floorAdjustFloorId:Ke,floorAdjustBasePath:en||Jn.current?.floorAdjustBasePath||null};const Jt=(Zt&&Array.isArray(yt)&&yt.length?Zg(yt.filter(pn=>{const Xn=pn?.building??pn?.buildingName??pn?.buildingLabel??"";if(po(Xn)!==po(F||j))return!1;const dr=Pf(Ke);return dr.length?If(pn?.floor??pn?.floorName??pn?.floorId??"",dr):!0})):null)||ji.summary||null;if(Jt){hl.current[kt]=Jt,as.current.set(kt,Jt);const pn={...Jt,floorLabel:Ke};Dn(pn),vl(Jt),Xs.current===kt&&or(Hu(Jt,"floor"))}else Dn(null),or(Hu(null,"floor"));try{el(Bi),zl(Bi)}catch{}return ir(!1),Ei("floor"),ju({x:12,y:12}),Ne===Re.SPACE_DATA&&KA(_.current),!0}catch(gt){return console.error(gt),alert("Failed to load floor plan. See console for details."),nh(!1),!1}}const ba=(O,de,Te,Me,tt,ze,Ke="Key Departments")=>{if(!de&&!ze&&!Te?.length)return;const At=14,kt=Me+6,gt=24,$t=ze||"Totals";O.setFontSize(12),O.setFont(void 0,"bold"),O.text($t,kt,gt);let en=gt+At;if(O.setFont(void 0,"normal"),de&&[de.totalSF!=null?`Total SF: ${Math.round(de.totalSF).toLocaleString()}`:null,de.rooms!=null?`Rooms: ${de.rooms}`:null,de.classroomSf!=null?`Classroom SF: ${Math.round(de.classroomSf).toLocaleString()}`:null,de.classroomCount!=null?`Classrooms: ${de.classroomCount}`:null,de.levels!=null?`Levels: ${de.levels}`:null].filter(Boolean).forEach(yn=>{O.text(yn,kt,en),en+=At}),Te?.length){en+=At/2,O.setFont(void 0,"bold"),O.text(Ke,kt,en),en+=At,O.setFont(void 0,"normal");const An=10;Te.slice(0,8).forEach(yn=>{const Kt=yn.color||ef(yn.name);O.setFillColor(Kt),O.rect(Me+6,en-8,An,An,"F"),O.setTextColor("#000");const rn=yn.areaSf?`${yn.name} (${Math.round(yn.areaSf).toLocaleString()} SF)`:yn.name;O.text(rn,Me+6+An+4,en),en+=At})}},ts=nr((O,de={})=>{if(!Array.isArray(O)||!O.length){alert("No floorplan data to export.");return}try{const Te=new Si("p","pt","letter"),Me=Te.internal.pageSize.getWidth(),tt=Te.internal.pageSize.getHeight(),ze=24,Ke=de.stats||null,At=de.keyDepts||[],kt=de.summaryLabel||"",gt=de.legendTitle||"Key Departments",$t=de.filenameBase||"floorplan",en=!!(Ke||At&&At.length),An=en?130:0,yn=en?An-12:0;O.forEach((rn,$n)=>{const yr=rn?.img;if(!yr?.data)return;$n>0&&Te.addPage();const On=yr.height&&yr.width?yr.height/yr.width:1,gr=en?Me-ze*2-An-ze:Me-ze*2;let ti=Math.min(gr,yr.width),Or=ti*On;const Hr=tt-ze*2-40;Or>Hr&&(Or=Hr,ti=Or/(On||1));const _i=ze;Te.addImage(yr.data,"PNG",_i,ze+20,ti,Or),Te.setFontSize(12);const vr=rn.label||"";if(vr&&Te.text(vr,ze,ze),en){const Rr=Math.min(Me-An-ze,_i+ti+ze*.75);ba(Te,Ke,At,Rr,yn,kt||vr,gt)}});const Kt=`${$t.replace(/\s+/g,"-").toLowerCase()}.pdf`;Te.save(Kt)}catch(Te){console.error("Floor export failed",Te),alert("Export failed - see console for details.")}},[]),cc=nr(async({context:O,floorStats:de,panelStats:Te})=>{const Me=await Xd("/ai/explain-floor",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context:O,floorStats:de,panelStats:Te})}),tt=await Me.text();let ze=null;try{ze=JSON.parse(tt)}catch{}if(!Me.ok)throw new Error(ze?.error||tt||`HTTP ${Me.status}`);return ze},[]),Cc=nr(async({context:O,campusStats:de,panelStats:Te})=>{const Me=await Xd("/ai/explain-campus",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context:O,campusStats:de,panelStats:Te})}),tt=await Me.text();let ze=null;try{ze=JSON.parse(tt)}catch{}if(!Me.ok)throw new Error(ze?.error||tt||`HTTP ${Me.status}`);return ze},[]),Li=nr(async({context:O,baselineStats:de,scenarioStats:Te,deltas:Me})=>{const tt=await Xd("/ai/compare-scenario",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context:O,baselineStats:de,scenarioStats:Te,deltas:Me})}),ze=await tt.text();let Ke=null;try{Ke=JSON.parse(ze)}catch{}if(!tt.ok)throw new Error(Ke?.error||ze||`HTTP ${tt.status}`);return Ke},[]),eo=nr(async({request:O,context:de,inventory:Te,constraints:Me})=>{const tt=await Xd("/ai/create-move-scenario",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({request:O,context:de,inventory:Te,constraints:Me})}),ze=await tt.text();let Ke=null;try{Ke=JSON.parse(ze)}catch{}if(!tt.ok)throw new Error(Ke?.error||ze||`HTTP ${tt.status}`);return Ke},[]),uo=nr(async({question:O,context:de,data:Te})=>{const Me=await Xd("/ai/ask-mapfluence",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:O,context:de,data:Te})}),tt=await Me.text();let ze=null;try{ze=JSON.parse(tt)}catch{}if(!Me.ok)throw new Error(ze?.error||tt||`HTTP ${Me.status}`);return ze},[]),Ms=nr(async({context:O,buildingStats:de,panelStats:Te})=>{const Me=await Xd("/ai/explain-building",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context:O,buildingStats:de,panelStats:Te})}),tt=await Me.text();let ze=null;try{ze=JSON.parse(tt)}catch{}if(!Me.ok)throw new Error(ze?.error||tt||`HTTP ${Me.status}`);return ze},[]),qa=nr(async()=>{ss(""),dn(!0),pu(null);try{const O=Jn.current,de={universityId:e,buildingId:O?.buildingId||F||j||"",buildingLabel:O?.buildingLabel||"",floorId:O?.floorId||qn||"",floorLabel:O?.floorLabel||Gn?.floorLabel||qn||"",url:O?.url||""},Te=await cc({context:de,floorStats:Gn,panelStats:Pi});pu(Te),Aa(!0)}catch(O){ss(String(O?.message||O))}finally{dn(!1)}},[cc,Gn,Pi,F,j,qn,e]),ns=nr(async()=>{fs(""),yl(!0),mu(null);try{const O=$s?{totalSf:Math.round($s.totalSf||0),rooms:Math.round($s.roomCount||0),totalsByDept:Object.fromEntries(($s.byDept||[]).map(Me=>[Me.name,Math.round(Number(Me.sf||0))])),byType:($s.byType||[]).map(Me=>({type:Me.name,sf:Math.round(Number(Me.sf||0))})),occupancySummary:$s.occupancySummary||null,officeOccupancy:$s.officeOccupancy||null}:null,Te=await Cc({context:{universityId:e,campusLabel:be||e||"Campus",buildingId:"",buildingLabel:"",floorId:"",floorLabel:"",url:""},campusStats:O||Mr,panelStats:Tr});mu(Te),bi(!0)}catch(O){fs(String(O?.message||O))}finally{yl(!1)}},[be,Tr,Mr,$s,Cc,e]),As=nr(async()=>{Ls(""),tc(!0),Fa(null);try{if(!lo)throw new Error("No scenario totals available. Turn on Move Scenario Mode and make changes.");if(!Ni)throw new Error("Select a department for the scenario before comparing.");const{perBuilding:O,campusTotals:de}=await nT(Ni,{ensureFloorsForBuilding:Zs,buildFloorUrl:ao,floorCache:ps,fetchGeoJSON:pd});if(!de)throw new Error("No baseline stats for the selected department on this campus.");const Me=oa(li||j||F||"").toLowerCase(),tt=Object.entries(O||{}).sort((Kt,rn)=>(rn[1]?.totalSF||0)-(Kt[1]?.totalSF||0)||(rn[1]?.rooms||0)-(Kt[1]?.rooms||0)),ze=tt.find(([Kt])=>oa(Kt).toLowerCase()!==Me)||tt[0]||null,Ke=ze?ze[0]:"campus",At=ze?ze[1]:de;At&&(At.__label=Ke||"campus");const kt="campus",gt=F||j||"",$t=Lf(F||j)||j||F||"",en={universityId:e,baselineScope:kt,buildingId:gt,buildingLabel:li||"",floorId:qn||"",scenarioDepartment:Ni,baselineLabel:`Current allocation for ${Ni} (${Ke})`};console.log("Scenario compare baseline (dept campus-wide):",At),console.log("Scenario compare scenario (selection totals):",lo),hn(At);const An={totalSF:(lo?.totalSF||0)-(At?.totalSF||0),rooms:(lo?.rooms||0)-(At?.rooms||0)},yn=await Li({context:en,baselineStats:At,scenarioStats:lo,deltas:An,scenarioDept:Ni||""});Fa(yn),nu(!0)}catch(O){Ls(String(O?.message||O))}finally{tc(!1)}},[li,Li,Ni,lo,li,Zs,ao,ps,pd,j,F,qn,e]);ui(()=>{Vs&&(!Ni||!lo?.rooms||(Bo(!1),As()))},[Vs,Ni,lo,As]);const hs=nr(async()=>{zr(""),Cs(!0),js(null);try{const Te=await Ms({context:{universityId:e,buildingId:F||j||"",buildingLabel:li||"",floorId:"",floorLabel:"",url:""},buildingStats:Vt,panelStats:Pi});js(Te),Ya(!0)}catch(O){zr(String(O?.message||O))}finally{Cs(!1)}},[li,Vt,Ms,Pi,j,F,e]);ui(()=>{const O=D8();if(typeof window<"u"&&window.location.hostname.includes("github.io"))return Ki(O?"ok":"down"),()=>{};if(!O)return Ki("down"),()=>{};const Te=tC("/ai/health"),Me=async()=>{try{const ze=await Xd(Te,{cache:"no-store",timeoutMs:3e3});Ki(ze.ok?"ok":"down")}catch{Ki("down")}};Me();const tt=setInterval(Me,3e4);return()=>clearInterval(tt)},[]);const xs=nr(()=>{const O=Jn?.current;if(!O?.fc){alert("No floor loaded.");return}const de=Qe?Ee.get(Qe)||[]:[],Te=nc(za.current||[]),Me=Ct.current||[],tt=Array.from(new Set([...de||[],...Te||[],...Me||[]])),ze=Xg({...O,colorMode:Bi,selectedIds:tt,solidFill:!0,labelOptions:{hideDrawing:!0}});if(!ze){alert("Unable to render floorplan.");return}const Ke=`${li} - ${O.floorLabel||qn||""}`.trim()||"Floor",At=O?.url?hl.current[O.url]:null,kt=Gn??(At?{...At,floorLabel:O.floorLabel||qn}:null),gt=si&&si.length?si:k1(kt?.totalsByDept),$t={department:"Key Departments",type:"Key Types",occupancy:"Occupancy",vacancy:"Vacancy"}[Bi]||"Legend";ts([{img:ze,label:Ke}],{filenameBase:`${li}-${O.floorLabel||qn||"floor"}`,stats:kt,keyDepts:gt,summaryLabel:`${li} - ${O.floorLabel||qn||""} (${Bi||"department"})`,legendTitle:$t})},[li,qn,ts,Bi,si]),ls=nr(()=>{IC(_.current,Xs);try{const de=_.current;de?.getLayer(k0)&&de.removeLayer(k0),de?.getSource(Vv)&&de.removeSource(Vv)}catch{}nh(!1),c&&oc("campus"),Vc.current="",Xs.current=null,th.current=null,Jn.current={url:null,key:null,buildingId:null,floorId:null},Dn(null),Ei("building");const O=xl.current||j;O&&$e(O)},[j,$e,c]);nr(()=>{TT(_.current)},[]);const $l=nr(()=>{const O=!wl;Uh(O),O?(_u(!0),qo(null),sc(20)):lc()},[lc,wl,_u]),Il=nr(()=>{try{const O={markers:me,buildingConditions:ke,buildingAssessments:pe},de=new Blob([JSON.stringify(O,null,2)],{type:"application/json"}),Te=document.createElement("a");Te.href=URL.createObjectURL(de),Te.download=`${e||"campus"}-map-data.json`,document.body.appendChild(Te),Te.click(),document.body.removeChild(Te)}catch(O){console.warn("Export failed",O),alert("Export failed. See console for details.")}},[me,ke,pe,e]);nr(()=>{alert("Export Drawing Entries not implemented in this build.")},[]);const ka=nr(async(O="__all__",de="")=>{const Te=O&&O!=="__all__"?[O]:md.map(ze=>ze.name).filter(Boolean),Me=de.toLowerCase().trim(),tt=[];for(const ze of Te){if(!ze)continue;const Ke=await Zs(ze);if(Ke?.length)for(const At of Ke){const kt=ao(ze,At);if(!kt)continue;let gt;try{const $t=await pd(kt);gt=Au($t)}catch($t){console.warn("Space export: failed to load",kt,$t);continue}if(gt?.features?.length)for(const $t of gt.features){const en=$t?.properties||{},An=$t?.id??en.RevitId??en.id,yn=ze&&At&&An!=null?Jd(ze,At,An):null,Kt=yn&&Ws instanceof Map?Ws.get(yn):null,rn=Kt?{...en,...Kt}:en,$n=rn.Number??rn.RoomNumber??rn.number??rn.Room??"",yr=gd(rn)||rn.Name||"",On=(rn.department??rn.Department??rn.Dept??"").toString().trim();if(Me&&!On.toLowerCase().includes(Me))continue;const gr=Rf(rn),ti=e5(rn),Or=rn.occupant??rn.Occupant??"";tt.push({building:ze,floor:At,roomNumber:$n||"",type:yr||"",department:On||"",area:Number.isFinite(gr)?gr:"",seatCount:ti??"",occupant:Or||"",roomId:yn||"",revitId:An??null})}}}return tt},[ao,Zs,Ws]);nr(async()=>{const O=await ka("__all__","");return s5(O,250)||[]},[ka]);const rd=nr(async(O="__all__",de="")=>{const Te=O&&O!=="__all__"?[O]:md.map($t=>$t.name).filter(Boolean),Me=de.toLowerCase().trim(),tt=[],ze=uv(),Ke=($t,en,An)=>{if(!$t)return null;const yn=rn=>Number.isFinite(rn)?Math.round(rn):"",Kt=rn=>Number.isFinite(rn)?Number(rn):0;return{buildingId:An||pp(en||""),buildingName:en||"",totalSf:yn($t.totalSf),rooms:Kt($t.rooms),classroomSf:yn($t.classroomSf),classrooms:Kt($t.classroomCount),labSf:yn($t.labSf),labs:Kt($t.labCount),officeSf:yn($t.officeSf),offices:Kt($t.officeCount),keyDepts:($t.keyDepts||[]).join("; ")}};for(const $t of Te){if(!$t)continue;const en=await Zs($t);if(!en?.length)continue;const An=uv();for(const rn of en){const $n=ao($t,rn);if(!$n)continue;let yr=ps.get($n);yr||(yr=await pd($n),yr&&ps.set($n,yr));const On=Au(yr);if(On?.features?.length)for(const gr of On.features){const ti=gr?.properties||{},Or=gr?.id??ti.RevitId??ti.id,Hr=$t&&rn&&Or!=null?Jd($t,rn,Or):null,_i=Hr&&Ws instanceof Map?Ws.get(Hr):null,vr=_i?{...ti,..._i}:ti,Rr=(vr.department??vr.Department??vr.Dept??"").toString().trim();Me&&!Rr.toLowerCase().includes(Me)||(aw(An,vr),aw(ze,vr))}}const yn=jy(An),Kt=yn?Ke(yn,$t):null;Kt&&(Kt.rooms||Kt.totalSf)&&tt.push(Kt)}const At=jy(ze);return{campusRow:(!O||O==="__all__")&&At&&(At.rooms||At.totalSf)?Ke(At,"Campus Total","campus"):null,buildingRows:tt}},[ao,Zs,Ws]),Ys=nr(async()=>{ku(""),_o(!0),vo(null);try{if(Fo==="down")throw new Error("AI server is offline.");const O=(Ao||"").trim();if(!O)throw new Error("Enter a short request for the move scenario.");const de=Zt&&Array.isArray(yt)?yt:[],Te=vT(de),Me=Ni||xT(O,Te)||"",tt=Me?ST(de,Me):[],ze=new Set((tt||[]).map(Un=>po(Un)).filter(Boolean)),Ke=bT(de),At=wT(O,Ke)||"",kt=At||"",gt="";let $t=[];if(Zt&&Array.isArray(yt)&&yt.length)$t=s5(yt,2e3)||[];else try{const Un=await ka("__all__","");$t=s5(Un,250)||[]}catch{}if(!$t.length){const Un=Jn?.current?.fc?.features||[];$t=NV(Un,kt,gt,250)||[]}if(!$t.length)throw new Error("No room inventory loaded yet. Load Space Data or a floorplan first.");if(At){const Un=po(At),Jt=$t.filter(pn=>{const Xn=pn?.buildingLabel??pn?.building??pn?.buildingName??"";return po(Xn)===Un});if(!Jt.length)throw new Error(`No rooms found for ${At}.`);$t=Jt}if(ze.size){const Un=$t.filter(Jt=>{const pn=Jt?.buildingLabel??Jt?.building??Jt?.buildingName??"";return!ze.has(po(pn))});if(!Un.length)throw new Error(`No rooms available outside the current ${Me||"department"} home building(s).`);$t=Un}$t=dC($t);let en=null,An="";if(Me)try{const{perBuilding:Un,campusTotals:Jt}=await nT(Me,{ensureFloorsForBuilding:Zs,buildFloorUrl:ao,floorCache:ps,fetchGeoJSON:pd}),pn=Object.entries(Un||{}).sort((Xn,dr)=>(dr[1]?.totalSF||0)-(Xn[1]?.totalSF||0)||(dr[1]?.rooms||0)-(Xn[1]?.rooms||0))[0]||null;en=pn?pn[1]:Jt,An=pn?pn[0]:"",en&&(en={...en,__label:An||"campus"})}catch{}const yn=At?{maxTotal:260,maxPerBuilding:260,maxPerType:35}:{maxTotal:220,maxPerBuilding:90,maxPerType:25};en&&$t.length>yn.maxTotal?$t=MV($t,en,{maxTotal:yn.maxTotal,minPerType:At?8:5,maxPerType:At?45:35}):$t=fC($t,yn);const Kt=new Map;$t.forEach(Un=>{if(!Un)return;[Un.roomId,Un.id,Un.revitId].filter(pn=>pn!=null).map(pn=>String(pn)).forEach(pn=>{Kt.has(pn)||Kt.set(pn,Un)})});const rn=Un=>{if(!Un||!$t.length)return null;const Jt=po(Un?.buildingLabel||""),pn=Pf(Un?.floorName||Un?.floorId||""),Xn=_T(Un?.roomLabel||Un?.roomNumber||"");if(Xn){const wo=$t.find(ho=>{const dc=po(ho?.buildingLabel??ho?.buildingName??ho?.building??"");if(Jt&&dc!==Jt||pn.length&&!If(ho?.floorName??ho?.floorId??"",pn))return!1;const Ns=_T(ho?.roomLabel??ho?.roomNumber??"");return Ns&&Ns===Xn});if(wo)return wo}const dr=hg(Un?.type||""),qr=Number(Un?.sf||0),Di=Number.isFinite(qr)&&qr>0;let Wn=null,qi=Number.POSITIVE_INFINITY;return $t.forEach(wo=>{const ho=po(wo?.buildingLabel??wo?.buildingName??wo?.building??"");if(Jt&&ho!==Jt||pn.length&&!If(wo?.floorName??wo?.floorId??"",pn))return;const dc=hg(wo?.type||wo?.roomType||"");let Ns=0;if(dr&&dc?Ns+=dc===dr?0:1e3:dr&&(Ns+=500),Di){const Ds=Number(wo?.sf??wo?.area??wo?.areaSF??0);Number.isFinite(Ds)&&(Ns+=Math.abs(Ds-qr))}Ns<qi&&(qi=Ns,Wn=wo)}),Wn},$n={universityId:e,campusLabel:be||e||"Campus",buildingLabel:At||"",floorId:gt,moveScenarioMode:!0,scenarioDepartment:Ni||Me||"",targetDepartment:Me||Ni||"",excludeBuildings:tt||[],scenarioLabel:(Vl||"").trim(),scope:At?"building":"campus"},yr=en?{totalSF:Math.round(en.totalSF||0),rooms:Math.round(en.rooms||0),sfByType:Object.entries(en.sfByRoomType||{}).map(([Un,Jt])=>({type:Un,sf:Math.round(Number(Jt||0)||0)})),roomTypes:Object.entries(en.roomTypes||{}).map(([Un,Jt])=>({type:Un,count:Math.round(Number(Jt||0)||0)}))}:null,On=yr?{baselineTotals:yr,targetSfTolerance:Dl?.05:.1}:null,gr=await eo({request:O,context:$n,inventory:$t,constraints:On}),ti=Array.isArray(gr?.recommendedCandidates)?gr.recommendedCandidates.map(Un=>{const pn=[Un?.roomId,Un?.id,Un?.revitId].filter(qr=>qr!=null).map(qr=>String(qr)).map(qr=>Kt.get(qr)).find(Boolean)||rn(Un);if(!pn)return{...Un,floorName:Un?.floorName||Un?.floorId||"",rationale:a5(Un?.rationale)};const Xn=Number(pn.sf??pn.area??pn.areaSF??0),dr=Number(Un?.sf??0);return{...Un,roomId:Un?.roomId||pn.roomId||pn.id||"",id:Un?.id||pn.id||pn.roomId||"",revitId:Un?.revitId??pn.revitId??null,roomGuid:Un?.roomGuid??pn.roomGuid??pn.revitId??null,buildingLabel:Un?.buildingLabel||pn.buildingLabel||pn.buildingName||pn.building||"",roomLabel:Un?.roomLabel||pn.roomLabel||pn.roomNumber||"",type:Un?.type||pn.type||pn.roomType||"",sf:Number.isFinite(dr)&&dr>0?dr:Number.isFinite(Xn)?Xn:0,vacancy:pn.vacancy??Un.vacancy,occupant:pn.occupant??Un.occupant,occupancyStatus:pn.occupancyStatus??Un.occupancyStatus,occupantDept:pn.occupantDept??Un.occupantDept,department:pn.department??Un.department,floorName:Un?.floorName||Un?.floorId||pn.floorName||pn.floorId||"",rationale:a5(Un?.rationale)}}):[],Or=oa(At||tT(ti)||"");let Hr=ti,_i="";if(en){const{candidates:Un,added:Jt}=YA(ti,$t,en,{targetTolerance:On?.targetSfTolerance??.1,maxCandidates:Dl?40:30,primaryBuilding:Or});Jt>0&&(Hr=Un,_i=`Auto-filled ${Jt} rooms to better match baseline SF and room-type mix.`)}const vr=Un=>QA(Un?.type)||JA(Un?.type),Rr=Or||tT(Hr)||"";if(Rr){const Un=Hr.filter(Jt=>oa(Jt?.buildingLabel||"")===Rr?!0:vr(Jt));if(Un.length&&(Hr=Un,_i=`${_i?_i+" ":""}Constrained scenario to a single building (${Rr}), allowing labs/classrooms to remain outside if needed.`),en){const Jt=$t.filter(dr=>{if(oa(dr?.buildingLabel??dr?.building??dr?.buildingName??"")===Rr)return!0;const Di=dr?.type??dr?.roomType??"";return QA(Di)||JA(Di)}),{candidates:pn,added:Xn}=YA(Hr,Jt,en,{targetTolerance:On?.targetSfTolerance??.1,maxCandidates:Dl?40:30,primaryBuilding:Rr});Xn>0&&(Hr=pn,_i=`${_i?_i+" ":""}Auto-filled ${Xn} rooms to better match baseline SF.`)}}Hr=mC(Hr,Rr);const ji=en?.totalSF||gr?.baselineTotals?.totalSF||0,Gr=Math.round((On?.targetSfTolerance??.1)*100),jr=ji?[`Aim for total SF within +/-${Gr}% of baseline department total SF (${Math.round(ji).toLocaleString()} SF).`]:[],Wr=Array.isArray(gr?.selectionCriteria)?gr.selectionCriteria.filter(Un=>!/baseline|total\s*sf|sf within/i.test(Un||"")):[];vo({...gr,baselineTotals:en||gr?.baselineTotals,selectionCriteria:[...jr,..._i?[_i]:[],...Wr],recommendedCandidates:Hr}),Zo(!1)}catch(O){ku(String(O?.message||O))}finally{_o(!1)}},[li,be,Ao,Fo,Zt,yt,ka,eo,Zs,ao,pd,Ni,Vl,j,qn,e]),Vh=nr(async()=>{qs(""),ru(!0),Ss(null);try{const O=(ya||"").trim();if(!O)throw new Error("Type a question first.");const de=Zt&&Array.isArray(yt)?yt:[],Te=vT(de),Me=xT(O,Te)||"",tt=bT(de),ze=wT(O,tt)||"",Ke=/best new suitable home|suitable home|best home|relocat|move|find space|new home|anywhere|entire campus|campus[-\s]?wide|across campus/i.test(O),At=/\b(basement|ground floor|first floor|second floor|third floor|fourth floor|fifth floor|sixth floor|seventh floor|eighth floor|ninth floor|tenth floor|level\s*\d+|level\s*(one|two|three|four|five|six|seven|eight|nine|ten)|lvl\s*\d+|floor\s*\d+|floor\s*(one|two|three|four|five|six|seven|eight|nine|ten))\b/i.test(O),kt=/\b(entire campus|campus[-\s]?wide|across campus|anywhere on campus)\b/i.test(O)||/\bwhere\s+(is|are)\b|\blocation of\b|\bwhere\b.*\b(located|location)\b|\bwhich building\b|\bwhat building\b/i.test(O)&&!ze,gt=Ke&&Me?ST(de,Me):[],$t=new Set((gt||[]).map(Jt=>po(Jt)).filter(Boolean)),en={first:1,second:2,third:3,fourth:4,fifth:5,sixth:6,seventh:7,eighth:8,ninth:9,tenth:10},An=(()=>{if(!At)return"";const Jt=O.toLowerCase();if(Jt.includes("basement"))return"BASEMENT";if(Jt.includes("ground floor"))return"LEVEL_1";const pn=Jt.match(/level\s*(\d+)/);if(pn)return`LEVEL_${pn[1]}`;const Xn=Jt.match(/floor\s*(\d+)/);if(Xn)return`LEVEL_${Xn[1]}`;const dr=Jt.match(/\b(first|second|third|fourth|fifth|sixth|seventh|eighth|ninth|tenth)\s+floor\b/);return dr?`LEVEL_${en[dr[1]]}`:""})(),yn=ze||"",Kt=ze||"",rn=!ze||Ke||kt,$n=!rn&&!!ze&&!!An,yr={universityId:e,campusLabel:be||e||"Campus",buildingId:yn,buildingLabel:ze||"",floorId:$n?An:"",scope:rn?"campus":$n?"floor":ze?"building":"campus",targetDepartment:Me||"",excludeBuildings:gt||[]},On=(()=>{if(!Zt)return[];if(rn||!ze)return yt;const Jt=po(ze);if(!Jt)return yt;const pn=yt.filter(dr=>{const qr=dr?.building??dr?.buildingName??dr?.buildingLabel??"";return po(qr)===Jt});if(!$n)return pn;const Xn=Pf(An);return Xn.length?pn.filter(dr=>If(dr?.floor??dr?.floorName??dr?.floorId??"",Xn)):pn})(),gr=$t.size?On.filter(Jt=>{const pn=n_(Jt);return!$t.has(po(pn))}):On,ti=(Jt,pn={})=>{if(!Array.isArray(Jt))return[];const Xn=Number(pn.maxRows||400);if(Jt.length<=Xn)return Jt;const dr=po(pn.inferredDept||"");let qr=Jt;if(dr&&(qr=Jt.filter(ho=>{const dc=String(ho?.department??ho?.occupantDept??"").trim();return po(dc)===dr}),qr.length<=Xn))return qr;const Di=new Map;qr.forEach(ho=>{const dc=po(n_(ho));Di.has(dc)||Di.set(dc,[]),Di.get(dc).push(ho)});const Wn=Math.max(1,Math.floor(Xn/Math.max(1,Di.size||1))),qi=[];if(Di.forEach(ho=>{qi.push(...ho.slice(0,Wn))}),qi.length>=Xn)return qi.slice(0,Xn);const wo=qr.filter(ho=>!qi.includes(ho));return qi.concat(wo.slice(0,Math.max(0,Xn-qi.length)))};if(xq(O)){const Jt=gr.filter(Xn=>D1(Xn?.type??Xn?.roomType??"")),pn=rn?"campus":ze||"selected scope";Ss({answer:`Found ${Jt.length.toLocaleString()} classrooms in ${pn}.`,bullets:["Count is based on room type labels that include classroom/teaching room definitions."],resultType:"none",columns:[],rows:[],dataUsed:["roomRows"],missingData:[]});return}if(vq(O)){const Jt=ET(gr),pn=rn?"campus":ze||"selected scope";Ss({answer:`Found ${Jt.length.toLocaleString()} vacant offices in ${pn}.`,bullets:["Only rooms marked vacant/available and without an occupant are counted."],resultType:"none",columns:[],rows:[],dataUsed:["roomRows"],missingData:Jt.length?[]:["Vacancy status","Room inventory"]});return}if(_q(O)){let Jt=ET(gr);if(Jt.some(dr=>!String(dr?.["Room Number"]||"").trim()))try{const qr=await ka(rn?"__all__":Kt||"__all__",""),Di=new Map;(qr||[]).forEach(Wn=>{const qi=String(Wn?.roomNumber??"").trim();if(!qi||im(qi))return;const wo=gm(Wn?.revitId??Wn?.roomId??"");wo&&(Di.has(wo)||Di.set(wo,qi))}),Jt=Jt.map(Wn=>{if(String(Wn?.["Room Number"]||"").trim())return Wn;const wo=gm(Wn?.__lookupKey??"");if(!wo)return Wn;const ho=Di.get(wo)||"";return ho?{...Wn,"Room Number":ho}:Wn})}catch{}const pn=rn?"campus":ze||"selected scope",Xn=Jt.length?`Found ${Jt.length.toLocaleString()} vacant offices in ${pn}.`:`No vacant offices were found in ${pn} with explicit vacancy data.`;Ss({answer:Xn,bullets:["Only rooms marked as vacant/available and not currently assigned to an occupant are included."],resultType:Jt.length?"table":"none",columns:Jt.length?["Building","Room Number","Room Type","Square Feet"]:[],rows:Jt,dataUsed:["roomRows"],missingData:Jt.length?[]:["Vacancy status","Room inventory"]});return}const Or=/\bwhere\s+(is|are)\b|\blocation of\b|\bwhere\b.*\b(located|location)\b|\bwhich building\b|\bwhat building\b/i.test(O),Hr=(()=>{const Jt=[];if(Me&&Jt.push(Me),/\bpresident'?s?\b/i.test(O)&&Jt.push("president"),/\bprovost\b/i.test(O)&&Jt.push("provost"),/\bdean\b/i.test(O)&&Jt.push("dean"),!Jt.length)return[];const pn=Jt.map(Xn=>po(Xn)).filter(Boolean);return gr.filter(Xn=>{const dr=String(Xn?.department??Xn?.occupantDept??"").trim(),qr=String(Xn?.occupant??"").trim(),Di=String(Xn?.roomNumber??Xn?.roomLabel??"").trim(),Wn=po(`${dr} ${qr} ${Di}`);return pn.some(qi=>qi&&Wn.includes(qi))})})();if(Or&&Hr.length){const Jt=new Map;Hr.forEach(Xn=>{const dr=n_(Xn)||"Unknown Building";Jt.has(dr)||Jt.set(dr,[]),Jt.get(dr).push(Xn)});const pn=Array.from(Jt.entries()).map(([Xn,dr])=>{const qr=dr.map(ho=>ho?.roomNumber||ho?.roomLabel||ho?.roomId||ho?.id||ho?.revitId||"").filter(Boolean),Di=Array.from(new Set(qr)),Wn=dr.map(ho=>ho?.occupant||ho?.department||ho?.type||"").filter(Boolean),qi=Array.from(new Set(Wn)),wo=Di.length?`Rooms: ${Di.slice(0,12).join(", ")}`:qi.length?`Rooms: (not labeled)  ${qi.slice(0,3).join(", ")}`:"Rooms: (not labeled)";return`${Xn}  ${wo}`});Ss({answer:"Here are the rooms matching that request across campus.",bullets:pn,resultType:"none",columns:[],rows:[],dataUsed:["roomRows"],missingData:[]});return}const _i=Hr.length?Hr:gr,vr=ti(_i,{maxRows:Me?180:100,inferredDept:Me}),Rr=Zg(gr),ji=$n&&Rr?{...Rr,floorLabel:An}:null,Gr=!$n&&ze&&Rr?Rr:null;let jr=null;if(vr.length)jr=vr.map(Jt=>{const pn=Number(Jt?.areaSF??Jt?.area??Jt?.sf??0),Xn=Number(Jt?.seatCount??Jt?.SeatCount??Jt?.["Seat Count"]??0),dr=q3(Jt);return{building:Jt?.building??Jt?.buildingName??Jt?.buildingLabel??Kt,floor:Jt?.floor??Jt?.floorName??Jt?.floorId??"",roomNumber:dr||"",type:String(Jt?.type??Jt?.roomType??"").trim(),department:String(Jt?.department??"").trim(),area:Number.isFinite(pn)?Math.round(pn):"",seatCount:Number.isFinite(Xn)&&Xn>0?Xn:"",occupant:String(Jt?.occupant??"").trim(),occupancyStatus:String(Jt?.occupancyStatus??"").trim()}});else try{const pn=await ka(rn?"__all__":Kt||"__all__","");if(Array.isArray(pn)){const Xn=$t.size?pn.filter(qr=>!$t.has(po(qr.building))):pn,dr=ti(Xn,{maxRows:Me?180:100,inferredDept:Me});jr=Kt?dr:dr.slice(0,Me?180:100)}else jr=null}catch{jr=null}const Un=await uo({question:O,context:yr,data:{campusStats:Mr,buildingStats:!rn&&ze&&!$n&&Gr||void 0,floorStats:$n&&ji||void 0,dashboardMetrics:void 0,scopeSummary:Rr||void 0,roomRows:jr||void 0}});Ss(Un)}catch(O){qs(String(O?.message||O))}finally{ru(!1)}},[li,be,ya,F,j,qn,e,Zt,yt,Mr,Vt,Gn,$s,ni,uo,Lf,ka]),bd=nr(()=>{if(Ti)try{const O=new Si("p","pt","letter"),de=O.internal.pageSize.getWidth(),Te=O.internal.pageSize.getHeight(),Me=24,tt=de-Me*2,ze=14;let Ke=Me;const At=(yn=ze)=>{Ke+yn<=Te-Me||(O.addPage(),Ke=Me)},kt=(yn,Kt={})=>{const rn=String(yn??"").trim();if(!rn)return;const $n=Kt.fontStyle||"normal",yr=Kt.fontSize||11;O.setFont(void 0,$n),O.setFontSize(yr),O.splitTextToSize(rn,tt).forEach(gr=>{At(ze),O.text(gr,Me,Ke),Ke+=ze})},gt=(yn=8)=>{At(yn),Ke+=yn};kt("Ask Mapfluence",{fontStyle:"bold",fontSize:14}),gt(4),kt(`Question: ${ya||"(no question)"}`,{fontSize:10}),gt(8),kt(`Answer: ${Ti.answer||""}`),Array.isArray(Ti.bullets)&&Ti.bullets.length&&(gt(8),kt("Notes:",{fontStyle:"bold"}),Ti.bullets.forEach(yn=>kt(`- ${yn}`)));const $t=Array.isArray(Ti.columns)?Ti.columns:[],en=Array.isArray(Ti.rows)?Ti.rows:[];$t.length&&en.length&&(gt(10),kt("Table:",{fontStyle:"bold"}),kt($t.join(" | "),{fontStyle:"bold",fontSize:10}),en.forEach(yn=>{const Kt=$t.map(rn=>{const $n=yn&&yn[rn]!=null?yn[rn]:"";return String($n)});kt(Kt.join(" | "),{fontSize:10})})),Array.isArray(Ti.missingData)&&Ti.missingData.length&&(gt(8),kt(`Missing data: ${Ti.missingData.join(", ")}`,{fontSize:10}));const An=String(ya||"ask-mapfluence").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").slice(0,60)||"ask-mapfluence";O.save(`${An}.pdf`)}catch(O){console.error("Ask Mapfluence PDF export failed",O),alert("PDF export failed - see console for details.")}},[Ti,ya]),Ou=nr(async()=>{if(!Ti)return;const O=Array.isArray(Ti.columns)?Ti.columns:[],de=Array.isArray(Ti.rows)?Ti.rows:[];if(!O.length||!de.length){alert("No table data available to copy.");return}const Te=ze=>{if(ze==null)return"";const Ke=String(ze);return/[",\n]/.test(Ke)?`"${Ke.replace(/"/g,'""')}"`:Ke},Me=[O.map(Te).join(",")];de.forEach(ze=>{Me.push(O.map(Ke=>Te(ze&&ze[Ke]!=null?ze[Ke]:"")).join(","))});const tt=Me.join(`
`);try{if(navigator?.clipboard?.writeText)await navigator.clipboard.writeText(tt);else throw new Error("Clipboard API unavailable")}catch{try{const ze=document.createElement("textarea");ze.value=tt,ze.setAttribute("readonly",""),ze.style.position="fixed",ze.style.left="-9999px",document.body.appendChild(ze),ze.select(),document.execCommand("copy"),document.body.removeChild(ze)}catch{alert("Copy failed. Please use Export PDF.");return}}alert(`Copied ${de.length.toLocaleString()} rows to clipboard (CSV).`)},[Ti]),Bu=nr(()=>{const O=String(st||"").trim();if(!/^pk\./i.test(O)){Cr("Enter a valid Mapbox public token (starts with pk.).");return}try{window.localStorage.setItem("MAPBOX_PUBLIC_TOKEN",O)}catch{}kd.accessToken=O,Cr(""),Gt(!1),window.location.reload()},[st]);ui(()=>{const O=Hi.current;if(!O||O.buildingLabel!==j||O.floorId!==qn)return;Hi.current=null;const de=xu.current||[];xu.current=null,(async()=>{try{if(!await Ri())return}catch{}Q(de)})()},[j,qn,Ri,Q]);const Lc=nr(async()=>{const O=Go?.recommendedCandidates||[];if(!O.length)return;const de=Go?.scenarioDept||Ni||"";Uh(!0),de&&Ua(de);const Te=O[0],Me=Te?.buildingLabel||j,tt=Te?.floorName||Te?.floorId||qn;let ze=tt;if(Me){const At=await Zs(Me);ze=F1(tt,At)||At?.[0]||tt}if(Me&&ze&&(Me!==j||ze!==qn)){Hi.current={buildingLabel:Me,floorId:ze},xu.current=O,H(Me),jl(ze);return}Q(O)},[Go?.recommendedCandidates,Go?.scenarioDept,Q,Zs,Ni,j,qn,Uh,Ua,H,jl]),qh=nr(O=>{const de=O?.recommendedCandidates||[];if(!de.length)return;const Te=O?.scenarioDept||Ni||"";Uh(!0),Te&&Ua(Te),Q(de),Bo(!0)},[Q,Ni,Uh,Ua]),id=nr(async(O,de)=>{const Te=O&&typeof O=="object"?null:O,Me=de||Eo||"rooms";Ko(!0),Nl(Me==="summary"?"Preparing summary export...":"Building export data...");try{const tt=An=>{if(An==null)return"";const yn=String(An);return/[",\n]/.test(yn)?`"${yn.replace(/"/g,'""')}"`:yn};if(Me==="summary"){const{campusRow:An,buildingRows:yn}=await rd(Te||sl,Jl),Kt=[...An?[An]:[],...yn];if(!Kt.length){Nl("No matching rooms found."),Ko(!1);return}const $n=[["BuildingId","BuildingName","TotalSF","Rooms","ClassroomSF","Classrooms","LabSF","Labs","OfficeSF","Offices","KeyDepts"].join(",")];Kt.forEach(Or=>{$n.push([tt(Or.buildingId),tt(Or.buildingName),tt(Or.totalSf),tt(Or.rooms),tt(Or.classroomSf),tt(Or.classrooms),tt(Or.labSf),tt(Or.labs),tt(Or.officeSf),tt(Or.offices),tt(Or.keyDepts)].join(","))});const yr=new Blob([$n.join(`
`)],{type:"text/csv;charset=utf-8;"}),On=document.createElement("a");On.href=URL.createObjectURL(yr);const gr=Te||sl,ti=gr&&gr!=="__all__"?gr.replace(/\s+/g,"-").toLowerCase():"campus";On.download=`${ti}-space-summary.csv`,document.body.appendChild(On),On.click(),document.body.removeChild(On),Nl(`Exported ${Kt.length} summary rows`);return}const ze=await ka(Te||sl,Jl);if(!ze.length){Nl("No matching rooms found."),Ko(!1);return}const At=[["Building","Floor","Room","Type","Department","AreaSF","SeatCount","Occupant"].join(",")];ze.forEach(An=>{At.push([tt(An.building),tt(An.floor),tt(An.roomNumber),tt(An.type),tt(An.department),tt(An.area),tt(An.seatCount),tt(An.occupant)].join(","))});const kt=new Blob([At.join(`
`)],{type:"text/csv;charset=utf-8;"}),gt=document.createElement("a");gt.href=URL.createObjectURL(kt);const $t=Te||sl,en=$t&&$t!=="__all__"?$t.replace(/\s+/g,"-").toLowerCase():"campus";gt.download=`${en}-space-data.csv`,document.body.appendChild(gt),gt.click(),document.body.removeChild(gt),Nl(`Exported ${ze.length} rows`)}catch(tt){console.warn("Space export failed",tt),Nl("Export failed. See console.")}finally{Ko(!1)}},[ka,rd,sl,Jl,Eo]);nr(()=>{try{ue([]),te([])}catch{}},[]);const zu=nr(()=>{le(O=>{const de=!O;try{const Te=new URL(window.location.href);de?Te.searchParams.set("presentation","1"):Te.searchParams.delete("presentation"),window.history.replaceState({},"",`${Te.pathname}${Te.search}${Te.hash}`)}catch{}return de})},[]),Fd=nr(()=>{try{je({}),U({})}catch{}},[]),[Pc,ju]=jn(null),[wd,Od]=jn(null),[lh,cf]=jn(null),[kh,kc]=jn(null),uc=nr(()=>u.current?.getBoundingClientRect()||{left:0,top:0,width:window.innerWidth,height:window.innerHeight},[]),$a=nr(()=>({left:0,top:0,width:window.innerWidth,height:window.innerHeight}),[]),Rc=nr(O=>Cy(O,I,Od,uc),[uc]),Gc=nr(O=>Cy(O,M,iu,$a),[$a]),Uu=nr(O=>Cy(O,V,qo,uc),[uc]),ch=So(null),Vu=So(null),uf=nr(O=>Cy(O,ch,cf,$a),[$a]),_g=nr(O=>Cy(O,Vu,kc,$a),[$a]),kp={onPointerDown:Rc,style:{cursor:"grab",userSelect:"none",touchAction:"none"}},vg={onPointerDown:Gc,style:{cursor:"grab",userSelect:"none",touchAction:"none"}},_m={onPointerDown:Uu,style:{cursor:"grab",userSelect:"none",touchAction:"none"}},vm={onPointerDown:uf,style:{cursor:"grab",userSelect:"none",touchAction:"none"}},Rh={onPointerDown:_g,style:{cursor:"grab",userSelect:"none",touchAction:"none"}};if(So(null),!e)return Y.jsx("div",{children:"Loading University..."});const hf=Wa(()=>Bm(Sh,"universities",e,"markers"),[e]),xg=Wa(()=>Bm(Sh,"universities",e,"buildingConditions"),[e]),Ra=Wa(()=>Bm(Sh,"universities",e,"buildingAssessments"),[e]);Wa(()=>Bm(Sh,"universities",e,"drawingEntries"),[e]);const Jr=Wa(()=>Bm(Sh,"moves"),[Sh]),od=({person:O,from:de,to:Te,effectiveDate:Me,comments:tt,createdBy:ze})=>({person:O||"",fromRoomId:de?.roomId||"",toRoomId:Te?.roomId||"",fromBuildingId:de?.buildingId||"",toBuildingId:Te?.buildingId||"",fromFloorId:de?.floorId||"",toFloorId:Te?.floorId||"",fromRoomLabel:de?.roomLabel||"",toRoomLabel:Te?.roomLabel||"",effectiveDate:Me||"",comments:tt||"",createdAt:A1(),createdBy:ze||"unknown"}),Yf=nr(async O=>{if(O)try{await WE(Jr,O)}catch(de){console.warn("Failed to log move",de)}},[Jr]),hc=()=>{tn(null),Ft(null),Qo(null)},bg=async()=>{if(!ct)return;const{from:O,to:de,effectiveDate:Te,comments:Me,person:tt}=ct,ze=oa(tt||O?.occupantName||"");if(!(!O||!de||!ze))try{const Ke=await vt({roomId:O.roomId,buildingId:O.buildingId,buildingName:O.buildingName,floorName:O.floorId,revitId:O.revitId,roomLabel:O.roomLabel,properties:{occupant:""}}),At=await vt({roomId:de.roomId,buildingId:de.buildingId,buildingName:de.buildingName,floorName:de.floorId,revitId:de.revitId,roomLabel:de.roomLabel,properties:{occupant:ze}});Ke&&At?await Yf(od({person:ze,from:O,to:de,effectiveDate:Te,comments:Me,createdBy:a?.email||"unknown"})):console.warn("Move update incomplete, skipping move log.")}catch(Ke){console.warn("Move confirmation failed",Ke)}finally{hc()}},xm=Wa(()=>t!=="admin"?me:me.filter(O=>{const de=(O.persona||"").toLowerCase();return de.includes("student")?T:de.includes("staff")||de.includes("faculty")?z:!0}),[me,T,z,t]),Hc=Wa(()=>{if(!c||!ni)return me;const O=Jn.current||{},de=pp(O?.buildingId||F||j||""),Te=Na(O?.floorId||qn||""),Me=String(O?.floorLabel||qn||"").trim(),tt=Pf(Me||Te);return(me||[]).filter(ze=>{if(pp(ze?.buildingId||ze?.buildingName||ze?.building||"")!==de)return!1;const At=String(ze?.floorId||ze?.floorLabel||ze?.floor||"").trim();return Na(At)===Te?!0:tt.length?If(At,tt):!1})},[me,c,ni,F,j,qn,Br]),au=Wa(()=>({type:"FeatureCollection",features:(Hc||[]).filter(O=>Array.isArray(O?.coordinates)&&Number.isFinite(Number(O.coordinates[0]))&&Number.isFinite(Number(O.coordinates[1]))).map(O=>({type:"Feature",properties:{heatCategory:y_(O?.type),weight:Uq(O?.type),markerType:O?.type||""},geometry:{type:"Point",coordinates:[Number(O.coordinates[0]),Number(O.coordinates[1])]}}))}),[Hc]),Wc=Wa(()=>{const O={matchPairs:[],matchPairsGradientBase:[],gradientPointCollection:{type:"FeatureCollection",features:[]},legendItems:[],roomCount:0,markerCount:0};if(!c||!ua||!ni||!es)return O;const de=_.current,Te=de?Wu(de,ma):null,Me=Te&&(Te._data||Te.serialize?.().data)||null,tt=Au(Me);if(!tt?.features?.length)return O;const ze=tt.features.filter(Kt=>b0(Kt?.properties)==="room").filter(Kt=>{const rn=String(Kt?.geometry?.type||"");return rn==="Polygon"||rn==="MultiPolygon"}).map(Kt=>{const rn=Kt.properties||{},$n=Kt.id??rn.RevitId??rn.id;if($n==null)return null;const yr=Rf(rn);return{feature:Kt,idRaw:$n,idKey:String($n),areaSf:Number.isFinite(yr)?yr:0}}).filter(Boolean);if(!ze.length)return O;const Ke=new Map;ze.forEach(Kt=>Ke.set(Kt.idKey,{counts:new Map,total:0}));let At=0;(Hc||[]).filter(Kt=>Array.isArray(Kt?.coordinates)).forEach(Kt=>{const rn=Number(Kt?.coordinates?.[0]),$n=Number(Kt?.coordinates?.[1]);if(!Number.isFinite(rn)||!Number.isFinite($n))return;const yr=ms([rn,$n]);for(const On of ze){let gr=!1;try{gr=Ij(yr,On.feature)}catch{gr=!1}if(!gr)continue;const ti=y_(Kt?.type),Or=Ke.get(On.idKey),Hr=Or.counts.get(ti)||0;Or.counts.set(ti,Hr+1),Or.total+=1,At+=1;break}});const kt=new Map,gt=[],$t=[],en=[];let An=0;ze.forEach(Kt=>{const rn=Ke.get(Kt.idKey);if(!rn||!rn.total)return;An+=1;const yr=Array.from(rn.counts.entries()).sort((Hr,_i)=>{if((_i[1]||0)!==(Hr[1]||0))return(_i[1]||0)-(Hr[1]||0);const vr=hm[Hr[0]]?.heatValue??0;return(hm[_i[0]]?.heatValue??0)-vr})[0]?.[0]||"comment",On=hm[yr]?.color||"#9ca3af",gr=Af(On,"#ffffff",.4),ti=[{band:1,scale:.98,color:Af(On,"#ffffff",.36)},{band:2,scale:.93,color:Af(On,"#ffffff",.3)},{band:3,scale:.88,color:Af(On,"#ffffff",.23)},{band:4,scale:.83,color:Af(On,"#ffffff",.16)},{band:5,scale:.77,color:Af(On,"#ffffff",.08)},{band:6,scale:.71,color:On},{band:7,scale:.64,color:Af(On,"#000000",.1)},{band:8,scale:.57,color:Af(On,"#000000",.2)},{band:9,scale:.5,color:Af(On,"#000000",.31)},{band:10,scale:.43,color:Af(On,"#000000",.43)}];gt.push(Kt.idKey,On),$t.push(Kt.idKey,gr);try{const _i=b8(Kt.feature)?.geometry?.coordinates||null,vr=Number.isFinite(Number(_i?.[0]))&&Number.isFinite(Number(_i?.[1]))?[Number(_i[0]),Number(_i[1])]:"center";ti.forEach(({band:Rr,scale:ji,color:Gr})=>{let jr=null;try{jr=cg(Kt.feature,ji,{origin:vr})}catch{jr=null}if(!jr&&Rr===1&&(jr=Kt.feature),!jr)return;const Wr=String(jr?.geometry?.type||"");Wr!=="Polygon"&&Wr!=="MultiPolygon"||en.push({...jr,properties:{...jr.properties||{},roomId:Kt.idKey,band:Rr,c:Gr}})})}catch{}const Or=kt.get(yr)||{category:yr,label:Dq[yr]||yr,color:On,roomCount:0,markerCount:0,areaSf:0};Or.roomCount+=1,Or.markerCount+=rn.total,Or.areaSf+=Kt.areaSf||0,kt.set(yr,Or)});const yn=Array.from(kt.values()).sort((Kt,rn)=>(rn.roomCount||0)-(Kt.roomCount||0));return{matchPairs:gt,matchPairsGradientBase:$t,gradientPointCollection:{type:"FeatureCollection",features:en},legendItems:yn,roomCount:An,markerCount:At}},[c,ua,ni,es,Hc,Br]);ui(()=>{if(!k)return;const O=_.current;if(!(!O||!O.getLayer(ko))&&!(!c||!ua||!ni||!es))try{const de=ul==="gradient",Te=Hq(de?Wc.matchPairsGradientBase:Wc.matchPairs,"#f3f4f6");if(O.setPaintProperty(ko,"fill-color",Te),O.setPaintProperty(ko,"fill-opacity",de?.94:.88),de){Wq(O,Wc.gradientPointCollection),cv.forEach(Me=>Qg(O,Me,!0));try{O.getLayer(Qc)&&O.moveLayer(Qc)}catch{}}else cv.forEach(Me=>Qg(O,Me,!1))}catch{}},[k,c,ua,ul,ni,es,Wc,Br]),ui(()=>{if(!k)return;const O=_.current;if(!O)return;const de=!!(c&&ua&&ul==="gradient"&&ni&&es);cv.forEach(Te=>Qg(O,Te,de))},[k,c,ua,ul,ni,es]),ui(()=>{!k||!c||!ni||ua||el(Bi)},[k,c,ni,ua,Bi,el]),ui(()=>{ua||Ps&&_a(!1)},[ua,Ps]),ui(()=>{ni&&es||Ps&&_a(!1)},[ni,es,Ps]);const bu=Wa(()=>c?Oq:t==="admin"?{...I1.student,...I1.staff}:I1[i]||I1.default,[i,t,c]),sd=Wa(()=>{const O={};return Object.keys(bu||{}).forEach(de=>{O[de]=PT(de)}),O},[bu]);ui(()=>{const O=tv();bz(O).catch(()=>{});const de=HB(O,async Te=>{if(f(Te||null),!Te){S(!1);return}try{const Me=await HE(l0(Sh,"universities",e,"roles",Te.uid));S(!!Me.exists()&&Me.data()?.role==="admin")}catch{S(!1)}});return()=>de()},[e]);async function Rp(){try{const O=tv(),de=new Nf;try{await fz(O,de)}catch{await vz(O,de)}}catch{}}function Jf(){try{WB(tv())}catch{}}ui(()=>{e&&(async()=>{try{const O=Bm(Sh,"universities",e,"buildings"),de=await E1(O);if(!de.empty){const Me=de.docs.map(tt=>({id:tt.id,name:tt.data()?.name||tt.id}));!j&&Me.length&&H(Me[0].id);return}const Te=await fetch(sv);if(Te.ok){const Me=await Te.json(),tt=Object.entries(Me.buildings||{}).map(([ze,Ke])=>({id:ze,name:Ke?.name||ze}));!j&&tt.length&&H(tt[0].id)}}catch(O){console.warn("Building options load failed:",O)}})()},[e]),ui(()=>{let O=!1;const de=()=>{$c([]),jl(void 0)};return(async()=>{const Te=Kg(F,Do)||Kg(j,Do);if(!Te){de();return}const Me=await GA(Te);if(O)return;const tt=(Me||[]).map(Ke=>c0(Ke?.id)).filter(Boolean),ze=new Map((Me||[]).filter(Ke=>Ke?.id&&Ke?.url).map(Ke=>[Ke.id,Ke.url]));ou.current.set(Te,tt),su.current.set(Te,ze),tt.length?($c(tt),jl(Ke=>Ke&&tt.includes(Ke)?Ke:tt[0])):de()})(),()=>{O=!0}},[F,j,Do]),ui(()=>{let O=!1;return(async()=>{Hs(!0),W(null),cl("Campus Summary");try{const de=await Xd("/ai/api/rooms",{cache:"no-store",timeoutMs:8e3});let Te=null;try{Te=await de.json()}catch{}if(!de.ok){const Me=Te?.error||Te?.message||`Rooms fetch failed (${de.status})`;throw new Error(Me)}if(Te?.ok&&Array.isArray(Te.rooms)&&(O||(pt(Te.rooms),bo(new Date)),Te.rooms.some(Aq)))return;throw new Error("Rooms payload missing or invalid")}catch{try{let Te=us.current;Te||(Te=await m_(sv),us.current=Te);const Me=await AT(Te);if(!Me.length)throw new Error("No floorplan rooms found for dashboard");O||(qt(Me),W(null),Fn(!0))}catch(Te){O||W(Te)}}finally{O||Hs(!1)}})(),()=>{O=!0}},[e]),ui(()=>{const de=setInterval(()=>{ot()},18e5);return()=>clearInterval(de)},[ot]),ui(()=>{let O=!1;return(async()=>{try{const de=await fetch(Qd(XV),{cache:"no-store"});if(!de.ok)throw new Error(`Utilization CSV fetch failed (${de.status})`);const Te=await de.text(),Me=YV(Te);O||Ro(Me)}catch(de){console.warn("Unable to load classroom utilization data",de)}})(),()=>{O=!0}},[]);const Qf=Wa(()=>{if(!Zt)return[];if(!(!!F||ni))return yt;const de=oa(li);if(!!!de)return yt;const Me=new Set([po(li),po(F),po(j)].filter(Boolean));if(!Me.size)return yt;const tt=yt.filter(kt=>{const gt=kt?.building??kt?.buildingName??kt?.buildingLabel??"";return Me.has(po(gt))});if(!!!(ni&&de))return tt;const Ke=oa(Jn.current?.floorLabel||qn||""),At=Pf(Ke);return At.length?tt.filter(kt=>If(kt?.floor??kt?.floorName??kt?.floorId??"",At)):tt},[yt,Zt,li,F,j,ni,qn]),Bd=Wa(()=>{if(!(!!F||ni))return"Campus";const de=oa(li);if(!!!de)return"Campus";const Me=oa(Gn?.floorLabel||Jn.current?.floorLabel||qn||"");return!!(ni&&de&&Me)?`${de} ${Me}`:de},[li,F,j,ni,qn,Gn]),bm=Wa(()=>{if(!!F||ni){const de=oa(li);return de?ve(de):null}return L},[li,F,j,ni,L,ve]),ep=Wa(()=>!!F||ni?oa(li)||"":L?be:"",[li,F,j,ni,L,be]),df=Wa(()=>{if(!ni)return[];const O=Jn.current||{},de=po(F||j||""),Te=po(O.buildingLabel||O.buildingId||O.building||"");if(de&&Te&&de!==Te)return[];const Me=Pf(qn||"");if(Me.length){const Ke=O.floorLabel||O.floorId||O.floor||"";if(!If(Ke,Me))return[]}const tt=O.fc,ze=Array.isArray(tt?.features)?tt.features:[];return ze.length?ze.filter(Ke=>b0(Ke?.properties)==="room"):[]},[ni,Br,F,j,qn]),zd=Wa(()=>ni?df:(Qf||[]).map(TC).filter(Boolean),[Qf,df,ni]);ui(()=>{if(!Ce.length)return;let O=!1;if(!Ce.some(Te=>Kv(Te?.type)||Kv(Te?.department)||wq(Te))){O||(qt(Ce),Fn(!0));return}return(async()=>{try{let Te=us.current;Te||(Te=await m_(sv),us.current=Te);const Me=await AT(Te);if(O)return;const tt=Eq(Ce,Me);qt(tt),Fn(!0)}catch{O||(qt(Ce),Fn(!0))}})(),()=>{O=!0}},[Ce]),ui(()=>{if(!Zt)return;const O=!!F||ni,de=oa(li),Te=oa(Gn?.floorLabel||Jn.current?.floorLabel||qn||""),ze=!!(ni&&de&&Te)?`${de} ${Te} Summary`:!!(O&&de)?`${de} Summary`:"Campus Summary";cl(ze);try{const Ke=CU(zd);aa(Ke)}catch(Ke){W(Ke)}},[Zt,zd,li,F,j,ni,qn,Gn]),ui(()=>{if(!Zt||!Array.isArray(yt)||!yt.length||ni)return;const O=F||j;if(!O)return;const de=po(O);if(!de)return;const Te=yt.filter(tt=>{const ze=tt?.building??tt?.buildingName??tt?.buildingLabel??"";return po(ze)===de}),Me=Zg(Te);Me&&(Pn(Me),or(Hu(Me,"building")))},[Zt,yt,ni,F,j]),ui(()=>{if(!ni||!df.length)return;const O=Jn.current||{},de=O.url||Xs.current,Te=O.floorLabel||qn||O.floor||"";if(!de)return;const Me=PV(df);if(!Me)return;const tt={...Me,floorLabel:Te};hl.current[de]=Me,as.current.set(de,Me),O.key&&as.current.set(O.key,Me),Dn(tt),vl(Me),or(Hu(Me,"floor"))},[ni,df,qn,vl]),ui(()=>{if(!k||!_.current||!ni)return;const O=!!(Es?.byGuid?.size||Es?.byComposite?.size),de=Ws instanceof Map&&Ws.size>0;if(!O&&!de)return;const Te=_.current,Me=Wu(Te,ma);if(!Me)return;const tt=Me._data||Me.serialize?.()?.data||null,ze=Au(tt);if(!ze?.features?.length)return;const Ke=Jn.current||{},At=Ke.buildingId||F||j,kt=Ke.floorLabel||Ke.floorId||Ke.floor||qn;let gt=!1;const $t=ze.features.map(An=>{if(!An)return An;const yn=An.properties||{};if(b0(yn)!=="room")return An;let Kt=yn,rn=!1;if(O){const On=AC(yn,Es,At,kt);On&&(Kt=Hv(Kt,On),rn=!0)}if(de&&At&&kt){const On=An.id??yn.RevitId??yn.id,gr=On!=null?Jd(At,kt,On):null,ti=gr&&Ws.get(gr)||null;ti&&(Kt=Hv(Kt,ti),rn=!0)}const $n=gd(Kt),yr=$n?String($n).trim():Kt.__roomType||"";return!rn&&yr===yn.__roomType?An:(gt=!0,{...An,properties:{...Kt,__roomType:yr}})});if(!gt)return;const en={...ze,features:$t};try{Me.setData(en)}catch{}Jn.current&&(Jn.current={...Jn.current,fc:en}),di(An=>An+1);try{el(Bi)}catch{}},[Es,Ws,Bi,ni,k,F,j,qn,el]),ui(()=>{if(!n)return;let O=null,de=null;const Te=m.current;if(!Te)return;const Me=()=>Te.clientWidth>0&&Te.clientHeight>0,tt=()=>{if(_.current)return;const Ke=n&&n.style||"mapbox://styles/mapbox/streets-v12",At=typeof Ke=="string"&&/^mapbox:\/\//i.test(Ke),kt=!!(kd.accessToken||"").trim();if(At&&!kt){Gt(!0);return}Gt(!1);const gt=Ke,$t=n?.initialCenter||[-98.3739,40.5939],en=n?.initialZoom??16;console.log("Mapbox token length:",(kd.accessToken||"").length),console.log("Using style:",gt);let An=null;try{An=new kd.Map({container:Te,style:gt,center:$t,zoom:en,attributionControl:!1,preserveDrawingBuffer:!0})}catch(yn){console.error("Map constructor failed:",yn);return}if(!An){console.error("Map was not created (mapInstance is falsy).");return}An.on("error",yn=>{const Kt=String(yn?.error?.message||"");/access token/i.test(Kt)&&Gt(!0)}),_.current=An,typeof window<"u"&&(window.__map=An);try{An.addControl(new kd.NavigationControl,"top-right")}catch(yn){console.warn("Adding controls failed:",yn)}An.once("load",()=>{(async()=>{try{await XA(An,"mf-door-swing","/StakeholderMap/icons/door-swing.png")}catch(yn){console.warn("Door icon load failed:",yn)}try{await XA(An,"mf-stairs-run","/StakeholderMap/icons/stairs-run.png")}catch(yn){console.warn("Stairs icon load failed:",yn)}ie(!0);try{An.resize()}catch(yn){console.warn("resize() failed:",yn)}try{const yn=Au(n?.boundary);if(yn?.features?.length){const[Kt,rn,$n,yr]=BV(yn);Number.isFinite(Kt)&&Number.isFinite(rn)&&Number.isFinite($n)&&Number.isFinite(yr)&&An.fitBounds([[Kt,rn],[$n,yr]],{padding:40,duration:0})}}catch(yn){console.warn("fitBounds from boundary failed:",yn)}})()})};if(Me())tt();else{try{de=new ResizeObserver(()=>{if(Me()){try{de.disconnect()}catch{}de=void 0,tt()}}),de.observe(Te)}catch{}O=requestAnimationFrame(()=>{if(Me()){if(de){try{de.disconnect()}catch{}de=void 0}tt()}})}const ze=()=>{if(_.current)try{_.current.resize()}catch{}};try{window.addEventListener("resize",ze)}catch{}return()=>{if(O&&cancelAnimationFrame(O),de)try{de.disconnect()}catch{}try{window.removeEventListener("resize",ze)}catch{}if(_.current){try{_.current.remove()}catch{}_.current=null}}},[n]),ui(()=>{t!=="admin"&&(!Ol&&!Uo&&Ks.length===0||(_s(!1),Ia(null),yu([]),za.current=[]))},[t,Ol,Uo,Ks.length]),ui(()=>{(async()=>{try{let O;if(t==="admin"||c)O=qE(hf);else{if(!i){ue([]);return}O=qE(hf,rB("persona","==",i))}const de=await E1(O);if(ue(de.docs.map(Ke=>({id:Ke.id,...Ke.data(),coordinates:[Ke.data().coordinates.longitude,Ke.data().coordinates.latitude]}))),t!=="admin"){je({}),U({});return}const[Te,Me]=await Promise.all([E1(xg),E1(Ra)]),tt={};Te.forEach(Ke=>{const At=Ke.data().originalId||Ke.id.replace(/__/g,"/");tt[At]=Ke.data().condition}),je(tt);const ze={};Me.forEach(Ke=>{const At=Ke.data().originalId||Ke.id.replace(/__/g,"/");ze[At]=Ke.data()}),U(ze)}catch(O){console.error("Failed to fetch data:",O),t==="admin"&&(je({}),U({}))}})()},[t,c,e,i,hf,xg,Ra]),ui(()=>{if(!F)return;const O=ge(F)||F;j!==O&&H(O)},[F,ge,j]),ui(()=>{if(!c||!k)return;if(!es){Vc.current="";return}const O=pp(F||j||""),de=Na(qn||""),Te=Ul(O),Me=Te.some(kt=>Na(kt)===de);if(!Te.length||!Me){Vc.current="";return}const tt=Jn.current||{},ze=pp(tt.buildingId||""),Ke=Na(tt.floorId||""),At=`${O}/${de}`;if(ni&&ze===O&&Ke===de){Vc.current=At;return}Vc.current!==At&&(Vc.current=At,Ri(qn))},[c,es,k,F,j,qn,Ul,ni,Br]),ui(()=>{c&&(es||ni&&ls())},[c,es,ni,ls]),ui(()=>{c&&(es||nt(!0))},[c,es]),ui(()=>{(!c||!es||!ni)&&Ru(!1)},[c,es,ni]),ui(()=>{if(Du.current){try{Du.current()}catch{}Du.current=null}const O=F||j;if(!O||!qn||!e)return;const de=tu(e),Te=pp(O),Me=Na(qn),tt=Bm(Sh,"universities",de,"buildings",Te,"floors",Me,"rooms");return Du.current=sB(tt,ze=>{const Ke=new Map;ze.forEach(At=>{const kt=At.data();Ke.set(At.id,{...kt,buildingId:kt.original?.buildingName??O,floor:kt.original?.floorLabel??qn,revitId:kt.original?.featureId??kt.revitId??At.id})}),Ba(Ke)}),()=>{if(Du.current){try{Du.current()}catch{}Du.current=null}}},[F,j,qn,e]),ui(()=>{xl.current=F,F||(ha.current=null,bl.current=null,Pn(null),Dn(null),Ei("building"),Xs.current||or(null))},[F]),ui(()=>{if(c||!k||!_.current||!n)return;const O=_.current;if(!O.getSource("buildings")){if(O.addSource("buildings",{type:"geojson",data:n.buildings,promoteId:"id"}),O.addLayer({id:"buildings-layer",type:"fill-extrusion",source:"buildings",paint:{"fill-extrusion-color":fd(Vm),"fill-extrusion-height":15,"fill-extrusion-opacity":.7}}),O.addLayer({id:"buildings-outline-base",type:"line",source:"buildings",paint:{"line-color":"rgba(0,0,0,0.35)","line-width":1.6,"line-opacity":.8}}),O.addLayer({id:"buildings-outline",type:"line",source:"buildings",paint:{"line-color":"#1d4ed8","line-width":2.6,"line-opacity":["case",["boolean",["feature-state","selected"],!1],1,0]}}),!O.getLayer("buildings-fill"))try{O.addLayer({id:"buildings-fill",type:"fill",source:"buildings",paint:{"fill-opacity":0}},"buildings-outline")}catch{O.addLayer({id:"buildings-fill",type:"fill",source:"buildings",paint:{"fill-opacity":0}})}O.addLayer({id:"buildings-labels",type:"symbol",source:"buildings",layout:{"text-field":["coalesce",["get","name"],["get","id"]],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":10,"text-anchor":"center","text-variable-anchor":["center"],"text-offset":[0,0],"text-line-height":1,"text-allow-overlap":!1,"text-max-width":10,"symbol-placement":"point"},paint:{"text-color":"#111111","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":1}}),O.getLayer("buildings-hit")||O.addLayer({id:"buildings-hit",type:"line",source:"buildings",paint:{"line-color":"#007aff","line-width":2},filter:["==",["get","id"],F||""]})}if(n.boundary&&!O.getSource("boundary")){const de=Au(n.boundary);de?(O.addSource("boundary",{type:"geojson",data:de}),O.addLayer({id:"boundary-layer",type:"line",source:"boundary",paint:{"line-color":"#a9040e","line-width":3,"line-dasharray":[2,2]}})):console.warn("Boundary provided but could not normalize to FeatureCollection.")}},[k,n]),ui(()=>{if(!k||!_.current||!n)return;const O=_.current;O.getSource("buildings")||(O.addSource("buildings",{type:"geojson",data:n.buildings,promoteId:"id"}),O.addLayer({id:"buildings-layer",type:"fill-extrusion",source:"buildings",paint:{"fill-extrusion-color":fd(Vm),"fill-extrusion-height":15,"fill-extrusion-opacity":.7}}),O.addLayer({id:"buildings-outline",type:"line",source:"buildings",paint:{"line-color":"#1d4ed8","line-width":2.2,"line-opacity":["case",["boolean",["feature-state","selected"],!1],1,0]}}),O.getLayer("buildings-fill")||O.addLayer({id:"buildings-fill",type:"fill",source:"buildings",paint:{"fill-opacity":0}},"buildings-outline"));const de=async Te=>{if(!O)return;let Me=null;try{if(O.getLayer(ko)){const At=O.queryRenderedFeatures(Te.point,{layers:[ko]});Me=At&&At[0]}}catch{}if(Me)return;const tt=Te.features&&Te.features[0];if(!tt)return;bl.current=tt;const ze=tt.properties?.id;if(!ze)return;try{o.current&&O.setFeatureState({source:"buildings",id:o.current},{selected:!1}),O.setFeatureState({source:"buildings",id:ze},{selected:!0}),o.current=ze}catch{}q(ze),xl.current=ze;const Ke=O.project(Te.lngLat);ju(Qt(Ke)),ir(!1),Ei("building"),Dn(null),Pn(null),or({loading:!0,mode:"building"}),_e(ze);try{const At=await Ue(ze);if(xl.current!==ze)return;if(Xs.current||(Pn(At),or(Hu(At,"building"))),Ne!==Re.SPACE_DATA){const kt=await Xe?.(ze)||At||{},gt=yn=>Number.isFinite(yn)?Math.round(yn).toLocaleString():"-",$t=yn=>Number.isFinite(yn)?Number(yn).toLocaleString():"-",en=MU(kt.keyDepts||[]),An=`
          <div class="mf-popup mf-popup--building" style="min-width:280px;padding:8px 10px;">
            <div style="display:flex;gap:18px;align-items:flex-start;">
              <div style="flex:1">
                <div style="font-weight:700;margin-bottom:6px;">${buildingName}</div>
                <div><b>Total SF:</b> ${gt(kt.totalSf)}</div>
                <div><b>Rooms:</b> ${$t(kt.rooms)}</div>
                <div><b>Classroom SF:</b> ${gt(kt.classroomSf)}</div>
                <div><b>Classrooms:</b> ${$t(kt.classroomCount)}</div>
              </div>
              <div style="min-width:180px;">
                <div style="font-weight:600;margin-bottom:4px;">Key Departments</div>
                ${en||'<div class="mf-subtle">?</div>'}
              </div>
            </div>
          </div>`;new kd.Popup({offset:12}).setLngLat(Te.lngLat).setHTML(An).addTo(O)}}catch(At){console.warn("Failed to load building totals for popup:",At)}};return O.__mf_building_click_bound||(O.on("click","buildings-fill",de),O.__mf_building_click_bound=!0),()=>{try{O.__mf_building_click_bound&&(O.off("click","buildings-fill",de),O.__mf_building_click_bound=!1)}catch{}}},[c,k,n,Ne,_e,Ue,Xe]),ui(()=>{if(!k||!_.current)return;const O=_.current,de=(ze,Ke)=>{try{O.setPaintProperty("buildings-layer","fill-extrusion-color",ze),O.setPaintProperty("buildings-layer","fill-extrusion-opacity",Ke)}catch{}},Te=(ze,Ke,At)=>{try{O.setPaintProperty(ze,"fill-color",Ke),O.setPaintProperty(ze,"fill-opacity",At)}catch{}},Me=O.getLayer("buildings-layer"),tt=O.getLayer("buildings-fill");if(Ne===Re.SPACE_DATA)Me&&(Me.type==="fill-extrusion"?de(fd("#ffffff"),1):Te("buildings-layer",fd("#ffffff"),1)),KA(O);else if(Me&&(Me.type==="fill-extrusion"?de(fd(Vm),.7):Te("buildings-layer",fd(Vm),.7)),tt){Te("buildings-fill",fd(Vm),.2);try{O.setPaintProperty("buildings-fill","fill-outline-color","#00000000")}catch{}Uy(O,Bi)}},[k,Ne,Bi]),ui(()=>{if(!k||!_.current)return;const O=_.current;try{O.getLayer("buildings-hit")&&O.setFilter("buildings-hit",["==",["get","id"],F||""])}catch{}},[F,k]),ui(()=>{if(!k||!_.current)return;const O=_.current;o.current&&O.setFeatureState({source:"buildings",id:o.current},{selected:!1}),F&&O.setFeatureState({source:"buildings",id:F},{selected:!0}),o.current=F},[F,k,t]),ui(()=>{if(!k||!_.current)return;const O=_.current,de=()=>{const Me=O.getStyle?.(),tt=Me?.layers||[],ze=Me?.sources||{};try{O.getLayer(Zd)&&O.removeLayer(Zd)}catch{}try{O.getLayer(Yd)&&O.removeLayer(Yd)}catch{}tt.map(Ke=>Ke?.id).filter(Ke=>typeof Ke=="string"&&Ke.startsWith("engagement-heat-layer-")).forEach(Ke=>{try{O.removeLayer(Ke)}catch{}}),Object.keys(ze).filter(Ke=>Ke.startsWith("engagement-heat-source-")).forEach(Ke=>{try{O.removeSource(Ke)}catch{}})},Te=()=>{LT.forEach(({layerId:Me})=>{try{O.getLayer(Me)&&O.removeLayer(Me)}catch{}});try{O.getLayer(Zd)&&O.removeLayer(Zd)}catch{}try{O.getLayer(Yd)&&O.removeLayer(Yd)}catch{}try{O.getSource(Um)&&O.removeSource(Um)}catch{}};if(!c){Te(),de();return}try{de();const Me=O.getSource(Um);Me&&typeof Me.setData=="function"?Me.setData(au):O.addSource(Um,{type:"geojson",data:au});const tt=O.getLayer("boundary-layer")?"boundary-layer":O.getLayer("buildings-labels")?"buildings-labels":void 0,ze=!0,Ke=!!ni;O.getLayer(Zd)||O.addLayer({id:Zd,type:"heatmap",source:Um,maxzoom:d5,filter:["all",["in",["coalesce",["get","heatCategory"],""],["literal",Bq]],f5],paint:{"heatmap-weight":RT(),"heatmap-intensity":MT(ze),"heatmap-radius":NT(Ke),"heatmap-opacity":DT(ze),"heatmap-color":$q()}},tt),O.setPaintProperty(Zd,"heatmap-weight",RT()),O.setPaintProperty(Zd,"heatmap-intensity",MT(ze)),O.setPaintProperty(Zd,"heatmap-radius",NT(Ke)),O.setPaintProperty(Zd,"heatmap-opacity",DT(ze)),Qg(O,Zd,Fe&&CT),O.getLayer(Yd)||O.addLayer({id:Yd,type:"heatmap",source:Um,maxzoom:d5,filter:["all",["in",["coalesce",["get","heatCategory"],""],["literal",zq]],f5],paint:{"heatmap-weight":["*",Xv,.98],"heatmap-intensity":FT(ze),"heatmap-radius":OT(Ke),"heatmap-opacity":BT(ze),"heatmap-color":Gq()}},tt),O.setPaintProperty(Yd,"heatmap-weight",["*",Xv,.98]),O.setPaintProperty(Yd,"heatmap-intensity",FT(ze)),O.setPaintProperty(Yd,"heatmap-radius",OT(Ke)),O.setPaintProperty(Yd,"heatmap-opacity",BT(ze)),Qg(O,Yd,Fe&&CT),LT.forEach(({category:At,layerId:kt})=>{O.getLayer(kt)||O.addLayer({id:kt,type:"heatmap",source:Um,maxzoom:d5,filter:["all",["==",["coalesce",["get","heatCategory"],""],At],f5],paint:{"heatmap-weight":kT(At),"heatmap-intensity":jT(At,ze),"heatmap-radius":zT(At,Ke),"heatmap-opacity":UT(At,ze),"heatmap-color":qq(At)}},tt),O.setPaintProperty(kt,"heatmap-weight",kT(At)),O.setPaintProperty(kt,"heatmap-intensity",jT(At,ze)),O.setPaintProperty(kt,"heatmap-radius",zT(At,Ke)),O.setPaintProperty(kt,"heatmap-opacity",UT(At,ze)),Qg(O,kt,Fe)})}catch(Me){console.warn("Engagement heatmap update failed",Me)}},[k,c,au,Fe,ni]),ui(()=>{if(!k||!_.current)return;const O=_.current;O.getCanvas().parentElement.querySelectorAll(".custom-mapbox-marker").forEach(Me=>Me.remove());const de=t==="admin"?J?xm:[]:c?Hc:ee;c&&(Fe||Ps)||de.forEach(Me=>{const tt=document.createElement("div");tt.className="custom-marker custom-mapbox-marker";const ze=c?PT(Me.type):bu[Me.type]||"#9E9E9E";tt.style.backgroundColor=ze;const Ke=new kd.Marker(tt).setLngLat(Me.coordinates);if(Ne!==Re.SPACE_DATA){const At=c?jq(Me.type):Me.type;Ke.setPopup(new kd.Popup({offset:25}).setText(Me.comment||At))}Ke.addTo(O)})},[xm,ee,Hc,bu,sd,k,t,J,c,Fe,Ps]),ui(()=>{if(!k||!_.current||!_.current.getSource("buildings"))return;const O=_.current;if(Ne===Re.SPACE_DATA){if(zo&&ae&&Object.keys(ae).length>0){const tt=["match",["get","id"]];Object.entries(ae).forEach(([Ke,At])=>{const kt=Number.isFinite(At?.overallUtilization)?At.overallUtilization:null,gt=Mq(kt);tt.push(Ke,gt)}),tt.push("#e5e7eb");const ze=fd(tt);try{O.setPaintProperty("buildings-layer","fill-extrusion-color",ze),O.setPaintProperty("buildings-layer","fill-extrusion-opacity",.2),O.getLayer("buildings-fill")&&(O.setPaintProperty("buildings-fill","fill-color",ze),O.setPaintProperty("buildings-fill","fill-opacity",.55),O.setPaintProperty("buildings-fill","fill-outline-color","rgba(0,0,0,0)"))}catch{}}else try{O.setPaintProperty("buildings-layer","fill-extrusion-color",fd("#ffffff")),O.setPaintProperty("buildings-layer","fill-extrusion-opacity",.7),O.getLayer("buildings-fill")&&(O.setPaintProperty("buildings-fill","fill-color",fd("#ffffff")),O.setPaintProperty("buildings-fill","fill-opacity",0))}catch{}return}if(O.getLayer("buildings-fill"))try{O.setPaintProperty("buildings-fill","fill-opacity",0)}catch{}try{O.setPaintProperty("buildings-layer","fill-extrusion-opacity",.7)}catch{}const de=["match",["get","id"]];let Te=!1;t==="admin"&&Ne===Re.ASSESSMENT&&Object.keys(pe).length>0?Object.entries(pe).forEach(tt=>{const ze=tt[0],Ke=tt[1];let At=0;const kt=Ke&&Ke.scores?Ke.scores:{};kt.architecture&&Object.values(kt.architecture).some(gt=>gt>0)&&At++,kt.engineering&&Object.values(kt.engineering).some(gt=>gt>0)&&At++,kt.functionality&&Object.values(kt.functionality).some(gt=>gt>0)&&At++,de.push(Ke&&Ke.originalId||ze,Cq[At]),Te=!0}):t==="admin"&&Ne===Re.SPACE_DATA&&Object.keys(ke).length>0&&Object.entries(ke).forEach(tt=>{const ze=tt[0],Ke=tt[1],At=Iq[Ke];At&&(de.push(ze,At.color),Te=!0)}),de.push(Vm);const Me=fd(de);Te?O.setPaintProperty("buildings-layer","fill-extrusion-color",Me):O.setPaintProperty("buildings-layer","fill-extrusion-color",fd(Vm))},[ke,pe,k,t,Ne,zo,ae]);const Sd=nr(O=>{if(!_.current)return;const de=document.createElement("div");de.className="marker-prompt-popup",de.innerHTML=`
      <h4>Add a Marker</h4>
      <select id="marker-type">${Object.keys(bu).map(Me=>`<option value="${Me}">${Me}</option>`).join("")}</select>
      <textarea id="marker-comment" placeholder="Optional comment..."></textarea>
      <div class="button-group">
        <button id="confirm-marker">Add</button>
        <button id="cancel-marker">Cancel</button>
      </div>`;const Te=new kd.Popup({closeOnClick:!1,maxWidth:"280px"}).setDOMContent(de).setLngLat(O).addTo(_.current);de.querySelector("#confirm-marker").addEventListener("click",async()=>{const Me=de.querySelector("#marker-type").value,tt=de.querySelector("#marker-comment").value.trim(),ze=Jn.current||{},Ke=es&&ni,At=Ke&&(ze.buildingId||F||j)||"",kt=pp(At||""),gt=String(Lf(At)||li).trim(),$t=Ke?Na(ze.floorId||qn||""):"",en=Ke?String(ze.floorLabel||qn||"").trim():"",An=Ke?String(ze.url||dl||"").trim():"",yn={coordinates:new mx(O.lat,O.lng),type:Me,comment:tt,buildingId:kt,buildingName:gt,floorId:$t,floorLabel:en,floorUrl:An,persona:i||(c?"student":"admin"),createdAt:A1()},Kt=await WE(hf,yn),rn={...yn,id:Kt.id,coordinates:[O.lng,O.lat]};ue($n=>[...$n,rn]),te($n=>[...$n,rn]),Te.remove()}),de.querySelector("#cancel-marker").addEventListener("click",()=>Te.remove())},[bu,hf,i,c,F,j,qn,dl,li,es,ni]);ui(()=>{if(!c||t==="admin"||!k||!_.current)return;const O=_.current,de=Te=>{if(!(Bn.current||no.current)&&!(es&&!ni)){try{if(es){const Me=O.queryRenderedFeatures(Te.point,{layers:["buildings-fill"]})||[],tt=String(Me[0]?.properties?.id||""),ze=String(xl.current||F||j||"");if(tt&&ze&&tt!==ze)return}}catch{}Sd(Te.lngLat)}};return O.on("click",de),()=>{try{O.off("click",de)}catch{}}},[c,t,k,Sd,ni,F,j,es]),ui(()=>{if(!k||!_.current)return;const O=_.current,de=Te=>{const Me=vn.current;if(!Me)return;try{Te.preventDefault?.(),Te.originalEvent&&(Te.originalEvent.preventDefault?.(),Te.originalEvent.stopPropagation?.(),Te.originalEvent.cancelBubble=!0)}catch{}const tt=Number(Me.step)||0,ze=tt<2,Ke=ze?ko:Sp,kt=Jn.current?.fc||null;let gt=null;if(ze){if(O.getLayer(Ke)){const en=O.queryRenderedFeatures(Te.point,{layers:[Ke]})||[];if(en.length){const An=[Te.lngLat.lng,Te.lngLat.lat];gt=JU(en[0],An)}}if(!gt&&kt&&(gt=t5({map:O,fc:kt,isDrawing:!1,screenPoint:Te.point,maxPixels:rV,maxPoints:n5})),!gt){Pt("Click closer to a room polygon (or zoom in).");return}}else{const en=!!kt?.features?.some(An=>{const yn=An?.geometry?.type||"";return Fh(An?.properties||{})||yn==="LineString"||yn==="MultiLineString"});if(kt&&(gt=t5({map:O,fc:kt,isDrawing:!0,screenPoint:Te.point,maxPixels:iV,maxPoints:n5})),!gt&&en&&kt&&(gt=t5({map:O,fc:kt,isDrawing:!0,screenPoint:Te.point,maxPixels:null,maxPoints:n5})),!gt){Pt(en?"No drawing vertex nearby. Zoom in and click closer to linework.":"No drawing linework found on this floor.");return}}const $t={...Me,roomPts:Array.isArray(Me.roomPts)?[...Me.roomPts]:[],drawingPts:Array.isArray(Me.drawingPts)?[...Me.drawingPts]:[]};if(ze?$t.roomPts.push(gt):$t.drawingPts.push(gt),$t.step=tt+1,$t.step>=jA.length){const en=Ht($t.roomPts,$t.drawingPts);if(!en){Pt("Unable to compute alignment from those points.");return}if(!$U(Me.buildingLabel,Me.floorId,en)){Pt("Failed to save alignment in local storage.");return}Bt(null),Pt("");const yn=ao(j,Me.floorId);yn&&(ps.delete(yn),Xu.delete(yn)),Ri(Me.floorId);return}Pt(""),Bt($t)};return O.on("click",de),()=>{try{O.off("click",de)}catch{}}},[k,j,ao,Ri,Ht]),ui(()=>{if(!k||!_.current)return;const O=_.current,de=(ze,Ke)=>{const At=Mf(ms([ze.lng,ze.lat]),ms([Ke.lng,ze.lat]),{units:"kilometers"}),kt=Mf(ms([ze.lng,ze.lat]),ms([ze.lng,Ke.lat]),{units:"kilometers"}),gt=(Ke.lng>=ze.lng?1:-1)*At*1e3,$t=(Ke.lat>=ze.lat?1:-1)*kt*1e3;return[gt,$t]},Te=ze=>{if(!no.current)return;try{ze.preventDefault?.(),ze.originalEvent&&(ze.originalEvent.preventDefault?.(),ze.originalEvent.stopPropagation?.(),ze.originalEvent.cancelBubble=!0)}catch{}const Ke=Ai.current;if(!Ke)return;const At=zt(),kt=At.url||ao(j,At.floorId),gt=At.basePath||Jn.current?.floorAdjustBasePath||null,$t=Jn.current?.floorAdjustBasePivot||null,en=gt?By(gt,At.floorId):null,An=mp(en),yn=kt?Oy(kt):null,Kt=mp(yn),rn=An?en:Kt?yn:Wm(At.buildingLabel,At.floorId),$n=Array.isArray(rn.translateLngLat)?rn.translateLngLat:[0,0],yr=Jn.current?.floorAdjustLabel||(kt?Md(kt):null)||At.buildingLabel,gr=Wu(O,ma)?._data||Jn.current?.fc||null;if(!gr){Ar("No floor data to adjust.");return}let ti=null;try{ti=Ml(gr)?.geometry?.coordinates||null}catch{ti=null}if(!ti){Ar("Unable to find a transform pivot.");return}const Or=O.project({lng:ti[0],lat:ti[1]}),Hr=Math.atan2(ze.point.y-Or.y,ze.point.x-Or.x);$o.current={mode:Ke,baseData:JSON.parse(JSON.stringify(gr)),pivot:ti,pivotScreen:Or,startAngle:Hr,startRotation:rn.rotationDeg||0,startScale:rn.scale||1,startTranslate:rn.translateMeters||[0,0],startTranslateLngLat:$n,startLngLat:ze.lngLat,buildingLabel:At.buildingLabel,floorId:At.floorId,adjustUrl:kt,adjustLabel:yr,adjustBasePath:gt,basePivot:$t};try{O.dragPan.disable()}catch{}try{O.getCanvas().style.cursor="grabbing"}catch{}},Me=ze=>{const Ke=$o.current;if(!Ke)return;const At=Wu(O,ma);if(At){if(Ke.mode==="rotate"){const gt=(Math.atan2(ze.point.y-Ke.pivotScreen.y,ze.point.x-Ke.pivotScreen.x)-Ke.startAngle)*180/Math.PI,$t=Yh(Ke.baseData,gt,{pivot:Ke.pivot});At.setData($t);return}if(Ke.mode==="move"){de(Ke.startLngLat,ze.lngLat);const kt=ze.lngLat.lng-Ke.startLngLat.lng,gt=ze.lngLat.lat-Ke.startLngLat.lat,$t=ow(Ke.baseData,[kt,gt]);At.setData($t)}}},tt=ze=>{const Ke=$o.current;if(!Ke)return;let At=Wm(Ke.buildingLabel,Ke.floorId);if(Ke.mode==="rotate"){const rn=(Math.atan2(ze.point.y-Ke.pivotScreen.y,ze.point.x-Ke.pivotScreen.x)-Ke.startAngle)*180/Math.PI,$n=Array.isArray(Ke.basePivot)?Ke.basePivot:Array.isArray(Ke.pivot)?Ke.pivot:At.pivot;At={...At,rotationDeg:(Ke.startRotation||0)+rn,pivot:$n}}else if(Ke.mode==="move"){const[Kt,rn]=de(Ke.startLngLat,ze.lngLat),$n=ze.lngLat.lng-Ke.startLngLat.lng,yr=ze.lngLat.lat-Ke.startLngLat.lat,On=Array.isArray(Ke.basePivot)?Ke.basePivot:Array.isArray(Ke.pivot)?Ke.pivot:At.pivot;At={...At,translateMeters:[(Ke.startTranslate?.[0]||0)+Kt,(Ke.startTranslate?.[1]||0)+rn],translateLngLat:[(Ke.startTranslateLngLat?.[0]||0)+$n,(Ke.startTranslateLngLat?.[1]||0)+yr],pivot:On}}const gt=Wu(O,ma)?._data||Jn.current?.fc||null,$t=ov(gt);$t&&(At={...At,anchorLngLat:$t});const en=Ke.adjustLabel||Ke.buildingLabel;R1(en,Ke.floorId,At),Ke.adjustUrl&&M1(Ke.adjustUrl,At),Ke.adjustBasePath&&N1(Ke.adjustBasePath,Ke.floorId,At);try{an(en,Ke.floorId,At)}catch{}const An=Bv(At);if(An&&gt){const Kt={...gt,__mfUserAdjustSignature:An};Ke.adjustUrl&&ps.set(Ke.adjustUrl,Kt),Jn.current={...Jn.current||{},fc:Kt}}$o.current=null,Lr(null),Ar("");const yn=Ke.adjustUrl||ao(j,Ke.floorId);yn&&!Ke.adjustUrl&&(ps.delete(yn),Xu.delete(yn));try{O.dragPan.enable()}catch{}try{O.getCanvas().style.cursor=Ke.mode==="move"?"move":"grab"}catch{}};return O.on("mousedown",Te),O.on("mousemove",Me),O.on("mouseup",tt),()=>{try{O.off("mousedown",Te)}catch{}try{O.off("mousemove",Me)}catch{}try{O.off("mouseup",tt)}catch{}}},[k,j,ao,zt,an]),ui(()=>{if(!k||!_.current)return;const O=_.current,de=tt=>{try{tt.preventDefault?.(),tt.originalEvent&&(tt.originalEvent.preventDefault?.(),tt.originalEvent.stopPropagation?.(),tt.originalEvent.cancelBubble=!0)}catch{}if(Bn.current||no.current)return;if(c){Qo(null);return}Nu.current=null;const ze=tt.features?.[0];if(!ze)return;if(wl){try{const ci=ze.properties||{},bs=F||j||ci.Building||ci.buildingId||"",da=ci.Floor||qn||dl?.match(/(BASEMENT|LEVEL_\d+|LEVEL|L\d+)/)?.[0]||"LEVEL_1",hh=ze.id??ci.RevitId??ci.revitId??null,Ll=ci.Number??ci.RoomNumber??ci.number??ci.Room??"",Ed=oa(gd(ci)||ci.__roomType||""),qu=ci.department??ci.Department??ci.Dept??"",dh=Rf(ci),Ga=Number.isFinite(dh)?dh:0,Qr=bs&&da&&hh!=null?Jd(bs,da,hh):null;if(!Qr){console.warn("Scenario click: could not build roomId",{buildingId:bs,floorName:da,revitId:hh,props:ci});return}const rl=tt.point||O.project(tt.lngLat);oe({roomId:Qr,buildingId:bs,buildingName:ci.BuildingName||ci.buildingName||bs,floorName:da,revitId:hh,roomNumber:Ll,roomType:Ed,department:qu,area:Number(Ga)||0}),En(rl),y()}catch(ci){console.warn("Scenario click failed",ci)}return}Nu.current=ze;const Ke=ze.id??ze.properties?.RevitId??null;et||Qo(Ke),dl&&(b.current||(b.current={}),b.current[dl]=Ke);const At=ze.properties||{},kt=F||j,gt=li,$t=ze.id??At.RevitId??null,en=At.Floor||qn||dl?.match(/(BASEMENT|LEVEL_\d+|LEVEL|L\d+)/)?.[0]||"LEVEL_1",An=kt&&$t!=null?Jd(kt,en,$t):null;if(wl){if(!An)return;ih(ci=>{const bs=new Set(ci);return bs.has(An)?bs.delete(An):bs.add(An),B(bs),bs});return}const yn=An?Ws.get(An):null,Kt=yn?{...At,...yn}:At,rn=Kt.Number??Kt.RoomNumber??Kt.number??Kt.Room??"",$n=oa(gd(Kt)||Kt.__roomType||""),yr=oa(Kt.__dept||Xy(Kt)||""),On=Kt.occupant??Kt.Occupant??"",gr=Kt.comments??Kt.Comments??"",ti=Sc(Kt),Or=Rf(Kt);let Hr=$n,_i=yr,vr=Number.isFinite(Or)?Or:null,Rr=On;const ji=B8(Kt),Gr=e5(Kt),jr=j8(Kt),Wr=z8(ji)||jr.isOfficeText,Un=D1($n)||zU(ji)||jr.isTeachingText,Jt=kt&&en&&$t!=null?Jd(kt,en,$t):null,pn=(Rr??"").toString().trim(),Xn=rn||"-",dr=String(Kt.Revit_UniqueId??Kt.RevitUniqueId??At.Revit_UniqueId??At.RevitUniqueId??At["Room GUID"]??"").trim(),qr=po(kt),Di=Pf(en),Wn=String(rn??"").trim(),qi=Ce?.length?Ce:yt,wo=Array.isArray(qi)?qi.find(ci=>{if(!ci)return!1;const bs=String(ci?.roomId??ci?.roomNumber??ci?.roomLabel??"").trim(),da=String(ci?.roomGuid??ci?.revitUniqueId??"").trim();if(dr&&(da===dr||bs===dr))return!0;const hh=po(ci?.building??ci?.buildingName??ci?.buildingLabel??"");return qr&&hh!==qr||Di.length&&!If(ci?.floor??ci?.floorName??ci?.floorId??"",Di)?!1:Wn&&bs===Wn}):null,ho=wo?.airtableId||wo?.AirtableId||wo?.["Airtable ID"]||null;if(et){if(!Nt){if(!pn||!Jt||Ke==null){console.warn("Cannot start move: missing occupant or identifiers.");return}tn({roomId:Jt,roomLabel:Xn,buildingId:kt,buildingName:gt,floorId:en,occupantName:pn,revitId:$t,highlightId:Ke}),Ft(null),Qo(Ke);return}if(Ke===Nt.highlightId){tn(null),Ft(null),Qo(null);return}if(kt!==Nt.buildingId||en!==Nt.floorId){tn(null),Ft(null),Qo(null);return}Ft({person:Nt.occupantName,effectiveDate:"",comments:"",from:Nt,to:{roomId:Jt,roomLabel:Xn,buildingId:kt,buildingName:gt,floorId:en,revitId:$t,highlightId:Ke}});return}const dc=v,Ns=Kt.Floor||en,Ds=!!(t==="admin"&&dc&&kt&&Ns&&$t!=null&&e),fo=Ds?Jd(kt,Ns,$t):null,Qn=Ds?{roomId:fo,buildingId:kt,floorName:Ns,revitId:$t,roomGuid:dr||null,roomLabel:Xn,roomNumber:rn||"",feature:ze,flags:{isOffice:Wr,isTeaching:Un},highlightId:Ke,properties:{type:Hr||"",department:_i||"",area:Number.isFinite(vr)?vr:"",occupant:Rr||"",occupancyStatus:ti||"",comments:gr||"",roomGuid:dr||"",Revit_UniqueId:dr||"",airtableId:ho}}:null;let lu=za.current||[];if(Qn){const ci=za.current||[];ci.findIndex(da=>da.roomId===Qn.roomId)>=0?lu=ci.filter(da=>da.roomId!==Qn.roomId):lu=[...ci,Qn],za.current=lu,yu(lu),_l(lu)}const ad=()=>{const ci=Number.isFinite(vr)&&vr!==0?Math.round(vr).toLocaleString():"",da=(za.current||[]).length,hh=da>0,Ll=da>1?`Edit ${da} Rooms`:"Edit",Ed=Ds?`<div class="mf-popup-actions" style="margin-top:6px;padding-top:6px;gap:6px;flex-wrap:wrap;width:100%;">
               <button id="mf-room-edit-btn" class="mf-btn tiny">${Ll}</button>
               ${hh?'<button id="mf-clear-edit-selection" class="mf-btn tiny" style="background:#f4f4f4;color:#333;">Clear Selection</button>':""}
             </div>`:"",qu=Number.isFinite(Gr)&&Gr>0,dh=(Rr??"").toString().trim(),Ga=D1(Hr||""),Qr=qu?Gr.toLocaleString():"-",rl=Ga?`<div><b>Seat Count:</b> ${Qr}</div>`:"",Ts=dh.length?dh:"-",fa=Ga?"":`<div><b>Occupant:</b> ${Ts}</div>`,ea=Ga?Ge(gt,rn||Xn):null,mc=ea&&(Number.isFinite(ea.timeUtilization)||Number.isFinite(ea.seatUtilization)),Oo=(tp,Gh,Ud)=>{if(!Number.isFinite(Gh))return"";const cu=Math.max(0,Math.min(Gh,100));return`
            <div style="margin-top:3px;">
              <div style="font-size:10px;color:#444;">${tp}: ${Math.round(Gh)}%</div>
              <div style="height:4px;background:#e4e7ec;border-radius:999px;overflow:hidden;">
                <div style="width:${cu}%;height:100%;background:${Ud};"></div>
              </div>
            </div>
          `},pf=mc?`
            <div style="margin-top:6px; width:100%; max-width:220px;">
              ${Oo("Time Util",ea.timeUtilization,"#3b82f6")}
              ${Oo("Seat Util",ea.seatUtilization,"#f59e0b")}
            </div>
          `:"",Ma=Ds&&da?`<div style="font-size:11px;color:#555;margin-top:6px;">Rooms selected: ${da}</div>`:"";return`
          <div class="mf-popup" style="min-width:340px;max-width:460px;background:#fff;border-radius:8px;box-shadow:0 8px 24px rgba(0,0,0,0.15);padding:2px;">
            <div class="mf-popup-body" style="padding:8px 12px 16px 12px;">
              <div class="mf-title">Room ${rn||"-"}</div>
              <div><b>Room Type:</b></div>
              <div style="white-space:normal;word-break:break-word;margin-bottom:2px;">${Hr||"-"}</div>
              <div><b>Department:</b> ${_i||"-"}</div>
              <div><b>Area (SF):</b> ${ci||"-"}</div>
              <div><b>Floor:</b> ${Ns}</div>
              ${rl}
              ${fa}
              ${pf}
              ${Ma}
              ${Ed}
            </div>
          </div>`},Mh=O.project(tt.lngLat),Cl=m.current?.clientWidth||1e3,Js=Mh.x>Cl*.56?"right":"left",Qs=Js==="left"?240:-240,Mc={top:[Qs,12],"top-left":[Qs,12],"top-right":[Qs,12],bottom:[Qs,-12],"bottom-left":[Qs,-12],"bottom-right":[Qs,-12],left:[Qs,0],right:[Qs,0]},uh=new kd.Popup({closeButton:!0,offset:Mc,anchor:Js,maxWidth:"520px"}).setLngLat(tt.lngLat).setHTML(ad()).addTo(O);uh.on("close",()=>{if(!et&&!Nt){const ci=nc(za.current||[]);Qo(ci.length?ci:null)}});const ff=async()=>{try{uh.remove()}catch{}const ci=Xs.current||th.current;if(ci){we(Re.SPACE_DATA),Yt(!1),ir(!1);try{const bs=O.project(tt.lngLat);ju(Qt(bs))}catch{}xl.current?q(xl.current):j&&q(j),it(ci)}},fc=()=>{if(!Ds)return;const bs=Ks.length?fo&&Ks.some(Ed=>Ed.roomId===fo)||!Qn?Ks:[...Ks,Qn]:Qn?[Qn]:[];if(!bs.length)return;const da=Ll=>{const Ed=bs.map(dh=>dh?.properties?.[Ll]??""),qu=Ed[0];return Ed.every(dh=>dh===qu)?qu:""},hh={type:da("type"),department:da("department"),occupant:da("occupant"),occupancyStatus:da("occupancyStatus"),comments:da("comments"),area:da("area")};Ia({...bs[0],targets:bs,roomLabel:bs.length===1?bs[0]?.roomLabel||"-":`${bs.length} rooms`,properties:hh,includedKeys:new Set(bs.map(Ll=>Ll.roomId||String(Ll.revitId??""))),refreshPopup:()=>{uh.setHTML(ad()),pc()},onApply:Ll=>{"type"in Ll&&(Hr=Ll.type),"department"in Ll&&(_i=Ll.department),"occupant"in Ll&&(Rr=Ll.occupant)}}),gl(new Set(bs.map(Ll=>Ll.roomId||String(Ll.revitId??"")))),_s(!0)},jd=()=>{za.current=[],yu([]),_l([]);try{uh.remove()}catch{}};function pc(){const ci=uh.getElement();ci&&(ci.querySelector("#mf-show-floor")?.addEventListener("click",ff),Ds&&(ci.querySelector("#mf-room-edit-btn")?.addEventListener("click",fc),ci.querySelector("#mf-clear-edit-selection")?.addEventListener("click",jd)))}pc()},Te=()=>{if(!(Bn.current||no.current)&&!c)try{O.getCanvas().style.cursor="pointer"}catch{}},Me=()=>{if(!(Bn.current||no.current))try{O.getCanvas().style.cursor=""}catch{}};return O.on("click",ko,de),O.on("mouseenter",ko,Te),O.on("mouseleave",ko,Me),()=>{try{O.off("click",ko,de),O.off("mouseenter",ko,Te),O.off("mouseleave",ko,Me)}catch{}Nu.current=null}},[k,dl,j,F,qn,it,we,Yt,ir,ju,Pi,Ws,yt,Ce,v,a,e,ge,Xe,Ae,Ne,oi,wl,et,Nt,Qo,Ks,Bl,_l,nc,c]),ui(()=>{if(!k||!_.current)return;const O=_.current,de=Te=>{const Me=_.current;if(!Me||Bn.current||no.current)return;const tt=xl.current;if(!tt)return;if(!!!Me.getLayer(ko)){$e(tt);return}const Ke=Te.point,At=Me.queryRenderedFeatures(Ke,{layers:[ko]});if(At&&At.length||!!!Me.getLayer("buildings-fill"))return;Me.queryRenderedFeatures(Ke,{layers:["buildings-fill"]})?.some(en=>en.properties?.id===tt)&&(Xs.current=null,$e(tt))};return O.on("click",de),()=>{try{O.off("click",de)}catch{}}},[k,$e]);const $h=nr(()=>{},[]),Mp=nr(async()=>{const O=ha.current||F||j;if(!O){alert("No building selected for export.");return}if(!va.length){alert("No floors available for export.");return}const de=[];for(const ze of va){const Ke=ao(O,ze);if(!Ke)continue;const At=await pd(Ke),kt=Au(At);if(!kt?.features?.length)continue;const gt=Xg({fc:kt,colorMode:Bi,solidFill:!0,labelOptions:{hideDrawing:!0}});gt&&de.push({img:gt,label:`${li} - ${ze}`})}if(!de.length){alert("No floorplans could be rendered for export.");return}const Te=k1(Vt?.totalsByDept),Me={totalSF:Vt?.totalSf,rooms:Vt?.rooms,classroomSf:Vt?.classroomSf,classroomCount:Vt?.classroomCount,levels:va.length},tt=`${li.replace(/\s+/g,"-").toLowerCase()}-floors`;ts(de,{filenameBase:tt,stats:Me,keyDepts:Te,summaryLabel:`${li} Floors`})},[va,li,ao,ts,j,F]);return Y.jsxs("div",{ref:u,className:"map-page-container",children:[Y.jsx("div",{className:"page",children:Y.jsx("div",{className:"map-wrapper",children:Y.jsx("div",{ref:m,className:"map-container"})})}),Mn&&Y.jsx("div",{style:{position:"fixed",inset:0,zIndex:10010,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Y.jsxs("div",{className:"mf-ai-modal-panel",style:{width:"min(560px, 92vw)",padding:16},children:[Y.jsx("div",{style:{fontWeight:700,fontSize:16},children:"Mapbox Token Required"}),Y.jsx("div",{style:{marginTop:8,fontSize:13,color:"#333"},children:"Enter a Mapbox public token (`pk...`) once for this browser to load the map."}),Y.jsx("input",{value:st,onChange:O=>{mr(O.target.value),Er&&Cr("")},placeholder:"pk.eyJ...",style:{width:"100%",marginTop:10,padding:"8px 10px",borderRadius:8,border:"1px solid #d0d0d0"}}),Er?Y.jsx("div",{style:{marginTop:8,color:"crimson",fontSize:12},children:Er}):null,Y.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:12},children:[Y.jsx("button",{className:"btn",onClick:()=>{try{window.localStorage.removeItem("MAPBOX_PUBLIC_TOKEN")}catch{}mr("")},children:"Clear"}),Y.jsx("button",{className:"btn primary",onClick:Bu,children:"Save & Reload"})]})]})}),t==="admin"&&!xe&&Y.jsx("button",{className:"controls-toggle-button",onClick:()=>ft(O=>!O),children:mt?"Hide Controls":"Show Controls"}),c&&xe&&Y.jsx("div",{style:{position:"absolute",left:16,top:16,zIndex:40,display:"flex",gap:8},children:Y.jsx("button",{className:"btn",onClick:zu,children:"Exit Presentation"})}),Bc&&Y.jsx("div",{style:{position:"fixed",inset:0,zIndex:10002,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Y.jsxs("div",{className:"mf-ai-modal-panel",style:{width:"min(520px, 92vw)",padding:16,lineHeight:1.4},children:[Y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[Y.jsxs("div",{children:[Y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[Y.jsx("div",{style:{fontWeight:700,fontSize:16},children:"Ask Mapfluence"}),Y.jsx("span",{title:"AI-generated response based on currently loaded space data.",style:{fontSize:11,padding:"2px 8px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:"#f7f7ff"},children:" AI"})]}),Y.jsx("div",{style:{fontSize:12,color:"#555"},children:"Ask questions about loaded campus data."})]}),Y.jsx("button",{className:"btn",onClick:()=>Ho(!1),children:"Close"})]}),Y.jsxs("div",{style:{marginTop:10},children:[Y.jsx("label",{style:{fontWeight:600,fontSize:12},children:"Question"}),Y.jsx("textarea",{value:ya,onChange:O=>Ja(O.target.value),rows:3,placeholder:"e.g. How many vacant offices are on campus?",style:{width:"100%",resize:"vertical",padding:8,borderRadius:8,border:"1px solid #d0d0d0",marginTop:4}})]}),vc?Y.jsx("div",{style:{color:"crimson",marginTop:6,fontSize:12},children:vc}):null,Y.jsx("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:10},children:Y.jsx("button",{className:"btn",disabled:ll||!ya.trim()||zi,onClick:Vh,children:ll?"Asking...":"Ask"})})]})}),Ti&&Y.jsx("div",{style:{position:"fixed",inset:0,zIndex:10004,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Y.jsxs("div",{className:"mf-ai-modal-panel",style:{width:"min(720px, 94vw)",padding:16,lineHeight:1.45,maxHeight:"86vh",overflowY:"auto"},children:[Y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,alignItems:"center"},children:[Y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[Y.jsx("div",{style:{fontWeight:700,fontSize:16},children:"Ask Mapfluence"}),Y.jsx("span",{title:"AI-generated response based on currently loaded space data.",style:{fontSize:11,padding:"2px 8px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:"#f7f7ff"},children:" AI"})]}),Y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[Y.jsx("button",{className:"btn",onClick:Ou,children:"Copy CSV"}),Y.jsx("button",{className:"btn",onClick:bd,children:"Export PDF"}),Y.jsx("button",{className:"btn",onClick:()=>Ss(null),children:"Close"})]})]}),Y.jsx("p",{style:{marginTop:10},children:Ti.answer}),Ti.bullets?.length?Y.jsx("ul",{style:{margin:"6px 0 10px 18px",padding:0},children:Ti.bullets.map((O,de)=>Y.jsx("li",{children:O},de))}):null,Ti.resultType==="table"&&Ti.columns?.length&&Ti.rows?.length?Y.jsx("div",{style:{marginTop:10,overflowX:"auto"},children:Y.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[Y.jsx("thead",{style:{background:"#f8f9fb"},children:Y.jsx("tr",{children:Ti.columns.map(O=>Y.jsx("th",{style:{textAlign:"left",padding:"6px 8px",borderBottom:"1px solid #e0e0e0"},children:O},O))})}),Y.jsx("tbody",{children:Ti.rows.map((O,de)=>Y.jsx("tr",{style:{borderBottom:"1px solid #f0f0f0"},children:Ti.columns.map(Te=>Y.jsx("td",{style:{padding:"6px 8px"},children:O&&O[Te]!=null?String(O[Te]):""},Te))},de))})]})}):null,Ti.missingData?.length?Y.jsxs("div",{style:{marginTop:10,fontSize:12,color:"#555"},children:["Missing data: ",Ti.missingData.join(", ")]}):null]})}),!xe&&Y.jsxs("div",{className:"mf-right-rail",children:[Y.jsxs("div",{className:"mf-right-logos",children:[Y.jsxs("div",{className:"logo-box",children:[Y.jsx("div",{className:"mapfluence-title",children:"MAPFLUENCE"}),Y.jsx("img",{className:"mf-logo mf-logo--mapfluence",src:Qd("Clark_Enersen_Logo.png"),alt:"Clark & Enersen Logo"})]}),Y.jsx("div",{className:"logo-box",children:Y.jsx("img",{className:"mf-logo mf-logo--hc",src:Qd("HC_image.png"),alt:"Hastings College"})})]}),!c&&Y.jsx("div",{className:"dashboard-box",children:Y.jsx(bU,{title:la,scopeLabel:Bd,metrics:$s,loading:Gs,error:xc,utilization:bm,utilizationScopeLabel:ep,heatmapOn:zo,onToggleHeatmap:Jo})})]}),t==="admin"&&Y.jsxs(Y.Fragment,{children:[Ne===Re.ASSESSMENT&&F&&!Dt&&Pc&&Y.jsx("div",{className:"floating-panel",style:{position:"absolute",zIndex:40,left:Math.max(8,Math.min(Pc.x+12,(m.current?.clientWidth||1e3)-360)),top:Math.max(8,Math.min(Pc.y+12,(m.current?.clientHeight||800)-260)),width:340},children:Y.jsx(cj,{buildingId:F,buildingName:n?.buildings?.features?.find(O=>O.properties.id===F)?.properties?.name,currentCondition:ke[F],onSave:$h,onOpenTechnical:()=>Yt(!0),onClose:()=>{q(null),Yt(!1),ju(null)},canWrite:v})}),Ne===Re.TECHNICAL&&F&&Dt&&Y.jsx(lj,{buildingId:F,assessments:pe,universityId:e,panelPos:Pc,isAdminRole:v,onClose:()=>Yt(!1),onSave:handleAssessmentSave})]}),Ne===Re.SPACE_DATA&&(F||j)&&!Ln&&(()=>{const O=m.current?.clientWidth||1e3,de=m.current?.clientHeight||800,Te=360,Me=420,tt=16,ze=260,Ke=24,At=140,kt=(vr,Rr,ji)=>Math.max(Rr,Math.min(vr,ji)),gt=Math.max(300,Math.min(Te,O-tt*2)),$t=tt+40,en=kt(O-gt-$t,12,O-gt-12),An=kt(O-gt-ze-Ke-At,320,O-gt-12),yn=12,Kt=Pc||{y:de*.65},rn=kt(Kt.y,8,de-Me-8),$n=An,yr=rn,On=bl.current;let gr=null;if(On&&On.geometry)try{const vr=Cu(On);if(vr&&vr.length===4&&vr.every(Rr=>Number.isFinite(Rr))){const Rr=(vr[1]+vr[3])/2,ji=_.current?.project?_.current.project({lng:vr[2],lat:Rr}):null;if(ji){const Gr=en,jr=kt(ji.y-Me*.35,8,de-Me-8);gr={left:Gr,top:jr}}}}catch{}const ti={position:"absolute",zIndex:40,left:$n,top:yr,width:gt,maxHeight:"75vh",overflow:"auto"},Or=gr?{position:"absolute",zIndex:40,left:Math.max(12,Math.min(gr.left,O-gt-tt)),top:yn,width:gt,maxHeight:"80vh",overflow:"auto"}:ti,Hr=Pr==="floor"?Or:ti,_i=wd?{...Hr,left:wd.x,top:wd.y}:Hr;return Y.jsxs("div",{ref:I,className:"floating-panel",style:_i,children:[Pr==="building"&&Y.jsx(mU,{buildingName:li,stats:Vt,keyDepts:k1(Vt?.totalsByDept),utilization:ve(li),floors:va,selectedFloor:ja,onChangeFloor:vr=>jl(vr),onLoadFloorplan:co,onExportCSV:()=>id(li),onClose:()=>{ir(!0),q(null),ju(null),Od(null),Xs.current=null,ha.current=null,bl.current=null,Pn(null),Dn(null),or(null),Ei("building")},onExportPDF:Mp,onExplainBuilding:hs,explainBuildingLoading:al,explainBuildingDisabled:zi||!Vt,explainBuildingError:tr,dragHandleProps:kp}),Pr==="floor"&&Y.jsx(gU,{buildingName:li,floorLabel:Gn?.floorLabel||ja,stats:Gn,legendItems:si,legendTitle:{department:"Key Departments",type:"Key Types",occupancy:"Occupancy",vacancy:"Vacancy"}[Bi]||"Legend",floors:va,selectedFloor:ja,onChangeFloor:vr=>jl(vr),onLoadFloorplan:co,onUnloadFloorplan:ls,onExportCSV:()=>id(li),colorMode:Bi,onChangeColorMode:vr=>{Fl(vr),el(vr),Uy(_.current,vr)},legendSelection:Qe,onLegendClick:vr=>{const Rr=Ee.get(vr)||[];ht(ji=>{const Gr=ji===vr?null:vr;return Qo(Gr?Rr:null),Gr})},onClose:()=>{ir(!0),q(null),ju(null),Od(null),Xs.current=null,ha.current=null,bl.current=null,Pn(null),Dn(null),or(null),Ei("building")},onExportPDF:xs,onExplainFloor:qa,explainLoading:sa,explainDisabled:zi||!Gn,explainError:Xo,moveScenarioMode:wl,onToggleMoveScenarioMode:$l,rotateActive:t==="admin"&&kr==="rotate",moveActive:t==="admin"&&kr==="move",rotateValue:t==="admin"?Sr:0,scaleValue:t==="admin"?ki:1,rotateNotice:t==="admin"?Vr:"",rotateStored:t==="admin"?Ci:!1,adjustDebugInfo:t==="admin"?gi:null,onStartRotate:t==="admin"?Cn:void 0,onStartMove:t==="admin"?jt:void 0,onCancelRotate:t==="admin"?on:void 0,onClearRotate:t==="admin"?In:void 0,onSaveAdjust:t==="admin"?async()=>{const vr=zt();if(!vr?.buildingLabel||!vr?.floorId)return;const Rr=Jn.current?.floorAdjustLabel||vr.buildingLabel,ji=vr.url||Jn.current?.url||ao(j,vr.floorId),Gr=vr.basePath||Jn.current?.floorAdjustBasePath||null,jr=$r||Wm(Rr,vr.floorId),Wr=Jn.current?.floorAdjustBasePivot||Jn.current?.fc&&Ml(Jn.current.fc)?.geometry?.coordinates||null,Jt=Wu(_.current,ma)?._data||Jn.current?.fc||null,pn=ov(Jt),Xn={...jr,pivot:Array.isArray(jr.pivot)?jr.pivot:Array.isArray(Wr)?Wr:null,anchorLngLat:pn||jr.anchorLngLat||null};R1(Rr,vr.floorId,Xn),ji&&M1(ji,Xn),Gr&&N1(Gr,vr.floorId,Xn);try{await an(Rr,vr.floorId,Xn)}catch{}ji&&(ps.delete(ji),Xu.delete(ji))}:void 0,saveAdjustDisabled:t==="admin"?!Ci:!0,onScaleChange:t==="admin"?vr=>{const Rr=zt();if(!Rr?.buildingLabel||!Rr?.floorId)return;const ji=Rr.url||Jn.current?.url||ao(j,Rr.floorId),Gr=Rr.basePath||Jn.current?.floorAdjustBasePath||null,jr=Gr?By(Gr,Rr.floorId):null,Wr=mp(jr),Un=ji?Oy(ji):null,Jt=mp(Un),pn=Wr?jr:Jt?Un:Wm(Rr.buildingLabel,Rr.floorId),Xn=Math.max(.5,Math.min(2.5,(pn.scale||1)+vr)),dr=Xn/(pn.scale||1),qr=Wu(_.current,ma),Di=qr?._data||Jn.current?.fc||null,Wn=Di&&Ml(Di)?.geometry?.coordinates||null;let qi=null;Di&&Wn&&Number.isFinite(dr)&&Math.abs(dr-1)>1e-6&&(qi=cg(Di,dr,{origin:Wn}),qr&&qr.setData(qi));const wo={...pn,scale:Xn},ho=Jn.current?.floorAdjustLabel||Rr.buildingLabel,dc=Jn.current?.floorAdjustBasePivot||Di&&Ml(Di)?.geometry?.coordinates||null,Ns={...wo,pivot:Array.isArray(dc)?dc:wo.pivot,anchorLngLat:ov(qi||qr?._data||Di)||wo.anchorLngLat||null};R1(ho,Rr.floorId,Ns),ji&&M1(ji,Ns),Gr&&N1(Gr,Rr.floorId,Ns);try{an(ho,Rr.floorId,Ns)}catch{}const Ds=Bv(Ns),fo=Di||Jn.current?.fc||null;if(Ds&&fo){const lu={...fo,__mfUserAdjustSignature:Ds};ji&&ps.set(ji,lu),Jn.current={...Jn.current||{},fc:lu}}const Qn=ji||ao(j,Rr.floorId);Qn&&!ji&&(ps.delete(Qn),Xu.delete(Qn))}:void 0,dragHandleProps:kp})]})})(),wl&&ql&&Y.jsxs("div",{ref:V,className:"floating-panel mf-move-scenario-panel",style:{position:"absolute",zIndex:60,right:Pa?"auto":16,left:Pa?Pa.x:"auto",top:Pa?Pa.y:xd,width:320,maxHeight:"70vh",overflow:"auto",padding:12,fontSize:13},children:[Y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6},..._m,children:[Y.jsx("div",{style:{fontWeight:600},children:"Move Scenario"}),Y.jsx("button",{className:"btn secondary",style:{fontSize:11,padding:"2px 6px"},onClick:lc,children:"Clear"})]}),Y.jsxs("div",{style:{marginBottom:8},children:[Y.jsx("label",{style:{display:"block",fontSize:12,marginBottom:2},children:"Scenario label (optional)"}),Y.jsx("input",{className:"mf-input",value:Vl,onChange:O=>Va(O.target.value),placeholder:"e.g. Art Dept to Hurley - Option A",style:{width:"100%"}})]}),Y.jsxs("div",{style:{marginBottom:8},children:[Y.jsxs("div",{children:[Y.jsx("b",{children:"Total SF:"})," ",Math.round(lo.totalSF).toLocaleString()]}),Y.jsxs("div",{children:[Y.jsx("b",{children:"Rooms:"})," ",lo.rooms]})]}),Y.jsxs("div",{style:{marginBottom:8},children:[Y.jsx("div",{style:{fontWeight:600,marginBottom:2},children:"Rooms by Room Type Description"}),nd.length===0?Y.jsx("div",{style:{fontSize:12,fontStyle:"italic",color:"#666"},children:"No rooms selected."}):Y.jsxs("table",{style:{width:"100%",fontSize:12},children:[Y.jsx("thead",{children:Y.jsxs("tr",{children:[Y.jsx("th",{style:{textAlign:"left"},children:"Room Type Description"}),Y.jsx("th",{style:{textAlign:"right"},children:"Qty"}),Y.jsx("th",{style:{textAlign:"right"},children:"SF"})]})}),Y.jsx("tbody",{children:nd.map(({type:O,count:de,sf:Te})=>Y.jsxs("tr",{children:[Y.jsx("td",{children:O}),Y.jsx("td",{style:{textAlign:"right"},children:de}),Y.jsx("td",{style:{textAlign:"right"},children:Math.round(Te).toLocaleString()})]},O))})]})]}),Y.jsxs("div",{style:{marginTop:4},children:[Y.jsx("label",{style:{fontSize:12},children:"Scenario Department"}),Y.jsxs("select",{className:"mf-input",value:Ni,onChange:O=>Ua(O.target.value),children:[Y.jsx("option",{value:"",children:"Choose department..."}),io.map(O=>Y.jsx("option",{value:O,children:O},O))]}),Y.jsx("button",{className:"btn primary",style:{marginTop:6},onClick:He,disabled:!Ni||Sl.size===0,children:"Commit"})]}),Y.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap",marginTop:8},children:[Y.jsx("button",{className:"btn primary",onClick:As,disabled:zi||_c||!Ni||!lo,title:Ni?lo?"Compare scenario vs current allocation for this department.":"Enable Move Scenario Mode and create a scenario to compare.":"Select a department for the scenario before comparing.",children:_c?"Comparing...":" Compare scenario vs current"}),Da?Y.jsx("div",{style:{color:"crimson",fontSize:12},children:Da}):null]}),Y.jsx("button",{className:"btn secondary",style:{width:"100%",marginTop:6},onClick:async()=>{try{const O=new Si("p","pt","letter"),de=O.internal.pageSize.getWidth(),Te=O.internal.pageSize.getHeight(),Me=20,tt=Xg({...Jn.current,labelOptions:{hideDrawing:!0}});let ze=!1,Ke=0,At=0;if(tt){const vr=tt.height&&tt.width?tt.height/tt.width:1,Rr=Math.min(de*.55,de-Me*3),ji=Te-Me*2;Ke=Rr,At=Ke*vr,At>ji&&(At=ji,Ke=At/(vr||1)),O.addImage(tt.data,"PNG",Me,Me,Ke,At),ze=!0}const kt="Move Scenario",gt=Vl||"Move Scenario",$t=Vl?.trim()?Vl.trim():"",en=ze?Ke+Me*2:Me,An=de-en-Me,yn=16;let Kt=Me;O.setFontSize(14),O.text(kt,en,Kt),$t&&O.text($t,en+An,Kt,{align:"right"}),Kt+=yn,O.setFontSize(12);const rn=vr=>{O.text(vr,en,Kt,{maxWidth:An}),Kt+=yn},$n=Ni||"None selected",yr=ef(Ni)||"#AAAAAA",On=14;O.setDrawColor(0),O.setFillColor(yr),O.rect(en,Kt,On,On,"FD");const gr=`Scenario Dept: ${$n}`;O.setTextColor("#000000"),O.setFont(void 0,"bold");const ti=O.splitTextToSize(gr,Math.max(50,An-On-6));ti.forEach((vr,Rr)=>{O.text(vr,en+On+6,Kt+On-4+Rr*yn)}),O.setFont(void 0,"normal"),Kt+=Math.max(On,ti.length*yn)+yn/2,O.setFontSize(12),rn(`Total SF: ${Math.round(lo.totalSF).toLocaleString()}`),rn(`Rooms: ${lo.rooms}`),Kt+=yn/2,O.setFont(void 0,"bold"),O.text("Rooms by Type",en,Kt),Kt+=yn;const Or=en+An*.65,Hr=en+An;if(O.setFontSize(11),O.text("Type",en,Kt),O.text("Qty",Or,Kt,{align:"right"}),O.text("SF",Hr,Kt,{align:"right"}),Kt+=yn,O.setFont(void 0,"normal"),!nd.length)O.text("No rooms selected.",en,Kt),Kt+=yn;else{const vr=Math.max(An-120,100);nd.forEach(({type:Rr,count:ji,sf:Gr})=>{const jr=Math.round(Gr).toLocaleString(),Wr=O.splitTextToSize(Rr,vr);Wr.forEach((Un,Jt)=>{O.text(Un,en,Kt+Jt*(yn*.9))}),O.text(String(ji),Or,Kt,{align:"right"}),O.text(jr,Hr,Kt,{align:"right"}),Kt+=yn*Math.max(1,Wr.length*.9)})}O.setFont(void 0,"normal"),O.setFontSize(12),Kt+=yn/4;const _i=`${(gt||"move-scenario").replace(/\s+/g,"-").toLowerCase()}.pdf`;O.save(_i)}catch(O){console.error("Scenario export failed",O),alert("Export failed - see console for details.")}},children:"Export Scenario (PDF)"})]}),mt&&!xe&&Y.jsx("div",{className:"map-controls-panel",style:{width:270,fontSize:12.5,lineHeight:1.25},children:Y.jsxs("div",{className:"map-controls",children:[t==="admin"&&Y.jsx("div",{className:"control-section",style:{background:"#fff",padding:6,border:"1px solid #ddd",borderRadius:6,marginBottom:4},children:Y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,justifyContent:"space-between"},children:[Y.jsx("h5",{style:{margin:0,fontSize:13},children:"Admin access"}),a?Y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[Y.jsxs("span",{style:{fontSize:12,whiteSpace:"nowrap"},children:[a.email," ",v?"(admin)":"(no admin)"]}),Y.jsx("button",{onClick:Jf,children:"Sign out"})]}):Y.jsx("button",{onClick:Rp,children:"Sign in with Google"})]})}),!c&&Y.jsxs("div",{className:"control-section theme-selector",style:{marginTop:6},children:[Y.jsx("label",{htmlFor:"theme-select",style:{marginRight:8},children:"Map View:"}),Y.jsx("select",{id:"theme-select",value:Ne,onChange:O=>we(O.target.value),disabled:rt.length<=1,children:rt.map(O=>Y.jsx("option",{value:O.value,children:O.label},O.value))})]}),c&&Y.jsxs("div",{className:"legend",style:{marginTop:6},children:[Y.jsx("h4",{children:"Legend"}),Y.jsxs("div",{style:{display:"grid",gap:6,marginBottom:10},children:[Y.jsx("button",{className:"btn",onClick:()=>{const O=!Fe;nt(O),O&&_a(!1)},children:Fe?"Show Marker Dots":"Show Engagement Heatmap"}),Y.jsx("button",{className:"btn",onClick:()=>Ru(O=>!O),disabled:!ni||!es,children:ua?"Hide Room Sentiment":"Show Room Sentiment"}),Y.jsx("button",{className:"btn",onClick:()=>{const O=!Ps;_a(O),O&&(nt(!1),Ru(!0))},disabled:!ni||!es,children:Ps?"Exit Room Sentiment Only":"Room Sentiment Only"}),Y.jsx("button",{className:"btn",onClick:zu,children:xe?"Exit Presentation":"Presentation Mode"}),Y.jsx("div",{style:{fontSize:11,color:"#555"},children:"Tip: use `?presentation=1` in the URL for clean preview mode."}),De&&Y.jsxs("div",{style:{fontSize:11,color:"#777"},children:["Build: ",De]}),(!ni||!es)&&Y.jsx("div",{style:{fontSize:11,color:"#666"},children:"Room sentiment coloring is available in Floorplan mode with a loaded floor."})]}),Fe&&Y.jsxs("div",{className:"legend-section",style:{marginBottom:10},children:[Y.jsx("h5",{children:"Heat Colors"}),Y.jsx("div",{style:{height:10,borderRadius:6,border:"1px solid #ddd",background:"linear-gradient(90deg, #1d4ed8 0%, #60a5fa 14%, #67e8f9 30%, #ffe44d 56%, #fb923c 78%, #ef4444 100%)"}}),Y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:11,color:"#555",marginTop:4},children:[Y.jsx("span",{children:"Cool"}),Y.jsx("span",{children:"Warm"})]}),Y.jsx("div",{style:{fontSize:11,color:"#666",marginTop:4},children:"Category cores plus thermal multicolor halo (comments stay gray dots only)."})]}),ua&&ni&&es&&Y.jsxs("div",{className:"legend-section",style:{marginBottom:10},children:[Y.jsx("div",{style:{fontSize:11,fontWeight:600,marginBottom:6},children:"Room Fill Style"}),Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6,marginBottom:8},children:[Y.jsx("button",{className:"btn",style:{fontWeight:ul==="solid"?700:500,borderColor:ul==="solid"?"#1f2937":void 0},onClick:()=>bc("solid"),children:"Solid"}),Y.jsx("button",{className:"btn",style:{fontWeight:ul==="gradient"?700:500,borderColor:ul==="gradient"?"#1f2937":void 0},onClick:()=>bc("gradient"),children:"Gradient"})]}),Y.jsx("h5",{children:"Room Sentiment (Dominant)"}),Wc.legendItems.length?Y.jsxs(Y.Fragment,{children:[Wc.legendItems.map(O=>Y.jsxs("div",{className:"legend-item",style:{justifyContent:"space-between"},children:[Y.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[Y.jsx("span",{className:"legend-color-box",style:{backgroundColor:O.color}}),Y.jsx("span",{children:O.label})]}),Y.jsxs("span",{style:{fontSize:11,color:"#555"},children:[O.roomCount," rooms"]})]},O.category)),Y.jsxs("div",{style:{fontSize:11,color:"#666",marginTop:4},children:[Wc.markerCount.toLocaleString()," markers matched inside ",Wc.roomCount.toLocaleString()," rooms."]})]}):Y.jsx("div",{style:{fontSize:11,color:"#666"},children:"No markers are currently inside room polygons on this loaded floor."})]}),Y.jsxs("div",{className:"legend-section",children:[Y.jsx("h5",{children:"Marker Types"}),Object.entries(bu||{}).map(([O,de])=>Y.jsxs("div",{className:"legend-item",children:[Y.jsx("span",{className:"legend-color-box",style:{backgroundColor:c&&sd[O]||de}}),Y.jsx("span",{children:O})]},O))]})]}),Y.jsxs("div",{className:"floorplans-section",style:{marginTop:8,padding:6,borderRadius:8,border:"1px solid rgba(0,0,0,0.25)",background:"linear-gradient(180deg, rgba(235,250,240,0.9), rgba(220,242,230,0.9))"},children:[Y.jsx("h4",{style:{margin:"0 0 6px 0",fontSize:12.5},children:"Floorplans"}),Y.jsxs("div",{className:"floorplans",style:{display:"grid",gap:6},children:[c&&Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6},children:[Y.jsx("button",{className:"btn",style:{width:"100%",fontWeight:qc==="campus"?700:500,borderColor:qc==="campus"?"#1f2937":void 0},onClick:()=>{oc("campus"),ls()},children:"Campus"}),Y.jsx("button",{className:"btn",style:{width:"100%",fontWeight:qc==="floor"?700:500,borderColor:qc==="floor"?"#1f2937":void 0},onClick:()=>{oc("floor"),ni||Ri()},disabled:!va.length,children:"Floorplan"})]}),Y.jsx("select",{id:"fp-building",style:{width:"100%"},value:j,onChange:O=>{const de=O.target.value;H(de)},children:md.map(O=>Y.jsx("option",{value:O.name,children:O.name},O.name))}),Y.jsx("select",{id:"fp-floor",style:{width:"100%"},value:qn??"",onChange:O=>jl(O.target.value),disabled:!va.length,children:va.map(O=>Y.jsx("option",{value:O,children:O},O))}),Y.jsx("button",{className:"btn",style:{width:"100%"},onClick:()=>{c&&oc("floor"),Ri()},disabled:!va.length,children:"Load"}),Y.jsx("button",{className:"btn",style:{width:"100%"},onClick:()=>{c&&oc("campus"),ls()},children:"Unload"}),Y.jsx("button",{className:"btn",style:{width:"100%"},onClick:()=>TT(_.current),disabled:!ni,children:"Center"})]}),!c&&Y.jsxs("div",{style:{marginTop:8},children:[Y.jsxs("button",{className:"mf-btn",style:{width:"100%",fontWeight:600},onClick:$l,children:["Move Scenario Mode ",wl?"ON":"OFF"]}),wl&&Y.jsx("div",{style:{marginTop:6,fontSize:11,color:"#555",textAlign:"center"},children:"Click rooms to add/remove them from a what-if scenario. Real data is not changed."})]})]}),!c&&Y.jsxs("div",{className:"floorplans-section",style:{marginTop:8,padding:6,borderRadius:8,border:"1px solid rgba(0,0,0,0.25)",background:"linear-gradient(180deg, rgba(255,247,235,0.9), rgba(255,239,219,0.9))"},children:[Y.jsx("h4",{style:{margin:"2px 0 4px 0",fontSize:12.5},children:"Space Data Export"}),Y.jsxs("div",{style:{display:"grid",gap:6},children:[Y.jsxs("select",{style:{width:"100%"},value:sl,onChange:O=>Wi(O.target.value),children:[Y.jsx("option",{value:"__all__",children:"All buildings"}),md.map(O=>Y.jsx("option",{value:O.name,children:O.name},O.name))]}),Y.jsx("input",{className:"mf-input",style:{width:"100%"},placeholder:"Filter department (optional)",value:Jl,onChange:O=>Lu(O.target.value)}),Y.jsxs("select",{style:{width:"100%"},value:Eo,onChange:O=>fu(O.target.value),children:[Y.jsx("option",{value:"rooms",children:"Room rows"}),Y.jsx("option",{value:"summary",children:"Building summary"})]}),Y.jsx("button",{className:"btn",style:{width:"100%"},onClick:()=>id(),disabled:Ea,children:Ea?"Exporting...":Eo==="summary"?"Export Summary CSV":"Export Space CSV"}),t==="admin"&&Y.jsx("button",{className:"btn",style:{width:"100%"},onClick:wt,disabled:Dr,children:Dr?"Refreshing Airtable...":"Refresh Airtable Data"})]}),Y.jsx("div",{style:{fontSize:11,color:"#555",marginTop:2,minHeight:0},children:Xa||(Eo==="summary"?"Summary export adds a campus total (when exporting all buildings) plus one row per building.":"")}),t==="admin"&&yi&&Y.jsx("div",{style:{fontSize:11,color:"#555",marginTop:2},children:yi}),t==="admin"&&Y.jsxs("div",{style:{fontSize:11,color:"#555",marginTop:2},children:["Last synced: ",xo?xo.toLocaleString([],{hour:"2-digit",minute:"2-digit",month:"short",day:"numeric"}):"Not yet"]})]}),!c&&Y.jsxs("div",{style:{marginTop:4,padding:6,borderRadius:8,border:"1px solid rgba(0,0,0,0.25)",background:"linear-gradient(180deg, rgba(240,246,255,0.94), rgba(228,238,255,0.94))",boxShadow:"0 2px 6px rgba(0,0,0,0.05)"},children:[Y.jsx("style",{children:"@keyframes aiSparklePulse { 0% { transform: translateY(0); } 50% { transform: translateY(-1px); } 100% { transform: translateY(0); } }"}),Y.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:10},children:[Y.jsxs("div",{children:[Y.jsxs("div",{style:{fontWeight:800,letterSpacing:.2,display:"flex",alignItems:"center",gap:6,flexWrap:"nowrap"},children:[Y.jsx("span",{style:{color:"#c62828",fontFamily:"'Trebuchet MS', 'Gill Sans', 'Helvetica Neue', Arial, sans-serif",fontWeight:700},children:"MAPFLUENCE"}),Y.jsx("span",{children:"AI"}),Y.jsx("span",{title:"AI-generated summaries based on currently loaded space data.",style:{display:"inline-flex",alignItems:"center",marginLeft:"auto",padding:"2px 6px",borderRadius:999,fontSize:10,fontWeight:700,border:"1px solid rgba(0,0,0,0.15)",background:"rgba(255,255,255,0.9)",animation:Mo?"aiSparklePulse 2.8s ease-in-out infinite":"none"},children:" AI Summary"})]}),Y.jsxs("div",{style:{marginTop:4,fontSize:11,opacity:.8,display:"flex",alignItems:"center",justifyContent:"space-between",gap:6},children:[Y.jsx("span",{children:"Summaries from loaded space data"}),Y.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:4},children:[Y.jsx("span",{style:{fontSize:10,padding:"2px 6px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:Mo?"rgba(0,255,0,0.10)":ca?"rgba(255,193,7,0.18)":"rgba(255,0,0,0.08)"},title:Mo?"AI server available":ca?"Checking AI status":"AI server not reachable",children:Mo?"Online":ca?"Checking":"Unavailable"}),Y.jsx("button",{onClick:()=>so(!0),title:"What Mapfluence AI is doing",style:{border:"1px solid rgba(0,0,0,0.15)",borderRadius:999,background:"white",width:18,height:18,display:"inline-flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:10},"aria-label":"What Mapfluence AI is doing",children:"?"})]})]})]}),Y.jsxs("div",{style:{display:"none",alignItems:"center",gap:6,marginTop:10},children:[Y.jsx("span",{style:{fontSize:10,padding:"2px 6px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:Mo?"rgba(0,255,0,0.10)":ca?"rgba(255,193,7,0.18)":"rgba(255,0,0,0.08)"},title:Mo?"AI server available":ca?"Checking AI status":"AI server not reachable",children:Mo?"Online":ca?"Checking":"Unavailable"}),Y.jsx("button",{onClick:()=>so(!0),title:"What Mapfluence AI is doing",style:{border:"1px solid rgba(0,0,0,0.15)",borderRadius:999,background:"white",width:20,height:20,display:"inline-flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:11,marginTop:2},"aria-label":"What Mapfluence AI is doing",children:"i"})]})]}),Y.jsxs("div",{style:{display:"grid",gap:6,marginTop:6},children:[Y.jsx("button",{style:{padding:"5px 7px",fontSize:11},disabled:zi||!Gn||sa,onClick:qa,children:sa?"Explaining...":" Explain this floor"}),Y.jsx("button",{style:{padding:"5px 7px",fontSize:11},disabled:zi||!Vt||al,onClick:hs,children:al?"Explaining...":" Explain this building"}),Y.jsx("button",{style:{padding:"5px 7px",fontSize:11},disabled:zi||!Mr||Mi,onClick:ns,children:Mi?"Explaining...":" Explain campus"})]}),Y.jsx("div",{style:{marginTop:6,display:"grid",gap:4},children:Y.jsx("button",{style:{padding:"5px 7px",fontSize:11},onClick:()=>Ho(!0),children:" Ask Mapfluence"})}),t==="admin"&&Y.jsx("div",{style:{marginTop:6},children:Y.jsx("button",{disabled:zi,onClick:()=>Zo(!0),style:{width:"100%",padding:"5px 7px",fontSize:11},children:" Create move scenario"})}),Y.jsx("div",{style:{marginTop:10,fontSize:11,opacity:.75,lineHeight:1.35},children:"Results are descriptive and do not modify project data."}),Xo||tr||Gi?Y.jsx("div",{style:{marginTop:8,color:"crimson",fontSize:12},children:Xo||tr||Gi}):null]})]})}),t==="admin"&&mt&&!xe&&Y.jsxs("div",{style:{position:"absolute",left:20,bottom:20,width:270,borderRadius:8,border:"1px solid rgba(0,0,0,0.25)",background:"linear-gradient(180deg, rgba(245,245,245,0.96), rgba(230,230,230,0.96))",padding:8,boxShadow:"0 2px 6px rgba(0,0,0,0.05)"},children:[Y.jsx("h4",{style:{margin:"0 0 6px 0",fontSize:12.5},children:"Data Filters"}),Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:8},children:[Y.jsx("button",{className:"btn",onClick:Il,children:"Export Map Data"}),Y.jsx("button",{className:"btn",onClick:Fd,children:"Clear Conditions"})]})]}),c&&cn&&!xe&&Y.jsxs("div",{className:"help-panel",style:{right:20,bottom:20},children:[Y.jsx("button",{className:"close-button","aria-label":"Close help",onClick:()=>gn(!1),children:""}),Y.jsx("h4",{children:"How to Use This Map"}),Y.jsxs("ul",{children:[Y.jsx("li",{children:"Click anywhere on the map to add a marker."}),Y.jsx("li",{children:"Select a marker type and add an optional comment."}),Y.jsx("li",{children:"Markers are saved to the engagement demo dataset."})]}),Y.jsx("button",{className:"close-button-main",onClick:()=>gn(!1),children:"Close"})]}),!c&&Ol&&Uo&&Y.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e4,background:"rgba(0,0,0,0.35)"},children:Y.jsxs("div",{ref:M,className:"mf-room-edit-panel",style:{position:"absolute",left:wc?wc.x:"50%",top:wc?wc.y:"50%",transform:wc?"none":"translate(-50%, -50%)",width:520,maxWidth:"90vw",background:"#fff",borderRadius:14,padding:16,boxShadow:"0 18px 36px rgba(0,0,0,0.2)"},children:[Y.jsx("div",{style:{display:"flex",alignItems:"center",marginBottom:12},...vg,children:Y.jsx("h4",{style:{margin:0},children:No.length>1?`Edit ${No.length} Rooms`:`Edit Room ${Uo.feature?.properties?.name||Uo.roomLabel||""}`})}),No.length>1&&Y.jsxs("div",{style:{marginBottom:12},children:[Y.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"Selected Rooms"}),Y.jsx("div",{style:{maxHeight:180,overflow:"auto",border:"1px solid #e5e5e5",borderRadius:6},children:Y.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[Y.jsx("thead",{style:{background:"#f9f9f9",position:"sticky",top:0},children:Y.jsxs("tr",{children:[Y.jsx("th",{style:{padding:"6px 8px",width:40,textAlign:"center"},children:Y.jsx("input",{type:"checkbox",checked:ga.size===No.length,onChange:O=>{const de=O.target.checked?new Set(No.map(Te=>Te.roomId||String(Te.revitId??""))):new Set;gl(de)}})}),Y.jsx("th",{style:{padding:"6px 8px",textAlign:"left"},children:"Room"}),Y.jsx("th",{style:{padding:"6px 8px",textAlign:"right"},children:"Area (SF)"}),Y.jsx("th",{style:{padding:"6px 8px",textAlign:"left"},children:"Department"}),Y.jsx("th",{style:{padding:"6px 8px",textAlign:"left"},children:"Room Type Description"})]})}),Y.jsx("tbody",{children:No.map(O=>{const de=O.roomId||String(O.revitId??""),Te=ga.has(de),Me=Number.isFinite(O.properties?.area)?Math.round(O.properties.area):"";return Y.jsxs("tr",{style:{borderTop:"1px solid #f0f0f0"},children:[Y.jsx("td",{style:{padding:"6px 8px",textAlign:"center"},children:Y.jsx("input",{type:"checkbox",checked:Te,onChange:tt=>{gl(ze=>{const Ke=new Set(ze||[]);return tt.target.checked?Ke.add(de):Ke.delete(de),Ke})}})}),Y.jsx("td",{style:{padding:"6px 8px",fontWeight:600},children:O.roomLabel||O.feature?.properties?.name||de}),Y.jsx("td",{style:{padding:"6px 8px",textAlign:"right",whiteSpace:"nowrap"},children:Me?Me.toLocaleString():""}),Y.jsx("td",{style:{padding:"6px 8px"},children:O.properties?.department||O.feature?.properties?.department||""}),Y.jsx("td",{style:{padding:"6px 8px"},children:O.properties?.type||O.feature?.properties?.type||""})]},de)})})]})})]}),Y.jsx(OA,{label:"Room Type",value:Uo.properties?.type??Uo.feature?.properties?.type??"",onChange:O=>Ia(de=>de&&{...de,properties:{...de.properties,type:O}}),options:ro,placeholder:"Search or choose a type..."}),Y.jsx(OA,{label:"Department",value:Uo.properties?.department??Uo.feature?.properties?.department??"",onChange:O=>Ia(de=>de&&{...de,properties:{...de.properties,department:O}}),options:io,placeholder:"Search or choose a department..."}),Uc&&Y.jsxs("div",{className:"mf-form-row",children:[Y.jsx("label",{children:"Occupant"}),Y.jsx("input",{className:"mf-input",type:"text",value:Uo.properties?.occupant??"",onChange:O=>Ia(de=>de&&{...de,properties:{...de.properties,occupant:O.target.value}}),placeholder:"(optional)"})]}),Y.jsxs("div",{className:"mf-form-row",children:[Y.jsx("label",{children:"Area (SF)"}),Y.jsx("input",{className:"mf-input",value:Uo.properties?.area??"",disabled:!0,readOnly:!0})]}),Mu&&Y.jsxs("div",{className:"mf-form-row",children:[Y.jsx("label",{children:"Seat Count"}),Y.jsx("input",{className:"mf-input",type:"number",min:"0",value:La==="__MIXED__"?"":La,placeholder:rc&&La==="__MIXED__"?"varies":"",onChange:O=>{const de=O.target.value;Ia(Te=>Te&&{...Te,properties:{...Te.properties,seatCount:de}})}})]}),Uc&&Y.jsxs("div",{className:"mf-form-row",children:[Y.jsx("label",{children:"Occupancy Status"}),Y.jsxs("select",{className:"mf-input",value:jh==="__MIXED__"?"":jh,onChange:O=>{const de=O.target.value;Ia(Te=>Te&&{...Te,properties:{...Te.properties,occupancyStatus:de||(rc?null:"")}})},children:[rc&&jh==="__MIXED__"?Y.jsx("option",{value:"",children:"-- Mixed --"}):Y.jsx("option",{value:"",children:"--"}),Ca.map(O=>Y.jsx("option",{value:O,children:O},O))]})]}),Y.jsxs("div",{className:"mf-form-row",children:[Y.jsx("label",{children:"Comments"}),Y.jsx("textarea",{className:"mf-input",rows:3,value:Uo.properties?.comments??"",onChange:O=>Ia(de=>de&&{...de,properties:{...de.properties,comments:O.target.value}})})]}),Y.jsxs("div",{className:"mf-actions",children:[Y.jsx("button",{className:"btn",onClick:ks,children:"Cancel"}),Y.jsx("button",{className:"btn",onClick:async()=>{const O=ga,de=No.length?No.filter(gt=>O.has(gt.roomId||String(gt.revitId??""))):[];if(!de.length)return;let Te=0;const Me=de.length>1,tt=Uo.properties||{},ze=_.current,Ke=Wu(ze,ma),At=Ke&&(Ke._data||Ke.serialize?.().data)||null,kt=At?Au(At)?.features||[]:[];for(const gt of de){const $t={type:gt.properties?.type??gt.feature?.properties?.type??"",department:gt.properties?.department??gt.feature?.properties?.department??"",occupant:gt.properties?.occupant??gt.feature?.properties?.occupant??"",occupancyStatus:gt.properties?.occupancyStatus??gt.feature?.properties?.occupancyStatus??gt.properties?.["Occupancy Status"]??gt.feature?.properties?.["Occupancy Status"]??gt.properties?.OccupancyStatus??gt.feature?.properties?.OccupancyStatus??"",comments:gt.properties?.comments??gt.feature?.properties?.comments??"",seatCount:e5({...gt.feature?.properties||{},...gt.properties||{}})},An=tt.occupancyStatus!=null&&String(tt.occupancyStatus).trim()!==""?tt.occupancyStatus:$t.occupancyStatus,yn=Uc?Me?tt.occupant!=null&&String(tt.occupant).trim()!==""?tt.occupant:$t.occupant:tt.occupant??$t.occupant:void 0,Kt=Mu?tt.seatCount!=null?tt.seatCount:$t.seatCount:void 0,rn={...gt.properties,...tt,type:tt.type!=null&&String(tt.type).trim()!==""?tt.type:$t.type,department:tt.department!=null&&String(tt.department).trim()!==""?tt.department:$t.department,...Uc?{occupancyStatus:An,occupant:yn}:{},...Mu?{seatCount:Kt}:{}};if(Uc&&(rn.OccupancyStatus=An,rn["Occupancy Status"]=An),await vt({roomId:gt.roomId,buildingId:gt.buildingId,buildingName:gt.buildingName,floorName:gt.floorName,revitId:gt.revitId,roomLabel:gt.roomLabel,roomNumber:gt.roomNumber,properties:rn})&&(Te+=1,kt.length)){const yr=gt.revitId??gt.feature?.id??gt.feature?.properties?.RevitId??null;if(yr!=null){const On=kt.find(gr=>(gr.id??gr.properties?.RevitId)===yr);On&&On.properties&&(On.properties.department=rn.department??On.properties.department,On.properties.department=On.properties.department||rn.department||"",On.properties.Department=On.properties.department,On.properties.type=rn.type??On.properties.type,On.properties.Type=On.properties.type,On.properties.RoomType=On.properties.type,Uc&&(On.properties.Occupant=rn.occupant??On.properties.Occupant,On.properties.occupant=On.properties.Occupant,On.properties.occupancyStatus=rn.occupancyStatus??On.properties.occupancyStatus,On.properties.OccupancyStatus=rn.OccupancyStatus??On.properties.OccupancyStatus,On.properties["Occupancy Status"]=rn["Occupancy Status"]??On.properties["Occupancy Status"]),Mu&&(On.properties.SeatCount=rn.seatCount??On.properties.SeatCount,On.properties["Seat Count"]=rn.seatCount??On.properties["Seat Count"],On.properties.seatCount=rn.seatCount??On.properties.seatCount))}}}if(Te>0){try{if(Ke&&kt.length){const gt=Au(At)||{type:"FeatureCollection",features:[]};gt.features=kt,Ke.setData(gt)}}catch{}Uo.refreshPopup?.(),Bl(),ks()}},children:No.length>1?`Save ${No.length} Rooms`:"Save"})]})]})}),Ql&&xi&&Y.jsx("div",{style:{position:"fixed",inset:0,zIndex:10001,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Y.jsxs("div",{className:"mf-ai-modal-panel",style:{width:"min(760px, 92vw)",padding:16},children:[Y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,alignItems:"center"},children:[Y.jsxs("div",{children:[Y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[Y.jsx("div",{style:{fontWeight:700,fontSize:16},children:xi.title&&xi.title.includes("Summary")?xi.title:`${xi.title||"Level"} - Summary`}),Y.jsx("span",{title:"AI-generated summary based on currently loaded space data.",style:{fontSize:11,padding:"2px 8px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:"#f7f7ff"},children:" AI Summary"})]}),Y.jsx("div",{style:{fontSize:12,color:"#555",marginTop:2},children:"AI-assisted overview"})]}),Y.jsx("button",{className:"btn",onClick:()=>Aa(!1),children:"Close"})]}),Y.jsxs("div",{style:{marginTop:10,lineHeight:1.45},children:[xi.summary?Y.jsx("p",{style:{margin:"6px 0 10px 0"},children:xi.summary}):null,Y.jsxs("div",{children:[Y.jsx("h4",{style:{margin:"8px 0 4px 0"},children:"Insights"}),Y.jsx("ul",{style:{margin:"0 0 10px 18px",padding:0},children:(xi.insights||[]).map((O,de)=>Y.jsx("li",{children:O},de))})]}),Array.isArray(xi.watchouts)&&xi.watchouts.length?Y.jsxs("div",{children:[Y.jsx("h4",{style:{margin:"8px 0 4px 0"},children:"Watchouts"}),Y.jsx("ul",{style:{margin:"0 0 10px 18px",padding:0},children:xi.watchouts.map((O,de)=>Y.jsx("li",{children:O},de))})]}):null,Array.isArray(xi.data_used)&&xi.data_used.length?Y.jsxs("small",{style:{color:"#555"},children:["Data used: ",xi.data_used.join(", ")]}):null,Y.jsx("div",{style:{marginTop:12,fontSize:11,color:"#666"},children:"AI summaries reflect available data at the time of generation."})]})]})}),Za&&Nr&&Y.jsx("div",{style:{position:"fixed",inset:0,zIndex:10001,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Y.jsxs("div",{className:"mf-ai-modal-panel",style:{width:"min(760px, 92vw)",padding:16},children:[Y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,alignItems:"center"},children:[Y.jsxs("div",{children:[Y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[Y.jsx("div",{style:{fontWeight:700,fontSize:16},children:Nr.title&&Nr.title.includes("Summary")?Nr.title:`${Nr.title||"Building"} - Summary`}),Y.jsx("span",{title:"AI-generated summary based on currently loaded space data.",style:{fontSize:11,padding:"2px 8px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:"#f7f7ff"},children:" AI Summary"})]}),Y.jsx("div",{style:{fontSize:12,color:"#555",marginTop:2},children:"AI-assisted overview"})]}),Y.jsx("button",{className:"btn",onClick:()=>Ya(!1),children:"Close"})]}),Y.jsxs("div",{style:{marginTop:10,lineHeight:1.45},children:[Nr.summary?Y.jsx("p",{style:{margin:"6px 0 10px 0"},children:Nr.summary}):null,Y.jsxs("div",{children:[Y.jsx("h4",{style:{margin:"8px 0 4px 0"},children:"Insights"}),Y.jsx("ul",{style:{margin:"0 0 10px 18px",padding:0},children:(Nr.insights||[]).map((O,de)=>Y.jsx("li",{children:O},de))})]}),Array.isArray(Nr.watchouts)&&Nr.watchouts.length?Y.jsxs("div",{children:[Y.jsx("h4",{style:{margin:"8px 0 4px 0"},children:"Watchouts"}),Y.jsx("ul",{style:{margin:"0 0 10px 18px",padding:0},children:Nr.watchouts.map((O,de)=>Y.jsx("li",{children:O},de))})]}):null,Array.isArray(Nr.data_used)&&Nr.data_used.length?Y.jsxs("small",{style:{color:"#555"},children:["Data used: ",Nr.data_used.join(", ")]}):null,Y.jsx("div",{style:{marginTop:12,fontSize:11,color:"#666"},children:"AI summaries reflect available data at the time of generation."})]})]})}),Ta&&Ui&&Y.jsx("div",{style:{position:"fixed",inset:0,zIndex:10001,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Y.jsxs("div",{className:"mf-ai-modal-panel",style:{width:"min(760px, 92vw)",padding:16},children:[Y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,alignItems:"center"},children:[Y.jsxs("div",{children:[Y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[Y.jsx("div",{style:{fontWeight:700,fontSize:16},children:Ui.title&&Ui.title.includes("Summary")?Ui.title:`${Ui.title||be} - Summary`}),Y.jsx("span",{title:"AI-generated summary based on currently loaded space data.",style:{fontSize:11,padding:"2px 8px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:"#f7f7ff"},children:" AI Summary"})]}),Y.jsx("div",{style:{fontSize:12,color:"#555",marginTop:2},children:"AI-assisted overview"})]}),Y.jsx("button",{className:"btn",onClick:()=>bi(!1),children:"Close"})]}),Y.jsxs("div",{style:{marginTop:10,lineHeight:1.45},children:[Ui.summary?Y.jsx("p",{style:{margin:"6px 0 10px 0"},children:Ui.summary}):null,Y.jsxs("div",{children:[Y.jsx("h4",{style:{margin:"8px 0 4px 0"},children:"Insights"}),Y.jsx("ul",{style:{margin:"0 0 10px 18px",padding:0},children:(Ui.insights||[]).map((O,de)=>Y.jsx("li",{children:O},de))})]}),Array.isArray(Ui.watchouts)&&Ui.watchouts.length?Y.jsxs("div",{children:[Y.jsx("h4",{style:{margin:"8px 0 4px 0"},children:"Watchouts"}),Y.jsx("ul",{style:{margin:"0 0 10px 18px",padding:0},children:Ui.watchouts.map((O,de)=>Y.jsx("li",{children:O},de))})]}):null,Array.isArray(Ui.data_used)&&Ui.data_used.length?Y.jsxs("small",{style:{color:"#555"},children:["Data used: ",Ui.data_used.join(", ")]}):null,Y.jsx("div",{style:{marginTop:12,fontSize:11,color:"#666"},children:"AI summaries reflect available data at the time of generation."})]})]})}),ec&&Vi&&(()=>{const O=($t={})=>{let en=0,An=0,yn=0;for(const[Kt,rn]of Object.entries($t||{})){const $n=String(Kt||"").toLowerCase(),yr=Number(rn||0)||0;$n.includes("office")?en+=yr:$n.includes("class")?An+=yr:$n.includes("lab")&&(yn+=yr)}return{offices:en,classrooms:An,labs:yn}},de=Xt||{},Te=lo||{},Me=Vi?.scenarioDept||Ni||"Selected Dept",tt=Xt?.__label||"baseline",ze=li,Ke=`Baseline (${Me} in ${tt})`,At=`Scenario (${Me} to ${ze})`,kt=O(de.roomTypes),gt=O(Te.roomTypes);return Y.jsx("div",{style:{position:"fixed",inset:0,zIndex:10006,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Y.jsxs("div",{ref:ch,className:"mf-ai-modal-panel",style:{position:"fixed",left:lh?lh.x:"50%",top:lh?lh.y:"50%",transform:lh?"none":"translate(-50%, -50%)",width:"min(760px, 92vw)",padding:16,maxHeight:"90vh",overflow:"auto"},children:[Y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,alignItems:"center"},children:[Y.jsx("div",{...vm,style:{fontWeight:700},children:`${Ni||"Scenario"} - ${Xt?.__label||"baseline"} to ${li}${qn?` (${qn})`:""}`}),Y.jsxs("div",{style:{display:"flex",gap:8},children:[Y.jsx("button",{className:"btn",onClick:Je,children:"Export Scenario (PDF)"}),Y.jsx("button",{className:"btn",onClick:()=>nu(!1),children:"Close"})]})]}),Y.jsx("p",{style:{marginTop:10},children:Vi.summary}),Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(160px, 1fr))",gap:10,marginBottom:10},children:[Y.jsxs("div",{style:{border:"1px solid #e0e0e0",borderRadius:8,padding:10},children:[Y.jsx("div",{style:{fontWeight:700,marginBottom:4},children:Ke}),Y.jsxs("div",{style:{fontSize:13},children:["SF: ",Math.round(Xt?.totalSF||0).toLocaleString()]}),Y.jsxs("div",{style:{fontSize:13},children:["Rooms: ",Math.round(Xt?.rooms||0).toLocaleString()]}),kt.offices||kt.classrooms||kt.labs?Y.jsxs(Y.Fragment,{children:[Y.jsxs("div",{style:{fontSize:13},children:["Offices: ",kt.offices]}),Y.jsxs("div",{style:{fontSize:13},children:["Classrooms: ",kt.classrooms]}),Y.jsxs("div",{style:{fontSize:13},children:["Labs: ",kt.labs]})]}):null]}),Y.jsxs("div",{style:{border:"1px solid #e0e0e0",borderRadius:8,padding:10},children:[Y.jsx("div",{style:{fontWeight:700,marginBottom:4},children:At}),Y.jsxs("div",{style:{fontSize:13},children:["SF: ",Math.round(lo?.totalSF||0).toLocaleString()]}),Y.jsxs("div",{style:{fontSize:13},children:["Rooms: ",Math.round(lo?.rooms||0).toLocaleString()]}),gt.offices||gt.classrooms||gt.labs?Y.jsxs(Y.Fragment,{children:[Y.jsxs("div",{style:{fontSize:13},children:["Offices: ",gt.offices]}),Y.jsxs("div",{style:{fontSize:13},children:["Classrooms: ",gt.classrooms]}),Y.jsxs("div",{style:{fontSize:13},children:["Labs: ",gt.labs]})]}):null]})]}),Y.jsx("b",{children:`Scenario - ${Vi?.scenarioDept||Ni||"Selected Dept"}`}),Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginTop:8},children:[Y.jsxs("div",{style:{border:"1px solid #e0e0e0",borderRadius:8,padding:10},children:[Y.jsx("div",{style:{fontWeight:700,marginBottom:6},children:"Pluses"}),Y.jsx("ul",{style:{margin:0,paddingLeft:18},children:(Vi?.scenarioPros||[]).map(($t,en)=>Y.jsx("li",{children:$t},en))})]}),Y.jsxs("div",{style:{border:"1px solid #e0e0e0",borderRadius:8,padding:10},children:[Y.jsx("div",{style:{fontWeight:700,marginBottom:6},children:"Minuses"}),Y.jsx("ul",{style:{margin:0,paddingLeft:18},children:(Vi?.scenarioCons||[]).map(($t,en)=>Y.jsx("li",{children:$t},en))})]})]}),Vi.risks?.length?Y.jsxs(Y.Fragment,{children:[Y.jsx("b",{children:"Risks / watchouts"}),Y.jsx("ul",{children:Vi.risks.map(($t,en)=>Y.jsx("li",{children:$t},en))})]}):null,Vi.notes?.length?Y.jsxs(Y.Fragment,{children:[Y.jsx("b",{children:"Notes"}),Y.jsx("ul",{children:Vi.notes.map(($t,en)=>Y.jsx("li",{children:$t},en))})]}):null]})})})(),ai&&Y.jsx("div",{style:{position:"fixed",inset:0,zIndex:10002,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Y.jsxs("div",{className:"mf-ai-modal-panel",style:{width:"min(560px, 92vw)",padding:16,lineHeight:1.4},children:[Y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[Y.jsxs("div",{children:[Y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[Y.jsx("div",{style:{fontWeight:700,fontSize:16},children:"Create move scenario (AI)"}),Y.jsx("span",{title:"AI-generated scenario plan based on currently loaded space data.",style:{fontSize:11,padding:"2px 8px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:"#f7f7ff"},children:" AI"})]}),Y.jsx("div",{style:{fontSize:12,color:"#555"},children:"Uses campus-wide room inventory to suggest candidates."})]}),Y.jsx("button",{className:"btn",onClick:()=>Zo(!1),children:"Close"})]}),Y.jsxs("div",{style:{marginTop:10},children:[Y.jsx("label",{style:{fontWeight:600,fontSize:12},children:"Request"}),Y.jsx("textarea",{value:Ao,onChange:O=>Ih(O.target.value),rows:3,placeholder:"e.g. Find a new home for Physics; move the Art department to the Gray Center.",style:{width:"100%",resize:"vertical",padding:8,borderRadius:8,border:"1px solid #d0d0d0",marginTop:4}})]}),Us?Y.jsx("div",{style:{color:"crimson",marginTop:6,fontSize:12},children:Us}):null,Y.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,marginTop:10},children:[Y.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,fontSize:12,color:"#444"},children:[Y.jsx("input",{type:"checkbox",checked:Dl,onChange:O=>Oa(O.target.checked)}),"Strict fit (5% target)"]}),Y.jsx("button",{className:"btn",disabled:Pu||!Ao.trim()||zi,onClick:Ys,children:Pu?"Planning...":"Create move scenario"})]})]})}),Go&&Y.jsx("div",{style:{position:"fixed",inset:0,zIndex:10004,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Y.jsxs("div",{ref:Vu,className:"mf-ai-modal-panel",style:{position:"fixed",left:kh?kh.x:"50%",top:kh?kh.y:"50%",transform:kh?"none":"translate(-50%, -50%)",width:"min(760px, 92vw)",padding:12,lineHeight:1.35,fontSize:12,maxHeight:"90vh",overflow:"auto"},children:[Y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,alignItems:"center"},children:[Y.jsxs("div",{children:[Y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},...Rh,children:[Y.jsx("div",{style:{fontWeight:700,fontSize:16},children:Go.title||"Move scenario plan"}),Y.jsx("span",{title:"AI-generated scenario plan based on currently loaded space data.",style:{fontSize:11,padding:"2px 8px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:"#f7f7ff"},children:" AI"})]}),Go.interpretedIntent?Y.jsx("div",{style:{fontSize:12,color:"#555"},children:Go.interpretedIntent}):null]}),Y.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[Y.jsx("button",{className:"btn",onClick:()=>qh(Go),children:"Add to Scenario Comparison"}),Y.jsx("button",{className:"btn",onClick:()=>vo(null),children:"Close"})]})]}),Go.selectionCriteria?.filter(O=>!/vacan/i.test(O||"")).length?Y.jsxs("div",{style:{marginTop:10},children:[Y.jsx("b",{children:"Selection criteria"}),Y.jsx("ul",{style:{margin:"6px 0 10px 18px",padding:0},children:Go.selectionCriteria.filter(O=>!/vacan/i.test(O||"")).map((O,de)=>Y.jsx("li",{children:O},de))})]}):null,Y.jsxs("div",{style:{marginTop:10},children:[Y.jsx("b",{children:"Recommended candidates"}),Go.recommendedCandidates?.length?Y.jsxs("div",{style:{marginTop:6,border:"1px solid #e0e0e0",borderRadius:8,overflow:"hidden"},children:[Y.jsx("div",{style:{display:"flex",justifyContent:"flex-end",padding:"6px 8px",background:"#f8f9fb"},children:Y.jsx("button",{className:"btn",onClick:Lc,children:"Select these rooms in Move Scenario"})}),Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 3fr",background:"#f8f9fb",padding:"6px 8px",fontWeight:600,fontSize:12},children:[Y.jsx("div",{children:"Location"}),Y.jsx("div",{children:"Room"}),Y.jsx("div",{style:{textAlign:"right"},children:"SF"}),Y.jsx("div",{style:{textAlign:"right"},children:"Match / Notes"}),Y.jsx("div",{children:"Rationale"})]}),Y.jsx("div",{children:Go.recommendedCandidates.map((O,de)=>Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 3fr",padding:"6px 8px",borderTop:"1px solid #f0f0f0",fontSize:12},children:[Y.jsxs("div",{children:[Y.jsx("div",{style:{fontWeight:600},children:O.buildingLabel||"Building"}),Y.jsx("div",{style:{opacity:.75},children:O.floorId||""})]}),Y.jsxs("div",{children:[Y.jsx("div",{style:{fontWeight:600},children:O.roomLabel||"Room"}),Y.jsx("div",{style:{opacity:.75},children:O.type||"Unspecified"})]}),Y.jsx("div",{style:{textAlign:"right"},children:Math.round(Number(O.sf||0)).toLocaleString()}),Y.jsx("div",{style:{textAlign:"right"},children:(()=>{const Te=String(O.occupant||"").trim(),Me=String(O.occupantDept||O.department||"").trim();return Te?` Occupied  requires relocation${Me?` of ${Me}`:""}`:""})()}),Y.jsx("div",{children:a5(O.rationale)||""})]},O.id||de))})]}):Y.jsx("div",{style:{marginTop:6,fontSize:12,color:"#666"},children:"No candidates returned."})]}),Go.assumptions?.length?Y.jsxs("div",{style:{marginTop:10},children:[Y.jsx("b",{children:"Assumptions"}),Y.jsx("ul",{style:{margin:"6px 0 10px 18px",padding:0},children:Go.assumptions.map((O,de)=>Y.jsx("li",{children:O},de))})]}):null,Go.nextSteps?.length?Y.jsxs("div",{style:{marginTop:10},children:[Y.jsx("b",{children:"Next steps"}),Y.jsx("ul",{style:{margin:"6px 0 10px 18px",padding:0},children:Go.nextSteps.map((O,de)=>Y.jsx("li",{children:O},de))})]}):null]})}),ar&&Y.jsx("div",{style:{position:"fixed",inset:0,zIndex:10002,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Y.jsxs("div",{style:{width:"min(520px, 92vw)",background:"#fff",borderRadius:12,padding:16,boxShadow:"0 22px 44px rgba(0,0,0,0.25)",lineHeight:1.5,fontSize:13},children:[Y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[Y.jsx("div",{style:{fontWeight:700,fontSize:16},children:"What Mapfluence AI is doing"}),Y.jsx("button",{className:"btn",onClick:()=>so(!1),children:"Close"})]}),Y.jsxs("div",{style:{marginTop:10},children:[Y.jsx("div",{style:{fontWeight:600,marginBottom:4},children:"What Mapfluence AI is doing"}),Y.jsxs("ul",{style:{paddingLeft:18,margin:"0 0 10px 0"},children:[Y.jsx("li",{children:"Generates summaries and comparisons from the statistics currently loaded in this session."}),Y.jsx("li",{children:"Can reference the Hastings Master Facilities Plan for narrative/context questions when document support is enabled."}),Y.jsx("li",{children:"Uses your selected scope (campus / building / floor) and scenario totals when available."}),Y.jsx("li",{children:"Produces descriptive output and does not modify project data."})]}),Y.jsx("div",{style:{fontWeight:600,marginBottom:4},children:"What Mapfluence AI is not doing"}),Y.jsxs("ul",{style:{paddingLeft:18,margin:0},children:[Y.jsx("li",{children:"Not writing to the database automatically."}),Y.jsx("li",{children:"Not making final planning decisions."}),Y.jsx("li",{children:"Not inventing missing data; it will note what's unavailable."})]})]})]})}),ct&&Y.jsx("div",{style:{position:"fixed",inset:0,zIndex:10001,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Y.jsxs("div",{style:{width:480,maxWidth:"90vw",background:"#fff",borderRadius:14,padding:18,boxShadow:"0 22px 44px rgba(0,0,0,0.25)"},children:[Y.jsx("h4",{style:{margin:"0 0 10px 0"},children:"Confirm Move"}),Y.jsx("div",{style:{fontSize:13,color:"#333",marginBottom:10},children:`Move ${ct.person||ct.from?.occupantName||"-"} from ${ct.from?.buildingId||""} ${ct.from?.roomLabel||"-"} to ${ct.to?.buildingId||""} ${ct.to?.roomLabel||"-"}.`}),Y.jsxs("div",{className:"mf-form-row",children:[Y.jsx("label",{children:"Person"}),Y.jsx("input",{className:"mf-input",value:ct.person||"",onChange:O=>Ft(de=>de&&{...de,person:O.target.value})})]}),Y.jsxs("div",{className:"mf-form-row",children:[Y.jsx("label",{children:"Effective Date"}),Y.jsx("input",{className:"mf-input",type:"date",value:ct.effectiveDate||"",onChange:O=>Ft(de=>de&&{...de,effectiveDate:O.target.value})})]}),Y.jsxs("div",{className:"mf-form-row",children:[Y.jsx("label",{children:"Comments"}),Y.jsx("textarea",{className:"mf-input",rows:3,value:ct.comments||"",onChange:O=>Ft(de=>de&&{...de,comments:O.target.value})})]}),Y.jsxs("div",{className:"mf-actions",style:{marginTop:12,display:"flex",gap:8,justifyContent:"flex-end"},children:[Y.jsx("button",{className:"btn",onClick:hc,children:"Cancel"}),Y.jsx("button",{className:"btn",onClick:bg,children:"Confirm move"})]})]})})]})},Xq=({config:n,universityId:e,persona:t,engagementMode:i=!1})=>Y.jsx(CC,{config:n,universityId:e,persona:t,engagementMode:i}),Zq=({config:n,universityId:e})=>Y.jsx("div",{className:"admin-page",style:{width:"100%",height:"100%"},children:Y.jsx(CC,{config:n,universityId:e,mode:"admin"})}),Yq=[{universityName:"Hastings College",enableDrawingEntry:!0,buildings:"Hastings_College_Buildings.geojson",boundary:"Hastings_College_Boundary.geojson",outdoorSpacesUrl:"geojson/HC_Outdoor_map.geojson",style:"mapbox://styles/mapbox/streets-v12",lng:-98.371164,lat:40.592958,zoom:15.8,pitch:39,bearing:0,logos:{clarkEnersen:"Clark_Enersen_Logo.png",university:"HC_image.png"}}],Jq="rockhurst",Qq="Rockhurst University",e$=!1,t$="mapbox://styles/mapbox/light-v10",n$=39.038,r$=-94.57,i$=16,o$=45,s$=-17.6,a$={universityId:Jq,universityName:Qq,enableDrawingEntry:e$,style:t$,lat:n$,lng:r$,zoom:i$,pitch:o$,bearing:s$},l$=`\uFEFF{"type":"FeatureCollection", "features": [\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37413233965788,40.590313487951285],[-98.37471259730057,40.59032045203848],[-98.37471509841112,40.5901317883289],[-98.3741348407684,40.590126090423354],[-98.37413233965788,40.590313487951285]]]},"properties":{"id":"Perkins Library"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.3736191179045,40.59064334156154],[-98.37362033072382,40.59056689953065],[-98.37387380996378,40.59057058348595],[-98.37387866124111,40.5903256000165],[-98.3736639922197,40.59032283703991],[-98.37366520503903,40.59030073322319],[-98.37333455263524,40.590296927283184],[-98.37333901987164,40.59001629518303],[-98.37333621176148,40.59001558437107],[-98.37294307634048,40.59001416274713],[-98.37294319965034,40.59029870430257],[-98.37297039172454,40.59029870430257],[-98.37297048222555,40.590645772706125],[-98.3736191179045,40.59064334156154]]]},"properties":{"id":"Kiewit Building"}},\r
{\r
  "type": "Feature",\r
  "geometry": {\r
    "type": "Polygon",\r
    "coordinates": [\r
      [\r
        [-98.374702, 40.590876],\r
        [-98.374710, 40.590479],\r
        [-98.374496, 40.590477],\r
        [-98.374487, 40.590874],\r
        [-98.374702, 40.590876]\r
      ]\r
    ]\r
  },\r
  "properties": {\r
    "id": "Hurley-McDonald Hall",\r
    "floorplans": [\r
      {\r
        "name": "Basement",\r
        "url": "/floorplans/hastings/Hurley_McDonald_Floor0.png",\r
        "bounds": [\r
          [-98.374714, 40.590887], \r
          [-98.374499, 40.590891], \r
          [-98.374507, 40.590498], \r
          [-98.374739, 40.590506]  \r
        ]\r
      },\r
      {\r
        "name": "First Floor",\r
        "url": "/floorplans/hastings/Hurley_McDonald_Floor1.png",\r
        "bounds": [\r
          [-98.374714, 40.590887],\r
          [-98.374499, 40.590891],\r
          [-98.374507, 40.590498],\r
          [-98.374739, 40.590506]\r
        ]\r
      },\r
      {\r
        "name": "Second Floor",\r
        "url": "/floorplans/hastings/HurleyMcDonald_Floor2.png",\r
        "bounds": [\r
          [-98.374714, 40.590887],\r
          [-98.374499, 40.590891],\r
          [-98.374507, 40.590498],\r
          [-98.374739, 40.590506]\r
        ]\r
      }\r
    ]\r
  }\r
},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37353314553962,40.59087905110178],[-98.37353314553962,40.590708779882675],[-98.37343235743603,40.590709639839424],[-98.37342896008421,40.59087905110178],[-98.37353314553962,40.59087905110178]]]},"properties":{"id":"Name1"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37382750296666,40.591193020762205],[-98.37382980649612,40.59115891068626],[-98.37386551120254,40.59115891068626],[-98.37387127002614,40.590980488467004],[-98.37383211002555,40.59097961384712],[-98.37382980649612,40.59094812752329],[-98.37358217708065,40.59094462904195],[-98.37357987355122,40.5911921461451],[-98.37382750296666,40.591193020762205]]]},"properties":{"id":"Daugherty Student Engagement Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37229446140842,40.59159148756918],[-98.37223367991126,40.591483310642786],[-98.37238183481058,40.59144580926746],[-98.37226027181626,40.59117752958438],[-98.37226217123805,40.59064529412409],[-98.37211591576053,40.59063952461079],[-98.3721178151823,40.59070587398362],[-98.372022844093,40.59070731636056],[-98.372022844093,40.590756357157964],[-98.37191647647298,40.590759241909645],[-98.3719107782076,40.59114002803756],[-98.37187278977188,40.591154451711894],[-98.37211211691694,40.59164773950174],[-98.37229446140842,40.59159148756918]]]},"properties":{"id":"Morrison-Reeves Science Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37336463965526,40.591802138119164],[-98.37337046026076,40.59172257877987],[-98.37363587987099,40.59172611475252],[-98.3736393722343,40.59156345981731],[-98.37337046026076,40.59155903984072],[-98.37337395262405,40.59147948021219],[-98.37323658633453,40.591475060230046],[-98.37323891457672,40.59155903984072],[-98.373206319186,40.59155815584537],[-98.37320748330708,40.591719042807036],[-98.37323891457672,40.591719042807036],[-98.37323658633453,40.59179860215054],[-98.37336463965526,40.591802138119164]]]},"properties":{"id":"Calvin H. French Memorial Chapel"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37201576628836,40.59262743658687],[-98.37201700980901,40.592578334337375],[-98.37203317557764,40.592578334337375],[-98.37204312374293,40.59206842423039],[-98.37202695797433,40.59206747994882],[-98.37202944501566,40.59201271159418],[-98.3719846782718,40.59201271159418],[-98.37198343475114,40.592025931545955],[-98.37195607729657,40.592026875828125],[-98.37195483377592,40.5920627585407],[-98.37188768366015,40.592063702822344],[-98.3718789790155,40.592578334337375],[-98.37194364208995,40.59257927861174],[-98.37194239856929,40.59260666256263],[-98.3719809477098,40.59260666256263],[-98.37197970418916,40.59262743658687],[-98.37201576628836,40.59262743658687]]]},"properties":{"id":"Altman Hall Residency"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37345908377378,40.592428311631785],[-98.37346414649254,40.592127677901516],[-98.37348540991137,40.592127677901516],[-98.37354717508036,40.59209077136578],[-98.37348844754263,40.59203771818496],[-98.3731381074038,40.59203694929797],[-98.3731340572288,40.592211486417455],[-98.37322214853538,40.59221379307237],[-98.3732170858166,40.592428311631785],[-98.37345908377378,40.592428311631785]]]},"properties":{"id":"Scott Studio Theatre"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37378031069133,40.59233336628362],[-98.37378112606382,40.592306742401384],[-98.37381863319813,40.59230736156156],[-98.37382271006055,40.592159382117295],[-98.37378520292624,40.59215876295575],[-98.37378520292624,40.59213151984219],[-98.37363680513397,40.59212966235677],[-98.37363680513397,40.59215133301679],[-98.37359522113724,40.59215133301679],[-98.37359032890232,40.59231107652247],[-98.37363272827155,40.59231107652247],[-98.37363354364403,40.59233336628362],[-98.37378031069133,40.59233336628362]]]},"properties":{"id":"McCormick Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37472106546831,40.59285396151976],[-98.3747264832459,40.59266057179469],[-98.3747658645213,40.59266160297934],[-98.37476450654628,40.59255229731774],[-98.37474549489609,40.59255126613141],[-98.37474549489609,40.59250692510384],[-98.37467895412038,40.59250692510384],[-98.37467895412038,40.592480114235705],[-98.37464228879502,40.592479083048254],[-98.37464093082,40.59250795629086],[-98.37457846396934,40.59250795629086],[-98.37457826932462,40.59254912199468],[-98.37452034258709,40.59254809904091],[-98.37451764832021,40.59265857795722],[-98.37457018652402,40.59265755500513],[-98.37456479799032,40.59285498446884],[-98.37472106546831,40.59285396151976]]]},"properties":{"id":"Taylor Hall Residence"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.3737386139963,40.592822505804655],[-98.3737406459065,40.592765417120646],[-98.37377315646964,40.59276618858968],[-98.37377417242475,40.59266744048179],[-98.37374369377179,40.59266666901163],[-98.37374470972688,40.59260417989853],[-98.37339826903835,40.59259955107303],[-98.37339217330776,40.592818648462675],[-98.3737386139963,40.592822505804655]]]},"properties":{"id":"Wilson Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.3710880581408,40.59285384881594],[-98.37108495134117,40.59269460559814],[-98.37111757273735,40.59269460559814],[-98.37111912613716,40.592625010294974],[-98.37109116494044,40.59262265113089],[-98.37109116494044,40.592462227777595],[-98.37088766956425,40.59245986860776],[-98.37088922296408,40.59250115406781],[-98.3708488345688,40.59249997448359],[-98.37084572776917,40.59285384881594],[-98.3710880581408,40.59285384881594]]]},"properties":{"id":"Batchelder General Services"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37139804641792,40.59329458891759],[-98.37139804641792,40.59319899088562],[-98.37129990788338,40.59319823814465],[-98.3712969339884,40.59329308343783],[-98.37139804641792,40.59329458891759]]]},"properties":{"id":"Campus Safety"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37252975651616,40.593156827790594],[-98.37252881637454,40.59312398858383],[-98.37250813325893,40.59312327468785],[-98.37251095368379,40.59305259894826],[-98.37230600281096,40.59304902946449],[-98.37230882323581,40.59292195571781],[-98.37217062241788,40.59292195571781],[-98.37217062241788,40.593047601670925],[-98.37191960460574,40.593045459980516],[-98.37191866446413,40.59312184689587],[-98.37189234049882,40.59312184689587],[-98.37189328064044,40.593152544416704],[-98.3719572102705,40.593152544416704],[-98.3719572102705,40.59316468064199],[-98.37217062241788,40.59316468064199],[-98.37217156255952,40.59315325831238],[-98.37224959431384,40.593155399999326],[-98.37224865417222,40.59316682232858],[-98.37246206631963,40.59316967791059],[-98.37246394660288,40.59315468610369],[-98.37252975651616,40.593156827790594]]]},"properties":{"id":"Bronc Hall Residence"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37189410131195,40.59411717917972],[-98.3718924278385,40.594065714506016],[-98.37190665236291,40.594065714506016],[-98.37190748909967,40.593829357718064],[-98.37189410131195,40.59382999308689],[-98.37189661152215,40.59378170503864],[-98.37176022343498,40.59378043430005],[-98.37175938669823,40.59382745161154],[-98.37174683564726,40.59382745161154],[-98.3717451621738,40.5940663498726],[-98.37175603975129,40.5940663498726],[-98.37175603975129,40.5941152730814],[-98.37189410131195,40.59411717917972]]]},"properties":{"id":"The 1882 Residence Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37297358496218,40.594287236848594],[-98.37302656725574,40.594179361354826],[-98.37318062346203,40.59422593696438],[-98.37321057883548,40.59415661511511],[-98.37328903338498,40.594179361354826],[-98.3734202664496,40.59391832071013],[-98.37334181190009,40.59389665754029],[-98.37335892925634,40.5938717448863],[-98.37293670113542,40.593748264638194],[-98.37292243667187,40.59377317733819],[-98.37255726640511,40.593660528533846],[-98.37249307631916,40.59376559521309],[-98.37264713252546,40.593813254270884],[-98.37260576558117,40.59390857228456],[-98.37245313582125,40.59386199645395],[-98.37236130461655,40.5940333213648],[-98.37244344372661,40.594057941663856],[-98.37243407698598,40.59407927924903],[-98.3725123372465,40.594103359502135],[-98.37250152675315,40.59412524968894],[-98.37257936230517,40.59414878163177],[-98.37257071391052,40.594169030041066],[-98.37297358496218,40.594287236848594]]]},"properties":{"id":"Hazelrigg Student Union"}},
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37003093644454,40.59489319890186],[-98.37002539427893,40.594554427576305],[-98.36991824574359,40.594554427576305],[-98.36991824574359,40.594491302294855],[-98.36939635848097,40.59449551064881],[-98.36939635848097,40.59456985819158],[-98.36930768383104,40.59456915680006],[-98.36931045491386,40.5949002127828],[-98.37003093644454,40.59489319890186]]]},"properties":{"id":"Physical Fitness Facility"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.3707569741431,40.595997812186724],[-98.3707609796432,40.59595345634213],[-98.37093925863765,40.59595608489197],[-98.37093579690959,40.59587065696967],[-98.37126985366618,40.59587459979926],[-98.37126985366618,40.595589401192704],[-98.37099983887846,40.59558677262847],[-98.37099983887846,40.595392258587665],[-98.36994747355205,40.59538963001566],[-98.3699455880793,40.59587362637473],[-98.3702990362079,40.59587224653109],[-98.37030085342192,40.59595296733678],[-98.37043169283199,40.59595227741577],[-98.37042896701095,40.595997812186724],[-98.3707569741431,40.595997812186724]]]},"properties":{"id":"Lynn Farrell Arena/Fleharty Educational Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37211946976164,40.595036751142146],[-98.37209853033835,40.595007397045535],[-98.37215327445425,40.59498984579718],[-98.37194527282195,40.59469129454744],[-98.37194712982472,40.594305952303756],[-98.37169736008775,40.5943052575816],[-98.37169708368509,40.594470035453604],[-98.37176513394347,40.59446865751005],[-98.37176604128025,40.5945802708457],[-98.37153514181085,40.59467504115343],[-98.37155328864164,40.59470053315958],[-98.37153877117701,40.59470397802453],[-98.37157052813086,40.594785965758],[-98.37158504559547,40.59478114295293],[-98.37158595293702,40.59481421360927],[-98.37186178476472,40.594816280524746],[-98.37186178476472,40.59482661510118],[-98.3718844683032,40.59482799304458],[-98.3718826536201,40.59485210704955],[-98.37185180400779,40.59486313059177],[-98.37190170779242,40.59493685048371],[-98.3718871903278,40.594941673277546],[-98.37198881258011,40.59508980177594],[-98.37211946976164,40.595036751142146]]]},"properties":{"id":"Hayes M. Fuhr Hall of Music"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37538555821986,40.59328018799004],[-98.37538724870973,40.59309726484104],[-98.37520974727416,40.59309405565852],[-98.37521059251908,40.5931608066232],[-98.37519875909004,40.5931608066232],[-98.37519537811033,40.59327890432057],[-98.37538555821986,40.59328018799004]]]},"properties":{"id":"The Stone Health Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37471015347589,40.59324279822121],[-98.37471437942709,40.592969393604285],[-98.37457407784693,40.5929681100119],[-98.37457069708597,40.59313433502105],[-98.37436278028643,40.59313369322644],[-98.3743602447157,40.59324023104691],[-98.37471015347589,40.59324279822121]]]},"properties":{"id":"Babcock Hall Residence"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37464990421633,40.59375608706591],[-98.37465352180178,40.593639797917334],[-98.37456187630376,40.59363888225395],[-98.3745570528565,40.59375608706591],[-98.37464990421633,40.59375608706591]]]},"properties":{"id":"MacKay House"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.3742242349953,40.593824761664976],[-98.3742242349953,40.593780809929704],[-98.37426523429703,40.593780809929704],[-98.37427005774431,40.593658111182506],[-98.37412414846457,40.59365627985621],[-98.37412173674093,40.593824761664976],[-98.3742242349953,40.593824761664976]]]},"properties":{"id":"905 N Elm Ave"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37328303907076,40.59576922084294],[-98.37317465862661,40.595267009011295],[-98.37290194299486,40.59530583646519],[-98.37292020520233,40.595377020072085],[-98.3728508088139,40.595386264690795],[-98.37291395234293,40.595698179498136],[-98.37300321983061,40.59568449262486],[-98.37301866997268,40.59575031994207],[-98.37316630466383,40.59573076728035],[-98.37316973802872,40.59576335504669],[-98.37323926366815,40.59575227520792],[-98.37324527205675,40.59577573839374],[-98.37328303907076,40.59576922084294]]]},"properties":{"id":"Gray Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37355669887391,40.59683971651677],[-98.37346882100307,40.59659623606328],[-98.37349312764819,40.59659197692209],[-98.3734622769063,40.596499695463045],[-98.37332952522907,40.596526670056555],[-98.37330428371297,40.59644929553547],[-98.37297801374571,40.59651176304569],[-98.37254797310115,40.59649259688399],[-98.37254516848826,40.596542996778915],[-98.37256106129469,40.59659481634959],[-98.37255171258502,40.596682128686005],[-98.37264706942358,40.59668425825375],[-98.37264426481069,40.596737497425636],[-98.3727667329073,40.59674175655755],[-98.37276766777826,40.59669277652411],[-98.37282376003624,40.596682128686005],[-98.37300979935856,40.59668851738907],[-98.37300512500373,40.596779378877706],[-98.37291163790708,40.59679499568363],[-98.3729247261006,40.59683758695397],[-98.37296586042312,40.5968361672454],[-98.37296586042312,40.596802094230576],[-98.37299110193923,40.596887986588825],[-98.37307617519718,40.59686882053498],[-98.37309393774554,40.596929158093324],[-98.37355669887391,40.59683971651677]]]},"properties":{"id":"Jackson Dinsdale Art Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.36946922209306,40.59663009808219],[-98.36946309192157,40.59646951080968],[-98.36938339969201,40.596471838164206],[-98.36938646477778,40.59621582868018],[-98.36946922209306,40.59621582868018],[-98.36946309192157,40.59595516347105],[-98.36938952986353,40.59595516347105],[-98.36938646477778,40.59568984248238],[-98.36946615700731,40.59568984248238],[-98.36946309192157,40.59554321727376],[-98.36923321049021,40.595536235112945],[-98.36923321049021,40.596632425431125],[-98.36946922209306,40.59663009808219]]]},"properties":{"id":"Lloyd Wilson Field/Stadium"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.36635224661157,40.5952162806942],[-98.36635339463838,40.594929482162954],[-98.36611345703568,40.594929482162954],[-98.36611116098207,40.595215408968],[-98.36635224661157,40.5952162806942]]]},"properties":{"id":"Bronco Village Apartments 3"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.36594778233456,40.59521075896037],[-98.36594433215241,40.595025407005174],[-98.36560448920957,40.59502671691478],[-98.36560621430067,40.595043090782795],[-98.36556481211473,40.595043090782795],[-98.36556912484242,40.59519242027393],[-98.36560362666404,40.595191765320756],[-98.36560362666404,40.59521337877231],[-98.36594778233456,40.59521075896037]]]},"properties":{"id":"Bronco Village Apartments 4"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.36581753737377,40.59488116136897],[-98.36582035820989,40.594594140268],[-98.36557917672252,40.594593069291435],[-98.36557776630447,40.59489829691811],[-98.36562431010026,40.59489936788978],[-98.36562431010026,40.594879019425015],[-98.36581753737377,40.59488116136897]]]},"properties":{"id":"Bronco Village Apartments 1"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.36636763296093,40.59478975582371],[-98.3663640756504,40.59460499524451],[-98.36598486634739,40.594606075717216],[-98.36598842365792,40.59476814642561],[-98.36602186237695,40.59476868666066],[-98.36602186237695,40.59479029605858],[-98.36636763296093,40.59478975582371]]]},"properties":{"id":"Bronco Village Apartments 2"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.36542716760385,40.59439543172675],[-98.36542432429836,40.59422414915383],[-98.36538736132702,40.594225588505026],[-98.36538830909551,40.59420543758567],[-98.36508217987125,40.59420543758567],[-98.36508407540826,40.59422630818061],[-98.3650442691314,40.59422630818061],[-98.3650433213629,40.59437815955442],[-98.36508217987125,40.59437815955442],[-98.36508312763975,40.59439615140052],[-98.36542716760385,40.59439543172675]]]},"properties":{"id":"Bronco Village Apartments 5"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.36597687333165,40.594175930871394],[-98.36597687333165,40.59398737546289],[-98.3655949226277,40.59398881481917],[-98.36559302709068,40.594155060260746],[-98.36563188559904,40.5941543405844],[-98.36563283336753,40.59417521119527],[-98.36597687333165,40.594175930871394]]]},"properties":{"id":"Bronco Village Apartments 6"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.3646686039858,40.595412581009995],[-98.36494650785933,40.595223709584495],[-98.36492058096735,40.59520402262996],[-98.36498701862807,40.595156035653986],[-98.36490680730597,40.595086515999505],[-98.36483631856838,40.59513450302537],[-98.36481120189175,40.59511481604457],[-98.36470911475455,40.595181874799174],[-98.36465645075519,40.59513327258924],[-98.36458110072535,40.595182490016796],[-98.36463295450933,40.59522801610503],[-98.3645316775875,40.59529938126202],[-98.3646686039858,40.595412581009995]]]},"properties":{"id":"Barrett Alumni Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37338949046577,40.58959597891962],[-98.3733933780237,40.58945132240717],[-98.37327675128608,40.589449551101],[-98.37327286372816,40.58959361718315],[-98.37338949046577,40.58959597891962]]]},"properties":{"id":"706 E. 7th St. Residence"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37321144031304,40.58958535110486],[-98.37321299533619,40.589450141536396],[-98.37309792362176,40.5894489606656],[-98.37309559108701,40.58958535110486],[-98.37321144031304,40.58958535110486]]]},"properties":{"id":"710 E. 7th St. Residence"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37301550739384,40.58959538848551],[-98.3730225049981,40.58935803355154],[-98.37315079440947,40.58935921442396],[-98.37315312694422,40.58927655330535],[-98.37305827053098,40.58927537243149],[-98.37305749301939,40.58930607514516],[-98.37299218204632,40.58930489427181],[-98.37299140453474,40.5893633474772],[-98.37294008877019,40.5893633474772],[-98.37294164379337,40.58939582145811],[-98.37290976581842,40.58939523102224],[-98.3729058782605,40.58959538848551],[-98.37301550739384,40.58959538848551]]]},"properties":{"id":"714 E. 7th St. Residence"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37481677520717,40.59378243356543],[-98.3748159702016,40.59364459103049],[-98.37470492415694,40.59364364015712],[-98.37470219608254,40.59378243356543],[-98.37481677520717,40.59378243356543]]]},"properties":{"id":"607 E 9th St"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37505232877834,40.59378603329276],[-98.37505232877834,40.59363389370436],[-98.3749411932886,40.59363270511246],[-98.37493806271144,40.59378603329276],[-98.37505232877834,40.59378603329276]]]},"properties":{"id":"603 E 9th St"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37020808429642,40.59325096070355],[-98.3702087922692,40.59304678270344],[-98.37012640522326,40.59305025829369],[-98.37007453189801,40.59300275854457],[-98.3700699548399,40.59284403962595],[-98.36997383661961,40.59284403962595],[-98.36996925956151,40.59300275854457],[-98.37007148052594,40.59305373388376],[-98.37007497105584,40.59325096070355],[-98.37020808429642,40.59325096070355]]]},"properties":{"id":"906 E 9th St"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.3713716620568,40.59216760861196],[-98.3713716620568,40.59208501885758],[-98.37123658640381,40.592083686763935],[-98.37123658640381,40.592170272795876],[-98.3713716620568,40.59216760861196]]]},"properties":{"id":"812 N Ash Ave"}}\r
]}
`,c$=`{"type":"GeometryCollection", "geometries": [\r
{"type":"Polygon","coordinates":[[[-98.3702723467576,40.59295246060802],[-98.3712898200761,40.59296962250515],[-98.37127145248702,40.593452202532475],[-98.3693821617939,40.59343919245249],[-98.3693821617939,40.59396210621867],[-98.36898697694681,40.59395690670241],[-98.36897317608825,40.595313897438444],[-98.36666104991127,40.59530626415921],[-98.3666645004967,40.59434137689304],[-98.3660775631237,40.594328458560554],[-98.3660903226318,40.59391184099969],[-98.36552890427502,40.593908611396046],[-98.3655251986316,40.59414249211982],[-98.36432525734347,40.59413791286647],[-98.36427367897022,40.59707709495426],[-98.37377329389933,40.59709097965043],[-98.37386191086847,40.59401359006412],[-98.37508078915154,40.594020829208134],[-98.37509913072566,40.59343618356128],[-98.37541607762186,40.59342916474601],[-98.37541607762186,40.59304686495786],[-98.37491595389913,40.593044333163895],[-98.37497941341485,40.58982081072618],[-98.37347119813148,40.58981164082747],[-98.373477248548,40.58922812309826],[-98.37287220689669,40.589232717745936],[-98.37286010606364,40.58981164082747],[-98.37161977067842,40.58981164082747],[-98.37159980641273,40.59071814140597],[-98.37034264550859,40.590714592488666],[-98.37035943903622,40.59162321748957],[-98.37107540475405,40.59163250297191],[-98.37106656585733,40.592037456704084],[-98.37065419418758,40.59203614756078],[-98.37065535506281,40.59209797250316],[-98.37051258408789,40.59209551837214],[-98.37051409247337,40.59219975052995],[-98.37028934303831,40.59219975052995],[-98.3702875945045,40.59227459272085],[-98.37028731105269,40.59253351783216],[-98.37009609918391,40.59252977623261],[-98.36990069493494,40.59252314685871],[-98.36990818515268,40.5933535522459],[-98.37026022538576,40.59335639608224],[-98.3702723467576,40.59295246060802]]]}\r
]}`,u$='{"type":"FeatureCollection","features":[{"type":"Feature","properties":{"id":"Kiewit_MR_SEcorner"},"geometry":{"coordinates":[[[-98.37163503619607,40.59063976074893],[-98.37216212045448,40.590601318073],[-98.37257008962634,40.59062619274795],[-98.37289765611462,40.59063523808223],[-98.37286192158837,40.59039101362893],[-98.37285894371118,40.590234980871685],[-98.37290658974618,40.58994326648016],[-98.37282320918538,40.5896877326733],[-98.3716618370903,40.58968320994222],[-98.37163503619607,40.59063976074893]]],"type":"Polygon"},"id":0},{"type":"Feature","properties":{"id":"Daughtery_MR_Chapel"},"geometry":{"coordinates":[[[-98.37352702156389,40.5914658384647],[-98.37355230279564,40.59090910098766],[-98.37337280605138,40.590895662440005],[-98.37336774980503,40.59069984328954],[-98.37309471250403,40.590674885905486],[-98.3723160505715,40.590648008712265],[-98.37231099432515,40.591164432888604],[-98.3724626817145,40.5914312824801],[-98.37242728799043,40.591569506310634],[-98.37239189426599,40.5917653229138],[-98.37310482499674,40.5917787612872],[-98.37321100616931,40.591446640697654],[-98.37352702156389,40.5914658384647]]],"type":"Polygon"},"id":1},{"type":"Feature","properties":{"id":"801 Block"},"geometry":{"coordinates":[[[-98.37164381749396,40.591608632859675],[-98.37164919913825,40.59068913232153],[-98.37024189916244,40.59066052543514],[-98.37033069629301,40.591596372935584],[-98.37164381749396,40.591608632859675]]],"type":"Polygon"},"id":2},{"type":"Feature","properties":{"id":"South of Arboretum"},"geometry":{"coordinates":[[[-98.37476627281052,40.5910136742458],[-98.37477964615867,40.59092227590415],[-98.37446537247885,40.590915505651594],[-98.37446537247885,40.59037726838508],[-98.37394604079577,40.590356957462575],[-98.37393266744795,40.59120662589234],[-98.37434278345529,40.591032292413445],[-98.37476627281052,40.5910136742458]]],"type":"Polygon"},"id":3},{"type":"Feature","properties":{"id":"Arboretum"},"geometry":{"coordinates":[[[-98.37489112509611,40.59219972777811],[-98.37490794950106,40.591069061838084],[-98.37470325257557,40.59106054450788],[-98.37460230614677,40.59105628584243],[-98.37443686616615,40.59106693250561],[-98.37431068312993,40.59109035515871],[-98.37407514146206,40.591215985611285],[-98.3739938235057,40.59130328799105],[-98.37399101943821,40.59197189267704],[-98.37412561467688,40.59209965077304],[-98.37435554820935,40.59219333988858],[-98.37489112509611,40.59219972777811]]],"type":"Polygon"},"id":4},{"type":"Feature","properties":{"id":"North of Arboretum"},"geometry":{"coordinates":[[[-98.37431231320465,40.59336193656449],[-98.37433594448096,40.593078415557756],[-98.37448482150404,40.59306047115021],[-98.37451081590508,40.59293306571445],[-98.37449191088317,40.59276797661897],[-98.37448245837369,40.59257776476619],[-98.37449900026525,40.592471891896395],[-98.37483456434931,40.5924557417828],[-98.37483929060404,40.59226194011691],[-98.37479202805706,40.592233228710995],[-98.37449191088317,40.59222963978439],[-98.37424378251136,40.59221348961228],[-98.3740381904318,40.59213453315965],[-98.37391767093679,40.59193355267803],[-98.37388222402663,40.59336014213147],[-98.37431231320465,40.59336193656449]]],"type":"Polygon"},"id":5},{"type":"Feature","properties":{"id":"PickleBall Cts"},"geometry":{"coordinates":[[[-98.37301888192918,40.592758212922234],[-98.37305404173038,40.59270862956615],[-98.3730665988024,40.59181802995374],[-98.3720670558787,40.591791330852686],[-98.3720544988067,40.59201445872537],[-98.3720821243651,40.59211553349891],[-98.3720896586079,40.59233866028978],[-98.37207961295069,40.5925408087046],[-98.3720544988067,40.592636161518556],[-98.37203691890592,40.592884078198324],[-98.37301888192918,40.592758212922234]]],"type":"Polygon"},"id":6},{"type":"Feature","properties":{"id":"Steinhart Plz"},"geometry":{"coordinates":[[[-98.37375767305471,40.59380937954694],[-98.37381334284255,40.59285824408735],[-98.37336179901064,40.592860592586646],[-98.37332777858475,40.59276195554597],[-98.37319478964805,40.59273847051469],[-98.3726349990074,40.59282771358974],[-98.37261334964592,40.59363559284384],[-98.37317004752059,40.59373422859568],[-98.37375767305471,40.59380937954694]]],"type":"Polygon"},"id":7},{"type":"Feature","properties":{"id":"SE of Union"},"geometry":{"coordinates":[[[-98.37251903104057,40.59362476563635],[-98.37254773304886,40.593196135370334],[-98.37197369288644,40.59318887042687],[-98.37166753813338,40.593159810645574],[-98.37171059114546,40.59367925233752],[-98.37217939061152,40.593824549991155],[-98.37251903104057,40.59362476563635]]],"type":"Polygon"},"id":8},{"type":"Feature","properties":{"id":"Heartwell"},"geometry":{"coordinates":[[[-98.37407601600557,40.595375081069506],[-98.37397063105409,40.594673938335205],[-98.37389033775756,40.594109970364855],[-98.37308740479394,40.59428906881678],[-98.37294689152506,40.59433098540674],[-98.37263575500172,40.5942509628037],[-98.37250527839498,40.59418237192435],[-98.37237982011926,40.594094727921146],[-98.37199842696151,40.594033758112204],[-98.37202351861642,40.594334796004546],[-98.37202853694748,40.59470823353095],[-98.37212890356825,40.594822550724416],[-98.37225436184359,40.59499021558764],[-98.37219916020231,40.5950397528529],[-98.37206366526487,40.595108342852654],[-98.37216403188529,40.59528362808683],[-98.3728164149183,40.595218848814255],[-98.37322289973137,40.595119774511886],[-98.37330821135897,40.5956418182227],[-98.37353905458613,40.595710407604884],[-98.37407601600557,40.595375081069506]]],"type":"Polygon"},"id":9},{"type":"Feature","properties":{"id":"Heartwell North"},"geometry":{"coordinates":[[[-98.37364723125614,40.59642709268644],[-98.37372717366044,40.595729025036405],[-98.37348068458046,40.595744200497705],[-98.37331413790477,40.59580996078944],[-98.37317423869737,40.5958504286296],[-98.37308763442599,40.59580996078944],[-98.37296772081977,40.595789726860176],[-98.37289444028254,40.595739142010984],[-98.37274121734099,40.59567844014052],[-98.37272123173979,40.59534963738679],[-98.37165533301602,40.59529905220464],[-98.37130891593102,40.59546598316149],[-98.3713555489995,40.59585548710561],[-98.37149803178302,40.59612724032186],[-98.37170454966062,40.59618288333169],[-98.37166457845869,40.59672413564374],[-98.37141142751166,40.59705293163782],[-98.37241070756525,40.596997289352856],[-98.37251063557076,40.596410513342704],[-98.37364723125614,40.59642709268644]]],"type":"Polygon"},"id":10},{"type":"Feature","properties":{"id":"Athletic Parking lot"},"geometry":{"coordinates":[[[-98.37135713636462,40.59703881753842],[-98.37159398256752,40.59675342106121],[-98.37164547087292,40.59621781068529],[-98.37141377350018,40.59613570944552],[-98.37124901092368,40.59594804909017],[-98.37084225331375,40.5960575176949],[-98.37024498897541,40.59604578892433],[-98.36962198048437,40.5960184217856],[-98.36954474802666,40.596280363943634],[-98.3695498968572,40.59707400332135],[-98.37135713636462,40.59703881753842]]],"type":"Polygon"},"id":11},{"type":"Feature","properties":{"id":"Fle+PFF"},"geometry":{"coordinates":[[[-98.36986465261369,40.595478850474535],[-98.37011842595624,40.594928288639665],[-98.36931682444536,40.59493746470747],[-98.36901874147125,40.59488240828182],[-98.36905499480616,40.59548190913873],[-98.36986465261369,40.595478850474535]]],"type":"Polygon"},"id":12},{"type":"Feature","properties":{"id":"Football field"},"geometry":{"coordinates":[[[-98.36913306842247,40.59687166324542],[-98.36912125095233,40.595575039769074],[-98.36904443739681,40.59551222692079],[-98.36897944131144,40.59530135478337],[-98.36831766298764,40.59536416782973],[-98.36827630184256,40.596880636330724],[-98.36913306842247,40.59687166324542]]],"type":"Polygon"},"id":13},{"type":"Feature","properties":{"id":"Practice field"},"geometry":{"coordinates":[[[-98.36817488651938,40.596967941434826],[-98.3682206392564,40.5952830148853],[-98.36668220346046,40.59530907080216],[-98.36580718237055,40.59530907080216],[-98.36588153056778,40.59700268176945],[-98.36817488651938,40.596967941434826]]],"type":"Polygon"},"id":14},{"type":"Feature","properties":{"id":"track"},"geometry":{"coordinates":[[[-98.3658412178937,40.597004912936484],[-98.36577780942038,40.595387736092704],[-98.36551671491901,40.59541889048063],[-98.3653525983754,40.59530276950733],[-98.36468494243638,40.59548119921246],[-98.36468494243638,40.59674435461838],[-98.36463272353635,40.59700491285406],[-98.3658412178937,40.597004912936484]]],"type":"Polygon"},"id":15},{"type":"Feature","properties":{"id":"BVH outdoor"},"geometry":{"coordinates":[[[-98.36606218586846,40.594981336403094],[-98.36621039516318,40.5948299194323],[-98.36602176515188,40.59482378089922],[-98.36595709200517,40.59480741147544],[-98.36594361843285,40.59475011845865],[-98.36585738757081,40.59474807227855],[-98.36586277699975,40.594981336403094],[-98.36606218586846,40.594981336403094]]],"type":"Polygon"},"id":16},{"type":"Feature","properties":{"id":"BVH south outdoor"},"geometry":{"coordinates":[[[-98.36605957398896,40.59455423531671],[-98.36605957398896,40.59420722418943],[-98.36571163584682,40.59422694077912],[-98.36549871847637,40.59418750759389],[-98.36547794604984,40.59433735357291],[-98.36543120809051,40.59455817861465],[-98.36605957398896,40.59455423531671]]],"type":"Polygon"},"id":17}]}',h$=`{"type":"FeatureCollection", "features": [\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.5732546949417,39.033957896346706],[-94.57326522382158,39.033796212560006],[-94.5729226302682,39.033781742786736],[-94.57291453112981,39.03394783044083],[-94.5732546949417,39.033957896346706]]]},"properties":{"id":"Physical Plant Operations"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57330618126248,39.03329184109743],[-94.57333069079144,39.032868879640596],[-94.57332112401924,39.03286702180975],[-94.57332590740536,39.03279828203385],[-94.57289061927166,39.032835438677765],[-94.57286046661933,39.03328233695542],[-94.57330618126248,39.03329184109743]]]},"properties":{"id":"St. Luke's Urgent Care"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57151501542803,39.03292423985276],[-94.57151293405649,39.032993004805604],[-94.57184717798721,39.03300418514015],[-94.57184478733176,39.03304318257621],[-94.57179856799333,39.03305618171678],[-94.57179298979729,39.03312055837771],[-94.571829646514,39.033121177383784],[-94.57181849012196,39.033266024655184],[-94.5720280709153,39.03327654773599],[-94.57204321173309,39.033054943703505],[-94.5720575556657,39.03305556271014],[-94.5720631338617,39.03295156951771],[-94.572026477145,39.032949093487446],[-94.57203205534103,39.03290576294391],[-94.57191730388003,39.03289895385609],[-94.57191252256916,39.0329466174571],[-94.57185434995351,39.03294537944191],[-94.57185275618323,39.03297261577139],[-94.57165911309279,39.032966425697424],[-94.57166230063338,39.032929904250025],[-94.57151501542803,39.03292423985276]]]},"properties":{"id":"St. Peter Claver Jesuit Community"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57320143143617,39.03248280295288],[-94.5732236476623,39.03206766728228],[-94.57287806192237,39.03205807982458],[-94.57285214299189,39.0324693805906],[-94.57320143143617,39.03248280295288]]]},"properties":{"id":"Greenlease Library"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57258061133909,39.03244157711775],[-94.57259171945215,39.03223353009446],[-94.57203878226827,39.03221147899157],[-94.57202520568563,39.03242240230252],[-94.57258061133909,39.03244157711775]]]},"properties":{"id":"Conway Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.5729983573256,39.031851550588144],[-94.57299756184071,39.031777457537544],[-94.57321564931763,39.03178334435931],[-94.57323249004943,39.03143209646873],[-94.57296205948676,39.031423909721845],[-94.57296447934267,39.03135905846342],[-94.57280960856365,39.03135529896836],[-94.5728071887077,39.03138819454341],[-94.57269708526324,39.03138631479668],[-94.57269708526324,39.03142109010315],[-94.57267409663196,39.03142015023023],[-94.572672886704,39.03149158053676],[-94.57274790223761,39.0314934602807],[-94.57273580295798,39.03168519389932],[-94.5727950894281,39.031686133768716],[-94.57279387950013,39.031724668403285],[-94.5728701049617,39.03172748800987],[-94.57286526524985,39.03184873098651],[-94.5729983573256,39.031851550588144]]]},"properties":{"id":"Sedgewick Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57326241323847,39.03143368161774],[-94.57327626990363,39.03124423732891],[-94.5730261570974,39.03123347343362],[-94.57301275849636,39.0314254445335],[-94.57326241323847,39.03143368161774]]]},"properties":{"id":"Greenlease Gallery"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.573095990435,39.03111733680814],[-94.57308496704151,39.031231510274026],[-94.57308922652759,39.0312361877],[-94.57325910712441,39.03124349870881],[-94.57328155089225,39.03098889143854],[-94.57264954299825,39.03095820723238],[-94.57262565897899,39.031273611693024],[-94.57279744019438,39.0312828882735],[-94.57281213805237,39.03110377869681],[-94.573095990435,39.03111733680814]]]},"properties":{"id":"Van Ackeren Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57168446809365,39.032022569107156],[-94.57169184016705,39.03180937961588],[-94.57179868570213,39.031816109120946],[-94.57180734885364,39.0318116227843],[-94.57183045059094,39.03127774669104],[-94.57147526137969,39.031266530763475],[-94.57148969996551,39.030961456851074],[-94.57133665095579,39.03095921365567],[-94.57130690259424,39.031697853704856],[-94.57146028857838,39.031697853704856],[-94.57144848965653,39.032017331773794],[-94.57168446809365,39.032022569107156]]]},"properties":{"id":"Massman Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57102622899816,39.03227668523504],[-94.57041136868395,39.032248511124756],[-94.57038028024108,39.03258659970685],[-94.57099514055531,39.03261611529995],[-94.57102622899816,39.03227668523504]]]},"properties":{"id":"Mason-Halpin Fieldhouse"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57102622899816,39.03227668523504],[-94.5710435003553,39.03201775132257],[-94.57017475109112,39.0319855522205],[-94.57016266114111,39.03223509487781],[-94.57102622899816,39.03227668523504]]]},"properties":{"id":"Convocation Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57003078591215,39.032220762006155],[-94.57011418121974,39.032159390693046],[-94.57010430545964,39.032152571654976],[-94.57011857044647,39.0321355240569],[-94.57007906740601,39.03210654313074],[-94.57011857044647,39.03207244790827],[-94.57010211084628,39.03205880981468],[-94.57012515428654,39.03204005743169],[-94.57007687279265,39.03200340503239],[-94.57005492665907,39.03201960028093],[-94.57003627244553,39.03200425741399],[-94.56983546532327,39.03214575261624],[-94.56986180068357,39.03216620973048],[-94.56983985454998,39.03218837159754],[-94.56987935759042,39.03221479535305],[-94.56989910911065,39.032200304907704],[-94.56992434716427,39.03221905724818],[-94.56996714212474,39.03218496207999],[-94.57000993708525,39.032220762006155],[-94.57001981284535,39.03221309059493],[-94.57003078591215,39.032220762006155]]]},"properties":{"id":"Student Activities Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.5700079120054,39.03251153999033],[-94.57007391952787,39.03239788275361],[-94.56962616850038,39.03226029743301],[-94.56963937000486,39.03224064236535],[-94.56956236122863,39.03221756901809],[-94.569545859348,39.0322355149555],[-94.56911791057726,39.032091092758456],[-94.56905630355628,39.03220047764487],[-94.56942814593293,39.03231926260322],[-94.56943254643443,39.03240899211564],[-94.56956566160477,39.032447447586094],[-94.56962836875111,39.03238335512371],[-94.5700079120054,39.03251153999033]]]},"properties":{"id":"Corcoran Residence Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.56854799775466,39.03168092891154],[-94.56855120851591,39.03148472512313],[-94.5683842489311,39.03148306237683],[-94.56838210842359,39.031552066315285],[-94.56833501725863,39.03155040357058],[-94.5683318064974,39.03160527412545],[-94.56837889766234,39.031604442753725],[-94.5683756869011,39.03167843479901],[-94.56854799775466,39.03168092891154]]]},"properties":{"id":"Town House Village"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.5694451877561,39.031137040617324],[-94.56944931800915,39.031079289457125],[-94.56924142860419,39.03107180319216],[-94.56923729835111,39.031130623824076],[-94.5694451877561,39.031137040617324]]]},"properties":{"id":"The Birdhouse"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57023544284519,39.03101832984793],[-94.57024370335134,39.03090603569337],[-94.56974669623084,39.03088999365672],[-94.56974531947982,39.03083117282454],[-94.56960626762614,39.03082582547373],[-94.56960351412411,39.03088250737171],[-94.56911752101182,39.03087074320795],[-94.56911201400773,39.03097982901504],[-94.57023544284519,39.03101832984793]]]},"properties":{"id":"Xavier-Loyola Residence Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57110683934017,39.030625006944845],[-94.5711103812666,39.03058465303729],[-94.57115524566798,39.03058648730631],[-94.57116351016298,39.030412231536324],[-94.57103836209599,39.030407645852364],[-94.57103836209599,39.03042507144983],[-94.57075146605564,39.030415900083284],[-94.5707502854135,39.03054338197162],[-94.57072076935995,39.03054429910667],[-94.57071722743352,39.03061583560425],[-94.57110683934017,39.030625006944845]]]},"properties":{"id":"Magis Activity Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57198788526269,39.03047484462258],[-94.57200861727132,39.03025032364125],[-94.57210130154519,39.03026832323989],[-94.57212569214357,39.03018021989759],[-94.57206837423735,39.02993485624719],[-94.57194154312575,39.02995664533168],[-94.57194032359583,39.029975592356216],[-94.57188544474947,39.02997275030286],[-94.57188544474947,39.029948119168985],[-94.57170739338125,39.029948119168985],[-94.57155373261142,39.029932961543864],[-94.57155373261142,39.02994906652044],[-94.57146348739738,39.0299414877084],[-94.57145373115803,39.03010916873508],[-94.57150129282489,39.03011201078295],[-94.57148665846586,39.03031758527588],[-94.57179885812519,39.03032705874041],[-94.5717927604756,39.030445476939825],[-94.57185373697156,39.03044831897417],[-94.57185495650148,39.030468213211414],[-94.57198788526269,39.03047484462258]]]},"properties":{"id":"Pedro Arrupe, S.J., Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57284047860178,39.0302797832297],[-94.57286427952926,39.029831426558175],[-94.5727080859427,39.02982911543394],[-94.572694697921,39.03005444969102],[-94.5725905688633,39.03005329413256],[-94.57258164351548,39.030234716579436],[-94.57268279745728,39.030237027690404],[-94.57267982234133,39.03027631656532],[-94.57284047860178,39.0302797832297]]]},"properties":{"id":"McGee Residence Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.5730942108803,39.03066445893382],[-94.57317199672308,39.030664613464],[-94.57325985414333,39.030643791903515],[-94.57335366799886,39.03057901367613],[-94.57337898284875,39.03051307863372],[-94.57340366198356,39.02995448923646],[-94.57335443753462,39.029949304371044],[-94.57335193459656,39.029918843279034],[-94.57318507205777,39.02991495462804],[-94.57317172305467,39.03002707731239],[-94.57310581235186,39.03002837352735],[-94.5730700106048,39.030426554038584],[-94.57268280619707,39.03041812687501],[-94.57267696475127,39.03046998632717],[-94.57261938478547,39.03048035821303],[-94.57261604681642,39.03052508695338],[-94.57264692302996,39.03053999652721],[-94.57264692302996,39.030585373471666],[-94.57268864764288,39.03067936847824],[-94.5730858659577,39.03068714736974],[-94.5730942108803,39.03066445893382]]]},"properties":{"id":"St. Ignatius Science Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57292884511348,39.02885017929442],[-94.57292884511348,39.02878607947923],[-94.57289583924593,39.02878607947923],[-94.57289790211264,39.02876043953688],[-94.57268542684032,39.02875242705299],[-94.57268336397358,39.02881973188946],[-94.57272049557459,39.02881973188946],[-94.57271843270787,39.02884697430505],[-94.57292884511348,39.02885017929442]]]},"properties":{"id":"University Marketing and Communication"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57283326901032,39.028729445595104],[-94.57284341632814,39.02854814224998],[-94.57270405983009,39.028544463626574],[-94.57270270685437,39.028568111916584],[-94.57268511817016,39.028568111916584],[-94.57268308870658,39.028620663643835],[-94.5727020303665,39.028622240195055],[-94.57270000090294,39.02865902638007],[-94.57268241221873,39.02865902638007],[-94.57268173573087,39.02870684839195],[-94.5727006773908,39.028707899424816],[-94.5726993244151,39.028725766981125],[-94.57283326901032,39.028729445595104]]]},"properties":{"id":"Rock Row Housing N"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57284691787102,39.02851897602392],[-94.57285908326953,39.0283383666503],[-94.57271782947576,39.02833311637091],[-94.57271715362029,39.02835674262511],[-94.5726975538116,39.02835726765288],[-94.57269417453423,39.02840924538392],[-94.57271512605388,39.02840924538392],[-94.572712422632,39.02844599729188],[-94.5726975538116,39.02844809740033],[-94.5726948503897,39.0284948247972],[-94.572712422632,39.028496399877454],[-94.57271174677652,39.02851582586437],[-94.57284691787102,39.02851897602392]]]},"properties":{"id":"Rock Row Housing S"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57359514381248,39.02847208180017],[-94.57361271431651,39.028083475715746],[-94.57327990829927,39.02807143210462],[-94.57325923711807,39.028461644061366],[-94.57359514381248,39.02847208180017]]]},"properties":{"id":"Security Department"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57480409573863,39.03238485708068],[-94.57475834188774,39.03234294052741],[-94.57478743748095,39.0323230514835],[-94.57466523598949,39.03222270213117],[-94.57465592539967,39.03222903047291],[-94.57456281950141,39.032149474135494],[-94.57455234508787,39.032154898434065],[-94.57453256008448,39.03213591338722],[-94.5745418706743,39.03212868098708],[-94.57443596271503,39.03204189212767],[-94.57444294565741,39.03200392196817],[-94.57448600713533,39.031963239631786],[-94.57446854977943,39.03195419910939],[-94.57445691154213,39.0319668558404],[-94.57437893535234,39.031978608517164],[-94.57437078858625,39.03197318420506],[-94.57426022533207,39.03199216929562],[-94.57421018091178,39.031950582900116],[-94.57410660059993,39.03202561920467],[-94.5741217303084,39.03203737187166],[-94.57391816391097,39.03218429006349],[-94.5739193483118,39.03221373112918],[-94.57398567475879,39.03222937169034],[-94.57396790874621,39.03229653406067],[-94.57383525585222,39.03238485708068],[-94.5738127522363,39.03243637879136],[-94.57379024862033,39.03244833918312],[-94.57380209262874,39.03245661945314],[-94.573822227443,39.03244281900256],[-94.57387552548074,39.03242901854928],[-94.57400462517222,39.032327815142885],[-94.57410885244606,39.03231401466714],[-94.57411122124773,39.032375656771244],[-94.57415030647543,39.03237933689516],[-94.5743552078206,39.03223397185472],[-94.574367051829,39.03224501224803],[-94.57443811587935,39.03218705016392],[-94.57453642114899,39.032267093029475],[-94.57452220833892,39.03227813341762],[-94.57461577600522,39.03235817618002],[-94.57462880441446,39.032348055835755],[-94.57464538602619,39.03236553642948],[-94.57466078323709,39.03235541608627],[-94.57474369129585,39.03242809851896],[-94.57480409573863,39.03238485708068]]]},"properties":{"id":"St. Francis Xavier Church"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57151501542803,39.03292423985276],[-94.57133748256577,39.032919396176545],[-94.57133184858787,39.03302943092199],[-94.57151052617259,39.03303443249725],[-94.57151501542803,39.03292423985276]]]},"properties":{"id":"Campus Ministry Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57133184858787,39.03302943092199],[-94.57132503847693,39.033133258595875],[-94.57150408963523,39.03313923484835],[-94.57151052617259,39.03303443249725],[-94.57133184858787,39.03302943092199]]]},"properties":{"id":"Kateri Community Residence"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57286010900144,39.03328693338342],[-94.57283532620258,39.03371719964933],[-94.5732878874704,39.0337356369808],[-94.57330546295397,39.03329801918155],[-94.57286010900144,39.03328693338342]]]},"properties":{"id":"Prosperity Center for Financial Opportunity"}}\r
]}`,d$=`{"type":"GeometryCollection", "geometries": [\r
{"type":"Polygon","coordinates":[[[-94.5733601221702,39.033991702842954],[-94.57343057843688,39.032627336829854],[-94.57483618218124,39.03266045740923],[-94.57483618218124,39.03225653248882],[-94.57456975228335,39.031925844267924],[-94.57443769998508,39.031865057522765],[-94.5734766527032,39.03184416206704],[-94.5737667714431,39.02721317928421],[-94.57318118713299,39.027186419902776],[-94.5731396822614,39.02830719202791],[-94.5726236948803,39.02827994478758],[-94.57256476148764,39.028963612429386],[-94.5679483123955,39.02883237317173],[-94.56774097288552,39.032390935290124],[-94.5688957036816,39.03245419936561],[-94.57042657308332,39.032720791128675],[-94.57108453863592,39.03274057444863],[-94.57121364975842,39.03280827134139],[-94.57119428309004,39.03315176939054],[-94.57150092200602,39.03315929122695],[-94.57153965534276,39.03306150729117],[-94.57173977758268,39.03306652185526],[-94.57178173869748,39.03329719141926],[-94.57214002206244,39.033307220513656],[-94.57216584428696,39.0332119440594],[-94.57283722212401,39.03322949499484],[-94.57279848878727,39.033964123097064],[-94.5733601221702,39.033991702842954]]]}\r
]}`;function O_(n){return typeof n=="string"?n.replace(/^\uFEFF/,""):n}const f$=JSON.parse(O_(l$)),p$=JSON.parse(O_(c$)),m$=JSON.parse(O_(u$)),g$=JSON.parse(O_(h$)),y$=JSON.parse(O_(d$));function LC(n){return Array.isArray(n)?n[0]||{}:n||{}}const _$=LC(Yq),v$=LC(a$),VT={..._$,buildings:f$,boundary:p$,outdoorSpaces:m$},x$={...v$,buildings:g$,boundary:y$},b$={hastings:VT,"hastings-demo":VT,rockhurst:x$};function w$(n){return b$[n]}function Ly({engagementMode:n=!1}){const{universityId:e,persona:t}=zP(),i=w$(e);return i?window.location.pathname.includes("/admin")?Y.jsx(Zq,{config:i,universityId:e}):Y.jsx(Xq,{config:i,universityId:e,persona:t,engagementMode:n}):Y.jsxs("div",{children:['Error: Configuration not found for "',e,'".']})}function S$(){return Y.jsx(S7,{basename:"/StakeholderMap",children:Y.jsxs(e7,{children:[Y.jsx(qm,{path:"/:universityId/admin",element:Y.jsx(Ly,{})}),Y.jsx(qm,{path:"/:universityId/engagement",element:Y.jsx(Ly,{engagementMode:!0})}),Y.jsx(qm,{path:"/:universityId/:persona",element:Y.jsx(Ly,{})}),Y.jsx(qm,{path:"/:universityId/survey",element:Y.jsx(Ly,{})}),Y.jsx(qm,{path:"/:universityId",element:Y.jsx(Ly,{})}),Y.jsx(qm,{path:"/",element:Y.jsx("div",{children:"Please select a university by navigating to its URL (e.g., /hastings)"})})]})})}const E$=lP.createRoot(document.getElementById("root"));E$.render(Y.jsx(S$,{}));export{wa as _,A$ as c,Zv as g};
