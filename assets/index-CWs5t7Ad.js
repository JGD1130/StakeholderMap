function kL(n,e){for(var t=0;t<e.length;t++){const i=e[t];if(typeof i!="string"&&!Array.isArray(i)){for(const c in i)if(c!=="default"&&!(c in n)){const u=Object.getOwnPropertyDescriptor(i,c);u&&Object.defineProperty(n,c,u.get?u:{enumerable:!0,get:()=>i[c]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))i(c);new MutationObserver(c=>{for(const u of c)if(u.type==="childList")for(const m of u.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&i(m)}).observe(document,{childList:!0,subtree:!0});function t(c){const u={};return c.integrity&&(u.integrity=c.integrity),c.referrerPolicy&&(u.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?u.credentials="include":c.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function i(c){if(c.ep)return;c.ep=!0;const u=t(c);fetch(c.href,u)}})();var t$=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Wv(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function ML(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function i(){var c=!1;try{c=this instanceof i}catch{}return c?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(i){var c=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,c.get?c:{enumerable:!0,get:function(){return n[i]}})}),t}var nb={exports:{}},xy={},rb={exports:{}},os={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f2;function RL(){if(f2)return os;f2=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),c=Symbol.for("react.profiler"),u=Symbol.for("react.provider"),m=Symbol.for("react.context"),_=Symbol.for("react.forward_ref"),o=Symbol.for("react.suspense"),w=Symbol.for("react.memo"),I=Symbol.for("react.lazy"),R=Symbol.iterator;function V(xe){return xe===null||typeof xe!="object"?null:(xe=R&&xe[R]||xe["@@iterator"],typeof xe=="function"?xe:null)}var k={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ie=Object.assign,ae={};function fe(xe,le,Ne){this.props=xe,this.context=le,this.refs=ae,this.updater=Ne||k}fe.prototype.isReactComponent={},fe.prototype.setState=function(xe,le){if(typeof xe!="object"&&typeof xe!="function"&&xe!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,xe,le,"setState")},fe.prototype.forceUpdate=function(xe){this.updater.enqueueForceUpdate(this,xe,"forceUpdate")};function J(){}J.prototype=fe.prototype;function ne(xe,le,Ne){this.props=xe,this.context=le,this.refs=ae,this.updater=Ne||k}var me=ne.prototype=new J;me.constructor=ne,ie(me,fe.prototype),me.isPureReactComponent=!0;var ue=Array.isArray,ke=Object.prototype.hasOwnProperty,ze={current:null},pe={key:!0,ref:!0,__self:!0,__source:!0};function U(xe,le,Ne){var Oe,Je={},rt=null,mt=null;if(le!=null)for(Oe in le.ref!==void 0&&(mt=le.ref),le.key!==void 0&&(rt=""+le.key),le)ke.call(le,Oe)&&!pe.hasOwnProperty(Oe)&&(Je[Oe]=le[Oe]);var dt=arguments.length-2;if(dt===1)Je.children=Ne;else if(1<dt){for(var Dt=Array(dt),tn=0;tn<dt;tn++)Dt[tn]=arguments[tn+2];Je.children=Dt}if(xe&&xe.defaultProps)for(Oe in dt=xe.defaultProps,dt)Je[Oe]===void 0&&(Je[Oe]=dt[Oe]);return{$$typeof:n,type:xe,key:rt,ref:mt,props:Je,_owner:ze.current}}function F(xe,le){return{$$typeof:n,type:xe.type,key:le,ref:xe.ref,props:xe.props,_owner:xe._owner}}function q(xe){return typeof xe=="object"&&xe!==null&&xe.$$typeof===n}function j(xe){var le={"=":"=0",":":"=2"};return"$"+xe.replace(/[=:]/g,function(Ne){return le[Ne]})}var H=/\/+/g;function Z(xe,le){return typeof xe=="object"&&xe!==null&&xe.key!=null?j(""+xe.key):le.toString(36)}function be(xe,le,Ne,Oe,Je){var rt=typeof xe;(rt==="undefined"||rt==="boolean")&&(xe=null);var mt=!1;if(xe===null)mt=!0;else switch(rt){case"string":case"number":mt=!0;break;case"object":switch(xe.$$typeof){case n:case e:mt=!0}}if(mt)return mt=xe,Je=Je(mt),xe=Oe===""?"."+Z(mt,0):Oe,ue(Je)?(Ne="",xe!=null&&(Ne=xe.replace(H,"$&/")+"/"),be(Je,le,Ne,"",function(tn){return tn})):Je!=null&&(q(Je)&&(Je=F(Je,Ne+(!Je.key||mt&&mt.key===Je.key?"":(""+Je.key).replace(H,"$&/")+"/")+xe)),le.push(Je)),1;if(mt=0,Oe=Oe===""?".":Oe+":",ue(xe))for(var dt=0;dt<xe.length;dt++){rt=xe[dt];var Dt=Oe+Z(rt,dt);mt+=be(rt,le,Ne,Dt,Je)}else if(Dt=V(xe),typeof Dt=="function")for(xe=Dt.call(xe),dt=0;!(rt=xe.next()).done;)rt=rt.value,Dt=Oe+Z(rt,dt++),mt+=be(rt,le,Ne,Dt,Je);else if(rt==="object")throw le=String(xe),Error("Objects are not valid as a React child (found: "+(le==="[object Object]"?"object with keys {"+Object.keys(xe).join(", ")+"}":le)+"). If you meant to render a collection of children, use an array instead.");return mt}function Me(xe,le,Ne){if(xe==null)return xe;var Oe=[],Je=0;return be(xe,Oe,"","",function(rt){return le.call(Ne,rt,Je++)}),Oe}function Be(xe){if(xe._status===-1){var le=xe._result;le=le(),le.then(function(Ne){(xe._status===0||xe._status===-1)&&(xe._status=1,xe._result=Ne)},function(Ne){(xe._status===0||xe._status===-1)&&(xe._status=2,xe._result=Ne)}),xe._status===-1&&(xe._status=0,xe._result=le)}if(xe._status===1)return xe._result.default;throw xe._result}var Re={current:null},we={transition:null},De={ReactCurrentDispatcher:Re,ReactCurrentBatchConfig:we,ReactCurrentOwner:ze};function nt(){throw Error("act(...) is not supported in production builds of React.")}return os.Children={map:Me,forEach:function(xe,le,Ne){Me(xe,function(){le.apply(this,arguments)},Ne)},count:function(xe){var le=0;return Me(xe,function(){le++}),le},toArray:function(xe){return Me(xe,function(le){return le})||[]},only:function(xe){if(!q(xe))throw Error("React.Children.only expected to receive a single React element child.");return xe}},os.Component=fe,os.Fragment=t,os.Profiler=c,os.PureComponent=ne,os.StrictMode=i,os.Suspense=o,os.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=De,os.act=nt,os.cloneElement=function(xe,le,Ne){if(xe==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+xe+".");var Oe=ie({},xe.props),Je=xe.key,rt=xe.ref,mt=xe._owner;if(le!=null){if(le.ref!==void 0&&(rt=le.ref,mt=ze.current),le.key!==void 0&&(Je=""+le.key),xe.type&&xe.type.defaultProps)var dt=xe.type.defaultProps;for(Dt in le)ke.call(le,Dt)&&!pe.hasOwnProperty(Dt)&&(Oe[Dt]=le[Dt]===void 0&&dt!==void 0?dt[Dt]:le[Dt])}var Dt=arguments.length-2;if(Dt===1)Oe.children=Ne;else if(1<Dt){dt=Array(Dt);for(var tn=0;tn<Dt;tn++)dt[tn]=arguments[tn+2];Oe.children=dt}return{$$typeof:n,type:xe.type,key:Je,ref:rt,props:Oe,_owner:mt}},os.createContext=function(xe){return xe={$$typeof:m,_currentValue:xe,_currentValue2:xe,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},xe.Provider={$$typeof:u,_context:xe},xe.Consumer=xe},os.createElement=U,os.createFactory=function(xe){var le=U.bind(null,xe);return le.type=xe,le},os.createRef=function(){return{current:null}},os.forwardRef=function(xe){return{$$typeof:_,render:xe}},os.isValidElement=q,os.lazy=function(xe){return{$$typeof:I,_payload:{_status:-1,_result:xe},_init:Be}},os.memo=function(xe,le){return{$$typeof:w,type:xe,compare:le===void 0?null:le}},os.startTransition=function(xe){var le=we.transition;we.transition={};try{xe()}finally{we.transition=le}},os.unstable_act=nt,os.useCallback=function(xe,le){return Re.current.useCallback(xe,le)},os.useContext=function(xe){return Re.current.useContext(xe)},os.useDebugValue=function(){},os.useDeferredValue=function(xe){return Re.current.useDeferredValue(xe)},os.useEffect=function(xe,le){return Re.current.useEffect(xe,le)},os.useId=function(){return Re.current.useId()},os.useImperativeHandle=function(xe,le,Ne){return Re.current.useImperativeHandle(xe,le,Ne)},os.useInsertionEffect=function(xe,le){return Re.current.useInsertionEffect(xe,le)},os.useLayoutEffect=function(xe,le){return Re.current.useLayoutEffect(xe,le)},os.useMemo=function(xe,le){return Re.current.useMemo(xe,le)},os.useReducer=function(xe,le,Ne){return Re.current.useReducer(xe,le,Ne)},os.useRef=function(xe){return Re.current.useRef(xe)},os.useState=function(xe){return Re.current.useState(xe)},os.useSyncExternalStore=function(xe,le,Ne){return Re.current.useSyncExternalStore(xe,le,Ne)},os.useTransition=function(){return Re.current.useTransition()},os.version="18.3.1",os}var p2;function uw(){return p2||(p2=1,rb.exports=RL()),rb.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var m2;function NL(){if(m2)return xy;m2=1;var n=uw(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,c=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function m(_,o,w){var I,R={},V=null,k=null;w!==void 0&&(V=""+w),o.key!==void 0&&(V=""+o.key),o.ref!==void 0&&(k=o.ref);for(I in o)i.call(o,I)&&!u.hasOwnProperty(I)&&(R[I]=o[I]);if(_&&_.defaultProps)for(I in o=_.defaultProps,o)R[I]===void 0&&(R[I]=o[I]);return{$$typeof:e,type:_,key:V,ref:k,props:R,_owner:c.current}}return xy.Fragment=t,xy.jsx=m,xy.jsxs=m,xy}var g2;function DL(){return g2||(g2=1,nb.exports=NL()),nb.exports}var Y=DL(),Nn=uw();const FL=Wv(Nn),OL=kL({__proto__:null,default:FL},[Nn]);var l1={},ib={exports:{}},Kh={},ob={exports:{}},sb={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var y2;function BL(){return y2||(y2=1,(function(n){function e(we,De){var nt=we.length;we.push(De);e:for(;0<nt;){var xe=nt-1>>>1,le=we[xe];if(0<c(le,De))we[xe]=De,we[nt]=le,nt=xe;else break e}}function t(we){return we.length===0?null:we[0]}function i(we){if(we.length===0)return null;var De=we[0],nt=we.pop();if(nt!==De){we[0]=nt;e:for(var xe=0,le=we.length,Ne=le>>>1;xe<Ne;){var Oe=2*(xe+1)-1,Je=we[Oe],rt=Oe+1,mt=we[rt];if(0>c(Je,nt))rt<le&&0>c(mt,Je)?(we[xe]=mt,we[rt]=nt,xe=rt):(we[xe]=Je,we[Oe]=nt,xe=Oe);else if(rt<le&&0>c(mt,nt))we[xe]=mt,we[rt]=nt,xe=rt;else break e}}return De}function c(we,De){var nt=we.sortIndex-De.sortIndex;return nt!==0?nt:we.id-De.id}if(typeof performance=="object"&&typeof performance.now=="function"){var u=performance;n.unstable_now=function(){return u.now()}}else{var m=Date,_=m.now();n.unstable_now=function(){return m.now()-_}}var o=[],w=[],I=1,R=null,V=3,k=!1,ie=!1,ae=!1,fe=typeof setTimeout=="function"?setTimeout:null,J=typeof clearTimeout=="function"?clearTimeout:null,ne=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function me(we){for(var De=t(w);De!==null;){if(De.callback===null)i(w);else if(De.startTime<=we)i(w),De.sortIndex=De.expirationTime,e(o,De);else break;De=t(w)}}function ue(we){if(ae=!1,me(we),!ie)if(t(o)!==null)ie=!0,Be(ke);else{var De=t(w);De!==null&&Re(ue,De.startTime-we)}}function ke(we,De){ie=!1,ae&&(ae=!1,J(U),U=-1),k=!0;var nt=V;try{for(me(De),R=t(o);R!==null&&(!(R.expirationTime>De)||we&&!j());){var xe=R.callback;if(typeof xe=="function"){R.callback=null,V=R.priorityLevel;var le=xe(R.expirationTime<=De);De=n.unstable_now(),typeof le=="function"?R.callback=le:R===t(o)&&i(o),me(De)}else i(o);R=t(o)}if(R!==null)var Ne=!0;else{var Oe=t(w);Oe!==null&&Re(ue,Oe.startTime-De),Ne=!1}return Ne}finally{R=null,V=nt,k=!1}}var ze=!1,pe=null,U=-1,F=5,q=-1;function j(){return!(n.unstable_now()-q<F)}function H(){if(pe!==null){var we=n.unstable_now();q=we;var De=!0;try{De=pe(!0,we)}finally{De?Z():(ze=!1,pe=null)}}else ze=!1}var Z;if(typeof ne=="function")Z=function(){ne(H)};else if(typeof MessageChannel<"u"){var be=new MessageChannel,Me=be.port2;be.port1.onmessage=H,Z=function(){Me.postMessage(null)}}else Z=function(){fe(H,0)};function Be(we){pe=we,ze||(ze=!0,Z())}function Re(we,De){U=fe(function(){we(n.unstable_now())},De)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(we){we.callback=null},n.unstable_continueExecution=function(){ie||k||(ie=!0,Be(ke))},n.unstable_forceFrameRate=function(we){0>we||125<we?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<we?Math.floor(1e3/we):5},n.unstable_getCurrentPriorityLevel=function(){return V},n.unstable_getFirstCallbackNode=function(){return t(o)},n.unstable_next=function(we){switch(V){case 1:case 2:case 3:var De=3;break;default:De=V}var nt=V;V=De;try{return we()}finally{V=nt}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(we,De){switch(we){case 1:case 2:case 3:case 4:case 5:break;default:we=3}var nt=V;V=we;try{return De()}finally{V=nt}},n.unstable_scheduleCallback=function(we,De,nt){var xe=n.unstable_now();switch(typeof nt=="object"&&nt!==null?(nt=nt.delay,nt=typeof nt=="number"&&0<nt?xe+nt:xe):nt=xe,we){case 1:var le=-1;break;case 2:le=250;break;case 5:le=1073741823;break;case 4:le=1e4;break;default:le=5e3}return le=nt+le,we={id:I++,callback:De,priorityLevel:we,startTime:nt,expirationTime:le,sortIndex:-1},nt>xe?(we.sortIndex=nt,e(w,we),t(o)===null&&we===t(w)&&(ae?(J(U),U=-1):ae=!0,Re(ue,nt-xe))):(we.sortIndex=le,e(o,we),ie||k||(ie=!0,Be(ke))),we},n.unstable_shouldYield=j,n.unstable_wrapCallback=function(we){var De=V;return function(){var nt=V;V=De;try{return we.apply(this,arguments)}finally{V=nt}}}})(sb)),sb}var _2;function zL(){return _2||(_2=1,ob.exports=BL()),ob.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var v2;function jL(){if(v2)return Kh;v2=1;var n=uw(),e=zL();function t(d){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+d,E=1;E<arguments.length;E++)g+="&args[]="+encodeURIComponent(arguments[E]);return"Minified React error #"+d+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,c={};function u(d,g){m(d,g),m(d+"Capture",g)}function m(d,g){for(c[d]=g,d=0;d<g.length;d++)i.add(g[d])}var _=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),o=Object.prototype.hasOwnProperty,w=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,I={},R={};function V(d){return o.call(R,d)?!0:o.call(I,d)?!1:w.test(d)?R[d]=!0:(I[d]=!0,!1)}function k(d,g,E,D){if(E!==null&&E.type===0)return!1;switch(typeof g){case"function":case"symbol":return!0;case"boolean":return D?!1:E!==null?!E.acceptsBooleans:(d=d.toLowerCase().slice(0,5),d!=="data-"&&d!=="aria-");default:return!1}}function ie(d,g,E,D){if(g===null||typeof g>"u"||k(d,g,E,D))return!0;if(D)return!1;if(E!==null)switch(E.type){case 3:return!g;case 4:return g===!1;case 5:return isNaN(g);case 6:return isNaN(g)||1>g}return!1}function ae(d,g,E,D,K,ce,Ve){this.acceptsBooleans=g===2||g===3||g===4,this.attributeName=D,this.attributeNamespace=K,this.mustUseProperty=E,this.propertyName=d,this.type=g,this.sanitizeURL=ce,this.removeEmptyString=Ve}var fe={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(d){fe[d]=new ae(d,0,!1,d,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(d){var g=d[0];fe[g]=new ae(g,1,!1,d[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(d){fe[d]=new ae(d,2,!1,d.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(d){fe[d]=new ae(d,2,!1,d,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(d){fe[d]=new ae(d,3,!1,d.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(d){fe[d]=new ae(d,3,!0,d,null,!1,!1)}),["capture","download"].forEach(function(d){fe[d]=new ae(d,4,!1,d,null,!1,!1)}),["cols","rows","size","span"].forEach(function(d){fe[d]=new ae(d,6,!1,d,null,!1,!1)}),["rowSpan","start"].forEach(function(d){fe[d]=new ae(d,5,!1,d.toLowerCase(),null,!1,!1)});var J=/[\-:]([a-z])/g;function ne(d){return d[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(d){var g=d.replace(J,ne);fe[g]=new ae(g,1,!1,d,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(d){var g=d.replace(J,ne);fe[g]=new ae(g,1,!1,d,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(d){var g=d.replace(J,ne);fe[g]=new ae(g,1,!1,d,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(d){fe[d]=new ae(d,1,!1,d.toLowerCase(),null,!1,!1)}),fe.xlinkHref=new ae("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(d){fe[d]=new ae(d,1,!1,d.toLowerCase(),null,!0,!0)});function me(d,g,E,D){var K=fe.hasOwnProperty(g)?fe[g]:null;(K!==null?K.type!==0:D||!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(ie(g,E,K,D)&&(E=null),D||K===null?V(g)&&(E===null?d.removeAttribute(g):d.setAttribute(g,""+E)):K.mustUseProperty?d[K.propertyName]=E===null?K.type===3?!1:"":E:(g=K.attributeName,D=K.attributeNamespace,E===null?d.removeAttribute(g):(K=K.type,E=K===3||K===4&&E===!0?"":""+E,D?d.setAttributeNS(D,g,E):d.setAttribute(g,E))))}var ue=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ke=Symbol.for("react.element"),ze=Symbol.for("react.portal"),pe=Symbol.for("react.fragment"),U=Symbol.for("react.strict_mode"),F=Symbol.for("react.profiler"),q=Symbol.for("react.provider"),j=Symbol.for("react.context"),H=Symbol.for("react.forward_ref"),Z=Symbol.for("react.suspense"),be=Symbol.for("react.suspense_list"),Me=Symbol.for("react.memo"),Be=Symbol.for("react.lazy"),Re=Symbol.for("react.offscreen"),we=Symbol.iterator;function De(d){return d===null||typeof d!="object"?null:(d=we&&d[we]||d["@@iterator"],typeof d=="function"?d:null)}var nt=Object.assign,xe;function le(d){if(xe===void 0)try{throw Error()}catch(E){var g=E.stack.trim().match(/\n( *(at )?)/);xe=g&&g[1]||""}return`
`+xe+d}var Ne=!1;function Oe(d,g){if(!d||Ne)return"";Ne=!0;var E=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(vn){var D=vn}Reflect.construct(d,[],g)}else{try{g.call()}catch(vn){D=vn}d.call(g.prototype)}else{try{throw Error()}catch(vn){D=vn}d()}}catch(vn){if(vn&&D&&typeof vn.stack=="string"){for(var K=vn.stack.split(`
`),ce=D.stack.split(`
`),Ve=K.length-1,Et=ce.length-1;1<=Ve&&0<=Et&&K[Ve]!==ce[Et];)Et--;for(;1<=Ve&&0<=Et;Ve--,Et--)if(K[Ve]!==ce[Et]){if(Ve!==1||Et!==1)do if(Ve--,Et--,0>Et||K[Ve]!==ce[Et]){var Ft=`
`+K[Ve].replace(" at new "," at ");return d.displayName&&Ft.includes("<anonymous>")&&(Ft=Ft.replace("<anonymous>",d.displayName)),Ft}while(1<=Ve&&0<=Et);break}}}finally{Ne=!1,Error.prepareStackTrace=E}return(d=d?d.displayName||d.name:"")?le(d):""}function Je(d){switch(d.tag){case 5:return le(d.type);case 16:return le("Lazy");case 13:return le("Suspense");case 19:return le("SuspenseList");case 0:case 2:case 15:return d=Oe(d.type,!1),d;case 11:return d=Oe(d.type.render,!1),d;case 1:return d=Oe(d.type,!0),d;default:return""}}function rt(d){if(d==null)return null;if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case pe:return"Fragment";case ze:return"Portal";case F:return"Profiler";case U:return"StrictMode";case Z:return"Suspense";case be:return"SuspenseList"}if(typeof d=="object")switch(d.$$typeof){case j:return(d.displayName||"Context")+".Consumer";case q:return(d._context.displayName||"Context")+".Provider";case H:var g=d.render;return d=d.displayName,d||(d=g.displayName||g.name||"",d=d!==""?"ForwardRef("+d+")":"ForwardRef"),d;case Me:return g=d.displayName||null,g!==null?g:rt(d.type)||"Memo";case Be:g=d._payload,d=d._init;try{return rt(d(g))}catch{}}return null}function mt(d){var g=d.type;switch(d.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return d=g.render,d=d.displayName||d.name||"",g.displayName||(d!==""?"ForwardRef("+d+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return rt(g);case 8:return g===U?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function dt(d){switch(typeof d){case"boolean":case"number":case"string":case"undefined":return d;case"object":return d;default:return""}}function Dt(d){var g=d.type;return(d=d.nodeName)&&d.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function tn(d){var g=Dt(d)?"checked":"value",E=Object.getOwnPropertyDescriptor(d.constructor.prototype,g),D=""+d[g];if(!d.hasOwnProperty(g)&&typeof E<"u"&&typeof E.get=="function"&&typeof E.set=="function"){var K=E.get,ce=E.set;return Object.defineProperty(d,g,{configurable:!0,get:function(){return K.call(this)},set:function(Ve){D=""+Ve,ce.call(this,Ve)}}),Object.defineProperty(d,g,{enumerable:E.enumerable}),{getValue:function(){return D},setValue:function(Ve){D=""+Ve},stopTracking:function(){d._valueTracker=null,delete d[g]}}}}function ln(d){d._valueTracker||(d._valueTracker=tn(d))}function yn(d){if(!d)return!1;var g=d._valueTracker;if(!g)return!0;var E=g.getValue(),D="";return d&&(D=Dt(d)?d.checked?"true":"false":d.value),d=D,d!==E?(g.setValue(d),!0):!1}function Mn(d){if(d=d||(typeof document<"u"?document:void 0),typeof d>"u")return null;try{return d.activeElement||d.body}catch{return d.body}}function Gt(d,g){var E=g.checked;return nt({},g,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:E??d._wrapperState.initialChecked})}function st(d,g){var E=g.defaultValue==null?"":g.defaultValue,D=g.checked!=null?g.checked:g.defaultChecked;E=dt(g.value!=null?g.value:E),d._wrapperState={initialChecked:D,initialValue:E,controlled:g.type==="checkbox"||g.type==="radio"?g.checked!=null:g.value!=null}}function fr(d,g){g=g.checked,g!=null&&me(d,"checked",g,!1)}function br(d,g){fr(d,g);var E=dt(g.value),D=g.type;if(E!=null)D==="number"?(E===0&&d.value===""||d.value!=E)&&(d.value=""+E):d.value!==""+E&&(d.value=""+E);else if(D==="submit"||D==="reset"){d.removeAttribute("value");return}g.hasOwnProperty("value")?Cn(d,g.type,E):g.hasOwnProperty("defaultValue")&&Cn(d,g.type,dt(g.defaultValue)),g.checked==null&&g.defaultChecked!=null&&(d.defaultChecked=!!g.defaultChecked)}function Tr(d,g,E){if(g.hasOwnProperty("value")||g.hasOwnProperty("defaultValue")){var D=g.type;if(!(D!=="submit"&&D!=="reset"||g.value!==void 0&&g.value!==null))return;g=""+d._wrapperState.initialValue,E||g===d.value||(d.value=g),d.defaultValue=g}E=d.name,E!==""&&(d.name=""),d.defaultChecked=!!d._wrapperState.initialChecked,E!==""&&(d.name=E)}function Cn(d,g,E){(g!=="number"||Mn(d.ownerDocument)!==d)&&(E==null?d.defaultValue=""+d._wrapperState.initialValue:d.defaultValue!==""+E&&(d.defaultValue=""+E))}var ir=Array.isArray;function Jn(d,g,E,D){if(d=d.options,g){g={};for(var K=0;K<E.length;K++)g["$"+E[K]]=!0;for(E=0;E<d.length;E++)K=g.hasOwnProperty("$"+d[E].value),d[E].selected!==K&&(d[E].selected=K),K&&D&&(d[E].defaultSelected=!0)}else{for(E=""+dt(E),g=null,K=0;K<d.length;K++){if(d[K].value===E){d[K].selected=!0,D&&(d[K].defaultSelected=!0);return}g!==null||d[K].disabled||(g=d[K])}g!==null&&(g.selected=!0)}}function Hr(d,g){if(g.dangerouslySetInnerHTML!=null)throw Error(t(91));return nt({},g,{value:void 0,defaultValue:void 0,children:""+d._wrapperState.initialValue})}function Vt(d,g){var E=g.value;if(E==null){if(E=g.children,g=g.defaultValue,E!=null){if(g!=null)throw Error(t(92));if(ir(E)){if(1<E.length)throw Error(t(93));E=E[0]}g=E}g==null&&(g=""),E=g}d._wrapperState={initialValue:dt(E)}}function Ln(d,g){var E=dt(g.value),D=dt(g.defaultValue);E!=null&&(E=""+E,E!==d.value&&(d.value=E),g.defaultValue==null&&d.defaultValue!==E&&(d.defaultValue=E)),D!=null&&(d.defaultValue=""+D)}function $n(d){var g=d.textContent;g===d._wrapperState.initialValue&&g!==""&&g!==null&&(d.value=g)}function Dn(d){switch(d){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Mr(d,g){return d==null||d==="http://www.w3.org/1999/xhtml"?Dn(g):d==="http://www.w3.org/2000/svg"&&g==="foreignObject"?"http://www.w3.org/1999/xhtml":d}var xr,Sr=(function(d){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(g,E,D,K){MSApp.execUnsafeLocalFunction(function(){return d(g,E,D,K)})}:d})(function(d,g){if(d.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in d)d.innerHTML=g;else{for(xr=xr||document.createElement("div"),xr.innerHTML="<svg>"+g.valueOf().toString()+"</svg>",g=xr.firstChild;d.firstChild;)d.removeChild(d.firstChild);for(;g.firstChild;)d.appendChild(g.firstChild)}});function Er(d,g){if(g){var E=d.firstChild;if(E&&E===d.lastChild&&E.nodeType===3){E.nodeValue=g;return}}d.textContent=g}var Cr={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Si=["Webkit","ms","Moz","O"];Object.keys(Cr).forEach(function(d){Si.forEach(function(g){g=g+d.charAt(0).toUpperCase()+d.substring(1),Cr[g]=Cr[d]})});function Li(d,g,E){return g==null||typeof g=="boolean"||g===""?"":E||typeof g!="number"||g===0||Cr.hasOwnProperty(d)&&Cr[d]?(""+g).trim():g+"px"}function or(d,g){d=d.style;for(var E in g)if(g.hasOwnProperty(E)){var D=E.indexOf("--")===0,K=Li(E,g[E],D);E==="float"&&(E="cssFloat"),D?d.setProperty(E,K):d[E]=K}}var ai=nt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function qr(d,g){if(g){if(ai[d]&&(g.children!=null||g.dangerouslySetInnerHTML!=null))throw Error(t(137,d));if(g.dangerouslySetInnerHTML!=null){if(g.children!=null)throw Error(t(60));if(typeof g.dangerouslySetInnerHTML!="object"||!("__html"in g.dangerouslySetInnerHTML))throw Error(t(61))}if(g.style!=null&&typeof g.style!="object")throw Error(t(62))}}function Dr(d,g){if(d.indexOf("-")===-1)return typeof g.is=="string";switch(d){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var hi=null;function li(d){return d=d.target||d.srcElement||window,d.correspondingUseElement&&(d=d.correspondingUseElement),d.nodeType===3?d.parentNode:d}var lt=null,Ee=null,Te=null;function et(d){if(d=wh(d)){if(typeof lt!="function")throw Error(t(280));var g=d.stateNode;g&&(g=Cc(g),lt(d.stateNode,d.type,g))}}function ht(d){Ee?Te?Te.push(d):Te=[d]:Ee=d}function Ct(){if(Ee){var d=Ee,g=Te;if(Te=Ee=null,et(d),g)for(d=0;d<g.length;d++)et(g[d])}}function Rt(d,g){return d(g)}function Ot(){}var At=!1;function Lt(d,g,E){if(At)return d(g,E);At=!0;try{return Rt(d,g,E)}finally{At=!1,(Ee!==null||Te!==null)&&(Ot(),Ct())}}function xn(d,g){var E=d.stateNode;if(E===null)return null;var D=Cc(E);if(D===null)return null;E=D[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(D=!D.disabled)||(d=d.type,D=!(d==="button"||d==="input"||d==="select"||d==="textarea")),d=!D;break e;default:d=!1}if(d)return null;if(E&&typeof E!="function")throw Error(t(231,g,typeof E));return E}var On=!1;if(_)try{var An={};Object.defineProperty(An,"passive",{get:function(){On=!0}}),window.addEventListener("test",An,An),window.removeEventListener("test",An,An)}catch{On=!1}function Lr(d,g,E,D,K,ce,Ve,Et,Ft){var vn=Array.prototype.slice.call(arguments,3);try{g.apply(E,vn)}catch(nr){this.onError(nr)}}var Ir=!1,zr=null,wr=!1,Ei=null,to={onError:function(d){Ir=!0,zr=d}};function po(d,g,E,D,K,ce,Ve,Et,Ft){Ir=!1,zr=null,Lr.apply(to,arguments)}function Wo(d,g,E,D,K,ce,Ve,Et,Ft){if(po.apply(this,arguments),Ir){if(Ir){var vn=zr;Ir=!1,zr=null}else throw Error(t(198));wr||(wr=!0,Ei=vn)}}function no(d){var g=d,E=d;if(d.alternate)for(;g.return;)g=g.return;else{d=g;do g=d,(g.flags&4098)!==0&&(E=g.return),d=g.return;while(d)}return g.tag===3?E:null}function _s(d){if(d.tag===13){var g=d.memoizedState;if(g===null&&(d=d.alternate,d!==null&&(g=d.memoizedState)),g!==null)return g.dehydrated}return null}function ro(d){if(no(d)!==d)throw Error(t(188))}function Ps(d){var g=d.alternate;if(!g){if(g=no(d),g===null)throw Error(t(188));return g!==d?null:d}for(var E=d,D=g;;){var K=E.return;if(K===null)break;var ce=K.alternate;if(ce===null){if(D=K.return,D!==null){E=D;continue}break}if(K.child===ce.child){for(ce=K.child;ce;){if(ce===E)return ro(K),d;if(ce===D)return ro(K),g;ce=ce.sibling}throw Error(t(188))}if(E.return!==D.return)E=K,D=ce;else{for(var Ve=!1,Et=K.child;Et;){if(Et===E){Ve=!0,E=K,D=ce;break}if(Et===D){Ve=!0,D=K,E=ce;break}Et=Et.sibling}if(!Ve){for(Et=ce.child;Et;){if(Et===E){Ve=!0,E=ce,D=K;break}if(Et===D){Ve=!0,D=ce,E=K;break}Et=Et.sibling}if(!Ve)throw Error(t(189))}}if(E.alternate!==D)throw Error(t(190))}if(E.tag!==3)throw Error(t(188));return E.stateNode.current===E?d:g}function fa(d){return d=Ps(d),d!==null?Sl(d):null}function Sl(d){if(d.tag===5||d.tag===6)return d;for(d=d.child;d!==null;){var g=Sl(d);if(g!==null)return g;d=d.sibling}return null}var al=e.unstable_scheduleCallback,Vi=e.unstable_cancelCallback,Ql=e.unstable_shouldYield,Pu=e.unstable_requestPaint,So=e.unstable_now,mu=e.unstable_getCurrentPriorityLevel,Ea=e.unstable_ImmediatePriority,Zo=e.unstable_UserBlockingPriority,Xa=e.unstable_NormalPriority,kl=e.unstable_LowPriority,ec=e.unstable_IdlePriority,Aa=null,ra=null;function pn(d){if(ra&&typeof ra.onCommitFiberRoot=="function")try{ra.onCommitFiberRoot(Aa,d,void 0,(d.current.flags&128)===128)}catch{}}var Yo=Math.clz32?Math.clz32:gu,ss=Math.log,vi=Math.LN2;function gu(d){return d>>>=0,d===0?32:31-(ss(d)/vi|0)|0}var Za=64,Ya=4194304;function ll(d){switch(d&-d){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return d&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return d}}function ks(d,g){var E=d.pendingLanes;if(E===0)return 0;var D=0,K=d.suspendedLanes,ce=d.pingedLanes,Ve=E&268435455;if(Ve!==0){var Et=Ve&~K;Et!==0?D=ll(Et):(ce&=Ve,ce!==0&&(D=ll(ce)))}else Ve=E&~K,Ve!==0?D=ll(Ve):ce!==0&&(D=ll(ce));if(D===0)return 0;if(g!==0&&g!==D&&(g&K)===0&&(K=D&-D,ce=g&-g,K>=ce||K===16&&(ce&4194240)!==0))return g;if((D&4)!==0&&(D|=E&16),g=d.entangledLanes,g!==0)for(d=d.entanglements,g&=D;0<g;)E=31-Yo(g),K=1<<E,D|=d[E],g&=~K;return D}function er(d,g){switch(d){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Fr(d,g){for(var E=d.suspendedLanes,D=d.pingedLanes,K=d.expirationTimes,ce=d.pendingLanes;0<ce;){var Ve=31-Yo(ce),Et=1<<Ve,Ft=K[Ve];Ft===-1?((Et&E)===0||(Et&D)!==0)&&(K[Ve]=er(Et,g)):Ft<=g&&(d.expiredLanes|=Et),ce&=~Et}}function Rr(d){return d=d.pendingLanes&-1073741825,d!==0?d:d&1073741824?1073741824:0}function zs(){var d=Za;return Za<<=1,(Za&4194240)===0&&(Za=64),d}function Ta(d){for(var g=[],E=0;31>E;E++)g.push(d);return g}function xi(d,g,E){d.pendingLanes|=g,g!==536870912&&(d.suspendedLanes=0,d.pingedLanes=0),d=d.eventTimes,g=31-Yo(g),d[g]=E}function Mi(d,g){var E=d.pendingLanes&~g;d.pendingLanes=g,d.suspendedLanes=0,d.pingedLanes=0,d.expiredLanes&=g,d.mutableReadLanes&=g,d.entangledLanes&=g,g=d.entanglements;var D=d.eventTimes;for(d=d.expirationTimes;0<E;){var K=31-Yo(E),ce=1<<K;g[K]=0,D[K]=-1,d[K]=-1,E&=~ce}}function El(d,g){var E=d.entangledLanes|=g;for(d=d.entanglements;E;){var D=31-Yo(E),K=1<<D;K&g|d[D]&g&&(d[D]|=g),E&=~K}}var ji=0;function fs(d){return d&=-d,1<d?4<d?(d&268435455)!==0?16:536870912:4:1}var Fi,yu,tc,eu,bc,nc=!1,Da=[],Ms=null,Oi=null,Fa=null,ci=new Map,Jo=new Map,Eo=[],xh="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ku(d,g){switch(d){case"focusin":case"focusout":Ms=null;break;case"dragenter":case"dragleave":Oi=null;break;case"mouseover":case"mouseout":Fa=null;break;case"pointerover":case"pointerout":ci.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":Jo.delete(g.pointerId)}}function mo(d,g,E,D,K,ce){return d===null||d.nativeEvent!==ce?(d={blockedOn:g,domEventName:E,eventSystemFlags:D,nativeEvent:ce,targetContainers:[K]},g!==null&&(g=wh(g),g!==null&&yu(g)),d):(d.eventSystemFlags|=D,g=d.targetContainers,K!==null&&g.indexOf(K)===-1&&g.push(K),d)}function js(d,g,E,D,K){switch(g){case"focusin":return Ms=mo(Ms,d,g,E,D,K),!0;case"dragenter":return Oi=mo(Oi,d,g,E,D,K),!0;case"mouseover":return Fa=mo(Fa,d,g,E,D,K),!0;case"pointerover":var ce=K.pointerId;return ci.set(ce,mo(ci.get(ce)||null,d,g,E,D,K)),!0;case"gotpointercapture":return ce=K.pointerId,Jo.set(ce,mo(Jo.get(ce)||null,d,g,E,D,K)),!0}return!1}function Mu(d){var g=ka(d.target);if(g!==null){var E=no(g);if(E!==null){if(g=E.tag,g===13){if(g=_s(E),g!==null){d.blockedOn=g,bc(d.priority,function(){tc(E)});return}}else if(g===3&&E.stateNode.current.memoizedState.isDehydrated){d.blockedOn=E.tag===3?E.stateNode.containerInfo:null;return}}}d.blockedOn=null}function Ko(d){if(d.blockedOn!==null)return!1;for(var g=d.targetContainers;0<g.length;){var E=tu(d.domEventName,d.eventSystemFlags,g[0],d.nativeEvent);if(E===null){E=d.nativeEvent;var D=new E.constructor(E.type,E);hi=D,E.target.dispatchEvent(D),hi=null}else return g=wh(E),g!==null&&yu(g),d.blockedOn=E,!1;g.shift()}return!0}function go(d,g,E){Ko(d)&&E.delete(g)}function Ml(){nc=!1,Ms!==null&&Ko(Ms)&&(Ms=null),Oi!==null&&Ko(Oi)&&(Oi=null),Fa!==null&&Ko(Fa)&&(Fa=null),ci.forEach(go),Jo.forEach(go)}function Oa(d,g){d.blockedOn===g&&(d.blockedOn=null,nc||(nc=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Ml)))}function Us(d){function g(K){return Oa(K,d)}if(0<Da.length){Oa(Da[0],d);for(var E=1;E<Da.length;E++){var D=Da[E];D.blockedOn===d&&(D.blockedOn=null)}}for(Ms!==null&&Oa(Ms,d),Oi!==null&&Oa(Oi,d),Fa!==null&&Oa(Fa,d),ci.forEach(g),Jo.forEach(g),E=0;E<Eo.length;E++)D=Eo[E],D.blockedOn===d&&(D.blockedOn=null);for(;0<Eo.length&&(E=Eo[0],E.blockedOn===null);)Mu(E),E.blockedOn===null&&Eo.shift()}var Uo=ue.ReactCurrentBatchConfig,zc=!0;function Xo(d,g,E,D){var K=ji,ce=Uo.transition;Uo.transition=null;try{ji=1,Ja(d,g,E,D)}finally{ji=K,Uo.transition=ce}}function pa(d,g,E,D){var K=ji,ce=Uo.transition;Uo.transition=null;try{ji=4,Ja(d,g,E,D)}finally{ji=K,Uo.transition=ce}}function Ja(d,g,E,D){if(zc){var K=tu(d,g,E,D);if(K===null)za(d,g,D,cl,E),ku(d,D);else if(js(K,d,g,E,D))D.stopPropagation();else if(ku(d,D),g&4&&-1<xh.indexOf(d)){for(;K!==null;){var ce=wh(K);if(ce!==null&&Fi(ce),ce=tu(d,g,E,D),ce===null&&za(d,g,D,cl,E),ce===K)break;K=ce}K!==null&&D.stopPropagation()}else za(d,g,D,null,E)}}var cl=null;function tu(d,g,E,D){if(cl=null,d=li(D),d=ka(d),d!==null)if(g=no(d),g===null)d=null;else if(E=g.tag,E===13){if(d=_s(g),d!==null)return d;d=null}else if(E===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;d=null}else g!==d&&(d=null);return cl=d,null}function wc(d){switch(d){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(mu()){case Ea:return 1;case Zo:return 4;case Xa:case kl:return 16;case ec:return 536870912;default:return 16}default:return 16}}var Vs=null,Ai=null,Ss=null;function qs(){if(Ss)return Ss;var d,g=Ai,E=g.length,D,K="value"in Vs?Vs.value:Vs.textContent,ce=K.length;for(d=0;d<E&&g[d]===K[d];d++);var Ve=E-d;for(D=1;D<=Ve&&g[E-D]===K[ce-D];D++);return Ss=K.slice(d,1<D?1-D:void 0)}function ia(d){var g=d.keyCode;return"charCode"in d?(d=d.charCode,d===0&&g===13&&(d=13)):d=g,d===10&&(d=13),32<=d||d===13?d:0}function oa(){return!0}function ul(){return!1}function $s(d){function g(E,D,K,ce,Ve){this._reactName=E,this._targetInst=K,this.type=D,this.nativeEvent=ce,this.target=Ve,this.currentTarget=null;for(var Et in d)d.hasOwnProperty(Et)&&(E=d[Et],this[Et]=E?E(ce):ce[Et]);return this.isDefaultPrevented=(ce.defaultPrevented!=null?ce.defaultPrevented:ce.returnValue===!1)?oa:ul,this.isPropagationStopped=ul,this}return nt(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var E=this.nativeEvent;E&&(E.preventDefault?E.preventDefault():typeof E.returnValue!="unknown"&&(E.returnValue=!1),this.isDefaultPrevented=oa)},stopPropagation:function(){var E=this.nativeEvent;E&&(E.stopPropagation?E.stopPropagation():typeof E.cancelBubble!="unknown"&&(E.cancelBubble=!0),this.isPropagationStopped=oa)},persist:function(){},isPersistent:oa}),g}var Gs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(d){return d.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Sc=$s(Gs),W=nt({},Gs,{view:0,detail:0}),Ce=$s(W),pt,yt,qt,Qt=nt({},W,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Qa,button:0,buttons:0,relatedTarget:function(d){return d.relatedTarget===void 0?d.fromElement===d.srcElement?d.toElement:d.fromElement:d.relatedTarget},movementX:function(d){return"movementX"in d?d.movementX:(d!==qt&&(qt&&d.type==="mousemove"?(pt=d.screenX-qt.screenX,yt=d.screenY-qt.screenY):yt=pt=0,qt=d),pt)},movementY:function(d){return"movementY"in d?d.movementY:yt}}),Fn=$s(Qt),Nr=nt({},Qt,{dataTransfer:0}),$r=$s(Nr),yi=nt({},W,{relatedTarget:0}),Ti=$s(yi),yo=nt({},Gs,{animationName:0,elapsedTime:0,pseudoElement:0}),_o=$s(yo),Qo=nt({},Gs,{clipboardData:function(d){return"clipboardData"in d?d.clipboardData:window.clipboardData}}),Mo=$s(Qo),Vo=nt({},Gs,{data:0}),es=$s(Vo),cs={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},qo={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Es={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function jc(d){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(d):(d=Es[d])?!!g[d]:!1}function Qa(){return jc}var L=nt({},W,{key:function(d){if(d.key){var g=cs[d.key]||d.key;if(g!=="Unidentified")return g}return d.type==="keypress"?(d=ia(d),d===13?"Enter":String.fromCharCode(d)):d.type==="keydown"||d.type==="keyup"?qo[d.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Qa,charCode:function(d){return d.type==="keypress"?ia(d):0},keyCode:function(d){return d.type==="keydown"||d.type==="keyup"?d.keyCode:0},which:function(d){return d.type==="keypress"?ia(d):d.type==="keydown"||d.type==="keyup"?d.keyCode:0}}),se=$s(L),ve=nt({},Qt,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),He=$s(ve),Xt=nt({},W,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Qa}),fn=$s(Xt),ar=nt({},Gs,{propertyName:0,elapsedTime:0,pseudoElement:0}),ao=$s(ar),Fo=nt({},Qt,{deltaX:function(d){return"deltaX"in d?d.deltaX:"wheelDeltaX"in d?-d.wheelDeltaX:0},deltaY:function(d){return"deltaY"in d?d.deltaY:"wheelDeltaY"in d?-d.wheelDeltaY:"wheelDelta"in d?-d.wheelDelta:0},deltaZ:0,deltaMode:0}),qi=$s(Fo),Di=[9,13,27,32],Ro=_&&"CompositionEvent"in window,sa=null;_&&"documentMode"in document&&(sa=document.documentMode);var Oo=_&&"TextEvent"in window&&!sa,Ji=_&&(!Ro||sa&&8<sa&&11>=sa),Rl=" ",Ia=!1;function Ru(d,g){switch(d){case"keyup":return Di.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function hl(d){return d=d.detail,typeof d=="object"&&"data"in d?d.data:null}var Nl=!1;function dl(d,g){switch(d){case"compositionend":return hl(g);case"keypress":return g.which!==32?null:(Ia=!0,Rl);case"textInput":return d=g.data,d===Rl&&Ia?null:d;default:return null}}function No(d,g){if(Nl)return d==="compositionend"||!Ro&&Ru(d,g)?(d=qs(),Ss=Ai=Vs=null,Nl=!1,d):null;switch(d){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return Ji&&g.locale!=="ko"?null:g.data;default:return null}}var aa={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Dl(d){var g=d&&d.nodeName&&d.nodeName.toLowerCase();return g==="input"?!!aa[d.type]:g==="textarea"}function Ec(d,g,E,D){ht(D),g=Rs(g,"onChange"),0<g.length&&(E=new Sc("onChange","change",null,E,D),d.push({event:E,listeners:g}))}var ma=null,Lo=null;function $o(d){_a(d,0)}function Ca(d){var g=su(d);if(yn(g))return d}function rc(d,g){if(d==="change")return g}var fl=!1;if(_){var Nu;if(_){var el="oninput"in document;if(!el){var Ac=document.createElement("div");Ac.setAttribute("oninput","return;"),el=typeof Ac.oninput=="function"}Nu=el}else Nu=!1;fl=Nu&&(!document.documentMode||9<document.documentMode)}function Al(){ma&&(ma.detachEvent("onpropertychange",pl),Lo=ma=null)}function pl(d){if(d.propertyName==="value"&&Ca(Lo)){var g=[];Ec(g,Lo,d,li(d)),Lt($o,g)}}function ic(d,g,E){d==="focusin"?(Al(),ma=g,Lo=E,ma.attachEvent("onpropertychange",pl)):d==="focusout"&&Al()}function Fl(d){if(d==="selectionchange"||d==="keyup"||d==="keydown")return Ca(Lo)}function _u(d,g){if(d==="click")return Ca(g)}function vs(d,g){if(d==="input"||d==="change")return Ca(g)}function vu(d,g){return d===g&&(d!==0||1/d===1/g)||d!==d&&g!==g}var la=typeof Object.is=="function"?Object.is:vu;function ga(d,g){if(la(d,g))return!0;if(typeof d!="object"||d===null||typeof g!="object"||g===null)return!1;var E=Object.keys(d),D=Object.keys(g);if(E.length!==D.length)return!1;for(D=0;D<E.length;D++){var K=E[D];if(!o.call(g,K)||!la(d[K],g[K]))return!1}return!0}function Go(d){for(;d&&d.firstChild;)d=d.firstChild;return d}function Po(d,g){var E=Go(d);d=0;for(var D;E;){if(E.nodeType===3){if(D=d+E.textContent.length,d<=g&&D>=g)return{node:E,offset:g-d};d=D}e:{for(;E;){if(E.nextSibling){E=E.nextSibling;break e}E=E.parentNode}E=void 0}E=Go(E)}}function Hs(d,g){return d&&g?d===g?!0:d&&d.nodeType===3?!1:g&&g.nodeType===3?Hs(d,g.parentNode):"contains"in d?d.contains(g):d.compareDocumentPosition?!!(d.compareDocumentPosition(g)&16):!1:!1}function ya(){for(var d=window,g=Mn();g instanceof d.HTMLIFrameElement;){try{var E=typeof g.contentWindow.location.href=="string"}catch{E=!1}if(E)d=g.contentWindow;else break;g=Mn(d.document)}return g}function Ol(d){var g=d&&d.nodeName&&d.nodeName.toLowerCase();return g&&(g==="input"&&(d.type==="text"||d.type==="search"||d.type==="tel"||d.type==="url"||d.type==="password")||g==="textarea"||d.contentEditable==="true")}function Dh(d){var g=ya(),E=d.focusedElem,D=d.selectionRange;if(g!==E&&E&&E.ownerDocument&&Hs(E.ownerDocument.documentElement,E)){if(D!==null&&Ol(E)){if(g=D.start,d=D.end,d===void 0&&(d=g),"selectionStart"in E)E.selectionStart=g,E.selectionEnd=Math.min(d,E.value.length);else if(d=(g=E.ownerDocument||document)&&g.defaultView||window,d.getSelection){d=d.getSelection();var K=E.textContent.length,ce=Math.min(D.start,K);D=D.end===void 0?ce:Math.min(D.end,K),!d.extend&&ce>D&&(K=D,D=ce,ce=K),K=Po(E,ce);var Ve=Po(E,D);K&&Ve&&(d.rangeCount!==1||d.anchorNode!==K.node||d.anchorOffset!==K.offset||d.focusNode!==Ve.node||d.focusOffset!==Ve.offset)&&(g=g.createRange(),g.setStart(K.node,K.offset),d.removeAllRanges(),ce>D?(d.addRange(g),d.extend(Ve.node,Ve.offset)):(g.setEnd(Ve.node,Ve.offset),d.addRange(g)))}}for(g=[],d=E;d=d.parentNode;)d.nodeType===1&&g.push({element:d,left:d.scrollLeft,top:d.scrollTop});for(typeof E.focus=="function"&&E.focus(),E=0;E<g.length;E++)d=g[E],d.element.scrollLeft=d.left,d.element.scrollTop=d.top}}var Ju=_&&"documentMode"in document&&11>=document.documentMode,xu=null,Du=null,Uc=null,bh=!1;function Fh(d,g,E){var D=E.window===E?E.document:E.nodeType===9?E:E.ownerDocument;bh||xu==null||xu!==Mn(D)||(D=xu,"selectionStart"in D&&Ol(D)?D={start:D.selectionStart,end:D.selectionEnd}:(D=(D.ownerDocument&&D.ownerDocument.defaultView||window).getSelection(),D={anchorNode:D.anchorNode,anchorOffset:D.anchorOffset,focusNode:D.focusNode,focusOffset:D.focusOffset}),Uc&&ga(Uc,D)||(Uc=D,D=Rs(Du,"onSelect"),0<D.length&&(g=new Sc("onSelect","select",null,g,E),d.push({event:g,listeners:D}),g.target=xu)))}function tl(d,g){var E={};return E[d.toLowerCase()]=g.toLowerCase(),E["Webkit"+d]="webkit"+g,E["Moz"+d]="moz"+g,E}var Tc={animationend:tl("Animation","AnimationEnd"),animationiteration:tl("Animation","AnimationIteration"),animationstart:tl("Animation","AnimationStart"),transitionend:tl("Transition","TransitionEnd")},As={},Bl={};_&&(Bl=document.createElement("div").style,"AnimationEvent"in window||(delete Tc.animationend.animation,delete Tc.animationiteration.animation,delete Tc.animationstart.animation),"TransitionEvent"in window||delete Tc.transitionend.transition);function Ws(d){if(As[d])return As[d];if(!Tc[d])return d;var g=Tc[d],E;for(E in g)if(g.hasOwnProperty(E)&&E in Bl)return As[d]=g[E];return d}var nu=Ws("animationend"),jr=Ws("animationiteration"),Qu=Ws("animationstart"),eh=Ws("transitionend"),Bi=new Map,Tl="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ru(d,g){Bi.set(d,g),u(g,[d])}for(var oc=0;oc<Tl.length;oc++){var xs=Tl[oc],Ba=xs.toLowerCase(),iu=xs[0].toUpperCase()+xs.slice(1);ru(Ba,"on"+iu)}ru(nu,"onAnimationEnd"),ru(jr,"onAnimationIteration"),ru(Qu,"onAnimationStart"),ru("dblclick","onDoubleClick"),ru("focusin","onFocus"),ru("focusout","onBlur"),ru(eh,"onTransitionEnd"),m("onMouseEnter",["mouseout","mouseover"]),m("onMouseLeave",["mouseout","mouseover"]),m("onPointerEnter",["pointerout","pointerover"]),m("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var La="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ar=new Set("cancel close invalid load scroll toggle".split(" ").concat(La));function ml(d,g,E){var D=d.type||"unknown-event";d.currentTarget=E,Wo(D,g,void 0,d),d.currentTarget=null}function _a(d,g){g=(g&4)!==0;for(var E=0;E<d.length;E++){var D=d[E],K=D.event;D=D.listeners;e:{var ce=void 0;if(g)for(var Ve=D.length-1;0<=Ve;Ve--){var Et=D[Ve],Ft=Et.instance,vn=Et.currentTarget;if(Et=Et.listener,Ft!==ce&&K.isPropagationStopped())break e;ml(K,Et,vn),ce=Ft}else for(Ve=0;Ve<D.length;Ve++){if(Et=D[Ve],Ft=Et.instance,vn=Et.currentTarget,Et=Et.listener,Ft!==ce&&K.isPropagationStopped())break e;ml(K,Et,vn),ce=Ft}}}if(wr)throw d=Ei,wr=!1,Ei=null,d}function Bo(d,g){var E=g[zl];E===void 0&&(E=g[zl]=new Set);var D=d+"__bubble";E.has(D)||(Ii(g,d,2,!1),E.add(D))}function Fu(d,g,E){var D=0;g&&(D|=4),Ii(E,d,D,g)}var Ic="_reactListening"+Math.random().toString(36).slice(2);function sc(d){if(!d[Ic]){d[Ic]=!0,i.forEach(function(E){E!=="selectionchange"&&(Ar.has(E)||Fu(E,!1,d),Fu(E,!0,d))});var g=d.nodeType===9?d:d.ownerDocument;g===null||g[Ic]||(g[Ic]=!0,Fu("selectionchange",!1,g))}}function Ii(d,g,E,D){switch(wc(g)){case 1:var K=Xo;break;case 4:K=pa;break;default:K=Ja}E=K.bind(null,g,E,d),K=void 0,!On||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(K=!0),D?K!==void 0?d.addEventListener(g,E,{capture:!0,passive:K}):d.addEventListener(g,E,!0):K!==void 0?d.addEventListener(g,E,{passive:K}):d.addEventListener(g,E,!1)}function za(d,g,E,D,K){var ce=D;if((g&1)===0&&(g&2)===0&&D!==null)e:for(;;){if(D===null)return;var Ve=D.tag;if(Ve===3||Ve===4){var Et=D.stateNode.containerInfo;if(Et===K||Et.nodeType===8&&Et.parentNode===K)break;if(Ve===4)for(Ve=D.return;Ve!==null;){var Ft=Ve.tag;if((Ft===3||Ft===4)&&(Ft=Ve.stateNode.containerInfo,Ft===K||Ft.nodeType===8&&Ft.parentNode===K))return;Ve=Ve.return}for(;Et!==null;){if(Ve=ka(Et),Ve===null)return;if(Ft=Ve.tag,Ft===5||Ft===6){D=ce=Ve;continue e}Et=Et.parentNode}}D=D.return}Lt(function(){var vn=ce,nr=li(E),cr=[];e:{var Kn=Bi.get(d);if(Kn!==void 0){var Gr=Sc,si=d;switch(d){case"keypress":if(ia(E)===0)break e;case"keydown":case"keyup":Gr=se;break;case"focusin":si="focus",Gr=Ti;break;case"focusout":si="blur",Gr=Ti;break;case"beforeblur":case"afterblur":Gr=Ti;break;case"click":if(E.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Gr=Fn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Gr=$r;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Gr=fn;break;case nu:case jr:case Qu:Gr=_o;break;case eh:Gr=ao;break;case"scroll":Gr=Ce;break;case"wheel":Gr=qi;break;case"copy":case"cut":case"paste":Gr=Mo;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Gr=He}var fi=(g&4)!==0,Ll=!fi&&d==="scroll",an=fi?Kn!==null?Kn+"Capture":null:Kn;fi=[];for(var Ht=vn,mn;Ht!==null;){mn=Ht;var gr=mn.stateNode;if(mn.tag===5&&gr!==null&&(mn=gr,an!==null&&(gr=xn(Ht,an),gr!=null&&fi.push(Un(Ht,gr,mn)))),Ll)break;Ht=Ht.return}0<fi.length&&(Kn=new Gr(Kn,si,null,E,nr),cr.push({event:Kn,listeners:fi}))}}if((g&7)===0){e:{if(Kn=d==="mouseover"||d==="pointerover",Gr=d==="mouseout"||d==="pointerout",Kn&&E!==hi&&(si=E.relatedTarget||E.fromElement)&&(ka(si)||si[xa]))break e;if((Gr||Kn)&&(Kn=nr.window===nr?nr:(Kn=nr.ownerDocument)?Kn.defaultView||Kn.parentWindow:window,Gr?(si=E.relatedTarget||E.toElement,Gr=vn,si=si?ka(si):null,si!==null&&(Ll=no(si),si!==Ll||si.tag!==5&&si.tag!==6)&&(si=null)):(Gr=null,si=vn),Gr!==si)){if(fi=Fn,gr="onMouseLeave",an="onMouseEnter",Ht="mouse",(d==="pointerout"||d==="pointerover")&&(fi=He,gr="onPointerLeave",an="onPointerEnter",Ht="pointer"),Ll=Gr==null?Kn:su(Gr),mn=si==null?Kn:su(si),Kn=new fi(gr,Ht+"leave",Gr,E,nr),Kn.target=Ll,Kn.relatedTarget=mn,gr=null,ka(nr)===vn&&(fi=new fi(an,Ht+"enter",si,E,nr),fi.target=mn,fi.relatedTarget=Ll,gr=fi),Ll=gr,Gr&&si)t:{for(fi=Gr,an=si,Ht=0,mn=fi;mn;mn=Ns(mn))Ht++;for(mn=0,gr=an;gr;gr=Ns(gr))mn++;for(;0<Ht-mn;)fi=Ns(fi),Ht--;for(;0<mn-Ht;)an=Ns(an),mn--;for(;Ht--;){if(fi===an||an!==null&&fi===an.alternate)break t;fi=Ns(fi),an=Ns(an)}fi=null}else fi=null;Gr!==null&&lo(cr,Kn,Gr,fi,!1),si!==null&&Ll!==null&&lo(cr,Ll,si,fi,!0)}}e:{if(Kn=vn?su(vn):window,Gr=Kn.nodeName&&Kn.nodeName.toLowerCase(),Gr==="select"||Gr==="input"&&Kn.type==="file")var pi=rc;else if(Dl(Kn))if(fl)pi=vs;else{pi=Fl;var Ri=ic}else(Gr=Kn.nodeName)&&Gr.toLowerCase()==="input"&&(Kn.type==="checkbox"||Kn.type==="radio")&&(pi=_u);if(pi&&(pi=pi(d,vn))){Ec(cr,pi,E,nr);break e}Ri&&Ri(d,Kn,vn),d==="focusout"&&(Ri=Kn._wrapperState)&&Ri.controlled&&Kn.type==="number"&&Cn(Kn,"number",Kn.value)}switch(Ri=vn?su(vn):window,d){case"focusin":(Dl(Ri)||Ri.contentEditable==="true")&&(xu=Ri,Du=vn,Uc=null);break;case"focusout":Uc=Du=xu=null;break;case"mousedown":bh=!0;break;case"contextmenu":case"mouseup":case"dragend":bh=!1,Fh(cr,E,nr);break;case"selectionchange":if(Ju)break;case"keydown":case"keyup":Fh(cr,E,nr)}var Ni;if(Ro)e:{switch(d){case"compositionstart":var eo="onCompositionStart";break e;case"compositionend":eo="onCompositionEnd";break e;case"compositionupdate":eo="onCompositionUpdate";break e}eo=void 0}else Nl?Ru(d,E)&&(eo="onCompositionEnd"):d==="keydown"&&E.keyCode===229&&(eo="onCompositionStart");eo&&(Ji&&E.locale!=="ko"&&(Nl||eo!=="onCompositionStart"?eo==="onCompositionEnd"&&Nl&&(Ni=qs()):(Vs=nr,Ai="value"in Vs?Vs.value:Vs.textContent,Nl=!0)),Ri=Rs(vn,eo),0<Ri.length&&(eo=new es(eo,d,null,E,nr),cr.push({event:eo,listeners:Ri}),Ni?eo.data=Ni:(Ni=hl(E),Ni!==null&&(eo.data=Ni)))),(Ni=Oo?dl(d,E):No(d,E))&&(vn=Rs(vn,"onBeforeInput"),0<vn.length&&(nr=new es("onBeforeInput","beforeinput",null,E,nr),cr.push({event:nr,listeners:vn}),nr.data=Ni))}_a(cr,g)})}function Un(d,g,E){return{instance:d,listener:g,currentTarget:E}}function Rs(d,g){for(var E=g+"Capture",D=[];d!==null;){var K=d,ce=K.stateNode;K.tag===5&&ce!==null&&(K=ce,ce=xn(d,E),ce!=null&&D.unshift(Un(d,ce,K)),ce=xn(d,g),ce!=null&&D.push(Un(d,ce,K))),d=d.return}return D}function Ns(d){if(d===null)return null;do d=d.return;while(d&&d.tag!==5);return d||null}function lo(d,g,E,D,K){for(var ce=g._reactName,Ve=[];E!==null&&E!==D;){var Et=E,Ft=Et.alternate,vn=Et.stateNode;if(Ft!==null&&Ft===D)break;Et.tag===5&&vn!==null&&(Et=vn,K?(Ft=xn(E,ce),Ft!=null&&Ve.unshift(Un(E,Ft,Et))):K||(Ft=xn(E,ce),Ft!=null&&Ve.push(Un(E,Ft,Et)))),E=E.return}Ve.length!==0&&d.push({event:g,listeners:Ve})}var va=/\r\n?/g,gl=/\u0000|\uFFFD/g;function Jh(d){return(typeof d=="string"?d:""+d).replace(va,`
`).replace(gl,"")}function ii(d,g,E){if(g=Jh(g),Jh(d)!==g&&E)throw Error(t(425))}function bu(){}var th=null,Ks=null;function Pa(d,g){return d==="textarea"||d==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var Vc=typeof setTimeout=="function"?setTimeout:void 0,ac=typeof clearTimeout=="function"?clearTimeout:void 0,Qh=typeof Promise=="function"?Promise:void 0,Zf=typeof queueMicrotask=="function"?queueMicrotask:typeof Qh<"u"?function(d){return Qh.resolve(null).then(d).catch(nh)}:Vc;function nh(d){setTimeout(function(){throw d})}function vo(d,g){var E=g,D=0;do{var K=E.nextSibling;if(d.removeChild(E),K&&K.nodeType===8)if(E=K.data,E==="/$"){if(D===0){d.removeChild(K),Us(g);return}D--}else E!=="$"&&E!=="$?"&&E!=="$!"||D++;E=K}while(E);Us(g)}function ca(d){for(;d!=null;d=d.nextSibling){var g=d.nodeType;if(g===1||g===3)break;if(g===8){if(g=d.data,g==="$"||g==="$!"||g==="$?")break;if(g==="/$")return null}}return d}function ja(d){d=d.previousSibling;for(var g=0;d;){if(d.nodeType===8){var E=d.data;if(E==="$"||E==="$!"||E==="$?"){if(g===0)return d;g--}else E==="/$"&&g++}d=d.previousSibling}return null}var nl=Math.random().toString(36).slice(2),xo="__reactFiber$"+nl,ou="__reactProps$"+nl,xa="__reactContainer$"+nl,zl="__reactEvents$"+nl,Oh="__reactListeners$"+nl,jl="__reactHandles$"+nl;function ka(d){var g=d[xo];if(g)return g;for(var E=d.parentNode;E;){if(g=E[xa]||E[xo]){if(E=g.alternate,g.child!==null||E!==null&&E.child!==null)for(d=ja(d);d!==null;){if(E=d[xo])return E;d=ja(d)}return g}d=E,E=d.parentNode}return null}function wh(d){return d=d[xo]||d[xa],!d||d.tag!==5&&d.tag!==6&&d.tag!==13&&d.tag!==3?null:d}function su(d){if(d.tag===5||d.tag===6)return d.stateNode;throw Error(t(33))}function Cc(d){return d[ou]||null}var Bh=[],Lc=-1;function lc(d){return{current:d}}function Ao(d){0>Lc||(d.current=Bh[Lc],Bh[Lc]=null,Lc--)}function $i(d,g){Lc++,Bh[Lc]=d.current,d.current=g}var Ou={},Ua=lc(Ou),yl=lc(!1),qc=Ou;function rl(d,g){var E=d.type.contextTypes;if(!E)return Ou;var D=d.stateNode;if(D&&D.__reactInternalMemoizedUnmaskedChildContext===g)return D.__reactInternalMemoizedMaskedChildContext;var K={},ce;for(ce in E)K[ce]=g[ce];return D&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=g,d.__reactInternalMemoizedMaskedChildContext=K),K}function _l(d){return d=d.childContextTypes,d!=null}function Sh(){Ao(yl),Ao(Ua)}function Ul(d,g,E){if(Ua.current!==Ou)throw Error(t(168));$i(Ua,g),$i(yl,E)}function Vl(d,g,E){var D=d.stateNode;if(g=g.childContextTypes,typeof D.getChildContext!="function")return E;D=D.getChildContext();for(var K in D)if(!(K in g))throw Error(t(108,mt(d)||"Unknown",K));return nt({},E,D)}function cc(d){return d=(d=d.stateNode)&&d.__reactInternalMemoizedMergedChildContext||Ou,qc=Ua.current,$i(Ua,d),$i(yl,yl.current),!0}function zh(d,g,E){var D=d.stateNode;if(!D)throw Error(t(169));E?(d=Vl(d,g,qc),D.__reactInternalMemoizedMergedChildContext=d,Ao(yl),Ao(Ua),$i(Ua,d)):Ao(yl),$i(yl,E)}var lr=null,$c=!1,C=!1;function B(d){lr===null?lr=[d]:lr.push(d)}function ee(d){$c=!0,B(d)}function oe(){if(!C&&lr!==null){C=!0;var d=0,g=ji;try{var E=lr;for(ji=1;d<E.length;d++){var D=E[d];do D=D(!0);while(D!==null)}lr=null,$c=!1}catch(K){throw lr!==null&&(lr=lr.slice(d+1)),al(Ea,oe),K}finally{ji=g,C=!1}}return null}var Pe=[],je=0,Ke=null,Ye=0,tt=[],ut=0,Nt=null,rn=1,ft="";function zt(d,g){Pe[je++]=Ye,Pe[je++]=Ke,Ke=d,Ye=g}function Jt(d,g,E){tt[ut++]=rn,tt[ut++]=ft,tt[ut++]=Nt,Nt=d;var D=rn;d=ft;var K=32-Yo(D)-1;D&=~(1<<K),E+=1;var ce=32-Yo(g)+K;if(30<ce){var Ve=K-K%5;ce=(D&(1<<Ve)-1).toString(32),D>>=Ve,K-=Ve,rn=1<<32-Yo(g)+K|E<<K|D,ft=ce+d}else rn=1<<ce|E<<K|D,ft=d}function En(d){d.return!==null&&(zt(d,1),Jt(d,1,0))}function y(d){for(;d===Ke;)Ke=Pe[--je],Pe[je]=null,Ye=Pe[--je],Pe[je]=null;for(;d===Nt;)Nt=tt[--ut],tt[ut]=null,ft=tt[--ut],tt[ut]=null,rn=tt[--ut],tt[ut]=null}var a=null,f=null,v=!1,S=null;function T(d,g){var E=Wc(5,null,null,0);E.elementType="DELETED",E.stateNode=g,E.return=d,g=d.deletions,g===null?(d.deletions=[E],d.flags|=16):g.push(E)}function N(d,g){switch(d.tag){case 5:var E=d.type;return g=g.nodeType!==1||E.toLowerCase()!==g.nodeName.toLowerCase()?null:g,g!==null?(d.stateNode=g,a=d,f=ca(g.firstChild),!0):!1;case 6:return g=d.pendingProps===""||g.nodeType!==3?null:g,g!==null?(d.stateNode=g,a=d,f=null,!0):!1;case 13:return g=g.nodeType!==8?null:g,g!==null?(E=Nt!==null?{id:rn,overflow:ft}:null,d.memoizedState={dehydrated:g,treeContext:E,retryLane:1073741824},E=Wc(18,null,null,0),E.stateNode=g,E.return=d,d.child=E,a=d,f=null,!0):!1;default:return!1}}function z(d){return(d.mode&1)!==0&&(d.flags&128)===0}function $(d){if(v){var g=f;if(g){var E=g;if(!N(d,g)){if(z(d))throw Error(t(418));g=ca(E.nextSibling);var D=a;g&&N(d,g)?T(D,E):(d.flags=d.flags&-4097|2,v=!1,a=d)}}else{if(z(d))throw Error(t(418));d.flags=d.flags&-4097|2,v=!1,a=d}}}function Q(d){for(d=d.return;d!==null&&d.tag!==5&&d.tag!==3&&d.tag!==13;)d=d.return;a=d}function te(d){if(d!==a)return!1;if(!v)return Q(d),v=!0,!1;var g;if((g=d.tag!==3)&&!(g=d.tag!==5)&&(g=d.type,g=g!=="head"&&g!=="body"&&!Pa(d.type,d.memoizedProps)),g&&(g=f)){if(z(d))throw ge(),Error(t(418));for(;g;)T(d,g),g=ca(g.nextSibling)}if(Q(d),d.tag===13){if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(t(317));e:{for(d=d.nextSibling,g=0;d;){if(d.nodeType===8){var E=d.data;if(E==="/$"){if(g===0){f=ca(d.nextSibling);break e}g--}else E!=="$"&&E!=="$!"&&E!=="$?"||g++}d=d.nextSibling}f=null}}else f=a?ca(d.stateNode.nextSibling):null;return!0}function ge(){for(var d=f;d;)d=ca(d.nextSibling)}function Ae(){f=a=null,v=!1}function Le(d){S===null?S=[d]:S.push(d)}var Ze=ue.ReactCurrentBatchConfig;function Ue(d,g,E){if(d=E.ref,d!==null&&typeof d!="function"&&typeof d!="object"){if(E._owner){if(E=E._owner,E){if(E.tag!==1)throw Error(t(309));var D=E.stateNode}if(!D)throw Error(t(147,d));var K=D,ce=""+d;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===ce?g.ref:(g=function(Ve){var Et=K.refs;Ve===null?delete Et[ce]:Et[ce]=Ve},g._stringRef=ce,g)}if(typeof d!="string")throw Error(t(284));if(!E._owner)throw Error(t(290,d))}return d}function Xe(d,g){throw d=Object.prototype.toString.call(g),Error(t(31,d==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":d))}function _e(d){var g=d._init;return g(d._payload)}function Ge(d){function g(an,Ht){if(d){var mn=an.deletions;mn===null?(an.deletions=[Ht],an.flags|=16):mn.push(Ht)}}function E(an,Ht){if(!d)return null;for(;Ht!==null;)g(an,Ht),Ht=Ht.sibling;return null}function D(an,Ht){for(an=new Map;Ht!==null;)Ht.key!==null?an.set(Ht.key,Ht):an.set(Ht.index,Ht),Ht=Ht.sibling;return an}function K(an,Ht){return an=_f(an,Ht),an.index=0,an.sibling=null,an}function ce(an,Ht,mn){return an.index=mn,d?(mn=an.alternate,mn!==null?(mn=mn.index,mn<Ht?(an.flags|=2,Ht):mn):(an.flags|=2,Ht)):(an.flags|=1048576,Ht)}function Ve(an){return d&&an.alternate===null&&(an.flags|=2),an}function Et(an,Ht,mn,gr){return Ht===null||Ht.tag!==6?(Ht=Y0(mn,an.mode,gr),Ht.return=an,Ht):(Ht=K(Ht,mn),Ht.return=an,Ht)}function Ft(an,Ht,mn,gr){var pi=mn.type;return pi===pe?nr(an,Ht,mn.props.children,gr,mn.key):Ht!==null&&(Ht.elementType===pi||typeof pi=="object"&&pi!==null&&pi.$$typeof===Be&&_e(pi)===Ht.type)?(gr=K(Ht,mn.props),gr.ref=Ue(an,Ht,mn),gr.return=an,gr):(gr=Tg(mn.type,mn.key,mn.props,null,an.mode,gr),gr.ref=Ue(an,Ht,mn),gr.return=an,gr)}function vn(an,Ht,mn,gr){return Ht===null||Ht.tag!==4||Ht.stateNode.containerInfo!==mn.containerInfo||Ht.stateNode.implementation!==mn.implementation?(Ht=J0(mn,an.mode,gr),Ht.return=an,Ht):(Ht=K(Ht,mn.children||[]),Ht.return=an,Ht)}function nr(an,Ht,mn,gr,pi){return Ht===null||Ht.tag!==7?(Ht=sp(mn,an.mode,gr,pi),Ht.return=an,Ht):(Ht=K(Ht,mn),Ht.return=an,Ht)}function cr(an,Ht,mn){if(typeof Ht=="string"&&Ht!==""||typeof Ht=="number")return Ht=Y0(""+Ht,an.mode,mn),Ht.return=an,Ht;if(typeof Ht=="object"&&Ht!==null){switch(Ht.$$typeof){case ke:return mn=Tg(Ht.type,Ht.key,Ht.props,null,an.mode,mn),mn.ref=Ue(an,null,Ht),mn.return=an,mn;case ze:return Ht=J0(Ht,an.mode,mn),Ht.return=an,Ht;case Be:var gr=Ht._init;return cr(an,gr(Ht._payload),mn)}if(ir(Ht)||De(Ht))return Ht=sp(Ht,an.mode,mn,null),Ht.return=an,Ht;Xe(an,Ht)}return null}function Kn(an,Ht,mn,gr){var pi=Ht!==null?Ht.key:null;if(typeof mn=="string"&&mn!==""||typeof mn=="number")return pi!==null?null:Et(an,Ht,""+mn,gr);if(typeof mn=="object"&&mn!==null){switch(mn.$$typeof){case ke:return mn.key===pi?Ft(an,Ht,mn,gr):null;case ze:return mn.key===pi?vn(an,Ht,mn,gr):null;case Be:return pi=mn._init,Kn(an,Ht,pi(mn._payload),gr)}if(ir(mn)||De(mn))return pi!==null?null:nr(an,Ht,mn,gr,null);Xe(an,mn)}return null}function Gr(an,Ht,mn,gr,pi){if(typeof gr=="string"&&gr!==""||typeof gr=="number")return an=an.get(mn)||null,Et(Ht,an,""+gr,pi);if(typeof gr=="object"&&gr!==null){switch(gr.$$typeof){case ke:return an=an.get(gr.key===null?mn:gr.key)||null,Ft(Ht,an,gr,pi);case ze:return an=an.get(gr.key===null?mn:gr.key)||null,vn(Ht,an,gr,pi);case Be:var Ri=gr._init;return Gr(an,Ht,mn,Ri(gr._payload),pi)}if(ir(gr)||De(gr))return an=an.get(mn)||null,nr(Ht,an,gr,pi,null);Xe(Ht,gr)}return null}function si(an,Ht,mn,gr){for(var pi=null,Ri=null,Ni=Ht,eo=Ht=0,Kc=null;Ni!==null&&eo<mn.length;eo++){Ni.index>eo?(Kc=Ni,Ni=null):Kc=Ni.sibling;var rs=Kn(an,Ni,mn[eo],gr);if(rs===null){Ni===null&&(Ni=Kc);break}d&&Ni&&rs.alternate===null&&g(an,Ni),Ht=ce(rs,Ht,eo),Ri===null?pi=rs:Ri.sibling=rs,Ri=rs,Ni=Kc}if(eo===mn.length)return E(an,Ni),v&&zt(an,eo),pi;if(Ni===null){for(;eo<mn.length;eo++)Ni=cr(an,mn[eo],gr),Ni!==null&&(Ht=ce(Ni,Ht,eo),Ri===null?pi=Ni:Ri.sibling=Ni,Ri=Ni);return v&&zt(an,eo),pi}for(Ni=D(an,Ni);eo<mn.length;eo++)Kc=Gr(Ni,an,eo,mn[eo],gr),Kc!==null&&(d&&Kc.alternate!==null&&Ni.delete(Kc.key===null?eo:Kc.key),Ht=ce(Kc,Ht,eo),Ri===null?pi=Kc:Ri.sibling=Kc,Ri=Kc);return d&&Ni.forEach(function(Gh){return g(an,Gh)}),v&&zt(an,eo),pi}function fi(an,Ht,mn,gr){var pi=De(mn);if(typeof pi!="function")throw Error(t(150));if(mn=pi.call(mn),mn==null)throw Error(t(151));for(var Ri=pi=null,Ni=Ht,eo=Ht=0,Kc=null,rs=mn.next();Ni!==null&&!rs.done;eo++,rs=mn.next()){Ni.index>eo?(Kc=Ni,Ni=null):Kc=Ni.sibling;var Gh=Kn(an,Ni,rs.value,gr);if(Gh===null){Ni===null&&(Ni=Kc);break}d&&Ni&&Gh.alternate===null&&g(an,Ni),Ht=ce(Gh,Ht,eo),Ri===null?pi=Gh:Ri.sibling=Gh,Ri=Gh,Ni=Kc}if(rs.done)return E(an,Ni),v&&zt(an,eo),pi;if(Ni===null){for(;!rs.done;eo++,rs=mn.next())rs=cr(an,rs.value,gr),rs!==null&&(Ht=ce(rs,Ht,eo),Ri===null?pi=rs:Ri.sibling=rs,Ri=rs);return v&&zt(an,eo),pi}for(Ni=D(an,Ni);!rs.done;eo++,rs=mn.next())rs=Gr(Ni,an,eo,rs.value,gr),rs!==null&&(d&&rs.alternate!==null&&Ni.delete(rs.key===null?eo:rs.key),Ht=ce(rs,Ht,eo),Ri===null?pi=rs:Ri.sibling=rs,Ri=rs);return d&&Ni.forEach(function(V_){return g(an,V_)}),v&&zt(an,eo),pi}function Ll(an,Ht,mn,gr){if(typeof mn=="object"&&mn!==null&&mn.type===pe&&mn.key===null&&(mn=mn.props.children),typeof mn=="object"&&mn!==null){switch(mn.$$typeof){case ke:e:{for(var pi=mn.key,Ri=Ht;Ri!==null;){if(Ri.key===pi){if(pi=mn.type,pi===pe){if(Ri.tag===7){E(an,Ri.sibling),Ht=K(Ri,mn.props.children),Ht.return=an,an=Ht;break e}}else if(Ri.elementType===pi||typeof pi=="object"&&pi!==null&&pi.$$typeof===Be&&_e(pi)===Ri.type){E(an,Ri.sibling),Ht=K(Ri,mn.props),Ht.ref=Ue(an,Ri,mn),Ht.return=an,an=Ht;break e}E(an,Ri);break}else g(an,Ri);Ri=Ri.sibling}mn.type===pe?(Ht=sp(mn.props.children,an.mode,gr,mn.key),Ht.return=an,an=Ht):(gr=Tg(mn.type,mn.key,mn.props,null,an.mode,gr),gr.ref=Ue(an,Ht,mn),gr.return=an,an=gr)}return Ve(an);case ze:e:{for(Ri=mn.key;Ht!==null;){if(Ht.key===Ri)if(Ht.tag===4&&Ht.stateNode.containerInfo===mn.containerInfo&&Ht.stateNode.implementation===mn.implementation){E(an,Ht.sibling),Ht=K(Ht,mn.children||[]),Ht.return=an,an=Ht;break e}else{E(an,Ht);break}else g(an,Ht);Ht=Ht.sibling}Ht=J0(mn,an.mode,gr),Ht.return=an,an=Ht}return Ve(an);case Be:return Ri=mn._init,Ll(an,Ht,Ri(mn._payload),gr)}if(ir(mn))return si(an,Ht,mn,gr);if(De(mn))return fi(an,Ht,mn,gr);Xe(an,mn)}return typeof mn=="string"&&mn!==""||typeof mn=="number"?(mn=""+mn,Ht!==null&&Ht.tag===6?(E(an,Ht.sibling),Ht=K(Ht,mn),Ht.return=an,an=Ht):(E(an,Ht),Ht=Y0(mn,an.mode,gr),Ht.return=an,an=Ht),Ve(an)):E(an,Ht)}return Ll}var it=Ge(!0),ot=Ge(!1),bt=lc(null),wt=null,_t=null,Pt=null;function kt(){Pt=_t=wt=null}function jt(d){var g=bt.current;Ao(bt),d._currentValue=g}function _n(d,g,E){for(;d!==null;){var D=d.alternate;if((d.childLanes&g)!==g?(d.childLanes|=g,D!==null&&(D.childLanes|=g)):D!==null&&(D.childLanes&g)!==g&&(D.childLanes|=g),d===E)break;d=d.return}}function Ut(d,g){wt=d,Pt=_t=null,d=d.dependencies,d!==null&&d.firstContext!==null&&((d.lanes&g)!==0&&(Fe=!0),d.firstContext=null)}function cn(d){var g=d._currentValue;if(Pt!==d)if(d={context:d,memoizedValue:g,next:null},_t===null){if(wt===null)throw Error(t(308));_t=d,wt.dependencies={lanes:0,firstContext:d}}else _t=_t.next=d;return g}var Wt=null;function In(d){Wt===null?Wt=[d]:Wt.push(d)}function Bt(d,g,E,D){var K=g.interleaved;return K===null?(E.next=E,In(g)):(E.next=K.next,K.next=E),g.interleaved=E,Yt(d,D)}function Yt(d,g){d.lanes|=g;var E=d.alternate;for(E!==null&&(E.lanes|=g),E=d,d=d.return;d!==null;)d.childLanes|=g,E=d.alternate,E!==null&&(E.childLanes|=g),E=d,d=d.return;return E.tag===3?E.stateNode:null}var Tn=!1;function bn(d){d.updateQueue={baseState:d.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Rn(d,g){d=d.updateQueue,g.updateQueue===d&&(g.updateQueue={baseState:d.baseState,firstBaseUpdate:d.firstBaseUpdate,lastBaseUpdate:d.lastBaseUpdate,shared:d.shared,effects:d.effects})}function hr(d,g){return{eventTime:d,lane:g,tag:0,payload:null,callback:null,next:null}}function mr(d,g,E){var D=d.updateQueue;if(D===null)return null;if(D=D.shared,(ti&2)!==0){var K=D.pending;return K===null?g.next=g:(g.next=K.next,K.next=g),D.pending=g,Yt(d,E)}return K=D.interleaved,K===null?(g.next=g,In(D)):(g.next=K.next,K.next=g),D.interleaved=g,Yt(d,E)}function sr(d,g,E){if(g=g.updateQueue,g!==null&&(g=g.shared,(E&4194240)!==0)){var D=g.lanes;D&=d.pendingLanes,E|=D,g.lanes=E,El(d,E)}}function dr(d,g){var E=d.updateQueue,D=d.alternate;if(D!==null&&(D=D.updateQueue,E===D)){var K=null,ce=null;if(E=E.firstBaseUpdate,E!==null){do{var Ve={eventTime:E.eventTime,lane:E.lane,tag:E.tag,payload:E.payload,callback:E.callback,next:null};ce===null?K=ce=Ve:ce=ce.next=Ve,E=E.next}while(E!==null);ce===null?K=ce=g:ce=ce.next=g}else K=ce=g;E={baseState:D.baseState,firstBaseUpdate:K,lastBaseUpdate:ce,shared:D.shared,effects:D.effects},d.updateQueue=E;return}d=E.lastBaseUpdate,d===null?E.firstBaseUpdate=g:d.next=g,E.lastBaseUpdate=g}function oi(d,g,E,D){var K=d.updateQueue;Tn=!1;var ce=K.firstBaseUpdate,Ve=K.lastBaseUpdate,Et=K.shared.pending;if(Et!==null){K.shared.pending=null;var Ft=Et,vn=Ft.next;Ft.next=null,Ve===null?ce=vn:Ve.next=vn,Ve=Ft;var nr=d.alternate;nr!==null&&(nr=nr.updateQueue,Et=nr.lastBaseUpdate,Et!==Ve&&(Et===null?nr.firstBaseUpdate=vn:Et.next=vn,nr.lastBaseUpdate=Ft))}if(ce!==null){var cr=K.baseState;Ve=0,nr=vn=Ft=null,Et=ce;do{var Kn=Et.lane,Gr=Et.eventTime;if((D&Kn)===Kn){nr!==null&&(nr=nr.next={eventTime:Gr,lane:0,tag:Et.tag,payload:Et.payload,callback:Et.callback,next:null});e:{var si=d,fi=Et;switch(Kn=g,Gr=E,fi.tag){case 1:if(si=fi.payload,typeof si=="function"){cr=si.call(Gr,cr,Kn);break e}cr=si;break e;case 3:si.flags=si.flags&-65537|128;case 0:if(si=fi.payload,Kn=typeof si=="function"?si.call(Gr,cr,Kn):si,Kn==null)break e;cr=nt({},cr,Kn);break e;case 2:Tn=!0}}Et.callback!==null&&Et.lane!==0&&(d.flags|=64,Kn=K.effects,Kn===null?K.effects=[Et]:Kn.push(Et))}else Gr={eventTime:Gr,lane:Kn,tag:Et.tag,payload:Et.payload,callback:Et.callback,next:null},nr===null?(vn=nr=Gr,Ft=cr):nr=nr.next=Gr,Ve|=Kn;if(Et=Et.next,Et===null){if(Et=K.shared.pending,Et===null)break;Kn=Et,Et=Kn.next,Kn.next=null,K.lastBaseUpdate=Kn,K.shared.pending=null}}while(!0);if(nr===null&&(Ft=cr),K.baseState=Ft,K.firstBaseUpdate=vn,K.lastBaseUpdate=nr,g=K.shared.interleaved,g!==null){K=g;do Ve|=K.lane,K=K.next;while(K!==g)}else ce===null&&(K.shared.lanes=0);Ra|=Ve,d.lanes=Ve,d.memoizedState=cr}}function di(d,g,E){if(d=g.effects,g.effects=null,d!==null)for(g=0;g<d.length;g++){var D=d[g],K=D.callback;if(K!==null){if(D.callback=null,D=E,typeof K!="function")throw Error(t(191,K));K.call(D)}}}var _r={},Zr=lc(_r),Pi=lc(_r),io=lc(_r);function oo(d){if(d===_r)throw Error(t(174));return d}function ua(d,g){switch($i(io,g),$i(Pi,d),$i(Zr,_r),d=g.nodeType,d){case 9:case 11:g=(g=g.documentElement)?g.namespaceURI:Mr(null,"");break;default:d=d===8?g.parentNode:g,g=d.namespaceURI||null,d=d.tagName,g=Mr(g,d)}Ao(Zr),$i(Zr,g)}function us(){Ao(Zr),Ao(Pi),Ao(io)}function uc(d){oo(io.current);var g=oo(Zr.current),E=Mr(g,d.type);g!==E&&($i(Pi,d),$i(Zr,E))}function Pc(d){Pi.current===d&&(Ao(Zr),Ao(Pi))}var Ci=lc(0);function Qi(d){for(var g=d;g!==null;){if(g.tag===13){var E=g.memoizedState;if(E!==null&&(E=E.dehydrated,E===null||E.data==="$?"||E.data==="$!"))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===d)break;for(;g.sibling===null;){if(g.return===null||g.return===d)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var bo=[];function Ts(){for(var d=0;d<bo.length;d++)bo[d]._workInProgressVersionPrimary=null;bo.length=0}var Va=ue.ReactCurrentDispatcher,ts=ue.ReactCurrentBatchConfig,ps=0,hs=null,bs=null,zo=null,ql=!1,Il=!1,Gc=0,_d=0;function Xs(){throw Error(t(321))}function jh(d,g){if(g===null)return!1;for(var E=0;E<g.length&&E<d.length;E++)if(!la(d[E],g[E]))return!1;return!0}function vd(d,g,E,D,K,ce){if(ps=ce,hs=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,Va.current=d===null||d.memoizedState===null?Mp:bd,d=E(D,K),Il){ce=0;do{if(Il=!1,Gc=0,25<=ce)throw Error(t(301));ce+=1,zo=bs=null,g.updateQueue=null,Va.current=Rc,d=E(D,K)}while(Il)}if(Va.current=il,g=bs!==null&&bs.next!==null,ps=0,zo=bs=hs=null,ql=!1,g)throw Error(t(300));return d}function Bu(){var d=Gc!==0;return Gc=0,d}function au(){var d={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return zo===null?hs.memoizedState=zo=d:zo=zo.next=d,zo}function hc(){if(bs===null){var d=hs.alternate;d=d!==null?d.memoizedState:null}else d=bs.next;var g=zo===null?hs.memoizedState:zo.next;if(g!==null)zo=g,bs=d;else{if(d===null)throw Error(t(310));bs=d,d={memoizedState:bs.memoizedState,baseState:bs.baseState,baseQueue:bs.baseQueue,queue:bs.queue,next:null},zo===null?hs.memoizedState=zo=d:zo=zo.next=d}return zo}function Uh(d,g){return typeof g=="function"?g(d):g}function Eh(d){var g=hc(),E=g.queue;if(E===null)throw Error(t(311));E.lastRenderedReducer=d;var D=bs,K=D.baseQueue,ce=E.pending;if(ce!==null){if(K!==null){var Ve=K.next;K.next=ce.next,ce.next=Ve}D.baseQueue=K=ce,E.pending=null}if(K!==null){ce=K.next,D=D.baseState;var Et=Ve=null,Ft=null,vn=ce;do{var nr=vn.lane;if((ps&nr)===nr)Ft!==null&&(Ft=Ft.next={lane:0,action:vn.action,hasEagerState:vn.hasEagerState,eagerState:vn.eagerState,next:null}),D=vn.hasEagerState?vn.eagerState:d(D,vn.action);else{var cr={lane:nr,action:vn.action,hasEagerState:vn.hasEagerState,eagerState:vn.eagerState,next:null};Ft===null?(Et=Ft=cr,Ve=D):Ft=Ft.next=cr,hs.lanes|=nr,Ra|=nr}vn=vn.next}while(vn!==null&&vn!==ce);Ft===null?Ve=D:Ft.next=Et,la(D,g.memoizedState)||(Fe=!0),g.memoizedState=D,g.baseState=Ve,g.baseQueue=Ft,E.lastRenderedState=D}if(d=E.interleaved,d!==null){K=d;do ce=K.lane,hs.lanes|=ce,Ra|=ce,K=K.next;while(K!==d)}else K===null&&(E.lanes=0);return[g.memoizedState,E.dispatch]}function dc(d){var g=hc(),E=g.queue;if(E===null)throw Error(t(311));E.lastRenderedReducer=d;var D=E.dispatch,K=E.pending,ce=g.memoizedState;if(K!==null){E.pending=null;var Ve=K=K.next;do ce=d(ce,Ve.action),Ve=Ve.next;while(Ve!==K);la(ce,g.memoizedState)||(Fe=!0),g.memoizedState=ce,g.baseQueue===null&&(g.baseState=ce),E.lastRenderedState=ce}return[ce,D]}function ed(){}function lu(d,g){var E=hs,D=hc(),K=g(),ce=!la(D.memoizedState,K);if(ce&&(D.memoizedState=K,Fe=!0),D=D.queue,zu(td.bind(null,E,D,d),[d]),D.getSnapshot!==g||ce||zo!==null&&zo.memoizedState.tag&1){if(E.flags|=2048,kc(9,lf.bind(null,E,D,K,g),void 0,null),Ma===null)throw Error(t(349));(ps&30)!==0||Ah(E,g,K)}return K}function Ah(d,g,E){d.flags|=16384,d={getSnapshot:g,value:E},g=hs.updateQueue,g===null?(g={lastEffect:null,stores:null},hs.updateQueue=g,g.stores=[d]):(E=g.stores,E===null?g.stores=[d]:E.push(d))}function lf(d,g,E,D){g.value=E,g.getSnapshot=D,xd(g)&&nd(d)}function td(d,g,E){return E(function(){xd(g)&&nd(d)})}function xd(d){var g=d.getSnapshot;d=d.value;try{var E=g();return!la(d,E)}catch{return!0}}function nd(d){var g=Yt(d,1);g!==null&&ld(g,d,1,-1)}function rh(d){var g=au();return typeof d=="function"&&(d=d()),g.memoizedState=g.baseState=d,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Uh,lastRenderedState:d},g.queue=d,d=d.dispatch=qa.bind(null,hs,d),[g.memoizedState,d]}function kc(d,g,E,D){return d={tag:d,create:g,destroy:E,deps:D,next:null},g=hs.updateQueue,g===null?(g={lastEffect:null,stores:null},hs.updateQueue=g,g.lastEffect=d.next=d):(E=g.lastEffect,E===null?g.lastEffect=d.next=d:(D=E.next,E.next=d,d.next=D,g.lastEffect=d)),d}function cu(){return hc().memoizedState}function fc(d,g,E,D){var K=au();hs.flags|=d,K.memoizedState=kc(1|g,E,void 0,D===void 0?null:D)}function pc(d,g,E,D){var K=hc();D=D===void 0?null:D;var ce=void 0;if(bs!==null){var Ve=bs.memoizedState;if(ce=Ve.destroy,D!==null&&jh(D,Ve.deps)){K.memoizedState=kc(g,E,ce,D);return}}hs.flags|=d,K.memoizedState=kc(1|g,E,ce,D)}function Mc(d,g){return fc(8390656,8,d,g)}function zu(d,g){return pc(2048,8,d,g)}function Th(d,g){return pc(4,2,d,g)}function ju(d,g){return pc(4,4,d,g)}function cf(d,g){if(typeof g=="function")return d=d(),g(d),function(){g(null)};if(g!=null)return d=d(),g.current=d,function(){g.current=null}}function _g(d,g,E){return E=E!=null?E.concat([d]):null,pc(4,4,cf.bind(null,g,d),E)}function xm(){}function vg(d,g){var E=hc();g=g===void 0?null:g;var D=E.memoizedState;return D!==null&&g!==null&&jh(g,D[1])?D[0]:(E.memoizedState=[d,g],d)}function zd(d,g){var E=hc();g=g===void 0?null:g;var D=E.memoizedState;return D!==null&&g!==null&&jh(g,D[1])?D[0]:(d=d(),E.memoizedState=[d,g],d)}function kp(d,g,E){return(ps&21)===0?(d.baseState&&(d.baseState=!1,Fe=!0),d.memoizedState=E):(la(E,g)||(E=zs(),hs.lanes|=E,Ra|=E,d.baseState=!0),g)}function ih(d,g){var E=ji;ji=E!==0&&4>E?E:4,d(!0);var D=ts.transition;ts.transition={};try{d(!1),g()}finally{ji=E,ts.transition=D}}function bm(){return hc().memoizedState}function V0(d,g,E){var D=Cd(d);if(E={lane:D,action:E,hasEagerState:!1,eagerState:null,next:null},Wr(d))rd(g,E);else if(E=Bt(d,g,E,D),E!==null){var K=Vu();ld(E,d,D,K),uf(E,g,D)}}function qa(d,g,E){var D=Cd(d),K={lane:D,action:E,hasEagerState:!1,eagerState:null,next:null};if(Wr(d))rd(g,K);else{var ce=d.alternate;if(d.lanes===0&&(ce===null||ce.lanes===0)&&(ce=g.lastRenderedReducer,ce!==null))try{var Ve=g.lastRenderedState,Et=ce(Ve,E);if(K.hasEagerState=!0,K.eagerState=Et,la(Et,Ve)){var Ft=g.interleaved;Ft===null?(K.next=K,In(g)):(K.next=Ft.next,Ft.next=K),g.interleaved=K;return}}catch{}finally{}E=Bt(d,g,K,D),E!==null&&(K=Vu(),ld(E,d,D,K),uf(E,g,D))}}function Wr(d){var g=d.alternate;return d===hs||g!==null&&g===hs}function rd(d,g){Il=ql=!0;var E=d.pending;E===null?g.next=g:(g.next=E.next,E.next=g),d.pending=g}function uf(d,g,E){if((E&4194240)!==0){var D=g.lanes;D&=d.pendingLanes,E|=D,g.lanes=E,El(d,E)}}var il={readContext:cn,useCallback:Xs,useContext:Xs,useEffect:Xs,useImperativeHandle:Xs,useInsertionEffect:Xs,useLayoutEffect:Xs,useMemo:Xs,useReducer:Xs,useRef:Xs,useState:Xs,useDebugValue:Xs,useDeferredValue:Xs,useTransition:Xs,useMutableSource:Xs,useSyncExternalStore:Xs,useId:Xs,unstable_isNewReconciler:!1},Mp={readContext:cn,useCallback:function(d,g){return au().memoizedState=[d,g===void 0?null:g],d},useContext:cn,useEffect:Mc,useImperativeHandle:function(d,g,E){return E=E!=null?E.concat([d]):null,fc(4194308,4,cf.bind(null,g,d),E)},useLayoutEffect:function(d,g){return fc(4194308,4,d,g)},useInsertionEffect:function(d,g){return fc(4,2,d,g)},useMemo:function(d,g){var E=au();return g=g===void 0?null:g,d=d(),E.memoizedState=[d,g],d},useReducer:function(d,g,E){var D=au();return g=E!==void 0?E(g):g,D.memoizedState=D.baseState=g,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:d,lastRenderedState:g},D.queue=d,d=d.dispatch=V0.bind(null,hs,d),[D.memoizedState,d]},useRef:function(d){var g=au();return d={current:d},g.memoizedState=d},useState:rh,useDebugValue:xm,useDeferredValue:function(d){return au().memoizedState=d},useTransition:function(){var d=rh(!1),g=d[0];return d=ih.bind(null,d[1]),au().memoizedState=d,[g,d]},useMutableSource:function(){},useSyncExternalStore:function(d,g,E){var D=hs,K=au();if(v){if(E===void 0)throw Error(t(407));E=E()}else{if(E=g(),Ma===null)throw Error(t(349));(ps&30)!==0||Ah(D,g,E)}K.memoizedState=E;var ce={value:E,getSnapshot:g};return K.queue=ce,Mc(td.bind(null,D,ce,d),[d]),D.flags|=2048,kc(9,lf.bind(null,D,ce,E,g),void 0,null),E},useId:function(){var d=au(),g=Ma.identifierPrefix;if(v){var E=ft,D=rn;E=(D&~(1<<32-Yo(D)-1)).toString(32)+E,g=":"+g+"R"+E,E=Gc++,0<E&&(g+="H"+E.toString(32)),g+=":"}else E=_d++,g=":"+g+"r"+E.toString(32)+":";return d.memoizedState=g},unstable_isNewReconciler:!1},bd={readContext:cn,useCallback:vg,useContext:cn,useEffect:zu,useImperativeHandle:_g,useInsertionEffect:Th,useLayoutEffect:ju,useMemo:zd,useReducer:Eh,useRef:cu,useState:function(){return Eh(Uh)},useDebugValue:xm,useDeferredValue:function(d){var g=hc();return kp(g,bs.memoizedState,d)},useTransition:function(){var d=Eh(Uh)[0],g=hc().memoizedState;return[d,g]},useMutableSource:ed,useSyncExternalStore:lu,useId:bm,unstable_isNewReconciler:!1},Rc={readContext:cn,useCallback:vg,useContext:cn,useEffect:zu,useImperativeHandle:_g,useInsertionEffect:Th,useLayoutEffect:ju,useMemo:zd,useReducer:dc,useRef:cu,useState:function(){return dc(Uh)},useDebugValue:xm,useDeferredValue:function(d){var g=hc();return bs===null?g.memoizedState=d:kp(g,bs.memoizedState,d)},useTransition:function(){var d=dc(Uh)[0],g=hc().memoizedState;return[d,g]},useMutableSource:ed,useSyncExternalStore:lu,useId:bm,unstable_isNewReconciler:!1};function wu(d,g){if(d&&d.defaultProps){g=nt({},g),d=d.defaultProps;for(var E in d)g[E]===void 0&&(g[E]=d[E]);return g}return g}function id(d,g,E,D){g=d.memoizedState,E=E(D,g),E=E==null?g:nt({},g,E),d.memoizedState=E,d.lanes===0&&(d.updateQueue.baseState=E)}var wd={isMounted:function(d){return(d=d._reactInternals)?no(d)===d:!1},enqueueSetState:function(d,g,E){d=d._reactInternals;var D=Vu(),K=Cd(d),ce=hr(D,K);ce.payload=g,E!=null&&(ce.callback=E),g=mr(d,ce,K),g!==null&&(ld(g,d,K,D),sr(g,d,K))},enqueueReplaceState:function(d,g,E){d=d._reactInternals;var D=Vu(),K=Cd(d),ce=hr(D,K);ce.tag=1,ce.payload=g,E!=null&&(ce.callback=E),g=mr(d,ce,K),g!==null&&(ld(g,d,K,D),sr(g,d,K))},enqueueForceUpdate:function(d,g){d=d._reactInternals;var E=Vu(),D=Cd(d),K=hr(E,D);K.tag=2,g!=null&&(K.callback=g),g=mr(d,K,D),g!==null&&(ld(g,d,D,E),sr(g,d,D))}};function od(d,g,E,D,K,ce,Ve){return d=d.stateNode,typeof d.shouldComponentUpdate=="function"?d.shouldComponentUpdate(D,ce,Ve):g.prototype&&g.prototype.isPureReactComponent?!ga(E,D)||!ga(K,ce):!0}function Rp(d,g,E){var D=!1,K=Ou,ce=g.contextType;return typeof ce=="object"&&ce!==null?ce=cn(ce):(K=_l(g)?qc:Ua.current,D=g.contextTypes,ce=(D=D!=null)?rl(d,K):Ou),g=new g(E,ce),d.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=wd,d.stateNode=g,g._reactInternals=d,D&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=K,d.__reactInternalMemoizedMaskedChildContext=ce),g}function Yf(d,g,E,D){d=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(E,D),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(E,D),g.state!==d&&wd.enqueueReplaceState(g,g.state,null)}function Np(d,g,E,D){var K=d.stateNode;K.props=E,K.state=d.memoizedState,K.refs={},bn(d);var ce=g.contextType;typeof ce=="object"&&ce!==null?K.context=cn(ce):(ce=_l(g)?qc:Ua.current,K.context=rl(d,ce)),K.state=d.memoizedState,ce=g.getDerivedStateFromProps,typeof ce=="function"&&(id(d,g,ce,E),K.state=d.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof K.getSnapshotBeforeUpdate=="function"||typeof K.UNSAFE_componentWillMount!="function"&&typeof K.componentWillMount!="function"||(g=K.state,typeof K.componentWillMount=="function"&&K.componentWillMount(),typeof K.UNSAFE_componentWillMount=="function"&&K.UNSAFE_componentWillMount(),g!==K.state&&wd.enqueueReplaceState(K,K.state,null),oi(d,E,K,D),K.state=d.memoizedState),typeof K.componentDidMount=="function"&&(d.flags|=4194308)}function Ih(d,g){try{var E="",D=g;do E+=Je(D),D=D.return;while(D);var K=E}catch(ce){K=`
Error generating stack: `+ce.message+`
`+ce.stack}return{value:d,source:g,stack:K,digest:null}}function Dp(d,g,E){return{value:d,source:null,stack:E??null,digest:g??null}}function hf(d,g){try{console.error(g.value)}catch(E){setTimeout(function(){throw E})}}var xg=typeof WeakMap=="function"?WeakMap:Map;function df(d,g,E){E=hr(-1,E),E.tag=3,E.payload={element:null};var D=g.value;return E.callback=function(){Sm||(Sm=!0,q0=D),hf(d,g)},E}function O(d,g,E){E=hr(-1,E),E.tag=3;var D=d.type.getDerivedStateFromError;if(typeof D=="function"){var K=g.value;E.payload=function(){return D(K)},E.callback=function(){hf(d,g)}}var ce=d.stateNode;return ce!==null&&typeof ce.componentDidCatch=="function"&&(E.callback=function(){hf(d,g),typeof D!="function"&&(Su===null?Su=new Set([this]):Su.add(this));var Ve=g.stack;this.componentDidCatch(g.value,{componentStack:Ve!==null?Ve:""})}),E}function he(d,g,E){var D=d.pingCache;if(D===null){D=d.pingCache=new xg;var K=new Set;D.set(g,K)}else K=D.get(g),K===void 0&&(K=new Set,D.set(g,K));K.has(E)||(K.add(E),d=Z0.bind(null,d,g,E),g.then(d,d))}function Ie(d){do{var g;if((g=d.tag===13)&&(g=d.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return d;d=d.return}while(d!==null);return null}function qe(d,g,E,D,K){return(d.mode&1)===0?(d===g?d.flags|=65536:(d.flags|=128,E.flags|=131072,E.flags&=-52805,E.tag===1&&(E.alternate===null?E.tag=17:(g=hr(-1,1),g.tag=2,mr(E,g,1))),E.lanes|=1),d):(d.flags|=65536,d.lanes=K,d)}var Qe=ue.ReactCurrentOwner,Fe=!1;function $e(d,g,E,D){g.child=d===null?ot(g,null,E,D):it(g,d.child,E,D)}function St(d,g,E,D,K){E=E.render;var ce=g.ref;return Ut(g,K),D=vd(d,g,E,D,ce,K),E=Bu(),d!==null&&!Fe?(g.updateQueue=d.updateQueue,g.flags&=-2053,d.lanes&=~K,kr(d,g,K)):(v&&E&&En(g),g.flags|=1,$e(d,g,D,K),g.child)}function Mt(d,g,E,D,K){if(d===null){var ce=E.type;return typeof ce=="function"&&!op(ce)&&ce.defaultProps===void 0&&E.compare===null&&E.defaultProps===void 0?(g.tag=15,g.type=ce,gt(d,g,ce,D,K)):(d=Tg(E.type,null,D,g,g.mode,K),d.ref=g.ref,d.return=g,g.child=d)}if(ce=d.child,(d.lanes&K)===0){var Ve=ce.memoizedProps;if(E=E.compare,E=E!==null?E:ga,E(Ve,D)&&d.ref===g.ref)return kr(d,g,K)}return g.flags|=1,d=_f(ce,D),d.ref=g.ref,d.return=g,g.child=d}function gt(d,g,E,D,K){if(d!==null){var ce=d.memoizedProps;if(ga(ce,D)&&d.ref===g.ref)if(Fe=!1,g.pendingProps=D=ce,(d.lanes&K)!==0)(d.flags&131072)!==0&&(Fe=!0);else return g.lanes=d.lanes,kr(d,g,K)}return gn(d,g,E,D,K)}function Zt(d,g,E){var D=g.pendingProps,K=D.children,ce=d!==null?d.memoizedState:null;if(D.mode==="hidden")if((g.mode&1)===0)g.memoizedState={baseLanes:0,cachePool:null,transitions:null},$i(yc,Ga),Ga|=E;else{if((E&1073741824)===0)return d=ce!==null?ce.baseLanes|E:E,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:d,cachePool:null,transitions:null},g.updateQueue=null,$i(yc,Ga),Ga|=d,null;g.memoizedState={baseLanes:0,cachePool:null,transitions:null},D=ce!==null?ce.baseLanes:E,$i(yc,Ga),Ga|=D}else ce!==null?(D=ce.baseLanes|E,g.memoizedState=null):D=E,$i(yc,Ga),Ga|=D;return $e(d,g,K,E),g.child}function Kt(d,g){var E=g.ref;(d===null&&E!==null||d!==null&&d.ref!==E)&&(g.flags|=512,g.flags|=2097152)}function gn(d,g,E,D,K){var ce=_l(E)?qc:Ua.current;return ce=rl(g,ce),Ut(g,K),E=vd(d,g,E,D,ce,K),D=Bu(),d!==null&&!Fe?(g.updateQueue=d.updateQueue,g.flags&=-2053,d.lanes&=~K,kr(d,g,K)):(v&&D&&En(g),g.flags|=1,$e(d,g,E,K),g.child)}function en(d,g,E,D,K){if(_l(E)){var ce=!0;cc(g)}else ce=!1;if(Ut(g,K),g.stateNode===null)Ui(d,g),Rp(g,E,D),Np(g,E,D,K),D=!0;else if(d===null){var Ve=g.stateNode,Et=g.memoizedProps;Ve.props=Et;var Ft=Ve.context,vn=E.contextType;typeof vn=="object"&&vn!==null?vn=cn(vn):(vn=_l(E)?qc:Ua.current,vn=rl(g,vn));var nr=E.getDerivedStateFromProps,cr=typeof nr=="function"||typeof Ve.getSnapshotBeforeUpdate=="function";cr||typeof Ve.UNSAFE_componentWillReceiveProps!="function"&&typeof Ve.componentWillReceiveProps!="function"||(Et!==D||Ft!==vn)&&Yf(g,Ve,D,vn),Tn=!1;var Kn=g.memoizedState;Ve.state=Kn,oi(g,D,Ve,K),Ft=g.memoizedState,Et!==D||Kn!==Ft||yl.current||Tn?(typeof nr=="function"&&(id(g,E,nr,D),Ft=g.memoizedState),(Et=Tn||od(g,E,Et,D,Kn,Ft,vn))?(cr||typeof Ve.UNSAFE_componentWillMount!="function"&&typeof Ve.componentWillMount!="function"||(typeof Ve.componentWillMount=="function"&&Ve.componentWillMount(),typeof Ve.UNSAFE_componentWillMount=="function"&&Ve.UNSAFE_componentWillMount()),typeof Ve.componentDidMount=="function"&&(g.flags|=4194308)):(typeof Ve.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=D,g.memoizedState=Ft),Ve.props=D,Ve.state=Ft,Ve.context=vn,D=Et):(typeof Ve.componentDidMount=="function"&&(g.flags|=4194308),D=!1)}else{Ve=g.stateNode,Rn(d,g),Et=g.memoizedProps,vn=g.type===g.elementType?Et:wu(g.type,Et),Ve.props=vn,cr=g.pendingProps,Kn=Ve.context,Ft=E.contextType,typeof Ft=="object"&&Ft!==null?Ft=cn(Ft):(Ft=_l(E)?qc:Ua.current,Ft=rl(g,Ft));var Gr=E.getDerivedStateFromProps;(nr=typeof Gr=="function"||typeof Ve.getSnapshotBeforeUpdate=="function")||typeof Ve.UNSAFE_componentWillReceiveProps!="function"&&typeof Ve.componentWillReceiveProps!="function"||(Et!==cr||Kn!==Ft)&&Yf(g,Ve,D,Ft),Tn=!1,Kn=g.memoizedState,Ve.state=Kn,oi(g,D,Ve,K);var si=g.memoizedState;Et!==cr||Kn!==si||yl.current||Tn?(typeof Gr=="function"&&(id(g,E,Gr,D),si=g.memoizedState),(vn=Tn||od(g,E,vn,D,Kn,si,Ft)||!1)?(nr||typeof Ve.UNSAFE_componentWillUpdate!="function"&&typeof Ve.componentWillUpdate!="function"||(typeof Ve.componentWillUpdate=="function"&&Ve.componentWillUpdate(D,si,Ft),typeof Ve.UNSAFE_componentWillUpdate=="function"&&Ve.UNSAFE_componentWillUpdate(D,si,Ft)),typeof Ve.componentDidUpdate=="function"&&(g.flags|=4),typeof Ve.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof Ve.componentDidUpdate!="function"||Et===d.memoizedProps&&Kn===d.memoizedState||(g.flags|=4),typeof Ve.getSnapshotBeforeUpdate!="function"||Et===d.memoizedProps&&Kn===d.memoizedState||(g.flags|=1024),g.memoizedProps=D,g.memoizedState=si),Ve.props=D,Ve.state=si,Ve.context=Ft,D=vn):(typeof Ve.componentDidUpdate!="function"||Et===d.memoizedProps&&Kn===d.memoizedState||(g.flags|=4),typeof Ve.getSnapshotBeforeUpdate!="function"||Et===d.memoizedProps&&Kn===d.memoizedState||(g.flags|=1024),D=!1)}return $t(d,g,E,D,ce,K)}function $t(d,g,E,D,K,ce){Kt(d,g);var Ve=(g.flags&128)!==0;if(!D&&!Ve)return K&&zh(g,E,!1),kr(d,g,ce);D=g.stateNode,Qe.current=g;var Et=Ve&&typeof E.getDerivedStateFromError!="function"?null:D.render();return g.flags|=1,d!==null&&Ve?(g.child=it(g,d.child,null,ce),g.child=it(g,null,Et,ce)):$e(d,g,Et,ce),g.memoizedState=D.state,K&&zh(g,E,!0),g.child}function un(d){var g=d.stateNode;g.pendingContext?Ul(d,g.pendingContext,g.pendingContext!==g.context):g.context&&Ul(d,g.context,!1),ua(d,g.containerInfo)}function vr(d,g,E,D,K){return Ae(),Le(K),g.flags|=256,$e(d,g,E,D),g.child}var Pr={dehydrated:null,treeContext:null,retryLane:0};function Gn(d){return{baseLanes:d,cachePool:null,transitions:null}}function rr(d,g,E){var D=g.pendingProps,K=Ci.current,ce=!1,Ve=(g.flags&128)!==0,Et;if((Et=Ve)||(Et=d!==null&&d.memoizedState===null?!1:(K&2)!==0),Et?(ce=!0,g.flags&=-129):(d===null||d.memoizedState!==null)&&(K|=1),$i(Ci,K&1),d===null)return $(g),d=g.memoizedState,d!==null&&(d=d.dehydrated,d!==null)?((g.mode&1)===0?g.lanes=1:d.data==="$!"?g.lanes=8:g.lanes=1073741824,null):(Ve=D.children,d=D.fallback,ce?(D=g.mode,ce=g.child,Ve={mode:"hidden",children:Ve},(D&1)===0&&ce!==null?(ce.childLanes=0,ce.pendingProps=Ve):ce=Ig(Ve,D,0,null),d=sp(d,D,E,null),ce.return=g,d.return=g,ce.sibling=d,g.child=ce,g.child.memoizedState=Gn(E),g.memoizedState=Pr,d):ni(g,Ve));if(K=d.memoizedState,K!==null&&(Et=K.dehydrated,Et!==null))return Jr(d,g,Ve,D,Et,K,E);if(ce){ce=D.fallback,Ve=g.mode,K=d.child,Et=K.sibling;var Ft={mode:"hidden",children:D.children};return(Ve&1)===0&&g.child!==K?(D=g.child,D.childLanes=0,D.pendingProps=Ft,g.deletions=null):(D=_f(K,Ft),D.subtreeFlags=K.subtreeFlags&14680064),Et!==null?ce=_f(Et,ce):(ce=sp(ce,Ve,E,null),ce.flags|=2),ce.return=g,D.return=g,D.sibling=ce,g.child=D,D=ce,ce=g.child,Ve=d.child.memoizedState,Ve=Ve===null?Gn(E):{baseLanes:Ve.baseLanes|E,cachePool:null,transitions:Ve.transitions},ce.memoizedState=Ve,ce.childLanes=d.childLanes&~E,g.memoizedState=Pr,D}return ce=d.child,d=ce.sibling,D=_f(ce,{mode:"visible",children:D.children}),(g.mode&1)===0&&(D.lanes=E),D.return=g,D.sibling=null,d!==null&&(E=g.deletions,E===null?(g.deletions=[d],g.flags|=16):E.push(d)),g.child=D,g.memoizedState=null,D}function ni(d,g){return g=Ig({mode:"visible",children:g},d.mode,0,null),g.return=d,d.child=g}function Yr(d,g,E,D){return D!==null&&Le(D),it(g,d.child,null,E),d=ni(g,g.pendingProps.children),d.flags|=2,g.memoizedState=null,d}function Jr(d,g,E,D,K,ce,Ve){if(E)return g.flags&256?(g.flags&=-257,D=Dp(Error(t(422))),Yr(d,g,Ve,D)):g.memoizedState!==null?(g.child=d.child,g.flags|=128,null):(ce=D.fallback,K=g.mode,D=Ig({mode:"visible",children:D.children},K,0,null),ce=sp(ce,K,Ve,null),ce.flags|=2,D.return=g,ce.return=g,D.sibling=ce,g.child=D,(g.mode&1)!==0&&it(g,d.child,null,Ve),g.child.memoizedState=Gn(Ve),g.memoizedState=Pr,ce);if((g.mode&1)===0)return Yr(d,g,Ve,null);if(K.data==="$!"){if(D=K.nextSibling&&K.nextSibling.dataset,D)var Et=D.dgst;return D=Et,ce=Error(t(419)),D=Dp(ce,D,void 0),Yr(d,g,Ve,D)}if(Et=(Ve&d.childLanes)!==0,Fe||Et){if(D=Ma,D!==null){switch(Ve&-Ve){case 4:K=2;break;case 16:K=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:K=32;break;case 536870912:K=268435456;break;default:K=0}K=(K&(D.suspendedLanes|Ve))!==0?0:K,K!==0&&K!==ce.retryLane&&(ce.retryLane=K,Yt(d,K),ld(D,d,K,-1))}return H0(),D=Dp(Error(t(421))),Yr(d,g,Ve,D)}return K.data==="$?"?(g.flags|=128,g.child=d.child,g=wx.bind(null,d),K._reactRetry=g,null):(d=ce.treeContext,f=ca(K.nextSibling),a=g,v=!0,S=null,d!==null&&(tt[ut++]=rn,tt[ut++]=ft,tt[ut++]=Nt,rn=d.id,ft=d.overflow,Nt=g),g=ni(g,D.children),g.flags|=4096,g)}function Gi(d,g,E){d.lanes|=g;var D=d.alternate;D!==null&&(D.lanes|=g),_n(d.return,g,E)}function Or(d,g,E,D,K){var ce=d.memoizedState;ce===null?d.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:D,tail:E,tailMode:K}:(ce.isBackwards=g,ce.rendering=null,ce.renderingStartTime=0,ce.last=D,ce.tail=E,ce.tailMode=K)}function Ur(d,g,E){var D=g.pendingProps,K=D.revealOrder,ce=D.tail;if($e(d,g,D.children,E),D=Ci.current,(D&2)!==0)D=D&1|2,g.flags|=128;else{if(d!==null&&(d.flags&128)!==0)e:for(d=g.child;d!==null;){if(d.tag===13)d.memoizedState!==null&&Gi(d,E,g);else if(d.tag===19)Gi(d,E,g);else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===g)break e;for(;d.sibling===null;){if(d.return===null||d.return===g)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}D&=1}if($i(Ci,D),(g.mode&1)===0)g.memoizedState=null;else switch(K){case"forwards":for(E=g.child,K=null;E!==null;)d=E.alternate,d!==null&&Qi(d)===null&&(K=E),E=E.sibling;E=K,E===null?(K=g.child,g.child=null):(K=E.sibling,E.sibling=null),Or(g,!1,K,E,ce);break;case"backwards":for(E=null,K=g.child,g.child=null;K!==null;){if(d=K.alternate,d!==null&&Qi(d)===null){g.child=K;break}d=K.sibling,K.sibling=E,E=K,K=d}Or(g,!0,E,null,ce);break;case"together":Or(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function Ui(d,g){(g.mode&1)===0&&d!==null&&(d.alternate=null,g.alternate=null,g.flags|=2)}function kr(d,g,E){if(d!==null&&(g.dependencies=d.dependencies),Ra|=g.lanes,(E&g.childLanes)===0)return null;if(d!==null&&g.child!==d.child)throw Error(t(153));if(g.child!==null){for(d=g.child,E=_f(d,d.pendingProps),g.child=E,E.return=g;d.sibling!==null;)d=d.sibling,E=E.sibling=_f(d,d.pendingProps),E.return=g;E.sibling=null}return g.child}function Kr(d,g,E){switch(g.tag){case 3:un(g),Ae();break;case 5:uc(g);break;case 1:_l(g.type)&&cc(g);break;case 4:ua(g,g.stateNode.containerInfo);break;case 10:var D=g.type._context,K=g.memoizedProps.value;$i(bt,D._currentValue),D._currentValue=K;break;case 13:if(D=g.memoizedState,D!==null)return D.dehydrated!==null?($i(Ci,Ci.current&1),g.flags|=128,null):(E&g.child.childLanes)!==0?rr(d,g,E):($i(Ci,Ci.current&1),d=kr(d,g,E),d!==null?d.sibling:null);$i(Ci,Ci.current&1);break;case 19:if(D=(E&g.childLanes)!==0,(d.flags&128)!==0){if(D)return Ur(d,g,E);g.flags|=128}if(K=g.memoizedState,K!==null&&(K.rendering=null,K.tail=null,K.lastEffect=null),$i(Ci,Ci.current),D)break;return null;case 22:case 23:return g.lanes=0,Zt(d,g,E)}return kr(d,g,E)}var ki,Vn,on,hn;ki=function(d,g){for(var E=g.child;E!==null;){if(E.tag===5||E.tag===6)d.appendChild(E.stateNode);else if(E.tag!==4&&E.child!==null){E.child.return=E,E=E.child;continue}if(E===g)break;for(;E.sibling===null;){if(E.return===null||E.return===g)return;E=E.return}E.sibling.return=E.return,E=E.sibling}},Vn=function(){},on=function(d,g,E,D){var K=d.memoizedProps;if(K!==D){d=g.stateNode,oo(Zr.current);var ce=null;switch(E){case"input":K=Gt(d,K),D=Gt(d,D),ce=[];break;case"select":K=nt({},K,{value:void 0}),D=nt({},D,{value:void 0}),ce=[];break;case"textarea":K=Hr(d,K),D=Hr(d,D),ce=[];break;default:typeof K.onClick!="function"&&typeof D.onClick=="function"&&(d.onclick=bu)}qr(E,D);var Ve;E=null;for(vn in K)if(!D.hasOwnProperty(vn)&&K.hasOwnProperty(vn)&&K[vn]!=null)if(vn==="style"){var Et=K[vn];for(Ve in Et)Et.hasOwnProperty(Ve)&&(E||(E={}),E[Ve]="")}else vn!=="dangerouslySetInnerHTML"&&vn!=="children"&&vn!=="suppressContentEditableWarning"&&vn!=="suppressHydrationWarning"&&vn!=="autoFocus"&&(c.hasOwnProperty(vn)?ce||(ce=[]):(ce=ce||[]).push(vn,null));for(vn in D){var Ft=D[vn];if(Et=K?.[vn],D.hasOwnProperty(vn)&&Ft!==Et&&(Ft!=null||Et!=null))if(vn==="style")if(Et){for(Ve in Et)!Et.hasOwnProperty(Ve)||Ft&&Ft.hasOwnProperty(Ve)||(E||(E={}),E[Ve]="");for(Ve in Ft)Ft.hasOwnProperty(Ve)&&Et[Ve]!==Ft[Ve]&&(E||(E={}),E[Ve]=Ft[Ve])}else E||(ce||(ce=[]),ce.push(vn,E)),E=Ft;else vn==="dangerouslySetInnerHTML"?(Ft=Ft?Ft.__html:void 0,Et=Et?Et.__html:void 0,Ft!=null&&Et!==Ft&&(ce=ce||[]).push(vn,Ft)):vn==="children"?typeof Ft!="string"&&typeof Ft!="number"||(ce=ce||[]).push(vn,""+Ft):vn!=="suppressContentEditableWarning"&&vn!=="suppressHydrationWarning"&&(c.hasOwnProperty(vn)?(Ft!=null&&vn==="onScroll"&&Bo("scroll",d),ce||Et===Ft||(ce=[])):(ce=ce||[]).push(vn,Ft))}E&&(ce=ce||[]).push("style",E);var vn=ce;(g.updateQueue=vn)&&(g.flags|=4)}},hn=function(d,g,E,D){E!==D&&(g.flags|=4)};function Hn(d,g){if(!v)switch(d.tailMode){case"hidden":g=d.tail;for(var E=null;g!==null;)g.alternate!==null&&(E=g),g=g.sibling;E===null?d.tail=null:E.sibling=null;break;case"collapsed":E=d.tail;for(var D=null;E!==null;)E.alternate!==null&&(D=E),E=E.sibling;D===null?g||d.tail===null?d.tail=null:d.tail.sibling=null:D.sibling=null}}function tr(d){var g=d.alternate!==null&&d.alternate.child===d.child,E=0,D=0;if(g)for(var K=d.child;K!==null;)E|=K.lanes|K.childLanes,D|=K.subtreeFlags&14680064,D|=K.flags&14680064,K.return=d,K=K.sibling;else for(K=d.child;K!==null;)E|=K.lanes|K.childLanes,D|=K.subtreeFlags,D|=K.flags,K.return=d,K=K.sibling;return d.subtreeFlags|=D,d.childLanes=E,g}function Qr(d,g,E){var D=g.pendingProps;switch(y(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return tr(g),null;case 1:return _l(g.type)&&Sh(),tr(g),null;case 3:return D=g.stateNode,us(),Ao(yl),Ao(Ua),Ts(),D.pendingContext&&(D.context=D.pendingContext,D.pendingContext=null),(d===null||d.child===null)&&(te(g)?g.flags|=4:d===null||d.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,S!==null&&(Ud(S),S=null))),Vn(d,g),tr(g),null;case 5:Pc(g);var K=oo(io.current);if(E=g.type,d!==null&&g.stateNode!=null)on(d,g,E,D,K),d.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!D){if(g.stateNode===null)throw Error(t(166));return tr(g),null}if(d=oo(Zr.current),te(g)){D=g.stateNode,E=g.type;var ce=g.memoizedProps;switch(D[xo]=g,D[ou]=ce,d=(g.mode&1)!==0,E){case"dialog":Bo("cancel",D),Bo("close",D);break;case"iframe":case"object":case"embed":Bo("load",D);break;case"video":case"audio":for(K=0;K<La.length;K++)Bo(La[K],D);break;case"source":Bo("error",D);break;case"img":case"image":case"link":Bo("error",D),Bo("load",D);break;case"details":Bo("toggle",D);break;case"input":st(D,ce),Bo("invalid",D);break;case"select":D._wrapperState={wasMultiple:!!ce.multiple},Bo("invalid",D);break;case"textarea":Vt(D,ce),Bo("invalid",D)}qr(E,ce),K=null;for(var Ve in ce)if(ce.hasOwnProperty(Ve)){var Et=ce[Ve];Ve==="children"?typeof Et=="string"?D.textContent!==Et&&(ce.suppressHydrationWarning!==!0&&ii(D.textContent,Et,d),K=["children",Et]):typeof Et=="number"&&D.textContent!==""+Et&&(ce.suppressHydrationWarning!==!0&&ii(D.textContent,Et,d),K=["children",""+Et]):c.hasOwnProperty(Ve)&&Et!=null&&Ve==="onScroll"&&Bo("scroll",D)}switch(E){case"input":ln(D),Tr(D,ce,!0);break;case"textarea":ln(D),$n(D);break;case"select":case"option":break;default:typeof ce.onClick=="function"&&(D.onclick=bu)}D=K,g.updateQueue=D,D!==null&&(g.flags|=4)}else{Ve=K.nodeType===9?K:K.ownerDocument,d==="http://www.w3.org/1999/xhtml"&&(d=Dn(E)),d==="http://www.w3.org/1999/xhtml"?E==="script"?(d=Ve.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild)):typeof D.is=="string"?d=Ve.createElement(E,{is:D.is}):(d=Ve.createElement(E),E==="select"&&(Ve=d,D.multiple?Ve.multiple=!0:D.size&&(Ve.size=D.size))):d=Ve.createElementNS(d,E),d[xo]=g,d[ou]=D,ki(d,g,!1,!1),g.stateNode=d;e:{switch(Ve=Dr(E,D),E){case"dialog":Bo("cancel",d),Bo("close",d),K=D;break;case"iframe":case"object":case"embed":Bo("load",d),K=D;break;case"video":case"audio":for(K=0;K<La.length;K++)Bo(La[K],d);K=D;break;case"source":Bo("error",d),K=D;break;case"img":case"image":case"link":Bo("error",d),Bo("load",d),K=D;break;case"details":Bo("toggle",d),K=D;break;case"input":st(d,D),K=Gt(d,D),Bo("invalid",d);break;case"option":K=D;break;case"select":d._wrapperState={wasMultiple:!!D.multiple},K=nt({},D,{value:void 0}),Bo("invalid",d);break;case"textarea":Vt(d,D),K=Hr(d,D),Bo("invalid",d);break;default:K=D}qr(E,K),Et=K;for(ce in Et)if(Et.hasOwnProperty(ce)){var Ft=Et[ce];ce==="style"?or(d,Ft):ce==="dangerouslySetInnerHTML"?(Ft=Ft?Ft.__html:void 0,Ft!=null&&Sr(d,Ft)):ce==="children"?typeof Ft=="string"?(E!=="textarea"||Ft!=="")&&Er(d,Ft):typeof Ft=="number"&&Er(d,""+Ft):ce!=="suppressContentEditableWarning"&&ce!=="suppressHydrationWarning"&&ce!=="autoFocus"&&(c.hasOwnProperty(ce)?Ft!=null&&ce==="onScroll"&&Bo("scroll",d):Ft!=null&&me(d,ce,Ft,Ve))}switch(E){case"input":ln(d),Tr(d,D,!1);break;case"textarea":ln(d),$n(d);break;case"option":D.value!=null&&d.setAttribute("value",""+dt(D.value));break;case"select":d.multiple=!!D.multiple,ce=D.value,ce!=null?Jn(d,!!D.multiple,ce,!1):D.defaultValue!=null&&Jn(d,!!D.multiple,D.defaultValue,!0);break;default:typeof K.onClick=="function"&&(d.onclick=bu)}switch(E){case"button":case"input":case"select":case"textarea":D=!!D.autoFocus;break e;case"img":D=!0;break e;default:D=!1}}D&&(g.flags|=4)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return tr(g),null;case 6:if(d&&g.stateNode!=null)hn(d,g,d.memoizedProps,D);else{if(typeof D!="string"&&g.stateNode===null)throw Error(t(166));if(E=oo(io.current),oo(Zr.current),te(g)){if(D=g.stateNode,E=g.memoizedProps,D[xo]=g,(ce=D.nodeValue!==E)&&(d=a,d!==null))switch(d.tag){case 3:ii(D.nodeValue,E,(d.mode&1)!==0);break;case 5:d.memoizedProps.suppressHydrationWarning!==!0&&ii(D.nodeValue,E,(d.mode&1)!==0)}ce&&(g.flags|=4)}else D=(E.nodeType===9?E:E.ownerDocument).createTextNode(D),D[xo]=g,g.stateNode=D}return tr(g),null;case 13:if(Ao(Ci),D=g.memoizedState,d===null||d.memoizedState!==null&&d.memoizedState.dehydrated!==null){if(v&&f!==null&&(g.mode&1)!==0&&(g.flags&128)===0)ge(),Ae(),g.flags|=98560,ce=!1;else if(ce=te(g),D!==null&&D.dehydrated!==null){if(d===null){if(!ce)throw Error(t(318));if(ce=g.memoizedState,ce=ce!==null?ce.dehydrated:null,!ce)throw Error(t(317));ce[xo]=g}else Ae(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;tr(g),ce=!1}else S!==null&&(Ud(S),S=null),ce=!0;if(!ce)return g.flags&65536?g:null}return(g.flags&128)!==0?(g.lanes=E,g):(D=D!==null,D!==(d!==null&&d.memoizedState!==null)&&D&&(g.child.flags|=8192,(g.mode&1)!==0&&(d===null||(Ci.current&1)!==0?Ho===0&&(Ho=3):H0())),g.updateQueue!==null&&(g.flags|=4),tr(g),null);case 4:return us(),Vn(d,g),d===null&&sc(g.stateNode.containerInfo),tr(g),null;case 10:return jt(g.type._context),tr(g),null;case 17:return _l(g.type)&&Sh(),tr(g),null;case 19:if(Ao(Ci),ce=g.memoizedState,ce===null)return tr(g),null;if(D=(g.flags&128)!==0,Ve=ce.rendering,Ve===null)if(D)Hn(ce,!1);else{if(Ho!==0||d!==null&&(d.flags&128)!==0)for(d=g.child;d!==null;){if(Ve=Qi(d),Ve!==null){for(g.flags|=128,Hn(ce,!1),D=Ve.updateQueue,D!==null&&(g.updateQueue=D,g.flags|=4),g.subtreeFlags=0,D=E,E=g.child;E!==null;)ce=E,d=D,ce.flags&=14680066,Ve=ce.alternate,Ve===null?(ce.childLanes=0,ce.lanes=d,ce.child=null,ce.subtreeFlags=0,ce.memoizedProps=null,ce.memoizedState=null,ce.updateQueue=null,ce.dependencies=null,ce.stateNode=null):(ce.childLanes=Ve.childLanes,ce.lanes=Ve.lanes,ce.child=Ve.child,ce.subtreeFlags=0,ce.deletions=null,ce.memoizedProps=Ve.memoizedProps,ce.memoizedState=Ve.memoizedState,ce.updateQueue=Ve.updateQueue,ce.type=Ve.type,d=Ve.dependencies,ce.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),E=E.sibling;return $i(Ci,Ci.current&1|2),g.child}d=d.sibling}ce.tail!==null&&So()>Fp&&(g.flags|=128,D=!0,Hn(ce,!1),g.lanes=4194304)}else{if(!D)if(d=Qi(Ve),d!==null){if(g.flags|=128,D=!0,E=d.updateQueue,E!==null&&(g.updateQueue=E,g.flags|=4),Hn(ce,!0),ce.tail===null&&ce.tailMode==="hidden"&&!Ve.alternate&&!v)return tr(g),null}else 2*So()-ce.renderingStartTime>Fp&&E!==1073741824&&(g.flags|=128,D=!0,Hn(ce,!1),g.lanes=4194304);ce.isBackwards?(Ve.sibling=g.child,g.child=Ve):(E=ce.last,E!==null?E.sibling=Ve:g.child=Ve,ce.last=Ve)}return ce.tail!==null?(g=ce.tail,ce.rendering=g,ce.tail=g.sibling,ce.renderingStartTime=So(),g.sibling=null,E=Ci.current,$i(Ci,D?E&1|2:E&1),g):(tr(g),null);case 22:case 23:return Eg(),D=g.memoizedState!==null,d!==null&&d.memoizedState!==null!==D&&(g.flags|=8192),D&&(g.mode&1)!==0?(Ga&1073741824)!==0&&(tr(g),g.subtreeFlags&6&&(g.flags|=8192)):tr(g),null;case 24:return null;case 25:return null}throw Error(t(156,g.tag))}function co(d,g){switch(y(g),g.tag){case 1:return _l(g.type)&&Sh(),d=g.flags,d&65536?(g.flags=d&-65537|128,g):null;case 3:return us(),Ao(yl),Ao(Ua),Ts(),d=g.flags,(d&65536)!==0&&(d&128)===0?(g.flags=d&-65537|128,g):null;case 5:return Pc(g),null;case 13:if(Ao(Ci),d=g.memoizedState,d!==null&&d.dehydrated!==null){if(g.alternate===null)throw Error(t(340));Ae()}return d=g.flags,d&65536?(g.flags=d&-65537|128,g):null;case 19:return Ao(Ci),null;case 4:return us(),null;case 10:return jt(g.type._context),null;case 22:case 23:return Eg(),null;case 24:return null;default:return null}}var Do=!1,ei=!1,Hi=typeof WeakSet=="function"?WeakSet:Set,Bn=null;function $a(d,g){var E=d.ref;if(E!==null)if(typeof E=="function")try{E(null)}catch(D){Cl(d,g,D)}else E.current=null}function Zs(d,g,E){try{E()}catch(D){Cl(d,g,D)}}var mc=!1;function ns(d,g){if(th=zc,d=ya(),Ol(d)){if("selectionStart"in d)var E={start:d.selectionStart,end:d.selectionEnd};else e:{E=(E=d.ownerDocument)&&E.defaultView||window;var D=E.getSelection&&E.getSelection();if(D&&D.rangeCount!==0){E=D.anchorNode;var K=D.anchorOffset,ce=D.focusNode;D=D.focusOffset;try{E.nodeType,ce.nodeType}catch{E=null;break e}var Ve=0,Et=-1,Ft=-1,vn=0,nr=0,cr=d,Kn=null;t:for(;;){for(var Gr;cr!==E||K!==0&&cr.nodeType!==3||(Et=Ve+K),cr!==ce||D!==0&&cr.nodeType!==3||(Ft=Ve+D),cr.nodeType===3&&(Ve+=cr.nodeValue.length),(Gr=cr.firstChild)!==null;)Kn=cr,cr=Gr;for(;;){if(cr===d)break t;if(Kn===E&&++vn===K&&(Et=Ve),Kn===ce&&++nr===D&&(Ft=Ve),(Gr=cr.nextSibling)!==null)break;cr=Kn,Kn=cr.parentNode}cr=Gr}E=Et===-1||Ft===-1?null:{start:Et,end:Ft}}else E=null}E=E||{start:0,end:0}}else E=null;for(Ks={focusedElem:d,selectionRange:E},zc=!1,Bn=g;Bn!==null;)if(g=Bn,d=g.child,(g.subtreeFlags&1028)!==0&&d!==null)d.return=g,Bn=d;else for(;Bn!==null;){g=Bn;try{var si=g.alternate;if((g.flags&1024)!==0)switch(g.tag){case 0:case 11:case 15:break;case 1:if(si!==null){var fi=si.memoizedProps,Ll=si.memoizedState,an=g.stateNode,Ht=an.getSnapshotBeforeUpdate(g.elementType===g.type?fi:wu(g.type,fi),Ll);an.__reactInternalSnapshotBeforeUpdate=Ht}break;case 3:var mn=g.stateNode.containerInfo;mn.nodeType===1?mn.textContent="":mn.nodeType===9&&mn.documentElement&&mn.removeChild(mn.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(gr){Cl(g,g.return,gr)}if(d=g.sibling,d!==null){d.return=g.return,Bn=d;break}Bn=g.return}return si=mc,mc=!1,si}function Wn(d,g,E){var D=g.updateQueue;if(D=D!==null?D.lastEffect:null,D!==null){var K=D=D.next;do{if((K.tag&d)===d){var ce=K.destroy;K.destroy=void 0,ce!==void 0&&Zs(g,E,ce)}K=K.next}while(K!==D)}}function ba(d,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var E=g=g.next;do{if((E.tag&d)===d){var D=E.create;E.destroy=D()}E=E.next}while(E!==g)}}function Hc(d){var g=d.ref;if(g!==null){var E=d.stateNode;switch(d.tag){case 5:d=E;break;default:d=E}typeof g=="function"?g(d):g.current=d}}function Sd(d){var g=d.alternate;g!==null&&(d.alternate=null,Sd(g)),d.child=null,d.deletions=null,d.sibling=null,d.tag===5&&(g=d.stateNode,g!==null&&(delete g[xo],delete g[ou],delete g[zl],delete g[Oh],delete g[jl])),d.stateNode=null,d.return=null,d.dependencies=null,d.memoizedProps=null,d.memoizedState=null,d.pendingProps=null,d.stateNode=null,d.updateQueue=null}function gc(d){return d.tag===5||d.tag===3||d.tag===4}function jd(d){e:for(;;){for(;d.sibling===null;){if(d.return===null||gc(d.return))return null;d=d.return}for(d.sibling.return=d.return,d=d.sibling;d.tag!==5&&d.tag!==6&&d.tag!==18;){if(d.flags&2||d.child===null||d.tag===4)continue e;d.child.return=d,d=d.child}if(!(d.flags&2))return d.stateNode}}function Nc(d,g,E){var D=d.tag;if(D===5||D===6)d=d.stateNode,g?E.nodeType===8?E.parentNode.insertBefore(d,g):E.insertBefore(d,g):(E.nodeType===8?(g=E.parentNode,g.insertBefore(d,E)):(g=E,g.appendChild(d)),E=E._reactRootContainer,E!=null||g.onclick!==null||(g.onclick=bu));else if(D!==4&&(d=d.child,d!==null))for(Nc(d,g,E),d=d.sibling;d!==null;)Nc(d,g,E),d=d.sibling}function Vh(d,g,E){var D=d.tag;if(D===5||D===6)d=d.stateNode,g?E.insertBefore(d,g):E.appendChild(d);else if(D!==4&&(d=d.child,d!==null))for(Vh(d,g,E),d=d.sibling;d!==null;)Vh(d,g,E),d=d.sibling}var Is=null,$l=!1;function uu(d,g,E){for(E=E.child;E!==null;)Ed(d,g,E),E=E.sibling}function Ed(d,g,E){if(ra&&typeof ra.onCommitFiberUnmount=="function")try{ra.onCommitFiberUnmount(Aa,E)}catch{}switch(E.tag){case 5:ei||$a(E,g);case 6:var D=Is,K=$l;Is=null,uu(d,g,E),Is=D,$l=K,Is!==null&&($l?(d=Is,E=E.stateNode,d.nodeType===8?d.parentNode.removeChild(E):d.removeChild(E)):Is.removeChild(E.stateNode));break;case 18:Is!==null&&($l?(d=Is,E=E.stateNode,d.nodeType===8?vo(d.parentNode,E):d.nodeType===1&&vo(d,E),Us(d)):vo(Is,E.stateNode));break;case 4:D=Is,K=$l,Is=E.stateNode.containerInfo,$l=!0,uu(d,g,E),Is=D,$l=K;break;case 0:case 11:case 14:case 15:if(!ei&&(D=E.updateQueue,D!==null&&(D=D.lastEffect,D!==null))){K=D=D.next;do{var ce=K,Ve=ce.destroy;ce=ce.tag,Ve!==void 0&&((ce&2)!==0||(ce&4)!==0)&&Zs(E,g,Ve),K=K.next}while(K!==D)}uu(d,g,E);break;case 1:if(!ei&&($a(E,g),D=E.stateNode,typeof D.componentWillUnmount=="function"))try{D.props=E.memoizedProps,D.state=E.memoizedState,D.componentWillUnmount()}catch(Et){Cl(E,g,Et)}uu(d,g,E);break;case 21:uu(d,g,E);break;case 22:E.mode&1?(ei=(D=ei)||E.memoizedState!==null,uu(d,g,E),ei=D):uu(d,g,E);break;default:uu(d,g,E)}}function qh(d){var g=d.updateQueue;if(g!==null){d.updateQueue=null;var E=d.stateNode;E===null&&(E=d.stateNode=new Hi),g.forEach(function(D){var K=Sx.bind(null,d,D);E.has(D)||(E.add(D),D.then(K,K))})}}function Vr(d,g){var E=g.deletions;if(E!==null)for(var D=0;D<E.length;D++){var K=E[D];try{var ce=d,Ve=g,Et=Ve;e:for(;Et!==null;){switch(Et.tag){case 5:Is=Et.stateNode,$l=!1;break e;case 3:Is=Et.stateNode.containerInfo,$l=!0;break e;case 4:Is=Et.stateNode.containerInfo,$l=!0;break e}Et=Et.return}if(Is===null)throw Error(t(160));Ed(ce,Ve,K),Is=null,$l=!1;var Ft=K.alternate;Ft!==null&&(Ft.return=null),K.return=null}catch(vn){Cl(K,g,vn)}}if(g.subtreeFlags&12854)for(g=g.child;g!==null;)ms(g,d),g=g.sibling}function ms(d,g){var E=d.alternate,D=d.flags;switch(d.tag){case 0:case 11:case 14:case 15:if(Vr(g,d),as(d),D&4){try{Wn(3,d,d.return),ba(3,d)}catch(fi){Cl(d,d.return,fi)}try{Wn(5,d,d.return)}catch(fi){Cl(d,d.return,fi)}}break;case 1:Vr(g,d),as(d),D&512&&E!==null&&$a(E,E.return);break;case 5:if(Vr(g,d),as(d),D&512&&E!==null&&$a(E,E.return),d.flags&32){var K=d.stateNode;try{Er(K,"")}catch(fi){Cl(d,d.return,fi)}}if(D&4&&(K=d.stateNode,K!=null)){var ce=d.memoizedProps,Ve=E!==null?E.memoizedProps:ce,Et=d.type,Ft=d.updateQueue;if(d.updateQueue=null,Ft!==null)try{Et==="input"&&ce.type==="radio"&&ce.name!=null&&fr(K,ce),Dr(Et,Ve);var vn=Dr(Et,ce);for(Ve=0;Ve<Ft.length;Ve+=2){var nr=Ft[Ve],cr=Ft[Ve+1];nr==="style"?or(K,cr):nr==="dangerouslySetInnerHTML"?Sr(K,cr):nr==="children"?Er(K,cr):me(K,nr,cr,vn)}switch(Et){case"input":br(K,ce);break;case"textarea":Ln(K,ce);break;case"select":var Kn=K._wrapperState.wasMultiple;K._wrapperState.wasMultiple=!!ce.multiple;var Gr=ce.value;Gr!=null?Jn(K,!!ce.multiple,Gr,!1):Kn!==!!ce.multiple&&(ce.defaultValue!=null?Jn(K,!!ce.multiple,ce.defaultValue,!0):Jn(K,!!ce.multiple,ce.multiple?[]:"",!1))}K[ou]=ce}catch(fi){Cl(d,d.return,fi)}}break;case 6:if(Vr(g,d),as(d),D&4){if(d.stateNode===null)throw Error(t(162));K=d.stateNode,ce=d.memoizedProps;try{K.nodeValue=ce}catch(fi){Cl(d,d.return,fi)}}break;case 3:if(Vr(g,d),as(d),D&4&&E!==null&&E.memoizedState.isDehydrated)try{Us(g.containerInfo)}catch(fi){Cl(d,d.return,fi)}break;case 4:Vr(g,d),as(d);break;case 13:Vr(g,d),as(d),K=d.child,K.flags&8192&&(ce=K.memoizedState!==null,K.stateNode.isHidden=ce,!ce||K.alternate!==null&&K.alternate.memoizedState!==null||(wm=So())),D&4&&qh(d);break;case 22:if(nr=E!==null&&E.memoizedState!==null,d.mode&1?(ei=(vn=ei)||nr,Vr(g,d),ei=vn):Vr(g,d),as(d),D&8192){if(vn=d.memoizedState!==null,(d.stateNode.isHidden=vn)&&!nr&&(d.mode&1)!==0)for(Bn=d,nr=d.child;nr!==null;){for(cr=Bn=nr;Bn!==null;){switch(Kn=Bn,Gr=Kn.child,Kn.tag){case 0:case 11:case 14:case 15:Wn(4,Kn,Kn.return);break;case 1:$a(Kn,Kn.return);var si=Kn.stateNode;if(typeof si.componentWillUnmount=="function"){D=Kn,E=Kn.return;try{g=D,si.props=g.memoizedProps,si.state=g.memoizedState,si.componentWillUnmount()}catch(fi){Cl(D,E,fi)}}break;case 5:$a(Kn,Kn.return);break;case 22:if(Kn.memoizedState!==null){Ad(cr);continue}}Gr!==null?(Gr.return=Kn,Bn=Gr):Ad(cr)}nr=nr.sibling}e:for(nr=null,cr=d;;){if(cr.tag===5){if(nr===null){nr=cr;try{K=cr.stateNode,vn?(ce=K.style,typeof ce.setProperty=="function"?ce.setProperty("display","none","important"):ce.display="none"):(Et=cr.stateNode,Ft=cr.memoizedProps.style,Ve=Ft!=null&&Ft.hasOwnProperty("display")?Ft.display:null,Et.style.display=Li("display",Ve))}catch(fi){Cl(d,d.return,fi)}}}else if(cr.tag===6){if(nr===null)try{cr.stateNode.nodeValue=vn?"":cr.memoizedProps}catch(fi){Cl(d,d.return,fi)}}else if((cr.tag!==22&&cr.tag!==23||cr.memoizedState===null||cr===d)&&cr.child!==null){cr.child.return=cr,cr=cr.child;continue}if(cr===d)break e;for(;cr.sibling===null;){if(cr.return===null||cr.return===d)break e;nr===cr&&(nr=null),cr=cr.return}nr===cr&&(nr=null),cr.sibling.return=cr.return,cr=cr.sibling}}break;case 19:Vr(g,d),as(d),D&4&&qh(d);break;case 21:break;default:Vr(g,d),as(d)}}function as(d){var g=d.flags;if(g&2){try{e:{for(var E=d.return;E!==null;){if(gc(E)){var D=E;break e}E=E.return}throw Error(t(160))}switch(D.tag){case 5:var K=D.stateNode;D.flags&32&&(Er(K,""),D.flags&=-33);var ce=jd(d);Vh(d,ce,K);break;case 3:case 4:var Ve=D.stateNode.containerInfo,Et=jd(d);Nc(d,Et,Ve);break;default:throw Error(t(161))}}catch(Ft){Cl(d,d.return,Ft)}d.flags&=-3}g&4096&&(d.flags&=-4097)}function hu(d,g,E){Bn=d,vl(d)}function vl(d,g,E){for(var D=(d.mode&1)!==0;Bn!==null;){var K=Bn,ce=K.child;if(K.tag===22&&D){var Ve=K.memoizedState!==null||Do;if(!Ve){var Et=K.alternate,Ft=Et!==null&&Et.memoizedState!==null||ei;Et=Do;var vn=ei;if(Do=Ve,(ei=Ft)&&!vn)for(Bn=K;Bn!==null;)Ve=Bn,Ft=Ve.child,Ve.tag===22&&Ve.memoizedState!==null?$h(K):Ft!==null?(Ft.return=Ve,Bn=Ft):$h(K);for(;ce!==null;)Bn=ce,vl(ce),ce=ce.sibling;Bn=K,Do=Et,ei=vn}Ch(d)}else(K.subtreeFlags&8772)!==0&&ce!==null?(ce.return=K,Bn=ce):Ch(d)}}function Ch(d){for(;Bn!==null;){var g=Bn;if((g.flags&8772)!==0){var E=g.alternate;try{if((g.flags&8772)!==0)switch(g.tag){case 0:case 11:case 15:ei||ba(5,g);break;case 1:var D=g.stateNode;if(g.flags&4&&!ei)if(E===null)D.componentDidMount();else{var K=g.elementType===g.type?E.memoizedProps:wu(g.type,E.memoizedProps);D.componentDidUpdate(K,E.memoizedState,D.__reactInternalSnapshotBeforeUpdate)}var ce=g.updateQueue;ce!==null&&di(g,ce,D);break;case 3:var Ve=g.updateQueue;if(Ve!==null){if(E=null,g.child!==null)switch(g.child.tag){case 5:E=g.child.stateNode;break;case 1:E=g.child.stateNode}di(g,Ve,E)}break;case 5:var Et=g.stateNode;if(E===null&&g.flags&4){E=Et;var Ft=g.memoizedProps;switch(g.type){case"button":case"input":case"select":case"textarea":Ft.autoFocus&&E.focus();break;case"img":Ft.src&&(E.src=Ft.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(g.memoizedState===null){var vn=g.alternate;if(vn!==null){var nr=vn.memoizedState;if(nr!==null){var cr=nr.dehydrated;cr!==null&&Us(cr)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}ei||g.flags&512&&Hc(g)}catch(Kn){Cl(g,g.return,Kn)}}if(g===d){Bn=null;break}if(E=g.sibling,E!==null){E.return=g.return,Bn=E;break}Bn=g.return}}function Ad(d){for(;Bn!==null;){var g=Bn;if(g===d){Bn=null;break}var E=g.sibling;if(E!==null){E.return=g.return,Bn=E;break}Bn=g.return}}function $h(d){for(;Bn!==null;){var g=Bn;try{switch(g.tag){case 0:case 11:case 15:var E=g.return;try{ba(4,g)}catch(Ft){Cl(g,E,Ft)}break;case 1:var D=g.stateNode;if(typeof D.componentDidMount=="function"){var K=g.return;try{D.componentDidMount()}catch(Ft){Cl(g,K,Ft)}}var ce=g.return;try{Hc(g)}catch(Ft){Cl(g,ce,Ft)}break;case 5:var Ve=g.return;try{Hc(g)}catch(Ft){Cl(g,Ve,Ft)}}}catch(Ft){Cl(g,g.return,Ft)}if(g===d){Bn=null;break}var Et=g.sibling;if(Et!==null){Et.return=g.return,Bn=Et;break}Bn=g.return}}var Jf=Math.ceil,Lh=ue.ReactCurrentDispatcher,ff=ue.ReactCurrentOwner,Gl=ue.ReactCurrentBatchConfig,ti=0,Ma=null,Cs=null,Ys=0,Ga=0,yc=lc(0),Ho=0,Td=null,Ra=0,Qf=0,pf=0,ep=null,Uu=null,wm=0,Fp=1/0,sd=null,Sm=!1,q0=null,Su=null,Id=!1,ad=null,tp=0,np=0,bg=null,wg=-1,Em=0;function Vu(){return(ti&6)!==0?So():wg!==-1?wg:wg=So()}function Cd(d){return(d.mode&1)===0?1:(ti&2)!==0&&Ys!==0?Ys&-Ys:Ze.transition!==null?(Em===0&&(Em=zs()),Em):(d=ji,d!==0||(d=window.event,d=d===void 0?16:wc(d.type)),d)}function ld(d,g,E,D){if(50<np)throw np=0,bg=null,Error(t(185));xi(d,E,D),((ti&2)===0||d!==Ma)&&(d===Ma&&((ti&2)===0&&(Qf|=E),Ho===4&&mf(d,Ys)),Eu(d,D),E===1&&ti===0&&(g.mode&1)===0&&(Fp=So()+500,$c&&oe()))}function Eu(d,g){var E=d.callbackNode;Fr(d,g);var D=ks(d,d===Ma?Ys:0);if(D===0)E!==null&&Vi(E),d.callbackNode=null,d.callbackPriority=0;else if(g=D&-D,d.callbackPriority!==g){if(E!=null&&Vi(E),g===1)d.tag===0?ee(rp.bind(null,d)):B(rp.bind(null,d)),Zf(function(){(ti&6)===0&&oe()}),E=null;else{switch(fs(D)){case 1:E=Ea;break;case 4:E=Zo;break;case 16:E=Xa;break;case 536870912:E=ec;break;default:E=Xa}E=Tm(E,$0.bind(null,d))}d.callbackPriority=g,d.callbackNode=E}}function $0(d,g){if(wg=-1,Em=0,(ti&6)!==0)throw Error(t(327));var E=d.callbackNode;if(oh()&&d.callbackNode!==E)return null;var D=ks(d,d===Ma?Ys:0);if(D===0)return null;if((D&30)!==0||(D&d.expiredLanes)!==0||g)g=Am(d,D);else{g=D;var K=ti;ti|=2;var ce=G0();(Ma!==d||Ys!==g)&&(sd=null,Fp=So()+500,ip(d,g));do try{bx();break}catch(Et){B_(d,Et)}while(!0);kt(),Lh.current=ce,ti=K,Cs!==null?g=0:(Ma=null,Ys=0,g=Ho)}if(g!==0){if(g===2&&(K=Rr(d),K!==0&&(D=K,g=Sg(d,K))),g===1)throw E=Td,ip(d,0),mf(d,D),Eu(d,So()),E;if(g===6)mf(d,D);else{if(K=d.current.alternate,(D&30)===0&&!O_(K)&&(g=Am(d,D),g===2&&(ce=Rr(d),ce!==0&&(D=ce,g=Sg(d,ce))),g===1))throw E=Td,ip(d,0),mf(d,D),Eu(d,So()),E;switch(d.finishedWork=K,d.finishedLanes=D,g){case 0:case 1:throw Error(t(345));case 2:yf(d,Uu,sd);break;case 3:if(mf(d,D),(D&130023424)===D&&(g=wm+500-So(),10<g)){if(ks(d,0)!==0)break;if(K=d.suspendedLanes,(K&D)!==D){Vu(),d.pingedLanes|=d.suspendedLanes&K;break}d.timeoutHandle=Vc(yf.bind(null,d,Uu,sd),g);break}yf(d,Uu,sd);break;case 4:if(mf(d,D),(D&4194240)===D)break;for(g=d.eventTimes,K=-1;0<D;){var Ve=31-Yo(D);ce=1<<Ve,Ve=g[Ve],Ve>K&&(K=Ve),D&=~ce}if(D=K,D=So()-D,D=(120>D?120:480>D?480:1080>D?1080:1920>D?1920:3e3>D?3e3:4320>D?4320:1960*Jf(D/1960))-D,10<D){d.timeoutHandle=Vc(yf.bind(null,d,Uu,sd),D);break}yf(d,Uu,sd);break;case 5:yf(d,Uu,sd);break;default:throw Error(t(329))}}}return Eu(d,So()),d.callbackNode===E?$0.bind(null,d):null}function Sg(d,g){var E=ep;return d.current.memoizedState.isDehydrated&&(ip(d,g).flags|=256),d=Am(d,g),d!==2&&(g=Uu,Uu=E,g!==null&&Ud(g)),d}function Ud(d){Uu===null?Uu=d:Uu.push.apply(Uu,d)}function O_(d){for(var g=d;;){if(g.flags&16384){var E=g.updateQueue;if(E!==null&&(E=E.stores,E!==null))for(var D=0;D<E.length;D++){var K=E[D],ce=K.getSnapshot;K=K.value;try{if(!la(ce(),K))return!1}catch{return!1}}}if(E=g.child,g.subtreeFlags&16384&&E!==null)E.return=g,g=E;else{if(g===d)break;for(;g.sibling===null;){if(g.return===null||g.return===d)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function mf(d,g){for(g&=~pf,g&=~Qf,d.suspendedLanes|=g,d.pingedLanes&=~g,d=d.expirationTimes;0<g;){var E=31-Yo(g),D=1<<E;d[E]=-1,g&=~D}}function rp(d){if((ti&6)!==0)throw Error(t(327));oh();var g=ks(d,0);if((g&1)===0)return Eu(d,So()),null;var E=Am(d,g);if(d.tag!==0&&E===2){var D=Rr(d);D!==0&&(g=D,E=Sg(d,D))}if(E===1)throw E=Td,ip(d,0),mf(d,g),Eu(d,So()),E;if(E===6)throw Error(t(345));return d.finishedWork=d.current.alternate,d.finishedLanes=g,yf(d,Uu,sd),Eu(d,So()),null}function Op(d,g){var E=ti;ti|=1;try{return d(g)}finally{ti=E,ti===0&&(Fp=So()+500,$c&&oe())}}function gf(d){ad!==null&&ad.tag===0&&(ti&6)===0&&oh();var g=ti;ti|=1;var E=Gl.transition,D=ji;try{if(Gl.transition=null,ji=1,d)return d()}finally{ji=D,Gl.transition=E,ti=g,(ti&6)===0&&oe()}}function Eg(){Ga=yc.current,Ao(yc)}function ip(d,g){d.finishedWork=null,d.finishedLanes=0;var E=d.timeoutHandle;if(E!==-1&&(d.timeoutHandle=-1,ac(E)),Cs!==null)for(E=Cs.return;E!==null;){var D=E;switch(y(D),D.tag){case 1:D=D.type.childContextTypes,D!=null&&Sh();break;case 3:us(),Ao(yl),Ao(Ua),Ts();break;case 5:Pc(D);break;case 4:us();break;case 13:Ao(Ci);break;case 19:Ao(Ci);break;case 10:jt(D.type._context);break;case 22:case 23:Eg()}E=E.return}if(Ma=d,Cs=d=_f(d.current,null),Ys=Ga=g,Ho=0,Td=null,pf=Qf=Ra=0,Uu=ep=null,Wt!==null){for(g=0;g<Wt.length;g++)if(E=Wt[g],D=E.interleaved,D!==null){E.interleaved=null;var K=D.next,ce=E.pending;if(ce!==null){var Ve=ce.next;ce.next=K,D.next=Ve}E.pending=D}Wt=null}return d}function B_(d,g){do{var E=Cs;try{if(kt(),Va.current=il,ql){for(var D=hs.memoizedState;D!==null;){var K=D.queue;K!==null&&(K.pending=null),D=D.next}ql=!1}if(ps=0,zo=bs=hs=null,Il=!1,Gc=0,ff.current=null,E===null||E.return===null){Ho=1,Td=g,Cs=null;break}e:{var ce=d,Ve=E.return,Et=E,Ft=g;if(g=Ys,Et.flags|=32768,Ft!==null&&typeof Ft=="object"&&typeof Ft.then=="function"){var vn=Ft,nr=Et,cr=nr.tag;if((nr.mode&1)===0&&(cr===0||cr===11||cr===15)){var Kn=nr.alternate;Kn?(nr.updateQueue=Kn.updateQueue,nr.memoizedState=Kn.memoizedState,nr.lanes=Kn.lanes):(nr.updateQueue=null,nr.memoizedState=null)}var Gr=Ie(Ve);if(Gr!==null){Gr.flags&=-257,qe(Gr,Ve,Et,ce,g),Gr.mode&1&&he(ce,vn,g),g=Gr,Ft=vn;var si=g.updateQueue;if(si===null){var fi=new Set;fi.add(Ft),g.updateQueue=fi}else si.add(Ft);break e}else{if((g&1)===0){he(ce,vn,g),H0();break e}Ft=Error(t(426))}}else if(v&&Et.mode&1){var Ll=Ie(Ve);if(Ll!==null){(Ll.flags&65536)===0&&(Ll.flags|=256),qe(Ll,Ve,Et,ce,g),Le(Ih(Ft,Et));break e}}ce=Ft=Ih(Ft,Et),Ho!==4&&(Ho=2),ep===null?ep=[ce]:ep.push(ce),ce=Ve;do{switch(ce.tag){case 3:ce.flags|=65536,g&=-g,ce.lanes|=g;var an=df(ce,Ft,g);dr(ce,an);break e;case 1:Et=Ft;var Ht=ce.type,mn=ce.stateNode;if((ce.flags&128)===0&&(typeof Ht.getDerivedStateFromError=="function"||mn!==null&&typeof mn.componentDidCatch=="function"&&(Su===null||!Su.has(mn)))){ce.flags|=65536,g&=-g,ce.lanes|=g;var gr=O(ce,Et,g);dr(ce,gr);break e}}ce=ce.return}while(ce!==null)}K0(E)}catch(pi){g=pi,Cs===E&&E!==null&&(Cs=E=E.return);continue}break}while(!0)}function G0(){var d=Lh.current;return Lh.current=il,d===null?il:d}function H0(){(Ho===0||Ho===3||Ho===2)&&(Ho=4),Ma===null||(Ra&268435455)===0&&(Qf&268435455)===0||mf(Ma,Ys)}function Am(d,g){var E=ti;ti|=2;var D=G0();(Ma!==d||Ys!==g)&&(sd=null,ip(d,g));do try{xx();break}catch(K){B_(d,K)}while(!0);if(kt(),ti=E,Lh.current=D,Cs!==null)throw Error(t(261));return Ma=null,Ys=0,Ho}function xx(){for(;Cs!==null;)W0(Cs)}function bx(){for(;Cs!==null&&!Ql();)W0(Cs)}function W0(d){var g=Ag(d.alternate,d,Ga);d.memoizedProps=d.pendingProps,g===null?K0(d):Cs=g,ff.current=null}function K0(d){var g=d;do{var E=g.alternate;if(d=g.return,(g.flags&32768)===0){if(E=Qr(E,g,Ga),E!==null){Cs=E;return}}else{if(E=co(E,g),E!==null){E.flags&=32767,Cs=E;return}if(d!==null)d.flags|=32768,d.subtreeFlags=0,d.deletions=null;else{Ho=6,Cs=null;return}}if(g=g.sibling,g!==null){Cs=g;return}Cs=g=d}while(g!==null);Ho===0&&(Ho=5)}function yf(d,g,E){var D=ji,K=Gl.transition;try{Gl.transition=null,ji=1,X0(d,g,E,D)}finally{Gl.transition=K,ji=D}return null}function X0(d,g,E,D){do oh();while(ad!==null);if((ti&6)!==0)throw Error(t(327));E=d.finishedWork;var K=d.finishedLanes;if(E===null)return null;if(d.finishedWork=null,d.finishedLanes=0,E===d.current)throw Error(t(177));d.callbackNode=null,d.callbackPriority=0;var ce=E.lanes|E.childLanes;if(Mi(d,ce),d===Ma&&(Cs=Ma=null,Ys=0),(E.subtreeFlags&2064)===0&&(E.flags&2064)===0||Id||(Id=!0,Tm(Xa,function(){return oh(),null})),ce=(E.flags&15990)!==0,(E.subtreeFlags&15990)!==0||ce){ce=Gl.transition,Gl.transition=null;var Ve=ji;ji=1;var Et=ti;ti|=4,ff.current=null,ns(d,E),ms(E,d),Dh(Ks),zc=!!th,Ks=th=null,d.current=E,hu(E),Pu(),ti=Et,ji=Ve,Gl.transition=ce}else d.current=E;if(Id&&(Id=!1,ad=d,tp=K),ce=d.pendingLanes,ce===0&&(Su=null),pn(E.stateNode),Eu(d,So()),g!==null)for(D=d.onRecoverableError,E=0;E<g.length;E++)K=g[E],D(K.value,{componentStack:K.stack,digest:K.digest});if(Sm)throw Sm=!1,d=q0,q0=null,d;return(tp&1)!==0&&d.tag!==0&&oh(),ce=d.pendingLanes,(ce&1)!==0?d===bg?np++:(np=0,bg=d):np=0,oe(),null}function oh(){if(ad!==null){var d=fs(tp),g=Gl.transition,E=ji;try{if(Gl.transition=null,ji=16>d?16:d,ad===null)var D=!1;else{if(d=ad,ad=null,tp=0,(ti&6)!==0)throw Error(t(331));var K=ti;for(ti|=4,Bn=d.current;Bn!==null;){var ce=Bn,Ve=ce.child;if((Bn.flags&16)!==0){var Et=ce.deletions;if(Et!==null){for(var Ft=0;Ft<Et.length;Ft++){var vn=Et[Ft];for(Bn=vn;Bn!==null;){var nr=Bn;switch(nr.tag){case 0:case 11:case 15:Wn(8,nr,ce)}var cr=nr.child;if(cr!==null)cr.return=nr,Bn=cr;else for(;Bn!==null;){nr=Bn;var Kn=nr.sibling,Gr=nr.return;if(Sd(nr),nr===vn){Bn=null;break}if(Kn!==null){Kn.return=Gr,Bn=Kn;break}Bn=Gr}}}var si=ce.alternate;if(si!==null){var fi=si.child;if(fi!==null){si.child=null;do{var Ll=fi.sibling;fi.sibling=null,fi=Ll}while(fi!==null)}}Bn=ce}}if((ce.subtreeFlags&2064)!==0&&Ve!==null)Ve.return=ce,Bn=Ve;else e:for(;Bn!==null;){if(ce=Bn,(ce.flags&2048)!==0)switch(ce.tag){case 0:case 11:case 15:Wn(9,ce,ce.return)}var an=ce.sibling;if(an!==null){an.return=ce.return,Bn=an;break e}Bn=ce.return}}var Ht=d.current;for(Bn=Ht;Bn!==null;){Ve=Bn;var mn=Ve.child;if((Ve.subtreeFlags&2064)!==0&&mn!==null)mn.return=Ve,Bn=mn;else e:for(Ve=Ht;Bn!==null;){if(Et=Bn,(Et.flags&2048)!==0)try{switch(Et.tag){case 0:case 11:case 15:ba(9,Et)}}catch(pi){Cl(Et,Et.return,pi)}if(Et===Ve){Bn=null;break e}var gr=Et.sibling;if(gr!==null){gr.return=Et.return,Bn=gr;break e}Bn=Et.return}}if(ti=K,oe(),ra&&typeof ra.onPostCommitFiberRoot=="function")try{ra.onPostCommitFiberRoot(Aa,d)}catch{}D=!0}return D}finally{ji=E,Gl.transition=g}}return!1}function qu(d,g,E){g=Ih(E,g),g=df(d,g,1),d=mr(d,g,1),g=Vu(),d!==null&&(xi(d,1,g),Eu(d,g))}function Cl(d,g,E){if(d.tag===3)qu(d,d,E);else for(;g!==null;){if(g.tag===3){qu(g,d,E);break}else if(g.tag===1){var D=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof D.componentDidCatch=="function"&&(Su===null||!Su.has(D))){d=Ih(E,d),d=O(g,d,1),g=mr(g,d,1),d=Vu(),g!==null&&(xi(g,1,d),Eu(g,d));break}}g=g.return}}function Z0(d,g,E){var D=d.pingCache;D!==null&&D.delete(g),g=Vu(),d.pingedLanes|=d.suspendedLanes&E,Ma===d&&(Ys&E)===E&&(Ho===4||Ho===3&&(Ys&130023424)===Ys&&500>So()-wm?ip(d,0):pf|=E),Eu(d,g)}function z_(d,g){g===0&&((d.mode&1)===0?g=1:(g=Ya,Ya<<=1,(Ya&130023424)===0&&(Ya=4194304)));var E=Vu();d=Yt(d,g),d!==null&&(xi(d,g,E),Eu(d,E))}function wx(d){var g=d.memoizedState,E=0;g!==null&&(E=g.retryLane),z_(d,E)}function Sx(d,g){var E=0;switch(d.tag){case 13:var D=d.stateNode,K=d.memoizedState;K!==null&&(E=K.retryLane);break;case 19:D=d.stateNode;break;default:throw Error(t(314))}D!==null&&D.delete(g),z_(d,E)}var Ag;Ag=function(d,g,E){if(d!==null)if(d.memoizedProps!==g.pendingProps||yl.current)Fe=!0;else{if((d.lanes&E)===0&&(g.flags&128)===0)return Fe=!1,Kr(d,g,E);Fe=(d.flags&131072)!==0}else Fe=!1,v&&(g.flags&1048576)!==0&&Jt(g,Ye,g.index);switch(g.lanes=0,g.tag){case 2:var D=g.type;Ui(d,g),d=g.pendingProps;var K=rl(g,Ua.current);Ut(g,E),K=vd(null,g,D,d,K,E);var ce=Bu();return g.flags|=1,typeof K=="object"&&K!==null&&typeof K.render=="function"&&K.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,_l(D)?(ce=!0,cc(g)):ce=!1,g.memoizedState=K.state!==null&&K.state!==void 0?K.state:null,bn(g),K.updater=wd,g.stateNode=K,K._reactInternals=g,Np(g,D,d,E),g=$t(null,g,D,!0,ce,E)):(g.tag=0,v&&ce&&En(g),$e(null,g,K,E),g=g.child),g;case 16:D=g.elementType;e:{switch(Ui(d,g),d=g.pendingProps,K=D._init,D=K(D._payload),g.type=D,K=g.tag=Ex(D),d=wu(D,d),K){case 0:g=gn(null,g,D,d,E);break e;case 1:g=en(null,g,D,d,E);break e;case 11:g=St(null,g,D,d,E);break e;case 14:g=Mt(null,g,D,wu(D.type,d),E);break e}throw Error(t(306,D,""))}return g;case 0:return D=g.type,K=g.pendingProps,K=g.elementType===D?K:wu(D,K),gn(d,g,D,K,E);case 1:return D=g.type,K=g.pendingProps,K=g.elementType===D?K:wu(D,K),en(d,g,D,K,E);case 3:e:{if(un(g),d===null)throw Error(t(387));D=g.pendingProps,ce=g.memoizedState,K=ce.element,Rn(d,g),oi(g,D,null,E);var Ve=g.memoizedState;if(D=Ve.element,ce.isDehydrated)if(ce={element:D,isDehydrated:!1,cache:Ve.cache,pendingSuspenseBoundaries:Ve.pendingSuspenseBoundaries,transitions:Ve.transitions},g.updateQueue.baseState=ce,g.memoizedState=ce,g.flags&256){K=Ih(Error(t(423)),g),g=vr(d,g,D,E,K);break e}else if(D!==K){K=Ih(Error(t(424)),g),g=vr(d,g,D,E,K);break e}else for(f=ca(g.stateNode.containerInfo.firstChild),a=g,v=!0,S=null,E=ot(g,null,D,E),g.child=E;E;)E.flags=E.flags&-3|4096,E=E.sibling;else{if(Ae(),D===K){g=kr(d,g,E);break e}$e(d,g,D,E)}g=g.child}return g;case 5:return uc(g),d===null&&$(g),D=g.type,K=g.pendingProps,ce=d!==null?d.memoizedProps:null,Ve=K.children,Pa(D,K)?Ve=null:ce!==null&&Pa(D,ce)&&(g.flags|=32),Kt(d,g),$e(d,g,Ve,E),g.child;case 6:return d===null&&$(g),null;case 13:return rr(d,g,E);case 4:return ua(g,g.stateNode.containerInfo),D=g.pendingProps,d===null?g.child=it(g,null,D,E):$e(d,g,D,E),g.child;case 11:return D=g.type,K=g.pendingProps,K=g.elementType===D?K:wu(D,K),St(d,g,D,K,E);case 7:return $e(d,g,g.pendingProps,E),g.child;case 8:return $e(d,g,g.pendingProps.children,E),g.child;case 12:return $e(d,g,g.pendingProps.children,E),g.child;case 10:e:{if(D=g.type._context,K=g.pendingProps,ce=g.memoizedProps,Ve=K.value,$i(bt,D._currentValue),D._currentValue=Ve,ce!==null)if(la(ce.value,Ve)){if(ce.children===K.children&&!yl.current){g=kr(d,g,E);break e}}else for(ce=g.child,ce!==null&&(ce.return=g);ce!==null;){var Et=ce.dependencies;if(Et!==null){Ve=ce.child;for(var Ft=Et.firstContext;Ft!==null;){if(Ft.context===D){if(ce.tag===1){Ft=hr(-1,E&-E),Ft.tag=2;var vn=ce.updateQueue;if(vn!==null){vn=vn.shared;var nr=vn.pending;nr===null?Ft.next=Ft:(Ft.next=nr.next,nr.next=Ft),vn.pending=Ft}}ce.lanes|=E,Ft=ce.alternate,Ft!==null&&(Ft.lanes|=E),_n(ce.return,E,g),Et.lanes|=E;break}Ft=Ft.next}}else if(ce.tag===10)Ve=ce.type===g.type?null:ce.child;else if(ce.tag===18){if(Ve=ce.return,Ve===null)throw Error(t(341));Ve.lanes|=E,Et=Ve.alternate,Et!==null&&(Et.lanes|=E),_n(Ve,E,g),Ve=ce.sibling}else Ve=ce.child;if(Ve!==null)Ve.return=ce;else for(Ve=ce;Ve!==null;){if(Ve===g){Ve=null;break}if(ce=Ve.sibling,ce!==null){ce.return=Ve.return,Ve=ce;break}Ve=Ve.return}ce=Ve}$e(d,g,K.children,E),g=g.child}return g;case 9:return K=g.type,D=g.pendingProps.children,Ut(g,E),K=cn(K),D=D(K),g.flags|=1,$e(d,g,D,E),g.child;case 14:return D=g.type,K=wu(D,g.pendingProps),K=wu(D.type,K),Mt(d,g,D,K,E);case 15:return gt(d,g,g.type,g.pendingProps,E);case 17:return D=g.type,K=g.pendingProps,K=g.elementType===D?K:wu(D,K),Ui(d,g),g.tag=1,_l(D)?(d=!0,cc(g)):d=!1,Ut(g,E),Rp(g,D,K),Np(g,D,K,E),$t(null,g,D,!0,d,E);case 19:return Ur(d,g,E);case 22:return Zt(d,g,E)}throw Error(t(156,g.tag))};function Tm(d,g){return al(d,g)}function j_(d,g,E,D){this.tag=d,this.key=E,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=D,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Wc(d,g,E,D){return new j_(d,g,E,D)}function op(d){return d=d.prototype,!(!d||!d.isReactComponent)}function Ex(d){if(typeof d=="function")return op(d)?1:0;if(d!=null){if(d=d.$$typeof,d===H)return 11;if(d===Me)return 14}return 2}function _f(d,g){var E=d.alternate;return E===null?(E=Wc(d.tag,g,d.key,d.mode),E.elementType=d.elementType,E.type=d.type,E.stateNode=d.stateNode,E.alternate=d,d.alternate=E):(E.pendingProps=g,E.type=d.type,E.flags=0,E.subtreeFlags=0,E.deletions=null),E.flags=d.flags&14680064,E.childLanes=d.childLanes,E.lanes=d.lanes,E.child=d.child,E.memoizedProps=d.memoizedProps,E.memoizedState=d.memoizedState,E.updateQueue=d.updateQueue,g=d.dependencies,E.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},E.sibling=d.sibling,E.index=d.index,E.ref=d.ref,E}function Tg(d,g,E,D,K,ce){var Ve=2;if(D=d,typeof d=="function")op(d)&&(Ve=1);else if(typeof d=="string")Ve=5;else e:switch(d){case pe:return sp(E.children,K,ce,g);case U:Ve=8,K|=8;break;case F:return d=Wc(12,E,g,K|2),d.elementType=F,d.lanes=ce,d;case Z:return d=Wc(13,E,g,K),d.elementType=Z,d.lanes=ce,d;case be:return d=Wc(19,E,g,K),d.elementType=be,d.lanes=ce,d;case Re:return Ig(E,K,ce,g);default:if(typeof d=="object"&&d!==null)switch(d.$$typeof){case q:Ve=10;break e;case j:Ve=9;break e;case H:Ve=11;break e;case Me:Ve=14;break e;case Be:Ve=16,D=null;break e}throw Error(t(130,d==null?d:typeof d,""))}return g=Wc(Ve,E,g,K),g.elementType=d,g.type=D,g.lanes=ce,g}function sp(d,g,E,D){return d=Wc(7,d,D,g),d.lanes=E,d}function Ig(d,g,E,D){return d=Wc(22,d,D,g),d.elementType=Re,d.lanes=E,d.stateNode={isHidden:!1},d}function Y0(d,g,E){return d=Wc(6,d,null,g),d.lanes=E,d}function J0(d,g,E){return g=Wc(4,d.children!==null?d.children:[],d.key,g),g.lanes=E,g.stateNode={containerInfo:d.containerInfo,pendingChildren:null,implementation:d.implementation},g}function Q0(d,g,E,D,K){this.tag=g,this.containerInfo=d,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ta(0),this.expirationTimes=Ta(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ta(0),this.identifierPrefix=D,this.onRecoverableError=K,this.mutableSourceEagerHydrationData=null}function ey(d,g,E,D,K,ce,Ve,Et,Ft){return d=new Q0(d,g,E,Et,Ft),g===1?(g=1,ce===!0&&(g|=8)):g=0,ce=Wc(3,null,null,g),d.current=ce,ce.stateNode=d,ce.memoizedState={element:D,isDehydrated:E,cache:null,transitions:null,pendingSuspenseBoundaries:null},bn(ce),d}function Bp(d,g,E){var D=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ze,key:D==null?null:""+D,children:d,containerInfo:g,implementation:E}}function U_(d){if(!d)return Ou;d=d._reactInternals;e:{if(no(d)!==d||d.tag!==1)throw Error(t(170));var g=d;do{switch(g.tag){case 3:g=g.stateNode.context;break e;case 1:if(_l(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break e}}g=g.return}while(g!==null);throw Error(t(171))}if(d.tag===1){var E=d.type;if(_l(E))return Vl(d,E,g)}return g}function ol(d,g,E,D,K,ce,Ve,Et,Ft){return d=ey(E,D,!0,d,K,ce,Ve,Et,Ft),d.context=U_(null),E=d.current,D=Vu(),K=Cd(E),ce=hr(D,K),ce.callback=g??null,mr(E,ce,K),d.current.lanes=K,xi(d,K,D),Eu(d,D),d}function ap(d,g,E,D){var K=g.current,ce=Vu(),Ve=Cd(K);return E=U_(E),g.context===null?g.context=E:g.pendingContext=E,g=hr(ce,Ve),g.payload={element:d},D=D===void 0?null:D,D!==null&&(g.callback=D),d=mr(K,g,Ve),d!==null&&(ld(d,K,Ve,ce),sr(d,K,Ve)),Ve}function Im(d){if(d=d.current,!d.child)return null;switch(d.child.tag){case 5:return d.child.stateNode;default:return d.child.stateNode}}function Cm(d,g){if(d=d.memoizedState,d!==null&&d.dehydrated!==null){var E=d.retryLane;d.retryLane=E!==0&&E<g?E:g}}function zp(d,g){Cm(d,g),(d=d.alternate)&&Cm(d,g)}function Lm(){return null}var ty=typeof reportError=="function"?reportError:function(d){console.error(d)};function Cg(d){this._internalRoot=d}vf.prototype.render=Cg.prototype.render=function(d){var g=this._internalRoot;if(g===null)throw Error(t(409));ap(d,g,null,null)},vf.prototype.unmount=Cg.prototype.unmount=function(){var d=this._internalRoot;if(d!==null){this._internalRoot=null;var g=d.containerInfo;gf(function(){ap(null,d,null,null)}),g[xa]=null}};function vf(d){this._internalRoot=d}vf.prototype.unstable_scheduleHydration=function(d){if(d){var g=eu();d={blockedOn:null,target:d,priority:g};for(var E=0;E<Eo.length&&g!==0&&g<Eo[E].priority;E++);Eo.splice(E,0,d),E===0&&Mu(d)}};function Pm(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)}function jp(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11&&(d.nodeType!==8||d.nodeValue!==" react-mount-point-unstable "))}function Lg(){}function Ax(d,g,E,D,K){if(K){if(typeof D=="function"){var ce=D;D=function(){var vn=Im(Ve);ce.call(vn)}}var Ve=ol(g,D,d,0,null,!1,!1,"",Lg);return d._reactRootContainer=Ve,d[xa]=Ve.current,sc(d.nodeType===8?d.parentNode:d),gf(),Ve}for(;K=d.lastChild;)d.removeChild(K);if(typeof D=="function"){var Et=D;D=function(){var vn=Im(Ft);Et.call(vn)}}var Ft=ey(d,0,!1,null,null,!1,!1,"",Lg);return d._reactRootContainer=Ft,d[xa]=Ft.current,sc(d.nodeType===8?d.parentNode:d),gf(function(){ap(g,Ft,E,D)}),Ft}function km(d,g,E,D,K){var ce=E._reactRootContainer;if(ce){var Ve=ce;if(typeof K=="function"){var Et=K;K=function(){var Ft=Im(Ve);Et.call(Ft)}}ap(g,Ve,d,K)}else Ve=Ax(E,g,d,K,D);return Im(Ve)}Fi=function(d){switch(d.tag){case 3:var g=d.stateNode;if(g.current.memoizedState.isDehydrated){var E=ll(g.pendingLanes);E!==0&&(El(g,E|1),Eu(g,So()),(ti&6)===0&&(Fp=So()+500,oe()))}break;case 13:gf(function(){var D=Yt(d,1);if(D!==null){var K=Vu();ld(D,d,1,K)}}),zp(d,1)}},yu=function(d){if(d.tag===13){var g=Yt(d,134217728);if(g!==null){var E=Vu();ld(g,d,134217728,E)}zp(d,134217728)}},tc=function(d){if(d.tag===13){var g=Cd(d),E=Yt(d,g);if(E!==null){var D=Vu();ld(E,d,g,D)}zp(d,g)}},eu=function(){return ji},bc=function(d,g){var E=ji;try{return ji=d,g()}finally{ji=E}},lt=function(d,g,E){switch(g){case"input":if(br(d,E),g=E.name,E.type==="radio"&&g!=null){for(E=d;E.parentNode;)E=E.parentNode;for(E=E.querySelectorAll("input[name="+JSON.stringify(""+g)+'][type="radio"]'),g=0;g<E.length;g++){var D=E[g];if(D!==d&&D.form===d.form){var K=Cc(D);if(!K)throw Error(t(90));yn(D),br(D,K)}}}break;case"textarea":Ln(d,E);break;case"select":g=E.value,g!=null&&Jn(d,!!E.multiple,g,!1)}},Rt=Op,Ot=gf;var Mm={usingClientEntryPoint:!1,Events:[wh,su,Cc,ht,Ct,Op]},Rm={findFiberByHostInstance:ka,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ny={bundleType:Rm.bundleType,version:Rm.version,rendererPackageName:Rm.rendererPackageName,rendererConfig:Rm.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ue.ReactCurrentDispatcher,findHostInstanceByFiber:function(d){return d=fa(d),d===null?null:d.stateNode},findFiberByHostInstance:Rm.findFiberByHostInstance||Lm,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Pg=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Pg.isDisabled&&Pg.supportsFiber)try{Aa=Pg.inject(ny),ra=Pg}catch{}}return Kh.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Mm,Kh.createPortal=function(d,g){var E=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Pm(g))throw Error(t(200));return Bp(d,g,null,E)},Kh.createRoot=function(d,g){if(!Pm(d))throw Error(t(299));var E=!1,D="",K=ty;return g!=null&&(g.unstable_strictMode===!0&&(E=!0),g.identifierPrefix!==void 0&&(D=g.identifierPrefix),g.onRecoverableError!==void 0&&(K=g.onRecoverableError)),g=ey(d,1,!1,null,null,E,!1,D,K),d[xa]=g.current,sc(d.nodeType===8?d.parentNode:d),new Cg(g)},Kh.findDOMNode=function(d){if(d==null)return null;if(d.nodeType===1)return d;var g=d._reactInternals;if(g===void 0)throw typeof d.render=="function"?Error(t(188)):(d=Object.keys(d).join(","),Error(t(268,d)));return d=fa(g),d=d===null?null:d.stateNode,d},Kh.flushSync=function(d){return gf(d)},Kh.hydrate=function(d,g,E){if(!jp(g))throw Error(t(200));return km(null,d,g,!0,E)},Kh.hydrateRoot=function(d,g,E){if(!Pm(d))throw Error(t(405));var D=E!=null&&E.hydratedSources||null,K=!1,ce="",Ve=ty;if(E!=null&&(E.unstable_strictMode===!0&&(K=!0),E.identifierPrefix!==void 0&&(ce=E.identifierPrefix),E.onRecoverableError!==void 0&&(Ve=E.onRecoverableError)),g=ol(g,null,d,1,E??null,K,!1,ce,Ve),d[xa]=g.current,sc(d),D)for(d=0;d<D.length;d++)E=D[d],K=E._getVersion,K=K(E._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[E,K]:g.mutableSourceEagerHydrationData.push(E,K);return new vf(g)},Kh.render=function(d,g,E){if(!jp(g))throw Error(t(200));return km(null,d,g,!1,E)},Kh.unmountComponentAtNode=function(d){if(!jp(d))throw Error(t(40));return d._reactRootContainer?(gf(function(){km(null,null,d,!1,function(){d._reactRootContainer=null,d[xa]=null})}),!0):!1},Kh.unstable_batchedUpdates=Op,Kh.unstable_renderSubtreeIntoContainer=function(d,g,E,D){if(!jp(E))throw Error(t(200));if(d==null||d._reactInternals===void 0)throw Error(t(38));return km(d,g,E,!1,D)},Kh.version="18.3.1-next-f1338f8080-20240426",Kh}var x2;function UL(){if(x2)return ib.exports;x2=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),ib.exports=jL(),ib.exports}var b2;function VL(){if(b2)return l1;b2=1;var n=UL();return l1.createRoot=n.createRoot,l1.hydrateRoot=n.hydrateRoot,l1}var qL=VL();const $L=Wv(qL);/**
 * react-router v7.8.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var w2="popstate";function GL(n={}){function e(i,c){let{pathname:u,search:m,hash:_}=i.location;return h5("",{pathname:u,search:m,hash:_},c.state&&c.state.usr||null,c.state&&c.state.key||"default")}function t(i,c){return typeof c=="string"?c:n_(c)}return WL(e,t,null,n)}function Yl(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function $f(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function HL(){return Math.random().toString(36).substring(2,10)}function S2(n,e){return{usr:n.state,key:n.key,idx:e}}function h5(n,e,t=null,i){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof e=="string"?M0(e):e,state:t,key:e&&e.key||i||HL()}}function n_({pathname:n="/",search:e="",hash:t=""}){return e&&e!=="?"&&(n+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(n+=t.charAt(0)==="#"?t:"#"+t),n}function M0(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substring(t),n=n.substring(0,t));let i=n.indexOf("?");i>=0&&(e.search=n.substring(i),n=n.substring(0,i)),n&&(e.pathname=n)}return e}function WL(n,e,t,i={}){let{window:c=document.defaultView,v5Compat:u=!1}=i,m=c.history,_="POP",o=null,w=I();w==null&&(w=0,m.replaceState({...m.state,idx:w},""));function I(){return(m.state||{idx:null}).idx}function R(){_="POP";let fe=I(),J=fe==null?null:fe-w;w=fe,o&&o({action:_,location:ae.location,delta:J})}function V(fe,J){_="PUSH";let ne=h5(ae.location,fe,J);w=I()+1;let me=S2(ne,w),ue=ae.createHref(ne);try{m.pushState(me,"",ue)}catch(ke){if(ke instanceof DOMException&&ke.name==="DataCloneError")throw ke;c.location.assign(ue)}u&&o&&o({action:_,location:ae.location,delta:1})}function k(fe,J){_="REPLACE";let ne=h5(ae.location,fe,J);w=I();let me=S2(ne,w),ue=ae.createHref(ne);m.replaceState(me,"",ue),u&&o&&o({action:_,location:ae.location,delta:0})}function ie(fe){return KL(fe)}let ae={get action(){return _},get location(){return n(c,m)},listen(fe){if(o)throw new Error("A history only accepts one active listener");return c.addEventListener(w2,R),o=fe,()=>{c.removeEventListener(w2,R),o=null}},createHref(fe){return e(c,fe)},createURL:ie,encodeLocation(fe){let J=ie(fe);return{pathname:J.pathname,search:J.search,hash:J.hash}},push:V,replace:k,go(fe){return m.go(fe)}};return ae}function KL(n,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),Yl(t,"No window.location.(origin|href) available to create URL");let i=typeof n=="string"?n:n_(n);return i=i.replace(/ $/,"%20"),!e&&i.startsWith("//")&&(i=t+i),new URL(i,t)}function OT(n,e,t="/"){return XL(n,e,t,!1)}function XL(n,e,t,i){let c=typeof e=="string"?M0(e):e,u=Ep(c.pathname||"/",t);if(u==null)return null;let m=BT(n);ZL(m);let _=null;for(let o=0;_==null&&o<m.length;++o){let w=aP(u);_=oP(m[o],w,i)}return _}function BT(n,e=[],t=[],i="",c=!1){let u=(m,_,o=c,w)=>{let I={relativePath:w===void 0?m.path||"":w,caseSensitive:m.caseSensitive===!0,childrenIndex:_,route:m};if(I.relativePath.startsWith("/")){if(!I.relativePath.startsWith(i)&&o)return;Yl(I.relativePath.startsWith(i),`Absolute route path "${I.relativePath}" nested under path "${i}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),I.relativePath=I.relativePath.slice(i.length)}let R=xp([i,I.relativePath]),V=t.concat(I);m.children&&m.children.length>0&&(Yl(m.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${R}".`),BT(m.children,e,V,R,o)),!(m.path==null&&!m.index)&&e.push({path:R,score:rP(R,m.index),routesMeta:V})};return n.forEach((m,_)=>{if(m.path===""||!m.path?.includes("?"))u(m,_);else for(let o of zT(m.path))u(m,_,!0,o)}),e}function zT(n){let e=n.split("/");if(e.length===0)return[];let[t,...i]=e,c=t.endsWith("?"),u=t.replace(/\?$/,"");if(i.length===0)return c?[u,""]:[u];let m=zT(i.join("/")),_=[];return _.push(...m.map(o=>o===""?u:[u,o].join("/"))),c&&_.push(...m),_.map(o=>n.startsWith("/")&&o===""?"/":o)}function ZL(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:iP(e.routesMeta.map(i=>i.childrenIndex),t.routesMeta.map(i=>i.childrenIndex)))}var YL=/^:[\w-]+$/,JL=3,QL=2,eP=1,tP=10,nP=-2,E2=n=>n==="*";function rP(n,e){let t=n.split("/"),i=t.length;return t.some(E2)&&(i+=nP),e&&(i+=QL),t.filter(c=>!E2(c)).reduce((c,u)=>c+(YL.test(u)?JL:u===""?eP:tP),i)}function iP(n,e){return n.length===e.length&&n.slice(0,-1).every((i,c)=>i===e[c])?n[n.length-1]-e[e.length-1]:0}function oP(n,e,t=!1){let{routesMeta:i}=n,c={},u="/",m=[];for(let _=0;_<i.length;++_){let o=i[_],w=_===i.length-1,I=u==="/"?e:e.slice(u.length)||"/",R=uv({path:o.relativePath,caseSensitive:o.caseSensitive,end:w},I),V=o.route;if(!R&&w&&t&&!i[i.length-1].route.index&&(R=uv({path:o.relativePath,caseSensitive:o.caseSensitive,end:!1},I)),!R)return null;Object.assign(c,R.params),m.push({params:c,pathname:xp([u,R.pathname]),pathnameBase:hP(xp([u,R.pathnameBase])),route:V}),R.pathnameBase!=="/"&&(u=xp([u,R.pathnameBase]))}return m}function uv(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,i]=sP(n.path,n.caseSensitive,n.end),c=e.match(t);if(!c)return null;let u=c[0],m=u.replace(/(.)\/+$/,"$1"),_=c.slice(1);return{params:i.reduce((w,{paramName:I,isOptional:R},V)=>{if(I==="*"){let ie=_[V]||"";m=u.slice(0,u.length-ie.length).replace(/(.)\/+$/,"$1")}const k=_[V];return R&&!k?w[I]=void 0:w[I]=(k||"").replace(/%2F/g,"/"),w},{}),pathname:u,pathnameBase:m,pattern:n}}function sP(n,e=!1,t=!0){$f(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let i=[],c="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(m,_,o)=>(i.push({paramName:_,isOptional:o!=null}),o?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return n.endsWith("*")?(i.push({paramName:"*"}),c+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?c+="\\/*$":n!==""&&n!=="/"&&(c+="(?:(?=\\/|$))"),[new RegExp(c,e?void 0:"i"),i]}function aP(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return $f(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),n}}function Ep(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,i=n.charAt(t);return i&&i!=="/"?null:n.slice(t)||"/"}function lP(n,e="/"){let{pathname:t,search:i="",hash:c=""}=typeof n=="string"?M0(n):n;return{pathname:t?t.startsWith("/")?t:cP(t,e):e,search:dP(i),hash:fP(c)}}function cP(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(c=>{c===".."?t.length>1&&t.pop():c!=="."&&t.push(c)}),t.length>1?t.join("/"):"/"}function ab(n,e,t,i){return`Cannot include a '${n}' character in a manually specified \`to.${e}\` field [${JSON.stringify(i)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function uP(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function jT(n){let e=uP(n);return e.map((t,i)=>i===e.length-1?t.pathname:t.pathnameBase)}function UT(n,e,t,i=!1){let c;typeof n=="string"?c=M0(n):(c={...n},Yl(!c.pathname||!c.pathname.includes("?"),ab("?","pathname","search",c)),Yl(!c.pathname||!c.pathname.includes("#"),ab("#","pathname","hash",c)),Yl(!c.search||!c.search.includes("#"),ab("#","search","hash",c)));let u=n===""||c.pathname==="",m=u?"/":c.pathname,_;if(m==null)_=t;else{let R=e.length-1;if(!i&&m.startsWith("..")){let V=m.split("/");for(;V[0]==="..";)V.shift(),R-=1;c.pathname=V.join("/")}_=R>=0?e[R]:"/"}let o=lP(c,_),w=m&&m!=="/"&&m.endsWith("/"),I=(u||m===".")&&t.endsWith("/");return!o.pathname.endsWith("/")&&(w||I)&&(o.pathname+="/"),o}var xp=n=>n.join("/").replace(/\/\/+/g,"/"),hP=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),dP=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,fP=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function pP(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}var VT=["POST","PUT","PATCH","DELETE"];new Set(VT);var mP=["GET",...VT];new Set(mP);var R0=Nn.createContext(null);R0.displayName="DataRouter";var Kv=Nn.createContext(null);Kv.displayName="DataRouterState";Nn.createContext(!1);var qT=Nn.createContext({isTransitioning:!1});qT.displayName="ViewTransition";var gP=Nn.createContext(new Map);gP.displayName="Fetchers";var yP=Nn.createContext(null);yP.displayName="Await";var Wf=Nn.createContext(null);Wf.displayName="Navigation";var y_=Nn.createContext(null);y_.displayName="Location";var Kf=Nn.createContext({outlet:null,matches:[],isDataRoute:!1});Kf.displayName="Route";var hw=Nn.createContext(null);hw.displayName="RouteError";function _P(n,{relative:e}={}){Yl(__(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:i}=Nn.useContext(Wf),{hash:c,pathname:u,search:m}=v_(n,{relative:e}),_=u;return t!=="/"&&(_=u==="/"?t:xp([t,u])),i.createHref({pathname:_,search:m,hash:c})}function __(){return Nn.useContext(y_)!=null}function hg(){return Yl(__(),"useLocation() may be used only in the context of a <Router> component."),Nn.useContext(y_).location}var $T="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function GT(n){Nn.useContext(Wf).static||Nn.useLayoutEffect(n)}function vP(){let{isDataRoute:n}=Nn.useContext(Kf);return n?RP():xP()}function xP(){Yl(__(),"useNavigate() may be used only in the context of a <Router> component.");let n=Nn.useContext(R0),{basename:e,navigator:t}=Nn.useContext(Wf),{matches:i}=Nn.useContext(Kf),{pathname:c}=hg(),u=JSON.stringify(jT(i)),m=Nn.useRef(!1);return GT(()=>{m.current=!0}),Nn.useCallback((o,w={})=>{if($f(m.current,$T),!m.current)return;if(typeof o=="number"){t.go(o);return}let I=UT(o,JSON.parse(u),c,w.relative==="path");n==null&&e!=="/"&&(I.pathname=I.pathname==="/"?e:xp([e,I.pathname])),(w.replace?t.replace:t.push)(I,w.state,w)},[e,t,u,c,n])}Nn.createContext(null);function bP(){let{matches:n}=Nn.useContext(Kf),e=n[n.length-1];return e?e.params:{}}function v_(n,{relative:e}={}){let{matches:t}=Nn.useContext(Kf),{pathname:i}=hg(),c=JSON.stringify(jT(t));return Nn.useMemo(()=>UT(n,JSON.parse(c),i,e==="path"),[n,c,i,e])}function wP(n,e){return HT(n,e)}function HT(n,e,t,i){Yl(__(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:c}=Nn.useContext(Wf),{matches:u}=Nn.useContext(Kf),m=u[u.length-1],_=m?m.params:{},o=m?m.pathname:"/",w=m?m.pathnameBase:"/",I=m&&m.route;{let J=I&&I.path||"";WT(o,!I||J.endsWith("*")||J.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${o}" (under <Route path="${J}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${J}"> to <Route path="${J==="/"?"*":`${J}/*`}">.`)}let R=hg(),V;if(e){let J=typeof e=="string"?M0(e):e;Yl(w==="/"||J.pathname?.startsWith(w),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${w}" but pathname "${J.pathname}" was given in the \`location\` prop.`),V=J}else V=R;let k=V.pathname||"/",ie=k;if(w!=="/"){let J=w.replace(/^\//,"").split("/");ie="/"+k.replace(/^\//,"").split("/").slice(J.length).join("/")}let ae=OT(n,{pathname:ie});$f(I||ae!=null,`No routes matched location "${V.pathname}${V.search}${V.hash}" `),$f(ae==null||ae[ae.length-1].route.element!==void 0||ae[ae.length-1].route.Component!==void 0||ae[ae.length-1].route.lazy!==void 0,`Matched leaf route at location "${V.pathname}${V.search}${V.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let fe=IP(ae&&ae.map(J=>Object.assign({},J,{params:Object.assign({},_,J.params),pathname:xp([w,c.encodeLocation?c.encodeLocation(J.pathname).pathname:J.pathname]),pathnameBase:J.pathnameBase==="/"?w:xp([w,c.encodeLocation?c.encodeLocation(J.pathnameBase).pathname:J.pathnameBase])})),u,t,i);return e&&fe?Nn.createElement(y_.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...V},navigationType:"POP"}},fe):fe}function SP(){let n=MP(),e=pP(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,i="rgba(200,200,200, 0.5)",c={padding:"0.5rem",backgroundColor:i},u={padding:"2px 4px",backgroundColor:i},m=null;return console.error("Error handled by React Router default ErrorBoundary:",n),m=Nn.createElement(Nn.Fragment,null,Nn.createElement("p",null," Hey developer "),Nn.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",Nn.createElement("code",{style:u},"ErrorBoundary")," or"," ",Nn.createElement("code",{style:u},"errorElement")," prop on your route.")),Nn.createElement(Nn.Fragment,null,Nn.createElement("h2",null,"Unexpected Application Error!"),Nn.createElement("h3",{style:{fontStyle:"italic"}},e),t?Nn.createElement("pre",{style:c},t):null,m)}var EP=Nn.createElement(SP,null),AP=class extends Nn.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,e){return e.location!==n.location||e.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:e.error,location:e.location,revalidation:n.revalidation||e.revalidation}}componentDidCatch(n,e){console.error("React Router caught the following error during render",n,e)}render(){return this.state.error!==void 0?Nn.createElement(Kf.Provider,{value:this.props.routeContext},Nn.createElement(hw.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function TP({routeContext:n,match:e,children:t}){let i=Nn.useContext(R0);return i&&i.static&&i.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=e.route.id),Nn.createElement(Kf.Provider,{value:n},t)}function IP(n,e=[],t=null,i=null){if(n==null){if(!t)return null;if(t.errors)n=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let c=n,u=t?.errors;if(u!=null){let o=c.findIndex(w=>w.route.id&&u?.[w.route.id]!==void 0);Yl(o>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(u).join(",")}`),c=c.slice(0,Math.min(c.length,o+1))}let m=!1,_=-1;if(t)for(let o=0;o<c.length;o++){let w=c[o];if((w.route.HydrateFallback||w.route.hydrateFallbackElement)&&(_=o),w.route.id){let{loaderData:I,errors:R}=t,V=w.route.loader&&!I.hasOwnProperty(w.route.id)&&(!R||R[w.route.id]===void 0);if(w.route.lazy||V){m=!0,_>=0?c=c.slice(0,_+1):c=[c[0]];break}}}return c.reduceRight((o,w,I)=>{let R,V=!1,k=null,ie=null;t&&(R=u&&w.route.id?u[w.route.id]:void 0,k=w.route.errorElement||EP,m&&(_<0&&I===0?(WT("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),V=!0,ie=null):_===I&&(V=!0,ie=w.route.hydrateFallbackElement||null)));let ae=e.concat(c.slice(0,I+1)),fe=()=>{let J;return R?J=k:V?J=ie:w.route.Component?J=Nn.createElement(w.route.Component,null):w.route.element?J=w.route.element:J=o,Nn.createElement(TP,{match:w,routeContext:{outlet:o,matches:ae,isDataRoute:t!=null},children:J})};return t&&(w.route.ErrorBoundary||w.route.errorElement||I===0)?Nn.createElement(AP,{location:t.location,revalidation:t.revalidation,component:k,error:R,children:fe(),routeContext:{outlet:null,matches:ae,isDataRoute:!0}}):fe()},null)}function dw(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function CP(n){let e=Nn.useContext(R0);return Yl(e,dw(n)),e}function LP(n){let e=Nn.useContext(Kv);return Yl(e,dw(n)),e}function PP(n){let e=Nn.useContext(Kf);return Yl(e,dw(n)),e}function fw(n){let e=PP(n),t=e.matches[e.matches.length-1];return Yl(t.route.id,`${n} can only be used on routes that contain a unique "id"`),t.route.id}function kP(){return fw("useRouteId")}function MP(){let n=Nn.useContext(hw),e=LP("useRouteError"),t=fw("useRouteError");return n!==void 0?n:e.errors?.[t]}function RP(){let{router:n}=CP("useNavigate"),e=fw("useNavigate"),t=Nn.useRef(!1);return GT(()=>{t.current=!0}),Nn.useCallback(async(c,u={})=>{$f(t.current,$T),t.current&&(typeof c=="number"?n.navigate(c):await n.navigate(c,{fromRouteId:e,...u}))},[n,e])}var A2={};function WT(n,e,t){!e&&!A2[n]&&(A2[n]=!0,$f(!1,t))}Nn.memo(NP);function NP({routes:n,future:e,state:t}){return HT(n,void 0,t,e)}function qm(n){Yl(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function DP({basename:n="/",children:e=null,location:t,navigationType:i="POP",navigator:c,static:u=!1}){Yl(!__(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let m=n.replace(/^\/*/,"/"),_=Nn.useMemo(()=>({basename:m,navigator:c,static:u,future:{}}),[m,c,u]);typeof t=="string"&&(t=M0(t));let{pathname:o="/",search:w="",hash:I="",state:R=null,key:V="default"}=t,k=Nn.useMemo(()=>{let ie=Ep(o,m);return ie==null?null:{location:{pathname:ie,search:w,hash:I,state:R,key:V},navigationType:i}},[m,o,w,I,R,V,i]);return $f(k!=null,`<Router basename="${m}"> is not able to match the URL "${o}${w}${I}" because it does not start with the basename, so the <Router> won't render anything.`),k==null?null:Nn.createElement(Wf.Provider,{value:_},Nn.createElement(y_.Provider,{children:e,value:k}))}function FP({children:n,location:e}){return wP(d5(n),e)}function d5(n,e=[]){let t=[];return Nn.Children.forEach(n,(i,c)=>{if(!Nn.isValidElement(i))return;let u=[...e,c];if(i.type===Nn.Fragment){t.push.apply(t,d5(i.props.children,u));return}Yl(i.type===qm,`[${typeof i.type=="string"?i.type:i.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Yl(!i.props.index||!i.props.children,"An index route cannot have child routes.");let m={id:i.props.id||u.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,loader:i.props.loader,action:i.props.action,hydrateFallbackElement:i.props.hydrateFallbackElement,HydrateFallback:i.props.HydrateFallback,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.hasErrorBoundary===!0||i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(m.children=d5(i.props.children,u)),t.push(m)}),t}var D1="get",F1="application/x-www-form-urlencoded";function Xv(n){return n!=null&&typeof n.tagName=="string"}function OP(n){return Xv(n)&&n.tagName.toLowerCase()==="button"}function BP(n){return Xv(n)&&n.tagName.toLowerCase()==="form"}function zP(n){return Xv(n)&&n.tagName.toLowerCase()==="input"}function jP(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function UP(n,e){return n.button===0&&(!e||e==="_self")&&!jP(n)}var c1=null;function VP(){if(c1===null)try{new FormData(document.createElement("form"),0),c1=!1}catch{c1=!0}return c1}var qP=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function lb(n){return n!=null&&!qP.has(n)?($f(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${F1}"`),null):n}function $P(n,e){let t,i,c,u,m;if(BP(n)){let _=n.getAttribute("action");i=_?Ep(_,e):null,t=n.getAttribute("method")||D1,c=lb(n.getAttribute("enctype"))||F1,u=new FormData(n)}else if(OP(n)||zP(n)&&(n.type==="submit"||n.type==="image")){let _=n.form;if(_==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let o=n.getAttribute("formaction")||_.getAttribute("action");if(i=o?Ep(o,e):null,t=n.getAttribute("formmethod")||_.getAttribute("method")||D1,c=lb(n.getAttribute("formenctype"))||lb(_.getAttribute("enctype"))||F1,u=new FormData(_,n),!VP()){let{name:w,type:I,value:R}=n;if(I==="image"){let V=w?`${w}.`:"";u.append(`${V}x`,"0"),u.append(`${V}y`,"0")}else w&&u.append(w,R)}}else{if(Xv(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=D1,i=null,c=F1,m=n}return u&&c==="text/plain"&&(m=u,u=void 0),{action:i,method:t.toLowerCase(),encType:c,formData:u,body:m}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function pw(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function GP(n,e,t){let i=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return i.pathname==="/"?i.pathname=`_root.${t}`:e&&Ep(i.pathname,e)==="/"?i.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:i.pathname=`${i.pathname.replace(/\/$/,"")}.${t}`,i}async function HP(n,e){if(n.id in e)return e[n.id];try{let t=await import(n.module);return e[n.id]=t,t}catch(t){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function WP(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function KP(n,e,t){let i=await Promise.all(n.map(async c=>{let u=e.routes[c.route.id];if(u){let m=await HP(u,t);return m.links?m.links():[]}return[]}));return JP(i.flat(1).filter(WP).filter(c=>c.rel==="stylesheet"||c.rel==="preload").map(c=>c.rel==="stylesheet"?{...c,rel:"prefetch",as:"style"}:{...c,rel:"prefetch"}))}function T2(n,e,t,i,c,u){let m=(o,w)=>t[w]?o.route.id!==t[w].route.id:!0,_=(o,w)=>t[w].pathname!==o.pathname||t[w].route.path?.endsWith("*")&&t[w].params["*"]!==o.params["*"];return u==="assets"?e.filter((o,w)=>m(o,w)||_(o,w)):u==="data"?e.filter((o,w)=>{let I=i.routes[o.route.id];if(!I||!I.hasLoader)return!1;if(m(o,w)||_(o,w))return!0;if(o.route.shouldRevalidate){let R=o.route.shouldRevalidate({currentUrl:new URL(c.pathname+c.search+c.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(n,window.origin),nextParams:o.params,defaultShouldRevalidate:!0});if(typeof R=="boolean")return R}return!0}):[]}function XP(n,e,{includeHydrateFallback:t}={}){return ZP(n.map(i=>{let c=e.routes[i.route.id];if(!c)return[];let u=[c.module];return c.clientActionModule&&(u=u.concat(c.clientActionModule)),c.clientLoaderModule&&(u=u.concat(c.clientLoaderModule)),t&&c.hydrateFallbackModule&&(u=u.concat(c.hydrateFallbackModule)),c.imports&&(u=u.concat(c.imports)),u}).flat(1))}function ZP(n){return[...new Set(n)]}function YP(n){let e={},t=Object.keys(n).sort();for(let i of t)e[i]=n[i];return e}function JP(n,e){let t=new Set;return new Set(e),n.reduce((i,c)=>{let u=JSON.stringify(YP(c));return t.has(u)||(t.add(u),i.push({key:u,link:c})),i},[])}function KT(){let n=Nn.useContext(R0);return pw(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function QP(){let n=Nn.useContext(Kv);return pw(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var mw=Nn.createContext(void 0);mw.displayName="FrameworkContext";function XT(){let n=Nn.useContext(mw);return pw(n,"You must render this element inside a <HydratedRouter> element"),n}function e7(n,e){let t=Nn.useContext(mw),[i,c]=Nn.useState(!1),[u,m]=Nn.useState(!1),{onFocus:_,onBlur:o,onMouseEnter:w,onMouseLeave:I,onTouchStart:R}=e,V=Nn.useRef(null);Nn.useEffect(()=>{if(n==="render"&&m(!0),n==="viewport"){let ae=J=>{J.forEach(ne=>{m(ne.isIntersecting)})},fe=new IntersectionObserver(ae,{threshold:.5});return V.current&&fe.observe(V.current),()=>{fe.disconnect()}}},[n]),Nn.useEffect(()=>{if(i){let ae=setTimeout(()=>{m(!0)},100);return()=>{clearTimeout(ae)}}},[i]);let k=()=>{c(!0)},ie=()=>{c(!1),m(!1)};return t?n!=="intent"?[u,V,{}]:[u,V,{onFocus:by(_,k),onBlur:by(o,ie),onMouseEnter:by(w,k),onMouseLeave:by(I,ie),onTouchStart:by(R,k)}]:[!1,V,{}]}function by(n,e){return t=>{n&&n(t),t.defaultPrevented||e(t)}}function t7({page:n,...e}){let{router:t}=KT(),i=Nn.useMemo(()=>OT(t.routes,n,t.basename),[t.routes,n,t.basename]);return i?Nn.createElement(r7,{page:n,matches:i,...e}):null}function n7(n){let{manifest:e,routeModules:t}=XT(),[i,c]=Nn.useState([]);return Nn.useEffect(()=>{let u=!1;return KP(n,e,t).then(m=>{u||c(m)}),()=>{u=!0}},[n,e,t]),i}function r7({page:n,matches:e,...t}){let i=hg(),{manifest:c,routeModules:u}=XT(),{basename:m}=KT(),{loaderData:_,matches:o}=QP(),w=Nn.useMemo(()=>T2(n,e,o,c,i,"data"),[n,e,o,c,i]),I=Nn.useMemo(()=>T2(n,e,o,c,i,"assets"),[n,e,o,c,i]),R=Nn.useMemo(()=>{if(n===i.pathname+i.search+i.hash)return[];let ie=new Set,ae=!1;if(e.forEach(J=>{let ne=c.routes[J.route.id];!ne||!ne.hasLoader||(!w.some(me=>me.route.id===J.route.id)&&J.route.id in _&&u[J.route.id]?.shouldRevalidate||ne.hasClientLoader?ae=!0:ie.add(J.route.id))}),ie.size===0)return[];let fe=GP(n,m,"data");return ae&&ie.size>0&&fe.searchParams.set("_routes",e.filter(J=>ie.has(J.route.id)).map(J=>J.route.id).join(",")),[fe.pathname+fe.search]},[m,_,i,c,w,e,n,u]),V=Nn.useMemo(()=>XP(I,c),[I,c]),k=n7(I);return Nn.createElement(Nn.Fragment,null,R.map(ie=>Nn.createElement("link",{key:ie,rel:"prefetch",as:"fetch",href:ie,...t})),V.map(ie=>Nn.createElement("link",{key:ie,rel:"modulepreload",href:ie,...t})),k.map(({key:ie,link:ae})=>Nn.createElement("link",{key:ie,nonce:t.nonce,...ae})))}function i7(...n){return e=>{n.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var ZT=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{ZT&&(window.__reactRouterVersion="7.8.1")}catch{}function o7({basename:n,children:e,window:t}){let i=Nn.useRef();i.current==null&&(i.current=GL({window:t,v5Compat:!0}));let c=i.current,[u,m]=Nn.useState({action:c.action,location:c.location}),_=Nn.useCallback(o=>{Nn.startTransition(()=>m(o))},[m]);return Nn.useLayoutEffect(()=>c.listen(_),[c,_]),Nn.createElement(DP,{basename:n,children:e,location:u.location,navigationType:u.action,navigator:c})}var YT=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,JT=Nn.forwardRef(function({onClick:e,discover:t="render",prefetch:i="none",relative:c,reloadDocument:u,replace:m,state:_,target:o,to:w,preventScrollReset:I,viewTransition:R,...V},k){let{basename:ie}=Nn.useContext(Wf),ae=typeof w=="string"&&YT.test(w),fe,J=!1;if(typeof w=="string"&&ae&&(fe=w,ZT))try{let F=new URL(window.location.href),q=w.startsWith("//")?new URL(F.protocol+w):new URL(w),j=Ep(q.pathname,ie);q.origin===F.origin&&j!=null?w=j+q.search+q.hash:J=!0}catch{$f(!1,`<Link to="${w}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let ne=_P(w,{relative:c}),[me,ue,ke]=e7(i,V),ze=c7(w,{replace:m,state:_,target:o,preventScrollReset:I,relative:c,viewTransition:R});function pe(F){e&&e(F),F.defaultPrevented||ze(F)}let U=Nn.createElement("a",{...V,...ke,href:fe||ne,onClick:J||u?e:pe,ref:i7(k,ue),target:o,"data-discover":!ae&&t==="render"?"true":void 0});return me&&!ae?Nn.createElement(Nn.Fragment,null,U,Nn.createElement(t7,{page:ne})):U});JT.displayName="Link";var s7=Nn.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:i="",end:c=!1,style:u,to:m,viewTransition:_,children:o,...w},I){let R=v_(m,{relative:w.relative}),V=hg(),k=Nn.useContext(Kv),{navigator:ie,basename:ae}=Nn.useContext(Wf),fe=k!=null&&p7(R)&&_===!0,J=ie.encodeLocation?ie.encodeLocation(R).pathname:R.pathname,ne=V.pathname,me=k&&k.navigation&&k.navigation.location?k.navigation.location.pathname:null;t||(ne=ne.toLowerCase(),me=me?me.toLowerCase():null,J=J.toLowerCase()),me&&ae&&(me=Ep(me,ae)||me);const ue=J!=="/"&&J.endsWith("/")?J.length-1:J.length;let ke=ne===J||!c&&ne.startsWith(J)&&ne.charAt(ue)==="/",ze=me!=null&&(me===J||!c&&me.startsWith(J)&&me.charAt(J.length)==="/"),pe={isActive:ke,isPending:ze,isTransitioning:fe},U=ke?e:void 0,F;typeof i=="function"?F=i(pe):F=[i,ke?"active":null,ze?"pending":null,fe?"transitioning":null].filter(Boolean).join(" ");let q=typeof u=="function"?u(pe):u;return Nn.createElement(JT,{...w,"aria-current":U,className:F,ref:I,style:q,to:m,viewTransition:_},typeof o=="function"?o(pe):o)});s7.displayName="NavLink";var a7=Nn.forwardRef(({discover:n="render",fetcherKey:e,navigate:t,reloadDocument:i,replace:c,state:u,method:m=D1,action:_,onSubmit:o,relative:w,preventScrollReset:I,viewTransition:R,...V},k)=>{let ie=d7(),ae=f7(_,{relative:w}),fe=m.toLowerCase()==="get"?"get":"post",J=typeof _=="string"&&YT.test(_),ne=me=>{if(o&&o(me),me.defaultPrevented)return;me.preventDefault();let ue=me.nativeEvent.submitter,ke=ue?.getAttribute("formmethod")||m;ie(ue||me.currentTarget,{fetcherKey:e,method:ke,navigate:t,replace:c,state:u,relative:w,preventScrollReset:I,viewTransition:R})};return Nn.createElement("form",{ref:k,method:fe,action:ae,onSubmit:i?o:ne,...V,"data-discover":!J&&n==="render"?"true":void 0})});a7.displayName="Form";function l7(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function QT(n){let e=Nn.useContext(R0);return Yl(e,l7(n)),e}function c7(n,{target:e,replace:t,state:i,preventScrollReset:c,relative:u,viewTransition:m}={}){let _=vP(),o=hg(),w=v_(n,{relative:u});return Nn.useCallback(I=>{if(UP(I,e)){I.preventDefault();let R=t!==void 0?t:n_(o)===n_(w);_(n,{replace:R,state:i,preventScrollReset:c,relative:u,viewTransition:m})}},[o,_,w,t,i,e,n,c,u,m])}var u7=0,h7=()=>`__${String(++u7)}__`;function d7(){let{router:n}=QT("useSubmit"),{basename:e}=Nn.useContext(Wf),t=kP();return Nn.useCallback(async(i,c={})=>{let{action:u,method:m,encType:_,formData:o,body:w}=$P(i,e);if(c.navigate===!1){let I=c.fetcherKey||h7();await n.fetch(I,t,c.action||u,{preventScrollReset:c.preventScrollReset,formData:o,body:w,formMethod:c.method||m,formEncType:c.encType||_,flushSync:c.flushSync})}else await n.navigate(c.action||u,{preventScrollReset:c.preventScrollReset,formData:o,body:w,formMethod:c.method||m,formEncType:c.encType||_,replace:c.replace,state:c.state,fromRouteId:t,flushSync:c.flushSync,viewTransition:c.viewTransition})},[n,e,t])}function f7(n,{relative:e}={}){let{basename:t}=Nn.useContext(Wf),i=Nn.useContext(Kf);Yl(i,"useFormAction must be used inside a RouteContext");let[c]=i.matches.slice(-1),u={...v_(n||".",{relative:e})},m=hg();if(n==null){u.search=m.search;let _=new URLSearchParams(u.search),o=_.getAll("index");if(o.some(I=>I==="")){_.delete("index"),o.filter(R=>R).forEach(R=>_.append("index",R));let I=_.toString();u.search=I?`?${I}`:""}}return(!n||n===".")&&c.route.index&&(u.search=u.search?u.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(u.pathname=u.pathname==="/"?t:xp([t,u.pathname])),n_(u)}function p7(n,{relative:e}={}){let t=Nn.useContext(qT);Yl(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=QT("useViewTransitionState"),c=v_(n,{relative:e});if(!t.isTransitioning)return!1;let u=Ep(t.currentLocation.pathname,i)||t.currentLocation.pathname,m=Ep(t.nextLocation.pathname,i)||t.nextLocation.pathname;return uv(c.pathname,m)!=null||uv(c.pathname,u)!=null}var O1={exports:{}},m7=O1.exports,I2;function g7(){return I2||(I2=1,(function(n,e){var t={};(function(i,c){n.exports=c()})(m7,(function(){var i,c,u;function m(o,w){if(!i)i=w;else if(!c)c=w;else{var I="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+i+")(sharedChunk); ("+c+")(sharedChunk); self.onerror = null;",R={};i(R),u=w(R),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(u.workerUrl=window.URL.createObjectURL(new Blob([I],{type:"text/javascript"})))}}m(["exports"],(function(o){var w=typeof self<"u"?self:{},I="2.15.0";let R;const V={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(R==null){const s=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{R=t.API_URL_REGEX!=null?new RegExp(t.API_URL_REGEX):s}catch{R=s}}return R},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!V.API_URL)return null;try{const s=new URL(V.API_URL);return s.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":s.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},k={supported:!1,testSupport:function(s){!fe&&ae&&(J?ne(s):ie=s)}};let ie,ae,fe=!1,J=!1;function ne(s){const r=s.createTexture();s.bindTexture(s.TEXTURE_2D,r);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,ae),s.isContextLost())return;k.supported=!0}catch{}s.deleteTexture(r),fe=!0}w.document&&(ae=w.document.createElement("img"),ae.onload=function(){ie&&ne(ie),ie=null,J=!0},ae.onerror=function(){fe=!0,ie=null},ae.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const me="01";function ue(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var ke=ze;function ze(s,r,l,h){this.cx=3*s,this.bx=3*(l-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(h-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=r,this.p2x=l,this.p2y=h}ze.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,r){if(r===void 0&&(r=1e-6),s<0)return 0;if(s>1)return 1;for(var l=s,h=0;h<8;h++){var p=this.sampleCurveX(l)-s;if(Math.abs(p)<r)return l;var x=this.sampleCurveDerivativeX(l);if(Math.abs(x)<1e-6)break;l-=p/x}var b=0,A=1;for(l=s,h=0;h<20&&(p=this.sampleCurveX(l),!(Math.abs(p-s)<r));h++)s>p?b=l:A=l,l=.5*(A-b)+b;return l},solve:function(s,r){return this.sampleCurveY(this.solveCurveX(s,r))}};var pe=ue(ke),U=F;function F(s,r){this.x=s,this.y=r}F.prototype={clone:function(){return new F(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,r){return this.clone()._rotateAround(s,r)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var r=s.x-this.x,l=s.y-this.y;return r*r+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,r){return Math.atan2(this.x*r-this.y*s,this.x*s+this.y*r)},_matMult:function(s){var r=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=r,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var r=Math.cos(s),l=Math.sin(s),h=l*this.x+r*this.y;return this.x=r*this.x-l*this.y,this.y=h,this},_rotateAround:function(s,r){var l=Math.cos(s),h=Math.sin(s),p=r.y+h*(this.x-r.x)+l*(this.y-r.y);return this.x=r.x+l*(this.x-r.x)-h*(this.y-r.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},F.convert=function(s){return s instanceof F?s:Array.isArray(s)?new F(s[0],s[1]):s};var q=ue(U);const j=Math.PI/180,H=180/Math.PI;function Z(s){return s*j}function be(s){return s*H}const Me=[[0,0],[1,0],[1,1],[0,1]];function Be(s){if(s<=0)return 0;if(s>=1)return 1;const r=s*s,l=r*s;return 4*(s<.5?l:3*(s-r)+l-.75)}function Re(s,r,l,h){const p=new pe(s,r,l,h);return function(x){return p.solve(x)}}const we=Re(.25,.1,.25,1);function De(s,r,l){return Math.min(l,Math.max(r,s))}function nt(s,r,l){return(l=De((l-s)/(r-s),0,1))*l*(3-2*l)}function xe(s,r,l){const h=l-r,p=((s-r)%h+h)%h+r;return p===r?l:p}function le(s,r,l){if(!s.length)return l(null,[]);let h=s.length;const p=new Array(s.length);let x=null;s.forEach(((b,A)=>{r(b,((P,M)=>{P&&(x=P),p[A]=M,--h==0&&l(x,p)}))}))}function Ne(s){const r=[];for(const l in s)r.push(s[l]);return r}function Oe(s,...r){for(const l of r)for(const h in l)s[h]=l[h];return s}let Je=1;function rt(){return Je++}function mt(){return(function s(r){return r?(r^Math.random()*(16>>r/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)})()}function dt(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function Dt(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)}function tn(s,r){s.forEach((l=>{r[l]&&(r[l]=r[l].bind(r))}))}function ln(s,r){return s.indexOf(r,s.length-r.length)!==-1}function yn(s,r,l){const h={};for(const p in s)h[p]=r.call(this,s[p],p,s);return h}function Mn(s,r,l){const h={};for(const p in s)r.call(l||this,s[p],p,s)&&(h[p]=s[p]);return h}function Gt(s){return Array.isArray(s)?s.map(Gt):typeof s=="object"&&s?yn(s,Gt):s}const st={};function fr(s){st[s]||(typeof console<"u"&&console.warn(s),st[s]=!0)}function br(s,r,l){return(l.y-s.y)*(r.x-s.x)>(r.y-s.y)*(l.x-s.x)}function Tr(s){let r=0;for(let l,h,p=0,x=s.length,b=x-1;p<x;b=p++)l=s[p],h=s[b],r+=(h.x-l.x)*(l.y+h.y);return r}function Cn(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function ir(s){const r={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((l,h,p,x)=>{const b=p||x;return r[h]=!b||b.toLowerCase(),""})),r["max-age"]){const l=parseInt(r["max-age"],10);isNaN(l)?delete r["max-age"]:r["max-age"]=l}return r}let Jn=null;function Hr(s){if(Jn==null){const r=s.navigator?s.navigator.userAgent:null;Jn=!!s.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return Jn}function Vt(s){try{const r=w[s];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch{return!1}}function Ln(s,r){return[s[4*r],s[4*r+1],s[4*r+2],s[4*r+3]]}const $n="mapbox-tiles";let Dn=500,Mr=50,xr,Sr;function Er(){try{return w.caches}catch{}}function Cr(){Er()&&!xr&&(xr=w.caches.open($n))}function Si(s){const r=s.indexOf("?");if(r<0)return s;const l=(function(p){const x=p.indexOf("?");return x>0?p.slice(x+1).split("&"):[]})(s),h=l.filter((p=>{const x=p.split("=");return x[0]==="language"||x[0]==="worldview"}));return h.length?`${s.slice(0,r)}?${h.join("&")}`:s.slice(0,r)}let Li=1/0;const or={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(or);class ai extends Error{constructor(r,l,h){l===401&&Rt(h)&&(r+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(r),this.status=l,this.url=h}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const qr=Cn()?()=>self.worker&&self.worker.referrer:()=>(w.location.protocol==="blob:"?w.parent:w).location.href,Dr=function(s,r){if(!(/^file:/.test(l=s.url)||/^file:/.test(qr())&&!/^\w+:/.test(l))){if(w.fetch&&w.Request&&w.AbortController&&w.Request.prototype.hasOwnProperty("signal"))return(function(h,p){const x=new w.AbortController,b=new w.Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:qr(),referrerPolicy:h.referrerPolicy,signal:x.signal});let A=!1,P=!1;const M=(G=b.url).indexOf("sku=")>0&&Rt(G);var G;h.type==="json"&&b.headers.set("Accept","application/json");const X=(de,ye,Se)=>{if(P)return;if(de&&de.message!=="SecurityError"&&fr(de.toString()),ye&&Se)return re(ye);const We=Date.now();w.fetch(b).then((at=>{if(at.ok){const xt=M?at.clone():null;return re(at,xt,We)}return p(new ai(at.statusText,at.status,h.url))})).catch((at=>{at.name!=="AbortError"&&p(new Error(`${at.message} ${h.url}`))}))},re=(de,ye,Se)=>{(h.type==="arrayBuffer"?de.arrayBuffer():h.type==="json"?de.json():de.text()).then((We=>{P||(ye&&Se&&(function(at,xt,ct){if(Cr(),!xr)return;const vt={status:xt.status,statusText:xt.statusText,headers:new w.Headers};xt.headers.forEach(((sn,nn)=>vt.headers.set(nn,sn)));const It=ir(xt.headers.get("Cache-Control")||"");if(It["no-store"])return;It["max-age"]&&vt.headers.set("Expires",new Date(ct+1e3*It["max-age"]).toUTCString());const Tt=vt.headers.get("Expires");Tt&&(new Date(Tt).getTime()-ct<42e4||(function(sn,nn){if(Sr===void 0)try{new Response(new ReadableStream),Sr=!0}catch{Sr=!1}Sr?nn(sn.body):sn.blob().then(nn)})(xt,(sn=>{const nn=new w.Response(sn,vt);Cr(),xr&&xr.then((Sn=>Sn.put(Si(at.url),nn))).catch((Sn=>fr(Sn.message)))})))})(b,ye,Se),A=!0,p(null,We,de.headers.get("Cache-Control"),de.headers.get("Expires")))})).catch((We=>{P||p(new Error(We.message))}))};return M?(function(de,ye){if(Cr(),!xr)return ye(null);const Se=Si(de.url);xr.then((We=>{We.match(Se).then((at=>{const xt=(function(ct){if(!ct)return!1;const vt=new Date(ct.headers.get("Expires")||0),It=ir(ct.headers.get("Cache-Control")||"");return vt>Date.now()&&!It["no-cache"]})(at);We.delete(Se),xt&&We.put(Se,at.clone()),ye(null,at,xt)})).catch(ye)})).catch(ye)})(b,X):X(null,null),{cancel:()=>{P=!0,A||x.abort()}}})(s,r);if(Cn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,r,void 0,!0)}var l;return(function(h,p){const x=new w.XMLHttpRequest;x.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(x.responseType="arraybuffer");for(const b in h.headers)x.setRequestHeader(b,h.headers[b]);return h.type==="json"&&(x.responseType="text",x.setRequestHeader("Accept","application/json")),x.withCredentials=h.credentials==="include",x.onerror=()=>{p(new Error(x.statusText))},x.onload=()=>{if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let b=x.response;if(h.type==="json")try{b=JSON.parse(x.response)}catch(A){return p(A)}p(null,b,x.getResponseHeader("Cache-Control"),x.getResponseHeader("Expires"))}else p(new ai(x.statusText,x.status,h.url))},x.send(h.body),{cancel:()=>x.abort()}})(s,r)},hi=function(s,r){return Dr(Oe(s,{type:"arrayBuffer"}),r)};function li(s){const r=w.document.createElement("a");return r.href=s,r.protocol===w.document.location.protocol&&r.host===w.document.location.host}const lt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ee,Te;Ee=[],Te=0;const et=function(s,r){if(k.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),Te>=V.MAX_PARALLEL_IMAGE_REQUESTS){const x={requestParameters:s,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return Ee.push(x),x}Te++;let l=!1;const h=()=>{if(!l)for(l=!0,Te--;Ee.length&&Te<V.MAX_PARALLEL_IMAGE_REQUESTS;){const x=Ee.shift(),{requestParameters:b,callback:A,cancelled:P}=x;P||(x.cancel=et(b,A).cancel)}},p=hi(s,((x,b,A,P)=>{h(),x?r(x):b&&(w.createImageBitmap?(function(M,G){const X=new w.Blob([new Uint8Array(M)],{type:"image/png"});w.createImageBitmap(X).then((re=>{G(null,re)})).catch((re=>{G(new Error(`Could not load image because of ${re.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))})(b,((M,G)=>r(M,G,A,P))):(function(M,G){const X=new w.Image,re=w.URL;X.onload=()=>{G(null,X),re.revokeObjectURL(X.src),X.onload=null,w.requestAnimationFrame((()=>{X.src=lt}))},X.onerror=()=>G(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const de=new w.Blob([new Uint8Array(M)],{type:"image/png"});X.src=M.byteLength?re.createObjectURL(de):lt})(b,((M,G)=>r(M,G,A,P))))}));return{cancel:()=>{p.cancel(),h()}}},ht="NO_ACCESS_TOKEN";function Ct(s){return s.indexOf("mapbox:")===0}function Rt(s){return V.API_URL_REGEX.test(s)}function Ot(s){return V.API_CDN_URL_REGEX.test(s)}function At(s){return V.API_STYLE_REGEX.test(s)&&!Lt(s)}function Lt(s){return V.API_SPRITE_REGEX.test(s)}const xn=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function On(s){const r=s.match(xn);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function An(s){const r=s.params.length?`?${s.params.join("&")}`:"";return`${s.protocol}://${s.authority}${s.path}${r}`}const Lr="mapbox.eventData";function Ir(s){if(!s)return null;const r=s.split(".");if(!r||r.length!==3)return null;try{return JSON.parse(decodeURIComponent(w.atob(r[1]).split("").map((l=>"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2))).join("")))}catch{return null}}class zr{constructor(r){this.type=r,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const l=Ir(V.ACCESS_TOKEN);let h="";return h=l&&l.u?w.btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,((p,x)=>String.fromCharCode(+("0x"+x))))):V.ACCESS_TOKEN||"",r?`${Lr}.${r}:${h}`:`${Lr}:${h}`}fetchEventData(){const r=Vt("localStorage"),l=this.getStorageKey(),h=this.getStorageKey("uuid");if(r)try{const p=w.localStorage.getItem(l);p&&(this.eventData=JSON.parse(p));const x=w.localStorage.getItem(h);x&&(this.anonId=x)}catch{fr("Unable to read from LocalStorage")}}saveEventData(){const r=Vt("localStorage"),l=this.getStorageKey(),h=this.getStorageKey("uuid");if(r)try{w.localStorage.setItem(h,this.anonId),Object.keys(this.eventData).length>=1&&w.localStorage.setItem(l,JSON.stringify(this.eventData))}catch{fr("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,l,h,p){if(!V.EVENTS_URL)return;const x=On(V.EVENTS_URL);x.params.push(`access_token=${p||V.ACCESS_TOKEN||""}`);const b={event:this.type,created:new Date(r).toISOString()},A=l?Oe(b,l):b,P={url:An(x),headers:{"Content-Type":"text/plain"},body:JSON.stringify([A])};this.pendingRequest=(function(M,G){return Dr(Oe(M,{method:"POST"}),G)})(P,(M=>{this.pendingRequest=null,h(M),this.saveEventData(),this.processRequests(p)}))}queueRequest(r,l){this.queue.push(r),this.processRequests(l)}}const wr=new class extends zr{constructor(s){super("appUserTurnstile"),this._customAccessToken=s}postTurnstileEvent(s,r){V.EVENTS_URL&&V.ACCESS_TOKEN&&Array.isArray(s)&&s.some((l=>Ct(l)||Rt(l)))&&this.queueRequest(Date.now(),r)}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=Ir(V.ACCESS_TOKEN),l=r?r.u:V.ACCESS_TOKEN;let h=l!==this.eventData.tokenU;Dt(this.anonId)||(this.anonId=mt(),h=!0);const p=this.queue.shift();if(this.eventData.lastSuccess){const x=new Date(this.eventData.lastSuccess),b=new Date(p),A=(p-this.eventData.lastSuccess)/864e5;h=h||A>=1||A<-1||x.getDate()!==b.getDate()}else h=!0;h?this.postEvent(p,{sdkIdentifier:"mapbox-gl-js",sdkVersion:I,skuId:me,"enabled.telemetry":!1,userId:this.anonId},(x=>{x||(this.eventData.lastSuccess=p,this.eventData.tokenU=l)}),s):this.processRequests()}},Ei=wr.postTurnstileEvent.bind(wr),to=new class extends zr{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(s,r,l,h){this.skuToken=r,this.errorCb=h,V.EVENTS_URL&&(l||V.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},l):this.errorCb(new Error(ht)))}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:l}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),Dt(this.anonId)||(this.anonId=mt()),this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:I,skuId:me,skuToken:this.skuToken,userId:this.anonId},(h=>{h?this.errorCb(h):r&&(this.success[r]=!0)}),s))}},po=to.postMapLoadEvent.bind(to),Wo=new class extends zr{constructor(){super("gljs.performance")}postPerformanceEvent(s,r){V.EVENTS_URL&&(s||V.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:r},s)}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:r,performanceData:l}=this.queue.shift(),h=(function(p){const x=w.performance.getEntriesByType("resource"),b=w.performance.getEntriesByType("mark"),A=(function(re){const de={};if(re){for(const ye in re)if(ye!=="other")for(const Se of re[ye]){const We=`${ye}ResolveRangeMin`,at=`${ye}ResolveRangeMax`,xt=`${ye}RequestCount`,ct=`${ye}RequestCachedCount`;de[We]=Math.min(de[We]||1/0,Se.startTime),de[at]=Math.max(de[at]||-1/0,Se.responseEnd);const vt=It=>{de[It]===void 0&&(de[It]=0),++de[It]};Se.transferSize!==void 0&&Se.transferSize===0&&vt(ct),vt(xt)}}return de})((function(re,de){const ye={};if(re)for(const Se of re){const We=de(Se);ye[We]===void 0&&(ye[We]=[]),ye[We].push(Se)}return ye})(x,al)),P=w.devicePixelRatio,M=w.navigator.connection||w.navigator.mozConnection||w.navigator.webkitConnection,G={counters:[],metadata:[],attributes:[]},X=(re,de,ye)=>{ye!=null&&re.push({name:de,value:ye.toString()})};for(const re in A)X(G.counters,re,A[re]);if(p.interactionRange[0]!==1/0&&p.interactionRange[1]!==-1/0&&(X(G.counters,"interactionRangeMin",p.interactionRange[0]),X(G.counters,"interactionRangeMax",p.interactionRange[1])),b)for(const re of Object.keys(fa)){const de=fa[re],ye=b.find((Se=>Se.name===de));ye&&X(G.counters,de,ye.startTime)}return X(G.counters,"visibilityHidden",p.visibilityHidden),X(G.attributes,"style",(function(re){if(re)for(const de of re){const ye=de.name.split("?")[0];if(At(ye)){const Se=ye.split("/").slice(-2);if(Se.length===2)return`mapbox://styles/${Se[0]}/${Se[1]}`}}})(x)),X(G.attributes,"terrainEnabled",p.terrainEnabled?"true":"false"),X(G.attributes,"fogEnabled",p.fogEnabled?"true":"false"),X(G.attributes,"projection",p.projection),X(G.attributes,"zoom",p.zoom),X(G.metadata,"devicePixelRatio",P),X(G.metadata,"connectionEffectiveType",M?M.effectiveType:void 0),X(G.metadata,"navigatorUserAgent",w.navigator.userAgent),X(G.metadata,"screenWidth",w.screen.width),X(G.metadata,"screenHeight",w.screen.height),X(G.metadata,"windowWidth",w.innerWidth),X(G.metadata,"windowHeight",w.innerHeight),X(G.metadata,"mapWidth",p.width/P),X(G.metadata,"mapHeight",p.height/P),X(G.metadata,"webglRenderer",p.renderer),X(G.metadata,"webglVendor",p.vendor),X(G.metadata,"sdkVersion",I),X(G.metadata,"sdkIdentifier","mapbox-gl-js"),G})(l);for(const p of h.metadata);for(const p of h.counters);for(const p of h.attributes);this.postEvent(r,h,(()=>{}),s)}},no=Wo.postPerformanceEvent.bind(Wo),_s=new class extends zr{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(s,r,l,h){if(!V.API_URL||!V.SESSION_PATH)return;const p=On(V.API_URL+V.SESSION_PATH);p.params.push(`sku=${r||""}`),p.params.push(`access_token=${h||V.ACCESS_TOKEN||""}`);const x={url:An(p),headers:{"Content-Type":"text/plain"}};this.pendingRequest=(function(b,A){return Dr(Oe(b,{method:"GET"}),A)})(x,(b=>{this.pendingRequest=null,l(b),this.saveEventData(),this.processRequests(h)}))}getSessionAPI(s,r,l,h){this.skuToken=r,this.errorCb=h,V.SESSION_PATH&&V.API_URL&&(l||V.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},l):this.errorCb(new Error(ht)))}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:l}=this.queue.shift();r&&this.success[r]||this.getSession(l,this.skuToken,(h=>{h?this.errorCb(h):r&&(this.success[r]=!0)}),s)}},ro=_s.getSessionAPI.bind(_s),Ps=new Set,fa={create:"create",load:"load",fullLoad:"fullLoad"},Sl={mark(s){w.performance.mark(s)},measure(s,r,l){w.performance.measure(s,r,l)}};function al(s){const r=s.name.split("?")[0];return Ot(r)&&r.includes("mapbox-gl.js")?"javascript":Ot(r)&&r.includes("mapbox-gl.css")?"css":(function(l){return V.API_FONTS_REGEX.test(l)})(r)?"fontRange":Lt(r)?"sprite":At(r)?"style":(function(l){return V.API_TILEJSON_REGEX.test(l)})(r)?"tilejson":"other"}const Vi=w.performance;function Ql(s){const r=s?s.url.toString():void 0;return Vi.getEntriesByName(r)}let Pu,So,mu,Ea;const Zo={now:()=>mu!==void 0?mu:w.performance.now(),setNow(s){mu=s},restoreNow(){mu=void 0},frame(s){const r=w.requestAnimationFrame(s);return{cancel:()=>w.cancelAnimationFrame(r)}},getImageData(s,r=0){const{width:l,height:h}=s;Ea||(Ea=w.document.createElement("canvas"));const p=Ea.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(l>Ea.width||h>Ea.height)&&(Ea.width=l,Ea.height=h),p.clearRect(-r,-r,l+2*r,h+2*r),p.drawImage(s,0,0,l,h),p.getImageData(-r,-r,l+2*r,h+2*r)},resolveURL:s=>(Pu||(Pu=w.document.createElement("a")),Pu.href=s,Pu.href),get devicePixelRatio(){return w.devicePixelRatio},get prefersReducedMotion(){return!!w.matchMedia&&(So==null&&(So=w.matchMedia("(prefers-reduced-motion: reduce)")),So.matches)}};function Xa(s,r,l){l[s]&&l[s].indexOf(r)!==-1||(l[s]=l[s]||[],l[s].push(r))}function kl(s,r,l){if(l&&l[s]){const h=l[s].indexOf(r);h!==-1&&l[s].splice(h,1)}}class ec{constructor(r,l={}){Oe(this,l),this.type=r}}class Aa extends ec{constructor(r,l={}){super("error",Oe({error:r},l))}}class ra{on(r,l){return this._listeners=this._listeners||{},Xa(r,l,this._listeners),this}off(r,l){return kl(r,l,this._listeners),kl(r,l,this._oneTimeListeners),this}once(r,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},Xa(r,l,this._oneTimeListeners),this):new Promise((h=>this.once(r,h)))}fire(r,l){typeof r=="string"&&(r=new ec(r,l||{}));const h=r.type;if(this.listens(h)){r.target=this;const p=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const A of p)A.call(this,r);const x=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const A of x)kl(h,A,this._oneTimeListeners),A.call(this,r);const b=this._eventedParent;b&&(Oe(r,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),b.fire(r))}else r instanceof Aa&&console.error(r.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,l){return this._eventedParent=r,this._eventedParentData=l,this}}var pn=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Yo(s,...r){for(const l of r)for(const h in l)s[h]=l[h];return s}function ss(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function vi(s){if(Array.isArray(s))return s.map(vi);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const r={};for(const l in s)r[l]=vi(s[l]);return r}return ss(s)}class gu extends Error{constructor(r,l){super(l),this.message=l,this.key=r}}var Za=gu;class Ya{constructor(r,l=[]){this.parent=r,this.bindings={};for(const[h,p]of l)this.bindings[h]=p}concat(r){return new Ya(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}var ll=Ya;const ks={kind:"null"},er={kind:"number"},Fr={kind:"string"},Rr={kind:"boolean"},zs={kind:"color"},Ta={kind:"object"},xi={kind:"value"},Mi={kind:"collator"},El={kind:"formatted"},ji={kind:"resolvedImage"};function fs(s,r){return{kind:"array",itemType:s,N:r}}function Fi(s){if(s.kind==="array"){const r=Fi(s.itemType);return typeof s.N=="number"?`array<${r}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${r}>`}return s.kind}const yu=[ks,er,Fr,Rr,zs,El,Ta,fs(xi),ji];function tc(s,r){if(r.kind==="error")return null;if(s.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!tc(s.itemType,r.itemType))&&(typeof s.N!="number"||s.N===r.N))return null}else{if(s.kind===r.kind)return null;if(s.kind==="value"){for(const l of yu)if(!tc(l,r))return null}}return`Expected ${Fi(s)} but found ${Fi(r)} instead.`}function eu(s,r){return r.some((l=>l.kind===s.kind))}function bc(s,r){return r.some((l=>l==="null"?s===null:l==="array"?Array.isArray(s):l==="object"?s&&!Array.isArray(s)&&typeof s=="object":l===typeof s))}var nc,Da={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Ms(s){return(s=Math.round(s))<0?0:s>255?255:s}function Oi(s){return Ms(s[s.length-1]==="%"?parseFloat(s)/100*255:parseInt(s))}function Fa(s){return(r=s[s.length-1]==="%"?parseFloat(s)/100:parseFloat(s))<0?0:r>1?1:r;var r}function ci(s,r,l){return l<0?l+=1:l>1&&(l-=1),6*l<1?s+(r-s)*l*6:2*l<1?r:3*l<2?s+(r-s)*(2/3-l)*6:s}try{nc={}.parseCSSColor=function(s){var r,l=s.replace(/ /g,"").toLowerCase();if(l in Da)return Da[l].slice();if(l[0]==="#")return l.length===4?(r=parseInt(l.substr(1),16))>=0&&r<=4095?[(3840&r)>>4|(3840&r)>>8,240&r|(240&r)>>4,15&r|(15&r)<<4,1]:null:l.length===7&&(r=parseInt(l.substr(1),16))>=0&&r<=16777215?[(16711680&r)>>16,(65280&r)>>8,255&r,1]:null;var h=l.indexOf("("),p=l.indexOf(")");if(h!==-1&&p+1===l.length){var x=l.substr(0,h),b=l.substr(h+1,p-(h+1)).split(","),A=1;switch(x){case"rgba":if(b.length!==4)return null;A=Fa(b.pop());case"rgb":return b.length!==3?null:[Oi(b[0]),Oi(b[1]),Oi(b[2]),A];case"hsla":if(b.length!==4)return null;A=Fa(b.pop());case"hsl":if(b.length!==3)return null;var P=(parseFloat(b[0])%360+360)%360/360,M=Fa(b[1]),G=Fa(b[2]),X=G<=.5?G*(M+1):G+M-G*M,re=2*G-X;return[Ms(255*ci(re,X,P+1/3)),Ms(255*ci(re,X,P)),Ms(255*ci(re,X,P-1/3)),A];default:return null}}return null}}catch{}class Jo{constructor(r,l,h,p=1){this.r=r,this.g=l,this.b=h,this.a=p}static parse(r){if(!r)return;if(r instanceof Jo)return r;if(typeof r!="string")return;const l=nc(r);return l?new Jo(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){const[r,l,h,p]=this.toArray();return`rgba(${Math.round(r)},${Math.round(l)},${Math.round(h)},${p})`}toArray(){const{r,g:l,b:h,a:p}=this;return p===0?[0,0,0,0]:[255*r/p,255*l/p,255*h/p,p]}toArray01(){const{r,g:l,b:h,a:p}=this;return p===0?[0,0,0,0]:[r/p,l/p,h/p,p]}toArray01PremultipliedAlpha(){const{r,g:l,b:h,a:p}=this;return[r,l,h,p]}}Jo.black=new Jo(0,0,0,1),Jo.white=new Jo(1,1,1,1),Jo.transparent=new Jo(0,0,0,0),Jo.red=new Jo(1,0,0,1),Jo.blue=new Jo(0,0,1,1);var Eo=Jo;class xh{constructor(r,l,h){this.sensitivity=r?l?"variant":"case":l?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,l){return this.collator.compare(r,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ku{constructor(r,l,h,p,x){this.text=r.normalize?r.normalize():r,this.image=l,this.scale=h,this.fontStack=p,this.textColor=x}}class mo{constructor(r){this.sections=r}static fromString(r){return new mo([new ku(r,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((r=>r.text.length!==0||r.image&&r.image.name.length!==0))}static factory(r){return r instanceof mo?r:mo.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map((r=>r.text)).join("")}serialize(){const r=["format"];for(const l of this.sections){if(l.image){r.push(["image",l.image.name]);continue}r.push(l.text);const h={};l.fontStack&&(h["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(h["font-scale"]=l.scale),l.textColor&&(h["text-color"]=["rgba"].concat(l.textColor.toArray())),r.push(h)}return r}}class js{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new js({name:r,available:!1}):null}serialize(){return["image",this.name]}}function Mu(s,r,l,h){return typeof s=="number"&&s>=0&&s<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof l=="number"&&l>=0&&l<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[s,r,l,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[s,r,l,h]:[s,r,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ko(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof Eo||s instanceof xh||s instanceof mo||s instanceof js)return!0;if(Array.isArray(s)){for(const r of s)if(!Ko(r))return!1;return!0}if(typeof s=="object"){for(const r in s)if(!Ko(s[r]))return!1;return!0}return!1}function go(s){if(s===null)return ks;if(typeof s=="string")return Fr;if(typeof s=="boolean")return Rr;if(typeof s=="number")return er;if(s instanceof Eo)return zs;if(s instanceof xh)return Mi;if(s instanceof mo)return El;if(s instanceof js)return ji;if(Array.isArray(s)){const r=s.length;let l;for(const h of s){const p=go(h);if(l){if(l===p)continue;l=xi;break}l=p}return fs(l||xi,r)}return Ta}function Ml(s){const r=typeof s;return s===null?"":r==="string"||r==="number"||r==="boolean"?String(s):s instanceof Eo||s instanceof mo||s instanceof js?s.toString():JSON.stringify(s)}class Oa{constructor(r,l){this.type=r,this.value=l}static parse(r,l){if(r.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!Ko(r[1]))return l.error("invalid value");const h=r[1];let p=go(h);const x=l.expectedType;return p.kind!=="array"||p.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(p=x),new Oa(p,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Eo?["rgba"].concat(this.value.toArray()):this.value instanceof mo?this.value.serialize():this.value}}var Us=Oa,Uo=class{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}};const zc={string:Fr,number:er,boolean:Rr,object:Ta};class Xo{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");let h,p=1;const x=r[0];if(x==="array"){let A,P;if(r.length>2){const M=r[1];if(typeof M!="string"||!(M in zc)||M==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);A=zc[M],p++}else A=xi;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return l.error('The length argument to "array" must be a positive integer literal',2);P=r[2],p++}h=fs(A,P)}else h=zc[x];const b=[];for(;p<r.length;p++){const A=l.parse(r[p],p,xi);if(!A)return null;b.push(A)}return new Xo(h,b)}evaluate(r){for(let l=0;l<this.args.length;l++){const h=this.args[l].evaluate(r);if(!tc(this.type,go(h)))return h;if(l===this.args.length-1)throw new Uo(`Expected value to be of type ${Fi(this.type)}, but found ${Fi(go(h))} instead.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every((r=>r.outputDefined()))}serialize(){const r=this.type,l=[r.kind];if(r.kind==="array"){const h=r.itemType;if(h.kind==="string"||h.kind==="number"||h.kind==="boolean"){l.push(h.kind);const p=r.N;(typeof p=="number"||this.args.length>1)&&l.push(p)}}return l.concat(this.args.map((h=>h.serialize())))}}var pa=Xo;class Ja{constructor(r){this.type=El,this.sections=r}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");const h=r[1];if(!Array.isArray(h)&&typeof h=="object")return l.error("First argument must be an image or text section.");const p=[];let x=!1;for(let b=1;b<=r.length-1;++b){const A=r[b];if(x&&typeof A=="object"&&!Array.isArray(A)){x=!1;let P=null;if(A["font-scale"]&&(P=l.parse(A["font-scale"],1,er),!P))return null;let M=null;if(A["text-font"]&&(M=l.parse(A["text-font"],1,fs(Fr)),!M))return null;let G=null;if(A["text-color"]&&(G=l.parse(A["text-color"],1,zs),!G))return null;const X=p[p.length-1];X.scale=P,X.font=M,X.textColor=G}else{const P=l.parse(r[b],1,xi);if(!P)return null;const M=P.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,p.push({content:P,scale:null,font:null,textColor:null})}}return new Ja(p)}evaluate(r){return new mo(this.sections.map((l=>{const h=l.content.evaluate(r);return go(h)===ji?new ku("",h,null,null,null):new ku(Ml(h),null,l.scale?l.scale.evaluate(r):null,l.font?l.font.evaluate(r).join(","):null,l.textColor?l.textColor.evaluate(r):null)})))}eachChild(r){for(const l of this.sections)r(l.content),l.scale&&r(l.scale),l.font&&r(l.font),l.textColor&&r(l.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const l of this.sections){r.push(l.content.serialize());const h={};l.scale&&(h["font-scale"]=l.scale.serialize()),l.font&&(h["text-font"]=l.font.serialize()),l.textColor&&(h["text-color"]=l.textColor.serialize()),r.push(h)}return r}}class cl{constructor(r){this.type=ji,this.input=r}static parse(r,l){if(r.length!==2)return l.error("Expected two arguments.");const h=l.parse(r[1],1,Fr);return h?new cl(h):l.error("No image name provided.")}evaluate(r){const l=this.input.evaluate(r),h=js.fromString(l);return h&&r.availableImages&&(h.available=r.availableImages.indexOf(l)>-1),h}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const tu={"to-boolean":Rr,"to-color":zs,"to-number":er,"to-string":Fr};class wc{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");const h=r[0];if((h==="to-boolean"||h==="to-string")&&r.length!==2)return l.error("Expected one argument.");const p=tu[h],x=[];for(let b=1;b<r.length;b++){const A=l.parse(r[b],b,xi);if(!A)return null;x.push(A)}return new wc(p,x)}evaluate(r){if(this.type.kind==="boolean")return!!this.args[0].evaluate(r);if(this.type.kind==="color"){let l,h;for(const p of this.args){if(l=p.evaluate(r),h=null,l instanceof Eo)return l;if(typeof l=="string"){const x=r.parseColor(l);if(x)return x}else if(Array.isArray(l)&&(h=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:Mu(l[0],l[1],l[2],l[3]),!h))return new Eo(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new Uo(h||`Could not parse color from value '${typeof l=="string"?l:String(JSON.stringify(l))}'`)}if(this.type.kind==="number"){let l=null;for(const h of this.args){if(l=h.evaluate(r),l===null)return 0;const p=Number(l);if(!isNaN(p))return p}throw new Uo(`Could not convert ${JSON.stringify(l)} to number.`)}return this.type.kind==="formatted"?mo.fromString(Ml(this.args[0].evaluate(r))):this.type.kind==="resolvedImage"?js.fromString(Ml(this.args[0].evaluate(r))):Ml(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every((r=>r.outputDefined()))}serialize(){if(this.type.kind==="formatted")return new Ja([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new cl(this.args[0]).serialize();const r=[`to-${this.type.kind}`];return this.eachChild((l=>{r.push(l.serialize())})),r}}var Vs=wc;const Ai=["Unknown","Point","LineString","Polygon"];var Ss=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ai[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const s=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:l,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*r-s[0])+this.featureDistanceData.bearing[1]*(h*r-s[1])}return 0}parseColor(s){let r=this._parseColorCache[s];return r||(r=this._parseColorCache[s]=Eo.parse(s)),r}};class qs{constructor(r,l,h,p){this.name=r,this.type=l,this._evaluate=h,this.args=p}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((r=>r.serialize())))}static parse(r,l){const h=r[0],p=qs.definitions[h];if(!p)return l.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const x=Array.isArray(p)?p[0]:p.type,b=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,A=b.filter((([M])=>!Array.isArray(M)||M.length===r.length-1));let P=null;for(const[M,G]of A){P=new jc(l.registry,l.path,null,l.scope);const X=[];let re=!1;for(let de=1;de<r.length;de++){const ye=r[de],Se=Array.isArray(M)?M[de-1]:M.type,We=P.parse(ye,1+X.length,Se);if(!We){re=!0;break}X.push(We)}if(!re)if(Array.isArray(M)&&M.length!==X.length)P.error(`Expected ${M.length} arguments, but found ${X.length} instead.`);else{for(let de=0;de<X.length;de++){const ye=Array.isArray(M)?M[de]:M.type,Se=X[de];P.concat(de+1).checkSubtype(ye,Se.type)}if(P.errors.length===0)return new qs(h,x,G,X)}}if(A.length===1)l.errors.push(...P.errors);else{const M=(A.length?A:b).map((([X])=>{return re=X,Array.isArray(re)?`(${re.map(Fi).join(", ")})`:`(${Fi(re.type)}...)`;var re})).join(" | "),G=[];for(let X=1;X<r.length;X++){const re=l.parse(r[X],1+G.length);if(!re)return null;G.push(Fi(re.type))}l.error(`Expected arguments of type ${M}, but found (${G.join(", ")}) instead.`)}return null}static register(r,l){qs.definitions=l;for(const h in l)r[h]=qs}}var ia=qs;class oa{constructor(r,l,h){this.type=Mi,this.locale=h,this.caseSensitive=r,this.diacriticSensitive=l}static parse(r,l){if(r.length!==2)return l.error("Expected one argument.");const h=r[1];if(typeof h!="object"||Array.isArray(h))return l.error("Collator options argument must be an object.");const p=l.parse(h["case-sensitive"]!==void 0&&h["case-sensitive"],1,Rr);if(!p)return null;const x=l.parse(h["diacritic-sensitive"]!==void 0&&h["diacritic-sensitive"],1,Rr);if(!x)return null;let b=null;return h.locale&&(b=l.parse(h.locale,1,Fr),!b)?null:new oa(p,x,b)}evaluate(r){return new xh(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}const ul=8192;function $s(s,r){s[0]=Math.min(s[0],r[0]),s[1]=Math.min(s[1],r[1]),s[2]=Math.max(s[2],r[0]),s[3]=Math.max(s[3],r[1])}function Gs(s,r){return!(s[0]<=r[0]||s[2]>=r[2]||s[1]<=r[1]||s[3]>=r[3])}function Sc(s,r){const l=(180+s[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,p=Math.pow(2,r.z);return[Math.round(l*p*ul),Math.round(h*p*ul)]}function W(s,r,l){const h=s[0]-r[0],p=s[1]-r[1],x=s[0]-l[0],b=s[1]-l[1];return h*b-x*p==0&&h*x<=0&&p*b<=0}function Ce(s,r){let l=!1;for(let b=0,A=r.length;b<A;b++){const P=r[b];for(let M=0,G=P.length;M<G-1;M++){if(W(s,P[M],P[M+1]))return!1;(p=P[M])[1]>(h=s)[1]!=(x=P[M+1])[1]>h[1]&&h[0]<(x[0]-p[0])*(h[1]-p[1])/(x[1]-p[1])+p[0]&&(l=!l)}}var h,p,x;return l}function pt(s,r){for(let l=0;l<r.length;l++)if(Ce(s,r[l]))return!0;return!1}function yt(s,r,l,h){const p=h[0]-l[0],x=h[1]-l[1],b=(s[0]-l[0])*x-p*(s[1]-l[1]),A=(r[0]-l[0])*x-p*(r[1]-l[1]);return b>0&&A<0||b<0&&A>0}function qt(s,r,l){for(const M of l)for(let G=0;G<M.length-1;++G)if((A=[(b=M[G+1])[0]-(x=M[G])[0],b[1]-x[1]])[0]*(P=[(p=r)[0]-(h=s)[0],p[1]-h[1]])[1]-A[1]*P[0]!=0&&yt(h,p,x,b)&&yt(x,b,h,p))return!0;var h,p,x,b,A,P;return!1}function Qt(s,r){for(let l=0;l<s.length;++l)if(!Ce(s[l],r))return!1;for(let l=0;l<s.length-1;++l)if(qt(s[l],s[l+1],r))return!1;return!0}function Fn(s,r){for(let l=0;l<r.length;l++)if(Qt(s,r[l]))return!0;return!1}function Nr(s,r,l){const h=[];for(let p=0;p<s.length;p++){const x=[];for(let b=0;b<s[p].length;b++){const A=Sc(s[p][b],l);$s(r,A),x.push(A)}h.push(x)}return h}function $r(s,r,l){const h=[];for(let p=0;p<s.length;p++){const x=Nr(s[p],r,l);h.push(x)}return h}function yi(s,r,l,h){if(s[0]<l[0]||s[0]>l[2]){const p=.5*h;let x=s[0]-l[0]>p?-h:l[0]-s[0]>p?h:0;x===0&&(x=s[0]-l[2]>p?-h:l[2]-s[0]>p?h:0),s[0]+=x}$s(r,s)}function Ti(s,r,l,h){const p=Math.pow(2,h.z)*ul,x=[h.x*ul,h.y*ul],b=[];if(!s)return b;for(const A of s)for(const P of A){const M=[P.x+x[0],P.y+x[1]];yi(M,r,l,p),b.push(M)}return b}function yo(s,r,l,h){const p=Math.pow(2,h.z)*ul,x=[h.x*ul,h.y*ul],b=[];if(!s)return b;for(const P of s){const M=[];for(const G of P){const X=[G.x+x[0],G.y+x[1]];$s(r,X),M.push(X)}b.push(M)}if(r[2]-r[0]<=p/2){(A=r)[0]=A[1]=1/0,A[2]=A[3]=-1/0;for(const P of b)for(const M of P)yi(M,r,l,p)}var A;return b}class _o{constructor(r,l){this.type=Rr,this.geojson=r,this.geometries=l}static parse(r,l){if(r.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(Ko(r[1])){const h=r[1];if(h.type==="FeatureCollection")for(let p=0;p<h.features.length;++p){const x=h.features[p].geometry.type;if(x==="Polygon"||x==="MultiPolygon")return new _o(h,h.features[p].geometry)}else if(h.type==="Feature"){const p=h.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new _o(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new _o(h,h)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return(function(l,h){const p=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],b=l.canonicalID();if(!b)return!1;if(h.type==="Polygon"){const A=Nr(h.coordinates,x,b),P=Ti(l.geometry(),p,x,b);if(!Gs(p,x))return!1;for(const M of P)if(!Ce(M,A))return!1}if(h.type==="MultiPolygon"){const A=$r(h.coordinates,x,b),P=Ti(l.geometry(),p,x,b);if(!Gs(p,x))return!1;for(const M of P)if(!pt(M,A))return!1}return!0})(r,this.geometries);if(r.geometryType()==="LineString")return(function(l,h){const p=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],b=l.canonicalID();if(!b)return!1;if(h.type==="Polygon"){const A=Nr(h.coordinates,x,b),P=yo(l.geometry(),p,x,b);if(!Gs(p,x))return!1;for(const M of P)if(!Qt(M,A))return!1}if(h.type==="MultiPolygon"){const A=$r(h.coordinates,x,b),P=yo(l.geometry(),p,x,b);if(!Gs(p,x))return!1;for(const M of P)if(!Fn(M,A))return!1}return!0})(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Qo=_o;function Mo(s){if(s instanceof ia&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof Qo)return!1;let r=!0;return s.eachChild((l=>{r&&!Mo(l)&&(r=!1)})),r}function Vo(s){if(s instanceof ia&&s.name==="feature-state")return!1;let r=!0;return s.eachChild((l=>{r&&!Vo(l)&&(r=!1)})),r}function es(s,r){if(s instanceof ia&&r.indexOf(s.name)>=0)return!1;let l=!0;return s.eachChild((h=>{l&&!es(h,r)&&(l=!1)})),l}class cs{constructor(r,l){this.type=l.type,this.name=r,this.boundExpression=l}static parse(r,l){if(r.length!==2||typeof r[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");const h=r[1];return l.scope.has(h)?new cs(h,l.scope.get(h)):l.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var qo=cs;class Es{constructor(r,l=[],h,p=new ll,x=[]){this.registry=r,this.path=l,this.key=l.map((b=>`[${b}]`)).join(""),this.scope=p,this.errors=x,this.expectedType=h}parse(r,l,h,p,x={}){return l?this.concat(l,h,p)._parse(r,x):this._parse(r,x)}_parse(r,l){function h(p,x,b){return b==="assert"?new pa(x,[p]):b==="coerce"?new Vs(x,[p]):p}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=r[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const x=this.registry[p];if(x){let b=x.parse(r,this);if(!b)return null;if(this.expectedType){const A=this.expectedType,P=b.type;if(A.kind!=="string"&&A.kind!=="number"&&A.kind!=="boolean"&&A.kind!=="object"&&A.kind!=="array"||P.kind!=="value")if(A.kind!=="color"&&A.kind!=="formatted"&&A.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string"){if(this.checkSubtype(A,P))return null}else b=h(b,A,l.typeAnnotation||"coerce");else b=h(b,A,l.typeAnnotation||"assert")}if(!(b instanceof Us)&&b.type.kind!=="resolvedImage"&&Qa(b)){const A=new Ss;try{b=new Us(b.type,b.evaluate(A))}catch(P){return this.error(P.message),null}}return b}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,l,h){const p=typeof r=="number"?this.path.concat(r):this.path,x=h?this.scope.concat(h):this.scope;return new Es(this.registry,p,l||null,x,this.errors)}error(r,...l){const h=`${this.key}${l.map((p=>`[${p}]`)).join("")}`;this.errors.push(new Za(h,r))}checkSubtype(r,l){const h=tc(r,l);return h&&this.error(h),h}}var jc=Es;function Qa(s){if(s instanceof qo)return Qa(s.boundExpression);if(s instanceof ia&&s.name==="error"||s instanceof oa||s instanceof Qo)return!1;const r=s instanceof Vs||s instanceof pa;let l=!0;return s.eachChild((h=>{l=r?l&&Qa(h):l&&h instanceof Us})),!!l&&Mo(s)&&es(s,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function L(s,r){const l=s.length-1;let h,p,x=0,b=l,A=0;for(;x<=b;)if(A=Math.floor((x+b)/2),h=s[A],p=s[A+1],h<=r){if(A===l||r<p)return A;x=A+1}else{if(!(h>r))throw new Uo("Input is not a number.");b=A-1}return 0}class se{constructor(r,l,h){this.type=r,this.input=l,this.labels=[],this.outputs=[];for(const[p,x]of h)this.labels.push(p),this.outputs.push(x)}static parse(r,l){if(r.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return l.error("Expected an even number of arguments.");const h=l.parse(r[1],1,er);if(!h)return null;const p=[];let x=null;l.expectedType&&l.expectedType.kind!=="value"&&(x=l.expectedType);for(let b=1;b<r.length;b+=2){const A=b===1?-1/0:r[b],P=r[b+1],M=b,G=b+1;if(typeof A!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(p.length&&p[p.length-1][0]>=A)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const X=l.parse(P,G,x);if(!X)return null;x=x||X.type,p.push([A,X])}return new se(x,h,p)}evaluate(r){const l=this.labels,h=this.outputs;if(l.length===1)return h[0].evaluate(r);const p=this.input.evaluate(r);if(p<=l[0])return h[0].evaluate(r);const x=l.length;return p>=l[x-1]?h[x-1].evaluate(r):h[L(l,p)].evaluate(r)}eachChild(r){r(this.input);for(const l of this.outputs)r(l)}outputDefined(){return this.outputs.every((r=>r.outputDefined()))}serialize(){const r=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&r.push(this.labels[l]),r.push(this.outputs[l].serialize());return r}}var ve=se;function He(s,r,l){return s*(1-l)+r*l}var Xt=Object.freeze({__proto__:null,array:function(s,r,l){return s.map(((h,p)=>He(h,r[p],l)))},color:function(s,r,l){return new Eo(He(s.r,r.r,l),He(s.g,r.g,l),He(s.b,r.b,l),He(s.a,r.a,l))},number:He});const fn=.95047,ar=1.08883,ao=4/29,Fo=6/29,qi=3*Fo*Fo,Di=Fo*Fo*Fo,Ro=Math.PI/180,sa=180/Math.PI;function Oo(s){return s>Di?Math.pow(s,1/3):s/qi+ao}function Ji(s){return s>Fo?s*s*s:qi*(s-ao)}function Rl(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function Ia(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function Ru(s){const r=Ia(s.r),l=Ia(s.g),h=Ia(s.b),p=Oo((.4124564*r+.3575761*l+.1804375*h)/fn),x=Oo((.2126729*r+.7151522*l+.072175*h)/1);return{l:116*x-16,a:500*(p-x),b:200*(x-Oo((.0193339*r+.119192*l+.9503041*h)/ar)),alpha:s.a}}function hl(s){let r=(s.l+16)/116,l=isNaN(s.a)?r:r+s.a/500,h=isNaN(s.b)?r:r-s.b/200;return r=1*Ji(r),l=fn*Ji(l),h=ar*Ji(h),new Eo(Rl(3.2404542*l-1.5371385*r-.4985314*h),Rl(-.969266*l+1.8760108*r+.041556*h),Rl(.0556434*l-.2040259*r+1.0572252*h),s.alpha)}function Nl(s,r,l){const h=r-s;return s+l*(h>180||h<-180?h-360*Math.round(h/360):h)}const dl={forward:Ru,reverse:hl,interpolate:function(s,r,l){return{l:He(s.l,r.l,l),a:He(s.a,r.a,l),b:He(s.b,r.b,l),alpha:He(s.alpha,r.alpha,l)}}},No={forward:function(s){const{l:r,a:l,b:h}=Ru(s),p=Math.atan2(h,l)*sa;return{h:p<0?p+360:p,c:Math.sqrt(l*l+h*h),l:r,alpha:s.a}},reverse:function(s){const r=s.h*Ro,l=s.c;return hl({l:s.l,a:Math.cos(r)*l,b:Math.sin(r)*l,alpha:s.alpha})},interpolate:function(s,r,l){return{h:Nl(s.h,r.h,l),c:He(s.c,r.c,l),l:He(s.l,r.l,l),alpha:He(s.alpha,r.alpha,l)}}};var aa=Object.freeze({__proto__:null,hcl:No,lab:dl});class Dl{constructor(r,l,h,p,x){this.type=r,this.operator=l,this.interpolation=h,this.input=p,this.labels=[],this.outputs=[];for(const[b,A]of x)this.labels.push(b),this.outputs.push(A)}static interpolationFactor(r,l,h,p){let x=0;if(r.name==="exponential")x=Ec(l,r.base,h,p);else if(r.name==="linear")x=Ec(l,1,h,p);else if(r.name==="cubic-bezier"){const b=r.controlPoints;x=new pe(b[0],b[1],b[2],b[3]).solve(Ec(l,1,h,p))}return x}static parse(r,l){let[h,p,x,...b]=r;if(!Array.isArray(p)||p.length===0)return l.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const M=p[1];if(typeof M!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:M}}else{if(p[0]!=="cubic-bezier")return l.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const M=p.slice(1);if(M.length!==4||M.some((G=>typeof G!="number"||G<0||G>1)))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:M}}}if(r.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(x=l.parse(x,2,er),!x)return null;const A=[];let P=null;h==="interpolate-hcl"||h==="interpolate-lab"?P=zs:l.expectedType&&l.expectedType.kind!=="value"&&(P=l.expectedType);for(let M=0;M<b.length;M+=2){const G=b[M],X=b[M+1],re=M+3,de=M+4;if(typeof G!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',re);if(A.length&&A[A.length-1][0]>=G)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',re);const ye=l.parse(X,de,P);if(!ye)return null;P=P||ye.type,A.push([G,ye])}return P.kind==="number"||P.kind==="color"||P.kind==="array"&&P.itemType.kind==="number"&&typeof P.N=="number"?new Dl(P,h,p,x,A):l.error(`Type ${Fi(P)} is not interpolatable.`)}evaluate(r){const l=this.labels,h=this.outputs;if(l.length===1)return h[0].evaluate(r);const p=this.input.evaluate(r);if(p<=l[0])return h[0].evaluate(r);const x=l.length;if(p>=l[x-1])return h[x-1].evaluate(r);const b=L(l,p),A=Dl.interpolationFactor(this.interpolation,p,l[b],l[b+1]),P=h[b].evaluate(r),M=h[b+1].evaluate(r);return this.operator==="interpolate"?Xt[this.type.kind.toLowerCase()](P,M,A):this.operator==="interpolate-hcl"?No.reverse(No.interpolate(No.forward(P),No.forward(M),A)):dl.reverse(dl.interpolate(dl.forward(P),dl.forward(M),A))}eachChild(r){r(this.input);for(const l of this.outputs)r(l)}outputDefined(){return this.outputs.every((r=>r.outputDefined()))}serialize(){let r;r=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const l=[this.operator,r,this.input.serialize()];for(let h=0;h<this.labels.length;h++)l.push(this.labels[h],this.outputs[h].serialize());return l}}function Ec(s,r,l,h){const p=h-l,x=s-l;return p===0?0:r===1?x/p:(Math.pow(r,x)-1)/(Math.pow(r,p)-1)}var ma=Dl;class Lo{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expectected at least one argument.");let h=null;const p=l.expectedType;p&&p.kind!=="value"&&(h=p);const x=[];for(const A of r.slice(1)){const P=l.parse(A,1+x.length,h,void 0,{typeAnnotation:"omit"});if(!P)return null;h=h||P.type,x.push(P)}const b=p&&x.some((A=>tc(p,A.type)));return new Lo(b?xi:h,x)}evaluate(r){let l,h=null,p=0;for(const x of this.args){if(p++,h=x.evaluate(r),h&&h instanceof js&&!h.available&&(l||(l=h),h=null,p===this.args.length))return l;if(h!==null)break}return h}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every((r=>r.outputDefined()))}serialize(){const r=["coalesce"];return this.eachChild((l=>{r.push(l.serialize())})),r}}var $o=Lo;class Ca{constructor(r,l){this.type=l.type,this.bindings=[].concat(r),this.result=l}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const l of this.bindings)r(l[1]);r(this.result)}static parse(r,l){if(r.length<4)return l.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const h=[];for(let x=1;x<r.length-1;x+=2){const b=r[x];if(typeof b!="string")return l.error(`Expected string, but found ${typeof b} instead.`,x);if(/[^a-zA-Z0-9_]/.test(b))return l.error("Variable names must contain only alphanumeric characters or '_'.",x);const A=l.parse(r[x+1],x+1);if(!A)return null;h.push([b,A])}const p=l.parse(r[r.length-1],r.length-1,l.expectedType,h);return p?new Ca(h,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[l,h]of this.bindings)r.push(l,h.serialize());return r.push(this.result.serialize()),r}}var rc=Ca;class fl{constructor(r,l,h){this.type=r,this.index=l,this.input=h}static parse(r,l){if(r.length!==3)return l.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const h=l.parse(r[1],1,er),p=l.parse(r[2],2,fs(l.expectedType||xi));return h&&p?new fl(p.type.itemType,h,p):null}evaluate(r){const l=this.index.evaluate(r),h=this.input.evaluate(r);if(l<0)throw new Uo(`Array index out of bounds: ${l} < 0.`);if(l>=h.length)throw new Uo(`Array index out of bounds: ${l} > ${h.length-1}.`);if(l!==Math.floor(l))throw new Uo(`Array index must be an integer, but found ${l} instead.`);return h[l]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Nu=fl;class el{constructor(r,l){this.type=Rr,this.needle=r,this.haystack=l}static parse(r,l){if(r.length!==3)return l.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const h=l.parse(r[1],1,xi),p=l.parse(r[2],2,xi);return h&&p?eu(h.type,[Rr,Fr,er,ks,xi])?new el(h,p):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Fi(h.type)} instead`):null}evaluate(r){const l=this.needle.evaluate(r),h=this.haystack.evaluate(r);if(h==null)return!1;if(!bc(l,["boolean","string","number","null"]))throw new Uo(`Expected first argument to be of type boolean, string, number or null, but found ${Fi(go(l))} instead.`);if(!bc(h,["string","array"]))throw new Uo(`Expected second argument to be of type array or string, but found ${Fi(go(h))} instead.`);return h.indexOf(l)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Ac=el;class Al{constructor(r,l,h){this.type=er,this.needle=r,this.haystack=l,this.fromIndex=h}static parse(r,l){if(r.length<=2||r.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const h=l.parse(r[1],1,xi),p=l.parse(r[2],2,xi);if(!h||!p)return null;if(!eu(h.type,[Rr,Fr,er,ks,xi]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Fi(h.type)} instead`);if(r.length===4){const x=l.parse(r[3],3,er);return x?new Al(h,p,x):null}return new Al(h,p)}evaluate(r){const l=this.needle.evaluate(r),h=this.haystack.evaluate(r);if(!bc(l,["boolean","string","number","null"]))throw new Uo(`Expected first argument to be of type boolean, string, number or null, but found ${Fi(go(l))} instead.`);if(!bc(h,["string","array"]))throw new Uo(`Expected second argument to be of type array or string, but found ${Fi(go(h))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(r);return h.indexOf(l,p)}return h.indexOf(l)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var pl=Al;class ic{constructor(r,l,h,p,x,b){this.inputType=r,this.type=l,this.input=h,this.cases=p,this.outputs=x,this.otherwise=b}static parse(r,l){if(r.length<5)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return l.error("Expected an even number of arguments.");let h,p;l.expectedType&&l.expectedType.kind!=="value"&&(p=l.expectedType);const x={},b=[];for(let M=2;M<r.length-1;M+=2){let G=r[M];const X=r[M+1];Array.isArray(G)||(G=[G]);const re=l.concat(M);if(G.length===0)return re.error("Expected at least one branch label.");for(const ye of G){if(typeof ye!="number"&&typeof ye!="string")return re.error("Branch labels must be numbers or strings.");if(typeof ye=="number"&&Math.abs(ye)>Number.MAX_SAFE_INTEGER)return re.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ye=="number"&&Math.floor(ye)!==ye)return re.error("Numeric branch labels must be integer values.");if(h){if(re.checkSubtype(h,go(ye)))return null}else h=go(ye);if(x[String(ye)]!==void 0)return re.error("Branch labels must be unique.");x[String(ye)]=b.length}const de=l.parse(X,M,p);if(!de)return null;p=p||de.type,b.push(de)}const A=l.parse(r[1],1,xi);if(!A)return null;const P=l.parse(r[r.length-1],r.length-1,p);return P?A.type.kind!=="value"&&l.concat(1).checkSubtype(h,A.type)?null:new ic(h,p,A,x,b,P):null}evaluate(r){const l=this.input.evaluate(r);return(go(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every((r=>r.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),h=[],p={};for(const b of l){const A=p[this.cases[b]];A===void 0?(p[this.cases[b]]=h.length,h.push([this.cases[b],[b]])):h[A][1].push(b)}const x=b=>this.inputType.kind==="number"?Number(b):b;for(const[b,A]of h)r.push(A.length===1?x(A[0]):A.map(x)),r.push(this.outputs[b].serialize());return r.push(this.otherwise.serialize()),r}}var Fl=ic;class _u{constructor(r,l,h){this.type=r,this.branches=l,this.otherwise=h}static parse(r,l){if(r.length<4)return l.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return l.error("Expected an odd number of arguments.");let h;l.expectedType&&l.expectedType.kind!=="value"&&(h=l.expectedType);const p=[];for(let b=1;b<r.length-1;b+=2){const A=l.parse(r[b],b,Rr);if(!A)return null;const P=l.parse(r[b+1],b+1,h);if(!P)return null;p.push([A,P]),h=h||P.type}const x=l.parse(r[r.length-1],r.length-1,h);return x?new _u(h,p,x):null}evaluate(r){for(const[l,h]of this.branches)if(l.evaluate(r))return h.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[l,h]of this.branches)r(l),r(h);r(this.otherwise)}outputDefined(){return this.branches.every((([r,l])=>l.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild((l=>{r.push(l.serialize())})),r}}var vs=_u;class vu{constructor(r,l,h,p){this.type=r,this.input=l,this.beginIndex=h,this.endIndex=p}static parse(r,l){if(r.length<=2||r.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const h=l.parse(r[1],1,xi),p=l.parse(r[2],2,er);if(!h||!p)return null;if(!eu(h.type,[fs(xi),Fr,xi]))return l.error(`Expected first argument to be of type array or string, but found ${Fi(h.type)} instead`);if(r.length===4){const x=l.parse(r[3],3,er);return x?new vu(h.type,h,p,x):null}return new vu(h.type,h,p)}evaluate(r){const l=this.input.evaluate(r),h=this.beginIndex.evaluate(r);if(!bc(l,["string","array"]))throw new Uo(`Expected first argument to be of type array or string, but found ${Fi(go(l))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(r);return l.slice(h,p)}return l.slice(h)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var la=vu;function ga(s,r){return s==="=="||s==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function Go(s,r,l,h){return h.compare(r,l)===0}function Po(s,r,l){const h=s!=="=="&&s!=="!=";return class e6{constructor(x,b,A){this.type=Rr,this.lhs=x,this.rhs=b,this.collator=A,this.hasUntypedArgument=x.type.kind==="value"||b.type.kind==="value"}static parse(x,b){if(x.length!==3&&x.length!==4)return b.error("Expected two or three arguments.");const A=x[0];let P=b.parse(x[1],1,xi);if(!P)return null;if(!ga(A,P.type))return b.concat(1).error(`"${A}" comparisons are not supported for type '${Fi(P.type)}'.`);let M=b.parse(x[2],2,xi);if(!M)return null;if(!ga(A,M.type))return b.concat(2).error(`"${A}" comparisons are not supported for type '${Fi(M.type)}'.`);if(P.type.kind!==M.type.kind&&P.type.kind!=="value"&&M.type.kind!=="value")return b.error(`Cannot compare types '${Fi(P.type)}' and '${Fi(M.type)}'.`);h&&(P.type.kind==="value"&&M.type.kind!=="value"?P=new pa(M.type,[P]):P.type.kind!=="value"&&M.type.kind==="value"&&(M=new pa(P.type,[M])));let G=null;if(x.length===4){if(P.type.kind!=="string"&&M.type.kind!=="string"&&P.type.kind!=="value"&&M.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(G=b.parse(x[3],3,Mi),!G)return null}return new e6(P,M,G)}evaluate(x){const b=this.lhs.evaluate(x),A=this.rhs.evaluate(x);if(h&&this.hasUntypedArgument){const P=go(b),M=go(A);if(P.kind!==M.kind||P.kind!=="string"&&P.kind!=="number")throw new Uo(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${P.kind}, ${M.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const P=go(b),M=go(A);if(P.kind!=="string"||M.kind!=="string")return r(x,b,A)}return this.collator?l(x,b,A,this.collator.evaluate(x)):r(x,b,A)}eachChild(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)}outputDefined(){return!0}serialize(){const x=[s];return this.eachChild((b=>{x.push(b.serialize())})),x}}}const Hs=Po("==",(function(s,r,l){return r===l}),Go),ya=Po("!=",(function(s,r,l){return r!==l}),(function(s,r,l,h){return!Go(0,r,l,h)})),Ol=Po("<",(function(s,r,l){return r<l}),(function(s,r,l,h){return h.compare(r,l)<0})),Dh=Po(">",(function(s,r,l){return r>l}),(function(s,r,l,h){return h.compare(r,l)>0})),Ju=Po("<=",(function(s,r,l){return r<=l}),(function(s,r,l,h){return h.compare(r,l)<=0})),xu=Po(">=",(function(s,r,l){return r>=l}),(function(s,r,l,h){return h.compare(r,l)>=0}));class Du{constructor(r,l,h,p,x,b){this.type=Fr,this.number=r,this.locale=l,this.currency=h,this.unit=p,this.minFractionDigits=x,this.maxFractionDigits=b}static parse(r,l){if(r.length!==3)return l.error("Expected two arguments.");const h=l.parse(r[1],1,er);if(!h)return null;const p=r[2];if(typeof p!="object"||Array.isArray(p))return l.error("NumberFormat options argument must be an object.");let x=null;if(p.locale&&(x=l.parse(p.locale,1,Fr),!x))return null;let b=null;if(p.currency&&(b=l.parse(p.currency,1,Fr),!b))return null;let A=null;if(p.unit&&(A=l.parse(p.unit,1,Fr),!A))return null;let P=null;if(p["min-fraction-digits"]&&(P=l.parse(p["min-fraction-digits"],1,er),!P))return null;let M=null;return p["max-fraction-digits"]&&(M=l.parse(p["max-fraction-digits"],1,er),!M)?null:new Du(h,x,b,A,P,M)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(r):void 0,unit:this.unit?this.unit.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.unit&&r(this.unit),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.unit&&(r.unit=this.unit.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class Uc{constructor(r){this.type=er,this.input=r}static parse(r,l){if(r.length!==2)return l.error(`Expected 1 argument, but found ${r.length-1} instead.`);const h=l.parse(r[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${Fi(h.type)} instead.`):new Uc(h):null}evaluate(r){const l=this.input.evaluate(r);if(typeof l=="string"||Array.isArray(l))return l.length;throw new Uo(`Expected value to be of type string or array, but found ${Fi(go(l))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild((l=>{r.push(l.serialize())})),r}}const bh={"==":Hs,"!=":ya,">":Dh,"<":Ol,">=":xu,"<=":Ju,array:pa,at:Nu,boolean:pa,case:vs,coalesce:$o,collator:oa,format:Ja,image:cl,in:Ac,"index-of":pl,interpolate:ma,"interpolate-hcl":ma,"interpolate-lab":ma,length:Uc,let:rc,literal:Us,match:Fl,number:pa,"number-format":Du,object:pa,slice:la,step:ve,string:pa,"to-boolean":Vs,"to-color":Vs,"to-number":Vs,"to-string":Vs,var:qo,within:Qo};function Fh(s,[r,l,h,p]){r=r.evaluate(s),l=l.evaluate(s),h=h.evaluate(s);const x=p?p.evaluate(s):1,b=Mu(r,l,h,x);if(b)throw new Uo(b);return new Eo(r/255*x,l/255*x,h/255*x,x)}function tl(s,r){return s in r}function Tc(s,r){const l=r[s];return l===void 0?null:l}function As(s){return{type:s}}ia.register(bh,{error:[{kind:"error"},[Fr],(s,[r])=>{throw new Uo(r.evaluate(s))}],typeof:[Fr,[xi],(s,[r])=>Fi(go(r.evaluate(s)))],"to-rgba":[fs(er,4),[zs],(s,[r])=>r.evaluate(s).toArray()],rgb:[zs,[er,er,er],Fh],rgba:[zs,[er,er,er,er],Fh],has:{type:Rr,overloads:[[[Fr],(s,[r])=>tl(r.evaluate(s),s.properties())],[[Fr,Ta],(s,[r,l])=>tl(r.evaluate(s),l.evaluate(s))]]},get:{type:xi,overloads:[[[Fr],(s,[r])=>Tc(r.evaluate(s),s.properties())],[[Fr,Ta],(s,[r,l])=>Tc(r.evaluate(s),l.evaluate(s))]]},"feature-state":[xi,[Fr],(s,[r])=>Tc(r.evaluate(s),s.featureState||{})],properties:[Ta,[],s=>s.properties()],"geometry-type":[Fr,[],s=>s.geometryType()],id:[xi,[],s=>s.id()],zoom:[er,[],s=>s.globals.zoom],pitch:[er,[],s=>s.globals.pitch||0],"distance-from-center":[er,[],s=>s.distanceFromCenter()],"heatmap-density":[er,[],s=>s.globals.heatmapDensity||0],"line-progress":[er,[],s=>s.globals.lineProgress||0],"sky-radial-progress":[er,[],s=>s.globals.skyRadialProgress||0],accumulated:[xi,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[er,As(er),(s,r)=>{let l=0;for(const h of r)l+=h.evaluate(s);return l}],"*":[er,As(er),(s,r)=>{let l=1;for(const h of r)l*=h.evaluate(s);return l}],"-":{type:er,overloads:[[[er,er],(s,[r,l])=>r.evaluate(s)-l.evaluate(s)],[[er],(s,[r])=>-r.evaluate(s)]]},"/":[er,[er,er],(s,[r,l])=>r.evaluate(s)/l.evaluate(s)],"%":[er,[er,er],(s,[r,l])=>r.evaluate(s)%l.evaluate(s)],ln2:[er,[],()=>Math.LN2],pi:[er,[],()=>Math.PI],e:[er,[],()=>Math.E],"^":[er,[er,er],(s,[r,l])=>Math.pow(r.evaluate(s),l.evaluate(s))],sqrt:[er,[er],(s,[r])=>Math.sqrt(r.evaluate(s))],log10:[er,[er],(s,[r])=>Math.log(r.evaluate(s))/Math.LN10],ln:[er,[er],(s,[r])=>Math.log(r.evaluate(s))],log2:[er,[er],(s,[r])=>Math.log(r.evaluate(s))/Math.LN2],sin:[er,[er],(s,[r])=>Math.sin(r.evaluate(s))],cos:[er,[er],(s,[r])=>Math.cos(r.evaluate(s))],tan:[er,[er],(s,[r])=>Math.tan(r.evaluate(s))],asin:[er,[er],(s,[r])=>Math.asin(r.evaluate(s))],acos:[er,[er],(s,[r])=>Math.acos(r.evaluate(s))],atan:[er,[er],(s,[r])=>Math.atan(r.evaluate(s))],min:[er,As(er),(s,r)=>Math.min(...r.map((l=>l.evaluate(s))))],max:[er,As(er),(s,r)=>Math.max(...r.map((l=>l.evaluate(s))))],abs:[er,[er],(s,[r])=>Math.abs(r.evaluate(s))],round:[er,[er],(s,[r])=>{const l=r.evaluate(s);return l<0?-Math.round(-l):Math.round(l)}],floor:[er,[er],(s,[r])=>Math.floor(r.evaluate(s))],ceil:[er,[er],(s,[r])=>Math.ceil(r.evaluate(s))],"filter-==":[Rr,[Fr,xi],(s,[r,l])=>s.properties()[r.value]===l.value],"filter-id-==":[Rr,[xi],(s,[r])=>s.id()===r.value],"filter-type-==":[Rr,[Fr],(s,[r])=>s.geometryType()===r.value],"filter-<":[Rr,[Fr,xi],(s,[r,l])=>{const h=s.properties()[r.value],p=l.value;return typeof h==typeof p&&h<p}],"filter-id-<":[Rr,[xi],(s,[r])=>{const l=s.id(),h=r.value;return typeof l==typeof h&&l<h}],"filter->":[Rr,[Fr,xi],(s,[r,l])=>{const h=s.properties()[r.value],p=l.value;return typeof h==typeof p&&h>p}],"filter-id->":[Rr,[xi],(s,[r])=>{const l=s.id(),h=r.value;return typeof l==typeof h&&l>h}],"filter-<=":[Rr,[Fr,xi],(s,[r,l])=>{const h=s.properties()[r.value],p=l.value;return typeof h==typeof p&&h<=p}],"filter-id-<=":[Rr,[xi],(s,[r])=>{const l=s.id(),h=r.value;return typeof l==typeof h&&l<=h}],"filter->=":[Rr,[Fr,xi],(s,[r,l])=>{const h=s.properties()[r.value],p=l.value;return typeof h==typeof p&&h>=p}],"filter-id->=":[Rr,[xi],(s,[r])=>{const l=s.id(),h=r.value;return typeof l==typeof h&&l>=h}],"filter-has":[Rr,[xi],(s,[r])=>r.value in s.properties()],"filter-has-id":[Rr,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[Rr,[fs(Fr)],(s,[r])=>r.value.indexOf(s.geometryType())>=0],"filter-id-in":[Rr,[fs(xi)],(s,[r])=>r.value.indexOf(s.id())>=0],"filter-in-small":[Rr,[Fr,fs(xi)],(s,[r,l])=>l.value.indexOf(s.properties()[r.value])>=0],"filter-in-large":[Rr,[Fr,fs(xi)],(s,[r,l])=>(function(h,p,x,b){for(;x<=b;){const A=x+b>>1;if(p[A]===h)return!0;p[A]>h?b=A-1:x=A+1}return!1})(s.properties()[r.value],l.value,0,l.value.length-1)],all:{type:Rr,overloads:[[[Rr,Rr],(s,[r,l])=>r.evaluate(s)&&l.evaluate(s)],[As(Rr),(s,r)=>{for(const l of r)if(!l.evaluate(s))return!1;return!0}]]},any:{type:Rr,overloads:[[[Rr,Rr],(s,[r,l])=>r.evaluate(s)||l.evaluate(s)],[As(Rr),(s,r)=>{for(const l of r)if(l.evaluate(s))return!0;return!1}]]},"!":[Rr,[Rr],(s,[r])=>!r.evaluate(s)],"is-supported-script":[Rr,[Fr],(s,[r])=>{const l=s.globals&&s.globals.isSupportedScript;return!l||l(r.evaluate(s))}],upcase:[Fr,[Fr],(s,[r])=>r.evaluate(s).toUpperCase()],downcase:[Fr,[Fr],(s,[r])=>r.evaluate(s).toLowerCase()],concat:[Fr,As(xi),(s,r)=>r.map((l=>Ml(l.evaluate(s)))).join("")],"resolved-locale":[Fr,[Mi],(s,[r])=>r.evaluate(s).resolvedLocale()]});var Bl=bh;function Ws(s){return{result:"success",value:s}}function nu(s){return{result:"error",value:s}}function jr(s){return s["property-type"]==="data-driven"}function Qu(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function eh(s){return!!s.expression&&s.expression.interpolated}function Bi(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function Tl(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function ru(s){return s}function oc(s,r){const l=r.type==="color",h=s.stops&&typeof s.stops[0][0]=="object",p=h||!(h||s.property!==void 0),x=s.type||(eh(r)?"exponential":"interval");if(l&&((s=Yo({},s)).stops&&(s.stops=s.stops.map((M=>[M[0],Eo.parse(M[1])]))),s.default=Eo.parse(s.default?s.default:r.default)),s.colorSpace&&s.colorSpace!=="rgb"&&!aa[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let b,A,P;if(x==="exponential")b=La;else if(x==="interval")b=iu;else if(x==="categorical"){b=Ba,A=Object.create(null);for(const M of s.stops)A[M[0]]=M[1];P=typeof s.stops[0][0]}else{if(x!=="identity")throw new Error(`Unknown function type "${x}"`);b=Ar}if(h){const M={},G=[];for(let de=0;de<s.stops.length;de++){const ye=s.stops[de],Se=ye[0].zoom;M[Se]===void 0&&(M[Se]={zoom:Se,type:s.type,property:s.property,default:s.default,stops:[]},G.push(Se)),M[Se].stops.push([ye[0].value,ye[1]])}const X=[];for(const de of G)X.push([M[de].zoom,oc(M[de],r)]);const re={name:"linear"};return{kind:"composite",interpolationType:re,interpolationFactor:ma.interpolationFactor.bind(void 0,re),zoomStops:X.map((de=>de[0])),evaluate:({zoom:de},ye)=>La({stops:X,base:s.base},r,de).evaluate(de,ye)}}if(p){const M=x==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:ma.interpolationFactor.bind(void 0,M),zoomStops:s.stops.map((G=>G[0])),evaluate:({zoom:G})=>b(s,r,G,A,P)}}return{kind:"source",evaluate(M,G){const X=G&&G.properties?G.properties[s.property]:void 0;return X===void 0?xs(s.default,r.default):b(s,r,X,A,P)}}}function xs(s,r,l){return s!==void 0?s:r!==void 0?r:l!==void 0?l:void 0}function Ba(s,r,l,h,p){return xs(typeof l===p?h[l]:void 0,s.default,r.default)}function iu(s,r,l){if(Bi(l)!=="number")return xs(s.default,r.default);const h=s.stops.length;if(h===1||l<=s.stops[0][0])return s.stops[0][1];if(l>=s.stops[h-1][0])return s.stops[h-1][1];const p=L(s.stops.map((x=>x[0])),l);return s.stops[p][1]}function La(s,r,l){const h=s.base!==void 0?s.base:1;if(Bi(l)!=="number")return xs(s.default,r.default);const p=s.stops.length;if(p===1||l<=s.stops[0][0])return s.stops[0][1];if(l>=s.stops[p-1][0])return s.stops[p-1][1];const x=L(s.stops.map((G=>G[0])),l),b=(function(G,X,re,de){const ye=de-re,Se=G-re;return ye===0?0:X===1?Se/ye:(Math.pow(X,Se)-1)/(Math.pow(X,ye)-1)})(l,h,s.stops[x][0],s.stops[x+1][0]),A=s.stops[x][1],P=s.stops[x+1][1];let M=Xt[r.type]||ru;if(s.colorSpace&&s.colorSpace!=="rgb"){const G=aa[s.colorSpace];M=(X,re)=>G.reverse(G.interpolate(G.forward(X),G.forward(re),b))}return typeof A.evaluate=="function"?{evaluate(...G){const X=A.evaluate.apply(void 0,G),re=P.evaluate.apply(void 0,G);if(X!==void 0&&re!==void 0)return M(X,re,b)}}:M(A,P,b)}function Ar(s,r,l){return r.type==="color"?l=Eo.parse(l):r.type==="formatted"?l=mo.fromString(l.toString()):r.type==="resolvedImage"?l=js.fromString(l.toString()):Bi(l)===r.type||r.type==="enum"&&r.values[l]||(l=void 0),xs(l,s.default,r.default)}class ml{constructor(r,l){this.expression=r,this._warningHistory={},this._evaluator=new Ss,this._defaultValue=l?(function(h){return h.type==="color"&&(Tl(h.default)||Array.isArray(h.default))?new Eo(0,0,0,0):h.type==="color"?Eo.parse(h.default)||null:h.default===void 0?null:h.default})(l):null,this._enumValues=l&&l.type==="enum"?l.values:null}evaluateWithoutErrorHandling(r,l,h,p,x,b,A,P){return this._evaluator.globals=r,this._evaluator.feature=l,this._evaluator.featureState=h,this._evaluator.canonical=p||null,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=b,this._evaluator.featureTileCoord=A||null,this._evaluator.featureDistanceData=P||null,this.expression.evaluate(this._evaluator)}evaluate(r,l,h,p,x,b,A,P){this._evaluator.globals=r,this._evaluator.feature=l||null,this._evaluator.featureState=h||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=b||null,this._evaluator.featureTileCoord=A||null,this._evaluator.featureDistanceData=P||null;try{const M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new Uo(`Expected value to be one of ${Object.keys(this._enumValues).map((G=>JSON.stringify(G))).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(M.message)),this._defaultValue}}}function _a(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in Bl}function Bo(s,r){const l=new jc(Bl,[],r?(function(p){const x={color:zs,string:Fr,number:er,enum:Fr,boolean:Rr,formatted:El,resolvedImage:ji};return p.type==="array"?fs(x[p.value]||xi,p.length):x[p.type]})(r):void 0),h=l.parse(s,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Ws(new ml(h,r)):nu(l.errors)}class Fu{constructor(r,l){this.kind=r,this._styleExpression=l,this.isStateDependent=r!=="constant"&&!Vo(l.expression)}evaluateWithoutErrorHandling(r,l,h,p,x,b){return this._styleExpression.evaluateWithoutErrorHandling(r,l,h,p,x,b)}evaluate(r,l,h,p,x,b){return this._styleExpression.evaluate(r,l,h,p,x,b)}}class Ic{constructor(r,l,h,p){this.kind=r,this.zoomStops=h,this._styleExpression=l,this.isStateDependent=r!=="camera"&&!Vo(l.expression),this.interpolationType=p}evaluateWithoutErrorHandling(r,l,h,p,x,b){return this._styleExpression.evaluateWithoutErrorHandling(r,l,h,p,x,b)}evaluate(r,l,h,p,x,b){return this._styleExpression.evaluate(r,l,h,p,x,b)}interpolationFactor(r,l,h){return this.interpolationType?ma.interpolationFactor(this.interpolationType,r,l,h):0}}function sc(s,r){if((s=Bo(s,r)).result==="error")return s;const l=s.value.expression,h=Mo(l);if(!h&&!jr(r))return nu([new Za("","data expressions not supported")]);const p=es(l,["zoom","pitch","distance-from-center"]);if(!p&&!Qu(r))return nu([new Za("","zoom expressions not supported")]);const x=za(l);return x||p?x instanceof Za?nu([x]):x instanceof ma&&!eh(r)?nu([new Za("",'"interpolate" expressions cannot be used with this property')]):Ws(x?new Ic(h?"camera":"composite",s.value,x.labels,x instanceof ma?x.interpolation:void 0):new Fu(h?"constant":"source",s.value)):nu([new Za("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ii{constructor(r,l){this._parameters=r,this._specification=l,Yo(this,oc(this._parameters,this._specification))}static deserialize(r){return new Ii(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function za(s){let r=null;if(s instanceof rc)r=za(s.result);else if(s instanceof $o){for(const l of s.args)if(r=za(l),r)break}else(s instanceof ve||s instanceof ma)&&s.input instanceof ia&&s.input.name==="zoom"&&(r=s);return r instanceof Za||s.eachChild((l=>{const h=za(l);h instanceof Za?r=h:!r&&h?r=new Za("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&h&&r!==h&&(r=new Za("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),r}class Un{constructor(r,l,h,p){this.message=(r?`${r}: `:"")+h,p&&(this.identifier=p),l!=null&&l.__line__&&(this.line=l.__line__)}}function Rs(s){const r=s.key,l=s.value,h=s.valueSpec||{},p=s.objectElementValidators||{},x=s.style,b=s.styleSpec;let A=[];const P=Bi(l);if(P!=="object")return[new Un(r,l,`object expected, ${P} found`)];for(const M in l){const G=M.split(".")[0];let X;p[G]?X=p[G]:h[G]?X=$i:p["*"]?X=p["*"]:h["*"]&&(X=$i),X?A=A.concat(X({key:(r&&`${r}.`)+M,value:l[M],valueSpec:h[G]||h["*"],style:x,styleSpec:b,object:l,objectKey:M},l)):A.push(new Un(r,l[M],`unknown property "${M}"`))}for(const M in h)p[M]||h[M].required&&h[M].default===void 0&&l[M]===void 0&&A.push(new Un(r,l,`missing required property "${M}"`));return A}function Ns(s){const r=s.value,l=s.valueSpec,h=s.style,p=s.styleSpec,x=s.key,b=s.arrayElementValidator||$i;if(Bi(r)!=="array")return[new Un(x,r,`array expected, ${Bi(r)} found`)];if(l.length&&r.length!==l.length)return[new Un(x,r,`array length ${l.length} expected, length ${r.length} found`)];if(l["min-length"]&&r.length<l["min-length"])return[new Un(x,r,`array length at least ${l["min-length"]} expected, length ${r.length} found`)];let A={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};p.$version<7&&(A.function=l.function),Bi(l.value)==="object"&&(A=l.value);let P=[];for(let M=0;M<r.length;M++)P=P.concat(b({array:r,arrayIndex:M,value:r[M],valueSpec:A,style:h,styleSpec:p,key:`${x}[${M}]`}));return P}function lo(s){const r=s.key,l=s.value,h=s.valueSpec;let p=Bi(l);if(p==="number"&&l!=l&&(p="NaN"),p!=="number")return[new Un(r,l,`number expected, ${p} found`)];if("minimum"in h){let x=h.minimum;if(Bi(h.minimum)==="array"&&(x=h.minimum[s.arrayIndex]),l<x)return[new Un(r,l,`${l} is less than the minimum value ${x}`)]}if("maximum"in h){let x=h.maximum;if(Bi(h.maximum)==="array"&&(x=h.maximum[s.arrayIndex]),l>x)return[new Un(r,l,`${l} is greater than the maximum value ${x}`)]}return[]}function va(s){const r=s.valueSpec,l=ss(s.value.type);let h,p,x,b={};const A=l!=="categorical"&&s.value.property===void 0,P=!A,M=Bi(s.value.stops)==="array"&&Bi(s.value.stops[0])==="array"&&Bi(s.value.stops[0][0])==="object",G=Rs({key:s.key,value:s.value,valueSpec:s.styleSpec.function,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(de){if(l==="identity")return[new Un(de.key,de.value,'identity function may not have a "stops" property')];let ye=[];const Se=de.value;return ye=ye.concat(Ns({key:de.key,value:Se,valueSpec:de.valueSpec,style:de.style,styleSpec:de.styleSpec,arrayElementValidator:X})),Bi(Se)==="array"&&Se.length===0&&ye.push(new Un(de.key,Se,"array must have at least one stop")),ye},default:function(de){return $i({key:de.key,value:de.value,valueSpec:r,style:de.style,styleSpec:de.styleSpec})}}});return l==="identity"&&A&&G.push(new Un(s.key,s.value,'missing required property "property"')),l==="identity"||s.value.stops||G.push(new Un(s.key,s.value,'missing required property "stops"')),l==="exponential"&&s.valueSpec.expression&&!eh(s.valueSpec)&&G.push(new Un(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(P&&!jr(s.valueSpec)?G.push(new Un(s.key,s.value,"property functions not supported")):A&&!Qu(s.valueSpec)&&G.push(new Un(s.key,s.value,"zoom functions not supported"))),l!=="categorical"&&!M||s.value.property!==void 0||G.push(new Un(s.key,s.value,'"property" property is required')),G;function X(de){let ye=[];const Se=de.value,We=de.key;if(Bi(Se)!=="array")return[new Un(We,Se,`array expected, ${Bi(Se)} found`)];if(Se.length!==2)return[new Un(We,Se,`array length 2 expected, length ${Se.length} found`)];if(M){if(Bi(Se[0])!=="object")return[new Un(We,Se,`object expected, ${Bi(Se[0])} found`)];if(Se[0].zoom===void 0)return[new Un(We,Se,"object stop key must have zoom")];if(Se[0].value===void 0)return[new Un(We,Se,"object stop key must have value")];const at=ss(Se[0].zoom);if(typeof at!="number")return[new Un(We,Se[0].zoom,"stop zoom values must be numbers")];if(x&&x>at)return[new Un(We,Se[0].zoom,"stop zoom values must appear in ascending order")];at!==x&&(x=at,p=void 0,b={}),ye=ye.concat(Rs({key:`${We}[0]`,value:Se[0],valueSpec:{zoom:{}},style:de.style,styleSpec:de.styleSpec,objectElementValidators:{zoom:lo,value:re}}))}else ye=ye.concat(re({key:`${We}[0]`,value:Se[0],style:de.style,styleSpec:de.styleSpec},Se));return _a(vi(Se[1]))?ye.concat([new Un(`${We}[1]`,Se[1],"expressions are not allowed in function stops.")]):ye.concat($i({key:`${We}[1]`,value:Se[1],valueSpec:r,style:de.style,styleSpec:de.styleSpec}))}function re(de,ye){const Se=Bi(de.value),We=ss(de.value),at=de.value!==null?de.value:ye;if(h){if(Se!==h)return[new Un(de.key,at,`${Se} stop domain type must match previous stop domain type ${h}`)]}else h=Se;if(Se!=="number"&&Se!=="string"&&Se!=="boolean"&&typeof We!="number"&&typeof We!="string"&&typeof We!="boolean")return[new Un(de.key,at,"stop domain value must be a number, string, or boolean")];if(Se!=="number"&&l!=="categorical"){let xt=`number expected, ${Se} found`;return jr(r)&&l===void 0&&(xt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Un(de.key,at,xt)]}return l!=="categorical"||Se!=="number"||typeof We=="number"&&isFinite(We)&&Math.floor(We)===We?l!=="categorical"&&Se==="number"&&typeof We=="number"&&typeof p=="number"&&p!==void 0&&We<p?[new Un(de.key,at,"stop domain values must appear in ascending order")]:(p=We,l==="categorical"&&We in b?[new Un(de.key,at,"stop domain values must be unique")]:(b[We]=!0,[])):[new Un(de.key,at,`integer expected, found ${String(We)}`)]}}function gl(s){const r=(s.expressionContext==="property"?sc:Bo)(vi(s.value),s.valueSpec);if(r.result==="error")return r.value.map((h=>new Un(`${s.key}${h.key}`,s.value,h.message)));const l=r.value.expression||r.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!l.outputDefined())return[new Un(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!Vo(l))return[new Un(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter")return Jh(l,s);if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!es(l,["zoom","feature-state"]))return[new Un(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!Mo(l))return[new Un(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Jh(s,r){const l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const p of r.valueSpec.expression.parameters)l.delete(p);if(l.size===0)return[];const h=[];return s instanceof ia&&l.has(s.name)?[new Un(r.key,r.value,`["${s.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(s.eachChild((p=>{h.push(...Jh(p,r))})),h)}function ii(s){const r=s.key,l=s.value,h=s.valueSpec,p=[];return Array.isArray(h.values)?h.values.indexOf(ss(l))===-1&&p.push(new Un(r,l,`expected one of [${h.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(h.values).indexOf(ss(l))===-1&&p.push(new Un(r,l,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(l)} found`)),p}function bu(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const r of s.slice(1))if(!bu(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}function th(s,r="fill"){if(s==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};bu(s)||(s=nh(s));const l=s;let h=!0;try{h=(function(M){if(!Vc(M))return M;let G=vi(M);return Pa(G),G=Ks(G),G})(l)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(l,null,2)}
        `)}const p=pn[`filter_${r}`],x=Bo(h,p);let b=null;if(x.result==="error")throw new Error(x.value.map((M=>`${M.key}: ${M.message}`)).join(", "));b=(M,G,X)=>x.value.evaluate(M,G,{},X);let A=null,P=null;if(h!==l){const M=Bo(l,p);if(M.result==="error")throw new Error(M.value.map((G=>`${G.key}: ${G.message}`)).join(", "));A=(G,X,re,de,ye)=>M.value.evaluate(G,X,{},re,void 0,void 0,de,ye),P=!Mo(M.value.expression)}return{filter:b,dynamicFilter:A||void 0,needGeometry:Zf(h),needFeature:!!P}}function Ks(s){if(!Array.isArray(s))return s;const r=(function(l){if(ac.has(l[0])){for(let h=1;h<l.length;h++)if(Vc(l[h]))return!0}return l})(s);return r===!0?r:r.map((l=>Ks(l)))}function Pa(s){let r=!1;const l=[];if(s[0]==="case"){for(let h=1;h<s.length-1;h+=2)r=r||Vc(s[h]),l.push(s[h+1]);l.push(s[s.length-1])}else if(s[0]==="match"){r=r||Vc(s[1]);for(let h=2;h<s.length-1;h+=2)l.push(s[h+1]);l.push(s[s.length-1])}else if(s[0]==="step"){r=r||Vc(s[1]);for(let h=1;h<s.length-1;h+=2)l.push(s[h+1])}r&&(s.length=0,s.push("any",...l));for(let h=1;h<s.length;h++)Pa(s[h])}function Vc(s){if(!Array.isArray(s))return!1;if((r=s[0])==="pitch"||r==="distance-from-center")return!0;var r;for(let l=1;l<s.length;l++)if(Vc(s[l]))return!0;return!1}const ac=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Qh(s,r){return s<r?-1:s>r?1:0}function Zf(s){if(!Array.isArray(s))return!1;if(s[0]==="within")return!0;for(let r=1;r<s.length;r++)if(Zf(s[r]))return!0;return!1}function nh(s){if(!s)return!0;const r=s[0];return s.length<=1?r!=="any":r==="=="?vo(s[1],s[2],"=="):r==="!="?nl(vo(s[1],s[2],"==")):r==="<"||r===">"||r==="<="||r===">="?vo(s[1],s[2],r):r==="any"?(l=s.slice(1),["any"].concat(l.map(nh))):r==="all"?["all"].concat(s.slice(1).map(nh)):r==="none"?["all"].concat(s.slice(1).map(nh).map(nl)):r==="in"?ca(s[1],s.slice(2)):r==="!in"?nl(ca(s[1],s.slice(2))):r==="has"?ja(s[1]):r==="!has"?nl(ja(s[1])):r!=="within"||s;var l}function vo(s,r,l){switch(s){case"$type":return[`filter-type-${l}`,r];case"$id":return[`filter-id-${l}`,r];default:return[`filter-${l}`,s,r]}}function ca(s,r){if(r.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some((l=>typeof l!=typeof r[0]))?["filter-in-large",s,["literal",r.sort(Qh)]]:["filter-in-small",s,["literal",r]]}}function ja(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function nl(s){return["!",s]}function xo(s){return bu(vi(s.value))?gl(Yo({},s,{expressionContext:"filter",valueSpec:s.styleSpec[`filter_${s.layerType||"fill"}`]})):ou(s)}function ou(s){const r=s.value,l=s.key;if(Bi(r)!=="array")return[new Un(l,r,`array expected, ${Bi(r)} found`)];const h=s.styleSpec;let p,x=[];if(r.length<1)return[new Un(l,r,"filter array must have at least 1 element")];switch(x=x.concat(ii({key:`${l}[0]`,value:r[0],valueSpec:h.filter_operator,style:s.style,styleSpec:s.styleSpec})),ss(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&ss(r[1])==="$type"&&x.push(new Un(l,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&x.push(new Un(l,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(p=Bi(r[1]),p!=="string"&&x.push(new Un(`${l}[1]`,r[1],`string expected, ${p} found`)));for(let b=2;b<r.length;b++)p=Bi(r[b]),ss(r[1])==="$type"?x=x.concat(ii({key:`${l}[${b}]`,value:r[b],valueSpec:h.geometry_type,style:s.style,styleSpec:s.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&x.push(new Un(`${l}[${b}]`,r[b],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let b=1;b<r.length;b++)x=x.concat(ou({key:`${l}[${b}]`,value:r[b],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":p=Bi(r[1]),r.length!==2?x.push(new Un(l,r,`filter array for "${r[0]}" operator must have 2 elements`)):p!=="string"&&x.push(new Un(`${l}[1]`,r[1],`string expected, ${p} found`));break;case"within":p=Bi(r[1]),r.length!==2?x.push(new Un(l,r,`filter array for "${r[0]}" operator must have 2 elements`)):p!=="object"&&x.push(new Un(`${l}[1]`,r[1],`object expected, ${p} found`))}return x}function xa(s,r){const l=s.key,h=s.style,p=s.styleSpec,x=s.value,b=s.objectKey,A=p[`${r}_${s.layerType}`];if(!A)return[];const P=b.match(/^(.*)-transition$/);if(r==="paint"&&P&&A[P[1]]&&A[P[1]].transition)return $i({key:l,value:x,valueSpec:p.transition,style:h,styleSpec:p});const M=s.valueSpec||A[b];if(!M)return[new Un(l,x,`unknown property "${b}"`)];let G;if(Bi(x)==="string"&&jr(M)&&!M.tokens&&(G=/^{([^}]+)}$/.exec(x))){const re=`\`{ "type": "identity", "property": ${G?JSON.stringify(G[1]):'"_"'} }\``;return[new Un(l,x,`"${b}" does not support interpolation syntax
Use an identity property function instead: ${re}.`)]}const X=[];return s.layerType==="symbol"&&(b==="text-field"&&h&&!h.glyphs&&X.push(new Un(l,x,'use of "text-field" requires a style "glyphs" property')),b==="text-font"&&Tl(vi(x))&&ss(x.type)==="identity"&&X.push(new Un(l,x,'"text-font" does not support identity functions'))),X.concat($i({key:s.key,value:x,valueSpec:M,style:h,styleSpec:p,expressionContext:"property",propertyType:r,propertyKey:b}))}function zl(s){return xa(s,"paint")}function Oh(s){return xa(s,"layout")}function jl(s){let r=[];const l=s.value,h=s.key,p=s.style,x=s.styleSpec;l.type||l.ref||r.push(new Un(h,l,'either "type" or "ref" is required'));let b=ss(l.type);const A=ss(l.ref);if(l.id){const P=ss(l.id);for(let M=0;M<s.arrayIndex;M++){const G=p.layers[M];ss(G.id)===P&&r.push(new Un(h,l.id,`duplicate layer id "${l.id}", previously used at line ${G.id.__line__}`))}}if("ref"in l){let P;["type","source","source-layer","filter","layout"].forEach((M=>{M in l&&r.push(new Un(h,l[M],`"${M}" is prohibited for ref layers`))})),p.layers.forEach((M=>{ss(M.id)===A&&(P=M)})),P?P.ref?r.push(new Un(h,l.ref,"ref cannot reference another ref layer")):b=ss(P.type):typeof A=="string"&&r.push(new Un(h,l.ref,`ref layer "${A}" not found`))}else if(b!=="background"&&b!=="sky")if(l.source){const P=p.sources&&p.sources[l.source],M=P&&ss(P.type);P?M==="vector"&&b==="raster"?r.push(new Un(h,l.source,`layer "${l.id}" requires a raster source`)):M==="raster"&&b!=="raster"?r.push(new Un(h,l.source,`layer "${l.id}" requires a vector source`)):M!=="vector"||l["source-layer"]?M==="raster-dem"&&b!=="hillshade"?r.push(new Un(h,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):b!=="line"||!l.paint||!l.paint["line-gradient"]&&!l.paint["line-trim-offset"]||M==="geojson"&&P.lineMetrics||r.push(new Un(h,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new Un(h,l,`layer "${l.id}" must specify a "source-layer"`)):r.push(new Un(h,l.source,`source "${l.source}" not found`))}else r.push(new Un(h,l,'missing required property "source"'));return r=r.concat(Rs({key:h,value:l,valueSpec:x.layer,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{"*":()=>[],type:()=>$i({key:`${h}.type`,value:l.type,valueSpec:x.layer.type,style:s.style,styleSpec:s.styleSpec,object:l,objectKey:"type"}),filter:P=>xo(Yo({layerType:b},P)),layout:P=>Rs({layer:l,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":M=>Oh(Yo({layerType:b},M))}}),paint:P=>Rs({layer:l,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":M=>zl(Yo({layerType:b},M))}})}})),r}function ka(s){const r=s.value,l=s.key,h=Bi(r);return h!=="string"?[new Un(l,r,`string expected, ${h} found`)]:[]}const wh={promoteId:function({key:s,value:r}){if(Bi(r)==="string")return ka({key:s,value:r});{const l=[];for(const h in r)l.push(...ka({key:`${s}.${h}`,value:r[h]}));return l}}};function su(s){const r=s.value,l=s.key,h=s.styleSpec,p=s.style;if(!r.type)return[new Un(l,r,'"type" is required')];const x=ss(r.type);let b;switch(x){case"vector":case"raster":case"raster-dem":return b=Rs({key:l,value:r,valueSpec:h[`source_${x.replace("-","_")}`],style:s.style,styleSpec:h,objectElementValidators:wh}),b;case"geojson":if(b=Rs({key:l,value:r,valueSpec:h.source_geojson,style:p,styleSpec:h,objectElementValidators:wh}),r.cluster)for(const A in r.clusterProperties){const[P,M]=r.clusterProperties[A],G=typeof P=="string"?[P,["accumulated"],["get",A]]:P;b.push(...gl({key:`${l}.${A}.map`,value:M,expressionContext:"cluster-map"})),b.push(...gl({key:`${l}.${A}.reduce`,value:G,expressionContext:"cluster-reduce"}))}return b;case"video":return Rs({key:l,value:r,valueSpec:h.source_video,style:p,styleSpec:h});case"image":return Rs({key:l,value:r,valueSpec:h.source_image,style:p,styleSpec:h});case"canvas":return[new Un(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ii({key:`${l}.type`,value:r.type,valueSpec:{values:Cc(h)}})}}function Cc(s){return s.source.reduce(((r,l)=>{const h=s[l];return h.type.type==="enum"&&(r=r.concat(Object.keys(h.type.values))),r}),[])}function Bh(s){const r=s.value,l=s.styleSpec,h=l.light,p=s.style;let x=[];const b=Bi(r);if(r===void 0)return x;if(b!=="object")return x=x.concat([new Un("light",r,`object expected, ${b} found`)]),x;for(const A in r){const P=A.match(/^(.*)-transition$/);x=x.concat(P&&h[P[1]]&&h[P[1]].transition?$i({key:A,value:r[A],valueSpec:l.transition,style:p,styleSpec:l}):h[A]?$i({key:A,value:r[A],valueSpec:h[A],style:p,styleSpec:l}):[new Un(A,r[A],`unknown property "${A}"`)])}return x}function Lc(s){const r=s.value,l=s.key,h=s.style,p=s.styleSpec,x=p.terrain;let b=[];const A=Bi(r);if(r===void 0)return b;if(A!=="object")return b=b.concat([new Un("terrain",r,`object expected, ${A} found`)]),b;for(const P in r){const M=P.match(/^(.*)-transition$/);b=b.concat(M&&x[M[1]]&&x[M[1]].transition?$i({key:P,value:r[P],valueSpec:p.transition,style:h,styleSpec:p}):x[P]?$i({key:P,value:r[P],valueSpec:x[P],style:h,styleSpec:p}):[new Un(P,r[P],`unknown property "${P}"`)])}if(r.source){const P=h.sources&&h.sources[r.source],M=P&&ss(P.type);P?M!=="raster-dem"&&b.push(new Un(l,r.source,`terrain cannot be used with a source of type ${String(M)}, it only be used with a "raster-dem" source type`)):b.push(new Un(l,r.source,`source "${r.source}" not found`))}else b.push(new Un(l,r,'terrain is missing required property "source"'));return b}function lc(s){const r=s.value,l=s.style,h=s.styleSpec,p=h.fog;let x=[];const b=Bi(r);if(r===void 0)return x;if(b!=="object")return x=x.concat([new Un("fog",r,`object expected, ${b} found`)]),x;for(const A in r){const P=A.match(/^(.*)-transition$/);x=x.concat(P&&p[P[1]]&&p[P[1]].transition?$i({key:A,value:r[A],valueSpec:h.transition,style:l,styleSpec:h}):p[A]?$i({key:A,value:r[A],valueSpec:p[A],style:l,styleSpec:h}):[new Un(A,r[A],`unknown property "${A}"`)])}return x}const Ao={"*":()=>[],array:Ns,boolean:function(s){const r=s.value,l=s.key,h=Bi(r);return h!=="boolean"?[new Un(l,r,`boolean expected, ${h} found`)]:[]},number:lo,color:function(s){const r=s.key,l=s.value,h=Bi(l);return h!=="string"?[new Un(r,l,`color expected, ${h} found`)]:nc(l)===null?[new Un(r,l,`color expected, "${l}" found`)]:[]},enum:ii,filter:xo,function:va,layer:jl,object:Rs,source:su,light:Bh,terrain:Lc,fog:lc,string:ka,formatted:function(s){return ka(s).length===0?[]:gl(s)},resolvedImage:function(s){return ka(s).length===0?[]:gl(s)},projection:function(s){const r=s.value,l=s.styleSpec,h=l.projection,p=s.style;let x=[];const b=Bi(r);if(b==="object")for(const A in r)x=x.concat($i({key:A,value:r[A],valueSpec:h[A],style:p,styleSpec:l}));else b!=="string"&&(x=x.concat([new Un("projection",r,`object or string expected, ${b} found`)]));return x}};function $i(s){const r=s.value,l=s.valueSpec,h=s.styleSpec;return l.expression&&Tl(ss(r))?va(s):l.expression&&_a(vi(r))?gl(s):l.type&&Ao[l.type]?Ao[l.type](s):Rs(Yo({},s,{valueSpec:l.type?h[l.type]:l}))}function Ou(s){const r=s.value,l=s.key,h=ka(s);return h.length||(r.indexOf("{fontstack}")===-1&&h.push(new Un(l,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&h.push(new Un(l,r,'"glyphs" url must include a "{range}" token'))),h}function Ua(s,r=pn){return rl($i({key:"",value:s,valueSpec:r.$root,styleSpec:r,style:s,objectElementValidators:{glyphs:Ou,"*":()=>[]}}))}const yl=s=>rl(zl(s)),qc=s=>rl(Oh(s));function rl(s){return s.slice().sort(((r,l)=>r.line&&l.line?r.line-l.line:0))}function _l(s,r){let l=!1;if(r&&r.length)for(const h of r)s.fire(new Aa(new Error(h.message))),l=!0;return l}var Sh=Vl,Ul=3;function Vl(s,r,l){var h=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var p=new Int32Array(this.arrayBuffer);s=p[0],this.d=(r=p[1])+2*(l=p[2]);for(var x=0;x<this.d*this.d;x++){var b=p[Ul+x],A=p[Ul+x+1];h.push(b===A?null:p.subarray(b,A))}var P=p[Ul+h.length+1];this.keys=p.subarray(p[Ul+h.length],P),this.bboxes=p.subarray(P),this.insert=this._insertReadonly}else{this.d=r+2*l;for(var M=0;M<this.d*this.d;M++)h.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=s,this.padding=l,this.scale=r/s,this.uid=0;var G=l/r*s;this.min=-G,this.max=s+G}Vl.prototype.insert=function(s,r,l,h,p){this._forEachCell(r,l,h,p,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(r),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(p)},Vl.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Vl.prototype._insertCell=function(s,r,l,h,p,x){this.cells[p].push(x)},Vl.prototype.query=function(s,r,l,h,p){var x=this.min,b=this.max;if(s<=x&&r<=x&&b<=l&&b<=h&&!p)return Array.prototype.slice.call(this.keys);var A=[];return this._forEachCell(s,r,l,h,this._queryCell,A,{},p),A},Vl.prototype._queryCell=function(s,r,l,h,p,x,b,A){var P=this.cells[p];if(P!==null)for(var M=this.keys,G=this.bboxes,X=0;X<P.length;X++){var re=P[X];if(b[re]===void 0){var de=4*re;(A?A(G[de+0],G[de+1],G[de+2],G[de+3]):s<=G[de+2]&&r<=G[de+3]&&l>=G[de+0]&&h>=G[de+1])?(b[re]=!0,x.push(M[re])):b[re]=!1}}},Vl.prototype._forEachCell=function(s,r,l,h,p,x,b,A){for(var P=this._convertToCellCoord(s),M=this._convertToCellCoord(r),G=this._convertToCellCoord(l),X=this._convertToCellCoord(h),re=P;re<=G;re++)for(var de=M;de<=X;de++){var ye=this.d*de+re;if((!A||A(this._convertFromCellCoord(re),this._convertFromCellCoord(de),this._convertFromCellCoord(re+1),this._convertFromCellCoord(de+1)))&&p.call(this,s,r,l,h,ye,x,b,A))return}},Vl.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},Vl.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},Vl.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,r=Ul+this.cells.length+1+1,l=0,h=0;h<this.cells.length;h++)l+=this.cells[h].length;var p=new Int32Array(r+l+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var x=r,b=0;b<s.length;b++){var A=s[b];p[Ul+b]=x,p.set(A,x),x+=A.length}return p[Ul+s.length]=x,p.set(this.keys,x),p[Ul+s.length+1]=x+=this.keys.length,p.set(this.bboxes,x),x+=this.bboxes.length,p.buffer};var cc=ue(Sh);const zh={};function lr(s,r,l={}){Object.defineProperty(s,"_classRegistryKey",{value:r,writeable:!1}),zh[r]={klass:s,omit:l.omit||[]}}lr(Object,"Object"),cc.serialize=function(s,r){const l=s.toArrayBuffer();return r&&r.push(l),{buffer:l}},cc.deserialize=function(s){return new cc(s.buffer)},Object.defineProperty(cc,"name",{value:"Grid"}),lr(cc,"Grid"),lr(Eo,"Color"),lr(Error,"Error"),lr(ai,"AJAXError"),lr(js,"ResolvedImage"),lr(Ii,"StylePropertyFunction"),lr(ml,"StyleExpression",{omit:["_evaluator"]}),lr(Ic,"ZoomDependentExpression"),lr(Fu,"ZoomConstantExpression"),lr(ia,"CompoundExpression",{omit:["_evaluate"]});for(const s in Bl)zh[Bl[s]._classRegistryKey]||lr(Bl[s],`Expression${s}`);function $c(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function C(s){return w.ImageBitmap&&s instanceof w.ImageBitmap}function B(s,r){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if($c(s)||C(s))return r&&r.push(s),s;if(ArrayBuffer.isView(s)){const l=s;return r&&r.push(l.buffer),l}if(s instanceof w.ImageData)return r&&r.push(s.data.buffer),s;if(Array.isArray(s)){const l=[];for(const h of s)l.push(B(h,r));return l}if(typeof s=="object"){const l=s.constructor,h=l._classRegistryKey;if(!h)throw new Error(`can't serialize object of unregistered class ${h}`);const p=l.serialize?l.serialize(s,r):{};if(!l.serialize){for(const x in s)s.hasOwnProperty(x)&&(zh[h].omit.indexOf(x)>=0||(p[x]=B(s[x],r)));s instanceof Error&&(p.message=s.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return h!=="Object"&&(p.$name=h),p}throw new Error("can't serialize object of type "+typeof s)}function ee(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||$c(s)||C(s)||ArrayBuffer.isView(s)||s instanceof w.ImageData)return s;if(Array.isArray(s))return s.map(ee);if(typeof s=="object"){const r=s.$name||"Object",{klass:l}=zh[r];if(!l)throw new Error(`can't deserialize unregistered class ${r}`);if(l.deserialize)return l.deserialize(s);const h=Object.create(l.prototype);for(const p of Object.keys(s))p!=="$name"&&(h[p]=ee(s[p]));return h}throw new Error("can't deserialize object of type "+typeof s)}const oe={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function Pe(s){for(const r of s)if(Ye(r.charCodeAt(0)))return!0;return!1}function je(s){for(const r of s)if(!Ke(r.charCodeAt(0)))return!1;return!0}function Ke(s){return!(oe.Arabic(s)||oe["Arabic Supplement"](s)||oe["Arabic Extended-A"](s)||oe["Arabic Presentation Forms-A"](s)||oe["Arabic Presentation Forms-B"](s))}function Ye(s){return!(s!==746&&s!==747&&(s<4352||!(oe["Bopomofo Extended"](s)||oe.Bopomofo(s)||oe["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||oe["CJK Compatibility Ideographs"](s)||oe["CJK Compatibility"](s)||oe["CJK Radicals Supplement"](s)||oe["CJK Strokes"](s)||!(!oe["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||oe["CJK Unified Ideographs Extension A"](s)||oe["CJK Unified Ideographs"](s)||oe["Enclosed CJK Letters and Months"](s)||oe["Hangul Compatibility Jamo"](s)||oe["Hangul Jamo Extended-A"](s)||oe["Hangul Jamo Extended-B"](s)||oe["Hangul Jamo"](s)||oe["Hangul Syllables"](s)||oe.Hiragana(s)||oe["Ideographic Description Characters"](s)||oe.Kanbun(s)||oe["Kangxi Radicals"](s)||oe["Katakana Phonetic Extensions"](s)||oe.Katakana(s)&&s!==12540||!(!oe["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!oe["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||oe["Unified Canadian Aboriginal Syllabics"](s)||oe["Unified Canadian Aboriginal Syllabics Extended"](s)||oe["Vertical Forms"](s)||oe["Yijing Hexagram Symbols"](s)||oe["Yi Syllables"](s)||oe["Yi Radicals"](s))))}function tt(s){return!(Ye(s)||(function(r){return!!(oe["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||oe["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||oe["Letterlike Symbols"](r)||oe["Number Forms"](r)||oe["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||oe["Control Pictures"](r)&&r!==9251||oe["Optical Character Recognition"](r)||oe["Enclosed Alphanumerics"](r)||oe["Geometric Shapes"](r)||oe["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||oe["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||oe["CJK Symbols and Punctuation"](r)||oe.Katakana(r)||oe["Private Use Area"](r)||oe["CJK Compatibility Forms"](r)||oe["Small Form Variants"](r)||oe["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)})(s))}function ut(s){return s>=1424&&s<=2303||oe["Arabic Presentation Forms-A"](s)||oe["Arabic Presentation Forms-B"](s)}function Nt(s,r){return!(!r&&ut(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||oe.Khmer(s))}function rn(s){for(const r of s)if(ut(r.charCodeAt(0)))return!0;return!1}const ft="deferred",zt="loading",Jt="loaded";let En=null,y="unavailable",a=null;const f=function(s){s&&typeof s=="string"&&s.indexOf("NetworkError")>-1&&(y="error"),En&&En(s)};function v(){S.fire(new ec("pluginStateChange",{pluginStatus:y,pluginURL:a}))}const S=new ra,T=function(){return y},N=function(){if(y!==ft||!a)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");y=zt,v(),a&&hi({url:a},(s=>{s?f(s):(y=Jt,v())}))},z={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>y===Jt||z.applyArabicShaping!=null,isLoading:()=>y===zt,setState(s){y=s.pluginStatus,a=s.pluginURL},isParsed:()=>z.applyArabicShaping!=null&&z.processBidirectionalText!=null&&z.processStyledBidirectionalText!=null,getPluginURL:()=>a};class ${constructor(r,l){this.zoom=r,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.transition=l.transition,this.pitch=l.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(r){return(function(l,h){for(const p of l)if(!Nt(p.charCodeAt(0),h))return!1;return!0})(r,z.isLoaded())}}class Q{constructor(r,l){this.property=r,this.value=l,this.expression=(function(h,p){if(Tl(h))return new Ii(h,p);if(_a(h)){const x=sc(h,p);if(x.result==="error")throw new Error(x.value.map((b=>`${b.key}: ${b.message}`)).join(", "));return x.value}{let x=h;return typeof h=="string"&&p.type==="color"&&(x=Eo.parse(h)),{kind:"constant",evaluate:()=>x}}})(l===void 0?r.specification.default:l,r.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(r,l,h){return this.property.possiblyEvaluate(this,r,l,h)}}class te{constructor(r){this.property=r,this.value=new Q(r,void 0)}transitioned(r,l){return new Ae(this.property,this.value,l,Oe({},r.transition,this.transition),r.now)}untransitioned(){return new Ae(this.property,this.value,null,{},0)}}class ge{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return Gt(this._values[r].value.value)}setValue(r,l){this._values.hasOwnProperty(r)||(this._values[r]=new te(this._values[r].property)),this._values[r].value=new Q(this._values[r].property,l===null?void 0:Gt(l))}getTransition(r){return Gt(this._values[r].transition)}setTransition(r,l){this._values.hasOwnProperty(r)||(this._values[r]=new te(this._values[r].property)),this._values[r].transition=Gt(l)||void 0}serialize(){const r={};for(const l of Object.keys(this._values)){const h=this.getValue(l);h!==void 0&&(r[l]=h);const p=this.getTransition(l);p!==void 0&&(r[`${l}-transition`]=p)}return r}transitioned(r,l){const h=new Le(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].transitioned(r,l._values[p]);return h}untransitioned(){const r=new Le(this._properties);for(const l of Object.keys(this._values))r._values[l]=this._values[l].untransitioned();return r}}class Ae{constructor(r,l,h,p,x){const b=p.delay||0,A=p.duration||0;x=x||0,this.property=r,this.value=l,this.begin=x+b,this.end=this.begin+A,r.specification.transition&&(p.delay||p.duration)&&(this.prior=h)}possiblyEvaluate(r,l,h){const p=r.now||0,x=this.value.possiblyEvaluate(r,l,h),b=this.prior;if(b){if(p>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(p<this.begin)return b.possiblyEvaluate(r,l,h);{const A=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(r,l,h),x,Be(A))}}return x}}class Le{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,l,h){const p=new Xe(this._properties);for(const x of Object.keys(this._values))p._values[x]=this._values[x].possiblyEvaluate(r,l,h);return p}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class Ze{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}getValue(r){return Gt(this._values[r].value)}setValue(r,l){this._values[r]=new Q(this._values[r].property,l===null?void 0:Gt(l))}serialize(){const r={};for(const l of Object.keys(this._values)){const h=this.getValue(l);h!==void 0&&(r[l]=h)}return r}possiblyEvaluate(r,l,h){const p=new Xe(this._properties);for(const x of Object.keys(this._values))p._values[x]=this._values[x].possiblyEvaluate(r,l,h);return p}}class Ue{constructor(r,l,h){this.property=r,this.value=l,this.parameters=h}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,l,h,p){return this.property.evaluate(this.value,this.parameters,r,l,h,p)}}class Xe{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class _e{constructor(r){this.specification=r}possiblyEvaluate(r,l){return r.expression.evaluate(l)}interpolate(r,l,h){const p=Xt[this.specification.type];return p?p(r,l,h):r}}class Ge{constructor(r,l){this.specification=r,this.overrides=l}possiblyEvaluate(r,l,h,p){return new Ue(this,r.expression.kind==="constant"||r.expression.kind==="camera"?{kind:"constant",value:r.expression.evaluate(l,null,{},h,p)}:r.expression,l)}interpolate(r,l,h){if(r.value.kind!=="constant"||l.value.kind!=="constant")return r;if(r.value.value===void 0||l.value.value===void 0)return new Ue(this,{kind:"constant",value:void 0},r.parameters);const p=Xt[this.specification.type];return p?new Ue(this,{kind:"constant",value:p(r.value.value,l.value.value,h)},r.parameters):r}evaluate(r,l,h,p,x,b){return r.kind==="constant"?r.value:r.evaluate(l,h,p,x,b)}}class it{constructor(r){this.specification=r}possiblyEvaluate(r,l,h,p){return!!r.expression.evaluate(l,null,{},h,p)}interpolate(){return!1}}class ot{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const l=new $(0,{});for(const h in r){const p=r[h];p.specification.overridable&&this.overridableProperties.push(h);const x=this.defaultPropertyValues[h]=new Q(p,void 0),b=this.defaultTransitionablePropertyValues[h]=new te(p);this.defaultTransitioningPropertyValues[h]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=x.possiblyEvaluate(l)}}}function bt(s,r){return 256*(s=De(Math.floor(s),0,255))+De(Math.floor(r),0,255)}lr(Ge,"DataDrivenProperty"),lr(_e,"DataConstantProperty"),lr(it,"ColorRampProperty");const wt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class _t{constructor(r,l){this._structArray=r,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Pt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,l){return r._trim(),l&&(r.isTransferred=!0,l.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const l=Object.create(this.prototype);return l.arrayBuffer=r.arrayBuffer,l.length=r.length,l.capacity=r.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function kt(s,r=1){let l=0,h=0;return{members:s.map((p=>{const x=wt[p.type].BYTES_PER_ELEMENT,b=l=jt(l,Math.max(r,x)),A=p.components||1;return h=Math.max(h,x),l+=x*A,{name:p.name,type:p.type,components:A,offset:b}})),size:jt(l,Math.max(h,r)),alignment:r}}function jt(s,r){return Math.ceil(s/r)*r}class _n extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l){const h=this.length;return this.resize(h+1),this.emplace(h,r,l)}emplace(r,l,h){const p=2*r;return this.int16[p+0]=l,this.int16[p+1]=h,r}}_n.prototype.bytesPerElement=4,lr(_n,"StructArrayLayout2i4");class Ut extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,r,l,h)}emplace(r,l,h,p){const x=3*r;return this.int16[x+0]=l,this.int16[x+1]=h,this.int16[x+2]=p,r}}Ut.prototype.bytesPerElement=6,lr(Ut,"StructArrayLayout3i6");class cn extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,h,p){const x=this.length;return this.resize(x+1),this.emplace(x,r,l,h,p)}emplace(r,l,h,p,x){const b=4*r;return this.int16[b+0]=l,this.int16[b+1]=h,this.int16[b+2]=p,this.int16[b+3]=x,r}}cn.prototype.bytesPerElement=8,lr(cn,"StructArrayLayout4i8");class Wt extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x,b,A){const P=this.length;return this.resize(P+1),this.emplace(P,r,l,h,p,x,b,A)}emplace(r,l,h,p,x,b,A,P){const M=6*r,G=12*r,X=3*r;return this.int16[M+0]=l,this.int16[M+1]=h,this.uint8[G+4]=p,this.uint8[G+5]=x,this.uint8[G+6]=b,this.uint8[G+7]=A,this.float32[X+2]=P,r}}Wt.prototype.bytesPerElement=12,lr(Wt,"StructArrayLayout2i4ub1f12");class In extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,p){const x=this.length;return this.resize(x+1),this.emplace(x,r,l,h,p)}emplace(r,l,h,p,x){const b=4*r;return this.float32[b+0]=l,this.float32[b+1]=h,this.float32[b+2]=p,this.float32[b+3]=x,r}}In.prototype.bytesPerElement=16,lr(In,"StructArrayLayout4f16");class Bt extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x){const b=this.length;return this.resize(b+1),this.emplace(b,r,l,h,p,x)}emplace(r,l,h,p,x,b){const A=6*r,P=3*r;return this.uint16[A+0]=l,this.uint16[A+1]=h,this.uint16[A+2]=p,this.uint16[A+3]=x,this.float32[P+2]=b,r}}Bt.prototype.bytesPerElement=12,lr(Bt,"StructArrayLayout4ui1f12");class Yt extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,h,p){const x=this.length;return this.resize(x+1),this.emplace(x,r,l,h,p)}emplace(r,l,h,p,x){const b=4*r;return this.uint16[b+0]=l,this.uint16[b+1]=h,this.uint16[b+2]=p,this.uint16[b+3]=x,r}}Yt.prototype.bytesPerElement=8,lr(Yt,"StructArrayLayout4ui8");class Tn extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x,b){const A=this.length;return this.resize(A+1),this.emplace(A,r,l,h,p,x,b)}emplace(r,l,h,p,x,b,A){const P=6*r;return this.int16[P+0]=l,this.int16[P+1]=h,this.int16[P+2]=p,this.int16[P+3]=x,this.int16[P+4]=b,this.int16[P+5]=A,r}}Tn.prototype.bytesPerElement=12,lr(Tn,"StructArrayLayout6i12");class bn extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x,b,A,P,M,G,X,re){const de=this.length;return this.resize(de+1),this.emplace(de,r,l,h,p,x,b,A,P,M,G,X,re)}emplace(r,l,h,p,x,b,A,P,M,G,X,re,de){const ye=12*r;return this.int16[ye+0]=l,this.int16[ye+1]=h,this.int16[ye+2]=p,this.int16[ye+3]=x,this.uint16[ye+4]=b,this.uint16[ye+5]=A,this.uint16[ye+6]=P,this.uint16[ye+7]=M,this.int16[ye+8]=G,this.int16[ye+9]=X,this.int16[ye+10]=re,this.int16[ye+11]=de,r}}bn.prototype.bytesPerElement=24,lr(bn,"StructArrayLayout4i4ui4i24");class Rn extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x,b){const A=this.length;return this.resize(A+1),this.emplace(A,r,l,h,p,x,b)}emplace(r,l,h,p,x,b,A){const P=10*r,M=5*r;return this.int16[P+0]=l,this.int16[P+1]=h,this.int16[P+2]=p,this.float32[M+2]=x,this.float32[M+3]=b,this.float32[M+4]=A,r}}Rn.prototype.bytesPerElement=20,lr(Rn,"StructArrayLayout3i3f20");class hr extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.uint32[1*r+0]=l,r}}hr.prototype.bytesPerElement=4,lr(hr,"StructArrayLayout1ul4");class mr extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x,b,A,P,M,G,X,re,de){const ye=this.length;return this.resize(ye+1),this.emplace(ye,r,l,h,p,x,b,A,P,M,G,X,re,de)}emplace(r,l,h,p,x,b,A,P,M,G,X,re,de,ye){const Se=20*r,We=10*r;return this.int16[Se+0]=l,this.int16[Se+1]=h,this.int16[Se+2]=p,this.int16[Se+3]=x,this.int16[Se+4]=b,this.float32[We+3]=A,this.float32[We+4]=P,this.float32[We+5]=M,this.float32[We+6]=G,this.int16[Se+14]=X,this.uint32[We+8]=re,this.uint16[Se+18]=de,this.uint16[Se+19]=ye,r}}mr.prototype.bytesPerElement=40,lr(mr,"StructArrayLayout5i4f1i1ul2ui40");class sr extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x,b,A){const P=this.length;return this.resize(P+1),this.emplace(P,r,l,h,p,x,b,A)}emplace(r,l,h,p,x,b,A,P){const M=8*r;return this.int16[M+0]=l,this.int16[M+1]=h,this.int16[M+2]=p,this.int16[M+4]=x,this.int16[M+5]=b,this.int16[M+6]=A,this.int16[M+7]=P,r}}sr.prototype.bytesPerElement=16,lr(sr,"StructArrayLayout3i2i2i16");class dr extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x){const b=this.length;return this.resize(b+1),this.emplace(b,r,l,h,p,x)}emplace(r,l,h,p,x,b){const A=4*r,P=8*r;return this.float32[A+0]=l,this.float32[A+1]=h,this.float32[A+2]=p,this.int16[P+6]=x,this.int16[P+7]=b,r}}dr.prototype.bytesPerElement=16,lr(dr,"StructArrayLayout2f1f2i16");class oi extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,p){const x=this.length;return this.resize(x+1),this.emplace(x,r,l,h,p)}emplace(r,l,h,p,x){const b=12*r,A=3*r;return this.uint8[b+0]=l,this.uint8[b+1]=h,this.float32[A+1]=p,this.float32[A+2]=x,r}}oi.prototype.bytesPerElement=12,lr(oi,"StructArrayLayout2ub2f12");class di extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,r,l,h)}emplace(r,l,h,p){const x=3*r;return this.float32[x+0]=l,this.float32[x+1]=h,this.float32[x+2]=p,r}}di.prototype.bytesPerElement=12,lr(di,"StructArrayLayout3f12");class _r extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,r,l,h)}emplace(r,l,h,p){const x=3*r;return this.uint16[x+0]=l,this.uint16[x+1]=h,this.uint16[x+2]=p,r}}_r.prototype.bytesPerElement=6,lr(_r,"StructArrayLayout3ui6");class Zr extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x,b,A,P,M,G,X,re,de,ye,Se,We,at,xt,ct,vt,It){const Tt=this.length;return this.resize(Tt+1),this.emplace(Tt,r,l,h,p,x,b,A,P,M,G,X,re,de,ye,Se,We,at,xt,ct,vt,It)}emplace(r,l,h,p,x,b,A,P,M,G,X,re,de,ye,Se,We,at,xt,ct,vt,It,Tt){const sn=30*r,nn=15*r,Sn=60*r;return this.int16[sn+0]=l,this.int16[sn+1]=h,this.int16[sn+2]=p,this.float32[nn+2]=x,this.float32[nn+3]=b,this.uint16[sn+8]=A,this.uint16[sn+9]=P,this.uint32[nn+5]=M,this.uint32[nn+6]=G,this.uint32[nn+7]=X,this.uint16[sn+16]=re,this.uint16[sn+17]=de,this.uint16[sn+18]=ye,this.float32[nn+10]=Se,this.float32[nn+11]=We,this.uint8[Sn+48]=at,this.uint8[Sn+49]=xt,this.uint8[Sn+50]=ct,this.uint32[nn+13]=vt,this.int16[sn+28]=It,this.uint8[Sn+58]=Tt,r}}Zr.prototype.bytesPerElement=60,lr(Zr,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Pi extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x,b,A,P,M,G,X,re,de,ye,Se,We,at,xt,ct,vt,It,Tt,sn,nn,Sn,qn,dn,Pn,kn,zn){const Xn=this.length;return this.resize(Xn+1),this.emplace(Xn,r,l,h,p,x,b,A,P,M,G,X,re,de,ye,Se,We,at,xt,ct,vt,It,Tt,sn,nn,Sn,qn,dn,Pn,kn,zn)}emplace(r,l,h,p,x,b,A,P,M,G,X,re,de,ye,Se,We,at,xt,ct,vt,It,Tt,sn,nn,Sn,qn,dn,Pn,kn,zn,Xn){const wn=38*r,pr=19*r;return this.int16[wn+0]=l,this.int16[wn+1]=h,this.int16[wn+2]=p,this.float32[pr+2]=x,this.float32[pr+3]=b,this.int16[wn+8]=A,this.int16[wn+9]=P,this.int16[wn+10]=M,this.int16[wn+11]=G,this.int16[wn+12]=X,this.int16[wn+13]=re,this.uint16[wn+14]=de,this.uint16[wn+15]=ye,this.uint16[wn+16]=Se,this.uint16[wn+17]=We,this.uint16[wn+18]=at,this.uint16[wn+19]=xt,this.uint16[wn+20]=ct,this.uint16[wn+21]=vt,this.uint16[wn+22]=It,this.uint16[wn+23]=Tt,this.uint16[wn+24]=sn,this.uint16[wn+25]=nn,this.uint16[wn+26]=Sn,this.uint16[wn+27]=qn,this.uint16[wn+28]=dn,this.uint32[pr+15]=Pn,this.float32[pr+16]=kn,this.float32[pr+17]=zn,this.float32[pr+18]=Xn,r}}Pi.prototype.bytesPerElement=76,lr(Pi,"StructArrayLayout3i2f6i15ui1ul3f76");class io extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.float32[1*r+0]=l,r}}io.prototype.bytesPerElement=4,lr(io,"StructArrayLayout1f4");class oo extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x){const b=this.length;return this.resize(b+1),this.emplace(b,r,l,h,p,x)}emplace(r,l,h,p,x,b){const A=5*r;return this.float32[A+0]=l,this.float32[A+1]=h,this.float32[A+2]=p,this.float32[A+3]=x,this.float32[A+4]=b,r}}oo.prototype.bytesPerElement=20,lr(oo,"StructArrayLayout5f20");class ua extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,h,p){const x=this.length;return this.resize(x+1),this.emplace(x,r,l,h,p)}emplace(r,l,h,p,x){const b=6*r;return this.uint32[3*r+0]=l,this.uint16[b+2]=h,this.uint16[b+3]=p,this.uint16[b+4]=x,r}}ua.prototype.bytesPerElement=12,lr(ua,"StructArrayLayout1ul3ui12");class us extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l){const h=this.length;return this.resize(h+1),this.emplace(h,r,l)}emplace(r,l,h){const p=2*r;return this.uint16[p+0]=l,this.uint16[p+1]=h,r}}us.prototype.bytesPerElement=4,lr(us,"StructArrayLayout2ui4");class uc extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.uint16[1*r+0]=l,r}}uc.prototype.bytesPerElement=2,lr(uc,"StructArrayLayout1ui2");class Pc extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l){const h=this.length;return this.resize(h+1),this.emplace(h,r,l)}emplace(r,l,h){const p=2*r;return this.float32[p+0]=l,this.float32[p+1]=h,r}}Pc.prototype.bytesPerElement=8,lr(Pc,"StructArrayLayout2f8");class Ci extends _t{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ci.prototype.size=40;class Qi extends mr{get(r){return new Ci(this,r)}}lr(Qi,"CollisionBoxArray");class bo extends _t{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}bo.prototype.size=60;class Ts extends Zr{get(r){return new bo(this,r)}}lr(Ts,"PlacedSymbolArray");class Va extends _t{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(r){this._structArray.uint32[this._pos4+15]=r}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Va.prototype.size=76;class ts extends Pi{get(r){return new Va(this,r)}}lr(ts,"SymbolInstanceArray");class ps extends io{getoffsetX(r){return this.float32[1*r+0]}}lr(ps,"GlyphOffsetArray");class hs extends _n{getx(r){return this.int16[2*r+0]}gety(r){return this.int16[2*r+1]}}lr(hs,"SymbolLineVertexArray");class bs extends _t{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}bs.prototype.size=12;class zo extends ua{get(r){return new bs(this,r)}}lr(zo,"FeatureIndexArray");class ql extends us{geta_centroid_pos0(r){return this.uint16[2*r+0]}geta_centroid_pos1(r){return this.uint16[2*r+1]}}lr(ql,"FillExtrusionCentroidArray");const Il=kt([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Gc=kt([{name:"a_dash",components:4,type:"Uint16"}]);var _d={exports:{}},Xs={exports:{}};Xs.exports=function(s,r){var l,h,p,x,b,A,P,M;for(h=s.length-(l=3&s.length),p=r,b=3432918353,A=461845907,M=0;M<h;)P=255&s.charCodeAt(M)|(255&s.charCodeAt(++M))<<8|(255&s.charCodeAt(++M))<<16|(255&s.charCodeAt(++M))<<24,++M,p=27492+(65535&(x=5*(65535&(p=(p^=P=(65535&(P=(P=(65535&P)*b+(((P>>>16)*b&65535)<<16)&4294967295)<<15|P>>>17))*A+(((P>>>16)*A&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(P=0,l){case 3:P^=(255&s.charCodeAt(M+2))<<16;case 2:P^=(255&s.charCodeAt(M+1))<<8;case 1:p^=P=(65535&(P=(P=(65535&(P^=255&s.charCodeAt(M)))*b+(((P>>>16)*b&65535)<<16)&4294967295)<<15|P>>>17))*A+(((P>>>16)*A&65535)<<16)&4294967295}return p^=s.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0};var jh=Xs.exports,vd={exports:{}};vd.exports=function(s,r){for(var l,h=s.length,p=r^h,x=0;h>=4;)l=1540483477*(65535&(l=255&s.charCodeAt(x)|(255&s.charCodeAt(++x))<<8|(255&s.charCodeAt(++x))<<16|(255&s.charCodeAt(++x))<<24))+((1540483477*(l>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),h-=4,++x;switch(h){case 3:p^=(255&s.charCodeAt(x+2))<<16;case 2:p^=(255&s.charCodeAt(x+1))<<8;case 1:p=1540483477*(65535&(p^=255&s.charCodeAt(x)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0};var Bu=jh,au=vd.exports;_d.exports=Bu,_d.exports.murmur3=Bu,_d.exports.murmur2=au;var hc=ue(_d.exports);class Uh{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,l,h,p){this.ids.push(Eh(r)),this.positions.push(l,h,p)}getPositions(r){const l=Eh(r);let h=0,p=this.ids.length-1;for(;h<p;){const b=h+p>>1;this.ids[b]>=l?p=b:h=b+1}const x=[];for(;this.ids[h]===l;)x.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return x}static serialize(r,l){const h=new Float64Array(r.ids),p=new Uint32Array(r.positions);return dc(h,p,0,h.length-1),l&&l.push(h.buffer,p.buffer),{ids:h,positions:p}}static deserialize(r){const l=new Uh;return l.ids=r.ids,l.positions=r.positions,l.indexed=!0,l}}function Eh(s){const r=+s;return!isNaN(r)&&Number.MIN_SAFE_INTEGER<=r&&r<=Number.MAX_SAFE_INTEGER?r:hc(String(s))}function dc(s,r,l,h){for(;l<h;){const p=s[l+h>>1];let x=l-1,b=h+1;for(;;){do x++;while(s[x]<p);do b--;while(s[b]>p);if(x>=b)break;ed(s,x,b),ed(r,3*x,3*b),ed(r,3*x+1,3*b+1),ed(r,3*x+2,3*b+2)}b-l<h-b?(dc(s,r,l,b),l=b+1):(dc(s,r,b+1,h),h=b)}}function ed(s,r,l){const h=s[r];s[r]=s[l],s[l]=h}lr(Uh,"FeaturePositionMap");class lu{constructor(r){this.gl=r.gl,this.initialized=!1}fetchUniformLocation(r,l){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(r,l),this.initialized=!0),!!this.location}}class Ah extends lu{constructor(r){super(r),this.current=0}set(r,l,h){this.fetchUniformLocation(r,l)&&this.current!==h&&(this.current=h,this.gl.uniform1f(this.location,h))}}class lf extends lu{constructor(r){super(r),this.current=[0,0,0,0]}set(r,l,h){this.fetchUniformLocation(r,l)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]&&h[3]===this.current[3]||(this.current=h,this.gl.uniform4f(this.location,h[0],h[1],h[2],h[3])))}}class td extends lu{constructor(r){super(r),this.current=Eo.transparent}set(r,l,h){this.fetchUniformLocation(r,l)&&(h.r===this.current.r&&h.g===this.current.g&&h.b===this.current.b&&h.a===this.current.a||(this.current=h,this.gl.uniform4f(this.location,h.r,h.g,h.b,h.a)))}}const xd=new Float32Array(16),nd=new Float32Array(9),rh=new Float32Array(4);function kc(s){return[bt(255*s.r,255*s.g),bt(255*s.b,255*s.a)]}class cu{constructor(r,l,h){this.value=r,this.uniformNames=l.map((p=>`u_${p}`)),this.type=h}setUniform(r,l,h,p,x){l.set(r,x,p.constantOr(this.value))}getBinding(r,l){return this.type==="color"?new td(r):new Ah(r)}}class fc{constructor(r,l){this.uniformNames=l.map((h=>`u_${h}`)),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(r){this.pixelRatio=r.pixelRatio||1,this.pattern=r.tl.concat(r.br)}setUniform(r,l,h,p,x){const b=x==="u_pattern"||x==="u_dash"?this.pattern:x==="u_pixel_ratio"?this.pixelRatio:null;b&&l.set(r,x,b)}getBinding(r,l){return l==="u_pattern"||l==="u_dash"?new lf(r):new Ah(r)}}class pc{constructor(r,l,h,p){this.expression=r,this.type=h,this.maxValue=0,this.paintVertexAttributes=l.map((x=>({name:`a_${x}`,type:"Float32",components:h==="color"?2:1,offset:0}))),this.paintVertexArray=new p}populatePaintArray(r,l,h,p,x,b){const A=this.paintVertexArray.length,P=this.expression.evaluate(new $(0),l,{},x,p,b);this.paintVertexArray.resize(r),this._setPaintValue(A,r,P)}updatePaintArray(r,l,h,p,x){const b=this.expression.evaluate({zoom:0},h,p,void 0,x);this._setPaintValue(r,l,b)}_setPaintValue(r,l,h){if(this.type==="color"){const p=kc(h);for(let x=r;x<l;x++)this.paintVertexArray.emplace(x,p[0],p[1])}else{for(let p=r;p<l;p++)this.paintVertexArray.emplace(p,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Mc{constructor(r,l,h,p,x,b){this.expression=r,this.uniformNames=l.map((A=>`u_${A}_t`)),this.type=h,this.useIntegerZoom=p,this.zoom=x,this.maxValue=0,this.paintVertexAttributes=l.map((A=>({name:`a_${A}`,type:"Float32",components:h==="color"?4:2,offset:0}))),this.paintVertexArray=new b}populatePaintArray(r,l,h,p,x,b){const A=this.expression.evaluate(new $(this.zoom),l,{},x,p,b),P=this.expression.evaluate(new $(this.zoom+1),l,{},x,p,b),M=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(M,r,A,P)}updatePaintArray(r,l,h,p,x){const b=this.expression.evaluate({zoom:this.zoom},h,p,void 0,x),A=this.expression.evaluate({zoom:this.zoom+1},h,p,void 0,x);this._setPaintValue(r,l,b,A)}_setPaintValue(r,l,h,p){if(this.type==="color"){const x=kc(h),b=kc(p);for(let A=r;A<l;A++)this.paintVertexArray.emplace(A,x[0],x[1],b[0],b[1])}else{for(let x=r;x<l;x++)this.paintVertexArray.emplace(x,h,p);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(p))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,l,h,p,x){const b=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,A=De(this.expression.interpolationFactor(b,this.zoom,this.zoom+1),0,1);l.set(r,x,A)}getBinding(r,l){return new Ah(r)}}class zu{constructor(r,l,h,p,x){this.expression=r,this.layerId=x,this.paintVertexAttributes=(h==="array"?Gc:Il).members;for(let b=0;b<l.length;++b);this.paintVertexArray=new p}populatePaintArray(r,l,h){const p=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValues(p,r,l.patterns&&l.patterns[this.layerId],h)}updatePaintArray(r,l,h,p,x,b){this._setPaintValues(r,l,h.patterns&&h.patterns[this.layerId],b)}_setPaintValues(r,l,h,p){if(!p||!h)return;const x=p[h];if(!x)return;const{tl:b,br:A,pixelRatio:P}=x;for(let M=r;M<l;M++)this.paintVertexArray.emplace(M,b[0],b[1],A[0],A[1],P)}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Th{constructor(r,l,h=(()=>!0)){this.binders={},this._buffers=[];const p=[];for(const x in r.paint._values){if(!h(x))continue;const b=r.paint.get(x);if(!(b instanceof Ue&&jr(b.property.specification)))continue;const A=_g(x,r.type),P=b.value,M=b.property.specification.type,G=!!b.property.useIntegerZoom,X=x==="line-dasharray"||x.endsWith("pattern"),re=x==="line-dasharray"&&r.layout.get("line-cap").value.kind!=="constant";if(P.kind!=="constant"||re)if(P.kind==="source"||re||X){const de=zd(x,M,"source");this.binders[x]=X?new zu(P,A,M,de,r.id):new pc(P,A,M,de),p.push(`/a_${x}`)}else{const de=zd(x,M,"composite");this.binders[x]=new Mc(P,A,M,G,l,de),p.push(`/z_${x}`)}else this.binders[x]=X?new fc(P.value,A):new cu(P.value,A,M),p.push(`/u_${x}`)}this.cacheKey=p.sort().join("")}getMaxValue(r){const l=this.binders[r];return l instanceof pc||l instanceof Mc?l.maxValue:0}populatePaintArrays(r,l,h,p,x,b){for(const A in this.binders){const P=this.binders[A];(P instanceof pc||P instanceof Mc||P instanceof zu)&&P.populatePaintArray(r,l,h,p,x,b)}}setConstantPatternPositions(r){for(const l in this.binders){const h=this.binders[l];h instanceof fc&&h.setConstantPatternPositions(r)}}updatePaintArrays(r,l,h,p,x,b){let A=!1;for(const P in r){const M=l.getPositions(P);for(const G of M){const X=h.feature(G.index);for(const re in this.binders){const de=this.binders[re];if((de instanceof pc||de instanceof Mc||de instanceof zu)&&de.expression.isStateDependent===!0){const ye=p.paint.get(re);de.expression=ye.value,de.updatePaintArray(G.start,G.end,X,r[P],x,b),A=!0}}}}return A}defines(){const r=[];for(const l in this.binders){const h=this.binders[l];(h instanceof cu||h instanceof fc)&&r.push(...h.uniformNames.map((p=>`#define HAS_UNIFORM_${p}`)))}return r}getBinderAttributes(){const r=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof pc||h instanceof Mc||h instanceof zu)for(let p=0;p<h.paintVertexAttributes.length;p++)r.push(h.paintVertexAttributes[p].name)}return r}getBinderUniforms(){const r=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof cu||h instanceof fc||h instanceof Mc)for(const p of h.uniformNames)r.push(p)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r){const l=[];for(const h in this.binders){const p=this.binders[h];if(p instanceof cu||p instanceof fc||p instanceof Mc)for(const x of p.uniformNames)l.push({name:x,property:h,binding:p.getBinding(r,x)})}return l}setUniforms(r,l,h,p,x){for(const{name:b,property:A,binding:P}of h)this.binders[A].setUniform(r,P,x,p.get(A),b)}updatePaintBuffers(){this._buffers=[];for(const r in this.binders){const l=this.binders[r];(l instanceof pc||l instanceof Mc||l instanceof zu)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(r){for(const l in this.binders){const h=this.binders[l];(h instanceof pc||h instanceof Mc||h instanceof zu)&&h.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const l=this.binders[r];(l instanceof pc||l instanceof Mc||l instanceof zu)&&l.destroy()}}}class ju{constructor(r,l,h=(()=>!0)){this.programConfigurations={};for(const p of r)this.programConfigurations[p.id]=new Th(p,l,h);this.needsUpload=!1,this._featureMap=new Uh,this._bufferOffset=0}populatePaintArrays(r,l,h,p,x,b,A){for(const P in this.programConfigurations)this.programConfigurations[P].populatePaintArrays(r,l,p,x,b,A);l.id!==void 0&&this._featureMap.add(l.id,h,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,l,h,p,x){for(const b of h)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(r,this._featureMap,l,b,p,x)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const cf={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function _g(s,r){return cf[s]||[s.replace(`${r}-`,"").replace(/-/g,"_")]}const xm={"line-pattern":{source:Bt,composite:Bt},"fill-pattern":{source:Bt,composite:Bt},"fill-extrusion-pattern":{source:Bt,composite:Bt},"line-dasharray":{source:Yt,composite:Yt}},vg={color:{source:Pc,composite:In},number:{source:io,composite:Pc}};function zd(s,r,l){const h=xm[s];return h&&h[l]||vg[r][l]}lr(cu,"ConstantBinder"),lr(fc,"PatternConstantBinder"),lr(pc,"SourceExpressionBinder"),lr(zu,"PatternCompositeBinder"),lr(Mc,"CompositeExpressionBinder"),lr(Th,"ProgramConfiguration",{omit:["_buffers"]}),lr(ju,"ProgramConfigurationSet");const kp="-transition";class ih extends ra{constructor(r,l){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,r.type!=="custom"&&(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&r.type!=="sky"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),l.layout&&(this._unevaluatedLayout=new Ze(l.layout)),l.paint)){this._transitionablePaint=new ge(l.paint);for(const h in r.paint)this.setPaintProperty(h,r.paint[h],{validate:!1});for(const h in r.layout)this.setLayoutProperty(h,r.layout[h],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Xe(l.paint)}}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,l,h={}){l!=null&&this._validate(qc,`layers.${this.id}.layout.${r}`,r,l,h)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,l):this.visibility=l)}getPaintProperty(r){return ln(r,kp)?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)}setPaintProperty(r,l,h={}){if(l!=null&&this._validate(yl,`layers.${this.id}.paint.${r}`,r,l,h))return!1;if(ln(r,kp))return this._transitionablePaint.setTransition(r.slice(0,-11),l||void 0),!1;{const p=this._transitionablePaint._values[r],x=p.value.isDataDriven(),b=p.value;this._transitionablePaint.setValue(r,l),this._handleSpecialPaintPropertyUpdate(r);const A=this._transitionablePaint._values[r].value,P=A.isDataDriven(),M=ln(r,"pattern")||r==="line-dasharray";return P||x||M||this._handleOverridablePaintPropertyUpdate(r,b,A)}}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getProgramConfiguration(r){return null}_handleOverridablePaintPropertyUpdate(r,l,h){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,l){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,l)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),Mn(r,((l,h)=>!(l===void 0||h==="layout"&&!Object.keys(l).length||h==="paint"&&!Object.keys(l).length)))}_validate(r,l,h,p,x={}){return(!x||x.validate!==!1)&&_l(this,r.call(Ua,{key:l,layerType:this.type,objectKey:h,value:p,styleSpec:pn,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const l=this.paint.get(r);if(l instanceof Ue&&jr(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=th(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const bm=kt([{name:"a_pos",components:2,type:"Int16"}],4),V0=kt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class qa{constructor(r=[]){this.segments=r}prepareSegment(r,l,h,p){let x=this.segments[this.segments.length-1];return r>qa.MAX_VERTEX_ARRAY_LENGTH&&fr(`Max vertices per segment is ${qa.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!x||x.vertexLength+r>qa.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==p)&&(x={vertexOffset:l.length,primitiveOffset:h.length,vertexLength:0,primitiveLength:0},p!==void 0&&(x.sortKey=p),this.segments.push(x)),x}get(){return this.segments}destroy(){for(const r of this.segments)for(const l in r.vaos)r.vaos[l].destroy()}static simpleSegment(r,l,h,p){return new qa([{vertexOffset:r,primitiveOffset:l,vertexLength:h,primitiveLength:p,vaos:{},sortKey:0}])}}qa.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,lr(qa,"SegmentVector");var Wr=8192;class rd{constructor(r,l){r&&(l?this.setSouthWest(r).setNorthEast(l):r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof ti?new ti(r.lng,r.lat):ti.convert(r),this}setSouthWest(r){return this._sw=r instanceof ti?new ti(r.lng,r.lat):ti.convert(r),this}extend(r){const l=this._sw,h=this._ne;let p,x;if(r instanceof ti)p=r,x=r;else{if(!(r instanceof rd))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(rd.convert(r)):this.extend(ti.convert(r)):typeof r=="object"&&r!==null&&r.hasOwnProperty("lat")&&(r.hasOwnProperty("lon")||r.hasOwnProperty("lng"))?this.extend(ti.convert(r)):this;if(p=r._sw,x=r._ne,!p||!x)return this}return l||h?(l.lng=Math.min(p.lng,l.lng),l.lat=Math.min(p.lat,l.lat),h.lng=Math.max(x.lng,h.lng),h.lat=Math.max(x.lat,h.lat)):(this._sw=new ti(p.lng,p.lat),this._ne=new ti(x.lng,x.lat)),this}getCenter(){return new ti((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ti(this.getWest(),this.getNorth())}getSouthEast(){return new ti(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:l,lat:h}=ti.convert(r);let p=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&p}static convert(r){return!r||r instanceof rd?r:new rd(r)}}var uf=1e-6,il=typeof Float32Array<"u"?Float32Array:Array;function Mp(){var s=new il(9);return il!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s}function bd(s,r,l){var h=r[0],p=r[1],x=r[2],b=r[3],A=r[4],P=r[5],M=r[6],G=r[7],X=r[8],re=l[0],de=l[1],ye=l[2],Se=l[3],We=l[4],at=l[5],xt=l[6],ct=l[7],vt=l[8];return s[0]=re*h+de*b+ye*M,s[1]=re*p+de*A+ye*G,s[2]=re*x+de*P+ye*X,s[3]=Se*h+We*b+at*M,s[4]=Se*p+We*A+at*G,s[5]=Se*x+We*P+at*X,s[6]=xt*h+ct*b+vt*M,s[7]=xt*p+ct*A+vt*G,s[8]=xt*x+ct*P+vt*X,s}function Rc(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function wu(s,r){var l=r[0],h=r[1],p=r[2],x=r[3],b=r[4],A=r[5],P=r[6],M=r[7],G=r[8],X=r[9],re=r[10],de=r[11],ye=r[12],Se=r[13],We=r[14],at=r[15],xt=l*A-h*b,ct=l*P-p*b,vt=l*M-x*b,It=h*P-p*A,Tt=h*M-x*A,sn=p*M-x*P,nn=G*Se-X*ye,Sn=G*We-re*ye,qn=G*at-de*ye,dn=X*We-re*Se,Pn=X*at-de*Se,kn=re*at-de*We,zn=xt*kn-ct*Pn+vt*dn+It*qn-Tt*Sn+sn*nn;return zn?(s[0]=(A*kn-P*Pn+M*dn)*(zn=1/zn),s[1]=(p*Pn-h*kn-x*dn)*zn,s[2]=(Se*sn-We*Tt+at*It)*zn,s[3]=(re*Tt-X*sn-de*It)*zn,s[4]=(P*qn-b*kn-M*Sn)*zn,s[5]=(l*kn-p*qn+x*Sn)*zn,s[6]=(We*vt-ye*sn-at*ct)*zn,s[7]=(G*sn-re*vt+de*ct)*zn,s[8]=(b*Pn-A*qn+M*nn)*zn,s[9]=(h*qn-l*Pn-x*nn)*zn,s[10]=(ye*Tt-Se*vt+at*xt)*zn,s[11]=(X*vt-G*Tt-de*xt)*zn,s[12]=(A*Sn-b*dn-P*nn)*zn,s[13]=(l*dn-h*Sn+p*nn)*zn,s[14]=(Se*ct-ye*It-We*xt)*zn,s[15]=(G*It-X*ct+re*xt)*zn,s):null}function id(s,r,l){var h=r[0],p=r[1],x=r[2],b=r[3],A=r[4],P=r[5],M=r[6],G=r[7],X=r[8],re=r[9],de=r[10],ye=r[11],Se=r[12],We=r[13],at=r[14],xt=r[15],ct=l[0],vt=l[1],It=l[2],Tt=l[3];return s[0]=ct*h+vt*A+It*X+Tt*Se,s[1]=ct*p+vt*P+It*re+Tt*We,s[2]=ct*x+vt*M+It*de+Tt*at,s[3]=ct*b+vt*G+It*ye+Tt*xt,s[4]=(ct=l[4])*h+(vt=l[5])*A+(It=l[6])*X+(Tt=l[7])*Se,s[5]=ct*p+vt*P+It*re+Tt*We,s[6]=ct*x+vt*M+It*de+Tt*at,s[7]=ct*b+vt*G+It*ye+Tt*xt,s[8]=(ct=l[8])*h+(vt=l[9])*A+(It=l[10])*X+(Tt=l[11])*Se,s[9]=ct*p+vt*P+It*re+Tt*We,s[10]=ct*x+vt*M+It*de+Tt*at,s[11]=ct*b+vt*G+It*ye+Tt*xt,s[12]=(ct=l[12])*h+(vt=l[13])*A+(It=l[14])*X+(Tt=l[15])*Se,s[13]=ct*p+vt*P+It*re+Tt*We,s[14]=ct*x+vt*M+It*de+Tt*at,s[15]=ct*b+vt*G+It*ye+Tt*xt,s}function wd(s,r,l){var h,p,x,b,A,P,M,G,X,re,de,ye,Se=l[0],We=l[1],at=l[2];return r===s?(s[12]=r[0]*Se+r[4]*We+r[8]*at+r[12],s[13]=r[1]*Se+r[5]*We+r[9]*at+r[13],s[14]=r[2]*Se+r[6]*We+r[10]*at+r[14],s[15]=r[3]*Se+r[7]*We+r[11]*at+r[15]):(p=r[1],x=r[2],b=r[3],A=r[4],P=r[5],M=r[6],G=r[7],X=r[8],re=r[9],de=r[10],ye=r[11],s[0]=h=r[0],s[1]=p,s[2]=x,s[3]=b,s[4]=A,s[5]=P,s[6]=M,s[7]=G,s[8]=X,s[9]=re,s[10]=de,s[11]=ye,s[12]=h*Se+A*We+X*at+r[12],s[13]=p*Se+P*We+re*at+r[13],s[14]=x*Se+M*We+de*at+r[14],s[15]=b*Se+G*We+ye*at+r[15]),s}function od(s,r,l){var h=l[0],p=l[1],x=l[2];return s[0]=r[0]*h,s[1]=r[1]*h,s[2]=r[2]*h,s[3]=r[3]*h,s[4]=r[4]*p,s[5]=r[5]*p,s[6]=r[6]*p,s[7]=r[7]*p,s[8]=r[8]*x,s[9]=r[9]*x,s[10]=r[10]*x,s[11]=r[11]*x,s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15],s}function Rp(s,r,l){var h=Math.sin(l),p=Math.cos(l),x=r[4],b=r[5],A=r[6],P=r[7],M=r[8],G=r[9],X=r[10],re=r[11];return r!==s&&(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[4]=x*p+M*h,s[5]=b*p+G*h,s[6]=A*p+X*h,s[7]=P*p+re*h,s[8]=M*p-x*h,s[9]=G*p-b*h,s[10]=X*p-A*h,s[11]=re*p-P*h,s}function Yf(s,r,l){var h=Math.sin(l),p=Math.cos(l),x=r[0],b=r[1],A=r[2],P=r[3],M=r[8],G=r[9],X=r[10],re=r[11];return r!==s&&(s[4]=r[4],s[5]=r[5],s[6]=r[6],s[7]=r[7],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[0]=x*p-M*h,s[1]=b*p-G*h,s[2]=A*p-X*h,s[3]=P*p-re*h,s[8]=x*h+M*p,s[9]=b*h+G*p,s[10]=A*h+X*p,s[11]=P*h+re*p,s}function Np(s,r){return s[0]=r[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=r[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=r[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Ih(s,r,l){var h,p,x,b=l[0],A=l[1],P=l[2],M=Math.hypot(b,A,P);return M<uf?null:(b*=M=1/M,A*=M,P*=M,h=Math.sin(r),p=Math.cos(r),s[0]=b*b*(x=1-p)+p,s[1]=A*b*x+P*h,s[2]=P*b*x-A*h,s[3]=0,s[4]=b*A*x-P*h,s[5]=A*A*x+p,s[6]=P*A*x+b*h,s[7]=0,s[8]=b*P*x+A*h,s[9]=A*P*x-b*h,s[10]=P*P*x+p,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s)}Math.hypot||(Math.hypot=function(){for(var s=0,r=arguments.length;r--;)s+=arguments[r]*arguments[r];return Math.sqrt(s)});var Dp=id;function hf(){var s=new il(3);return il!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function xg(s){var r=new il(3);return r[0]=s[0],r[1]=s[1],r[2]=s[2],r}function df(s){return Math.hypot(s[0],s[1],s[2])}function O(s,r,l){var h=new il(3);return h[0]=s,h[1]=r,h[2]=l,h}function he(s,r,l){return s[0]=r[0]+l[0],s[1]=r[1]+l[1],s[2]=r[2]+l[2],s}function Ie(s,r,l){return s[0]=r[0]-l[0],s[1]=r[1]-l[1],s[2]=r[2]-l[2],s}function qe(s,r,l){return s[0]=r[0]*l[0],s[1]=r[1]*l[1],s[2]=r[2]*l[2],s}function Qe(s,r,l){return s[0]=Math.min(r[0],l[0]),s[1]=Math.min(r[1],l[1]),s[2]=Math.min(r[2],l[2]),s}function Fe(s,r,l){return s[0]=Math.max(r[0],l[0]),s[1]=Math.max(r[1],l[1]),s[2]=Math.max(r[2],l[2]),s}function $e(s,r,l){return s[0]=r[0]*l,s[1]=r[1]*l,s[2]=r[2]*l,s}function St(s,r,l,h){return s[0]=r[0]+l[0]*h,s[1]=r[1]+l[1]*h,s[2]=r[2]+l[2]*h,s}function Mt(s,r){var l=r[0],h=r[1],p=r[2],x=l*l+h*h+p*p;return x>0&&(x=1/Math.sqrt(x)),s[0]=r[0]*x,s[1]=r[1]*x,s[2]=r[2]*x,s}function gt(s,r){return s[0]*r[0]+s[1]*r[1]+s[2]*r[2]}function Zt(s,r,l){var h=r[0],p=r[1],x=r[2],b=l[0],A=l[1],P=l[2];return s[0]=p*P-x*A,s[1]=x*b-h*P,s[2]=h*A-p*b,s}function Kt(s,r,l){var h=r[0],p=r[1],x=r[2],b=l[3]*h+l[7]*p+l[11]*x+l[15];return s[0]=(l[0]*h+l[4]*p+l[8]*x+l[12])/(b=b||1),s[1]=(l[1]*h+l[5]*p+l[9]*x+l[13])/b,s[2]=(l[2]*h+l[6]*p+l[10]*x+l[14])/b,s}function gn(s,r,l){var h=l[0],p=l[1],x=l[2],b=r[0],A=r[1],P=r[2],M=p*P-x*A,G=x*b-h*P,X=h*A-p*b,re=p*X-x*G,de=x*M-h*X,ye=h*G-p*M,Se=2*l[3];return G*=Se,X*=Se,de*=2,ye*=2,s[0]=b+(M*=Se)+(re*=2),s[1]=A+G+de,s[2]=P+X+ye,s}var en,$t=Ie,un=qe,vr=df;function Pr(s,r,l){return s[0]=r[0]*l,s[1]=r[1]*l,s[2]=r[2]*l,s[3]=r[3]*l,s}function Gn(s,r){var l=r[0],h=r[1],p=r[2],x=r[3],b=l*l+h*h+p*p+x*x;return b>0&&(b=1/Math.sqrt(b)),s[0]=l*b,s[1]=h*b,s[2]=p*b,s[3]=x*b,s}function rr(s,r,l){var h=r[0],p=r[1],x=r[2],b=r[3];return s[0]=l[0]*h+l[4]*p+l[8]*x+l[12]*b,s[1]=l[1]*h+l[5]*p+l[9]*x+l[13]*b,s[2]=l[2]*h+l[6]*p+l[10]*x+l[14]*b,s[3]=l[3]*h+l[7]*p+l[11]*x+l[15]*b,s}function ni(){var s=new il(4);return il!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s[3]=1,s}function Yr(s){return s[0]=0,s[1]=0,s[2]=0,s[3]=1,s}function Jr(s,r,l){l*=.5;var h=r[0],p=r[1],x=r[2],b=r[3],A=Math.sin(l),P=Math.cos(l);return s[0]=h*P+b*A,s[1]=p*P+x*A,s[2]=x*P-p*A,s[3]=b*P-h*A,s}function Gi(s,r,l){l*=.5;var h=r[0],p=r[1],x=r[2],b=r[3],A=Math.sin(l),P=Math.cos(l);return s[0]=h*P-x*A,s[1]=p*P+b*A,s[2]=x*P+h*A,s[3]=b*P-p*A,s}hf(),en=new il(4),il!=Float32Array&&(en[0]=0,en[1]=0,en[2]=0,en[3]=0);var Or=Gn;hf(),O(1,0,0),O(0,1,0),ni(),ni(),Mp();const Ur=kt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Ui}=Ur,kr=kt([{name:"a_pos_3",components:3,type:"Int16"}]);var Kr=kt([{name:"a_pos",type:"Int16",components:2}]);class ki{constructor(r,l){this.pos=r,this.dir=l}intersectsPlane(r,l,h){const p=gt(l,this.dir);if(Math.abs(p)<1e-6)return!1;const x=((r[0]-this.pos[0])*l[0]+(r[1]-this.pos[1])*l[1]+(r[2]-this.pos[2])*l[2])/p;return h[0]=this.pos[0]+this.dir[0]*x,h[1]=this.pos[1]+this.dir[1]*x,h[2]=this.pos[2]+this.dir[2]*x,!0}closestPointOnSphere(r,l,h){if((function(de,ye){var Se=de[0],We=de[1],at=de[2],xt=ye[0],ct=ye[1],vt=ye[2];return Math.abs(Se-xt)<=uf*Math.max(1,Math.abs(Se),Math.abs(xt))&&Math.abs(We-ct)<=uf*Math.max(1,Math.abs(We),Math.abs(ct))&&Math.abs(at-vt)<=uf*Math.max(1,Math.abs(at),Math.abs(vt))})(this.pos,r)||l===0)return h[0]=h[1]=h[2]=0,!1;const[p,x,b]=this.dir,A=this.pos[0]-r[0],P=this.pos[1]-r[1],M=this.pos[2]-r[2],G=p*p+x*x+b*b,X=2*(A*p+P*x+M*b),re=X*X-4*G*(A*A+P*P+M*M-l*l);if(re<0){const de=Math.max(-X/2,0),ye=A+p*de,Se=P+x*de,We=M+b*de,at=Math.hypot(ye,Se,We);return h[0]=ye*l/at,h[1]=Se*l/at,h[2]=We*l/at,!1}{const de=(-X-Math.sqrt(re))/(2*G);if(de<0){const ye=Math.hypot(A,P,M);return h[0]=A*l/ye,h[1]=P*l/ye,h[2]=M*l/ye,!1}return h[0]=A+p*de,h[1]=P+x*de,h[2]=M+b*de,!0}}}class Vn{constructor(r,l,h,p,x){this.TL=r,this.TR=l,this.BR=h,this.BL=p,this.horizon=x}static fromInvProjectionMatrix(r,l,h){const p=[-1,1,1],x=[1,1,1],b=[1,-1,1],A=[-1,-1,1],P=Kt(p,p,r),M=Kt(x,x,r),G=Kt(b,b,r),X=Kt(A,A,r);return new Vn(P,M,G,X,l/h)}}class on{constructor(r,l){this.points=r,this.planes=l}static fromInvProjectionMatrix(r,l,h,p){const x=Math.pow(2,h),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((P=>{const M=rr([],P,r),G=1/M[3]/l*x;return(function(X,re,de){return X[0]=re[0]*de[0],X[1]=re[1]*de[1],X[2]=re[2]*de[2],X[3]=re[3]*de[3],X})(M,M,[G,G,p?1/M[3]:G,G])})),A=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((P=>{const M=Mt([],Zt([],$t([],b[P[0]],b[P[1]]),$t([],b[P[2]],b[P[1]]))),G=-gt(M,b[P[1]]);return M.concat(G)}));return new on(b,A)}}class hn{static fromPoints(r){const l=[1/0,1/0,1/0],h=[-1/0,-1/0,-1/0];for(const p of r)Qe(l,l,p),Fe(h,h,p);return new hn(l,h)}static applyTransform(r,l){const h=r.getCorners();for(let p=0;p<h.length;++p)Kt(h[p],h[p],l);return hn.fromPoints(h)}constructor(r,l){this.min=r,this.max=l,this.center=$e([],he([],this.min,this.max),.5)}quadrant(r){const l=[r%2==0,r<2],h=xg(this.min),p=xg(this.max);for(let x=0;x<l.length;x++)h[x]=l[x]?this.min[x]:this.center[x],p[x]=l[x]?this.center[x]:this.max[x];return p[2]=this.max[2],new hn(h,p)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}getCorners(){const r=this.min,l=this.max;return[[r[0],r[1],r[2]],[l[0],r[1],r[2]],[l[0],l[1],r[2]],[r[0],l[1],r[2]],[r[0],r[1],l[2]],[l[0],r[1],l[2]],[l[0],l[1],l[2]],[r[0],l[1],l[2]]]}intersects(r){const l=this.getCorners();let h=!0;for(let p=0;p<r.planes.length;p++){const x=r.planes[p];let b=0;for(let A=0;A<l.length;A++)b+=gt(x,l[A])+x[3]>=0;if(b===0)return 0;b!==l.length&&(h=!1)}if(h)return 2;for(let p=0;p<3;p++){let x=Number.MAX_VALUE,b=-Number.MAX_VALUE;for(let A=0;A<r.points.length;A++){const P=r.points[A][p]-this.min[p];x=Math.min(x,P),b=Math.max(b,P)}if(b<0||x>this.max[p]-this.min[p])return 0}return 1}}const Hn=5,tr=6,Qr=Wr/Math.PI/2,co=16383,Do=64,ei=[Do,32,16],Hi=-Qr,Bn=Qr,$a=[new hn([Hi,Hi,Hi],[Bn,Bn,Bn]),new hn([Hi,Hi,Hi],[0,0,Bn]),new hn([0,Hi,Hi],[Bn,0,Bn]),new hn([Hi,0,Hi],[0,Bn,Bn]),new hn([0,0,Hi],[Bn,Bn,Bn])];function Zs(s){return s*Qr/Lh}function mc(s,r,l,h=!0){const p=$e([],s._camera.position,s.worldSize),x=[r,l,1,1];rr(x,x,s.pixelMatrixInverse),Pr(x,x,1/x[3]);const b=Mt([],$t([],x,p)),A=s.globeMatrix,P=[A[12],A[13],A[14]],M=$t([],P,p),G=df(M),X=Mt([],M),re=s.worldSize/(2*Math.PI),de=gt(X,b),ye=Math.asin(re/G);if(ye<Math.acos(de)){if(!h)return null;const qn=[],dn=[];$e(qn,b,G/de),Mt(dn,$t(dn,qn,M)),Mt(b,he(b,M,$e(b,dn,Math.tan(ye)*G)))}const Se=[];new ki(p,b).closestPointOnSphere(P,re,Se);const We=Mt([],Ln(A,0)),at=Mt([],Ln(A,1)),xt=Mt([],Ln(A,2)),ct=gt(We,Se),vt=gt(at,Se),It=gt(xt,Se),Tt=be(Math.asin(-vt/re));let sn=be(Math.atan2(ct,It));sn=s.center.lng+(function(qn,dn){const Pn=(dn-qn+180)%360-180;return Pn<-180?Pn+360:Pn})(s.center.lng,sn);const nn=Cs(sn),Sn=De(Ys(Tt),0,1);return new pf(nn,Sn)}class ns{constructor(r,l,h){this.a=$t([],r,h),this.b=$t([],l,h),this.center=h;const p=Mt([],this.a),x=Mt([],this.b);this.angle=Math.acos(gt(p,x))}}function Wn(s,r){if(s.angle===0)return null;let l;return l=s.a[r]===0?1/s.angle*.5*Math.PI:1/s.angle*Math.atan(s.b[r]/s.a[r]/Math.sin(s.angle)-1/Math.tan(s.angle)),l<0||l>1?null:(function(h,p,x,b){const A=Math.sin(x);return h*(Math.sin((1-b)*x)/A)+p*(Math.sin(b*x)/A)})(s.a[r],s.b[r],s.angle,De(l,0,1))+s.center[r]}function ba(s){if(s.z<=1)return $a[s.z+2*s.y+s.x];const r=Vh(Nc(s));return hn.fromPoints(r)}function Hc(s,r,l){return $e(s,s,1-l),St(s,s,r,l)}function Sd(s,r){const l=hu(r.zoom);if(l===0)return ba(s);const h=Nc(s),p=Vh(h),x=Cs(h.getWest())*r.worldSize,b=Cs(h.getEast())*r.worldSize,A=Ys(h.getNorth())*r.worldSize,P=Ys(h.getSouth())*r.worldSize,M=[x,A,0],G=[b,A,0],X=[x,P,0],re=[b,P,0],de=wu([],r.globeMatrix);return Kt(M,M,de),Kt(G,G,de),Kt(X,X,de),Kt(re,re,de),p[0]=Hc(p[0],X,l),p[1]=Hc(p[1],re,l),p[2]=Hc(p[2],G,l),p[3]=Hc(p[3],M,l),hn.fromPoints(p)}function gc(s,r,l){for(const h of s)Kt(h,h,r),$e(h,h,l)}function jd(s,r,l){const h=r/s.worldSize,p=s.globeMatrix;if(l.z<=1){const nn=ba(l).getCorners();return gc(nn,p,h),hn.fromPoints(nn)}const x=Nc(l),b=Vh(x);gc(b,p,h);const A=Number.MAX_VALUE,P=[-A,-A,-A],M=[A,A,A];if(x.contains(s.center)){for(const qn of b)Qe(M,M,qn),Fe(P,P,qn);P[2]=0;const nn=s.point,Sn=[nn.x*h,nn.y*h,0];return Qe(M,M,Sn),Fe(P,P,Sn),new hn(M,P)}const G=[p[12]*h,p[13]*h,p[14]*h],X=x.getCenter(),re=De(s.center.lat,-Ra,Ra),de=De(X.lat,-Ra,Ra),ye=Cs(s.center.lng),Se=Ys(re);let We=ye-Cs(X.lng);const at=Se-Ys(de);We>.5?We-=1:We<-.5&&(We+=1);let xt=0;Math.abs(We)>Math.abs(at)?xt=We>=0?1:3:(xt=at>=0?0:2,St(G,G,[p[4]*h,p[5]*h,p[6]*h],-Math.sin(Z(at>=0?x.getSouth():x.getNorth()))*Qr));const ct=b[xt],vt=b[(xt+1)%4],It=new ns(ct,vt,G),Tt=[Wn(It,0)||ct[0],Wn(It,1)||ct[1],Wn(It,2)||ct[2]],sn=hu(s.zoom);if(sn>0){const nn=(function({x:qn,y:dn,z:Pn},kn,zn,Xn,wn){const pr=1/(1<<Pn);let Br=qn*pr,yr=Br+pr,Wi=dn*pr,Zn=Wi+pr,ri=0;const Ki=(Br+yr)/2-Xn;return Ki>.5?ri=-1:Ki<-.5&&(ri=1),Br=((Br+ri)*kn-(Xn*=kn))*zn+Xn,yr=((yr+ri)*kn-Xn)*zn+Xn,Wi=(Wi*kn-(wn*=kn))*zn+wn,Zn=(Zn*kn-wn)*zn+wn,[[Br,Zn,0],[yr,Zn,0],[yr,Wi,0],[Br,Wi,0]]})(l,r,s._pixelsPerMercatorPixel,ye,Se);for(let qn=0;qn<b.length;qn++)Hc(b[qn],nn[qn],sn);const Sn=he([],nn[xt],nn[(xt+1)%4]);$e(Sn,Sn,.5),Hc(Tt,Sn,sn)}for(const nn of b)Qe(M,M,nn),Fe(P,P,nn);return M[2]=Math.min(ct[2],vt[2]),Qe(M,M,Tt),Fe(P,P,Tt),new hn(M,P)}function Nc({x:s,y:r,z:l}){const h=1/(1<<l),p=new ti(yc(s*h),Ho((r+1)*h)),x=new ti(yc((s+1)*h),Ho(r*h));return new rd(p,x)}function Vh(s){const r=Z(s.getNorth()),l=Z(s.getSouth()),h=Math.cos(r),p=Math.cos(l),x=Math.sin(r),b=Math.sin(l),A=s.getWest(),P=s.getEast();return[Is(p,b,A),Is(p,b,P),Is(h,x,P),Is(h,x,A)]}function Is(s,r,l,h=Qr){return l=Z(l),[s*Math.sin(l)*h,-r*h,s*Math.cos(l)*h]}function $l(s,r,l){return Is(Math.cos(Z(s)),Math.sin(Z(s)),r,l)}function uu(s,r,l,h){const p=1<<l.z,x=(s/Wr+l.x)/p;return $l(Ho((r/Wr+l.y)/p),yc(x),h)}function Ed({min:s,max:r}){return co/Math.max(r[0]-s[0],r[1]-s[1],r[2]-s[2])}const qh=new Float64Array(16);function Vr(s){const r=Ed(s),l=Np(qh,[r,r,r]);return wd(l,l,((h=[])[0]=-(p=s.min)[0],h[1]=-p[1],h[2]=-p[2],h));var h,p}function ms(s){const r=(h=s.min,(l=qh)[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=h[0],l[13]=h[1],l[14]=h[2],l[15]=1,l);var l,h;const p=1/Ed(s);return od(r,r,[p,p,p])}function as(s,r,l,h,p){const x=(function(P){const M=Wr/(2*Math.PI);return P/(2*Math.PI)/M})(l),b=[s,r,-l/(2*Math.PI)],A=Rc(new Float64Array(16));return wd(A,A,b),od(A,A,[x,x,x]),Rp(A,A,Z(-p)),Yf(A,A,Z(-h)),A}function hu(s){return nt(Hn,tr,s)}function vl(s,r){const l=$l(r.lat,r.lng),h=(function(ye){const Se=$l(ye._center.lat,ye._center.lng);let We=Zt([],O(0,1,0),Se);const at=Ih([],-ye.angle,Se);We=Kt(We,We,at),Ih(at,-ye._pitch,We);const xt=Mt([],Se);return $e(xt,xt,Zs(ye.cameraToCenterDistance/ye.pixelsPerMeter)),Kt(xt,xt,at),he([],Se,xt)})(s);return b=(p=Ie([],h,l))[0],A=p[1],P=p[2],M=(x=l)[0],G=x[1],X=x[2],de=(re=Math.sqrt(b*b+A*A+P*P)*Math.sqrt(M*M+G*G+X*X))&&gt(p,x)/re,Math.acos(Math.min(Math.max(de,-1),1));var p,x,b,A,P,M,G,X,re,de}function Ch(s,r){return vl(s,r)>Math.PI/2*1.01}const Ad=Z(85),$h=Math.cos(Ad),Jf=Math.sin(Ad),Lh=63710088e-1,ff=2*Math.PI*Lh;class Gl{constructor(r,l){if(isNaN(r)||isNaN(l))throw new Error(`Invalid LngLat object: (${r}, ${l})`);if(this.lng=+r,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Gl(xe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const l=Math.PI/180,h=this.lat*l,p=r.lat*l,x=Math.sin(h)*Math.sin(p)+Math.cos(h)*Math.cos(p)*Math.cos((r.lng-this.lng)*l);return Lh*Math.acos(Math.min(x,1))}toBounds(r=0){const l=360*r/40075017,h=l/Math.cos(Math.PI/180*this.lat);return new rd(new Gl(this.lng-h,this.lat-l),new Gl(this.lng+h,this.lat+l))}toEcef(r){const l=Zs(r);return $l(this.lat,this.lng,Qr+l)}static convert(r){if(r instanceof Gl)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new Gl(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new Gl(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var ti=Gl;function Ma(s){return ff*Math.cos(s*Math.PI/180)}function Cs(s){return(180+s)/360}function Ys(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function Ga(s,r){return s/Ma(r)}function yc(s){return 360*s-180}function Ho(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function Td(s,r){return s*Ma(Ho(r))}const Ra=85.051129;function Qf(s){return 1/Math.cos(s*Math.PI/180)}class pf{constructor(r,l,h=0){this.x=+r,this.y=+l,this.z=+h}static fromLngLat(r,l=0){const h=ti.convert(r);return new pf(Cs(h.lng),Ys(h.lat),Ga(l,h.lat))}toLngLat(){return new ti(yc(this.x),Ho(this.y))}toAltitude(){return Td(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ff*Qf(Ho(this.y))}}function ep(s,r,l,h,p,x,b,A,P){const M=(r+h)/2,G=(l+p)/2,X=new q(M,G);A(X),(function(re,de,ye,Se,We,at){const xt=ye-We,ct=Se-at;return Math.abs((Se-de)*xt-(ye-re)*ct)/Math.hypot(xt,ct)})(X.x,X.y,x.x,x.y,b.x,b.y)>=P?(ep(s,r,l,M,G,x,X,A,P),ep(s,M,G,h,p,X,b,A,P)):s.push(b)}function Uu(s,r,l){let h=s[0],p=h.x,x=h.y;r(h);const b=[h];for(let A=1;A<s.length;A++){const P=s[A],{x:M,y:G}=P;r(P),ep(b,p,x,M,G,h,P,r,l),p=M,x=G,h=P}return b}function wm(s,r,l,h){if(h(r,l)){const p=r.add(l)._mult(.5);wm(s,r,p,h),wm(s,p,l,h)}else s.push(l)}function Fp(s,r){let l=s[0];const h=[l];for(let p=1;p<s.length;p++){const x=s[p];wm(h,l,x,r),l=x}return h}const sd=Math.pow(2,14)-1,Sm=-sd-1;function q0(s,r){const l=Math.round(s.x*r),h=Math.round(s.y*r);return s.x=De(l,Sm,sd),s.y=De(h,Sm,sd),(l<s.x||l>s.x+1||h<s.y||h>s.y+1)&&fr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function Su(s,r,l){const h=s.loadGeometry(),p=s.extent,x=Wr/p;if(r&&l&&l.projection.isReprojectedInTileSpace){const b=1<<r.z,{scale:A,x:P,y:M,projection:G}=l,X=re=>{const de=yc((r.x+re.x/p)/b),ye=Ho((r.y+re.y/p)/b),Se=G.project(de,ye);re.x=(Se.x*A-P)*p,re.y=(Se.y*A-M)*p};for(let re=0;re<h.length;re++)if(s.type!==1)h[re]=Uu(h[re],X,1);else{const de=[];for(const ye of h[re])ye.x<0||ye.x>=p||ye.y<0||ye.y>=p||(X(ye),de.push(ye));h[re]=de}}for(const b of h)for(const A of b)q0(A,x);return h}function Id(s,r){return{type:s.type,id:s.id,properties:s.properties,geometry:r?Su(s):[]}}function ad(s,r,l,h,p){s.emplaceBack(2*r+(h+1)/2,2*l+(p+1)/2)}function tp(s,r,l){s.emplaceBack(r.x,r.y,r.z,l[0]*16384,l[1]*16384,l[2]*16384)}class np{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((l=>l.id)),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new _n,this.indexArray=new _r,this.segments=new qa,this.programConfigurations=new ju(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter((l=>l.isStateDependent())).map((l=>l.id))}populate(r,l,h,p){const x=this.layers[0],b=[];let A=null;x.type==="circle"&&(A=x.layout.get("circle-sort-key"));for(const{feature:M,id:G,index:X,sourceLayerIndex:re}of r){const de=this.layers[0]._featureFilter.needGeometry,ye=Id(M,de);if(!this.layers[0]._featureFilter.filter(new $(this.zoom),ye,h))continue;const Se=A?A.evaluate(ye,{},h):void 0,We={id:G,properties:M.properties,type:M.type,sourceLayerIndex:re,index:X,geometry:de?ye.geometry:Su(M,h,p),patterns:{},sortKey:Se};b.push(We)}A&&b.sort(((M,G)=>M.sortKey-G.sortKey));let P=null;p.projection.name==="globe"&&(this.globeExtVertexArray=new Tn,P=p.projection);for(const M of b){const{geometry:G,index:X,sourceLayerIndex:re}=M,de=r[X].feature;this.addFeature(M,G,X,l.availableImages,h,P),l.featureIndex.insert(de,G,X,re,this.index)}}update(r,l,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,bm.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,V0.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(r,l,h,p,x,b){for(const A of l)for(const P of A){const M=P.x,G=P.y;if(M<0||M>=Wr||G<0||G>=Wr)continue;if(b){const de=b.projectTilePoint(M,G,x),ye=b.upVector(x,M,G),Se=this.globeExtVertexArray;tp(Se,de,ye),tp(Se,de,ye),tp(Se,de,ye),tp(Se,de,ye)}const X=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),re=X.vertexLength;ad(this.layoutVertexArray,M,G,-1,-1),ad(this.layoutVertexArray,M,G,1,-1),ad(this.layoutVertexArray,M,G,1,1),ad(this.layoutVertexArray,M,G,-1,1),this.indexArray.emplaceBack(re,re+1,re+2),this.indexArray.emplaceBack(re,re+2,re+3),X.vertexLength+=4,X.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,{},p,x)}}function bg(s,r){for(let l=0;l<s.length;l++)if(Ud(r,s[l]))return!0;for(let l=0;l<r.length;l++)if(Ud(s,r[l]))return!0;return!!Cd(s,r)}function wg(s,r,l){return!!Ud(s,r)||!!Eu(r,s,l)}function Em(s,r){if(s.length===1)return Sg(r,s[0]);for(let l=0;l<r.length;l++){const h=r[l];for(let p=0;p<h.length;p++)if(Ud(s,h[p]))return!0}for(let l=0;l<s.length;l++)if(Sg(r,s[l]))return!0;for(let l=0;l<r.length;l++)if(Cd(s,r[l]))return!0;return!1}function Vu(s,r,l){if(s.length>1){if(Cd(s,r))return!0;for(let h=0;h<r.length;h++)if(Eu(r[h],s,l))return!0}for(let h=0;h<s.length;h++)if(Eu(s[h],r,l))return!0;return!1}function Cd(s,r){if(s.length===0||r.length===0)return!1;for(let l=0;l<s.length-1;l++){const h=s[l],p=s[l+1];for(let x=0;x<r.length-1;x++)if(ld(h,p,r[x],r[x+1]))return!0}return!1}function ld(s,r,l,h){return br(s,l,h)!==br(r,l,h)&&br(s,r,l)!==br(s,r,h)}function Eu(s,r,l){const h=l*l;if(r.length===1)return s.distSqr(r[0])<h;for(let p=1;p<r.length;p++)if($0(s,r[p-1],r[p])<h)return!0;return!1}function $0(s,r,l){const h=r.distSqr(l);if(h===0)return s.distSqr(r);const p=((s.x-r.x)*(l.x-r.x)+(s.y-r.y)*(l.y-r.y))/h;return s.distSqr(p<0?r:p>1?l:l.sub(r)._mult(p)._add(r))}function Sg(s,r){let l,h,p,x=!1;for(let b=0;b<s.length;b++){l=s[b];for(let A=0,P=l.length-1;A<l.length;P=A++)h=l[A],p=l[P],h.y>r.y!=p.y>r.y&&r.x<(p.x-h.x)*(r.y-h.y)/(p.y-h.y)+h.x&&(x=!x)}return x}function Ud(s,r){let l=!1;for(let h=0,p=s.length-1;h<s.length;p=h++){const x=s[h],b=s[p];x.y>r.y!=b.y>r.y&&r.x<(b.x-x.x)*(r.y-x.y)/(b.y-x.y)+x.x&&(l=!l)}return l}function O_(s,r,l,h,p){for(const b of s)if(r<=b.x&&l<=b.y&&h>=b.x&&p>=b.y)return!0;const x=[new q(r,l),new q(r,p),new q(h,p),new q(h,l)];if(s.length>2){for(const b of x)if(Ud(s,b))return!0}for(let b=0;b<s.length-1;b++)if(mf(s[b],s[b+1],x))return!0;return!1}function mf(s,r,l){const h=l[0],p=l[2];if(s.x<h.x&&r.x<h.x||s.x>p.x&&r.x>p.x||s.y<h.y&&r.y<h.y||s.y>p.y&&r.y>p.y)return!1;const x=br(s,r,l[0]);return x!==br(s,r,l[1])||x!==br(s,r,l[2])||x!==br(s,r,l[3])}function rp(s,r,l){const h=r.paint.get(s).value;return h.kind==="constant"?h.value:l.programConfigurations.get(r.id).getMaxValue(s)}function Op(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function gf(s,r,l,h,p){if(!r[0]&&!r[1])return s;const x=q.convert(r)._mult(p);l==="viewport"&&x._rotate(-h);const b=[];for(let A=0;A<s.length;A++)b.push(s[A].sub(x));return b}function Eg(s,r,l,h){const p=q.convert(s)._mult(h);return r==="viewport"&&p._rotate(-l),p}lr(np,"CircleBucket",{omit:["layers"]});const ip=new ot({"circle-sort-key":new Ge(pn.layout_circle["circle-sort-key"])});var B_={paint:new ot({"circle-radius":new Ge(pn.paint_circle["circle-radius"]),"circle-color":new Ge(pn.paint_circle["circle-color"]),"circle-blur":new Ge(pn.paint_circle["circle-blur"]),"circle-opacity":new Ge(pn.paint_circle["circle-opacity"]),"circle-translate":new _e(pn.paint_circle["circle-translate"]),"circle-translate-anchor":new _e(pn.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new _e(pn.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new _e(pn.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ge(pn.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ge(pn.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ge(pn.paint_circle["circle-stroke-opacity"])}),layout:ip};function G0(s,r,l,h,p,x,b,A,P){if(x&&s.queryGeometry.isAboveHorizon)return!1;x&&(P*=s.pixelToTileUnitsFactor);const M=s.tileID.canonical,G=l.projection.upVectorScale(M,l.center.lat,l.worldSize).metersToTile;for(const X of r)for(const re of X){const de=re.add(A),ye=p&&l.elevation?l.elevation.exaggeration()*p.getElevationAt(de.x,de.y,!0):0,Se=l.projection.projectTilePoint(de.x,de.y,M);if(ye>0){const ct=l.projection.upVector(M,de.x,de.y);Se.x+=ct[0]*G*ye,Se.y+=ct[1]*G*ye,Se.z+=ct[2]*G*ye}const We=x?de:H0(Se.x,Se.y,Se.z,h),at=x?s.tilespaceRays.map((ct=>bx(ct,ye))):s.queryGeometry.screenGeometry,xt=rr([],[Se.x,Se.y,Se.z,1],h);if(!b&&x?P*=xt[3]/l.cameraToCenterDistance:b&&!x&&(P*=l.cameraToCenterDistance/xt[3]),x){const ct=Ho((re.y/Wr+M.y)/(1<<M.z));P/=l.projection.pixelsPerMeter(ct,1)/Ga(1,ct)}if(wg(at,We,P))return!0}return!1}function H0(s,r,l,h){const p=rr([],[s,r,l,1],h);return new q(p[0]/p[3],p[1]/p[3])}const Am=O(0,0,0),xx=O(0,0,1);function bx(s,r){const l=hf();return Am[2]=r,s.intersectsPlane(Am,xx,l),new q(l[0],l[1])}class W0 extends np{}function K0(s,{width:r,height:l},h,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==r*l*h)throw new RangeError("mismatched image size")}else p=new Uint8Array(r*l*h);return s.width=r,s.height=l,s.data=p,s}function yf(s,r,l){const{width:h,height:p}=r;h===s.width&&p===s.height||(X0(s,r,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,h),height:Math.min(s.height,p)},l),s.width=h,s.height=p,s.data=r.data)}function X0(s,r,l,h,p,x){if(p.width===0||p.height===0)return r;if(p.width>s.width||p.height>s.height||l.x>s.width-p.width||l.y>s.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>r.width||p.height>r.height||h.x>r.width-p.width||h.y>r.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const b=s.data,A=r.data;for(let P=0;P<p.height;P++){const M=((l.y+P)*s.width+l.x)*x,G=((h.y+P)*r.width+h.x)*x;for(let X=0;X<p.width*x;X++)A[G+X]=b[M+X]}return r}lr(W0,"HeatmapBucket",{omit:["layers"]});class oh{constructor(r,l){K0(this,r,1,l)}resize(r){yf(this,new oh(r),1)}clone(){return new oh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,l,h,p,x){X0(r,l,h,p,x,1)}}class qu{constructor(r,l){K0(this,r,4,l)}resize(r){yf(this,new qu(r),4)}replace(r,l){l?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new qu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,l,h,p,x){X0(r,l,h,p,x,4)}}lr(oh,"AlphaImage"),lr(qu,"RGBAImage");var Cl={paint:new ot({"heatmap-radius":new Ge(pn.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ge(pn.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new _e(pn.paint_heatmap["heatmap-intensity"]),"heatmap-color":new it(pn.paint_heatmap["heatmap-color"]),"heatmap-opacity":new _e(pn.paint_heatmap["heatmap-opacity"])})};function Z0(s){const r={},l=s.resolution||256,h=s.clips?s.clips.length:1,p=s.image||new qu({width:l,height:h}),x=(b,A,P)=>{r[s.evaluationKey]=P;const M=s.expression.evaluate(r);p.data[b+A+0]=Math.floor(255*M.r/M.a),p.data[b+A+1]=Math.floor(255*M.g/M.a),p.data[b+A+2]=Math.floor(255*M.b/M.a),p.data[b+A+3]=Math.floor(255*M.a)};if(s.clips)for(let b=0,A=0;b<h;++b,A+=4*l)for(let P=0,M=0;P<l;P++,M+=4){const G=P/(l-1),{start:X,end:re}=s.clips[b];x(A,M,X*(1-G)+re*G)}else for(let b=0,A=0;b<l;b++,A+=4)x(0,A,b/(l-1));return p}var z_={paint:new ot({"hillshade-illumination-direction":new _e(pn.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new _e(pn.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new _e(pn.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new _e(pn.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new _e(pn.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new _e(pn.paint_hillshade["hillshade-accent-color"])})};const wx=kt([{name:"a_pos",components:2,type:"Int16"}],4),{members:Sx}=wx;var Ag={exports:{}};function Tm(s,r,l){l=l||2;var h,p,x,b,A,P,M,G=r&&r.length,X=G?r[0]*l:s.length,re=j_(s,0,X,l,!0),de=[];if(!re||re.next===re.prev)return de;if(G&&(re=(function(Se,We,at,xt){var ct,vt,It,Tt=[];for(ct=0,vt=We.length;ct<vt;ct++)(It=j_(Se,We[ct]*xt,ct<vt-1?We[ct+1]*xt:Se.length,xt,!1))===It.next&&(It.steiner=!0),Tt.push(ey(It));for(Tt.sort(Ig),ct=0;ct<Tt.length;ct++)at=Y0(Tt[ct],at);return at})(s,r,re,l)),s.length>80*l){h=x=s[0],p=b=s[1];for(var ye=l;ye<X;ye+=l)(A=s[ye])<h&&(h=A),(P=s[ye+1])<p&&(p=P),A>x&&(x=A),P>b&&(b=P);M=(M=Math.max(x-h,b-p))!==0?32767/M:0}return op(re,de,l,h,p,M,0),de}function j_(s,r,l,h,p){var x,b;if(p===jp(s,r,l,h)>0)for(x=r;x<l;x+=h)b=Cg(x,s[x],s[x+1],b);else for(x=l-h;x>=r;x-=h)b=Cg(x,s[x],s[x+1],b);return b&&ap(b,b.next)&&(vf(b),b=b.next),b}function Wc(s,r){if(!s)return s;r||(r=s);var l,h=s;do if(l=!1,h.steiner||!ap(h,h.next)&&ol(h.prev,h,h.next)!==0)h=h.next;else{if(vf(h),(h=r=h.prev)===h.next)break;l=!0}while(l||h!==r);return r}function op(s,r,l,h,p,x,b){if(s){!b&&x&&(function(G,X,re,de){var ye=G;do ye.z===0&&(ye.z=Q0(ye.x,ye.y,X,re,de)),ye.prevZ=ye.prev,ye.nextZ=ye.next,ye=ye.next;while(ye!==G);ye.prevZ.nextZ=null,ye.prevZ=null,(function(Se){var We,at,xt,ct,vt,It,Tt,sn,nn=1;do{for(at=Se,Se=null,vt=null,It=0;at;){for(It++,xt=at,Tt=0,We=0;We<nn&&(Tt++,xt=xt.nextZ);We++);for(sn=nn;Tt>0||sn>0&&xt;)Tt!==0&&(sn===0||!xt||at.z<=xt.z)?(ct=at,at=at.nextZ,Tt--):(ct=xt,xt=xt.nextZ,sn--),vt?vt.nextZ=ct:Se=ct,ct.prevZ=vt,vt=ct;at=xt}vt.nextZ=null,nn*=2}while(It>1)})(ye)})(s,h,p,x);for(var A,P,M=s;s.prev!==s.next;)if(A=s.prev,P=s.next,x?_f(s,h,p,x):Ex(s))r.push(A.i/l|0),r.push(s.i/l|0),r.push(P.i/l|0),vf(s),s=P.next,M=P.next;else if((s=P)===M){b?b===1?op(s=Tg(Wc(s),r,l),r,l,h,p,x,2):b===2&&sp(s,r,l,h,p,x):op(Wc(s),r,l,h,p,x,1);break}}}function Ex(s){var r=s.prev,l=s,h=s.next;if(ol(r,l,h)>=0)return!1;for(var p=r.x,x=l.x,b=h.x,A=r.y,P=l.y,M=h.y,G=p<x?p<b?p:b:x<b?x:b,X=A<P?A<M?A:M:P<M?P:M,re=p>x?p>b?p:b:x>b?x:b,de=A>P?A>M?A:M:P>M?P:M,ye=h.next;ye!==r;){if(ye.x>=G&&ye.x<=re&&ye.y>=X&&ye.y<=de&&Bp(p,A,x,P,b,M,ye.x,ye.y)&&ol(ye.prev,ye,ye.next)>=0)return!1;ye=ye.next}return!0}function _f(s,r,l,h){var p=s.prev,x=s,b=s.next;if(ol(p,x,b)>=0)return!1;for(var A=p.x,P=x.x,M=b.x,G=p.y,X=x.y,re=b.y,de=A<P?A<M?A:M:P<M?P:M,ye=G<X?G<re?G:re:X<re?X:re,Se=A>P?A>M?A:M:P>M?P:M,We=G>X?G>re?G:re:X>re?X:re,at=Q0(de,ye,r,l,h),xt=Q0(Se,We,r,l,h),ct=s.prevZ,vt=s.nextZ;ct&&ct.z>=at&&vt&&vt.z<=xt;){if(ct.x>=de&&ct.x<=Se&&ct.y>=ye&&ct.y<=We&&ct!==p&&ct!==b&&Bp(A,G,P,X,M,re,ct.x,ct.y)&&ol(ct.prev,ct,ct.next)>=0||(ct=ct.prevZ,vt.x>=de&&vt.x<=Se&&vt.y>=ye&&vt.y<=We&&vt!==p&&vt!==b&&Bp(A,G,P,X,M,re,vt.x,vt.y)&&ol(vt.prev,vt,vt.next)>=0))return!1;vt=vt.nextZ}for(;ct&&ct.z>=at;){if(ct.x>=de&&ct.x<=Se&&ct.y>=ye&&ct.y<=We&&ct!==p&&ct!==b&&Bp(A,G,P,X,M,re,ct.x,ct.y)&&ol(ct.prev,ct,ct.next)>=0)return!1;ct=ct.prevZ}for(;vt&&vt.z<=xt;){if(vt.x>=de&&vt.x<=Se&&vt.y>=ye&&vt.y<=We&&vt!==p&&vt!==b&&Bp(A,G,P,X,M,re,vt.x,vt.y)&&ol(vt.prev,vt,vt.next)>=0)return!1;vt=vt.nextZ}return!0}function Tg(s,r,l){var h=s;do{var p=h.prev,x=h.next.next;!ap(p,x)&&Im(p,h,h.next,x)&&Lm(p,x)&&Lm(x,p)&&(r.push(p.i/l|0),r.push(h.i/l|0),r.push(x.i/l|0),vf(h),vf(h.next),h=s=x),h=h.next}while(h!==s);return Wc(h)}function sp(s,r,l,h,p,x){var b=s;do{for(var A=b.next.next;A!==b.prev;){if(b.i!==A.i&&U_(b,A)){var P=ty(b,A);return b=Wc(b,b.next),P=Wc(P,P.next),op(b,r,l,h,p,x,0),void op(P,r,l,h,p,x,0)}A=A.next}b=b.next}while(b!==s)}function Ig(s,r){return s.x-r.x}function Y0(s,r){var l=(function(p,x){var b,A=x,P=p.x,M=p.y,G=-1/0;do{if(M<=A.y&&M>=A.next.y&&A.next.y!==A.y){var X=A.x+(M-A.y)*(A.next.x-A.x)/(A.next.y-A.y);if(X<=P&&X>G&&(G=X,b=A.x<A.next.x?A:A.next,X===P))return b}A=A.next}while(A!==x);if(!b)return null;var re,de=b,ye=b.x,Se=b.y,We=1/0;A=b;do P>=A.x&&A.x>=ye&&P!==A.x&&Bp(M<Se?P:G,M,ye,Se,M<Se?G:P,M,A.x,A.y)&&(re=Math.abs(M-A.y)/(P-A.x),Lm(A,p)&&(re<We||re===We&&(A.x>b.x||A.x===b.x&&J0(b,A)))&&(b=A,We=re)),A=A.next;while(A!==de);return b})(s,r);if(!l)return r;var h=ty(l,s);return Wc(h,h.next),Wc(l,l.next)}function J0(s,r){return ol(s.prev,s,r.prev)<0&&ol(r.next,s,s.next)<0}function Q0(s,r,l,h,p){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-l)*p|0)|s<<8))|s<<4))|s<<2))|s<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-h)*p|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function ey(s){var r=s,l=s;do(r.x<l.x||r.x===l.x&&r.y<l.y)&&(l=r),r=r.next;while(r!==s);return l}function Bp(s,r,l,h,p,x,b,A){return(p-b)*(r-A)>=(s-b)*(x-A)&&(s-b)*(h-A)>=(l-b)*(r-A)&&(l-b)*(x-A)>=(p-b)*(h-A)}function U_(s,r){return s.next.i!==r.i&&s.prev.i!==r.i&&!(function(l,h){var p=l;do{if(p.i!==l.i&&p.next.i!==l.i&&p.i!==h.i&&p.next.i!==h.i&&Im(p,p.next,l,h))return!0;p=p.next}while(p!==l);return!1})(s,r)&&(Lm(s,r)&&Lm(r,s)&&(function(l,h){var p=l,x=!1,b=(l.x+h.x)/2,A=(l.y+h.y)/2;do p.y>A!=p.next.y>A&&p.next.y!==p.y&&b<(p.next.x-p.x)*(A-p.y)/(p.next.y-p.y)+p.x&&(x=!x),p=p.next;while(p!==l);return x})(s,r)&&(ol(s.prev,s,r.prev)||ol(s,r.prev,r))||ap(s,r)&&ol(s.prev,s,s.next)>0&&ol(r.prev,r,r.next)>0)}function ol(s,r,l){return(r.y-s.y)*(l.x-r.x)-(r.x-s.x)*(l.y-r.y)}function ap(s,r){return s.x===r.x&&s.y===r.y}function Im(s,r,l,h){var p=zp(ol(s,r,l)),x=zp(ol(s,r,h)),b=zp(ol(l,h,s)),A=zp(ol(l,h,r));return p!==x&&b!==A||!(p!==0||!Cm(s,l,r))||!(x!==0||!Cm(s,h,r))||!(b!==0||!Cm(l,s,h))||!(A!==0||!Cm(l,r,h))}function Cm(s,r,l){return r.x<=Math.max(s.x,l.x)&&r.x>=Math.min(s.x,l.x)&&r.y<=Math.max(s.y,l.y)&&r.y>=Math.min(s.y,l.y)}function zp(s){return s>0?1:s<0?-1:0}function Lm(s,r){return ol(s.prev,s,s.next)<0?ol(s,r,s.next)>=0&&ol(s,s.prev,r)>=0:ol(s,r,s.prev)<0||ol(s,s.next,r)<0}function ty(s,r){var l=new Pm(s.i,s.x,s.y),h=new Pm(r.i,r.x,r.y),p=s.next,x=r.prev;return s.next=r,r.prev=s,l.next=p,p.prev=l,h.next=l,l.prev=h,x.next=h,h.prev=x,h}function Cg(s,r,l,h){var p=new Pm(s,r,l);return h?(p.next=h.next,p.prev=h,h.next.prev=p,h.next=p):(p.prev=p,p.next=p),p}function vf(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Pm(s,r,l){this.i=s,this.x=r,this.y=l,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function jp(s,r,l,h){for(var p=0,x=r,b=l-h;x<l;x+=h)p+=(s[b]-s[x])*(s[x+1]+s[b+1]),b=x;return p}Ag.exports=Tm,Ag.exports.default=Tm,Tm.deviation=function(s,r,l,h){var p=r&&r.length,x=Math.abs(jp(s,0,p?r[0]*l:s.length,l));if(p)for(var b=0,A=r.length;b<A;b++)x-=Math.abs(jp(s,r[b]*l,b<A-1?r[b+1]*l:s.length,l));var P=0;for(b=0;b<h.length;b+=3){var M=h[b]*l,G=h[b+1]*l,X=h[b+2]*l;P+=Math.abs((s[M]-s[X])*(s[G+1]-s[M+1])-(s[M]-s[G])*(s[X+1]-s[M+1]))}return x===0&&P===0?0:Math.abs((P-x)/x)},Tm.flatten=function(s){for(var r=s[0][0].length,l={vertices:[],holes:[],dimensions:r},h=0,p=0;p<s.length;p++){for(var x=0;x<s[p].length;x++)for(var b=0;b<r;b++)l.vertices.push(s[p][x][b]);p>0&&l.holes.push(h+=s[p-1].length)}return l};var Lg=ue(Ag.exports);function Ax(s,r,l,h,p){km(s,r,l,h||s.length-1,p||Rm)}function km(s,r,l,h,p){for(;h>l;){if(h-l>600){var x=h-l+1,b=r-l+1,A=Math.log(x),P=.5*Math.exp(2*A/3),M=.5*Math.sqrt(A*P*(x-P)/x)*(b-x/2<0?-1:1);km(s,r,Math.max(l,Math.floor(r-b*P/x+M)),Math.min(h,Math.floor(r+(x-b)*P/x+M)),p)}var G=s[r],X=l,re=h;for(Mm(s,l,r),p(s[h],G)>0&&Mm(s,l,h);X<re;){for(Mm(s,X,re),X++,re--;p(s[X],G)<0;)X++;for(;p(s[re],G)>0;)re--}p(s[l],G)===0?Mm(s,l,re):Mm(s,++re,h),re<=r&&(l=re+1),r<=re&&(h=re-1)}}function Mm(s,r,l){var h=s[r];s[r]=s[l],s[l]=h}function Rm(s,r){return s<r?-1:s>r?1:0}function ny(s,r){const l=s.length;if(l<=1)return[s];const h=[];let p,x;for(let b=0;b<l;b++){const A=Tr(s[b]);A!==0&&(s[b].area=Math.abs(A),x===void 0&&(x=A<0),x===A<0?(p&&h.push(p),p=[s[b]]):p.push(s[b]))}if(p&&h.push(p),r>1)for(let b=0;b<h.length;b++)h[b].length<=r||(Ax(h[b],r,1,h[b].length-1,Pg),h[b]=h[b].slice(0,r));return h}function Pg(s,r){return r.area-s.area}function d(s,r,l){const h=l.patternDependencies;let p=!1;for(const x of r){const b=x.paint.get(`${s}-pattern`);b.isConstant()||(p=!0);const A=b.constantOr(null);A&&(p=!0,h[A]=!0)}return p}function g(s,r,l,h,p){const x=p.patternDependencies;for(const b of r){const A=b.paint.get(`${s}-pattern`).value;if(A.kind!=="constant"){let P=A.evaluate({zoom:h},l,{},p.availableImages);P=P&&P.name?P.name:P,x[P]=!0,l.patterns[b.id]=P}}return l}class E{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((l=>l.id)),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new _n,this.indexArray=new _r,this.indexArray2=new us,this.programConfigurations=new ju(r.layers,r.zoom),this.segments=new qa,this.segments2=new qa,this.stateDependentLayerIds=this.layers.filter((l=>l.isStateDependent())).map((l=>l.id)),this.projection=r.projection}populate(r,l,h,p){this.hasPattern=d("fill",this.layers,l);const x=this.layers[0].layout.get("fill-sort-key"),b=[];for(const{feature:A,id:P,index:M,sourceLayerIndex:G}of r){const X=this.layers[0]._featureFilter.needGeometry,re=Id(A,X);if(!this.layers[0]._featureFilter.filter(new $(this.zoom),re,h))continue;const de=x?x.evaluate(re,{},h,l.availableImages):void 0,ye={id:P,properties:A.properties,type:A.type,sourceLayerIndex:G,index:M,geometry:X?re.geometry:Su(A,h,p),patterns:{},sortKey:de};b.push(ye)}x&&b.sort(((A,P)=>A.sortKey-P.sortKey));for(const A of b){const{geometry:P,index:M,sourceLayerIndex:G}=A;if(this.hasPattern){const X=g("fill",this.layers,A,this.zoom,l);this.patternFeatures.push(X)}else this.addFeature(A,P,M,h,{},l.availableImages);l.featureIndex.insert(r[M].feature,P,M,G,this.index)}}update(r,l,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,h,p)}addFeatures(r,l,h,p,x){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,l,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Sx),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,l,h,p,x,b=[]){for(const A of ny(l,500)){let P=0;for(const ye of A)P+=ye.length;const M=this.segments.prepareSegment(P,this.layoutVertexArray,this.indexArray),G=M.vertexLength,X=[],re=[];for(const ye of A){if(ye.length===0)continue;ye!==A[0]&&re.push(X.length/2);const Se=this.segments2.prepareSegment(ye.length,this.layoutVertexArray,this.indexArray2),We=Se.vertexLength;this.layoutVertexArray.emplaceBack(ye[0].x,ye[0].y),this.indexArray2.emplaceBack(We+ye.length-1,We),X.push(ye[0].x),X.push(ye[0].y);for(let at=1;at<ye.length;at++)this.layoutVertexArray.emplaceBack(ye[at].x,ye[at].y),this.indexArray2.emplaceBack(We+at-1,We+at),X.push(ye[at].x),X.push(ye[at].y);Se.vertexLength+=ye.length,Se.primitiveLength+=ye.length}const de=Lg(X,re);for(let ye=0;ye<de.length;ye+=3)this.indexArray.emplaceBack(G+de[ye],G+de[ye+1],G+de[ye+2]);M.vertexLength+=P,M.primitiveLength+=de.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,x,b,p)}}lr(E,"FillBucket",{omit:["layers","patternFeatures"]});const D=new ot({"fill-sort-key":new Ge(pn.layout_fill["fill-sort-key"])});var K={paint:new ot({"fill-antialias":new _e(pn.paint_fill["fill-antialias"]),"fill-opacity":new Ge(pn.paint_fill["fill-opacity"]),"fill-color":new Ge(pn.paint_fill["fill-color"]),"fill-outline-color":new Ge(pn.paint_fill["fill-outline-color"]),"fill-translate":new _e(pn.paint_fill["fill-translate"]),"fill-translate-anchor":new _e(pn.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ge(pn.paint_fill["fill-pattern"])}),layout:D};const ce=kt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Ve=kt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Et=kt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Ft}=ce;var vn={},nr=U,cr=Kn;function Kn(s,r,l,h,p){this.properties={},this.extent=l,this.type=0,this._pbf=s,this._geometry=-1,this._keys=h,this._values=p,s.readFields(Gr,this,r)}function Gr(s,r,l){s==1?r.id=l.readVarint():s==2?(function(h,p){for(var x=h.readVarint()+h.pos;h.pos<x;){var b=p._keys[h.readVarint()],A=p._values[h.readVarint()];p.properties[b]=A}})(l,r):s==3?r.type=l.readVarint():s==4&&(r._geometry=l.pos)}function si(s){for(var r,l,h=0,p=0,x=s.length,b=x-1;p<x;b=p++)h+=((l=s[b]).x-(r=s[p]).x)*(r.y+l.y);return h}Kn.types=["Unknown","Point","LineString","Polygon"],Kn.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var r,l=s.readVarint()+s.pos,h=1,p=0,x=0,b=0,A=[];s.pos<l;){if(p<=0){var P=s.readVarint();h=7&P,p=P>>3}if(p--,h===1||h===2)x+=s.readSVarint(),b+=s.readSVarint(),h===1&&(r&&A.push(r),r=[]),r.push(new nr(x,b));else{if(h!==7)throw new Error("unknown command "+h);r&&r.push(r[0].clone())}}return r&&A.push(r),A},Kn.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var r=s.readVarint()+s.pos,l=1,h=0,p=0,x=0,b=1/0,A=-1/0,P=1/0,M=-1/0;s.pos<r;){if(h<=0){var G=s.readVarint();l=7&G,h=G>>3}if(h--,l===1||l===2)(p+=s.readSVarint())<b&&(b=p),p>A&&(A=p),(x+=s.readSVarint())<P&&(P=x),x>M&&(M=x);else if(l!==7)throw new Error("unknown command "+l)}return[b,P,A,M]},Kn.prototype.toGeoJSON=function(s,r,l){var h,p,x=this.extent*Math.pow(2,l),b=this.extent*s,A=this.extent*r,P=this.loadGeometry(),M=Kn.types[this.type];function G(de){for(var ye=0;ye<de.length;ye++){var Se=de[ye];de[ye]=[360*(Se.x+b)/x-180,360/Math.PI*Math.atan(Math.exp((180-360*(Se.y+A)/x)*Math.PI/180))-90]}}switch(this.type){case 1:var X=[];for(h=0;h<P.length;h++)X[h]=P[h][0];G(P=X);break;case 2:for(h=0;h<P.length;h++)G(P[h]);break;case 3:for(P=(function(de){var ye=de.length;if(ye<=1)return[de];for(var Se,We,at=[],xt=0;xt<ye;xt++){var ct=si(de[xt]);ct!==0&&(We===void 0&&(We=ct<0),We===ct<0?(Se&&at.push(Se),Se=[de[xt]]):Se.push(de[xt]))}return Se&&at.push(Se),at})(P),h=0;h<P.length;h++)for(p=0;p<P[h].length;p++)G(P[h][p])}P.length===1?P=P[0]:M="Multi"+M;var re={type:"Feature",geometry:{type:M,coordinates:P},properties:this.properties};return"id"in this&&(re.id=this.id),re};var fi=cr,Ll=an;function an(s,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(Ht,this,r),this.length=this._features.length}function Ht(s,r,l){s===15?r.version=l.readVarint():s===1?r.name=l.readString():s===5?r.extent=l.readVarint():s===2?r._features.push(l.pos):s===3?r._keys.push(l.readString()):s===4&&r._values.push((function(h){for(var p=null,x=h.readVarint()+h.pos;h.pos<x;){var b=h.readVarint()>>3;p=b===1?h.readString():b===2?h.readFloat():b===3?h.readDouble():b===4?h.readVarint64():b===5?h.readVarint():b===6?h.readSVarint():b===7?h.readBoolean():null}return p})(l))}an.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var r=this._pbf.readVarint()+this._pbf.pos;return new fi(this._pbf,r,this.extent,this._keys,this._values)};var mn=Ll;function gr(s,r,l){if(s===3){var h=new mn(l,l.readVarint()+l.pos);h.length&&(r[h.name]=h)}}var pi=vn.VectorTile=function(s,r){this.layers=s.readFields(gr,{},r)},Ri=vn.VectorTileFeature=cr;function Ni(s,r,l,h){const p=[],x=h===0?(b,A,P,M,G,X)=>{b.push(new q(X,P+(X-A)/(M-A)*(G-P)))}:(b,A,P,M,G,X)=>{b.push(new q(A+(X-P)/(G-P)*(M-A),X))};for(const b of s){const A=[];for(const P of b){if(P.length<=2)continue;const M=[];for(let re=0;re<P.length-1;re++){const de=P[re].x,ye=P[re].y,Se=P[re+1].x,We=P[re+1].y,at=h===0?de:ye,xt=h===0?Se:We;at<r?xt>r&&x(M,de,ye,Se,We,r):at>l?xt<l&&x(M,de,ye,Se,We,l):M.push(P[re]),xt<r&&at>=r&&x(M,de,ye,Se,We,r),xt>l&&at<=l&&x(M,de,ye,Se,We,l)}let G=P[P.length-1];const X=h===0?G.x:G.y;X>=r&&X<=l&&M.push(G),M.length&&(G=M[M.length-1],M[0].x===G.x&&M[0].y===G.y||M.push(M[0]),A.push(M))}A.length&&p.push(A)}return p}vn.VectorTileLayer=Ll;const eo=Ri.types,Kc=Math.pow(2,13);function rs(s,r,l,h,p,x,b,A){s.emplaceBack((r<<1)+b,(l<<1)+x,(Math.floor(h*Kc)<<1)+p,Math.round(A))}function Gh(s,r,l){s.emplaceBack(r.x,r.y,r.z,l[0]*16384,l[1]*16384,l[2]*16384)}class V_{constructor(){this.acc=new q(0,0),this.polyCount=[]}startRing(r){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new q(r.x,r.y),this.max=new q(r.x,r.y))}append(r,l){this.currentPolyCount.edges++,this.acc._add(r);const h=this.min,p=this.max;r.x<h.x?h.x=r.x:r.x>p.x&&(p.x=r.x),r.y<h.y?h.y=r.y:r.y>p.y&&(p.y=r.y),((r.x===0||r.x===Wr)&&r.x===l.x)!=((r.y===0||r.y===Wr)&&r.y===l.y)&&this.processBorderOverlap(r,l),l.x<0!=r.x<0&&this.addBorderIntersection(0,He(l.y,r.y,(0-l.x)/(r.x-l.x))),l.x>Wr!=r.x>Wr&&this.addBorderIntersection(1,He(l.y,r.y,(Wr-l.x)/(r.x-l.x))),l.y<0!=r.y<0&&this.addBorderIntersection(2,He(l.x,r.x,(0-l.y)/(r.y-l.y))),l.y>Wr!=r.y>Wr&&this.addBorderIntersection(3,He(l.x,r.x,(Wr-l.y)/(r.y-l.y)))}addBorderIntersection(r,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const h=this.borders[r];l<h[0]&&(h[0]=l),l>h[1]&&(h[1]=l)}processBorderOverlap(r,l){if(r.x===l.x){if(r.y===l.y)return;const h=r.x===0?0:1;this.addBorderIntersection(h,l.y),this.addBorderIntersection(h,r.y)}else{const h=r.y===0?2:3;this.addBorderIntersection(h,l.x),this.addBorderIntersection(h,r.x)}}centroid(){const r=this.polyCount.reduce(((l,h)=>l+h.edges),0);return r!==0?this.acc.div(r)._round():new q(0,0)}span(){return new q(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce(((r,l)=>r+ +(l[0]!==Number.MAX_VALUE)),0)}}class ry{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((l=>l.id)),this.index=r.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=r.projection,this.layoutVertexArray=new cn,this.centroidVertexArray=new ql,this.indexArray=new _r,this.programConfigurations=new ju(r.layers,r.zoom),this.segments=new qa,this.stateDependentLayerIds=this.layers.filter((l=>l.isStateDependent())).map((l=>l.id)),this.enableTerrain=r.enableTerrain}populate(r,l,h,p){this.features=[],this.hasPattern=d("fill-extrusion",this.layers,l),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=(function(x){const b=Math.exp(Math.PI*(1-x.y/(1<<x.z)*2));return 80150034*b/(b*b+1)/Wr/(1<<x.z)})(h),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:x,id:b,index:A,sourceLayerIndex:P}of r){const M=this.layers[0]._featureFilter.needGeometry,G=Id(x,M);if(!this.layers[0]._featureFilter.filter(new $(this.zoom),G,h))continue;const X={id:b,sourceLayerIndex:P,index:A,geometry:M?G.geometry:Su(x,h,p),properties:x.properties,type:x.type,patterns:{}},re=this.layoutVertexArray.length;this.hasPattern?this.features.push(g("fill-extrusion",this.layers,X,this.zoom,l)):this.addFeature(X,X.geometry,A,h,{},l.availableImages,p),l.featureIndex.insert(x,X.geometry,A,P,this.index,re)}this.sortBorders()}addFeatures(r,l,h,p,x){for(const b of this.features){const{geometry:A}=b;this.addFeature(b,A,b.index,l,h,p,x)}this.sortBorders()}update(r,l,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Ft),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=r.createVertexBuffer(this.layoutVertexExtArray,Et.members,!0))),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,Ve.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,l,h,p,x,b,A){const P=[new q(0,0),new q(Wr,Wr)],M=A.projection,G=M.name==="globe",X=this.enableTerrain&&!G?new V_:null,re=eo[r.type]==="Polygon";G&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Tn);const de=ny(l,500);for(let at=de.length-1;at>=0;at--){const xt=de[at];(xt.length===0||(ye=xt[0]).every((ct=>ct.x<=0))||ye.every((ct=>ct.x>=Wr))||ye.every((ct=>ct.y<=0))||ye.every((ct=>ct.y>=Wr)))&&de.splice(at,1)}var ye;let Se;if(G)Se=G3(de,P,p);else{Se=[];for(const at of de)Se.push({polygon:at,bounds:P})}const We=re?this.edgeRadius:0;for(const{polygon:at,bounds:xt}of Se){let ct=0,vt=0;for(const Tt of at)re&&!Tt[0].equals(Tt[Tt.length-1])&&Tt.push(Tt[0]),vt+=re?Tt.length-1:Tt.length;const It=this.segments.prepareSegment((re?5:4)*vt,this.layoutVertexArray,this.indexArray);if(re){const Tt=[],sn=[];ct=It.vertexLength;for(const Sn of at){let qn,dn;Sn.length&&Sn!==at[0]&&sn.push(Tt.length/2),qn=Sn[1].sub(Sn[0])._perp()._unit();for(let Pn=1;Pn<Sn.length;Pn++){const kn=Sn[Pn],zn=Sn[Pn===Sn.length-1?1:Pn+1];let{x:Xn,y:wn}=kn;if(We){dn=zn.sub(kn)._perp()._unit();const pr=qn.add(dn)._unit(),Br=We*Math.min(4,1/(qn.x*pr.x+qn.y*pr.y));Xn+=Br*pr.x,wn+=Br*pr.y,qn=dn}rs(this.layoutVertexArray,Xn,wn,0,0,1,1,0),It.vertexLength++,Tt.push(kn.x,kn.y),G&&Gh(this.layoutVertexExtArray,M.projectTilePoint(Xn,wn,p),M.upVector(p,Xn,wn))}}const nn=Lg(Tt,sn);for(let Sn=0;Sn<nn.length;Sn+=3)this.indexArray.emplaceBack(ct+nn[Sn],ct+nn[Sn+2],ct+nn[Sn+1]),It.primitiveLength++}for(const Tt of at){X&&Tt.length&&X.startRing(Tt[0]);let sn,nn,Sn,qn=Tt.length>4&&V3(Tt[Tt.length-2],Tt[0],Tt[1]),dn=We?dC(Tt[Tt.length-2],Tt[0],Tt[1],We):0;nn=Tt[1].sub(Tt[0])._perp()._unit();let Pn=!0;for(let kn=1,zn=0;kn<Tt.length;kn++){let Xn=Tt[kn-1],wn=Tt[kn];const pr=Tt[kn===Tt.length-1?1:kn+1];if(X&&re&&X.currentPolyCount.top++,U3(wn,Xn,xt)){We&&(nn=pr.sub(wn)._perp()._unit(),Pn=!Pn);continue}X&&X.append(wn,Xn);const Br=wn.sub(Xn)._perp(),yr=Br.x/(Math.abs(Br.x)+Math.abs(Br.y)),Wi=Br.y>0?1:0,Zn=Xn.dist(wn);if(zn+Zn>32768&&(zn=0),We){Sn=pr.sub(wn)._perp()._unit();let Xi=j3(Xn,wn,pr,z3(nn,Sn),We);isNaN(Xi)&&(Xi=0);const bi=wn.sub(Xn)._unit();Xn=Xn.add(bi.mult(dn))._round(),wn=wn.add(bi.mult(-Xi))._round(),dn=Xi,nn=Sn}const ri=It.vertexLength,Ki=Tt.length>4&&V3(Xn,wn,pr);let is=q3(zn,qn,Pn);if(rs(this.layoutVertexArray,Xn.x,Xn.y,yr,Wi,0,0,is),rs(this.layoutVertexArray,Xn.x,Xn.y,yr,Wi,0,1,is),zn+=Zn,is=q3(zn,Ki,!Pn),qn=Ki,rs(this.layoutVertexArray,wn.x,wn.y,yr,Wi,0,0,is),rs(this.layoutVertexArray,wn.x,wn.y,yr,Wi,0,1,is),It.vertexLength+=4,this.indexArray.emplaceBack(ri+0,ri+1,ri+2),this.indexArray.emplaceBack(ri+1,ri+3,ri+2),It.primitiveLength+=2,We){const Xi=ct+(kn===1?Tt.length-2:kn-2),bi=kn===1?ct:Xi+1;if(this.indexArray.emplaceBack(ri+1,Xi,ri+3),this.indexArray.emplaceBack(Xi,bi,ri+3),It.primitiveLength+=2,sn===void 0&&(sn=ri),!U3(pr,Tt[kn],xt)){const ha=kn===Tt.length-1?sn:It.vertexLength;this.indexArray.emplaceBack(ri+2,ri+3,ha),this.indexArray.emplaceBack(ri+3,ha+1,ha),this.indexArray.emplaceBack(ri+3,bi,ha+1),It.primitiveLength+=3}Pn=!Pn}if(G){const Xi=this.layoutVertexExtArray,bi=M.projectTilePoint(Xn.x,Xn.y,p),ha=M.projectTilePoint(wn.x,wn.y,p),Zi=M.upVector(p,Xn.x,Xn.y),Yi=M.upVector(p,wn.x,wn.y);Gh(Xi,bi,Zi),Gh(Xi,bi,Zi),Gh(Xi,ha,Yi),Gh(Xi,ha,Yi)}}re&&(ct+=Tt.length-1)}}if(X&&X.polyCount.length>0){if(X.borders){X.vertexArrayOffset=this.centroidVertexArray.length;const at=X.borders,xt=this.featuresOnBorder.push(X)-1;for(let ct=0;ct<4;ct++)at[ct][0]!==Number.MAX_VALUE&&this.borders[ct].push(xt)}this.encodeCentroid(X.borders?void 0:X.centroid(),X)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,x,b,p)}sortBorders(){for(let r=0;r<4;r++)this.borders[r].sort(((l,h)=>this.featuresOnBorder[l].borders[r][0]-this.featuresOnBorder[h].borders[r][0]))}encodeCentroid(r,l,h=!0){let p,x;if(r)if(r.y!==0){const A=l.span()._mult(this.tileToMeter);p=(Math.max(r.x,1)<<3)+Math.min(7,Math.round(A.x/10)),x=(Math.max(r.y,1)<<3)+Math.min(7,Math.round(A.y/10))}else p=Math.ceil(7*(r.x+450)),x=0;else p=0,x=+h;let b=h?this.centroidVertexArray.length:l.vertexArrayOffset;for(const A of l.polyCount){h&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*A.edges+A.top);for(let P=0;P<A.top;P++)this.centroidVertexArray.emplace(b++,p,x);for(let P=0;P<2*A.edges;P++)this.centroidVertexArray.emplace(b++,0,x),this.centroidVertexArray.emplace(b++,p,x)}}}function z3(s,r){const l=s.add(r)._unit();return s.x*l.x+s.y*l.y}function dC(s,r,l,h){const p=r.sub(s)._perp()._unit(),x=l.sub(r)._perp()._unit();return j3(s,r,l,z3(p,x),h)}function j3(s,r,l,h,p){const x=Math.sqrt(1-h*h);return Math.min(s.dist(r)/3,r.dist(l)/3,p*x/h)}function U3(s,r,l){return s.x<l[0].x&&r.x<l[0].x||s.x>l[1].x&&r.x>l[1].x||s.y<l[0].y&&r.y<l[0].y||s.y>l[1].y&&r.y>l[1].y}function V3(s,r,l){if(s.x<0||s.x>=Wr||r.x<0||r.x>=Wr||l.x<0||l.x>=Wr)return!1;const h=l.sub(r),p=h.perp(),x=s.sub(r);return(h.x*x.x+h.y*x.y)/Math.sqrt((h.x*h.x+h.y*h.y)*(x.x*x.x+x.y*x.y))>-.866&&p.x*x.x+p.y*x.y<0}function q3(s,r,l){const h=r?2|s:-3&s;return l?1|h:-2&h}function $3(){const s=Math.PI/32,r=Math.tan(s),l=Lh;return l*Math.sqrt(1+2*r*r)-l}function G3(s,r,l){const h=1<<l.z,p=yc(l.x/h),x=yc((l.x+1)/h),b=Ho(l.y/h),A=Ho((l.y+1)/h);return(function(P,M,G,X,re=0,de){const ye=[];if(!P.length||!G||!X)return ye;const Se=(Tt,sn)=>{for(const nn of Tt)ye.push({polygon:nn,bounds:sn})},We=Math.ceil(Math.log2(G)),at=Math.ceil(Math.log2(X)),xt=We-at,ct=[];for(let Tt=0;Tt<Math.abs(xt);Tt++)ct.push(xt>0?0:1);for(let Tt=0;Tt<Math.min(We,at);Tt++)ct.push(0),ct.push(1);let vt=P;if(vt=Ni(vt,M[0].y-re,M[1].y+re,1),vt=Ni(vt,M[0].x-re,M[1].x+re,0),!vt.length)return ye;const It=[];for(ct.length?It.push({polygons:vt,bounds:M,depth:0}):Se(vt,M);It.length;){const Tt=It.pop(),sn=Tt.depth,nn=ct[sn],Sn=Tt.bounds[0],qn=Tt.bounds[1],dn=nn===0?Sn.x:Sn.y,Pn=nn===0?qn.x:qn.y,kn=de?de(nn,dn,Pn):.5*(dn+Pn),zn=Ni(Tt.polygons,dn-re,kn+re,nn),Xn=Ni(Tt.polygons,kn-re,Pn+re,nn);if(zn.length){const wn=[Sn,new q(nn===0?kn:qn.x,nn===1?kn:qn.y)];ct.length>sn+1?It.push({polygons:zn,bounds:wn,depth:sn+1}):Se(zn,wn)}if(Xn.length){const wn=[new q(nn===0?kn:Sn.x,nn===1?kn:Sn.y),qn];ct.length>sn+1?It.push({polygons:Xn,bounds:wn,depth:sn+1}):Se(Xn,wn)}}return ye})(s,r,Math.ceil((x-p)/11.25),Math.ceil((b-A)/11.25),1,((P,M,G)=>{if(P===0)return .5*(M+G);{const X=Ho((l.y+M/Wr)/h);return(Ys(.5*(Ho((l.y+G/Wr)/h)+X))*h-l.y)*Wr}}))}lr(ry,"FillExtrusionBucket",{omit:["layers","features"]}),lr(V_,"PartMetadata");const fC=new ot({"fill-extrusion-edge-radius":new _e(pn["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var pC={paint:new ot({"fill-extrusion-opacity":new _e(pn["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ge(pn["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new _e(pn["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new _e(pn["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ge(pn["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ge(pn["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ge(pn["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new _e(pn["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new _e(pn["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new _e(pn["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new _e(pn["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:fC};function H3(s,r,l){var h=2*Math.PI*6378137/256/Math.pow(2,l);return[s*h-2*Math.PI*6378137/2,r*h-2*Math.PI*6378137/2]}class q_{constructor(r,l,h){this.z=r,this.x=l,this.y=h,this.key=iy(0,r,r,l,h)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,l){const h=(function(x,b,A){var P=H3(256*x,256*(b=Math.pow(2,A)-b-1),A),M=H3(256*(x+1),256*(b+1),A);return P[0]+","+P[1]+","+M[0]+","+M[1]})(this.x,this.y,this.z),p=(function(x,b,A){let P,M="";for(let G=x;G>0;G--)P=1<<G-1,M+=(b&P?1:0)+(A&P?2:0);return M})(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",h)}toString(){return`${this.z}/${this.x}/${this.y}`}}class W3{constructor(r,l){this.wrap=r,this.canonical=l,this.key=iy(r,l.z,l.z,l.x,l.y)}}class sh{constructor(r,l,h,p,x){this.overscaledZ=r,this.wrap=l,this.canonical=new q_(h,+p,+x),this.key=l===0&&r===h?this.canonical.key:iy(l,r,h,p,x)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const l=this.canonical.z-r;return r>this.canonical.z?new sh(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new sh(r,this.wrap,r,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(r,l=!0){if(this.overscaledZ===r&&l)return this.key;if(r>this.canonical.z)return iy(this.wrap*+l,r,this.canonical.z,this.canonical.x,this.canonical.y);{const h=this.canonical.z-r;return iy(this.wrap*+l,r,r,this.canonical.x>>h,this.canonical.y>>h)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const l=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>l&&r.canonical.y===this.canonical.y>>l}children(r){if(this.overscaledZ>=r)return[new sh(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,h=2*this.canonical.x,p=2*this.canonical.y;return[new sh(l,this.wrap,l,h,p),new sh(l,this.wrap,l,h+1,p),new sh(l,this.wrap,l,h,p+1),new sh(l,this.wrap,l,h+1,p+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new sh(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new sh(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new W3(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function iy(s,r,l,h,p){const x=1<<Math.min(l,22);let b=x*(p%x)+h%x;return s&&l<22&&(b+=x*x*((s<0?-2*s-1:2*s)%(1<<2*(22-l)))),16*(32*b+l)+(r-l)}lr(q_,"CanonicalTileID"),lr(sh,"OverscaledTileID",{omit:["projMatrix"]});class kg extends q{constructor(r,l,h){super(r,l),this.z=h}}function oy(s,r){return s.x*r.x+s.y*r.y}function K3(s,r){if(s.length===1){let l=0;const h=r[l++];let p;for(;!p||h.equals(p);)if(p=r[l++],!p)return 1/0;for(;l<r.length;l++){const x=r[l],b=s[0],A=p.sub(h),P=x.sub(h),M=b.sub(h),G=oy(A,A),X=oy(A,P),re=oy(P,P),de=oy(M,A),ye=oy(M,P),Se=G*re-X*X,We=(re*de-X*ye)/Se,at=(G*ye-X*de)/Se,xt=h.z*(1-We-at)+p.z*We+x.z*at;if(isFinite(xt))return xt}return 1/0}{let l=1/0;for(const h of r)l=Math.min(l,h.z);return l}}function X3(s,r,l,h,p,x,b,A){const P=b*p.getElevationAt(s,r,!0,!0),M=x[0]!==0,G=M?x[1]===0?b*(x[0]/7-450):b*(function(X,re,de){const ye=Math.floor(re[0]/8),Se=Math.floor(re[1]/8),We=10*(re[0]-8*ye),at=10*(re[1]-8*Se),xt=X.getElevationAt(ye,Se,!0,!0),ct=X.getMeterToDEM(de),vt=Math.floor(.5*(We*ct-1)),It=Math.floor(.5*(at*ct-1)),Tt=X.tileCoordToPixel(ye,Se),sn=2*vt+1,nn=2*It+1,Sn=(function(Xn,wn,pr,Br,yr){return[Xn.getElevationAtPixel(wn,pr,!0),Xn.getElevationAtPixel(wn+yr,pr,!0),Xn.getElevationAtPixel(wn,pr+yr,!0),Xn.getElevationAtPixel(wn+Br,pr+yr,!0)]})(X,Tt.x-vt,Tt.y-It,sn,nn),qn=Math.abs(Sn[0]-Sn[1]),dn=Math.abs(Sn[2]-Sn[3]),Pn=Math.abs(Sn[0]-Sn[2])+Math.abs(Sn[1]-Sn[3]),kn=Math.min(.25,.5*ct*(qn+dn)/sn),zn=Math.min(.25,.5*ct*Pn/nn);return xt+Math.max(kn*We,zn*at)})(p,x,A):P;return{base:P+(l===0)?-1:l,top:M?Math.max(G+h,P+l+2):P+h}}const mC=kt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:gC}=mC,yC=kt([{name:"a_packed",components:4,type:"Float32"}]),{members:_C}=yC,vC=Ri.types,xC=Math.cos(Math.PI/180*37.5);class $_{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((l=>l.id)),this.index=r.index,this.projection=r.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((l=>{this.gradients[l.id]={}})),this.layoutVertexArray=new Wt,this.layoutVertexArray2=new In,this.indexArray=new _r,this.programConfigurations=new ju(r.layers,r.zoom),this.segments=new qa,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((l=>l.isStateDependent())).map((l=>l.id))}populate(r,l,h,p){this.hasPattern=d("line",this.layers,l);const x=this.layers[0].layout.get("line-sort-key"),b=[];for(const{feature:G,id:X,index:re,sourceLayerIndex:de}of r){const ye=this.layers[0]._featureFilter.needGeometry,Se=Id(G,ye);if(!this.layers[0]._featureFilter.filter(new $(this.zoom),Se,h))continue;const We=x?x.evaluate(Se,{},h):void 0,at={id:X,properties:G.properties,type:G.type,sourceLayerIndex:de,index:re,geometry:ye?Se.geometry:Su(G,h,p),patterns:{},sortKey:We};b.push(at)}x&&b.sort(((G,X)=>G.sortKey-X.sortKey));const{lineAtlas:A,featureIndex:P}=l,M=this.addConstantDashes(A);for(const G of b){const{geometry:X,index:re,sourceLayerIndex:de}=G;if(M&&this.addFeatureDashes(G,A),this.hasPattern){const ye=g("line",this.layers,G,this.zoom,l);this.patternFeatures.push(ye)}else this.addFeature(G,X,re,h,A.positions,l.availableImages);P.insert(r[re].feature,X,re,de,this.index)}}addConstantDashes(r){let l=!1;for(const h of this.layers){const p=h.paint.get("line-dasharray").value,x=h.layout.get("line-cap").value;if(p.kind!=="constant"||x.kind!=="constant")l=!0;else{const b=x.value,A=p.value;if(!A)continue;r.addDash(A,b)}}return l}addFeatureDashes(r,l){const h=this.zoom;for(const p of this.layers){const x=p.paint.get("line-dasharray").value,b=p.layout.get("line-cap").value;if(x.kind==="constant"&&b.kind==="constant")continue;let A,P;if(x.kind==="constant"){if(A=x.value,!A)continue}else A=x.evaluate({zoom:h},r);P=b.kind==="constant"?b.value:b.evaluate({zoom:h},r),l.addDash(A,P),r.patterns[p.id]=l.getKey(A,P)}}update(r,l,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,h,p)}addFeatures(r,l,h,p,x){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,l,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,_C)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,gC),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&r.properties.hasOwnProperty("mapbox_clip_start")&&r.properties.hasOwnProperty("mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,l,h,p,x,b){const A=this.layers[0].layout,P=A.get("line-join").evaluate(r,{}),M=A.get("line-cap").evaluate(r,{}),G=A.get("line-miter-limit"),X=A.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const re of l)this.addLine(re,r,P,M,G,X);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,x,b,p)}addLine(r,l,h,p,x,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let at=0;at<r.length-1;at++)this.totalDistance+=r[at].dist(r[at+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const A=vC[l.type]==="Polygon";let P=r.length;for(;P>=2&&r[P-1].equals(r[P-2]);)P--;let M=0;for(;M<P-1&&r[M].equals(r[M+1]);)M++;if(P<(A?3:2))return;h==="bevel"&&(x=1.05);const G=this.overscaling<=16?15*Wr/(512*this.overscaling):0,X=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray);let re,de,ye,Se,We;this.e1=this.e2=-1,A&&(re=r[P-2],We=r[M].sub(re)._unit()._perp());for(let at=M;at<P;at++){if(ye=at===P-1?A?r[M+1]:void 0:r[at+1],ye&&r[at].equals(ye))continue;We&&(Se=We),re&&(de=re),re=r[at],We=ye?ye.sub(re)._unit()._perp():Se,Se=Se||We;let xt=Se.add(We);xt.x===0&&xt.y===0||xt._unit();const ct=Se.x*We.x+Se.y*We.y,vt=xt.x*We.x+xt.y*We.y,It=vt!==0?1/vt:1/0,Tt=2*Math.sqrt(2-2*vt),sn=vt<xC&&de&&ye,nn=Se.x*We.y-Se.y*We.x>0;if(sn&&at>M){const dn=re.dist(de);if(dn>2*G){const Pn=re.sub(re.sub(de)._mult(G/dn)._round());this.updateDistance(de,Pn),this.addCurrentVertex(Pn,Se,0,0,X),de=Pn}}const Sn=de&&ye;let qn=Sn?h:A?"butt":p;if(Sn&&qn==="round"&&(It<b?qn="miter":It<=2&&(qn="fakeround")),qn==="miter"&&It>x&&(qn="bevel"),qn==="bevel"&&(It>2&&(qn="flipbevel"),It<x&&(qn="miter")),de&&this.updateDistance(de,re),qn==="miter")xt._mult(It),this.addCurrentVertex(re,xt,0,0,X);else if(qn==="flipbevel"){if(It>100)xt=We.mult(-1);else{const dn=It*Se.add(We).mag()/Se.sub(We).mag();xt._perp()._mult(dn*(nn?-1:1))}this.addCurrentVertex(re,xt,0,0,X),this.addCurrentVertex(re,xt.mult(-1),0,0,X)}else if(qn==="bevel"||qn==="fakeround"){const dn=-Math.sqrt(It*It-1),Pn=nn?dn:0,kn=nn?0:dn;if(de&&this.addCurrentVertex(re,Se,Pn,kn,X),qn==="fakeround"){const zn=Math.round(180*Tt/Math.PI/20);for(let Xn=1;Xn<zn;Xn++){let wn=Xn/zn;if(wn!==.5){const Br=wn-.5;wn+=wn*Br*(wn-1)*((1.0904+ct*(ct*(3.55645-1.43519*ct)-3.2452))*Br*Br+(.848013+ct*(.215638*ct-1.06021)))}const pr=We.sub(Se)._mult(wn)._add(Se)._unit()._mult(nn?-1:1);this.addHalfVertex(re,pr.x,pr.y,!1,nn,0,X)}}ye&&this.addCurrentVertex(re,We,-Pn,-kn,X)}else if(qn==="butt")this.addCurrentVertex(re,xt,0,0,X);else if(qn==="square"){const dn=de?1:-1;de||this.addCurrentVertex(re,xt,dn,dn,X),this.addCurrentVertex(re,xt,0,0,X),de&&this.addCurrentVertex(re,xt,dn,dn,X)}else qn==="round"&&(de&&(this.addCurrentVertex(re,Se,0,0,X),this.addCurrentVertex(re,Se,1,1,X,!0)),ye&&(this.addCurrentVertex(re,We,-1,-1,X,!0),this.addCurrentVertex(re,We,0,0,X)));if(sn&&at<P-1){const dn=re.dist(ye);if(dn>2*G){const Pn=re.add(ye.sub(re)._mult(G/dn)._round());this.updateDistance(re,Pn),this.addCurrentVertex(Pn,We,0,0,X),re=Pn}}}}addCurrentVertex(r,l,h,p,x,b=!1){const A=l.y*p-l.x,P=-l.y-l.x*p;this.addHalfVertex(r,l.x+l.y*h,l.y-l.x*h,b,!1,h,x),this.addHalfVertex(r,A,P,b,!0,-p,x)}addHalfVertex({x:r,y:l},h,p,x,b,A,P){this.layoutVertexArray.emplaceBack((r<<1)+(x?1:0),(l<<1)+(b?1:0),Math.round(63*h)+128,Math.round(63*p)+128,1+(A===0?0:A<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const M=P.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,M),P.primitiveLength++),b?this.e2=M:this.e1=M}updateScaledDistance(){if(this.lineClips){const r=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=r*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(r,l){this.distance+=r.dist(l),this.updateScaledDistance()}}lr($_,"LineBucket",{omit:["layers","patternFeatures"]});const bC=new ot({"line-cap":new Ge(pn.layout_line["line-cap"]),"line-join":new Ge(pn.layout_line["line-join"]),"line-miter-limit":new _e(pn.layout_line["line-miter-limit"]),"line-round-limit":new _e(pn.layout_line["line-round-limit"]),"line-sort-key":new Ge(pn.layout_line["line-sort-key"])});var Z3={paint:new ot({"line-opacity":new Ge(pn.paint_line["line-opacity"]),"line-color":new Ge(pn.paint_line["line-color"]),"line-translate":new _e(pn.paint_line["line-translate"]),"line-translate-anchor":new _e(pn.paint_line["line-translate-anchor"]),"line-width":new Ge(pn.paint_line["line-width"]),"line-gap-width":new Ge(pn.paint_line["line-gap-width"]),"line-offset":new Ge(pn.paint_line["line-offset"]),"line-blur":new Ge(pn.paint_line["line-blur"]),"line-dasharray":new Ge(pn.paint_line["line-dasharray"]),"line-pattern":new Ge(pn.paint_line["line-pattern"]),"line-gradient":new it(pn.paint_line["line-gradient"]),"line-trim-offset":new _e(pn.paint_line["line-trim-offset"])}),layout:bC};const Y3=new class extends Ge{possiblyEvaluate(s,r){return r=new $(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,transition:r.transition}),super.possiblyEvaluate(s,r)}evaluate(s,r,l,h){return r=Oe({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(s,r,l,h)}}(Z3.paint.properties["line-width"].specification);function J3(s,r){return r>0?r+2*s:s}Y3.useIntegerZoom=!0;const wC=kt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),SC=kt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),EC=kt([{name:"a_projected_pos",components:4,type:"Float32"}],4);kt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const AC=kt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),TC=kt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);kt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Q3=kt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),IC=kt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);kt([{name:"triangle",components:3,type:"Uint16"}]),kt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),kt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),kt([{type:"Float32",name:"offsetX"}]),kt([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var du=24;const Vd=128;function Tx(s,r){const{expression:l}=r;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new $(s+1))};if(l.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:p}=l;let x=0;for(;x<h.length&&h[x]<=s;)x++;x=Math.max(0,x-1);let b=x;for(;b<h.length&&h[b]<s+1;)b++;b=Math.min(h.length-1,b);const A=h[x],P=h[b];return l.kind==="composite"?{kind:"composite",minZoom:A,maxZoom:P,interpolationType:p}:{kind:"camera",minZoom:A,maxZoom:P,minSize:l.evaluate(new $(A)),maxSize:l.evaluate(new $(P)),interpolationType:p}}}function G_(s,{uSize:r,uSizeT:l},{lowerSize:h,upperSize:p}){return s.kind==="source"?h/Vd:s.kind==="composite"?He(h/Vd,p/Vd,l):r}function Mg(s,r){let l=0,h=0;if(s.kind==="constant")h=s.layoutSize;else if(s.kind!=="source"){const{interpolationType:p,minZoom:x,maxZoom:b}=s,A=p?De(ma.interpolationFactor(p,r,x,b),0,1):0;s.kind==="camera"?h=He(s.minSize,s.maxSize,A):l=A}return{uSizeT:l,uSize:h}}var CC=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Vd,evaluateSizeForFeature:G_,evaluateSizeForZoom:Mg,getSizeData:Tx});function LC(s,r,l){return s.sections.forEach((h=>{h.text=(function(p,x,b){const A=x.layout.get("text-transform").evaluate(b,{});return A==="uppercase"?p=p.toLocaleUpperCase():A==="lowercase"&&(p=p.toLocaleLowerCase()),z.applyArabicShaping&&(p=z.applyArabicShaping(p)),p})(h.text,r,l)})),s}const sy={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function PC(s){return s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""}function kC(s){return s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""}var e4=Js,t4=function(s,r,l,h,p){var x,b,A=8*p-h-1,P=(1<<A)-1,M=P>>1,G=-7,X=p-1,re=-1,de=s[r+X];for(X+=re,x=de&(1<<-G)-1,de>>=-G,G+=A;G>0;x=256*x+s[r+X],X+=re,G-=8);for(b=x&(1<<-G)-1,x>>=-G,G+=h;G>0;b=256*b+s[r+X],X+=re,G-=8);if(x===0)x=1-M;else{if(x===P)return b?NaN:1/0*(de?-1:1);b+=Math.pow(2,h),x-=M}return(de?-1:1)*b*Math.pow(2,x-h)},n4=function(s,r,l,h,p,x){var b,A,P,M=8*x-p-1,G=(1<<M)-1,X=G>>1,re=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,de=0,ye=1,Se=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(A=isNaN(r)?1:0,b=G):(b=Math.floor(Math.log(r)/Math.LN2),r*(P=Math.pow(2,-b))<1&&(b--,P*=2),(r+=b+X>=1?re/P:re*Math.pow(2,1-X))*P>=2&&(b++,P/=2),b+X>=G?(A=0,b=G):b+X>=1?(A=(r*P-1)*Math.pow(2,p),b+=X):(A=r*Math.pow(2,X-1)*Math.pow(2,p),b=0));p>=8;s[l+de]=255&A,de+=ye,A/=256,p-=8);for(b=b<<p|A,M+=p;M>0;s[l+de]=255&b,de+=ye,b/=256,M-=8);s[l+de-ye]|=128*Se};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Js(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}Js.Varint=0,Js.Fixed64=1,Js.Bytes=2,Js.Fixed32=5;var Ix=4294967296,r4=1/Ix,i4=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function lp(s){return s.type===Js.Bytes?s.readVarint()+s.pos:s.pos+1}function Rg(s,r,l){return l?4294967296*r+(s>>>0):4294967296*(r>>>0)+(s>>>0)}function o4(s,r,l){var h=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));l.realloc(h);for(var p=l.pos-1;p>=s;p--)l.buf[p+h]=l.buf[p]}function MC(s,r){for(var l=0;l<s.length;l++)r.writeVarint(s[l])}function RC(s,r){for(var l=0;l<s.length;l++)r.writeSVarint(s[l])}function NC(s,r){for(var l=0;l<s.length;l++)r.writeFloat(s[l])}function DC(s,r){for(var l=0;l<s.length;l++)r.writeDouble(s[l])}function FC(s,r){for(var l=0;l<s.length;l++)r.writeBoolean(s[l])}function OC(s,r){for(var l=0;l<s.length;l++)r.writeFixed32(s[l])}function BC(s,r){for(var l=0;l<s.length;l++)r.writeSFixed32(s[l])}function zC(s,r){for(var l=0;l<s.length;l++)r.writeFixed64(s[l])}function jC(s,r){for(var l=0;l<s.length;l++)r.writeSFixed64(s[l])}function H_(s,r){return(s[r]|s[r+1]<<8|s[r+2]<<16)+16777216*s[r+3]}function Ng(s,r,l){s[l]=r,s[l+1]=r>>>8,s[l+2]=r>>>16,s[l+3]=r>>>24}function s4(s,r){return(s[r]|s[r+1]<<8|s[r+2]<<16)+(s[r+3]<<24)}Js.prototype={destroy:function(){this.buf=null},readFields:function(s,r,l){for(l=l||this.length;this.pos<l;){var h=this.readVarint(),p=h>>3,x=this.pos;this.type=7&h,s(p,r,this),this.pos===x&&this.skip(h)}return r},readMessage:function(s,r){return this.readFields(s,r,this.readVarint()+this.pos)},readFixed32:function(){var s=H_(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=s4(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=H_(this.buf,this.pos)+H_(this.buf,this.pos+4)*Ix;return this.pos+=8,s},readSFixed64:function(){var s=H_(this.buf,this.pos)+s4(this.buf,this.pos+4)*Ix;return this.pos+=8,s},readFloat:function(){var s=t4(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=t4(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var r,l,h=this.buf;return r=127&(l=h[this.pos++]),l<128?r:(r|=(127&(l=h[this.pos++]))<<7,l<128?r:(r|=(127&(l=h[this.pos++]))<<14,l<128?r:(r|=(127&(l=h[this.pos++]))<<21,l<128?r:(function(p,x,b){var A,P,M=b.buf;if(A=(112&(P=M[b.pos++]))>>4,P<128||(A|=(127&(P=M[b.pos++]))<<3,P<128)||(A|=(127&(P=M[b.pos++]))<<10,P<128)||(A|=(127&(P=M[b.pos++]))<<17,P<128)||(A|=(127&(P=M[b.pos++]))<<24,P<128)||(A|=(1&(P=M[b.pos++]))<<31,P<128))return Rg(p,A,x);throw new Error("Expected varint not more than 10 bytes")})(r|=(15&(l=h[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var s=this.readVarint()+this.pos,r=this.pos;return this.pos=s,s-r>=12&&i4?(function(l,h,p){return i4.decode(l.subarray(h,p))})(this.buf,r,s):(function(l,h,p){for(var x="",b=h;b<p;){var A,P,M,G=l[b],X=null,re=G>239?4:G>223?3:G>191?2:1;if(b+re>p)break;re===1?G<128&&(X=G):re===2?(192&(A=l[b+1]))==128&&(X=(31&G)<<6|63&A)<=127&&(X=null):re===3?(P=l[b+2],(192&(A=l[b+1]))==128&&(192&P)==128&&((X=(15&G)<<12|(63&A)<<6|63&P)<=2047||X>=55296&&X<=57343)&&(X=null)):re===4&&(P=l[b+2],M=l[b+3],(192&(A=l[b+1]))==128&&(192&P)==128&&(192&M)==128&&((X=(15&G)<<18|(63&A)<<12|(63&P)<<6|63&M)<=65535||X>=1114112)&&(X=null)),X===null?(X=65533,re=1):X>65535&&(X-=65536,x+=String.fromCharCode(X>>>10&1023|55296),X=56320|1023&X),x+=String.fromCharCode(X),b+=re}return x})(this.buf,r,s)},readBytes:function(){var s=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,s);return this.pos=s,r},readPackedVarint:function(s,r){if(this.type!==Js.Bytes)return s.push(this.readVarint(r));var l=lp(this);for(s=s||[];this.pos<l;)s.push(this.readVarint(r));return s},readPackedSVarint:function(s){if(this.type!==Js.Bytes)return s.push(this.readSVarint());var r=lp(this);for(s=s||[];this.pos<r;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==Js.Bytes)return s.push(this.readBoolean());var r=lp(this);for(s=s||[];this.pos<r;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==Js.Bytes)return s.push(this.readFloat());var r=lp(this);for(s=s||[];this.pos<r;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==Js.Bytes)return s.push(this.readDouble());var r=lp(this);for(s=s||[];this.pos<r;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==Js.Bytes)return s.push(this.readFixed32());var r=lp(this);for(s=s||[];this.pos<r;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==Js.Bytes)return s.push(this.readSFixed32());var r=lp(this);for(s=s||[];this.pos<r;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==Js.Bytes)return s.push(this.readFixed64());var r=lp(this);for(s=s||[];this.pos<r;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==Js.Bytes)return s.push(this.readSFixed64());var r=lp(this);for(s=s||[];this.pos<r;)s.push(this.readSFixed64());return s},skip:function(s){var r=7&s;if(r===Js.Varint)for(;this.buf[this.pos++]>127;);else if(r===Js.Bytes)this.pos=this.readVarint()+this.pos;else if(r===Js.Fixed32)this.pos+=4;else{if(r!==Js.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(s,r){this.writeVarint(s<<3|r)},realloc:function(s){for(var r=this.length||16;r<this.pos+s;)r*=2;if(r!==this.length){var l=new Uint8Array(r);l.set(this.buf),this.buf=l,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),Ng(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),Ng(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),Ng(this.buf,-1&s,this.pos),Ng(this.buf,Math.floor(s*r4),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),Ng(this.buf,-1&s,this.pos),Ng(this.buf,Math.floor(s*r4),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?(function(r,l){var h,p;if(r>=0?(h=r%4294967296|0,p=r/4294967296|0):(p=~(-r/4294967296),4294967295^(h=~(-r%4294967296))?h=h+1|0:(h=0,p=p+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),(function(x,b,A){A.buf[A.pos++]=127&x|128,x>>>=7,A.buf[A.pos++]=127&x|128,x>>>=7,A.buf[A.pos++]=127&x|128,x>>>=7,A.buf[A.pos++]=127&x|128,A.buf[A.pos]=127&(x>>>=7)})(h,0,l),(function(x,b){var A=(7&x)<<4;b.buf[b.pos++]|=A|((x>>>=3)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x)))))})(p,l)})(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(!!s)},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var r=this.pos;this.pos=(function(h,p,x){for(var b,A,P=0;P<p.length;P++){if((b=p.charCodeAt(P))>55295&&b<57344){if(!A){b>56319||P+1===p.length?(h[x++]=239,h[x++]=191,h[x++]=189):A=b;continue}if(b<56320){h[x++]=239,h[x++]=191,h[x++]=189,A=b;continue}b=A-55296<<10|b-56320|65536,A=null}else A&&(h[x++]=239,h[x++]=191,h[x++]=189,A=null);b<128?h[x++]=b:(b<2048?h[x++]=b>>6|192:(b<65536?h[x++]=b>>12|224:(h[x++]=b>>18|240,h[x++]=b>>12&63|128),h[x++]=b>>6&63|128),h[x++]=63&b|128)}return x})(this.buf,s,this.pos);var l=this.pos-r;l>=128&&o4(r,l,this),this.pos=r-1,this.writeVarint(l),this.pos+=l},writeFloat:function(s){this.realloc(4),n4(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),n4(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var r=s.length;this.writeVarint(r),this.realloc(r);for(var l=0;l<r;l++)this.buf[this.pos++]=s[l]},writeRawMessage:function(s,r){this.pos++;var l=this.pos;s(r,this);var h=this.pos-l;h>=128&&o4(l,h,this),this.pos=l-1,this.writeVarint(h),this.pos+=h},writeMessage:function(s,r,l){this.writeTag(s,Js.Bytes),this.writeRawMessage(r,l)},writePackedVarint:function(s,r){r.length&&this.writeMessage(s,MC,r)},writePackedSVarint:function(s,r){r.length&&this.writeMessage(s,RC,r)},writePackedBoolean:function(s,r){r.length&&this.writeMessage(s,FC,r)},writePackedFloat:function(s,r){r.length&&this.writeMessage(s,NC,r)},writePackedDouble:function(s,r){r.length&&this.writeMessage(s,DC,r)},writePackedFixed32:function(s,r){r.length&&this.writeMessage(s,OC,r)},writePackedSFixed32:function(s,r){r.length&&this.writeMessage(s,BC,r)},writePackedFixed64:function(s,r){r.length&&this.writeMessage(s,zC,r)},writePackedSFixed64:function(s,r){r.length&&this.writeMessage(s,jC,r)},writeBytesField:function(s,r){this.writeTag(s,Js.Bytes),this.writeBytes(r)},writeFixed32Field:function(s,r){this.writeTag(s,Js.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(s,r){this.writeTag(s,Js.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(s,r){this.writeTag(s,Js.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(s,r){this.writeTag(s,Js.Fixed64),this.writeSFixed64(r)},writeVarintField:function(s,r){this.writeTag(s,Js.Varint),this.writeVarint(r)},writeSVarintField:function(s,r){this.writeTag(s,Js.Varint),this.writeSVarint(r)},writeStringField:function(s,r){this.writeTag(s,Js.Bytes),this.writeString(r)},writeFloatField:function(s,r){this.writeTag(s,Js.Fixed32),this.writeFloat(r)},writeDoubleField:function(s,r){this.writeTag(s,Js.Fixed64),this.writeDouble(r)},writeBooleanField:function(s,r){this.writeVarintField(s,!!r)}};var W_=ue(e4);const Cx=3;function UC(s,r,l){r.glyphs=[],s===1&&l.readMessage(VC,r)}function VC(s,r,l){if(s===3){const{id:h,bitmap:p,width:x,height:b,left:A,top:P,advance:M}=l.readMessage(qC,{});r.glyphs.push({id:h,bitmap:new oh({width:x+2*Cx,height:b+2*Cx},p),metrics:{width:x,height:b,left:A,top:P,advance:M}})}else s===4?r.ascender=l.readSVarint():s===5&&(r.descender=l.readSVarint())}function qC(s,r,l){s===1?r.id=l.readVarint():s===2?r.bitmap=l.readBytes():s===3?r.width=l.readVarint():s===4?r.height=l.readVarint():s===5?r.left=l.readSVarint():s===6?r.top=l.readSVarint():s===7&&(r.advance=l.readVarint())}const a4=Cx;function Lx(s){let r=0,l=0;for(const b of s)r+=b.w*b.h,l=Math.max(l,b.w);s.sort(((b,A)=>A.h-b.h));const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),l),h:1/0}];let p=0,x=0;for(const b of s)for(let A=h.length-1;A>=0;A--){const P=h[A];if(!(b.w>P.w||b.h>P.h)){if(b.x=P.x,b.y=P.y,x=Math.max(x,b.y+b.h),p=Math.max(p,b.x+b.w),b.w===P.w&&b.h===P.h){const M=h.pop();A<h.length&&(h[A]=M)}else b.h===P.h?(P.x+=b.w,P.w-=b.w):b.w===P.w?(P.y+=b.h,P.h-=b.h):(h.push({x:P.x+b.w,y:P.y,w:P.w-b.w,h:b.h}),P.y+=b.h,P.h-=b.h);break}}return{w:p,h:x,fill:r/(p*x)||0}}const Ph=1;class Px{constructor(r,{pixelRatio:l,version:h,stretchX:p,stretchY:x,content:b}){this.paddedRect=r,this.pixelRatio=l,this.stretchX=p,this.stretchY=x,this.content=b,this.version=h}get tl(){return[this.paddedRect.x+Ph,this.paddedRect.y+Ph]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ph,this.paddedRect.y+this.paddedRect.h-Ph]}get displaySize(){return[(this.paddedRect.w-2*Ph)/this.pixelRatio,(this.paddedRect.h-2*Ph)/this.pixelRatio]}}class l4{constructor(r,l){const h={},p={};this.haveRenderCallbacks=[];const x=[];this.addImages(r,h,x),this.addImages(l,p,x);const{w:b,h:A}=Lx(x),P=new qu({width:b||1,height:A||1});for(const M in r){const G=r[M],X=h[M].paddedRect;qu.copy(G.data,P,{x:0,y:0},{x:X.x+Ph,y:X.y+Ph},G.data)}for(const M in l){const G=l[M],X=p[M].paddedRect,re=X.x+Ph,de=X.y+Ph,ye=G.data.width,Se=G.data.height;qu.copy(G.data,P,{x:0,y:0},{x:re,y:de},G.data),qu.copy(G.data,P,{x:0,y:Se-1},{x:re,y:de-1},{width:ye,height:1}),qu.copy(G.data,P,{x:0,y:0},{x:re,y:de+Se},{width:ye,height:1}),qu.copy(G.data,P,{x:ye-1,y:0},{x:re-1,y:de},{width:1,height:Se}),qu.copy(G.data,P,{x:0,y:0},{x:re+ye,y:de},{width:1,height:Se})}this.image=P,this.iconPositions=h,this.patternPositions=p}addImages(r,l,h){for(const p in r){const x=r[p],b={x:0,y:0,w:x.data.width+2*Ph,h:x.data.height+2*Ph};h.push(b),l[p]=new Px(b,x),x.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(r,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((h=>r.hasImage(h))),r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const h in r.updatedImages)this.patchUpdatedImage(this.iconPositions[h],r.getImage(h),l),this.patchUpdatedImage(this.patternPositions[h],r.getImage(h),l)}patchUpdatedImage(r,l,h){if(!r||!l||r.version===l.version)return;r.version=l.version;const[p,x]=r.tl;h.update(l.data,void 0,{x:p,y:x})}}lr(Px,"ImagePosition"),lr(l4,"ImageAtlas");const cd={horizontal:1,vertical:2,horizontalOnly:3},c4=-17;class ay{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,l){const h=new ay;return h.scale=r||1,h.fontStack=l,h}static forImage(r){const l=new ay;return l.imageName=r,l}}class Dg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,l){const h=new Dg;for(let p=0;p<r.sections.length;p++){const x=r.sections[p];x.image?h.addImageSection(x):h.addTextSection(x,l)}return h}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(r){this.text=(function(l,h){let p="";for(let x=0;x<l.length;x++){const b=l.charCodeAt(x+1)||null,A=l.charCodeAt(x-1)||null;p+=!h&&(b&&tt(b)&&!sy[l[x+1]]||A&&tt(A)&&!sy[l[x-1]])||!sy[l[x]]?l[x]:sy[l[x]]}return p})(this.text,r)}trim(){let r=0;for(let h=0;h<this.text.length&&K_[this.text.charCodeAt(h)];h++)r++;let l=this.text.length;for(let h=this.text.length-1;h>=0&&h>=r&&K_[this.text.charCodeAt(h)];h--)l--;this.text=this.text.substring(r,l),this.sectionIndex=this.sectionIndex.slice(r,l)}substring(r,l){const h=new Dg;return h.text=this.text.substring(r,l),h.sectionIndex=this.sectionIndex.slice(r,l),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((r,l)=>Math.max(r,this.sections[l].scale)),0)}addTextSection(r,l){this.text+=r.text,this.sections.push(ay.forText(r.scale,r.fontStack||l));const h=this.sections.length-1;for(let p=0;p<r.text.length;++p)this.sectionIndex.push(h)}addImageSection(r){const l=r.image?r.image.name:"";if(l.length===0)return void fr("Can't add FormattedSection with an empty image.");const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCharCode(h),this.sections.push(ay.forImage(l)),this.sectionIndex.push(this.sections.length-1)):fr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function kx(s,r,l,h,p,x,b,A,P,M,G,X,re,de,ye){const Se=Dg.fromFeature(s,p);X===cd.vertical&&Se.verticalizePunctuation(re);let We=[];const at=(function(Tt,sn,nn,Sn,qn,dn){if(!Tt)return[];const Pn=[],kn=(function(pr,Br,yr,Wi,Zn,ri){let Ki=0;for(let is=0;is<pr.length();is++){const Xi=pr.getSection(is);Ki+=u4(pr.getCharCode(is),Xi,Wi,Zn,Br,ri)}return Ki/Math.max(1,Math.ceil(Ki/yr))})(Tt,sn,nn,Sn,qn,dn),zn=Tt.text.indexOf("")>=0;let Xn=0;for(let pr=0;pr<Tt.length();pr++){const Br=Tt.getSection(pr),yr=Tt.getCharCode(pr);if(K_[yr]||(Xn+=u4(yr,Br,Sn,qn,sn,dn)),pr<Tt.length()-1){const Wi=!((wn=yr)<11904||!(oe["Bopomofo Extended"](wn)||oe.Bopomofo(wn)||oe["CJK Compatibility Forms"](wn)||oe["CJK Compatibility Ideographs"](wn)||oe["CJK Compatibility"](wn)||oe["CJK Radicals Supplement"](wn)||oe["CJK Strokes"](wn)||oe["CJK Symbols and Punctuation"](wn)||oe["CJK Unified Ideographs Extension A"](wn)||oe["CJK Unified Ideographs"](wn)||oe["Enclosed CJK Letters and Months"](wn)||oe["Halfwidth and Fullwidth Forms"](wn)||oe.Hiragana(wn)||oe["Ideographic Description Characters"](wn)||oe["Kangxi Radicals"](wn)||oe["Katakana Phonetic Extensions"](wn)||oe.Katakana(wn)||oe["Vertical Forms"](wn)||oe["Yi Radicals"](wn)||oe["Yi Syllables"](wn)));($C[yr]||Wi||Br.imageName)&&Pn.push(d4(pr+1,Xn,kn,Pn,GC(yr,Tt.getCharCode(pr+1),Wi&&zn),!1))}}var wn;return f4(d4(Tt.length(),Xn,kn,Pn,0,!0))})(Se,M,x,r,h,de),{processBidirectionalText:xt,processStyledBidirectionalText:ct}=z;if(xt&&Se.sections.length===1){const Tt=xt(Se.toString(),at);for(const sn of Tt){const nn=new Dg;nn.text=sn,nn.sections=Se.sections;for(let Sn=0;Sn<sn.length;Sn++)nn.sectionIndex.push(0);We.push(nn)}}else if(ct){const Tt=ct(Se.text,Se.sectionIndex,at);for(const sn of Tt){const nn=new Dg;nn.text=sn[0],nn.sectionIndex=sn[1],nn.sections=Se.sections,We.push(nn)}}else We=(function(Tt,sn){const nn=[],Sn=Tt.text;let qn=0;for(const dn of sn)nn.push(Tt.substring(qn,dn)),qn=dn;return qn<Sn.length&&nn.push(Tt.substring(qn,Sn.length)),nn})(Se,at);const vt=[],It={positionedLines:vt,text:Se.toString(),top:G[1],bottom:G[1],left:G[0],right:G[0],writingMode:X,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return(function(Tt,sn,nn,Sn,qn,dn,Pn,kn,zn,Xn,wn,pr){let Br=0,yr=0,Wi=0;const Zn=kn==="right"?1:kn==="left"?0:.5;let ri=!1;for(const Zi of qn){const Yi=Zi.getSections();for(const Ds of Yi){if(Ds.imageName)continue;const Qs=sn[Ds.fontStack];if(Qs&&(ri=Qs.ascender!==void 0&&Qs.descender!==void 0,!ri))break}if(!ri)break}let Ki=0;for(const Zi of qn){Zi.trim();const Yi=Zi.getMaxScale(),Ds=(Yi-1)*du,Qs={positionedGlyphs:[],lineOffset:0};Tt.positionedLines[Ki]=Qs;const ea=Qs.positionedGlyphs;let Fs=0;if(!Zi.length()){yr+=dn,++Ki;continue}let Ha=0,xl=0;for(let Os=0;Os<Zi.length();Os++){const _c=Zi.getSection(Os),Wl=Zi.getSectionIndex(Os),sl=Zi.getCharCode(Os);let ls=_c.scale,Kl=null,ta=null,ah=null,Xl=du,fu=0;const Xc=!(zn===cd.horizontal||!wn&&!Ye(sl)||wn&&(K_[sl]||(is=sl,oe.Arabic(is)||oe["Arabic Supplement"](is)||oe["Arabic Extended-A"](is)||oe["Arabic Presentation Forms-A"](is)||oe["Arabic Presentation Forms-B"](is))));if(_c.imageName){const lh=Sn[_c.imageName];if(!lh)continue;ah=_c.imageName,Tt.iconsInText=Tt.iconsInText||!0,ta=lh.paddedRect;const Zc=lh.displaySize;ls=ls*du/pr,Kl={width:Zc[0],height:Zc[1],left:Ph,top:-a4,advance:Xc?Zc[1]:Zc[0],localGlyph:!1},fu=ri?-Kl.height*ls:c4+Yi*du-Zc[1]*ls,Xl=Kl.advance;const Gd=(Xc?Zc[0]:Zc[1])*ls-du*Yi;Gd>0&&Gd>Fs&&(Fs=Gd)}else{const lh=nn[_c.fontStack];if(!lh)continue;lh[sl]&&(ta=lh[sl]);const Zc=sn[_c.fontStack];if(!Zc)continue;const Gd=Zc.glyphs[sl];if(!Gd)continue;if(Kl=Gd.metrics,Xl=sl!==8203?du:0,ri){const Vg=Zc.ascender!==void 0?Math.abs(Zc.ascender):0,yy=Zc.descender!==void 0?Math.abs(Zc.descender):0,_y=(Vg+yy)*ls;Ha<_y&&(Ha=_y,xl=(Vg-yy)/2*ls),fu=-Vg*ls}else fu=c4+(Yi-ls)*du}Xc?(Tt.verticalizable=!0,ea.push({glyph:sl,imageName:ah,x:Br,y:yr+fu,vertical:Xc,scale:ls,localGlyph:Kl.localGlyph,fontStack:_c.fontStack,sectionIndex:Wl,metrics:Kl,rect:ta}),Br+=Xl*ls+Xn):(ea.push({glyph:sl,imageName:ah,x:Br,y:yr+fu,vertical:Xc,scale:ls,localGlyph:Kl.localGlyph,fontStack:_c.fontStack,sectionIndex:Wl,metrics:Kl,rect:ta}),Br+=Kl.advance*ls+Xn)}ea.length!==0&&(Wi=Math.max(Br-Xn,Wi),ri?p4(ea,Zn,Fs,xl,dn*Yi/2):p4(ea,Zn,Fs,0,dn/2)),Br=0;const Hl=dn*Yi+Fs;Qs.lineOffset=Math.max(Fs,Ds),yr+=Hl,++Ki}var is;const Xi=yr,{horizontalAlign:bi,verticalAlign:ha}=Mx(Pn);(function(Zi,Yi,Ds,Qs,ea,Fs){const Ha=(Yi-Ds)*ea,xl=-Fs*Qs;for(const Hl of Zi)for(const Os of Hl.positionedGlyphs)Os.x+=Ha,Os.y+=xl})(Tt.positionedLines,Zn,bi,ha,Wi,Xi),Tt.top+=-ha*Xi,Tt.bottom=Tt.top+Xi,Tt.left+=-bi*Wi,Tt.right=Tt.left+Wi,Tt.hasBaseline=ri})(It,r,l,h,We,b,A,P,X,M,re,ye),!(function(Tt){for(const sn of Tt)if(sn.positionedGlyphs.length!==0)return!1;return!0})(vt)&&It}const K_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},$C={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function u4(s,r,l,h,p,x){if(r.imageName){const b=h[r.imageName];return b?b.displaySize[0]*r.scale*du/x+p:0}{const b=l[r.fontStack],A=b&&b.glyphs[s];return A?A.metrics.advance*r.scale+p:0}}function h4(s,r,l,h){const p=Math.pow(s-r,2);return h?s<r?p/2:2*p:p+Math.abs(l)*l}function GC(s,r,l){let h=0;return s===10&&(h-=1e4),l&&(h+=150),s!==40&&s!==65288||(h+=50),r!==41&&r!==65289||(h+=50),h}function d4(s,r,l,h,p,x){let b=null,A=h4(r,l,p,x);for(const P of h){const M=h4(r-P.x,l,p,x)+P.badness;M<=A&&(b=P,A=M)}return{index:s,x:r,priorBreak:b,badness:A}}function f4(s){return s?f4(s.priorBreak).concat(s.index):[]}function Mx(s){let r=.5,l=.5;switch(s){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:r,verticalAlign:l}}function p4(s,r,l,h,p){if(!(r||l||h||p))return;const x=s.length-1,b=s[x],A=(b.x+b.metrics.advance*b.scale)*r;for(let P=0;P<=x;P++)s[P].x-=A,s[P].y+=l+h+p}function HC(s,r,l){const{horizontalAlign:h,verticalAlign:p}=Mx(l),x=r[0]-s.displaySize[0]*h,b=r[1]-s.displaySize[1]*p;return{image:s,top:b,bottom:b+s.displaySize[1],left:x,right:x+s.displaySize[0]}}function m4(s,r,l,h,p,x){const b=s.image;let A;if(b.content){const We=b.content,at=b.pixelRatio||1;A=[We[0]/at,We[1]/at,b.displaySize[0]-We[2]/at,b.displaySize[1]-We[3]/at]}const P=r.left*x,M=r.right*x;let G,X,re,de;l==="width"||l==="both"?(de=p[0]+P-h[3],X=p[0]+M+h[1]):(de=p[0]+(P+M-b.displaySize[0])/2,X=de+b.displaySize[0]);const ye=r.top*x,Se=r.bottom*x;return l==="height"||l==="both"?(G=p[1]+ye-h[0],re=p[1]+Se+h[2]):(G=p[1]+(ye+Se-b.displaySize[1])/2,re=G+b.displaySize[1]),{image:b,top:G,right:X,bottom:re,left:de,collisionPadding:A}}class cp extends q{constructor(r,l,h,p,x){super(r,l),this.angle=p,this.z=h,x!==void 0&&(this.segment=x)}clone(){return new cp(this.x,this.y,this.z,this.angle,this.segment)}}function g4(s,r,l,h,p){if(r.segment===void 0)return!0;let x=r,b=r.segment+1,A=0;for(;A>-l/2;){if(b--,b<0)return!1;A-=s[b].dist(x),x=s[b]}A+=s[b].dist(s[b+1]),b++;const P=[];let M=0;for(;A<l/2;){const G=s[b],X=s[b+1];if(!X)return!1;let re=s[b-1].angleTo(G)-G.angleTo(X);for(re=Math.abs((re+3*Math.PI)%(2*Math.PI)-Math.PI),P.push({distance:A,angleDelta:re}),M+=re;A-P[0].distance>h;)M-=P.shift().angleDelta;if(M>p)return!1;b++,A+=G.dist(X)}return!0}function y4(s){let r=0;for(let l=0;l<s.length-1;l++)r+=s[l].dist(s[l+1]);return r}function _4(s,r,l){return s?.6*r*l:0}function v4(s,r){return Math.max(s?s.right-s.left:0,r?r.right-r.left:0)}function WC(s,r,l,h,p,x){const b=_4(l,p,x),A=v4(l,h)*x;let P=0;const M=y4(s)/2;for(let G=0;G<s.length-1;G++){const X=s[G],re=s[G+1],de=X.dist(re);if(P+de>M){const ye=(M-P)/de,Se=He(X.x,re.x,ye),We=He(X.y,re.y,ye),at=new cp(Se,We,0,re.angleTo(X),G);return!b||g4(s,at,A,b,r)?at:void 0}P+=de}}function KC(s,r,l,h,p,x,b,A,P){const M=_4(h,x,b),G=v4(h,p),X=G*b,re=s[0].x===0||s[0].x===P||s[0].y===0||s[0].y===P;return r-X<r/4&&(r=X+r/4),x4(s,re?r/2*A%r:(G/2+2*x)*b*A%r,r,M,l,X,re,!1,P)}function x4(s,r,l,h,p,x,b,A,P){const M=x/2,G=y4(s);let X=0,re=r-l,de=[];for(let ye=0;ye<s.length-1;ye++){const Se=s[ye],We=s[ye+1],at=Se.dist(We),xt=We.angleTo(Se);for(;re+l<X+at;){re+=l;const ct=(re-X)/at,vt=He(Se.x,We.x,ct),It=He(Se.y,We.y,ct);if(vt>=0&&vt<P&&It>=0&&It<P&&re-M>=0&&re+M<=G){const Tt=new cp(vt,It,0,xt,ye);Tt._round(),h&&!g4(s,Tt,x,h,p)||de.push(Tt)}}X+=at}return A||de.length||b||(de=x4(s,X/2,l,h,p,x,b,!0,P)),de}function b4(s,r,l,h,p){const x=[];for(let b=0;b<s.length;b++){const A=s[b];let P;for(let M=0;M<A.length-1;M++){let G=A[M],X=A[M+1];G.x<r&&X.x<r||(G.x<r?G=new q(r,G.y+(r-G.x)/(X.x-G.x)*(X.y-G.y))._round():X.x<r&&(X=new q(r,G.y+(r-G.x)/(X.x-G.x)*(X.y-G.y))._round()),G.y<l&&X.y<l||(G.y<l?G=new q(G.x+(l-G.y)/(X.y-G.y)*(X.x-G.x),l)._round():X.y<l&&(X=new q(G.x+(l-G.y)/(X.y-G.y)*(X.x-G.x),l)._round()),G.x>=h&&X.x>=h||(G.x>=h?G=new q(h,G.y+(h-G.x)/(X.x-G.x)*(X.y-G.y))._round():X.x>=h&&(X=new q(h,G.y+(h-G.x)/(X.x-G.x)*(X.y-G.y))._round()),G.y>=p&&X.y>=p||(G.y>=p?G=new q(G.x+(p-G.y)/(X.y-G.y)*(X.x-G.x),p)._round():X.y>=p&&(X=new q(G.x+(p-G.y)/(X.y-G.y)*(X.x-G.x),p)._round()),P&&G.equals(P[P.length-1])||(P=[G],x.push(P)),P.push(X)))))}}return x}lr(cp,"Anchor");const ly=1e20;function w4(s,r,l,h,p,x,b,A,P){for(let M=r;M<r+h;M++)S4(s,l*x+M,x,p,b,A,P);for(let M=l;M<l+p;M++)S4(s,M*x+r,1,h,b,A,P)}function S4(s,r,l,h,p,x,b){x[0]=0,b[0]=-ly,b[1]=ly,p[0]=s[r];for(let A=1,P=0,M=0;A<h;A++){p[A]=s[r+A*l];const G=A*A;do{const X=x[P];M=(p[A]-p[X]+G-X*X)/(A-X)/2}while(M<=b[P]&&--P>-1);P++,x[P]=A,b[P]=M,b[P+1]=ly}for(let A=0,P=0;A<h;A++){for(;b[P+1]<A;)P++;const M=x[P],G=A-M;s[r+A*l]=p[M]+G*G}}const qd=2,Rx={none:0,ideographs:1,all:2};class Fg{constructor(r,l,h){this.requestManager=r,this.localGlyphMode=l,this.localFontFamily=h,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r){this.url=r}getGlyphs(r,l){const h=[];for(const p in r)for(const x of r[p])h.push({stack:p,id:x});le(h,(({stack:p,id:x},b)=>{let A=this.entries[p];A||(A=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let P=A.glyphs[x];if(P!==void 0)return void b(null,{stack:p,id:x,glyph:P});if(P=this._tinySDF(A,p,x),P)return A.glyphs[x]=P,void b(null,{stack:p,id:x,glyph:P});const M=Math.floor(x/256);if(256*M>65535)return void b(new Error("glyphs > 65535 not supported"));if(A.ranges[M])return void b(null,{stack:p,id:x,glyph:P});let G=A.requests[M];G||(G=A.requests[M]=[],Fg.loadGlyphRange(p,M,this.url,this.requestManager,((X,re)=>{if(re){A.ascender=re.ascender,A.descender=re.descender;for(const de in re.glyphs)this._doesCharSupportLocalGlyph(+de)||(A.glyphs[+de]=re.glyphs[+de]);A.ranges[M]=!0}for(const de of G)de(X,re);delete A.requests[M]}))),G.push(((X,re)=>{X?b(X):re&&b(null,{stack:p,id:x,glyph:re.glyphs[x]||null})}))}),((p,x)=>{if(p)l(p);else if(x){const b={};for(const{stack:A,id:P,glyph:M}of x)b[A]===void 0&&(b[A]={}),b[A].glyphs===void 0&&(b[A].glyphs={}),b[A].glyphs[P]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics},b[A].ascender=this.entries[A].ascender,b[A].descender=this.entries[A].descender;l(null,b)}}))}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==Rx.none&&(this.localGlyphMode===Rx.all?!!this.localFontFamily:!!this.localFontFamily&&(oe["CJK Unified Ideographs"](r)||oe["Hangul Syllables"](r)||oe.Hiragana(r)||oe.Katakana(r)||oe["CJK Symbols and Punctuation"](r)))}_tinySDF(r,l,h){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(h))return;let x=r.tinySDF;if(!x){let Se="400";/bold/i.test(l)?Se="900":/medium/i.test(l)?Se="500":/light/i.test(l)&&(Se="200"),x=r.tinySDF=new Fg.TinySDF({fontFamily:p,fontWeight:Se,fontSize:24*qd,buffer:3*qd,radius:8*qd}),x.fontWeight=Se}if(this.localGlyphs[x.fontWeight][h])return this.localGlyphs[x.fontWeight][h];const b=String.fromCharCode(h),{data:A,width:P,height:M,glyphWidth:G,glyphHeight:X,glyphLeft:re,glyphTop:de,glyphAdvance:ye}=x.draw(b);return this.localGlyphs[x.fontWeight][h]={id:h,bitmap:new oh({width:P,height:M},A),metrics:{width:G/qd,height:X/qd,left:re/qd,top:de/qd-27,advance:ye/qd,localGlyph:!0}}}}Fg.loadGlyphRange=function(s,r,l,h,p){const x=256*r,b=x+255,A=h.transformRequest(h.normalizeGlyphsURL(l).replace("{fontstack}",s).replace("{range}",`${x}-${b}`),or.Glyphs);hi(A,((P,M)=>{if(P)p(P);else if(M){const G={},X=(function(re){return new W_(re).readFields(UC,{})})(M);for(const re of X.glyphs)G[re.id]=re;p(null,{glyphs:G,ascender:X.ascender,descender:X.descender})}}))},Fg.TinySDF=class{constructor({fontSize:s=24,buffer:r=3,radius:l=8,cutoff:h=.25,fontFamily:p="sans-serif",fontWeight:x="normal",fontStyle:b="normal"}={}){this.buffer=r,this.cutoff=h,this.radius=l;const A=this.size=s+4*r,P=this._createCanvas(A),M=this.ctx=P.getContext("2d",{willReadFrequently:!0});M.font=`${b} ${x} ${s}px ${p}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(A*A),this.gridInner=new Float64Array(A*A),this.f=new Float64Array(A),this.z=new Float64Array(A+1),this.v=new Uint16Array(A)}_createCanvas(s){const r=document.createElement("canvas");return r.width=r.height=s,r}draw(s){const{width:r,actualBoundingBoxAscent:l,actualBoundingBoxDescent:h,actualBoundingBoxLeft:p,actualBoundingBoxRight:x}=this.ctx.measureText(s),b=Math.ceil(l),A=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(x-p))),P=Math.min(this.size-this.buffer,b+Math.ceil(h)),M=A+2*this.buffer,G=P+2*this.buffer,X=Math.max(M*G,0),re=new Uint8ClampedArray(X),de={data:re,width:M,height:G,glyphWidth:A,glyphHeight:P,glyphTop:b,glyphLeft:0,glyphAdvance:r};if(A===0||P===0)return de;const{ctx:ye,buffer:Se,gridInner:We,gridOuter:at}=this;ye.clearRect(Se,Se,A,P),ye.fillText(s,Se,Se+b);const xt=ye.getImageData(Se,Se,A,P);at.fill(ly,0,X),We.fill(0,0,X);for(let ct=0;ct<P;ct++)for(let vt=0;vt<A;vt++){const It=xt.data[4*(ct*A+vt)+3]/255;if(It===0)continue;const Tt=(ct+Se)*M+vt+Se;if(It===1)at[Tt]=0,We[Tt]=ly;else{const sn=.5-It;at[Tt]=sn>0?sn*sn:0,We[Tt]=sn<0?sn*sn:0}}w4(at,0,0,M,G,M,this.f,this.v,this.z),w4(We,Se,Se,A,P,M,this.f,this.v,this.z);for(let ct=0;ct<X;ct++){const vt=Math.sqrt(at[ct])-Math.sqrt(We[ct]);re[ct]=Math.round(255-255*(vt/this.radius+this.cutoff))}return de}};const Og=Ph;function E4(s,r,l,h){const p=[],x=s.image,b=x.pixelRatio,A=x.paddedRect.w-2*Og,P=x.paddedRect.h-2*Og,M=s.right-s.left,G=s.bottom-s.top,X=x.stretchX||[[0,A]],re=x.stretchY||[[0,P]],de=(dn,Pn)=>dn+Pn[1]-Pn[0],ye=X.reduce(de,0),Se=re.reduce(de,0),We=A-ye,at=P-Se;let xt=0,ct=ye,vt=0,It=Se,Tt=0,sn=We,nn=0,Sn=at;if(x.content&&h){const dn=x.content;xt=X_(X,0,dn[0]),vt=X_(re,0,dn[1]),ct=X_(X,dn[0],dn[2]),It=X_(re,dn[1],dn[3]),Tt=dn[0]-xt,nn=dn[1]-vt,sn=dn[2]-dn[0]-ct,Sn=dn[3]-dn[1]-It}const qn=(dn,Pn,kn,zn)=>{const Xn=Z_(dn.stretch-xt,ct,M,s.left),wn=Y_(dn.fixed-Tt,sn,dn.stretch,ye),pr=Z_(Pn.stretch-vt,It,G,s.top),Br=Y_(Pn.fixed-nn,Sn,Pn.stretch,Se),yr=Z_(kn.stretch-xt,ct,M,s.left),Wi=Y_(kn.fixed-Tt,sn,kn.stretch,ye),Zn=Z_(zn.stretch-vt,It,G,s.top),ri=Y_(zn.fixed-nn,Sn,zn.stretch,Se),Ki=new q(Xn,pr),is=new q(yr,pr),Xi=new q(yr,Zn),bi=new q(Xn,Zn),ha=new q(wn/b,Br/b),Zi=new q(Wi/b,ri/b),Yi=r*Math.PI/180;if(Yi){const ea=Math.sin(Yi),Fs=Math.cos(Yi),Ha=[Fs,-ea,ea,Fs];Ki._matMult(Ha),is._matMult(Ha),bi._matMult(Ha),Xi._matMult(Ha)}const Ds=dn.stretch+dn.fixed,Qs=Pn.stretch+Pn.fixed;return{tl:Ki,tr:is,bl:bi,br:Xi,tex:{x:x.paddedRect.x+Og+Ds,y:x.paddedRect.y+Og+Qs,w:kn.stretch+kn.fixed-Ds,h:zn.stretch+zn.fixed-Qs},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ha,pixelOffsetBR:Zi,minFontScaleX:sn/b/M,minFontScaleY:Sn/b/G,isSDF:l}};if(h&&(x.stretchX||x.stretchY)){const dn=A4(X,We,ye),Pn=A4(re,at,Se);for(let kn=0;kn<dn.length-1;kn++){const zn=dn[kn],Xn=dn[kn+1];for(let wn=0;wn<Pn.length-1;wn++)p.push(qn(zn,Pn[wn],Xn,Pn[wn+1]))}}else p.push(qn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:A+1},{fixed:0,stretch:P+1}));return p}function X_(s,r,l){let h=0;for(const p of s)h+=Math.max(r,Math.min(l,p[1]))-Math.max(r,Math.min(l,p[0]));return h}function A4(s,r,l){const h=[{fixed:-Og,stretch:0}];for(const[p,x]of s){const b=h[h.length-1];h.push({fixed:p-b.stretch,stretch:b.stretch}),h.push({fixed:p-b.stretch,stretch:b.stretch+(x-p)})}return h.push({fixed:r+Og,stretch:l}),h}function Z_(s,r,l,h){return s/r*l+h}function Y_(s,r,l,h){return s-r*l/h}function XC(s,r,l,h){const p=r+s.positionedLines[h].lineOffset;return h===0?l+p/2:l+(p+(r+s.positionedLines[h-1].lineOffset))/2}class ZC{constructor(r=[],l=YC){if(this.data=r,this.length=this.data.length,this.compare=l,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const r=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:l,compare:h}=this,p=l[r];for(;r>0;){const x=r-1>>1,b=l[x];if(h(p,b)>=0)break;l[r]=b,r=x}l[r]=p}_down(r){const{data:l,compare:h}=this,p=this.length>>1,x=l[r];for(;r<p;){let b=1+(r<<1),A=l[b];const P=b+1;if(P<this.length&&h(l[P],A)<0&&(b=P,A=l[P]),h(A,x)>=0)break;l[r]=A,r=b}l[r]=x}}function YC(s,r){return s<r?-1:s>r?1:0}function JC(s,r=1,l=!1){let h=1/0,p=1/0,x=-1/0,b=-1/0;const A=s[0];for(let de=0;de<A.length;de++){const ye=A[de];(!de||ye.x<h)&&(h=ye.x),(!de||ye.y<p)&&(p=ye.y),(!de||ye.x>x)&&(x=ye.x),(!de||ye.y>b)&&(b=ye.y)}const P=Math.min(x-h,b-p);let M=P/2;const G=new ZC([],QC);if(P===0)return new q(h,p);for(let de=h;de<x;de+=P)for(let ye=p;ye<b;ye+=P)G.push(new Bg(de+M,ye+M,M,s));let X=(function(de){let ye=0,Se=0,We=0;const at=de[0];for(let xt=0,ct=at.length,vt=ct-1;xt<ct;vt=xt++){const It=at[xt],Tt=at[vt],sn=It.x*Tt.y-Tt.x*It.y;Se+=(It.x+Tt.x)*sn,We+=(It.y+Tt.y)*sn,ye+=3*sn}return new Bg(Se/ye,We/ye,0,de)})(s),re=G.length;for(;G.length;){const de=G.pop();(de.d>X.d||!X.d)&&(X=de,l&&console.log("found best %d after %d probes",Math.round(1e4*de.d)/1e4,re)),de.max-X.d<=r||(M=de.h/2,G.push(new Bg(de.p.x-M,de.p.y-M,M,s)),G.push(new Bg(de.p.x+M,de.p.y-M,M,s)),G.push(new Bg(de.p.x-M,de.p.y+M,M,s)),G.push(new Bg(de.p.x+M,de.p.y+M,M,s)),re+=4)}return l&&(console.log(`num probes: ${re}`),console.log(`best distance: ${X.d}`)),X.p}function QC(s,r){return r.max-s.max}class Bg{constructor(r,l,h,p){this.p=new q(r,l),this.h=h,this.d=(function(x,b){let A=!1,P=1/0;for(let M=0;M<b.length;M++){const G=b[M];for(let X=0,re=G.length,de=re-1;X<re;de=X++){const ye=G[X],Se=G[de];ye.y>x.y!=Se.y>x.y&&x.x<(Se.x-ye.x)*(x.y-ye.y)/(Se.y-ye.y)+ye.x&&(A=!A),P=Math.min(P,$0(x,ye,Se))}}return(A?1:-1)*Math.sqrt(P)})(this.p,p),this.max=this.d+this.h*Math.SQRT2}}const zg=7,Nx=Number.POSITIVE_INFINITY,eL=Math.sqrt(2);function T4(s,[r,l]){let h=0,p=0;if(l===Nx){r<0&&(r=0);const x=r/eL;switch(s){case"top-right":case"top-left":p=x-zg;break;case"bottom-right":case"bottom-left":p=-x+zg;break;case"bottom":p=-r+zg;break;case"top":p=r-zg}switch(s){case"top-right":case"bottom-right":h=-x;break;case"top-left":case"bottom-left":h=x;break;case"left":h=r;break;case"right":h=-r}}else{switch(r=Math.abs(r),l=Math.abs(l),s){case"top-right":case"top-left":case"top":p=l-zg;break;case"bottom-right":case"bottom-left":case"bottom":p=-l+zg}switch(s){case"top-right":case"bottom-right":case"right":h=-r;break;case"top-left":case"bottom-left":case"left":h=r}}return[h,p]}function tL(s,r,l,h,p,x,b,A,P,M){s.createArrays(),s.tilePixelRatio=Wr/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const G=s.layers[0].layout,X=s.layers[0]._unevaluatedLayout._values,re={};if(s.textSizeData.kind==="composite"){const{minZoom:Se,maxZoom:We}=s.textSizeData;re.compositeTextSizes=[X["text-size"].possiblyEvaluate(new $(Se),A),X["text-size"].possiblyEvaluate(new $(We),A)]}if(s.iconSizeData.kind==="composite"){const{minZoom:Se,maxZoom:We}=s.iconSizeData;re.compositeIconSizes=[X["icon-size"].possiblyEvaluate(new $(Se),A),X["icon-size"].possiblyEvaluate(new $(We),A)]}re.layoutTextSize=X["text-size"].possiblyEvaluate(new $(P+1),A),re.layoutIconSize=X["icon-size"].possiblyEvaluate(new $(P+1),A),re.textMaxSize=X["text-size"].possiblyEvaluate(new $(18),A);const de=G.get("text-rotation-alignment")==="map"&&G.get("symbol-placement")!=="point",ye=G.get("text-size");for(const Se of s.features){const We=G.get("text-font").evaluate(Se,{},A).join(","),at=ye.evaluate(Se,{},A),xt=re.layoutTextSize.evaluate(Se,{},A),ct=(re.layoutIconSize.evaluate(Se,{},A),{horizontal:{},vertical:void 0}),vt=Se.text;let It,Tt=[0,0];if(vt){const Sn=vt.toString(),qn=G.get("text-letter-spacing").evaluate(Se,{},A)*du,dn=G.get("text-line-height").evaluate(Se,{},A)*du,Pn=je(Sn)?qn:0,kn=G.get("text-anchor").evaluate(Se,{},A),zn=G.get("text-variable-anchor");if(!zn){const yr=G.get("text-radial-offset").evaluate(Se,{},A);Tt=yr?T4(kn,[yr*du,Nx]):G.get("text-offset").evaluate(Se,{},A).map((Wi=>Wi*du))}let Xn=de?"center":G.get("text-justify").evaluate(Se,{},A);const wn=G.get("symbol-placement")==="point",pr=wn?G.get("text-max-width").evaluate(Se,{},A)*du:1/0,Br=yr=>{s.allowVerticalPlacement&&Pe(Sn)&&(ct.vertical=kx(vt,r,l,p,We,pr,dn,kn,yr,Pn,Tt,cd.vertical,!0,xt,at))};if(!de&&zn){const yr=Xn==="auto"?zn.map((Zn=>Dx(Zn))):[Xn];let Wi=!1;for(let Zn=0;Zn<yr.length;Zn++){const ri=yr[Zn];if(!ct.horizontal[ri])if(Wi)ct.horizontal[ri]=ct.horizontal[0];else{const Ki=kx(vt,r,l,p,We,pr,dn,"center",ri,Pn,Tt,cd.horizontal,!1,xt,at);Ki&&(ct.horizontal[ri]=Ki,Wi=Ki.positionedLines.length===1)}}Br("left")}else{if(Xn==="auto"&&(Xn=Dx(kn)),wn||G.get("text-writing-mode").indexOf("horizontal")>=0||!Pe(Sn)){const yr=kx(vt,r,l,p,We,pr,dn,kn,Xn,Pn,Tt,cd.horizontal,!1,xt,at);yr&&(ct.horizontal[Xn]=yr)}Br(wn?"left":Xn)}}let sn=!1;if(Se.icon&&Se.icon.name){const Sn=h[Se.icon.name];Sn&&(It=HC(p[Se.icon.name],G.get("icon-offset").evaluate(Se,{},A),G.get("icon-anchor").evaluate(Se,{},A)),sn=Sn.sdf,s.sdfIcons===void 0?s.sdfIcons=Sn.sdf:s.sdfIcons!==Sn.sdf&&fr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Sn.pixelRatio!==s.pixelRatio||G.get("icon-rotate").constantOr(1)!==0)&&(s.iconsNeedLinear=!0))}const nn=C4(ct.horizontal)||ct.vertical;s.iconsInText||(s.iconsInText=!!nn&&nn.iconsInText),(nn||It)&&nL(s,Se,ct,It,h,re,xt,0,Tt,sn,b,A,M)}x&&s.generateCollisionDebugBuffers(P,s.collisionBoxArray)}function Dx(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function nL(s,r,l,h,p,x,b,A,P,M,G,X,re){let de=x.textMaxSize.evaluate(r,{},X);de===void 0&&(de=b);const ye=s.layers[0].layout,Se=ye.get("icon-offset").evaluate(r,{},X),We=C4(l.horizontal)||l.vertical,at=re.name==="globe",xt=du,ct=b/xt,vt=s.tilePixelRatio*de/xt,It=(kn=s.overscaling,s.zoom>18&&kn>2&&(kn>>=1),Math.max(Wr/(512*kn),1)*ye.get("symbol-spacing")),Tt=ye.get("text-padding")*s.tilePixelRatio,sn=ye.get("icon-padding")*s.tilePixelRatio,nn=Z(ye.get("text-max-angle")),Sn=ye.get("text-rotation-alignment")==="map"&&ye.get("symbol-placement")!=="point",qn=ye.get("icon-rotation-alignment")==="map"&&ye.get("symbol-placement")!=="point",dn=ye.get("symbol-placement"),Pn=It/2;var kn;const zn=ye.get("icon-text-fit");let Xn;h&&zn!=="none"&&(s.allowVerticalPlacement&&l.vertical&&(Xn=m4(h,l.vertical,zn,ye.get("icon-text-fit-padding"),Se,ct)),We&&(h=m4(h,We,zn,ye.get("icon-text-fit-padding"),Se,ct)));const wn=(pr,Br,yr)=>{if(Br.x<0||Br.x>=Wr||Br.y<0||Br.y>=Wr)return;let Wi=null;if(at){const{x:Zn,y:ri,z:Ki}=re.projectTilePoint(Br.x,Br.y,yr);Wi={anchor:new cp(Zn,ri,Ki,0,void 0),up:re.upVector(yr,Br.x,Br.y)}}(function(Zn,ri,Ki,is,Xi,bi,ha,Zi,Yi,Ds,Qs,ea,Fs,Ha,xl,Hl,Os,_c,Wl,sl,ls,Kl,ta,ah,Xl){const fu=Zn.addToLineVertexArray(ri,is);let Xc,lh,Zc,Gd,Vg,yy,_y,a2=0,l2=0,c2=0,u2=0,Zx=-1,Yx=-1;const Sf={};let h2=hc("");const Fm=Ki?Ki.anchor:ri;let Jx=0,Qx=0;if(Yi._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Jx,Qx]=Yi.layout.get("text-offset").evaluate(ls,{},Xl).map((Hh=>Hh*du)):(Jx=Yi.layout.get("text-radial-offset").evaluate(ls,{},Xl)*du,Qx=Nx),Zn.allowVerticalPlacement&&Xi.vertical){const Hh=Xi.vertical;if(xl)yy=Fx(Hh),Zi&&(_y=Fx(Zi));else{const Wh=Yi.layout.get("text-rotate").evaluate(ls,{},Xl)+90;Zc=J_(Ds,Fm,ri,Qs,ea,Fs,Hh,Ha,Wh,Hl),Zi&&(Gd=J_(Ds,Fm,ri,Qs,ea,Fs,Zi,_c,Wh))}}if(bi){const Hh=Yi.layout.get("icon-rotate").evaluate(ls,{},Xl),Wh=Yi.layout.get("icon-text-fit")!=="none",vy=E4(bi,Hh,ta,Wh),tb=Zi?E4(Zi,Hh,ta,Wh):void 0;lh=J_(Ds,Fm,ri,Qs,ea,Fs,bi,_c,Hh),a2=4*vy.length;const d2=Zn.iconSizeData;let Om=null;d2.kind==="source"?(Om=[Vd*Yi.layout.get("icon-size").evaluate(ls,{},Xl)],Om[0]>Up&&fr(`${Zn.layerIds[0]}: Value for "icon-size" is >= ${cy}. Reduce your "icon-size".`)):d2.kind==="composite"&&(Om=[Vd*Kl.compositeIconSizes[0].evaluate(ls,{},Xl),Vd*Kl.compositeIconSizes[1].evaluate(ls,{},Xl)],(Om[0]>Up||Om[1]>Up)&&fr(`${Zn.layerIds[0]}: Value for "icon-size" is >= ${cy}. Reduce your "icon-size".`)),Zn.addSymbols(Zn.icon,vy,Om,sl,Wl,ls,!1,Ki,ri,fu.lineStartIndex,fu.lineLength,-1,ah,Xl),Zx=Zn.icon.placedSymbolArray.length-1,tb&&(l2=4*tb.length,Zn.addSymbols(Zn.icon,tb,Om,sl,Wl,ls,cd.vertical,Ki,ri,fu.lineStartIndex,fu.lineLength,-1,ah,Xl),Yx=Zn.icon.placedSymbolArray.length-1)}for(const Hh in Xi.horizontal){const Wh=Xi.horizontal[Hh];Xc||(h2=hc(Wh.text),xl?Vg=Fx(Wh):Xc=J_(Ds,Fm,ri,Qs,ea,Fs,Wh,Ha,Yi.layout.get("text-rotate").evaluate(ls,{},Xl),Hl));const vy=Wh.positionedLines.length===1;if(c2+=I4(Zn,Ki,ri,Wh,ha,Yi,xl,ls,Hl,fu,Xi.vertical?cd.horizontal:cd.horizontalOnly,vy?Object.keys(Xi.horizontal):[Hh],Sf,Zx,Kl,ah,Xl),vy)break}Xi.vertical&&(u2+=I4(Zn,Ki,ri,Xi.vertical,ha,Yi,xl,ls,Hl,fu,cd.vertical,["vertical"],Sf,Yx,Kl,ah,Xl));let Wp=-1;const eb=(Hh,Wh)=>Hh?Math.max(Hh,Wh):Wh;Wp=eb(Vg,Wp),Wp=eb(yy,Wp),Wp=eb(_y,Wp);const PL=Wp>-1?1:0;Zn.glyphOffsetArray.length>=qp.MAX_GLYPHS&&fr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ls.sortKey!==void 0&&Zn.addToSortKeyRanges(Zn.symbolInstances.length,ls.sortKey),Zn.symbolInstances.emplaceBack(Fm.x,Fm.y,Fm.z,ri.x,ri.y,Sf.right>=0?Sf.right:-1,Sf.center>=0?Sf.center:-1,Sf.left>=0?Sf.left:-1,Sf.vertical>=0?Sf.vertical:-1,Zx,Yx,h2,Xc!==void 0?Xc:Zn.collisionBoxArray.length,Xc!==void 0?Xc+1:Zn.collisionBoxArray.length,Zc!==void 0?Zc:Zn.collisionBoxArray.length,Zc!==void 0?Zc+1:Zn.collisionBoxArray.length,lh!==void 0?lh:Zn.collisionBoxArray.length,lh!==void 0?lh+1:Zn.collisionBoxArray.length,Gd||Zn.collisionBoxArray.length,Gd?Gd+1:Zn.collisionBoxArray.length,Qs,c2,u2,a2,l2,PL,0,Jx,Qx,Wp)})(s,Br,Wi,pr,l,h,p,Xn,s.layers[0],s.collisionBoxArray,r.index,r.sourceLayerIndex,s.index,Tt,Sn,P,0,sn,qn,Se,r,x,M,G,X)};if(dn==="line")for(const pr of b4(r.geometry,0,0,Wr,Wr)){const Br=KC(pr,It,nn,l.vertical||We,h,xt,vt,s.overscaling,Wr);for(const yr of Br)We&&rL(s,We.text,Pn,yr)||wn(pr,yr,X)}else if(dn==="line-center"){for(const pr of r.geometry)if(pr.length>1){const Br=WC(pr,nn,l.vertical||We,h,xt,vt);Br&&wn(pr,Br,X)}}else if(r.type==="Polygon")for(const pr of ny(r.geometry,0)){const Br=JC(pr,16);wn(pr[0],new cp(Br.x,Br.y,0,0,void 0),X)}else if(r.type==="LineString")for(const pr of r.geometry)wn(pr,new cp(pr[0].x,pr[0].y,0,0,void 0),X);else if(r.type==="Point")for(const pr of r.geometry)for(const Br of pr)wn([Br],new cp(Br.x,Br.y,0,0,void 0),X)}const cy=255,Up=cy*Vd;function I4(s,r,l,h,p,x,b,A,P,M,G,X,re,de,ye,Se,We){const at=(function(vt,It,Tt,sn,nn,Sn,qn,dn){const Pn=[];if(It.positionedLines.length===0)return Pn;const kn=sn.layout.get("text-rotate").evaluate(Sn,{})*Math.PI/180,zn=(function(yr){const Wi=yr[0],Zn=yr[1],ri=Wi*Zn;return ri>0?[Wi,-Zn]:ri<0?[-Wi,Zn]:Wi===0?[Zn,Wi]:[Zn,-Wi]})(Tt);let Xn=Math.abs(It.top-It.bottom);for(const yr of It.positionedLines)Xn-=yr.lineOffset;const wn=It.positionedLines.length,pr=Xn/wn;let Br=It.top-Tt[1];for(let yr=0;yr<wn;++yr){const Wi=It.positionedLines[yr];Br=XC(It,pr,Br,yr);for(const Zn of Wi.positionedGlyphs){if(!Zn.rect)continue;const ri=Zn.rect||{};let Ki=a4+1,is=!0,Xi=1,bi=0;if(Zn.imageName){const ta=qn[Zn.imageName];if(!ta)continue;if(ta.sdf){fr("SDF images are not supported in formatted text and will be ignored.");continue}is=!1,Xi=ta.pixelRatio,Ki=Ph/Xi}const ha=(nn||dn)&&Zn.vertical,Zi=Zn.metrics.advance*Zn.scale/2,Yi=Zn.metrics,Ds=Zn.rect;if(Ds===null)continue;dn&&It.verticalizable&&(bi=Zn.imageName?Zi-Zn.metrics.width*Zn.scale/2:0);const Qs=nn?[Zn.x+Zi,Zn.y]:[0,0];let ea=[0,0],Fs=[0,0],Ha=!1;nn||(ha?(Fs=[Zn.x+Zi+zn[0],Zn.y+zn[1]-bi],Ha=!0):ea=[Zn.x+Zi+Tt[0],Zn.y+Tt[1]-bi]);const xl=Ds.w*Zn.scale/(Xi*(Zn.localGlyph?qd:1)),Hl=Ds.h*Zn.scale/(Xi*(Zn.localGlyph?qd:1));let Os,_c,Wl,sl;if(ha){const ta=Zn.y-Br,ah=new q(-Zi,Zi-ta),Xl=-Math.PI/2,fu=new q(...Fs);Os=new q(-Zi+ea[0],ea[1]),Os._rotateAround(Xl,ah)._add(fu),Os.x+=-ta+Zi,Os.y-=(Yi.left-Ki)*Zn.scale;const Xc=Zn.imageName?Yi.advance*Zn.scale:du*Zn.scale,lh=String.fromCharCode(Zn.glyph);PC(lh)?Os.x+=(1-Ki)*Zn.scale:kC(lh)?Os.x+=Xc-Yi.height*Zn.scale+(-Ki-1)*Zn.scale:Os.x+=Zn.imageName||Yi.width+2*Ki===Ds.w&&Yi.height+2*Ki===Ds.h?(Xc-Hl)/2:(Xc-(Yi.height+2*Ki)*Zn.scale)/2,_c=new q(Os.x,Os.y-xl),Wl=new q(Os.x+Hl,Os.y),sl=new q(Os.x+Hl,Os.y-xl)}else{const ta=(Yi.left-Ki)*Zn.scale-Zi+ea[0],ah=(-Yi.top-Ki)*Zn.scale+ea[1],Xl=ta+xl,fu=ah+Hl;Os=new q(ta,ah),_c=new q(Xl,ah),Wl=new q(ta,fu),sl=new q(Xl,fu)}if(kn){let ta;ta=nn?new q(0,0):Ha?new q(zn[0],zn[1]):new q(Tt[0],Tt[1]),Os._rotateAround(kn,ta),_c._rotateAround(kn,ta),Wl._rotateAround(kn,ta),sl._rotateAround(kn,ta)}const ls=new q(0,0),Kl=new q(0,0);Pn.push({tl:Os,tr:_c,bl:Wl,br:sl,tex:ri,writingMode:It.writingMode,glyphOffset:Qs,sectionIndex:Zn.sectionIndex,isSDF:is,pixelOffsetTL:ls,pixelOffsetBR:Kl,minFontScaleX:0,minFontScaleY:0})}}return Pn})(0,h,P,x,b,A,p,s.allowVerticalPlacement),xt=s.textSizeData;let ct=null;xt.kind==="source"?(ct=[Vd*x.layout.get("text-size").evaluate(A,{},We)],ct[0]>Up&&fr(`${s.layerIds[0]}: Value for "text-size" is >= ${cy}. Reduce your "text-size".`)):xt.kind==="composite"&&(ct=[Vd*ye.compositeTextSizes[0].evaluate(A,{},We),Vd*ye.compositeTextSizes[1].evaluate(A,{},We)],(ct[0]>Up||ct[1]>Up)&&fr(`${s.layerIds[0]}: Value for "text-size" is >= ${cy}. Reduce your "text-size".`)),s.addSymbols(s.text,at,ct,P,b,A,G,r,l,M.lineStartIndex,M.lineLength,de,Se,We);for(const vt of X)re[vt]=s.text.placedSymbolArray.length-1;return 4*at.length}function C4(s){for(const r in s)return s[r];return null}function J_(s,r,l,h,p,x,b,A,P,M){let G=b.top,X=b.bottom,re=b.left,de=b.right;const ye=b.collisionPadding;if(ye&&(re-=ye[0],G-=ye[1],de+=ye[2],X+=ye[3]),P){const Se=new q(re,G),We=new q(de,G),at=new q(re,X),xt=new q(de,X),ct=Z(P);let vt=new q(0,0);M&&(vt=new q(M[0],M[1])),Se._rotateAround(ct,vt),We._rotateAround(ct,vt),at._rotateAround(ct,vt),xt._rotateAround(ct,vt),re=Math.min(Se.x,We.x,at.x,xt.x),de=Math.max(Se.x,We.x,at.x,xt.x),G=Math.min(Se.y,We.y,at.y,xt.y),X=Math.max(Se.y,We.y,at.y,xt.y)}return s.emplaceBack(r.x,r.y,r.z,l.x,l.y,re,G,de,X,A,h,p,x),s.length-1}function Fx(s){s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const r=s.bottom-s.top;return r>0?Math.max(10,r):null}function rL(s,r,l,h){const p=s.compareText;if(r in p){const x=p[r];for(let b=x.length-1;b>=0;b--)if(h.dist(x[b])<l)return!0}else p[r]=[];return p[r].push(h),!1}function L4(s,r){const l=s.fovAboveCenter,h=s.elevation?s.elevation.getMinElevationBelowMSL()*r:0,p=(s._camera.position[2]*s.worldSize-h)/Math.cos(s._pitch),x=Math.sin(l)*p/Math.sin(Math.max(Math.PI/2-s._pitch-l,.01)),b=Math.sin(s._pitch)*x+p;return Math.min(1.01*b,p*(1/s._horizonShift))}function Nm(s,r){if(!r.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:r};const l=Math.pow(2,-s.z),h=s.x*l,p=(s.x+1)*l,x=s.y*l,b=(s.y+1)*l,A=yc(h),P=yc(p),M=Ho(x),G=Ho(b),X=r.project(A,M),re=r.project(P,M),de=r.project(P,G),ye=r.project(A,G);let Se=Math.min(X.x,re.x,de.x,ye.x),We=Math.min(X.y,re.y,de.y,ye.y),at=Math.max(X.x,re.x,de.x,ye.x),xt=Math.max(X.y,re.y,de.y,ye.y);const ct=l/16;function vt(Tt,sn,nn,Sn,qn,dn){const Pn=(nn+qn)/2,kn=(Sn+dn)/2,zn=r.project(yc(Pn),Ho(kn)),Xn=Math.max(0,Se-zn.x,We-zn.y,zn.x-at,zn.y-xt);Se=Math.min(Se,zn.x),at=Math.max(at,zn.x),We=Math.min(We,zn.y),xt=Math.max(xt,zn.y),Xn>ct&&(vt(Tt,zn,nn,Sn,Pn,kn),vt(zn,sn,Pn,kn,qn,dn))}vt(X,re,h,x,p,x),vt(re,de,p,x,p,b),vt(de,ye,p,b,h,b),vt(ye,X,h,b,h,x),Se-=ct,We-=ct,at+=ct,xt+=ct;const It=1/Math.max(at-Se,xt-We);return{scale:It,x:Se*It,y:We*It,x2:at*It,y2:xt*It,projection:r}}const iL=Rc(new Float32Array(16));class Vp{constructor(r){this.spec=r,this.name=r.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(r,l){return{x:0,y:0,z:0}}unproject(r,l){return new ti(0,0)}projectTilePoint(r,l,h){return{x:r,y:l,z:0}}locationPoint(r,l,h=!0){return r._coordinatePoint(r.locationCoordinate(l),h)}pixelsPerMeter(r,l){return Ga(1,r)*l}pixelSpaceConversion(r,l,h){return 1}farthestPixelDistance(r){return L4(r,r.pixelsPerMeter)}pointCoordinate(r,l,h,p){const x=r.horizonLineFromTop(!1),b=new q(l,Math.max(x,h));return r.rayIntersectionCoordinate(r.pointRayIntersection(b,p))}pointCoordinate3D(r,l,h){const p=new q(l,h);if(r.elevation)return r.elevation.pointCoordinate(p);{const x=this.pointCoordinate(r,p.x,p.y,0);return[x.x,x.y,x.z]}}isPointAboveHorizon(r,l){if(r.elevation)return!this.pointCoordinate3D(r,l.x,l.y);const h=r.horizonLineFromTop();return l.y<h}createInversionMatrix(r,l){return iL}createTileMatrix(r,l,h){let p,x,b;const A=h.canonical,P=Rc(new Float64Array(16));if(this.isReprojectedInTileSpace){const M=Nm(A,this);p=1,x=M.x+h.wrap*M.scale,b=M.y,od(P,P,[p/M.scale,p/M.scale,r.pixelsPerMeter/l])}else p=l/r.zoomScale(A.z),x=(A.x+Math.pow(2,A.z)*h.wrap)*p,b=A.y*p;return wd(P,P,[x,b,0]),od(P,P,[p/Wr,p/Wr,1]),P}upVector(r,l,h){return[0,0,1]}upVectorScale(r,l,h){return{metersToTile:1}}}class oL extends Vp{constructor(r){super(r),this.range=[4,7],this.center=r.center||[-96,37.5];const[l,h]=this.parallels=r.parallels||[29.5,45.5],p=Math.sin(Z(l));this.n=(p+Math.sin(Z(h)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(r,l){const{n:h,c:p,r0:x}=this,b=Z(r-this.center[0]),A=Z(l),P=Math.sqrt(p-2*h*Math.sin(A))/h;return{x:P*Math.sin(b*h),y:P*Math.cos(b*h)-x,z:0}}unproject(r,l){const{n:h,c:p,r0:x}=this,b=x+l;let A=Math.atan2(r,Math.abs(b))*Math.sign(b);b*h<0&&(A-=Math.PI*Math.sign(r)*Math.sign(b));const P=Z(this.center[0])*h;A=xe(A,-Math.PI-P,Math.PI-P);const M=De(be(A/h)+this.center[0],-180,180),G=Math.asin(De((p-(r*r+b*b)*h*h)/(2*h),-1,1)),X=De(be(G),-Ra,Ra);return new ti(M,X)}}const uy=1.340264,hy=-.081106,dy=893e-6,fy=.003796,Q_=Math.sqrt(3)/2;class sL extends Vp{project(r,l){l=l/180*Math.PI,r=r/180*Math.PI;const h=Math.asin(Q_*Math.sin(l)),p=h*h,x=p*p*p;return{x:.5*(r*Math.cos(h)/(Q_*(uy+3*hy*p+x*(7*dy+9*fy*p)))/Math.PI+.5),y:1-.5*(h*(uy+hy*p+x*(dy+fy*p))/Math.PI+1),z:0}}unproject(r,l){r=(2*r-.5)*Math.PI;let h=l=(2*(1-l)-1)*Math.PI,p=h*h,x=p*p*p;for(let G,X,re,de=0;de<12&&(X=h*(uy+hy*p+x*(dy+fy*p))-l,re=uy+3*hy*p+x*(7*dy+9*fy*p),G=X/re,h=De(h-G,-Math.PI/3,Math.PI/3),p=h*h,x=p*p*p,!(Math.abs(G)<1e-12));++de);const b=Q_*r*(uy+3*hy*p+x*(7*dy+9*fy*p))/Math.cos(h),A=Math.asin(Math.sin(h)/Q_),P=De(180*b/Math.PI,-180,180),M=De(180*A/Math.PI,-Ra,Ra);return new ti(P,M)}}class aL extends Vp{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0}project(r,l){return{x:.5+r/360,y:.5-l/360,z:0}}unproject(r,l){const h=360*(r-.5),p=De(360*(.5-l),-Ra,Ra);return new ti(h,p)}}const jg=Math.PI/2;function e1(s){return Math.tan((jg+s)/2)}class lL extends Vp{constructor(r){super(r),this.center=r.center||[0,30];const[l,h]=this.parallels=r.parallels||[30,30];let p=Z(l),x=Z(h);this.southernCenter=p+x<0,this.southernCenter&&(p=-p,x=-x);const b=Math.cos(p),A=e1(p);this.n=p===x?Math.sin(p):Math.log(b/Math.cos(x))/Math.log(e1(x)/A),this.f=b*Math.pow(e1(p),this.n)/this.n}project(r,l){l=Z(l),this.southernCenter&&(l=-l),r=Z(r-this.center[0]);const h=1e-6,{n:p,f:x}=this;x>0?l<-jg+h&&(l=-jg+h):l>jg-h&&(l=jg-h);const b=x/Math.pow(e1(l),p);let A=b*Math.sin(p*r),P=x-b*Math.cos(p*r);return A=.5*(A/Math.PI+.5),P=.5*(P/Math.PI+.5),{x:A,y:this.southernCenter?P:1-P,z:0}}unproject(r,l){r=(2*r-.5)*Math.PI,this.southernCenter&&(l=1-l),l=(2*(1-l)-.5)*Math.PI;const{n:h,f:p}=this,x=p-l,b=Math.sign(x),A=Math.sign(h)*Math.sqrt(r*r+x*x);let P=Math.atan2(r,Math.abs(x))*b;x*h<0&&(P-=Math.PI*Math.sign(r)*b);const M=De(be(P/h)+this.center[0],-180,180),G=De(be(2*Math.atan(Math.pow(p/A,1/h))-jg),-Ra,Ra);return new ti(M,this.southernCenter?-G:G)}}class P4 extends Vp{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(r,l){return{x:Cs(r),y:Ys(l),z:0}}unproject(r,l){const h=yc(r),p=Ho(l);return new ti(h,p)}}const k4=Z(Ra);class cL extends Vp{project(r,l){const h=(l=Z(l))*l,p=h*h;return{x:.5*((r=Z(r))*(.8707-.131979*h+p*(p*(.003971*h-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(l*(1.007226+h*(.015085+p*(.028874*h-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(r,l){r=(2*r-.5)*Math.PI;let h=l=(2*(1-l)-1)*Math.PI,p=25,x=0,b=h*h;do{b=h*h;const M=b*b;x=(h*(1.007226+b*(.015085+M*(.028874*b-.044475-.005916*M)))-l)/(1.007226+b*(.045255+M*(.259866*b-.311325-.005916*11*M))),h=De(h-x,-k4,k4)}while(Math.abs(x)>1e-6&&--p>0);b=h*h;const A=De(be(r/(.8707+b*(b*(b*b*b*(.003971-.001529*b)-.013791)-.131979))),-180,180),P=be(h);return new ti(A,P)}}const M4=Z(Ra);class uL extends Vp{project(r,l){l=Z(l),r=Z(r);const h=Math.cos(l),p=2/Math.PI,x=Math.acos(h*Math.cos(r/2)),b=Math.sin(x)/x,A=.5*(r*p+2*h*Math.sin(r/2)/b)||0,P=.5*(l+Math.sin(l)/b)||0;return{x:.5*(A/Math.PI+.5),y:1-.5*(P/Math.PI+1),z:0}}unproject(r,l){let h=r=(2*r-.5)*Math.PI,p=l=(2*(1-l)-1)*Math.PI,x=25;const b=1e-6;let A=0,P=0;do{const M=Math.cos(p),G=Math.sin(p),X=2*G*M,re=G*G,de=M*M,ye=Math.cos(h/2),Se=Math.sin(h/2),We=2*ye*Se,at=Se*Se,xt=1-de*ye*ye,ct=xt?1/xt:0,vt=xt?Math.acos(M*ye)*Math.sqrt(1/xt):0,It=.5*(2*vt*M*Se+2*h/Math.PI)-r,Tt=.5*(vt*G+p)-l,sn=.5*ct*(de*at+vt*M*ye*re)+1/Math.PI,nn=ct*(We*X/4-vt*G*Se),Sn=.125*ct*(X*Se-vt*G*de*We),qn=.5*ct*(re*ye+vt*at*M)+.5,dn=nn*Sn-qn*sn;A=(Tt*nn-It*qn)/dn,P=(It*Sn-Tt*sn)/dn,h=De(h-A,-Math.PI,Math.PI),p=De(p-P,-M4,M4)}while((Math.abs(A)>b||Math.abs(P)>b)&&--x>0);return new ti(be(h),be(p))}}class R4 extends Vp{constructor(r){super(r),this.center=r.center||[0,0],this.parallels=r.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Z(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(r,l){const{scale:h,cosPhi:p}=this;return{x:Z(r)*p*h+.5,y:-Math.sin(Z(l))/p*h+.5,z:0}}unproject(r,l){const{scale:h,cosPhi:p}=this,x=-(l-.5)/h,b=De(be((r-.5)/h)/p,-180,180),A=Math.asin(De(x*p,-1,1)),P=De(be(A),-Ra,Ra);return new ti(b,P)}}class hL extends P4{constructor(r){super(r),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(r,l,h){const p=uu(r,l,h);return Kt(p,p,Vr(ba(h))),{x:p[0],y:p[1],z:p[2]}}locationPoint(r,l){const h=$l(l.lat,l.lng),p=Mt([],h),x=r.elevation?r.elevation.getAtPointOrZero(r.locationCoordinate(l),r._centerAltitude):r._centerAltitude;St(h,h,p,Ga(1,0)*Wr*x);const b=Rc(new Float64Array(16));return id(b,r.pixelMatrix,r.globeMatrix),Kt(h,h,b),new q(h[0],h[1])}pixelsPerMeter(r,l){return Ga(1,0)*l}pixelSpaceConversion(r,l,h){const p=Ga(1,r)*l,x=He(Ga(1,45)*l,p,h);return this.pixelsPerMeter(r,l)/x}createTileMatrix(r,l,h){const p=ms(ba(h.canonical));return id(new Float64Array(16),r.globeMatrix,p)}createInversionMatrix(r,l){const{center:h}=r,p=Vr(ba(l));return Yf(p,p,Z(h.lng)),Rp(p,p,Z(h.lat)),od(p,p,[r._pixelsPerMercatorPixel,r._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(r,l,h,p){return mc(r,l,h,!0)||new pf(0,0)}pointCoordinate3D(r,l,h){const p=this.pointCoordinate(r,l,h,0);return[p.x,p.y,p.z]}isPointAboveHorizon(r,l){return!mc(r,l.x,l.y,!1)}farthestPixelDistance(r){const l=(function(p,x){const b=p.cameraToCenterDistance,A=p._centerAltitude*x,P=p._camera,M=p._camera.forward(),G=he([],$e([],M,-b),[0,0,A]),X=p.worldSize/(2*Math.PI),re=[0,0,-X],de=p.width/p.height,ye=Math.tan(p.fovAboveCenter),Se=$e([],P.up(),ye),We=$e([],P.right(),ye*de),at=Mt([],he([],he([],M,Se),We)),xt=[];let ct;if(new ki(G,at).closestPointOnSphere(re,X,xt)){const vt=he([],xt,re),It=$t([],vt,G);ct=Math.cos(p.fovAboveCenter)*df(It)}else{const vt=$t([],G,re),It=$t([],re,G);Mt(It,It);const Tt=df(vt)-X;ct=Math.sqrt(Tt*(Tt+2*X));const sn=Math.acos(ct/(X+Tt))-Math.acos(gt(M,It));ct*=Math.cos(sn)}return 1.01*ct})(r,this.pixelsPerMeter(r.center.lat,r.worldSize)),h=hu(r.zoom);if(h>0){const p=L4(r,Ga(1,r.center.lat)*r.worldSize),x=r.worldSize/(2*Math.PI),b=Math.max(r.width,r.height)/r.worldSize*Math.PI;return He(l,p+x*(1-Math.cos(b)),Math.pow(h,10))}return l}upVector(r,l,h){return uu(l,h,r,1)}upVectorScale(r){return{metersToTile:Zs(Ed(ba(r)))}}}function N4(s){const r=s.parallels,l=!!r&&Math.abs(r[0]+r[1])<.01;switch(s.name){case"mercator":return new P4(s);case"equirectangular":return new aL(s);case"naturalEarth":return new cL(s);case"equalEarth":return new sL(s);case"winkelTripel":return new uL(s);case"albers":return l?new R4(s):new oL(s);case"lambertConformalConic":return l?new R4(s):new lL(s);case"globe":return new hL(s)}throw new Error(`Invalid projection name: ${s.name}`)}const dL=Ri.types,fL=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function t1(s,r,l,h,p,x,b,A,P,M,G,X,re){const de=A?Math.min(Up,Math.round(A[0])):0,ye=A?Math.min(Up,Math.round(A[1])):0;s.emplaceBack(r,l,Math.round(32*h),Math.round(32*p),x,b,(de<<1)+(P?1:0),ye,16*M,16*G,256*X,256*re)}function n1(s,r,l,h,p,x,b){s.emplaceBack(r,l,h,p,x,b)}function r1(s,r,l,h,p){s.emplaceBack(r,l,h,p),s.emplaceBack(r,l,h,p),s.emplaceBack(r,l,h,p),s.emplaceBack(r,l,h,p)}function pL(s){for(const r of s.sections)if(rn(r.text))return!0;return!1}class Ox{constructor(r){this.layoutVertexArray=new bn,this.indexArray=new _r,this.programConfigurations=r,this.segments=new qa,this.dynamicLayoutVertexArray=new In,this.opacityVertexArray=new hr,this.placedSymbolArray=new Ts,this.globeExtVertexArray=new Rn}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(r,l,h,p){this.isEmpty()||(h&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,wC.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,EC.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,fL,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,SC.members,!0)),this.opacityVertexBuffer.itemSize=1),(h||p)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}lr(Ox,"SymbolBuffers");class Bx{constructor(r,l,h){this.layoutVertexArray=new r,this.layoutAttributes=l,this.indexArray=new h,this.segments=new qa,this.collisionVertexArray=new oi,this.collisionVertexArrayExt=new di}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,AC.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,TC.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}lr(Bx,"CollisionBuffers");class qp{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((b=>b.id)),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Rc([]),this.placementViewportMatrix=Rc([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Tx(this.zoom,l["text-size"]),this.iconSizeData=Tx(this.zoom,l["icon-size"]);const h=this.layers[0].layout,p=h.get("symbol-sort-key"),x=h.get("symbol-z-order");this.canOverlap=h.get("text-allow-overlap")||h.get("icon-allow-overlap")||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=h.get("text-writing-mode").map((b=>cd[b])),this.stateDependentLayerIds=this.layers.filter((b=>b.isStateDependent())).map((b=>b.id)),this.sourceID=r.sourceID,this.projection=r.projection}createArrays(){this.text=new Ox(new ju(this.layers,this.zoom,(r=>/^text/.test(r)))),this.icon=new Ox(new ju(this.layers,this.zoom,(r=>/^icon/.test(r)))),this.glyphOffsetArray=new ps,this.lineVertexArray=new hs,this.symbolInstances=new ts}calculateGlyphDependencies(r,l,h,p,x){for(let b=0;b<r.length;b++)if(l[r.charCodeAt(b)]=!0,p&&x){const A=sy[r.charAt(b)];A&&(l[A.charCodeAt(0)]=!0)}}populate(r,l,h,p){const x=this.layers[0],b=x.layout,A=this.projection.name==="globe",P=b.get("text-font"),M=b.get("text-field"),G=b.get("icon-image"),X=(M.value.kind!=="constant"||M.value.value instanceof mo&&!M.value.value.isEmpty()||M.value.value.toString().length>0)&&(P.value.kind!=="constant"||P.value.value.length>0),re=G.value.kind!=="constant"||!!G.value.value||Object.keys(G.parameters).length>0,de=b.get("symbol-sort-key");if(this.features=[],!X&&!re)return;const ye=l.iconDependencies,Se=l.glyphDependencies,We=l.availableImages,at=new $(this.zoom);for(const{feature:xt,id:ct,index:vt,sourceLayerIndex:It}of r){const Tt=x._featureFilter.needGeometry,sn=Id(xt,Tt);if(!x._featureFilter.filter(at,sn,h))continue;if(Tt||(sn.geometry=Su(xt,h,p)),A&&xt.type!==1&&h.z<=5){const dn=sn.geometry,Pn=.98078528056,kn=(zn,Xn)=>gt(uu(zn.x,zn.y,h,1),uu(Xn.x,Xn.y,h,1))<Pn;for(let zn=0;zn<dn.length;zn++)dn[zn]=Fp(dn[zn],kn)}let nn,Sn;if(X){const dn=x.getValueAndResolveTokens("text-field",sn,h,We),Pn=mo.factory(dn);pL(Pn)&&(this.hasRTLText=!0),(!this.hasRTLText||T()==="unavailable"||this.hasRTLText&&z.isParsed())&&(nn=LC(Pn,x,sn))}if(re){const dn=x.getValueAndResolveTokens("icon-image",sn,h,We);Sn=dn instanceof js?dn:js.fromString(dn)}if(!nn&&!Sn)continue;const qn=this.sortFeaturesByKey?de.evaluate(sn,{},h):void 0;if(this.features.push({id:ct,text:nn,icon:Sn,index:vt,sourceLayerIndex:It,geometry:sn.geometry,properties:xt.properties,type:dL[xt.type],sortKey:qn}),Sn&&(ye[Sn.name]=!0),nn){const dn=P.evaluate(sn,{},h).join(","),Pn=b.get("text-rotation-alignment")==="map"&&b.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(cd.vertical)>=0;for(const kn of nn.sections)if(kn.image)ye[kn.image.name]=!0;else{const zn=Pe(nn.toString()),Xn=kn.fontStack||dn,wn=Se[Xn]=Se[Xn]||{};this.calculateGlyphDependencies(kn.text,wn,Pn,this.allowVerticalPlacement,zn)}}}b.get("symbol-placement")==="line"&&(this.features=(function(xt){const ct={},vt={},It=[];let Tt=0;function sn(dn){It.push(xt[dn]),Tt++}function nn(dn,Pn,kn){const zn=vt[dn];return delete vt[dn],vt[Pn]=zn,It[zn].geometry[0].pop(),It[zn].geometry[0]=It[zn].geometry[0].concat(kn[0]),zn}function Sn(dn,Pn,kn){const zn=ct[Pn];return delete ct[Pn],ct[dn]=zn,It[zn].geometry[0].shift(),It[zn].geometry[0]=kn[0].concat(It[zn].geometry[0]),zn}function qn(dn,Pn,kn){const zn=kn?Pn[0][Pn[0].length-1]:Pn[0][0];return`${dn}:${zn.x}:${zn.y}`}for(let dn=0;dn<xt.length;dn++){const Pn=xt[dn],kn=Pn.geometry,zn=Pn.text?Pn.text.toString():null;if(!zn){sn(dn);continue}const Xn=qn(zn,kn),wn=qn(zn,kn,!0);if(Xn in vt&&wn in ct&&vt[Xn]!==ct[wn]){const pr=Sn(Xn,wn,kn),Br=nn(Xn,wn,It[pr].geometry);delete ct[Xn],delete vt[wn],vt[qn(zn,It[Br].geometry,!0)]=Br,It[pr].geometry=null}else Xn in vt?nn(Xn,wn,kn):wn in ct?Sn(Xn,wn,kn):(sn(dn),ct[Xn]=Tt-1,vt[wn]=Tt-1)}return It.filter((dn=>dn.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((xt,ct)=>xt.sortKey-ct.sortKey))}update(r,l,h,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,l,this.layers,h,p),this.icon.programConfigurations.updatePaintArrays(r,l,this.layers,h,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=N4(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,l){const h=this.lineVertexArray.length;if(r.segment!==void 0)for(const{x:p,y:x}of l)this.lineVertexArray.emplaceBack(p,x);return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(r,l,h,p,x,b,A,P,M,G,X,re,de,ye){const Se=r.indexArray,We=r.layoutVertexArray,at=r.globeExtVertexArray,xt=r.segments.prepareSegment(4*l.length,We,Se,this.canOverlap?b.sortKey:void 0),ct=this.glyphOffsetArray.length,vt=xt.vertexLength,It=this.allowVerticalPlacement&&A===cd.vertical?Math.PI/2:0,Tt=b.text&&b.text.sections;for(let nn=0;nn<l.length;nn++){const{tl:Sn,tr:qn,bl:dn,br:Pn,tex:kn,pixelOffsetTL:zn,pixelOffsetBR:Xn,minFontScaleX:wn,minFontScaleY:pr,glyphOffset:Br,isSDF:yr,sectionIndex:Wi}=l[nn],Zn=xt.vertexLength,ri=Br[1];if(t1(We,M.x,M.y,Sn.x,ri+Sn.y,kn.x,kn.y,h,yr,zn.x,zn.y,wn,pr),t1(We,M.x,M.y,qn.x,ri+qn.y,kn.x+kn.w,kn.y,h,yr,Xn.x,zn.y,wn,pr),t1(We,M.x,M.y,dn.x,ri+dn.y,kn.x,kn.y+kn.h,h,yr,zn.x,Xn.y,wn,pr),t1(We,M.x,M.y,Pn.x,ri+Pn.y,kn.x+kn.w,kn.y+kn.h,h,yr,Xn.x,Xn.y,wn,pr),P){const{x:Ki,y:is,z:Xi}=P.anchor,[bi,ha,Zi]=P.up;n1(at,Ki,is,Xi,bi,ha,Zi),n1(at,Ki,is,Xi,bi,ha,Zi),n1(at,Ki,is,Xi,bi,ha,Zi),n1(at,Ki,is,Xi,bi,ha,Zi),r1(r.dynamicLayoutVertexArray,Ki,is,Xi,It)}else r1(r.dynamicLayoutVertexArray,M.x,M.y,M.z,It);Se.emplaceBack(Zn,Zn+1,Zn+2),Se.emplaceBack(Zn+1,Zn+2,Zn+3),xt.vertexLength+=4,xt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Br[0]),nn!==l.length-1&&Wi===l[nn+1].sectionIndex||r.programConfigurations.populatePaintArrays(We.length,b,b.index,{},de,ye,Tt&&Tt[Wi])}const sn=P?P.anchor:M;r.placedSymbolArray.emplaceBack(sn.x,sn.y,sn.z,M.x,M.y,ct,this.glyphOffsetArray.length-ct,vt,G,X,M.segment,h?h[0]:0,h?h[1]:0,p[0],p[1],A,0,!1,0,re,0)}_commitLayoutVertex(r,l,h,p,x,b,A){r.emplaceBack(l,h,p,x,b,Math.round(A.x),Math.round(A.y))}_addCollisionDebugVertices(r,l,h,p,x,b,A){const P=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),M=P.vertexLength,G=A.tileAnchorX,X=A.tileAnchorY;for(let de=0;de<4;de++)h.collisionVertexArray.emplaceBack(0,0,0,0);h.collisionVertexArrayExt.emplaceBack(l,-r.padding,-r.padding),h.collisionVertexArrayExt.emplaceBack(l,r.padding,-r.padding),h.collisionVertexArrayExt.emplaceBack(l,r.padding,r.padding),h.collisionVertexArrayExt.emplaceBack(l,-r.padding,r.padding),this._commitLayoutVertex(h.layoutVertexArray,p,x,b,G,X,new q(r.x1,r.y1)),this._commitLayoutVertex(h.layoutVertexArray,p,x,b,G,X,new q(r.x2,r.y1)),this._commitLayoutVertex(h.layoutVertexArray,p,x,b,G,X,new q(r.x2,r.y2)),this._commitLayoutVertex(h.layoutVertexArray,p,x,b,G,X,new q(r.x1,r.y2)),P.vertexLength+=4;const re=h.indexArray;re.emplaceBack(M,M+1),re.emplaceBack(M+1,M+2),re.emplaceBack(M+2,M+3),re.emplaceBack(M+3,M),P.primitiveLength+=4}_addTextDebugCollisionBoxes(r,l,h,p,x,b){for(let A=p;A<x;A++){const P=h.get(A),M=this.getSymbolInstanceTextSize(r,b,l,A);this._addCollisionDebugVertices(P,M,this.textCollisionBox,P.projectedAnchorX,P.projectedAnchorY,P.projectedAnchorZ,b)}}_addIconDebugCollisionBoxes(r,l,h,p,x,b){for(let A=p;A<x;A++){const P=h.get(A),M=this.getSymbolInstanceIconSize(r,l,b.placedIconSymbolIndex);this._addCollisionDebugVertices(P,M,this.iconCollisionBox,P.projectedAnchorX,P.projectedAnchorY,P.projectedAnchorZ,b)}}generateCollisionDebugBuffers(r,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Bx(sr,Q3.members,us),this.iconCollisionBox=new Bx(sr,Q3.members,us);const h=Mg(this.iconSizeData,r),p=Mg(this.textSizeData,r);for(let x=0;x<this.symbolInstances.length;x++){const b=this.symbolInstances.get(x);this._addTextDebugCollisionBoxes(p,r,l,b.textBoxStartIndex,b.textBoxEndIndex,b),this._addTextDebugCollisionBoxes(p,r,l,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b),this._addIconDebugCollisionBoxes(h,r,l,b.iconBoxStartIndex,b.iconBoxEndIndex,b),this._addIconDebugCollisionBoxes(h,r,l,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b)}}getSymbolInstanceTextSize(r,l,h,p){const x=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:p),b=G_(this.textSizeData,r,x)/du;return this.tilePixelRatio*b}getSymbolInstanceIconSize(r,l,h){const p=this.icon.placedSymbolArray.get(h),x=G_(this.iconSizeData,r,p);return this.tilePixelRatio*x}_commitDebugCollisionVertexUpdate(r,l,h){r.emplaceBack(l,-h,-h),r.emplaceBack(l,h,-h),r.emplaceBack(l,h,h),r.emplaceBack(l,-h,h)}_updateTextDebugCollisionBoxes(r,l,h,p,x,b){for(let A=p;A<x;A++){const P=h.get(A),M=this.getSymbolInstanceTextSize(r,b,l,A);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,M,P.padding)}}_updateIconDebugCollisionBoxes(r,l,h,p,x,b){for(let A=p;A<x;A++){const P=h.get(A),M=this.getSymbolInstanceIconSize(r,l,b);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,M,P.padding)}}updateCollisionDebugBuffers(r,l){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const h=Mg(this.iconSizeData,r),p=Mg(this.textSizeData,r);for(let x=0;x<this.symbolInstances.length;x++){const b=this.symbolInstances.get(x);this._updateTextDebugCollisionBoxes(p,r,l,b.textBoxStartIndex,b.textBoxEndIndex,b),this._updateTextDebugCollisionBoxes(p,r,l,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b),this._updateIconDebugCollisionBoxes(h,r,l,b.iconBoxStartIndex,b.iconBoxEndIndex,b.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(h,r,l,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,l,h,p,x,b,A,P,M){const G={};if(l<h){const{x1:X,y1:re,x2:de,y2:ye,padding:Se,projectedAnchorX:We,projectedAnchorY:at,projectedAnchorZ:xt,tileAnchorX:ct,tileAnchorY:vt,featureIndex:It}=r.get(l);G.textBox={x1:X,y1:re,x2:de,y2:ye,padding:Se,projectedAnchorX:We,projectedAnchorY:at,projectedAnchorZ:xt,tileAnchorX:ct,tileAnchorY:vt},G.textFeatureIndex=It}if(p<x){const{x1:X,y1:re,x2:de,y2:ye,padding:Se,projectedAnchorX:We,projectedAnchorY:at,projectedAnchorZ:xt,tileAnchorX:ct,tileAnchorY:vt,featureIndex:It}=r.get(p);G.verticalTextBox={x1:X,y1:re,x2:de,y2:ye,padding:Se,projectedAnchorX:We,projectedAnchorY:at,projectedAnchorZ:xt,tileAnchorX:ct,tileAnchorY:vt},G.verticalTextFeatureIndex=It}if(b<A){const{x1:X,y1:re,x2:de,y2:ye,padding:Se,projectedAnchorX:We,projectedAnchorY:at,projectedAnchorZ:xt,tileAnchorX:ct,tileAnchorY:vt,featureIndex:It}=r.get(b);G.iconBox={x1:X,y1:re,x2:de,y2:ye,padding:Se,projectedAnchorX:We,projectedAnchorY:at,projectedAnchorZ:xt,tileAnchorX:ct,tileAnchorY:vt},G.iconFeatureIndex=It}if(P<M){const{x1:X,y1:re,x2:de,y2:ye,padding:Se,projectedAnchorX:We,projectedAnchorY:at,projectedAnchorZ:xt,tileAnchorX:ct,tileAnchorY:vt,featureIndex:It}=r.get(P);G.verticalIconBox={x1:X,y1:re,x2:de,y2:ye,padding:Se,projectedAnchorX:We,projectedAnchorY:at,projectedAnchorZ:xt,tileAnchorX:ct,tileAnchorY:vt},G.verticalIconFeatureIndex=It}return G}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const h=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,l){const h=r.placedSymbolArray.get(l),p=h.vertexStartIndex+4*h.numGlyphs;for(let x=h.vertexStartIndex;x<p;x+=4)r.indexArray.emplaceBack(x,x+1,x+2),r.indexArray.emplaceBack(x+1,x+2,x+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const l=Math.sin(r),h=Math.cos(r),p=[],x=[],b=[];for(let A=0;A<this.symbolInstances.length;++A){b.push(A);const P=this.symbolInstances.get(A);p.push(0|Math.round(l*P.tileAnchorX+h*P.tileAnchorY)),x.push(P.featureIndex)}return b.sort(((A,P)=>p[A]-p[P]||x[P]-x[A])),b}addToSortKeyRanges(r,l){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===l?h.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const h=this.symbolInstances.get(l);this.featureSortOrder.push(h.featureIndex);const{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:x,leftJustifiedTextSymbolIndex:b,verticalPlacedTextSymbolIndex:A,placedIconSymbolIndex:P,verticalPlacedIconSymbolIndex:M}=h;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),x>=0&&x!==p&&this.addIndicesForPlacedSymbol(this.text,x),b>=0&&b!==x&&b!==p&&this.addIndicesForPlacedSymbol(this.text,b),A>=0&&this.addIndicesForPlacedSymbol(this.text,A),P>=0&&this.addIndicesForPlacedSymbol(this.icon,P),M>=0&&this.addIndicesForPlacedSymbol(this.icon,M)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}lr(qp,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),qp.MAX_GLYPHS=65535,qp.addDynamicAttributes=r1;const mL=new ot({"symbol-placement":new _e(pn.layout_symbol["symbol-placement"]),"symbol-spacing":new _e(pn.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new _e(pn.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ge(pn.layout_symbol["symbol-sort-key"]),"symbol-z-order":new _e(pn.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new _e(pn.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new _e(pn.layout_symbol["icon-ignore-placement"]),"icon-optional":new _e(pn.layout_symbol["icon-optional"]),"icon-rotation-alignment":new _e(pn.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ge(pn.layout_symbol["icon-size"]),"icon-text-fit":new _e(pn.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new _e(pn.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ge(pn.layout_symbol["icon-image"]),"icon-rotate":new Ge(pn.layout_symbol["icon-rotate"]),"icon-padding":new _e(pn.layout_symbol["icon-padding"]),"icon-keep-upright":new _e(pn.layout_symbol["icon-keep-upright"]),"icon-offset":new Ge(pn.layout_symbol["icon-offset"]),"icon-anchor":new Ge(pn.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new _e(pn.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new _e(pn.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new _e(pn.layout_symbol["text-rotation-alignment"]),"text-field":new Ge(pn.layout_symbol["text-field"]),"text-font":new Ge(pn.layout_symbol["text-font"]),"text-size":new Ge(pn.layout_symbol["text-size"]),"text-max-width":new Ge(pn.layout_symbol["text-max-width"]),"text-line-height":new Ge(pn.layout_symbol["text-line-height"]),"text-letter-spacing":new Ge(pn.layout_symbol["text-letter-spacing"]),"text-justify":new Ge(pn.layout_symbol["text-justify"]),"text-radial-offset":new Ge(pn.layout_symbol["text-radial-offset"]),"text-variable-anchor":new _e(pn.layout_symbol["text-variable-anchor"]),"text-anchor":new Ge(pn.layout_symbol["text-anchor"]),"text-max-angle":new _e(pn.layout_symbol["text-max-angle"]),"text-writing-mode":new _e(pn.layout_symbol["text-writing-mode"]),"text-rotate":new Ge(pn.layout_symbol["text-rotate"]),"text-padding":new _e(pn.layout_symbol["text-padding"]),"text-keep-upright":new _e(pn.layout_symbol["text-keep-upright"]),"text-transform":new Ge(pn.layout_symbol["text-transform"]),"text-offset":new Ge(pn.layout_symbol["text-offset"]),"text-allow-overlap":new _e(pn.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new _e(pn.layout_symbol["text-ignore-placement"]),"text-optional":new _e(pn.layout_symbol["text-optional"])});var zx={paint:new ot({"icon-opacity":new Ge(pn.paint_symbol["icon-opacity"]),"icon-color":new Ge(pn.paint_symbol["icon-color"]),"icon-halo-color":new Ge(pn.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ge(pn.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ge(pn.paint_symbol["icon-halo-blur"]),"icon-translate":new _e(pn.paint_symbol["icon-translate"]),"icon-translate-anchor":new _e(pn.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ge(pn.paint_symbol["text-opacity"]),"text-color":new Ge(pn.paint_symbol["text-color"],{runtimeType:zs,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new Ge(pn.paint_symbol["text-halo-color"]),"text-halo-width":new Ge(pn.paint_symbol["text-halo-width"]),"text-halo-blur":new Ge(pn.paint_symbol["text-halo-blur"]),"text-translate":new _e(pn.paint_symbol["text-translate"]),"text-translate-anchor":new _e(pn.paint_symbol["text-translate-anchor"])}),layout:mL};class D4{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:ks,this.defaultValue=r}evaluate(r){if(r.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(r.formattedSection))return l.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}lr(D4,"FormatSectionOverride",{omit:["defaultValue"]});class i1 extends ih{constructor(r){super(r,zx)}recalculate(r,l){super.recalculate(r,l),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const h=this.layout.get("text-writing-mode");if(h){const p=[];for(const x of h)p.indexOf(x)<0&&p.push(x);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(r,l,h,p){const x=this.layout.get(r).evaluate(l,{},h,p),b=this._unevaluatedLayout._values[r];return b.isDataDriven()||_a(b.value)||!x?x:(function(A,P){return P.replace(/{([^{}]+)}/g,((M,G)=>G in A?String(A[G]):""))})(l.properties,x)}createBucket(r){return new qp(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of zx.paint.overridableProperties){if(!i1.hasPaintOverride(this.layout,r))continue;const l=this.paint.get(r),h=new D4(l),p=new ml(h,l.property.specification);let x=null;x=l.value.kind==="constant"||l.value.kind==="source"?new Fu("source",p):new Ic("composite",p,l.value.zoomStops,l.value._interpolationType),this.paint._values[r]=new Ue(l.property,x,l.parameters)}}_handleOverridablePaintPropertyUpdate(r,l,h){return!(!this.layout||l.isDataDriven()||h.isDataDriven())&&i1.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,l){const h=r.get("text-field"),p=zx.paint.properties[l];let x=!1;const b=A=>{for(const P of A)if(p.overrides&&p.overrides.hasOverride(P))return void(x=!0)};if(h.value.kind==="constant"&&h.value.value instanceof mo)b(h.value.value.sections);else if(h.value.kind==="source"){const A=M=>{x||(M instanceof Us&&go(M.value)===El?b(M.value.sections):M instanceof Ja?b(M.sections):M.eachChild(A))},P=h.value;P._styleExpression&&A(P._styleExpression.expression)}return x}getProgramConfiguration(r){return new Th(this,r)}}var gL={paint:new ot({"background-color":new _e(pn.paint_background["background-color"]),"background-pattern":new _e(pn.paint_background["background-pattern"]),"background-opacity":new _e(pn.paint_background["background-opacity"])})},yL={paint:new ot({"raster-opacity":new _e(pn.paint_raster["raster-opacity"]),"raster-hue-rotate":new _e(pn.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new _e(pn.paint_raster["raster-brightness-min"]),"raster-brightness-max":new _e(pn.paint_raster["raster-brightness-max"]),"raster-saturation":new _e(pn.paint_raster["raster-saturation"]),"raster-contrast":new _e(pn.paint_raster["raster-contrast"]),"raster-resampling":new _e(pn.paint_raster["raster-resampling"]),"raster-fade-duration":new _e(pn.paint_raster["raster-fade-duration"])})};class _L extends ih{constructor(r){super(r,{}),this.implementation=r}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}var vL={paint:new ot({"sky-type":new _e(pn.paint_sky["sky-type"]),"sky-atmosphere-sun":new _e(pn.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new _e(pn.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new _e(pn.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new _e(pn.paint_sky["sky-gradient-radius"]),"sky-gradient":new it(pn.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new _e(pn.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new _e(pn.paint_sky["sky-atmosphere-color"]),"sky-opacity":new _e(pn.paint_sky["sky-opacity"])})};function jx(s,r,l){const h=[0,0,1],p=Yr([]);return Gi(p,p,l?-Z(s)+Math.PI:Z(s)),Jr(p,p,-Z(r)),gn(h,h,p),Mt(h,h)}const xL={circle:class extends ih{constructor(s){super(s,B_)}createBucket(s){return new np(s)}queryRadius(s){const r=s;return rp("circle-radius",this,r)+rp("circle-stroke-width",this,r)+Op(this.paint.get("circle-translate"))}queryIntersectsFeature(s,r,l,h,p,x,b,A){const P=Eg(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,s.pixelToTileUnitsFactor),M=this.paint.get("circle-radius").evaluate(r,l)+this.paint.get("circle-stroke-width").evaluate(r,l);return G0(s,h,x,b,A,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",P,M)}getProgramIds(){return["circle"]}getProgramConfiguration(s){return new Th(this,s)}},heatmap:class extends ih{createBucket(s){return new W0(s)}constructor(s){super(s,Cl),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Z0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(s){return rp("heatmap-radius",this,s)}queryIntersectsFeature(s,r,l,h,p,x,b,A){const P=this.paint.get("heatmap-radius").evaluate(r,l);return G0(s,h,x,b,A,!0,!0,new q(0,0),P)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(s){return new Th(this,s)}},hillshade:class extends ih{constructor(s){super(s,z_)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends ih{constructor(s){super(s,K)}getProgramIds(){const s=this.paint.get("fill-pattern"),r=s&&s.constantOr(1),l=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getProgramConfiguration(s){return new Th(this,s)}recalculate(s,r){super.recalculate(s,r);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new E(s)}queryRadius(){return Op(this.paint.get("fill-translate"))}queryIntersectsFeature(s,r,l,h,p,x){return!s.queryGeometry.isAboveHorizon&&Em(gf(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,s.pixelToTileUnitsFactor),h)}isTileClipped(){return!0}},"fill-extrusion":class extends ih{constructor(s){super(s,pC)}createBucket(s){return new ry(s)}queryRadius(){return Op(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(s){return new Th(this,s)}queryIntersectsFeature(s,r,l,h,p,x,b,A,P){const M=Eg(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,s.pixelToTileUnitsFactor),G=this.paint.get("fill-extrusion-height").evaluate(r,l),X=this.paint.get("fill-extrusion-base").evaluate(r,l),re=[0,0],de=A&&x.elevation,ye=x.elevation?x.elevation.exaggeration():1,Se=s.tile.getBucket(this);if(de&&Se instanceof ry){const vt=Se.centroidVertexArray,It=P+1;It<vt.length&&(re[0]=vt.geta_centroid_pos0(It),re[1]=vt.geta_centroid_pos1(It))}if(re[0]===0&&re[1]===1)return!1;x.projection.name==="globe"&&(h=G3([h],[new q(0,0),new q(Wr,Wr)],s.tileID.canonical).map((vt=>vt.polygon)).flat());const We=de?A:null,[at,xt]=(function(vt,It,Tt,sn,nn,Sn,qn,dn,Pn,kn,zn){return vt.projection.name==="globe"?(function(Xn,wn,pr,Br,yr,Wi,Zn,ri,Ki,is,Xi){const bi=[],ha=[],Zi=Xn.projection.upVectorScale(Xi,Xn.center.lat,Xn.worldSize).metersToTile,Yi=[0,0,0,1],Ds=[0,0,0,1],Qs=(Fs,Ha,xl,Hl)=>{Fs[0]=Ha,Fs[1]=xl,Fs[2]=Hl,Fs[3]=1},ea=$3();pr>0&&(pr+=ea),Br+=ea;for(const Fs of wn){const Ha=[],xl=[];for(const Hl of Fs){const Os=Hl.x+yr.x,_c=Hl.y+yr.y,Wl=Xn.projection.projectTilePoint(Os,_c,Xi),sl=Xn.projection.upVector(Xi,Hl.x,Hl.y);let ls=pr,Kl=Br;if(Zn){const ta=X3(Os,_c,pr,Br,Zn,ri,Ki,is);ls+=ta.base,Kl+=ta.top}pr!==0?Qs(Yi,Wl.x+sl[0]*Zi*ls,Wl.y+sl[1]*Zi*ls,Wl.z+sl[2]*Zi*ls):Qs(Yi,Wl.x,Wl.y,Wl.z),Qs(Ds,Wl.x+sl[0]*Zi*Kl,Wl.y+sl[1]*Zi*Kl,Wl.z+sl[2]*Zi*Kl),Kt(Yi,Yi,Wi),Kt(Ds,Ds,Wi),Ha.push(new kg(Yi[0],Yi[1],Yi[2])),xl.push(new kg(Ds[0],Ds[1],Ds[2]))}bi.push(Ha),ha.push(xl)}return[bi,ha]})(vt,It,Tt,sn,nn,Sn,qn,dn,Pn,kn,zn):qn?(function(Xn,wn,pr,Br,yr,Wi,Zn,ri,Ki){const is=[],Xi=[],bi=[0,0,0,1];for(const ha of Xn){const Zi=[],Yi=[];for(const Ds of ha){const Qs=Ds.x+Br.x,ea=Ds.y+Br.y,Fs=X3(Qs,ea,wn,pr,Wi,Zn,ri,Ki);bi[0]=Qs,bi[1]=ea,bi[2]=Fs.base,bi[3]=1,rr(bi,bi,yr),bi[3]=Math.max(bi[3],1e-5);const Ha=new kg(bi[0]/bi[3],bi[1]/bi[3],bi[2]/bi[3]);bi[0]=Qs,bi[1]=ea,bi[2]=Fs.top,bi[3]=1,rr(bi,bi,yr),bi[3]=Math.max(bi[3],1e-5);const xl=new kg(bi[0]/bi[3],bi[1]/bi[3],bi[2]/bi[3]);Zi.push(Ha),Yi.push(xl)}is.push(Zi),Xi.push(Yi)}return[is,Xi]})(It,Tt,sn,nn,Sn,qn,dn,Pn,kn):(function(Xn,wn,pr,Br,yr){const Wi=[],Zn=[],ri=yr[8]*wn,Ki=yr[9]*wn,is=yr[10]*wn,Xi=yr[11]*wn,bi=yr[8]*pr,ha=yr[9]*pr,Zi=yr[10]*pr,Yi=yr[11]*pr;for(const Ds of Xn){const Qs=[],ea=[];for(const Fs of Ds){const Ha=Fs.x+Br.x,xl=Fs.y+Br.y,Hl=yr[0]*Ha+yr[4]*xl+yr[12],Os=yr[1]*Ha+yr[5]*xl+yr[13],_c=yr[2]*Ha+yr[6]*xl+yr[14],Wl=yr[3]*Ha+yr[7]*xl+yr[15],sl=Hl+ri,ls=Os+Ki,Kl=_c+is,ta=Math.max(Wl+Xi,1e-5),ah=Hl+bi,Xl=Os+ha,fu=_c+Zi,Xc=Math.max(Wl+Yi,1e-5);Qs.push(new kg(sl/ta,ls/ta,Kl/ta)),ea.push(new kg(ah/Xc,Xl/Xc,fu/Xc))}Wi.push(Qs),Zn.push(ea)}return[Wi,Zn]})(It,Tt,sn,nn,Sn)})(x,h,X,G,M,b,We,re,ye,x.center.lat,s.tileID.canonical),ct=s.queryGeometry;return(function(vt,It,Tt){let sn=1/0;Em(Tt,It)&&(sn=K3(Tt,It[0]));for(let nn=0;nn<It.length;nn++){const Sn=It[nn],qn=vt[nn];for(let dn=0;dn<Sn.length-1;dn++){const Pn=Sn[dn],kn=[Pn,Sn[dn+1],qn[dn+1],qn[dn],Pn];bg(Tt,kn)&&(sn=Math.min(sn,K3(Tt,kn)))}}return sn!==1/0&&sn})(at,xt,ct.isPointQuery()?ct.screenBounds:ct.screenGeometry)}},line:class extends ih{constructor(s){super(s,Z3),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof ve,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(s,r){super.recalculate(s,r),this.paint._values["line-floorwidth"]=Y3.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new $_(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(s){return new Th(this,s)}queryRadius(s){const r=s,l=J3(rp("line-width",this,r),rp("line-gap-width",this,r)),h=rp("line-offset",this,r);return l/2+Math.abs(h)+Op(this.paint.get("line-translate"))}queryIntersectsFeature(s,r,l,h,p,x){if(s.queryGeometry.isAboveHorizon)return!1;const b=gf(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,s.pixelToTileUnitsFactor),A=s.pixelToTileUnitsFactor/2*J3(this.paint.get("line-width").evaluate(r,l),this.paint.get("line-gap-width").evaluate(r,l)),P=this.paint.get("line-offset").evaluate(r,l);return P&&(h=(function(M,G){const X=[],re=new q(0,0);for(let de=0;de<M.length;de++){const ye=M[de],Se=[];for(let We=0;We<ye.length;We++){const at=ye[We],xt=ye[We+1],ct=We===0?re:at.sub(ye[We-1])._unit()._perp(),vt=We===ye.length-1?re:xt.sub(at)._unit()._perp(),It=ct._add(vt)._unit();It._mult(1/(It.x*vt.x+It.y*vt.y)),Se.push(It._mult(G)._add(at))}X.push(Se)}return X})(h,P*s.pixelToTileUnitsFactor)),(function(M,G,X){for(let re=0;re<G.length;re++){const de=G[re];if(M.length>=3){for(let ye=0;ye<de.length;ye++)if(Ud(M,de[ye]))return!0}if(Vu(M,de,X))return!0}return!1})(b,h,A)}isTileClipped(){return!0}},symbol:i1,background:class extends ih{constructor(s){super(s,gL)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends ih{constructor(s){super(s,yL)}getProgramIds(){return["raster"]}},sky:class extends ih{constructor(s){super(s,vL),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="sky-gradient"?this._updateColorRamp():s!=="sky-atmosphere-sun"&&s!=="sky-atmosphere-halo-color"&&s!=="sky-atmosphere-color"&&s!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Z0({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}return!1}getCenter(s,r){if(this.paint.get("sky-type")==="atmosphere"){const h=this.paint.get("sky-atmosphere-sun"),p=!h,x=s.style.light,b=x.properties.get("position");return p&&x.properties.get("anchor")==="viewport"&&fr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?jx(b.azimuthal,90-b.polar,r):jx(h[0],90-h[1],r)}const l=this.paint.get("sky-gradient-center");return jx(l[0],90-l[1],r)}is3D(){return!1}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return s==="atmosphere"?["skyboxCapture","skybox"]:s==="gradient"?["skyboxGradient"]:null}}};class py{constructor(r,l,h,p){this.context=r,this.format=h,this.texture=r.gl.createTexture(),this.update(l,p)}update(r,l,h){const{width:p,height:x}=r,{context:b}=this,{gl:A}=b,{HTMLImageElement:P,HTMLCanvasElement:M,HTMLVideoElement:G,ImageData:X,ImageBitmap:re}=w;if(A.bindTexture(A.TEXTURE_2D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(this.format===A.RGBA&&(!l||l.premultiply!==!1)),h||this.size&&this.size[0]===p&&this.size[1]===x){const{x:de,y:ye}=h||{x:0,y:0};r instanceof P||r instanceof M||r instanceof G||r instanceof X||re&&r instanceof re?A.texSubImage2D(A.TEXTURE_2D,0,de,ye,A.RGBA,A.UNSIGNED_BYTE,r):A.texSubImage2D(A.TEXTURE_2D,0,de,ye,p,x,A.RGBA,A.UNSIGNED_BYTE,r.data)}else this.size=[p,x],r instanceof P||r instanceof M||r instanceof G||r instanceof X||re&&r instanceof re?A.texImage2D(A.TEXTURE_2D,0,this.format,this.format,A.UNSIGNED_BYTE,r):A.texImage2D(A.TEXTURE_2D,0,this.format,p,x,0,this.format,A.UNSIGNED_BYTE,r.data);this.useMipmap=!!(l&&l.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&A.generateMipmap(A.TEXTURE_2D)}bind(r,l){const{context:h}=this,{gl:p}=h;p.bindTexture(p.TEXTURE_2D,this.texture),r!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,r),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?r===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_NEAREST:r),this.filter=r),l!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,l),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class bL{constructor(r){this._callback=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class wL{constructor(){this.tasks={},this.taskQueue=[],tn(["process"],this),this.invoker=new bL(this.process),this.nextId=0}add(r,l){const h=this.nextId++,p=(function({type:x,isSymbolTile:b,zoom:A}){return A=A||0,x==="message"?0:x!=="maybePrepare"||b?x!=="parseTile"||b?x==="parseTile"&&b?300-A:x==="maybePrepare"&&b?400-A:500:200-A:100-A})(l);if(p===0){Cn();try{r()}finally{}return{cancel:()=>{}}}return this.tasks[h]={fn:r,metadata:l,priority:p,id:h},this.taskQueue.push(h),this.invoker.trigger(),{cancel:()=>{delete this.tasks[h]}}}process(){Cn();try{if(this.taskQueue=this.taskQueue.filter((h=>!!this.tasks[h])),!this.taskQueue.length)return;const r=this.pick();if(r===null)return;const l=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let r=null,l=1/0;for(let p=0;p<this.taskQueue.length;p++){const x=this.tasks[this.taskQueue[p]];x.priority<l&&(l=x.priority,r=p)}if(r===null)return null;const h=this.taskQueue[r];return this.taskQueue.splice(r,1),h}remove(){this.invoker.remove()}}class F4{constructor(r){this._stringToNumber={},this._numberToString=[];for(let l=0;l<r.length;l++){const h=r[l];this._stringToNumber[h]=l,this._numberToString[l]=h}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}const SL=["tile","layer","source","sourceLayer","state"];class O4{constructor(r,l,h,p,x){this.type="Feature",this._vectorTileFeature=r,this._z=l,this._x=h,this._y=p,this.properties=r.properties,this.id=x}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(r.id=this.id);for(const l of SL)this[l]!==void 0&&(r[l]=this[l]);return r}}const Ld=32,xf=33,$p=new Uint16Array(8184);for(let s=0;s<2046;s++){let r=s+2,l=0,h=0,p=0,x=0,b=0,A=0;for(1&r?p=x=b=Ld:l=h=A=Ld;(r>>=1)>1;){const M=l+p>>1,G=h+x>>1;1&r?(p=l,x=h,l=b,h=A):(l=p,h=x,p=b,x=A),b=M,A=G}const P=4*s;$p[P+0]=l,$p[P+1]=h,$p[P+2]=p,$p[P+3]=x}const bf=new Uint16Array(2178),Gp=new Uint8Array(1089),o1=new Uint16Array(1089);function B4(s){return s===0?-.03125:s===32?.03125:0}var z4=kt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const j4={type:2,extent:Wr,loadGeometry:()=>[[new q(0,0),new q(Wr+1,0),new q(Wr+1,Wr+1),new q(0,Wr+1),new q(0,0)]]};class Ux{constructor(r,l,h,p,x){this.tileID=r,this.uid=rt(),this.uses=0,this.tileSize=l,this.tileZoom=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=x,this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection)}registerFadeDuration(r){const l=r+this.timeAdded;l<Zo.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Nm(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,l,h){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=(function(p,x){const b={};if(!x)return b;for(const A of p){const P=A.layerIds.map((M=>x.getLayer(M))).filter(Boolean);if(P.length!==0){A.layers=P,A.stateDependentLayerIds&&(A.stateDependentLayers=A.stateDependentLayerIds.map((M=>P.filter((G=>G.id===M))[0])));for(const M of P)b[M.id]=A}}return b})(r.buckets,l.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const x=this.buckets[p];if(x instanceof qp){if(this.hasSymbolBuckets=!0,!h)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const x=this.buckets[p];if(x instanceof qp&&x.hasRTLText){this.hasRTLText=!0,z.isLoading()||z.isLoaded()||T()!=="deferred"||N();break}}this.queryPadding=0;for(const p in this.buckets){const x=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(p).queryRadius(x))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas)}else this.collisionBoxArray=new Qi}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(r){return this.buckets[r.id]}upload(r){for(const h in this.buckets){const p=this.buckets[h];p.uploadPending()&&p.upload(r)}const l=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new py(r,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new py(r,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new py(r,this.lineAtlas.image,l.ALPHA),this.lineAtlas.uploaded=!0)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,l,h,p,x,b,A,P){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:p,pixelPosMatrix:A,transform:b,params:x,tileTransform:this.tileTransform},r,l,h):{}}querySourceFeatures(r,l){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const p=h.loadVTLayers(),x=l?l.sourceLayer:"",b=p._geojsonTileLayer||p[x];if(!b)return;const A=th(l&&l.filter),{z:P,x:M,y:G}=this.tileID.canonical,X={z:P,x:M,y:G};for(let re=0;re<b.length;re++){const de=b.feature(re);if(A.needGeometry){const We=Id(de,!0);if(!A.filter(new $(this.tileID.overscaledZ),We,this.tileID.canonical))continue}else if(!A.filter(new $(this.tileID.overscaledZ),de))continue;const ye=h.getId(de,x),Se=new O4(de,P,M,G,ye);Se.tile=X,r.push(Se)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const l=this.expirationTime;if(r.cacheControl){const h=ir(r.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const h=Date.now();let p=!1;if(this.expirationTime>h)p=!1;else if(l)if(this.expirationTime<l)p=!0;else{const x=this.expirationTime-l;x?this.expirationTime=h+Math.max(x,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(r,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(r).length===0||!l)return;const h=this.latestFeatureIndex.loadVTLayers(),p=l.style.listImages();for(const x in this.buckets){if(!l.style.hasLayer(x))continue;const b=this.buckets[x],A=b.layers[0].sourceLayer||"_geojsonTileLayer",P=h[A],M=r[A];if(!P||!M||Object.keys(M).length===0)continue;if(b.update(M,P,p,this.imageAtlas&&this.imageAtlas.patternPositions||{}),b instanceof $_||b instanceof E){const X=l.style._getSourceCache(b.layers[0].source);l._terrain&&l._terrain.enabled&&X&&b.programConfigurations.needsUpload&&l._terrain._clearRenderCacheForTile(X.id,this.tileID)}const G=l&&l.style&&l.style.getLayer(x);G&&(this.queryPadding=Math.max(this.queryPadding,G.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Zo.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=Zo.now()+r}setTexture(r,l){const h=l.context,p=h.gl;this.texture=this.texture||l.getTileTexture(r.width),this.texture?this.texture.update(r,{useMipmap:!0}):(this.texture=new py(h,r,p.RGBA,{useMipmap:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE))}setDependencies(r,l){const h={};for(const p of l)h[p]=!0;this.dependencies[r]=h}hasDependency(r,l){for(const h of r){const p=this.dependencies[h];if(p){for(const x of l)if(p[x])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,l){if(!l||l.name==="mercator"||this._tileDebugBuffer)return;const h=Su(j4,this.tileID.canonical,this.tileTransform)[0],p=new _n,x=new uc;for(let b=0;b<h.length;b++){const{x:A,y:P}=h[b];p.emplaceBack(A,P),x.emplaceBack(b)}x.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(x),this._tileDebugBuffer=r.createVertexBuffer(p,Kr.members),this._tileDebugSegments=qa.simpleSegment(0,0,p.length,x.length)}_makeTileBoundsBuffers(r,l){if(this._tileBoundsBuffer||!l||l.name==="mercator")return;const h=Su(j4,this.tileID.canonical,this.tileTransform)[0];let p,x;if(this.isRaster){const b=(function(A,P){const M=Nm(A,P),G=Math.pow(2,A.z);for(let We=0;We<xf;We++)for(let at=0;at<xf;at++){const xt=yc((A.x+(at+B4(at))/Ld)/G),ct=Ho((A.y+(We+B4(We))/Ld)/G),vt=P.project(xt,ct),It=We*xf+at;bf[2*It+0]=Math.round((vt.x*M.scale-M.x)*Wr),bf[2*It+1]=Math.round((vt.y*M.scale-M.y)*Wr)}Gp.fill(0),o1.fill(0);for(let We=2045;We>=0;We--){const at=4*We,xt=$p[at+0],ct=$p[at+1],vt=$p[at+2],It=$p[at+3],Tt=xt+vt>>1,sn=ct+It>>1,nn=Tt+sn-ct,Sn=sn+xt-Tt,qn=ct*xf+xt,dn=It*xf+vt,Pn=sn*xf+Tt,kn=Math.hypot((bf[2*qn+0]+bf[2*dn+0])/2-bf[2*Pn+0],(bf[2*qn+1]+bf[2*dn+1])/2-bf[2*Pn+1])>=16;Gp[Pn]=Gp[Pn]||(kn?1:0),We<1022&&(Gp[Pn]=Gp[Pn]||Gp[(ct+Sn>>1)*xf+(xt+nn>>1)]||Gp[(It+Sn>>1)*xf+(vt+nn>>1)])}const X=new cn,re=new _r;let de=0;function ye(We,at){const xt=at*xf+We;return o1[xt]===0&&(X.emplaceBack(bf[2*xt+0],bf[2*xt+1],We*Wr/Ld,at*Wr/Ld),o1[xt]=++de),o1[xt]-1}function Se(We,at,xt,ct,vt,It){const Tt=We+xt>>1,sn=at+ct>>1;if(Math.abs(We-vt)+Math.abs(at-It)>1&&Gp[sn*xf+Tt])Se(vt,It,We,at,Tt,sn),Se(xt,ct,vt,It,Tt,sn);else{const nn=ye(We,at),Sn=ye(xt,ct),qn=ye(vt,It);re.emplaceBack(nn,Sn,qn)}}return Se(0,0,Ld,Ld,Ld,0),Se(Ld,Ld,0,0,0,Ld),{vertices:X,indices:re}})(this.tileID.canonical,l);p=b.vertices,x=b.indices}else{p=new cn,x=new _r;for(const{x:A,y:P}of h)p.emplaceBack(A,P,0,0);const b=Lg(p.int16,void 0,4);for(let A=0;A<b.length;A+=3)x.emplaceBack(b[A],b[A+1],b[A+2])}this._tileBoundsBuffer=r.createVertexBuffer(p,z4.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(x),this._tileBoundsSegments=qa.simpleSegment(0,0,p.length,x.length)}_makeGlobeTileDebugBuffers(r,l){const h=l.projection;if(!h||h.name!=="globe"||l.freezeTileCoverage)return;const p=this.tileID.canonical,x=Vr(Sd(p,l)),b=hu(l.zoom);let A;b>0&&(A=wu(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(r,p,l,x,A,b),this._makeGlobeTileDebugTextBuffer(r,p,l,x,A,b)}_globePoint(r,l,h,p,x,b,A){let P=uu(r,l,h);if(b){const M=1<<h.z,G=Cs(p.center.lng),X=Ys(p.center.lat),re=(h.x+.5)/M-G;let de=0;re>.5?de=-1:re<-.5&&(de=1);let ye=(r/Wr+h.x)/M+de,Se=(l/Wr+h.y)/M;ye=(ye-G)*p._pixelsPerMercatorPixel+G,Se=(Se-X)*p._pixelsPerMercatorPixel+X;const We=[ye*p.worldSize,Se*p.worldSize,0];Kt(We,We,b),P=Hc(P,We,A)}return Kt(P,P,x)}_makeGlobeTileDebugBorderBuffer(r,l,h,p,x,b){const A=new _n,P=new uc,M=new Ut,G=(re,de,ye,Se,We)=>{const at=(ye-re)/(We-1),xt=(Se-de)/(We-1),ct=A.length;for(let vt=0;vt<We;vt++){const It=re+vt*at,Tt=de+vt*xt;A.emplaceBack(It,Tt);const sn=this._globePoint(It,Tt,l,h,p,x,b);M.emplaceBack(sn[0],sn[1],sn[2]),P.emplaceBack(ct+vt)}},X=Wr;G(0,0,X,0,16),G(X,0,X,X,16),G(X,X,0,X,16),G(0,X,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(P),this._tileDebugBuffer=r.createVertexBuffer(A,Kr.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(M,kr.members),this._tileDebugSegments=qa.simpleSegment(0,0,A.length,P.length)}_makeGlobeTileDebugTextBuffer(r,l,h,p,x,b){const A=Wr/4,P=new _n,M=new _r,G=new Ut,X=25;M.reserve(32),P.reserve(X),G.reserve(X);const re=(de,ye)=>X*de+ye;for(let de=0;de<X;de++){const ye=de*A;for(let Se=0;Se<X;Se++){const We=Se*A;P.emplaceBack(We,ye);const at=this._globePoint(We,ye,l,h,p,x,b);G.emplaceBack(at[0],at[1],at[2])}}for(let de=0;de<4;de++)for(let ye=0;ye<4;ye++){const Se=re(de,ye),We=re(de,ye+1),at=re(de+1,ye),xt=re(de+1,ye+1);M.emplaceBack(Se,We,at),M.emplaceBack(at,We,xt)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(M),this._tileDebugTextBuffer=r.createVertexBuffer(P,Kr.members),this._globeTileDebugTextBuffer=r.createVertexBuffer(G,kr.members),this._tileDebugTextSegments=qa.simpleSegment(0,0,X,32)}}class EL{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,l,h){const p=String(l);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][p]=this.stateChanges[r][p]||{},Oe(this.stateChanges[r][p],h),this.deletedStates[r]===null){this.deletedStates[r]={};for(const x in this.state[r])x!==p&&(this.deletedStates[r][x]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][p]===null){this.deletedStates[r][p]={};for(const x in this.state[r][p])h[x]||(this.deletedStates[r][p][x]=null)}else for(const x in h)this.deletedStates[r]&&this.deletedStates[r][p]&&this.deletedStates[r][p][x]===null&&delete this.deletedStates[r][p][x]}removeFeatureState(r,l,h){if(this.deletedStates[r]===null)return;const p=String(l);if(this.deletedStates[r]=this.deletedStates[r]||{},h&&l!==void 0)this.deletedStates[r][p]!==null&&(this.deletedStates[r][p]=this.deletedStates[r][p]||{},this.deletedStates[r][p][h]=null);else if(l!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][p])for(h in this.deletedStates[r][p]={},this.stateChanges[r][p])this.deletedStates[r][p][h]=null;else this.deletedStates[r][p]=null;else this.deletedStates[r]=null}getState(r,l){const h=String(l),p=Oe({},(this.state[r]||{})[h],(this.stateChanges[r]||{})[h]);if(this.deletedStates[r]===null)return{};if(this.deletedStates[r]){const x=this.deletedStates[r][l];if(x===null)return{};for(const b in x)delete p[b]}return p}initializeTileState(r,l){r.setFeatureState(this.state,l)}coalesceChanges(r,l){const h={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const x={};for(const b in this.stateChanges[p])this.state[p][b]||(this.state[p][b]={}),Oe(this.state[p][b],this.stateChanges[p][b]),x[b]=this.state[p][b];h[p]=x}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const x={};if(this.deletedStates[p]===null)for(const b in this.state[p])x[b]={},this.state[p][b]={};else for(const b in this.deletedStates[p]){if(this.deletedStates[p][b]===null)this.state[p][b]={};else if(this.state[p][b])for(const A of Object.keys(this.deletedStates[p][b]))delete this.state[p][b][A];x[b]=this.state[p][b]}h[p]=h[p]||{},Oe(h[p],x)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(const p in r)r[p].setFeatureState(h,l)}}class U4{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,l){const h=this.toIdx(r,l);return{min:this.minimums[h],max:this.maximums[h]}}isLeaf(r,l){return this.leaves[this.toIdx(r,l)]}toIdx(r,l){return l*this.size+r}}function V4(s,r,l,h){let p=0,x=Number.MAX_VALUE;for(let b=0;b<3;b++)if(Math.abs(h[b])<1e-15){if(l[b]<s[b]||l[b]>r[b])return null}else{const A=1/h[b];let P=(s[b]-l[b])*A,M=(r[b]-l[b])*A;if(P>M){const G=P;P=M,M=G}if(P>p&&(p=P),M<x&&(x=M),p>x)return null}return p}function q4(s,r,l,h,p,x,b,A,P,M,G){const X=h-s,re=p-r,de=x-l,ye=b-s,Se=A-r,We=P-l,at=G[1]*We-G[2]*Se,xt=G[2]*ye-G[0]*We,ct=G[0]*Se-G[1]*ye,vt=X*at+re*xt+de*ct;if(Math.abs(vt)<1e-15)return null;const It=1/vt,Tt=M[0]-s,sn=M[1]-r,nn=M[2]-l,Sn=(Tt*at+sn*xt+nn*ct)*It;if(Sn<0||Sn>1)return null;const qn=sn*de-nn*re,dn=nn*X-Tt*de,Pn=Tt*re-sn*X,kn=(G[0]*qn+G[1]*dn+G[2]*Pn)*It;return kn<0||Sn+kn>1?null:(ye*qn+Se*dn+We*Pn)*It}function $4(s,r,l){return(s-r)/(l-r)}function G4(s,r,l,h,p,x,b,A,P){const M=1<<l,G=x-h,X=b-p,re=(s+1)/M*G+h,de=(r+0)/M*X+p,ye=(r+1)/M*X+p;A[0]=(s+0)/M*G+h,A[1]=de,P[0]=re,P[1]=ye}class H4{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=(function(x){const b=Math.ceil(Math.log2(x.dim/8)),A=[];let P=Math.ceil(Math.pow(2,b));const M=1/P,G=(de,ye,Se,We,at)=>{const xt=We?1:0,ct=(de+1)*Se-xt,vt=ye*Se,It=(ye+1)*Se-xt;at[0]=de*Se,at[1]=vt,at[2]=ct,at[3]=It};let X=new U4(P);const re=[];for(let de=0;de<P*P;de++){G(de%P,Math.floor(de/P),M,!1,re);const ye=Hp(re[0],re[1],x),Se=Hp(re[2],re[1],x),We=Hp(re[2],re[3],x),at=Hp(re[0],re[3],x);X.minimums.push(Math.min(ye,Se,We,at)),X.maximums.push(Math.max(ye,Se,We,at)),X.leaves.push(1)}for(A.push(X),P/=2;P>=1;P/=2){const de=A[A.length-1];X=new U4(P);for(let ye=0;ye<P*P;ye++){G(ye%P,Math.floor(ye/P),2,!0,re);const Se=de.getElevation(re[0],re[1]),We=de.getElevation(re[2],re[1]),at=de.getElevation(re[2],re[3]),xt=de.getElevation(re[0],re[3]),ct=de.isLeaf(re[0],re[1]),vt=de.isLeaf(re[2],re[1]),It=de.isLeaf(re[2],re[3]),Tt=de.isLeaf(re[0],re[3]),sn=Math.min(Se.min,We.min,at.min,xt.min),nn=Math.max(Se.max,We.max,at.max,xt.max),Sn=ct&&vt&&It&&Tt;X.maximums.push(nn),X.minimums.push(sn),X.leaves.push(nn-sn<=5&&Sn?1:0)}A.push(X)}return A})(this.dem),h=l.length-1,p=l[h];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(l,0,0,h,0)}raycastRoot(r,l,h,p,x,b,A=1){return V4([r,l,-100],[h,p,this.maximums[0]*A],x,b)}raycast(r,l,h,p,x,b,A=1){if(!this.nodeCount)return null;const P=this.raycastRoot(r,l,h,p,x,b,A);if(P==null)return null;const M=[],G=[],X=[],re=[],de=[{idx:0,t:P,nodex:0,nodey:0,depth:0}];for(;de.length>0;){const{idx:ye,t:Se,nodex:We,nodey:at,depth:xt}=de.pop();if(this.leaves[ye]){G4(We,at,xt,r,l,h,p,X,re);const vt=1<<xt,It=(We+0)/vt,Tt=(We+1)/vt,sn=(at+0)/vt,nn=(at+1)/vt,Sn=Hp(It,sn,this.dem)*A,qn=Hp(Tt,sn,this.dem)*A,dn=Hp(Tt,nn,this.dem)*A,Pn=Hp(It,nn,this.dem)*A,kn=q4(X[0],X[1],Sn,re[0],X[1],qn,re[0],re[1],dn,x,b),zn=q4(re[0],re[1],dn,X[0],re[1],Pn,X[0],X[1],Sn,x,b),Xn=Math.min(kn!==null?kn:Number.MAX_VALUE,zn!==null?zn:Number.MAX_VALUE);if(Xn!==Number.MAX_VALUE)return Xn;{const wn=St([],x,b,Se);if(W4(Sn,qn,Pn,dn,$4(wn[0],X[0],re[0]),$4(wn[1],X[1],re[1]))>=wn[2])return Se}continue}let ct=0;for(let vt=0;vt<this._siblingOffset.length;vt++){G4((We<<1)+this._siblingOffset[vt][0],(at<<1)+this._siblingOffset[vt][1],xt+1,r,l,h,p,X,re),X[2]=-100,re[2]=this.maximums[this.childOffsets[ye]+vt]*A;const It=V4(X,re,x,b);if(It!=null){const Tt=It;M[vt]=Tt;let sn=!1;for(let nn=0;nn<ct&&!sn;nn++)Tt>=M[G[nn]]&&(G.splice(nn,0,vt),sn=!0);sn||(G[ct]=vt),ct++}}for(let vt=0;vt<ct;vt++){const It=G[vt];de.push({idx:this.childOffsets[ye]+It,t:M[It],nodex:(We<<1)+this._siblingOffset[It][0],nodey:(at<<1)+this._siblingOffset[It][1],depth:xt+1})}}return null}_addNode(r,l,h){return this.minimums.push(r),this.maximums.push(l),this.leaves.push(h),this.childOffsets.push(0),this.nodeCount++}_construct(r,l,h,p,x){if(r[p].isLeaf(l,h)===1)return;this.childOffsets[x]||(this.childOffsets[x]=this.nodeCount);const b=p-1,A=r[b];let P=0,M=0;for(let G=0;G<this._siblingOffset.length;G++){const X=2*l+this._siblingOffset[G][0],re=2*h+this._siblingOffset[G][1],de=A.getElevation(X,re),ye=A.isLeaf(X,re),Se=this._addNode(de.min,de.max,ye);ye&&(P|=1<<G),M||(M=Se)}for(let G=0;G<this._siblingOffset.length;G++)P&1<<G||this._construct(r,2*l+this._siblingOffset[G][0],2*h+this._siblingOffset[G][1],b,M+G)}}function W4(s,r,l,h,p,x){return He(He(s,l,x),He(r,h,x),p)}function Hp(s,r,l){const h=l.dim,p=De(s*h-.5,0,h-1),x=De(r*h-.5,0,h-1),b=Math.floor(p),A=Math.floor(x),P=Math.min(b+1,h-1),M=Math.min(A+1,h-1);return W4(l.get(b,A),l.get(P,A),l.get(b,M),l.get(P,M),p-b,x-A)}const K4={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function AL(s,r,l){return(256*s*256+256*r+l)/10-1e4}function TL(s,r,l){return 256*s+r+l/256-32768}class s1{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,l,h,p=!1,x=!1){if(this.uid=r,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(h&&h!=="mapbox"&&h!=="terrarium")return fr(`"${h}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const b=this.dim=l.height-2,A=new Uint32Array(l.data.buffer);if(this.pixels=new Uint8Array(l.data.buffer),this.encoding=h||"mapbox",this.borderReady=p,!p){for(let P=0;P<b;P++)A[this._idx(-1,P)]=A[this._idx(0,P)],A[this._idx(b,P)]=A[this._idx(b-1,P)],A[this._idx(P,-1)]=A[this._idx(P,0)],A[this._idx(P,b)]=A[this._idx(P,b-1)];A[this._idx(-1,-1)]=A[this._idx(0,0)],A[this._idx(b,-1)]=A[this._idx(b-1,0)],A[this._idx(-1,b)]=A[this._idx(0,b-1)],A[this._idx(b,b)]=A[this._idx(b-1,b-1)],x&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new H4(this)}get(r,l,h=!1){h&&(r=De(r,-1,this.dim),l=De(l,-1,this.dim));const p=4*this._idx(r,l);return(this.encoding==="terrarium"?TL:AL)(this.pixels[p],this.pixels[p+1],this.pixels[p+2])}static getUnpackVector(r){return K4[r]}get unpackVector(){return K4[this.encoding]}_idx(r,l){if(r<-1||r>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(r+1)}static pack(r,l){const h=[0,0,0,0],p=s1.getUnpackVector(l);let x=Math.floor((r+p[3])/p[2]);return h[2]=x%256,x=Math.floor(x/256),h[1]=x%256,x=Math.floor(x/256),h[0]=x,h}getPixels(){return new qu({width:this.stride,height:this.stride},this.pixels)}backfillBorder(r,l,h){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let p=l*this.dim,x=l*this.dim+this.dim,b=h*this.dim,A=h*this.dim+this.dim;switch(l){case-1:p=x-1;break;case 1:x=p+1}switch(h){case-1:b=A-1;break;case 1:A=b+1}const P=-l*this.dim,M=-h*this.dim;for(let G=b;G<A;G++)for(let X=p;X<x;X++){const re=4*this._idx(X,G),de=4*this._idx(X+P,G+M);this.pixels[re+0]=r.pixels[de+0],this.pixels[re+1]=r.pixels[de+1],this.pixels[re+2]=r.pixels[de+2],this.pixels[re+3]=r.pixels[de+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}lr(s1,"DEMData"),lr(H4,"DemMinMaxQuadTree",{omit:["dem"]});class IL{constructor(r,l){this.max=r,this.onRemove=l,this.reset()}reset(){for(const r in this.data)for(const l of this.data[r])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(r,l,h){const p=r.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const x={value:l,timeout:void 0};if(h!==void 0&&(x.timeout=setTimeout((()=>{this.remove(r,x)}),h)),this.data[p].push(x),this.order.push(p),this.order.length>this.max){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const l=this.data[r].shift();return l.timeout&&clearTimeout(l.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),l.value}getByKey(r){const l=this.data[r];return l?l[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,l){if(!this.has(r))return this;const h=r.wrapped().key,p=l===void 0?0:this.data[h].indexOf(l),x=this.data[h][p];return this.data[h].splice(p,1),x.timeout&&clearTimeout(x.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(x.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(r){const l=[];for(const h in this.data)for(const p of this.data[h])r(p.value)||l.push(p);for(const h of l)this.remove(h.value.tileID,h)}}class Ug{constructor(r,l,h){this.func=r,this.mask=l,this.range=h}}Ug.ReadOnly=!1,Ug.ReadWrite=!0,Ug.disabled=new Ug(519,Ug.ReadOnly,[0,1]);const Vx=7680;class qx{constructor(r,l,h,p,x,b){this.test=r,this.ref=l,this.mask=h,this.fail=p,this.depthFail=x,this.pass=b}}qx.disabled=new qx({func:519,mask:0},0,0,Vx,Vx,Vx);class wf{constructor(r,l,h){this.blendFunction=r,this.blendColor=l,this.mask=h}}wf.Replace=[1,0],wf.disabled=new wf(wf.Replace,Eo.transparent,[!1,!1,!1,!1]),wf.unblended=new wf(wf.Replace,Eo.transparent,[!0,!0,!0,!0]),wf.alphaBlended=new wf([1,771],Eo.transparent,[!0,!0,!0,!0]);const $x=1029,Gx=2305;class $d{constructor(r,l,h){this.enable=r,this.mode=l,this.frontFace=h}}$d.disabled=new $d(!1,$x,Gx),$d.backCCW=new $d(!0,$x,Gx),$d.backCW=new $d(!0,$x,2304),$d.frontCW=new $d(!0,1028,2304),$d.frontCCW=new $d(!0,1028,Gx);class Dm extends ra{constructor(r,l,h){super(),this.id=r,this._onlySymbols=h,l.on("data",(p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))})),l.on("error",(()=>{this._sourceErrored=!0})),this._source=l,this._tiles={},this._cache=new IL(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new EL,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(r){this.map=r,this._minTileCacheSize=this._minTileCacheSize===void 0&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles){const l=this._tiles[r];if(l.state!=="loaded"&&l.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,l){return r.isSymbolTile=this._onlySymbols,this._source.loadTile(r,l)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,(()=>{}))}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r,(()=>{}))}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const h=this._tiles[l];h.upload(r),h.prepare(this.map.style.imageManager)}}getIds(){return Ne(this._tiles).map((r=>r.tileID)).sort(X4).map((r=>r.key))}getRenderableIds(r){const l=[];for(const h in this._tiles)this._isIdRenderable(+h,r)&&l.push(this._tiles[h]);return r?l.sort(((h,p)=>{const x=h.tileID,b=p.tileID,A=new q(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),P=new q(b.canonical.x,b.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-b.overscaledZ||P.y-A.y||P.x-A.x})).map((h=>h.tileID.key)):l.map((h=>h.tileID)).sort(X4).map((h=>h.key))}hasRenderableParent(r){const l=this.findLoadedParent(r,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(r,l){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(l||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(+r,"reloading")}}_reloadTile(r,l){const h=this._tiles[r];h&&(h.state!=="loading"&&(h.state=l),this._loadTile(h,this._tileLoaded.bind(this,h,r,l)))}_tileLoaded(r,l,h,p){if(p)if(r.state="errored",p.status!==404)this._source.fire(new Aa(p,{tile:r}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const x=this.map.painter.terrain;this.update(this.transform,x.getScaledDemTileSize(),!0),x.resetTileLookupCache(this.id)}else this.update(this.transform);else r.timeAdded=Zo.now(),h==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(l,r),this._source.type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new ec("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const l=this.getRenderableIds();for(let p=0;p<l.length;p++){const x=l[p];if(r.neighboringTiles&&r.neighboringTiles[x]){const b=this.getTileByID(x);h(r,b),h(b,r)}}function h(p,x){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let b=x.tileID.canonical.x-p.tileID.canonical.x;const A=x.tileID.canonical.y-p.tileID.canonical.y,P=Math.pow(2,p.tileID.canonical.z),M=x.tileID.key;b===0&&A===0||Math.abs(A)>1||(Math.abs(b)>1&&(Math.abs(b+P)===1?b+=P:Math.abs(b-P)===1&&(b-=P)),x.dem&&p.dem&&(p.dem.backfillBorder(x.dem,b,A),p.neighboringTiles&&p.neighboringTiles[M]&&(p.neighboringTiles[M].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,l,h,p){for(const x in this._tiles){let b=this._tiles[x];if(p[x]||!b.hasData()||b.tileID.overscaledZ<=l||b.tileID.overscaledZ>h)continue;let A=b.tileID;for(;b&&b.tileID.overscaledZ>l+1;){const M=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[M.key],b&&b.hasData()&&(A=M)}let P=A;for(;P.overscaledZ>l;)if(P=P.scaledTo(P.overscaledZ-1),r[P.key]){p[A.key]=A;break}}}findLoadedParent(r,l){if(r.key in this._loadedParentTiles){const h=this._loadedParentTiles[r.key];return h&&h.tileID.overscaledZ>=l?h:null}for(let h=r.overscaledZ-1;h>=l;h--){const p=r.scaledTo(h),x=this._getLoadedTile(p);if(x)return x}}_getLoadedTile(r){const l=this._tiles[r.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,l){l=l||this._source.tileSize;const h=Math.ceil(r.width/l)+1,p=Math.ceil(r.height/l)+1,x=Math.floor(h*p*5),b=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,x):x,A=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(A)}handleWrapJump(r){const l=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,l){const h={};for(const p in this._tiles){const x=this._tiles[p];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+l),h[x.tileID.key]=x}this._tiles=h;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(r,l,h){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!h)return;let p;this.updateCacheSize(r,l),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=r.getVisibleUnwrappedCoordinates(this._source.tileID).map((A=>new sh(A.canonical.z,A.wrap,A.canonical.z,A.canonical.x,A.canonical.y))):(p=r.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(p=p.filter((A=>this._source.hasTile(A))))):p=[];const x=this._updateRetainedTiles(p);if(Z4(this._source.type)&&p.length!==0){const A={},P={},M=Object.keys(x);for(const X of M){const re=x[X],de=this._tiles[X];if(!de||de.fadeEndTime&&de.fadeEndTime<=Zo.now())continue;const ye=this.findLoadedParent(re,Math.max(re.overscaledZ-Dm.maxOverzooming,this._source.minzoom));ye&&(this._addTile(ye.tileID),A[ye.tileID.key]=ye.tileID),P[X]=re}const G=p[p.length-1].overscaledZ;for(const X in this._tiles){const re=this._tiles[X];if(x[X]||!re.hasData())continue;let de=re.tileID;for(;de.overscaledZ>G;){de=de.scaledTo(de.overscaledZ-1);const ye=this._tiles[de.key];if(ye&&ye.hasData()&&P[de.key]){x[X]=re.tileID;break}}}for(const X in A)x[X]||(this._coveredTiles[X]=!0,x[X]=A[X])}for(const A in x)this._tiles[A].clearFadeHold();const b=(function(A,P){const M=[];for(const G in A)G in P||M.push(G);return M})(this._tiles,x);for(const A of b){const P=this._tiles[A];P.hasSymbolBuckets&&!P.holdingForFade()?P.setHoldDuration(this.map._fadeDuration):P.hasSymbolBuckets&&!P.symbolFadeFinished()||this._removeTile(+A)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const l={};if(r.length===0)return l;const h={},p=r.reduce(((M,G)=>Math.min(M,G.overscaledZ)),1/0),x=r[0].overscaledZ,b=Math.max(x-Dm.maxOverzooming,this._source.minzoom),A=Math.max(x+Dm.maxUnderzooming,this._source.minzoom),P={};for(const M of r){const G=this._addTile(M);l[M.key]=M,G.hasData()||p<this._source.maxzoom&&(P[M.key]=M)}this._retainLoadedChildren(P,p,A,l);for(const M of r){let G=this._tiles[M.key];if(G.hasData())continue;if(M.canonical.z>=this._source.maxzoom){const re=M.children(this._source.maxzoom)[0],de=this.getTile(re);if(de&&de.hasData()){l[re.key]=re;continue}}else{const re=M.children(this._source.maxzoom);if(l[re[0].key]&&l[re[1].key]&&l[re[2].key]&&l[re[3].key])continue}let X=G.wasRequested();for(let re=M.overscaledZ-1;re>=b;--re){const de=M.scaledTo(re);if(h[de.key]||(h[de.key]=!0,G=this.getTile(de),!G&&X&&(G=this._addTile(de)),G&&(l[de.key]=de,X=G.wasRequested(),G.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const l=[];let h,p=this._tiles[r].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){h=this._loadedParentTiles[p.key];break}l.push(p.key);const x=p.scaledTo(p.overscaledZ-1);if(h=this._getLoadedTile(x),h)break;p=x}for(const x of l)this._loadedParentTiles[x]=h}}_addTile(r){let l=this._tiles[r.key];if(l)return l;l=this._cache.getAndRemove(r),l&&(this._setTileReloadTimer(r.key,l),l.tileID=r,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,l)));const h=!!l;if(!h){const p=this.map?this.map.painter:null;l=new Ux(r,this._source.tileSize*r.overscaleFactor(),this.transform.tileZoom,p,this._isRaster),this._loadTile(l,this._tileLoaded.bind(this,l,r.key,l.state))}return l?(l.uses++,this._tiles[r.key]=l,h||this._source.fire(new ec("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(r,l){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const h=l.getExpiryTimeout();h&&(this._timers[r]=setTimeout((()=>{this._reloadTile(r,"expired"),delete this._timers[r]}),h))}_removeTile(r){const l=this._tiles[r];l&&(l.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),l.uses>0||(l.hasData()&&l.state!=="reloading"?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,l,h){const p=[],x=this.transform;if(!x)return p;const b=x.projection.name==="globe",A=Cs(x.center.lng);for(const P in this._tiles){const M=this._tiles[P];if(h&&M.clearQueryDebugViz(),M.holdingForFade())continue;let G;if(b){const X=M.tileID.canonical;if(X.z===0){const re=[Math.abs(De(A,...my(X,-1))-A),Math.abs(De(A,...my(X,1))-A)];G=[0,2*re.indexOf(Math.min(...re))-1]}else{const re=[Math.abs(De(A,...my(X,-1))-A),Math.abs(De(A,...my(X,0))-A),Math.abs(De(A,...my(X,1))-A)];G=[re.indexOf(Math.min(...re))-1]}}else G=[0];for(const X of G){const re=r.containsTile(M,x,l,X);re&&p.push(re)}}return p}getVisibleCoordinates(r){const l=this.getRenderableIds(r).map((h=>this._tiles[h].tileID));for(const h of l)h.projMatrix=this.transform.calculateProjMatrix(h.toUnwrapped());return l}hasTransition(){if(this._source.hasTransition())return!0;if(Z4(this._source.type))for(const r in this._tiles){const l=this._tiles[r];if(l.fadeEndTime!==void 0&&l.fadeEndTime>=Zo.now())return!0}return!1}setFeatureState(r,l,h){this._state.updateState(r=r||"_geojsonTileLayer",l,h)}removeFeatureState(r,l,h){this._state.removeFeatureState(r=r||"_geojsonTileLayer",l,h)}getFeatureState(r,l){return this._state.getState(r=r||"_geojsonTileLayer",l)}setDependencies(r,l,h){const p=this._tiles[r];p&&p.setDependencies(l,h)}reloadTilesForDependencies(r,l){for(const h in this._tiles)this._tiles[h].hasDependency(r,l)&&this._reloadTile(+h,"reloading");this._cache.filter((h=>!h.hasDependency(r,l)))}_preloadTiles(r,l){if(!this._sourceLoaded){const A=()=>{this._sourceLoaded&&(this._source.off("data",A),this._preloadTiles(r,l))};return void this._source.on("data",A)}const h=new Map,p=Array.isArray(r)?r:[r],x=this.map.painter.terrain,b=this.usedForTerrain&&x?x.getScaledDemTileSize():this._source.tileSize;for(const A of p){const P=A.coveringTiles({tileSize:b,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const M of P)h.set(M.key,M);this.usedForTerrain&&A.updateElevation(!1)}le(Array.from(h.values()),((A,P)=>{const M=new Ux(A,this._source.tileSize*A.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(M,(G=>{this._source.type==="raster-dem"&&M.dem&&this._backfillDEM(M),P(G,M)}))}),l)}}function X4(s,r){const l=Math.abs(2*s.wrap)-+(s.wrap<0),h=Math.abs(2*r.wrap)-+(r.wrap<0);return s.overscaledZ-r.overscaledZ||h-l||r.canonical.y-s.canonical.y||r.canonical.x-s.canonical.x}function Z4(s){return s==="raster"||s==="image"||s==="video"||s==="custom"}function my(s,r){const l=1<<s.z;return[s.x/l+r,(s.x+1)/l+r]}Dm.maxOverzooming=10,Dm.maxUnderzooming=3;class a1{constructor(r,l,h){this._demTile=r,this._dem=this._demTile.dem,this._scale=l,this._offset=h}static create(r,l,h){const p=h||r.findDEMTileFor(l);if(!p||!p.dem)return;const x=p.dem,b=p.tileID,A=1<<l.canonical.z-b.canonical.z;return new a1(p,p.tileSize/Wr/A,[(l.canonical.x/A-b.canonical.x)*x.dim,(l.canonical.y/A-b.canonical.y)*x.dim])}tileCoordToPixel(r,l){const h=l*this._scale+this._offset[1],p=Math.floor(r*this._scale+this._offset[0]),x=Math.floor(h);return new q(p,x)}getElevationAt(r,l,h,p){const x=r*this._scale+this._offset[0],b=l*this._scale+this._offset[1],A=Math.floor(x),P=Math.floor(b),M=this._dem;return p=!!p,h?He(He(M.get(A,P,p),M.get(A,P+1,p),b-P),He(M.get(A+1,P,p),M.get(A+1,P+1,p),b-P),x-A):M.get(A,P,p)}getElevationAtPixel(r,l,h){return this._dem.get(r,l,!!h)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*Ga(1,r)*this._dem.stride}}class Y4{constructor(r,l){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new cc(Wr,16,0),this.featureIndexArray=new zo,this.promoteId=l}insert(r,l,h,p,x,b=0){const A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,p,x,b);const P=this.grid;for(let M=0;M<l.length;M++){const G=l[M],X=[1/0,1/0,-1/0,-1/0];for(let re=0;re<G.length;re++){const de=G[re];X[0]=Math.min(X[0],de.x),X[1]=Math.min(X[1],de.y),X[2]=Math.max(X[2],de.x),X[3]=Math.max(X[3],de.y)}X[0]<Wr&&X[1]<Wr&&X[2]>=0&&X[3]>=0&&P.insert(A,X[0],X[1],X[2],X[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new pi(new W_(this.rawTileData)).layers,this.sourceLayerCoder=new F4(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,l,h,p){this.loadVTLayers();const x=r.params||{},b=th(x.filter),A=r.tileResult,P=r.transform,M=A.bufferedTilespaceBounds,G=this.grid.query(M.min.x,M.min.y,M.max.x,M.max.y,((ye,Se,We,at)=>O_(A.bufferedTilespaceGeometry,ye,Se,We,at)));G.sort(CL);let X=null;P.elevation&&G.length>0&&(X=a1.create(P.elevation,this.tileID));const re={};let de;for(let ye=0;ye<G.length;ye++){const Se=G[ye];if(Se===de)continue;de=Se;const We=this.featureIndexArray.get(Se);let at=null;this.loadMatchingFeature(re,We,b,x.layers,x.availableImages,l,h,p,((xt,ct,vt,It=0)=>(at||(at=Su(xt,this.tileID.canonical,r.tileTransform)),ct.queryIntersectsFeature(A,xt,vt,at,this.z,r.transform,r.pixelPosMatrix,X,It))))}return re}loadMatchingFeature(r,l,h,p,x,b,A,P,M){const{featureIndex:G,bucketIndex:X,sourceLayerIndex:re,layoutVertexArrayOffset:de}=l,ye=this.bucketLayerIDs[X];if(p&&!(function(xt,ct){for(let vt=0;vt<xt.length;vt++)if(ct.indexOf(xt[vt])>=0)return!0;return!1})(p,ye))return;const Se=this.sourceLayerCoder.decode(re),We=this.vtLayers[Se].feature(G);if(h.needGeometry){const xt=Id(We,!0);if(!h.filter(new $(this.tileID.overscaledZ),xt,this.tileID.canonical))return}else if(!h.filter(new $(this.tileID.overscaledZ),We))return;const at=this.getId(We,Se);for(let xt=0;xt<ye.length;xt++){const ct=ye[xt];if(p&&p.indexOf(ct)<0)continue;const vt=b[ct];if(!vt)continue;let It={};at!==void 0&&P&&(It=P.getState(vt.sourceLayer||"_geojsonTileLayer",at));const Tt=Oe({},A[ct]);Tt.paint=J4(Tt.paint,vt.paint,We,It,x),Tt.layout=J4(Tt.layout,vt.layout,We,It,x);const sn=!M||M(We,vt,It,de);if(!sn)continue;const nn=new O4(We,this.z,this.x,this.y,at);nn.layer=Tt;let Sn=r[ct];Sn===void 0&&(Sn=r[ct]=[]),Sn.push({featureIndex:G,feature:nn,intersectionZ:sn})}}lookupSymbolFeatures(r,l,h,p,x,b,A,P){const M={};this.loadVTLayers();const G=th(x);for(const X of r)this.loadMatchingFeature(M,{bucketIndex:h,sourceLayerIndex:p,featureIndex:X,layoutVertexArrayOffset:0},G,b,A,P,l);return M}loadFeature(r){const{featureIndex:l,sourceLayerIndex:h}=r;this.loadVTLayers();const p=this.sourceLayerCoder.decode(h),x=this.vtFeatures[p];if(x[l])return x[l];const b=this.vtLayers[p].feature(l);return x[l]=b,b}hasLayer(r){for(const l of this.bucketLayerIDs)for(const h of l)if(r===h)return!0;return!1}getId(r,l){let h=r.id;if(this.promoteId){const p=typeof this.promoteId=="string"?this.promoteId:this.promoteId[l];p!=null&&(h=r.properties[p]),typeof h=="boolean"&&(h=Number(h))}return h}}function J4(s,r,l,h,p){return yn(s,((x,b)=>{const A=r instanceof Xe?r.get(b):null;return A&&A.evaluate?A.evaluate(l,h,p):A}))}function CL(s,r){return r-s}lr(Y4,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Q4{constructor(r,l){this.width=r,this.height=l,this.nextRow=0,this.image=new oh({width:r,height:l}),this.positions={},this.uploaded=!1}getDash(r,l){const h=this.getKey(r,l);return this.positions[h]}trim(){const r=this.width,l=this.height=dt(this.nextRow);this.image.resize({width:r,height:l})}getKey(r,l){return r.join(",")+l}getDashRanges(r,l,h){const p=[];let x=r.length%2==1?-r[r.length-1]*h:0,b=r[0]*h,A=!0;p.push({left:x,right:b,isDash:A,zeroLength:r[0]===0});let P=r[0];for(let M=1;M<r.length;M++){A=!A;const G=r[M];x=P*h,P+=G,b=P*h,p.push({left:x,right:b,isDash:A,zeroLength:G===0})}return p}addRoundDash(r,l,h){const p=l/2;for(let x=-h;x<=h;x++){const b=this.width*(this.nextRow+h+x);let A=0,P=r[A];for(let M=0;M<this.width;M++){M/P.right>1&&(P=r[++A]);const G=Math.abs(M-P.left),X=Math.abs(M-P.right),re=Math.min(G,X);let de;const ye=x/h*(p+1);if(P.isDash){const Se=p-Math.abs(ye);de=Math.sqrt(re*re+Se*Se)}else de=p-Math.sqrt(re*re+ye*ye);this.image.data[b+M]=Math.max(0,Math.min(255,de+128))}}}addRegularDash(r,l){for(let P=r.length-1;P>=0;--P){const M=r[P],G=r[P+1];M.zeroLength?r.splice(P,1):G&&G.isDash===M.isDash&&(G.left=M.left,r.splice(P,1))}const h=r[0],p=r[r.length-1];h.isDash===p.isDash&&(h.left=p.left-this.width,p.right=h.right+this.width);const x=this.width*this.nextRow;let b=0,A=r[b];for(let P=0;P<this.width;P++){P/A.right>1&&(A=r[++b]);const M=Math.abs(P-A.left),G=Math.abs(P-A.right),X=Math.min(M,G);this.image.data[x+P]=Math.max(0,Math.min(255,(A.isDash?X:-X)+l+128))}}addDash(r,l){const h=this.getKey(r,l);if(this.positions[h])return this.positions[h];const p=l==="round",x=p?7:0,b=2*x+1;if(this.nextRow+b>this.height)return fr("LineAtlas out of space"),null;r.length===0&&r.push(1);let A=0;for(let G=0;G<r.length;G++)r[G]<0&&(fr("Negative value is found in line dasharray, replacing values with 0"),r[G]=0),A+=r[G];if(A!==0){const G=this.width/A,X=this.getDashRanges(r,this.width,G);p?this.addRoundDash(X,G,x):this.addRegularDash(X,l==="square"?.5*G:0)}const P=this.nextRow+x;this.nextRow+=b;const M={tl:[P,x],br:[A,0]};return this.positions[h]=M,M}}lr(Q4,"LineAtlas");const e2=1*qd;class t2{constructor(r){const l={},h=[];for(const A in r){const P=r[A],M=l[A]={};for(const G in P.glyphs){const X=P.glyphs[+G];if(!X||X.bitmap.width===0||X.bitmap.height===0)continue;const re=X.metrics.localGlyph?e2:1,de={x:0,y:0,w:X.bitmap.width+2*re,h:X.bitmap.height+2*re};h.push(de),M[G]=de}}const{w:p,h:x}=Lx(h),b=new oh({width:p||1,height:x||1});for(const A in r){const P=r[A];for(const M in P.glyphs){const G=P.glyphs[+M];if(!G||G.bitmap.width===0||G.bitmap.height===0)continue;const X=l[A][M],re=G.metrics.localGlyph?e2:1;oh.copy(G.bitmap,b,{x:0,y:0},{x:X.x+re,y:X.y+re},G.bitmap)}}this.image=b,this.positions=l}}lr(t2,"GlyphAtlas");class LL{constructor(r){this.tileID=new sh(r.tileID.overscaledZ,r.tileID.wrap,r.tileID.canonical.z,r.tileID.canonical.x,r.tileID.canonical.y),this.tileZoom=r.tileZoom,this.uid=r.uid,this.zoom=r.zoom,this.canonical=r.tileID.canonical,this.pixelRatio=r.pixelRatio,this.tileSize=r.tileSize,this.source=r.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=r.showCollisionBoxes,this.collectResourceTiming=!!r.collectResourceTiming,this.returnDependencies=!!r.returnDependencies,this.promoteId=r.promoteId,this.enableTerrain=!!r.enableTerrain,this.isSymbolTile=r.isSymbolTile,this.tileTransform=Nm(r.tileID.canonical,r.projection),this.projection=r.projection}parse(r,l,h,p,x){this.status="parsing",this.data=r,this.collisionBoxArray=new Qi;const b=new F4(Object.keys(r.layers).sort()),A=new Y4(this.tileID,this.promoteId);A.bucketLayerIDs=[];const P={},M=new Q4(256,256),G={featureIndex:A,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:M,availableImages:h},X=l.familiesBySource[this.source];for(const It in X){const Tt=r.layers[It];if(!Tt)continue;let sn=!1,nn=!1;for(const dn of X[It])dn[0].type==="symbol"?sn=!0:nn=!0;if(this.isSymbolTile===!0&&!sn||this.isSymbolTile===!1&&!nn)continue;Tt.version===1&&fr(`Vector tile source "${this.source}" layer "${It}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Sn=b.encode(It),qn=[];for(let dn=0;dn<Tt.length;dn++){const Pn=Tt.feature(dn),kn=A.getId(Pn,It);qn.push({feature:Pn,id:kn,index:dn,sourceLayerIndex:Sn})}for(const dn of X[It]){const Pn=dn[0];this.isSymbolTile!==void 0&&Pn.type==="symbol"!==this.isSymbolTile||Pn.minzoom&&this.zoom<Math.floor(Pn.minzoom)||Pn.maxzoom&&this.zoom>=Pn.maxzoom||Pn.visibility!=="none"&&(Hx(dn,this.zoom,h),(P[Pn.id]=Pn.createBucket({index:A.bucketLayerIDs.length,layers:dn,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Sn,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:h})).populate(qn,G,this.tileID.canonical,this.tileTransform),A.bucketLayerIDs.push(dn.map((kn=>kn.id))))}}let re,de,ye,Se;M.trim();const We={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},at=()=>{if(re)return x(re);if(de&&ye&&Se){const It=new t2(de),Tt=new l4(ye,Se);for(const sn in P){const nn=P[sn];nn instanceof qp?(Hx(nn.layers,this.zoom,h),tL(nn,de,It.positions,ye,Tt.iconPositions,this.showCollisionBoxes,h,this.tileID.canonical,this.tileZoom,this.projection)):nn.hasPattern&&(nn instanceof $_||nn instanceof E||nn instanceof ry)&&(Hx(nn.layers,this.zoom,h),nn.addFeatures(G,this.tileID.canonical,Tt.patternPositions,h,this.tileTransform))}this.status="done",x(null,{buckets:Ne(P).filter((sn=>!sn.isEmpty())),featureIndex:A,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:It.image,lineAtlas:M,imageAtlas:Tt,glyphMap:this.returnDependencies?de:null,iconMap:this.returnDependencies?ye:null,glyphPositions:this.returnDependencies?It.positions:null})}},xt=yn(G.glyphDependencies,(It=>Object.keys(It).map(Number)));Object.keys(xt).length?p.send("getGlyphs",{uid:this.uid,stacks:xt},((It,Tt)=>{re||(re=It,de=Tt,at())}),void 0,!1,We):de={};const ct=Object.keys(G.iconDependencies);ct.length?p.send("getImages",{icons:ct,source:this.source,tileID:this.tileID,type:"icons"},((It,Tt)=>{re||(re=It,ye=Tt,at())}),void 0,!1,We):ye={};const vt=Object.keys(G.patternDependencies);vt.length?p.send("getImages",{icons:vt,source:this.source,tileID:this.tileID,type:"patterns"},((It,Tt)=>{re||(re=It,Se=Tt,at())}),void 0,!1,We):Se={},at()}}function Hx(s,r,l){const h=new $(r);for(const p of s)p.recalculate(h,l)}class n2{constructor(r){this.entries={},this.scheduler=r}request(r,l,h,p){const x=this.entries[r]=this.entries[r]||{callbacks:[]};if(x.result){const[b,A]=x.result;return this.scheduler?this.scheduler.add((()=>{p(b,A)}),l):p(b,A),()=>{}}return x.callbacks.push(p),x.cancel||(x.cancel=h(((b,A)=>{x.result=[b,A];for(const P of x.callbacks)this.scheduler?this.scheduler.add((()=>{P(b,A)}),l):P(b,A);setTimeout((()=>delete this.entries[r]),3e3)}))),()=>{x.result||(x.callbacks=x.callbacks.filter((b=>b!==p)),x.callbacks.length||(x.cancel(),delete this.entries[r]))}}}function r2(s,r,l){const h=JSON.stringify(s.request);return s.data&&(this.deduped.entries[h]={result:[null,s.data]}),this.deduped.request(h,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},(p=>{const x=hi(s.request,((b,A,P,M)=>{b?p(b):A&&p(null,{vectorTile:l?void 0:new pi(new W_(A)),rawData:A,cacheControl:P,expires:M})}));return()=>{x.cancel(),p()}}),r)}const i2=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Wx{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,h]=new Uint8Array(r,0,2);if(l!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=h>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const x=i2[15&h];if(!x)throw new Error("Unrecognized array type.");const[b]=new Uint16Array(r,2,1),[A]=new Uint32Array(r,4,1);return new Wx(A,b,x,r)}constructor(r,l=64,h=Float64Array,p){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=h,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const x=i2.indexOf(this.ArrayType),b=2*r*this.ArrayType.BYTES_PER_ELEMENT,A=r*this.IndexArrayType.BYTES_PER_ELEMENT,P=(8-A%8)%8;if(x<0)throw new Error(`Unexpected typed array class: ${h}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+A+P,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+b+A+P),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+A+P,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+x]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=r)}add(r,l){const h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=r,this.coords[this._pos++]=l,h}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return Kx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,l,h,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:x,coords:b,nodeSize:A}=this,P=[0,x.length-1,0],M=[];for(;P.length;){const G=P.pop()||0,X=P.pop()||0,re=P.pop()||0;if(X-re<=A){for(let We=re;We<=X;We++){const at=b[2*We],xt=b[2*We+1];at>=r&&at<=h&&xt>=l&&xt<=p&&M.push(x[We])}continue}const de=re+X>>1,ye=b[2*de],Se=b[2*de+1];ye>=r&&ye<=h&&Se>=l&&Se<=p&&M.push(x[de]),(G===0?r<=ye:l<=Se)&&(P.push(re),P.push(de-1),P.push(1-G)),(G===0?h>=ye:p>=Se)&&(P.push(de+1),P.push(X),P.push(1-G))}return M}within(r,l,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:x,nodeSize:b}=this,A=[0,p.length-1,0],P=[],M=h*h;for(;A.length;){const G=A.pop()||0,X=A.pop()||0,re=A.pop()||0;if(X-re<=b){for(let We=re;We<=X;We++)s2(x[2*We],x[2*We+1],r,l)<=M&&P.push(p[We]);continue}const de=re+X>>1,ye=x[2*de],Se=x[2*de+1];s2(ye,Se,r,l)<=M&&P.push(p[de]),(G===0?r-h<=ye:l-h<=Se)&&(A.push(re),A.push(de-1),A.push(1-G)),(G===0?r+h>=ye:l+h>=Se)&&(A.push(de+1),A.push(X),A.push(1-G))}return P}}function Kx(s,r,l,h,p,x){if(p-h<=l)return;const b=h+p>>1;o2(s,r,b,h,p,x),Kx(s,r,l,h,b-1,1-x),Kx(s,r,l,b+1,p,1-x)}function o2(s,r,l,h,p,x){for(;p>h;){if(p-h>600){const M=p-h+1,G=l-h+1,X=Math.log(M),re=.5*Math.exp(2*X/3),de=.5*Math.sqrt(X*re*(M-re)/M)*(G-M/2<0?-1:1);o2(s,r,l,Math.max(h,Math.floor(l-G*re/M+de)),Math.min(p,Math.floor(l+(M-G)*re/M+de)),x)}const b=r[2*l+x];let A=h,P=p;for(gy(s,r,h,l),r[2*p+x]>b&&gy(s,r,h,p);A<P;){for(gy(s,r,A,P),A++,P--;r[2*A+x]<b;)A++;for(;r[2*P+x]>b;)P--}r[2*h+x]===b?gy(s,r,h,P):(P++,gy(s,r,P,p)),P<=l&&(h=P+1),l<=P&&(p=P-1)}}function gy(s,r,l,h){Xx(s,l,h),Xx(r,2*l,2*h),Xx(r,2*l+1,2*h+1)}function Xx(s,r,l){const h=s[r];s[r]=s[l],s[l]=h}function s2(s,r,l,h){const p=s-l,x=r-h;return p*p+x*x}o.ARRAY_TYPE=il,o.AUTH_ERR_MSG=ht,o.Aabb=hn,o.Actor=class{constructor(s,r,l){this.target=s,this.parent=r,this.mapId=l,this.callbacks={},this.cancelCallbacks={},tn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Cn()?s:w,this.scheduler=new wL}send(s,r,l,h,p=!1,x){const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=x,this.callbacks[b]=l);const A=Hr(this.globalScope)?void 0:[];return this.target.postMessage({id:b,type:s,hasCallback:!!l,targetMapId:h,mustQueue:p,sourceMapId:this.mapId,data:B(r,A)},A),{cancel:()=>{l&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(s){const r=s.data,l=r.id;if(l&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){const h=this.cancelCallbacks[l];delete this.cancelCallbacks[l],h&&h.cancel()}else if(r.mustQueue||Cn()){const h=this.callbacks[l];this.cancelCallbacks[l]=this.scheduler.add((()=>this.processTask(l,r)),h&&h.metadata||{type:"message"})}else this.processTask(l,r)}processTask(s,r){if(r.type==="<response>"){const l=this.callbacks[s];delete this.callbacks[s],l&&(r.error?l(ee(r.error)):l(null,ee(r.data)))}else{const l=Hr(this.globalScope)?void 0:[],h=r.hasCallback?(x,b)=>{delete this.cancelCallbacks[s],this.target.postMessage({id:s,type:"<response>",sourceMapId:this.mapId,error:x?B(x):null,data:B(b,l)},l)}:x=>{},p=ee(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,p,h);else if(this.parent.getWorkerSource){const x=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,x[0],p.source)[x[1]](p,h)}else h(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.CanonicalTileID=q_,o.Color=Eo,o.ColorMode=wf,o.CullFaceMode=$d,o.DEMData=s1,o.DataConstantProperty=_e,o.DedupedRequest=n2,o.DepthMode=Ug,o.EXTENT=Wr,o.Elevation=class{isDataAvailableAtPoint(s){const r=this._source();if(this.isUsingMockSource()||!r||s.y<0||s.y>1)return!1;const l=r.getSource().maxzoom,h=1<<l,p=Math.floor(s.x),x=Math.floor((s.x-p)*h),b=Math.floor(s.y*h),A=this.findDEMTileFor(new sh(l,p,l,x,b));return!(!A||!A.dem)}getAtPointOrZero(s,r=0){return this.getAtPoint(s,r)||0}getAtPoint(s,r,l=!0){if(this.isUsingMockSource())return null;r==null&&(r=null);const h=this._source();if(!h||s.y<0||s.y>1)return r;const p=h.getSource().maxzoom,x=1<<p,b=Math.floor(s.x),A=s.x-b,P=new sh(p,b,p,Math.floor(A*x),Math.floor(s.y*x)),M=this.findDEMTileFor(P);if(!M||!M.dem)return r;const G=M.dem,X=1<<M.tileID.canonical.z,re=(A*X-M.tileID.canonical.x)*G.dim,de=(s.y*X-M.tileID.canonical.y)*G.dim,ye=Math.floor(re),Se=Math.floor(de);return(l?this.exaggeration():1)*He(He(G.get(ye,Se),G.get(ye,Se+1),de-Se),He(G.get(ye+1,Se),G.get(ye+1,Se+1),de-Se),re-ye)}getAtTileOffset(s,r,l){const h=1<<s.canonical.z;return this.getAtPointOrZero(new pf(s.wrap+(s.canonical.x+r/Wr)/h,(s.canonical.y+l/Wr)/h))}getAtTileOffsetFunc(s,r,l,h){return p=>{const x=this.getAtTileOffset(s,p.x,p.y),b=h.upVector(s.canonical,p.x,p.y);return $e(b,b,x*h.upVectorScale(s.canonical,r,l).metersToTile),b}}getForTilePoints(s,r,l,h){if(this.isUsingMockSource())return!1;const p=a1.create(this,s,h);return!!p&&(r.forEach((x=>{x[2]=this.exaggeration()*p.getElevationAt(x[0],x[1],l)})),!0)}getMinMaxForTile(s){if(this.isUsingMockSource())return null;const r=this.findDEMTileFor(s);if(!r||!r.dem)return null;const l=r.dem.tree,h=r.tileID,p=1<<s.canonical.z-h.canonical.z;let x=s.canonical.x/p-h.canonical.x,b=s.canonical.y/p-h.canonical.y,A=0;for(let P=0;P<s.canonical.z-h.canonical.z&&!l.leaves[A];P++){x*=2,b*=2;const M=2*Math.floor(b)+Math.floor(x);A=l.childOffsets[A]+M,x%=1,b%=1}return{min:this.exaggeration()*l.minimums[A],max:this.exaggeration()*l.maximums[A]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,r,l){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},o.ErrorEvent=Aa,o.EvaluationParameters=$,o.Event=ec,o.Evented=ra,o.FillExtrusionBucket=ry,o.Frustum=on,o.FrustumCorners=Vn,o.GLOBE_RADIUS=Qr,o.GLOBE_SCALE_MATCH_LATITUDE=45,o.GLOBE_ZOOM_THRESHOLD_MAX=tr,o.GLOBE_ZOOM_THRESHOLD_MIN=Hn,o.GlobeSharedBuffers=class{constructor(s){this._createGrid(s),this._createPoles(s)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const s of this._poleSegments)s.destroy();for(const s of this._gridSegments)s.withSkirts.destroy(),s.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const s of this._wireframeSegments)s.destroy()}}_fillGridMeshWithLods(s,r){const l=new _n,h=new _r,p=[],x=s+1+2,b=r[0]+1,A=r[0]+1+(1+r.length),P=(M,G,X)=>{let re=M===x-1?M-2:M===0?M:M-1;return re+=X?24575:0,[re,G]};for(let M=0;M<x;++M)l.emplaceBack(...P(M,0,!0));for(let M=0;M<b;++M)for(let G=0;G<x;++G)l.emplaceBack(...P(G,M,(G===0||G===x-1)&&!0));for(let M=0;M<r.length;++M){const G=r[M];for(let X=0;X<x;++X)l.emplaceBack(...P(X,G,!0))}for(let M=0;M<r.length;++M){const G=h.length,X=r[M]+1+2,re=new _r;for(let Se=0;Se<X-1;Se++){const We=Se===X-2,at=We?x*(A-r.length+M-Se):x;for(let xt=0;xt<x-1;xt++){const ct=Se*x+xt;Se===0||We||xt===0||xt===x-2?(re.emplaceBack(ct+1,ct,ct+at),re.emplaceBack(ct+at,ct+at+1,ct+1)):(h.emplaceBack(ct+1,ct,ct+at),h.emplaceBack(ct+at,ct+at+1,ct+1))}}const de=qa.simpleSegment(0,G,l.length,h.length-G);for(let Se=0;Se<re.uint16.length;Se+=3)h.emplaceBack(re.uint16[Se],re.uint16[Se+1],re.uint16[Se+2]);const ye=qa.simpleSegment(0,G,l.length,h.length-G);p.push({withoutSkirts:de,withSkirts:ye})}return{vertices:l,indices:h,segments:p}}_createGrid(s){const r=this._fillGridMeshWithLods(Do,ei);this._gridSegments=r.segments,this._gridBuffer=s.createVertexBuffer(r.vertices,Kr.members),this._gridIndexBuffer=s.createIndexBuffer(r.indices,!0)}_createPoles(s){const r=new _r;for(let p=0;p<=Do;p++)r.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=s.createIndexBuffer(r,!0);const l=new oo,h=new oo;this._poleSegments=[];for(let p=0,x=0;p<Hn;p++){const b=360/(1<<p);l.emplaceBack(0,-Qr,0,.5,0),h.emplaceBack(0,-Qr,0,.5,1);for(let A=0;A<=Do;A++){const P=A/Do,M=He(0,b,P),[G,X,re]=Is($h,Jf,M,Qr);l.emplaceBack(G,X,re,P,0),h.emplaceBack(G,X,re,P,1)}this._poleSegments.push(qa.simpleSegment(x,0,66,64)),x+=66}this._poleNorthVertexBuffer=s.createVertexBuffer(l,Ui,!1),this._poleSouthVertexBuffer=s.createVertexBuffer(h,Ui,!1)}getGridBuffers(s,r){return[this._gridBuffer,this._gridIndexBuffer,r?this._gridSegments[s].withSkirts:this._gridSegments[s].withoutSkirts]}getPoleBuffers(s){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[s]]}getWirefameBuffers(s,r){if(!this._wireframeSegments){const l=new us,h=Do,p=h+1+2,x=1;this._wireframeSegments=[];for(let b=0,A=0;b<ei.length;b++){const P=ei[b];for(let G=x;G<P+x;G++)for(let X=x;X<h+x;X++){const re=G*p+X;l.emplaceBack(re,re+1),l.emplaceBack(re,re+p),l.emplaceBack(re,re+p+1)}const M=P*h*3;this._wireframeSegments.push(qa.simpleSegment(0,A,(P+1)*p,M)),A+=M}this._wireframeIndexBuffer=s.createIndexBuffer(l)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[r]]}},o.GlyphManager=Fg,o.ImagePosition=Px,o.KDBush=Wx,o.LivePerformanceUtils=Sl,o.LngLat=ti,o.LngLatBounds=rd,o.LocalGlyphMode=Rx,o.MAX_MERCATOR_LATITUDE=Ra,o.MercatorCoordinate=pf,o.ONE_EM=du,o.OverscaledTileID=sh,o.PerformanceMarkers=fa,o.Point=q,o.Properties=ot,o.RGBAImage=qu,o.Ray=ki,o.RequestManager=class{constructor(s,r,l){this._transformRequestFn=s,this._customAccessToken=r,this._silenceAuthErrors=!!l,this._createSkuToken()}_createSkuToken(){const s=(function(){let r="";for(let l=0;l<10;l++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",me,r].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(s,r){return this._transformRequestFn&&this._transformRequestFn(s,r)||{url:s}}normalizeStyleURL(s,r){if(!Ct(s))return s;const l=On(s);return l.path=`/styles/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||r)}normalizeGlyphsURL(s,r){if(!Ct(s))return s;const l=On(s);return l.path=`/fonts/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||r)}normalizeSourceURL(s,r,l,h){if(!Ct(s))return s;const p=On(s);return p.path=`/v4/${p.authority}.json`,p.params.push("secure"),l&&p.params.push(`language=${l}`),h&&p.params.push(`worldview=${h}`),this._makeAPIURL(p,this._customAccessToken||r)}normalizeSpriteURL(s,r,l,h){const p=On(s);return Ct(s)?(p.path=`/styles/v1${p.path}/sprite${r}${l}`,this._makeAPIURL(p,this._customAccessToken||h)):(p.path+=`${r}${l}`,An(p))}normalizeTileURL(s,r,l){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!Ct(s))return s;const h=On(s);h.path=h.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||l&&h.authority!=="raster"&&l===512?"@2x":""}${k.supported?".webp":"$1"}`),h.authority==="raster"?h.path=`/${V.RASTER_URL_PREFIX}${h.path}`:(h.path=h.path.replace(/^.+\/v4\//,"/"),h.path=`/${V.TILE_URL_VERSION}${h.path}`);const p=this._customAccessToken||(function(x){for(const b of x){const A=b.match(/^access_token=(.*)$/);if(A)return A[1]}return null})(h.params)||V.ACCESS_TOKEN;return V.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&h.params.push(`sku=${this._skuToken}`),this._makeAPIURL(h,p)}canonicalizeTileURL(s,r){const l=On(s);if(!l.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!l.path.match(/\.[\w]+$/))return s;let h="mapbox://";l.path.match(/^\/raster\/v1\//)?h+=`raster/${l.path.replace(`/${V.RASTER_URL_PREFIX}/`,"")}`:h+=`tiles/${l.path.replace(`/${V.TILE_URL_VERSION}/`,"")}`;let p=l.params;return r&&(p=p.filter((x=>!x.match(/^access_token=/)))),p.length&&(h+=`?${p.join("&")}`),h}canonicalizeTileset(s,r){const l=!!r&&Ct(r),h=[];for(const p of s.tiles||[])Rt(p)?h.push(this.canonicalizeTileURL(p,l)):h.push(p);return h}_makeAPIURL(s,r){const l="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",h=On(V.API_URL);if(s.protocol=h.protocol,s.authority=h.authority,s.protocol==="http"){const p=s.params.indexOf("secure");p>=0&&s.params.splice(p,1)}if(h.path!=="/"&&(s.path=`${h.path}${s.path}`),!V.REQUIRE_ACCESS_TOKEN)return An(s);if(r=r||V.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${l}`);if(r[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${l}`)}return s.params=s.params.filter((p=>p.indexOf("access_token")===-1)),s.params.push(`access_token=${r||""}`),An(s)}},o.ResourceType=or,o.SegmentVector=qa,o.SourceCache=Dm,o.StencilMode=qx,o.StructArrayLayout1ui2=uc,o.StructArrayLayout2f1f2i16=dr,o.StructArrayLayout2i4=_n,o.StructArrayLayout2ui4=us,o.StructArrayLayout3f12=di,o.StructArrayLayout3ui6=_r,o.StructArrayLayout4i8=cn,o.StructArrayLayout5f20=oo,o.Texture=py,o.Tile=Ux,o.Transitionable=ge,o.Uniform1f=Ah,o.Uniform1i=class extends lu{constructor(s){super(s),this.current=0}set(s,r,l){this.fetchUniformLocation(s,r)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},o.Uniform2f=class extends lu{constructor(s){super(s),this.current=[0,0]}set(s,r,l){this.fetchUniformLocation(s,r)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}},o.Uniform3f=class extends lu{constructor(s){super(s),this.current=[0,0,0]}set(s,r,l){this.fetchUniformLocation(s,r)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}},o.Uniform4f=lf,o.UniformColor=td,o.UniformMatrix2f=class extends lu{constructor(s){super(s),this.current=rh}set(s,r,l){if(this.fetchUniformLocation(s,r)){for(let h=0;h<4;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}}},o.UniformMatrix3f=class extends lu{constructor(s){super(s),this.current=nd}set(s,r,l){if(this.fetchUniformLocation(s,r)){for(let h=0;h<9;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix3fv(this.location,!1,l);break}}}},o.UniformMatrix4f=class extends lu{constructor(s){super(s),this.current=xd}set(s,r,l){if(this.fetchUniformLocation(s,r)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let h=1;h<16;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}},o.UnwrappedTileID=W3,o.ValidationError=Un,o.VectorTileFeature=Ri,o.VectorTileWorkerSource=class extends ra{constructor(s,r,l,h,p){super(),this.actor=s,this.layerIndex=r,this.availableImages=l,this.loadVectorData=p||r2,this.loading={},this.loaded={},this.deduped=new n2(s.scheduler),this.isSpriteLoaded=h,this.scheduler=s.scheduler}loadTile(s,r){const l=s.uid,h=s&&s.request,p=h&&h.collectResourceTiming,x=this.loading[l]=new LL(s);x.abort=this.loadVectorData(s,((b,A)=>{const P=!this.loading[l];if(delete this.loading[l],P||b||!A)return x.status="done",P||(this.loaded[l]=x),r(b);const M=A.rawData,G={};A.expires&&(G.expires=A.expires),A.cacheControl&&(G.cacheControl=A.cacheControl),x.vectorTile=A.vectorTile||new pi(new W_(M));const X=()=>{x.parse(x.vectorTile,this.layerIndex,this.availableImages,this.actor,((re,de)=>{if(re||!de)return r(re);const ye={};if(p){const Se=Ql(h);Se.length>0&&(ye.resourceTiming=JSON.parse(JSON.stringify(Se)))}r(null,Oe({rawTileData:M.slice(0)},de,G,ye))}))};this.isSpriteLoaded?X():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(X,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom}):X()})),this.loaded=this.loaded||{},this.loaded[l]=x}))}reloadTile(s,r){const l=this.loaded,h=s.uid,p=this;if(l&&l[h]){const x=l[h];x.showCollisionBoxes=s.showCollisionBoxes,x.enableTerrain=!!s.enableTerrain,x.projection=s.projection,x.tileTransform=Nm(s.tileID.canonical,s.projection);const b=(A,P)=>{const M=x.reloadCallback;M&&(delete x.reloadCallback,x.parse(x.vectorTile,p.layerIndex,this.availableImages,p.actor,M)),r(A,P)};x.status==="parsing"?x.reloadCallback=b:x.status==="done"&&(x.vectorTile?x.parse(x.vectorTile,this.layerIndex,this.availableImages,this.actor,b):b())}}abortTile(s,r){const l=s.uid,h=this.loading[l];h&&(h.abort&&h.abort(),delete this.loading[l]),r()}removeTile(s,r){const l=this.loaded,h=s.uid;l&&l[h]&&delete l[h],r()}},o.WritingMode=cd,o.ZoomDependentExpression=Ic,o.add=he,o.addDynamicAttributes=r1,o.adjoint=function(s,r){var l=r[0],h=r[1],p=r[2],x=r[3],b=r[4],A=r[5],P=r[6],M=r[7],G=r[8];return s[0]=b*G-A*M,s[1]=p*M-h*G,s[2]=h*A-p*b,s[3]=A*P-x*G,s[4]=l*G-p*P,s[5]=p*x-l*A,s[6]=x*M-b*P,s[7]=h*P-l*M,s[8]=l*b-h*x,s},o.asyncAll=le,o.bezier=Re,o.bindAll=tn,o.boundsAttributes=z4,o.bufferConvexPolygon=function(s,r){const l=[];for(let h=0;h<s.length;h++){const p=xe(h-1,-1,s.length-1),x=xe(h+1,-1,s.length-1),b=s[h],A=s[x],P=s[p].sub(b).unit(),M=A.sub(b).unit(),G=M.angleWithSep(P.x,P.y),X=P.add(M).unit().mult(-1*r/Math.sin(G/2));l.push(b.add(X))}return l},o.cacheEntryPossiblyAdded=function(s){Li++,Li>Mr&&(s.getActor().send("enforceCacheSizeLimit",Dn),Li=0)},o.calculateGlobeLabelMatrix=function(s,r){const{x:l,y:h}=s.point,p=as(l,h,s.worldSize/s._pixelsPerMercatorPixel,0,0);return id(p,p,ms(ba(r)))},o.calculateGlobeMatrix=function(s){const{x:r,y:l}=s.point,{lng:h,lat:p}=s._center;return as(r,l,s.worldSize,h,p)},o.calculateGlobeMercatorMatrix=function(s){const r=s.pixelsPerMeter,l=r/Ga(1,s.center.lat),h=Rc(new Float64Array(16));return wd(h,h,[s.point.x,s.point.y,0]),od(h,h,[l,l,r]),Float32Array.from(h)},o.circumferenceAtLatitude=Ma,o.clamp=De,o.clearTileCache=function(s){if(!Er())return;const r=w.caches.delete($n);s&&r.catch(s).then((()=>s()))},o.clipLine=b4,o.clone=function(s){var r=new il(16);return r[0]=s[0],r[1]=s[1],r[2]=s[2],r[3]=s[3],r[4]=s[4],r[5]=s[5],r[6]=s[6],r[7]=s[7],r[8]=s[8],r[9]=s[9],r[10]=s[10],r[11]=s[11],r[12]=s[12],r[13]=s[13],r[14]=s[14],r[15]=s[15],r},o.clone$1=Gt,o.collisionCircleLayout=IC,o.config=V,o.conjugate=function(s,r){return s[0]=-r[0],s[1]=-r[1],s[2]=-r[2],s[3]=r[3],s},o.create=function(){var s=new il(16);return il!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},o.create$1=Mp,o.createExpression=Bo,o.createLayout=kt,o.createStyleLayer=function(s){return s.type==="custom"?new _L(s):new xL[s.type](s)},o.cross=Zt,o.degToRad=Z,o.distance=function(s,r){return Math.hypot(r[0]-s[0],r[1]-s[1],r[2]-s[2])},o.div=function(s,r,l){return s[0]=r[0]/l[0],s[1]=r[1]/l[1],s[2]=r[2]/l[2],s},o.dot=gt,o.earthRadius=Lh,o.ease=we,o.easeCubicInOut=Be,o.ecefToLatLng=function([s,r,l]){const h=Math.hypot(s,r,l),p=Math.atan2(s,l),x=.5*Math.PI-Math.acos(-r/h);return new ti(be(p),be(x))},o.emitValidationErrors=_l,o.endsWith=ln,o.enforceCacheSizeLimit=function(s){Cr(),xr&&xr.then((r=>{r.keys().then((l=>{for(let h=0;h<l.length-s;h++)r.delete(l[h])}))}))},o.evaluateSizeForFeature=G_,o.evaluateSizeForZoom=Mg,o.evaluateVariableOffset=T4,o.evented=S,o.exactEquals=function(s,r){return s[0]===r[0]&&s[1]===r[1]&&s[2]===r[2]&&s[3]===r[3]},o.exactEquals$1=function(s,r){return s[0]===r[0]&&s[1]===r[1]&&s[2]===r[2]},o.exported=Zo,o.exported$1=k,o.extend=Oe,o.extend$1=Yo,o.fillExtrusionHeightLift=$3,o.filterObject=Mn,o.fromMat4=function(s,r){return s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[4],s[4]=r[5],s[5]=r[6],s[6]=r[8],s[7]=r[9],s[8]=r[10],s},o.fromQuat=function(s,r){var l=r[0],h=r[1],p=r[2],x=r[3],b=l+l,A=h+h,P=p+p,M=l*b,G=h*b,X=h*A,re=p*b,de=p*A,ye=p*P,Se=x*b,We=x*A,at=x*P;return s[0]=1-X-ye,s[1]=G+at,s[2]=re-We,s[3]=0,s[4]=G-at,s[5]=1-M-ye,s[6]=de+Se,s[7]=0,s[8]=re+We,s[9]=de-Se,s[10]=1-M-X,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},o.fromRotation=function(s,r){var l=Math.sin(r),h=Math.cos(r);return s[0]=h,s[1]=l,s[2]=0,s[3]=-l,s[4]=h,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},o.fromScaling=Np,o.furthestTileCorner=function(s){const r=Math.round((s+45+360)%360/90)%4;return Me[r]},o.getAABBPointSquareDist=function(s,r,l){let h=0;for(let p=0;p<2;++p){const x=l?l[p]:0;s[p]>x&&(h+=(s[p]-x)*(s[p]-x)),r[p]<x&&(h+=(x-r[p])*(x-r[p]))}return h},o.getAnchorAlignment=Mx,o.getAnchorJustification=Dx,o.getBounds=function(s){let r=1/0,l=1/0,h=-1/0,p=-1/0;for(const x of s)r=Math.min(r,x.x),l=Math.min(l,x.y),h=Math.max(h,x.x),p=Math.max(p,x.y);return{min:new q(r,l),max:new q(h,p)}},o.getColumn=Ln,o.getDefaultExportFromCjs=ue,o.getGridMatrix=function(s,r,l,h){const p=r.getNorth(),x=r.getSouth(),b=r.getWest(),A=r.getEast(),P=1<<s.z,M=A-b,G=p-x,X=M/Do,re=-G/ei[l],de=[0,X,0,re,0,0,p,b,0];if(s.z>0){const ye=180/h;bd(de,de,[ye/M+1,0,0,0,ye/G+1,0,-.5*ye/X,.5*ye/re,1])}return de[2]=P,de[5]=s.x,de[8]=s.y,de},o.getImage=et,o.getJSON=function(s,r){return Dr(Oe(s,{type:"json"}),r)},o.getLatitudinalLod=function(s){const r=Ra-5;s=De(s,-r,r)/r*90;const l=Math.pow(Math.abs(Math.sin(Z(s))),3);return Math.round(l*(ei.length-1))},o.getMapSessionAPI=ro,o.getPerformanceMeasurement=Ql,o.getProjection=N4,o.getRTLTextPluginStatus=T,o.getReferrer=qr,o.getTilePoint=function(s,{x:r,y:l},h=0){return new q(((r-h)*s.scale-s.x)*Wr,(l*s.scale-s.y)*Wr)},o.getTileVec3=function(s,r,l=0){return O(((r.x-l)*s.scale-s.x)*Wr,(r.y*s.scale-s.y)*Wr,Td(r.z,r.y))},o.getVideo=function(s,r){const l=w.document.createElement("video");l.muted=!0,l.onloadstart=function(){r(null,l)};for(let h=0;h<s.length;h++){const p=w.document.createElement("source");li(s[h])||(l.crossOrigin="Anonymous"),p.src=s[h],l.appendChild(p)}return{cancel:()=>{}}},o.globeCenterToScreenPoint=function(s){const r=[0,0,0],l=Rc(new Float64Array(16));return id(l,s.pixelMatrix,s.globeMatrix),Kt(r,r,l),new q(r[0],r[1])},o.globeDenormalizeECEF=ms,o.globeECEFOrigin=function(s,r){const l=[0,0,0];return Kt(l,l,Vr(ba(r.canonical))),Kt(l,l,s),l},o.globeMetersToEcef=Zs,o.globeNormalizeECEF=Vr,o.globePixelsToTileUnits=function(s,r){return Wr/(512*Math.pow(2,s))*Ed(ba(r))},o.globePoleMatrixForTile=function(s,r,l){const h=Rc(new Float64Array(16)),p=(r/(1<<s)-.5)*Math.PI*2;return Yf(h,l.globeMatrix,p),Float32Array.from(h)},o.globeTileBounds=ba,o.globeTiltAtLngLat=vl,o.globeToMercatorTransition=hu,o.globeUseCustomAntiAliasing=function(s,r,l){const h=hu(l.zoom),p=s.style.map._antialias,x=!!r.extStandardDerivatives,b=r.extStandardDerivativesForceOff||s.terrain&&s.terrain.exaggeration()>0;return h===0&&!p&&!b&&x},o.identity=Rc,o.identity$1=Yr,o.invert=wu,o.isFullscreen=function(){return!!w.document.fullscreenElement||!!w.document.webkitFullscreenElement},o.isLngLatBehindGlobe=Ch,o.isMapAuthenticated=function(s){return Ps.has(s)},o.isMapboxURL=Ct,o.isSafariWithAntialiasingBug=function(s){const r=s.navigator?s.navigator.userAgent:null;return!!Hr(s)&&r&&(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.latFromMercatorY=Ho,o.latLngToECEF=$l,o.len=vr,o.length=df,o.length$1=function(s){return Math.hypot(s[0],s[1],s[2],s[3])},o.lngFromMercatorX=yc,o.loadVectorTile=r2,o.makeRequest=Dr,o.mapValue=function(s,r,l,h,p){return De((s-r)/(l-r)*(p-h)+h,h,p)},o.mercatorScale=Qf,o.mercatorXfromLng=Cs,o.mercatorYfromLat=Ys,o.mercatorZfromAltitude=Ga,o.mul=Dp,o.mul$1=un,o.multiply=id,o.multiply$1=bd,o.multiply$2=qe,o.nextPowerOfTwo=dt,o.normalize=Mt,o.normalize$1=Or,o.normalize$2=Gn,o.number=He,o.ortho=function(s,r,l,h,p,x,b){var A=1/(r-l),P=1/(h-p),M=1/(x-b);return s[0]=-2*A,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*P,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*M,s[11]=0,s[12]=(r+l)*A,s[13]=(p+h)*P,s[14]=(b+x)*M,s[15]=1,s},o.pbf=e4,o.perspective=function(s,r,l,h,p){var x,b=1/Math.tan(r/2);return s[0]=b/l,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=b,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,p!=null&&p!==1/0?(s[10]=(p+h)*(x=1/(h-p)),s[14]=2*p*h*x):(s[10]=-1,s[14]=-2*h),s},o.pick=function(s,r){const l={};for(let h=0;h<r.length;h++){const p=r[h];p in s&&(l[p]=s[p])}return l},o.plugin=z,o.pointGeometry=U,o.polesInViewport=function(s){const r=Rc(new Float64Array(16));id(r,s.pixelMatrix,s.globeMatrix);const l=[0,Hi,0],h=[0,Bn,0];return Kt(l,l,r),Kt(h,h,r),[l[0]>0&&l[0]<=s.width&&l[1]>0&&l[1]<=s.height&&!Ch(s,new ti(s.center.lat,90)),h[0]>0&&h[0]<=s.width&&h[1]>0&&h[1]<=s.height&&!Ch(s,new ti(s.center.lat,-90))]},o.polygonContainsPoint=Ud,o.polygonIntersectsBox=O_,o.polygonIntersectsPolygon=bg,o.polygonizeBounds=function(s,r,l=0,h=!0){const p=new q(l,l),x=s.sub(p),b=r.add(p),A=[x,new q(b.x,x.y),b,new q(x.x,b.y)];return h&&A.push(x.clone()),A},o.posAttributes=Kr,o.postMapLoadEvent=po,o.postPerformanceEvent=no,o.postTurnstileEvent=Ei,o.potpack=Lx,o.prevPowerOfTwo=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log(s)/Math.LN2))},o.radToDeg=be,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.registerForPluginStateChange=function(s){return s({pluginStatus:y,pluginURL:a}),S.on("pluginStateChange",s),s},o.removeAuthState=function(s){Ps.delete(s)},o.renderColorRamp=Z0,o.resample=Uu,o.rotateX=Rp,o.rotateX$1=Jr,o.rotateY=Yf,o.rotateY$1=Gi,o.rotateZ=function(s,r,l){var h=Math.sin(l),p=Math.cos(l),x=r[0],b=r[1],A=r[2],P=r[3],M=r[4],G=r[5],X=r[6],re=r[7];return r!==s&&(s[8]=r[8],s[9]=r[9],s[10]=r[10],s[11]=r[11],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[0]=x*p+M*h,s[1]=b*p+G*h,s[2]=A*p+X*h,s[3]=P*p+re*h,s[4]=M*p-x*h,s[5]=G*p-b*h,s[6]=X*p-A*h,s[7]=re*p-P*h,s},o.rotateZ$1=function(s,r,l){l*=.5;var h=r[0],p=r[1],x=r[2],b=r[3],A=Math.sin(l),P=Math.cos(l);return s[0]=h*P+p*A,s[1]=p*P-h*A,s[2]=x*P+b*A,s[3]=b*P-x*A,s},o.scale=od,o.scale$1=Pr,o.scale$2=$e,o.scaleAndAdd=St,o.set=function(s,r,l,h){return s[0]=r,s[1]=l,s[2]=h,s},o.setCacheLimits=function(s,r){Dn=s,Mr=r},o.setColumn=function(s,r,l){s[4*r+0]=l[0],s[4*r+1]=l[1],s[4*r+2]=l[2],s[4*r+3]=l[3]},o.setRTLTextPlugin=function(s,r,l=!1){if(y===ft||y===zt||y===Jt)throw new Error("setRTLTextPlugin cannot be called multiple times.");a=Zo.resolveURL(s),y=ft,En=r,v(),l||N()},o.smoothstep=nt,o.spec=pn,o.squaredLength=function(s){var r=s[0],l=s[1],h=s[2];return r*r+l*l+h*h},o.storeAuthState=function(s,r){r?Ps.add(s):Ps.delete(s)},o.sub=$t,o.subtract=Ie,o.symbolSize=CC,o.tileAABB=function(s,r,l,h,p,x,b,A,P){if(P.name==="globe")return jd(s,r,new q_(l,h,p));const M=Nm({z:l,x:h,y:p},P);return new hn([(x+M.x/M.scale)*r,r*(M.y/M.scale),b],[(x+M.x2/M.scale)*r,r*(M.y2/M.scale),A])},o.tileCornersToBounds=Nc,o.tileTransform=Nm,o.transformMat3=function(s,r,l){var h=r[0],p=r[1],x=r[2];return s[0]=h*l[0]+p*l[3]+x*l[6],s[1]=h*l[1]+p*l[4]+x*l[7],s[2]=h*l[2]+p*l[5]+x*l[8],s},o.transformMat4=Kt,o.transformMat4$1=rr,o.transformQuat=gn,o.transitionTileAABBinECEF=Sd,o.translate=wd,o.transpose=function(s,r){if(s===r){var l=r[1],h=r[2],p=r[5];s[1]=r[3],s[2]=r[6],s[3]=l,s[5]=r[7],s[6]=h,s[7]=p}else s[0]=r[0],s[1]=r[3],s[2]=r[6],s[3]=r[1],s[4]=r[4],s[5]=r[7],s[6]=r[2],s[7]=r[5],s[8]=r[8];return s},o.triggerPluginCompletionEvent=f,o.uniqueId=rt,o.updateGlobeVertexNormal=function(s,r,l,h,p){const x=5*r+2;s.float32[x+0]=l,s.float32[x+1]=h,s.float32[x+2]=p},o.validateCustomStyleLayer=function(s){const r=[],l=s.id;return l===void 0&&r.push({message:`layers.${l}: missing required property "id"`}),s.render===void 0&&r.push({message:`layers.${l}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&r.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),r},o.validateFilter=s=>rl(xo(s)),o.validateFog=s=>rl(lc(s)),o.validateLayer=s=>rl(jl(s)),o.validateLight=s=>rl(Bh(s)),o.validateSource=s=>rl(su(s)),o.validateStyle=Ua,o.validateTerrain=s=>rl(Lc(s)),o.values=Ne,o.vectorTile=vn,o.version=I,o.warnOnce=fr,o.window=w,o.wrap=xe})),m(["./shared"],(function(o){function w(lt){if(typeof lt=="number"||typeof lt=="boolean"||typeof lt=="string"||lt==null)return JSON.stringify(lt);if(Array.isArray(lt)){let Te="[";for(const et of lt)Te+=`${w(et)},`;return`${Te}]`}let Ee="{";for(const Te of Object.keys(lt).sort())Ee+=`${Te}:${w(lt[Te])},`;return`${Ee}}`}function I(lt){let Ee="";for(const Te of o.refProperties)Ee+=`/${w(lt[Te])}`;return Ee}class R{constructor(Ee){this.keyCache={},Ee&&this.replace(Ee)}replace(Ee){this._layerConfigs={},this._layers={},this.update(Ee,[])}update(Ee,Te){for(const ht of Ee)this._layerConfigs[ht.id]=ht,(this._layers[ht.id]=o.createStyleLayer(ht)).compileFilter(),this.keyCache[ht.id]&&delete this.keyCache[ht.id];for(const ht of Te)delete this.keyCache[ht],delete this._layerConfigs[ht],delete this._layers[ht];this.familiesBySource={};const et=(function(ht,Ct){const Rt={};for(let At=0;At<ht.length;At++){const Lt=Ct&&Ct[ht[At].id]||I(ht[At]);Ct&&(Ct[ht[At].id]=Lt);let xn=Rt[Lt];xn||(xn=Rt[Lt]=[]),xn.push(ht[At])}const Ot=[];for(const At in Rt)Ot.push(Rt[At]);return Ot})(o.values(this._layerConfigs),this.keyCache);for(const ht of et){const Ct=ht.map((On=>this._layers[On.id])),Rt=Ct[0];if(Rt.visibility==="none")continue;const Ot=Rt.source||"";let At=this.familiesBySource[Ot];At||(At=this.familiesBySource[Ot]={});const Lt=Rt.sourceLayer||"_geojsonTileLayer";let xn=At[Lt];xn||(xn=At[Lt]=[]),xn.push(Ct)}}}class V{loadTile(Ee,Te){const{uid:et,encoding:ht,rawImageData:Ct,padding:Rt,buildQuadTree:Ot}=Ee,At=o.window.ImageBitmap&&Ct instanceof o.window.ImageBitmap?this.getImageData(Ct,Rt):Ct;Te(null,new o.DEMData(et,At,ht,Rt<1,Ot))}getImageData(Ee,Te){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Ee.width,Ee.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Ee.width,this.offscreenCanvas.height=Ee.height,this.offscreenCanvasContext.drawImage(Ee,0,0,Ee.width,Ee.height);const et=this.offscreenCanvasContext.getImageData(-Te,-Te,Ee.width+2*Te,Ee.height+2*Te);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),et}}function k(lt,Ee){if(lt.length!==0){ie(lt[0],Ee);for(var Te=1;Te<lt.length;Te++)ie(lt[Te],!Ee)}}function ie(lt,Ee){for(var Te=0,et=0,ht=0,Ct=lt.length,Rt=Ct-1;ht<Ct;Rt=ht++){var Ot=(lt[ht][0]-lt[Rt][0])*(lt[Rt][1]+lt[ht][1]),At=Te+Ot;et+=Math.abs(Te)>=Math.abs(Ot)?Te-At+Ot:Ot-At+Te,Te=At}Te+et>=0!=!!Ee&&lt.reverse()}var ae=o.getDefaultExportFromCjs((function lt(Ee,Te){var et,ht=Ee&&Ee.type;if(ht==="FeatureCollection")for(et=0;et<Ee.features.length;et++)lt(Ee.features[et],Te);else if(ht==="GeometryCollection")for(et=0;et<Ee.geometries.length;et++)lt(Ee.geometries[et],Te);else if(ht==="Feature")lt(Ee.geometry,Te);else if(ht==="Polygon")k(Ee.coordinates,Te);else if(ht==="MultiPolygon")for(et=0;et<Ee.coordinates.length;et++)k(Ee.coordinates[et],Te);return Ee}));const fe=o.VectorTileFeature.prototype.toGeoJSON;var J={exports:{}},ne=o.pointGeometry,me=o.vectorTile.VectorTileFeature,ue=ke;function ke(lt,Ee){this.options=Ee||{},this.features=lt,this.length=lt.length}function ze(lt,Ee){this.id=typeof lt.id=="number"?lt.id:void 0,this.type=lt.type,this.rawGeometry=lt.type===1?[lt.geometry]:lt.geometry,this.properties=lt.tags,this.extent=Ee||4096}ke.prototype.feature=function(lt){return new ze(this.features[lt],this.options.extent)},ze.prototype.loadGeometry=function(){var lt=this.rawGeometry;this.geometry=[];for(var Ee=0;Ee<lt.length;Ee++){for(var Te=lt[Ee],et=[],ht=0;ht<Te.length;ht++)et.push(new ne(Te[ht][0],Te[ht][1]));this.geometry.push(et)}return this.geometry},ze.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var lt=this.geometry,Ee=1/0,Te=-1/0,et=1/0,ht=-1/0,Ct=0;Ct<lt.length;Ct++)for(var Rt=lt[Ct],Ot=0;Ot<Rt.length;Ot++){var At=Rt[Ot];Ee=Math.min(Ee,At.x),Te=Math.max(Te,At.x),et=Math.min(et,At.y),ht=Math.max(ht,At.y)}return[Ee,et,Te,ht]},ze.prototype.toGeoJSON=me.prototype.toGeoJSON;var pe=o.pbf,U=ue;function F(lt){var Ee=new pe;return(function(Te,et){for(var ht in Te.layers)et.writeMessage(3,q,Te.layers[ht])})(lt,Ee),Ee.finish()}function q(lt,Ee){var Te;Ee.writeVarintField(15,lt.version||1),Ee.writeStringField(1,lt.name||""),Ee.writeVarintField(5,lt.extent||4096);var et={keys:[],values:[],keycache:{},valuecache:{}};for(Te=0;Te<lt.length;Te++)et.feature=lt.feature(Te),Ee.writeMessage(2,j,et);var ht=et.keys;for(Te=0;Te<ht.length;Te++)Ee.writeStringField(3,ht[Te]);var Ct=et.values;for(Te=0;Te<Ct.length;Te++)Ee.writeMessage(4,Be,Ct[Te])}function j(lt,Ee){var Te=lt.feature;Te.id!==void 0&&Ee.writeVarintField(1,Te.id),Ee.writeMessage(2,H,lt),Ee.writeVarintField(3,Te.type),Ee.writeMessage(4,Me,Te)}function H(lt,Ee){var Te=lt.feature,et=lt.keys,ht=lt.values,Ct=lt.keycache,Rt=lt.valuecache;for(var Ot in Te.properties){var At=Te.properties[Ot],Lt=Ct[Ot];if(At!==null){Lt===void 0&&(et.push(Ot),Ct[Ot]=Lt=et.length-1),Ee.writeVarint(Lt);var xn=typeof At;xn!=="string"&&xn!=="boolean"&&xn!=="number"&&(At=JSON.stringify(At));var On=xn+":"+At,An=Rt[On];An===void 0&&(ht.push(At),Rt[On]=An=ht.length-1),Ee.writeVarint(An)}}}function Z(lt,Ee){return(Ee<<3)+(7&lt)}function be(lt){return lt<<1^lt>>31}function Me(lt,Ee){for(var Te=lt.loadGeometry(),et=lt.type,ht=0,Ct=0,Rt=Te.length,Ot=0;Ot<Rt;Ot++){var At=Te[Ot],Lt=1;et===1&&(Lt=At.length),Ee.writeVarint(Z(1,Lt));for(var xn=et===3?At.length-1:At.length,On=0;On<xn;On++){On===1&&et!==1&&Ee.writeVarint(Z(2,xn-1));var An=At[On].x-ht,Lr=At[On].y-Ct;Ee.writeVarint(be(An)),Ee.writeVarint(be(Lr)),ht+=An,Ct+=Lr}et===3&&Ee.writeVarint(Z(7,1))}}function Be(lt,Ee){var Te=typeof lt;Te==="string"?Ee.writeStringField(1,lt):Te==="boolean"?Ee.writeBooleanField(7,lt):Te==="number"&&(lt%1!=0?Ee.writeDoubleField(3,lt):lt<0?Ee.writeSVarintField(6,lt):Ee.writeVarintField(5,lt))}J.exports=F,J.exports.fromVectorTileJs=F,J.exports.fromGeojsonVt=function(lt,Ee){Ee=Ee||{};var Te={};for(var et in lt)Te[et]=new U(lt[et].features,Ee),Te[et].name=et,Te[et].version=Ee.version,Te[et].extent=Ee.extent;return F({layers:Te})},J.exports.GeoJSONWrapper=U;var Re=o.getDefaultExportFromCjs(J.exports);const we={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:lt=>lt},De=Math.fround||(nt=new Float32Array(1),lt=>(nt[0]=+lt,nt[0]));var nt;const xe=3,le=5,Ne=6;class Oe{constructor(Ee){this.options=Object.assign(Object.create(we),Ee),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Ee){const{log:Te,minZoom:et,maxZoom:ht}=this.options;Te&&console.time("total time");const Ct=`prepare ${Ee.length} points`;Te&&console.time(Ct),this.points=Ee;const Rt=[];for(let At=0;At<Ee.length;At++){const Lt=Ee[At];if(!Lt.geometry)continue;const[xn,On]=Lt.geometry.coordinates,An=De(mt(xn)),Lr=De(dt(On));Rt.push(An,Lr,1/0,At,-1,1),this.options.reduce&&Rt.push(0)}let Ot=this.trees[ht+1]=this._createTree(Rt);Te&&console.timeEnd(Ct);for(let At=ht;At>=et;At--){const Lt=+Date.now();Ot=this.trees[At]=this._createTree(this._cluster(Ot,At)),Te&&console.log("z%d: %d clusters in %dms",At,Ot.numItems,+Date.now()-Lt)}return Te&&console.timeEnd("total time"),this}getClusters(Ee,Te){let et=((Ee[0]+180)%360+360)%360-180;const ht=Math.max(-90,Math.min(90,Ee[1]));let Ct=Ee[2]===180?180:((Ee[2]+180)%360+360)%360-180;const Rt=Math.max(-90,Math.min(90,Ee[3]));if(Ee[2]-Ee[0]>=360)et=-180,Ct=180;else if(et>Ct){const On=this.getClusters([et,ht,180,Rt],Te),An=this.getClusters([-180,ht,Ct,Rt],Te);return On.concat(An)}const Ot=this.trees[this._limitZoom(Te)],At=Ot.range(mt(et),dt(Rt),mt(Ct),dt(ht)),Lt=Ot.data,xn=[];for(const On of At){const An=this.stride*On;xn.push(Lt[An+le]>1?Je(Lt,An,this.clusterProps):this.points[Lt[An+xe]])}return xn}getChildren(Ee){const Te=this._getOriginId(Ee),et=this._getOriginZoom(Ee),ht="No cluster with the specified id.",Ct=this.trees[et];if(!Ct)throw new Error(ht);const Rt=Ct.data;if(Te*this.stride>=Rt.length)throw new Error(ht);const Ot=this.options.radius/(this.options.extent*Math.pow(2,et-1)),At=Ct.within(Rt[Te*this.stride],Rt[Te*this.stride+1],Ot),Lt=[];for(const xn of At){const On=xn*this.stride;Rt[On+4]===Ee&&Lt.push(Rt[On+le]>1?Je(Rt,On,this.clusterProps):this.points[Rt[On+xe]])}if(Lt.length===0)throw new Error(ht);return Lt}getLeaves(Ee,Te,et){const ht=[];return this._appendLeaves(ht,Ee,Te=Te||10,et=et||0,0),ht}getTile(Ee,Te,et){const ht=this.trees[this._limitZoom(Ee)],Ct=Math.pow(2,Ee),{extent:Rt,radius:Ot}=this.options,At=Ot/Rt,Lt=(et-At)/Ct,xn=(et+1+At)/Ct,On={features:[]};return this._addTileFeatures(ht.range((Te-At)/Ct,Lt,(Te+1+At)/Ct,xn),ht.data,Te,et,Ct,On),Te===0&&this._addTileFeatures(ht.range(1-At/Ct,Lt,1,xn),ht.data,Ct,et,Ct,On),Te===Ct-1&&this._addTileFeatures(ht.range(0,Lt,At/Ct,xn),ht.data,-1,et,Ct,On),On.features.length?On:null}getClusterExpansionZoom(Ee){let Te=this._getOriginZoom(Ee)-1;for(;Te<=this.options.maxZoom;){const et=this.getChildren(Ee);if(Te++,et.length!==1)break;Ee=et[0].properties.cluster_id}return Te}_appendLeaves(Ee,Te,et,ht,Ct){const Rt=this.getChildren(Te);for(const Ot of Rt){const At=Ot.properties;if(At&&At.cluster?Ct+At.point_count<=ht?Ct+=At.point_count:Ct=this._appendLeaves(Ee,At.cluster_id,et,ht,Ct):Ct<ht?Ct++:Ee.push(Ot),Ee.length===et)break}return Ct}_createTree(Ee){const Te=new o.KDBush(Ee.length/this.stride|0,this.options.nodeSize,Float32Array);for(let et=0;et<Ee.length;et+=this.stride)Te.add(Ee[et],Ee[et+1]);return Te.finish(),Te.data=Ee,Te}_addTileFeatures(Ee,Te,et,ht,Ct,Rt){for(const Ot of Ee){const At=Ot*this.stride,Lt=Te[At+le]>1;let xn,On,An;if(Lt)xn=rt(Te,At,this.clusterProps),On=Te[At],An=Te[At+1];else{const zr=this.points[Te[At+xe]];xn=zr.properties;const[wr,Ei]=zr.geometry.coordinates;On=mt(wr),An=dt(Ei)}const Lr={type:1,geometry:[[Math.round(this.options.extent*(On*Ct-et)),Math.round(this.options.extent*(An*Ct-ht))]],tags:xn};let Ir;Ir=Lt||this.options.generateId?Te[At+xe]:this.points[Te[At+xe]].id,Ir!==void 0&&(Lr.id=Ir),Rt.features.push(Lr)}}_limitZoom(Ee){return Math.max(this.options.minZoom,Math.min(Math.floor(+Ee),this.options.maxZoom+1))}_cluster(Ee,Te){const{radius:et,extent:ht,reduce:Ct,minPoints:Rt}=this.options,Ot=et/(ht*Math.pow(2,Te)),At=Ee.data,Lt=[],xn=this.stride;for(let On=0;On<At.length;On+=xn){if(At[On+2]<=Te)continue;At[On+2]=Te;const An=At[On],Lr=At[On+1],Ir=Ee.within(At[On],At[On+1],Ot),zr=At[On+le];let wr=zr;for(const Ei of Ir){const to=Ei*xn;At[to+2]>Te&&(wr+=At[to+le])}if(wr>zr&&wr>=Rt){let Ei,to=An*zr,po=Lr*zr,Wo=-1;const no=((On/xn|0)<<5)+(Te+1)+this.points.length;for(const _s of Ir){const ro=_s*xn;if(At[ro+2]<=Te)continue;At[ro+2]=Te;const Ps=At[ro+le];to+=At[ro]*Ps,po+=At[ro+1]*Ps,At[ro+4]=no,Ct&&(Ei||(Ei=this._map(At,On,!0),Wo=this.clusterProps.length,this.clusterProps.push(Ei)),Ct(Ei,this._map(At,ro)))}At[On+4]=no,Lt.push(to/wr,po/wr,1/0,no,-1,wr),Ct&&Lt.push(Wo)}else{for(let Ei=0;Ei<xn;Ei++)Lt.push(At[On+Ei]);if(wr>1)for(const Ei of Ir){const to=Ei*xn;if(!(At[to+2]<=Te)){At[to+2]=Te;for(let po=0;po<xn;po++)Lt.push(At[to+po])}}}}return Lt}_getOriginId(Ee){return Ee-this.points.length>>5}_getOriginZoom(Ee){return(Ee-this.points.length)%32}_map(Ee,Te,et){if(Ee[Te+le]>1){const Rt=this.clusterProps[Ee[Te+Ne]];return et?Object.assign({},Rt):Rt}const ht=this.points[Ee[Te+xe]].properties,Ct=this.options.map(ht);return et&&Ct===ht?Object.assign({},Ct):Ct}}function Je(lt,Ee,Te){return{type:"Feature",id:lt[Ee+xe],properties:rt(lt,Ee,Te),geometry:{type:"Point",coordinates:[(et=lt[Ee],360*(et-.5)),Dt(lt[Ee+1])]}};var et}function rt(lt,Ee,Te){const et=lt[Ee+le],ht=et>=1e4?`${Math.round(et/1e3)}k`:et>=1e3?Math.round(et/100)/10+"k":et,Ct=lt[Ee+Ne],Rt=Ct===-1?{}:Object.assign({},Te[Ct]);return Object.assign(Rt,{cluster:!0,cluster_id:lt[Ee+xe],point_count:et,point_count_abbreviated:ht})}function mt(lt){return lt/360+.5}function dt(lt){const Ee=Math.sin(lt*Math.PI/180),Te=.5-.25*Math.log((1+Ee)/(1-Ee))/Math.PI;return Te<0?0:Te>1?1:Te}function Dt(lt){const Ee=(180-360*lt)*Math.PI/180;return 360*Math.atan(Math.exp(Ee))/Math.PI-90}function tn(lt,Ee,Te,et){for(var ht,Ct=et,Rt=Te-Ee>>1,Ot=Te-Ee,At=lt[Ee],Lt=lt[Ee+1],xn=lt[Te],On=lt[Te+1],An=Ee+3;An<Te;An+=3){var Lr=ln(lt[An],lt[An+1],At,Lt,xn,On);if(Lr>Ct)ht=An,Ct=Lr;else if(Lr===Ct){var Ir=Math.abs(An-Rt);Ir<Ot&&(ht=An,Ot=Ir)}}Ct>et&&(ht-Ee>3&&tn(lt,Ee,ht,et),lt[ht+2]=Ct,Te-ht>3&&tn(lt,ht,Te,et))}function ln(lt,Ee,Te,et,ht,Ct){var Rt=ht-Te,Ot=Ct-et;if(Rt!==0||Ot!==0){var At=((lt-Te)*Rt+(Ee-et)*Ot)/(Rt*Rt+Ot*Ot);At>1?(Te=ht,et=Ct):At>0&&(Te+=Rt*At,et+=Ot*At)}return(Rt=lt-Te)*Rt+(Ot=Ee-et)*Ot}function yn(lt,Ee,Te,et){var ht={id:lt===void 0?null:lt,type:Ee,geometry:Te,tags:et,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return(function(Ct){var Rt=Ct.geometry,Ot=Ct.type;if(Ot==="Point"||Ot==="MultiPoint"||Ot==="LineString")Mn(Ct,Rt);else if(Ot==="Polygon"||Ot==="MultiLineString")for(var At=0;At<Rt.length;At++)Mn(Ct,Rt[At]);else if(Ot==="MultiPolygon")for(At=0;At<Rt.length;At++)for(var Lt=0;Lt<Rt[At].length;Lt++)Mn(Ct,Rt[At][Lt])})(ht),ht}function Mn(lt,Ee){for(var Te=0;Te<Ee.length;Te+=3)lt.minX=Math.min(lt.minX,Ee[Te]),lt.minY=Math.min(lt.minY,Ee[Te+1]),lt.maxX=Math.max(lt.maxX,Ee[Te]),lt.maxY=Math.max(lt.maxY,Ee[Te+1])}function Gt(lt,Ee,Te,et){if(Ee.geometry){var ht=Ee.geometry.coordinates,Ct=Ee.geometry.type,Rt=Math.pow(Te.tolerance/((1<<Te.maxZoom)*Te.extent),2),Ot=[],At=Ee.id;if(Te.promoteId?At=Ee.properties[Te.promoteId]:Te.generateId&&(At=et||0),Ct==="Point")st(ht,Ot);else if(Ct==="MultiPoint")for(var Lt=0;Lt<ht.length;Lt++)st(ht[Lt],Ot);else if(Ct==="LineString")fr(ht,Ot,Rt,!1);else if(Ct==="MultiLineString"){if(Te.lineMetrics){for(Lt=0;Lt<ht.length;Lt++)fr(ht[Lt],Ot=[],Rt,!1),lt.push(yn(At,"LineString",Ot,Ee.properties));return}br(ht,Ot,Rt,!1)}else if(Ct==="Polygon")br(ht,Ot,Rt,!0);else{if(Ct!=="MultiPolygon"){if(Ct==="GeometryCollection"){for(Lt=0;Lt<Ee.geometry.geometries.length;Lt++)Gt(lt,{id:At,geometry:Ee.geometry.geometries[Lt],properties:Ee.properties},Te,et);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Lt=0;Lt<ht.length;Lt++){var xn=[];br(ht[Lt],xn,Rt,!0),Ot.push(xn)}}lt.push(yn(At,Ct,Ot,Ee.properties))}}function st(lt,Ee){Ee.push(Tr(lt[0])),Ee.push(Cn(lt[1])),Ee.push(0)}function fr(lt,Ee,Te,et){for(var ht,Ct,Rt=0,Ot=0;Ot<lt.length;Ot++){var At=Tr(lt[Ot][0]),Lt=Cn(lt[Ot][1]);Ee.push(At),Ee.push(Lt),Ee.push(0),Ot>0&&(Rt+=et?(ht*Lt-At*Ct)/2:Math.sqrt(Math.pow(At-ht,2)+Math.pow(Lt-Ct,2))),ht=At,Ct=Lt}var xn=Ee.length-3;Ee[2]=1,tn(Ee,0,xn,Te),Ee[xn+2]=1,Ee.size=Math.abs(Rt),Ee.start=0,Ee.end=Ee.size}function br(lt,Ee,Te,et){for(var ht=0;ht<lt.length;ht++){var Ct=[];fr(lt[ht],Ct,Te,et),Ee.push(Ct)}}function Tr(lt){return lt/360+.5}function Cn(lt){var Ee=Math.sin(lt*Math.PI/180),Te=.5-.25*Math.log((1+Ee)/(1-Ee))/Math.PI;return Te<0?0:Te>1?1:Te}function ir(lt,Ee,Te,et,ht,Ct,Rt,Ot){if(et/=Ee,Ct>=(Te/=Ee)&&Rt<et)return lt;if(Rt<Te||Ct>=et)return null;for(var At=[],Lt=0;Lt<lt.length;Lt++){var xn=lt[Lt],On=xn.geometry,An=xn.type,Lr=ht===0?xn.minX:xn.minY,Ir=ht===0?xn.maxX:xn.maxY;if(Lr>=Te&&Ir<et)At.push(xn);else if(!(Ir<Te||Lr>=et)){var zr=[];if(An==="Point"||An==="MultiPoint")Jn(On,zr,Te,et,ht);else if(An==="LineString")Hr(On,zr,Te,et,ht,!1,Ot.lineMetrics);else if(An==="MultiLineString")Ln(On,zr,Te,et,ht,!1);else if(An==="Polygon")Ln(On,zr,Te,et,ht,!0);else if(An==="MultiPolygon")for(var wr=0;wr<On.length;wr++){var Ei=[];Ln(On[wr],Ei,Te,et,ht,!0),Ei.length&&zr.push(Ei)}if(zr.length){if(Ot.lineMetrics&&An==="LineString"){for(wr=0;wr<zr.length;wr++)At.push(yn(xn.id,An,zr[wr],xn.tags));continue}An!=="LineString"&&An!=="MultiLineString"||(zr.length===1?(An="LineString",zr=zr[0]):An="MultiLineString"),An!=="Point"&&An!=="MultiPoint"||(An=zr.length===3?"Point":"MultiPoint"),At.push(yn(xn.id,An,zr,xn.tags))}}}return At.length?At:null}function Jn(lt,Ee,Te,et,ht){for(var Ct=0;Ct<lt.length;Ct+=3){var Rt=lt[Ct+ht];Rt>=Te&&Rt<=et&&(Ee.push(lt[Ct]),Ee.push(lt[Ct+1]),Ee.push(lt[Ct+2]))}}function Hr(lt,Ee,Te,et,ht,Ct,Rt){for(var Ot,At,Lt=Vt(lt),xn=ht===0?Dn:Mr,On=lt.start,An=0;An<lt.length-3;An+=3){var Lr=lt[An],Ir=lt[An+1],zr=lt[An+2],wr=lt[An+3],Ei=lt[An+4],to=ht===0?Lr:Ir,po=ht===0?wr:Ei,Wo=!1;Rt&&(Ot=Math.sqrt(Math.pow(Lr-wr,2)+Math.pow(Ir-Ei,2))),to<Te?po>Te&&(At=xn(Lt,Lr,Ir,wr,Ei,Te),Rt&&(Lt.start=On+Ot*At)):to>et?po<et&&(At=xn(Lt,Lr,Ir,wr,Ei,et),Rt&&(Lt.start=On+Ot*At)):$n(Lt,Lr,Ir,zr),po<Te&&to>=Te&&(At=xn(Lt,Lr,Ir,wr,Ei,Te),Wo=!0),po>et&&to<=et&&(At=xn(Lt,Lr,Ir,wr,Ei,et),Wo=!0),!Ct&&Wo&&(Rt&&(Lt.end=On+Ot*At),Ee.push(Lt),Lt=Vt(lt)),Rt&&(On+=Ot)}var no=lt.length-3;Lr=lt[no],Ir=lt[no+1],zr=lt[no+2],(to=ht===0?Lr:Ir)>=Te&&to<=et&&$n(Lt,Lr,Ir,zr),no=Lt.length-3,Ct&&no>=3&&(Lt[no]!==Lt[0]||Lt[no+1]!==Lt[1])&&$n(Lt,Lt[0],Lt[1],Lt[2]),Lt.length&&Ee.push(Lt)}function Vt(lt){var Ee=[];return Ee.size=lt.size,Ee.start=lt.start,Ee.end=lt.end,Ee}function Ln(lt,Ee,Te,et,ht,Ct){for(var Rt=0;Rt<lt.length;Rt++)Hr(lt[Rt],Ee,Te,et,ht,Ct,!1)}function $n(lt,Ee,Te,et){lt.push(Ee),lt.push(Te),lt.push(et)}function Dn(lt,Ee,Te,et,ht,Ct){var Rt=(Ct-Ee)/(et-Ee);return lt.push(Ct),lt.push(Te+(ht-Te)*Rt),lt.push(1),Rt}function Mr(lt,Ee,Te,et,ht,Ct){var Rt=(Ct-Te)/(ht-Te);return lt.push(Ee+(et-Ee)*Rt),lt.push(Ct),lt.push(1),Rt}function xr(lt,Ee){for(var Te=[],et=0;et<lt.length;et++){var ht,Ct=lt[et],Rt=Ct.type;if(Rt==="Point"||Rt==="MultiPoint"||Rt==="LineString")ht=Sr(Ct.geometry,Ee);else if(Rt==="MultiLineString"||Rt==="Polygon"){ht=[];for(var Ot=0;Ot<Ct.geometry.length;Ot++)ht.push(Sr(Ct.geometry[Ot],Ee))}else if(Rt==="MultiPolygon")for(ht=[],Ot=0;Ot<Ct.geometry.length;Ot++){for(var At=[],Lt=0;Lt<Ct.geometry[Ot].length;Lt++)At.push(Sr(Ct.geometry[Ot][Lt],Ee));ht.push(At)}Te.push(yn(Ct.id,Rt,ht,Ct.tags))}return Te}function Sr(lt,Ee){var Te=[];Te.size=lt.size,lt.start!==void 0&&(Te.start=lt.start,Te.end=lt.end);for(var et=0;et<lt.length;et+=3)Te.push(lt[et]+Ee,lt[et+1],lt[et+2]);return Te}function Er(lt,Ee){if(lt.transformed)return lt;var Te,et,ht,Ct=1<<lt.z,Rt=lt.x,Ot=lt.y;for(Te=0;Te<lt.features.length;Te++){var At=lt.features[Te],Lt=At.geometry,xn=At.type;if(At.geometry=[],xn===1)for(et=0;et<Lt.length;et+=2)At.geometry.push(Cr(Lt[et],Lt[et+1],Ee,Ct,Rt,Ot));else for(et=0;et<Lt.length;et++){var On=[];for(ht=0;ht<Lt[et].length;ht+=2)On.push(Cr(Lt[et][ht],Lt[et][ht+1],Ee,Ct,Rt,Ot));At.geometry.push(On)}}return lt.transformed=!0,lt}function Cr(lt,Ee,Te,et,ht,Ct){return[Math.round(Te*(lt*et-ht)),Math.round(Te*(Ee*et-Ct))]}function Si(lt,Ee,Te,et,ht){for(var Ct=Ee===ht.maxZoom?0:ht.tolerance/((1<<Ee)*ht.extent),Rt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Te,y:et,z:Ee,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ot=0;Ot<lt.length;Ot++){Rt.numFeatures++,Li(Rt,lt[Ot],Ct,ht);var At=lt[Ot].minX,Lt=lt[Ot].minY,xn=lt[Ot].maxX,On=lt[Ot].maxY;At<Rt.minX&&(Rt.minX=At),Lt<Rt.minY&&(Rt.minY=Lt),xn>Rt.maxX&&(Rt.maxX=xn),On>Rt.maxY&&(Rt.maxY=On)}return Rt}function Li(lt,Ee,Te,et){var ht=Ee.geometry,Ct=Ee.type,Rt=[];if(Ct==="Point"||Ct==="MultiPoint")for(var Ot=0;Ot<ht.length;Ot+=3)Rt.push(ht[Ot]),Rt.push(ht[Ot+1]),lt.numPoints++,lt.numSimplified++;else if(Ct==="LineString")or(Rt,ht,lt,Te,!1,!1);else if(Ct==="MultiLineString"||Ct==="Polygon")for(Ot=0;Ot<ht.length;Ot++)or(Rt,ht[Ot],lt,Te,Ct==="Polygon",Ot===0);else if(Ct==="MultiPolygon")for(var At=0;At<ht.length;At++){var Lt=ht[At];for(Ot=0;Ot<Lt.length;Ot++)or(Rt,Lt[Ot],lt,Te,!0,Ot===0)}if(Rt.length){var xn=Ee.tags||null;if(Ct==="LineString"&&et.lineMetrics){for(var On in xn={},Ee.tags)xn[On]=Ee.tags[On];xn.mapbox_clip_start=ht.start/ht.size,xn.mapbox_clip_end=ht.end/ht.size}var An={geometry:Rt,type:Ct==="Polygon"||Ct==="MultiPolygon"?3:Ct==="LineString"||Ct==="MultiLineString"?2:1,tags:xn};Ee.id!==null&&(An.id=Ee.id),lt.features.push(An)}}function or(lt,Ee,Te,et,ht,Ct){var Rt=et*et;if(et>0&&Ee.size<(ht?Rt:et))Te.numPoints+=Ee.length/3;else{for(var Ot=[],At=0;At<Ee.length;At+=3)(et===0||Ee[At+2]>Rt)&&(Te.numSimplified++,Ot.push(Ee[At]),Ot.push(Ee[At+1])),Te.numPoints++;ht&&(function(Lt,xn){for(var On=0,An=0,Lr=Lt.length,Ir=Lr-2;An<Lr;Ir=An,An+=2)On+=(Lt[An]-Lt[Ir])*(Lt[An+1]+Lt[Ir+1]);if(On>0===xn)for(An=0,Lr=Lt.length;An<Lr/2;An+=2){var zr=Lt[An],wr=Lt[An+1];Lt[An]=Lt[Lr-2-An],Lt[An+1]=Lt[Lr-1-An],Lt[Lr-2-An]=zr,Lt[Lr-1-An]=wr}})(Ot,Ct),lt.push(Ot)}}function ai(lt,Ee){var Te=(Ee=this.options=(function(ht,Ct){for(var Rt in Ct)ht[Rt]=Ct[Rt];return ht})(Object.create(this.options),Ee)).debug;if(Te&&console.time("preprocess data"),Ee.maxZoom<0||Ee.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Ee.promoteId&&Ee.generateId)throw new Error("promoteId and generateId cannot be used together.");var et=(function(ht,Ct){var Rt=[];if(ht.type==="FeatureCollection")for(var Ot=0;Ot<ht.features.length;Ot++)Gt(Rt,ht.features[Ot],Ct,Ot);else Gt(Rt,ht.type==="Feature"?ht:{geometry:ht},Ct);return Rt})(lt,Ee);this.tiles={},this.tileCoords=[],Te&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Ee.indexMaxZoom,Ee.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),et=(function(ht,Ct){var Rt=Ct.buffer/Ct.extent,Ot=ht,At=ir(ht,1,-1-Rt,Rt,0,-1,2,Ct),Lt=ir(ht,1,1-Rt,2+Rt,0,-1,2,Ct);return(At||Lt)&&(Ot=ir(ht,1,-Rt,1+Rt,0,-1,2,Ct)||[],At&&(Ot=xr(At,1).concat(Ot)),Lt&&(Ot=Ot.concat(xr(Lt,-1)))),Ot})(et,Ee),et.length&&this.splitTile(et,0,0,0),Te&&(et.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function qr(lt,Ee,Te){return 32*((1<<lt)*Te+Ee)+lt}function Dr(lt,Ee){const Te=lt.tileID.canonical;if(!this._geoJSONIndex)return Ee(null,null);const et=this._geoJSONIndex.getTile(Te.z,Te.x,Te.y);if(!et)return Ee(null,null);const ht=new class{constructor(Rt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=Rt.length,this._features=Rt}feature(Rt){return new class{constructor(Ot){this._feature=Ot,this.extent=o.EXTENT,this.type=Ot.type,this.properties=Ot.tags,"id"in Ot&&!isNaN(Ot.id)&&(this.id=parseInt(Ot.id,10))}loadGeometry(){if(this._feature.type===1){const Ot=[];for(const At of this._feature.geometry)Ot.push([new o.Point(At[0],At[1])]);return Ot}{const Ot=[];for(const At of this._feature.geometry){const Lt=[];for(const xn of At)Lt.push(new o.Point(xn[0],xn[1]));Ot.push(Lt)}return Ot}}toGeoJSON(Ot,At,Lt){return fe.call(this,Ot,At,Lt)}}(this._features[Rt])}}(et.features);let Ct=Re(ht);Ct.byteOffset===0&&Ct.byteLength===Ct.buffer.byteLength||(Ct=new Uint8Array(Ct)),Ee(null,{vectorTile:ht,rawData:Ct.buffer})}ai.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ai.prototype.splitTile=function(lt,Ee,Te,et,ht,Ct,Rt){for(var Ot=[lt,Ee,Te,et],At=this.options,Lt=At.debug;Ot.length;){et=Ot.pop(),Te=Ot.pop(),Ee=Ot.pop(),lt=Ot.pop();var xn=1<<Ee,On=qr(Ee,Te,et),An=this.tiles[On];if(!An&&(Lt>1&&console.time("creation"),An=this.tiles[On]=Si(lt,Ee,Te,et,At),this.tileCoords.push({z:Ee,x:Te,y:et}),Lt)){Lt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Ee,Te,et,An.numFeatures,An.numPoints,An.numSimplified),console.timeEnd("creation"));var Lr="z"+Ee;this.stats[Lr]=(this.stats[Lr]||0)+1,this.total++}if(An.source=lt,ht){if(Ee===At.maxZoom||Ee===ht)continue;var Ir=1<<ht-Ee;if(Te!==Math.floor(Ct/Ir)||et!==Math.floor(Rt/Ir))continue}else if(Ee===At.indexMaxZoom||An.numPoints<=At.indexMaxPoints)continue;if(An.source=null,lt.length!==0){Lt>1&&console.time("clipping");var zr,wr,Ei,to,po,Wo,no=.5*At.buffer/At.extent,_s=.5-no,ro=.5+no,Ps=1+no;zr=wr=Ei=to=null,po=ir(lt,xn,Te-no,Te+ro,0,An.minX,An.maxX,At),Wo=ir(lt,xn,Te+_s,Te+Ps,0,An.minX,An.maxX,At),lt=null,po&&(zr=ir(po,xn,et-no,et+ro,1,An.minY,An.maxY,At),wr=ir(po,xn,et+_s,et+Ps,1,An.minY,An.maxY,At),po=null),Wo&&(Ei=ir(Wo,xn,et-no,et+ro,1,An.minY,An.maxY,At),to=ir(Wo,xn,et+_s,et+Ps,1,An.minY,An.maxY,At),Wo=null),Lt>1&&console.timeEnd("clipping"),Ot.push(zr||[],Ee+1,2*Te,2*et),Ot.push(wr||[],Ee+1,2*Te,2*et+1),Ot.push(Ei||[],Ee+1,2*Te+1,2*et),Ot.push(to||[],Ee+1,2*Te+1,2*et+1)}}},ai.prototype.getTile=function(lt,Ee,Te){var et=this.options,ht=et.extent,Ct=et.debug;if(lt<0||lt>24)return null;var Rt=1<<lt,Ot=qr(lt,Ee=(Ee%Rt+Rt)%Rt,Te);if(this.tiles[Ot])return Er(this.tiles[Ot],ht);Ct>1&&console.log("drilling down to z%d-%d-%d",lt,Ee,Te);for(var At,Lt=lt,xn=Ee,On=Te;!At&&Lt>0;)Lt--,xn=Math.floor(xn/2),On=Math.floor(On/2),At=this.tiles[qr(Lt,xn,On)];return At&&At.source?(Ct>1&&console.log("found parent tile z%d-%d-%d",Lt,xn,On),Ct>1&&console.time("drilling down"),this.splitTile(At.source,Lt,xn,On,lt,Ee,Te),Ct>1&&console.timeEnd("drilling down"),this.tiles[Ot]?Er(this.tiles[Ot],ht):null):null};class hi extends o.VectorTileWorkerSource{constructor(Ee,Te,et,ht,Ct){super(Ee,Te,et,ht,Dr),Ct&&(this.loadGeoJSON=Ct)}loadData(Ee,Te){const et=Ee&&Ee.request,ht=et&&et.collectResourceTiming;this.loadGeoJSON(Ee,((Ct,Rt)=>{if(Ct||!Rt)return Te(Ct);if(typeof Rt!="object")return Te(new Error(`Input data given to '${Ee.source}' is not a valid GeoJSON object.`));{ae(Rt,!0);try{if(Ee.filter){const At=o.createExpression(Ee.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(At.result==="error")throw new Error(At.value.map((xn=>`${xn.key}: ${xn.message}`)).join(", "));Rt={type:"FeatureCollection",features:Rt.features.filter((xn=>At.value.evaluate({zoom:0},xn)))}}this._geoJSONIndex=Ee.cluster?new Oe((function({superclusterOptions:At,clusterProperties:Lt}){if(!Lt||!At)return At;const xn={},On={},An={accumulated:null,zoom:0},Lr={properties:null},Ir=Object.keys(Lt);for(const zr of Ir){const[wr,Ei]=Lt[zr],to=o.createExpression(Ei),po=o.createExpression(typeof wr=="string"?[wr,["accumulated"],["get",zr]]:wr);xn[zr]=to.value,On[zr]=po.value}return At.map=zr=>{Lr.properties=zr;const wr={};for(const Ei of Ir)wr[Ei]=xn[Ei].evaluate(An,Lr);return wr},At.reduce=(zr,wr)=>{Lr.properties=wr;for(const Ei of Ir)An.accumulated=zr[Ei],zr[Ei]=On[Ei].evaluate(An,Lr)},At})(Ee)).load(Rt.features):(function(At,Lt){return new ai(At,Lt)})(Rt,Ee.geojsonVtOptions)}catch(At){return Te(At)}this.loaded={};const Ot={};if(ht){const At=o.getPerformanceMeasurement(et);At&&(Ot.resourceTiming={},Ot.resourceTiming[Ee.source]=JSON.parse(JSON.stringify(At)))}Te(null,Ot)}}))}reloadTile(Ee,Te){const et=this.loaded;return et&&et[Ee.uid]?super.reloadTile(Ee,Te):this.loadTile(Ee,Te)}loadGeoJSON(Ee,Te){if(Ee.request)o.getJSON(Ee.request,Te);else{if(typeof Ee.data!="string")return Te(new Error(`Input data given to '${Ee.source}' is not a valid GeoJSON object.`));try{return Te(null,JSON.parse(Ee.data))}catch{return Te(new Error(`Input data given to '${Ee.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Ee,Te){try{Te(null,this._geoJSONIndex.getClusterExpansionZoom(Ee.clusterId))}catch(et){Te(et)}}getClusterChildren(Ee,Te){try{Te(null,this._geoJSONIndex.getChildren(Ee.clusterId))}catch(et){Te(et)}}getClusterLeaves(Ee,Te){try{Te(null,this._geoJSONIndex.getLeaves(Ee.clusterId,Ee.limit,Ee.offset))}catch(et){Te(et)}}}class li{constructor(Ee){this.self=Ee,this.actor=new o.Actor(Ee,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.getProjection({name:"mercator"}),this.workerSourceTypes={vector:o.VectorTileWorkerSource,geojson:hi},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Te,et)=>{if(this.workerSourceTypes[Te])throw new Error(`Worker source with name "${Te}" already registered.`);this.workerSourceTypes[Te]=et},this.self.registerRTLTextPlugin=Te=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=Te.applyArabicShaping,o.plugin.processBidirectionalText=Te.processBidirectionalText,o.plugin.processStyledBidirectionalText=Te.processStyledBidirectionalText}}clearCaches(Ee,Te,et){delete this.layerIndexes[Ee],delete this.availableImages[Ee],delete this.workerSources[Ee],delete this.demWorkerSources[Ee],et()}checkIfReady(Ee,Te,et){et()}setReferrer(Ee,Te){this.referrer=Te}spriteLoaded(Ee,Te){this.isSpriteLoaded[Ee]=Te;for(const et in this.workerSources[Ee]){const ht=this.workerSources[Ee][et];for(const Ct in ht)ht[Ct]instanceof o.VectorTileWorkerSource&&(ht[Ct].isSpriteLoaded=Te,ht[Ct].fire(new o.Event("isSpriteLoaded")))}}setImages(Ee,Te,et){this.availableImages[Ee]=Te;for(const ht in this.workerSources[Ee]){const Ct=this.workerSources[Ee][ht];for(const Rt in Ct)Ct[Rt].availableImages=Te}et()}enableTerrain(Ee,Te,et){this.terrain=Te,et()}setProjection(Ee,Te){this.projections[Ee]=o.getProjection(Te)}setLayers(Ee,Te,et){this.getLayerIndex(Ee).replace(Te),et()}updateLayers(Ee,Te,et){this.getLayerIndex(Ee).update(Te.layers,Te.removedIds),et()}loadTile(Ee,Te,et){const ht=this.enableTerrain?o.extend({enableTerrain:this.terrain},Te):Te;ht.projection=this.projections[Ee]||this.defaultProjection,this.getWorkerSource(Ee,Te.type,Te.source).loadTile(ht,et)}loadDEMTile(Ee,Te,et){const ht=this.enableTerrain?o.extend({buildQuadTree:this.terrain},Te):Te;this.getDEMWorkerSource(Ee,Te.source).loadTile(ht,et)}reloadTile(Ee,Te,et){const ht=this.enableTerrain?o.extend({enableTerrain:this.terrain},Te):Te;ht.projection=this.projections[Ee]||this.defaultProjection,this.getWorkerSource(Ee,Te.type,Te.source).reloadTile(ht,et)}abortTile(Ee,Te,et){this.getWorkerSource(Ee,Te.type,Te.source).abortTile(Te,et)}removeTile(Ee,Te,et){this.getWorkerSource(Ee,Te.type,Te.source).removeTile(Te,et)}removeSource(Ee,Te,et){if(!this.workerSources[Ee]||!this.workerSources[Ee][Te.type]||!this.workerSources[Ee][Te.type][Te.source])return;const ht=this.workerSources[Ee][Te.type][Te.source];delete this.workerSources[Ee][Te.type][Te.source],ht.removeSource!==void 0?ht.removeSource(Te,et):et()}loadWorkerSource(Ee,Te,et){try{this.self.importScripts(Te.url),et()}catch(ht){et(ht.toString())}}syncRTLPluginState(Ee,Te,et){try{o.plugin.setState(Te);const ht=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&ht!=null){this.self.importScripts(ht);const Ct=o.plugin.isParsed();et(Ct?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ht}`),Ct)}}catch(ht){et(ht.toString())}}getAvailableImages(Ee){let Te=this.availableImages[Ee];return Te||(Te=[]),Te}getLayerIndex(Ee){let Te=this.layerIndexes[Ee];return Te||(Te=this.layerIndexes[Ee]=new R),Te}getWorkerSource(Ee,Te,et){if(this.workerSources[Ee]||(this.workerSources[Ee]={}),this.workerSources[Ee][Te]||(this.workerSources[Ee][Te]={}),!this.workerSources[Ee][Te][et]){const ht={send:(Ct,Rt,Ot,At,Lt,xn)=>{this.actor.send(Ct,Rt,Ot,Ee,Lt,xn)},scheduler:this.actor.scheduler};this.workerSources[Ee][Te][et]=new this.workerSourceTypes[Te](ht,this.getLayerIndex(Ee),this.getAvailableImages(Ee),this.isSpriteLoaded[Ee])}return this.workerSources[Ee][Te][et]}getDEMWorkerSource(Ee,Te){return this.demWorkerSources[Ee]||(this.demWorkerSources[Ee]={}),this.demWorkerSources[Ee][Te]||(this.demWorkerSources[Ee][Te]=new V),this.demWorkerSources[Ee][Te]}enforceCacheSizeLimit(Ee,Te){o.enforceCacheSizeLimit(Te)}getWorkerPerformanceMetrics(Ee,Te,et){et(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new li(self)),li})),m(["./shared"],(function(o){function w(y,a){if(Array.isArray(y)){if(!Array.isArray(a)||y.length!==a.length)return!1;for(let f=0;f<y.length;f++)if(!w(y[f],a[f]))return!1;return!0}if(typeof y=="object"&&y!==null&&a!==null){if(typeof a!="object"||Object.keys(y).length!==Object.keys(a).length)return!1;for(const f in y)if(!w(y[f],a[f]))return!1;return!0}return y===a}var I=R;function R(y){return!(function(a){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var v,S,T=new Blob([""],{type:"text/javascript"}),N=URL.createObjectURL(T);try{S=new Worker(N),v=!0}catch{v=!1}return S&&S.terminate(),URL.revokeObjectURL(N),v})()?"Uint8ClampedArray"in window?ArrayBuffer.isView?(function(){var v=document.createElement("canvas");v.width=v.height=1;var S=v.getContext("2d");if(!S)return!1;var T=S.getImageData(0,0,1,1);return T&&T.width===v.width})()?(V[f=a&&a.failIfMajorPerformanceCaveat]===void 0&&(V[f]=(function(v){var S,T=(function(N){var z=document.createElement("canvas"),$=Object.create(R.webGLContextAttributes);return $.failIfMajorPerformanceCaveat=N,z.getContext("webgl",$)||z.getContext("experimental-webgl",$)})(v);if(!T)return!1;try{S=T.createShader(T.VERTEX_SHADER)}catch{return!1}return!(!S||T.isContextLost())&&(T.shaderSource(S,"void main() {}"),T.compileShader(S),T.getShaderParameter(S,T.COMPILE_STATUS)===!0)})(f)),V[f]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var f})(y)}var V={};function k(y,a,f){const v=o.window.document.createElement(y);return a!==void 0&&(v.className=a),f&&f.appendChild(v),v}function ie(y,a,f){const v=o.window.document.createElementNS("http://www.w3.org/2000/svg",y);for(const S of Object.keys(a))v.setAttributeNS(null,S,a[S]);return f&&f.appendChild(v),v}R.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ae=o.window.document&&o.window.document.documentElement.style,fe=ae&&ae.userSelect!==void 0?"userSelect":"WebkitUserSelect";let J;function ne(){ae&&fe&&(J=ae[fe],ae[fe]="none")}function me(){ae&&fe&&(ae[fe]=J)}function ue(y){y.preventDefault(),y.stopPropagation(),o.window.removeEventListener("click",ue,!0)}function ke(){o.window.addEventListener("click",ue,!0),o.window.setTimeout((()=>{o.window.removeEventListener("click",ue,!0)}),0)}function ze(y,a){const f=y.getBoundingClientRect();return F(y,f,a)}function pe(y,a){const f=y.getBoundingClientRect(),v=[];for(let S=0;S<a.length;S++)v.push(F(y,f,a[S]));return v}function U(y){return o.window.InstallTrigger!==void 0&&y.button===2&&y.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:y.button}function F(y,a,f){const v=y.offsetWidth===a.width?1:y.offsetWidth/a.width;return new o.Point((f.clientX-a.left)*v,(f.clientY-a.top)*v)}function q(y,a){var f=a[0],v=a[1],S=a[2],T=a[3],N=f*T-S*v;return N?(y[0]=T*(N=1/N),y[1]=-v*N,y[2]=-S*N,y[3]=f*N,y):null}function j(y){const{userImage:a}=y;return!!(a&&a.render&&a.render())&&(y.data.replace(new Uint8Array(a.data.buffer)),!0)}class H extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(a){if(this.loaded!==a&&(this.loaded=a,a)){for(const{ids:f,callback:v}of this.requestors)this._notify(f,v);this.requestors=[]}}hasImage(a){return!!this.getImage(a)}getImage(a){return this.images[a]}addImage(a,f){this._validate(a,f)&&(this.images[a]=f)}_validate(a,f){let v=!0;return this._validateStretch(f.stretchX,f.data&&f.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${a}" has invalid "stretchX" value`))),v=!1),this._validateStretch(f.stretchY,f.data&&f.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${a}" has invalid "stretchY" value`))),v=!1),this._validateContent(f.content,f)||(this.fire(new o.ErrorEvent(new Error(`Image "${a}" has invalid "content" value`))),v=!1),v}_validateStretch(a,f){if(!a)return!0;let v=0;for(const S of a){if(S[0]<v||S[1]<S[0]||f<S[1])return!1;v=S[1]}return!0}_validateContent(a,f){return!(a&&(a.length!==4||a[0]<0||f.data.width<a[0]||a[1]<0||f.data.height<a[1]||a[2]<0||f.data.width<a[2]||a[3]<0||f.data.height<a[3]||a[2]<a[0]||a[3]<a[1]))}updateImage(a,f){f.version=this.images[a].version+1,this.images[a]=f,this.updatedImages[a]=!0}removeImage(a){const f=this.images[a];delete this.images[a],delete this.patterns[a],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(a,f){let v=!0;if(!this.isLoaded())for(const S of a)this.images[S]||(v=!1);this.isLoaded()||v?this._notify(a,f):this.requestors.push({ids:a,callback:f})}_notify(a,f){const v={};for(const S of a){this.images[S]||this.fire(new o.Event("styleimagemissing",{id:S}));const T=this.images[S];T?v[S]={data:T.data.clone(),pixelRatio:T.pixelRatio,sdf:T.sdf,version:T.version,stretchX:T.stretchX,stretchY:T.stretchY,content:T.content,hasRenderCallback:!!(T.userImage&&T.userImage.render)}:o.warnOnce(`Image "${S}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}f(null,v)}getPixelSize(){const{width:a,height:f}=this.atlasImage;return{width:a,height:f}}getPattern(a){const f=this.patterns[a],v=this.getImage(a);if(!v)return null;if(f&&f.position.version===v.version)return f.position;if(f)f.position.version=v.version;else{const S={w:v.data.width+2,h:v.data.height+2,x:0,y:0},T=new o.ImagePosition(S,v);this.patterns[a]={bin:S,position:T}}return this._updatePatternAtlas(),this.patterns[a].position}bind(a){const f=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(a,this.atlasImage,f.RGBA),this.atlasTexture&&this.atlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(){const a=[];for(const T in this.patterns)a.push(this.patterns[T].bin);const{w:f,h:v}=o.potpack(a),S=this.atlasImage;S.resize({width:f||1,height:v||1});for(const T in this.patterns){const{bin:N}=this.patterns[T],z=N.x+1,$=N.y+1,Q=this.images[T].data,te=Q.width,ge=Q.height;o.RGBAImage.copy(Q,S,{x:0,y:0},{x:z,y:$},{width:te,height:ge}),o.RGBAImage.copy(Q,S,{x:0,y:ge-1},{x:z,y:$-1},{width:te,height:1}),o.RGBAImage.copy(Q,S,{x:0,y:0},{x:z,y:$+ge},{width:te,height:1}),o.RGBAImage.copy(Q,S,{x:te-1,y:0},{x:z-1,y:$},{width:1,height:ge}),o.RGBAImage.copy(Q,S,{x:0,y:0},{x:z+te,y:$},{width:1,height:ge})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(a){for(const f of a){if(this.callbackDispatchedThisFrame[f])continue;this.callbackDispatchedThisFrame[f]=!0;const v=this.images[f];j(v)&&this.updateImage(f,v)}}}const Z=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(y,a){return(function([f,v,S]){const T=o.degToRad(v+90),N=o.degToRad(S);return{x:f*Math.cos(T)*Math.sin(N),y:f*Math.sin(T)*Math.sin(N),z:f*Math.cos(N),azimuthal:v,polar:S}})(y.expression.evaluate(a))}interpolate(y,a,f){return{x:o.number(y.x,a.x,f),y:o.number(y.y,a.y,f),z:o.number(y.z,a.z,f),azimuthal:o.number(y.azimuthal,a.azimuthal,f),polar:o.number(y.polar,a.polar,f)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)});class be extends o.Evented{constructor(a){super(),this._transitionable=new o.Transitionable(Z),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a,f={}){if(!this._validate(o.validateLight,a,f))for(const v in a){const S=a[v];o.endsWith(v,"-transition")?this._transitionable.setTransition(v.slice(0,-11),S):this._transitionable.setValue(v,S)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,f,v){return(!v||v.validate!==!1)&&o.emitValidationErrors(this,a.call(o.validateStyle,o.extend({value:f,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}const Me=new o.Properties({source:new o.DataConstantProperty(o.spec.terrain.source),exaggeration:new o.DataConstantProperty(o.spec.terrain.exaggeration)});let Be=class extends o.Evented{constructor(y,a){super(),this._transitionable=new o.Transitionable(Me),this.set(y),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=a}get(){return this._transitionable.serialize()}set(y){for(const a in y){const f=y[a];o.endsWith(a,"-transition")?this._transitionable.setTransition(a.slice(0,-11),f):this._transitionable.setValue(a,f)}}updateTransitions(y){this._transitioning=this._transitionable.transitioned(y,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(y){this.properties=this._transitioning.possiblyEvaluate(y)}};function Re(y,a,f,v){const S=o.smoothstep(45,65,f),[T,N]=we(y,v),z=o.length(a);let $=1-Math.min(1,Math.exp((z-T)/(N-T)*-6));return $*=$*$,$=Math.min(1,1.00747*$),$*S*y.alpha}function we(y,a){const f=.5/Math.tan(.5*a);return[y.range[0]+f,y.range[1]+f]}const De=new o.Properties({range:new o.DataConstantProperty(o.spec.fog.range),color:new o.DataConstantProperty(o.spec.fog.color),"high-color":new o.DataConstantProperty(o.spec.fog["high-color"]),"space-color":new o.DataConstantProperty(o.spec.fog["space-color"]),"horizon-blend":new o.DataConstantProperty(o.spec.fog["horizon-blend"]),"star-intensity":new o.DataConstantProperty(o.spec.fog["star-intensity"])});class nt extends o.Evented{constructor(a,f){super(),this._transitionable=new o.Transitionable(De),this.set(a),this._transitioning=this._transitionable.untransitioned(),this._transform=f}get state(){const a=this._transform,f=a.projection.name==="globe",v=o.globeToMercatorTransition(a.zoom),S=this.properties.get("range"),T=[.5,3];return{range:f?[o.number(T[0],S[0],v),o.number(T[1],S[1],v)]:S,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(a,f={}){if(!this._validate(o.validateFog,a,f)){for(const v of Object.keys(o.spec.fog))a&&a[v]===void 0&&(a[v]=o.spec.fog[v].default);for(const v in a){const S=a[v];o.endsWith(v,"-transition")?this._transitionable.setTransition(v.slice(0,-11),S):this._transitionable.setValue(v,S)}}}getOpacity(a){if(!this._transform.projection.supportsFog)return 0;const f=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.smoothstep(45,65,a))*f.a}getOpacityAtLatLng(a,f){return this._transform.projection.supportsFog?(function(v,S,T){const N=o.MercatorCoordinate.fromLngLat(S),z=T.elevation?T.elevation.getAtPointOrZero(N):0,$=[N.x,N.y,z];return o.transformMat4($,$,T.mercatorFogMatrix),Re(v,$,T.pitch,T._fov)})(this.state,a,f):0}getFovAdjustedRange(a){return this._transform.projection.supportsFog?we(this.state,a):[0,1]}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,f,v){return(!v||v.validate!==!1)&&o.emitValidationErrors(this,a.call(o.validateStyle,o.extend({value:f,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class xe{constructor(a,f){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=o.uniqueId();const v=this.workerPool.acquire(this.id);for(let S=0;S<v.length;S++){const T=new xe.Actor(v[S],f,this.id);T.name=`Worker ${S}`,this.actors.push(T)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(a,f,v){o.asyncAll(this.actors,((S,T)=>{S.send(a,f,T)}),v=v||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((a=>{a.remove()})),this.actors=[],this.workerPool.release(this.id)}}function le(y,a,f){return a*(o.EXTENT/(y.tileSize*Math.pow(2,f-y.tileID.overscaledZ)))}xe.Actor=o.Actor;class Ne{constructor(a,f,v,S){this.screenBounds=a,this.cameraPoint=f,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=v,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,S)}static createFromScreenPoints(a,f){let v,S;if(a instanceof o.Point||typeof a[0]=="number"){const T=o.Point.convert(a);v=[T],S=f.isPointAboveHorizon(T)}else{const T=o.Point.convert(a[0]),N=o.Point.convert(a[1]);v=[T,N],S=o.polygonizeBounds(T,N).every((z=>f.isPointAboveHorizon(z)))}return new Ne(v,f.getCameraPoint(),S,f)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(a){return o.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],a)}bufferedCameraGeometry(a){const f=this.screenBounds[0],v=this.screenBounds.length===1?this.screenBounds[0].add(new o.Point(1,1)):this.screenBounds[1],S=o.polygonizeBounds(f,v,0,!1);return this.cameraPoint.y>v.y&&(this.cameraPoint.x>f.x&&this.cameraPoint.x<v.x?S.splice(3,0,this.cameraPoint):this.cameraPoint.x>=v.x?S[2]=this.cameraPoint:this.cameraPoint.x<=f.x&&(S[3]=this.cameraPoint)),o.bufferConvexPolygon(S,a)}bufferedCameraGeometryGlobe(a){const f=this.screenBounds[0],v=this.screenBounds.length===1?this.screenBounds[0].add(new o.Point(1,1)):this.screenBounds[1],S=o.polygonizeBounds(f,v,a),T=this.cameraPoint.clone();switch(3*((T.y>f.y)+(T.y>v.y))+((T.x>f.x)+(T.x>v.x))){case 0:S[0]=T,S[4]=T.clone();break;case 1:S.splice(1,0,T);break;case 2:S[1]=T;break;case 3:S.splice(4,0,T);break;case 5:S.splice(2,0,T);break;case 6:S[3]=T;break;case 7:S.splice(3,0,T);break;case 8:S[2]=T}return S}containsTile(a,f,v,S=0){const T=a.queryPadding/f._pixelsPerMercatorPixel+1,N=v?this._bufferedCameraMercator(T,f):this._bufferedScreenMercator(T,f);let z=a.tileID.wrap+(N.unwrapped?S:0);const $=N.polygon.map((Xe=>o.getTilePoint(a.tileTransform,Xe,z)));if(!o.polygonIntersectsBox($,0,0,o.EXTENT,o.EXTENT))return;z=a.tileID.wrap+(this.screenGeometryMercator.unwrapped?S:0);const Q=this.screenGeometryMercator.polygon.map((Xe=>o.getTileVec3(a.tileTransform,Xe,z))),te=Q.map((Xe=>new o.Point(Xe[0],Xe[1]))),ge=f.getFreeCameraOptions().position||new o.MercatorCoordinate(0,0,0),Ae=o.getTileVec3(a.tileTransform,ge,z),Le=Q.map((Xe=>{const _e=o.sub(Xe,Xe,Ae);return o.normalize(_e,_e),new o.Ray(Ae,_e)})),Ze=le(a,1,f.zoom)*f._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:te,tilespaceRays:Le,bufferedTilespaceGeometry:$,bufferedTilespaceBounds:(Ue=o.getBounds($),Ue.min.x=o.clamp(Ue.min.x,0,o.EXTENT),Ue.min.y=o.clamp(Ue.min.y,0,o.EXTENT),Ue.max.x=o.clamp(Ue.max.x,0,o.EXTENT),Ue.max.y=o.clamp(Ue.max.y,0,o.EXTENT),Ue),tile:a,tileID:a.tileID,pixelToTileUnitsFactor:Ze};var Ue}_bufferedScreenMercator(a,f){const v=rt(a);if(this._screenRaycastCache[v])return this._screenRaycastCache[v];{let S;return S=f.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(a),f):{polygon:this.bufferedScreenGeometry(a).map((T=>f.pointCoordinate3D(T))),unwrapped:!0},this._screenRaycastCache[v]=S,S}}_bufferedCameraMercator(a,f){const v=rt(a);if(this._cameraRaycastCache[v])return this._cameraRaycastCache[v];{let S;return S=f.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(a),f):{polygon:this.bufferedCameraGeometry(a).map((T=>f.pointCoordinate3D(T))),unwrapped:!0},this._cameraRaycastCache[v]=S,S}}_projectAndResample(a,f){const v=(function(T,N){const z=o.multiply([],N.pixelMatrix,N.globeMatrix),$=[0,-o.GLOBE_RADIUS,0,1],Q=[0,o.GLOBE_RADIUS,0,1],te=[0,0,0,1];o.transformMat4$1($,$,z),o.transformMat4$1(Q,Q,z),o.transformMat4$1(te,te,z);const ge=new o.Point($[0]/$[3],$[1]/$[3]),Ae=new o.Point(Q[0]/Q[3],Q[1]/Q[3]),Le=o.polygonContainsPoint(T,ge)&&$[3]<te[3],Ze=o.polygonContainsPoint(T,Ae)&&Q[3]<te[3];if(!Le&&!Ze)return null;const Ue=(function(_t,Pt,kt){for(let jt=1;jt<_t.length;jt++){const _n=Je(Pt.pointCoordinate3D(_t[jt-1]).x),Ut=Je(Pt.pointCoordinate3D(_t[jt]).x);if(kt<0){if(_n<Ut)return{idx:jt,t:-_n/(Ut-1-_n)}}else if(Ut<_n)return{idx:jt,t:(1-_n)/(Ut+1-_n)}}return null})(T,N,Le?-1:1);if(!Ue)return null;const{idx:Xe,t:_e}=Ue;let Ge=Xe>1?Oe(T.slice(0,Xe),N):[],it=Xe<T.length?Oe(T.slice(Xe),N):[];Ge=Ge.map((_t=>new o.Point(Je(_t.x),_t.y))),it=it.map((_t=>new o.Point(Je(_t.x),_t.y)));const ot=[...Ge];ot.length===0&&ot.push(it[it.length-1]);const bt=o.number(ot[ot.length-1].y,(it.length===0?Ge[0]:it[0]).y,_e);let wt;return wt=Le?[new o.Point(0,bt),new o.Point(0,0),new o.Point(1,0),new o.Point(1,bt)]:[new o.Point(1,bt),new o.Point(1,1),new o.Point(0,1),new o.Point(0,bt)],ot.push(...wt),it.length===0?ot.push(Ge[0]):ot.push(...it),{polygon:ot.map((_t=>new o.MercatorCoordinate(_t.x,_t.y))),unwrapped:!1}})(a,f);if(v)return v;const S=(function(T,N){let z=!1,$=-1/0,Q=0;for(let ge=0;ge<T.length-1;ge++)T[ge].x>$&&($=T[ge].x,Q=ge);for(let ge=0;ge<T.length-1;ge++){const Ae=(Q+ge)%(T.length-1),Le=T[Ae],Ze=T[Ae+1];Math.abs(Le.x-Ze.x)>.5&&(Le.x<Ze.x?(Le.x+=1,Ae===0&&(T[T.length-1].x+=1)):(Ze.x+=1,Ae+1===T.length-1&&(T[0].x+=1)),z=!0)}const te=o.mercatorXfromLng(N.center.lng);return z&&te<Math.abs(te-1)&&T.forEach((ge=>{ge.x-=1})),{polygon:T,unwrapped:z}})(Oe(a,f).map((T=>new o.Point(Je(T.x),T.y))),f);return{polygon:S.polygon.map((T=>new o.MercatorCoordinate(T.x,T.y))),unwrapped:S.unwrapped}}}function Oe(y,a){return o.resample(y,(f=>{const v=a.pointCoordinate3D(f);f.x=v.x,f.y=v.y}),1/256)}function Je(y){return y<0?1+y%1:y%1}function rt(y){return 100*y|0}function mt(y,a,f,v,S){const T=function(N,z){if(N)return S(N);if(z){y.url&&z.tiles&&y.tiles&&delete y.tiles;const $=o.pick(o.extend(z,y),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);z.vector_layers&&($.vectorLayers=z.vector_layers,$.vectorLayerIds=$.vectorLayers.map((Q=>Q.id))),$.tiles=a.canonicalizeTileset($,y.url),S(null,$)}};return y.url?o.getJSON(a.transformRequest(a.normalizeSourceURL(y.url,null,f,v),o.ResourceType.Source),T):o.exported.frame((()=>T(null,y)))}class dt{constructor(a,f,v){this.bounds=o.LngLatBounds.convert(this.validateBounds(a)),this.minzoom=f||0,this.maxzoom=v||24}validateBounds(a){return Array.isArray(a)&&a.length===4?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(a){const f=Math.pow(2,a.z),v=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*f),S=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*f),T=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*f),N=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*f);return a.x>=v&&a.x<T&&a.y>=S&&a.y<N}}class Dt{constructor(a,f,v){this.context=a;const S=a.gl;this.buffer=S.createBuffer(),this.dynamicDraw=!!v,this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),S.bufferData(S.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||f.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){const f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const tn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ln{constructor(a,f,v,S){this.length=f.length,this.attributes=v,this.itemSize=f.bytesPerElement,this.dynamicDraw=S,this.context=a;const T=a.gl;this.buffer=T.createBuffer(),a.bindVertexBuffer.set(this.buffer),T.bufferData(T.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||f.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,f){for(let v=0;v<this.attributes.length;v++){const S=f.attributes[this.attributes[v].name];S!==void 0&&a.enableVertexAttribArray(S)}}setVertexAttribPointers(a,f,v){for(let S=0;S<this.attributes.length;S++){const T=this.attributes[S],N=f.attributes[T.name];N!==void 0&&a.vertexAttribPointer(N,T.components,a[tn[T.type]],!1,this.itemSize,T.offset+this.itemSize*(v||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class yn{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Mn extends yn{getDefault(){return o.Color.transparent}set(a){const f=this.current;(a.r!==f.r||a.g!==f.g||a.b!==f.b||a.a!==f.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class Gt extends yn{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class st extends yn{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class fr extends yn{getDefault(){return[!0,!0,!0,!0]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||a[2]!==f[2]||a[3]!==f[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class br extends yn{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class Tr extends yn{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class Cn extends yn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const f=this.current;(a.func!==f.func||a.ref!==f.ref||a.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class ir extends yn{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||a[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class Jn extends yn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=a,this.dirty=!1}}class Hr extends yn{getDefault(){return[0,1]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class Vt extends yn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=a,this.dirty=!1}}class Ln extends yn{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class $n extends yn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.BLEND):f.disable(f.BLEND),this.current=a,this.dirty=!1}}class Dn extends yn{getDefault(){const a=this.gl;return[a.ONE,a.ZERO]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)}}class Mr extends yn{getDefault(){return o.Color.transparent}set(a){const f=this.current;(a.r!==f.r||a.g!==f.g||a.b!==f.b||a.a!==f.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class xr extends yn{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)}}class Sr extends yn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=a,this.dirty=!1}}class Er extends yn{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class Cr extends yn{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}let Si,Li=class extends yn{getDefault(){return null}set(y){(y!==this.current||this.dirty)&&(this.gl.useProgram(y),this.current=y,this.dirty=!1)}};class or extends yn{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class ai extends yn{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||a[2]!==f[2]||a[3]!==f[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class qr extends yn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class Dr extends yn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class hi extends yn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class li extends yn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class lt extends yn{getDefault(){return null}set(a){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class Ee extends yn{constructor(a){super(a),this.vao=a.extVertexArrayObject}getDefault(){return null}set(a){this.vao&&(a!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(a),this.current=a,this.dirty=!1)}}class Te extends yn{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class et extends yn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class ht extends yn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class Ct extends yn{constructor(a,f){super(a),this.context=a,this.parent=f}getDefault(){return null}}class Rt extends Ct{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class Ot extends Ct{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,this.attachment(),f.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class At extends Ot{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Lt{constructor(a,f,v,S){this.context=a,this.width=f,this.height=v;const T=this.framebuffer=a.gl.createFramebuffer();this.colorAttachment=new Rt(a,T),S&&(this.depthAttachment=new Ot(a,T))}destroy(){const a=this.context.gl,f=this.colorAttachment.get();if(f&&a.deleteTexture(f),this.depthAttachment){const v=this.depthAttachment.get();v&&a.deleteRenderbuffer(v)}a.deleteFramebuffer(this.framebuffer)}}class xn{constructor(a,f=!1){if(this.gl=a,this.isWebGL2=f,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),f){const v=a;this.extVertexArrayObject={createVertexArrayOES:v.createVertexArray.bind(a),deleteVertexArrayOES:v.deleteVertexArray.bind(a),bindVertexArrayOES:v.bindVertexArray.bind(a)}}this.clearColor=new Mn(this),this.clearDepth=new Gt(this),this.clearStencil=new st(this),this.colorMask=new fr(this),this.depthMask=new br(this),this.stencilMask=new Tr(this),this.stencilFunc=new Cn(this),this.stencilOp=new ir(this),this.stencilTest=new Jn(this),this.depthRange=new Hr(this),this.depthTest=new Vt(this),this.depthFunc=new Ln(this),this.blend=new $n(this),this.blendFunc=new Dn(this),this.blendColor=new Mr(this),this.blendEquation=new xr(this),this.cullFace=new Sr(this),this.cullFaceSide=new Er(this),this.frontFace=new Cr(this),this.program=new Li(this),this.activeTexture=new or(this),this.viewport=new ai(this),this.bindFramebuffer=new qr(this),this.bindRenderbuffer=new Dr(this),this.bindTexture=new hi(this),this.bindVertexBuffer=new li(this),this.bindElementBuffer=new lt(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Ee(this),this.pixelStoreUnpack=new Te(this),this.pixelStoreUnpackPremultiplyAlpha=new et(this),this.pixelStoreUnpackFlipY=new ht(this),this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=a.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=a.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=a.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),f||(this.extTextureHalfFloat=a.getExtension("OES_texture_half_float")),(f||this.extTextureHalfFloat&&a.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=a.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=f||a.getExtension("OES_standard_derivatives"),this.extTimerQuery=a.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,f){return new Dt(this,a,f)}createVertexBuffer(a,f,v){return new ln(this,a,f,v)}createRenderbuffer(a,f,v){const S=this.gl,T=S.createRenderbuffer();return this.bindRenderbuffer.set(T),S.renderbufferStorage(S.RENDERBUFFER,a,f,v),this.bindRenderbuffer.set(null),T}createFramebuffer(a,f,v){return new Lt(this,a,f,v)}clear({color:a,depth:f,stencil:v}){const S=this.gl;let T=0;a&&(T|=S.COLOR_BUFFER_BIT,this.clearColor.set(a),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(T|=S.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),v!==void 0&&(T|=S.STENCIL_BUFFER_BIT,this.clearStencil.set(v),this.stencilMask.set(255)),S.clear(T)}setCullFace(a){a.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){w(a.blendFunction,o.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor)),this.colorMask.set(a.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class On extends o.Evented{constructor(a,f,v,S){if(super(),this.id=a,this.dispatcher=v,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(f,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},f),this._collectResourceTiming=f.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(S),this._tileWorkers={},this._deduped=new o.DedupedRequest}load(a){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"}));const f=Array.isArray(this.map._language)?this.map._language.join():this.map._language,v=this.map._worldview;this._tileJSONRequest=mt(this._options,this.map._requestManager,f,v,((S,T)=>{this._tileJSONRequest=null,this._loaded=!0,S?(f&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${f}`),v&&v.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${v}`),this.fire(new o.ErrorEvent(S))):T&&(o.extend(this,T),T.bounds&&(this.tileBounds=new dt(T.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(T.tiles,this.map._requestManager._customAccessToken),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),a&&a(S)}))}loaded(){return this._loaded}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest(),this.load((()=>this.map.style._clearSource(this.id)))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.extend({},this._options)}loadTile(a,f){const v=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme)),S={request:this.map._requestManager.transformRequest(v,o.ResourceType.Tile),data:void 0,uid:a.uid,tileID:a.tileID,tileZoom:a.tileZoom,zoom:a.tileID.overscaledZ,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:a.isSymbolTile};if(S.request.collectResourceTiming=this._collectResourceTiming,a.actor&&a.state!=="expired")a.state==="loading"?a.reloadCallback=f:a.request=a.actor.send("reloadTile",S,T.bind(this));else if(a.actor=this._tileWorkers[v]=this._tileWorkers[v]||this.dispatcher.getActor(),this.dispatcher.ready)a.request=a.actor.send("loadTile",S,T.bind(this),void 0,!0);else{const N=o.loadVectorTile.call({deduped:this._deduped},S,((z,$)=>{z||!$?T.call(this,z):(S.data={cacheControl:$.cacheControl,expires:$.expires,rawData:$.rawData.slice(0)},a.actor&&a.actor.send("loadTile",S,T.bind(this),void 0,!0))}),!0);a.request={cancel:N}}function T(N,z){return delete a.request,a.aborted?f(null):N&&N.status!==404?f(N):(z&&z.resourceTiming&&(a.resourceTiming=z.resourceTiming),this.map._refreshExpiredTiles&&z&&a.setExpiryData(z),a.loadVectorData(z,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),f(null),void(a.reloadCallback&&(this.loadTile(a,a.reloadCallback),a.reloadCallback=null)))}}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id})}unloadTile(a){a.unloadVectorData(),a.actor&&a.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class An extends o.Evented{constructor(a,f,v,S){super(),this.id=a,this.dispatcher=v,this.setEventedParent(S),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},f),o.extend(this,o.pick(f,["url","scheme","tileSize"]))}load(a){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=mt(this._options,this.map._requestManager,null,null,((f,v)=>{this._tileJSONRequest=null,this._loaded=!0,f?this.fire(new o.ErrorEvent(f)):v&&(o.extend(this,v),v.bounds&&(this.tileBounds=new dt(v.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(v.tiles),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),a&&a(f)}))}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest(),this.load((()=>this.map.style._clearSource(this.id)))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.extend({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a,f){const v=o.exported.devicePixelRatio>=2,S=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),v,this.tileSize);a.request=o.getImage(this.map._requestManager.transformRequest(S,o.ResourceType.Tile),((T,N,z,$)=>(delete a.request,a.aborted?(a.state="unloaded",f(null)):T?(a.state="errored",f(T)):N?(this.map._refreshExpiredTiles&&a.setExpiryData({cacheControl:z,expires:$}),a.setTexture(N,this.map.painter),a.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),void f(null)):f(null))))}static loadTileData(a,f,v){a.setTexture(f,v)}static unloadTileData(a,f){a.texture&&f.saveTileTexture(a.texture)}abortTile(a,f){a.request&&(a.request.cancel(),delete a.request),f()}unloadTile(a,f){a.texture&&this.map.painter.saveTileTexture(a.texture),f()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Lr(y,a,f,v,S,T,N,z){const $=[y,f,S,a,v,T,1,1,1],Q=[N,z,1],te=o.adjoint([],$),[ge,Ae,Le]=o.transformMat3(Q,Q,o.transpose(te,te));return o.multiply$1($,[ge,0,0,0,Ae,0,0,0,Le],$)}class Ir extends o.Evented{constructor(a,f,v,S){super(),this.id=a,this.dispatcher=v,this.coordinates=f.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(S),this.options=f,this._dirty=!1}load(a,f){this._loaded=f||!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),((v,S)=>{if(this._imageRequest=null,this._loaded=!0,v)this.fire(new o.ErrorEvent(v));else if(S){const{HTMLImageElement:T}=o.window;this.image=S instanceof T?o.exported.getImageData(S):S,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,a&&(this.coordinates=a),this._finishLoading()}}))}loaded(){return this._loaded}updateImage(a){return this.image&&a.url?(this._imageRequest&&a.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=a.url,this.load(a.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(a){this.coordinates=a,this._boundsArray=void 0;const f=a.map(o.MercatorCoordinate.fromLngLat);return this.tileID=(function(v){let S=1/0,T=1/0,N=-1/0,z=-1/0;for(const ge of v)S=Math.min(S,ge.x),T=Math.min(T,ge.y),N=Math.max(N,ge.x),z=Math.max(z,ge.y);const $=Math.max(N-S,z-T),Q=Math.max(0,Math.floor(-Math.log($)/Math.LN2)),te=Math.pow(2,Q);return new o.CanonicalTileID(Q,Math.floor((S+N)/2*te),Math.floor((T+z)/2*te))})(f),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(a){for(const $ in this.tiles){const Q=this.tiles[$];Q.state!=="loaded"&&(Q.state="loaded",Q.texture=this.texture)}if(this._boundsArray)return;const f=o.tileTransform(this.tileID,this.map.transform.projection),[v,S,T,N]=this.coordinates.map(($=>{const Q=f.projection.project($[0],$[1]);return o.getTilePoint(f,Q)._round()}));this.perspectiveTransform=(function($,Q,te,ge,Ae,Le,Ze,Ue,Xe,_e){const Ge=Lr(0,0,$,0,0,Q,$,Q),it=Lr(te,ge,Ae,Le,Ze,Ue,Xe,_e);return o.multiply$1(it,o.adjoint(Ge,Ge),it),[it[6]/it[8]*$/o.EXTENT,it[7]/it[8]*Q/o.EXTENT]})(this.width,this.height,v.x,v.y,S.x,S.y,N.x,N.y,T.x,T.y);const z=this._boundsArray=new o.StructArrayLayout4i8;z.emplaceBack(v.x,v.y,0,0),z.emplaceBack(S.x,S.y,o.EXTENT,0),z.emplaceBack(N.x,N.y,0,o.EXTENT),z.emplaceBack(T.x,T.y,o.EXTENT,o.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=a.createVertexBuffer(z,o.boundsAttributes.members),this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const a=this.map.painter.context,f=a.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new o.Texture(a,this.image,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(a)}loadTile(a,f){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={},f(null)):(a.state="errored",f(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const zr={vector:On,raster:An,"raster-dem":class extends An{constructor(y,a,f,v){super(y,a,f,v),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox"}loadTile(y,a){const f=this.map._requestManager.normalizeTileURL(y.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function v(S,T){S&&(y.state="errored",a(S)),T&&(y.dem=T,y.dem.onDeserialize(),y.needsHillshadePrepare=!0,y.needsDEMTextureUpload=!0,y.state="loaded",a(null))}y.request=o.getImage(this.map._requestManager.transformRequest(f,o.ResourceType.Tile),(function(S,T,N,z){if(delete y.request,y.aborted)y.state="unloaded",a(null);else if(S)y.state="errored",a(S);else if(T){this.map._refreshExpiredTiles&&y.setExpiryData({cacheControl:N,expires:z});const $=o.window.ImageBitmap&&T instanceof o.window.ImageBitmap&&(Si==null&&(Si=o.window.OffscreenCanvas&&new o.window.OffscreenCanvas(1,1).getContext("2d")&&typeof o.window.createImageBitmap=="function"),Si),Q=1-(T.width-o.prevPowerOfTwo(T.width))/2;Q<1||y.neighboringTiles||(y.neighboringTiles=this._getNeighboringTiles(y.tileID));const te=$?T:o.exported.getImageData(T,Q),ge={uid:y.uid,coord:y.tileID,source:this.id,rawImageData:te,encoding:this.encoding,padding:Q};y.actor&&y.state!=="expired"||(y.actor=this.dispatcher.getActor(),y.actor.send("loadDEMTile",ge,v.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(y){const a=y.canonical,f=Math.pow(2,a.z),v=(a.x-1+f)%f,S=a.x===0?y.wrap-1:y.wrap,T=(a.x+1+f)%f,N=a.x+1===f?y.wrap+1:y.wrap,z={};return z[new o.OverscaledTileID(y.overscaledZ,S,a.z,v,a.y).key]={backfilled:!1},z[new o.OverscaledTileID(y.overscaledZ,N,a.z,T,a.y).key]={backfilled:!1},a.y>0&&(z[new o.OverscaledTileID(y.overscaledZ,S,a.z,v,a.y-1).key]={backfilled:!1},z[new o.OverscaledTileID(y.overscaledZ,y.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},z[new o.OverscaledTileID(y.overscaledZ,N,a.z,T,a.y-1).key]={backfilled:!1}),a.y+1<f&&(z[new o.OverscaledTileID(y.overscaledZ,S,a.z,v,a.y+1).key]={backfilled:!1},z[new o.OverscaledTileID(y.overscaledZ,y.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},z[new o.OverscaledTileID(y.overscaledZ,N,a.z,T,a.y+1).key]={backfilled:!1}),z}unloadTile(y){y.demTexture&&this.map.painter.saveTileTexture(y.demTexture),y.fbo&&(y.fbo.destroy(),delete y.fbo),y.dem&&delete y.dem,delete y.neighboringTiles,y.state="unloaded"}},geojson:class extends o.Evented{constructor(y,a,f,v){super(),this.id=y,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=f.getActor(),this.setEventedParent(v),this._data=a.data,this._options=o.extend({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const S=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(a.buffer!==void 0?a.buffer:128)*S,tolerance:(a.tolerance!==void 0?a.tolerance:.375)*S,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:a.clusterMaxZoom!==void 0?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:o.EXTENT,radius:(a.clusterRadius!==void 0?a.clusterRadius:50)*S,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions)}onAdd(y){this.map=y,this.setData(this._data)}setData(y){return this._data=y,this._updateWorkerData(),this}getClusterExpansionZoom(y,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:y,source:this.id},a),this}getClusterChildren(y,a){return this.actor.send("geojson.getClusterChildren",{clusterId:y,source:this.id},a),this}getClusterLeaves(y,a,f,v){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:y,limit:a,offset:f},v),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.Event("dataloading",{dataType:"source"})),this._loaded=!1;const y=o.extend({},this.workerOptions),a=this._data;typeof a=="string"?(y.request=this.map._requestManager.transformRequest(o.exported.resolveURL(a),o.ResourceType.Source),y.request.collectResourceTiming=this._collectResourceTiming):y.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,y,((f,v)=>{if(this._loaded=!0,this._pendingLoad=null,f)this.fire(new o.ErrorEvent(f));else{const S={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(S.resourceTiming=v.resourceTiming[this.id]),this.fire(new o.Event("data",S)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)}))}loaded(){return this._loaded}loadTile(y,a){const f=y.actor?"reloadTile":"loadTile";y.actor=this.actor,y.request=this.actor.send(f,{type:this.type,uid:y.uid,tileID:y.tileID,tileZoom:y.tileZoom,zoom:y.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},((v,S)=>(delete y.request,y.unloadVectorData(),y.aborted?a(null):v?a(v):(y.loadVectorData(S,this.map.painter,f==="reloadTile"),a(null)))),void 0,f==="loadTile")}abortTile(y){y.request&&(y.request.cancel(),delete y.request),y.aborted=!0}unloadTile(y){y.unloadVectorData(),this.actor.send("removeTile",{uid:y.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Ir{constructor(y,a,f,v){super(y,a,f,v),this.roundZoom=!0,this.type="video",this.options=a}load(){this._loaded=!1;const y=this.options;this.urls=[];for(const a of y.urls)this.urls.push(this.map._requestManager.transformRequest(a,o.ResourceType.Source).url);o.getVideo(this.urls,((a,f)=>{this._loaded=!0,a?this.fire(new o.ErrorEvent(a)):f&&(this.video=f,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(y){if(this.video){const a=this.video.seekable;y<a.start(0)||y>a.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=y}}getVideo(){return this.video}onAdd(y){this.map||(this.map=y,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const y=this.map.painter.context,a=y.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(y,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(y)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Ir,canvas:class extends Ir{constructor(y,a,f,v){super(y,a,f,v),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some((S=>!Array.isArray(S)||S.length!==2||S.some((T=>typeof T!="number"))))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${y}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${y}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${y}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${y}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${y}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(y){this.map=y,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let y=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,y=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,y=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context;this.texture?(y||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(a,this.canvas,a.gl.RGBA,{premultiply:!0}),this._prepareData(a)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const y of[this.canvas.width,this.canvas.height])if(isNaN(y)||y<=0)return!0;return!1}},custom:class extends o.Evented{constructor(y,a,f,v){super(),this.id=y,this.type="custom",this._dataType="raster",this._dispatcher=f,this._implementation=a,this.setEventedParent(v),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new dt(this._implementation.bounds,this.minzoom,this.maxzoom)),a.update=this._update.bind(this),a.clearTiles=this._clearTiles.bind(this),a.coveringTiles=this._coveringTiles.bind(this),o.extend(this,o.pick(a,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(y){this._map=y,this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(y),this.load()}onRemove(y){this._implementation.onRemove&&this._implementation.onRemove(y)}hasTile(y){if(this._implementation.hasTile){const{x:a,y:f,z:v}=y.canonical;return this._implementation.hasTile({x:a,y:f,z:v})}return!this.tileBounds||this.tileBounds.contains(y.canonical)}loadTile(y,a){const{x:f,y:v,z:S}=y.tileID.canonical,T=new o.window.AbortController;y.request=Promise.resolve(this._implementation.loadTile({x:f,y:v,z:S},{signal:T.signal})).then((function(N){return delete y.request,y.aborted?(y.state="unloaded",a(null)):N===void 0?(y.state="errored",a(null)):N===null?(this.loadTileData(y,{width:this.tileSize,height:this.tileSize,data:null}),y.state="loaded",a(null)):(function(z){return z instanceof o.window.ImageData||z instanceof o.window.HTMLCanvasElement||z instanceof o.window.ImageBitmap||z instanceof o.window.HTMLImageElement})(N)?(this.loadTileData(y,N),y.state="loaded",void a(null)):(y.state="errored",a(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch((N=>{N.code!==20&&(y.state="errored",a(N))})),y.request.cancel=()=>T.abort()}loadTileData(y,a){An.loadTileData(y,a,this._map.painter)}unloadTileData(y){An.unloadTileData(y,this._map.painter)}unloadTile(y,a){if(this.unloadTileData(y),this._implementation.unloadTile){const{x:f,y:v,z:S}=y.tileID.canonical;this._implementation.unloadTile({x:f,y:v,z:S})}a()}abortTile(y,a){y.request&&y.request.cancel&&(y.request.cancel(),delete y.request),a()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((y=>({x:y.canonical.x,y:y.canonical.y,z:y.canonical.z})))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}}},wr=function(y,a,f,v){const S=new zr[a.type](y,a,f,v);if(S.id!==y)throw new Error(`Expected Source id to be ${y} instead of ${S.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],S),S};function Ei(y,a){const f=o.identity([]);return o.scale(f,f,[.5*y.width,.5*-y.height,1]),o.translate(f,f,[1,-1,0]),o.multiply(f,f,y.calculateProjMatrix(a.toUnwrapped())),Float32Array.from(f)}function to(y,a,f,v,S,T,N,z=!1){const $=y.tilesIn(v,N,z);$.sort(Wo);const Q=[];for(const ge of $)Q.push({wrappedTileID:ge.tile.tileID.wrapped().key,queryResults:ge.tile.queryRenderedFeatures(a,f,y._state,ge,S,T,Ei(y.transform,ge.tile.tileID),z)});const te=(function(ge){const Ae={},Le={};for(const Ze of ge){const Ue=Ze.queryResults,Xe=Ze.wrappedTileID,_e=Le[Xe]=Le[Xe]||{};for(const Ge in Ue){const it=Ue[Ge],ot=_e[Ge]=_e[Ge]||{},bt=Ae[Ge]=Ae[Ge]||[];for(const wt of it)ot[wt.featureIndex]||(ot[wt.featureIndex]=!0,bt.push(wt))}}return Ae})(Q);for(const ge in te)te[ge].forEach((Ae=>{const Le=Ae.feature,Ze=Le.layer;Ze&&Ze.type!=="background"&&Ze.type!=="sky"&&(Le.source=Ze.source,Ze["source-layer"]&&(Le.sourceLayer=Ze["source-layer"]),Le.state=Le.id!==void 0?y.getFeatureState(Ze["source-layer"],Le.id):{})}));return te}function po(y,a){const f=y.getRenderableIds().map((T=>y.getTileByID(T))),v=[],S={};for(let T=0;T<f.length;T++){const N=f[T],z=N.tileID.canonical.key;S[z]||(S[z]=!0,N.querySourceFeatures(v,a))}return v}function Wo(y,a){const f=y.tileID,v=a.tileID;return f.overscaledZ-v.overscaledZ||f.canonical.y-v.canonical.y||f.wrap-v.wrap||f.canonical.x-v.canonical.x}function no(){return En.workerClass!=null?new En.workerClass:new o.window.Worker(En.workerUrl)}const _s="mapboxgl_preloaded_worker_pool";class ro{constructor(){this.active={}}acquire(a){if(!this.workers)for(this.workers=[];this.workers.length<ro.workerCount;)this.workers.push(new no);return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],this.numActive()===0&&(this.workers.forEach((f=>{f.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[_s]}numActive(){return Object.keys(this.active).length}}let Ps;function fa(){return Ps||(Ps=new ro),Ps}function Sl(y,a){const f={};for(const v in y)v!=="ref"&&(f[v]=y[v]);return o.refProperties.forEach((v=>{v in a&&(f[v]=a[v])})),f}function al(y){y=y.slice();const a=Object.create(null);for(let f=0;f<y.length;f++)a[y[f].id]=y[f];for(let f=0;f<y.length;f++)"ref"in y[f]&&(y[f]=Sl(y[f],a[y[f].ref]));return y}ro.workerCount=2;const Vi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Ql(y,a,f){f.push({command:Vi.addSource,args:[y,a[y]]})}function Pu(y,a,f){a.push({command:Vi.removeSource,args:[y]}),f[y]=!0}function So(y,a,f,v){Pu(y,f,v),Ql(y,a,f)}function mu(y,a,f){let v;for(v in y[f])if(y[f].hasOwnProperty(v)&&v!=="data"&&!w(y[f][v],a[f][v]))return!1;for(v in a[f])if(a[f].hasOwnProperty(v)&&v!=="data"&&!w(y[f][v],a[f][v]))return!1;return!0}function Ea(y,a,f,v,S,T){let N;for(N in a=a||{},y=y||{})y.hasOwnProperty(N)&&(w(y[N],a[N])||f.push({command:T,args:[v,N,a[N],S]}));for(N in a)a.hasOwnProperty(N)&&!y.hasOwnProperty(N)&&(w(y[N],a[N])||f.push({command:T,args:[v,N,a[N],S]}))}function Zo(y){return y.id}function Xa(y,a){return y[a.id]=a,y}class kl{constructor(a,f){this.reset(a,f)}reset(a,f){this.points=a||[],this._distances=[0];for(let v=1;v<this.points.length;v++)this._distances[v]=this._distances[v-1]+this.points[v].dist(this.points[v-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(this.points.length===1)return this.points[0];a=o.clamp(a,0,1);let f=1,v=this._distances[f];const S=a*this.paddedLength+this.padding;for(;v<S&&f<this._distances.length;)v=this._distances[++f];const T=f-1,N=this._distances[T],z=v-N,$=z>0?(S-N)/z:0;return this.points[T].mult(1-$).add(this.points[f].mult($))}}class ec{constructor(a,f,v){const S=this.boxCells=[],T=this.circleCells=[];this.xCellCount=Math.ceil(a/v),this.yCellCount=Math.ceil(f/v);for(let N=0;N<this.xCellCount*this.yCellCount;N++)S.push([]),T.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=f,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,f,v,S,T){this._forEachCell(f,v,S,T,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(f),this.bboxes.push(v),this.bboxes.push(S),this.bboxes.push(T)}insertCircle(a,f,v,S){this._forEachCell(f-S,v-S,f+S,v+S,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(f),this.circles.push(v),this.circles.push(S)}_insertBoxCell(a,f,v,S,T,N){this.boxCells[T].push(N)}_insertCircleCell(a,f,v,S,T,N){this.circleCells[T].push(N)}_query(a,f,v,S,T,N){if(v<0||a>this.width||S<0||f>this.height)return!T&&[];const z=[];if(a<=0&&f<=0&&this.width<=v&&this.height<=S){if(T)return!0;for(let $=0;$<this.boxKeys.length;$++)z.push({key:this.boxKeys[$],x1:this.bboxes[4*$],y1:this.bboxes[4*$+1],x2:this.bboxes[4*$+2],y2:this.bboxes[4*$+3]});for(let $=0;$<this.circleKeys.length;$++){const Q=this.circles[3*$],te=this.circles[3*$+1],ge=this.circles[3*$+2];z.push({key:this.circleKeys[$],x1:Q-ge,y1:te-ge,x2:Q+ge,y2:te+ge})}return N?z.filter(N):z}return this._forEachCell(a,f,v,S,this._queryCell,z,{hitTest:T,seenUids:{box:{},circle:{}}},N),T?z.length>0:z}_queryCircle(a,f,v,S,T){const N=a-v,z=a+v,$=f-v,Q=f+v;if(z<0||N>this.width||Q<0||$>this.height)return!S&&[];const te=[];return this._forEachCell(N,$,z,Q,this._queryCellCircle,te,{hitTest:S,circle:{x:a,y:f,radius:v},seenUids:{box:{},circle:{}}},T),S?te.length>0:te}query(a,f,v,S,T){return this._query(a,f,v,S,!1,T)}hitTest(a,f,v,S,T){return this._query(a,f,v,S,!0,T)}hitTestCircle(a,f,v,S){return this._queryCircle(a,f,v,!0,S)}_queryCell(a,f,v,S,T,N,z,$){const Q=z.seenUids,te=this.boxCells[T];if(te!==null){const Ae=this.bboxes;for(const Le of te)if(!Q.box[Le]){Q.box[Le]=!0;const Ze=4*Le;if(a<=Ae[Ze+2]&&f<=Ae[Ze+3]&&v>=Ae[Ze+0]&&S>=Ae[Ze+1]&&(!$||$(this.boxKeys[Le]))){if(z.hitTest)return N.push(!0),!0;N.push({key:this.boxKeys[Le],x1:Ae[Ze],y1:Ae[Ze+1],x2:Ae[Ze+2],y2:Ae[Ze+3]})}}}const ge=this.circleCells[T];if(ge!==null){const Ae=this.circles;for(const Le of ge)if(!Q.circle[Le]){Q.circle[Le]=!0;const Ze=3*Le;if(this._circleAndRectCollide(Ae[Ze],Ae[Ze+1],Ae[Ze+2],a,f,v,S)&&(!$||$(this.circleKeys[Le]))){if(z.hitTest)return N.push(!0),!0;{const Ue=Ae[Ze],Xe=Ae[Ze+1],_e=Ae[Ze+2];N.push({key:this.circleKeys[Le],x1:Ue-_e,y1:Xe-_e,x2:Ue+_e,y2:Xe+_e})}}}}}_queryCellCircle(a,f,v,S,T,N,z,$){const Q=z.circle,te=z.seenUids,ge=this.boxCells[T];if(ge!==null){const Le=this.bboxes;for(const Ze of ge)if(!te.box[Ze]){te.box[Ze]=!0;const Ue=4*Ze;if(this._circleAndRectCollide(Q.x,Q.y,Q.radius,Le[Ue+0],Le[Ue+1],Le[Ue+2],Le[Ue+3])&&(!$||$(this.boxKeys[Ze])))return N.push(!0),!0}}const Ae=this.circleCells[T];if(Ae!==null){const Le=this.circles;for(const Ze of Ae)if(!te.circle[Ze]){te.circle[Ze]=!0;const Ue=3*Ze;if(this._circlesCollide(Le[Ue],Le[Ue+1],Le[Ue+2],Q.x,Q.y,Q.radius)&&(!$||$(this.circleKeys[Ze])))return N.push(!0),!0}}}_forEachCell(a,f,v,S,T,N,z,$){const Q=this._convertToXCellCoord(a),te=this._convertToYCellCoord(f),ge=this._convertToXCellCoord(v),Ae=this._convertToYCellCoord(S);for(let Le=Q;Le<=ge;Le++)for(let Ze=te;Ze<=Ae;Ze++)if(T.call(this,a,f,v,S,this.xCellCount*Ze+Le,N,z,$))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,f,v,S,T,N){const z=S-a,$=T-f,Q=v+N;return Q*Q>z*z+$*$}_circleAndRectCollide(a,f,v,S,T,N,z){const $=(N-S)/2,Q=Math.abs(a-(S+$));if(Q>$+v)return!1;const te=(z-T)/2,ge=Math.abs(f-(T+te));if(ge>te+v)return!1;if(Q<=$||ge<=te)return!0;const Ae=Q-$,Le=ge-te;return Ae*Ae+Le*Le<=v*v}}const Aa={unknown:0,flipRequired:1,flipNotRequired:2},ra=Math.tan(85*Math.PI/180);function pn(y,a,f,v,S,T,N){const z=o.create();if(f)if(T.name==="globe"){const $=o.calculateGlobeLabelMatrix(S,a);o.multiply(z,z,$)}else{const $=q([],N);z[0]=$[0],z[1]=$[1],z[4]=$[2],z[5]=$[3],v||o.rotateZ(z,z,S.angle)}else o.multiply(z,S.labelPlaneMatrix,y);return z}function Yo(y,a,f,v,S,T,N){const z=pn(y,a,f,v,S,T,N);return T.name==="globe"&&f||(z[2]=z[6]=z[10]=z[14]=0),z}function ss(y,a,f,v,S,T,N){if(f){if(T.name==="globe"){const z=pn(y,a,f,v,S,T,N);return o.invert(z,z),o.multiply(z,y,z),z}{const z=o.clone(y),$=o.identity([]);return $[0]=N[0],$[1]=N[1],$[4]=N[2],$[5]=N[3],o.multiply(z,z,$),v||o.rotateZ(z,z,-S.angle),z}}return S.glCoordMatrix}function vi(y,a,f,v){const S=[y,a,f,1];f?o.transformMat4$1(S,S,v):xi(S,S,v);const T=S[3];return S[0]/=T,S[1]/=T,S[2]/=T,S}function gu(y,a){return Math.min(.5+y/a*.5,1.5)}function Za(y,a){const f=y[0]/y[3],v=y[1]/y[3];return f>=-a[0]&&f<=a[0]&&v>=-a[1]&&v<=a[1]}function Ya(y,a,f,v,S,T,N,z,$,Q){const te=f.transform,ge=v?y.textSizeData:y.iconSizeData,Ae=o.evaluateSizeForZoom(ge,f.transform.zoom),Le=te.projection.name==="globe",Ze=[256/f.width*2+1,256/f.height*2+1],Ue=v?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;Ue.clear();let Xe=null;Le&&(Xe=v?y.text.globeExtVertexArray:y.icon.globeExtVertexArray);const _e=y.lineVertexArray,Ge=v?y.text.placedSymbolArray:y.icon.placedSymbolArray,it=f.transform.width/f.transform.height;let ot,bt=!1;for(let wt=0;wt<Ge.length;wt++){const _t=Ge.get(wt),{numGlyphs:Pt,writingMode:kt}=_t;if(kt!==o.WritingMode.vertical||bt||ot===o.WritingMode.horizontal||(bt=!0),ot=kt,(_t.hidden||kt===o.WritingMode.vertical)&&!bt){Ta(Pt,Ue);continue}bt=!1;const jt=new o.Point(_t.tileAnchorX,_t.tileAnchorY);let{x:_n,y:Ut,z:cn}=te.projection.projectTilePoint(jt.x,jt.y,Q.canonical);if($){const[mr,sr,dr]=$(jt);_n+=mr,Ut+=sr,cn+=dr}const Wt=[_n,Ut,cn,1];if(o.transformMat4$1(Wt,Wt,a),!Za(Wt,Ze)){Ta(Pt,Ue);continue}const In=gu(f.transform.cameraToCenterDistance,Wt[3]),Bt=o.evaluateSizeForFeature(ge,Ae,_t),Yt=N?Bt/In:Bt*In,Tn=vi(_n,Ut,cn,S);if(Tn[3]<=0){Ta(Pt,Ue);continue}let bn={};const Rn=N?null:$,hr=er(_t,Yt,!1,z,a,S,T,y.glyphOffsetArray,_e,Ue,Xe,Tn,jt,bn,it,Rn,te.projection,Q,N);bt=hr.useVertical,Rn&&hr.needsFlipping&&(bn={}),(hr.notEnoughRoom||bt||hr.needsFlipping&&er(_t,Yt,!0,z,a,S,T,y.glyphOffsetArray,_e,Ue,Xe,Tn,jt,bn,it,Rn,te.projection,Q,N).notEnoughRoom)&&Ta(Pt,Ue)}v?(y.text.dynamicLayoutVertexBuffer.updateData(Ue),Xe&&y.text.globeExtVertexBuffer.updateData(Xe)):(y.icon.dynamicLayoutVertexBuffer.updateData(Ue),Xe&&y.icon.globeExtVertexBuffer.updateData(Xe))}function ll(y,a,f,v,S,T,N,z,$,Q,te,ge,Ae,Le,Ze,Ue){const{lineStartIndex:Xe,glyphStartIndex:_e,segment:Ge}=z,it=_e+z.numGlyphs,ot=Xe+z.lineLength,bt=a.getoffsetX(_e),wt=a.getoffsetX(it-1),_t=zs(y*bt,f,v,S,T,N,Ge,Xe,ot,$,Q,te,ge,Ae,!0,Le,Ze,Ue);if(!_t)return null;const Pt=zs(y*wt,f,v,S,T,N,Ge,Xe,ot,$,Q,te,ge,Ae,!0,Le,Ze,Ue);return Pt?{first:_t,last:Pt}:null}function ks(y,a,f,v){return y===o.WritingMode.horizontal&&Math.abs(v)>Math.abs(f)?{useVertical:!0}:y===o.WritingMode.vertical?v>0?{needsFlipping:!0}:null:a!==Aa.unknown&&(function(S,T){return S===0||Math.abs(T/S)>ra})(f,v)?a===Aa.flipRequired?{needsFlipping:!0}:null:f<0?{needsFlipping:!0}:null}function er(y,a,f,v,S,T,N,z,$,Q,te,ge,Ae,Le,Ze,Ue,Xe,_e,Ge){const it=a/24,ot=y.lineOffsetX*it,bt=y.lineOffsetY*it,{lineStartIndex:wt,glyphStartIndex:_t,numGlyphs:Pt,segment:kt,writingMode:jt,flipState:_n}=y,Ut=wt+y.lineLength,cn=Wt=>{if(te){const[Tn,bn,Rn]=Wt.up,hr=Q.length;o.updateGlobeVertexNormal(te,hr+0,Tn,bn,Rn),o.updateGlobeVertexNormal(te,hr+1,Tn,bn,Rn),o.updateGlobeVertexNormal(te,hr+2,Tn,bn,Rn),o.updateGlobeVertexNormal(te,hr+3,Tn,bn,Rn)}const[In,Bt,Yt]=Wt.point;o.addDynamicAttributes(Q,In,Bt,Yt,Wt.angle)};if(Pt>1){const Wt=ll(it,z,ot,bt,f,ge,Ae,y,$,T,Le,Ue,!1,Xe,_e,Ge);if(!Wt)return{notEnoughRoom:!0};if(v&&!f){let[In,Bt,Yt]=Wt.first.point,[Tn,bn,Rn]=Wt.last.point;[In,Bt]=vi(In,Bt,Yt,N),[Tn,bn]=vi(Tn,bn,Rn,N);const hr=ks(jt,_n,(Tn-In)*Ze,bn-Bt);if(y.flipState=hr&&hr.needsFlipping?Aa.flipRequired:Aa.flipNotRequired,hr)return hr}cn(Wt.first);for(let In=_t+1;In<_t+Pt-1;In++){const Bt=zs(it*z.getoffsetX(In),ot,bt,f,ge,Ae,kt,wt,Ut,$,T,Le,Ue,!1,!1,Xe,_e,Ge);if(!Bt)return Q.length-=4*(In-_t),{notEnoughRoom:!0};cn(Bt)}cn(Wt.last)}else{if(v&&!f){const In=vi(Ae.x,Ae.y,0,S),Bt=wt+kt+1,Yt=new o.Point($.getx(Bt),$.gety(Bt)),Tn=vi(Yt.x,Yt.y,0,S),bn=Tn[3]>0?Tn:Rr(Ae,Yt,In,1,S,void 0,Xe,_e.canonical),Rn=ks(jt,_n,(bn[0]-In[0])*Ze,bn[1]-In[1]);if(y.flipState=Rn&&Rn.needsFlipping?Aa.flipRequired:Aa.flipNotRequired,Rn)return Rn}const Wt=zs(it*z.getoffsetX(_t),ot,bt,f,ge,Ae,kt,wt,Ut,$,T,Le,Ue,!1,!1,Xe,_e,Ge);if(!Wt)return{notEnoughRoom:!0};cn(Wt)}return{}}function Fr(y,a,f,v,S){const{x:T,y:N,z}=v.projectTilePoint(y.x,y.y,a);if(!S)return vi(T,N,z,f);const[$,Q,te]=S(y);return vi(T+$,N+Q,z+te,f)}function Rr(y,a,f,v,S,T,N,z){const $=Fr(y.sub(a)._unit()._add(y),z,S,N,T);return o.sub($,f,$),o.normalize($,$),o.scaleAndAdd($,f,$,v)}function zs(y,a,f,v,S,T,N,z,$,Q,te,ge,Ae,Le,Ze,Ue,Xe,_e){const Ge=v?y-a:y+a;let it=Ge>0?1:-1,ot=0;v&&(it*=-1,ot=Math.PI),it<0&&(ot+=Math.PI);let bt=z+N+(it>0?0:1)|0,wt=S,_t=S,Pt=0,kt=0;const jt=Math.abs(Ge),_n=[],Ut=[];let cn=T,Wt=cn;const In=()=>Rr(Wt,cn,_t,jt-Pt+1,te,Ae,Ue,Xe.canonical);for(;Pt+kt<=jt;){if(bt+=it,bt<z||bt>=$)return null;if(_t=wt,Wt=cn,_n.push(_t),Le&&Ut.push(Wt),cn=new o.Point(Q.getx(bt),Q.gety(bt)),wt=ge[bt],!wt){const dr=Fr(cn,Xe.canonical,te,Ue,Ae);wt=dr[3]>0?ge[bt]=dr:In()}Pt+=kt,kt=o.distance(_t,wt)}Ze&&Ae&&(ge[bt]&&(wt=In(),kt=o.distance(_t,wt)),ge[bt]=wt);const Bt=(jt-Pt)/kt,Yt=cn.sub(Wt)._mult(Bt)._add(Wt),Tn=o.sub([],wt,_t),bn=o.scaleAndAdd([],_t,Tn,Bt);let Rn=[0,0,1],hr=Tn[0],mr=Tn[1];if(_e&&(Rn=Ue.upVector(Xe.canonical,Yt.x,Yt.y),Rn[0]!==0||Rn[1]!==0||Rn[2]!==1)){const dr=[Rn[2],0,-Rn[0]],oi=o.cross([],Rn,dr);o.normalize(dr,dr),o.normalize(oi,oi),hr=o.dot(Tn,dr),mr=o.dot(Tn,oi)}if(f){const dr=o.cross([],Rn,Tn);o.normalize(dr,dr),o.scaleAndAdd(bn,bn,dr,f*it)}const sr=ot+Math.atan2(mr,hr);return _n.push(bn),Le&&Ut.push(Yt),{point:bn,angle:sr,path:_n,tilePath:Ut,up:Rn}}function Ta(y,a){const f=a.length,v=f+4*y;a.resize(v),a.float32.fill(-1/0,4*f,4*v)}function xi(y,a,f){const v=a[0],S=a[1];return y[0]=f[0]*v+f[4]*S+f[12],y[1]=f[1]*v+f[5]*S+f[13],y[3]=f[3]*v+f[7]*S+f[15],y}const Mi=100;class El{constructor(a,f,v=new ec(a.width+200,a.height+200,25),S=new ec(a.width+200,a.height+200,25)){this.transform=a,this.grid=v,this.ignoredGrid=S,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+Mi,this.screenBottomBoundary=a.height+Mi,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.fogState=f}placeCollisionBox(a,f,v,S,T,N,z,$){let Q=v.projectedAnchorX,te=v.projectedAnchorY,ge=v.projectedAnchorZ;const Ae=v.elevation,Le=v.tileID,Ze=a.getProjection();if(Ae&&Le){const[wt,_t,Pt]=Ze.upVector(Le.canonical,v.tileAnchorX,v.tileAnchorY),kt=Ze.upVectorScale(Le.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;Q+=wt*Ae*kt,te+=_t*Ae*kt,ge+=Pt*Ae*kt}const Ue=this.projectAndGetPerspectiveRatio(z,Q,te,ge,v.tileID,Ze.name==="globe"||!!Ae||this.transform.pitch>0,Ze),Xe=N*Ue.perspectiveRatio,_e=(v.x1*f+S.x-v.padding)*Xe+Ue.point.x,Ge=(v.y1*f+S.y-v.padding)*Xe+Ue.point.y,it=(v.x2*f+S.x+v.padding)*Xe+Ue.point.x,ot=(v.y2*f+S.y+v.padding)*Xe+Ue.point.y,bt=Ue.perspectiveRatio<=.55||Ue.occluded;return!this.isInsideGrid(_e,Ge,it,ot)||!T&&this.grid.hitTest(_e,Ge,it,ot,$)||bt?{box:[],offscreen:!1,occluded:Ue.occluded}:{box:[_e,Ge,it,ot],offscreen:this.isOffscreen(_e,Ge,it,ot),occluded:!1}}placeCollisionCircles(a,f,v,S,T,N,z,$,Q,te,ge,Ae,Le,Ze,Ue){const Xe=[],_e=this.transform.elevation,Ge=a.getProjection(),it=_e?_e.getAtTileOffsetFunc(Ue,this.transform.center.lat,this.transform.worldSize,Ge):null,ot=new o.Point(v.tileAnchorX,v.tileAnchorY);let{x:bt,y:wt,z:_t}=Ge.projectTilePoint(ot.x,ot.y,Ue.canonical);if(it){const[Yt,Tn,bn]=it(ot);bt+=Yt,wt+=Tn,_t+=bn}const Pt=Ge.name==="globe",kt=this.projectAndGetPerspectiveRatio(z,bt,wt,_t,Ue,Pt||!!_e||this.transform.pitch>0,Ge),{perspectiveRatio:jt}=kt,_n=(ge?N/jt:N*jt)/o.ONE_EM,Ut=vi(bt,wt,_t,$),cn=kt.signedDistanceFromCamera>0?ll(_n,T,v.lineOffsetX*_n,v.lineOffsetY*_n,!1,Ut,ot,v,S,$,{},_e&&!ge?it:null,ge&&!!_e,Ge,Ue,ge):null;let Wt=!1,In=!1,Bt=!0;if(cn&&!kt.occluded){const Yt=.5*Le*jt+Ze,Tn=new o.Point(-100,-100),bn=new o.Point(this.screenRightBoundary,this.screenBottomBoundary),Rn=new kl,{first:hr,last:mr}=cn,sr=hr.path.length;let dr=[];for(let _r=sr-1;_r>=1;_r--)dr.push(hr.path[_r]);for(let _r=1;_r<mr.path.length;_r++)dr.push(mr.path[_r]);const oi=2.5*Yt;Q&&(dr=dr.map((([_r,Zr,Pi],io)=>(it&&!Pt&&(Pi=it(io<sr-1?hr.tilePath[sr-1-io]:mr.tilePath[io-sr+2])[2]),vi(_r,Zr,Pi,Q)))),dr.some((_r=>_r[3]<=0))&&(dr=[]));let di=[];if(dr.length>0){let _r=1/0,Zr=-1/0,Pi=1/0,io=-1/0;for(const oo of dr)_r=Math.min(_r,oo[0]),Pi=Math.min(Pi,oo[1]),Zr=Math.max(Zr,oo[0]),io=Math.max(io,oo[1]);Zr>=Tn.x&&_r<=bn.x&&io>=Tn.y&&Pi<=bn.y&&(di=[dr.map((oo=>new o.Point(oo[0],oo[1])))],(_r<Tn.x||Zr>bn.x||Pi<Tn.y||io>bn.y)&&(di=o.clipLine(di,Tn.x,Tn.y,bn.x,bn.y)))}for(const _r of di){Rn.reset(_r,.25*Yt);let Zr=0;Zr=Rn.length<=.5*Yt?1:Math.ceil(Rn.paddedLength/oi)+1;for(let Pi=0;Pi<Zr;Pi++){const io=Pi/Math.max(Zr-1,1),oo=Rn.lerp(io),ua=oo.x+Mi,us=oo.y+Mi;Xe.push(ua,us,Yt,0);const uc=ua-Yt,Pc=us-Yt,Ci=ua+Yt,Qi=us+Yt;if(Bt=Bt&&this.isOffscreen(uc,Pc,Ci,Qi),In=In||this.isInsideGrid(uc,Pc,Ci,Qi),!f&&this.grid.hitTestCircle(ua,us,Yt,Ae)&&(Wt=!0,!te))return{circles:[],offscreen:!1,collisionDetected:Wt,occluded:!1}}}}return{circles:!te&&Wt||!In?[]:Xe,offscreen:Bt,collisionDetected:Wt,occluded:kt.occluded}}queryRenderedSymbols(a){if(a.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const f=[];let v=1/0,S=1/0,T=-1/0,N=-1/0;for(const te of a){const ge=new o.Point(te.x+Mi,te.y+Mi);v=Math.min(v,ge.x),S=Math.min(S,ge.y),T=Math.max(T,ge.x),N=Math.max(N,ge.y),f.push(ge)}const z=this.grid.query(v,S,T,N).concat(this.ignoredGrid.query(v,S,T,N)),$={},Q={};for(const te of z){const ge=te.key;if($[ge.bucketInstanceId]===void 0&&($[ge.bucketInstanceId]={}),$[ge.bucketInstanceId][ge.featureIndex])continue;const Ae=[new o.Point(te.x1,te.y1),new o.Point(te.x2,te.y1),new o.Point(te.x2,te.y2),new o.Point(te.x1,te.y2)];o.polygonIntersectsPolygon(f,Ae)&&($[ge.bucketInstanceId][ge.featureIndex]=!0,Q[ge.bucketInstanceId]===void 0&&(Q[ge.bucketInstanceId]=[]),Q[ge.bucketInstanceId].push(ge.featureIndex))}return Q}insertCollisionBox(a,f,v,S,T){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:S,collisionGroupID:T},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,f,v,S,T){const N=f?this.ignoredGrid:this.grid,z={bucketInstanceId:v,featureIndex:S,collisionGroupID:T};for(let $=0;$<a.length;$+=4)N.insertCircle(z,a[$],a[$+1],a[$+2])}projectAndGetPerspectiveRatio(a,f,v,S,T,N,z){const $=[f,v,S,1];let Q=!1;S||this.transform.pitch>0?(o.transformMat4$1($,$,a),this.fogState&&T&&z.name!=="globe"&&(Q=(function(Ae,Le,Ze,Ue,Xe,_e){const Ge=_e.calculateFogTileMatrix(Xe),it=[Le,Ze,Ue];return o.transformMat4(it,it,Ge),Re(Ae,it,_e.pitch,_e._fov)})(this.fogState,f,v,S,T.toUnwrapped(),this.transform)>.9)):xi($,$,a);const te=$[3];return{point:new o.Point(($[0]/te+1)/2*this.transform.width+Mi,(-$[1]/te+1)/2*this.transform.height+Mi),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(z)/te*.5,1.5),signedDistanceFromCamera:te,occluded:N&&$[2]>te||Q}}isOffscreen(a,f,v,S){return v<Mi||a>=this.screenRightBoundary||S<Mi||f>this.screenBottomBoundary}isInsideGrid(a,f,v,S){return v>=0&&a<this.gridRightBoundary&&S>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const a=o.identity([]);return o.translate(a,a,[-100,-100,0]),a}}function ji(y,a,f){const v=a.createTileMatrix(y,y.worldSize,f.toUnwrapped());return o.multiply(new Float32Array(16),y.projMatrix,v)}function fs(y,a,f){if(a.projection.name===f.projection.name)return y.projMatrix;const v=f.clone();return v.setProjection(a.projection),ji(v,a.getProjection(),y)}function Fi(y,a,f){return a.name===f.projection.name?y.projMatrix:ji(f,a,y)}class yu{constructor(a,f,v,S){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?f:-f))):S&&v?1:0,this.placed=v}isHidden(){return this.opacity===0&&!this.placed}}class tc{constructor(a,f,v,S,T,N=!1){this.text=new yu(a?a.text:null,f,v,T),this.icon=new yu(a?a.icon:null,f,S,T),this.clipped=N}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class eu{constructor(a,f,v,S=!1){this.text=a,this.icon=f,this.skipFade=v,this.clipped=S}}class bc{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class nc{constructor(a,f,v,S,T){this.bucketInstanceId=a,this.featureIndex=f,this.sourceLayerIndex=v,this.bucketIndex=S,this.tileID=T}}class Da{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const f=++this.maxGroupID;this.collisionGroups[a]={ID:f,predicate:v=>v.collisionGroupID===f}}return this.collisionGroups[a]}}function Ms(y,a,f,v,S){const{horizontalAlign:T,verticalAlign:N}=o.getAnchorAlignment(y),z=-(T-.5)*a,$=-(N-.5)*f,Q=o.evaluateVariableOffset(y,v);return new o.Point(z+Q[0]*S,$+Q[1]*S)}function Oi(y,a,f,v,S){const T=new o.Point(y,a);return f&&T._rotate(v?S:-S),T}class Fa{constructor(a,f,v,S,T){this.transform=a.clone(),this.projection=a.projection.name,this.collisionIndex=new El(this.transform,T),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new Da(v),this.collisionCircleArrays={},this.prevPlacement=S,S&&(S.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,f,v,S){const T=v.getBucket(f),N=v.latestFeatureIndex;if(!T||!N||f.id!==T.layerIds[0])return;const z=T.layers[0].layout,$=v.collisionBoxArray,Q=Math.pow(2,this.transform.zoom-v.tileID.overscaledZ),te=v.tileSize/o.EXTENT,ge=v.tileID.toUnwrapped();this.transform.setProjection(T.projection);const Ae=(Le=v.tileID,Ze=T.getProjection(),Ue=this.transform,Ze.name===this.projection?Ue.calculateProjMatrix(Le.toUnwrapped()):ji(Ue,Ze,Le));var Le,Ze,Ue;const Xe=z.get("text-pitch-alignment")==="map",_e=z.get("text-rotation-alignment")==="map";f.compileFilter();const Ge=f.dynamicFilter(),it=f.dynamicFilterNeedsFeature(),ot=this.transform.calculatePixelsToTileUnitsMatrix(v),bt=Yo(Ae,v.tileID.canonical,Xe,_e,this.transform,T.getProjection(),ot);let wt=null;if(Xe){const kt=ss(Ae,v.tileID.canonical,Xe,_e,this.transform,T.getProjection(),ot);wt=o.multiply([],this.transform.labelPlaneMatrix,kt)}let _t=null;Ge&&v.latestFeatureIndex&&(_t={unwrappedTileID:ge,dynamicFilter:Ge,dynamicFilterNeedsFeature:it,featureIndex:v.latestFeatureIndex}),this.retainedQueryData[T.bucketInstanceId]=new nc(T.bucketInstanceId,N,T.sourceLayerIndex,T.index,v.tileID);const Pt={bucket:T,layout:z,posMatrix:Ae,textLabelPlaneMatrix:bt,labelToScreenMatrix:wt,clippingData:_t,scale:Q,textPixelRatio:te,holdingForFade:v.holdingForFade(),collisionBoxArray:$,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(T.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.evaluateSizeForZoom(T.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(T.sourceID)};if(S)for(const kt of T.sortKeyRanges){const{sortKey:jt,symbolInstanceStart:_n,symbolInstanceEnd:Ut}=kt;a.push({sortKey:jt,symbolInstanceStart:_n,symbolInstanceEnd:Ut,parameters:Pt})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:Pt})}attemptAnchorPlacement(a,f,v,S,T,N,z,$,Q,te,ge,Ae,Le,Ze,Ue,Xe,_e,Ge){const{textOffset0:it,textOffset1:ot,crossTileID:bt}=Ae,wt=[it,ot],_t=Ms(a,v,S,wt,T),Pt=this.collisionIndex.placeCollisionBox(Ze,T,f,Oi(_t.x,_t.y,N,z,this.transform.angle),ge,$,Q,te.predicate);if(Xe){const kt=Ze.getSymbolInstanceIconSize(Ge,this.transform.zoom,Ae.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Ze,kt,Xe,Oi(_t.x,_t.y,N,z,this.transform.angle),ge,$,Q,te.predicate).box.length===0)return}if(Pt.box.length>0){let kt;return this.prevPlacement&&this.prevPlacement.variableOffsets[bt]&&this.prevPlacement.placements[bt]&&this.prevPlacement.placements[bt].text&&(kt=this.prevPlacement.variableOffsets[bt].anchor),this.variableOffsets[bt]={textOffset:wt,width:v,height:S,anchor:a,textScale:T,prevAnchor:kt},this.markUsedJustification(Ze,a,Ae,Ue),Ze.allowVerticalPlacement&&(this.markUsedOrientation(Ze,Ue,Ae),this.placedOrientations[bt]=Ue),{shift:_t,placedGlyphBoxes:Pt}}}placeLayerBucketPart(a,f,v,S){const{bucket:T,layout:N,posMatrix:z,textLabelPlaneMatrix:$,labelToScreenMatrix:Q,clippingData:te,textPixelRatio:ge,holdingForFade:Ae,collisionBoxArray:Le,partiallyEvaluatedTextSize:Ze,partiallyEvaluatedIconSize:Ue,collisionGroup:Xe}=a.parameters,_e=N.get("text-optional"),Ge=N.get("icon-optional"),it=N.get("text-allow-overlap"),ot=N.get("icon-allow-overlap"),bt=N.get("text-rotation-alignment")==="map",wt=N.get("text-pitch-alignment")==="map",_t=N.get("icon-text-fit")!=="none",Pt=N.get("symbol-z-order")==="viewport-y";this.transform.setProjection(T.projection);let kt=it&&(ot||!T.hasIconData()||Ge),jt=ot&&(it||!T.hasTextData()||_e);!T.collisionArrays&&Le&&T.deserializeCollisionBoxes(Le),v&&S&&T.updateCollisionDebugBuffers(this.transform.zoom,Le);const _n=(Ut,cn,Wt)=>{const{crossTileID:In,numVerticalGlyphVertices:Bt}=Ut;if(te){const Ci={zoom:this.transform.zoom,pitch:this.transform.pitch};let Qi=null;if(te.dynamicFilterNeedsFeature){const bo=this.retainedQueryData[T.bucketInstanceId];Qi=te.featureIndex.loadFeature({featureIndex:Ut.featureIndex,bucketIndex:bo.bucketIndex,sourceLayerIndex:bo.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,te.dynamicFilter)(Ci,Qi,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new o.Point(Ut.tileAnchorX,Ut.tileAnchorY),this.transform.calculateDistanceTileData(te.unwrappedTileID)))return this.placements[In]=new eu(!1,!1,!1,!0),void f.add(In)}if(f.has(In))return;if(Ae)return void(this.placements[In]=new eu(!1,!1,!1));let Yt=!1,Tn=!1,bn=!0,Rn=!1,hr=!1,mr=null,sr={box:null,offscreen:null,occluded:null},dr={box:null},oi=null,di=null,_r=null,Zr=0,Pi=0,io=0;Wt.textFeatureIndex?Zr=Wt.textFeatureIndex:Ut.useRuntimeCollisionCircles&&(Zr=Ut.featureIndex),Wt.verticalTextFeatureIndex&&(Pi=Wt.verticalTextFeatureIndex);const oo=Ci=>{Ci.tileID=this.retainedQueryData[T.bucketInstanceId].tileID;const Qi=this.transform.elevation;(Qi||Ci.elevation)&&(Ci.elevation=Qi?Qi.getAtTileOffset(Ci.tileID,Ci.tileAnchorX,Ci.tileAnchorY):0)},ua=Wt.textBox;if(ua){oo(ua);const Ci=bo=>{let Ts=o.WritingMode.horizontal;if(T.allowVerticalPlacement&&!bo&&this.prevPlacement){const Va=this.prevPlacement.placedOrientations[In];Va&&(this.placedOrientations[In]=Va,Ts=Va,this.markUsedOrientation(T,Ts,Ut))}return Ts},Qi=(bo,Ts)=>{if(T.allowVerticalPlacement&&Bt>0&&Wt.verticalTextBox){for(const Va of T.writingModes)if(Va===o.WritingMode.vertical?(sr=Ts(),dr=sr):sr=bo(),sr&&sr.box&&sr.box.length)break}else sr=bo()};if(N.get("text-variable-anchor")){let bo=N.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[In]){const ts=this.prevPlacement.variableOffsets[In];bo.indexOf(ts.anchor)>0&&(bo=bo.filter((ps=>ps!==ts.anchor)),bo.unshift(ts.anchor))}const Ts=(ts,ps,hs)=>{const bs=T.getSymbolInstanceTextSize(Ze,Ut,this.transform.zoom,cn),zo=(ts.x2-ts.x1)*bs+2*ts.padding,ql=(ts.y2-ts.y1)*bs+2*ts.padding,Il=_t&&!ot?ps:null;Il&&oo(Il);let Gc={box:[],offscreen:!1,occluded:!1};const _d=it?2*bo.length:bo.length;for(let Xs=0;Xs<_d;++Xs){const jh=this.attemptAnchorPlacement(bo[Xs%bo.length],ts,zo,ql,bs,bt,wt,ge,z,Xe,Xs>=bo.length,Ut,cn,T,hs,Il,Ze,Ue);if(jh&&(Gc=jh.placedGlyphBoxes,Gc&&Gc.box&&Gc.box.length)){Yt=!0,mr=jh.shift;break}}return Gc};Qi((()=>Ts(ua,Wt.iconBox,o.WritingMode.horizontal)),(()=>{const ts=Wt.verticalTextBox;return ts&&oo(ts),T.allowVerticalPlacement&&!(sr&&sr.box&&sr.box.length)&&Bt>0&&ts?Ts(ts,Wt.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null,occluded:null}})),sr&&(Yt=sr.box,bn=sr.offscreen,Rn=sr.occluded);const Va=Ci(!(!sr||!sr.box));if(!Yt&&this.prevPlacement){const ts=this.prevPlacement.variableOffsets[In];ts&&(this.variableOffsets[In]=ts,this.markUsedJustification(T,ts.anchor,Ut,Va))}}else{const bo=(Ts,Va)=>{const ts=T.getSymbolInstanceTextSize(Ze,Ut,this.transform.zoom,cn),ps=this.collisionIndex.placeCollisionBox(T,ts,Ts,new o.Point(0,0),it,ge,z,Xe.predicate);return ps&&ps.box&&ps.box.length&&(this.markUsedOrientation(T,Va,Ut),this.placedOrientations[In]=Va),ps};Qi((()=>bo(ua,o.WritingMode.horizontal)),(()=>{const Ts=Wt.verticalTextBox;return T.allowVerticalPlacement&&Bt>0&&Ts?(oo(Ts),bo(Ts,o.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}})),Ci(!!(sr&&sr.box&&sr.box.length))}}if(oi=sr,Yt=oi&&oi.box&&oi.box.length>0,bn=oi&&oi.offscreen,Rn=oi&&oi.occluded,Ut.useRuntimeCollisionCircles){const Ci=T.text.placedSymbolArray.get(Ut.centerJustifiedTextSymbolIndex>=0?Ut.centerJustifiedTextSymbolIndex:Ut.verticalPlacedTextSymbolIndex),Qi=o.evaluateSizeForFeature(T.textSizeData,Ze,Ci),bo=N.get("text-padding");di=this.collisionIndex.placeCollisionCircles(T,it,Ci,T.lineVertexArray,T.glyphOffsetArray,Qi,z,$,Q,v,wt,Xe.predicate,Ut.collisionCircleDiameter*Qi/o.ONE_EM,bo,this.retainedQueryData[T.bucketInstanceId].tileID),Yt=it||di.circles.length>0&&!di.collisionDetected,bn=bn&&di.offscreen,Rn=di.occluded}if(Wt.iconFeatureIndex&&(io=Wt.iconFeatureIndex),Wt.iconBox){const Ci=Qi=>{oo(Qi);const bo=_t&&mr?Oi(mr.x,mr.y,bt,wt,this.transform.angle):new o.Point(0,0),Ts=T.getSymbolInstanceIconSize(Ue,this.transform.zoom,Ut.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(T,Ts,Qi,bo,ot,ge,z,Xe.predicate)};dr&&dr.box&&dr.box.length&&Wt.verticalIconBox?(_r=Ci(Wt.verticalIconBox),Tn=_r.box.length>0):(_r=Ci(Wt.iconBox),Tn=_r.box.length>0),bn=bn&&_r.offscreen,hr=_r.occluded}const us=_e||Ut.numHorizontalGlyphVertices===0&&Bt===0,uc=Ge||Ut.numIconVertices===0;if(us||uc?uc?us||(Tn=Tn&&Yt):Yt=Tn&&Yt:Tn=Yt=Tn&&Yt,Yt&&oi&&oi.box&&this.collisionIndex.insertCollisionBox(oi.box,N.get("text-ignore-placement"),T.bucketInstanceId,dr&&dr.box&&Pi?Pi:Zr,Xe.ID),Tn&&_r&&this.collisionIndex.insertCollisionBox(_r.box,N.get("icon-ignore-placement"),T.bucketInstanceId,io,Xe.ID),di&&(Yt&&this.collisionIndex.insertCollisionCircles(di.circles,N.get("text-ignore-placement"),T.bucketInstanceId,Zr,Xe.ID),v)){const Ci=T.bucketInstanceId;let Qi=this.collisionCircleArrays[Ci];Qi===void 0&&(Qi=this.collisionCircleArrays[Ci]=new bc);for(let bo=0;bo<di.circles.length;bo+=4)Qi.circles.push(di.circles[bo+0]),Qi.circles.push(di.circles[bo+1]),Qi.circles.push(di.circles[bo+2]),Qi.circles.push(di.collisionDetected?1:0)}const Pc=T.projection.name!=="globe";kt=kt&&(Pc||!Rn),jt=jt&&(Pc||!hr),this.placements[In]=new eu(Yt||kt,Tn||jt,bn||T.justReloaded),f.add(In)};if(Pt){const Ut=T.getSortedSymbolIndexes(this.transform.angle);for(let cn=Ut.length-1;cn>=0;--cn){const Wt=Ut[cn];_n(T.symbolInstances.get(Wt),Wt,T.collisionArrays[Wt])}}else for(let Ut=a.symbolInstanceStart;Ut<a.symbolInstanceEnd;Ut++)_n(T.symbolInstances.get(Ut),Ut,T.collisionArrays[Ut]);if(v&&T.bucketInstanceId in this.collisionCircleArrays){const Ut=this.collisionCircleArrays[T.bucketInstanceId];o.invert(Ut.invProjMatrix,z),Ut.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(a,f,v,S){const{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:N,rightJustifiedTextSymbolIndex:z,verticalPlacedTextSymbolIndex:$,crossTileID:Q}=v,te=o.getAnchorJustification(f),ge=S===o.WritingMode.vertical?$:te==="left"?T:te==="center"?N:te==="right"?z:-1;T>=0&&(a.text.placedSymbolArray.get(T).crossTileID=ge>=0&&T!==ge?0:Q),N>=0&&(a.text.placedSymbolArray.get(N).crossTileID=ge>=0&&N!==ge?0:Q),z>=0&&(a.text.placedSymbolArray.get(z).crossTileID=ge>=0&&z!==ge?0:Q),$>=0&&(a.text.placedSymbolArray.get($).crossTileID=ge>=0&&$!==ge?0:Q)}markUsedOrientation(a,f,v){const S=f===o.WritingMode.horizontal||f===o.WritingMode.horizontalOnly?f:0,T=f===o.WritingMode.vertical?f:0,{leftJustifiedTextSymbolIndex:N,centerJustifiedTextSymbolIndex:z,rightJustifiedTextSymbolIndex:$,verticalPlacedTextSymbolIndex:Q}=v,te=a.text.placedSymbolArray;N>=0&&(te.get(N).placedOrientation=S),z>=0&&(te.get(z).placedOrientation=S),$>=0&&(te.get($).placedOrientation=S),Q>=0&&(te.get(Q).placedOrientation=T)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let v=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const S=f?f.symbolFadeChange(a):1,T=f?f.opacities:{},N=f?f.variableOffsets:{},z=f?f.placedOrientations:{};for(const $ in this.placements){const Q=this.placements[$],te=T[$];te?(this.opacities[$]=new tc(te,S,Q.text,Q.icon,null,Q.clipped),v=v||Q.text!==te.text.placed||Q.icon!==te.icon.placed):(this.opacities[$]=new tc(null,S,Q.text,Q.icon,Q.skipFade,Q.clipped),v=v||Q.text||Q.icon)}for(const $ in T){const Q=T[$];if(!this.opacities[$]){const te=new tc(Q,S,!1,!1);te.isHidden()||(this.opacities[$]=te,v=v||Q.text.placed||Q.icon.placed)}}for(const $ in N)this.variableOffsets[$]||!this.opacities[$]||this.opacities[$].isHidden()||(this.variableOffsets[$]=N[$]);for(const $ in z)this.placedOrientations[$]||!this.opacities[$]||this.opacities[$].isHidden()||(this.placedOrientations[$]=z[$]);v?this.lastPlacementChangeTime=a:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:a)}updateLayerOpacities(a,f){const v=new Set;for(const S of f){const T=S.getBucket(a);T&&S.latestFeatureIndex&&a.id===T.layerIds[0]&&this.updateBucketOpacities(T,v,S.collisionBoxArray)}}updateBucketOpacities(a,f,v){a.hasTextData()&&a.text.opacityVertexArray.clear(),a.hasIconData()&&a.icon.opacityVertexArray.clear(),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const S=a.layers[0].layout,T=!!a.layers[0].dynamicFilter(),N=new tc(null,0,!1,!1,!0),z=S.get("text-allow-overlap"),$=S.get("icon-allow-overlap"),Q=S.get("text-variable-anchor"),te=S.get("text-rotation-alignment")==="map",ge=S.get("text-pitch-alignment")==="map",Ae=S.get("icon-text-fit")!=="none",Le=new tc(null,0,z&&($||!a.hasIconData()||S.get("icon-optional")),$&&(z||!a.hasTextData()||S.get("text-optional")),!0);!a.collisionArrays&&v&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(v);const Ze=(Xe,_e,Ge)=>{for(let it=0;it<_e/4;it++)Xe.opacityVertexArray.emplaceBack(Ge)};let Ue=0;for(let Xe=0;Xe<a.symbolInstances.length;Xe++){const _e=a.symbolInstances.get(Xe),{numHorizontalGlyphVertices:Ge,numVerticalGlyphVertices:it,crossTileID:ot,numIconVertices:bt}=_e,wt=f.has(ot);let _t=this.opacities[ot];wt?_t=N:_t||(_t=Le,this.opacities[ot]=_t),f.add(ot);const Pt=Ge>0||it>0,kt=bt>0,jt=this.placedOrientations[ot],_n=jt===o.WritingMode.vertical,Ut=jt===o.WritingMode.horizontal||jt===o.WritingMode.horizontalOnly;if(!Pt&&!kt||_t.isHidden()||Ue++,Pt){const cn=Ko(_t.text);Ze(a.text,Ge,_n?go:cn),Ze(a.text,it,Ut?go:cn);const Wt=_t.text.isHidden(),{leftJustifiedTextSymbolIndex:In,centerJustifiedTextSymbolIndex:Bt,rightJustifiedTextSymbolIndex:Yt,verticalPlacedTextSymbolIndex:Tn}=_e,bn=a.text.placedSymbolArray,Rn=Wt||_n?1:0;In>=0&&(bn.get(In).hidden=Rn),Bt>=0&&(bn.get(Bt).hidden=Rn),Yt>=0&&(bn.get(Yt).hidden=Rn),Tn>=0&&(bn.get(Tn).hidden=Wt||Ut?1:0);const hr=this.variableOffsets[ot];hr&&this.markUsedJustification(a,hr.anchor,_e,jt);const mr=this.placedOrientations[ot];mr&&(this.markUsedJustification(a,"left",_e,mr),this.markUsedOrientation(a,mr,_e))}if(kt){const cn=Ko(_t.icon),{placedIconSymbolIndex:Wt,verticalPlacedIconSymbolIndex:In}=_e,Bt=a.icon.placedSymbolArray,Yt=_t.icon.isHidden()?1:0;Wt>=0&&(Ze(a.icon,bt,_n?go:cn),Bt.get(Wt).hidden=Yt),In>=0&&(Ze(a.icon,_e.numVerticalIconVertices,Ut?go:cn),Bt.get(In).hidden=Yt)}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const cn=a.collisionArrays[Xe];if(cn){let Wt=new o.Point(0,0),In=!0;if(cn.textBox||cn.verticalTextBox){if(Q){const Yt=this.variableOffsets[ot];Yt?(Wt=Ms(Yt.anchor,Yt.width,Yt.height,Yt.textOffset,Yt.textScale),te&&Wt._rotate(ge?this.transform.angle:-this.transform.angle)):In=!1}T&&(In=!_t.clipped),cn.textBox&&ci(a.textCollisionBox.collisionVertexArray,_t.text.placed,!In||_n,Wt.x,Wt.y),cn.verticalTextBox&&ci(a.textCollisionBox.collisionVertexArray,_t.text.placed,!In||Ut,Wt.x,Wt.y)}const Bt=In&&!!(!Ut&&cn.verticalIconBox);cn.iconBox&&ci(a.iconCollisionBox.collisionVertexArray,_t.icon.placed,Bt,Ae?Wt.x:0,Ae?Wt.y:0),cn.verticalIconBox&&ci(a.iconCollisionBox.collisionVertexArray,_t.icon.placed,!Bt,Ae?Wt.x:0,Ae?Wt.y:0)}}}if(a.fullyClipped=Ue===0,a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.bucketInstanceId in this.collisionCircleArrays){const Xe=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=Xe.invProjMatrix,a.placementViewportMatrix=Xe.viewportMatrix,a.collisionCircleArray=Xe.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return this.fadeDuration===0?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,f){const v=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*v>a}setStale(){this.stale=!0}}function ci(y,a,f,v,S){y.emplaceBack(a?1:0,f?1:0,v||0,S||0),y.emplaceBack(a?1:0,f?1:0,v||0,S||0),y.emplaceBack(a?1:0,f?1:0,v||0,S||0),y.emplaceBack(a?1:0,f?1:0,v||0,S||0)}const Jo=Math.pow(2,25),Eo=Math.pow(2,24),xh=Math.pow(2,17),ku=Math.pow(2,16),mo=Math.pow(2,9),js=Math.pow(2,8),Mu=Math.pow(2,1);function Ko(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const a=y.placed?1:0,f=Math.floor(127*y.opacity);return f*Jo+a*Eo+f*xh+a*ku+f*mo+a*js+f*Mu+a}const go=0;class Ml{constructor(a){this._sortAcrossTiles=a.layout.get("symbol-z-order")!=="viewport-y"&&a.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(a,f,v,S,T){const N=this._bucketParts;for(;this._currentTileIndex<a.length;)if(f.getBucketParts(N,S,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,T())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,N.sort(((z,$)=>z.sortKey-$.sortKey)));this._currentPartIndex<N.length;){const z=N[this._currentPartIndex];if(f.placeLayerBucketPart(z,this._seenCrossTileIDs,v,z.symbolInstanceStart===0),this._currentPartIndex++,T())return!0}return!1}}class Oa{constructor(a,f,v,S,T,N,z,$){this.placement=new Fa(a,T,N,z,$),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=S,this._done=!1}isDone(){return this._done}continuePlacement(a,f,v){const S=o.exported.now(),T=()=>{const N=o.exported.now()-S;return!this._forceFullPlacement&&N>2};for(;this._currentPlacementIndex>=0;){const N=f[a[this._currentPlacementIndex]],z=this.placement.collisionIndex.transform.zoom;if(N.type==="symbol"&&(!N.minzoom||N.minzoom<=z)&&(!N.maxzoom||N.maxzoom>z)){if(this._inProgressLayer||(this._inProgressLayer=new Ml(N)),this._inProgressLayer.continuePlacement(v[N.source],this.placement,this._showCollisionBoxes,N,T))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const Us=512/o.EXTENT/2;class Uo{constructor(a,f,v){this.tileID=a,this.bucketInstanceId=v,this.index=new o.KDBush(f.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const S=a.canonical.x*o.EXTENT,T=a.canonical.y*o.EXTENT;for(let N=0;N<f.length;N++){const{key:z,crossTileID:$,tileAnchorX:Q,tileAnchorY:te}=f.get(N),ge=Math.floor((S+Q)*Us),Ae=Math.floor((T+te)*Us);this.index.add(ge,Ae),this.keys.push(z),this.crossTileIDs.push($)}this.index.finish()}findMatches(a,f,v){const S=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),T=Us/Math.pow(2,f.canonical.z-this.tileID.canonical.z),N=f.canonical.x*o.EXTENT,z=f.canonical.y*o.EXTENT;for(let $=0;$<a.length;$++){const Q=a.get($);if(Q.crossTileID)continue;const{key:te,tileAnchorX:ge,tileAnchorY:Ae}=Q,Le=Math.floor((N+ge)*T),Ze=Math.floor((z+Ae)*T),Ue=this.index.range(Le-S,Ze-S,Le+S,Ze+S);for(const Xe of Ue){const _e=this.crossTileIDs[Xe];if(this.keys[Xe]===te&&!v.has(_e)){v.add(_e),Q.crossTileID=_e;break}}}}}class zc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Xo{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const f=Math.round((a-this.lng)/360);if(f!==0)for(const v in this.indexes){const S=this.indexes[v],T={};for(const N in S){const z=S[N];z.tileID=z.tileID.unwrapTo(z.tileID.wrap+f),T[z.tileID.key]=z}this.indexes[v]=T}this.lng=a}addBucket(a,f,v){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let T=0;T<f.symbolInstances.length;T++)f.symbolInstances.get(T).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]=new Set);const S=this.usedCrossTileIDs[a.overscaledZ];for(const T in this.indexes){const N=this.indexes[T];if(Number(T)>a.overscaledZ)for(const z in N){const $=N[z];$.tileID.isChildOf(a)&&$.findMatches(f.symbolInstances,a,S)}else{const z=N[a.scaledTo(Number(T)).key];z&&z.findMatches(f.symbolInstances,a,S)}}for(let T=0;T<f.symbolInstances.length;T++){const N=f.symbolInstances.get(T);N.crossTileID||(N.crossTileID=v.generate(),S.add(N.crossTileID))}return this.indexes[a.overscaledZ]===void 0&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new Uo(a,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(a,f){for(const v of f.crossTileIDs)this.usedCrossTileIDs[a].delete(v)}removeStaleBuckets(a){let f=!1;for(const v in this.indexes){const S=this.indexes[v];for(const T in S)a[S[T].bucketInstanceId]||(this.removeBucketCrossTileIDs(v,S[T]),delete S[T],f=!0)}return f}}class pa{constructor(){this.layerIndexes={},this.crossTileIDs=new zc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,f,v,S){let T=this.layerIndexes[a.id];T===void 0&&(T=this.layerIndexes[a.id]=new Xo);let N=!1;const z={};S.name!=="globe"&&T.handleWrapJump(v);for(const $ of f){const Q=$.getBucket(a);Q&&a.id===Q.layerIds[0]&&(Q.bucketInstanceId||(Q.bucketInstanceId=++this.maxBucketInstanceId),T.addBucket($.tileID,Q,this.crossTileIDs)&&(N=!0),z[Q.bucketInstanceId]=!0)}return T.removeStaleBuckets(z)&&(N=!0),N}pruneUnusedLayers(a){const f={};a.forEach((v=>{f[v]=!0}));for(const v in this.layerIndexes)f[v]||delete this.layerIndexes[v]}}const Ja=(y,a)=>o.emitValidationErrors(y,a&&a.filter((f=>f.identifier!=="source.canvas"))),cl=o.pick(Vi,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),tu=o.pick(Vi,["setCenter","setZoom","setBearing","setPitch"]),wc={version:8,layers:[],sources:{}},Vs={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Ai extends o.Evented{constructor(a,f={}){super(),this.map=a,this.dispatcher=new xe(fa(),this),this.imageManager=new H,this.imageManager.setEventedParent(this),this.glyphManager=new o.GlyphManager(a._requestManager,f.localFontFamily?o.LocalGlyphMode.all:f.localIdeographFontFamily?o.LocalGlyphMode.ideographs:o.LocalGlyphMode.none,f.localFontFamily||f.localIdeographFontFamily),this.crossTileSymbolIndex=new pa,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const v=this;this._rtlTextPluginCallback=Ai.registerForPluginStateChange((S=>{v.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:S.pluginStatus,pluginURL:S.pluginURL},((T,N)=>{if(o.triggerPluginCompletionEvent(T),N&&N.every((z=>z)))for(const z in v._sourceCaches){const $=v._sourceCaches[z],Q=$.getSource().type;Q!=="vector"&&Q!=="geojson"||$.reload()}}))})),this.on("data",(S=>{if(S.dataType!=="source"||S.sourceDataType!=="metadata")return;const T=this.getSource(S.sourceId);if(T&&T.vectorLayerIds)for(const N in this._layers){const z=this._layers[N];z.source===T.id&&this._validateLayer(z)}}))}loadURL(a,f={}){this.fire(new o.Event("dataloading",{dataType:"style"}));const v=typeof f.validate=="boolean"?f.validate:!o.isMapboxURL(a);a=this.map._requestManager.normalizeStyleURL(a,f.accessToken);const S=this.map._requestManager.transformRequest(a,o.ResourceType.Style);this._request=o.getJSON(S,((T,N)=>{this._request=null,T?this.fire(new o.ErrorEvent(T)):N&&this._load(N,v)}))}loadJSON(a,f={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame((()=>{this._request=null,this._load(a,f.validate!==!1)}))}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(wc,!1)}_updateLayerCount(a,f){const v=f?1:-1;a.is3D()&&(this._num3DLayers+=v),a.type==="circle"&&(this._numCircleLayers+=v),a.type==="symbol"&&(this._numSymbolLayers+=v)}_load(a,f){if(f&&Ja(this,o.validateStyle(a)))return;this._loaded=!0,this.stylesheet=o.clone$1(a),this._updateMapProjection();for(const S in a.sources)this.addSource(S,a.sources[S],{validate:!1});this._changed=!1,a.sprite?this._loadSprite(a.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(a.glyphs);const v=al(this.stylesheet.layers);this._order=v.map((S=>S.id)),this._layers={},this._serializedLayers={};for(const S of v){const T=o.createStyleLayer(S);T.setEventedParent(this,{layer:{id:T.id}}),this._layers[T.id]=T,this._serializedLayers[T.id]=T.serialize(),this._updateLayerCount(T,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new be(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(a){a?this.stylesheet.projection=a:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(a){this._spriteRequest=(function(f,v,S){let T,N,z;const $=o.exported.devicePixelRatio>1?"@2x":"";let Q=o.getJSON(v.transformRequest(v.normalizeSpriteURL(f,$,".json"),o.ResourceType.SpriteJSON),((Ae,Le)=>{Q=null,z||(z=Ae,T=Le,ge())})),te=o.getImage(v.transformRequest(v.normalizeSpriteURL(f,$,".png"),o.ResourceType.SpriteImage),((Ae,Le)=>{te=null,z||(z=Ae,N=Le,ge())}));function ge(){if(z)S(z);else if(T&&N){const Ae=o.exported.getImageData(N),Le={};for(const Ze in T){const{width:Ue,height:Xe,x:_e,y:Ge,sdf:it,pixelRatio:ot,stretchX:bt,stretchY:wt,content:_t}=T[Ze],Pt=new o.RGBAImage({width:Ue,height:Xe});o.RGBAImage.copy(Ae,Pt,{x:_e,y:Ge},{x:0,y:0},{width:Ue,height:Xe}),Le[Ze]={data:Pt,pixelRatio:ot,sdf:it,stretchX:bt,stretchY:wt,content:_t}}S(null,Le)}}return{cancel(){Q&&(Q.cancel(),Q=null),te&&(te.cancel(),te=null)}}})(a,this.map._requestManager,((f,v)=>{if(this._spriteRequest=null,f)this.fire(new o.ErrorEvent(f));else if(v)for(const S in v)this.imageManager.addImage(S,v[S]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new o.Event("data",{dataType:"style"}))}))}_validateLayer(a){const f=this.getSource(a.source);if(!f)return;const v=a.sourceLayer;v&&(f.type==="geojson"||f.vectorLayerIds&&f.vectorLayerIds.indexOf(v)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${v}" does not exist on source "${f.id}" as specified by style layer "${a.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const a in this._sourceCaches)if(!this._sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(a){const f=[];for(const v of a){const S=this._layers[v];S.type!=="custom"&&f.push(S.serialize())}return f}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const a in this._sourceCaches)if(this._sourceCaches[a].hasTransition())return!0;for(const a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(a){return!!this.terrain&&(typeof a.isLayerDraped=="function"?a.isLayerDraped():Vs[a.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(a){if(!this._loaded)return;const f=this._changed;if(this._changed){const S=Object.keys(this._updatedLayers),T=Object.keys(this._removedLayers);(S.length||T.length)&&this._updateWorkerLayers(S,T);for(const N in this._updatedSources){const z=this._updatedSources[N];z==="reload"?this._reloadSource(N):z==="clear"&&this._clearSource(N)}this._updateTilesForChangedImages();for(const N in this._updatedPaintProps)this._layers[N].updateTransitions(a);this.light.updateTransitions(a),this.fog&&this.fog.updateTransitions(a),this._resetUpdates()}const v={};for(const S in this._sourceCaches){const T=this._sourceCaches[S];v[S]=T.used,T.used=!1}for(const S of this._order){const T=this._layers[S];if(T.recalculate(a,this._availableImages),!T.isHidden(a.zoom)){const z=this._getLayerSourceCache(T);z&&(z.used=!0)}const N=this.map.painter;if(N){const z=T.getProgramIds();if(!z)continue;const $=T.getProgramConfiguration(a.zoom);for(const Q of z)N.useProgram(Q,$)}}for(const S in v){const T=this._sourceCaches[S];v[S]!==T.used&&T.getSource().fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:T.getSource().id}))}this.light.recalculate(a),this.terrain&&this.terrain.recalculate(a),this.fog&&this.fog.recalculate(a),this.z=a.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),f&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const a=Object.keys(this._changedImages);if(a.length){for(const f in this._sourceCaches)this._sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}}_updateWorkerLayers(a,f){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(a),removedIds:f})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(a){if(this._checkLoaded(),Ja(this,o.validateStyle(a)))return!1;(a=o.clone$1(a)).layers=al(a.layers);const f=(function(S,T){if(!S)return[{command:Vi.setStyle,args:[T]}];let N=[];try{if(!w(S.version,T.version))return[{command:Vi.setStyle,args:[T]}];w(S.center,T.center)||N.push({command:Vi.setCenter,args:[T.center]}),w(S.zoom,T.zoom)||N.push({command:Vi.setZoom,args:[T.zoom]}),w(S.bearing,T.bearing)||N.push({command:Vi.setBearing,args:[T.bearing]}),w(S.pitch,T.pitch)||N.push({command:Vi.setPitch,args:[T.pitch]}),w(S.sprite,T.sprite)||N.push({command:Vi.setSprite,args:[T.sprite]}),w(S.glyphs,T.glyphs)||N.push({command:Vi.setGlyphs,args:[T.glyphs]}),w(S.transition,T.transition)||N.push({command:Vi.setTransition,args:[T.transition]}),w(S.light,T.light)||N.push({command:Vi.setLight,args:[T.light]}),w(S.fog,T.fog)||N.push({command:Vi.setFog,args:[T.fog]}),w(S.projection,T.projection)||N.push({command:Vi.setProjection,args:[T.projection]});const z={},$=[];(function(ge,Ae,Le,Ze){let Ue;for(Ue in Ae=Ae||{},ge=ge||{})ge.hasOwnProperty(Ue)&&(Ae.hasOwnProperty(Ue)||Pu(Ue,Le,Ze));for(Ue in Ae){if(!Ae.hasOwnProperty(Ue))continue;const Xe=Ae[Ue];ge.hasOwnProperty(Ue)?w(ge[Ue],Xe)||(ge[Ue].type==="geojson"&&Xe.type==="geojson"&&mu(ge,Ae,Ue)?Le.push({command:Vi.setGeoJSONSourceData,args:[Ue,Xe.data]}):So(Ue,Ae,Le,Ze)):Ql(Ue,Ae,Le)}})(S.sources,T.sources,$,z);const Q=[];S.layers&&S.layers.forEach((ge=>{ge.source&&z[ge.source]?N.push({command:Vi.removeLayer,args:[ge.id]}):Q.push(ge)}));let te=S.terrain;te&&z[te.source]&&(N.push({command:Vi.setTerrain,args:[void 0]}),te=void 0),N=N.concat($),w(te,T.terrain)||N.push({command:Vi.setTerrain,args:[T.terrain]}),(function(ge,Ae,Le){Ae=Ae||[];const Ze=(ge=ge||[]).map(Zo),Ue=Ae.map(Zo),Xe=ge.reduce(Xa,{}),_e=Ae.reduce(Xa,{}),Ge=Ze.slice(),it=Object.create(null);let ot,bt,wt,_t,Pt,kt,jt;for(ot=0,bt=0;ot<Ze.length;ot++)wt=Ze[ot],_e.hasOwnProperty(wt)?bt++:(Le.push({command:Vi.removeLayer,args:[wt]}),Ge.splice(Ge.indexOf(wt,bt),1));for(ot=0,bt=0;ot<Ue.length;ot++)wt=Ue[Ue.length-1-ot],Ge[Ge.length-1-ot]!==wt&&(Xe.hasOwnProperty(wt)?(Le.push({command:Vi.removeLayer,args:[wt]}),Ge.splice(Ge.lastIndexOf(wt,Ge.length-bt),1)):bt++,kt=Ge[Ge.length-ot],Le.push({command:Vi.addLayer,args:[_e[wt],kt]}),Ge.splice(Ge.length-ot,0,wt),it[wt]=!0);for(ot=0;ot<Ue.length;ot++)if(wt=Ue[ot],_t=Xe[wt],Pt=_e[wt],!it[wt]&&!w(_t,Pt))if(w(_t.source,Pt.source)&&w(_t["source-layer"],Pt["source-layer"])&&w(_t.type,Pt.type)){for(jt in Ea(_t.layout,Pt.layout,Le,wt,null,Vi.setLayoutProperty),Ea(_t.paint,Pt.paint,Le,wt,null,Vi.setPaintProperty),w(_t.filter,Pt.filter)||Le.push({command:Vi.setFilter,args:[wt,Pt.filter]}),w(_t.minzoom,Pt.minzoom)&&w(_t.maxzoom,Pt.maxzoom)||Le.push({command:Vi.setLayerZoomRange,args:[wt,Pt.minzoom,Pt.maxzoom]}),_t)_t.hasOwnProperty(jt)&&jt!=="layout"&&jt!=="paint"&&jt!=="filter"&&jt!=="metadata"&&jt!=="minzoom"&&jt!=="maxzoom"&&(jt.indexOf("paint.")===0?Ea(_t[jt],Pt[jt],Le,wt,jt.slice(6),Vi.setPaintProperty):w(_t[jt],Pt[jt])||Le.push({command:Vi.setLayerProperty,args:[wt,jt,Pt[jt]]}));for(jt in Pt)Pt.hasOwnProperty(jt)&&!_t.hasOwnProperty(jt)&&jt!=="layout"&&jt!=="paint"&&jt!=="filter"&&jt!=="metadata"&&jt!=="minzoom"&&jt!=="maxzoom"&&(jt.indexOf("paint.")===0?Ea(_t[jt],Pt[jt],Le,wt,jt.slice(6),Vi.setPaintProperty):w(_t[jt],Pt[jt])||Le.push({command:Vi.setLayerProperty,args:[wt,jt,Pt[jt]]}))}else Le.push({command:Vi.removeLayer,args:[wt]}),kt=Ge[Ge.lastIndexOf(wt)+1],Le.push({command:Vi.addLayer,args:[Pt,kt]})})(Q,T.layers,N)}catch(z){console.warn("Unable to compute style diff:",z),N=[{command:Vi.setStyle,args:[T]}]}return N})(this.serialize(),a).filter((S=>!(S.command in tu)));if(f.length===0)return!1;const v=f.filter((S=>!(S.command in cl)));if(v.length>0)throw new Error(`Unimplemented: ${v.map((S=>S.command)).join(", ")}.`);return f.forEach((S=>{S.command!=="setTransition"&&S.command!=="setProjection"&&this[S.command].apply(this,S.args)})),this.stylesheet=a,this._updateMapProjection(),!0}addImage(a,f){return this.getImage(a)?this.fire(new o.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(a,f),this._afterImageUpdated(a),this)}updateImage(a,f){this.imageManager.updateImage(a,f)}getImage(a){return this.imageManager.getImage(a)}removeImage(a){return this.getImage(a)?(this.imageManager.removeImage(a),this._afterImageUpdated(a),this):this.fire(new o.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(a,f,v={}){if(this._checkLoaded(),this.getSource(a)!==void 0)throw new Error("There is already a source with this ID");if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(o.validateSource,`sources.${a}`,f,null,v))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const S=wr(a,f,this.dispatcher,this);S.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(a),source:S.serialize(),sourceId:a})));const T=N=>{const z=(N?"symbol:":"other:")+a,$=this._sourceCaches[z]=new o.SourceCache(z,S,N);(N?this._symbolSourceCaches:this._otherSourceCaches)[a]=$,$.style=this,$.onAdd(this.map)};T(!1),f.type!=="vector"&&f.type!=="geojson"||T(!0),S.onAdd&&S.onAdd(this.map),this._changed=!0}removeSource(a){this._checkLoaded();const f=this.getSource(a);if(!f)throw new Error("There is no source with this ID");for(const S in this._layers)if(this._layers[S].source===a)return this.fire(new o.ErrorEvent(new Error(`Source "${a}" cannot be removed while layer "${S}" is using it.`)));if(this.terrain&&this.terrain.get().source===a)return this.fire(new o.ErrorEvent(new Error(`Source "${a}" cannot be removed while terrain is using it.`)));const v=this._getSourceCaches(a);for(const S of v)delete this._sourceCaches[S.id],delete this._updatedSources[S.id],S.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:S.getSource().id})),S.setEventedParent(null),S.clearTiles();return delete this._otherSourceCaches[a],delete this._symbolSourceCaches[a],f.setEventedParent(null),f.onRemove&&f.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(a,f){this._checkLoaded(),this.getSource(a).setData(f),this._changed=!0}getSource(a){const f=this._getSourceCache(a);return f&&f.getSource()}_getSources(){const a=[];for(const f in this._otherSourceCaches){const v=this._getSourceCache(f);v&&a.push(v.getSource())}return a}addLayer(a,f,v={}){this._checkLoaded();const S=a.id;if(this.getLayer(S))return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${S}" already exists on this map`)));let T;if(a.type==="custom"){if(Ja(this,o.validateCustomStyleLayer(a)))return;T=o.createStyleLayer(a)}else{if(typeof a.source=="object"&&(this.addSource(S,a.source),a=o.clone$1(a),a=o.extend(a,{source:S})),this._validate(o.validateLayer,`layers.${S}`,a,{arrayIndex:-1},v))return;T=o.createStyleLayer(a),this._validateLayer(T),T.setEventedParent(this,{layer:{id:S}}),this._serializedLayers[T.id]=T.serialize(),this._updateLayerCount(T,!0)}const N=f?this._order.indexOf(f):this._order.length;if(f&&N===-1)return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${f}" does not exist on this map.`)));this._order.splice(N,0,S),this._layerOrderChanged=!0,this._layers[S]=T;const z=this._getLayerSourceCache(T);if(this._removedLayers[S]&&T.source&&z&&T.type!=="custom"){const $=this._removedLayers[S];delete this._removedLayers[S],$.type!==T.type?this._updatedSources[T.source]="clear":(this._updatedSources[T.source]="reload",z.pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(a,f){if(this._checkLoaded(),this._changed=!0,!this._layers[a])return void this.fire(new o.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be moved.`)));if(a===f)return;const v=this._order.indexOf(a);this._order.splice(v,1);const S=f?this._order.indexOf(f):this._order.length;f&&S===-1?this.fire(new o.ErrorEvent(new Error(`Layer with id "${f}" does not exist on this map.`))):(this._order.splice(S,0,a),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(a){this._checkLoaded();const f=this._layers[a];if(!f)return void this.fire(new o.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be removed.`)));f.setEventedParent(null),this._updateLayerCount(f,!1);const v=this._order.indexOf(a);this._order.splice(v,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=f,delete this._layers[a],delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],f.onRemove&&f.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(a){return this._layers[a]}hasLayer(a){return a in this._layers}hasLayerType(a){for(const f in this._layers)if(this._layers[f].type===a)return!0;return!1}setLayerZoomRange(a,f,v){this._checkLoaded();const S=this.getLayer(a);S?S.minzoom===f&&S.maxzoom===v||(f!=null&&(S.minzoom=f),v!=null&&(S.maxzoom=v),this._updateLayer(S)):this.fire(new o.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(a,f,v={}){this._checkLoaded();const S=this.getLayer(a);if(S){if(!w(S.filter,f))return f==null?(S.filter=void 0,void this._updateLayer(S)):void(this._validate(o.validateFilter,`layers.${S.id}.filter`,f,{layerType:S.type},v)||(S.filter=o.clone$1(f),this._updateLayer(S)))}else this.fire(new o.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be filtered.`)))}getFilter(a){const f=this.getLayer(a);return f&&o.clone$1(f.filter)}setLayoutProperty(a,f,v,S={}){this._checkLoaded();const T=this.getLayer(a);T?w(T.getLayoutProperty(f),v)||(T.setLayoutProperty(f,v,S),this._updateLayer(T)):this.fire(new o.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(a,f){const v=this.getLayer(a);if(v)return v.getLayoutProperty(f);this.fire(new o.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style.`)))}setPaintProperty(a,f,v,S={}){this._checkLoaded();const T=this.getLayer(a);T?w(T.getPaintProperty(f),v)||(T.setPaintProperty(f,v,S)&&this._updateLayer(T),this._changed=!0,this._updatedPaintProps[a]=!0):this.fire(new o.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(a,f){const v=this.getLayer(a);return v&&v.getPaintProperty(f)}setFeatureState(a,f){this._checkLoaded();const v=a.source,S=a.sourceLayer,T=this.getSource(v);if(!T)return void this.fire(new o.ErrorEvent(new Error(`The source '${v}' does not exist in the map's style.`)));const N=T.type;if(N==="geojson"&&S)return void this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(N==="vector"&&!S)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));a.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided.")));const z=this._getSourceCaches(v);for(const $ of z)$.setFeatureState(S,a.id,f)}removeFeatureState(a,f){this._checkLoaded();const v=a.source,S=this.getSource(v);if(!S)return void this.fire(new o.ErrorEvent(new Error(`The source '${v}' does not exist in the map's style.`)));const T=S.type,N=T==="vector"?a.sourceLayer:void 0;if(T==="vector"&&!N)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(f&&typeof a.id!="string"&&typeof a.id!="number")return void this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const z=this._getSourceCaches(v);for(const $ of z)$.removeFeatureState(N,a.id,f)}getFeatureState(a){this._checkLoaded();const f=a.source,v=a.sourceLayer,S=this.getSource(f);if(S){if(S.type!=="vector"||v)return a.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(f)[0].getFeatureState(v,a.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const a={};for(const f in this._sourceCaches){const v=this._sourceCaches[f].getSource();a[v.id]||(a[v.id]=v.serialize())}return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:a,layers:this._serializeLayers(this._order)},(f=>f!==void 0))}_updateLayer(a){this._updatedLayers[a.id]=!0;const f=this._getLayerSourceCache(a);a.source&&!this._updatedSources[a.source]&&f&&f.getSource().type!=="raster"&&(this._updatedSources[a.source]="reload",f.pause()),this._changed=!0,a.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(a){const f=N=>this._layers[N].type==="fill-extrusion",v={},S=[];for(let N=this._order.length-1;N>=0;N--){const z=this._order[N];if(f(z)){v[z]=N;for(const $ of a){const Q=$[z];if(Q)for(const te of Q)S.push(te)}}}S.sort(((N,z)=>z.intersectionZ-N.intersectionZ));const T=[];for(let N=this._order.length-1;N>=0;N--){const z=this._order[N];if(f(z))for(let $=S.length-1;$>=0;$--){const Q=S[$].feature;if(v[Q.layer.id]<N)break;T.push(Q),S.pop()}else for(const $ of a){const Q=$[z];if(Q)for(const te of Q)T.push(te.feature)}}return T}queryRenderedFeatures(a,f,v){f&&f.filter&&this._validate(o.validateFilter,"queryRenderedFeatures.filter",f.filter,null,f);const S={};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const $ of f.layers){const Q=this._layers[$];if(!Q)return this.fire(new o.ErrorEvent(new Error(`The layer '${$}' does not exist in the map's style and cannot be queried for features.`))),[];S[Q.source]=!0}}const T=[];f.availableImages=this._availableImages;const N=f&&f.layers?f.layers.some(($=>{const Q=this.getLayer($);return Q&&Q.is3D()})):this.has3DLayers(),z=Ne.createFromScreenPoints(a,v);for(const $ in this._sourceCaches){const Q=this._sourceCaches[$].getSource().id;f.layers&&!S[Q]||T.push(to(this._sourceCaches[$],this._layers,this._serializedLayers,z,f,v,N,!!this.map._showQueryGeometry))}return this.placement&&T.push((function($,Q,te,ge,Ae,Le,Ze){const Ue={},Xe=Le.queryRenderedSymbols(ge),_e=[];for(const Ge of Object.keys(Xe).map(Number))_e.push(Ze[Ge]);_e.sort(Wo);for(const Ge of _e){const it=Ge.featureIndex.lookupSymbolFeatures(Xe[Ge.bucketInstanceId],Q,Ge.bucketIndex,Ge.sourceLayerIndex,Ae.filter,Ae.layers,Ae.availableImages,$);for(const ot in it){const bt=Ue[ot]=Ue[ot]||[],wt=it[ot];wt.sort(((_t,Pt)=>{const kt=Ge.featureSortOrder;if(kt){const jt=kt.indexOf(_t.featureIndex);return kt.indexOf(Pt.featureIndex)-jt}return Pt.featureIndex-_t.featureIndex}));for(const _t of wt)bt.push(_t)}}for(const Ge in Ue)Ue[Ge].forEach((it=>{const ot=it.feature,bt=te($[Ge]);if(!bt)return;const wt=bt.getFeatureState(ot.layer["source-layer"],ot.id);ot.source=ot.layer.source,ot.layer["source-layer"]&&(ot.sourceLayer=ot.layer["source-layer"]),ot.state=wt}));return Ue})(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),z.screenGeometry,f,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(T)}querySourceFeatures(a,f){f&&f.filter&&this._validate(o.validateFilter,"querySourceFeatures.filter",f.filter,null,f);const v=this._getSourceCaches(a);let S=[];for(const T of v)S=S.concat(po(T,f));return S}addSourceType(a,f,v){return Ai.getSourceType(a)?v(new Error(`A source type called "${a}" already exists.`)):(Ai.setSourceType(a,f),f.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:f.workerSourceURL},v):v(null,null))}getLight(){return this.light.getLight()}setLight(a,f={}){this._checkLoaded();const v=this.light.getLight();let S=!1;for(const N in a)if(!w(a[N],v[N])){S=!0;break}if(!S)return;const T=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(a,f),this.light.updateTransitions(T)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(a,f=1){if(this._checkLoaded(),!a)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let v=a;if(f===1){if(typeof v.source=="object"){const S="terrain-dem-src";this.addSource(S,v.source),v=o.clone$1(v),v=o.extend(v,{source:S})}if(this._validate(o.validateTerrain,"terrain",v))return}if(!this.terrain||this.terrain&&f!==this.terrain.drapeRenderMode){if(!v)return;this._createTerrain(v,f)}else{const S=this.terrain,T=S.get();for(const N of Object.keys(o.spec.terrain))!v.hasOwnProperty(N)&&o.spec.terrain[N].default&&(v[N]=o.spec.terrain[N].default);for(const N in v)if(!w(v[N],T[N])){S.set(v),this.stylesheet.terrain=v;const z=this._setTransitionParameters({duration:0});S.updateTransitions(z);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(a){const f=this.fog=new nt(a,this.map.transform);this.stylesheet.fog=a;const v=this._setTransitionParameters({duration:0});f.updateTransitions(v)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask((()=>{for(const a of this.map._markers)a._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(a){if(this._checkLoaded(),!a)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const f=this.fog,v=f.get();Object.keys(a).length===0&&f.set(a);for(const S in a)if(!w(a[S],v[S])){f.set(a),this.stylesheet.fog=a;const T=this._setTransitionParameters({duration:0});f.updateTransitions(T);break}}else this._createFog(a);this._markersNeedUpdate=!0}_setTransitionParameters(a){return{now:o.exported.now(),transition:o.extend(a,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const a=this._order.filter((v=>this.isLayerDraped(this._layers[v]))),f=this._order.filter((v=>!this.isLayerDraped(this._layers[v])));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...a),this._drapedFirstOrder.push(...f)}_createTerrain(a,f){const v=this.terrain=new Be(a,f);this.stylesheet.terrain=a,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const S=this._setTransitionParameters({duration:0});v.updateTransitions(S)}_force3DLayerUpdate(){for(const a in this._layers){const f=this._layers[a];f.type==="fill-extrusion"&&this._updateLayer(f)}}_forceSymbolLayerUpdate(){for(const a in this._layers){const f=this._layers[a];f.type==="symbol"&&this._updateLayer(f)}}_validate(a,f,v,S,T={}){return(!T||T.validate!==!1)&&Ja(this,a.call(o.validateStyle,o.extend({key:f,style:this.serialize(),value:v,styleSpec:o.spec},S)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this._sourceCaches)this._sourceCaches[a].clearTiles(),this._sourceCaches[a].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(a){const f=this._getSourceCaches(a);for(const v of f)v.clearTiles()}_reloadSource(a){const f=this._getSourceCaches(a);for(const v of f)v.resume(),v.reload()}_reloadSources(){for(const a of this._getSources())a.reload&&a.reload()}_updateSources(a){for(const f in this._sourceCaches)this._sourceCaches[f].update(a)}_generateCollisionBoxes(){for(const a in this._sourceCaches){const f=this._sourceCaches[a];f.resume(),f.reload()}}_updatePlacement(a,f,v,S,T=!1){let N=!1,z=!1;const $={};for(const Q of this._order){const te=this._layers[Q];if(te.type!=="symbol")continue;if(!$[te.source]){const Ae=this._getLayerSourceCache(te);if(!Ae)continue;$[te.source]=Ae.getRenderableIds(!0).map((Le=>Ae.getTileByID(Le))).sort(((Le,Ze)=>Ze.tileID.overscaledZ-Le.tileID.overscaledZ||(Le.tileID.isLessThan(Ze.tileID)?-1:1)))}const ge=this.crossTileSymbolIndex.addLayer(te,$[te.source],a.center.lng,a.projection);N=N||ge}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),T=T||this._layerOrderChanged||v===0,this._layerOrderChanged&&this.fire(new o.Event("neworder")),(T||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),a.zoom))&&(this.pauseablePlacement=new Oa(a,this._order,T,f,v,S,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,$),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),z=!0),N&&this.pauseablePlacement.placement.setStale()),z||N)for(const Q of this._order){const te=this._layers[Q];te.type==="symbol"&&this.placement.updateLayerOpacities(te,$[te.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const a in this._sourceCaches)this._sourceCaches[a].releaseSymbolFadeTiles()}getImages(a,f,v){this.imageManager.getImages(f.icons,v),this._updateTilesForChangedImages();const S=T=>{T&&T.setDependencies(f.tileID.key,f.type,f.icons)};S(this._otherSourceCaches[f.source]),S(this._symbolSourceCaches[f.source])}getGlyphs(a,f,v){this.glyphManager.getGlyphs(f.stacks,v)}getResource(a,f,v){return o.makeRequest(f,v)}_getSourceCache(a){return this._otherSourceCaches[a]}_getLayerSourceCache(a){return a.type==="symbol"?this._symbolSourceCaches[a.source]:this._otherSourceCaches[a.source]}_getSourceCaches(a){const f=[];return this._otherSourceCaches[a]&&f.push(this._otherSourceCaches[a]),this._symbolSourceCaches[a]&&f.push(this._symbolSourceCaches[a]),f}_isSourceCacheLoaded(a){const f=this._getSourceCaches(a);return f.length===0?(this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${a}'`))),!1):f.every((v=>v.loaded()))}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ai.getSourceType=function(y){return zr[y]},Ai.setSourceType=function(y,a){zr[y]=a},Ai.registerForPluginStateChange=o.registerForPluginStateChange;var Ss=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,qs="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ia=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,oa=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,ul=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let $s={},Gs={};const Sc=[];qt(Ss,Sc),qt(ia,Sc),qt(oa,Sc),qt(ul,Sc),$s=Qt("",ia),Gs=Qt(ul,oa);const W=Qt(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Ce=Ss,pt=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var yt={background:Qt(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Qt(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Qt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Qt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Qt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Qt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Qt("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Qt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Qt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Qt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Qt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Qt(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Qt(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Qt(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Qt(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Qt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Qt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Qt(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Qt(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Qt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Qt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Qt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Qt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Qt(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:Qt(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Qt(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,qs),skyboxGradient:Qt(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,qs),skyboxCapture:Qt(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Qt(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Qt(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function qt(y,a){const f=y.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let v of f)if(v=v.trim(),v[0]==="#"&&v.includes("if")&&!v.includes("endif")){v=v.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const S=v.split(" ");for(const T of S)a.includes(T)||a.push(T)}}function Qt(y,a){const f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,v=a.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),S={},T=[...Sc];return qt(y,T),qt(a,T),{fragmentSource:y=y.replace(f,((N,z,$,Q,te)=>(S[te]=!0,z==="define"?`
#ifndef HAS_UNIFORM_u_${te}
varying ${$} ${Q} ${te};
#else
uniform ${$} ${Q} u_${te};
#endif
`:`
#ifdef HAS_UNIFORM_u_${te}
    ${$} ${Q} ${te} = u_${te};
#endif
`))),vertexSource:a=a.replace(f,((N,z,$,Q,te)=>{const ge=Q==="float"?"vec2":"vec4",Ae=te.match(/color/)?"color":ge;return S[te]?z==="define"?`
#ifndef HAS_UNIFORM_u_${te}
uniform lowp float u_${te}_t;
attribute ${$} ${ge} a_${te};
varying ${$} ${Q} ${te};
#else
uniform ${$} ${Q} u_${te};
#endif
`:Ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${te}
    ${te} = a_${te};
#else
    ${$} ${Q} ${te} = u_${te};
#endif
`:`
#ifndef HAS_UNIFORM_u_${te}
    ${te} = unpack_mix_${Ae}(a_${te}, u_${te}_t);
#else
    ${$} ${Q} ${te} = u_${te};
#endif
`:z==="define"?`
#ifndef HAS_UNIFORM_u_${te}
uniform lowp float u_${te}_t;
attribute ${$} ${ge} a_${te};
#else
uniform ${$} ${Q} u_${te};
#endif
`:Ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${te}
    ${$} ${Q} ${te} = a_${te};
#else
    ${$} ${Q} ${te} = u_${te};
#endif
`:`
#ifndef HAS_UNIFORM_u_${te}
    ${$} ${Q} ${te} = unpack_mix_${Ae}(a_${te}, u_${te}_t);
#else
    ${$} ${Q} ${te} = u_${te};
#endif
`})),staticAttributes:v,usedDefines:T}}class Fn{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(a,f,v,S,T,N,z){this.context=a;let $=this.boundPaintVertexBuffers.length!==S.length;for(let te=0;!$&&te<S.length;te++)this.boundPaintVertexBuffers[te]!==S[te]&&($=!0);let Q=this.boundDynamicVertexBuffers.length!==z.length;for(let te=0;!Q&&te<z.length;te++)this.boundDynamicVertexBuffers[te]!==z[te]&&(Q=!0);if(!a.extVertexArrayObject||!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==v||$||Q||this.boundIndexBuffer!==T||this.boundVertexOffset!==N)this.freshBind(f,v,S,T,N,z);else{a.bindVertexArrayOES.set(this.vao);for(const te of z)te&&te.bind();T&&T.dynamicDraw&&T.bind()}}freshBind(a,f,v,S,T,N){let z;const $=a.numAttributes,Q=this.context,te=Q.gl;if(Q.extVertexArrayObject)this.vao&&this.destroy(),this.vao=Q.extVertexArrayObject.createVertexArrayOES(),Q.bindVertexArrayOES.set(this.vao),z=0,this.boundProgram=a,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=v,this.boundIndexBuffer=S,this.boundVertexOffset=T,this.boundDynamicVertexBuffers=N;else{z=Q.currentNumAttributes||0;for(let ge=$;ge<z;ge++)te.disableVertexAttribArray(ge)}f.enableAttributes(te,a),f.bind(),f.setVertexAttribPointers(te,a,T);for(const ge of v)ge.enableAttributes(te,a),ge.bind(),ge.setVertexAttribPointers(te,a,T);for(const ge of N)ge&&(ge.enableAttributes(te,a),ge.bind(),ge.setVertexAttribPointers(te,a,T));S&&S.bind(),Q.currentNumAttributes=$}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Nr(y,a){const f=Math.pow(2,a.canonical.z),v=a.canonical.y;return[new o.MercatorCoordinate(0,v/f).toLngLat().lat,new o.MercatorCoordinate(0,(v+1)/f).toLngLat().lat]}function $r(y,a,f,v,S,T,N){const z=y.context,$=z.gl,Q=f.fbo;if(!Q)return;y.prepareDrawTile();const te=y.useProgram("hillshade");z.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_2D,Q.colorAttachment.get());const ge=((Ue,Xe,_e,Ge)=>{const it=_e.paint.get("hillshade-shadow-color"),ot=_e.paint.get("hillshade-highlight-color"),bt=_e.paint.get("hillshade-accent-color");let wt=_e.paint.get("hillshade-illumination-direction")*(Math.PI/180);_e.paint.get("hillshade-illumination-anchor")==="viewport"&&(wt-=Ue.transform.angle);const _t=!Ue.options.moving;return{u_matrix:Ge||Ue.transform.calculateProjMatrix(Xe.tileID.toUnwrapped(),_t),u_image:0,u_latrange:Nr(0,Xe.tileID),u_light:[_e.paint.get("hillshade-exaggeration"),wt],u_shadow:it,u_highlight:ot,u_accent:bt}})(y,f,v,y.terrain?a.projMatrix:null);y.prepareDrawProgram(z,te,a.toUnwrapped());const{tileBoundsBuffer:Ae,tileBoundsIndexBuffer:Le,tileBoundsSegments:Ze}=y.getTileBoundsBuffers(f);te.draw(z,$.TRIANGLES,S,T,N,o.CullFaceMode.disabled,ge,v.id,Ae,Le,Ze)}function yi(y,a,f){if(!a.needsDEMTextureUpload)return;const v=y.context,S=v.gl;v.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||y.getTileTexture(f.stride);const T=f.getPixels();a.demTexture?a.demTexture.update(T,{premultiply:!1}):a.demTexture=new o.Texture(v,T,S.RGBA,{premultiply:!1}),a.needsDEMTextureUpload=!1}function Ti(y,a,f,v,S,T){const N=y.context,z=N.gl;if(!a.dem)return;const $=a.dem;if(N.activeTexture.set(z.TEXTURE1),yi(y,a,$),!a.demTexture)return;a.demTexture.bind(z.NEAREST,z.CLAMP_TO_EDGE);const Q=$.dim;N.activeTexture.set(z.TEXTURE0);let te=a.fbo;if(!te){const Ze=new o.Texture(N,{width:Q,height:Q,data:null},z.RGBA);Ze.bind(z.LINEAR,z.CLAMP_TO_EDGE),te=a.fbo=N.createFramebuffer(Q,Q,!0),te.colorAttachment.set(Ze.texture)}N.bindFramebuffer.set(te.framebuffer),N.viewport.set([0,0,Q,Q]);const{tileBoundsBuffer:ge,tileBoundsIndexBuffer:Ae,tileBoundsSegments:Le}=y.getMercatorTileBoundsBuffers();y.useProgram("hillshadePrepare").draw(N,z.TRIANGLES,v,S,T,o.CullFaceMode.disabled,((Ze,Ue)=>{const Xe=Ue.stride,_e=o.create();return o.ortho(_e,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(_e,_e,[0,-o.EXTENT,0]),{u_matrix:_e,u_image:1,u_dimension:[Xe,Xe],u_zoom:Ze.overscaledZ,u_unpack:Ue.unpackVector}})(a.tileID,$),f.id,ge,Ae,Le),a.needsHillshadePrepare=!1}const yo=y=>({u_matrix:new o.UniformMatrix4f(y),u_image0:new o.Uniform1i(y),u_skirt_height:new o.Uniform1f(y)}),_o=(y,a)=>({u_matrix:y,u_image0:0,u_skirt_height:a}),Qo=(y,a,f,v,S,T,N,z,$,Q,te,ge,Ae,Le,Ze)=>({u_proj_matrix:Float32Array.from(y),u_globe_matrix:a,u_normalize_matrix:Float32Array.from(v),u_merc_matrix:f,u_zoom_transition:S,u_merc_center:T,u_image0:0,u_frustum_tl:N,u_frustum_tr:z,u_frustum_br:$,u_frustum_bl:Q,u_globe_pos:te,u_globe_radius:ge,u_viewport:Ae,u_grid_matrix:Ze?Float32Array.from(Ze):new Float32Array(9),u_skirt_height:Le});function Mo(y,a){return y!=null&&a!=null&&!(!y.hasData()||!a.hasData())&&y.demTexture!=null&&a.demTexture!=null&&y.tileID.key!==a.tileID.key}const Vo=new class{constructor(){this.operations={}}newMorphing(y,a,f,v,S){if(y in this.operations){const T=this.operations[y];T.to.tileID.key!==f.tileID.key&&(T.queued=f)}else this.operations[y]={startTime:v,phase:0,duration:S,from:a,to:f,queued:null}}getMorphValuesForProxy(y){if(!(y in this.operations))return null;const a=this.operations[y];return{from:a.from,to:a.to,phase:a.phase}}update(y){for(const a in this.operations){const f=this.operations[a];for(f.phase=(y-f.startTime)/f.duration;f.phase>=1||!this._validOp(f);)if(!this._nextOp(f,y)){delete this.operations[a];break}}}_nextOp(y,a){return!!y.queued&&(y.from=y.to,y.to=y.queued,y.queued=null,y.phase=0,y.startTime=a,!0)}_validOp(y){return y.from.hasData()&&y.to.hasData()}},es={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function cs(y){return 6*Math.pow(1.5,22-y)}function qo(y,a){const f=1<<y.z;return!a&&(y.x===0||y.x===f-1)||y.y===0||y.y===f-1}const Es=y=>({u_matrix:y});function jc(y,a,f,v,S){if(S>0){const T=o.exported.now(),N=(T-y.timeAdded)/S,z=a?(T-a.timeAdded)/S:-1,$=f.getSource(),Q=v.coveringZoomLevel({tileSize:$.tileSize,roundZoom:$.roundZoom}),te=!a||Math.abs(a.tileID.overscaledZ-Q)>Math.abs(y.tileID.overscaledZ-Q),ge=te&&y.refreshedUponExpiration?1:o.clamp(te?N:1-z,0,1);return y.refreshedUponExpiration&&N>=1&&(y.refreshedUponExpiration=!1),a?{opacity:1,mix:1-ge}:{opacity:ge,mix:0}}return{opacity:1,mix:0}}class Qa extends o.SourceCache{constructor(a){const f={type:"raster-dem",maxzoom:a.transform.maxZoom},v=new xe(fa(),null),S=wr("mock-dem",f,v,a.style);super("mock-dem",S,!1),S.setEventedParent(this),this._sourceLoaded=!0}_loadTile(a,f){a.state="loaded",f(null)}}class L extends o.SourceCache{constructor(a){const f=wr("proxy",{type:"geojson",maxzoom:a.transform.maxZoom},new xe(fa(),null),a.style);super("proxy",f,!1),f.setEventedParent(this),this.map=this.getSource().map=a,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(a,f,v){if(a.freezeTileCoverage)return;this.transform=a;const S=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((T,N)=>{if(T[N.key]="",!this._tiles[N.key]){const z=new o.Tile(N,this._source.tileSize*N.overscaleFactor(),a.tileZoom);z.state="loaded",this._tiles[N.key]=z}return T}),{});for(const T in this._tiles)T in S||(this.freeFBO(T),this._tiles[T].unloadVectorData(),delete this._tiles[T])}freeFBO(a){const f=this.proxyCachedFBO[a];if(f!==void 0){const v=Object.values(f);this.renderCachePool.push(...v),delete this.proxyCachedFBO[a]}}deallocRenderCache(){this.renderCache.forEach((a=>a.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class se extends o.OverscaledTileID{constructor(a,f,v){super(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y),this.proxyTileKey=f,this.projMatrix=v}}class ve extends o.Elevation{constructor(a,f){super(),this.painter=a,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[v,S,T]=(function($){const Q=new o.StructArrayLayout2i4,te=new o.StructArrayLayout3ui6,ge=131;Q.reserve(17161),te.reserve(33800);const Ae=o.EXTENT/128,Le=o.EXTENT+Ae/2,Ze=Le+Ae;for(let Xe=-Ae;Xe<Ze;Xe+=Ae)for(let _e=-Ae;_e<Ze;_e+=Ae){const Ge=_e<0||_e>Le||Xe<0||Xe>Le?24575:0,it=o.clamp(Math.round(_e),0,o.EXTENT),ot=o.clamp(Math.round(Xe),0,o.EXTENT);Q.emplaceBack(it+Ge,ot)}const Ue=(Xe,_e)=>{const Ge=_e*ge+Xe;te.emplaceBack(Ge+1,Ge,Ge+ge),te.emplaceBack(Ge+ge,Ge+ge+1,Ge+1)};for(let Xe=1;Xe<129;Xe++)for(let _e=1;_e<129;_e++)Ue(_e,Xe);return[0,129].forEach((Xe=>{for(let _e=0;_e<130;_e++)Ue(_e,Xe),Ue(Xe,_e)})),[Q,te,32768]})(),N=a.context;this.gridBuffer=N.createVertexBuffer(v,o.posAttributes.members),this.gridIndexBuffer=N.createIndexBuffer(S),this.gridSegments=o.SegmentVector.simpleSegment(0,0,v.length,S.length),this.gridNoSkirtSegments=o.SegmentVector.simpleSegment(0,0,v.length,T),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new L(f.map),this.orthoMatrix=o.create(),o.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.EXTENT,0,o.EXTENT,0,1);const z=N.gl;this._overlapStencilMode=new o.StencilMode({func:z.GEQUAL,mask:255},0,255,z.KEEP,z.KEEP,z.REPLACE),this._previousZoom=a.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=f,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Qa(f.map)}set style(a){a.on("data",this._onStyleDataEvent.bind(this)),a.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=a,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(a,f,v){if(a&&a.terrain){this._style!==a&&(this.style=a),this.enabled=!0;const S=a.terrain.properties;this.sourceCache=a.terrain.drapeRenderMode===0?this._mockSourceCache:a._getSourceCache(S.get("source")),this._exaggeration=S.get("exaggeration");const T=()=>{this.sourceCache.used&&o.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const N=this.getScaledDemTileSize();this.sourceCache.update(f,N,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,T(),this._initializing=!0),T(),f.updateElevation(!0,v),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(f),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(a){this._findCoveringTileCache[a]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const a=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||a.efficiency!==100&&o.warnOnce(`Terrain render cache efficiency is not optimal (${a.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${a.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(a){a.coord&&a.dataType==="source"?this._clearRenderCacheForTile(a.sourceCacheId,a.coord):a.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const a in this._style._sourceCaches)this._style._sourceCaches[a].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach((a=>a.fb.destroy())),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const a=2*this.proxySourceCache.getSource().tileSize;return[a,a]}set useVertexMorphing(a){this._useVertexMorphing=a}updateTileBinding(a){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const f=this.proxySourceCache,v=this.painter.transform;this._initializing&&(this._initializing=v._centerAltitude===0&&this.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(v.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const S=this.proxyCoords=f.getIds().map(($=>{const Q=f.getTileByID($).tileID;return Q.projMatrix=v.calculateProjMatrix(Q.toUnwrapped()),Q}));(function($,Q){const te=Q.transform.pointCoordinate(Q.transform.getCameraPoint()),ge=new o.Point(te.x,te.y);$.sort(((Ae,Le)=>{if(Le.overscaledZ-Ae.overscaledZ)return Le.overscaledZ-Ae.overscaledZ;const Ze=new o.Point(Ae.canonical.x+(1<<Ae.canonical.z)*Ae.wrap,Ae.canonical.y),Ue=new o.Point(Le.canonical.x+(1<<Le.canonical.z)*Le.wrap,Le.canonical.y),Xe=ge.mult(1<<Ae.canonical.z);return Xe.x-=.5,Xe.y-=.5,Xe.distSqr(Ze)-Xe.distSqr(Ue)}))})(S,this.painter),this._previousZoom=v.zoom;const T=this.proxyToSource||{};this.proxyToSource={},S.forEach(($=>{this.proxyToSource[$.key]={}})),this.terrainTileForTile={};const N=this._style._sourceCaches;for(const $ in N){const Q=N[$];if(!Q.used||(Q!==this.sourceCache&&this.resetTileLookupCache(Q.id),this._setupProxiedCoordsForOrtho(Q,a[$],T),Q.usedForTerrain))continue;const te=a[$];Q.getSource().reparseOverscaled&&this._assignTerrainTiles(te)}this.proxiedCoords[f.id]=S.map(($=>new se($,$.key,this.orthoMatrix))),this._assignTerrainTiles(S),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(T),this.renderingToTexture=!1,this._updateTimestamp=o.exported.now();const z={};this._visibleDemTiles=[];for(const $ of this.proxyCoords){const Q=this.terrainTileForTile[$.key];if(!Q)continue;const te=Q.tileID.key;te in z||(this._visibleDemTiles.push(Q),z[te]=te)}}_assignTerrainTiles(a){this._initializing||a.forEach((f=>{if(this.terrainTileForTile[f.key])return;const v=this._findTileCoveringTileID(f,this.sourceCache);v&&(this.terrainTileForTile[f.key]=v)}))}_prepareDEMTextures(){const a=this.painter.context,f=a.gl;for(const v in this.terrainTileForTile){const S=this.terrainTileForTile[v],T=S.dem;!T||S.demTexture&&!S.needsDEMTextureUpload||(a.activeTexture.set(f.TEXTURE1),yi(this.painter,S,T))}}_prepareDemTileUniforms(a,f,v,S){if(!f||f.demTexture==null)return!1;const T=a.tileID.canonical,N=Math.pow(2,f.tileID.canonical.z-T.z),z=S||"";return v[`u_dem_tl${z}`]=[T.x*N%1,T.y*N%1],v[`u_dem_scale${z}`]=N,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const a=this.painter.context,f=a.gl;if(!this._emptyDepthBufferTexture){const v=new o.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new o.Texture(a,v,f.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let a=0;const f=this._visibleDemTiles.reduce(((v,S)=>{if(!S.dem)return v;const T=S.dem.tree.minimums[0];return T>0&&a++,v+T}),0);return a?f/a:0}_updateEmptyDEMTexture(){const a=this.painter.context,f=a.gl;a.activeTexture.set(f.TEXTURE2);const v=this._getLoadedAreaMinimum(),S=new o.RGBAImage({width:1,height:1},new Uint8Array(o.DEMData.pack(v,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let T=this._emptyDEMTexture;return T?T.update(S,{premultiply:!1}):T=this._emptyDEMTexture=new o.Texture(a,S,f.RGBA,{premultiply:!1}),T}setupElevationDraw(a,f,v){const S=this.painter.context,T=S.gl,N=(z=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:o.DEMData.getUnpackVector(z),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var z;N.u_dem_size=this.sourceCache.getSource().tileSize,N.u_exaggeration=this.exaggeration();let $=null,Q=null,te=1;if(v&&v.morphing&&this._useVertexMorphing){const ge=v.morphing.srcDemTile,Ae=v.morphing.dstDemTile;te=v.morphing.phase,ge&&Ae&&(this._prepareDemTileUniforms(a,ge,N,"_prev")&&(Q=ge),this._prepareDemTileUniforms(a,Ae,N)&&($=Ae))}if(Q&&$?(S.activeTexture.set(T.TEXTURE2),$.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE,T.NEAREST),S.activeTexture.set(T.TEXTURE4),Q.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE,T.NEAREST),N.u_dem_lerp=te):($=this.terrainTileForTile[a.tileID.key],S.activeTexture.set(T.TEXTURE2),(this._prepareDemTileUniforms(a,$,N)?$.demTexture:this.emptyDEMTexture).bind(T.NEAREST,T.CLAMP_TO_EDGE)),S.activeTexture.set(T.TEXTURE3),v&&v.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),this._depthFBO&&(N.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),N.u_depth_size_inv=[1,1]),v&&v.useMeterToDem&&$){const ge=(1<<$.tileID.canonical.z)*o.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;N.u_meter_to_dem=ge}if(v&&v.labelPlaneMatrixInv&&(N.u_label_plane_matrix_inv=v.labelPlaneMatrixInv),f.setTerrainUniformValues(S,N),this.painter.transform.projection.name==="globe"){const ge=this.globeUniformValues(this.painter.transform,a.tileID.canonical,v&&v.useDenormalizedUpVectorScale);f.setGlobeUniformValues(S,ge)}}globeUniformValues(a,f,v){const S=a.projection;return{u_tile_tl_up:S.upVector(f,0,0),u_tile_tr_up:S.upVector(f,o.EXTENT,0),u_tile_br_up:S.upVector(f,o.EXTENT,o.EXTENT),u_tile_bl_up:S.upVector(f,0,o.EXTENT),u_tile_up_scale:v?o.globeMetersToEcef(1):S.upVectorScale(f,a.center.lat,a.worldSize).metersToTile}}renderToBackBuffer(a){const f=this.painter,v=this.painter.context;a.length!==0&&(v.bindFramebuffer.set(null),v.viewport.set([0,0,f.width,f.height]),f.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(S,T,N,z,$){if(S.transform.projection.name==="globe")(function(Q,te,ge,Ae,Le){const Ze=Q.context,Ue=Ze.gl;let Xe,_e;const Ge=Q.options.showTerrainWireframe?2:0,it=Q.transform,ot=o.globeUseCustomAntiAliasing(Q,Ze,it),bt=(In,Bt)=>{if(_e===In)return;const Yt=[es[In],"PROJECTION_GLOBE_VIEW"];ot&&Yt.push("CUSTOM_ANTIALIASING"),Bt&&Yt.push(es[Ge]),Xe=Q.useProgram("globeRaster",null,Yt),_e=In},wt=Q.colorModeForRenderPass(),_t=new o.DepthMode(Ue.LEQUAL,o.DepthMode.ReadWrite,Q.depthRangeFor3D);Vo.update(Le);const Pt=o.calculateGlobeMercatorMatrix(it),kt=[o.mercatorXfromLng(it.center.lng),o.mercatorYfromLat(it.center.lat)],jt=Ge?[!1,!0]:[!1],_n=Q.globeSharedBuffers,Ut=[it.width*o.exported.devicePixelRatio,it.height*o.exported.devicePixelRatio],cn=Float32Array.from(it.globeMatrix),Wt={useDenormalizedUpVectorScale:!0};if(jt.forEach((In=>{const Bt=Q.transform,Yt=cs(Bt.zoom)*te.exaggeration();_e=-1;const Tn=In?Ue.LINES:Ue.TRIANGLES;for(const bn of Ae){const Rn=ge.getTile(bn),hr=o.StencilMode.disabled,mr=te.prevTerrainTileForTile[bn.key],sr=te.terrainTileForTile[bn.key];Mo(mr,sr)&&Vo.newMorphing(bn.key,mr,sr,Le,250),Ze.activeTexture.set(Ue.TEXTURE0),Rn.texture.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE);const dr=Vo.getMorphValuesForProxy(bn.key),oi=dr?1:0;dr&&o.extend$1(Wt,{morphing:{srcDemTile:dr.from,dstDemTile:dr.to,phase:o.easeCubicInOut(dr.phase)}});const di=o.tileCornersToBounds(bn.canonical),_r=o.getLatitudinalLod(di.getCenter().lat),Zr=o.getGridMatrix(bn.canonical,di,_r,Bt.worldSize/Bt._pixelsPerMercatorPixel),Pi=o.globeNormalizeECEF(o.globeTileBounds(bn.canonical)),io=Qo(Bt.projMatrix,cn,Pt,Pi,o.globeToMercatorTransition(Bt.zoom),kt,Bt.frustumCorners.TL,Bt.frustumCorners.TR,Bt.frustumCorners.BR,Bt.frustumCorners.BL,Bt.globeCenterInViewSpace,Bt.globeRadius,Ut,Yt,Zr);if(bt(oi,In),te.setupElevationDraw(Rn,Xe,Wt),Q.prepareDrawProgram(Ze,Xe,bn.toUnwrapped()),_n){const[oo,ua,us]=In?_n.getWirefameBuffers(Q.context,_r):_n.getGridBuffers(_r,Yt!==0);Xe.draw(Ze,Tn,_t,hr,wt,o.CullFaceMode.backCCW,io,"globe_raster",oo,ua,us)}}})),_n){const In=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ot&&In.push("CUSTOM_ANTIALIASING"),Xe=Q.useProgram("globeRaster",null,In);for(const Bt of Ae){const{x:Yt,y:Tn,z:bn}=Bt.canonical,Rn=Tn===0,hr=Tn===(1<<bn)-1,[mr,sr,dr,oi]=_n.getPoleBuffers(bn);if(oi&&(Rn||hr)){const di=ge.getTile(Bt);Ze.activeTexture.set(Ue.TEXTURE0),di.texture.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE);let _r=o.globePoleMatrixForTile(bn,Yt,it);const Zr=o.globeNormalizeECEF(o.globeTileBounds(Bt.canonical)),Pi=(io,oo)=>io.draw(Ze,Ue.TRIANGLES,_t,o.StencilMode.disabled,wt,o.CullFaceMode.disabled,Qo(it.projMatrix,_r,_r,Zr,0,kt,it.frustumCorners.TL,it.frustumCorners.TR,it.frustumCorners.BR,it.frustumCorners.BL,it.globeCenterInViewSpace,it.globeRadius,Ut,0),"globe_pole_raster",oo,dr,oi);te.setupElevationDraw(di,Xe,Wt),Q.prepareDrawProgram(Ze,Xe,Bt.toUnwrapped()),Rn&&Pi(Xe,mr),hr&&(_r=o.scale(o.create(),_r,[1,-1,1]),Pi(Xe,sr))}}}})(S,T,N,z,$);else{const Q=S.context,te=Q.gl;let ge,Ae;const Le=S.options.showTerrainWireframe?2:0,Ze=(it,ot)=>{if(Ae===it)return;const bt=[es[it]];ot&&bt.push(es[Le]),ge=S.useProgram("terrainRaster",null,bt),Ae=it},Ue=S.colorModeForRenderPass(),Xe=new o.DepthMode(te.LEQUAL,o.DepthMode.ReadWrite,S.depthRangeFor3D);Vo.update($);const _e=S.transform,Ge=cs(_e.zoom)*T.exaggeration();(Le?[!1,!0]:[!1]).forEach((it=>{Ae=-1;const ot=it?te.LINES:te.TRIANGLES,[bt,wt]=it?T.getWirefameBuffer():[T.gridIndexBuffer,T.gridSegments];for(const _t of z){const Pt=N.getTile(_t),kt=o.StencilMode.disabled,jt=T.prevTerrainTileForTile[_t.key],_n=T.terrainTileForTile[_t.key];Mo(jt,_n)&&Vo.newMorphing(_t.key,jt,_n,$,250),Q.activeTexture.set(te.TEXTURE0),Pt.texture.bind(te.LINEAR,te.CLAMP_TO_EDGE,te.LINEAR_MIPMAP_NEAREST);const Ut=Vo.getMorphValuesForProxy(_t.key),cn=Ut?1:0;let Wt;Ut&&(Wt={morphing:{srcDemTile:Ut.from,dstDemTile:Ut.to,phase:o.easeCubicInOut(Ut.phase)}});const In=_o(_t.projMatrix,qo(_t.canonical,_e.renderWorldCopies)?Ge/10:Ge);Ze(cn,it),T.setupElevationDraw(Pt,ge,Wt),S.prepareDrawProgram(Q,ge,_t.toUnwrapped()),ge.draw(Q,ot,Xe,kt,Ue,o.CullFaceMode.backCCW,In,"terrain_raster",T.gridBuffer,bt,wt)}}))}})(f,this,this.proxySourceCache,a,this._updateTimestamp),this.renderingToTexture=!0,f.gpuTimingDeferredRenderEnd(),a.splice(0,a.length))}renderBatch(a){if(this._drapedRenderBatches.length===0)return a+1;this.renderingToTexture=!0;const f=this.painter,v=this.painter.context,S=this.proxySourceCache,T=this.proxiedCoords[S.id],N=this._drapedRenderBatches.shift(),z=[],$=f.style.order;let Q=0;for(const te of T){const ge=S.getTileByID(te.proxyTileKey),Ae=S.proxyCachedFBO[te.key]?S.proxyCachedFBO[te.key][a]:void 0,Le=Ae!==void 0?S.renderCache[Ae]:this.pool[Q++],Ze=Ae!==void 0;if(ge.texture=Le.tex,Ze&&!Le.dirty){z.push(ge.tileID);continue}let Ue;v.bindFramebuffer.set(Le.fb.framebuffer),this.renderedToTile=!1,Le.dirty&&(v.clear({color:o.Color.transparent,stencil:0}),Le.dirty=!1);for(let Xe=N.start;Xe<=N.end;++Xe){const _e=f.style._layers[$[Xe]];if(_e.isHidden(f.transform.zoom))continue;const Ge=f.style._getLayerSourceCache(_e),it=Ge?this.proxyToSource[te.key][Ge.id]:[te];if(!it)continue;const ot=it;v.viewport.set([0,0,Le.fb.width,Le.fb.height]),Ue!==(Ge?Ge.id:null)&&(this._setupStencil(Le,it,_e,Ge),Ue=Ge?Ge.id:null),f.renderLayer(f,Ge,_e,ot)}this.renderedToTile?(Le.dirty=!0,z.push(ge.tileID)):Ze||--Q,Q===5&&(Q=0,this.renderToBackBuffer(z))}return this.renderToBackBuffer(z),this.renderingToTexture=!1,v.bindFramebuffer.set(null),v.viewport.set([0,0,f.width,f.height]),N.end+1}postRender(){}renderCacheEfficiency(a){const f=a.order.length;if(f===0)return{efficiency:100};let v,S=0,T=0,N=!1;for(let z=0;z<f;++z){const $=a._layers[a.order[z]];this._style.isLayerDraped($)?(N&&++S,++T):N||(N=!0,v=$.id)}return T===0?{efficiency:100}:{efficiency:100*(1-S/T),firstUndrapedLayer:v}}getMinElevationBelowMSL(){let a=0;return this._visibleDemTiles.filter((f=>f.dem)).forEach((f=>{a=Math.min(a,f.dem.tree.minimums[0])})),a===0?a:(a-30)*this._exaggeration}raycast(a,f,v){if(!this._visibleDemTiles)return null;const S=this._visibleDemTiles.filter((T=>T.dem)).map((T=>{const N=T.tileID,z=1<<N.overscaledZ,{x:$,y:Q}=N.canonical,te=$/z,ge=($+1)/z,Ae=Q/z,Le=(Q+1)/z;return{minx:te,miny:Ae,maxx:ge,maxy:Le,t:T.dem.tree.raycastRoot(te,Ae,ge,Le,a,f,v),tile:T}}));S.sort(((T,N)=>(T.t!==null?T.t:Number.MAX_VALUE)-(N.t!==null?N.t:Number.MAX_VALUE)));for(const T of S){if(T.t==null)return null;const N=T.tile.dem.tree.raycast(T.minx,T.miny,T.maxx,T.maxy,a,f,v);if(N!=null)return N}return null}_createFBO(){const a=this.painter.context,f=a.gl,v=this.drapeBufferSize;a.activeTexture.set(f.TEXTURE0);const S=new o.Texture(a,{width:v[0],height:v[1],data:null},f.RGBA);S.bind(f.LINEAR,f.CLAMP_TO_EDGE);const T=a.createFramebuffer(v[0],v[1],!1);return T.colorAttachment.set(S.texture),T.depthAttachment=new At(a,T.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=a.createRenderbuffer(a.gl.DEPTH_STENCIL,v[0],v[1]),this._stencilRef=0,T.depthAttachment.set(this._sharedDepthStencil),a.clear({stencil:0})):T.depthAttachment.set(this._sharedDepthStencil),a.extTextureFilterAnisotropic&&!a.extTextureFilterAnisotropicForceOff&&f.texParameterf(f.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax),{fb:T,tex:S,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const a in this._style._sourceCaches)if(this._style._sourceCaches[a].hasTransition())return!0;return this._style.order.some((a=>{const f=this._style._layers[a],v=f.isHidden(this.painter.transform.zoom);return f.type==="custom"?!v&&f.shouldRedrape():!v&&f.hasTransition()}))}_clearLineLayersFromRenderCache(){let a=!1;for(const v of this._style._getSources())if(v instanceof On){a=!0;break}if(!a)return;const f={};for(let v=0;v<this._style.order.length;++v){const S=this._style._layers[this._style.order[v]],T=this._style._getLayerSourceCache(S);if(T&&!f[T.id]&&!S.isHidden(this.painter.transform.zoom)&&S.type==="line"&&S.widthExpression()instanceof o.ZoomDependentExpression){f[T.id]=!0;for(const N of this.proxyCoords){const z=this.proxyToSource[N.key][T.id];if(z)for(const $ of z)this._clearRenderCacheForTile(T.id,$)}}}}_clearRasterLayersFromRenderCache(){let a=!1;for(const v in this._style._sourceCaches)if(this._style._sourceCaches[v]._source instanceof An){a=!0;break}if(!a)return;const f={};for(let v=0;v<this._style.order.length;++v){const S=this._style._layers[this._style.order[v]],T=this._style._getLayerSourceCache(S);if(!T||f[T.id]||S.isHidden(this.painter.transform.zoom)||S.type!=="raster")continue;const N=S.paint.get("raster-fade-duration");for(const z of this.proxyCoords){const $=this.proxyToSource[z.key][T.id];if($)for(const Q of $){const te=jc(T.getTile(Q),T.findLoadedParent(Q,0),T,this.painter.transform,N);(te.opacity!==1||te.mix!==0)&&this._clearRenderCacheForTile(T.id,Q)}}}}_setupDrapedRenderBatches(){const a=this._style.order,f=a.length;if(f===0)return;const v=[];let S,T=0,N=this._style._layers[a[T]];for(;!this._style.isLayerDraped(N)&&N.isHidden(this.painter.transform.zoom)&&++T<f;)N=this._style._layers[a[T]];for(;T<f;++T){const z=this._style._layers[a[T]];z.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(z)?S===void 0&&(S=T):S!==void 0&&(v.push({start:S,end:T-1}),S=void 0))}S!==void 0&&v.push({start:S,end:T-1}),this._drapedRenderBatches=v}_setupRenderCache(a){const f=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,f.renderCache.length>f.renderCachePool.length){const N=Object.values(f.proxyCachedFBO);f.proxyCachedFBO={};for(let z=0;z<N.length;++z){const $=Object.values(N[z]);f.renderCachePool.push(...$)}}return}this._clearRasterLayersFromRenderCache();const v=this.proxyCoords,S=this._tilesDirty;for(let N=v.length-1;N>=0;N--){const z=v[N];if(f.getTileByID(z.key),f.proxyCachedFBO[z.key]!==void 0){const $=a[z.key],Q=this.proxyToSource[z.key];let te=0;for(const ge in Q){const Ae=Q[ge],Le=$[ge];if(!Le||Le.length!==Ae.length||Ae.some(((Ze,Ue)=>Ze!==Le[Ue]||S[ge]&&S[ge].hasOwnProperty(Ze.key)))){te=-1;break}++te}for(const ge in f.proxyCachedFBO[z.key])f.renderCache[f.proxyCachedFBO[z.key][ge]].dirty=te<0||te!==Object.values($).length}}const T=[...this._drapedRenderBatches];T.sort(((N,z)=>z.end-z.start-(N.end-N.start)));for(const N of T)for(const z of v){if(f.proxyCachedFBO[z.key])continue;let $=f.renderCachePool.pop();$===void 0&&f.renderCache.length<50&&($=f.renderCache.length,f.renderCache.push(this._createFBO())),$!==void 0&&(f.proxyCachedFBO[z.key]={},f.proxyCachedFBO[z.key][N.start]=$,f.renderCache[$].dirty=!0)}this._tilesDirty={}}_setupStencil(a,f,v,S){if(!S||!this._sourceTilesOverlap[S.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const T=this.painter.context,N=T.gl;if(f.length<=1)return void(this._overlapStencilType=!1);let z;if(v.isTileClipped())z=f.length,this._overlapStencilMode.test={func:N.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(f[0].overscaledZ>f[f.length-1].overscaledZ))return void(this._overlapStencilType=!1);z=1,this._overlapStencilMode.test={func:N.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+z>255&&(T.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=z,this._overlapStencilMode.ref=this._stencilRef,v.isTileClipped()&&this._renderTileClippingMasks(f,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(a){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[a.key]),this._overlapStencilMode):o.StencilMode.disabled}_renderTileClippingMasks(a,f){const v=this.painter,S=this.painter.context,T=S.gl;v._tileClippingMaskIDs={},S.setColorMode(o.ColorMode.disabled),S.setDepthMode(o.DepthMode.disabled);const N=v.useProgram("clippingMask");for(const z of a){const $=v._tileClippingMaskIDs[z.key]=--f;N.draw(S,T.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:T.ALWAYS,mask:0},$,255,T.KEEP,T.KEEP,T.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,Es(z.projMatrix),"$clipping",v.tileExtentBuffer,v.quadTriangleIndexBuffer,v.tileExtentSegments)}}pointCoordinate(a){const f=this.painter.transform;if(a.x<0||a.x>f.width||a.y<0||a.y>f.height)return null;const v=[a.x,a.y,1,1];o.transformMat4$1(v,v,f.pixelMatrixInverse),o.scale$1(v,v,1/v[3]),v[0]/=f.worldSize,v[1]/=f.worldSize;const S=f._camera.position,T=o.mercatorZfromAltitude(1,f.center.lat),N=[S[0],S[1],S[2]/T,0],z=o.subtract([],v.slice(0,3),N);o.normalize(z,z);const $=this.raycast(N,z,this._exaggeration);return $!==null&&$?(o.scaleAndAdd(N,N,z,$),N[3]=N[2],N[2]*=T,N):null}drawDepth(){const a=this.painter,f=a.context,v=this.proxySourceCache,S=Math.ceil(a.width),T=Math.ceil(a.height);if(!this._depthFBO||this._depthFBO.width===S&&this._depthFBO.height===T||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const N=f.gl,z=f.createFramebuffer(S,T,!0);f.activeTexture.set(N.TEXTURE0);const $=new o.Texture(f,{width:S,height:T,data:null},N.RGBA);$.bind(N.NEAREST,N.CLAMP_TO_EDGE),z.colorAttachment.set($.texture);const Q=f.createRenderbuffer(f.gl.DEPTH_COMPONENT16,S,T);z.depthAttachment.set(Q),this._depthFBO=z,this._depthTexture=$}f.bindFramebuffer.set(this._depthFBO.framebuffer),f.viewport.set([0,0,S,T]),(function(N,z,$,Q){if(N.transform.projection.name==="globe")return;const te=N.context,ge=te.gl;te.clear({depth:1});const Ae=N.useProgram("terrainDepth"),Le=new o.DepthMode(ge.LESS,o.DepthMode.ReadWrite,N.depthRangeFor3D);for(const Ze of Q){const Ue=$.getTile(Ze),Xe=_o(Ze.projMatrix,0);z.setupElevationDraw(Ue,Ae),Ae.draw(te,ge.TRIANGLES,Le,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.backCCW,Xe,"terrain_depth",z.gridBuffer,z.gridIndexBuffer,z.gridNoSkirtSegments)}})(a,this,v,this.proxyCoords)}_setupProxiedCoordsForOrtho(a,f,v){if(a.getSource()instanceof Ir)return this._setupProxiedCoordsForImageSource(a,f,v);this._findCoveringTileCache[a.id]=this._findCoveringTileCache[a.id]||{};const S=this.proxiedCoords[a.id]=[],T=this.proxyCoords;for(let z=0;z<T.length;z++){const $=T[z],Q=this._findTileCoveringTileID($,a);if(Q){const te=this._createProxiedId($,Q,v[$.key]&&v[$.key][a.id]);S.push(te),this.proxyToSource[$.key][a.id]=[te]}}let N=!1;for(let z=0;z<f.length;z++){const $=a.getTile(f[z]);if(!$||!$.hasData())continue;const Q=this._findTileCoveringTileID($.tileID,this.proxySourceCache);if(Q&&Q.tileID.canonical.z!==$.tileID.canonical.z){const te=this.proxyToSource[Q.tileID.key][a.id],ge=this._createProxiedId(Q.tileID,$,v[Q.tileID.key]&&v[Q.tileID.key][a.id]);te?te.splice(te.length-1,0,ge):this.proxyToSource[Q.tileID.key][a.id]=[ge],S.push(ge),N=!0}}this._sourceTilesOverlap[a.id]=N}_setupProxiedCoordsForImageSource(a,f,v){if(!a.getSource().loaded())return;const S=this.proxiedCoords[a.id]=[],T=this.proxyCoords,N=a.getSource(),z=new o.Point(N.tileID.x,N.tileID.y)._div(1<<N.tileID.z),$=N.coordinates.map(o.MercatorCoordinate.fromLngLat).reduce(((te,ge)=>(te.min.x=Math.min(te.min.x,ge.x-z.x),te.min.y=Math.min(te.min.y,ge.y-z.y),te.max.x=Math.max(te.max.x,ge.x-z.x),te.max.y=Math.max(te.max.y,ge.y-z.y),te)),{min:new o.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),Q=(te,ge)=>{const Ae=te.wrap+te.canonical.x/(1<<te.canonical.z),Le=te.canonical.y/(1<<te.canonical.z),Ze=o.EXTENT/(1<<te.canonical.z),Ue=ge.wrap+ge.canonical.x/(1<<ge.canonical.z),Xe=ge.canonical.y/(1<<ge.canonical.z);return Ae+Ze<Ue+$.min.x||Ae>Ue+$.max.x||Le+Ze<Xe+$.min.y||Le>Xe+$.max.y};for(let te=0;te<T.length;te++){const ge=T[te];for(let Ae=0;Ae<f.length;Ae++){const Le=a.getTile(f[Ae]);if(!Le||!Le.hasData()||Q(ge,Le.tileID))continue;const Ze=this._createProxiedId(ge,Le,v[ge.key]&&v[ge.key][a.id]),Ue=this.proxyToSource[ge.key][a.id];Ue?Ue.push(Ze):this.proxyToSource[ge.key][a.id]=[Ze],S.push(Ze)}}}_createProxiedId(a,f,v){let S=this.orthoMatrix;if(v){const T=v.find((N=>N.key===f.tileID.key));if(T)return T}if(f.tileID.key!==a.key){const T=a.canonical.z-f.tileID.canonical.z;let N,z,$;S=o.create();const Q=f.tileID.wrap-a.wrap<<a.overscaledZ;T>0?(N=o.EXTENT>>T,z=N*((f.tileID.canonical.x<<T)-a.canonical.x+Q),$=N*((f.tileID.canonical.y<<T)-a.canonical.y)):(N=o.EXTENT<<-T,z=o.EXTENT*(f.tileID.canonical.x-(a.canonical.x+Q<<-T)),$=o.EXTENT*(f.tileID.canonical.y-(a.canonical.y<<-T))),o.ortho(S,0,N,0,N,0,1),o.translate(S,S,[z,$,0])}return new se(f.tileID,a.key,S)}_findTileCoveringTileID(a,f){let v=f.getTile(a);if(v&&v.hasData())return v;const S=this._findCoveringTileCache[f.id],T=S[a.key];if(v=T?f.getTileByID(T):null,v&&v.hasData()||T===null)return v;let N=v?v.tileID:a,z=N.overscaledZ;const $=f.getSource().minzoom,Q=[];if(!T){const ge=f.getSource().maxzoom;if(a.canonical.z>=ge){const Ae=a.canonical.z-ge;f.getSource().reparseOverscaled?(z=Math.max(a.canonical.z+2,f.transform.tileZoom),N=new o.OverscaledTileID(z,a.wrap,ge,a.canonical.x>>Ae,a.canonical.y>>Ae)):Ae!==0&&(z=ge,N=new o.OverscaledTileID(z,a.wrap,ge,a.canonical.x>>Ae,a.canonical.y>>Ae))}N.key!==a.key&&(Q.push(N.key),v=f.getTile(N))}const te=ge=>{Q.forEach((Ae=>{S[Ae]=ge})),Q.length=0};for(z-=1;z>=$&&(!v||!v.hasData());z--){v&&te(v.tileID.key);const ge=N.calculateScaledKey(z);if(v=f.getTileByID(ge),v&&v.hasData())break;const Ae=S[ge];if(Ae===null)break;Ae===void 0?Q.push(ge):v=f.getTileByID(Ae)}return te(v?v.tileID.key:null),v&&v.hasData()?v:null}findDEMTileFor(a){return this.enabled?this._findTileCoveringTileID(a,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(a,f){let v=this._tilesDirty[a];v||(v=this._tilesDirty[a]={}),v[f.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const a=(function(f){let v=0;const S=new o.StructArrayLayout2ui4,T=131;for(let N=1;N<129;N++){for(let z=1;z<129;z++)v=N*T+z,S.emplaceBack(v,v+1),S.emplaceBack(v,v+T),S.emplaceBack(v+1,v+T),N===128&&S.emplaceBack(v+T,v+T+1);S.emplaceBack(v+1,v+1+T)}return S})();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(a),this.wireframeSegments=o.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,a.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class He{static cacheKey(a,f,v,S){let T=`${f}${S?S.cacheKey:""}`;for(const N of v)a.usedDefines.includes(N)&&(T+=`/${N}`);return T}constructor(a,f,v,S,T,N){const z=a.gl;this.program=z.createProgram();const $=(function(_e){const Ge=[];for(let it=0;it<_e.length;it++){if(_e[it]===null)continue;const ot=_e[it].split(" ");Ge.push(ot.pop())}return Ge})(v.staticAttributes),Q=S?S.getBinderAttributes():[],te=$.concat(Q);let ge=S?S.defines():[];ge=ge.concat(N.map((_e=>`#define ${_e}`)));const Ae=a.isWebGL2?`#version 300 es
`:"",Le=Ae+ge.concat(a.extStandardDerivatives&&Ae.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(pt):pt,pt,Ce,W.fragmentSource,Gs.fragmentSource,v.fragmentSource).join(`
`),Ze=Ae+ge.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Ce,W.vertexSource,Gs.vertexSource,$s.vertexSource,v.vertexSource).join(`
`),Ue=z.createShader(z.FRAGMENT_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);z.shaderSource(Ue,Le),z.compileShader(Ue),z.attachShader(this.program,Ue);const Xe=z.createShader(z.VERTEX_SHADER);if(z.isContextLost())this.failedToCreate=!0;else{z.shaderSource(Xe,Ze),z.compileShader(Xe),z.attachShader(this.program,Xe),this.attributes={},this.numAttributes=te.length;for(let _e=0;_e<this.numAttributes;_e++)te[_e]&&(z.bindAttribLocation(this.program,_e,te[_e]),this.attributes[te[_e]]=_e);z.linkProgram(this.program),z.deleteShader(Xe),z.deleteShader(Ue),this.fixedUniforms=T(a),this.binderUniforms=S?S.getUniforms(a):[],N.includes("TERRAIN")&&(this.terrainUniforms=(_e=>({u_dem:new o.Uniform1i(_e),u_dem_prev:new o.Uniform1i(_e),u_dem_unpack:new o.Uniform4f(_e),u_dem_tl:new o.Uniform2f(_e),u_dem_scale:new o.Uniform1f(_e),u_dem_tl_prev:new o.Uniform2f(_e),u_dem_scale_prev:new o.Uniform1f(_e),u_dem_size:new o.Uniform1f(_e),u_dem_lerp:new o.Uniform1f(_e),u_exaggeration:new o.Uniform1f(_e),u_depth:new o.Uniform1i(_e),u_depth_size_inv:new o.Uniform2f(_e),u_meter_to_dem:new o.Uniform1f(_e),u_label_plane_matrix_inv:new o.UniformMatrix4f(_e)}))(a)),N.includes("GLOBE")&&(this.globeUniforms=(_e=>({u_tile_tl_up:new o.Uniform3f(_e),u_tile_tr_up:new o.Uniform3f(_e),u_tile_br_up:new o.Uniform3f(_e),u_tile_bl_up:new o.Uniform3f(_e),u_tile_up_scale:new o.Uniform1f(_e)}))(a)),N.includes("FOG")&&(this.fogUniforms=(_e=>({u_fog_matrix:new o.UniformMatrix4f(_e),u_fog_range:new o.Uniform2f(_e),u_fog_color:new o.Uniform4f(_e),u_fog_horizon_blend:new o.Uniform1f(_e),u_fog_temporal_offset:new o.Uniform1f(_e),u_frustum_tl:new o.Uniform3f(_e),u_frustum_tr:new o.Uniform3f(_e),u_frustum_br:new o.Uniform3f(_e),u_frustum_bl:new o.Uniform3f(_e),u_globe_pos:new o.Uniform3f(_e),u_globe_radius:new o.Uniform1f(_e),u_globe_transition:new o.Uniform1f(_e),u_is_globe:new o.Uniform1i(_e),u_viewport:new o.Uniform2f(_e)}))(a))}}setTerrainUniformValues(a,f){if(!this.terrainUniforms)return;const v=this.terrainUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const S in f)v[S]&&v[S].set(this.program,S,f[S])}}setGlobeUniformValues(a,f){if(!this.globeUniforms)return;const v=this.globeUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const S in f)v[S]&&v[S].set(this.program,S,f[S])}}setFogUniformValues(a,f){if(!this.fogUniforms)return;const v=this.fogUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const S in f)v[S].set(this.program,S,f[S])}}draw(a,f,v,S,T,N,z,$,Q,te,ge,Ae,Le,Ze,Ue){const Xe=a.gl;if(this.failedToCreate)return;a.program.set(this.program),a.setDepthMode(v),a.setStencilMode(S),a.setColorMode(T),a.setCullFace(N);for(const Ge of Object.keys(this.fixedUniforms))this.fixedUniforms[Ge].set(this.program,Ge,z[Ge]);Ze&&Ze.setUniforms(this.program,a,this.binderUniforms,Ae,{zoom:Le});const _e={[Xe.LINES]:2,[Xe.TRIANGLES]:3,[Xe.LINE_STRIP]:1}[f];for(const Ge of ge.get()){const it=Ge.vaos||(Ge.vaos={});(it[$]||(it[$]=new Fn)).bind(a,this,Q,Ze?Ze.getPaintVertexBuffers():[],te,Ge.vertexOffset,Ue||[]),Xe.drawElements(f,Ge.primitiveLength*_e,Xe.UNSIGNED_SHORT,Ge.primitiveOffset*_e*2)}}}function Xt(y,a){const f=Math.pow(2,a.tileID.overscaledZ),v=a.tileSize*Math.pow(2,y.transform.tileZoom)/f,S=v*(a.tileID.canonical.x+a.tileID.wrap*f),T=v*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_tile_units_to_pixels:1/le(a,1,y.transform.tileZoom),u_pixel_coord_upper:[S>>16,T>>16],u_pixel_coord_lower:[65535&S,65535&T]}}const fn=o.create(),ar=(y,a,f,v,S,T,N,z,$,Q,te)=>{const ge=a.style.light,Ae=ge.properties.get("position"),Le=[Ae.x,Ae.y,Ae.z],Ze=o.create$1();ge.properties.get("anchor")==="viewport"&&(o.fromRotation(Ze,-a.transform.angle),o.transformMat3(Le,Le,Ze));const Ue=ge.properties.get("color"),Xe=a.transform,_e={u_matrix:y,u_lightpos:Le,u_lightintensity:ge.properties.get("intensity"),u_lightcolor:[Ue.r,Ue.g,Ue.b],u_vertical_gradient:+f,u_opacity:v,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:fn,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:S,u_edge_radius:T};return Xe.projection.name==="globe"&&(_e.u_tile_id=[N.canonical.x,N.canonical.y,1<<N.canonical.z],_e.u_zoom_transition=$,_e.u_inv_rot_matrix=te,_e.u_merc_center=Q,_e.u_up_dir=Xe.projection.upVector(new o.CanonicalTileID(0,0,0),Q[0]*o.EXTENT,Q[1]*o.EXTENT),_e.u_height_lift=z),_e},ao=(y,a,f,v,S,T,N,z,$,Q,te,ge)=>{const Ae=ar(y,a,f,v,S,T,N,$,Q,te,ge),Le={u_height_factor:-Math.pow(2,N.overscaledZ)/z.tileSize/8};return o.extend(Ae,Xt(a,z),Le)},Fo=y=>({u_matrix:y}),qi=(y,a,f)=>o.extend(Fo(y),Xt(a,f)),Di=(y,a)=>({u_matrix:y,u_world:a}),Ro=(y,a,f,v)=>o.extend(qi(y,a,f),{u_world:v}),sa=o.create(),Oo=(y,a,f,v,S,T)=>{const N=y.transform,z=N.projection.name==="globe";let $;if(T.paint.get("circle-pitch-alignment")==="map")if(z){const te=o.globePixelsToTileUnits(N.zoom,a.canonical)*N._pixelsPerMercatorPixel;$=Float32Array.from([te,0,0,te])}else $=N.calculatePixelsToTileUnitsMatrix(f);else $=new Float32Array([N.pixelsToGLUnits[0],0,0,N.pixelsToGLUnits[1]]);const Q={u_camera_to_center_distance:N.cameraToCenterDistance,u_matrix:y.translatePosMatrix(a.projMatrix,f,T.paint.get("circle-translate"),T.paint.get("circle-translate-anchor")),u_device_pixel_ratio:o.exported.devicePixelRatio,u_extrude_scale:$,u_inv_rot_matrix:sa,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(z){Q.u_inv_rot_matrix=v,Q.u_merc_center=S,Q.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],Q.u_zoom_transition=o.globeToMercatorTransition(N.zoom);const te=S[0]*o.EXTENT,ge=S[1]*o.EXTENT;Q.u_up_dir=N.projection.upVector(new o.CanonicalTileID(0,0,0),te,ge)}return Q},Ji=y=>{const a=[];return y.paint.get("circle-pitch-alignment")==="map"&&a.push("PITCH_WITH_MAP"),y.paint.get("circle-pitch-scale")==="map"&&a.push("SCALE_WITH_MAP"),a},Rl=(y,a,f,v)=>{const S=o.EXTENT/f.tileSize;return{u_matrix:y,u_camera_to_center_distance:a.getCameraToCenterDistance(v),u_extrude_scale:[a.pixelsToGLUnits[0]/S,a.pixelsToGLUnits[1]/S]}},Ia=(y,a,f=1)=>({u_matrix:y,u_color:a,u_overlay:0,u_overlay_scale:f}),Ru=o.create(),hl=(y,a,f,v,S,T,N)=>{const z=y.transform,$=z.projection.name==="globe",Q=$?o.globePixelsToTileUnits(z.zoom,a.canonical)*z._pixelsPerMercatorPixel:le(f,1,T),te={u_matrix:a.projMatrix,u_extrude_scale:Q,u_intensity:N,u_inv_rot_matrix:Ru,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if($){te.u_inv_rot_matrix=v,te.u_merc_center=S,te.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],te.u_zoom_transition=o.globeToMercatorTransition(z.zoom);const ge=S[0]*o.EXTENT,Ae=S[1]*o.EXTENT;te.u_up_dir=z.projection.upVector(new o.CanonicalTileID(0,0,0),ge,Ae)}return te},Nl=(y,a,f,v,S,T,N)=>{const z=y.transform,$=z.calculatePixelsToTileUnitsMatrix(a);return{u_matrix:aa(y,a,f,v),u_pixels_to_tile_units:$,u_device_pixel_ratio:T,u_units_to_pixels:[1/z.pixelsToGLUnits[0],1/z.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:S,u_texsize:Dl(f)?a.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:No(a,y.transform),u_alpha_discard_threshold:0,u_trim_offset:N}},dl=(y,a,f,v,S)=>{const T=y.transform;return{u_matrix:aa(y,a,f,v),u_texsize:a.imageAtlasTexture.size,u_pixels_to_tile_units:T.calculatePixelsToTileUnitsMatrix(a),u_device_pixel_ratio:S,u_image:0,u_tile_units_to_pixels:No(a,T),u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function No(y,a){return 1/le(y,1,a.tileZoom)}function aa(y,a,f,v){return y.translatePosMatrix(v||a.tileID.projMatrix,a,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}function Dl(y){const a=y.paint.get("line-dasharray").value;return a.value||a.kind!=="constant"}const Ec=(y,a,f,v,S,T)=>{return{u_matrix:y,u_tl_parent:a,u_scale_parent:f,u_fade_t:v.mix,u_opacity:v.opacity*S.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:S.paint.get("raster-brightness-min"),u_brightness_high:S.paint.get("raster-brightness-max"),u_saturation_factor:(z=S.paint.get("raster-saturation"),z>0?1-1/(1.001-z):-z),u_contrast_factor:(N=S.paint.get("raster-contrast"),N>0?1/(1-N):1+N),u_spin_weights:ma(S.paint.get("raster-hue-rotate")),u_perspective_transform:T};var N,z};function ma(y){y*=Math.PI/180;const a=Math.sin(y),f=Math.cos(y);return[(2*f+1)/3,(-Math.sqrt(3)*a-f+1)/3,(Math.sqrt(3)*a-f+1)/3]}const Lo=o.create(),$o=(y,a,f,v,S,T,N,z,$,Q,te,ge,Ae,Le,Ze,Ue)=>{const Xe=S.transform,_e={u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:Xe.cameraToCenterDistance,u_rotate_symbol:+f,u_aspect_ratio:Xe.width/Xe.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_matrix:T,u_label_plane_matrix:N,u_coord_matrix:z,u_is_text:+$,u_pitch_with_map:+v,u_texsize:Q,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Lo,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Lo,u_up_vector:[0,-1,0]};return Ue.name==="globe"&&(_e.u_tile_id=[te.canonical.x,te.canonical.y,1<<te.canonical.z],_e.u_zoom_transition=ge,_e.u_inv_rot_matrix=Le,_e.u_merc_center=Ae,_e.u_camera_forward=Xe._camera.forward(),_e.u_ecef_origin=o.globeECEFOrigin(Xe.globeMatrix,te.toUnwrapped()),_e.u_tile_matrix=Float32Array.from(Xe.globeMatrix),_e.u_up_vector=Ze),_e},Ca=(y,a,f,v,S,T,N,z,$,Q,te,ge,Ae,Le,Ze,Ue,Xe)=>o.extend($o(y,a,f,v,S,T,N,z,$,Q,ge,Ae,Le,Ze,Ue,Xe),{u_gamma_scale:v?S.transform.cameraToCenterDistance*Math.cos(S.terrain?0:S.transform._pitch):1,u_device_pixel_ratio:o.exported.devicePixelRatio,u_is_halo:1}),rc=(y,a,f,v,S,T,N,z,$,Q,te,ge,Ae,Le,Ze,Ue)=>o.extend(Ca(y,a,f,v,S,T,N,z,!0,$,!0,te,ge,Ae,Le,Ze,Ue),{u_texsize_icon:Q,u_texture_icon:1}),fl=(y,a,f)=>({u_matrix:y,u_opacity:a,u_color:f}),Nu=(y,a,f,v,S)=>o.extend((function(T,N,z){const $=N.imageManager.getPattern(T.toString()),{width:Q,height:te}=N.imageManager.getPixelSize(),ge=Math.pow(2,z.tileID.overscaledZ),Ae=z.tileSize*Math.pow(2,N.transform.tileZoom)/ge,Le=Ae*(z.tileID.canonical.x+z.tileID.wrap*ge),Ze=Ae*z.tileID.canonical.y;return{u_image:0,u_pattern_tl:$.tl,u_pattern_br:$.br,u_texsize:[Q,te],u_pattern_size:$.displaySize,u_tile_units_to_pixels:1/le(z,1,N.transform.tileZoom),u_pixel_coord_upper:[Le>>16,Ze>>16],u_pixel_coord_lower:[65535&Le,65535&Ze]}})(v,f,S),{u_matrix:y,u_opacity:a}),el={fillExtrusion:y=>({u_matrix:new o.UniformMatrix4f(y),u_lightpos:new o.Uniform3f(y),u_lightintensity:new o.Uniform1f(y),u_lightcolor:new o.Uniform3f(y),u_vertical_gradient:new o.Uniform1f(y),u_opacity:new o.Uniform1f(y),u_edge_radius:new o.Uniform1f(y),u_ao:new o.Uniform2f(y),u_tile_id:new o.Uniform3f(y),u_zoom_transition:new o.Uniform1f(y),u_inv_rot_matrix:new o.UniformMatrix4f(y),u_merc_center:new o.Uniform2f(y),u_up_dir:new o.Uniform3f(y),u_height_lift:new o.Uniform1f(y)}),fillExtrusionPattern:y=>({u_matrix:new o.UniformMatrix4f(y),u_lightpos:new o.Uniform3f(y),u_lightintensity:new o.Uniform1f(y),u_lightcolor:new o.Uniform3f(y),u_vertical_gradient:new o.Uniform1f(y),u_height_factor:new o.Uniform1f(y),u_edge_radius:new o.Uniform1f(y),u_ao:new o.Uniform2f(y),u_tile_id:new o.Uniform3f(y),u_zoom_transition:new o.Uniform1f(y),u_inv_rot_matrix:new o.UniformMatrix4f(y),u_merc_center:new o.Uniform2f(y),u_up_dir:new o.Uniform3f(y),u_height_lift:new o.Uniform1f(y),u_image:new o.Uniform1i(y),u_texsize:new o.Uniform2f(y),u_pixel_coord_upper:new o.Uniform2f(y),u_pixel_coord_lower:new o.Uniform2f(y),u_tile_units_to_pixels:new o.Uniform1f(y),u_opacity:new o.Uniform1f(y)}),fill:y=>({u_matrix:new o.UniformMatrix4f(y)}),fillPattern:y=>({u_matrix:new o.UniformMatrix4f(y),u_image:new o.Uniform1i(y),u_texsize:new o.Uniform2f(y),u_pixel_coord_upper:new o.Uniform2f(y),u_pixel_coord_lower:new o.Uniform2f(y),u_tile_units_to_pixels:new o.Uniform1f(y)}),fillOutline:y=>({u_matrix:new o.UniformMatrix4f(y),u_world:new o.Uniform2f(y)}),fillOutlinePattern:y=>({u_matrix:new o.UniformMatrix4f(y),u_world:new o.Uniform2f(y),u_image:new o.Uniform1i(y),u_texsize:new o.Uniform2f(y),u_pixel_coord_upper:new o.Uniform2f(y),u_pixel_coord_lower:new o.Uniform2f(y),u_tile_units_to_pixels:new o.Uniform1f(y)}),circle:y=>({u_camera_to_center_distance:new o.Uniform1f(y),u_extrude_scale:new o.UniformMatrix2f(y),u_device_pixel_ratio:new o.Uniform1f(y),u_matrix:new o.UniformMatrix4f(y),u_inv_rot_matrix:new o.UniformMatrix4f(y),u_merc_center:new o.Uniform2f(y),u_tile_id:new o.Uniform3f(y),u_zoom_transition:new o.Uniform1f(y),u_up_dir:new o.Uniform3f(y)}),collisionBox:y=>({u_matrix:new o.UniformMatrix4f(y),u_camera_to_center_distance:new o.Uniform1f(y),u_extrude_scale:new o.Uniform2f(y)}),collisionCircle:y=>({u_matrix:new o.UniformMatrix4f(y),u_inv_matrix:new o.UniformMatrix4f(y),u_camera_to_center_distance:new o.Uniform1f(y),u_viewport_size:new o.Uniform2f(y)}),debug:y=>({u_color:new o.UniformColor(y),u_matrix:new o.UniformMatrix4f(y),u_overlay:new o.Uniform1i(y),u_overlay_scale:new o.Uniform1f(y)}),clippingMask:y=>({u_matrix:new o.UniformMatrix4f(y)}),heatmap:y=>({u_extrude_scale:new o.Uniform1f(y),u_intensity:new o.Uniform1f(y),u_matrix:new o.UniformMatrix4f(y),u_inv_rot_matrix:new o.UniformMatrix4f(y),u_merc_center:new o.Uniform2f(y),u_tile_id:new o.Uniform3f(y),u_zoom_transition:new o.Uniform1f(y),u_up_dir:new o.Uniform3f(y)}),heatmapTexture:y=>({u_image:new o.Uniform1i(y),u_color_ramp:new o.Uniform1i(y),u_opacity:new o.Uniform1f(y)}),hillshade:y=>({u_matrix:new o.UniformMatrix4f(y),u_image:new o.Uniform1i(y),u_latrange:new o.Uniform2f(y),u_light:new o.Uniform2f(y),u_shadow:new o.UniformColor(y),u_highlight:new o.UniformColor(y),u_accent:new o.UniformColor(y)}),hillshadePrepare:y=>({u_matrix:new o.UniformMatrix4f(y),u_image:new o.Uniform1i(y),u_dimension:new o.Uniform2f(y),u_zoom:new o.Uniform1f(y),u_unpack:new o.Uniform4f(y)}),line:y=>({u_matrix:new o.UniformMatrix4f(y),u_pixels_to_tile_units:new o.UniformMatrix2f(y),u_device_pixel_ratio:new o.Uniform1f(y),u_units_to_pixels:new o.Uniform2f(y),u_dash_image:new o.Uniform1i(y),u_gradient_image:new o.Uniform1i(y),u_image_height:new o.Uniform1f(y),u_texsize:new o.Uniform2f(y),u_tile_units_to_pixels:new o.Uniform1f(y),u_alpha_discard_threshold:new o.Uniform1f(y),u_trim_offset:new o.Uniform2f(y)}),linePattern:y=>({u_matrix:new o.UniformMatrix4f(y),u_texsize:new o.Uniform2f(y),u_pixels_to_tile_units:new o.UniformMatrix2f(y),u_device_pixel_ratio:new o.Uniform1f(y),u_image:new o.Uniform1i(y),u_units_to_pixels:new o.Uniform2f(y),u_tile_units_to_pixels:new o.Uniform1f(y),u_alpha_discard_threshold:new o.Uniform1f(y)}),raster:y=>({u_matrix:new o.UniformMatrix4f(y),u_tl_parent:new o.Uniform2f(y),u_scale_parent:new o.Uniform1f(y),u_fade_t:new o.Uniform1f(y),u_opacity:new o.Uniform1f(y),u_image0:new o.Uniform1i(y),u_image1:new o.Uniform1i(y),u_brightness_low:new o.Uniform1f(y),u_brightness_high:new o.Uniform1f(y),u_saturation_factor:new o.Uniform1f(y),u_contrast_factor:new o.Uniform1f(y),u_spin_weights:new o.Uniform3f(y),u_perspective_transform:new o.Uniform2f(y)}),symbolIcon:y=>({u_is_size_zoom_constant:new o.Uniform1i(y),u_is_size_feature_constant:new o.Uniform1i(y),u_size_t:new o.Uniform1f(y),u_size:new o.Uniform1f(y),u_camera_to_center_distance:new o.Uniform1f(y),u_rotate_symbol:new o.Uniform1i(y),u_aspect_ratio:new o.Uniform1f(y),u_fade_change:new o.Uniform1f(y),u_matrix:new o.UniformMatrix4f(y),u_label_plane_matrix:new o.UniformMatrix4f(y),u_coord_matrix:new o.UniformMatrix4f(y),u_is_text:new o.Uniform1i(y),u_pitch_with_map:new o.Uniform1i(y),u_texsize:new o.Uniform2f(y),u_tile_id:new o.Uniform3f(y),u_zoom_transition:new o.Uniform1f(y),u_inv_rot_matrix:new o.UniformMatrix4f(y),u_merc_center:new o.Uniform2f(y),u_camera_forward:new o.Uniform3f(y),u_tile_matrix:new o.UniformMatrix4f(y),u_up_vector:new o.Uniform3f(y),u_ecef_origin:new o.Uniform3f(y),u_texture:new o.Uniform1i(y)}),symbolSDF:y=>({u_is_size_zoom_constant:new o.Uniform1i(y),u_is_size_feature_constant:new o.Uniform1i(y),u_size_t:new o.Uniform1f(y),u_size:new o.Uniform1f(y),u_camera_to_center_distance:new o.Uniform1f(y),u_rotate_symbol:new o.Uniform1i(y),u_aspect_ratio:new o.Uniform1f(y),u_fade_change:new o.Uniform1f(y),u_matrix:new o.UniformMatrix4f(y),u_label_plane_matrix:new o.UniformMatrix4f(y),u_coord_matrix:new o.UniformMatrix4f(y),u_is_text:new o.Uniform1i(y),u_pitch_with_map:new o.Uniform1i(y),u_texsize:new o.Uniform2f(y),u_texture:new o.Uniform1i(y),u_gamma_scale:new o.Uniform1f(y),u_device_pixel_ratio:new o.Uniform1f(y),u_tile_id:new o.Uniform3f(y),u_zoom_transition:new o.Uniform1f(y),u_inv_rot_matrix:new o.UniformMatrix4f(y),u_merc_center:new o.Uniform2f(y),u_camera_forward:new o.Uniform3f(y),u_tile_matrix:new o.UniformMatrix4f(y),u_up_vector:new o.Uniform3f(y),u_ecef_origin:new o.Uniform3f(y),u_is_halo:new o.Uniform1i(y)}),symbolTextAndIcon:y=>({u_is_size_zoom_constant:new o.Uniform1i(y),u_is_size_feature_constant:new o.Uniform1i(y),u_size_t:new o.Uniform1f(y),u_size:new o.Uniform1f(y),u_camera_to_center_distance:new o.Uniform1f(y),u_rotate_symbol:new o.Uniform1i(y),u_aspect_ratio:new o.Uniform1f(y),u_fade_change:new o.Uniform1f(y),u_matrix:new o.UniformMatrix4f(y),u_label_plane_matrix:new o.UniformMatrix4f(y),u_coord_matrix:new o.UniformMatrix4f(y),u_is_text:new o.Uniform1i(y),u_pitch_with_map:new o.Uniform1i(y),u_texsize:new o.Uniform2f(y),u_texsize_icon:new o.Uniform2f(y),u_texture:new o.Uniform1i(y),u_texture_icon:new o.Uniform1i(y),u_gamma_scale:new o.Uniform1f(y),u_device_pixel_ratio:new o.Uniform1f(y),u_is_halo:new o.Uniform1i(y)}),background:y=>({u_matrix:new o.UniformMatrix4f(y),u_opacity:new o.Uniform1f(y),u_color:new o.UniformColor(y)}),backgroundPattern:y=>({u_matrix:new o.UniformMatrix4f(y),u_opacity:new o.Uniform1f(y),u_image:new o.Uniform1i(y),u_pattern_tl:new o.Uniform2f(y),u_pattern_br:new o.Uniform2f(y),u_texsize:new o.Uniform2f(y),u_pattern_size:new o.Uniform2f(y),u_pixel_coord_upper:new o.Uniform2f(y),u_pixel_coord_lower:new o.Uniform2f(y),u_tile_units_to_pixels:new o.Uniform1f(y)}),terrainRaster:yo,terrainDepth:yo,skybox:y=>({u_matrix:new o.UniformMatrix4f(y),u_sun_direction:new o.Uniform3f(y),u_cubemap:new o.Uniform1i(y),u_opacity:new o.Uniform1f(y),u_temporal_offset:new o.Uniform1f(y)}),skyboxGradient:y=>({u_matrix:new o.UniformMatrix4f(y),u_color_ramp:new o.Uniform1i(y),u_center_direction:new o.Uniform3f(y),u_radius:new o.Uniform1f(y),u_opacity:new o.Uniform1f(y),u_temporal_offset:new o.Uniform1f(y)}),skyboxCapture:y=>({u_matrix_3f:new o.UniformMatrix3f(y),u_sun_direction:new o.Uniform3f(y),u_sun_intensity:new o.Uniform1f(y),u_color_tint_r:new o.Uniform4f(y),u_color_tint_m:new o.Uniform4f(y),u_luminance:new o.Uniform1f(y)}),globeRaster:y=>({u_proj_matrix:new o.UniformMatrix4f(y),u_globe_matrix:new o.UniformMatrix4f(y),u_normalize_matrix:new o.UniformMatrix4f(y),u_merc_matrix:new o.UniformMatrix4f(y),u_zoom_transition:new o.Uniform1f(y),u_merc_center:new o.Uniform2f(y),u_image0:new o.Uniform1i(y),u_grid_matrix:new o.UniformMatrix3f(y),u_skirt_height:new o.Uniform1f(y),u_frustum_tl:new o.Uniform3f(y),u_frustum_tr:new o.Uniform3f(y),u_frustum_br:new o.Uniform3f(y),u_frustum_bl:new o.Uniform3f(y),u_globe_pos:new o.Uniform3f(y),u_globe_radius:new o.Uniform1f(y),u_viewport:new o.Uniform2f(y)}),globeAtmosphere:y=>({u_frustum_tl:new o.Uniform3f(y),u_frustum_tr:new o.Uniform3f(y),u_frustum_br:new o.Uniform3f(y),u_frustum_bl:new o.Uniform3f(y),u_horizon:new o.Uniform1f(y),u_transition:new o.Uniform1f(y),u_fadeout_range:new o.Uniform1f(y),u_color:new o.Uniform4f(y),u_high_color:new o.Uniform4f(y),u_space_color:new o.Uniform4f(y),u_star_intensity:new o.Uniform1f(y),u_star_density:new o.Uniform1f(y),u_star_size:new o.Uniform1f(y),u_temporal_offset:new o.Uniform1f(y),u_horizon_angle:new o.Uniform1f(y),u_rotation_matrix:new o.UniformMatrix4f(y)})};let Ac;function Al(y,a,f,v,S,T,N){const z=y.context,$=z.gl,Q=y.transform,te=y.useProgram("collisionBox"),ge=[];let Ae=0,Le=0;for(let ot=0;ot<v.length;ot++){const bt=v[ot],wt=a.getTile(bt),_t=wt.getBucket(f);if(!_t)continue;const Pt=fs(bt,_t,Q);let kt=Pt;S[0]===0&&S[1]===0||(kt=y.translatePosMatrix(Pt,wt,S,T));const jt=N?_t.textCollisionBox:_t.iconCollisionBox,_n=_t.collisionCircleArray;if(_n.length>0){const Ut=o.create(),cn=kt;o.mul(Ut,_t.placementInvProjMatrix,Q.glCoordMatrix),o.mul(Ut,Ut,_t.placementViewportMatrix),ge.push({circleArray:_n,circleOffset:Le,transform:cn,invTransform:Ut,projection:_t.getProjection()}),Ae+=_n.length/4,Le=Ae}jt&&(y.terrain&&y.terrain.setupElevationDraw(wt,te),te.draw(z,$.LINES,o.DepthMode.disabled,o.StencilMode.disabled,y.colorModeForRenderPass(),o.CullFaceMode.disabled,Rl(kt,Q,wt,_t.getProjection()),f.id,jt.layoutVertexBuffer,jt.indexBuffer,jt.segments,null,Q.zoom,null,[jt.collisionVertexBuffer,jt.collisionVertexBufferExt]))}if(!N||!ge.length)return;const Ze=y.useProgram("collisionCircle"),Ue=new o.StructArrayLayout2f1f2i16;Ue.resize(4*Ae),Ue._trim();let Xe=0;for(const ot of ge)for(let bt=0;bt<ot.circleArray.length/4;bt++){const wt=4*bt,_t=ot.circleArray[wt+0],Pt=ot.circleArray[wt+1],kt=ot.circleArray[wt+2],jt=ot.circleArray[wt+3];Ue.emplace(Xe++,_t,Pt,kt,jt,0),Ue.emplace(Xe++,_t,Pt,kt,jt,1),Ue.emplace(Xe++,_t,Pt,kt,jt,2),Ue.emplace(Xe++,_t,Pt,kt,jt,3)}(!Ac||Ac.length<2*Ae)&&(Ac=(function(ot){const bt=2*ot,wt=new o.StructArrayLayout3ui6;wt.resize(bt),wt._trim();for(let _t=0;_t<bt;_t++){const Pt=6*_t;wt.uint16[Pt+0]=4*_t+0,wt.uint16[Pt+1]=4*_t+1,wt.uint16[Pt+2]=4*_t+2,wt.uint16[Pt+3]=4*_t+2,wt.uint16[Pt+4]=4*_t+3,wt.uint16[Pt+5]=4*_t+0}return wt})(Ae));const _e=z.createIndexBuffer(Ac,!0),Ge=z.createVertexBuffer(Ue,o.collisionCircleLayout.members,!0);for(const ot of ge){const bt={u_matrix:ot.transform,u_inv_matrix:ot.invTransform,u_camera_to_center_distance:(it=Q).getCameraToCenterDistance(ot.projection),u_viewport_size:[it.width,it.height]};Ze.draw(z,$.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,y.colorModeForRenderPass(),o.CullFaceMode.disabled,bt,f.id,Ge,_e,o.SegmentVector.simpleSegment(0,2*ot.circleOffset,ot.circleArray.length,ot.circleArray.length/2),null,Q.zoom)}var it;Ge.destroy(),_e.destroy()}const pl=o.create();function ic({width:y,height:a,anchor:f,textOffset:v,textScale:S},T){const{horizontalAlign:N,verticalAlign:z}=o.getAnchorAlignment(f),$=-(N-.5)*y,Q=-(z-.5)*a,te=o.evaluateVariableOffset(f,v);return new o.Point(($/S+te[0])*T,(Q/S+te[1])*T)}function Fl(y,a,f,v,S,T,N,z,$,Q,te){const ge=y.text.placedSymbolArray,Ae=y.text.dynamicLayoutVertexArray,Le=y.icon.dynamicLayoutVertexArray,Ze={},Ue=y.getProjection(),Xe=Fi(z,Ue,T),_e=T.elevation,Ge=Ue.upVectorScale(z.canonical,T.center.lat,T.worldSize).metersToTile;Ae.clear();for(let it=0;it<ge.length;it++){const ot=ge.get(it),{tileAnchorX:bt,tileAnchorY:wt,numGlyphs:_t}=ot,Pt=ot.hidden||!ot.crossTileID||y.allowVerticalPlacement&&!ot.placedOrientation?null:v[ot.crossTileID];if(Pt){let kt=0,jt=0,_n=0;if(_e){const Rn=_e?_e.getAtTileOffset(z,bt,wt):0,[hr,mr,sr]=Ue.upVector(z.canonical,bt,wt);kt=Rn*hr*Ge,jt=Rn*mr*Ge,_n=Rn*sr*Ge}let[Ut,cn,Wt,In]=vi(ot.projectedAnchorX+kt,ot.projectedAnchorY+jt,ot.projectedAnchorZ+_n,f?Xe:N);const Bt=gu(T.getCameraToCenterDistance(Ue),In);let Yt=S.evaluateSizeForFeature(y.textSizeData,Q,ot)*Bt/o.ONE_EM;f&&(Yt*=y.tilePixelRatio/$);const Tn=ic(Pt,Yt);f?({x:Ut,y:cn,z:Wt}=Ue.projectTilePoint(bt+Tn.x,wt+Tn.y,z.canonical),[Ut,cn,Wt]=vi(Ut+kt,cn+jt,Wt+_n,N)):(a&&Tn._rotate(-T.angle),Ut+=Tn.x,cn+=Tn.y,Wt=0);const bn=y.allowVerticalPlacement&&ot.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let Rn=0;Rn<_t;Rn++)o.addDynamicAttributes(Ae,Ut,cn,Wt,bn);te&&ot.associatedIconIndex>=0&&(Ze[ot.associatedIconIndex]={x:Ut,y:cn,z:Wt,angle:bn})}else Ta(_t,Ae)}if(te){Le.clear();const it=y.icon.placedSymbolArray;for(let ot=0;ot<it.length;ot++){const bt=it.get(ot),{numGlyphs:wt}=bt,_t=Ze[ot];if(bt.hidden||!_t)Ta(wt,Le);else{const{x:Pt,y:kt,z:jt,angle:_n}=_t;for(let Ut=0;Ut<wt;Ut++)o.addDynamicAttributes(Le,Pt,kt,jt,_n)}}y.icon.dynamicLayoutVertexBuffer.updateData(Le)}y.text.dynamicLayoutVertexBuffer.updateData(Ae)}function _u(y,a,f){return f.iconsInText&&a?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function vs(y,a,f,v,S,T,N,z,$,Q,te,ge){const Ae=y.context,Le=Ae.gl,Ze=y.transform,Ue=z==="map",Xe=$==="map",_e=Ue&&f.layout.get("symbol-placement")!=="point",Ge=Ue&&!Xe&&!_e,it=f.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ot=!1;const bt=y.depthModeForSublayer(0,o.DepthMode.ReadOnly),wt=[o.mercatorXfromLng(Ze.center.lng),o.mercatorYfromLat(Ze.center.lat)],_t=f.layout.get("text-variable-anchor"),Pt=Ze.projection.name==="globe",kt=[],jt=[0,-1,0];let _n=jt;!Pt&&!Ze.mercatorFromTransition||Ue||(_n=(function(Ut){const cn=Ut._camera.getWorldToCamera(Ut.worldSize,1),Wt=o.multiply([],cn,Ut.globeMatrix);o.invert(Wt,Wt);const In=[0,0,0],Bt=[0,1,0,0];return o.transformMat4$1(Bt,Bt,Wt),In[0]=Bt[0],In[1]=Bt[1],In[2]=Bt[2],o.normalize(In,In),In})(Ze));for(const Ut of v){const cn=a.getTile(Ut),Wt=cn.getBucket(f);if(!Wt||Wt.projection.name==="mercator"&&Pt)continue;const In=S?Wt.text:Wt.icon;if(!In||Wt.fullyClipped||!In.segments.get().length)continue;const Bt=In.programConfigurations.get(f.id),Yt=S||Wt.sdfIcons,Tn=S?Wt.textSizeData:Wt.iconSizeData,bn=Xe||Ze.pitch!==0,Rn=o.evaluateSizeForZoom(Tn,Ze.zoom);let hr,mr,sr,dr,oi=[0,0],di=null;if(S)mr=cn.glyphAtlasTexture,sr=Le.LINEAR,hr=cn.glyphAtlasTexture.size,Wt.iconsInText&&(oi=cn.imageAtlasTexture.size,di=cn.imageAtlasTexture,dr=bn||y.options.rotating||y.options.zooming||Tn.kind==="composite"||Tn.kind==="camera"?Le.LINEAR:Le.NEAREST);else{const ql=f.layout.get("icon-size").constantOr(0)!==1||Wt.iconsNeedLinear;mr=cn.imageAtlasTexture,sr=Yt||y.options.rotating||y.options.zooming||ql||bn?Le.LINEAR:Le.NEAREST,hr=cn.imageAtlasTexture.size}const _r=Wt.projection.name==="globe",Zr=_r?_n:jt,Pi=_r?o.globeToMercatorTransition(Ze.zoom):0,io=Fi(Ut,Wt.getProjection(),Ze),oo=Ze.calculatePixelsToTileUnitsMatrix(cn),ua=pn(io,cn.tileID.canonical,Xe,Ue,Ze,Wt.getProjection(),oo),us=y.terrain&&Xe&&_e?o.invert(o.create(),ua):pl,uc=ss(io,cn.tileID.canonical,Xe,Ue,Ze,Wt.getProjection(),oo),Pc=_t&&Wt.hasTextData(),Ci=f.layout.get("icon-text-fit")!=="none"&&Pc&&Wt.hasIconData();if(_e){const ql=Ze.elevation,Il=ql?ql.getAtTileOffsetFunc(Ut,Ze.center.lat,Ze.worldSize,Wt.getProjection()):null,Gc=Yo(io,cn.tileID.canonical,Xe,Ue,Ze,Wt.getProjection(),oo);Ya(Wt,io,y,S,Gc,uc,Xe,Q,Il,Ut)}const Qi=_e||S&&_t||Ci,bo=y.translatePosMatrix(io,cn,T,N),Ts=Qi?pl:ua,Va=y.translatePosMatrix(uc,cn,T,N,!0),ts=Wt.getProjection().createInversionMatrix(Ze,Ut.canonical),ps=[];y.terrainRenderModeElevated()&&Xe&&ps.push("PITCH_WITH_MAP_TERRAIN"),_r&&ps.push("PROJECTION_GLOBE_VIEW"),Qi&&ps.push("PROJECTED_POS_ON_VIEWPORT");const hs=Yt&&f.paint.get(S?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let bs;bs=Yt?Wt.iconsInText?rc(Tn.kind,Rn,Ge,Xe,y,bo,Ts,Va,hr,oi,Ut,Pi,wt,ts,Zr,Wt.getProjection()):Ca(Tn.kind,Rn,Ge,Xe,y,bo,Ts,Va,S,hr,!0,Ut,Pi,wt,ts,Zr,Wt.getProjection()):$o(Tn.kind,Rn,Ge,Xe,y,bo,Ts,Va,S,hr,Ut,Pi,wt,ts,Zr,Wt.getProjection());const zo={program:y.useProgram(_u(Yt,S,Wt),Bt,ps),buffers:In,uniformValues:bs,atlasTexture:mr,atlasTextureIcon:di,atlasInterpolation:sr,atlasInterpolationIcon:dr,isSDF:Yt,hasHalo:hs,tile:cn,labelPlaneMatrixInv:us};if(it&&Wt.canOverlap){ot=!0;const ql=In.segments.get();for(const Il of ql)kt.push({segments:new o.SegmentVector([Il]),sortKey:Il.sortKey,state:zo})}else kt.push({segments:In.segments,sortKey:0,state:zo})}ot&&kt.sort(((Ut,cn)=>Ut.sortKey-cn.sortKey));for(const Ut of kt){const cn=Ut.state;if(y.terrain&&y.terrain.setupElevationDraw(cn.tile,cn.program,{useDepthForOcclusion:!Pt,labelPlaneMatrixInv:cn.labelPlaneMatrixInv}),Ae.activeTexture.set(Le.TEXTURE0),cn.atlasTexture.bind(cn.atlasInterpolation,Le.CLAMP_TO_EDGE),cn.atlasTextureIcon&&(Ae.activeTexture.set(Le.TEXTURE1),cn.atlasTextureIcon&&cn.atlasTextureIcon.bind(cn.atlasInterpolationIcon,Le.CLAMP_TO_EDGE)),cn.isSDF){const Wt=cn.uniformValues;cn.hasHalo&&(Wt.u_is_halo=1,vu(cn.buffers,Ut.segments,f,y,cn.program,bt,te,ge,Wt)),Wt.u_is_halo=0}vu(cn.buffers,Ut.segments,f,y,cn.program,bt,te,ge,cn.uniformValues)}}function vu(y,a,f,v,S,T,N,z,$){const Q=v.context,te=[y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer,y.globeExtVertexBuffer];S.draw(Q,Q.gl.TRIANGLES,T,N,z,o.CullFaceMode.disabled,$,f.id,y.layoutVertexBuffer,y.indexBuffer,a,f.paint,v.transform.zoom,y.programConfigurations.get(f.id),te)}function la(y,a,f,v,S,T,N){const z=y.context.gl,$=f.paint.get("fill-pattern"),Q=$&&$.constantOr(1);let te,ge,Ae,Le,Ze;N?(ge=Q&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",te=z.LINES):(ge=Q?"fillPattern":"fill",te=z.TRIANGLES);for(const Ue of v){const Xe=a.getTile(Ue);if(Q&&!Xe.patternsLoaded())continue;const _e=Xe.getBucket(f);if(!_e)continue;y.prepareDrawTile();const Ge=_e.programConfigurations.get(f.id),it=y.useProgram(ge,Ge);Q&&(y.context.activeTexture.set(z.TEXTURE0),Xe.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Ge.updatePaintBuffers());const ot=$.constantOr(null);if(ot&&Xe.imageAtlas){const wt=Xe.imageAtlas.patternPositions[ot.toString()];wt&&Ge.setConstantPatternPositions(wt)}const bt=y.translatePosMatrix(Ue.projMatrix,Xe,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));if(N){Le=_e.indexBuffer2,Ze=_e.segments2;const wt=y.terrain&&y.terrain.renderingToTexture?y.terrain.drapeBufferSize:[z.drawingBufferWidth,z.drawingBufferHeight];Ae=ge==="fillOutlinePattern"&&Q?Ro(bt,y,Xe,wt):Di(bt,wt)}else Le=_e.indexBuffer,Ze=_e.segments,Ae=Q?qi(bt,y,Xe):Fo(bt);y.prepareDrawProgram(y.context,it,Ue.toUnwrapped()),it.draw(y.context,te,S,y.stencilModeForClipping(Ue),T,o.CullFaceMode.disabled,Ae,f.id,_e.layoutVertexBuffer,Le,Ze,f.paint,y.transform.zoom,Ge)}}function ga(y,a,f,v,S,T,N){const z=y.context,$=z.gl,Q=y.transform,te=f.paint.get("fill-extrusion-pattern"),ge=te.constantOr(1),Ae=f.paint.get("fill-extrusion-opacity"),Le=[f.paint.get("fill-extrusion-ambient-occlusion-intensity"),f.paint.get("fill-extrusion-ambient-occlusion-radius")],Ze=f.layout.get("fill-extrusion-edge-radius"),Ue=Ze>0&&!f.paint.get("fill-extrusion-rounded-roof"),Xe=Ue?0:Ze,_e=Q.projection.name==="globe"?o.fillExtrusionHeightLift():0,Ge=Q.projection.name==="globe",it=Ge?o.globeToMercatorTransition(Q.zoom):0,ot=[o.mercatorXfromLng(Q.center.lng),o.mercatorYfromLat(Q.center.lat)],bt=[];Ge&&bt.push("PROJECTION_GLOBE_VIEW"),Le[0]>0&&bt.push("FAUX_AO"),Ue&&bt.push("ZERO_ROOF_RADIUS");for(const wt of v){const _t=a.getTile(wt),Pt=_t.getBucket(f);if(!Pt||Pt.projection.name!==Q.projection.name)continue;const kt=Pt.programConfigurations.get(f.id),jt=y.useProgram(ge?"fillExtrusionPattern":"fillExtrusion",kt,bt);if(y.terrain){const Yt=y.terrain;if(y.style.terrainSetForDrapingOnly())Yt.setupElevationDraw(_t,jt,{useMeterToDem:!0});else{if(!Pt.enableTerrain)continue;if(Yt.setupElevationDraw(_t,jt,{useMeterToDem:!0}),Go(z,a,wt,Pt,f,Yt),!Pt.centroidVertexBuffer){const Tn=jt.attributes.a_centroid_pos;Tn!==void 0&&$.vertexAttrib2f(Tn,0,0)}}}ge&&(y.context.activeTexture.set($.TEXTURE0),_t.imageAtlasTexture.bind($.LINEAR,$.CLAMP_TO_EDGE),kt.updatePaintBuffers());const _n=te.constantOr(null);if(_n&&_t.imageAtlas){const Yt=_t.imageAtlas.patternPositions[_n.toString()];Yt&&kt.setConstantPatternPositions(Yt)}const Ut=y.translatePosMatrix(wt.projMatrix,_t,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),cn=Q.projection.createInversionMatrix(Q,wt.canonical),Wt=f.paint.get("fill-extrusion-vertical-gradient"),In=ge?ao(Ut,y,Wt,Ae,Le,Xe,wt,_t,_e,it,ot,cn):ar(Ut,y,Wt,Ae,Le,Xe,wt,_e,it,ot,cn);y.prepareDrawProgram(z,jt,wt.toUnwrapped());const Bt=[];y.terrain&&Bt.push(Pt.centroidVertexBuffer),Ge&&Bt.push(Pt.layoutVertexExtBuffer),jt.draw(z,z.gl.TRIANGLES,S,T,N,o.CullFaceMode.backCCW,In,f.id,Pt.layoutVertexBuffer,Pt.indexBuffer,Pt.segments,f.paint,y.transform.zoom,kt,Bt)}}function Go(y,a,f,v,S,T){const N=[_e=>{let Ge=_e.canonical.x-1,it=_e.wrap;return Ge<0&&(Ge=(1<<_e.canonical.z)-1,it--),new o.OverscaledTileID(_e.overscaledZ,it,_e.canonical.z,Ge,_e.canonical.y)},_e=>{let Ge=_e.canonical.x+1,it=_e.wrap;return Ge===1<<_e.canonical.z&&(Ge=0,it++),new o.OverscaledTileID(_e.overscaledZ,it,_e.canonical.z,Ge,_e.canonical.y)},_e=>new o.OverscaledTileID(_e.overscaledZ,_e.wrap,_e.canonical.z,_e.canonical.x,(_e.canonical.y===0?1<<_e.canonical.z:_e.canonical.y)-1),_e=>new o.OverscaledTileID(_e.overscaledZ,_e.wrap,_e.canonical.z,_e.canonical.x,_e.canonical.y===(1<<_e.canonical.z)-1?0:_e.canonical.y+1)],z=_e=>{const Ge=a.getSource().minzoom,it=bt=>{const wt=a.getTileByID(bt);if(wt&&wt.hasData())return wt.getBucket(S)},ot=[0,-1,1];for(const bt of ot){if(_e.overscaledZ+bt<Ge)continue;const wt=it(_e.calculateScaledKey(_e.overscaledZ+bt));if(wt)return wt}},$=[0,0,0],Q=(_e,Ge)=>($[0]=Math.min(_e.min.y,Ge.min.y),$[1]=Math.max(_e.max.y,Ge.max.y),$[2]=o.EXTENT-Ge.min.x>_e.max.x?Ge.min.x-o.EXTENT:_e.max.x,$),te=(_e,Ge)=>($[0]=Math.min(_e.min.x,Ge.min.x),$[1]=Math.max(_e.max.x,Ge.max.x),$[2]=o.EXTENT-Ge.min.y>_e.max.y?Ge.min.y-o.EXTENT:_e.max.y,$),ge=[(_e,Ge)=>Q(_e,Ge),(_e,Ge)=>Q(Ge,_e),(_e,Ge)=>te(_e,Ge),(_e,Ge)=>te(Ge,_e)],Ae=new o.Point(0,0);let Le,Ze,Ue;const Xe=(_e,Ge,it,ot,bt)=>{const wt=[[ot?it:_e,ot?_e:it,0],[ot?it:Ge,ot?Ge:it,0]],_t=bt<0?o.EXTENT+bt:bt,Pt=[ot?_t:(_e+Ge)/2,ot?(_e+Ge)/2:_t,0];return it===0&&bt<0||it!==0&&bt>0?T.getForTilePoints(Ue,[Pt],!0,Ze):wt.push(Pt),T.getForTilePoints(f,wt,!0,Le),Math.max(wt[0][2],wt[1][2],Pt[2])/T.exaggeration()};for(let _e=0;_e<4;_e++){const Ge=(_e<2?1:5)-_e,it=v.borders[_e];if(it.length===0)continue;const ot=Ue=N[_e](f),bt=z(ot);if(!(bt&&bt instanceof o.FillExtrusionBucket&&bt.enableTerrain)||v.borderDoneWithNeighborZ[_e]===bt.canonical.z&&bt.borderDoneWithNeighborZ[Ge]===v.canonical.z||(Ze=T.findDEMTileFor(ot),!Ze||!Ze.dem))continue;if(!Le){const kt=T.findDEMTileFor(f);if(!kt||!kt.dem)return;Le=kt}const wt=bt.borders[Ge];let _t=0;const Pt=bt.borderDoneWithNeighborZ[Ge]!==v.canonical.z;if(v.canonical.z===bt.canonical.z){for(let kt=0;kt<it.length;kt++){const jt=v.featuresOnBorder[it[kt]],_n=jt.borders[_e];let Ut;for(;_t<wt.length&&(Ut=bt.featuresOnBorder[wt[_t]],!(Ut.borders[Ge][1]>_n[0]+3));)Pt&&bt.encodeCentroid(void 0,Ut,!1),_t++;if(Ut&&_t<wt.length){const cn=_t;let Wt=0;for(;!(Ut.borders[Ge][0]>_n[1]-3)&&(Wt++,++_t!==wt.length);)Ut=bt.featuresOnBorder[wt[_t]];if(Ut=bt.featuresOnBorder[wt[cn]],jt.intersectsCount()>1||Ut.intersectsCount()>1||Wt!==1){Wt!==1&&(_t=cn),v.encodeCentroid(void 0,jt,!1),Pt&&bt.encodeCentroid(void 0,Ut,!1);continue}const In=ge[_e](jt,Ut),Bt=_e%2?o.EXTENT-1:0;Ae.x=Xe(In[0],Math.min(o.EXTENT-1,In[1]),Bt,_e<2,In[2]),Ae.y=0,v.encodeCentroid(Ae,jt,!1),Pt&&bt.encodeCentroid(Ae,Ut,!1)}else v.encodeCentroid(void 0,jt,!1)}v.borderDoneWithNeighborZ[_e]=bt.canonical.z,v.needsCentroidUpdate=!0,Pt&&(bt.borderDoneWithNeighborZ[Ge]=v.canonical.z,bt.needsCentroidUpdate=!0)}else{for(const kt of it)v.encodeCentroid(void 0,v.featuresOnBorder[kt],!1);if(Pt){for(const kt of wt)bt.encodeCentroid(void 0,bt.featuresOnBorder[kt],!1);bt.borderDoneWithNeighborZ[Ge]=v.canonical.z,bt.needsCentroidUpdate=!0}v.borderDoneWithNeighborZ[_e]=bt.canonical.z,v.needsCentroidUpdate=!0}}(v.needsCentroidUpdate||!v.centroidVertexBuffer&&v.centroidVertexArray.length!==0)&&v.uploadCentroid(y)}const Po=new o.Color(1,0,0,1),Hs=new o.Color(0,1,0,1),ya=new o.Color(0,0,1,1),Ol=new o.Color(1,0,1,1),Dh=new o.Color(0,1,1,1);function Ju(y,a,f){const v=y.context,S=y.transform,T=v.gl,N=S.projection.name==="globe",z=N?["PROJECTION_GLOBE_VIEW"]:null;let $=f.projMatrix;if(N&&o.globeToMercatorTransition(S.zoom)>0){const jt=o.transitionTileAABBinECEF(f.canonical,S),_n=o.globeDenormalizeECEF(jt);$=o.multiply(new Float32Array(16),S.globeMatrix,_n),o.multiply($,S.projMatrix,$)}const Q=y.useProgram("debug",null,z),te=a.getTileByID(f.key);y.terrain&&y.terrain.setupElevationDraw(te,Q);const ge=o.DepthMode.disabled,Ae=o.StencilMode.disabled,Le=y.colorModeForRenderPass(),Ze="$debug";v.activeTexture.set(T.TEXTURE0),y.emptyTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),N?te._makeGlobeTileDebugBuffers(y.context,S):te._makeDebugTileBoundsBuffers(y.context,S.projection);const Ue=te._tileDebugBuffer||y.debugBuffer,Xe=te._tileDebugIndexBuffer||y.debugIndexBuffer,_e=te._tileDebugSegments||y.debugSegments;Q.draw(v,T.LINE_STRIP,ge,Ae,Le,o.CullFaceMode.disabled,Ia($,o.Color.red),Ze,Ue,Xe,_e,null,null,null,[te._globeTileDebugBorderBuffer]);const Ge=te.latestRawTileData,it=Math.floor((Ge&&Ge.byteLength||0)/1024),ot=a.getTile(f).tileSize,bt=512/Math.min(ot,512)*(f.overscaledZ/S.zoom)*.5;let wt=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(wt+=` => ${f.overscaledZ}`),wt+=` ${it}kb`,(function(jt,_n){jt.initDebugOverlayCanvas();const Ut=jt.debugOverlayCanvas,cn=jt.context.gl,Wt=jt.debugOverlayCanvas.getContext("2d");Wt.clearRect(0,0,Ut.width,Ut.height),Wt.shadowColor="white",Wt.shadowBlur=2,Wt.lineWidth=1.5,Wt.strokeStyle="white",Wt.textBaseline="top",Wt.font="bold 36px Open Sans, sans-serif",Wt.fillText(_n,5,5),Wt.strokeText(_n,5,5),jt.debugOverlayTexture.update(Ut),jt.debugOverlayTexture.bind(cn.LINEAR,cn.CLAMP_TO_EDGE)})(y,wt);const _t=te._tileDebugTextBuffer||y.debugBuffer,Pt=te._tileDebugTextIndexBuffer||y.quadTriangleIndexBuffer,kt=te._tileDebugTextSegments||y.debugSegments;Q.draw(v,T.TRIANGLES,ge,Ae,o.ColorMode.alphaBlended,o.CullFaceMode.disabled,Ia($,o.Color.transparent,bt),Ze,_t,Pt,kt,null,null,null,[te._globeTileDebugTextBuffer])}function xu(y,a,f,v){Uc(y,0,a+f/2,y.transform.width,f,v)}function Du(y,a,f,v){Uc(y,a-f/2,0,f,y.transform.height,v)}function Uc(y,a,f,v,S,T){const N=y.context,z=N.gl;z.enable(z.SCISSOR_TEST),z.scissor(a*o.exported.devicePixelRatio,f*o.exported.devicePixelRatio,v*o.exported.devicePixelRatio,S*o.exported.devicePixelRatio),N.clear({color:T}),z.disable(z.SCISSOR_TEST)}const bh=o.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Fh}=bh;function tl(y,a,f,v){y.emplaceBack(a,f,v)}class Tc{constructor(a){this.vertexArray=new o.StructArrayLayout3f12,this.indices=new o.StructArrayLayout3ui6,tl(this.vertexArray,-1,-1,1),tl(this.vertexArray,1,-1,1),tl(this.vertexArray,-1,1,1),tl(this.vertexArray,1,1,1),tl(this.vertexArray,-1,-1,-1),tl(this.vertexArray,1,-1,-1),tl(this.vertexArray,-1,1,-1),tl(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=a.createVertexBuffer(this.vertexArray,Fh),this.indexBuffer=a.createIndexBuffer(this.indices),this.segment=o.SegmentVector.simpleSegment(0,0,36,12)}}function As(y,a,f,v,S,T){const N=y.gl,z=a.paint.get("sky-atmosphere-color"),$=a.paint.get("sky-atmosphere-halo-color"),Q=a.paint.get("sky-atmosphere-sun-intensity"),te=((ge,Ae,Le,Ze,Ue)=>({u_matrix_3f:ge,u_sun_direction:Ae,u_sun_intensity:Le,u_color_tint_r:[Ze.r,Ze.g,Ze.b,Ze.a],u_color_tint_m:[Ue.r,Ue.g,Ue.b,Ue.a],u_luminance:5e-5}))(o.fromMat4(o.create$1(),v),S,Q,z,$);N.framebufferTexture2D(N.FRAMEBUFFER,N.COLOR_ATTACHMENT0,N.TEXTURE_CUBE_MAP_POSITIVE_X+T,a.skyboxTexture,0),f.draw(y,N.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.frontCW,te,"skyboxCapture",a.skyboxGeometry.vertexBuffer,a.skyboxGeometry.indexBuffer,a.skyboxGeometry.segment)}const Bl=o.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Ws{constructor(a){const f=new o.StructArrayLayout5f20;f.emplaceBack(-1,1,1,0,0),f.emplaceBack(1,1,1,1,0),f.emplaceBack(1,-1,1,1,1),f.emplaceBack(-1,-1,1,0,1);const v=new o.StructArrayLayout3ui6;v.emplaceBack(0,1,2),v.emplaceBack(2,3,0),this.vertexBuffer=a.createVertexBuffer(f,Bl.members),this.indexBuffer=a.createIndexBuffer(v),this.segments=o.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const nu={symbol:function(y,a,f,v,S){if(y.renderPass!=="translucent")return;const T=o.StencilMode.disabled,N=y.colorModeForRenderPass();f.layout.get("text-variable-anchor")&&(function(z,$,Q,te,ge,Ae,Le){const Ze=$.transform,Ue=ge==="map",Xe=Ae==="map";for(const _e of z){const Ge=te.getTile(_e),it=Ge.getBucket(Q);if(!it||!it.text||!it.text.segments.get().length)continue;const ot=o.evaluateSizeForZoom(it.textSizeData,Ze.zoom),bt=Fi(_e,it.getProjection(),Ze),wt=Ze.calculatePixelsToTileUnitsMatrix(Ge),_t=pn(bt,Ge.tileID.canonical,Xe,Ue,Ze,it.getProjection(),wt),Pt=Q.layout.get("icon-text-fit")!=="none"&&it.hasIconData();if(ot){const kt=Math.pow(2,Ze.zoom-Ge.tileID.overscaledZ);Fl(it,Ue,Xe,Le,o.symbolSize,Ze,_t,_e,kt,ot,Pt)}}})(v,y,f,a,f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),S),f.paint.get("icon-opacity").constantOr(1)!==0&&vs(y,a,f,v,!1,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),f.layout.get("icon-rotation-alignment"),f.layout.get("icon-pitch-alignment"),f.layout.get("icon-keep-upright"),T,N),f.paint.get("text-opacity").constantOr(1)!==0&&vs(y,a,f,v,!0,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),f.layout.get("text-keep-upright"),T,N),a.map.showCollisionBoxes&&(Al(y,a,f,v,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),!0),Al(y,a,f,v,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),!1))},circle:function(y,a,f,v){if(y.renderPass!=="translucent")return;const S=f.paint.get("circle-opacity"),T=f.paint.get("circle-stroke-width"),N=f.paint.get("circle-stroke-opacity"),z=f.layout.get("circle-sort-key").constantOr(1)!==void 0;if(S.constantOr(1)===0&&(T.constantOr(1)===0||N.constantOr(1)===0))return;const $=y.context,Q=$.gl,te=y.transform,ge=y.depthModeForSublayer(0,o.DepthMode.ReadOnly),Ae=o.StencilMode.disabled,Le=y.colorModeForRenderPass(),Ze=te.projection.name==="globe",Ue=[o.mercatorXfromLng(te.center.lng),o.mercatorYfromLat(te.center.lat)],Xe=[];for(let Ge=0;Ge<v.length;Ge++){const it=v[Ge],ot=a.getTile(it),bt=ot.getBucket(f);if(!bt||bt.projection.name!==te.projection.name)continue;const wt=bt.programConfigurations.get(f.id),_t=Ji(f);Ze&&_t.push("PROJECTION_GLOBE_VIEW");const Pt=y.useProgram("circle",wt,_t),kt=bt.layoutVertexBuffer,jt=bt.globeExtVertexBuffer,_n=bt.indexBuffer,Ut=te.projection.createInversionMatrix(te,it.canonical),cn={programConfiguration:wt,program:Pt,layoutVertexBuffer:kt,globeExtVertexBuffer:jt,indexBuffer:_n,uniformValues:Oo(y,it,ot,Ut,Ue,f),tile:ot};if(z){const Wt=bt.segments.get();for(const In of Wt)Xe.push({segments:new o.SegmentVector([In]),sortKey:In.sortKey,state:cn})}else Xe.push({segments:bt.segments,sortKey:0,state:cn})}z&&Xe.sort(((Ge,it)=>Ge.sortKey-it.sortKey));const _e={useDepthForOcclusion:!Ze};for(const Ge of Xe){const{programConfiguration:it,program:ot,layoutVertexBuffer:bt,globeExtVertexBuffer:wt,indexBuffer:_t,uniformValues:Pt,tile:kt}=Ge.state,jt=Ge.segments;y.terrain&&y.terrain.setupElevationDraw(kt,ot,_e),y.prepareDrawProgram($,ot,kt.tileID.toUnwrapped()),ot.draw($,Q.TRIANGLES,ge,Ae,Le,o.CullFaceMode.disabled,Pt,f.id,bt,_t,jt,f.paint,te.zoom,it,[wt])}},heatmap:function(y,a,f,v){if(f.paint.get("heatmap-opacity")!==0)if(y.renderPass==="offscreen"){const S=y.context,T=S.gl,N=o.StencilMode.disabled,z=new o.ColorMode([T.ONE,T.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(Le,Ze,Ue,Xe){const _e=Le.gl,Ge=Ze.width*Xe,it=Ze.height*Xe;Le.activeTexture.set(_e.TEXTURE1),Le.viewport.set([0,0,Ge,it]);let ot=Ue.heatmapFbo;if(!ot||ot&&(ot.width!==Ge||ot.height!==it)){ot&&ot.destroy();const bt=_e.createTexture();_e.bindTexture(_e.TEXTURE_2D,bt),_e.texParameteri(_e.TEXTURE_2D,_e.TEXTURE_WRAP_S,_e.CLAMP_TO_EDGE),_e.texParameteri(_e.TEXTURE_2D,_e.TEXTURE_WRAP_T,_e.CLAMP_TO_EDGE),_e.texParameteri(_e.TEXTURE_2D,_e.TEXTURE_MIN_FILTER,_e.LINEAR),_e.texParameteri(_e.TEXTURE_2D,_e.TEXTURE_MAG_FILTER,_e.LINEAR),ot=Ue.heatmapFbo=Le.createFramebuffer(Ge,it,!1),(function(wt,_t,Pt,kt,jt,_n){const Ut=wt.gl;Ut.texImage2D(Ut.TEXTURE_2D,0,wt.isWebGL2&&wt.extRenderToTextureHalfFloat?Ut.RGBA16F:Ut.RGBA,jt,_n,0,Ut.RGBA,wt.extRenderToTextureHalfFloat?wt.isWebGL2?Ut.HALF_FLOAT:wt.extTextureHalfFloat.HALF_FLOAT_OES:Ut.UNSIGNED_BYTE,null),kt.colorAttachment.set(Pt)})(Le,0,bt,ot,Ge,it)}else _e.bindTexture(_e.TEXTURE_2D,ot.colorAttachment.get()),Le.bindFramebuffer.set(ot.framebuffer)})(S,y,f,y.transform.projection.name==="globe"?.5:.25),S.clear({color:o.Color.transparent});const $=y.transform,Q=$.projection.name==="globe",te=Q?["PROJECTION_GLOBE_VIEW"]:null,ge=Q?o.CullFaceMode.frontCCW:o.CullFaceMode.disabled,Ae=[o.mercatorXfromLng($.center.lng),o.mercatorYfromLat($.center.lat)];for(let Le=0;Le<v.length;Le++){const Ze=v[Le];if(a.hasRenderableParent(Ze))continue;const Ue=a.getTile(Ze),Xe=Ue.getBucket(f);if(!Xe||Xe.projection.name!==$.projection.name)continue;const _e=Xe.programConfigurations.get(f.id),Ge=y.useProgram("heatmap",_e,te),{zoom:it}=y.transform;y.terrain&&y.terrain.setupElevationDraw(Ue,Ge),y.prepareDrawProgram(S,Ge,Ze.toUnwrapped());const ot=$.projection.createInversionMatrix($,Ze.canonical);Ge.draw(S,T.TRIANGLES,o.DepthMode.disabled,N,z,ge,hl(y,Ze,Ue,ot,Ae,it,f.paint.get("heatmap-intensity")),f.id,Xe.layoutVertexBuffer,Xe.indexBuffer,Xe.segments,f.paint,y.transform.zoom,_e,Q?[Xe.globeExtVertexBuffer]:null)}S.viewport.set([0,0,y.width,y.height])}else y.renderPass==="translucent"&&(y.context.setColorMode(y.colorModeForRenderPass()),(function(S,T){const N=S.context,z=N.gl,$=T.heatmapFbo;if(!$)return;N.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,$.colorAttachment.get()),N.activeTexture.set(z.TEXTURE1);let Q=T.colorRampTexture;Q||(Q=T.colorRampTexture=new o.Texture(N,T.colorRamp,z.RGBA)),Q.bind(z.LINEAR,z.CLAMP_TO_EDGE),S.useProgram("heatmapTexture").draw(N,z.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,S.colorModeForRenderPass(),o.CullFaceMode.disabled,((te,ge,Ae,Le)=>({u_image:0,u_color_ramp:1,u_opacity:ge.paint.get("heatmap-opacity")}))(0,T),T.id,S.viewportBuffer,S.quadTriangleIndexBuffer,S.viewportSegments,T.paint,S.transform.zoom)})(y,f))},line:function(y,a,f,v){if(y.renderPass!=="translucent")return;const S=f.paint.get("line-opacity"),T=f.paint.get("line-width");if(S.constantOr(1)===0||T.constantOr(1)===0)return;const N=y.depthModeForSublayer(0,o.DepthMode.ReadOnly),z=y.colorModeForRenderPass(),$=y.terrain&&y.terrain.renderingToTexture?1:o.exported.devicePixelRatio,Q=f.paint.get("line-dasharray"),te=Q.constantOr(1),ge=f.layout.get("line-cap"),Ae=f.paint.get("line-pattern"),Le=Ae.constantOr(1),Ze=f.paint.get("line-gradient"),Ue=Le?"linePattern":"line",Xe=y.context,_e=Xe.gl,Ge=(ot=>{const bt=[];Dl(ot)&&bt.push("RENDER_LINE_DASH"),ot.paint.get("line-gradient")&&bt.push("RENDER_LINE_GRADIENT");const wt=ot.paint.get("line-trim-offset");wt[0]===0&&wt[1]===0||bt.push("RENDER_LINE_TRIM_OFFSET");const _t=ot.paint.get("line-pattern").constantOr(1),Pt=ot.paint.get("line-opacity").constantOr(1)!==1;return!_t&&Pt&&bt.push("RENDER_LINE_ALPHA_DISCARD"),bt})(f);let it=Ge.includes("RENDER_LINE_ALPHA_DISCARD");y.terrain&&y.terrain.clipOrMaskOverlapStencilType()&&(it=!1);for(const ot of v){const bt=a.getTile(ot);if(Le&&!bt.patternsLoaded())continue;const wt=bt.getBucket(f);if(!wt)continue;y.prepareDrawTile();const _t=wt.programConfigurations.get(f.id),Pt=y.useProgram(Ue,_t,Ge),kt=Ae.constantOr(null);if(kt&&bt.imageAtlas){const Yt=bt.imageAtlas.patternPositions[kt.toString()];Yt&&_t.setConstantPatternPositions(Yt)}const jt=Q.constantOr(null),_n=ge.constantOr(null);if(!Le&&jt&&_n&&bt.lineAtlas){const Yt=bt.lineAtlas.getDash(jt,_n);Yt&&_t.setConstantPatternPositions(Yt)}let[Ut,cn]=f.paint.get("line-trim-offset");(_n==="round"||_n==="square")&&Ut!==cn&&(Ut===0&&(Ut-=1),cn===1&&(cn+=1));const Wt=y.terrain?ot.projMatrix:null,In=Le?dl(y,bt,f,Wt,$):Nl(y,bt,f,Wt,wt.lineClipsArray.length,$,[Ut,cn]);if(Ze){const Yt=wt.gradients[f.id];let Tn=Yt.texture;if(f.gradientVersion!==Yt.version){let bn=256;if(f.stepInterpolant){const Rn=a.getSource().maxzoom,hr=ot.canonical.z===Rn?Math.ceil(1<<y.transform.maxZoom-ot.canonical.z):1;bn=o.clamp(o.nextPowerOfTwo(wt.maxLineLength/o.EXTENT*1024*hr),256,Xe.maxTextureSize)}Yt.gradient=o.renderColorRamp({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:bn,image:Yt.gradient||void 0,clips:wt.lineClipsArray}),Yt.texture?Yt.texture.update(Yt.gradient):Yt.texture=new o.Texture(Xe,Yt.gradient,_e.RGBA),Yt.version=f.gradientVersion,Tn=Yt.texture}Xe.activeTexture.set(_e.TEXTURE1),Tn.bind(f.stepInterpolant?_e.NEAREST:_e.LINEAR,_e.CLAMP_TO_EDGE)}te&&(Xe.activeTexture.set(_e.TEXTURE0),bt.lineAtlasTexture.bind(_e.LINEAR,_e.REPEAT),_t.updatePaintBuffers()),Le&&(Xe.activeTexture.set(_e.TEXTURE0),bt.imageAtlasTexture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE),_t.updatePaintBuffers()),y.prepareDrawProgram(Xe,Pt,ot.toUnwrapped());const Bt=Yt=>{Pt.draw(Xe,_e.TRIANGLES,N,Yt,z,o.CullFaceMode.disabled,In,f.id,wt.layoutVertexBuffer,wt.indexBuffer,wt.segments,f.paint,y.transform.zoom,_t,[wt.layoutVertexBuffer2])};if(it){const Yt=y.stencilModeForClipping(ot).ref;Yt===0&&y.terrain&&Xe.clear({stencil:0});const Tn={func:_e.EQUAL,mask:255};In.u_alpha_discard_threshold=.8,Bt(new o.StencilMode(Tn,Yt,255,_e.KEEP,_e.KEEP,_e.INVERT)),In.u_alpha_discard_threshold=0,Bt(new o.StencilMode(Tn,Yt,255,_e.KEEP,_e.KEEP,_e.KEEP))}else Bt(y.stencilModeForClipping(ot))}it&&(y.resetStencilClippingMasks(),y.terrain&&Xe.clear({stencil:0}))},fill:function(y,a,f,v){const S=f.paint.get("fill-color"),T=f.paint.get("fill-opacity");if(T.constantOr(1)===0)return;const N=y.colorModeForRenderPass(),z=f.paint.get("fill-pattern"),$=y.opaquePassEnabledForLayer()&&!z.constantOr(1)&&S.constantOr(o.Color.transparent).a===1&&T.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===$){const Q=y.depthModeForSublayer(1,y.renderPass==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly);la(y,a,f,v,Q,N,!1)}if(y.renderPass==="translucent"&&f.paint.get("fill-antialias")){const Q=y.depthModeForSublayer(f.getPaintProperty("fill-outline-color")?2:0,o.DepthMode.ReadOnly);la(y,a,f,v,Q,N,!0)}},"fill-extrusion":function(y,a,f,v){const S=f.paint.get("fill-extrusion-opacity");if(S!==0&&y.renderPass==="translucent"){const T=new o.DepthMode(y.context.gl.LEQUAL,o.DepthMode.ReadWrite,y.depthRangeFor3D);if(S!==1||f.paint.get("fill-extrusion-pattern").constantOr(1))ga(y,a,f,v,T,o.StencilMode.disabled,o.ColorMode.disabled),ga(y,a,f,v,T,y.stencilModeFor3D(),y.colorModeForRenderPass()),y.resetStencilClippingMasks();else{const N=y.colorModeForRenderPass();ga(y,a,f,v,T,o.StencilMode.disabled,N)}}},hillshade:function(y,a,f,v){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;const S=y.context,T=y.depthModeForSublayer(0,o.DepthMode.ReadOnly),N=y.colorModeForRenderPass(),z=y.terrain&&y.terrain.renderingToTexture,[$,Q]=y.renderPass!=="translucent"||z?[{},v]:y.stencilConfigForOverlap(v);for(const te of Q){const ge=a.getTile(te);if(ge.needsHillshadePrepare&&y.renderPass==="offscreen")Ti(y,ge,f,T,o.StencilMode.disabled,N);else if(y.renderPass==="translucent"){const Ae=z&&y.terrain?y.terrain.stencilModeForRTTOverlap(te):$[te.overscaledZ];$r(y,te,ge,f,T,Ae,N)}}S.viewport.set([0,0,y.width,y.height]),y.resetStencilClippingMasks()},raster:function(y,a,f,v,S,T){if(y.renderPass!=="translucent"||f.paint.get("raster-opacity")===0||!v.length)return;const N=y.context,z=N.gl,$=a.getSource(),Q=y.useProgram("raster"),te=y.colorModeForRenderPass(),ge=y.terrain&&y.terrain.renderingToTexture,[Ae,Le]=$ instanceof Ir||ge?[{},v]:y.stencilConfigForOverlap(v),Ze=Le[Le.length-1].overscaledZ,Ue=!y.options.moving;for(const Xe of Le){const _e=ge?o.DepthMode.disabled:y.depthModeForSublayer(Xe.overscaledZ-Ze,f.paint.get("raster-opacity")===1?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly,z.LESS),Ge=Xe.toUnwrapped(),it=a.getTile(Xe);if(ge&&(!it||!it.hasData()))continue;const ot=ge?Xe.projMatrix:y.transform.calculateProjMatrix(Ge,Ue),bt=y.terrain&&ge?y.terrain.stencilModeForRTTOverlap(Xe):Ae[Xe.overscaledZ],wt=T?0:f.paint.get("raster-fade-duration");it.registerFadeDuration(wt);const _t=a.findLoadedParent(Xe,0),Pt=jc(it,_t,a,y.transform,wt);let kt,jt;y.terrain&&y.terrain.prepareDrawTile();const _n=f.paint.get("raster-resampling")==="nearest"?z.NEAREST:z.LINEAR;N.activeTexture.set(z.TEXTURE0),it.texture.bind(_n,z.CLAMP_TO_EDGE),N.activeTexture.set(z.TEXTURE1),_t?(_t.texture.bind(_n,z.CLAMP_TO_EDGE),kt=Math.pow(2,_t.tileID.overscaledZ-it.tileID.overscaledZ),jt=[it.tileID.canonical.x*kt%1,it.tileID.canonical.y*kt%1]):it.texture.bind(_n,z.CLAMP_TO_EDGE),it.texture.useMipmap&&N.extTextureFilterAnisotropic&&y.transform.pitch>20&&z.texParameterf(z.TEXTURE_2D,N.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,N.extTextureFilterAnisotropicMax);const Ut=Ec(ot,jt||[0,0],kt||1,Pt,f,$ instanceof Ir?$.perspectiveTransform:[0,0]);if(y.prepareDrawProgram(N,Q,Ge),$ instanceof Ir)$.boundsBuffer&&$.boundsSegments&&Q.draw(N,z.TRIANGLES,_e,o.StencilMode.disabled,te,o.CullFaceMode.disabled,Ut,f.id,$.boundsBuffer,y.quadTriangleIndexBuffer,$.boundsSegments);else{const{tileBoundsBuffer:cn,tileBoundsIndexBuffer:Wt,tileBoundsSegments:In}=y.getTileBoundsBuffers(it);Q.draw(N,z.TRIANGLES,_e,bt,te,o.CullFaceMode.disabled,Ut,f.id,cn,Wt,In)}}y.resetStencilClippingMasks()},background:function(y,a,f,v){const S=f.paint.get("background-color"),T=f.paint.get("background-opacity");if(T===0)return;const N=y.context,z=N.gl,$=y.transform,Q=$.tileSize,te=f.paint.get("background-pattern");if(y.isPatternMissing(te))return;const ge=!te&&S.a===1&&T===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==ge)return;const Ae=o.StencilMode.disabled,Le=y.depthModeForSublayer(0,ge==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly),Ze=y.colorModeForRenderPass(),Ue=y.useProgram(te?"backgroundPattern":"background");let Xe,_e=v;_e||(Xe=y.getBackgroundTiles(),_e=Object.values(Xe).map((Ge=>Ge.tileID))),te&&(N.activeTexture.set(z.TEXTURE0),y.imageManager.bind(y.context));for(const Ge of _e){const it=Ge.toUnwrapped(),ot=v?Ge.projMatrix:y.transform.calculateProjMatrix(it);y.prepareDrawTile();const bt=a?a.getTile(Ge):Xe?Xe[Ge.key]:new o.Tile(Ge,Q,$.zoom,y),wt=te?Nu(ot,T,y,te,{tileID:Ge,tileSize:Q}):fl(ot,T,S);y.prepareDrawProgram(N,Ue,it);const{tileBoundsBuffer:_t,tileBoundsIndexBuffer:Pt,tileBoundsSegments:kt}=y.getTileBoundsBuffers(bt);Ue.draw(N,z.TRIANGLES,Le,Ae,Ze,o.CullFaceMode.disabled,wt,f.id,_t,Pt,kt)}},sky:function(y,a,f){const v=y.transform,S=v.projection.name==="mercator"||v.projection.name==="globe"?1:o.smoothstep(7,8,v.zoom),T=f.paint.get("sky-opacity")*S;if(T===0)return;const N=y.context,z=f.paint.get("sky-type"),$=new o.DepthMode(N.gl.LEQUAL,o.DepthMode.ReadOnly,[0,1]),Q=y.frameCounter/1e3%1;z==="atmosphere"?y.renderPass==="offscreen"?f.needsSkyboxCapture(y)&&((function(te,ge,Ae,Le){const Ze=te.context,Ue=Ze.gl;let Xe=ge.skyboxFbo;if(!Xe){Xe=ge.skyboxFbo=Ze.createFramebuffer(32,32,!1),ge.skyboxGeometry=new Tc(Ze),ge.skyboxTexture=Ze.gl.createTexture(),Ue.bindTexture(Ue.TEXTURE_CUBE_MAP,ge.skyboxTexture),Ue.texParameteri(Ue.TEXTURE_CUBE_MAP,Ue.TEXTURE_WRAP_S,Ue.CLAMP_TO_EDGE),Ue.texParameteri(Ue.TEXTURE_CUBE_MAP,Ue.TEXTURE_WRAP_T,Ue.CLAMP_TO_EDGE),Ue.texParameteri(Ue.TEXTURE_CUBE_MAP,Ue.TEXTURE_MIN_FILTER,Ue.LINEAR),Ue.texParameteri(Ue.TEXTURE_CUBE_MAP,Ue.TEXTURE_MAG_FILTER,Ue.LINEAR);for(let ot=0;ot<6;++ot)Ue.texImage2D(Ue.TEXTURE_CUBE_MAP_POSITIVE_X+ot,0,Ue.RGBA,32,32,0,Ue.RGBA,Ue.UNSIGNED_BYTE,null)}Ze.bindFramebuffer.set(Xe.framebuffer),Ze.viewport.set([0,0,32,32]);const _e=ge.getCenter(te,!0),Ge=te.useProgram("skyboxCapture"),it=new Float64Array(16);o.identity(it),o.rotateY(it,it,.5*-Math.PI),As(Ze,ge,Ge,it,_e,0),o.identity(it),o.rotateY(it,it,.5*Math.PI),As(Ze,ge,Ge,it,_e,1),o.identity(it),o.rotateX(it,it,.5*-Math.PI),As(Ze,ge,Ge,it,_e,2),o.identity(it),o.rotateX(it,it,.5*Math.PI),As(Ze,ge,Ge,it,_e,3),o.identity(it),As(Ze,ge,Ge,it,_e,4),o.identity(it),o.rotateY(it,it,Math.PI),As(Ze,ge,Ge,it,_e,5),Ze.viewport.set([0,0,te.width,te.height])})(y,f),f.markSkyboxValid(y)):y.renderPass==="sky"&&(function(te,ge,Ae,Le,Ze){const Ue=te.context,Xe=Ue.gl,_e=te.transform,Ge=te.useProgram("skybox");Ue.activeTexture.set(Xe.TEXTURE0),Xe.bindTexture(Xe.TEXTURE_CUBE_MAP,ge.skyboxTexture);const it=((ot,bt,wt,_t,Pt)=>({u_matrix:ot,u_sun_direction:bt,u_cubemap:0,u_opacity:_t,u_temporal_offset:Pt}))(_e.skyboxMatrix,ge.getCenter(te,!1),0,Le,Ze);te.prepareDrawProgram(Ue,Ge),Ge.draw(Ue,Xe.TRIANGLES,Ae,o.StencilMode.disabled,te.colorModeForRenderPass(),o.CullFaceMode.backCW,it,"skybox",ge.skyboxGeometry.vertexBuffer,ge.skyboxGeometry.indexBuffer,ge.skyboxGeometry.segment)})(y,f,$,T,Q):z==="gradient"&&y.renderPass==="sky"&&(function(te,ge,Ae,Le,Ze){const Ue=te.context,Xe=Ue.gl,_e=te.transform,Ge=te.useProgram("skyboxGradient");ge.skyboxGeometry||(ge.skyboxGeometry=new Tc(Ue)),Ue.activeTexture.set(Xe.TEXTURE0);let it=ge.colorRampTexture;it||(it=ge.colorRampTexture=new o.Texture(Ue,ge.colorRamp,Xe.RGBA)),it.bind(Xe.LINEAR,Xe.CLAMP_TO_EDGE);const ot=((bt,wt,_t,Pt,kt)=>({u_matrix:bt,u_color_ramp:0,u_center_direction:wt,u_radius:o.degToRad(_t),u_opacity:Pt,u_temporal_offset:kt}))(_e.skyboxMatrix,ge.getCenter(te,!1),ge.paint.get("sky-gradient-radius"),Le,Ze);te.prepareDrawProgram(Ue,Ge),Ge.draw(Ue,Xe.TRIANGLES,Ae,o.StencilMode.disabled,te.colorModeForRenderPass(),o.CullFaceMode.backCW,ot,"skyboxGradient",ge.skyboxGeometry.vertexBuffer,ge.skyboxGeometry.indexBuffer,ge.skyboxGeometry.segment)})(y,f,$,T,Q)},debug:function(y,a,f){for(let v=0;v<f.length;v++)Ju(y,a,f[v])},custom:function(y,a,f,v){const S=y.context,T=f.implementation;if(!y.transform.projection.unsupportedLayers||!y.transform.projection.unsupportedLayers.includes("custom")||y.terrain&&(y.terrain.renderingToTexture||y.renderPass==="offscreen")&&f.isLayerDraped()){if(y.renderPass==="offscreen"){const N=T.prerender;if(N){if(y.setCustomLayerDefaults(),S.setColorMode(y.colorModeForRenderPass()),y.transform.projection.name==="globe"){const z=y.transform.pointMerc;N.call(T,S.gl,y.transform.customLayerMatrix(),y.transform.getProjection(),y.transform.globeToMercatorMatrix(),o.globeToMercatorTransition(y.transform.zoom),[z.x,z.y],y.transform.pixelsPerMeterRatio)}else N.call(T,S.gl,y.transform.customLayerMatrix());S.setDirty(),y.setBaseState()}}else if(y.renderPass==="translucent"){if(y.terrain&&y.terrain.renderingToTexture){const z=T.renderToTile;if(z){const $=v[0].canonical,Q=new o.MercatorCoordinate($.x+v[0].wrap*(1<<$.z),$.y,$.z);S.setDepthMode(o.DepthMode.disabled),S.setStencilMode(o.StencilMode.disabled),S.setColorMode(y.colorModeForRenderPass()),y.setCustomLayerDefaults(),z.call(T,S.gl,Q),S.setDirty(),y.setBaseState()}return}y.setCustomLayerDefaults(),S.setColorMode(y.colorModeForRenderPass()),S.setStencilMode(o.StencilMode.disabled);const N=T.renderingMode==="3d"?new o.DepthMode(y.context.gl.LEQUAL,o.DepthMode.ReadWrite,y.depthRangeFor3D):y.depthModeForSublayer(0,o.DepthMode.ReadOnly);if(S.setDepthMode(N),y.transform.projection.name==="globe"){const z=y.transform.pointMerc;T.render(S.gl,y.transform.customLayerMatrix(),y.transform.getProjection(),y.transform.globeToMercatorMatrix(),o.globeToMercatorTransition(y.transform.zoom),[z.x,z.y],y.transform.pixelsPerMeterRatio)}else T.render(S.gl,y.transform.customLayerMatrix());S.setDirty(),y.setBaseState(),S.bindFramebuffer.set(null)}}else o.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class jr{constructor(a,f,v=!1){this.context=new xn(a,v),this.transform=f,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=o.SourceCache.maxUnderzooming+o.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(a,f){const v=!!a&&!!a.terrain&&this.transform.projection.supportsTerrain;if(!(v||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new ve(this,a));const S=this._terrain;this.transform.elevation=v?S:null,S.update(a,this.transform,f)}_updateFog(a){const f=a.fog;if(!f||this.transform.projection.name==="globe"||f.getOpacity(this.transform.pitch)<1||f.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[v,S]=f.getFovAdjustedRange(this.transform._fov);if(v>S)return void(this.transform.fogCullDistSq=null);const T=v+.78*(S-v);this.transform.fogCullDistSq=T*T}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(a,f){if(this.width=a*o.exported.devicePixelRatio,this.height=f*o.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const v of this.style.order)this.style._layers[v].resize()}setup(){const a=this.context,f=new o.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(o.EXTENT,0),f.emplaceBack(0,o.EXTENT),f.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=a.createVertexBuffer(f,o.posAttributes.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const v=new o.StructArrayLayout2i4;v.emplaceBack(0,0),v.emplaceBack(o.EXTENT,0),v.emplaceBack(0,o.EXTENT),v.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=a.createVertexBuffer(v,o.posAttributes.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const S=new o.StructArrayLayout2i4;S.emplaceBack(-1,-1),S.emplaceBack(1,-1),S.emplaceBack(-1,1),S.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(S,o.posAttributes.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const T=new o.StructArrayLayout4i8;T.emplaceBack(0,0,0,0),T.emplaceBack(o.EXTENT,0,o.EXTENT,0),T.emplaceBack(0,o.EXTENT,0,o.EXTENT),T.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.mercatorBoundsBuffer=a.createVertexBuffer(T,o.boundsAttributes.members),this.mercatorBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const N=new o.StructArrayLayout3ui6;N.emplaceBack(0,1,2),N.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(N);const z=new o.StructArrayLayout1ui2;for(const Q of[0,1,3,2,0])z.emplaceBack(Q);this.debugIndexBuffer=a.createIndexBuffer(z),this.emptyTexture=new o.Texture(a,new o.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),a.gl.RGBA),this.identityMat=o.create();const $=this.context.gl;this.stencilClearMode=new o.StencilMode({func:$.ALWAYS,mask:0},0,255,$.ZERO,$.ZERO,$.ZERO),this.loadTimeStamps.push(o.window.performance.now()),this.atmosphereBuffer=new Ws(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(a){return a._makeTileBoundsBuffers(this.context,this.transform.projection),a._tileBoundsBuffer?{tileBoundsBuffer:a._tileBoundsBuffer,tileBoundsIndexBuffer:a._tileBoundsIndexBuffer,tileBoundsSegments:a._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const a=this.context,f=a.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(a,f.TRIANGLES,o.DepthMode.disabled,this.stencilClearMode,o.ColorMode.disabled,o.CullFaceMode.disabled,Es(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(a,f,v){if(!f||this.currentStencilSource===f.id||!a.isTileClipped()||!v||v.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let z=!1;for(const $ of v)if(this._tileClippingMaskIDs[$.key]===void 0){z=!0;break}if(!z)return}this.currentStencilSource=f.id;const S=this.context,T=S.gl;this.nextStencilID+v.length>256&&this.clearStencil(),S.setColorMode(o.ColorMode.disabled),S.setDepthMode(o.DepthMode.disabled);const N=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const z of v){const $=f.getTile(z),Q=this._tileClippingMaskIDs[z.key]=this.nextStencilID++,{tileBoundsBuffer:te,tileBoundsIndexBuffer:ge,tileBoundsSegments:Ae}=this.getTileBoundsBuffers($);N.draw(S,T.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:T.ALWAYS,mask:0},Q,255,T.KEEP,T.KEEP,T.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,Es(z.projMatrix),"$clipping",te,ge,Ae)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,f=this.context.gl;return new o.StencilMode({func:f.NOTEQUAL,mask:255},a,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(a){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(a);const f=this.context.gl;return new o.StencilMode({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,f.KEEP,f.KEEP,f.REPLACE)}stencilConfigForOverlap(a){const f=this.context.gl,v=a.sort(((N,z)=>z.overscaledZ-N.overscaledZ)),S=v[v.length-1].overscaledZ,T=v[0].overscaledZ-S+1;if(T>1){this.currentStencilSource=void 0,this.nextStencilID+T>256&&this.clearStencil();const N={};for(let z=0;z<T;z++)N[z+S]=new o.StencilMode({func:f.GEQUAL,mask:255},z+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=T,[N,v]}return[{[S]:o.StencilMode.disabled},v]}colorModeForRenderPass(){const a=this.context.gl;return this._showOverdrawInspector?new o.ColorMode([a.CONSTANT_COLOR,a.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?o.ColorMode.unblended:o.ColorMode.alphaBlended}depthModeForSublayer(a,f,v){if(!this.opaquePassEnabledForLayer())return o.DepthMode.disabled;const S=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new o.DepthMode(v||this.context.gl.LEQUAL,f,[S,S])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(a,f){this.style=a,this.options=f,this.imageManager=a.imageManager,this.glyphManager=a.glyphManager,this.symbolFadeChange=a.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const v=this.style.order,S=this.style._sourceCaches;for(const Q in S){const te=S[Q];te.used&&te.prepare(this.context)}const T={},N={},z={};for(const Q in S){const te=S[Q];T[Q]=te.getVisibleCoordinates(),N[Q]=T[Q].slice().reverse(),z[Q]=te.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let Q=0;Q<v.length;Q++)if(this.style._layers[v[Q]].is3D()){this.opaquePassCutoff=Q;break}if(this.terrain&&(this.terrain.updateTileBinding(z),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.GlobeSharedBuffers(this.context)),!o.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const Q of v){const te=this.style._layers[Q],ge=a._getLayerSourceCache(te);if(!te.hasOffscreenPass()||te.isHidden(this.transform.zoom))continue;const Ae=ge?N[ge.id]:void 0;(te.type==="custom"||te.isSky()||Ae&&Ae.length)&&this.renderLayer(this,ge,te,Ae)}this.depthRangeFor3D=[0,1-(a.order.length+2)*this.numSublayers*this.depthEpsilon];const $=this.terrain;if($&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&$.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:f.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){const Q=this.style._layers[v[this.currentLayer]],te=a._getLayerSourceCache(Q);if(Q.isSky())continue;const ge=te?N[te.id]:void 0;this._renderTileClippingMasks(Q,te,ge),this.renderLayer(this,te,Q,ge)}if(this.style.fog&&this.transform.projection.supportsFog&&(function(Q,te){const ge=Q.context,Ae=ge.gl,Le=Q.transform,Ze=new o.DepthMode(Ae.LEQUAL,o.DepthMode.ReadOnly,[0,1]),Ue=Q.useProgram("globeAtmosphere",null,Le.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Xe=o.globeToMercatorTransition(Le.zoom),_e=te.properties.get("color").toArray01(),Ge=te.properties.get("high-color").toArray01(),it=te.properties.get("space-color").toArray01PremultipliedAlpha(),ot=o.identity$1([]);o.rotateY$1(ot,ot,-o.degToRad(Le._center.lng)),o.rotateX$1(ot,ot,o.degToRad(Le._center.lat)),o.rotateZ$1(ot,ot,Le.angle),o.rotateX$1(ot,ot,-Le._pitch);const bt=o.fromQuat(new Float32Array(16),ot),wt=o.mapValue(te.properties.get("star-intensity"),0,1,0,.25),_t=5e-4,Pt=o.mapValue(te.properties.get("horizon-blend"),0,1,_t,.25),kt=o.globeUseCustomAntiAliasing(Q,ge,Le)&&Pt===_t?Le.worldSize/(2*Math.PI*1.025)-1:Le.globeRadius,jt=Q.frameCounter/1e3%1,_n=o.length(Le.globeCenterInViewSpace),Ut=Math.sqrt(Math.pow(_n,2)-Math.pow(kt,2)),cn=Math.acos(Ut/_n),Wt=((Bt,Yt,Tn,bn,Rn,hr,mr,sr,dr,oi,di,_r,Zr,Pi)=>({u_frustum_tl:Bt,u_frustum_tr:Yt,u_frustum_br:Tn,u_frustum_bl:bn,u_horizon:Rn,u_transition:hr,u_fadeout_range:mr,u_color:sr,u_high_color:dr,u_space_color:oi,u_star_intensity:di,u_star_size:5*o.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:_r,u_horizon_angle:Zr,u_rotation_matrix:Pi}))(Le.frustumCorners.TL,Le.frustumCorners.TR,Le.frustumCorners.BR,Le.frustumCorners.BL,Le.frustumCorners.horizon,Xe,Pt,_e,Ge,it,wt,jt,cn,bt);Q.prepareDrawProgram(ge,Ue);const In=Q.atmosphereBuffer;In&&Ue.draw(ge,Ae.TRIANGLES,Ze,o.StencilMode.disabled,o.ColorMode.alphaBlended,o.CullFaceMode.backCW,Wt,"skybox",In.vertexBuffer,In.indexBuffer,In.segments)})(this,this.style.fog),this.renderPass="sky",(o.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){const Q=this.style._layers[v[this.currentLayer]],te=a._getLayerSourceCache(Q);Q.isSky()&&this.renderLayer(this,te,Q,te?N[te.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<v.length;){const Q=this.style._layers[v[this.currentLayer]],te=a._getLayerSourceCache(Q);if(Q.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(Q)){if(Q.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const ge=te?(Q.type==="symbol"?z:N)[te.id]:void 0;this._renderTileClippingMasks(Q,te,te?T[te.id]:void 0),this.renderLayer(this,te,Q,ge),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Q=null;o.values(this.style._layers).forEach((te=>{const ge=a._getLayerSourceCache(te);ge&&!te.isHidden(this.transform.zoom)&&(!Q||Q.getSource().maxzoom<ge.getSource().maxzoom)&&(Q=ge)})),Q&&this.options.showTileBoundaries&&nu.debug(this,Q,Q.getVisibleCoordinates())}this.options.showPadding&&(function(Q){const te=Q.transform.padding;xu(Q,Q.transform.height-(te.top||0),3,Po),xu(Q,te.bottom||0,3,Hs),Du(Q,te.left||0,3,ya),Du(Q,Q.transform.width-(te.right||0),3,Ol);const ge=Q.transform.centerPoint;(function(Ae,Le,Ze,Ue){Uc(Ae,Le-1,Ze-10,2,20,Ue),Uc(Ae,Le-10,Ze-1,20,2,Ue)})(Q,ge.x,Q.transform.height-ge.y,Dh)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(o.window.performance.now()),this.saveCanvasCopy())}renderLayer(a,f,v,S){v.isHidden(this.transform.zoom)||(v.type==="background"||v.type==="sky"||v.type==="custom"||S&&S.length)&&(this.id=v.id,this.gpuTimingStart(v),(!a.transform.projection.unsupportedLayers||!a.transform.projection.unsupportedLayers.includes(v.type)||a.terrain&&v.type==="custom")&&nu[v.type](a,f,v,S,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(a){if(!this.options.gpuTiming)return;const f=this.context.extTimerQuery;let v=this.gpuTimers[a.id];v||(v=this.gpuTimers[a.id]={calls:0,cpuTime:0,query:f.createQueryEXT()}),v.calls++,f.beginQueryEXT(f.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const a=this.context.extTimerQuery,f=a.createQueryEXT();this.deferredRenderGpuTimeQueries.push(f),a.beginQueryEXT(a.TIME_ELAPSED_EXT,f)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}collectGpuTimers(){const a=this.gpuTimers;return this.gpuTimers={},a}collectDeferredRenderGpuQueries(){const a=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],a}queryGpuTimers(a){const f={};for(const v in a){const S=a[v],T=this.context.extTimerQuery,N=T.getQueryObjectEXT(S.query,T.QUERY_RESULT_EXT)/1e6;T.deleteQueryEXT(S.query),f[v]=N}return f}queryGpuTimeDeferredRender(a){if(!this.options.gpuTimingDeferredRender)return 0;const f=this.context.extTimerQuery;let v=0;for(const S of a)v+=f.getQueryObjectEXT(S,f.QUERY_RESULT_EXT)/1e6,f.deleteQueryEXT(S);return v}translatePosMatrix(a,f,v,S,T){if(!v[0]&&!v[1])return a;const N=T?S==="map"?this.transform.angle:0:S==="viewport"?-this.transform.angle:0;if(N){const Q=Math.sin(N),te=Math.cos(N);v=[v[0]*te-v[1]*Q,v[0]*Q+v[1]*te]}const z=[T?v[0]:le(f,v[0],this.transform.zoom),T?v[1]:le(f,v[1],this.transform.zoom),0],$=new Float32Array(16);return o.translate($,a,z),$}saveTileTexture(a){const f=this._tileTextures[a.size[0]];f?f.push(a):this._tileTextures[a.size[0]]=[a]}getTileTexture(a){const f=this._tileTextures[a];return f&&f.length>0?f.pop():null}isPatternMissing(a){return a===null||a!==void 0&&!this.imageManager.getPattern(a.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const a=this.terrain&&this.terrain.renderingToTexture,f=this.terrain&&this.terrain.exaggeration()===0,v=this.style&&this.style.fog,S=[];return this.terrainRenderModeElevated()&&S.push("TERRAIN"),this.transform.projection.name==="globe"&&S.push("GLOBE"),f&&S.push("ZERO_EXAGGERATION"),v&&!a&&v.getOpacity(this.transform.pitch)!==0&&S.push("FOG"),a&&S.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&S.push("OVERDRAW_INSPECTOR"),S}useProgram(a,f,v){this.cache=this.cache||{};const S=v||[],T=this.currentGlobalDefines().concat(S),N=He.cacheKey(yt[a],a,T,f);return this.cache[N]||(this.cache[N]=new He(this.context,a,yt[a],f,el[a],T)),this.cache[N]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(a,f,v){if(this.terrain&&this.terrain.renderingToTexture)return;const S=this.style.fog;if(S){const T=S.getOpacity(this.transform.pitch),N=((z,$,Q,te,ge,Ae,Le,Ze,Ue,Xe,_e)=>{const Ge=z.transform,it=$.properties.get("color").toArray01();it[3]=te;const ot=z.frameCounter/1e3%1;return{u_fog_matrix:Q?Ge.calculateFogTileMatrix(Q):z.identityMat,u_fog_range:$.getFovAdjustedRange(Ge._fov),u_fog_color:it,u_fog_horizon_blend:$.properties.get("horizon-blend"),u_fog_temporal_offset:ot,u_frustum_tl:ge,u_frustum_tr:Ae,u_frustum_br:Le,u_frustum_bl:Ze,u_globe_pos:Ue,u_globe_radius:Xe,u_viewport:_e,u_globe_transition:o.globeToMercatorTransition(Ge.zoom),u_is_globe:+(Ge.projection.name==="globe")}})(this,S,v,T,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.exported.devicePixelRatio,this.transform.height*o.exported.devicePixelRatio]);f.setFogUniformValues(a,N)}}setTileLoadedFlag(a){this.tileLoaded=a}saveCanvasCopy(){const a=this.canvasCopy();a&&(this.frameCopies.push(a),this.tileLoaded=!1)}canvasCopy(){const a=this.context.gl,f=a.createTexture();return a.bindTexture(a.TEXTURE_2D,f),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,a.drawingBufferWidth,a.drawingBufferHeight,0),f}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const a=this.style&&this.style.fog;return!!a&&a.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const a=this._backgroundTiles,f=this._backgroundTiles={},v=this.transform.coveringTiles({tileSize:512});for(const S of v)f[S.key]=a[S.key]||new o.Tile(S,512,this.transform.tileZoom,this);return f}clearBackgroundTiles(){this._backgroundTiles={}}}class Qu{constructor(a=0,f=0,v=0,S=0){if(isNaN(a)||a<0||isNaN(f)||f<0||isNaN(v)||v<0||isNaN(S)||S<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=f,this.left=v,this.right=S}interpolate(a,f,v){return f.top!=null&&a.top!=null&&(this.top=o.number(a.top,f.top,v)),f.bottom!=null&&a.bottom!=null&&(this.bottom=o.number(a.bottom,f.bottom,v)),f.left!=null&&a.left!=null&&(this.left=o.number(a.left,f.left,v)),f.right!=null&&a.right!=null&&(this.right=o.number(a.right,f.right,v)),this}getCenter(a,f){const v=o.clamp((this.left+a-this.right)/2,0,a),S=o.clamp((this.top+f-this.bottom)/2,0,f);return new o.Point(v,S)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new Qu(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function eh(y,a){const f=o.getColumn(y,3);o.fromQuat(y,a),o.setColumn(y,3,f)}function Bi(y,a){const f=o.identity$1([]);return o.rotateZ$1(f,f,-a),o.rotateX$1(f,f,-y),f}function Tl(y,a){const f=[y[0],y[1],0],v=[a[0],a[1],0];if(o.length(f)>=1e-15){const N=o.normalize([],f);o.scale$2(v,N,o.dot(v,N)),a[0]=v[0],a[1]=v[1]}const S=o.cross([],a,y);if(o.len(S)<1e-15)return null;const T=Math.atan2(-S[1],S[0]);return Bi(Math.atan2(Math.sqrt(y[0]*y[0]+y[1]*y[1]),-y[2]),T)}class ru{constructor(a,f){this.position=a,this.orientation=f}get position(){return this._position}set position(a){if(a){const f=a instanceof o.MercatorCoordinate?a:new o.MercatorCoordinate(a[0],a[1],a[2]);this._renderWorldCopies&&(f.x=o.wrap(f.x,0,1)),this._position=f}else this._position=null}lookAtPoint(a,f){if(this.orientation=null,!this.position)return;const v=this.position,S=this._elevation?this._elevation.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(a)):0,T=o.MercatorCoordinate.fromLngLat(a,S),N=[T.x-v.x,T.y-v.y,T.z-v.z];f||(f=[0,0,1]),f[2]=Math.abs(f[2]),this.orientation=Tl(N,f)}setPitchBearing(a,f){this.orientation=Bi(o.degToRad(a),o.degToRad(-f))}}class oc{constructor(a,f){this._transform=o.identity([]),this.orientation=f,this.position=a}get mercatorPosition(){const a=this.position;return new o.MercatorCoordinate(a[0],a[1],a[2])}get position(){const a=o.getColumn(this._transform,3);return[a[0],a[1],a[2]]}set position(a){var f;a&&o.setColumn(this._transform,3,[(f=a)[0],f[1],f[2],1])}get orientation(){return this._orientation}set orientation(a){this._orientation=a||o.identity$1([]),a&&eh(this._transform,this._orientation)}getPitchBearing(){const a=this.forward(),f=this.right();return{bearing:Math.atan2(-f[1],f[0]),pitch:Math.atan2(Math.sqrt(a[0]*a[0]+a[1]*a[1]),-a[2])}}setPitchBearing(a,f){this._orientation=Bi(a,f),eh(this._transform,this._orientation)}forward(){const a=o.getColumn(this._transform,2);return[-a[0],-a[1],-a[2]]}up(){const a=o.getColumn(this._transform,1);return[-a[0],-a[1],-a[2]]}right(){const a=o.getColumn(this._transform,0);return[a[0],a[1],a[2]]}getCameraToWorld(a,f){const v=new Float64Array(16);return o.invert(v,this.getWorldToCamera(a,f)),v}getWorldToCameraPosition(a,f,v){const S=this.position;o.scale$2(S,S,-a);const T=new Float64Array(16);return o.fromScaling(T,[v,v,v]),o.translate(T,T,S),T[10]*=f,T}getWorldToCamera(a,f){const v=new Float64Array(16),S=new Float64Array(4),T=this.position;return o.conjugate(S,this._orientation),o.scale$2(T,T,-a),o.fromQuat(v,S),o.translate(v,v,T),v[1]*=-1,v[5]*=-1,v[9]*=-1,v[13]*=-1,v[8]*=f,v[9]*=f,v[10]*=f,v[11]*=f,v}getCameraToClipPerspective(a,f,v,S){const T=new Float64Array(16);return o.perspective(T,a,f,v,S),T}getDistanceToElevation(a,f=!1){const v=a===0?0:o.mercatorZfromAltitude(a,f?o.latFromMercatorY(this.position[1]):this.position[1]),S=this.forward();return(v-this.position[2])/S[2]}clone(){return new oc([...this.position],[...this.orientation])}}function xs(y,a){const f=iu(y.projection,y.zoom,y.width,y.height),v=(function(T,N,z,$,Q){const te=new o.LngLat(z.lng-180*La,z.lat),ge=new o.LngLat(z.lng+180*La,z.lat),Ae=T.project(te.lng,te.lat),Le=T.project(ge.lng,ge.lat),Ze=-Math.atan2(Le.y-Ae.y,Le.x-Ae.x),Ue=o.MercatorCoordinate.fromLngLat(z);Ue.y=o.clamp(Ue.y,-1+La,1-La);const Xe=Ue.toLngLat(),_e=T.project(Xe.lng,Xe.lat),Ge=o.MercatorCoordinate.fromLngLat(Xe);Ge.x+=La;const it=Ge.toLngLat(),ot=T.project(it.lng,it.lat),bt=ml(ot.x-_e.x,ot.y-_e.y,Ze),wt=o.MercatorCoordinate.fromLngLat(Xe);wt.y+=La;const _t=wt.toLngLat(),Pt=T.project(_t.lng,_t.lat),kt=ml(Pt.x-_e.x,Pt.y-_e.y,Ze),jt=Math.abs(bt.x)/Math.abs(kt.y),_n=o.identity([]);o.rotateZ(_n,_n,-Ze*(1-(Q?0:$)));const Ut=o.identity([]);return o.scale(Ut,Ut,[1,1-(1-jt)*$,1]),Ut[4]=-kt.x/kt.y*$,o.rotateZ(Ut,Ut,Ze),o.multiply(Ut,_n,Ut),Ut})(y.projection,0,y.center,f,a),S=Ba(y);return o.scale(v,v,[S,S,1]),v}function Ba(y){const a=y.projection,f=iu(y.projection,y.zoom,y.width,y.height),v=Ar(a,y.center),S=Ar(a,o.LngLat.convert(a.center));return Math.pow(2,v*f+(1-f)*S)}function iu(y,a,f,v,S=1/0){const T=y.range;if(!T)return 0;const N=Math.min(S,Math.max(f,v)),z=Math.log(N/1024)/Math.LN2;return o.smoothstep(T[0]+z,T[1]+z,a)}const La=1/4e4;function Ar(y,a){const f=o.clamp(a.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),v=new o.LngLat(a.lng-180*La,f),S=new o.LngLat(a.lng+180*La,f),T=y.project(v.lng,f),N=y.project(S.lng,f),z=o.MercatorCoordinate.fromLngLat(v),$=o.MercatorCoordinate.fromLngLat(S),Q=N.x-T.x,te=N.y-T.y,ge=$.x-z.x,Ae=$.y-z.y,Le=Math.sqrt((ge*ge+Ae*Ae)/(Q*Q+te*te));return Math.log(Le)/Math.LN2}function ml(y,a,f){const v=Math.cos(f),S=Math.sin(f);return{x:y*v-a*S,y:y*S+a*v}}class _a{constructor(a,f,v,S,T,N,z){this.tileSize=512,this._renderWorldCopies=T===void 0||T,this._minZoom=a||0,this._maxZoom=f||22,this._minPitch=v??0,this._maxPitch=S??60,this.setProjection(N),this.setMaxBounds(z),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Qu,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new oc,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const a=new _a(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return a._elevation=this._elevation,a._centerAltitude=this._centerAltitude,a._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,a.tileSize=this.tileSize,a.mercatorFromTransition=this.mercatorFromTransition,a.width=this.width,a.height=this.height,a.cameraElevationReference=this.cameraElevationReference,a._center=this._center,a._setZoom(this.zoom),a._seaLevelZoom=this._seaLevelZoom,a.angle=this.angle,a._fov=this._fov,a._pitch=this._pitch,a._nearZ=this._nearZ,a._farZ=this._farZ,a._averageElevation=this._averageElevation,a._unmodified=this._unmodified,a._edgeInsets=this._edgeInsets.clone(),a._camera=this._camera.clone(),a._calcMatrices(),a.freezeTileCoverage=this.freezeTileCoverage,a.frustumCorners=this.frustumCorners,a}get elevation(){return this._elevation}set elevation(a){this._elevation!==a&&(this._elevation=a,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(a,f=!1){const v=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||v)&&this._updateCameraOnTerrain(),(a||v)&&this._constrainCamera(f),this._calcMatrices()}getProjection(){return o.pick(this.projection,["name","center","parallels"])}setProjection(a){this.projectionOptions=a||{name:"mercator"};const f=this.projection?this.getProjection():void 0;this.projection=o.getProjection(this.projectionOptions);const v=!w(f,this.getProjection());return v&&this._calcMatrices(),this.mercatorFromTransition=!1,v}setMercatorFromTransition(){const a=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.getProjection({name:"mercator"});const f=a!==this.projection.name;return f&&this._calcMatrices(),f}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(a){a===void 0?a=!0:a===null&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get cameraWorldSize(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.Point(this.width,this.height)}get bearing(){return o.wrap(this.rotation,-180,180)}set bearing(a){this.rotation=a}get rotation(){return-this.angle/Math.PI*180}set rotation(a){const f=-a*Math.PI/180;var v;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=(v=new o.ARRAY_TYPE(4),o.ARRAY_TYPE!=Float32Array&&(v[1]=0,v[2]=0),v[0]=1,v[3]=1,v),(function(S,T,N){var z=T[0],$=T[1],Q=T[2],te=T[3],ge=Math.sin(N),Ae=Math.cos(N);S[0]=z*Ae+Q*ge,S[1]=$*Ae+te*ge,S[2]=z*-ge+Q*Ae,S[3]=$*-ge+te*Ae})(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(a){const f=o.clamp(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const a=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/a)}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=o.degToRad(a),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(a){this._averageElevation=a,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(a){const f=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._setZoom(f),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(a){this._zoom=a,this.scale=this.zoomScale(a),this.tileZoom=Math.floor(a),this.zoomFraction=a-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const a=this._elevation;this._centerAltitude=a.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=a.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const a=this._elevation,f=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],v=this.horizonLineFromTop();let S=0,T=0;for(let N=0;N<f.length;N++){const z=new o.Point(f[N][0]*this.width,v+f[N][1]*(this.height-v)),$=a.pointCoordinate(z);if(!$)continue;const Q=1/Math.hypot($[0]-this._camera.position[0],$[1]-this._camera.position[1]);S+=$[3]*Q,T+=Q}return T===0?NaN:S/T}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const a=this._seaLevelZoom,f=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),v=this.pixelsPerMeter/this.worldSize*f,S=this._mercatorZfromZoom(a),T=this._mercatorZfromZoom(this._maxZoom),N=Math.max(S-v,T);this._setZoom(this._zoomFromMercatorZ(N))}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}computeZoomRelativeTo(a){const f=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,a.toAltitude()));let v;v=a.z<this._camera.position[2]?[f.x,f.y,f.z]:[a.x,a.y,a.z];const S=o.length(o.sub([],this._camera.position,v));return o.clamp(this._zoomFromMercatorZ(S),this._minZoom,this._maxZoom)}setFreeCameraOptions(a){if(!this.height||!a.position&&!a.orientation)return;this._updateCameraState();let f=!1;if(a.orientation&&!o.exactEquals(a.orientation,this._camera.orientation)&&(f=this._setCameraOrientation(a.orientation)),a.position){const v=[a.position.x,a.position.y,a.position.z];o.exactEquals$1(v,this._camera.position)||(this._setCameraPosition(v),f=!0)}f&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const a=this._camera.position,f=new ru;return f.position=new o.MercatorCoordinate(a[0],a[1],a[2]),f.orientation=this._camera.orientation,f._elevation=this.elevation,f._renderWorldCopies=this.renderWorldCopies,f}_setCameraOrientation(a){if(!o.length$1(a))return!1;o.normalize$1(a,a);const f=o.transformQuat([],[0,0,-1],a),v=o.transformQuat([],[0,-1,0],a);if(v[2]<0)return!1;const S=Tl(f,v);return!!S&&(this._camera.orientation=S,!0)}_setCameraPosition(a){const f=this.zoomScale(this.minZoom)*this.tileSize,v=this.zoomScale(this.maxZoom)*this.tileSize,S=this.cameraToCenterDistance;a[2]=o.clamp(a[2],S/v,S/f),this._camera.position=a}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,f,v){this._unmodified=!1,this._edgeInsets.interpolate(a,f,v),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){const f=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,f)}getVisibleUnwrappedCoordinates(a){const f=[new o.UnwrappedTileID(0,a)];if(this.renderWorldCopies){const v=this.pointCoordinate(new o.Point(0,0)),S=this.pointCoordinate(new o.Point(this.width,0)),T=this.pointCoordinate(new o.Point(this.width,this.height)),N=this.pointCoordinate(new o.Point(0,this.height)),z=Math.floor(Math.min(v.x,S.x,T.x,N.x)),$=Math.floor(Math.max(v.x,S.x,T.x,N.x)),Q=1;for(let te=z-Q;te<=$+Q;te++)te!==0&&f.push(new o.UnwrappedTileID(te,a))}return f}coveringTiles(a){let f=this.coveringZoomLevel(a);const v=f,S=this.elevation&&!a.isTerrainDEM,T=this.projection.name==="mercator";if(a.minzoom!==void 0&&f<a.minzoom)return[];a.maxzoom!==void 0&&f>a.maxzoom&&(f=a.maxzoom);const N=this.locationCoordinate(this.center),z=this.center.lat,$=1<<f,Q=[$*N.x,$*N.y,0],te=this.projection.name==="globe",ge=!te,Ae=o.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f,ge),Le=te?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Ze=$*o.mercatorZfromAltitude(1,this.center.lat),Ue=this._camera.position[2]/o.mercatorZfromAltitude(1,this.center.lat),Xe=[$*Le.x,$*Le.y,Ue*(ge?1:Ze)],_e=this.cameraToCenterDistance/a.tileSize*(a.roundZoom?1:.502),Ge=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?f:0,it=a.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ot=a.isTerrainDEM?-it:this._elevation?this._elevation.getMinElevationBelowMSL():0,bt=this.projection.isReprojectedInTileSpace?Ba(this):1,wt=Bt=>{const Tn=new o.MercatorCoordinate(Bt.x+25e-6,Bt.y,Bt.z),bn=new o.MercatorCoordinate(Bt.x,Bt.y+25e-6,Bt.z),Rn=Bt.toLngLat(),hr=Tn.toLngLat(),mr=bn.toLngLat(),sr=this.locationCoordinate(Rn),dr=this.locationCoordinate(hr),oi=this.locationCoordinate(mr),di=Math.hypot(dr.x-sr.x,dr.y-sr.y),_r=Math.hypot(oi.x-sr.x,oi.y-sr.y);return Math.sqrt(di*_r)*bt/25e-6},_t=Bt=>{const Yt=it,Tn=ot;return{aabb:o.tileAABB(this,$,0,0,0,Bt,Tn,Yt,this.projection),zoom:0,x:0,y:0,minZ:Tn,maxZ:Yt,wrap:Bt,fullyVisible:!1}},Pt=[];let kt=[];const jt=f,_n=a.reparseOverscaled?v:f,Ut=Bt=>Bt*Bt,cn=Ut((Ue-this._centerAltitude)*Ze),Wt=Bt=>{if(!this._elevation||!Bt.tileID||!T)return;const Yt=this._elevation.getMinMaxForTile(Bt.tileID),Tn=Bt.aabb;Yt?(Tn.min[2]=Yt.min,Tn.max[2]=Yt.max,Tn.center[2]=(Tn.min[2]+Tn.max[2])/2):(Bt.shouldSplit=In(Bt),Bt.shouldSplit||(Tn.min[2]=Tn.max[2]=Tn.center[2]=this._centerAltitude))},In=Bt=>{if(Bt.zoom<Ge)return!0;if(Bt.zoom===jt)return!1;if(Bt.shouldSplit!=null)return Bt.shouldSplit;const Yt=Bt.aabb.distanceX(Xe),Tn=Bt.aabb.distanceY(Xe);let bn=cn,Rn=1;if(te){bn=Ut(Bt.aabb.distanceZ(Xe));const sr=Math.pow(2,Bt.zoom),dr=o.latFromMercatorY((Bt.y+1)/sr),oi=o.latFromMercatorY(Bt.y/sr),di=Math.min(Math.max(z,dr),oi),_r=o.circumferenceAtLatitude(di)/o.circumferenceAtLatitude(z);if(Rn=di===z?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,_r/this._mercatorScaleRatio),this.zoom<=o.GLOBE_ZOOM_THRESHOLD_MIN&&Bt.zoom===jt-1&&_r>=.9)return!0}else if(S&&(bn=Ut(Bt.aabb.distanceZ(Xe)*Ze)),this.projection.isReprojectedInTileSpace&&v<=5){const sr=Math.pow(2,Bt.zoom),dr=wt(new o.MercatorCoordinate((Bt.x+.5)/sr,(Bt.y+.5)/sr));Rn=dr>.85?1:dr}const hr=Yt*Yt+Tn*Tn+bn,mr=Ut((1<<jt-Bt.zoom)*_e*Rn*((sr,dr)=>{if(dr*Ut(.707)<sr)return 1;const oi=Math.sqrt(dr/sr);return oi/(1.4144271570014144+(Math.pow(1.1,oi-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(bn,cn),hr));return hr<mr};if(this.renderWorldCopies)for(let Bt=1;Bt<=3;Bt++)Pt.push(_t(-Bt)),Pt.push(_t(Bt));for(Pt.push(_t(0));Pt.length>0;){const Bt=Pt.pop(),Yt=Bt.x,Tn=Bt.y;let bn=Bt.fullyVisible;if(!bn){const Rn=Bt.aabb.intersects(Ae);if(Rn===0)continue;bn=Rn===2}if(Bt.zoom!==jt&&In(Bt))for(let Rn=0;Rn<4;Rn++){const hr=(Yt<<1)+Rn%2,mr=(Tn<<1)+(Rn>>1),sr={aabb:T?Bt.aabb.quadrant(Rn):o.tileAABB(this,$,Bt.zoom+1,hr,mr,Bt.wrap,Bt.minZ,Bt.maxZ,this.projection),zoom:Bt.zoom+1,x:hr,y:mr,wrap:Bt.wrap,fullyVisible:bn,tileID:void 0,shouldSplit:void 0,minZ:Bt.minZ,maxZ:Bt.maxZ};S&&!te&&(sr.tileID=new o.OverscaledTileID(Bt.zoom+1===jt?_n:Bt.zoom+1,Bt.wrap,Bt.zoom+1,hr,mr),Wt(sr)),Pt.push(sr)}else{const Rn=Bt.zoom===jt?_n:Bt.zoom;if(a.minzoom&&a.minzoom>Rn)continue;const hr=Q[0]-(.5+Yt+(Bt.wrap<<Bt.zoom))*(1<<f-Bt.zoom),mr=Q[1]-.5-Tn,sr=Bt.tileID?Bt.tileID:new o.OverscaledTileID(Rn,Bt.wrap,Bt.zoom,Yt,Tn);kt.push({tileID:sr,distanceSq:hr*hr+mr*mr})}}if(this.fogCullDistSq){const Bt=this.fogCullDistSq,Yt=this.horizonLineFromTop();kt=kt.filter((Tn=>{const bn=[0,0,0,1],Rn=[o.EXTENT,o.EXTENT,0,1],hr=this.calculateFogTileMatrix(Tn.tileID.toUnwrapped());o.transformMat4$1(bn,bn,hr),o.transformMat4$1(Rn,Rn,hr);const mr=o.getAABBPointSquareDist(bn,Rn);if(mr===0)return!0;let sr=!1;const dr=this._elevation;if(dr&&mr>Bt&&Yt!==0){const oi=this.calculateProjMatrix(Tn.tileID.toUnwrapped());let di;a.isTerrainDEM||(di=dr.getMinMaxForTile(Tn.tileID)),di||(di={min:ot,max:it});const _r=o.furthestTileCorner(this.rotation),Zr=[_r[0]*o.EXTENT,_r[1]*o.EXTENT,di.max];o.transformMat4(Zr,Zr,oi),sr=(1-Zr[1])*this.height*.5<Yt}return mr<Bt||sr}))}return kt.sort(((Bt,Yt)=>Bt.distanceSq-Yt.distanceSq)).map((Bt=>Bt.tileID))}resize(a,f){this.width=a,this.height=f,this.pixelsToGLUnits=[2/a,-2/f],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){const f=o.clamp(a.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),v=this.projection.project(a.lng,f);return new o.Point(v.x*this.worldSize,v.y*this.worldSize)}unproject(a){return this.projection.unproject(a.x/this.worldSize,a.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(a,f){let v,S;const T=this.centerPoint;if(this.projection.name==="globe"){const z=this.worldSize;v=(f.x-T.x)/z,S=(f.y-T.y)/z}else{const z=this.pointCoordinate(f),$=this.pointCoordinate(T);v=z.x-$.x,S=z.y-$.y}const N=this.locationCoordinate(a);this.setLocation(new o.MercatorCoordinate(N.x-v,N.y-S))}setLocation(a){this.center=this.coordinateLocation(a),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(a){return this.projection.locationPoint(this,a)}locationPoint3D(a){return this.projection.locationPoint(this,a,!0)}pointLocation(a){return this.coordinateLocation(this.pointCoordinate(a))}pointLocation3D(a){return this.coordinateLocation(this.pointCoordinate3D(a))}locationCoordinate(a,f){const v=f?o.mercatorZfromAltitude(f,a.lat):void 0,S=this.projection.project(a.lng,a.lat);return new o.MercatorCoordinate(S.x,S.y,v)}coordinateLocation(a){return this.projection.unproject(a.x,a.y)}pointRayIntersection(a,f){const v=f??this._centerAltitude,S=[a.x,a.y,0,1],T=[a.x,a.y,1,1];o.transformMat4$1(S,S,this.pixelMatrixInverse),o.transformMat4$1(T,T,this.pixelMatrixInverse);const N=T[3];o.scale$1(S,S,1/S[3]),o.scale$1(T,T,1/N);const z=S[2],$=T[2];return{p0:S,p1:T,t:z===$?0:(v-z)/($-z)}}screenPointToMercatorRay(a){const f=[a.x,a.y,0,1],v=[a.x,a.y,1,1];return o.transformMat4$1(f,f,this.pixelMatrixInverse),o.transformMat4$1(v,v,this.pixelMatrixInverse),o.scale$1(f,f,1/f[3]),o.scale$1(v,v,1/v[3]),f[2]=o.mercatorZfromAltitude(f[2],this._center.lat)*this.worldSize,v[2]=o.mercatorZfromAltitude(v[2],this._center.lat)*this.worldSize,o.scale$1(f,f,1/this.worldSize),o.scale$1(v,v,1/this.worldSize),new o.Ray([f[0],f[1],f[2]],o.normalize([],o.sub([],v,f)))}rayIntersectionCoordinate(a){const{p0:f,p1:v,t:S}=a,T=o.mercatorZfromAltitude(f[2],this._center.lat),N=o.mercatorZfromAltitude(v[2],this._center.lat);return new o.MercatorCoordinate(o.number(f[0],v[0],S)/this.worldSize,o.number(f[1],v[1],S)/this.worldSize,o.number(T,N,S))}pointCoordinate(a,f=this._centerAltitude){return this.projection.pointCoordinate(this,a.x,a.y,f)}pointCoordinate3D(a){if(!this.elevation)return this.pointCoordinate(a);let f=this.projection.pointCoordinate3D(this,a.x,a.y);if(f)return new o.MercatorCoordinate(f[0],f[1],f[2]);let v=0,S=this.horizonLineFromTop();if(a.y>S)return this.pointCoordinate(a);const T=.02*S,N=a.clone();for(let z=0;z<10&&S-v>T;z++){N.y=o.number(v,S,.66);const $=this.projection.pointCoordinate3D(this,N.x,N.y);$?(S=N.y,f=$):v=N.y}return f?new o.MercatorCoordinate(f[0],f[1],f[2]):this.pointCoordinate(a)}isPointAboveHorizon(a){return this.projection.isPointAboveHorizon(this,a)}isPointOnSurface(a){if(a.y<0||a.y>this.height||a.x<0||a.x>this.width)return!1;if(this.elevation||this.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(a);const f=this.pointCoordinate(a);return f.y>=0&&f.y<=1}_coordinatePoint(a,f){const v=f&&this.elevation?this.elevation.getAtPointOrZero(a,this._centerAltitude):this._centerAltitude,S=[a.x*this.worldSize,a.y*this.worldSize,v+a.toAltitude(),1];return o.transformMat4$1(S,S,this.pixelMatrix),S[3]>0?new o.Point(S[0]/S[3],S[1]/S[3]):new o.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:a,left:f}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,T=this.pointLocation3D(new o.Point(f,a)),N=this.pointLocation3D(new o.Point(S,a)),z=this.pointLocation3D(new o.Point(S,v)),$=this.pointLocation3D(new o.Point(f,v));let Q=Math.min(T.lng,N.lng,z.lng,$.lng),te=Math.max(T.lng,N.lng,z.lng,$.lng),ge=Math.min(T.lat,N.lat,z.lat,$.lat),Ae=Math.max(T.lat,N.lat,z.lat,$.lat);const Le=Math.pow(2,-this.zoom)/16*270,Ze=this.projection.name==="globe"?1:4,Ue=(Xe,_e,Ge,it,ot)=>{const bt=(Xe+Ge)/2,wt=(_e+it)/2,_t=new o.Point(bt,wt),{lng:Pt,lat:kt}=this.pointLocation3D(_t),jt=Math.max(0,Q-Pt,ge-kt,Pt-te,kt-Ae);Q=Math.min(Q,Pt),te=Math.max(te,Pt),ge=Math.min(ge,kt),Ae=Math.max(Ae,kt),(ot<Ze||jt>Le)&&(Ue(Xe,_e,bt,wt,ot+1),Ue(bt,wt,Ge,it,ot+1))};if(Ue(f,a,S,a,1),Ue(S,a,S,v,1),Ue(S,v,f,v,1),Ue(f,v,f,a,1),this.projection.name==="globe"){const[Xe,_e]=o.polesInViewport(this);Xe?(Ae=90,te=180,Q=-180):_e&&(ge=-90,te=180,Q=-180)}return new o.LngLatBounds(new o.LngLat(Q,ge),new o.LngLat(te,Ae))}_getBoundsRectangular(a,f){const{top:v,left:S}=this._edgeInsets,T=this.height-this._edgeInsets.bottom,N=this.width-this._edgeInsets.right,z=new o.Point(S,v),$=new o.Point(N,v),Q=new o.Point(N,T),te=new o.Point(S,T);let ge=this.pointCoordinate(z,a),Ae=this.pointCoordinate($,a);const Le=this.pointCoordinate(Q,f),Ze=this.pointCoordinate(te,f),Ue=(Xe,_e)=>(_e.y-Xe.y)/(_e.x-Xe.x);return ge.y>1&&Ae.y>=0?ge=new o.MercatorCoordinate((1-Ze.y)/Ue(Ze,ge)+Ze.x,1):ge.y<0&&Ae.y<=1&&(ge=new o.MercatorCoordinate(-Ze.y/Ue(Ze,ge)+Ze.x,0)),Ae.y>1&&ge.y>=0?Ae=new o.MercatorCoordinate((1-Le.y)/Ue(Le,Ae)+Le.x,1):Ae.y<0&&ge.y<=1&&(Ae=new o.MercatorCoordinate(-Le.y/Ue(Le,Ae)+Le.x,0)),new o.LngLatBounds().extend(this.coordinateLocation(ge)).extend(this.coordinateLocation(Ae)).extend(this.coordinateLocation(Ze)).extend(this.coordinateLocation(Le))}_getBoundsRectangularTerrain(){const a=this.elevation;if(!a.visibleDemTiles.length||a.isUsingMockSource())return this._getBoundsRectangular(0,0);const f=a.visibleDemTiles.reduce(((v,S)=>{if(S.dem){const T=S.dem.tree;v.min=Math.min(v.min,T.minimums[0]),v.max=Math.max(v.max,T.maximums[0])}return v}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(f.min*a.exaggeration(),f.max*a.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(a=!0){const f=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,v=this.height/2-f*(1-this._horizonShift);return a?Math.max(0,v):v}getMaxBounds(){return this.maxBounds}setMaxBounds(a){this.maxBounds=a,this.minLat=-o.MAX_MERCATOR_LATITUDE,this.maxLat=o.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,a&&(this.minLat=a.getSouth(),this.maxLat=a.getNorth(),this.minLng=a.getWest(),this.maxLng=a.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=o.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=o.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=o.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(a,f){return this.projection.createTileMatrix(this,f,a)}calculateDistanceTileData(a){const f=a.key,v=this._distanceTileDataCache;if(v[f])return v[f];const S=a.canonical,T=1/this.height,N=this.cameraWorldSize,z=N/this.zoomScale(S.z),$=(S.x+Math.pow(2,S.z)*a.wrap)*z,Q=S.y*z,te=this.point;te.x*=N/this.worldSize,te.y*=N/this.worldSize;const ge=this.angle,Ae=Math.sin(-ge),Le=-Math.cos(-ge);return v[f]={bearing:[Ae,Le],center:[(te.x-$)*T,(te.y-Q)*T],scale:z/o.EXTENT*T},v[f]}calculateFogTileMatrix(a){const f=a.key,v=this._fogTileMatrixCache;if(v[f])return v[f];const S=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,a);return o.multiply(S,this.worldToFogMatrix,S),v[f]=new Float32Array(S),v[f]}calculateProjMatrix(a,f=!1){const v=a.key,S=f?this._alignedProjMatrixCache:this._projMatrixCache;if(S[v])return S[v];const T=this.calculatePosMatrix(a,this.worldSize);return o.multiply(T,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:f?this.alignedProjMatrix:this.projMatrix,T),S[v]=new Float32Array(T),S[v]}calculatePixelsToTileUnitsMatrix(a){const f=a.tileID.key,v=this._pixelsToTileUnitsCache;if(v[f])return v[f];const S=(function(T,N){const{scale:z}=T.tileTransform,$=z*o.EXTENT/(T.tileSize*Math.pow(2,N.zoom-T.tileID.overscaledZ+T.tileID.canonical.z));return Q=new Float32Array(4),Ae=(te=N.inverseAdjustmentMatrix)[1],Le=te[2],Ze=te[3],Xe=(ge=[$,$])[1],Q[0]=te[0]*(Ue=ge[0]),Q[1]=Ae*Ue,Q[2]=Le*Xe,Q[3]=Ze*Xe,Q;var Q,te,ge,Ae,Le,Ze,Ue,Xe})(a,this);return v[f]=S,v[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const a=1/this.worldSize,f=o.fromScaling([],[a,a,a]);return o.multiply(f,f,this.globeMatrix),f}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const a=this._elevation;this._updateCameraState();const f=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(f),S=this._camera.forward(),T=o.mercatorZfromAltitude(1,this._center.lat);v[2]/=T,S[2]/=T,o.normalize(S,S);const N=a.raycast(v,S,a.exaggeration());if(N){const z=o.scaleAndAdd([],v,S,N),$=new o.MercatorCoordinate(z[0],z[1],o.mercatorZfromAltitude(z[2],o.latFromMercatorY(z[1]))),Q=($.z+o.length([$.x-v[0],$.y-v[1],$.z-v[2]*T]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(Q),this._centerAltitude=$.toAltitude(),this._center=this.coordinateLocation($),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(a=!1){if(!this._elevation)return;const f=this._elevation,v=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,S=this._computeCameraPosition(v),T=f.getAtPointOrZero(new o.MercatorCoordinate(...S)),N=this.pixelsPerMeter/this.worldSize*T,z=this._minimumHeightOverTerrain(),$=S[2]-N;if($<=z)if($<0||a){const Q=this.locationCoordinate(this._center,this._centerAltitude),te=[S[0],S[1],Q.z-S[2]],ge=o.length(te);te[2]-=(z-$)/this._pixelsPerMercatorPixel;const Ae=o.length(te);if(Ae===0)return;o.scale$2(te,te,ge/Ae*this._pixelsPerMercatorPixel),this._camera.position=[S[0],S[1],Q.z*this._pixelsPerMercatorPixel-te[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const a=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||a){const Ae=this.center;return Ae.lat=o.clamp(Ae.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!a)&&(Ae.lng=o.clamp(Ae.lng,this.minLng,this.maxLng)),this.center=Ae,void(this._constraining=!1)}const f=this._unmodified,{x:v,y:S}=this.point;let T=0,N=v,z=S;const $=this.width/2,Q=this.height/2,te=this.worldMinY*this.scale,ge=this.worldMaxY*this.scale;if(S-Q<te&&(z=te+Q),S+Q>ge&&(z=ge-Q),ge-te<this.height&&(T=Math.max(T,this.height/(ge-te)),z=(ge+te)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Ae=this.worldMinX*this.scale,Le=this.worldMaxX*this.scale,Ze=this.worldSize/2-(Ae+Le)/2;N=(v+Ze+this.worldSize)%this.worldSize-Ze,N-$<Ae&&(N=Ae+$),N+$>Le&&(N=Le-$),Le-Ae<this.width&&(T=Math.max(T,this.width/(Le-Ae)),N=(Le+Ae)/2)}N===v&&z===S||(this.center=this.unproject(new o.Point(N,z))),T&&(this.zoom+=this.scaleZoom(T)),this._constrainCamera(),this._unmodified=f,this._constraining=!1}_minZoomForBounds(){let a=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(a=Math.max(a,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),a}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const a=this.centerOffset,f=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.mercatorZfromAltitude(1,this.center.lat)/o.mercatorZfromAltitude(1,o.GLOBE_SCALE_MATCH_LATITUDE));const v=iu(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const S=this.projection.zAxisUnit==="meters"?f:1,T=this._camera.getWorldToCamera(this.worldSize,S),N=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);N[8]=2*-a.x/this.width,N[9]=2*a.y/this.height;let z=o.mul([],N,T);if(this.projection.isReprojectedInTileSpace){const wt=this.locationCoordinate(this.center),_t=o.identity([]);o.translate(_t,_t,[wt.x*this.worldSize,wt.y*this.worldSize,0]),o.multiply(_t,_t,xs(this)),o.translate(_t,_t,[-wt.x*this.worldSize,-wt.y*this.worldSize,0]),o.multiply(z,z,_t),this.inverseAdjustmentMatrix=(function(Pt){const kt=xs(Pt,!0);return q([],[kt[0],kt[1],kt[4],kt[5]])})(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=o.scale([],z,[this.worldSize,this.worldSize,this.worldSize/S,1]),this.projMatrix=z,this.invProjMatrix=o.invert(new Float64Array(16),this.projMatrix);const $=o.invert([],N);this.frustumCorners=o.FrustumCorners.fromInvProjectionMatrix($,this.horizonLineFromTop(),this.height);const Q=new Float32Array(16);o.identity(Q),o.scale(Q,Q,[1,-1,1]),o.rotateX(Q,Q,this._pitch),o.rotateZ(Q,Q,this.angle);const te=o.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),ge=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;te[8]=2*-a.x/this.width,te[9]=2*(a.y+ge)/this.height,this.skyboxMatrix=o.multiply(Q,te,Q);const Ae=this.point,Le=Ae.x,Ze=Ae.y,Ue=this.width%2/2,Xe=this.height%2/2,_e=Math.cos(this.angle),Ge=Math.sin(this.angle),it=Le-Math.round(Le)+_e*Ue+Ge*Xe,ot=Ze-Math.round(Ze)+_e*Xe+Ge*Ue,bt=new Float64Array(z);if(o.translate(bt,bt,[it>.5?it-1:it,ot>.5?ot-1:ot,0]),this.alignedProjMatrix=bt,z=o.create(),o.scale(z,z,[this.width/2,-this.height/2,1]),o.translate(z,z,[1,-1,0]),this.labelPlaneMatrix=z,z=o.create(),o.scale(z,z,[1,-1,1]),o.translate(z,z,[-1,-1,0]),o.scale(z,z,[2/this.width,2/this.height,1]),this.glCoordMatrix=z,this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},z=o.invert(new Float64Array(16),this.pixelMatrix),!z)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=z,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.calculateGlobeMatrix(this);const wt=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.transformMat4(wt,wt,T),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=z;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const a=this.cameraWorldSizeForFog,f=this.cameraPixelsPerMeter,v=this._camera.position,S=1/this.height/this._pixelsPerMercatorPixel,T=[a,a,f];o.scale$2(T,T,S),o.scale$2(v,v,-1),o.multiply$2(v,v,T);const N=o.create();o.translate(N,N,v),o.scale(N,N,T),this.mercatorFogMatrix=N,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(a,f,S)}_computeCameraPosition(a){const f=(a=a||this.pixelsPerMeter)/this.pixelsPerMeter,v=this._camera.forward(),S=this.point,T=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*f-a/this.worldSize*this._centerAltitude;return[S.x/this.worldSize-v[0]*T,S.y/this.worldSize-v[1]*T,a/this.worldSize*this._centerAltitude-v[2]*T]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(a){const f=this._maxCameraBoundsDistance()*Math.cos(this._pitch),v=this._camera.position[2],S=a[2];let T=1;this.projection.wrap&&(this.center=this.center.wrap()),S>0&&(T=Math.min((f-v)/S,1)),this._camera.position=o.scaleAndAdd([],this._camera.position,a,T),this._updateStateFromCamera()}_updateStateFromCamera(){const a=this._camera.position,f=this._camera.forward(),{pitch:v,bearing:S}=this._camera.getPitchBearing(),T=o.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,N=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.degToRad(this._maxPitch)),z=Math.max((a[2]-T)/Math.cos(v),N),$=this._zoomFromMercatorZ(z);o.scaleAndAdd(a,a,f,z),this._pitch=o.clamp(v,o.degToRad(this.minPitch),o.degToRad(this.maxPitch)),this.angle=o.wrap(S,-Math.PI,Math.PI),this._setZoom(o.clamp($,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.MercatorCoordinate(a[0],a[1],a[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(a){return Math.pow(2,a)*this.tileSize}_mercatorZfromZoom(a){return this.cameraToCenterDistance/this._worldSizeFromZoom(a)}_minimumHeightOverTerrain(){const a=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(a)}_zoomFromMercatorZ(a){return this.scaleZoom(this.cameraToCenterDistance/(a*this.tileSize))}zoomFromMercatorZAdjusted(a){let f=0,v=o.GLOBE_ZOOM_THRESHOLD_MAX,S=0,T=1/0;for(;v-f>1e-6&&v>f;){const N=f+.5*(v-f),z=this.tileSize*Math.pow(2,N),$=this.getCameraToCenterDistance(this.projection,N,z),Q=this.scaleZoom($/(a*this.tileSize)),te=Math.abs(N-Q);te<T&&(T=te,S=N),N<Q?f=N:v=N}return S}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(a,f){const v=Math.min(a.x,f.x),S=Math.max(a.x,f.x),T=Math.min(a.y,f.y),N=Math.max(a.y,f.y);if(T<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const z=[new o.Point(v,T),new o.Point(S,N),new o.Point(v,N),new o.Point(S,T)],$=this.renderWorldCopies?-3:0,Q=this.renderWorldCopies?4:1;for(const te of z){const ge=this.pointRayIntersection(te);if(ge.t<0)return!0;const Ae=this.rayIntersectionCoordinate(ge);if(Ae.x<$||Ae.y<0||Ae.x>Q||Ae.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.Point(0,0),new o.Point(this.width,this.height))}zoomDeltaToMovement(a,f){const v=o.length(o.sub([],this._camera.position,a)),S=this._zoomFromMercatorZ(v)+f;return v-this._mercatorZfromZoom(S)}getCameraPoint(){if(this.projection.name==="globe"){const a=(function([f,v,S],T){const N=[f,v,S,1];o.transformMat4$1(N,N,T);const z=N[3]=Math.max(N[3],1e-6);return N[0]/=z,N[1]/=z,N[2]/=z,N})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.Point(a[0],a[1])}{const a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.Point(0,a))}}getCameraToCenterDistance(a,f=this.zoom,v=this.worldSize){const S=iu(a,f,this.width,this.height,1024),T=a.pixelSpaceConversion(this.center.lat,v,S);return .5/Math.tan(.5*this._fov)*this.height*T}getWorldToCameraMatrix(){const a=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.multiply(a,a,this.globeMatrix),a}}function Bo(y,a){let f=!1,v=null;const S=()=>{v=null,f&&(y(),v=setTimeout(S,a),f=!1)};return()=>(f=!0,v||S(),v)}class Fu{constructor(a){this._hashName=a&&encodeURIComponent(a),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Bo(this._updateHashUnthrottled.bind(this),300)}addTo(a){return this._map=a,o.window.addEventListener("hashchange",this._onHashChange,!1),a.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),o.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const a=this._map;if(!a)return"";const f=Ic(a);if(this._hashName){const v=this._hashName;let S=!1;const T=o.window.location.hash.slice(1).split("&").map((N=>{const z=N.split("=")[0];return z===v?(S=!0,`${z}=${f}`):N})).filter((N=>N));return S||T.push(`${v}=${f}`),`#${T.join("&")}`}return`#${f}`}_getCurrentHash(){const a=o.window.location.hash.replace("#","");if(this._hashName){let f;return a.split("&").map((v=>v.split("="))).forEach((v=>{v[0]===this._hashName&&(f=v)})),(f&&f[1]||"").split("/")}return a.split("/")}_onHashChange(){const a=this._map;if(!a)return!1;const f=this._getCurrentHash();if(f.length>=3&&!f.some((v=>isNaN(v)))){const v=a.dragRotate.isEnabled()&&a.touchZoomRotate.isEnabled()?+(f[3]||0):a.getBearing();return a.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:v,pitch:+(f[4]||0)}),!0}return!1}_updateHashUnthrottled(){const a=o.window.location.href.replace(/(#.+)?$/,this.getHashString());o.window.history.replaceState(o.window.history.state,null,a)}}function Ic(y,a){const f=y.getCenter(),v=Math.round(100*y.getZoom())/100,S=Math.ceil((v*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,S),N=Math.round(f.lng*T)/T,z=Math.round(f.lat*T)/T,$=y.getBearing(),Q=y.getPitch();let te=a?`/${N}/${z}/${v}`:`${v}/${z}/${N}`;return($||Q)&&(te+="/"+Math.round(10*$)/10),Q&&(te+=`/${Math.round(Q)}`),te}const sc={linearity:.3,easing:o.bezier(0,0,.3,1)},Ii=o.extend({deceleration:2500,maxSpeed:1400},sc),za=o.extend({deceleration:20,maxSpeed:1400},sc),Un=o.extend({deceleration:1e3,maxSpeed:360},sc),Rs=o.extend({deceleration:1e3,maxSpeed:90},sc);class Ns{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,f=o.exported.now();for(;a.length>0&&f-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const f={zoom:0,bearing:0,pitch:0,pan:new o.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:T}of this._inertiaBuffer)f.zoom+=T.zoomDelta||0,f.bearing+=T.bearingDelta||0,f.pitch+=T.pitchDelta||0,T.panDelta&&f.pan._add(T.panDelta),T.around&&(f.around=T.around),T.pinchAround&&(f.pinchAround=T.pinchAround);const v=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,S={};if(f.pan.mag()){const T=va(f.pan.mag(),v,o.extend({},Ii,a||{}));S.offset=f.pan.mult(T.amount/f.pan.mag()),S.center=this._map.transform.center,lo(S,T)}if(f.zoom){const T=va(f.zoom,v,za);S.zoom=this._map.transform.zoom+T.amount,lo(S,T)}if(f.bearing){const T=va(f.bearing,v,Un);S.bearing=this._map.transform.bearing+o.clamp(T.amount,-179,179),lo(S,T)}if(f.pitch){const T=va(f.pitch,v,Rs);S.pitch=this._map.transform.pitch+T.amount,lo(S,T)}if(S.zoom||S.bearing){const T=f.pinchAround===void 0?f.around:f.pinchAround;S.around=T?this._map.unproject(T):this._map.getCenter()}return this.clear(),S.noMoveStart=!0,S}}function lo(y,a){(!y.duration||y.duration<a.duration)&&(y.duration=a.duration,y.easing=a.easing)}function va(y,a,f){const{maxSpeed:v,linearity:S,deceleration:T}=f,N=o.clamp(y*S/(a/1e3),-v,v),z=Math.abs(N)/(T*S);return{easing:f.easing,duration:1e3*z,amount:N*(z/2)}}class gl extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,f,v,S={}){const T=ze(f.getCanvasContainer(),v),N=f.unproject(T);super(a,o.extend({point:T,lngLat:N,originalEvent:v},S)),this._defaultPrevented=!1,this.target=f}}class Jh extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,f,v){const S=a==="touchend"?v.changedTouches:v.touches,T=pe(f.getCanvasContainer(),S),N=T.map(($=>f.unproject($))),z=T.reduce((($,Q,te,ge)=>$.add(Q.div(ge.length))),new o.Point(0,0));super(a,{points:T,point:z,lngLats:N,lngLat:f.unproject(z),originalEvent:v}),this._defaultPrevented=!1}}class ii extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,f,v){super(a,{originalEvent:v}),this._defaultPrevented=!1}}class bu{constructor(a,f){this._map=a,this._clickTolerance=f.clickTolerance}reset(){this._mousedownPos=void 0}wheel(a){return this._firePreventable(new ii(a.type,this._map,a))}mousedown(a,f){return this._mousedownPos=f,this._firePreventable(new gl(a.type,this._map,a))}mouseup(a){this._map.fire(new gl(a.type,this._map,a))}preclick(a){const f=o.extend({},a);f.type="preclick",this._map.fire(new gl(f.type,this._map,f))}click(a,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||(this.preclick(a),this._map.fire(new gl(a.type,this._map,a)))}dblclick(a){return this._firePreventable(new gl(a.type,this._map,a))}mouseover(a){this._map.fire(new gl(a.type,this._map,a))}mouseout(a){this._map.fire(new gl(a.type,this._map,a))}touchstart(a){return this._firePreventable(new Jh(a.type,this._map,a))}touchmove(a){this._map.fire(new Jh(a.type,this._map,a))}touchend(a){this._map.fire(new Jh(a.type,this._map,a))}touchcancel(a){this._map.fire(new Jh(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class th{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(a){this._map.fire(new gl(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new gl("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._map.fire(new gl(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ks{constructor(a,f){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,f){this.isEnabled()&&a.shiftKey&&a.button===0&&(ne(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(a,f){if(!this._active)return;const v=f,S=this._startPos,T=this._lastPos;if(!S||!T||T.equals(v)||!this._box&&v.dist(S)<this._clickTolerance)return;this._lastPos=v,this._box||(this._box=k("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",a));const N=Math.min(S.x,v.x),z=Math.max(S.x,v.x),$=Math.min(S.y,v.y),Q=Math.max(S.y,v.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${N}px,${$}px)`,this._box.style.width=z-N+"px",this._box.style.height=Q-$+"px")}))}mouseupWindow(a,f){if(!this._active)return;const v=this._startPos,S=f;if(v&&a.button===0){if(this.reset(),ke(),v.x!==S.x||v.y!==S.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:a})),{cameraAnimation:T=>T.fitScreenCoordinates(v,S,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",a)}}keydown(a){this._active&&a.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",a))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),me(),delete this._startPos,delete this._lastPos}_fireEvent(a,f){return this._map.fire(new o.Event(a,{originalEvent:f}))}}function Pa(y,a){const f={};for(let v=0;v<y.length;v++)f[y[v].identifier]=a[v];return f}class Vc{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(a,f,v){(this.centroid||v.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=a.timeStamp),v.length===this.numTouches&&(this.centroid=(function(S){const T=new o.Point(0,0);for(const N of S)T._add(N);return T.div(S.length)})(f),this.touches=Pa(v,f)))}touchmove(a,f,v){if(this.aborted||!this.centroid)return;const S=Pa(v,f);for(const T in this.touches){const N=S[T];(!N||N.dist(this.touches[T])>30)&&(this.aborted=!0)}}touchend(a,f,v){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),v.length===0){const S=!this.aborted&&this.centroid;if(this.reset(),S)return S}}}class ac{constructor(a){this.singleTap=new Vc(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(a,f,v){this.singleTap.touchstart(a,f,v)}touchmove(a,f,v){this.singleTap.touchmove(a,f,v)}touchend(a,f,v){const S=this.singleTap.touchend(a,f,v);if(S){const T=a.timeStamp-this.lastTime<500,N=!this.lastTap||this.lastTap.dist(S)<30;if(T&&N||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=S,this.count===this.numTaps)return this.reset(),S}}}class Qh{constructor(){this._zoomIn=new ac({numTouches:1,numTaps:2}),this._zoomOut=new ac({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,f,v){this._zoomIn.touchstart(a,f,v),this._zoomOut.touchstart(a,f,v)}touchmove(a,f,v){this._zoomIn.touchmove(a,f,v),this._zoomOut.touchmove(a,f,v)}touchend(a,f,v){const S=this._zoomIn.touchend(a,f,v),T=this._zoomOut.touchend(a,f,v);return S?(this._active=!0,a.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:N=>N.easeTo({duration:300,zoom:N.getZoom()+1,around:N.unproject(S)},{originalEvent:a})}):T?(this._active=!0,a.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:N=>N.easeTo({duration:300,zoom:N.getZoom()-1,around:N.unproject(T)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Zf={0:1,2:2};class nh{constructor(a){this.reset(),this._clickTolerance=a.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(a,f){return!1}_move(a,f){return{}}mousedown(a,f){if(this._lastPoint)return;const v=U(a);this._correctButton(a,v)&&(this._lastPoint=f,this._eventButton=v)}mousemoveWindow(a,f){const v=this._lastPoint;if(v){if(a.preventDefault(),this._eventButton!=null&&(function(S,T){const N=Zf[T];return S.buttons===void 0||(S.buttons&N)!==N})(a,this._eventButton))this.reset();else if(this._moved||!(f.dist(v)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(v,f)}}mouseupWindow(a){this._lastPoint&&U(a)===this._eventButton&&(this._moved&&ke(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vo extends nh{mousedown(a,f){super.mousedown(a,f),this._lastPoint&&(this._active=!0)}_correctButton(a,f){return f===0&&!a.ctrlKey}_move(a,f){return{around:f,panDelta:f.sub(a)}}}class ca extends nh{_correctButton(a,f){return f===0&&a.ctrlKey||f===2}_move(a,f){const v=.8*(f.x-a.x);if(v)return this._active=!0,{bearingDelta:v}}contextmenu(a){a.preventDefault()}}class ja extends nh{_correctButton(a,f){return f===0&&a.ctrlKey||f===2}_move(a,f){const v=-.5*(f.y-a.y);if(v)return this._active=!0,{pitchDelta:v}}contextmenu(a){a.preventDefault()}}class nl{constructor(a,f){this._map=a,this._el=a.getCanvasContainer(),this._minTouches=1,this._clickTolerance=f.clickTolerance||1,this.reset(),o.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.Point(0,0)}touchstart(a,f,v){return this._calculateTransform(a,f,v)}touchmove(a,f,v){if(this._active&&!(v.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(v.length===1&&!o.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return a.cancelable&&a.preventDefault(),this._calculateTransform(a,f,v)}}touchend(a,f,v){this._calculateTransform(a,f,v),this._active&&v.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,f,v){v.length>0&&(this._active=!0);const S=Pa(v,f),T=new o.Point(0,0),N=new o.Point(0,0);let z=0;for(const Q in S){const te=S[Q],ge=this._touches[Q];ge&&(T._add(te),N._add(te.sub(ge)),z++,S[Q]=te)}if(this._touches=S,z<this._minTouches||!N.mag())return;const $=N.div(z);return this._sum._add($),this._sum.mag()<this._clickTolerance?void 0:{around:T.div(z),panDelta:$}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=k("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")}),500)}}class xo{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(a){}_move(a,f,v){return{}}touchstart(a,f,v){this._firstTwoTouches||v.length<2||(this._firstTwoTouches=[v[0].identifier,v[1].identifier],this._start([f[0],f[1]]))}touchmove(a,f,v){const S=this._firstTwoTouches;if(!S)return;a.preventDefault();const[T,N]=S,z=ou(v,f,T),$=ou(v,f,N);if(!z||!$)return;const Q=this._aroundCenter?null:z.add($).div(2);return this._move([z,$],Q,a)}touchend(a,f,v){if(!this._firstTwoTouches)return;const[S,T]=this._firstTwoTouches,N=ou(v,f,S),z=ou(v,f,T);N&&z||(this._active&&ke(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&a.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ou(y,a,f){for(let v=0;v<y.length;v++)if(y[v].identifier===f)return a[v]}function xa(y,a){return Math.log(y/a)/Math.LN2}class zl extends xo{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,f){const v=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(xa(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:xa(this._distance,v),pinchAround:f}}}function Oh(y,a){return 180*y.angleWith(a)/Math.PI}class jl extends xo{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,f){const v=this._vector;if(this._vector=a[0].sub(a[1]),v&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Oh(this._vector,v),pinchAround:f}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const f=25/(Math.PI*this._minDiameter)*360,v=this._startVector;if(!v)return!1;const S=Oh(a,v);return Math.abs(S)<f}}function ka(y){return Math.abs(y.y)>Math.abs(y.x)}class wh extends xo{constructor(a){super(),this._map=a}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(a){this._lastPoints=a,ka(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,f,v){const S=this._lastPoints;if(!S)return;const T=a[0].sub(S[0]),N=a[1].sub(S[1]);return this._map._cooperativeGestures&&!o.isFullscreen()&&v.touches.length<3||(this._valid=this.gestureBeginsVertically(T,N,v.timeStamp),!this._valid)?void 0:(this._lastPoints=a,this._active=!0,{pitchDelta:(T.y+N.y)/2*-.5})}gestureBeginsVertically(a,f,v){if(this._valid!==void 0)return this._valid;const S=a.mag()>=2,T=f.mag()>=2;if(!S&&!T)return;if(!S||!T)return this._firstMove==null&&(this._firstMove=v),v-this._firstMove<100&&void 0;const N=a.y>0==f.y>0;return ka(a)&&ka(f)&&N}}const su={panStep:100,bearingStep:15,pitchStep:10};class Cc{constructor(){const a=su;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let f=0,v=0,S=0,T=0,N=0;switch(a.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:a.shiftKey?v=-1:(a.preventDefault(),T=-1);break;case 39:a.shiftKey?v=1:(a.preventDefault(),T=1);break;case 38:a.shiftKey?S=1:(a.preventDefault(),N=-1);break;case 40:a.shiftKey?S=-1:(a.preventDefault(),N=1);break;default:return}return this._rotationDisabled&&(v=0,S=0),{cameraAnimation:z=>{const $=z.getZoom();z.easeTo({duration:300,easeId:"keyboardHandler",easing:Bh,zoom:f?Math.round($)+f*(a.shiftKey?2:1):$,bearing:z.getBearing()+v*this._bearingStep,pitch:z.getPitch()+S*this._pitchStep,offset:[-T*this._panStep,-N*this._panStep],center:z.getCenter()},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Bh(y){return y*(2-y)}const Lc=4.000244140625;class lc{constructor(a,f){this._map=a,this._el=a.getCanvasContainer(),this._handler=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&a.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(a){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(a.ctrlKey||a.metaKey||this.isZooming()||o.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let f=a.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const v=o.exported.now(),S=v-(this._lastWheelEventTime||0);this._lastWheelEventTime=v,f!==0&&f%Lc==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":S>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(S*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),a.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=a,this._delta-=f,this._active||this._start(a)),a.preventDefault()}_onTimeout(a){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=ze(this._el,a);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:f,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._map.transform;this._type==="wheel"&&a.projection.wrap&&(a._center.lng>=180||a._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const f=()=>a._terrainEnabled()&&this._aroundCoord?a.computeZoomRelativeTo(this._aroundCoord):a.zoom;if(this._delta!==0){const $=this._type==="wheel"&&Math.abs(this._delta)>Lc?this._wheelZoomRate:this._defaultZoomRate;let Q=2/(1+Math.exp(-Math.abs(this._delta*$)));this._delta<0&&Q!==0&&(Q=1/Q);const te=f(),ge=Math.pow(2,te),Ae=typeof this._targetZoom=="number"?a.zoomScale(this._targetZoom):ge;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(Ae*Q))),this._type==="wheel"&&(this._startZoom=te,this._easing=this._smoothOutEasing(200)),this._delta=0}const v=typeof this._targetZoom=="number"?this._targetZoom:f(),S=this._startZoom,T=this._easing;let N,z=!1;if(this._type==="wheel"&&S&&T){const $=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),Q=T($);N=o.number(S,v,Q),$<1?this._frameId||(this._frameId=!0):z=!0}else N=v,z=!0;return this._active=!0,z&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!z,zoomDelta:N-f(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let f=o.ease;if(this._prevEase){const v=this._prevEase,S=(o.exported.now()-v.start)/v.duration,T=v.easing(S+.01)-v.easing(S),N=.27/Math.sqrt(T*T+1e-4)*.01,z=Math.sqrt(.0729-N*N);f=o.bezier(N,z,.25,1)}return this._prevEase={start:o.exported.now(),duration:a,easing:f},f}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=k("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(o.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")}),200)}}class Ao{constructor(a,f){this._clickZoom=a,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class $i{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(a,f){return a.preventDefault(),{cameraAnimation:v=>{v.easeTo({duration:300,zoom:v.getZoom()+(a.shiftKey?-1:1),around:v.unproject(f)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ou{constructor(){this._tap=new ac({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(a,f,v){this._swipePoint||(this._tapTime&&a.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?v.length>0&&(this._swipePoint=f[0],this._swipeTouch=v[0].identifier):this._tap.touchstart(a,f,v))}touchmove(a,f,v){if(this._tapTime){if(this._swipePoint){if(v[0].identifier!==this._swipeTouch)return;const S=f[0],T=S.y-this._swipePoint.y;return this._swipePoint=S,a.preventDefault(),this._active=!0,{zoomDelta:T/128}}}else this._tap.touchmove(a,f,v)}touchend(a,f,v){this._tapTime?this._swipePoint&&v.length===0&&this.reset():this._tap.touchend(a,f,v)&&(this._tapTime=a.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ua{constructor(a,f,v){this._el=a,this._mousePan=f,this._touchPan=v}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class yl{constructor(a,f,v){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=f,this._mousePitch=v}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class qc{constructor(a,f,v,S){this._el=a,this._touchZoom=f,this._touchRotate=v,this._tapDragZoom=S,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const rl=y=>y.zoom||y.drag||y.pitch||y.rotate;class _l extends o.Event{}class Sh{constructor(){this.constants=[1,1,.01],this.radius=0}setup(a,f){const v=o.sub([],f,a);this.radius=o.length(v[2]<0?o.div([],v,this.constants):[v[0],v[1],0])}projectRay(a){o.div(a,a,this.constants),o.normalize(a,a),o.mul$1(a,a,this.constants);const f=o.scale$2([],a,this.radius);if(f[2]>0){const v=o.scale$2([],[0,0,1],o.dot(f,[0,0,1])),S=o.scale$2([],o.normalize([],[f[0],f[1],0]),this.radius),T=o.add([],f,o.scale$2([],o.sub([],o.add([],S,v),f),2));f[0]=T[0],f[1]=T[1]}return f}}function Ul(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class Vl{constructor(a,f){this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ns(a),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Sh,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(f),o.bindAll(["handleEvent","handleWindowEvent"],this);const v=this._el;this._listeners=[[v,"touchstart",{passive:!0}],[v,"touchmove",{passive:!1}],[v,"touchend",void 0],[v,"touchcancel",void 0],[v,"mousedown",void 0],[v,"mousemove",void 0],[v,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[v,"mouseover",void 0],[v,"mouseout",void 0],[v,"dblclick",void 0],[v,"click",void 0],[v,"keydown",{capture:!1}],[v,"keyup",void 0],[v,"wheel",{passive:!1}],[v,"contextmenu",void 0],[o.window,"blur",void 0]];for(const[S,T,N]of this._listeners)S.addEventListener(T,S===o.window.document?this.handleWindowEvent:this.handleEvent,N)}destroy(){for(const[a,f,v]of this._listeners)a.removeEventListener(f,a===o.window.document?this.handleWindowEvent:this.handleEvent,v)}_addDefaultHandlers(a){const f=this._map,v=f.getCanvasContainer();this._add("mapEvent",new bu(f,a));const S=f.boxZoom=new Ks(f,a);this._add("boxZoom",S);const T=new Qh,N=new $i;f.doubleClickZoom=new Ao(N,T),this._add("tapZoom",T),this._add("clickZoom",N);const z=new Ou;this._add("tapDragZoom",z);const $=f.touchPitch=new wh(f);this._add("touchPitch",$);const Q=new ca(a),te=new ja(a);f.dragRotate=new yl(a,Q,te),this._add("mouseRotate",Q,["mousePitch"]),this._add("mousePitch",te,["mouseRotate"]);const ge=new vo(a),Ae=new nl(f,a);f.dragPan=new Ua(v,ge,Ae),this._add("mousePan",ge),this._add("touchPan",Ae,["touchZoom","touchRotate"]);const Le=new jl,Ze=new zl;f.touchZoomRotate=new qc(v,Ze,Le,z),this._add("touchRotate",Le,["touchPan","touchZoom"]),this._add("touchZoom",Ze,["touchPan","touchRotate"]),this._add("blockableMapEvent",new th(f));const Ue=f.scrollZoom=new lc(f,this);this._add("scrollZoom",Ue,["mousePan"]);const Xe=f.keyboard=new Cc;this._add("keyboard",Xe);for(const _e of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])a.interactive&&a[_e]&&f[_e].enable(a[_e])}_add(a,f,v){this._handlers.push({handlerName:a,handler:f,allowed:v}),this._handlersById[a]=f}stop(a){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[]}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!rl(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(a,f,v){for(const S in a)if(S!==v&&(!f||f.indexOf(S)<0))return!0;return!1}handleWindowEvent(a){this.handleEvent(a,`${a.type}Window`)}_getMapTouches(a){const f=[];for(const v of a)this._el.contains(v.target)&&f.push(v);return f}handleEvent(a,f){this._updatingCamera=!0;const v=a.type==="renderFrame",S=v?void 0:a,T={needsRenderFrame:!1},N={},z={},$=a.touches?this._getMapTouches(a.touches):void 0,Q=$?pe(this._el,$):v?void 0:ze(this._el,a);for(const{handlerName:Ae,handler:Le,allowed:Ze}of this._handlers){if(!Le.isEnabled())continue;let Ue;this._blockedByActive(z,Ze,Ae)?Le.reset():Le[f||a.type]&&(Ue=Le[f||a.type](a,Q,$),this.mergeHandlerResult(T,N,Ue,Ae,S),Ue&&Ue.needsRenderFrame&&this._triggerRenderFrame()),(Ue||Le.isActive())&&(z[Ae]=Le)}const te={};for(const Ae in this._previousActiveHandlers)z[Ae]||(te[Ae]=S);this._previousActiveHandlers=z,(Object.keys(te).length||Ul(T))&&(this._changes.push([T,N,te]),this._triggerRenderFrame()),(Object.keys(z).length||Ul(T))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ge}=T;ge&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ge(this._map))}mergeHandlerResult(a,f,v,S,T){if(!v)return;o.extend(a,v);const N={handlerName:S,originalEvent:v.originalEvent||T};v.zoomDelta!==void 0&&(f.zoom=N),v.panDelta!==void 0&&(f.drag=N),v.pitchDelta!==void 0&&(f.pitch=N),v.bearingDelta!==void 0&&(f.rotate=N)}_applyChanges(){const a={},f={},v={};for(const[S,T,N]of this._changes)S.panDelta&&(a.panDelta=(a.panDelta||new o.Point(0,0))._add(S.panDelta)),S.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+S.zoomDelta),S.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+S.bearingDelta),S.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+S.pitchDelta),S.around!==void 0&&(a.around=S.around),S.aroundCoord!==void 0&&(a.aroundCoord=S.aroundCoord),S.pinchAround!==void 0&&(a.pinchAround=S.pinchAround),S.noInertia&&(a.noInertia=S.noInertia),o.extend(f,T),o.extend(v,N);this._updateMapTransform(a,f,v),this._changes=[]}_updateMapTransform(a,f,v){const S=this._map,T=S.transform,N=Ge=>[Ge.x,Ge.y,Ge.z];if((Ge=>{const it=this._eventsInProgress.drag;return it&&!this._handlersById[it.handlerName].isActive()})()&&!Ul(a)){const Ge=T.zoom;T.cameraElevationReference="sea",T.recenterOnTerrain(),T.cameraElevationReference="ground",Ge!==T.zoom&&this._map._update(!0)}if(T._isCameraConstrained&&S._stop(!0),!Ul(a))return void this._fireEvents(f,v,!0);let{panDelta:z,zoomDelta:$,bearingDelta:Q,pitchDelta:te,around:ge,aroundCoord:Ae,pinchAround:Le}=a;T._isCameraConstrained&&($>0&&($=0),T._isCameraConstrained=!1),Le!==void 0&&(ge=Le),($||(Ge=>f[Ge]&&!this._eventsInProgress[Ge])("drag"))&&ge&&(this._dragOrigin=N(T.pointCoordinate3D(ge)),this._trackingEllipsoid.setup(T._camera.position,this._dragOrigin)),T.cameraElevationReference="sea",S._stop(!0),ge=ge||S.transform.centerPoint,Q&&(T.bearing+=Q),te&&(T.pitch+=te),T._updateCameraState();const Ze=[0,0,0];if(z)if(T.projection.name==="mercator"){const Ge=this._trackingEllipsoid.projectRay(T.screenPointToMercatorRay(ge).dir),it=this._trackingEllipsoid.projectRay(T.screenPointToMercatorRay(ge.sub(z)).dir);Ze[0]=it[0]-Ge[0],Ze[1]=it[1]-Ge[1]}else{const Ge=T.pointCoordinate(ge);if(T.projection.name==="globe"){z=z.rotate(-T.angle);const it=T._pixelsPerMercatorPixel/T.worldSize;Ze[0]=-z.x*o.mercatorScale(o.latFromMercatorY(Ge.y))*it,Ze[1]=-z.y*o.mercatorScale(T.center.lat)*it}else{const it=T.pointCoordinate(ge.sub(z));Ge&&it&&(Ze[0]=it.x-Ge.x,Ze[1]=it.y-Ge.y)}}const Ue=T.zoom,Xe=[0,0,0];if($){const Ge=N(Ae||T.pointCoordinate3D(ge)),it={dir:o.normalize([],o.sub([],Ge,T._camera.position))};if(it.dir[2]<0){const ot=T.zoomDeltaToMovement(Ge,$);o.scale$2(Xe,it.dir,ot)}}const _e=o.add(Ze,Ze,Xe);T._translateCameraConstrained(_e),$&&Math.abs(T.zoom-Ue)>1e-4&&T.recenterOnTerrain(),T.cameraElevationReference="ground",this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(f,v,!0)}_fireEvents(a,f,v){const S=rl(this._eventsInProgress),T=rl(a),N={};for(const te in a){const{originalEvent:ge}=a[te];this._eventsInProgress[te]||(N[`${te}start`]=ge),this._eventsInProgress[te]=a[te]}!S&&T&&this._fireEvent("movestart",T.originalEvent);for(const te in N)this._fireEvent(te,N[te]);T&&this._fireEvent("move",T.originalEvent);for(const te in a){const{originalEvent:ge}=a[te];this._fireEvent(te,ge)}const z={};let $;for(const te in this._eventsInProgress){const{handlerName:ge,originalEvent:Ae}=this._eventsInProgress[te];this._handlersById[ge].isActive()||(delete this._eventsInProgress[te],$=f[ge]||Ae,z[`${te}end`]=$)}for(const te in z)this._fireEvent(te,z[te]);const Q=rl(this._eventsInProgress);if(v&&(S||T)&&!Q){this._updatingCamera=!0;const te=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ge=Ae=>Ae!==0&&-this._bearingSnap<Ae&&Ae<this._bearingSnap;te?(ge(te.bearing||this._map.getBearing())&&(te.bearing=0),this._map.easeTo(te,{originalEvent:$})):(this._map.fire(new o.Event("moveend",{originalEvent:$})),ge(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(a,f){this._map.fire(new o.Event(a,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((a=>{this._frameId=void 0,this.handleEvent(new _l("renderFrame",{timeStamp:a})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const cc="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class zh extends o.Evented{constructor(a,f){super(),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=f.bearingSnap,this._respectPrefersReducedMotion=f.respectPrefersReducedMotion!==!1,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(a,f){return this.jumpTo({center:a},f)}panBy(a,f,v){return a=o.Point.convert(a).mult(-1),this.panTo(this.transform.center,o.extend({offset:a},f),v)}panTo(a,f,v){return this.easeTo(o.extend({center:a},f),v)}getZoom(){return this.transform.zoom}setZoom(a,f){return this.jumpTo({zoom:a},f),this}zoomTo(a,f,v){return this.easeTo(o.extend({zoom:a},f),v)}zoomIn(a,f){return this.zoomTo(this.getZoom()+1,a,f),this}zoomOut(a,f){return this.zoomTo(this.getZoom()-1,a,f),this}getBearing(){return this.transform.bearing}setBearing(a,f){return this.jumpTo({bearing:a},f),this}getPadding(){return this.transform.padding}setPadding(a,f){return this.jumpTo({padding:a},f),this}rotateTo(a,f,v){return this.easeTo(o.extend({bearing:a},f),v)}resetNorth(a,f){return this.rotateTo(0,o.extend({duration:1e3},a),f),this}resetNorthPitch(a,f){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},a),f),this}snapToNorth(a,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,f):this}getPitch(){return this.transform.pitch}setPitch(a,f){return this.jumpTo({pitch:a},f),this}cameraForBounds(a,f){a=o.LngLatBounds.convert(a);const v=f&&f.bearing||0,S=f&&f.pitch||0,T=a.getNorthWest(),N=a.getSouthEast();return this._cameraForBounds(this.transform,T,N,v,S,f)}_extendCameraOptions(a){const f={top:0,bottom:0,right:0,left:0};if(typeof(a=o.extend({padding:f,offset:[0,0],maxZoom:this.transform.maxZoom},a)).padding=="number"){const v=a.padding;a.padding={top:v,bottom:v,right:v,left:v}}return a.padding=o.extend(f,a.padding),a}_minimumAABBFrustumDistance(a,f){const v=f.max[0]-f.min[0],S=f.max[1]-f.min[1];return v/S>a.aspect?v/(2*Math.tan(.5*a.fovX)*a.aspect):S/(2*Math.tan(.5*a.fovY)*a.aspect)}_cameraForBoundsOnGlobe(a,f,v,S,T,N){const z=a.clone(),$=this._extendCameraOptions(N);z.bearing=S,z.pitch=T;const Q=o.LngLat.convert(f),te=o.LngLat.convert(v),ge=.5*(Q.lat+te.lat),Ae=.5*(Q.lng+te.lng),Le=o.latLngToECEF(ge,Ae),Ze=o.normalize([],Le),Ue=o.normalize([],o.cross([],Ze,[0,1,0])),Xe=o.cross([],Ue,Ze),_e=[Ue[0],Ue[1],Ue[2],0,Xe[0],Xe[1],Xe[2],0,Ze[0],Ze[1],Ze[2],0,0,0,0,1],Ge=[Le,o.latLngToECEF(Q.lat,Q.lng),o.latLngToECEF(te.lat,Q.lng),o.latLngToECEF(te.lat,te.lng),o.latLngToECEF(Q.lat,te.lng),o.latLngToECEF(ge,Q.lng),o.latLngToECEF(ge,te.lng),o.latLngToECEF(Q.lat,Ae),o.latLngToECEF(te.lat,Ae)];let it=o.Aabb.fromPoints(Ge.map((bn=>[o.dot(Ue,bn),o.dot(Xe,bn),o.dot(Ze,bn)])));const ot=o.transformMat4([],it.center,_e);o.squaredLength(ot)===0&&o.set(ot,0,0,1),o.normalize(ot,ot),o.scale$2(ot,ot,o.GLOBE_RADIUS),z.center=o.ecefToLatLng(ot);const bt=z.getWorldToCameraMatrix(),wt=o.invert(new Float64Array(16),bt);it=o.Aabb.applyTransform(it,o.multiply([],bt,_e)),o.transformMat4(ot,ot,bt);const _t=.5*(it.max[2]-it.min[2]),Pt=this._minimumAABBFrustumDistance(z,it),kt=o.scale$2([],[0,0,1],_t),jt=o.add(kt,ot,kt),_n=Pt+(z.pitch===0?0:o.distance(ot,jt)),Ut=z.globeCenterInViewSpace,cn=o.sub([],ot,[Ut[0],Ut[1],Ut[2]]);o.normalize(cn,cn),o.scale$2(cn,cn,_n);const Wt=o.add([],ot,cn);o.transformMat4(Wt,Wt,wt);const In=o.earthRadius/o.GLOBE_RADIUS,Bt=o.length(Wt),Yt=o.mercatorZfromAltitude(Math.max(Bt*In-o.earthRadius,Number.EPSILON),0),Tn=Math.min(z.zoomFromMercatorZAdjusted(Yt),$.maxZoom);return Tn>.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(z.setProjection({name:"mercator"}),z.zoom=Tn,this._cameraForBounds(z,f,v,S,T,N)):{center:z.center,zoom:Tn,bearing:S,pitch:T}}queryTerrainElevation(a,f){const v=this.transform.elevation;return v?(f=o.extend({},{exaggerated:!0},f),v.getAtPoint(o.MercatorCoordinate.fromLngLat(a),null,f.exaggerated)):null}_cameraForBounds(a,f,v,S,T,N){if(a.projection.name==="globe")return this._cameraForBoundsOnGlobe(a,f,v,S,T,N);const z=a.clone(),$=this._extendCameraOptions(N),Q=z.padding;z.bearing=S,z.pitch=T;const te=o.LngLat.convert(f),ge=o.LngLat.convert(v),Ae=new o.LngLat(te.lng,ge.lat),Le=new o.LngLat(ge.lng,te.lat),Ze=z.project(te),Ue=z.project(ge),Xe=this.queryTerrainElevation(te),_e=this.queryTerrainElevation(ge),Ge=this.queryTerrainElevation(Ae),it=this.queryTerrainElevation(Le),ot=[[Ze.x,Ze.y,Math.min(Xe||0,_e||0,Ge||0,it||0)],[Ue.x,Ue.y,Math.max(Xe||0,_e||0,Ge||0,it||0)]];let bt=o.Aabb.fromPoints(ot);const wt=z.getWorldToCameraMatrix(),_t=o.invert(new Float64Array(16),wt);bt=o.Aabb.applyTransform(bt,wt);const Pt=o.sub([],bt.max,bt.min),kt=Q.left||0,jt=Q.right||0,_n=Q.bottom||0,Ut=Q.top||0,{left:cn,right:Wt,top:In,bottom:Bt}=$.padding,Yt=.5*(kt+jt),Tn=.5*(Ut+_n),bn=Math.min(z.scaleZoom(z.scale*Math.min((z.width-(kt+jt+cn+Wt))/Pt[0],(z.height-(_n+Ut+Bt+In))/Pt[1])),$.maxZoom),Rn=z.scale/z.zoomScale(bn);bt=new o.Aabb([bt.min[0]-(cn+Yt)*Rn,bt.min[1]-(Bt+Tn)*Rn,bt.min[2]],[bt.max[0]+(Wt+Yt)*Rn,bt.max[1]+(In+Tn)*Rn,bt.max[2]]);const hr=.5*Pt[2],mr=this._minimumAABBFrustumDistance(z,bt),sr=[0,0,1,0];o.transformMat4$1(sr,sr,wt),o.normalize$2(sr,sr);const dr=o.scale$2([],sr,mr+hr),oi=o.add([],bt.center,dr),di=(typeof $.offset.x=="number"&&typeof $.offset.y=="number"?new o.Point($.offset.x,$.offset.y):o.Point.convert($.offset)).rotate(-o.degToRad(S));bt.center[0]-=di.x*Rn,bt.center[1]+=di.y*Rn,o.transformMat4(bt.center,bt.center,_t),o.transformMat4(oi,oi,_t);const _r=[bt.center[0],bt.center[1],oi[2]*z.pixelsPerMeter];o.scale$2(_r,_r,1/z.worldSize);const Zr=o.lngFromMercatorX(_r[0]),Pi=o.latFromMercatorY(_r[1]),io=Math.min(z._zoomFromMercatorZ(_r[2]),$.maxZoom),oo=new o.LngLat(Zr,Pi);return z.mercatorFromTransition&&io<.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(z.setProjection({name:"globe"}),z.zoom=io,this._cameraForBounds(z,f,v,S,T,N)):{center:oo,zoom:io,bearing:S,pitch:T}}fitBounds(a,f,v){const S=this.cameraForBounds(a,f);return this._fitInternal(S,f,v)}fitScreenCoordinates(a,f,v,S,T){const N=o.Point.convert(a),z=o.Point.convert(f),$=new o.Point(Math.min(N.x,z.x),Math.min(N.y,z.y)),Q=new o.Point(Math.max(N.x,z.x),Math.max(N.y,z.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(N,z))return this;const te=this.transform.pointLocation3D($),ge=this.transform.pointLocation3D(Q),Ae=this.transform.pointLocation3D(new o.Point($.x,Q.y)),Le=this.transform.pointLocation3D(new o.Point(Q.x,$.y)),Ze=[Math.min(te.lng,ge.lng,Ae.lng,Le.lng),Math.min(te.lat,ge.lat,Ae.lat,Le.lat)],Ue=[Math.max(te.lng,ge.lng,Ae.lng,Le.lng),Math.max(te.lat,ge.lat,Ae.lat,Le.lat)],Xe=S&&S.pitch?S.pitch:this.getPitch(),_e=this._cameraForBounds(this.transform,Ze,Ue,v,Xe,S);return this._fitInternal(_e,S,T)}_fitInternal(a,f,v){return a?(delete(f=o.extend(a,f)).padding,f.linear?this.easeTo(f,v):this.flyTo(f,v)):this}jumpTo(a,f){this.stop();const v=a.preloadOnly?this.transform.clone():this.transform;let S=!1,T=!1,N=!1;return"zoom"in a&&v.zoom!==+a.zoom&&(S=!0,v.zoom=+a.zoom),a.center!==void 0&&(v.center=o.LngLat.convert(a.center)),"bearing"in a&&v.bearing!==+a.bearing&&(T=!0,v.bearing=+a.bearing),"pitch"in a&&v.pitch!==+a.pitch&&(N=!0,v.pitch=+a.pitch),a.padding==null||v.isPaddingEqual(a.padding)||(v.padding=a.padding),a.preloadOnly?(this._preloadTiles(v),this):(this.fire(new o.Event("movestart",f)).fire(new o.Event("move",f)),S&&this.fire(new o.Event("zoomstart",f)).fire(new o.Event("zoom",f)).fire(new o.Event("zoomend",f)),T&&this.fire(new o.Event("rotatestart",f)).fire(new o.Event("rotate",f)).fire(new o.Event("rotateend",f)),N&&this.fire(new o.Event("pitchstart",f)).fire(new o.Event("pitch",f)).fire(new o.Event("pitchend",f)),this.fire(new o.Event("moveend",f)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.warnOnce(cc),this.transform.getFreeCameraOptions()}setFreeCameraOptions(a,f){const v=this.transform;if(!v.projection.supportsFreeCamera)return o.warnOnce(cc),this;this.stop();const S=v.zoom,T=v.pitch,N=v.bearing;v.setFreeCameraOptions(a);const z=S!==v.zoom,$=T!==v.pitch,Q=N!==v.bearing;return this.fire(new o.Event("movestart",f)).fire(new o.Event("move",f)),z&&this.fire(new o.Event("zoomstart",f)).fire(new o.Event("zoom",f)).fire(new o.Event("zoomend",f)),Q&&this.fire(new o.Event("rotatestart",f)).fire(new o.Event("rotate",f)).fire(new o.Event("rotateend",f)),$&&this.fire(new o.Event("pitchstart",f)).fire(new o.Event("pitch",f)).fire(new o.Event("pitchend",f)),this.fire(new o.Event("moveend",f)),this}easeTo(a,f){this._stop(!1,a.easeId),((a=o.extend({offset:[0,0],duration:500,easing:o.ease},a)).animate===!1||this._prefersReducedMotion(a))&&(a.duration=0);const v=this.transform,S=this.getZoom(),T=this.getBearing(),N=this.getPitch(),z=this.getPadding(),$="zoom"in a?+a.zoom:S,Q="bearing"in a?this._normalizeBearing(a.bearing,T):T,te="pitch"in a?+a.pitch:N,ge="padding"in a?a.padding:v.padding,Ae=o.Point.convert(a.offset);let Le,Ze,Ue;if(v.projection.name==="globe"){const kt=o.MercatorCoordinate.fromLngLat(v.center),jt=Ae.rotate(-v.angle);kt.x+=jt.x/v.worldSize,kt.y+=jt.y/v.worldSize;const _n=kt.toLngLat(),Ut=o.LngLat.convert(a.center||_n);this._normalizeCenter(Ut),Le=v.centerPoint.add(jt),Ze=new o.Point(kt.x,kt.y).mult(v.worldSize),Ue=new o.Point(o.mercatorXfromLng(Ut.lng),o.mercatorYfromLat(Ut.lat)).mult(v.worldSize).sub(Ze)}else{Le=v.centerPoint.add(Ae);const kt=v.pointLocation(Le),jt=o.LngLat.convert(a.center||kt);this._normalizeCenter(jt),Ze=v.project(kt),Ue=v.project(jt).sub(Ze)}const Xe=v.zoomScale($-S);let _e,Ge;a.around&&(_e=o.LngLat.convert(a.around),Ge=v.locationPoint(_e));const it=this._zooming||$!==S,ot=this._rotating||T!==Q,bt=this._pitching||te!==N,wt=!v.isPaddingEqual(ge),_t=kt=>jt=>{if(it&&(kt.zoom=o.number(S,$,jt)),ot&&(kt.bearing=o.number(T,Q,jt)),bt&&(kt.pitch=o.number(N,te,jt)),wt&&(kt.interpolatePadding(z,ge,jt),Le=kt.centerPoint.add(Ae)),_e)kt.setLocationAtPoint(_e,Ge);else{const _n=kt.zoomScale(kt.zoom-S),Ut=$>S?Math.min(2,Xe):Math.max(.5,Xe),cn=Math.pow(Ut,1-jt),Wt=kt.unproject(Ze.add(Ue.mult(jt*cn)).mult(_n));kt.setLocationAtPoint(kt.renderWorldCopies?Wt.wrap():Wt,Le)}return a.preloadOnly||this._fireMoveEvents(f),kt};if(a.preloadOnly){const kt=this._emulate(_t,a.duration,v);return this._preloadTiles(kt),this}const Pt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=it,this._rotating=ot,this._pitching=bt,this._padding=wt,this._easeId=a.easeId,this._prepareEase(f,a.noMoveStart,Pt),this._ease(_t(v),(kt=>{v.recenterOnTerrain(),this._afterEase(f,kt)}),a),this}_prepareEase(a,f,v={}){this._moving=!0,this.transform.cameraElevationReference="sea",f||v.moving||this.fire(new o.Event("movestart",a)),this._zooming&&!v.zooming&&this.fire(new o.Event("zoomstart",a)),this._rotating&&!v.rotating&&this.fire(new o.Event("rotatestart",a)),this._pitching&&!v.pitching&&this.fire(new o.Event("pitchstart",a))}_fireMoveEvents(a){this.fire(new o.Event("move",a)),this._zooming&&this.fire(new o.Event("zoom",a)),this._rotating&&this.fire(new o.Event("rotate",a)),this._pitching&&this.fire(new o.Event("pitch",a))}_afterEase(a,f){if(this._easeId&&f&&this._easeId===f)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const v=this._zooming,S=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,v&&this.fire(new o.Event("zoomend",a)),S&&this.fire(new o.Event("rotateend",a)),T&&this.fire(new o.Event("pitchend",a)),this.fire(new o.Event("moveend",a))}flyTo(a,f){if(this._prefersReducedMotion(a)){const bn=o.pick(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(bn,f)}this.stop(),a=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},a);const v=this.transform,S=this.getZoom(),T=this.getBearing(),N=this.getPitch(),z=this.getPadding(),$="zoom"in a?o.clamp(+a.zoom,v.minZoom,v.maxZoom):S,Q="bearing"in a?this._normalizeBearing(a.bearing,T):T,te="pitch"in a?+a.pitch:N,ge="padding"in a?a.padding:v.padding,Ae=v.zoomScale($-S),Le=o.Point.convert(a.offset);let Ze=v.centerPoint.add(Le);const Ue=v.pointLocation(Ze),Xe=o.LngLat.convert(a.center||Ue);this._normalizeCenter(Xe);const _e=v.project(Ue),Ge=v.project(Xe).sub(_e);let it=a.curve;const ot=Math.max(v.width,v.height),bt=ot/Ae,wt=Ge.mag();if("minZoom"in a){const bn=o.clamp(Math.min(a.minZoom,S,$),v.minZoom,v.maxZoom),Rn=ot/v.zoomScale(bn-S);it=Math.sqrt(Rn/wt*2)}const _t=it*it;function Pt(bn){const Rn=(bt*bt-ot*ot+(bn?-1:1)*_t*_t*wt*wt)/(2*(bn?bt:ot)*_t*wt);return Math.log(Math.sqrt(Rn*Rn+1)-Rn)}function kt(bn){return(Math.exp(bn)-Math.exp(-bn))/2}function jt(bn){return(Math.exp(bn)+Math.exp(-bn))/2}const _n=Pt(0);let Ut=function(bn){return jt(_n)/jt(_n+it*bn)},cn=function(bn){return ot*((jt(_n)*(kt(Rn=_n+it*bn)/jt(Rn))-kt(_n))/_t)/wt;var Rn},Wt=(Pt(1)-_n)/it;if(Math.abs(wt)<1e-6||!isFinite(Wt)){if(Math.abs(ot-bt)<1e-6)return this.easeTo(a,f);const bn=bt<ot?-1:1;Wt=Math.abs(Math.log(bt/ot))/it,cn=function(){return 0},Ut=function(Rn){return Math.exp(bn*it*Rn)}}a.duration="duration"in a?+a.duration:1e3*Wt/("screenSpeed"in a?+a.screenSpeed/it:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0);const In=T!==Q,Bt=te!==N,Yt=!v.isPaddingEqual(ge),Tn=bn=>Rn=>{const hr=Rn*Wt,mr=1/Ut(hr);bn.zoom=Rn===1?$:S+bn.scaleZoom(mr),In&&(bn.bearing=o.number(T,Q,Rn)),Bt&&(bn.pitch=o.number(N,te,Rn)),Yt&&(bn.interpolatePadding(z,ge,Rn),Ze=bn.centerPoint.add(Le));const sr=Rn===1?Xe:bn.unproject(_e.add(Ge.mult(cn(hr))).mult(mr));return bn.setLocationAtPoint(bn.renderWorldCopies?sr.wrap():sr,Ze),bn._updateCameraOnTerrain(),a.preloadOnly||this._fireMoveEvents(f),bn};if(a.preloadOnly){const bn=this._emulate(Tn,a.duration,v);return this._preloadTiles(bn),this}return this._zooming=!0,this._rotating=In,this._pitching=Bt,this._padding=Yt,this._prepareEase(f,!1),this._ease(Tn(v),(()=>this._afterEase(f)),a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(a,f){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const v=this._onEaseEnd;this._onEaseEnd=void 0,v.call(this,f)}if(!a){const v=this.handlers;v&&v.stop(!1)}return this}_ease(a,f,v){v.animate===!1||v.duration===0?(a(1),f()):(this._easeStart=o.exported.now(),this._easeOptions=v,this._onEaseFrame=a,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const a=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1),f=this._onEaseFrame;f&&f(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(a,f){a=o.wrap(a,-180,180);const v=Math.abs(a-f);return Math.abs(a-360-f)<v&&(a-=360),Math.abs(a+360-f)<v&&(a+=360),a}_normalizeCenter(a){const f=this.transform;if(!f.renderWorldCopies||f.maxBounds)return;const v=a.lng-f.center.lng;a.lng+=v>180?-360:v<-180?360:0}_prefersReducedMotion(a){return this._respectPrefersReducedMotion&&o.exported.prefersReducedMotion&&!(a&&a.essential)}_emulate(a,f,v){const S=Math.ceil(15*f/1e3),T=[],N=a(v.clone());for(let z=0;z<=S;z++){const $=N(z/S);T.push($.clone())}return T}}class lr{constructor(a={}){this.options=a,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(a){const f=this.options&&this.options.compact;return this._map=a,this._container=k("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=k("button","mapboxgl-ctrl-attrib-button",this._container),k("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=k("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(a,f){const v=this._map._getUIString(`AttributionControl.${f}`);a.setAttribute("aria-label",v),a.removeAttribute("title"),a.firstElementChild&&a.firstElementChild.setAttribute("title",v)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let a=this._editLink;a||(a=this._editLink=this._container.querySelector(".mapbox-improve-map"));const f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(a){const v=f.reduce(((S,T,N)=>(T.value&&(S+=`${T.key}=${T.value}${N<f.length-1?"&":""}`),S)),"?");a.href=`${o.config.FEEDBACK_URL}/${v}#${Ic(this._map,!0)}`,a.rel="noopener nofollow",this._setElementTitle(a,"MapFeedback")}}_updateData(a){!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let a=[];if(this._map.style.stylesheet){const S=this._map.style.stylesheet;this.styleOwner=S.owner,this.styleId=S.id}const f=this._map.style._sourceCaches;for(const S in f){const T=f[S];if(T.used){const N=T.getSource();N.attribution&&a.indexOf(N.attribution)<0&&a.push(N.attribution)}}a.sort(((S,T)=>S.length-T.length)),a=a.filter(((S,T)=>{for(let N=T+1;N<a.length;N++)if(a[N].indexOf(S)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=[...this.options.customAttribution,...a]:a.unshift(this.options.customAttribution));const v=a.join(" | ");v!==this._attribHTML&&(this._attribHTML=v,a.length?(this._innerContainer.innerHTML=v,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class $c{constructor(){o.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(a){this._map=a,this._container=k("div","mapboxgl-ctrl");const f=k("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(a){a&&a.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const a=this._map.style._sourceCaches;if(Object.entries(a).length===0)return!0;for(const f in a){const v=a[f].getSource();if(v.hasOwnProperty("mapbox_logo")&&!v.mapbox_logo)return!1}return!0}_updateCompact(){const a=this._container.children;if(a.length){const f=a[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}}}class C{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const f=++this._id;return this._queue.push({callback:a,id:f,cancelled:!1}),f}remove(a){const f=this._currentlyRunning,v=f?this._queue.concat(f):this._queue;for(const S of v)if(S.id===a)return void(S.cancelled=!0)}run(a=0){const f=this._currentlyRunning=this._queue;this._queue=[];for(const v of f)if(!v.cancelled&&(v.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function B(y,a,f){if(y=new o.LngLat(y.lng,y.lat),a){const v=new o.LngLat(y.lng-360,y.lat),S=new o.LngLat(y.lng+360,y.lat),T=360*Math.ceil(Math.abs(y.lng-f.center.lng)/360),N=f.locationPoint(y).distSqr(a),z=a.x<0||a.y<0||a.x>f.width||a.y>f.height;f.locationPoint(v).distSqr(a)<N&&(z||Math.abs(v.lng-f.center.lng)<T)?y=v:f.locationPoint(S).distSqr(a)<N&&(z||Math.abs(S.lng-f.center.lng)<T)&&(y=S)}for(;Math.abs(y.lng-f.center.lng)>180;){const v=f.locationPoint(y);if(v.x>=0&&v.y>=0&&v.x<=f.width&&v.y<=f.height)break;y.lng>f.center.lng?y.lng-=360:y.lng+=360}return y}const ee={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class oe extends o.Evented{constructor(a,f){if(super(),(a instanceof o.window.HTMLElement||f)&&(a=o.extend({element:a},f)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=a&&a.occludedOpacity||.2,a&&a.element)this._element=a.element,this._offset=o.Point.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=k("div");const S=41,T=27,N=ie("svg",{display:"block",height:S*this._scale+"px",width:T*this._scale+"px",viewBox:`0 0 ${T} ${S}`},this._element),z=ie("radialGradient",{id:"shadowGradient"},ie("defs",{},N));ie("stop",{offset:"10%","stop-opacity":.4},z),ie("stop",{offset:"100%","stop-opacity":.05},z),ie("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},N),ie("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},N),ie("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},N),ie("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},N),this._offset=o.Point.convert(a&&a.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(S=>{S.preventDefault()})),this._element.addEventListener("mousedown",(S=>{S.preventDefault()}));const v=this._element.classList;for(const S in ee)v.remove(`mapboxgl-marker-anchor-${S}`);v.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(a){return a===this._map||(this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._updateMoving),a.on("moveend",this._update),a.on("remove",this._clearFadeTimer),a._addMarker(this),this.setDraggable(this._draggable),this._update(),a.on("click",this._onMapClick)),this}remove(){const a=this._map;return a&&(a.off("click",this._onMapClick),a.off("move",this._updateMoving),a.off("moveend",this._update),a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler),a.off("mouseup",this._onUp),a.off("touchend",this._onUp),a.off("mousemove",this._onMove),a.off("touchmove",this._onMove),a.off("remove",this._clearFadeTimer),a._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=o.LngLat.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const S=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[S,-1*(38.1-13.5+S)],"bottom-right":[-S,-1*(38.1-13.5+S)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=a,a._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(a){const f=a.code,v=a.charCode||a.keyCode;f!=="Space"&&f!=="Enter"&&v!==32&&v!==13||this.togglePopup()}_onMapClick(a){const f=a.originalEvent.target,v=this._element;this._popup&&(f===v||v.contains(f))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const a=this._popup;return a?(a.isOpen()?(a.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(a.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const a=this._map,f=this._pos;if(!a||!f)return!1;const v=a.unproject(f),S=a.getFreeCameraOptions();if(!S.position)return!1;const T=S.position.toLngLat();return T.distanceTo(v)<.9*T.distanceTo(this._lngLat)}_evaluateOpacity(){const a=this._map;if(!a)return;const f=this._pos;if(!f||f.x<0||f.x>a.transform.width||f.y<0||f.y>a.transform.height)return void this._clearFadeTimer();const v=a.unproject(f);let S;a._showingGlobe()&&o.isLngLatBehindGlobe(a.transform,this._lngLat)?S=0:(S=1-a._queryFogOpacity(v),a.transform._terrainEnabled()&&a.getTerrain()&&this._behindTerrain()&&(S*=this._occludedOpacity)),this._element.style.opacity=`${S}`,this._element.style.pointerEvents=S>0?"auto":"none",this._popup&&this._popup._setOpacity(S),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const a=this._pos;if(!a||!this._map)return;const f=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${a.x}px,${a.y}px)
            ${ee[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${f.x}px,${f.y}px)
        `}_calculateXYTransform(){const a=this._pos,f=this._map,v=this.getPitchAlignment();if(!f||!a||v!=="map")return"";if(!f._showingGlobe()){const $=f.getPitch();return $?`rotateX(${$}deg)`:""}const S=o.radToDeg(o.globeTiltAtLngLat(f.transform,this._lngLat)),T=a.sub(o.globeCenterToScreenPoint(f.transform)),N=Math.abs(T.x)+Math.abs(T.y);if(N===0)return"";const z=S/N;return`rotateX(${-T.y*z}deg) rotateY(${T.x*z}deg)`}_calculateZTransform(){const a=this._pos,f=this._map;if(!f||!a)return"";let v=0;const S=this.getRotationAlignment();if(S==="map")if(f._showingGlobe()){const T=f.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),N=f.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(T);v=o.radToDeg(Math.atan2(N.y,N.x))-90}else v=-f.getBearing();else if(S==="horizon"){const T=o.smoothstep(4,6,f.getZoom()),N=o.globeCenterToScreenPoint(f.transform);N.y+=T*f.transform.height;const z=a.sub(N),$=o.radToDeg(Math.atan2(z.y,z.x));v=($>90?$-270:$+90)*(1-T)}return v+=this._rotation,v?`rotateZ(${v}deg)`:""}_update(a){o.window.cancelAnimationFrame(this._updateFrameId);const f=this._map;f&&(f.transform.renderWorldCopies&&(this._lngLat=B(this._lngLat,this._pos,f.transform)),this._pos=f.project(this._lngLat),a===!0?this._updateFrameId=o.window.requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),f._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(f._showingGlobe()||f.getTerrain()||f.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(a){return this._offset=o.Point.convert(a),this._update(),this}_onMove(a){const f=this._map;if(!f)return;const v=this._pointerdownPos,S=this._positionDelta;if(v&&S){if(!this._isDragging){const T=this._clickTolerance||f._clickTolerance;if(a.point.dist(v)<T)return;this._isDragging=!0}this._pos=a.point.sub(S),this._lngLat=f.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const a=this._map;a&&(a.off("mousemove",this._onMove),a.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(a){const f=this._map,v=this._pos;f&&v&&this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(v),this._pointerdownPos=a.point,this._state="pending",f.on("mousemove",this._onMove),f.on("touchmove",this._onMove),f.once("mouseup",this._onUp),f.once("touchend",this._onUp))}setDraggable(a){this._draggable=!!a;const f=this._map;return f&&(a?(f.on("mousedown",this._addDragHandler),f.on("touchstart",this._addDragHandler)):(f.off("mousedown",this._addDragHandler),f.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(a){return this._occludedOpacity=a||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Pe={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},je=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ke(y=new o.Point(0,0),a="bottom"){if(typeof y=="number"){const f=Math.round(Math.sqrt(.5*Math.pow(y,2)));switch(a){case"top":return new o.Point(0,y);case"top-left":return new o.Point(f,f);case"top-right":return new o.Point(-f,f);case"bottom":return new o.Point(0,-y);case"bottom-left":return new o.Point(f,-f);case"bottom-right":return new o.Point(-f,-f);case"left":return new o.Point(y,0);case"right":return new o.Point(-y,0)}return new o.Point(0,0)}return y instanceof o.Point||Array.isArray(y)?o.Point.convert(y):o.Point.convert(y[a]||[0,0])}class Ye{constructor(a){this.jumpTo(a)}getValue(a){if(a<=this._startTime)return this._start;if(a>=this._endTime)return this._end;const f=o.easeCubicInOut((a-this._startTime)/(this._endTime-this._startTime));return this._start*(1-f)+this._end*f}isEasing(a){return a>=this._startTime&&a<=this._endTime}jumpTo(a){this._startTime=-1/0,this._endTime=-1/0,this._start=a,this._end=a}easeTo(a,f,v){this._start=this.getValue(f),this._end=a,this._startTime=f,this._endTime=f+v}}const tt={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},ut={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},Nt={showCompass:!0,showZoom:!0,visualizePitch:!1};class rn{constructor(a,f,v=!1){this._clickTolerance=10,this.element=f,this.mouseRotate=new ca({clickTolerance:a.dragRotate._mouseRotate._clickTolerance}),this.map=a,v&&(this.mousePitch=new ja({clickTolerance:a.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),f.addEventListener("mousedown",this.mousedown),f.addEventListener("touchstart",this.touchstart,{passive:!1}),f.addEventListener("touchmove",this.touchmove),f.addEventListener("touchend",this.touchend),f.addEventListener("touchcancel",this.reset)}down(a,f){this.mouseRotate.mousedown(a,f),this.mousePitch&&this.mousePitch.mousedown(a,f),ne()}move(a,f){const v=this.map,S=this.mouseRotate.mousemoveWindow(a,f),T=S&&S.bearingDelta;if(T&&v.setBearing(v.getBearing()+T),this.mousePitch){const N=this.mousePitch.mousemoveWindow(a,f),z=N&&N.pitchDelta;z&&v.setPitch(v.getPitch()+z)}}off(){const a=this.element;a.removeEventListener("mousedown",this.mousedown),a.removeEventListener("touchstart",this.touchstart,{passive:!1}),a.removeEventListener("touchmove",this.touchmove),a.removeEventListener("touchend",this.touchend),a.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){me(),o.window.removeEventListener("mousemove",this.mousemove),o.window.removeEventListener("mouseup",this.mouseup)}mousedown(a){this.down(o.extend({},a,{ctrlKey:!0,preventDefault:()=>a.preventDefault()}),ze(this.element,a)),o.window.addEventListener("mousemove",this.mousemove),o.window.addEventListener("mouseup",this.mouseup)}mousemove(a){this.move(a,ze(this.element,a))}mouseup(a){this.mouseRotate.mouseupWindow(a),this.mousePitch&&this.mousePitch.mouseupWindow(a),this.offTemp()}touchstart(a){a.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=pe(this.element,a.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>a.preventDefault()},this._startPos))}touchmove(a){a.targetTouches.length!==1?this.reset():(this._lastPos=pe(this.element,a.targetTouches)[0],this.move({preventDefault:()=>a.preventDefault()},this._lastPos))}touchend(a){a.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const ft={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},zt={maxWidth:100,unit:"metric"},Jt={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},En={version:o.version,supported:I,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends zh{constructor(y){if(o.LivePerformanceUtils.mark(o.PerformanceMarkers.create),(y=o.extend({},ut,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(y.antialias&&o.isSafariWithAntialiasingBug(o.window)&&(y.antialias=!1,o.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new _a(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies),y),this._interactive=y.interactive,this._minTileCacheSize=y.minTileCacheSize,this._maxTileCacheSize=y.maxTileCacheSize,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._useWebGL2=y.useWebGL2,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=y.crossSourceCollisions,this._collectResourceTiming=y.collectResourceTiming,this._optimizeForTerrain=y.optimizeForTerrain,this._language=this._parseLanguage(y.language),this._worldview=y.worldview,this._renderTaskQueue=new C,this._domRenderTaskQueue=new C,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.uniqueId(),this._locale=o.extend({},tt,y.locale),this._clickTolerance=y.clickTolerance,this._cooperativeGestures=y.cooperativeGestures,this._performanceMetricsCollection=y.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Ye(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new o.RequestManager(y.transformRequest,y.accessToken,y.testMode),this._silenceAuthErrors=!!y.testMode,typeof y.container=="string"){if(this._container=o.window.document.getElementById(y.container),!this._container)throw new Error(`Container '${y.container}' not found.`)}else{if(!(y.container instanceof o.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(this._container.childNodes.length>0&&o.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),y.maxBounds&&this.setMaxBounds(y.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1),o.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Vl(this,y),this._localFontFamily=y.localFontFamily,this._localIdeographFontFamily=y.localIdeographFontFamily,y.style&&this.setStyle(y.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),y.projection&&this.setProjection(y.projection),this._hash=y.hash&&new Fu(typeof y.hash=="string"&&y.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}),y.bounds&&(this.resize(),this.fitBounds(y.bounds,o.extend({},y.fitBoundsOptions,{duration:0})))),this.resize(),y.attributionControl&&this.addControl(new lr({customAttribution:y.customAttribution})),this._logoControl=new $c,this.addControl(this._logoControl,y.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(a=>{this._update(a.dataType==="style"),this.fire(new o.Event(`${a.dataType}data`,a))})),this.on("dataloading",(a=>{this.fire(new o.Event(`${a.dataType}dataloading`,a))}))}_getMapId(){return this._mapId}addControl(y,a){if(a===void 0&&(a=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=y.onAdd(this);this._controls.push(y);const v=this._controlPositions[a];return a.indexOf("bottom")!==-1?v.insertBefore(f,v.firstChild):v.appendChild(f),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(y);return a>-1&&this._controls.splice(a,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(y){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const a=!this._moving;return a&&this.fire(new o.Event("movestart",y)).fire(new o.Event("move",y)),this.fire(new o.Event("resize",y)),a&&this.fire(new o.Event("moveend",y)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(y){return this.transform.setMaxBounds(o.LngLatBounds.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y?this.setZoom(y):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y?this.setZoom(y):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y?this.setPitch(y):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y?this.setPitch(y):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(y){return y==="auto"?o.window.navigator.language:Array.isArray(y)?y.length===0?void 0:y.map((a=>a==="auto"?o.window.navigator.language:a)):y}setLanguage(y){const a=this._parseLanguage(y);if(!this.style||a===this._language)return this;this._language=a,this.style._reloadSources();for(const f of this._controls)f._setLanguage&&f._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(y){return this.style&&y!==this._worldview?(this._worldview=y,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(y){return this._lazyInitEmptyStyle(),y?typeof y=="string"&&(y={name:y}):y=null,this._useExplicitProjection=!!y,this._prioritizeAndUpdateProjection(y,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const y=this.transform,a=y.projection.name;let f;a==="globe"&&y.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?(y.setMercatorFromTransition(),f=!0):a==="mercator"&&y.zoom<o.GLOBE_ZOOM_THRESHOLD_MAX&&(y.setProjection({name:"globe"}),f=!0),f&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(y,a){return this._updateProjection(y||a||{name:"mercator"})}_updateProjection(y){let a;if(a=y.name==="globe"&&this.transform.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(y),this.style.applyProjectionUpdate(),a){this.painter.clearBackgroundTiles();for(const f in this.style._sourceCaches)this.style._sourceCaches[f].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(y){return this.transform.locationPoint3D(o.LngLat.convert(y))}unproject(y){return this.transform.pointLocation3D(o.Point.convert(y))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(y,a,f){if(y==="mouseenter"||y==="mouseover"){let v=!1;const S=N=>{const z=a.filter((Q=>this.getLayer(Q))),$=z.length?this.queryRenderedFeatures(N.point,{layers:z}):[];$.length?v||(v=!0,f.call(this,new gl(y,this,N.originalEvent,{features:$}))):v=!1},T=()=>{v=!1};return{layers:new Set(a),listener:f,delegates:{mousemove:S,mouseout:T}}}if(y==="mouseleave"||y==="mouseout"){let v=!1;const S=N=>{const z=a.filter(($=>this.getLayer($)));(z.length?this.queryRenderedFeatures(N.point,{layers:z}):[]).length?v=!0:v&&(v=!1,f.call(this,new gl(y,this,N.originalEvent)))},T=N=>{v&&(v=!1,f.call(this,new gl(y,this,N.originalEvent)))};return{layers:new Set(a),listener:f,delegates:{mousemove:S,mouseout:T}}}{const v=S=>{const T=a.filter((z=>this.getLayer(z))),N=T.length?this.queryRenderedFeatures(S.point,{layers:T}):[];N.length&&(S.features=N,f.call(this,S),delete S.features)};return{layers:new Set(a),listener:f,delegates:{[y]:v}}}}on(y,a,f){if(f===void 0)return super.on(y,a);Array.isArray(a)||(a=[a]);const v=this._createDelegatedListener(y,a,f);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(v);for(const S in v.delegates)this.on(S,v.delegates[S]);return this}once(y,a,f){if(f===void 0)return super.once(y,a);Array.isArray(a)||(a=[a]);const v=this._createDelegatedListener(y,a,f);for(const S in v.delegates)this.once(S,v.delegates[S]);return this}off(y,a,f){if(f===void 0)return super.off(y,a);a=new Set(Array.isArray(a)?a:[a]);const v=(T,N)=>{if(T.size!==N.size)return!1;for(const z of T)if(!N.has(z))return!1;return!0},S=this._delegatedListeners?this._delegatedListeners[y]:void 0;return S&&(T=>{for(let N=0;N<T.length;N++){const z=T[N];if(z.listener===f&&v(z.layers,a)){for(const $ in z.delegates)this.off($,z.delegates[$]);return T.splice(N,1),this}}})(S),this}queryRenderedFeatures(y,a){return this.style?(a!==void 0||y===void 0||y instanceof o.Point||Array.isArray(y)||(a=y,y=void 0),this.style.queryRenderedFeatures(y=y||[[0,0],[this.transform.width,this.transform.height]],a=a||{},this.transform)):[]}querySourceFeatures(y,a){return this.style.querySourceFeatures(y,a)}isPointOnSurface(y){const{name:a}=this.transform.projection;return a!=="globe"&&a!=="mercator"&&o.warnOnce(`${a} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.Point.convert(y))}setStyle(y,a){return(a=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},a)).diff!==!1&&a.localIdeographFontFamily===this._localIdeographFontFamily&&a.localFontFamily===this._localFontFamily&&this.style&&y?(this._diffStyle(y,a),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._localFontFamily=a.localFontFamily,this._updateStyle(y,a))}_getUIString(y){const a=this._locale[y];if(a==null)throw new Error(`Missing UI string '${y}'`);return a}_updateStyle(y,a){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),y&&(this.style=new Ai(this,a||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y):this.style.loadJSON(y)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ai(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,a){if(typeof y=="string"){const f=this._requestManager.normalizeStyleURL(y),v=this._requestManager.transformRequest(f,o.ResourceType.Style);o.getJSON(v,((S,T)=>{S?this.fire(new o.ErrorEvent(S)):T&&this._updateDiff(T,a)}))}else typeof y=="object"&&this._updateDiff(y,a)}_updateDiff(y,a){try{this.style.setState(y)&&this._update(!0)}catch(f){o.warnOnce(`Unable to perform style diff: ${f.message||f.error||f}.  Rebuilding the style from scratch.`),this._updateStyle(y,a)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.warnOnce("There is no style added to the map."),!1)}addSource(y,a){return this._lazyInitEmptyStyle(),this.style.addSource(y,a),this._update(!0)}isSourceLoaded(y){return!!this.style&&this.style._isSourceCacheLoaded(y)}areTilesLoaded(){const y=this.style&&this.style._sourceCaches;for(const a in y){const f=y[a]._tiles;for(const v in f){const S=f[v];if(S.state!=="loaded"&&S.state!=="errored")return!1}}return!0}addSourceType(y,a,f){this._lazyInitEmptyStyle(),this.style.addSourceType(y,a,f)}removeSource(y){return this.style.removeSource(y),this._updateTerrain(),this._update(!0)}getSource(y){return this.style.getSource(y)}addImage(y,a,{pixelRatio:f=1,sdf:v=!1,stretchX:S,stretchY:T,content:N}={}){if(this._lazyInitEmptyStyle(),a instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&a instanceof o.window.ImageBitmap){const{width:z,height:$,data:Q}=o.exported.getImageData(a);this.style.addImage(y,{data:new o.RGBAImage({width:z,height:$},Q),pixelRatio:f,stretchX:S,stretchY:T,content:N,sdf:v,version:0})}else if(a.width===void 0||a.height===void 0)this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:z,height:$}=a,Q=a;this.style.addImage(y,{data:new o.RGBAImage({width:z,height:$},new Uint8Array(Q.data)),pixelRatio:f,stretchX:S,stretchY:T,content:N,sdf:v,version:0,userImage:Q}),Q.onAdd&&Q.onAdd(this,y)}}updateImage(y,a){const f=this.style.getImage(y);if(!f)return void this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const v=a instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&a instanceof o.window.ImageBitmap?o.exported.getImageData(a):a,{width:S,height:T}=v;S!==void 0&&T!==void 0?S===f.data.width&&T===f.data.height?(f.data.replace(v.data,!(a instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&a instanceof o.window.ImageBitmap)),this.style.updateImage(y,f)):this.fire(new o.ErrorEvent(new Error(`The width and height of the updated image (${S}, ${T})
                must be that same as the previous version of the image
                (${f.data.width}, ${f.data.height})`))):this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y,a){o.getImage(this._requestManager.transformRequest(y,o.ResourceType.Image),((f,v)=>{a(f,v instanceof o.window.HTMLImageElement?o.exported.getImageData(v):v)}))}listImages(){return this.style.listImages()}addLayer(y,a){return this._lazyInitEmptyStyle(),this.style.addLayer(y,a),this._update(!0)}moveLayer(y,a){return this.style.moveLayer(y,a),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}setLayerZoomRange(y,a,f){return this.style.setLayerZoomRange(y,a,f),this._update(!0)}setFilter(y,a,f={}){return this.style.setFilter(y,a,f),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,a,f,v={}){return this.style.setPaintProperty(y,a,f,v),this._update(!0)}getPaintProperty(y,a){return this.style.getPaintProperty(y,a)}setLayoutProperty(y,a,f,v={}){return this.style.setLayoutProperty(y,a,f,v),this._update(!0)}getLayoutProperty(y,a){return this.style.getLayoutProperty(y,a)}setLight(y,a={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,a),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(y){return this._lazyInitEmptyStyle(),!y&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(y),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(y){return this._lazyInitEmptyStyle(),this.style.setFog(y),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(y){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.LngLat.convert(y),this.transform):0}setFeatureState(y,a){return this.style.setFeatureState(y,a),this._update()}removeFeatureState(y,a){return this.style.removeFeatureState(y,a),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}_updateContainerDimensions(){if(!this._container)return;const y=this._container.getBoundingClientRect().width||400,a=this._container.getBoundingClientRect().height||300;let f,v,S,T=this._container;for(;T&&(!v||!S);){const N=o.window.getComputedStyle(T).transform;N&&N!=="none"&&(f=N.match(/matrix.*\((.+)\)/)[1].split(", "),f[0]&&f[0]!=="0"&&f[0]!=="1"&&(v=f[0]),f[3]&&f[3]!=="0"&&f[3]!=="1"&&(S=f[3])),T=T.parentElement}this._containerWidth=v?Math.abs(y/v):y,this._containerHeight=S?Math.abs(a/S):a}_detectMissingCSS(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const y=this._container;y.classList.add("mapboxgl-map"),(this._missingCSSCanary=k("div","mapboxgl-canary",y)).style.visibility="hidden",this._detectMissingCSS();const a=this._canvasContainer=k("div","mapboxgl-canvas-container",y);this._interactive&&a.classList.add("mapboxgl-interactive"),this._canvas=k("canvas","mapboxgl-canvas",a),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const f=this._controlContainer=k("div","mapboxgl-control-container",y),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((S=>{v[S]=k("div",`mapboxgl-ctrl-${S}`,f)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,a){const f=o.exported.devicePixelRatio||1;this._canvas.width=f*Math.ceil(y),this._canvas.height=f*Math.ceil(a),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${a}px`}_addMarker(y){this._markers.push(y)}_removeMarker(y){const a=this._markers.indexOf(y);a!==-1&&this._markers.splice(a,1)}_addPopup(y){this._popups.push(y)}_removePopup(y){const a=this._popups.indexOf(y);a!==-1&&this._popups.splice(a,1)}_setupPainter(){const y=o.extend({},I.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),a=this._useWebGL2&&this._canvas.getContext("webgl2",y),f=a||this._canvas.getContext("webgl",y)||this._canvas.getContext("experimental-webgl",y);f?(this._useWebGL2&&!a&&o.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),o.storeAuthState(f,!0),this.painter=new jr(f,this.transform,!!a),this.on("data",(v=>{v.dataType==="source"&&this.painter.setTileLoadedFlag(!0)})),o.exported$1.testSupport(f)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(y){y.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:y}))}_contextRestored(y){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:y}))}_onMapScroll(y){if(y.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_requestDomTask(y){!this.loaded()||this.loaded()&&!this.isMoving()?y():this._domRenderTaskQueue.add(y)}_render(y){let a;const f=this.painter.context.extTimerQuery,v=o.exported.now();if(this.listens("gpu-timing-frame")&&(a=f.createQueryEXT(),f.beginQueryEXT(f.TIME_ELAPSED_EXT,a)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],o.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],o.window.performance.now())),this._renderTaskQueue.run(y),this._domRenderTaskQueue.run(y),this._removed)return;this._updateProjectionTransition();const S=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const z=this.transform.zoom,$=this.transform.pitch,Q=o.exported.now(),te=new o.EvaluationParameters(z,{now:Q,fadeDuration:S,pitch:$,transition:this.style.getTransition()});this.style.update(te)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(v),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):T=this._updateAverageElevation(v),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,S,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:S,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),a){const z=o.exported.now()-v;f.endQueryEXT(f.TIME_ELAPSED_EXT,a),setTimeout((()=>{const $=f.getQueryObjectEXT(a,f.QUERY_RESULT_EXT)/1e6;f.deleteQueryEXT(a),this.fire(new o.Event("gpu-timing-frame",{cpuTime:z,gpuTime:$})),o.window.performance.mark("frame-gpu",{startTime:v,detail:{gpuTime:$}})}),50)}if(this.listens("gpu-timing-layer")){const z=this.painter.collectGpuTimers();setTimeout((()=>{const $=this.painter.queryGpuTimers(z);this.fire(new o.Event("gpu-timing-layer",{layerTimes:$}))}),50)}if(this.listens("gpu-timing-deferred-render")){const z=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const $=this.painter.queryGpuTimeDeferredRender(z);this.fire(new o.Event("gpu-timing-deferred-render",{gpuTime:$}))}),50)}const N=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(N||this._repaint)this.triggerRepaint();else{const z=!this.isMoving()&&this.loaded();if(z&&(T=this._updateAverageElevation(v,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),z&&(this.fire(new o.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const $=this._calculateSpeedIndex();this.fire(new o.Event("speedindexcompleted",{speedIndex:$})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||N||(this._fullyLoaded=!0,o.LivePerformanceUtils.mark(o.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&o.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(y){for(const a of this._markers)y&&!this.getRenderWorldCopies()&&(a._lngLat=a._lngLat.wrap()),a._update();for(const a of this._popups)!y||this.getRenderWorldCopies()||a._trackPointer||(a._lngLat=a._lngLat.wrap()),a._update()}_updateAverageElevation(y,a=!1){const f=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&f(0);if((a||y-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(y)){const v=this.transform.averageElevation;let S=this.transform.sampleAverageElevation(),T=!1;this.transform.elevation&&(T=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(S)?S=0:this._averageElevationLastSampledAt=y;const N=Math.abs(v-S);if(N>1){if(this._isInitialLoad||T)return this._averageElevation.jumpTo(S),f(S);this._averageElevation.easeTo(S,y,300)}else if(N>1e-4)return this._averageElevation.jumpTo(S),f(S)}return!!this._averageElevation.isEasing(y)&&f(this._averageElevation.getValue(y))}_authenticate(){o.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(y=>{if(y&&(y.message===o.AUTH_ERR_MSG||y.status===401)){const a=this.painter.context.gl;o.storeAuthState(a,!1),this._logoControl instanceof $c&&this._logoControl._updateLogo(),a&&a.clear(a.DEPTH_BUFFER_BIT|a.COLOR_BUFFER_BIT|a.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),o.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_updateTerrain(){const y=this._isDragging();this.painter.updateTerrain(this.style,y)}_calculateSpeedIndex(){const y=this.painter.canvasCopy(),a=this.painter.getCanvasCopiesAndTimestamps();a.timeStamps.push(performance.now());const f=this.painter.context.gl,v=f.createFramebuffer();function S(T){f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,T,0);const N=new Uint8Array(f.drawingBufferWidth*f.drawingBufferHeight*4);return f.readPixels(0,0,f.drawingBufferWidth,f.drawingBufferHeight,f.RGBA,f.UNSIGNED_BYTE,N),N}return f.bindFramebuffer(f.FRAMEBUFFER,v),this._canvasPixelComparison(S(y),a.canvasCopies.map(S),a.timeStamps)}_canvasPixelComparison(y,a,f){let v=f[1]-f[0];const S=y.length/4;for(let T=0;T<a.length;T++){const N=a[T];let z=0;for(let $=0;$<N.length;$+=4)N[$]===y[$]&&N[$+1]===y[$+1]&&N[$+2]===y[$+2]&&N[$+3]===y[$+3]&&(z+=1);v+=(f[T+2]-f[T+1])*(1-z/S)}return v}remove(){this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1),o.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const y=this.painter.context.gl.getExtension("WEBGL_lose_context");y&&y.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),o.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(y){this._renderNextFrame=this._renderNextFrame||y,this.style&&!this._frame&&(this._frame=o.exported.frame((a=>{const f=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,f&&this._render(a)})))}_preloadTiles(y){const a=this.style?Object.values(this.style._sourceCaches):[];return o.asyncAll(a,((f,v)=>f._preloadTiles(y,v)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(y){this._trackResize&&this.resize({originalEvent:y})._update()}_onVisibilityChange(){o.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(y){this._showTerrainWireframe!==y&&(this._showTerrainWireframe=y,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(y){this._speedIndexTiming!==y&&(this._speedIndexTiming=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(y){this._showTileAABBs!==y&&(this._showTileAABBs=y,y&&this._update())}_setCacheLimits(y,a){o.setCacheLimits(y,a)}get version(){return o.version}},NavigationControl:class{constructor(y){this.options=o.extend({},Nt,y),this._container=k("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(a=>a.preventDefault())),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(a=>{this._map&&this._map.zoomIn({},{originalEvent:a})})),k("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(a=>{this._map&&this._map.zoomOut({},{originalEvent:a})})),k("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(a=>{const f=this._map;f&&(this.options.visualizePitch?f.resetNorthPitch({},{originalEvent:a}):f.resetNorth({},{originalEvent:a}))})),this._compassIcon=k("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const y=this._map;if(!y)return;const a=y.getZoom(),f=a===y.getMaxZoom(),v=a===y.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=v,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",v.toString())}_rotateCompassArrow(){const y=this._map;if(!y)return;const a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(y.transform.pitch*(Math.PI/180)),.5)}) rotateX(${y.transform.pitch}deg) rotateZ(${y.transform.angle*(180/Math.PI)}deg)`:`rotate(${y.transform.angle*(180/Math.PI)}deg)`;y._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=a)}))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),y.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&y.on("pitch",this._rotateCompassArrow),y.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new rn(y,this._compass,this.options.visualizePitch)),this._container}onRemove(){const y=this._map;y&&(this._container.remove(),this.options.showZoom&&y.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&y.off("pitch",this._rotateCompassArrow),y.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(y,a){const f=k("button",y,this._container);return f.type="button",f.addEventListener("click",a),f}_setButtonTitle(y,a){if(!this._map)return;const f=this._map._getUIString(`NavigationControl.${a}`);y.setAttribute("aria-label",f),y.firstElementChild&&y.firstElementChild.setAttribute("title",f)}},GeolocateControl:class extends o.Evented{constructor(y){super(),this.options=o.extend({geolocation:o.window.navigator.geolocation},ft,y),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Bo(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(y){return this._map=y,this._container=k("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(y){const a=(f=!!this.options.geolocation)=>{this._supportsGeolocation=f,y(f)};this._supportsGeolocation!==void 0?y(this._supportsGeolocation):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then((f=>a(f.state!=="denied"))).catch((()=>a())):a()}_isOutOfMapMaxBounds(y){const a=this._map.getMaxBounds(),f=y.coords;return!!a&&(f.longitude<a.getWest()||f.longitude>a.getEast()||f.latitude<a.getSouth()||f.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(y){if(this._map){if(this._isOutOfMapMaxBounds(y))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",y)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=y,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(y),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(y),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",y)),this._finish()}}_updateCamera(y){const a=new o.LngLat(y.coords.longitude,y.coords.latitude),f=y.coords.accuracy,v=this._map.getBearing(),S=o.extend({bearing:v},this.options.fitBoundsOptions);this._map.fitBounds(a.toBounds(f),S,{geolocateSource:!0})}_updateMarker(y){if(y){const a=new o.LngLat(y.coords.longitude,y.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=y.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const y=this._map.transform,a=o.mercatorZfromAltitude(1,y._center.lat)*y.worldSize,f=Math.ceil(2*this._accuracy*a);this._circleElement.style.width=`${f}px`,this._circleElement.style.height=`${f}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(y){if(this._map){if(this.options.trackUserLocation)if(y.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(y.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",y)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(y){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",(a=>a.preventDefault())),this._geolocateButton=k("button","mapboxgl-ctrl-geolocate",this._container),k("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",y===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=k("div","mapboxgl-user-location"),this._dotElement.appendChild(k("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(k("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new oe({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=k("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new oe({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(a=>{a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a.originalEvent&&a.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))}))}}_onDeviceOrientation(y){this._userLocationDotMarker&&(y.webkitCompassHeading?this._heading=y.webkitCompassHeading:y.absolute===!0&&(this._heading=-1*y.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(y={maximumAge:6e5,timeout:0},this._noTimeout=!0):(y=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,y),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const y=()=>{o.window.addEventListener("ondeviceorientationabsolute"in o.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};o.window.DeviceMotionEvent!==void 0&&typeof o.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then((a=>{a==="granted"&&y()})).catch(console.error):y()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),o.window.removeEventListener("deviceorientation",this._onDeviceOrientation),o.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:lr,ScaleControl:class{constructor(y){this.options=o.extend({},zt,y),this._isNumberFormatSupported=(function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}})(),o.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const y=this.options.maxWidth||100,a=this._map,f=a._containerHeight/2,v=a._containerWidth/2-y/2,S=a.unproject([v,f]),T=a.unproject([v+y,f]),N=S.distanceTo(T);if(this.options.unit==="imperial"){const z=3.2808*N;z>5280?this._setScale(y,z/5280,"mile"):this._setScale(y,z,"foot")}else this.options.unit==="nautical"?this._setScale(y,N/1852,"nautical-mile"):N>=1e3?this._setScale(y,N/1e3,"kilometer"):this._setScale(y,N,"meter")}_setScale(y,a,f){this._map._requestDomTask((()=>{const v=(function(T){const N=Math.pow(10,`${Math.floor(T)}`.length-1);let z=T/N;return z=z>=10?10:z>=5?5:z>=3?3:z>=2?2:z>=1?1:(function($){const Q=Math.pow(10,Math.ceil(-Math.log($)/Math.LN10));return Math.round($*Q)/Q})(z),N*z})(a),S=v/a;this._container.innerHTML=this._isNumberFormatSupported&&f!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:f}).format(v):`${v}&nbsp;${Jt[f]}`,this._container.style.width=y*S+"px"}))}onAdd(y){return this._map=y,this._language=y.getLanguage(),this._container=k("div","mapboxgl-ctrl mapboxgl-ctrl-scale",y.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(y){this._language=y,this._update()}setUnit(y){this.options.unit=y,this._update()}},FullscreenControl:class{constructor(y){this._fullscreen=!1,y&&y.container&&(y.container instanceof o.window.HTMLElement?this._container=y.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in o.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=k("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!o.window.document.fullscreenEnabled&&!o.window.document.webkitFullscreenEnabled)}_setupUI(){const y=this._fullscreenButton=k("button","mapboxgl-ctrl-fullscreen",this._controlContainer);k("span","mapboxgl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",y)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(o.window.document.fullscreenElement||o.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.Evented{constructor(y){super(),this.options=o.extend(Object.create(Pe),y),o.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(y&&y.className?y.className.trim().split(/\s+/):[])}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&y.on("preclick",this._onClose),this.options.closeOnMove&&y.on("move",this._onClose),y.on("remove",this.remove),this._update(),y._addPopup(this),this._focusFirstElement(),this._trackPointer?(y.on("mousemove",this._onMouseEvent),y.on("mouseup",this._onMouseEvent),y._canvasContainer.classList.add("mapboxgl-track-pointer")):y.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const y=this._map;return y&&(y.off("move",this._update),y.off("move",this._onClose),y.off("preclick",this._onClose),y.off("click",this._onClose),y.off("remove",this.remove),y.off("mousemove",this._onMouseEvent),y.off("mouseup",this._onMouseEvent),y.off("drag",this._onMouseEvent),y._canvasContainer&&y._canvasContainer.classList.remove("mapboxgl-track-pointer"),y._removePopup(this),this._map=void 0),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(y){this._lngLat=o.LngLat.convert(y),this._pos=null,this._trackPointer=!1,this._update();const a=this._map;return a&&(a.on("move",this._update),a.off("mousemove",this._onMouseEvent),a._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const y=this._map;return y&&(y.off("move",this._update),y.on("mousemove",this._onMouseEvent),y.on("drag",this._onMouseEvent),y._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(o.window.document.createTextNode(y))}setHTML(y){const a=o.window.document.createDocumentFragment(),f=o.window.document.createElement("body");let v;for(f.innerHTML=y;v=f.firstChild,v;)a.appendChild(v);return this.setDOMContent(a)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){let a=this._content;if(a)for(;a.hasChildNodes();)a.firstChild&&a.removeChild(a.firstChild);else a=this._content=k("div","mapboxgl-popup-content",this._container||void 0);if(a.appendChild(y),this.options.closeButton){const f=this._closeButton=k("button","mapboxgl-popup-close-button",a);f.type="button",f.setAttribute("aria-label","Close popup"),f.setAttribute("aria-hidden","true"),f.innerHTML="&#215;",f.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(y){return this._classList.add(y),this._updateClassList(),this}removeClassName(y){return this._classList.delete(y),this._updateClassList(),this}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){let a;return this._classList.delete(y)?a=!1:(this._classList.add(y),a=!0),this._updateClassList(),a}_onMouseEvent(y){this._update(y.point)}_getAnchor(y){if(this.options.anchor)return this.options.anchor;const a=this._map,f=this._container,v=this._pos;if(!a||!f||!v)return"bottom";const S=f.offsetWidth,T=f.offsetHeight,N=v.x<S/2,z=v.x>a.transform.width-S/2;if(v.y+y<T)return N?"top-left":z?"top-right":"top";if(v.y>a.transform.height-T){if(N)return"bottom-left";if(z)return"bottom-right"}return N?"left":z?"right":"bottom"}_updateClassList(){const y=this._container;if(!y)return;const a=[...this._classList];a.push("mapboxgl-popup"),this._anchor&&a.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&a.push("mapboxgl-popup-track-pointer"),y.className=a.join(" ")}_update(y){const a=this._map,f=this._content;if(!a||!this._lngLat&&!this._trackPointer||!f)return;let v=this._container;if(v||(v=this._container=k("div","mapboxgl-popup",a.getContainer()),this._tip=k("div","mapboxgl-popup-tip",v),v.appendChild(f)),this.options.maxWidth&&v.style.maxWidth!==this.options.maxWidth&&(v.style.maxWidth=this.options.maxWidth),a.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=B(this._lngLat,this._pos,a.transform)),!this._trackPointer||y){const S=this._pos=this._trackPointer&&y?y:a.project(this._lngLat),T=Ke(this.options.offset),N=this._anchor=this._getAnchor(T.y),z=Ke(this.options.offset,N),$=S.add(z).round();a._requestDomTask((()=>{this._container&&N&&(this._container.style.transform=`${ee[N]} translate(${$.x}px,${$.y}px)`)}))}if(!this._marker&&a._showingGlobe()){const S=o.isLngLatBehindGlobe(a.transform,this._lngLat)?0:1;this._setOpacity(S)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(je);y&&y.focus()}_onClose(){this.remove()}_setOpacity(y){this._container&&(this._container.style.opacity=`${y}`),this._content&&(this._content.style.pointerEvents=y?"auto":"none")}},Marker:oe,Style:Ai,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.Point,MercatorCoordinate:o.MercatorCoordinate,FreeCameraOptions:ru,Evented:o.Evented,config:o.config,prewarm:function(){fa().acquire(_s)},clearPrewarmedResources:function(){const y=Ps;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(_s),Ps=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(y){o.config.ACCESS_TOKEN=y},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(y){o.config.API_URL=y},get workerCount(){return ro.workerCount},set workerCount(y){ro.workerCount=y},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(y){o.config.MAX_PARALLEL_IMAGE_REQUESTS=y},clearStorage(y){o.clearTileCache(y)},workerUrl:"",workerClass:null,setNow:o.exported.setNow,restoreNow:o.exported.restoreNow};return En}));var _=u;return _}))})(O1)),O1.exports}var y7=g7();const Rd=Wv(y7),_7="modulepreload",v7=function(n){return"/StakeholderMap/"+n},C2={},cb=function(e,t,i){let c=Promise.resolve();if(t&&t.length>0){let o=function(w){return Promise.all(w.map(I=>Promise.resolve(I).then(R=>({status:"fulfilled",value:R}),R=>({status:"rejected",reason:R}))))};document.getElementsByTagName("link");const m=document.querySelector("meta[property=csp-nonce]"),_=m?.nonce||m?.getAttribute("nonce");c=o(t.map(w=>{if(w=v7(w),w in C2)return;C2[w]=!0;const I=w.endsWith(".css"),R=I?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${w}"]${R}`))return;const V=document.createElement("link");if(V.rel=I?"stylesheet":_7,I||(V.as="script"),V.crossOrigin="",V.href=w,_&&V.setAttribute("nonce",_),document.head.appendChild(V),I)return new Promise((k,ie)=>{V.addEventListener("load",k),V.addEventListener("error",()=>ie(new Error(`Unable to preload CSS for ${w}`)))})}))}function u(m){const _=new Event("vite:preloadError",{cancelable:!0});if(_.payload=m,window.dispatchEvent(_),!_.defaultPrevented)throw m}return c.then(m=>{for(const _ of m||[])_.status==="rejected"&&u(_.reason);return e().catch(u)})};function wa(n){"@babel/helpers - typeof";return wa=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wa(n)}var rf=Uint8Array,md=Uint16Array,gw=Int32Array,yw=new rf([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),_w=new rf([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),L2=new rf([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),t6=function(n,e){for(var t=new md(31),i=0;i<31;++i)t[i]=e+=1<<n[i-1];for(var c=new gw(t[30]),i=1;i<30;++i)for(var u=t[i];u<t[i+1];++u)c[u]=u-t[i]<<5|i;return{b:t,r:c}},n6=t6(yw,2),x7=n6.b,f5=n6.r;x7[28]=258,f5[258]=28;var b7=t6(_w,0),P2=b7.r,p5=new md(32768);for(var wl=0;wl<32768;++wl){var Kp=(wl&43690)>>1|(wl&21845)<<1;Kp=(Kp&52428)>>2|(Kp&13107)<<2,Kp=(Kp&61680)>>4|(Kp&3855)<<4,p5[wl]=((Kp&65280)>>8|(Kp&255)<<8)>>1}var Uy=(function(n,e,t){for(var i=n.length,c=0,u=new md(e);c<i;++c)n[c]&&++u[n[c]-1];var m=new md(e);for(c=1;c<e;++c)m[c]=m[c-1]+u[c-1]<<1;var _;if(t){_=new md(1<<e);var o=15-e;for(c=0;c<i;++c)if(n[c])for(var w=c<<4|n[c],I=e-n[c],R=m[n[c]-1]++<<I,V=R|(1<<I)-1;R<=V;++R)_[p5[R]>>o]=w}else for(_=new md(i),c=0;c<i;++c)n[c]&&(_[c]=p5[m[n[c]-1]++]>>15-n[c]);return _}),tg=new rf(288);for(var wl=0;wl<144;++wl)tg[wl]=8;for(var wl=144;wl<256;++wl)tg[wl]=9;for(var wl=256;wl<280;++wl)tg[wl]=7;for(var wl=280;wl<288;++wl)tg[wl]=8;var hv=new rf(32);for(var wl=0;wl<32;++wl)hv[wl]=5;var w7=Uy(tg,9,0),S7=Uy(hv,5,0),r6=function(n){return(n+7)/8|0},E7=function(n,e,t){return(t==null||t>n.length)&&(t=n.length),new rf(n.subarray(e,t))},up=function(n,e,t){t<<=e&7;var i=e/8|0;n[i]|=t,n[i+1]|=t>>8},wy=function(n,e,t){t<<=e&7;var i=e/8|0;n[i]|=t,n[i+1]|=t>>8,n[i+2]|=t>>16},ub=function(n,e){for(var t=[],i=0;i<n.length;++i)n[i]&&t.push({s:i,f:n[i]});var c=t.length,u=t.slice();if(!c)return{t:o6,l:0};if(c==1){var m=new rf(t[0].s+1);return m[t[0].s]=1,{t:m,l:1}}t.sort(function(ke,ze){return ke.f-ze.f}),t.push({s:-1,f:25001});var _=t[0],o=t[1],w=0,I=1,R=2;for(t[0]={s:-1,f:_.f+o.f,l:_,r:o};I!=c-1;)_=t[t[w].f<t[R].f?w++:R++],o=t[w!=I&&t[w].f<t[R].f?w++:R++],t[I++]={s:-1,f:_.f+o.f,l:_,r:o};for(var V=u[0].s,i=1;i<c;++i)u[i].s>V&&(V=u[i].s);var k=new md(V+1),ie=m5(t[I-1],k,0);if(ie>e){var i=0,ae=0,fe=ie-e,J=1<<fe;for(u.sort(function(ze,pe){return k[pe.s]-k[ze.s]||ze.f-pe.f});i<c;++i){var ne=u[i].s;if(k[ne]>e)ae+=J-(1<<ie-k[ne]),k[ne]=e;else break}for(ae>>=fe;ae>0;){var me=u[i].s;k[me]<e?ae-=1<<e-k[me]++-1:++i}for(;i>=0&&ae;--i){var ue=u[i].s;k[ue]==e&&(--k[ue],++ae)}ie=e}return{t:new rf(k),l:ie}},m5=function(n,e,t){return n.s==-1?Math.max(m5(n.l,e,t+1),m5(n.r,e,t+1)):e[n.s]=t},k2=function(n){for(var e=n.length;e&&!n[--e];);for(var t=new md(++e),i=0,c=n[0],u=1,m=function(o){t[i++]=o},_=1;_<=e;++_)if(n[_]==c&&_!=e)++u;else{if(!c&&u>2){for(;u>138;u-=138)m(32754);u>2&&(m(u>10?u-11<<5|28690:u-3<<5|12305),u=0)}else if(u>3){for(m(c),--u;u>6;u-=6)m(8304);u>2&&(m(u-3<<5|8208),u=0)}for(;u--;)m(c);u=1,c=n[_]}return{c:t.subarray(0,i),n:e}},Sy=function(n,e){for(var t=0,i=0;i<e.length;++i)t+=n[i]*e[i];return t},i6=function(n,e,t){var i=t.length,c=r6(e+2);n[c]=i&255,n[c+1]=i>>8,n[c+2]=n[c]^255,n[c+3]=n[c+1]^255;for(var u=0;u<i;++u)n[c+u+4]=t[u];return(c+4+i)*8},M2=function(n,e,t,i,c,u,m,_,o,w,I){up(e,I++,t),++c[256];for(var R=ub(c,15),V=R.t,k=R.l,ie=ub(u,15),ae=ie.t,fe=ie.l,J=k2(V),ne=J.c,me=J.n,ue=k2(ae),ke=ue.c,ze=ue.n,pe=new md(19),U=0;U<ne.length;++U)++pe[ne[U]&31];for(var U=0;U<ke.length;++U)++pe[ke[U]&31];for(var F=ub(pe,7),q=F.t,j=F.l,H=19;H>4&&!q[L2[H-1]];--H);var Z=w+5<<3,be=Sy(c,tg)+Sy(u,hv)+m,Me=Sy(c,V)+Sy(u,ae)+m+14+3*H+Sy(pe,q)+2*pe[16]+3*pe[17]+7*pe[18];if(o>=0&&Z<=be&&Z<=Me)return i6(e,I,n.subarray(o,o+w));var Be,Re,we,De;if(up(e,I,1+(Me<be)),I+=2,Me<be){Be=Uy(V,k,0),Re=V,we=Uy(ae,fe,0),De=ae;var nt=Uy(q,j,0);up(e,I,me-257),up(e,I+5,ze-1),up(e,I+10,H-4),I+=14;for(var U=0;U<H;++U)up(e,I+3*U,q[L2[U]]);I+=3*H;for(var xe=[ne,ke],le=0;le<2;++le)for(var Ne=xe[le],U=0;U<Ne.length;++U){var Oe=Ne[U]&31;up(e,I,nt[Oe]),I+=q[Oe],Oe>15&&(up(e,I,Ne[U]>>5&127),I+=Ne[U]>>12)}}else Be=w7,Re=tg,we=S7,De=hv;for(var U=0;U<_;++U){var Je=i[U];if(Je>255){var Oe=Je>>18&31;wy(e,I,Be[Oe+257]),I+=Re[Oe+257],Oe>7&&(up(e,I,Je>>23&31),I+=yw[Oe]);var rt=Je&31;wy(e,I,we[rt]),I+=De[rt],rt>3&&(wy(e,I,Je>>5&8191),I+=_w[rt])}else wy(e,I,Be[Je]),I+=Re[Je]}return wy(e,I,Be[256]),I+Re[256]},A7=new gw([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),o6=new rf(0),T7=function(n,e,t,i,c,u){var m=u.z||n.length,_=new rf(i+m+5*(1+Math.ceil(m/7e3))+c),o=_.subarray(i,_.length-c),w=u.l,I=(u.r||0)&7;if(e){I&&(o[0]=u.r>>3);for(var R=A7[e-1],V=R>>13,k=R&8191,ie=(1<<t)-1,ae=u.p||new md(32768),fe=u.h||new md(ie+1),J=Math.ceil(t/3),ne=2*J,me=function(Gt){return(n[Gt]^n[Gt+1]<<J^n[Gt+2]<<ne)&ie},ue=new gw(25e3),ke=new md(288),ze=new md(32),pe=0,U=0,F=u.i||0,q=0,j=u.w||0,H=0;F+2<m;++F){var Z=me(F),be=F&32767,Me=fe[Z];if(ae[be]=Me,fe[Z]=be,j<=F){var Be=m-F;if((pe>7e3||q>24576)&&(Be>423||!w)){I=M2(n,o,0,ue,ke,ze,U,q,H,F-H,I),q=pe=U=0,H=F;for(var Re=0;Re<286;++Re)ke[Re]=0;for(var Re=0;Re<30;++Re)ze[Re]=0}var we=2,De=0,nt=k,xe=be-Me&32767;if(Be>2&&Z==me(F-xe))for(var le=Math.min(V,Be)-1,Ne=Math.min(32767,F),Oe=Math.min(258,Be);xe<=Ne&&--nt&&be!=Me;){if(n[F+we]==n[F+we-xe]){for(var Je=0;Je<Oe&&n[F+Je]==n[F+Je-xe];++Je);if(Je>we){if(we=Je,De=xe,Je>le)break;for(var rt=Math.min(xe,Je-2),mt=0,Re=0;Re<rt;++Re){var dt=F-xe+Re&32767,Dt=ae[dt],tn=dt-Dt&32767;tn>mt&&(mt=tn,Me=dt)}}}be=Me,Me=ae[be],xe+=be-Me&32767}if(De){ue[q++]=268435456|f5[we]<<18|P2[De];var ln=f5[we]&31,yn=P2[De]&31;U+=yw[ln]+_w[yn],++ke[257+ln],++ze[yn],j=F+we,++pe}else ue[q++]=n[F],++ke[n[F]]}}for(F=Math.max(F,j);F<m;++F)ue[q++]=n[F],++ke[n[F]];I=M2(n,o,w,ue,ke,ze,U,q,H,F-H,I),w||(u.r=I&7|o[I/8|0]<<3,I-=7,u.h=fe,u.p=ae,u.i=F,u.w=j)}else{for(var F=u.w||0;F<m+w;F+=65535){var Mn=F+65535;Mn>=m&&(o[I/8|0]=w,Mn=m),I=i6(o,I+1,n.subarray(F,Mn))}u.i=m}return E7(_,0,i+r6(I)+c)},s6=function(){var n=1,e=0;return{p:function(t){for(var i=n,c=e,u=t.length|0,m=0;m!=u;){for(var _=Math.min(m+2655,u);m<_;++m)c+=i+=t[m];i=(i&65535)+15*(i>>16),c=(c&65535)+15*(c>>16)}n=i,e=c},d:function(){return n%=65521,e%=65521,(n&255)<<24|(n&65280)<<8|(e&255)<<8|e>>8}}},I7=function(n,e,t,i,c){if(!c&&(c={l:1},e.dictionary)){var u=e.dictionary.subarray(-32768),m=new rf(u.length+n.length);m.set(u),m.set(n,u.length),n=m,c.w=u.length}return T7(n,e.level==null?6:e.level,e.mem==null?c.l?Math.ceil(Math.max(8,Math.min(13,Math.log(n.length)))*1.5):20:12+e.mem,t,i,c)},a6=function(n,e,t){for(;t;++e)n[e]=t,t>>>=8},C7=function(n,e){var t=e.level,i=t==0?0:t<6?1:t==9?3:2;if(n[0]=120,n[1]=i<<6|(e.dictionary&&32),n[1]|=31-(n[0]<<8|n[1])%31,e.dictionary){var c=s6();c.p(e.dictionary),a6(n,2,c.d())}};function g5(n,e){e||(e={});var t=s6();t.p(n);var i=I7(n,e,e.dictionary?6:2,4);return C7(i,e),a6(i,i.length-4,t.d()),i}var L7=typeof TextDecoder<"u"&&new TextDecoder,P7=0;try{L7.decode(o6,{stream:!0}),P7=1}catch{}function k7(n){if(Array.isArray(n))return n}function M7(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var i,c,u,m,_=[],o=!0,w=!1;try{if(u=(t=t.call(n)).next,e!==0)for(;!(o=(i=u.call(t)).done)&&(_.push(i.value),_.length!==e);o=!0);}catch(I){w=!0,c=I}finally{try{if(!o&&t.return!=null&&(m=t.return(),Object(m)!==m))return}finally{if(w)throw c}}return _}}function R2(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=Array(e);t<e;t++)i[t]=n[t];return i}function R7(n,e){if(n){if(typeof n=="string")return R2(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?R2(n,e):void 0}}function N7(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function N2(n,e){return k7(n)||M7(n,e)||R7(n,e)||N7()}function D2(n,e="utf8"){return new TextDecoder(e).decode(n)}const D7=new TextEncoder;function F7(n){return D7.encode(n)}const O7=1024*8,B7=(()=>{const n=new Uint8Array(4),e=new Uint32Array(n.buffer);return!((e[0]=1)&n[0])})(),hb={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class vw{buffer;byteLength;byteOffset;length;offset;lastWrittenByte;littleEndian;_data;_mark;_marks;constructor(e=O7,t={}){let i=!1;typeof e=="number"?e=new ArrayBuffer(e):(i=!0,this.lastWrittenByte=e.byteLength);const c=t.offset?t.offset>>>0:0,u=e.byteLength-c;let m=c;(ArrayBuffer.isView(e)||e instanceof vw)&&(e.byteLength!==e.buffer.byteLength&&(m=e.byteOffset+c),e=e.buffer),i?this.lastWrittenByte=u:this.lastWrittenByte=0,this.buffer=e,this.length=u,this.byteLength=u,this.byteOffset=m,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,m,u),this._mark=0,this._marks=[]}available(e=1){return this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e=1){return this.offset+=e,this}back(e=1){return this.offset-=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(e===void 0)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e=1){if(!this.available(e)){const i=(this.offset+e)*2,c=new Uint8Array(i);c.set(new Uint8Array(this.buffer)),this.buffer=c.buffer,this.length=i,this.byteLength=i,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e=1){return this.readArray(e,"uint8")}readArray(e,t){const i=hb[t].BYTES_PER_ELEMENT*e,c=this.byteOffset+this.offset,u=this.buffer.slice(c,c+i);if(this.littleEndian===B7&&t!=="uint8"&&t!=="int8"){const _=new Uint8Array(this.buffer.slice(c,c+i));_.reverse();const o=new hb[t](_.buffer);return this.offset+=i,o.reverse(),o}const m=new hb[t](u);return this.offset+=i,m}readInt16(){const e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){const e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){const e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){const e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){const e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){const e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readBigInt64(){const e=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,e}readBigUint64(){const e=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){let t="";for(let i=0;i<e;i++)t+=this.readChar();return t}readUtf8(e=1){return D2(this.readBytes(e))}decodeText(e=1,t="utf8"){return D2(this.readBytes(e),t)}writeBoolean(e){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(let t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(e){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(e){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(let t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this}writeUtf8(e){return this.writeBytes(F7(e))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function N0(n){let e=n.length;for(;--e>=0;)n[e]=0}const z7=3,j7=258,l6=29,U7=256,V7=U7+1+l6,c6=30,q7=512,$7=new Array((V7+2)*2);N0($7);const G7=new Array(c6*2);N0(G7);const H7=new Array(q7);N0(H7);const W7=new Array(j7-z7+1);N0(W7);const K7=new Array(l6);N0(K7);const X7=new Array(c6);N0(X7);const Z7=(n,e,t,i)=>{let c=n&65535|0,u=n>>>16&65535|0,m=0;for(;t!==0;){m=t>2e3?2e3:t,t-=m;do c=c+e[i++]|0,u=u+c|0;while(--m);c%=65521,u%=65521}return c|u<<16|0};var y5=Z7;const Y7=()=>{let n,e=[];for(var t=0;t<256;t++){n=t;for(var i=0;i<8;i++)n=n&1?3988292384^n>>>1:n>>>1;e[t]=n}return e},J7=new Uint32Array(Y7()),Q7=(n,e,t,i)=>{const c=J7,u=i+t;n^=-1;for(let m=i;m<u;m++)n=n>>>8^c[(n^e[m])&255];return n^-1};var Ef=Q7,_5={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},u6={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const ek=(n,e)=>Object.prototype.hasOwnProperty.call(n,e);var tk=function(n){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const t=e.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(const i in t)ek(t,i)&&(n[i]=t[i])}}return n},nk=n=>{let e=0;for(let i=0,c=n.length;i<c;i++)e+=n[i].length;const t=new Uint8Array(e);for(let i=0,c=0,u=n.length;i<u;i++){let m=n[i];t.set(m,c),c+=m.length}return t},h6={assign:tk,flattenChunks:nk};let d6=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{d6=!1}const r_=new Uint8Array(256);for(let n=0;n<256;n++)r_[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;r_[254]=r_[254]=1;var rk=n=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(n);let e,t,i,c,u,m=n.length,_=0;for(c=0;c<m;c++)t=n.charCodeAt(c),(t&64512)===55296&&c+1<m&&(i=n.charCodeAt(c+1),(i&64512)===56320&&(t=65536+(t-55296<<10)+(i-56320),c++)),_+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(_),u=0,c=0;u<_;c++)t=n.charCodeAt(c),(t&64512)===55296&&c+1<m&&(i=n.charCodeAt(c+1),(i&64512)===56320&&(t=65536+(t-55296<<10)+(i-56320),c++)),t<128?e[u++]=t:t<2048?(e[u++]=192|t>>>6,e[u++]=128|t&63):t<65536?(e[u++]=224|t>>>12,e[u++]=128|t>>>6&63,e[u++]=128|t&63):(e[u++]=240|t>>>18,e[u++]=128|t>>>12&63,e[u++]=128|t>>>6&63,e[u++]=128|t&63);return e};const ik=(n,e)=>{if(e<65534&&n.subarray&&d6)return String.fromCharCode.apply(null,n.length===e?n:n.subarray(0,e));let t="";for(let i=0;i<e;i++)t+=String.fromCharCode(n[i]);return t};var ok=(n,e)=>{const t=e||n.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(n.subarray(0,e));let i,c;const u=new Array(t*2);for(c=0,i=0;i<t;){let m=n[i++];if(m<128){u[c++]=m;continue}let _=r_[m];if(_>4){u[c++]=65533,i+=_-1;continue}for(m&=_===2?31:_===3?15:7;_>1&&i<t;)m=m<<6|n[i++]&63,_--;if(_>1){u[c++]=65533;continue}m<65536?u[c++]=m:(m-=65536,u[c++]=55296|m>>10&1023,u[c++]=56320|m&1023)}return ik(u,c)},sk=(n,e)=>{e=e||n.length,e>n.length&&(e=n.length);let t=e-1;for(;t>=0&&(n[t]&192)===128;)t--;return t<0||t===0?e:t+r_[n[t]]>e?t:e},v5={string2buf:rk,buf2string:ok,utf8border:sk};function ak(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var lk=ak;const u1=16209,ck=16191;var uk=function(e,t){let i,c,u,m,_,o,w,I,R,V,k,ie,ae,fe,J,ne,me,ue,ke,ze,pe,U,F,q;const j=e.state;i=e.next_in,F=e.input,c=i+(e.avail_in-5),u=e.next_out,q=e.output,m=u-(t-e.avail_out),_=u+(e.avail_out-257),o=j.dmax,w=j.wsize,I=j.whave,R=j.wnext,V=j.window,k=j.hold,ie=j.bits,ae=j.lencode,fe=j.distcode,J=(1<<j.lenbits)-1,ne=(1<<j.distbits)-1;e:do{ie<15&&(k+=F[i++]<<ie,ie+=8,k+=F[i++]<<ie,ie+=8),me=ae[k&J];t:for(;;){if(ue=me>>>24,k>>>=ue,ie-=ue,ue=me>>>16&255,ue===0)q[u++]=me&65535;else if(ue&16){ke=me&65535,ue&=15,ue&&(ie<ue&&(k+=F[i++]<<ie,ie+=8),ke+=k&(1<<ue)-1,k>>>=ue,ie-=ue),ie<15&&(k+=F[i++]<<ie,ie+=8,k+=F[i++]<<ie,ie+=8),me=fe[k&ne];n:for(;;){if(ue=me>>>24,k>>>=ue,ie-=ue,ue=me>>>16&255,ue&16){if(ze=me&65535,ue&=15,ie<ue&&(k+=F[i++]<<ie,ie+=8,ie<ue&&(k+=F[i++]<<ie,ie+=8)),ze+=k&(1<<ue)-1,ze>o){e.msg="invalid distance too far back",j.mode=u1;break e}if(k>>>=ue,ie-=ue,ue=u-m,ze>ue){if(ue=ze-ue,ue>I&&j.sane){e.msg="invalid distance too far back",j.mode=u1;break e}if(pe=0,U=V,R===0){if(pe+=w-ue,ue<ke){ke-=ue;do q[u++]=V[pe++];while(--ue);pe=u-ze,U=q}}else if(R<ue){if(pe+=w+R-ue,ue-=R,ue<ke){ke-=ue;do q[u++]=V[pe++];while(--ue);if(pe=0,R<ke){ue=R,ke-=ue;do q[u++]=V[pe++];while(--ue);pe=u-ze,U=q}}}else if(pe+=R-ue,ue<ke){ke-=ue;do q[u++]=V[pe++];while(--ue);pe=u-ze,U=q}for(;ke>2;)q[u++]=U[pe++],q[u++]=U[pe++],q[u++]=U[pe++],ke-=3;ke&&(q[u++]=U[pe++],ke>1&&(q[u++]=U[pe++]))}else{pe=u-ze;do q[u++]=q[pe++],q[u++]=q[pe++],q[u++]=q[pe++],ke-=3;while(ke>2);ke&&(q[u++]=q[pe++],ke>1&&(q[u++]=q[pe++]))}}else if((ue&64)===0){me=fe[(me&65535)+(k&(1<<ue)-1)];continue n}else{e.msg="invalid distance code",j.mode=u1;break e}break}}else if((ue&64)===0){me=ae[(me&65535)+(k&(1<<ue)-1)];continue t}else if(ue&32){j.mode=ck;break e}else{e.msg="invalid literal/length code",j.mode=u1;break e}break}}while(i<c&&u<_);ke=ie>>3,i-=ke,ie-=ke<<3,k&=(1<<ie)-1,e.next_in=i,e.next_out=u,e.avail_in=i<c?5+(c-i):5-(i-c),e.avail_out=u<_?257+(_-u):257-(u-_),j.hold=k,j.bits=ie};const qg=15,F2=852,O2=592,B2=0,db=1,z2=2,hk=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),dk=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),fk=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),pk=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),mk=(n,e,t,i,c,u,m,_)=>{const o=_.bits;let w=0,I=0,R=0,V=0,k=0,ie=0,ae=0,fe=0,J=0,ne=0,me,ue,ke,ze,pe,U=null,F;const q=new Uint16Array(qg+1),j=new Uint16Array(qg+1);let H=null,Z,be,Me;for(w=0;w<=qg;w++)q[w]=0;for(I=0;I<i;I++)q[e[t+I]]++;for(k=o,V=qg;V>=1&&q[V]===0;V--);if(k>V&&(k=V),V===0)return c[u++]=1<<24|64<<16|0,c[u++]=1<<24|64<<16|0,_.bits=1,0;for(R=1;R<V&&q[R]===0;R++);for(k<R&&(k=R),fe=1,w=1;w<=qg;w++)if(fe<<=1,fe-=q[w],fe<0)return-1;if(fe>0&&(n===B2||V!==1))return-1;for(j[1]=0,w=1;w<qg;w++)j[w+1]=j[w]+q[w];for(I=0;I<i;I++)e[t+I]!==0&&(m[j[e[t+I]]++]=I);if(n===B2?(U=H=m,F=20):n===db?(U=hk,H=dk,F=257):(U=fk,H=pk,F=0),ne=0,I=0,w=R,pe=u,ie=k,ae=0,ke=-1,J=1<<k,ze=J-1,n===db&&J>F2||n===z2&&J>O2)return 1;for(;;){Z=w-ae,m[I]+1<F?(be=0,Me=m[I]):m[I]>=F?(be=H[m[I]-F],Me=U[m[I]-F]):(be=96,Me=0),me=1<<w-ae,ue=1<<ie,R=ue;do ue-=me,c[pe+(ne>>ae)+ue]=Z<<24|be<<16|Me|0;while(ue!==0);for(me=1<<w-1;ne&me;)me>>=1;if(me!==0?(ne&=me-1,ne+=me):ne=0,I++,--q[w]===0){if(w===V)break;w=e[t+m[I]]}if(w>k&&(ne&ze)!==ke){for(ae===0&&(ae=k),pe+=R,ie=w-ae,fe=1<<ie;ie+ae<V&&(fe-=q[ie+ae],!(fe<=0));)ie++,fe<<=1;if(J+=1<<ie,n===db&&J>F2||n===z2&&J>O2)return 1;ke=ne&ze,c[ke]=k<<24|ie<<16|pe-u|0}}return ne!==0&&(c[pe+ne]=w-ae<<24|64<<16|0),_.bits=k,0};var Vy=mk;const gk=0,f6=1,p6=2,{Z_FINISH:j2,Z_BLOCK:yk,Z_TREES:h1,Z_OK:ng,Z_STREAM_END:_k,Z_NEED_DICT:vk,Z_STREAM_ERROR:Bd,Z_DATA_ERROR:m6,Z_MEM_ERROR:g6,Z_BUF_ERROR:xk,Z_DEFLATED:U2}=u6,Zv=16180,V2=16181,q2=16182,$2=16183,G2=16184,H2=16185,W2=16186,K2=16187,X2=16188,Z2=16189,dv=16190,hp=16191,fb=16192,Y2=16193,pb=16194,J2=16195,Q2=16196,eS=16197,tS=16198,d1=16199,f1=16200,nS=16201,rS=16202,iS=16203,oS=16204,sS=16205,mb=16206,aS=16207,lS=16208,Pl=16209,y6=16210,_6=16211,bk=852,wk=592,Sk=15,Ek=Sk,cS=n=>(n>>>24&255)+(n>>>8&65280)+((n&65280)<<8)+((n&255)<<24);function Ak(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const dg=n=>{if(!n)return 1;const e=n.state;return!e||e.strm!==n||e.mode<Zv||e.mode>_6?1:0},v6=n=>{if(dg(n))return Bd;const e=n.state;return n.total_in=n.total_out=e.total=0,n.msg="",e.wrap&&(n.adler=e.wrap&1),e.mode=Zv,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(bk),e.distcode=e.distdyn=new Int32Array(wk),e.sane=1,e.back=-1,ng},x6=n=>{if(dg(n))return Bd;const e=n.state;return e.wsize=0,e.whave=0,e.wnext=0,v6(n)},b6=(n,e)=>{let t;if(dg(n))return Bd;const i=n.state;return e<0?(t=0,e=-e):(t=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?Bd:(i.window!==null&&i.wbits!==e&&(i.window=null),i.wrap=t,i.wbits=e,x6(n))},w6=(n,e)=>{if(!n)return Bd;const t=new Ak;n.state=t,t.strm=n,t.window=null,t.mode=Zv;const i=b6(n,e);return i!==ng&&(n.state=null),i},Tk=n=>w6(n,Ek);let uS=!0,gb,yb;const Ik=n=>{if(uS){gb=new Int32Array(512),yb=new Int32Array(32);let e=0;for(;e<144;)n.lens[e++]=8;for(;e<256;)n.lens[e++]=9;for(;e<280;)n.lens[e++]=7;for(;e<288;)n.lens[e++]=8;for(Vy(f6,n.lens,0,288,gb,0,n.work,{bits:9}),e=0;e<32;)n.lens[e++]=5;Vy(p6,n.lens,0,32,yb,0,n.work,{bits:5}),uS=!1}n.lencode=gb,n.lenbits=9,n.distcode=yb,n.distbits=5},S6=(n,e,t,i)=>{let c;const u=n.state;return u.window===null&&(u.wsize=1<<u.wbits,u.wnext=0,u.whave=0,u.window=new Uint8Array(u.wsize)),i>=u.wsize?(u.window.set(e.subarray(t-u.wsize,t),0),u.wnext=0,u.whave=u.wsize):(c=u.wsize-u.wnext,c>i&&(c=i),u.window.set(e.subarray(t-i,t-i+c),u.wnext),i-=c,i?(u.window.set(e.subarray(t-i,t),0),u.wnext=i,u.whave=u.wsize):(u.wnext+=c,u.wnext===u.wsize&&(u.wnext=0),u.whave<u.wsize&&(u.whave+=c))),0},Ck=(n,e)=>{let t,i,c,u,m,_,o,w,I,R,V,k,ie,ae,fe=0,J,ne,me,ue,ke,ze,pe,U;const F=new Uint8Array(4);let q,j;const H=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(dg(n)||!n.output||!n.input&&n.avail_in!==0)return Bd;t=n.state,t.mode===hp&&(t.mode=fb),m=n.next_out,c=n.output,o=n.avail_out,u=n.next_in,i=n.input,_=n.avail_in,w=t.hold,I=t.bits,R=_,V=o,U=ng;e:for(;;)switch(t.mode){case Zv:if(t.wrap===0){t.mode=fb;break}for(;I<16;){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}if(t.wrap&2&&w===35615){t.wbits===0&&(t.wbits=15),t.check=0,F[0]=w&255,F[1]=w>>>8&255,t.check=Ef(t.check,F,2,0),w=0,I=0,t.mode=V2;break}if(t.head&&(t.head.done=!1),!(t.wrap&1)||(((w&255)<<8)+(w>>8))%31){n.msg="incorrect header check",t.mode=Pl;break}if((w&15)!==U2){n.msg="unknown compression method",t.mode=Pl;break}if(w>>>=4,I-=4,pe=(w&15)+8,t.wbits===0&&(t.wbits=pe),pe>15||pe>t.wbits){n.msg="invalid window size",t.mode=Pl;break}t.dmax=1<<t.wbits,t.flags=0,n.adler=t.check=1,t.mode=w&512?Z2:hp,w=0,I=0;break;case V2:for(;I<16;){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}if(t.flags=w,(t.flags&255)!==U2){n.msg="unknown compression method",t.mode=Pl;break}if(t.flags&57344){n.msg="unknown header flags set",t.mode=Pl;break}t.head&&(t.head.text=w>>8&1),t.flags&512&&t.wrap&4&&(F[0]=w&255,F[1]=w>>>8&255,t.check=Ef(t.check,F,2,0)),w=0,I=0,t.mode=q2;case q2:for(;I<32;){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}t.head&&(t.head.time=w),t.flags&512&&t.wrap&4&&(F[0]=w&255,F[1]=w>>>8&255,F[2]=w>>>16&255,F[3]=w>>>24&255,t.check=Ef(t.check,F,4,0)),w=0,I=0,t.mode=$2;case $2:for(;I<16;){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}t.head&&(t.head.xflags=w&255,t.head.os=w>>8),t.flags&512&&t.wrap&4&&(F[0]=w&255,F[1]=w>>>8&255,t.check=Ef(t.check,F,2,0)),w=0,I=0,t.mode=G2;case G2:if(t.flags&1024){for(;I<16;){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}t.length=w,t.head&&(t.head.extra_len=w),t.flags&512&&t.wrap&4&&(F[0]=w&255,F[1]=w>>>8&255,t.check=Ef(t.check,F,2,0)),w=0,I=0}else t.head&&(t.head.extra=null);t.mode=H2;case H2:if(t.flags&1024&&(k=t.length,k>_&&(k=_),k&&(t.head&&(pe=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(i.subarray(u,u+k),pe)),t.flags&512&&t.wrap&4&&(t.check=Ef(t.check,i,k,u)),_-=k,u+=k,t.length-=k),t.length))break e;t.length=0,t.mode=W2;case W2:if(t.flags&2048){if(_===0)break e;k=0;do pe=i[u+k++],t.head&&pe&&t.length<65536&&(t.head.name+=String.fromCharCode(pe));while(pe&&k<_);if(t.flags&512&&t.wrap&4&&(t.check=Ef(t.check,i,k,u)),_-=k,u+=k,pe)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=K2;case K2:if(t.flags&4096){if(_===0)break e;k=0;do pe=i[u+k++],t.head&&pe&&t.length<65536&&(t.head.comment+=String.fromCharCode(pe));while(pe&&k<_);if(t.flags&512&&t.wrap&4&&(t.check=Ef(t.check,i,k,u)),_-=k,u+=k,pe)break e}else t.head&&(t.head.comment=null);t.mode=X2;case X2:if(t.flags&512){for(;I<16;){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}if(t.wrap&4&&w!==(t.check&65535)){n.msg="header crc mismatch",t.mode=Pl;break}w=0,I=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),n.adler=t.check=0,t.mode=hp;break;case Z2:for(;I<32;){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}n.adler=t.check=cS(w),w=0,I=0,t.mode=dv;case dv:if(t.havedict===0)return n.next_out=m,n.avail_out=o,n.next_in=u,n.avail_in=_,t.hold=w,t.bits=I,vk;n.adler=t.check=1,t.mode=hp;case hp:if(e===yk||e===h1)break e;case fb:if(t.last){w>>>=I&7,I-=I&7,t.mode=mb;break}for(;I<3;){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}switch(t.last=w&1,w>>>=1,I-=1,w&3){case 0:t.mode=Y2;break;case 1:if(Ik(t),t.mode=d1,e===h1){w>>>=2,I-=2;break e}break;case 2:t.mode=Q2;break;case 3:n.msg="invalid block type",t.mode=Pl}w>>>=2,I-=2;break;case Y2:for(w>>>=I&7,I-=I&7;I<32;){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}if((w&65535)!==(w>>>16^65535)){n.msg="invalid stored block lengths",t.mode=Pl;break}if(t.length=w&65535,w=0,I=0,t.mode=pb,e===h1)break e;case pb:t.mode=J2;case J2:if(k=t.length,k){if(k>_&&(k=_),k>o&&(k=o),k===0)break e;c.set(i.subarray(u,u+k),m),_-=k,u+=k,o-=k,m+=k,t.length-=k;break}t.mode=hp;break;case Q2:for(;I<14;){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}if(t.nlen=(w&31)+257,w>>>=5,I-=5,t.ndist=(w&31)+1,w>>>=5,I-=5,t.ncode=(w&15)+4,w>>>=4,I-=4,t.nlen>286||t.ndist>30){n.msg="too many length or distance symbols",t.mode=Pl;break}t.have=0,t.mode=eS;case eS:for(;t.have<t.ncode;){for(;I<3;){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}t.lens[H[t.have++]]=w&7,w>>>=3,I-=3}for(;t.have<19;)t.lens[H[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,q={bits:t.lenbits},U=Vy(gk,t.lens,0,19,t.lencode,0,t.work,q),t.lenbits=q.bits,U){n.msg="invalid code lengths set",t.mode=Pl;break}t.have=0,t.mode=tS;case tS:for(;t.have<t.nlen+t.ndist;){for(;fe=t.lencode[w&(1<<t.lenbits)-1],J=fe>>>24,ne=fe>>>16&255,me=fe&65535,!(J<=I);){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}if(me<16)w>>>=J,I-=J,t.lens[t.have++]=me;else{if(me===16){for(j=J+2;I<j;){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}if(w>>>=J,I-=J,t.have===0){n.msg="invalid bit length repeat",t.mode=Pl;break}pe=t.lens[t.have-1],k=3+(w&3),w>>>=2,I-=2}else if(me===17){for(j=J+3;I<j;){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}w>>>=J,I-=J,pe=0,k=3+(w&7),w>>>=3,I-=3}else{for(j=J+7;I<j;){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}w>>>=J,I-=J,pe=0,k=11+(w&127),w>>>=7,I-=7}if(t.have+k>t.nlen+t.ndist){n.msg="invalid bit length repeat",t.mode=Pl;break}for(;k--;)t.lens[t.have++]=pe}}if(t.mode===Pl)break;if(t.lens[256]===0){n.msg="invalid code -- missing end-of-block",t.mode=Pl;break}if(t.lenbits=9,q={bits:t.lenbits},U=Vy(f6,t.lens,0,t.nlen,t.lencode,0,t.work,q),t.lenbits=q.bits,U){n.msg="invalid literal/lengths set",t.mode=Pl;break}if(t.distbits=6,t.distcode=t.distdyn,q={bits:t.distbits},U=Vy(p6,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,q),t.distbits=q.bits,U){n.msg="invalid distances set",t.mode=Pl;break}if(t.mode=d1,e===h1)break e;case d1:t.mode=f1;case f1:if(_>=6&&o>=258){n.next_out=m,n.avail_out=o,n.next_in=u,n.avail_in=_,t.hold=w,t.bits=I,uk(n,V),m=n.next_out,c=n.output,o=n.avail_out,u=n.next_in,i=n.input,_=n.avail_in,w=t.hold,I=t.bits,t.mode===hp&&(t.back=-1);break}for(t.back=0;fe=t.lencode[w&(1<<t.lenbits)-1],J=fe>>>24,ne=fe>>>16&255,me=fe&65535,!(J<=I);){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}if(ne&&(ne&240)===0){for(ue=J,ke=ne,ze=me;fe=t.lencode[ze+((w&(1<<ue+ke)-1)>>ue)],J=fe>>>24,ne=fe>>>16&255,me=fe&65535,!(ue+J<=I);){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}w>>>=ue,I-=ue,t.back+=ue}if(w>>>=J,I-=J,t.back+=J,t.length=me,ne===0){t.mode=sS;break}if(ne&32){t.back=-1,t.mode=hp;break}if(ne&64){n.msg="invalid literal/length code",t.mode=Pl;break}t.extra=ne&15,t.mode=nS;case nS:if(t.extra){for(j=t.extra;I<j;){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}t.length+=w&(1<<t.extra)-1,w>>>=t.extra,I-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=rS;case rS:for(;fe=t.distcode[w&(1<<t.distbits)-1],J=fe>>>24,ne=fe>>>16&255,me=fe&65535,!(J<=I);){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}if((ne&240)===0){for(ue=J,ke=ne,ze=me;fe=t.distcode[ze+((w&(1<<ue+ke)-1)>>ue)],J=fe>>>24,ne=fe>>>16&255,me=fe&65535,!(ue+J<=I);){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}w>>>=ue,I-=ue,t.back+=ue}if(w>>>=J,I-=J,t.back+=J,ne&64){n.msg="invalid distance code",t.mode=Pl;break}t.offset=me,t.extra=ne&15,t.mode=iS;case iS:if(t.extra){for(j=t.extra;I<j;){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}t.offset+=w&(1<<t.extra)-1,w>>>=t.extra,I-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){n.msg="invalid distance too far back",t.mode=Pl;break}t.mode=oS;case oS:if(o===0)break e;if(k=V-o,t.offset>k){if(k=t.offset-k,k>t.whave&&t.sane){n.msg="invalid distance too far back",t.mode=Pl;break}k>t.wnext?(k-=t.wnext,ie=t.wsize-k):ie=t.wnext-k,k>t.length&&(k=t.length),ae=t.window}else ae=c,ie=m-t.offset,k=t.length;k>o&&(k=o),o-=k,t.length-=k;do c[m++]=ae[ie++];while(--k);t.length===0&&(t.mode=f1);break;case sS:if(o===0)break e;c[m++]=t.length,o--,t.mode=f1;break;case mb:if(t.wrap){for(;I<32;){if(_===0)break e;_--,w|=i[u++]<<I,I+=8}if(V-=o,n.total_out+=V,t.total+=V,t.wrap&4&&V&&(n.adler=t.check=t.flags?Ef(t.check,c,V,m-V):y5(t.check,c,V,m-V)),V=o,t.wrap&4&&(t.flags?w:cS(w))!==t.check){n.msg="incorrect data check",t.mode=Pl;break}w=0,I=0}t.mode=aS;case aS:if(t.wrap&&t.flags){for(;I<32;){if(_===0)break e;_--,w+=i[u++]<<I,I+=8}if(t.wrap&4&&w!==(t.total&4294967295)){n.msg="incorrect length check",t.mode=Pl;break}w=0,I=0}t.mode=lS;case lS:U=_k;break e;case Pl:U=m6;break e;case y6:return g6;case _6:default:return Bd}return n.next_out=m,n.avail_out=o,n.next_in=u,n.avail_in=_,t.hold=w,t.bits=I,(t.wsize||V!==n.avail_out&&t.mode<Pl&&(t.mode<mb||e!==j2))&&S6(n,n.output,n.next_out,V-n.avail_out),R-=n.avail_in,V-=n.avail_out,n.total_in+=R,n.total_out+=V,t.total+=V,t.wrap&4&&V&&(n.adler=t.check=t.flags?Ef(t.check,c,V,n.next_out-V):y5(t.check,c,V,n.next_out-V)),n.data_type=t.bits+(t.last?64:0)+(t.mode===hp?128:0)+(t.mode===d1||t.mode===pb?256:0),(R===0&&V===0||e===j2)&&U===ng&&(U=xk),U},Lk=n=>{if(dg(n))return Bd;let e=n.state;return e.window&&(e.window=null),n.state=null,ng},Pk=(n,e)=>{if(dg(n))return Bd;const t=n.state;return(t.wrap&2)===0?Bd:(t.head=e,e.done=!1,ng)},kk=(n,e)=>{const t=e.length;let i,c,u;return dg(n)||(i=n.state,i.wrap!==0&&i.mode!==dv)?Bd:i.mode===dv&&(c=1,c=y5(c,e,t,0),c!==i.check)?m6:(u=S6(n,e,t,t),u?(i.mode=y6,g6):(i.havedict=1,ng))};var Mk=x6,Rk=b6,Nk=v6,Dk=Tk,Fk=w6,Ok=Ck,Bk=Lk,zk=Pk,jk=kk,Uk="pako inflate (from Nodeca project)",gp={inflateReset:Mk,inflateReset2:Rk,inflateResetKeep:Nk,inflateInit:Dk,inflateInit2:Fk,inflate:Ok,inflateEnd:Bk,inflateGetHeader:zk,inflateSetDictionary:jk,inflateInfo:Uk};function Vk(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var qk=Vk;const E6=Object.prototype.toString,{Z_NO_FLUSH:$k,Z_FINISH:Gk,Z_OK:i_,Z_STREAM_END:_b,Z_NEED_DICT:vb,Z_STREAM_ERROR:Hk,Z_DATA_ERROR:hS,Z_MEM_ERROR:Wk}=u6;function x_(n){this.options=h6.assign({chunkSize:1024*64,windowBits:15,to:""},n||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(n&&n.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15)===0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new lk,this.strm.avail_out=0;let t=gp.inflateInit2(this.strm,e.windowBits);if(t!==i_)throw new Error(_5[t]);if(this.header=new qk,gp.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=v5.string2buf(e.dictionary):E6.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=gp.inflateSetDictionary(this.strm,e.dictionary),t!==i_)))throw new Error(_5[t])}x_.prototype.push=function(n,e){const t=this.strm,i=this.options.chunkSize,c=this.options.dictionary;let u,m,_;if(this.ended)return!1;for(e===~~e?m=e:m=e===!0?Gk:$k,E6.call(n)==="[object ArrayBuffer]"?t.input=new Uint8Array(n):t.input=n,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(i),t.next_out=0,t.avail_out=i),u=gp.inflate(t,m),u===vb&&c&&(u=gp.inflateSetDictionary(t,c),u===i_?u=gp.inflate(t,m):u===hS&&(u=vb));t.avail_in>0&&u===_b&&t.state.wrap>0&&n[t.next_in]!==0;)gp.inflateReset(t),u=gp.inflate(t,m);switch(u){case Hk:case hS:case vb:case Wk:return this.onEnd(u),this.ended=!0,!1}if(_=t.avail_out,t.next_out&&(t.avail_out===0||u===_b))if(this.options.to==="string"){let o=v5.utf8border(t.output,t.next_out),w=t.next_out-o,I=v5.buf2string(t.output,o);t.next_out=w,t.avail_out=i-w,w&&t.output.set(t.output.subarray(o,o+w),0),this.onData(I)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(u===i_&&_===0)){if(u===_b)return u=gp.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};x_.prototype.onData=function(n){this.chunks.push(n)};x_.prototype.onEnd=function(n){n===i_&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=h6.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};function Kk(n,e){const t=new x_(e);if(t.push(n),t.err)throw t.msg||_5[t.err];return t.result}var Xk=x_,Zk=Kk,Yk={Inflate:Xk,inflate:Zk};const{Inflate:Jk,inflate:Qk}=Yk;var dS=Jk,eM=Qk;const A6=[];for(let n=0;n<256;n++){let e=n;for(let t=0;t<8;t++)e&1?e=3988292384^e>>>1:e=e>>>1;A6[n]=e}const fS=4294967295;function tM(n,e,t){let i=n;for(let c=0;c<t;c++)i=A6[(i^e[c])&255]^i>>>8;return i}function nM(n,e){return(tM(fS,n,e)^fS)>>>0}function pS(n,e,t){const i=n.readUint32(),c=nM(new Uint8Array(n.buffer,n.byteOffset+n.offset-e-4,e),e);if(c!==i)throw new Error(`CRC mismatch for chunk ${t}. Expected ${i}, found ${c}`)}function T6(n,e,t){for(let i=0;i<t;i++)e[i]=n[i]}function I6(n,e,t,i){let c=0;for(;c<i;c++)e[c]=n[c];for(;c<t;c++)e[c]=n[c]+e[c-i]&255}function C6(n,e,t,i){let c=0;if(t.length===0)for(;c<i;c++)e[c]=n[c];else for(;c<i;c++)e[c]=n[c]+t[c]&255}function L6(n,e,t,i,c){let u=0;if(t.length===0){for(;u<c;u++)e[u]=n[u];for(;u<i;u++)e[u]=n[u]+(e[u-c]>>1)&255}else{for(;u<c;u++)e[u]=n[u]+(t[u]>>1)&255;for(;u<i;u++)e[u]=n[u]+(e[u-c]+t[u]>>1)&255}}function P6(n,e,t,i,c){let u=0;if(t.length===0){for(;u<c;u++)e[u]=n[u];for(;u<i;u++)e[u]=n[u]+e[u-c]&255}else{for(;u<c;u++)e[u]=n[u]+t[u]&255;for(;u<i;u++)e[u]=n[u]+rM(e[u-c],t[u],t[u-c])&255}}function rM(n,e,t){const i=n+e-t,c=Math.abs(i-n),u=Math.abs(i-e),m=Math.abs(i-t);return c<=u&&c<=m?n:u<=m?e:t}function iM(n,e,t,i,c,u){switch(n){case 0:T6(e,t,c);break;case 1:I6(e,t,c,u);break;case 2:C6(e,t,i,c);break;case 3:L6(e,t,i,c,u);break;case 4:P6(e,t,i,c,u);break;default:throw new Error(`Unsupported filter: ${n}`)}}const oM=new Uint16Array([255]),sM=new Uint8Array(oM.buffer),aM=sM[0]===255;function lM(n){const{data:e,width:t,height:i,channels:c,depth:u}=n,m=[{x:0,y:0,xStep:8,yStep:8},{x:4,y:0,xStep:8,yStep:8},{x:0,y:4,xStep:4,yStep:8},{x:2,y:0,xStep:4,yStep:4},{x:0,y:2,xStep:2,yStep:4},{x:1,y:0,xStep:2,yStep:2},{x:0,y:1,xStep:1,yStep:2}],_=Math.ceil(u/8)*c,o=new Uint8Array(i*t*_);let w=0;for(let I=0;I<7;I++){const R=m[I],V=Math.ceil((t-R.x)/R.xStep),k=Math.ceil((i-R.y)/R.yStep);if(V<=0||k<=0)continue;const ie=V*_,ae=new Uint8Array(ie);for(let fe=0;fe<k;fe++){const J=e[w++],ne=e.subarray(w,w+ie);w+=ie;const me=new Uint8Array(ie);iM(J,ne,me,ae,ie,_),ae.set(me);for(let ue=0;ue<V;ue++){const ke=R.x+ue*R.xStep,ze=R.y+fe*R.yStep;if(!(ke>=t||ze>=i))for(let pe=0;pe<_;pe++)o[(ze*t+ke)*_+pe]=me[ue*_+pe]}}}if(u===16){const I=new Uint16Array(o.buffer);if(aM)for(let R=0;R<I.length;R++)I[R]=cM(I[R]);return I}else return o}function cM(n){return(n&255)<<8|n>>8&255}const uM=new Uint16Array([255]),hM=new Uint8Array(uM.buffer),dM=hM[0]===255,fM=new Uint8Array(0);function mS(n){const{data:e,width:t,height:i,channels:c,depth:u}=n,m=Math.ceil(u/8)*c,_=Math.ceil(u/8*c*t),o=new Uint8Array(i*_);let w=fM,I=0,R,V;for(let k=0;k<i;k++){switch(R=e.subarray(I+1,I+1+_),V=o.subarray(k*_,(k+1)*_),e[I]){case 0:T6(R,V,_);break;case 1:I6(R,V,_,m);break;case 2:C6(R,V,w,_);break;case 3:L6(R,V,w,_,m);break;case 4:P6(R,V,w,_,m);break;default:throw new Error(`Unsupported filter: ${e[I]}`)}w=V,I+=_+1}if(u===16){const k=new Uint16Array(o.buffer);if(dM)for(let ie=0;ie<k.length;ie++)k[ie]=pM(k[ie]);return k}else return o}function pM(n){return(n&255)<<8|n>>8&255}const B1=Uint8Array.of(137,80,78,71,13,10,26,10);function gS(n){if(!mM(n.readBytes(B1.length)))throw new Error("wrong PNG signature")}function mM(n){if(n.length<B1.length)return!1;for(let e=0;e<B1.length;e++)if(n[e]!==B1[e])return!1;return!0}const gM="tEXt",yM=0,k6=new TextDecoder("latin1");function _M(n){if(xM(n),n.length===0||n.length>79)throw new Error("keyword length must be between 1 and 79")}const vM=/^[\u0000-\u00FF]*$/;function xM(n){if(!vM.test(n))throw new Error("invalid latin1 text")}function bM(n,e,t){const i=M6(e);n[i]=wM(e,t-i.length-1)}function M6(n){for(n.mark();n.readByte()!==yM;);const e=n.offset;n.reset();const t=k6.decode(n.readBytes(e-n.offset-1));return n.skip(1),_M(t),t}function wM(n,e){return k6.decode(n.readBytes(e))}const ud={UNKNOWN:-1,GREYSCALE:0,TRUECOLOUR:2,INDEXED_COLOUR:3,GREYSCALE_ALPHA:4,TRUECOLOUR_ALPHA:6},xb={UNKNOWN:-1,DEFLATE:0},yS={UNKNOWN:-1,ADAPTIVE:0},bb={UNKNOWN:-1,NO_INTERLACE:0,ADAM7:1},p1={NONE:0,BACKGROUND:1,PREVIOUS:2},wb={SOURCE:0,OVER:1};class SM extends vw{_checkCrc;_inflator;_png;_apng;_end;_hasPalette;_palette;_hasTransparency;_transparency;_compressionMethod;_filterMethod;_interlaceMethod;_colorType;_isAnimated;_numberOfFrames;_numberOfPlays;_frames;_writingDataChunks;constructor(e,t={}){super(e);const{checkCrc:i=!1}=t;this._checkCrc=i,this._inflator=new dS,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._apng={width:-1,height:-1,channels:-1,depth:1,numberOfFrames:1,numberOfPlays:0,text:{},frames:[]},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=xb.UNKNOWN,this._filterMethod=yS.UNKNOWN,this._interlaceMethod=bb.UNKNOWN,this._colorType=ud.UNKNOWN,this._isAnimated=!1,this._numberOfFrames=1,this._numberOfPlays=0,this._frames=[],this._writingDataChunks=!1,this.setBigEndian()}decode(){for(gS(this);!this._end;){const e=this.readUint32(),t=this.readChars(4);this.decodeChunk(e,t)}return this.decodeImage(),this._png}decodeApng(){for(gS(this);!this._end;){const e=this.readUint32(),t=this.readChars(4);this.decodeApngChunk(e,t)}return this.decodeApngImage(),this._apng}decodeChunk(e,t){const i=this.offset;switch(t){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(e);break;case"IDAT":this.decodeIDAT(e);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(e);break;case"iCCP":this.decodeiCCP(e);break;case gM:bM(this._png.text,this,e);break;case"pHYs":this.decodepHYs();break;default:this.skip(e);break}if(this.offset-i!==e)throw new Error(`Length mismatch while decoding chunk ${t}`);this._checkCrc?pS(this,e+4,t):this.skip(4)}decodeApngChunk(e,t){const i=this.offset;switch(t!=="fdAT"&&t!=="IDAT"&&this._writingDataChunks&&this.pushDataToFrame(),t){case"acTL":this.decodeACTL();break;case"fcTL":this.decodeFCTL();break;case"fdAT":this.decodeFDAT(e);break;default:this.decodeChunk(e,t),this.offset=i+e;break}if(this.offset-i!==e)throw new Error(`Length mismatch while decoding chunk ${t}`);this._checkCrc?pS(this,e+4,t):this.skip(4)}decodeIHDR(){const e=this._png;e.width=this.readUint32(),e.height=this.readUint32(),e.depth=EM(this.readUint8());const t=this.readUint8();this._colorType=t;let i;switch(t){case ud.GREYSCALE:i=1;break;case ud.TRUECOLOUR:i=3;break;case ud.INDEXED_COLOUR:i=1;break;case ud.GREYSCALE_ALPHA:i=2;break;case ud.TRUECOLOUR_ALPHA:i=4;break;case ud.UNKNOWN:default:throw new Error(`Unknown color type: ${t}`)}if(this._png.channels=i,this._compressionMethod=this.readUint8(),this._compressionMethod!==xb.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodeACTL(){this._numberOfFrames=this.readUint32(),this._numberOfPlays=this.readUint32(),this._isAnimated=!0}decodeFCTL(){const e={sequenceNumber:this.readUint32(),width:this.readUint32(),height:this.readUint32(),xOffset:this.readUint32(),yOffset:this.readUint32(),delayNumber:this.readUint16(),delayDenominator:this.readUint16(),disposeOp:this.readUint8(),blendOp:this.readUint8(),data:new Uint8Array(0)};this._frames.push(e)}decodePLTE(e){if(e%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${e}`);const t=e/3;this._hasPalette=!0;const i=[];this._palette=i;for(let c=0;c<t;c++)i.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(e){this._writingDataChunks=!0;const t=e,i=this.offset+this.byteOffset;if(this._inflator.push(new Uint8Array(this.buffer,i,t)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(e)}decodeFDAT(e){this._writingDataChunks=!0;let t=e,i=this.offset+this.byteOffset;if(i+=4,t-=4,this._inflator.push(new Uint8Array(this.buffer,i,t)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(e)}decodetRNS(e){switch(this._colorType){case ud.GREYSCALE:case ud.TRUECOLOUR:{if(e%2!==0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${e}`);if(e/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${e/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(e/2);for(let t=0;t<e/2;t++)this._transparency[t]=this.readUint16();break}case ud.INDEXED_COLOUR:{if(e>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${e} vs ${this._palette.length})`);let t=0;for(;t<e;t++){const i=this.readByte();this._palette[t].push(i)}for(;t<this._palette.length;t++)this._palette[t].push(255);break}case ud.UNKNOWN:case ud.GREYSCALE_ALPHA:case ud.TRUECOLOUR_ALPHA:default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(e){const t=M6(this),i=this.readUint8();if(i!==xb.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${i}`);const c=this.readBytes(e-t.length-2);this._png.iccEmbeddedProfile={name:t,profile:eM(c)}}decodepHYs(){const e=this.readUint32(),t=this.readUint32(),i=this.readByte();this._png.resolution={x:e,y:t,unit:i}}decodeApngImage(){this._apng.width=this._png.width,this._apng.height=this._png.height,this._apng.channels=this._png.channels,this._apng.depth=this._png.depth,this._apng.numberOfFrames=this._numberOfFrames,this._apng.numberOfPlays=this._numberOfPlays,this._apng.text=this._png.text,this._apng.resolution=this._png.resolution;for(let e=0;e<this._numberOfFrames;e++){const t={sequenceNumber:this._frames[e].sequenceNumber,delayNumber:this._frames[e].delayNumber,delayDenominator:this._frames[e].delayDenominator,data:this._apng.depth===8?new Uint8Array(this._apng.width*this._apng.height*this._apng.channels):new Uint16Array(this._apng.width*this._apng.height*this._apng.channels)},i=this._frames.at(e);if(i){if(i.data=mS({data:i.data,width:i.width,height:i.height,channels:this._apng.channels,depth:this._apng.depth}),this._hasPalette&&(this._apng.palette=this._palette),this._hasTransparency&&(this._apng.transparency=this._transparency),e===0||i.xOffset===0&&i.yOffset===0&&i.width===this._png.width&&i.height===this._png.height)t.data=i.data;else{const c=this._apng.frames.at(e-1);this.disposeFrame(i,c,t),this.addFrameDataToCanvas(t,i)}this._apng.frames.push(t)}}return this._apng}disposeFrame(e,t,i){switch(e.disposeOp){case p1.NONE:break;case p1.BACKGROUND:for(let c=0;c<this._png.height;c++)for(let u=0;u<this._png.width;u++){const m=(c*e.width+u)*this._png.channels;for(let _=0;_<this._png.channels;_++)i.data[m+_]=0}break;case p1.PREVIOUS:i.data.set(t.data);break;default:throw new Error("Unknown disposeOp")}}addFrameDataToCanvas(e,t){const i=1<<this._png.depth,c=(u,m)=>{const _=((u+t.yOffset)*this._png.width+t.xOffset+m)*this._png.channels,o=(u*t.width+m)*this._png.channels;return{index:_,frameIndex:o}};switch(t.blendOp){case wb.SOURCE:for(let u=0;u<t.height;u++)for(let m=0;m<t.width;m++){const{index:_,frameIndex:o}=c(u,m);for(let w=0;w<this._png.channels;w++)e.data[_+w]=t.data[o+w]}break;case wb.OVER:for(let u=0;u<t.height;u++)for(let m=0;m<t.width;m++){const{index:_,frameIndex:o}=c(u,m);for(let w=0;w<this._png.channels;w++){const I=t.data[o+this._png.channels-1]/i,R=w%(this._png.channels-1)===0?1:t.data[o+w],V=Math.floor(I*R+(1-I)*e.data[_+w]);e.data[_+w]+=V}}break;default:throw new Error("Unknown blendOp")}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const e=this._isAnimated?(this._frames?.at(0)).data:this._inflator.result;if(this._filterMethod!==yS.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===bb.NO_INTERLACE)this._png.data=mS({data:e,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else if(this._interlaceMethod===bb.ADAM7)this._png.data=lM({data:e,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}pushDataToFrame(){const e=this._inflator.result,t=this._frames.at(-1);t?t.data=e:this._frames.push({sequenceNumber:0,width:this._png.width,height:this._png.height,xOffset:0,yOffset:0,delayNumber:0,delayDenominator:0,disposeOp:p1.NONE,blendOp:wb.SOURCE,data:e}),this._inflator=new dS,this._writingDataChunks=!1}}function EM(n){if(n!==1&&n!==2&&n!==4&&n!==8&&n!==16)throw new Error(`invalid bit depth: ${n}`);return n}var _S;(function(n){n[n.UNKNOWN=0]="UNKNOWN",n[n.METRE=1]="METRE"})(_S||(_S={}));function AM(n,e){return new SM(n,e).decode()}var so=(function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this})();function Sb(){so.console&&typeof so.console.log=="function"&&so.console.log.apply(so.console,arguments)}var Ka={log:Sb,warn:function(n){so.console&&(typeof so.console.warn=="function"?so.console.warn.apply(so.console,arguments):Sb.call(null,arguments))},error:function(n){so.console&&(typeof so.console.error=="function"?so.console.error.apply(so.console,arguments):Sb(n))}};function Eb(n,e,t){var i=new XMLHttpRequest;i.open("GET",n),i.responseType="blob",i.onload=function(){$m(i.response,e,t)},i.onerror=function(){Ka.error("could not download file")},i.send()}function vS(n){var e=new XMLHttpRequest;e.open("HEAD",n,!1);try{e.send()}catch{}return e.status>=200&&e.status<=299}function m1(n){try{n.dispatchEvent(new MouseEvent("click"))}catch{var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),n.dispatchEvent(e)}}var $m=so.saveAs||((typeof window>"u"?"undefined":wa(window))!=="object"||window!==so?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(n,e,t){var i=so.URL||so.webkitURL,c=document.createElement("a");e=e||n.name||"download",c.download=e,c.rel="noopener",typeof n=="string"?(c.href=n,c.origin!==location.origin?vS(c.href)?Eb(n,e,t):m1(c,c.target="_blank"):m1(c)):(c.href=i.createObjectURL(n),setTimeout(function(){i.revokeObjectURL(c.href)},4e4),setTimeout(function(){m1(c)},0))}:"msSaveOrOpenBlob"in navigator?function(n,e,t){if(e=e||n.name||"download",typeof n=="string")if(vS(n))Eb(n,e,t);else{var i=document.createElement("a");i.href=n,i.target="_blank",setTimeout(function(){m1(i)})}else navigator.msSaveOrOpenBlob((function(c,u){return u===void 0?u={autoBom:!1}:wa(u)!=="object"&&(Ka.warn("Deprecated: Expected third argument to be a object"),u={autoBom:!u}),u.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(c.type)?new Blob(["\uFEFF",c],{type:c.type}):c})(n,t),e)}:function(n,e,t,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),typeof n=="string")return Eb(n,e,t);var c=n.type==="application/octet-stream",u=/constructor/i.test(so.HTMLElement)||so.safari,m=/CriOS\/[\d]+/.test(navigator.userAgent);if((m||c&&u)&&(typeof FileReader>"u"?"undefined":wa(FileReader))==="object"){var _=new FileReader;_.onloadend=function(){var I=_.result;I=m?I:I.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=I:location=I,i=null},_.readAsDataURL(n)}else{var o=so.URL||so.webkitURL,w=o.createObjectURL(n);i?i.location=w:location.href=w,i=null,setTimeout(function(){o.revokeObjectURL(w)},4e4)}});/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
 * @license Use it if you like it
 */function R6(n){var e;n=n||"",this.ok=!1,n.charAt(0)=="#"&&(n=n.substr(1,6)),n={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[n=(n=n.replace(/ /g,"")).toLowerCase()]||n;for(var t=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(_){return[parseInt(_[1]),parseInt(_[2]),parseInt(_[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(_){return[parseInt(_[1],16),parseInt(_[2],16),parseInt(_[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(_){return[parseInt(_[1]+_[1],16),parseInt(_[2]+_[2],16),parseInt(_[3]+_[3],16)]}}],i=0;i<t.length;i++){var c=t[i].re,u=t[i].process,m=c.exec(n);m&&(e=u(m),this.r=e[0],this.g=e[1],this.b=e[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var _=this.r.toString(16),o=this.g.toString(16),w=this.b.toString(16);return _.length==1&&(_="0"+_),o.length==1&&(o="0"+o),w.length==1&&(w="0"+w),"#"+_+o+w}}var z1=so.atob.bind(so),xS=so.btoa.bind(so);/**
 * @license
 * Joseph Myers does not specify a particular license for his work.
 *
 * Author: Joseph Myers
 * Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
 *
 * Modified by: Owen Leong
 */function Ab(n,e){var t=n[0],i=n[1],c=n[2],u=n[3];t=ch(t,i,c,u,e[0],7,-680876936),u=ch(u,t,i,c,e[1],12,-389564586),c=ch(c,u,t,i,e[2],17,606105819),i=ch(i,c,u,t,e[3],22,-1044525330),t=ch(t,i,c,u,e[4],7,-176418897),u=ch(u,t,i,c,e[5],12,1200080426),c=ch(c,u,t,i,e[6],17,-1473231341),i=ch(i,c,u,t,e[7],22,-45705983),t=ch(t,i,c,u,e[8],7,1770035416),u=ch(u,t,i,c,e[9],12,-1958414417),c=ch(c,u,t,i,e[10],17,-42063),i=ch(i,c,u,t,e[11],22,-1990404162),t=ch(t,i,c,u,e[12],7,1804603682),u=ch(u,t,i,c,e[13],12,-40341101),c=ch(c,u,t,i,e[14],17,-1502002290),t=uh(t,i=ch(i,c,u,t,e[15],22,1236535329),c,u,e[1],5,-165796510),u=uh(u,t,i,c,e[6],9,-1069501632),c=uh(c,u,t,i,e[11],14,643717713),i=uh(i,c,u,t,e[0],20,-373897302),t=uh(t,i,c,u,e[5],5,-701558691),u=uh(u,t,i,c,e[10],9,38016083),c=uh(c,u,t,i,e[15],14,-660478335),i=uh(i,c,u,t,e[4],20,-405537848),t=uh(t,i,c,u,e[9],5,568446438),u=uh(u,t,i,c,e[14],9,-1019803690),c=uh(c,u,t,i,e[3],14,-187363961),i=uh(i,c,u,t,e[8],20,1163531501),t=uh(t,i,c,u,e[13],5,-1444681467),u=uh(u,t,i,c,e[2],9,-51403784),c=uh(c,u,t,i,e[7],14,1735328473),t=hh(t,i=uh(i,c,u,t,e[12],20,-1926607734),c,u,e[5],4,-378558),u=hh(u,t,i,c,e[8],11,-2022574463),c=hh(c,u,t,i,e[11],16,1839030562),i=hh(i,c,u,t,e[14],23,-35309556),t=hh(t,i,c,u,e[1],4,-1530992060),u=hh(u,t,i,c,e[4],11,1272893353),c=hh(c,u,t,i,e[7],16,-155497632),i=hh(i,c,u,t,e[10],23,-1094730640),t=hh(t,i,c,u,e[13],4,681279174),u=hh(u,t,i,c,e[0],11,-358537222),c=hh(c,u,t,i,e[3],16,-722521979),i=hh(i,c,u,t,e[6],23,76029189),t=hh(t,i,c,u,e[9],4,-640364487),u=hh(u,t,i,c,e[12],11,-421815835),c=hh(c,u,t,i,e[15],16,530742520),t=dh(t,i=hh(i,c,u,t,e[2],23,-995338651),c,u,e[0],6,-198630844),u=dh(u,t,i,c,e[7],10,1126891415),c=dh(c,u,t,i,e[14],15,-1416354905),i=dh(i,c,u,t,e[5],21,-57434055),t=dh(t,i,c,u,e[12],6,1700485571),u=dh(u,t,i,c,e[3],10,-1894986606),c=dh(c,u,t,i,e[10],15,-1051523),i=dh(i,c,u,t,e[1],21,-2054922799),t=dh(t,i,c,u,e[8],6,1873313359),u=dh(u,t,i,c,e[15],10,-30611744),c=dh(c,u,t,i,e[6],15,-1560198380),i=dh(i,c,u,t,e[13],21,1309151649),t=dh(t,i,c,u,e[4],6,-145523070),u=dh(u,t,i,c,e[11],10,-1120210379),c=dh(c,u,t,i,e[2],15,718787259),i=dh(i,c,u,t,e[9],21,-343485551),n[0]=im(t,n[0]),n[1]=im(i,n[1]),n[2]=im(c,n[2]),n[3]=im(u,n[3])}function Yv(n,e,t,i,c,u){return e=im(im(e,n),im(i,u)),im(e<<c|e>>>32-c,t)}function ch(n,e,t,i,c,u,m){return Yv(e&t|~e&i,n,e,c,u,m)}function uh(n,e,t,i,c,u,m){return Yv(e&i|t&~i,n,e,c,u,m)}function hh(n,e,t,i,c,u,m){return Yv(e^t^i,n,e,c,u,m)}function dh(n,e,t,i,c,u,m){return Yv(t^(e|~i),n,e,c,u,m)}function N6(n){var e,t=n.length,i=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=n.length;e+=64)Ab(i,TM(n.substring(e-64,e)));n=n.substring(e-64);var c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<n.length;e++)c[e>>2]|=n.charCodeAt(e)<<(e%4<<3);if(c[e>>2]|=128<<(e%4<<3),e>55)for(Ab(i,c),e=0;e<16;e++)c[e]=0;return c[14]=8*t,Ab(i,c),i}function TM(n){var e,t=[];for(e=0;e<64;e+=4)t[e>>2]=n.charCodeAt(e)+(n.charCodeAt(e+1)<<8)+(n.charCodeAt(e+2)<<16)+(n.charCodeAt(e+3)<<24);return t}var bS="0123456789abcdef".split("");function IM(n){for(var e="",t=0;t<4;t++)e+=bS[n>>8*t+4&15]+bS[n>>8*t&15];return e}function CM(n){return String.fromCharCode(255&n,(65280&n)>>8,(16711680&n)>>16,(4278190080&n)>>24)}function x5(n){return N6(n).map(CM).join("")}var LM=(function(n){for(var e=0;e<n.length;e++)n[e]=IM(n[e]);return n.join("")})(N6("hello"))!="5d41402abc4b2a76b9719d911017c592";function im(n,e){if(LM){var t=(65535&n)+(65535&e);return(n>>16)+(e>>16)+(t>>16)<<16|65535&t}return n+e&4294967295}/**
 * @license
 * FPDF is released under a permissive license: there is no usage restriction.
 * You may embed it freely in your application (commercial or not), with or
 * without modifications.
 *
 * Reference: http://www.fpdf.org/en/script/script37.php
 */function b5(n,e){var t,i,c,u;if(n!==t){for(var m=(c=n,u=1+(256/n.length|0),new Array(u+1).join(c)),_=[],o=0;o<256;o++)_[o]=o;var w=0;for(o=0;o<256;o++){var I=_[o];w=(w+I+m.charCodeAt(o))%256,_[o]=_[w],_[w]=I}t=n,i=_}else _=i;var R=e.length,V=0,k=0,ie="";for(o=0;o<R;o++)k=(k+(I=_[V=(V+1)%256]))%256,_[V]=_[k],_[k]=I,m=_[(_[V]+_[k])%256],ie+=String.fromCharCode(e.charCodeAt(o)^m);return ie}/**
 * @license
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 * Author: Owen Leong (@owenl131)
 * Date: 15 Oct 2020
 * References:
 * https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
 * https://github.com/foliojs/pdfkit/blob/master/lib/security.js
 * http://www.fpdf.org/en/script/script37.php
 */var wS={print:4,modify:8,copy:16,"annot-forms":32};function Jg(n,e,t,i){this.v=1,this.r=2;var c=192;n.forEach(function(_){if(wS.perm!==void 0)throw new Error("Invalid permission: "+_);c+=wS[_]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var u=(e+this.padding).substr(0,32),m=(t+this.padding).substr(0,32);this.O=this.processOwnerPassword(u,m),this.P=-(1+(255^c)),this.encryptionKey=x5(u+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(i)).substr(0,5),this.U=b5(this.encryptionKey,this.padding)}function Qg(n){if(/[^\u0000-\u00ff]/.test(n))throw new Error("Invalid PDF Name Object: "+n+", Only accept ASCII characters.");for(var e="",t=n.length,i=0;i<t;i++){var c=n.charCodeAt(i);e+=c<33||c===35||c===37||c===40||c===41||c===47||c===60||c===62||c===91||c===93||c===123||c===125||c>126?"#"+("0"+c.toString(16)).slice(-2):n[i]}return e}function SS(n){if(wa(n)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var e={};this.subscribe=function(t,i,c){if(c=c||!1,typeof t!="string"||typeof i!="function"||typeof c!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");e.hasOwnProperty(t)||(e[t]={});var u=Math.random().toString(35);return e[t][u]=[i,!!c],u},this.unsubscribe=function(t){for(var i in e)if(e[i][t])return delete e[i][t],Object.keys(e[i]).length===0&&delete e[i],!0;return!1},this.publish=function(t){if(e.hasOwnProperty(t)){var i=Array.prototype.slice.call(arguments,1),c=[];for(var u in e[t]){var m=e[t][u];try{m[0].apply(n,i)}catch(_){so.console&&Ka.error("jsPDF PubSub Error",_.message,_)}m[1]&&c.push(u)}c.length&&c.forEach(this.unsubscribe)}},this.getTopics=function(){return e}}function fv(n){if(!(this instanceof fv))return new fv(n);var e="opacity,stroke-opacity".split(",");for(var t in n)n.hasOwnProperty(t)&&e.indexOf(t)>=0&&(this[t]=n[t]);this.id="",this.objectNumber=-1}function D6(n,e){this.gState=n,this.matrix=e,this.id="",this.objectNumber=-1}function Km(n,e,t,i,c){if(!(this instanceof Km))return new Km(n,e,t,i,c);this.type=n==="axial"?2:3,this.coords=e,this.colors=t,D6.call(this,i,c)}function o0(n,e,t,i,c){if(!(this instanceof o0))return new o0(n,e,t,i,c);this.boundingBox=n,this.xStep=e,this.yStep=t,this.stream="",this.cloneIndex=0,D6.call(this,i,c)}function wi(n){var e,t=typeof arguments[0]=="string"?arguments[0]:"p",i=arguments[1],c=arguments[2],u=arguments[3],m=[],_=1,o=16,w="S",I=null;wa(n=n||{})==="object"&&(t=n.orientation,i=n.unit||i,c=n.format||c,u=n.compress||n.compressPdf||u,(I=n.encryption||null)!==null&&(I.userPassword=I.userPassword||"",I.ownerPassword=I.ownerPassword||"",I.userPermissions=I.userPermissions||[]),_=typeof n.userUnit=="number"?Math.abs(n.userUnit):1,n.precision!==void 0&&(e=n.precision),n.floatPrecision!==void 0&&(o=n.floatPrecision),w=n.defaultPathOperation||"S"),m=n.filters||(u===!0?["FlateEncode"]:m),i=i||"mm",t=(""+(t||"P")).toLowerCase();var R=n.putOnlyUsedFonts||!1,V={},k={internal:{},__private__:{}};k.__private__.PubSub=SS;var ie="1.3",ae=k.__private__.getPdfVersion=function(){return ie};k.__private__.setPdfVersion=function(W){ie=W};var fe={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};k.__private__.getPageFormats=function(){return fe};var J=k.__private__.getPageFormat=function(W){return fe[W]};c=c||"a4";var ne="compat",me="advanced",ue=ne;function ke(){this.saveGraphicsState(),st(new Lt(Er,0,0,-Er,0,Gs()*Er).toString()+" cm"),this.setFontSize(this.getFontSize()/Er),w="n",ue=me}function ze(){this.restoreGraphicsState(),w="S",ue=ne}var pe=k.__private__.combineFontStyleAndFontWeight=function(W,Ce){if(W=="bold"&&Ce=="normal"||W=="bold"&&Ce==400||W=="normal"&&Ce=="italic"||W=="bold"&&Ce=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return Ce&&(W=Ce==400||Ce==="normal"?W==="italic"?"italic":"normal":Ce!=700&&Ce!=="bold"||W!=="normal"?(Ce==700?"bold":Ce)+""+W:"bold"),W};k.advancedAPI=function(W){var Ce=ue===ne;return Ce&&ke.call(this),typeof W!="function"||(W(this),Ce&&ze.call(this)),this},k.compatAPI=function(W){var Ce=ue===me;return Ce&&ze.call(this),typeof W!="function"||(W(this),Ce&&ke.call(this)),this},k.isAdvancedAPI=function(){return ue===me};var U,F=function(W){if(ue!==me)throw new Error(W+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},q=k.roundToPrecision=k.__private__.roundToPrecision=function(W,Ce){var pt=e||Ce;if(isNaN(W)||isNaN(pt))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return W.toFixed(pt).replace(/0+$/,"")};U=k.hpf=k.__private__.hpf=typeof o=="number"?function(W){if(isNaN(W))throw new Error("Invalid argument passed to jsPDF.hpf");return q(W,o)}:o==="smart"?function(W){if(isNaN(W))throw new Error("Invalid argument passed to jsPDF.hpf");return q(W,W>-1&&W<1?16:5)}:function(W){if(isNaN(W))throw new Error("Invalid argument passed to jsPDF.hpf");return q(W,16)};var j=k.f2=k.__private__.f2=function(W){if(isNaN(W))throw new Error("Invalid argument passed to jsPDF.f2");return q(W,2)},H=k.__private__.f3=function(W){if(isNaN(W))throw new Error("Invalid argument passed to jsPDF.f3");return q(W,3)},Z=k.scale=k.__private__.scale=function(W){if(isNaN(W))throw new Error("Invalid argument passed to jsPDF.scale");return ue===ne?W*Er:ue===me?W:void 0},be=function(W){return Z((function(Ce){return ue===ne?Gs()-Ce:ue===me?Ce:void 0})(W))};k.__private__.setPrecision=k.setPrecision=function(W){typeof parseInt(W,10)=="number"&&(e=parseInt(W,10))};var Me,Be="00000000000000000000000000000000",Re=k.__private__.getFileId=function(){return Be},we=k.__private__.setFileId=function(W){return Be=W!==void 0&&/^[a-fA-F0-9]{32}$/.test(W)?W.toUpperCase():Be.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),I!==null&&(Fr=new Jg(I.userPermissions,I.userPassword,I.ownerPassword,Be)),Be};k.setFileId=function(W){return we(W),this},k.getFileId=function(){return Re()};var De=k.__private__.convertDateToPDFDate=function(W){var Ce=W.getTimezoneOffset(),pt=Ce<0?"+":"-",yt=Math.floor(Math.abs(Ce/60)),qt=Math.abs(Ce%60),Qt=[pt,Oe(yt),"'",Oe(qt),"'"].join("");return["D:",W.getFullYear(),Oe(W.getMonth()+1),Oe(W.getDate()),Oe(W.getHours()),Oe(W.getMinutes()),Oe(W.getSeconds()),Qt].join("")},nt=k.__private__.convertPDFDateToDate=function(W){var Ce=parseInt(W.substr(2,4),10),pt=parseInt(W.substr(6,2),10)-1,yt=parseInt(W.substr(8,2),10),qt=parseInt(W.substr(10,2),10),Qt=parseInt(W.substr(12,2),10),Fn=parseInt(W.substr(14,2),10);return new Date(Ce,pt,yt,qt,Qt,Fn,0)},xe=k.__private__.setCreationDate=function(W){var Ce;if(W===void 0&&(W=new Date),W instanceof Date)Ce=De(W);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(W))throw new Error("Invalid argument passed to jsPDF.setCreationDate");Ce=W}return Me=Ce},le=k.__private__.getCreationDate=function(W){var Ce=Me;return W==="jsDate"&&(Ce=nt(Me)),Ce};k.setCreationDate=function(W){return xe(W),this},k.getCreationDate=function(W){return le(W)};var Ne,Oe=k.__private__.padd2=function(W){return("0"+parseInt(W)).slice(-2)},Je=k.__private__.padd2Hex=function(W){return("00"+(W=W.toString())).substr(W.length)},rt=0,mt=[],dt=[],Dt=0,tn=[],ln=[],yn=!1,Mn=dt;k.__private__.setCustomOutputDestination=function(W){yn=!0,Mn=W};var Gt=function(W){yn||(Mn=W)};k.__private__.resetCustomOutputDestination=function(){yn=!1,Mn=dt};var st=k.__private__.out=function(W){return W=W.toString(),Dt+=W.length+1,Mn.push(W),Mn},fr=k.__private__.write=function(W){return st(arguments.length===1?W.toString():Array.prototype.join.call(arguments," "))},br=k.__private__.getArrayBuffer=function(W){for(var Ce=W.length,pt=new ArrayBuffer(Ce),yt=new Uint8Array(pt);Ce--;)yt[Ce]=W.charCodeAt(Ce);return pt},Tr=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];k.__private__.getStandardFonts=function(){return Tr};var Cn=n.fontSize||16;k.__private__.setFontSize=k.setFontSize=function(W){return Cn=ue===me?W/Er:W,this};var ir,Jn=k.__private__.getFontSize=k.getFontSize=function(){return ue===ne?Cn:Cn*Er},Hr=n.R2L||!1;k.__private__.setR2L=k.setR2L=function(W){return Hr=W,this},k.__private__.getR2L=k.getR2L=function(){return Hr};var Vt,Ln=k.__private__.setZoomMode=function(W){if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(W))ir=W;else if(isNaN(W)){if([void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(W)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+W+'" is not recognized.');ir=W}else ir=parseInt(W,10)};k.__private__.getZoomMode=function(){return ir};var $n,Dn=k.__private__.setPageMode=function(W){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(W)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+W+'" is not recognized.');Vt=W};k.__private__.getPageMode=function(){return Vt};var Mr=k.__private__.setLayoutMode=function(W){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(W)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+W+'" is not recognized.');$n=W};k.__private__.getLayoutMode=function(){return $n},k.__private__.setDisplayMode=k.setDisplayMode=function(W,Ce,pt){return Ln(W),Mr(Ce),Dn(pt),this};var xr={title:"",subject:"",author:"",keywords:"",creator:""};k.__private__.getDocumentProperty=function(W){if(Object.keys(xr).indexOf(W)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return xr[W]},k.__private__.getDocumentProperties=function(){return xr},k.__private__.setDocumentProperties=k.setProperties=k.setDocumentProperties=function(W){for(var Ce in xr)xr.hasOwnProperty(Ce)&&W[Ce]&&(xr[Ce]=W[Ce]);return this},k.__private__.setDocumentProperty=function(W,Ce){if(Object.keys(xr).indexOf(W)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return xr[W]=Ce};var Sr,Er,Cr,Si,Li,or={},ai={},qr=[],Dr={},hi={},li={},lt={},Ee=null,Te=0,et=[],ht=new SS(k),Ct=n.hotfixes||[],Rt={},Ot={},At=[],Lt=function W(Ce,pt,yt,qt,Qt,Fn){if(!(this instanceof W))return new W(Ce,pt,yt,qt,Qt,Fn);isNaN(Ce)&&(Ce=1),isNaN(pt)&&(pt=0),isNaN(yt)&&(yt=0),isNaN(qt)&&(qt=1),isNaN(Qt)&&(Qt=0),isNaN(Fn)&&(Fn=0),this._matrix=[Ce,pt,yt,qt,Qt,Fn]};Object.defineProperty(Lt.prototype,"sx",{get:function(){return this._matrix[0]},set:function(W){this._matrix[0]=W}}),Object.defineProperty(Lt.prototype,"shy",{get:function(){return this._matrix[1]},set:function(W){this._matrix[1]=W}}),Object.defineProperty(Lt.prototype,"shx",{get:function(){return this._matrix[2]},set:function(W){this._matrix[2]=W}}),Object.defineProperty(Lt.prototype,"sy",{get:function(){return this._matrix[3]},set:function(W){this._matrix[3]=W}}),Object.defineProperty(Lt.prototype,"tx",{get:function(){return this._matrix[4]},set:function(W){this._matrix[4]=W}}),Object.defineProperty(Lt.prototype,"ty",{get:function(){return this._matrix[5]},set:function(W){this._matrix[5]=W}}),Object.defineProperty(Lt.prototype,"a",{get:function(){return this._matrix[0]},set:function(W){this._matrix[0]=W}}),Object.defineProperty(Lt.prototype,"b",{get:function(){return this._matrix[1]},set:function(W){this._matrix[1]=W}}),Object.defineProperty(Lt.prototype,"c",{get:function(){return this._matrix[2]},set:function(W){this._matrix[2]=W}}),Object.defineProperty(Lt.prototype,"d",{get:function(){return this._matrix[3]},set:function(W){this._matrix[3]=W}}),Object.defineProperty(Lt.prototype,"e",{get:function(){return this._matrix[4]},set:function(W){this._matrix[4]=W}}),Object.defineProperty(Lt.prototype,"f",{get:function(){return this._matrix[5]},set:function(W){this._matrix[5]=W}}),Object.defineProperty(Lt.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(Lt.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(Lt.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(Lt.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),Lt.prototype.join=function(W){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(U).join(W)},Lt.prototype.multiply=function(W){var Ce=W.sx*this.sx+W.shy*this.shx,pt=W.sx*this.shy+W.shy*this.sy,yt=W.shx*this.sx+W.sy*this.shx,qt=W.shx*this.shy+W.sy*this.sy,Qt=W.tx*this.sx+W.ty*this.shx+this.tx,Fn=W.tx*this.shy+W.ty*this.sy+this.ty;return new Lt(Ce,pt,yt,qt,Qt,Fn)},Lt.prototype.decompose=function(){var W=this.sx,Ce=this.shy,pt=this.shx,yt=this.sy,qt=this.tx,Qt=this.ty,Fn=Math.sqrt(W*W+Ce*Ce),Nr=(W/=Fn)*pt+(Ce/=Fn)*yt;pt-=W*Nr,yt-=Ce*Nr;var $r=Math.sqrt(pt*pt+yt*yt);return Nr/=$r,W*(yt/=$r)<Ce*(pt/=$r)&&(W=-W,Ce=-Ce,Nr=-Nr,Fn=-Fn),{scale:new Lt(Fn,0,0,$r,0,0),translate:new Lt(1,0,0,1,qt,Qt),rotate:new Lt(W,Ce,-Ce,W,0,0),skew:new Lt(1,0,Nr,1,0,0)}},Lt.prototype.toString=function(W){return this.join(" ")},Lt.prototype.inversed=function(){var W=this.sx,Ce=this.shy,pt=this.shx,yt=this.sy,qt=this.tx,Qt=this.ty,Fn=1/(W*yt-Ce*pt),Nr=yt*Fn,$r=-Ce*Fn,yi=-pt*Fn,Ti=W*Fn;return new Lt(Nr,$r,yi,Ti,-Nr*qt-yi*Qt,-$r*qt-Ti*Qt)},Lt.prototype.applyToPoint=function(W){var Ce=W.x*this.sx+W.y*this.shx+this.tx,pt=W.x*this.shy+W.y*this.sy+this.ty;return new cl(Ce,pt)},Lt.prototype.applyToRectangle=function(W){var Ce=this.applyToPoint(W),pt=this.applyToPoint(new cl(W.x+W.w,W.y+W.h));return new tu(Ce.x,Ce.y,pt.x-Ce.x,pt.y-Ce.y)},Lt.prototype.clone=function(){var W=this.sx,Ce=this.shy,pt=this.shx,yt=this.sy,qt=this.tx,Qt=this.ty;return new Lt(W,Ce,pt,yt,qt,Qt)},k.Matrix=Lt;var xn=k.matrixMult=function(W,Ce){return Ce.multiply(W)},On=new Lt(1,0,0,1,0,0);k.unitMatrix=k.identityMatrix=On;var An=function(W,Ce){if(!hi[W]){var pt=(Ce instanceof Km?"Sh":"P")+(Object.keys(Dr).length+1).toString(10);Ce.id=pt,hi[W]=pt,Dr[pt]=Ce,ht.publish("addPattern",Ce)}};k.ShadingPattern=Km,k.TilingPattern=o0,k.addShadingPattern=function(W,Ce){return F("addShadingPattern()"),An(W,Ce),this},k.beginTilingPattern=function(W){F("beginTilingPattern()"),Vs(W.boundingBox[0],W.boundingBox[1],W.boundingBox[2]-W.boundingBox[0],W.boundingBox[3]-W.boundingBox[1],W.matrix)},k.endTilingPattern=function(W,Ce){F("endTilingPattern()"),Ce.stream=ln[Ne].join(`
`),An(W,Ce),ht.publish("endTilingPattern",Ce),At.pop().restore()};var Lr,Ir=k.__private__.newObject=function(){var W=zr();return wr(W,!0),W},zr=k.__private__.newObjectDeferred=function(){return rt++,mt[rt]=function(){return Dt},rt},wr=function(W,Ce){return Ce=typeof Ce=="boolean"&&Ce,mt[W]=Dt,Ce&&st(W+" 0 obj"),W},Ei=k.__private__.newAdditionalObject=function(){var W={objId:zr(),content:""};return tn.push(W),W},to=zr(),po=zr(),Wo=k.__private__.decodeColorString=function(W){var Ce=W.split(" ");if(Ce.length!==2||Ce[1]!=="g"&&Ce[1]!=="G")Ce.length!==5||Ce[4]!=="k"&&Ce[4]!=="K"||(Ce=[(1-Ce[0])*(1-Ce[3]),(1-Ce[1])*(1-Ce[3]),(1-Ce[2])*(1-Ce[3]),"r"]);else{var pt=parseFloat(Ce[0]);Ce=[pt,pt,pt,"r"]}for(var yt="#",qt=0;qt<3;qt++)yt+=("0"+Math.floor(255*parseFloat(Ce[qt])).toString(16)).slice(-2);return yt},no=k.__private__.encodeColorString=function(W){var Ce;typeof W=="string"&&(W={ch1:W});var pt=W.ch1,yt=W.ch2,qt=W.ch3,Qt=W.ch4,Fn=W.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof pt=="string"&&pt.charAt(0)!=="#"){var Nr=new R6(pt);if(Nr.ok)pt=Nr.toHex();else if(!/^\d*\.?\d*$/.test(pt))throw new Error('Invalid color "'+pt+'" passed to jsPDF.encodeColorString.')}if(typeof pt=="string"&&/^#[0-9A-Fa-f]{3}$/.test(pt)&&(pt="#"+pt[1]+pt[1]+pt[2]+pt[2]+pt[3]+pt[3]),typeof pt=="string"&&/^#[0-9A-Fa-f]{6}$/.test(pt)){var $r=parseInt(pt.substr(1),16);pt=$r>>16&255,yt=$r>>8&255,qt=255&$r}if(yt===void 0||Qt===void 0&&pt===yt&&yt===qt)Ce=typeof pt=="string"?pt+" "+Fn[0]:W.precision===2?j(pt/255)+" "+Fn[0]:H(pt/255)+" "+Fn[0];else if(Qt===void 0||wa(Qt)==="object"){if(Qt&&!isNaN(Qt.a)&&Qt.a===0)return["1.","1.","1.",Fn[1]].join(" ");Ce=typeof pt=="string"?[pt,yt,qt,Fn[1]].join(" "):W.precision===2?[j(pt/255),j(yt/255),j(qt/255),Fn[1]].join(" "):[H(pt/255),H(yt/255),H(qt/255),Fn[1]].join(" ")}else Ce=typeof pt=="string"?[pt,yt,qt,Qt,Fn[2]].join(" "):W.precision===2?[j(pt),j(yt),j(qt),j(Qt),Fn[2]].join(" "):[H(pt),H(yt),H(qt),H(Qt),Fn[2]].join(" ");return Ce},_s=k.__private__.getFilters=function(){return m},ro=k.__private__.putStream=function(W){var Ce=(W=W||{}).data||"",pt=W.filters||_s(),yt=W.alreadyAppliedFilters||[],qt=W.addLength1||!1,Qt=Ce.length,Fn=W.objectId,Nr=function(Vo){return Vo};if(I!==null&&Fn===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");I!==null&&(Nr=Fr.encryptor(Fn,0));var $r={};pt===!0&&(pt=["FlateEncode"]);var yi=W.additionalKeyValues||[],Ti=($r=wi.API.processDataByFilters!==void 0?wi.API.processDataByFilters(Ce,pt):{data:Ce,reverseChain:[]}).reverseChain+(Array.isArray(yt)?yt.join(" "):yt.toString());if($r.data.length!==0&&(yi.push({key:"Length",value:$r.data.length}),qt===!0&&yi.push({key:"Length1",value:Qt})),Ti.length!=0)if(Ti.split("/").length-1==1)yi.push({key:"Filter",value:Ti});else{yi.push({key:"Filter",value:"["+Ti+"]"});for(var yo=0;yo<yi.length;yo+=1)if(yi[yo].key==="DecodeParms"){for(var _o=[],Qo=0;Qo<$r.reverseChain.split("/").length-1;Qo+=1)_o.push("null");_o.push(yi[yo].value),yi[yo].value="["+_o.join(" ")+"]"}}st("<<");for(var Mo=0;Mo<yi.length;Mo++)st("/"+yi[Mo].key+" "+yi[Mo].value);st(">>"),$r.data.length!==0&&(st("stream"),st(Nr($r.data)),st("endstream"))},Ps=k.__private__.putPage=function(W){var Ce=W.number,pt=W.data,yt=W.objId,qt=W.contentsObjId;wr(yt,!0),st("<</Type /Page"),st("/Parent "+W.rootDictionaryObjId+" 0 R"),st("/Resources "+W.resourceDictionaryObjId+" 0 R"),st("/MediaBox ["+parseFloat(U(W.mediaBox.bottomLeftX))+" "+parseFloat(U(W.mediaBox.bottomLeftY))+" "+U(W.mediaBox.topRightX)+" "+U(W.mediaBox.topRightY)+"]"),W.cropBox!==null&&st("/CropBox ["+U(W.cropBox.bottomLeftX)+" "+U(W.cropBox.bottomLeftY)+" "+U(W.cropBox.topRightX)+" "+U(W.cropBox.topRightY)+"]"),W.bleedBox!==null&&st("/BleedBox ["+U(W.bleedBox.bottomLeftX)+" "+U(W.bleedBox.bottomLeftY)+" "+U(W.bleedBox.topRightX)+" "+U(W.bleedBox.topRightY)+"]"),W.trimBox!==null&&st("/TrimBox ["+U(W.trimBox.bottomLeftX)+" "+U(W.trimBox.bottomLeftY)+" "+U(W.trimBox.topRightX)+" "+U(W.trimBox.topRightY)+"]"),W.artBox!==null&&st("/ArtBox ["+U(W.artBox.bottomLeftX)+" "+U(W.artBox.bottomLeftY)+" "+U(W.artBox.topRightX)+" "+U(W.artBox.topRightY)+"]"),typeof W.userUnit=="number"&&W.userUnit!==1&&st("/UserUnit "+W.userUnit),ht.publish("putPage",{objId:yt,pageContext:et[Ce],pageNumber:Ce,page:pt}),st("/Contents "+qt+" 0 R"),st(">>"),st("endobj");var Qt=pt.join(`
`);return ue===me&&(Qt+=`
Q`),wr(qt,!0),ro({data:Qt,filters:_s(),objectId:qt}),st("endobj"),yt},fa=k.__private__.putPages=function(){var W,Ce,pt=[];for(W=1;W<=Te;W++)et[W].objId=zr(),et[W].contentsObjId=zr();for(W=1;W<=Te;W++)pt.push(Ps({number:W,data:ln[W],objId:et[W].objId,contentsObjId:et[W].contentsObjId,mediaBox:et[W].mediaBox,cropBox:et[W].cropBox,bleedBox:et[W].bleedBox,trimBox:et[W].trimBox,artBox:et[W].artBox,userUnit:et[W].userUnit,rootDictionaryObjId:to,resourceDictionaryObjId:po}));wr(to,!0),st("<</Type /Pages");var yt="/Kids [";for(Ce=0;Ce<Te;Ce++)yt+=pt[Ce]+" 0 R ";st(yt+"]"),st("/Count "+Te),st(">>"),st("endobj"),ht.publish("postPutPages")},Sl=function(W){ht.publish("putFont",{font:W,out:st,newObject:Ir,putStream:ro}),W.isAlreadyPutted!==!0&&(W.objectNumber=Ir(),st("<<"),st("/Type /Font"),st("/BaseFont /"+Qg(W.postScriptName)),st("/Subtype /Type1"),typeof W.encoding=="string"&&st("/Encoding /"+W.encoding),st("/FirstChar 32"),st("/LastChar 255"),st(">>"),st("endobj"))},al=function(W){W.objectNumber=Ir();var Ce=[];Ce.push({key:"Type",value:"/XObject"}),Ce.push({key:"Subtype",value:"/Form"}),Ce.push({key:"BBox",value:"["+[U(W.x),U(W.y),U(W.x+W.width),U(W.y+W.height)].join(" ")+"]"}),Ce.push({key:"Matrix",value:"["+W.matrix.toString()+"]"});var pt=W.pages[1].join(`
`);ro({data:pt,additionalKeyValues:Ce,objectId:W.objectNumber}),st("endobj")},Vi=function(W,Ce){Ce||(Ce=21);var pt=Ir(),yt=(function(Fn,Nr){var $r,yi=[],Ti=1/(Nr-1);for($r=0;$r<1;$r+=Ti)yi.push($r);if(yi.push(1),Fn[0].offset!=0){var yo={offset:0,color:Fn[0].color};Fn.unshift(yo)}if(Fn[Fn.length-1].offset!=1){var _o={offset:1,color:Fn[Fn.length-1].color};Fn.push(_o)}for(var Qo="",Mo=0,Vo=0;Vo<yi.length;Vo++){for($r=yi[Vo];$r>Fn[Mo+1].offset;)Mo++;var es=Fn[Mo].offset,cs=($r-es)/(Fn[Mo+1].offset-es),qo=Fn[Mo].color,Es=Fn[Mo+1].color;Qo+=Je(Math.round((1-cs)*qo[0]+cs*Es[0]).toString(16))+Je(Math.round((1-cs)*qo[1]+cs*Es[1]).toString(16))+Je(Math.round((1-cs)*qo[2]+cs*Es[2]).toString(16))}return Qo.trim()})(W.colors,Ce),qt=[];qt.push({key:"FunctionType",value:"0"}),qt.push({key:"Domain",value:"[0.0 1.0]"}),qt.push({key:"Size",value:"["+Ce+"]"}),qt.push({key:"BitsPerSample",value:"8"}),qt.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),qt.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),ro({data:yt,additionalKeyValues:qt,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:pt}),st("endobj"),W.objectNumber=Ir(),st("<< /ShadingType "+W.type),st("/ColorSpace /DeviceRGB");var Qt="/Coords ["+U(parseFloat(W.coords[0]))+" "+U(parseFloat(W.coords[1]))+" ";W.type===2?Qt+=U(parseFloat(W.coords[2]))+" "+U(parseFloat(W.coords[3])):Qt+=U(parseFloat(W.coords[2]))+" "+U(parseFloat(W.coords[3]))+" "+U(parseFloat(W.coords[4]))+" "+U(parseFloat(W.coords[5])),st(Qt+="]"),W.matrix&&st("/Matrix ["+W.matrix.toString()+"]"),st("/Function "+pt+" 0 R"),st("/Extend [true true]"),st(">>"),st("endobj")},Ql=function(W,Ce){var pt=zr(),yt=Ir();Ce.push({resourcesOid:pt,objectOid:yt}),W.objectNumber=yt;var qt=[];qt.push({key:"Type",value:"/Pattern"}),qt.push({key:"PatternType",value:"1"}),qt.push({key:"PaintType",value:"1"}),qt.push({key:"TilingType",value:"1"}),qt.push({key:"BBox",value:"["+W.boundingBox.map(U).join(" ")+"]"}),qt.push({key:"XStep",value:U(W.xStep)}),qt.push({key:"YStep",value:U(W.yStep)}),qt.push({key:"Resources",value:pt+" 0 R"}),W.matrix&&qt.push({key:"Matrix",value:"["+W.matrix.toString()+"]"}),ro({data:W.stream,additionalKeyValues:qt,objectId:W.objectNumber}),st("endobj")},Pu=function(W){for(var Ce in W.objectNumber=Ir(),st("<<"),W)switch(Ce){case"opacity":st("/ca "+j(W[Ce]));break;case"stroke-opacity":st("/CA "+j(W[Ce]))}st(">>"),st("endobj")},So=function(W){wr(W.resourcesOid,!0),st("<<"),st("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),(function(){for(var Ce in st("/Font <<"),or)or.hasOwnProperty(Ce)&&(R===!1||R===!0&&V.hasOwnProperty(Ce))&&st("/"+Ce+" "+or[Ce].objectNumber+" 0 R");st(">>")})(),(function(){if(Object.keys(Dr).length>0){for(var Ce in st("/Shading <<"),Dr)Dr.hasOwnProperty(Ce)&&Dr[Ce]instanceof Km&&Dr[Ce].objectNumber>=0&&st("/"+Ce+" "+Dr[Ce].objectNumber+" 0 R");ht.publish("putShadingPatternDict"),st(">>")}})(),(function(Ce){if(Object.keys(Dr).length>0){for(var pt in st("/Pattern <<"),Dr)Dr.hasOwnProperty(pt)&&Dr[pt]instanceof k.TilingPattern&&Dr[pt].objectNumber>=0&&Dr[pt].objectNumber<Ce&&st("/"+pt+" "+Dr[pt].objectNumber+" 0 R");ht.publish("putTilingPatternDict"),st(">>")}})(W.objectOid),(function(){if(Object.keys(li).length>0){var Ce;for(Ce in st("/ExtGState <<"),li)li.hasOwnProperty(Ce)&&li[Ce].objectNumber>=0&&st("/"+Ce+" "+li[Ce].objectNumber+" 0 R");ht.publish("putGStateDict"),st(">>")}})(),(function(){for(var Ce in st("/XObject <<"),Rt)Rt.hasOwnProperty(Ce)&&Rt[Ce].objectNumber>=0&&st("/"+Ce+" "+Rt[Ce].objectNumber+" 0 R");ht.publish("putXobjectDict"),st(">>")})(),st(">>"),st("endobj")},mu=function(W){ai[W.fontName]=ai[W.fontName]||{},ai[W.fontName][W.fontStyle]=W.id},Ea=function(W,Ce,pt,yt,qt){var Qt={id:"F"+(Object.keys(or).length+1).toString(10),postScriptName:W,fontName:Ce,fontStyle:pt,encoding:yt,isStandardFont:qt||!1,metadata:{}};return ht.publish("addFont",{font:Qt,instance:this}),or[Qt.id]=Qt,mu(Qt),Qt.id},Zo=k.__private__.pdfEscape=k.pdfEscape=function(W,Ce){return(function(pt,yt){var qt,Qt,Fn,Nr,$r,yi,Ti,yo,_o;if(Fn=(yt=yt||{}).sourceEncoding||"Unicode",$r=yt.outputEncoding,(yt.autoencode||$r)&&or[Sr].metadata&&or[Sr].metadata[Fn]&&or[Sr].metadata[Fn].encoding&&(Nr=or[Sr].metadata[Fn].encoding,!$r&&or[Sr].encoding&&($r=or[Sr].encoding),!$r&&Nr.codePages&&($r=Nr.codePages[0]),typeof $r=="string"&&($r=Nr[$r]),$r)){for(Ti=!1,yi=[],qt=0,Qt=pt.length;qt<Qt;qt++)(yo=$r[pt.charCodeAt(qt)])?yi.push(String.fromCharCode(yo)):yi.push(pt[qt]),yi[qt].charCodeAt(0)>>8&&(Ti=!0);pt=yi.join("")}for(qt=pt.length;Ti===void 0&&qt!==0;)pt.charCodeAt(qt-1)>>8&&(Ti=!0),qt--;if(!Ti)return pt;for(yi=yt.noBOM?[]:[254,255],qt=0,Qt=pt.length;qt<Qt;qt++){if((_o=(yo=pt.charCodeAt(qt))>>8)>>8)throw new Error("Character at position "+qt+" of string '"+pt+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");yi.push(_o),yi.push(yo-(_o<<8))}return String.fromCharCode.apply(void 0,yi)})(W,Ce).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Xa=k.__private__.beginPage=function(W){ln[++Te]=[],et[Te]={objId:0,contentsObjId:0,userUnit:Number(_),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(W[0]),topRightY:Number(W[1])}},Aa(Te),Gt(ln[Ne])},kl=function(W,Ce){var pt,yt,qt;switch(t=Ce||t,typeof W=="string"&&(pt=J(W.toLowerCase()),Array.isArray(pt)&&(yt=pt[0],qt=pt[1])),Array.isArray(W)&&(yt=W[0]*Er,qt=W[1]*Er),isNaN(yt)&&(yt=c[0],qt=c[1]),(yt>14400||qt>14400)&&(Ka.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),yt=Math.min(14400,yt),qt=Math.min(14400,qt)),c=[yt,qt],t.substr(0,1)){case"l":qt>yt&&(c=[qt,yt]);break;case"p":yt>qt&&(c=[qt,yt])}Xa(c),Jo(Fa),st(go),Xo!==0&&st(Xo+" J"),pa!==0&&st(pa+" j"),ht.publish("addPage",{pageNumber:Te})},ec=function(W){W>0&&W<=Te&&(ln.splice(W,1),et.splice(W,1),Te--,Ne>Te&&(Ne=Te),this.setPage(Ne))},Aa=function(W){W>0&&W<=Te&&(Ne=W)},ra=k.__private__.getNumberOfPages=k.getNumberOfPages=function(){return ln.length-1},pn=function(W,Ce,pt){var yt,qt=void 0;return pt=pt||{},W=W!==void 0?W:or[Sr].fontName,Ce=Ce!==void 0?Ce:or[Sr].fontStyle,yt=W.toLowerCase(),ai[yt]!==void 0&&ai[yt][Ce]!==void 0?qt=ai[yt][Ce]:ai[W]!==void 0&&ai[W][Ce]!==void 0?qt=ai[W][Ce]:pt.disableWarning===!1&&Ka.warn("Unable to look up font label for font '"+W+"', '"+Ce+"'. Refer to getFontList() for available fonts."),qt||pt.noFallback||(qt=ai.times[Ce])==null&&(qt=ai.times.normal),qt},Yo=k.__private__.putInfo=function(){var W=Ir(),Ce=function(yt){return yt};for(var pt in I!==null&&(Ce=Fr.encryptor(W,0)),st("<<"),st("/Producer ("+Zo(Ce("jsPDF "+wi.version))+")"),xr)xr.hasOwnProperty(pt)&&xr[pt]&&st("/"+pt.substr(0,1).toUpperCase()+pt.substr(1)+" ("+Zo(Ce(xr[pt]))+")");st("/CreationDate ("+Zo(Ce(Me))+")"),st(">>"),st("endobj")},ss=k.__private__.putCatalog=function(W){var Ce=(W=W||{}).rootDictionaryObjId||to;switch(Ir(),st("<<"),st("/Type /Catalog"),st("/Pages "+Ce+" 0 R"),ir||(ir="fullwidth"),ir){case"fullwidth":st("/OpenAction [3 0 R /FitH null]");break;case"fullheight":st("/OpenAction [3 0 R /FitV null]");break;case"fullpage":st("/OpenAction [3 0 R /Fit]");break;case"original":st("/OpenAction [3 0 R /XYZ null null 1]");break;default:var pt=""+ir;pt.substr(pt.length-1)==="%"&&(ir=parseInt(ir)/100),typeof ir=="number"&&st("/OpenAction [3 0 R /XYZ null null "+j(ir)+"]")}switch($n||($n="continuous"),$n){case"continuous":st("/PageLayout /OneColumn");break;case"single":st("/PageLayout /SinglePage");break;case"two":case"twoleft":st("/PageLayout /TwoColumnLeft");break;case"tworight":st("/PageLayout /TwoColumnRight")}Vt&&st("/PageMode /"+Vt),ht.publish("putCatalog"),st(">>"),st("endobj")},vi=k.__private__.putTrailer=function(){st("trailer"),st("<<"),st("/Size "+(rt+1)),st("/Root "+rt+" 0 R"),st("/Info "+(rt-1)+" 0 R"),I!==null&&st("/Encrypt "+Fr.oid+" 0 R"),st("/ID [ <"+Be+"> <"+Be+"> ]"),st(">>")},gu=k.__private__.putHeader=function(){st("%PDF-"+ie),st("%")},Za=k.__private__.putXRef=function(){var W="0000000000";st("xref"),st("0 "+(rt+1)),st("0000000000 65535 f ");for(var Ce=1;Ce<=rt;Ce++)typeof mt[Ce]=="function"?st((W+mt[Ce]()).slice(-10)+" 00000 n "):mt[Ce]!==void 0?st((W+mt[Ce]).slice(-10)+" 00000 n "):st("0000000000 00000 n ")},Ya=k.__private__.buildDocument=function(){var W;rt=0,Dt=0,dt=[],mt=[],tn=[],to=zr(),po=zr(),Gt(dt),ht.publish("buildDocument"),gu(),fa(),(function(){ht.publish("putAdditionalObjects");for(var pt=0;pt<tn.length;pt++){var yt=tn[pt];wr(yt.objId,!0),st(yt.content),st("endobj")}ht.publish("postPutAdditionalObjects")})(),W=[],(function(){for(var pt in or)or.hasOwnProperty(pt)&&(R===!1||R===!0&&V.hasOwnProperty(pt))&&Sl(or[pt])})(),(function(){var pt;for(pt in li)li.hasOwnProperty(pt)&&Pu(li[pt])})(),(function(){for(var pt in Rt)Rt.hasOwnProperty(pt)&&al(Rt[pt])})(),(function(pt){var yt;for(yt in Dr)Dr.hasOwnProperty(yt)&&(Dr[yt]instanceof Km?Vi(Dr[yt]):Dr[yt]instanceof o0&&Ql(Dr[yt],pt))})(W),ht.publish("putResources"),W.forEach(So),So({resourcesOid:po,objectOid:Number.MAX_SAFE_INTEGER}),ht.publish("postPutResources"),I!==null&&(Fr.oid=Ir(),st("<<"),st("/Filter /Standard"),st("/V "+Fr.v),st("/R "+Fr.r),st("/U <"+Fr.toHexString(Fr.U)+">"),st("/O <"+Fr.toHexString(Fr.O)+">"),st("/P "+Fr.P),st(">>"),st("endobj")),Yo(),ss();var Ce=Dt;return Za(),vi(),st("startxref"),st(""+Ce),st("%%EOF"),Gt(ln[Ne]),dt.join(`
`)},ll=k.__private__.getBlob=function(W){return new Blob([br(W)],{type:"application/pdf"})},ks=k.output=k.__private__.output=(Lr=function(W,Ce){switch(typeof(Ce=Ce||{})=="string"?Ce={filename:Ce}:Ce.filename=Ce.filename||"generated.pdf",W){case void 0:return Ya();case"save":k.save(Ce.filename);break;case"arraybuffer":return br(Ya());case"blob":return ll(Ya());case"bloburi":case"bloburl":if(so.URL!==void 0&&typeof so.URL.createObjectURL=="function")return so.URL&&so.URL.createObjectURL(ll(Ya()))||void 0;Ka.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var pt="",yt=Ya();try{pt=xS(yt)}catch{pt=xS(unescape(encodeURIComponent(yt)))}return"data:application/pdf;filename="+Ce.filename+";base64,"+pt;case"pdfobjectnewwindow":if(Object.prototype.toString.call(so)==="[object Window]"){var qt="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",Qt=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';Ce.pdfObjectUrl&&(qt=Ce.pdfObjectUrl,Qt="");var Fn='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+qt+'"'+Qt+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(Ce)+");<\/script></body></html>",Nr=so.open();return Nr!==null&&Nr.document.write(Fn),Nr}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(so)==="[object Window]"){var $r='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(Ce.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+Ce.filename+'" width="500px" height="400px" /></body></html>',yi=so.open();if(yi!==null){yi.document.write($r);var Ti=this;yi.document.documentElement.querySelector("#pdfViewer").onload=function(){yi.document.title=Ce.filename,yi.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(Ti.output("bloburl"))}}return yi}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(so)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var yo='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",Ce)+'"></iframe></body></html>',_o=so.open();if(_o!==null&&(_o.document.write(yo),_o.document.title=Ce.filename),_o||typeof safari>"u")return _o;break;case"datauri":case"dataurl":return so.document.location.href=this.output("datauristring",Ce);default:return null}},Lr.foo=function(){try{return Lr.apply(this,arguments)}catch(pt){var W=pt.stack||"";~W.indexOf(" at ")&&(W=W.split(" at ")[1]);var Ce="Error in function "+W.split(`
`)[0].split("<")[0]+": "+pt.message;if(!so.console)throw new Error(Ce);so.console.error(Ce,pt),so.alert&&alert(Ce)}},Lr.foo.bar=Lr,Lr.foo),er=function(W){return Array.isArray(Ct)===!0&&Ct.indexOf(W)>-1};switch(i){case"pt":Er=1;break;case"mm":Er=72/25.4;break;case"cm":Er=72/2.54;break;case"in":Er=72;break;case"px":Er=er("px_scaling")==1?.75:96/72;break;case"pc":case"em":Er=12;break;case"ex":Er=6;break;default:if(typeof i!="number")throw new Error("Invalid unit: "+i);Er=i}var Fr=null;xe(),we();var Rr=k.__private__.getPageInfo=k.getPageInfo=function(W){if(isNaN(W)||W%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:et[W].objId,pageNumber:W,pageContext:et[W]}},zs=k.__private__.getPageInfoByObjId=function(W){if(isNaN(W)||W%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var Ce in et)if(et[Ce].objId===W)break;return Rr(Ce)},Ta=k.__private__.getCurrentPageInfo=k.getCurrentPageInfo=function(){return{objId:et[Ne].objId,pageNumber:Ne,pageContext:et[Ne]}};k.addPage=function(){return kl.apply(this,arguments),this},k.setPage=function(){return Aa.apply(this,arguments),Gt.call(this,ln[Ne]),this},k.insertPage=function(W){return this.addPage(),this.movePage(Ne,W),this},k.movePage=function(W,Ce){var pt,yt;if(W>Ce){pt=ln[W],yt=et[W];for(var qt=W;qt>Ce;qt--)ln[qt]=ln[qt-1],et[qt]=et[qt-1];ln[Ce]=pt,et[Ce]=yt,this.setPage(Ce)}else if(W<Ce){pt=ln[W],yt=et[W];for(var Qt=W;Qt<Ce;Qt++)ln[Qt]=ln[Qt+1],et[Qt]=et[Qt+1];ln[Ce]=pt,et[Ce]=yt,this.setPage(Ce)}return this},k.deletePage=function(){return ec.apply(this,arguments),this},k.__private__.text=k.text=function(W,Ce,pt,yt,qt){var Qt,Fn,Nr,$r,yi,Ti,yo,_o,Qo,Mo=(yt=yt||{}).scope||this;if(typeof W=="number"&&typeof Ce=="number"&&(typeof pt=="string"||Array.isArray(pt))){var Vo=pt;pt=Ce,Ce=W,W=Vo}if(arguments[3]instanceof Lt==0?(Nr=arguments[4],$r=arguments[5],wa(yo=arguments[3])==="object"&&yo!==null||(typeof Nr=="string"&&($r=Nr,Nr=null),typeof yo=="string"&&($r=yo,yo=null),typeof yo=="number"&&(Nr=yo,yo=null),yt={flags:yo,angle:Nr,align:$r})):(F("The transform parameter of text() with a Matrix value"),Qo=qt),isNaN(Ce)||isNaN(pt)||W==null)throw new Error("Invalid arguments passed to jsPDF.text");if(W.length===0)return Mo;var es,cs="",qo=typeof yt.lineHeightFactor=="number"?yt.lineHeightFactor:Oi,Es=Mo.internal.scaleFactor;function jc(Go){return Go=Go.split("	").join(Array(yt.TabLen||9).join(" ")),Zo(Go,yo)}function Qa(Go){for(var Po,Hs=Go.concat(),ya=[],Ol=Hs.length;Ol--;)typeof(Po=Hs.shift())=="string"?ya.push(Po):Array.isArray(Go)&&(Po.length===1||Po[1]===void 0&&Po[2]===void 0)?ya.push(Po[0]):ya.push([Po[0],Po[1],Po[2]]);return ya}function L(Go,Po){var Hs;if(typeof Go=="string")Hs=Po(Go)[0];else if(Array.isArray(Go)){for(var ya,Ol,Dh=Go.concat(),Ju=[],xu=Dh.length;xu--;)typeof(ya=Dh.shift())=="string"?Ju.push(Po(ya)[0]):Array.isArray(ya)&&typeof ya[0]=="string"&&(Ol=Po(ya[0],ya[1],ya[2]),Ju.push([Ol[0],Ol[1],Ol[2]]));Hs=Ju}return Hs}var se=!1,ve=!0;if(typeof W=="string")se=!0;else if(Array.isArray(W)){var He=W.concat();Fn=[];for(var Xt,fn=He.length;fn--;)(typeof(Xt=He.shift())!="string"||Array.isArray(Xt)&&typeof Xt[0]!="string")&&(ve=!1);se=ve}if(se===!1)throw new Error('Type of text must be string or Array. "'+W+'" is not recognized.');typeof W=="string"&&(W=W.match(/[\r?\n]/)?W.split(/\r\n|\r|\n/g):[W]);var ar=Cn/Mo.internal.scaleFactor,ao=ar*(qo-1);switch(yt.baseline){case"bottom":pt-=ao;break;case"top":pt+=ar-ao;break;case"hanging":pt+=ar-2*ao;break;case"middle":pt+=ar/2-ao}if((Ti=yt.maxWidth||0)>0&&(typeof W=="string"?W=Mo.splitTextToSize(W,Ti):Object.prototype.toString.call(W)==="[object Array]"&&(W=W.reduce(function(Go,Po){return Go.concat(Mo.splitTextToSize(Po,Ti))},[]))),Qt={text:W,x:Ce,y:pt,options:yt,mutex:{pdfEscape:Zo,activeFontKey:Sr,fonts:or,activeFontSize:Cn}},ht.publish("preProcessText",Qt),W=Qt.text,Nr=(yt=Qt.options).angle,Qo instanceof Lt==0&&Nr&&typeof Nr=="number"){Nr*=Math.PI/180,yt.rotationDirection===0&&(Nr=-Nr),ue===me&&(Nr=-Nr);var Fo=Math.cos(Nr),qi=Math.sin(Nr);Qo=new Lt(Fo,qi,-qi,Fo,0,0)}else Nr&&Nr instanceof Lt&&(Qo=Nr);ue!==me||Qo||(Qo=On),(yi=yt.charSpace||Uo)!==void 0&&(cs+=U(Z(yi))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(_o=yt.horizontalScale)!==void 0&&(cs+=U(100*_o)+` Tz
`),yt.lang;var Di=-1,Ro=yt.renderingMode!==void 0?yt.renderingMode:yt.stroke,sa=Mo.internal.getCurrentPageInfo().pageContext;switch(Ro){case 0:case!1:case"fill":Di=0;break;case 1:case!0:case"stroke":Di=1;break;case 2:case"fillThenStroke":Di=2;break;case 3:case"invisible":Di=3;break;case 4:case"fillAndAddForClipping":Di=4;break;case 5:case"strokeAndAddPathForClipping":Di=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":Di=6;break;case 7:case"addToPathForClipping":Di=7}var Oo=sa.usedRenderingMode!==void 0?sa.usedRenderingMode:-1;Di!==-1?cs+=Di+` Tr
`:Oo!==-1&&(cs+=`0 Tr
`),Di!==-1&&(sa.usedRenderingMode=Di),$r=yt.align||"left";var Ji,Rl=Cn*qo,Ia=Mo.internal.pageSize.getWidth(),Ru=or[Sr];yi=yt.charSpace||Uo,Ti=yt.maxWidth||0,yo=Object.assign({autoencode:!0,noBOM:!0},yt.flags);var hl=[],Nl=function(Go){return Mo.getStringUnitWidth(Go,{font:Ru,charSpace:yi,fontSize:Cn,doKerning:!1})*Cn/Es};if(Object.prototype.toString.call(W)==="[object Array]"){var dl;Fn=Qa(W),$r!=="left"&&(Ji=Fn.map(Nl));var No,aa=0;if($r==="right"){Ce-=Ji[0],W=[],fn=Fn.length;for(var Dl=0;Dl<fn;Dl++)Dl===0?(No=mo(Ce),dl=js(pt)):(No=Z(aa-Ji[Dl]),dl=-Rl),W.push([Fn[Dl],No,dl]),aa=Ji[Dl]}else if($r==="center"){Ce-=Ji[0]/2,W=[],fn=Fn.length;for(var Ec=0;Ec<fn;Ec++)Ec===0?(No=mo(Ce),dl=js(pt)):(No=Z((aa-Ji[Ec])/2),dl=-Rl),W.push([Fn[Ec],No,dl]),aa=Ji[Ec]}else if($r==="left"){W=[],fn=Fn.length;for(var ma=0;ma<fn;ma++)W.push(Fn[ma])}else if($r==="justify"&&Ru.encoding==="Identity-H"){W=[],fn=Fn.length,Ti=Ti!==0?Ti:Ia;for(var Lo=0,$o=0;$o<fn;$o++)if(dl=$o===0?js(pt):-Rl,No=$o===0?mo(Ce):Lo,$o<fn-1){var Ca=Z((Ti-Ji[$o])/(Fn[$o].split(" ").length-1)),rc=Fn[$o].split(" ");W.push([rc[0]+" ",No,dl]),Lo=0;for(var fl=1;fl<rc.length;fl++){var Nu=(Nl(rc[fl-1]+" "+rc[fl])-Nl(rc[fl]))*Es+Ca;fl==rc.length-1?W.push([rc[fl],Nu,0]):W.push([rc[fl]+" ",Nu,0]),Lo-=Nu}}else W.push([Fn[$o],No,dl]);W.push(["",Lo,0])}else{if($r!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(W=[],fn=Fn.length,Ti=Ti!==0?Ti:Ia,$o=0;$o<fn;$o++){dl=$o===0?js(pt):-Rl,No=$o===0?mo(Ce):0;var el=Fn[$o].split(" ").length-1,Ac=el>0?(Ti-Ji[$o])/el:0;$o<fn-1?hl.push(U(Z(Ac))):hl.push(0),W.push([Fn[$o],No,dl])}}}(typeof yt.R2L=="boolean"?yt.R2L:Hr)===!0&&(W=L(W,function(Go,Po,Hs){return[Go.split("").reverse().join(""),Po,Hs]})),Qt={text:W,x:Ce,y:pt,options:yt,mutex:{pdfEscape:Zo,activeFontKey:Sr,fonts:or,activeFontSize:Cn}},ht.publish("postProcessText",Qt),W=Qt.text,es=Qt.mutex.isHex||!1;var Al=or[Sr].encoding;Al!=="WinAnsiEncoding"&&Al!=="StandardEncoding"||(W=L(W,function(Go,Po,Hs){return[jc(Go),Po,Hs]})),Fn=Qa(W),W=[];for(var pl,ic,Fl,_u=Array.isArray(Fn[0])?1:0,vs="",vu=function(Go,Po,Hs){var ya="";return Hs instanceof Lt?(Hs=typeof yt.angle=="number"?xn(Hs,new Lt(1,0,0,1,Go,Po)):xn(new Lt(1,0,0,1,Go,Po),Hs),ue===me&&(Hs=xn(new Lt(1,0,0,-1,0,0),Hs)),ya=Hs.join(" ")+` Tm
`):ya=U(Go)+" "+U(Po)+` Td
`,ya},la=0;la<Fn.length;la++){switch(vs="",_u){case 1:Fl=(es?"<":"(")+Fn[la][0]+(es?">":")"),pl=parseFloat(Fn[la][1]),ic=parseFloat(Fn[la][2]);break;case 0:Fl=(es?"<":"(")+Fn[la]+(es?">":")"),pl=mo(Ce),ic=js(pt)}hl!==void 0&&hl[la]!==void 0&&(vs=hl[la]+` Tw
`),la===0?W.push(vs+vu(pl,ic,Qo)+Fl):_u===0?W.push(vs+Fl):_u===1&&W.push(vs+vu(pl,ic,Qo)+Fl)}W=_u===0?W.join(` Tj
T* `):W.join(` Tj
`),W+=` Tj
`;var ga=`BT
/`;return ga+=Sr+" "+Cn+` Tf
`,ga+=U(Cn*qo)+` TL
`,ga+=Oa+`
`,ga+=cs,ga+=W,st(ga+="ET"),V[Sr]=!0,Mo};var xi=k.__private__.clip=k.clip=function(W){return st(W==="evenodd"?"W*":"W"),this};k.clipEvenOdd=function(){return xi("evenodd")},k.__private__.discardPath=k.discardPath=function(){return st("n"),this};var Mi=k.__private__.isValidStyle=function(W){var Ce=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(W)!==-1&&(Ce=!0),Ce};k.__private__.setDefaultPathOperation=k.setDefaultPathOperation=function(W){return Mi(W)&&(w=W),this};var El=k.__private__.getStyle=k.getStyle=function(W){var Ce=w;switch(W){case"D":case"S":Ce="S";break;case"F":Ce="f";break;case"FD":case"DF":Ce="B";break;case"f":case"f*":case"B":case"B*":Ce=W}return Ce},ji=k.close=function(){return st("h"),this};k.stroke=function(){return st("S"),this},k.fill=function(W){return fs("f",W),this},k.fillEvenOdd=function(W){return fs("f*",W),this},k.fillStroke=function(W){return fs("B",W),this},k.fillStrokeEvenOdd=function(W){return fs("B*",W),this};var fs=function(W,Ce){wa(Ce)==="object"?tc(Ce,W):st(W)},Fi=function(W){W===null||ue===me&&W===void 0||(W=El(W),st(W))};function yu(W,Ce,pt,yt,qt){var Qt=new o0(Ce||this.boundingBox,pt||this.xStep,yt||this.yStep,this.gState,qt||this.matrix);Qt.stream=this.stream;var Fn=W+"$$"+this.cloneIndex+++"$$";return An(Fn,Qt),Qt}var tc=function(W,Ce){var pt=hi[W.key],yt=Dr[pt];if(yt instanceof Km)st("q"),st(eu(Ce)),yt.gState&&k.setGState(yt.gState),st(W.matrix.toString()+" cm"),st("/"+pt+" sh"),st("Q");else if(yt instanceof o0){var qt=new Lt(1,0,0,-1,0,Gs());W.matrix&&(qt=qt.multiply(W.matrix||On),pt=yu.call(yt,W.key,W.boundingBox,W.xStep,W.yStep,qt).id),st("q"),st("/Pattern cs"),st("/"+pt+" scn"),yt.gState&&k.setGState(yt.gState),st(Ce),st("Q")}},eu=function(W){switch(W){case"f":case"F":case"n":return"W n";case"f*":return"W* n";case"B":case"S":return"W S";case"B*":return"W* S"}},bc=k.moveTo=function(W,Ce){return st(U(Z(W))+" "+U(be(Ce))+" m"),this},nc=k.lineTo=function(W,Ce){return st(U(Z(W))+" "+U(be(Ce))+" l"),this},Da=k.curveTo=function(W,Ce,pt,yt,qt,Qt){return st([U(Z(W)),U(be(Ce)),U(Z(pt)),U(be(yt)),U(Z(qt)),U(be(Qt)),"c"].join(" ")),this};k.__private__.line=k.line=function(W,Ce,pt,yt,qt){if(isNaN(W)||isNaN(Ce)||isNaN(pt)||isNaN(yt)||!Mi(qt))throw new Error("Invalid arguments passed to jsPDF.line");return ue===ne?this.lines([[pt-W,yt-Ce]],W,Ce,[1,1],qt||"S"):this.lines([[pt-W,yt-Ce]],W,Ce,[1,1]).stroke()},k.__private__.lines=k.lines=function(W,Ce,pt,yt,qt,Qt){var Fn,Nr,$r,yi,Ti,yo,_o,Qo,Mo,Vo,es,cs;if(typeof W=="number"&&(cs=pt,pt=Ce,Ce=W,W=cs),yt=yt||[1,1],Qt=Qt||!1,isNaN(Ce)||isNaN(pt)||!Array.isArray(W)||!Array.isArray(yt)||!Mi(qt)||typeof Qt!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(bc(Ce,pt),Fn=yt[0],Nr=yt[1],yi=W.length,Vo=Ce,es=pt,$r=0;$r<yi;$r++)(Ti=W[$r]).length===2?(Vo=Ti[0]*Fn+Vo,es=Ti[1]*Nr+es,nc(Vo,es)):(yo=Ti[0]*Fn+Vo,_o=Ti[1]*Nr+es,Qo=Ti[2]*Fn+Vo,Mo=Ti[3]*Nr+es,Vo=Ti[4]*Fn+Vo,es=Ti[5]*Nr+es,Da(yo,_o,Qo,Mo,Vo,es));return Qt&&ji(),Fi(qt),this},k.path=function(W){for(var Ce=0;Ce<W.length;Ce++){var pt=W[Ce],yt=pt.c;switch(pt.op){case"m":bc(yt[0],yt[1]);break;case"l":nc(yt[0],yt[1]);break;case"c":Da.apply(this,yt);break;case"h":ji()}}return this},k.__private__.rect=k.rect=function(W,Ce,pt,yt,qt){if(isNaN(W)||isNaN(Ce)||isNaN(pt)||isNaN(yt)||!Mi(qt))throw new Error("Invalid arguments passed to jsPDF.rect");return ue===ne&&(yt=-yt),st([U(Z(W)),U(be(Ce)),U(Z(pt)),U(Z(yt)),"re"].join(" ")),Fi(qt),this},k.__private__.triangle=k.triangle=function(W,Ce,pt,yt,qt,Qt,Fn){if(isNaN(W)||isNaN(Ce)||isNaN(pt)||isNaN(yt)||isNaN(qt)||isNaN(Qt)||!Mi(Fn))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[pt-W,yt-Ce],[qt-pt,Qt-yt],[W-qt,Ce-Qt]],W,Ce,[1,1],Fn,!0),this},k.__private__.roundedRect=k.roundedRect=function(W,Ce,pt,yt,qt,Qt,Fn){if(isNaN(W)||isNaN(Ce)||isNaN(pt)||isNaN(yt)||isNaN(qt)||isNaN(Qt)||!Mi(Fn))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var Nr=4/3*(Math.SQRT2-1);return qt=Math.min(qt,.5*pt),Qt=Math.min(Qt,.5*yt),this.lines([[pt-2*qt,0],[qt*Nr,0,qt,Qt-Qt*Nr,qt,Qt],[0,yt-2*Qt],[0,Qt*Nr,-qt*Nr,Qt,-qt,Qt],[2*qt-pt,0],[-qt*Nr,0,-qt,-Qt*Nr,-qt,-Qt],[0,2*Qt-yt],[0,-Qt*Nr,qt*Nr,-Qt,qt,-Qt]],W+qt,Ce,[1,1],Fn,!0),this},k.__private__.ellipse=k.ellipse=function(W,Ce,pt,yt,qt){if(isNaN(W)||isNaN(Ce)||isNaN(pt)||isNaN(yt)||!Mi(qt))throw new Error("Invalid arguments passed to jsPDF.ellipse");var Qt=4/3*(Math.SQRT2-1)*pt,Fn=4/3*(Math.SQRT2-1)*yt;return bc(W+pt,Ce),Da(W+pt,Ce-Fn,W+Qt,Ce-yt,W,Ce-yt),Da(W-Qt,Ce-yt,W-pt,Ce-Fn,W-pt,Ce),Da(W-pt,Ce+Fn,W-Qt,Ce+yt,W,Ce+yt),Da(W+Qt,Ce+yt,W+pt,Ce+Fn,W+pt,Ce),Fi(qt),this},k.__private__.circle=k.circle=function(W,Ce,pt,yt){if(isNaN(W)||isNaN(Ce)||isNaN(pt)||!Mi(yt))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(W,Ce,pt,pt,yt)},k.setFont=function(W,Ce,pt){return pt&&(Ce=pe(Ce,pt)),Sr=pn(W,Ce,{disableWarning:!1}),this};var Ms=k.__private__.getFont=k.getFont=function(){return or[pn.apply(k,arguments)]};k.__private__.getFontList=k.getFontList=function(){var W,Ce,pt={};for(W in ai)if(ai.hasOwnProperty(W))for(Ce in pt[W]=[],ai[W])ai[W].hasOwnProperty(Ce)&&pt[W].push(Ce);return pt},k.addFont=function(W,Ce,pt,yt,qt){var Qt=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&Qt.indexOf(arguments[3])!==-1?qt=arguments[3]:arguments[3]&&Qt.indexOf(arguments[3])==-1&&(pt=pe(pt,yt)),Ea.call(this,W,Ce,pt,qt=qt||"Identity-H")};var Oi,Fa=n.lineWidth||.200025,ci=k.__private__.getLineWidth=k.getLineWidth=function(){return Fa},Jo=k.__private__.setLineWidth=k.setLineWidth=function(W){return Fa=W,st(U(Z(W))+" w"),this};k.__private__.setLineDash=wi.API.setLineDash=wi.API.setLineDashPattern=function(W,Ce){if(W=W||[],Ce=Ce||0,isNaN(Ce)||!Array.isArray(W))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return W=W.map(function(pt){return U(Z(pt))}).join(" "),Ce=U(Z(Ce)),st("["+W+"] "+Ce+" d"),this};var Eo=k.__private__.getLineHeight=k.getLineHeight=function(){return Cn*Oi};k.__private__.getLineHeight=k.getLineHeight=function(){return Cn*Oi};var xh=k.__private__.setLineHeightFactor=k.setLineHeightFactor=function(W){return typeof(W=W||1.15)=="number"&&(Oi=W),this},ku=k.__private__.getLineHeightFactor=k.getLineHeightFactor=function(){return Oi};xh(n.lineHeight);var mo=k.__private__.getHorizontalCoordinate=function(W){return Z(W)},js=k.__private__.getVerticalCoordinate=function(W){return ue===me?W:et[Ne].mediaBox.topRightY-et[Ne].mediaBox.bottomLeftY-Z(W)},Mu=k.__private__.getHorizontalCoordinateString=k.getHorizontalCoordinateString=function(W){return U(mo(W))},Ko=k.__private__.getVerticalCoordinateString=k.getVerticalCoordinateString=function(W){return U(js(W))},go=n.strokeColor||"0 G";k.__private__.getStrokeColor=k.getDrawColor=function(){return Wo(go)},k.__private__.setStrokeColor=k.setDrawColor=function(W,Ce,pt,yt){return go=no({ch1:W,ch2:Ce,ch3:pt,ch4:yt,pdfColorType:"draw",precision:2}),st(go),this};var Ml=n.fillColor||"0 g";k.__private__.getFillColor=k.getFillColor=function(){return Wo(Ml)},k.__private__.setFillColor=k.setFillColor=function(W,Ce,pt,yt){return Ml=no({ch1:W,ch2:Ce,ch3:pt,ch4:yt,pdfColorType:"fill",precision:2}),st(Ml),this};var Oa=n.textColor||"0 g",Us=k.__private__.getTextColor=k.getTextColor=function(){return Wo(Oa)};k.__private__.setTextColor=k.setTextColor=function(W,Ce,pt,yt){return Oa=no({ch1:W,ch2:Ce,ch3:pt,ch4:yt,pdfColorType:"text",precision:3}),this};var Uo=n.charSpace,zc=k.__private__.getCharSpace=k.getCharSpace=function(){return parseFloat(Uo||0)};k.__private__.setCharSpace=k.setCharSpace=function(W){if(isNaN(W))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Uo=W,this};var Xo=0;k.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},k.__private__.setLineCap=k.setLineCap=function(W){var Ce=k.CapJoinStyles[W];if(Ce===void 0)throw new Error("Line cap style of '"+W+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Xo=Ce,st(Ce+" J"),this};var pa=0;k.__private__.setLineJoin=k.setLineJoin=function(W){var Ce=k.CapJoinStyles[W];if(Ce===void 0)throw new Error("Line join style of '"+W+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return pa=Ce,st(Ce+" j"),this},k.__private__.setLineMiterLimit=k.__private__.setMiterLimit=k.setLineMiterLimit=k.setMiterLimit=function(W){if(W=W||0,isNaN(W))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return st(U(Z(W))+" M"),this},k.GState=fv,k.setGState=function(W){(W=typeof W=="string"?li[lt[W]]:Ja(null,W)).equals(Ee)||(st("/"+W.id+" gs"),Ee=W)};var Ja=function(W,Ce){if(!W||!lt[W]){var pt=!1;for(var yt in li)if(li.hasOwnProperty(yt)&&li[yt].equals(Ce)){pt=!0;break}if(pt)Ce=li[yt];else{var qt="GS"+(Object.keys(li).length+1).toString(10);li[qt]=Ce,Ce.id=qt}return W&&(lt[W]=Ce.id),ht.publish("addGState",Ce),Ce}};k.addGState=function(W,Ce){return Ja(W,Ce),this},k.saveGraphicsState=function(){return st("q"),qr.push({key:Sr,size:Cn,color:Oa}),this},k.restoreGraphicsState=function(){st("Q");var W=qr.pop();return Sr=W.key,Cn=W.size,Oa=W.color,Ee=null,this},k.setCurrentTransformationMatrix=function(W){return st(W.toString()+" cm"),this},k.comment=function(W){return st("#"+W),this};var cl=function(W,Ce){var pt=W||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return pt},set:function(Qt){isNaN(Qt)||(pt=parseFloat(Qt))}});var yt=Ce||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return yt},set:function(Qt){isNaN(Qt)||(yt=parseFloat(Qt))}});var qt="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return qt},set:function(Qt){qt=Qt.toString()}}),this},tu=function(W,Ce,pt,yt){cl.call(this,W,Ce),this.type="rect";var qt=pt||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return qt},set:function(Fn){isNaN(Fn)||(qt=parseFloat(Fn))}});var Qt=yt||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return Qt},set:function(Fn){isNaN(Fn)||(Qt=parseFloat(Fn))}}),this},wc=function(){this.page=Te,this.currentPage=Ne,this.pages=ln.slice(0),this.pagesContext=et.slice(0),this.x=Cr,this.y=Si,this.matrix=Li,this.width=Ss(Ne),this.height=ia(Ne),this.outputDestination=Mn,this.id="",this.objectNumber=-1};wc.prototype.restore=function(){Te=this.page,Ne=this.currentPage,et=this.pagesContext,ln=this.pages,Cr=this.x,Si=this.y,Li=this.matrix,qs(Ne,this.width),oa(Ne,this.height),Mn=this.outputDestination};var Vs=function(W,Ce,pt,yt,qt){At.push(new wc),Te=Ne=0,ln=[],Cr=W,Si=Ce,Li=qt,Xa([pt,yt])};for(var Ai in k.beginFormObject=function(W,Ce,pt,yt,qt){return Vs(W,Ce,pt,yt,qt),this},k.endFormObject=function(W){return(function(Ce){if(Ot[Ce])At.pop().restore();else{var pt=new wc,yt="Xo"+(Object.keys(Rt).length+1).toString(10);pt.id=yt,Ot[Ce]=yt,Rt[yt]=pt,ht.publish("addFormObject",pt),At.pop().restore()}})(W),this},k.doFormObject=function(W,Ce){var pt=Rt[Ot[W]];return st("q"),st(Ce.toString()+" cm"),st("/"+pt.id+" Do"),st("Q"),this},k.getFormObject=function(W){var Ce=Rt[Ot[W]];return{x:Ce.x,y:Ce.y,width:Ce.width,height:Ce.height,matrix:Ce.matrix}},k.save=function(W,Ce){return W=W||"generated.pdf",(Ce=Ce||{}).returnPromise=Ce.returnPromise||!1,Ce.returnPromise===!1?($m(ll(Ya()),W),typeof $m.unload=="function"&&so.setTimeout&&setTimeout($m.unload,911),this):new Promise(function(pt,yt){try{var qt=$m(ll(Ya()),W);typeof $m.unload=="function"&&so.setTimeout&&setTimeout($m.unload,911),pt(qt)}catch(Qt){yt(Qt.message)}})},wi.API)wi.API.hasOwnProperty(Ai)&&(Ai==="events"&&wi.API.events.length?(function(W,Ce){var pt,yt,qt;for(qt=Ce.length-1;qt!==-1;qt--)pt=Ce[qt][0],yt=Ce[qt][1],W.subscribe.apply(W,[pt].concat(typeof yt=="function"?[yt]:yt))})(ht,wi.API.events):k[Ai]=wi.API[Ai]);function Ss(W){return et[W].mediaBox.topRightX-et[W].mediaBox.bottomLeftX}function qs(W,Ce){et[W].mediaBox.topRightX=Ce+et[W].mediaBox.bottomLeftX}function ia(W){return et[W].mediaBox.topRightY-et[W].mediaBox.bottomLeftY}function oa(W,Ce){et[W].mediaBox.topRightY=Ce+et[W].mediaBox.bottomLeftY}var ul=k.getPageWidth=function(W){return Ss(W=W||Ne)/Er},$s=k.setPageWidth=function(W,Ce){qs(W,Ce*Er)},Gs=k.getPageHeight=function(W){return ia(W=W||Ne)/Er},Sc=k.setPageHeight=function(W,Ce){oa(W,Ce*Er)};return k.internal={pdfEscape:Zo,getStyle:El,getFont:Ms,getFontSize:Jn,getCharSpace:zc,getTextColor:Us,getLineHeight:Eo,getLineHeightFactor:ku,getLineWidth:ci,write:fr,getHorizontalCoordinate:mo,getVerticalCoordinate:js,getCoordinateString:Mu,getVerticalCoordinateString:Ko,collections:{},newObject:Ir,newAdditionalObject:Ei,newObjectDeferred:zr,newObjectDeferredBegin:wr,getFilters:_s,putStream:ro,events:ht,scaleFactor:Er,pageSize:{getWidth:function(){return ul(Ne)},setWidth:function(W){$s(Ne,W)},getHeight:function(){return Gs(Ne)},setHeight:function(W){Sc(Ne,W)}},encryptionOptions:I,encryption:Fr,getEncryptor:function(W){return I!==null?Fr.encryptor(W,0):function(Ce){return Ce}},output:ks,getNumberOfPages:ra,pages:ln,out:st,f2:j,f3:H,getPageInfo:Rr,getPageInfoByObjId:zs,getCurrentPageInfo:Ta,getPDFVersion:ae,Point:cl,Rectangle:tu,Matrix:Lt,hasHotfix:er},Object.defineProperty(k.internal.pageSize,"width",{get:function(){return ul(Ne)},set:function(W){$s(Ne,W)},enumerable:!0,configurable:!0}),Object.defineProperty(k.internal.pageSize,"height",{get:function(){return Gs(Ne)},set:function(W){Sc(Ne,W)},enumerable:!0,configurable:!0}),(function(W){for(var Ce=0,pt=Tr.length;Ce<pt;Ce++){var yt=Ea.call(this,W[Ce][0],W[Ce][1],W[Ce][2],Tr[Ce][3],!0);R===!1&&(V[yt]=!0);var qt=W[Ce][0].split("-");mu({id:yt,fontName:qt[0],fontStyle:qt[1]||""})}ht.publish("addFonts",{fonts:or,dictionary:ai})}).call(k,Tr),Sr="F1",kl(c,t),ht.publish("initialized"),k}Jg.prototype.lsbFirstWord=function(n){return String.fromCharCode(255&n,n>>8&255,n>>16&255,n>>24&255)},Jg.prototype.toHexString=function(n){return n.split("").map(function(e){return("0"+(255&e.charCodeAt(0)).toString(16)).slice(-2)}).join("")},Jg.prototype.hexToBytes=function(n){for(var e=[],t=0;t<n.length;t+=2)e.push(String.fromCharCode(parseInt(n.substr(t,2),16)));return e.join("")},Jg.prototype.processOwnerPassword=function(n,e){return b5(x5(e).substr(0,5),n)},Jg.prototype.encryptor=function(n,e){var t=x5(this.encryptionKey+String.fromCharCode(255&n,n>>8&255,n>>16&255,255&e,e>>8&255)).substr(0,10);return function(i){return b5(t,i)}},fv.prototype.equals=function(n){var e,t="id,objectNumber,equals";if(!n||wa(n)!==wa(this))return!1;var i=0;for(e in this)if(!(t.indexOf(e)>=0)){if(this.hasOwnProperty(e)&&!n.hasOwnProperty(e)||this[e]!==n[e])return!1;i++}for(e in n)n.hasOwnProperty(e)&&t.indexOf(e)<0&&i--;return i===0},wi.API={events:[]},wi.version="3.0.3";var vc=wi.API,xw=1,fg=function(n){return n.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},$g=function(n){return n.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},To=function(n){return n.toFixed(2)},Xp=function(n){return n.toFixed(5)};vc.__acroform__={};var Yh=function(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n},ES=function(n){return n*xw},Af=function(n){var e=new O6,t=mi.internal.getHeight(n)||0,i=mi.internal.getWidth(n)||0;return e.BBox=[0,0,Number(To(i)),Number(To(t))],e},PM=vc.__acroform__.setBit=function(n,e){if(n=n||0,e=e||0,isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return n|1<<e},kM=vc.__acroform__.clearBit=function(n,e){if(n=n||0,e=e||0,isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return n&~(1<<e)},MM=vc.__acroform__.getBit=function(n,e){if(isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return n&1<<e?1:0},Fc=vc.__acroform__.getBitForPdf=function(n,e){if(isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return MM(n,e-1)},Oc=vc.__acroform__.setBitForPdf=function(n,e){if(isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return PM(n,e-1)},Bc=vc.__acroform__.clearBitForPdf=function(n,e){if(isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return kM(n,e-1)},RM=vc.__acroform__.calculateCoordinates=function(n,e){var t=e.internal.getHorizontalCoordinate,i=e.internal.getVerticalCoordinate,c=n[0],u=n[1],m=n[2],_=n[3],o={};return o.lowerLeft_X=t(c)||0,o.lowerLeft_Y=i(u+_)||0,o.upperRight_X=t(c+m)||0,o.upperRight_Y=i(u)||0,[Number(To(o.lowerLeft_X)),Number(To(o.lowerLeft_Y)),Number(To(o.upperRight_X)),Number(To(o.upperRight_Y))]},NM=function(n){if(n.appearanceStreamContent)return n.appearanceStreamContent;if(n.V||n.DV){var e=[],t=n._V||n.DV,i=w5(n,t),c=n.scope.internal.getFont(n.fontName,n.fontStyle).id;e.push("/Tx BMC"),e.push("q"),e.push("BT"),e.push(n.scope.__private__.encodeColorString(n.color)),e.push("/"+c+" "+To(i.fontSize)+" Tf"),e.push("1 0 0 1 0 0 Tm"),e.push(i.text),e.push("ET"),e.push("Q"),e.push("EMC");var u=Af(n);return u.scope=n.scope,u.stream=e.join(`
`),u}},w5=function(n,e){var t=n.fontSize===0?n.maxFontSize:n.fontSize,i={text:"",fontSize:""},c=(e=(e=e.substr(0,1)=="("?e.substr(1):e).substr(e.length-1)==")"?e.substr(0,e.length-1):e).split(" ");c=n.multiline?c.map(function(j){return j.split(`
`)}):c.map(function(j){return[j]});var u=t,m=mi.internal.getHeight(n)||0;m=m<0?-m:m;var _=mi.internal.getWidth(n)||0;_=_<0?-_:_;var o=function(j,H,Z){if(j+1<c.length){var be=H+" "+c[j+1][0];return g1(be,n,Z).width<=_-4}return!1};u++;e:for(;u>0;){e="",u--;var w,I,R=g1("3",n,u).height,V=n.multiline?m-u:(m-R)/2,k=V+=2,ie=0,ae=0,fe=0;if(u<=0){e=`(...) Tj
`,e+="% Width of Text: "+g1(e,n,u=12).width+", FieldWidth:"+_+`
`;break}for(var J="",ne=0,me=0;me<c.length;me++)if(c.hasOwnProperty(me)){var ue=!1;if(c[me].length!==1&&fe!==c[me].length-1){if((R+2)*(ne+2)+2>m)continue e;J+=c[me][fe],ue=!0,ae=me,me--}else{J=(J+=c[me][fe]+" ").substr(J.length-1)==" "?J.substr(0,J.length-1):J;var ke=parseInt(me),ze=o(ke,J,u),pe=me>=c.length-1;if(ze&&!pe){J+=" ",fe=0;continue}if(ze||pe){if(pe)ae=ke;else if(n.multiline&&(R+2)*(ne+2)+2>m)continue e}else{if(!n.multiline||(R+2)*(ne+2)+2>m)continue e;ae=ke}}for(var U="",F=ie;F<=ae;F++){var q=c[F];if(n.multiline){if(F===ae){U+=q[fe]+" ",fe=(fe+1)%q.length;continue}if(F===ie){U+=q[q.length-1]+" ";continue}}U+=q[0]+" "}switch(U=U.substr(U.length-1)==" "?U.substr(0,U.length-1):U,I=g1(U,n,u).width,n.textAlign){case"right":w=_-I-2;break;case"center":w=(_-I)/2;break;default:w=2}e+=To(w)+" "+To(k)+` Td
`,e+="("+fg(U)+`) Tj
`,e+=-To(w)+` 0 Td
`,k=-(u+2),I=0,ie=ue?ae:ae+1,ne++,J=""}break}return i.text=e,i.fontSize=u,i},g1=function(n,e,t){var i=e.scope.internal.getFont(e.fontName,e.fontStyle),c=e.scope.getStringUnitWidth(n,{font:i,fontSize:parseFloat(t),charSpace:0})*parseFloat(t);return{height:e.scope.getStringUnitWidth("3",{font:i,fontSize:parseFloat(t),charSpace:0})*parseFloat(t)*1.5,width:c}},DM={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},FM=function(n,e){var t={type:"reference",object:n};e.internal.getPageInfo(n.page).pageContext.annotations.find(function(i){return i.type===t.type&&i.object===t.object})===void 0&&e.internal.getPageInfo(n.page).pageContext.annotations.push(t)},OM=function(n,e){if(e.scope=n,n.internal!==void 0&&(n.internal.acroformPlugin===void 0||n.internal.acroformPlugin.isInitialized===!1)){if(sf.FieldNum=0,n.internal.acroformPlugin=JSON.parse(JSON.stringify(DM)),n.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");xw=n.internal.scaleFactor,n.internal.acroformPlugin.acroFormDictionaryRoot=new B6,n.internal.acroformPlugin.acroFormDictionaryRoot.scope=n,n.internal.acroformPlugin.acroFormDictionaryRoot._eventID=n.internal.events.subscribe("postPutResources",function(){(function(t){t.internal.events.unsubscribe(t.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete t.internal.acroformPlugin.acroFormDictionaryRoot._eventID,t.internal.acroformPlugin.printedOut=!0})(n)}),n.internal.events.subscribe("buildDocument",function(){(function(t){t.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var i=t.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var c in i)if(i.hasOwnProperty(c)){var u=i[c];u.objId=void 0,u.hasAnnotation&&FM(u,t)}})(n)}),n.internal.events.subscribe("putCatalog",function(){(function(t){if(t.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");t.internal.write("/AcroForm "+t.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(n)}),n.internal.events.subscribe("postPutPages",function(t){(function(i,c){var u=!i;for(var m in i||(c.internal.newObjectDeferredBegin(c.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),c.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),i=i||c.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(i.hasOwnProperty(m)){var _=i[m],o=[],w=_.Rect;if(_.Rect&&(_.Rect=RM(_.Rect,c)),c.internal.newObjectDeferredBegin(_.objId,!0),_.DA=mi.createDefaultAppearanceStream(_),wa(_)==="object"&&typeof _.getKeyValueListForStream=="function"&&(o=_.getKeyValueListForStream()),_.Rect=w,_.hasAppearanceStream&&!_.appearanceStreamContent){var I=NM(_);o.push({key:"AP",value:"<</N "+I+">>"}),c.internal.acroformPlugin.xForms.push(I)}if(_.appearanceStreamContent){var R="";for(var V in _.appearanceStreamContent)if(_.appearanceStreamContent.hasOwnProperty(V)){var k=_.appearanceStreamContent[V];if(R+="/"+V+" ",R+="<<",Object.keys(k).length>=1||Array.isArray(k)){for(var m in k)if(k.hasOwnProperty(m)){var ie=k[m];typeof ie=="function"&&(ie=ie.call(c,_)),R+="/"+m+" "+ie+" ",c.internal.acroformPlugin.xForms.indexOf(ie)>=0||c.internal.acroformPlugin.xForms.push(ie)}}else typeof(ie=k)=="function"&&(ie=ie.call(c,_)),R+="/"+m+" "+ie,c.internal.acroformPlugin.xForms.indexOf(ie)>=0||c.internal.acroformPlugin.xForms.push(ie);R+=">>"}o.push({key:"AP",value:`<<
`+R+">>"})}c.internal.putStream({additionalKeyValues:o,objectId:_.objId}),c.internal.out("endobj")}u&&(function(ae,fe){for(var J in ae)if(ae.hasOwnProperty(J)){var ne=J,me=ae[J];fe.internal.newObjectDeferredBegin(me.objId,!0),wa(me)==="object"&&typeof me.putStream=="function"&&me.putStream(),delete ae[ne]}})(c.internal.acroformPlugin.xForms,c)})(t,n)}),n.internal.acroformPlugin.isInitialized=!0}},F6=vc.__acroform__.arrayToPdfArray=function(n,e,t){var i=function(m){return m};if(Array.isArray(n)){for(var c="[",u=0;u<n.length;u++)switch(u!==0&&(c+=" "),wa(n[u])){case"boolean":case"number":case"object":c+=n[u].toString();break;case"string":n[u].substr(0,1)!=="/"?(e!==void 0&&t&&(i=t.internal.getEncryptor(e)),c+="("+fg(i(n[u].toString()))+")"):c+=n[u].toString()}return c+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},Tb=function(n,e,t){var i=function(c){return c};return e!==void 0&&t&&(i=t.internal.getEncryptor(e)),(n=n||"").toString(),"("+fg(i(n))+")"},Nf=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(n){this._objId=n}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};Nf.prototype.toString=function(){return this.objId+" 0 R"},Nf.prototype.putStream=function(){var n=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:n,objectId:this.objId}),this.scope.internal.out("endobj")},Nf.prototype.getKeyValueListForStream=function(){var n=[],e=Object.getOwnPropertyNames(this).filter(function(u){return u!="content"&&u!="appearanceStreamContent"&&u!="scope"&&u!="objId"&&u.substring(0,1)!="_"});for(var t in e)if(Object.getOwnPropertyDescriptor(this,e[t]).configurable===!1){var i=e[t],c=this[i];c&&(Array.isArray(c)?n.push({key:i,value:F6(c,this.objId,this.scope)}):c instanceof Nf?(c.scope=this.scope,n.push({key:i,value:c.objId+" 0 R"})):typeof c!="function"&&n.push({key:i,value:c}))}return n};var O6=function(){Nf.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var n,e=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(t){n=t.trim()},get:function(){return n||null}})};Yh(O6,Nf);var B6=function(){Nf.call(this);var n,e=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return e.length>0?e:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return e}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(n){var t=function(i){return i};return this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),"("+fg(t(n))+")"}},set:function(t){n=t}})};Yh(B6,Nf);var sf=function n(){Nf.call(this);var e=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return e},set:function(J){if(isNaN(J))throw new Error('Invalid value "'+J+'" for attribute F supplied.');e=J}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!Fc(e,3)},set:function(J){J?this.F=Oc(e,3):this.F=Bc(e,3)}});var t=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return t},set:function(J){if(isNaN(J))throw new Error('Invalid value "'+J+'" for attribute Ff supplied.');t=J}});var i=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(i.length!==0)return i},set:function(J){i=J!==void 0?J:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[0])?0:i[0]},set:function(J){i[0]=J}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[1])?0:i[1]},set:function(J){i[1]=J}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[2])?0:i[2]},set:function(J){i[2]=J}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[3])?0:i[3]},set:function(J){i[3]=J}});var c="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return c},set:function(J){switch(J){case"/Btn":case"/Tx":case"/Ch":case"/Sig":c=J;break;default:throw new Error('Invalid value "'+J+'" for attribute FT supplied.')}}});var u=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!u||u.length<1){if(this instanceof pv)return;u="FieldObject"+n.FieldNum++}var J=function(ne){return ne};return this.scope&&(J=this.scope.internal.getEncryptor(this.objId)),"("+fg(J(u))+")"},set:function(J){u=J.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return u},set:function(J){u=J}});var m="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return m},set:function(J){m=J}});var _="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return _},set:function(J){_=J}});var o=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return o},set:function(J){o=J}});var w=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return w===void 0?50/xw:w},set:function(J){w=J}});var I="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return I},set:function(J){I=J}});var R="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!R||this instanceof pv||this instanceof Qm))return Tb(R,this.objId,this.scope)},set:function(J){J=J.toString(),R=J}});var V=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(V)return this instanceof Cu==0?Tb(V,this.objId,this.scope):V},set:function(J){J=J.toString(),V=this instanceof Cu==0?J.substr(0,1)==="("?$g(J.substr(1,J.length-2)):$g(J):J}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Cu==1?$g(V.substr(1,V.length-1)):V},set:function(J){J=J.toString(),V=this instanceof Cu==1?"/"+J:J}});var k=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(k)return k},set:function(J){this.V=J}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(k)return this instanceof Cu==0?Tb(k,this.objId,this.scope):k},set:function(J){J=J.toString(),k=this instanceof Cu==0?J.substr(0,1)==="("?$g(J.substr(1,J.length-2)):$g(J):J}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Cu==1?$g(k.substr(1,k.length-1)):k},set:function(J){J=J.toString(),k=this instanceof Cu==1?"/"+J:J}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var ie,ae=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return ae},set:function(J){J=!!J,ae=J}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(ie)return ie},set:function(J){ie=J}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!Fc(this.Ff,1)},set:function(J){J?this.Ff=Oc(this.Ff,1):this.Ff=Bc(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!Fc(this.Ff,2)},set:function(J){J?this.Ff=Oc(this.Ff,2):this.Ff=Bc(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!Fc(this.Ff,3)},set:function(J){J?this.Ff=Oc(this.Ff,3):this.Ff=Bc(this.Ff,3)}});var fe=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(fe!==null)return fe},set:function(J){if([0,1,2].indexOf(J)===-1)throw new Error('Invalid value "'+J+'" for attribute Q supplied.');fe=J}}),Object.defineProperty(this,"textAlign",{get:function(){var J;switch(fe){case 0:default:J="left";break;case 1:J="center";break;case 2:J="right"}return J},configurable:!0,enumerable:!0,set:function(J){switch(J){case"right":case 2:fe=2;break;case"center":case 1:fe=1;break;default:fe=0}}})};Yh(sf,Nf);var h0=function(){sf.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var n=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return n},set:function(t){n=t}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return n},set:function(t){n=t}});var e=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return F6(e,this.objId,this.scope)},set:function(t){var i,c;c=[],typeof(i=t)=="string"&&(c=(function(u,m,_){_||(_=1);for(var o,w=[];o=m.exec(u);)w.push(o[_]);return w})(i,/\((.*?)\)/g)),e=c}}),this.getOptions=function(){return e},this.setOptions=function(t){e=t,this.sort&&e.sort()},this.addOption=function(t){t=(t=t||"").toString(),e.push(t),this.sort&&e.sort()},this.removeOption=function(t,i){for(i=i||!1,t=(t=t||"").toString();e.indexOf(t)!==-1&&(e.splice(e.indexOf(t),1),i!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!Fc(this.Ff,18)},set:function(t){t?this.Ff=Oc(this.Ff,18):this.Ff=Bc(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!Fc(this.Ff,19)},set:function(t){this.combo===!0&&(t?this.Ff=Oc(this.Ff,19):this.Ff=Bc(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!Fc(this.Ff,20)},set:function(t){t?(this.Ff=Oc(this.Ff,20),e.sort()):this.Ff=Bc(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!Fc(this.Ff,22)},set:function(t){t?this.Ff=Oc(this.Ff,22):this.Ff=Bc(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Fc(this.Ff,23)},set:function(t){t?this.Ff=Oc(this.Ff,23):this.Ff=Bc(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!Fc(this.Ff,27)},set:function(t){t?this.Ff=Oc(this.Ff,27):this.Ff=Bc(this.Ff,27)}}),this.hasAppearanceStream=!1};Yh(h0,sf);var d0=function(){h0.call(this),this.fontName="helvetica",this.combo=!1};Yh(d0,h0);var f0=function(){d0.call(this),this.combo=!0};Yh(f0,d0);var j1=function(){f0.call(this),this.edit=!0};Yh(j1,f0);var Cu=function(){sf.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!Fc(this.Ff,15)},set:function(t){t?this.Ff=Oc(this.Ff,15):this.Ff=Bc(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!Fc(this.Ff,16)},set:function(t){t?this.Ff=Oc(this.Ff,16):this.Ff=Bc(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!Fc(this.Ff,17)},set:function(t){t?this.Ff=Oc(this.Ff,17):this.Ff=Bc(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!Fc(this.Ff,26)},set:function(t){t?this.Ff=Oc(this.Ff,26):this.Ff=Bc(this.Ff,26)}});var n,e={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var t=function(u){return u};if(this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),Object.keys(e).length!==0){var i,c=[];for(i in c.push("<<"),e)c.push("/"+i+" ("+fg(t(e[i]))+")");return c.push(">>"),c.join(`
`)}},set:function(t){wa(t)==="object"&&(e=t)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return e.CA||""},set:function(t){typeof t=="string"&&(e.CA=t)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return n},set:function(t){n=t}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return n.substr(1,n.length-1)},set:function(t){n="/"+t}})};Yh(Cu,sf);var U1=function(){Cu.call(this),this.pushButton=!0};Yh(U1,Cu);var p0=function(){Cu.call(this),this.radio=!0,this.pushButton=!1;var n=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return n},set:function(e){n=e!==void 0?e:[]}})};Yh(p0,Cu);var pv=function(){var n,e;sf.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return n},set:function(c){n=c}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return e},set:function(c){e=c}});var t,i={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var c=function(_){return _};this.scope&&(c=this.scope.internal.getEncryptor(this.objId));var u,m=[];for(u in m.push("<<"),i)m.push("/"+u+" ("+fg(c(i[u]))+")");return m.push(">>"),m.join(`
`)},set:function(c){wa(c)==="object"&&(i=c)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return i.CA||""},set:function(c){typeof c=="string"&&(i.CA=c)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return t},set:function(c){t=c}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return t.substr(1,t.length-1)},set:function(c){t="/"+c}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=mi.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};Yh(pv,sf),p0.prototype.setAppearance=function(n){if(!("createAppearanceStream"in n)||!("getCA"in n))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var e in this.Kids)if(this.Kids.hasOwnProperty(e)){var t=this.Kids[e];t.appearanceStreamContent=n.createAppearanceStream(t.optionName),t.caption=n.getCA()}},p0.prototype.createOption=function(n){var e=new pv;return e.Parent=this,e.optionName=n,this.Kids.push(e),BM.call(this.scope,e),e};var V1=function(){Cu.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=mi.CheckBox.createAppearanceStream()};Yh(V1,Cu);var Qm=function(){sf.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!Fc(this.Ff,13)},set:function(e){e?this.Ff=Oc(this.Ff,13):this.Ff=Bc(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!Fc(this.Ff,21)},set:function(e){e?this.Ff=Oc(this.Ff,21):this.Ff=Bc(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Fc(this.Ff,23)},set:function(e){e?this.Ff=Oc(this.Ff,23):this.Ff=Bc(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!Fc(this.Ff,24)},set:function(e){e?this.Ff=Oc(this.Ff,24):this.Ff=Bc(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!Fc(this.Ff,25)},set:function(e){e?this.Ff=Oc(this.Ff,25):this.Ff=Bc(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!Fc(this.Ff,26)},set:function(e){e?this.Ff=Oc(this.Ff,26):this.Ff=Bc(this.Ff,26)}});var n=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return n},set:function(e){n=e}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return n},set:function(e){Number.isInteger(e)&&(n=e)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};Yh(Qm,sf);var q1=function(){Qm.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!Fc(this.Ff,14)},set:function(n){n?this.Ff=Oc(this.Ff,14):this.Ff=Bc(this.Ff,14)}}),this.password=!0};Yh(q1,Qm);var mi={CheckBox:{createAppearanceStream:function(){return{N:{On:mi.CheckBox.YesNormal},D:{On:mi.CheckBox.YesPushDown,Off:mi.CheckBox.OffPushDown}}},YesPushDown:function(n){var e=Af(n);e.scope=n.scope;var t=[],i=n.scope.internal.getFont(n.fontName,n.fontStyle).id,c=n.scope.__private__.encodeColorString(n.color),u=w5(n,n.caption);return t.push("0.749023 g"),t.push("0 0 "+To(mi.internal.getWidth(n))+" "+To(mi.internal.getHeight(n))+" re"),t.push("f"),t.push("BMC"),t.push("q"),t.push("0 0 1 rg"),t.push("/"+i+" "+To(u.fontSize)+" Tf "+c),t.push("BT"),t.push(u.text),t.push("ET"),t.push("Q"),t.push("EMC"),e.stream=t.join(`
`),e},YesNormal:function(n){var e=Af(n);e.scope=n.scope;var t=n.scope.internal.getFont(n.fontName,n.fontStyle).id,i=n.scope.__private__.encodeColorString(n.color),c=[],u=mi.internal.getHeight(n),m=mi.internal.getWidth(n),_=w5(n,n.caption);return c.push("1 g"),c.push("0 0 "+To(m)+" "+To(u)+" re"),c.push("f"),c.push("q"),c.push("0 0 1 rg"),c.push("0 0 "+To(m-1)+" "+To(u-1)+" re"),c.push("W"),c.push("n"),c.push("0 g"),c.push("BT"),c.push("/"+t+" "+To(_.fontSize)+" Tf "+i),c.push(_.text),c.push("ET"),c.push("Q"),e.stream=c.join(`
`),e},OffPushDown:function(n){var e=Af(n);e.scope=n.scope;var t=[];return t.push("0.749023 g"),t.push("0 0 "+To(mi.internal.getWidth(n))+" "+To(mi.internal.getHeight(n))+" re"),t.push("f"),e.stream=t.join(`
`),e}},RadioButton:{Circle:{createAppearanceStream:function(n){var e={D:{Off:mi.RadioButton.Circle.OffPushDown},N:{}};return e.N[n]=mi.RadioButton.Circle.YesNormal,e.D[n]=mi.RadioButton.Circle.YesPushDown,e},getCA:function(){return"l"},YesNormal:function(n){var e=Af(n);e.scope=n.scope;var t=[],i=mi.internal.getWidth(n)<=mi.internal.getHeight(n)?mi.internal.getWidth(n)/4:mi.internal.getHeight(n)/4;i=Number((.9*i).toFixed(5));var c=mi.internal.Bezier_C,u=Number((i*c).toFixed(5));return t.push("q"),t.push("1 0 0 1 "+Xp(mi.internal.getWidth(n)/2)+" "+Xp(mi.internal.getHeight(n)/2)+" cm"),t.push(i+" 0 m"),t.push(i+" "+u+" "+u+" "+i+" 0 "+i+" c"),t.push("-"+u+" "+i+" -"+i+" "+u+" -"+i+" 0 c"),t.push("-"+i+" -"+u+" -"+u+" -"+i+" 0 -"+i+" c"),t.push(u+" -"+i+" "+i+" -"+u+" "+i+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e},YesPushDown:function(n){var e=Af(n);e.scope=n.scope;var t=[],i=mi.internal.getWidth(n)<=mi.internal.getHeight(n)?mi.internal.getWidth(n)/4:mi.internal.getHeight(n)/4;i=Number((.9*i).toFixed(5));var c=Number((2*i).toFixed(5)),u=Number((c*mi.internal.Bezier_C).toFixed(5)),m=Number((i*mi.internal.Bezier_C).toFixed(5));return t.push("0.749023 g"),t.push("q"),t.push("1 0 0 1 "+Xp(mi.internal.getWidth(n)/2)+" "+Xp(mi.internal.getHeight(n)/2)+" cm"),t.push(c+" 0 m"),t.push(c+" "+u+" "+u+" "+c+" 0 "+c+" c"),t.push("-"+u+" "+c+" -"+c+" "+u+" -"+c+" 0 c"),t.push("-"+c+" -"+u+" -"+u+" -"+c+" 0 -"+c+" c"),t.push(u+" -"+c+" "+c+" -"+u+" "+c+" 0 c"),t.push("f"),t.push("Q"),t.push("0 g"),t.push("q"),t.push("1 0 0 1 "+Xp(mi.internal.getWidth(n)/2)+" "+Xp(mi.internal.getHeight(n)/2)+" cm"),t.push(i+" 0 m"),t.push(i+" "+m+" "+m+" "+i+" 0 "+i+" c"),t.push("-"+m+" "+i+" -"+i+" "+m+" -"+i+" 0 c"),t.push("-"+i+" -"+m+" -"+m+" -"+i+" 0 -"+i+" c"),t.push(m+" -"+i+" "+i+" -"+m+" "+i+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e},OffPushDown:function(n){var e=Af(n);e.scope=n.scope;var t=[],i=mi.internal.getWidth(n)<=mi.internal.getHeight(n)?mi.internal.getWidth(n)/4:mi.internal.getHeight(n)/4;i=Number((.9*i).toFixed(5));var c=Number((2*i).toFixed(5)),u=Number((c*mi.internal.Bezier_C).toFixed(5));return t.push("0.749023 g"),t.push("q"),t.push("1 0 0 1 "+Xp(mi.internal.getWidth(n)/2)+" "+Xp(mi.internal.getHeight(n)/2)+" cm"),t.push(c+" 0 m"),t.push(c+" "+u+" "+u+" "+c+" 0 "+c+" c"),t.push("-"+u+" "+c+" -"+c+" "+u+" -"+c+" 0 c"),t.push("-"+c+" -"+u+" -"+u+" -"+c+" 0 -"+c+" c"),t.push(u+" -"+c+" "+c+" -"+u+" "+c+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e}},Cross:{createAppearanceStream:function(n){var e={D:{Off:mi.RadioButton.Cross.OffPushDown},N:{}};return e.N[n]=mi.RadioButton.Cross.YesNormal,e.D[n]=mi.RadioButton.Cross.YesPushDown,e},getCA:function(){return"8"},YesNormal:function(n){var e=Af(n);e.scope=n.scope;var t=[],i=mi.internal.calculateCross(n);return t.push("q"),t.push("1 1 "+To(mi.internal.getWidth(n)-2)+" "+To(mi.internal.getHeight(n)-2)+" re"),t.push("W"),t.push("n"),t.push(To(i.x1.x)+" "+To(i.x1.y)+" m"),t.push(To(i.x2.x)+" "+To(i.x2.y)+" l"),t.push(To(i.x4.x)+" "+To(i.x4.y)+" m"),t.push(To(i.x3.x)+" "+To(i.x3.y)+" l"),t.push("s"),t.push("Q"),e.stream=t.join(`
`),e},YesPushDown:function(n){var e=Af(n);e.scope=n.scope;var t=mi.internal.calculateCross(n),i=[];return i.push("0.749023 g"),i.push("0 0 "+To(mi.internal.getWidth(n))+" "+To(mi.internal.getHeight(n))+" re"),i.push("f"),i.push("q"),i.push("1 1 "+To(mi.internal.getWidth(n)-2)+" "+To(mi.internal.getHeight(n)-2)+" re"),i.push("W"),i.push("n"),i.push(To(t.x1.x)+" "+To(t.x1.y)+" m"),i.push(To(t.x2.x)+" "+To(t.x2.y)+" l"),i.push(To(t.x4.x)+" "+To(t.x4.y)+" m"),i.push(To(t.x3.x)+" "+To(t.x3.y)+" l"),i.push("s"),i.push("Q"),e.stream=i.join(`
`),e},OffPushDown:function(n){var e=Af(n);e.scope=n.scope;var t=[];return t.push("0.749023 g"),t.push("0 0 "+To(mi.internal.getWidth(n))+" "+To(mi.internal.getHeight(n))+" re"),t.push("f"),e.stream=t.join(`
`),e}}},createDefaultAppearanceStream:function(n){var e=n.scope.internal.getFont(n.fontName,n.fontStyle).id,t=n.scope.__private__.encodeColorString(n.color);return"/"+e+" "+n.fontSize+" Tf "+t}};mi.internal={Bezier_C:.551915024494,calculateCross:function(n){var e=mi.internal.getWidth(n),t=mi.internal.getHeight(n),i=Math.min(e,t);return{x1:{x:(e-i)/2,y:(t-i)/2+i},x2:{x:(e-i)/2+i,y:(t-i)/2},x3:{x:(e-i)/2,y:(t-i)/2},x4:{x:(e-i)/2+i,y:(t-i)/2+i}}}},mi.internal.getWidth=function(n){var e=0;return wa(n)==="object"&&(e=ES(n.Rect[2])),e},mi.internal.getHeight=function(n){var e=0;return wa(n)==="object"&&(e=ES(n.Rect[3])),e};var BM=vc.addField=function(n){if(OM(this,n),!(n instanceof sf))throw new Error("Invalid argument passed to jsPDF.addField.");var e;return(e=n).scope.internal.acroformPlugin.printedOut&&(e.scope.internal.acroformPlugin.printedOut=!1,e.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),e.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(e),n.page=n.scope.internal.getCurrentPageInfo().pageNumber,this};vc.AcroFormChoiceField=h0,vc.AcroFormListBox=d0,vc.AcroFormComboBox=f0,vc.AcroFormEditBox=j1,vc.AcroFormButton=Cu,vc.AcroFormPushButton=U1,vc.AcroFormRadioButton=p0,vc.AcroFormCheckBox=V1,vc.AcroFormTextField=Qm,vc.AcroFormPasswordField=q1,vc.AcroFormAppearance=mi,vc.AcroForm={ChoiceField:h0,ListBox:d0,ComboBox:f0,EditBox:j1,Button:Cu,PushButton:U1,RadioButton:p0,CheckBox:V1,TextField:Qm,PasswordField:q1,Appearance:mi},wi.AcroForm={ChoiceField:h0,ListBox:d0,ComboBox:f0,EditBox:j1,Button:Cu,PushButton:U1,RadioButton:p0,CheckBox:V1,TextField:Qm,PasswordField:q1,Appearance:mi};wi.AcroForm;function z6(n){return n.reduce(function(e,t,i){return e[t]=i,e},{})}(function(n){var e="addImage_";n.__addimage__={};var t="UNKNOWN",i={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},c=n.__addimage__.getImageFileTypeByImageData=function(j,H){var Z,be,Me,Be,Re,we=t;if((H=H||t)==="RGBA"||j.data!==void 0&&j.data instanceof Uint8ClampedArray&&"height"in j&&"width"in j)return"RGBA";if(ze(j))for(Re in i)for(Me=i[Re],Z=0;Z<Me.length;Z+=1){for(Be=!0,be=0;be<Me[Z].length;be+=1)if(Me[Z][be]!==void 0&&Me[Z][be]!==j[be]){Be=!1;break}if(Be===!0){we=Re;break}}else for(Re in i)for(Me=i[Re],Z=0;Z<Me.length;Z+=1){for(Be=!0,be=0;be<Me[Z].length;be+=1)if(Me[Z][be]!==void 0&&Me[Z][be]!==j.charCodeAt(be)){Be=!1;break}if(Be===!0){we=Re;break}}return we===t&&H!==t&&(we=H),we},u=function j(H){for(var Z=this.internal.write,be=this.internal.putStream,Me=(0,this.internal.getFilters)();Me.indexOf("FlateEncode")!==-1;)Me.splice(Me.indexOf("FlateEncode"),1);H.objectId=this.internal.newObject();var Be=[];if(Be.push({key:"Type",value:"/XObject"}),Be.push({key:"Subtype",value:"/Image"}),Be.push({key:"Width",value:H.width}),Be.push({key:"Height",value:H.height}),H.colorSpace===J.INDEXED?Be.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(H.palette.length/3-1)+" "+("sMask"in H&&H.sMask!==void 0?H.objectId+2:H.objectId+1)+" 0 R]"}):(Be.push({key:"ColorSpace",value:"/"+H.colorSpace}),H.colorSpace===J.DEVICE_CMYK&&Be.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),Be.push({key:"BitsPerComponent",value:H.bitsPerComponent}),"decodeParameters"in H&&H.decodeParameters!==void 0&&Be.push({key:"DecodeParms",value:"<<"+H.decodeParameters+">>"}),"transparency"in H&&Array.isArray(H.transparency)&&H.transparency.length>0){for(var Re="",we=0,De=H.transparency.length;we<De;we++)Re+=H.transparency[we]+" "+H.transparency[we]+" ";Be.push({key:"Mask",value:"["+Re+"]"})}H.sMask!==void 0&&Be.push({key:"SMask",value:H.objectId+1+" 0 R"});var nt=H.filter!==void 0?["/"+H.filter]:void 0;if(be({data:H.data,additionalKeyValues:Be,alreadyAppliedFilters:nt,objectId:H.objectId}),Z("endobj"),"sMask"in H&&H.sMask!==void 0){var xe,le=(xe=H.sMaskBitsPerComponent)!==null&&xe!==void 0?xe:H.bitsPerComponent,Ne={width:H.width,height:H.height,colorSpace:"DeviceGray",bitsPerComponent:le,data:H.sMask};"filter"in H&&(Ne.decodeParameters="/Predictor ".concat(H.predictor," /Colors 1 /BitsPerComponent ").concat(le," /Columns ").concat(H.width),Ne.filter=H.filter),j.call(this,Ne)}if(H.colorSpace===J.INDEXED){var Oe=this.internal.newObject();be({data:U(new Uint8Array(H.palette)),objectId:Oe}),Z("endobj")}},m=function(){var j=this.internal.collections[e+"images"];for(var H in j)u.call(this,j[H])},_=function(){var j,H=this.internal.collections[e+"images"],Z=this.internal.write;for(var be in H)Z("/I"+(j=H[be]).index,j.objectId,"0","R")},o=function(){this.internal.collections[e+"images"]||(this.internal.collections[e+"images"]={},this.internal.events.subscribe("putResources",m),this.internal.events.subscribe("putXobjectDict",_))},w=function(){var j=this.internal.collections[e+"images"];return o.call(this),j},I=function(){return Object.keys(this.internal.collections[e+"images"]).length},R=function(j){return typeof n["process"+j.toUpperCase()]=="function"},V=function(j){return wa(j)==="object"&&j.nodeType===1},k=function(j,H){if(j.nodeName==="IMG"&&j.hasAttribute("src")){var Z=""+j.getAttribute("src");if(Z.indexOf("data:image/")===0)return z1(unescape(Z).split("base64,").pop());var be=n.loadFile(Z,!0);if(be!==void 0)return be}if(j.nodeName==="CANVAS"){if(j.width===0||j.height===0)throw new Error("Given canvas must have data. Canvas width: "+j.width+", height: "+j.height);var Me;switch(H){case"PNG":Me="image/png";break;case"WEBP":Me="image/webp";break;default:Me="image/jpeg"}return z1(j.toDataURL(Me,1).split("base64,").pop())}},ie=function(j){var H=this.internal.collections[e+"images"];if(H){for(var Z in H)if(j===H[Z].alias)return H[Z]}},ae=function(j,H,Z){return j||H||(j=-96,H=-96),j<0&&(j=-1*Z.width*72/j/this.internal.scaleFactor),H<0&&(H=-1*Z.height*72/H/this.internal.scaleFactor),j===0&&(j=H*Z.width/Z.height),H===0&&(H=j*Z.height/Z.width),[j,H]},fe=function(j,H,Z,be,Me,Be){var Re=ae.call(this,Z,be,Me),we=this.internal.getCoordinateString,De=this.internal.getVerticalCoordinateString,nt=w.call(this);if(Z=Re[0],be=Re[1],nt[Me.index]=Me,Be){Be*=Math.PI/180;var xe=Math.cos(Be),le=Math.sin(Be),Ne=function(Je){return Je.toFixed(4)},Oe=[Ne(xe),Ne(le),Ne(-1*le),Ne(xe),0,0,"cm"]}this.internal.write("q"),Be?(this.internal.write([1,"0","0",1,we(j),De(H+be),"cm"].join(" ")),this.internal.write(Oe.join(" ")),this.internal.write([we(Z),"0","0",we(be),"0","0","cm"].join(" "))):this.internal.write([we(Z),"0","0",we(be),we(j),De(H+be),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+Me.index+" Do"),this.internal.write("Q")},J=n.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};n.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var ne=n.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},me=n.__addimage__.sHashCode=function(j){var H,Z,be=0;if(typeof j=="string")for(Z=j.length,H=0;H<Z;H++)be=(be<<5)-be+j.charCodeAt(H),be|=0;else if(ze(j))for(Z=j.byteLength/2,H=0;H<Z;H++)be=(be<<5)-be+j[H],be|=0;return be},ue=n.__addimage__.validateStringAsBase64=function(j){(j=j||"").toString().trim();var H=!0;return j.length===0&&(H=!1),j.length%4!=0&&(H=!1),/^[A-Za-z0-9+/]+$/.test(j.substr(0,j.length-2))===!1&&(H=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(j.substr(-2))===!1&&(H=!1),H},ke=n.__addimage__.extractImageFromDataUrl=function(j){if(j==null||!(j=j.trim()).startsWith("data:"))return null;var H=j.indexOf(",");return H<0?null:j.substring(0,H).trim().endsWith("base64")?j.substring(H+1):null};n.__addimage__.isArrayBuffer=function(j){return j instanceof ArrayBuffer};var ze=n.__addimage__.isArrayBufferView=function(j){return j instanceof Int8Array||j instanceof Uint8Array||j instanceof Uint8ClampedArray||j instanceof Int16Array||j instanceof Uint16Array||j instanceof Int32Array||j instanceof Uint32Array||j instanceof Float32Array||j instanceof Float64Array},pe=n.__addimage__.binaryStringToUint8Array=function(j){for(var H=j.length,Z=new Uint8Array(H),be=0;be<H;be++)Z[be]=j.charCodeAt(be);return Z},U=n.__addimage__.arrayBufferToBinaryString=function(j){for(var H="",Z=ze(j)?j:new Uint8Array(j),be=0;be<Z.length;be+=8192)H+=String.fromCharCode.apply(null,Z.subarray(be,be+8192));return H};n.addImage=function(){var j,H,Z,be,Me,Be,Re,we,De;if(typeof arguments[1]=="number"?(H=t,Z=arguments[1],be=arguments[2],Me=arguments[3],Be=arguments[4],Re=arguments[5],we=arguments[6],De=arguments[7]):(H=arguments[1],Z=arguments[2],be=arguments[3],Me=arguments[4],Be=arguments[5],Re=arguments[6],we=arguments[7],De=arguments[8]),wa(j=arguments[0])==="object"&&!V(j)&&"imageData"in j){var nt=j;j=nt.imageData,H=nt.format||H||t,Z=nt.x||Z||0,be=nt.y||be||0,Me=nt.w||nt.width||Me,Be=nt.h||nt.height||Be,Re=nt.alias||Re,we=nt.compression||we,De=nt.rotation||nt.angle||De}var xe=this.internal.getFilters();if(we===void 0&&xe.indexOf("FlateEncode")!==-1&&(we="SLOW"),isNaN(Z)||isNaN(be))throw new Error("Invalid coordinates passed to jsPDF.addImage");o.call(this);var le=F.call(this,j,H,Re,we);return fe.call(this,Z,be,Me,Be,le,De),this};var F=function(j,H,Z,be){var Me,Be,Re;if(typeof j=="string"&&c(j)===t){j=unescape(j);var we=q(j,!1);(we!==""||(we=n.loadFile(j,!0))!==void 0)&&(j=we)}if(V(j)&&(j=k(j,H)),H=c(j,H),!R(H))throw new Error("addImage does not support files of type '"+H+"', please ensure that a plugin for '"+H+"' support is added.");if(((Re=Z)==null||Re.length===0)&&(Z=(function(De){return typeof De=="string"||ze(De)?me(De):ze(De.data)?me(De.data):null})(j)),(Me=ie.call(this,Z))||(j instanceof Uint8Array||H==="RGBA"||(Be=j,j=pe(j)),Me=this["process"+H.toUpperCase()](j,I.call(this),Z,(function(De){return De&&typeof De=="string"&&(De=De.toUpperCase()),De in n.image_compression?De:ne.NONE})(be),Be)),!Me)throw new Error("An unknown error occurred whilst processing the image.");return Me},q=n.__addimage__.convertBase64ToBinaryString=function(j,H){H=typeof H!="boolean"||H;var Z,be="";if(typeof j=="string"){var Me;Z=(Me=ke(j))!==null&&Me!==void 0?Me:j;try{be=z1(Z)}catch(Be){if(H)throw ue(Z)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+Be.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return be};n.getImageProperties=function(j){var H,Z,be="";if(V(j)&&(j=k(j)),typeof j=="string"&&c(j)===t&&((be=q(j,!1))===""&&(be=n.loadFile(j)||""),j=be),Z=c(j),!R(Z))throw new Error("addImage does not support files of type '"+Z+"', please ensure that a plugin for '"+Z+"' support is added.");if(j instanceof Uint8Array||(j=pe(j)),!(H=this["process"+Z.toUpperCase()](j)))throw new Error("An unknown error occurred whilst processing the image");return H.fileType=Z,H}})(wi.API),(function(n){var e=function(t){if(t!==void 0&&t!="")return!0};wi.API.events.push(["addPage",function(t){this.internal.getPageInfo(t.pageNumber).pageContext.annotations=[]}]),n.events.push(["putPage",function(t){for(var i,c,u,m=this.internal.getCoordinateString,_=this.internal.getVerticalCoordinateString,o=this.internal.getPageInfoByObjId(t.objId),w=t.pageContext.annotations,I=!1,R=0;R<w.length&&!I;R++)switch((i=w[R]).type){case"link":(e(i.options.url)||e(i.options.pageNumber))&&(I=!0);break;case"reference":case"text":case"freetext":I=!0}if(I!=0){this.internal.write("/Annots [");for(var V=0;V<w.length;V++){i=w[V];var k=this.internal.pdfEscape,ie=this.internal.getEncryptor(t.objId);switch(i.type){case"reference":this.internal.write(" "+i.object.objId+" 0 R ");break;case"text":var ae=this.internal.newAdditionalObject(),fe=this.internal.newAdditionalObject(),J=this.internal.getEncryptor(ae.objId),ne=i.title||"Note";u="<</Type /Annot /Subtype /Text "+(c="/Rect ["+m(i.bounds.x)+" "+_(i.bounds.y+i.bounds.h)+" "+m(i.bounds.x+i.bounds.w)+" "+_(i.bounds.y)+"] ")+"/Contents ("+k(J(i.contents))+")",u+=" /Popup "+fe.objId+" 0 R",u+=" /P "+o.objId+" 0 R",u+=" /T ("+k(J(ne))+") >>",ae.content=u;var me=ae.objId+" 0 R";u="<</Type /Annot /Subtype /Popup "+(c="/Rect ["+m(i.bounds.x+30)+" "+_(i.bounds.y+i.bounds.h)+" "+m(i.bounds.x+i.bounds.w+30)+" "+_(i.bounds.y)+"] ")+" /Parent "+me,i.open&&(u+=" /Open true"),u+=" >>",fe.content=u,this.internal.write(ae.objId,"0 R",fe.objId,"0 R");break;case"freetext":c="/Rect ["+m(i.bounds.x)+" "+_(i.bounds.y)+" "+m(i.bounds.x+i.bounds.w)+" "+_(i.bounds.y+i.bounds.h)+"] ";var ue=i.color||"#000000";u="<</Type /Annot /Subtype /FreeText "+c+"/Contents ("+k(ie(i.contents))+")",u+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+ue+")",u+=" /Border [0 0 0]",u+=" >>",this.internal.write(u);break;case"link":if(i.options.name){var ke=this.annotations._nameMap[i.options.name];i.options.pageNumber=ke.page,i.options.top=ke.y}else i.options.top||(i.options.top=0);if(c="/Rect ["+i.finalBounds.x+" "+i.finalBounds.y+" "+i.finalBounds.w+" "+i.finalBounds.h+"] ",u="",i.options.url)u="<</Type /Annot /Subtype /Link "+c+"/Border [0 0 0] /A <</S /URI /URI ("+k(ie(i.options.url))+") >>";else if(i.options.pageNumber)switch(u="<</Type /Annot /Subtype /Link "+c+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(i.options.pageNumber).objId+" 0 R",i.options.magFactor=i.options.magFactor||"XYZ",i.options.magFactor){case"Fit":u+=" /Fit]";break;case"FitH":u+=" /FitH "+i.options.top+"]";break;case"FitV":i.options.left=i.options.left||0,u+=" /FitV "+i.options.left+"]";break;default:var ze=_(i.options.top);i.options.left=i.options.left||0,i.options.zoom===void 0&&(i.options.zoom=0),u+=" /XYZ "+i.options.left+" "+ze+" "+i.options.zoom+"]"}u!=""&&(u+=" >>",this.internal.write(u))}}this.internal.write("]")}}]),n.createAnnotation=function(t){var i=this.internal.getCurrentPageInfo();switch(t.type){case"link":this.link(t.bounds.x,t.bounds.y,t.bounds.w,t.bounds.h,t);break;case"text":case"freetext":i.pageContext.annotations.push(t)}},n.link=function(t,i,c,u,m){var _=this.internal.getCurrentPageInfo(),o=this.internal.getCoordinateString,w=this.internal.getVerticalCoordinateString;_.pageContext.annotations.push({finalBounds:{x:o(t),y:w(i),w:o(t+c),h:w(i+u)},options:m,type:"link"})},n.textWithLink=function(t,i,c,u){var m,_,o=this.getTextWidth(t),w=this.internal.getLineHeight()/this.internal.scaleFactor;if(u.maxWidth!==void 0){_=u.maxWidth;var I=this.splitTextToSize(t,_).length;m=Math.ceil(w*I)}else _=o,m=w;return this.text(t,i,c,u),c+=.2*w,u.align==="center"&&(i-=o/2),u.align==="right"&&(i-=o),this.link(i,c-w,_,m,u),o},n.getTextWidth=function(t){var i=this.internal.getFontSize();return this.getStringUnitWidth(t)*i/this.internal.scaleFactor}})(wi.API),(function(n){var e={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},t={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},i={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},c=[1570,1571,1573,1575];n.__arabicParser__={};var u=n.__arabicParser__.isInArabicSubstitutionA=function(ae){return e[ae.charCodeAt(0)]!==void 0},m=n.__arabicParser__.isArabicLetter=function(ae){return typeof ae=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(ae)},_=n.__arabicParser__.isArabicEndLetter=function(ae){return m(ae)&&u(ae)&&e[ae.charCodeAt(0)].length<=2},o=n.__arabicParser__.isArabicAlfLetter=function(ae){return m(ae)&&c.indexOf(ae.charCodeAt(0))>=0};n.__arabicParser__.arabicLetterHasIsolatedForm=function(ae){return m(ae)&&u(ae)&&e[ae.charCodeAt(0)].length>=1};var w=n.__arabicParser__.arabicLetterHasFinalForm=function(ae){return m(ae)&&u(ae)&&e[ae.charCodeAt(0)].length>=2};n.__arabicParser__.arabicLetterHasInitialForm=function(ae){return m(ae)&&u(ae)&&e[ae.charCodeAt(0)].length>=3};var I=n.__arabicParser__.arabicLetterHasMedialForm=function(ae){return m(ae)&&u(ae)&&e[ae.charCodeAt(0)].length==4},R=n.__arabicParser__.resolveLigatures=function(ae){var fe=0,J=t,ne="",me=0;for(fe=0;fe<ae.length;fe+=1)J[ae.charCodeAt(fe)]!==void 0?(me++,typeof(J=J[ae.charCodeAt(fe)])=="number"&&(ne+=String.fromCharCode(J),J=t,me=0),fe===ae.length-1&&(J=t,ne+=ae.charAt(fe-(me-1)),fe-=me-1,me=0)):(J=t,ne+=ae.charAt(fe-me),fe-=me,me=0);return ne};n.__arabicParser__.isArabicDiacritic=function(ae){return ae!==void 0&&i[ae.charCodeAt(0)]!==void 0};var V=n.__arabicParser__.getCorrectForm=function(ae,fe,J){return m(ae)?u(ae)===!1?-1:!w(ae)||!m(fe)&&!m(J)||!m(J)&&_(fe)||_(ae)&&!m(fe)||_(ae)&&o(fe)||_(ae)&&_(fe)?0:I(ae)&&m(fe)&&!_(fe)&&m(J)&&w(J)?3:_(ae)||!m(J)?1:2:-1},k=function(ae){var fe=0,J=0,ne=0,me="",ue="",ke="",ze=(ae=ae||"").split("\\s+"),pe=[];for(fe=0;fe<ze.length;fe+=1){for(pe.push(""),J=0;J<ze[fe].length;J+=1)me=ze[fe][J],ue=ze[fe][J-1],ke=ze[fe][J+1],m(me)?(ne=V(me,ue,ke),pe[fe]+=ne!==-1?String.fromCharCode(e[me.charCodeAt(0)][ne]):me):pe[fe]+=me;pe[fe]=R(pe[fe])}return pe.join(" ")},ie=n.__arabicParser__.processArabic=n.processArabic=function(){var ae,fe=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,J=[];if(Array.isArray(fe)){var ne=0;for(J=[],ne=0;ne<fe.length;ne+=1)Array.isArray(fe[ne])?J.push([k(fe[ne][0]),fe[ne][1],fe[ne][2]]):J.push([k(fe[ne])]);ae=J}else ae=k(fe);return typeof arguments[0]=="string"?ae:(arguments[0].text=ae,arguments[0])};n.events.push(["preProcessText",ie])})(wi.API),wi.API.autoPrint=function(n){var e;return(n=n||{}).variant=n.variant||"non-conform",n.variant==="javascript"?this.addJS("print({});"):(this.internal.events.subscribe("postPutResources",function(){e=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+e+" 0 R")})),this},(function(n){var e=function(){var t=void 0;Object.defineProperty(this,"pdf",{get:function(){return t},set:function(_){t=_}});var i=150;Object.defineProperty(this,"width",{get:function(){return i},set:function(_){i=isNaN(_)||Number.isInteger(_)===!1||_<0?150:_,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=i+1)}});var c=300;Object.defineProperty(this,"height",{get:function(){return c},set:function(_){c=isNaN(_)||Number.isInteger(_)===!1||_<0?300:_,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=c+1)}});var u=[];Object.defineProperty(this,"childNodes",{get:function(){return u},set:function(_){u=_}});var m={};Object.defineProperty(this,"style",{get:function(){return m},set:function(_){m=_}}),Object.defineProperty(this,"parentNode",{})};e.prototype.getContext=function(t,i){var c;if((t=t||"2d")!=="2d")return null;for(c in i)this.pdf.context2d.hasOwnProperty(c)&&(this.pdf.context2d[c]=i[c]);return this.pdf.context2d._canvas=this,this.pdf.context2d},e.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},n.events.push(["initialized",function(){this.canvas=new e,this.canvas.pdf=this}])})(wi.API),(function(n){var e={left:0,top:0,bottom:0,right:0},t=!1,i=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},e),this.internal.__cell__.margins.width=this.getPageWidth(),c.call(this))},c=function(){this.internal.__cell__.lastCell=new u,this.internal.__cell__.pages=1},u=function(){var o=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return o},set:function(ae){o=ae}});var w=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return w},set:function(ae){w=ae}});var I=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return I},set:function(ae){I=ae}});var R=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return R},set:function(ae){R=ae}});var V=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return V},set:function(ae){V=ae}});var k=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return k},set:function(ae){k=ae}});var ie=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return ie},set:function(ae){ie=ae}}),this};u.prototype.clone=function(){return new u(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},u.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},n.setHeaderFunction=function(o){return i.call(this),this.internal.__cell__.headerFunction=typeof o=="function"?o:void 0,this},n.getTextDimensions=function(o,w){i.call(this);var I=(w=w||{}).fontSize||this.getFontSize(),R=w.font||this.getFont(),V=w.scaleFactor||this.internal.scaleFactor,k=0,ie=0,ae=0,fe=this;if(!Array.isArray(o)&&typeof o!="string"){if(typeof o!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");o=String(o)}var J=w.maxWidth;J>0?typeof o=="string"?o=this.splitTextToSize(o,J):Object.prototype.toString.call(o)==="[object Array]"&&(o=o.reduce(function(me,ue){return me.concat(fe.splitTextToSize(ue,J))},[])):o=Array.isArray(o)?o:[o];for(var ne=0;ne<o.length;ne++)k<(ae=this.getStringUnitWidth(o[ne],{font:R})*I)&&(k=ae);return k!==0&&(ie=o.length),{w:k/=V,h:Math.max((ie*I*this.getLineHeightFactor()-I*(this.getLineHeightFactor()-1))/V,0)}},n.cellAddPage=function(){i.call(this),this.addPage();var o=this.internal.__cell__.margins||e;return this.internal.__cell__.lastCell=new u(o.left,o.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var m=n.cell=function(){var o;o=arguments[0]instanceof u?arguments[0]:new u(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),i.call(this);var w=this.internal.__cell__.lastCell,I=this.internal.__cell__.padding,R=this.internal.__cell__.margins||e,V=this.internal.__cell__.tableHeaderRow,k=this.internal.__cell__.printHeaders;return w.lineNumber!==void 0&&(w.lineNumber===o.lineNumber?(o.x=(w.x||0)+(w.width||0),o.y=w.y||0):w.y+w.height+o.height+R.bottom>this.getPageHeight()?(this.cellAddPage(),o.y=R.top,k&&V&&(this.printHeaderRow(o.lineNumber,!0),o.y+=V[0].height)):o.y=w.y+w.height||o.y),o.text[0]!==void 0&&(this.rect(o.x,o.y,o.width,o.height,t===!0?"FD":void 0),o.align==="right"?this.text(o.text,o.x+o.width-I,o.y+I,{align:"right",baseline:"top"}):o.align==="center"?this.text(o.text,o.x+o.width/2,o.y+I,{align:"center",baseline:"top",maxWidth:o.width-I-I}):this.text(o.text,o.x+I,o.y+I,{align:"left",baseline:"top",maxWidth:o.width-I-I})),this.internal.__cell__.lastCell=o,this};n.table=function(o,w,I,R,V){if(i.call(this),!I)throw new Error("No data for PDF table.");var k,ie,ae,fe,J=[],ne=[],me=[],ue={},ke={},ze=[],pe=[],U=(V=V||{}).autoSize||!1,F=V.printHeaders!==!1,q=V.css&&V.css["font-size"]!==void 0?16*V.css["font-size"]:V.fontSize||12,j=V.margins||Object.assign({width:this.getPageWidth()},e),H=typeof V.padding=="number"?V.padding:3,Z=V.headerBackgroundColor||"#c8c8c8",be=V.headerTextColor||"#000";if(c.call(this),this.internal.__cell__.printHeaders=F,this.internal.__cell__.margins=j,this.internal.__cell__.table_font_size=q,this.internal.__cell__.padding=H,this.internal.__cell__.headerBackgroundColor=Z,this.internal.__cell__.headerTextColor=be,this.setFontSize(q),R==null)ne=J=Object.keys(I[0]),me=J.map(function(){return"left"});else if(Array.isArray(R)&&wa(R[0])==="object")for(J=R.map(function(nt){return nt.name}),ne=R.map(function(nt){return nt.prompt||nt.name||""}),me=R.map(function(nt){return nt.align||"left"}),k=0;k<R.length;k+=1)ke[R[k].name]=.7499990551181103*R[k].width;else Array.isArray(R)&&typeof R[0]=="string"&&(ne=J=R,me=J.map(function(){return"left"}));if(U||Array.isArray(R)&&typeof R[0]=="string")for(k=0;k<J.length;k+=1){for(ue[fe=J[k]]=I.map(function(nt){return nt[fe]}),this.setFont(void 0,"bold"),ze.push(this.getTextDimensions(ne[k],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),ie=ue[fe],this.setFont(void 0,"normal"),ae=0;ae<ie.length;ae+=1)ze.push(this.getTextDimensions(ie[ae],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);ke[fe]=Math.max.apply(null,ze)+H+H,ze=[]}if(F){var Me={};for(k=0;k<J.length;k+=1)Me[J[k]]={},Me[J[k]].text=ne[k],Me[J[k]].align=me[k];var Be=_.call(this,Me,ke);pe=J.map(function(nt){return new u(o,w,ke[nt],Be,Me[nt].text,void 0,Me[nt].align)}),this.setTableHeaderRow(pe),this.printHeaderRow(1,!1)}var Re=R.reduce(function(nt,xe){return nt[xe.name]=xe.align,nt},{});for(k=0;k<I.length;k+=1){"rowStart"in V&&V.rowStart instanceof Function&&V.rowStart({row:k,data:I[k]},this);var we=_.call(this,I[k],ke);for(ae=0;ae<J.length;ae+=1){var De=I[k][J[ae]];"cellStart"in V&&V.cellStart instanceof Function&&V.cellStart({row:k,col:ae,data:De},this),m.call(this,new u(o,w,ke[J[ae]],we,De,k+2,Re[J[ae]]))}}return this.internal.__cell__.table_x=o,this.internal.__cell__.table_y=w,this};var _=function(o,w){var I=this.internal.__cell__.padding,R=this.internal.__cell__.table_font_size,V=this.internal.scaleFactor;return Object.keys(o).map(function(k){var ie=o[k];return this.splitTextToSize(ie.hasOwnProperty("text")?ie.text:ie,w[k]-I-I)},this).map(function(k){return this.getLineHeightFactor()*k.length*R/V+I+I},this).reduce(function(k,ie){return Math.max(k,ie)},0)};n.setTableHeaderRow=function(o){i.call(this),this.internal.__cell__.tableHeaderRow=o},n.printHeaderRow=function(o,w){if(i.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var I;if(t=!0,typeof this.internal.__cell__.headerFunction=="function"){var R=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new u(R[0],R[1],R[2],R[3],void 0,-1)}this.setFont(void 0,"bold");for(var V=[],k=0;k<this.internal.__cell__.tableHeaderRow.length;k+=1){I=this.internal.__cell__.tableHeaderRow[k].clone(),w&&(I.y=this.internal.__cell__.margins.top||0,V.push(I)),I.lineNumber=o;var ie=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),m.call(this,I),this.setTextColor(ie)}V.length>0&&this.setTableHeaderRow(V),this.setFont(void 0,"normal"),t=!1}})(wi.API);var j6={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},U6=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],S5=z6(U6),V6=[100,200,300,400,500,600,700,800,900],zM=z6(V6);function Ib(n){var e=n.family.replace(/"|'/g,"").toLowerCase(),t=(function(u){return j6[u=u||"normal"]?u:"normal"})(n.style),i=(function(u){return u?typeof u=="number"?u>=100&&u<=900&&u%100==0?u:400:/^\d00$/.test(u)?parseInt(u):u==="bold"?700:400:400})(n.weight),c=(function(u){return typeof S5[u=u||"normal"]=="number"?u:"normal"})(n.stretch);return{family:e,style:t,weight:i,stretch:c,src:n.src||[],ref:n.ref||{name:e,style:[c,t,i].join(" ")}}}function AS(n,e,t,i){var c;for(c=t;c>=0&&c<e.length;c+=i)if(n[e[c]])return n[e[c]];for(c=t;c>=0&&c<e.length;c-=i)if(n[e[c]])return n[e[c]]}var jM={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},TS={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function IS(n){return[n.stretch,n.style,n.weight,n.family].join(" ")}function CS(n){return n.trimLeft()}function UM(n,e){for(var t=0;t<n.length;){if(n.charAt(t)===e)return[n.substring(0,t),n.substring(t+1)];t+=1}return null}function VM(n){var e=n.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return e===null?null:[e[0],n.substring(e[0].length)]}var y1,LS,PS,Gg,_1,kS,MS,RS,Cb=["times"];function NS(n,e,t,i,c){var u=4,m=FS;switch(c){case wi.API.image_compression.FAST:u=1,m=DS;break;case wi.API.image_compression.MEDIUM:u=6,m=OS;break;case wi.API.image_compression.SLOW:u=9,m=BS}n=(function(o,w,I,R){for(var V,k=o.length/w,ie=new Uint8Array(o.length+k),ae=[qM,DS,FS,OS,BS],fe=0;fe<k;fe+=1){var J=fe*w,ne=o.subarray(J,J+w);if(R)ie.set(R(ne,I,V),J+fe);else{for(var me=ae.length,ue=[],ke=0;ke<me;ke+=1)ue[ke]=ae[ke](ne,I,V);var ze=GM(ue.concat());ie.set(ue[ze],J+fe)}V=ne}return ie})(n,e,Math.ceil(t*i/8),m);var _=g5(n,{level:u});return wi.API.__addimage__.arrayBufferToBinaryString(_)}function qM(n){var e=Array.apply([],n);return e.unshift(0),e}function DS(n,e){var t=n.length,i=[];i[0]=1;for(var c=0;c<t;c+=1){var u=n[c-e]||0;i[c+1]=n[c]-u+256&255}return i}function FS(n,e,t){var i=n.length,c=[];c[0]=2;for(var u=0;u<i;u+=1){var m=t&&t[u]||0;c[u+1]=n[u]-m+256&255}return c}function OS(n,e,t){var i=n.length,c=[];c[0]=3;for(var u=0;u<i;u+=1){var m=n[u-e]||0,_=t&&t[u]||0;c[u+1]=n[u]+256-(m+_>>>1)&255}return c}function BS(n,e,t){var i=n.length,c=[];c[0]=4;for(var u=0;u<i;u+=1){var m=$M(n[u-e]||0,t&&t[u]||0,t&&t[u-e]||0);c[u+1]=n[u]-m+256&255}return c}function $M(n,e,t){if(n===e&&e===t)return n;var i=Math.abs(e-t),c=Math.abs(n-t),u=Math.abs(n+e-t-t);return i<=c&&i<=u?n:c<=u?e:t}function GM(n){var e=n.map(function(t){return t.reduce(function(i,c){return i+Math.abs(c)},0)});return e.indexOf(Math.min.apply(null,e))}function Lb(n,e,t){var i=e*t,c=Math.floor(i/8),u=16-(i-8*c+t),m=(1<<t)-1;return q6(n,c)>>u&m}function zS(n,e,t,i){var c=t*i,u=Math.floor(c/8),m=16-(c-8*u+i),_=(1<<i)-1,o=(e&_)<<m;(function(w,I,R){if(I+1<w.byteLength)w.setUint16(I,R,!1);else{var V=R>>8&255;w.setUint8(I,V)}})(n,u,q6(n,u)&~(_<<m)&65535|o)}function q6(n,e){return e+1<n.byteLength?n.getUint16(e,!1):n.getUint8(e)<<8}function HM(n){var e=0;if(n[e++]!==71||n[e++]!==73||n[e++]!==70||n[e++]!==56||(n[e++]+1&253)!=56||n[e++]!==97)throw new Error("Invalid GIF 87a/89a header.");var t=n[e++]|n[e++]<<8,i=n[e++]|n[e++]<<8,c=n[e++],u=c>>7,m=1<<1+(7&c);n[e++],n[e++];var _=null,o=null;u&&(_=e,o=m,e+=3*m);var w=!0,I=[],R=0,V=null,k=0,ie=null;for(this.width=t,this.height=i;w&&e<n.length;)switch(n[e++]){case 33:switch(n[e++]){case 255:if(n[e]!==11||n[e+1]==78&&n[e+2]==69&&n[e+3]==84&&n[e+4]==83&&n[e+5]==67&&n[e+6]==65&&n[e+7]==80&&n[e+8]==69&&n[e+9]==50&&n[e+10]==46&&n[e+11]==48&&n[e+12]==3&&n[e+13]==1&&n[e+16]==0)e+=14,ie=n[e++]|n[e++]<<8,e++;else for(e+=12;;){if(!((j=n[e++])>=0))throw Error("Invalid block size");if(j===0)break;e+=j}break;case 249:if(n[e++]!==4||n[e+4]!==0)throw new Error("Invalid graphics extension block.");var ae=n[e++];R=n[e++]|n[e++]<<8,V=n[e++],1&ae||(V=null),k=ae>>2&7,e++;break;case 254:for(;;){if(!((j=n[e++])>=0))throw Error("Invalid block size");if(j===0)break;e+=j}break;default:throw new Error("Unknown graphic control label: 0x"+n[e-1].toString(16))}break;case 44:var fe=n[e++]|n[e++]<<8,J=n[e++]|n[e++]<<8,ne=n[e++]|n[e++]<<8,me=n[e++]|n[e++]<<8,ue=n[e++],ke=ue>>6&1,ze=1<<1+(7&ue),pe=_,U=o,F=!1;ue>>7&&(F=!0,pe=e,U=ze,e+=3*ze);var q=e;for(e++;;){var j;if(!((j=n[e++])>=0))throw Error("Invalid block size");if(j===0)break;e+=j}I.push({x:fe,y:J,width:ne,height:me,has_local_palette:F,palette_offset:pe,palette_size:U,data_offset:q,data_length:e-q,transparent_index:V,interlaced:!!ke,delay:R,disposal:k});break;case 59:w=!1;break;default:throw new Error("Unknown gif block: 0x"+n[e-1].toString(16))}this.numFrames=function(){return I.length},this.loopCount=function(){return ie},this.frameInfo=function(H){if(H<0||H>=I.length)throw new Error("Frame index out of range.");return I[H]},this.decodeAndBlitFrameBGRA=function(H,Z){var be=this.frameInfo(H),Me=be.width*be.height,Be=new Uint8Array(Me);jS(n,be.data_offset,Be,Me);var Re=be.palette_offset,we=be.transparent_index;we===null&&(we=256);var De=be.width,nt=t-De,xe=De,le=4*(be.y*t+be.x),Ne=4*((be.y+be.height)*t+be.x),Oe=le,Je=4*nt;be.interlaced===!0&&(Je+=4*t*7);for(var rt=8,mt=0,dt=Be.length;mt<dt;++mt){var Dt=Be[mt];if(xe===0&&(xe=De,(Oe+=Je)>=Ne&&(Je=4*nt+4*t*(rt-1),Oe=le+(De+nt)*(rt<<1),rt>>=1)),Dt===we)Oe+=4;else{var tn=n[Re+3*Dt],ln=n[Re+3*Dt+1],yn=n[Re+3*Dt+2];Z[Oe++]=yn,Z[Oe++]=ln,Z[Oe++]=tn,Z[Oe++]=255}--xe}},this.decodeAndBlitFrameRGBA=function(H,Z){var be=this.frameInfo(H),Me=be.width*be.height,Be=new Uint8Array(Me);jS(n,be.data_offset,Be,Me);var Re=be.palette_offset,we=be.transparent_index;we===null&&(we=256);var De=be.width,nt=t-De,xe=De,le=4*(be.y*t+be.x),Ne=4*((be.y+be.height)*t+be.x),Oe=le,Je=4*nt;be.interlaced===!0&&(Je+=4*t*7);for(var rt=8,mt=0,dt=Be.length;mt<dt;++mt){var Dt=Be[mt];if(xe===0&&(xe=De,(Oe+=Je)>=Ne&&(Je=4*nt+4*t*(rt-1),Oe=le+(De+nt)*(rt<<1),rt>>=1)),Dt===we)Oe+=4;else{var tn=n[Re+3*Dt],ln=n[Re+3*Dt+1],yn=n[Re+3*Dt+2];Z[Oe++]=tn,Z[Oe++]=ln,Z[Oe++]=yn,Z[Oe++]=255}--xe}}}function jS(n,e,t,i){for(var c=n[e++],u=1<<c,m=u+1,_=m+1,o=c+1,w=(1<<o)-1,I=0,R=0,V=0,k=n[e++],ie=new Int32Array(4096),ae=null;;){for(;I<16&&k!==0;)R|=n[e++]<<I,I+=8,k===1?k=n[e++]:--k;if(I<o)break;var fe=R&w;if(R>>=o,I-=o,fe!==u){if(fe===m)break;for(var J=fe<_?fe:ae,ne=0,me=J;me>u;)me=ie[me]>>8,++ne;var ue=me;if(V+ne+(J!==fe?1:0)>i)return void Ka.log("Warning, gif stream longer than expected.");t[V++]=ue;var ke=V+=ne;for(J!==fe&&(t[V++]=ue),me=J;ne--;)me=ie[me],t[--ke]=255&me,me>>=8;ae!==null&&_<4096&&(ie[_++]=ae<<8|ue,_>=w+1&&o<12&&(++o,w=w<<1|1)),ae=fe}else _=m+1,w=(1<<(o=c+1))-1,ae=null}return V!==i&&Ka.log("Warning, gif stream shorter than expected."),t}/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function Pb(n){var e,t,i,c,u,m=Math.floor,_=new Array(64),o=new Array(64),w=new Array(64),I=new Array(64),R=new Array(65535),V=new Array(65535),k=new Array(64),ie=new Array(64),ae=[],fe=0,J=7,ne=new Array(64),me=new Array(64),ue=new Array(64),ke=new Array(256),ze=new Array(2048),pe=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],U=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],F=[0,1,2,3,4,5,6,7,8,9,10,11],q=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],j=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],H=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],Z=[0,1,2,3,4,5,6,7,8,9,10,11],be=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],Me=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function Be(le,Ne){for(var Oe=0,Je=0,rt=new Array,mt=1;mt<=16;mt++){for(var dt=1;dt<=le[mt];dt++)rt[Ne[Je]]=[],rt[Ne[Je]][0]=Oe,rt[Ne[Je]][1]=mt,Je++,Oe++;Oe*=2}return rt}function Re(le){for(var Ne=le[0],Oe=le[1]-1;Oe>=0;)Ne&1<<Oe&&(fe|=1<<J),Oe--,--J<0&&(fe==255?(we(255),we(0)):we(fe),J=7,fe=0)}function we(le){ae.push(le)}function De(le){we(le>>8&255),we(255&le)}function nt(le,Ne,Oe,Je,rt){for(var mt,dt=rt[0],Dt=rt[240],tn=(function(Cn,ir){var Jn,Hr,Vt,Ln,$n,Dn,Mr,xr,Sr,Er,Cr=0;for(Sr=0;Sr<8;++Sr){Jn=Cn[Cr],Hr=Cn[Cr+1],Vt=Cn[Cr+2],Ln=Cn[Cr+3],$n=Cn[Cr+4],Dn=Cn[Cr+5],Mr=Cn[Cr+6];var Si=Jn+(xr=Cn[Cr+7]),Li=Jn-xr,or=Hr+Mr,ai=Hr-Mr,qr=Vt+Dn,Dr=Vt-Dn,hi=Ln+$n,li=Ln-$n,lt=Si+hi,Ee=Si-hi,Te=or+qr,et=or-qr;Cn[Cr]=lt+Te,Cn[Cr+4]=lt-Te;var ht=.707106781*(et+Ee);Cn[Cr+2]=Ee+ht,Cn[Cr+6]=Ee-ht;var Ct=.382683433*((lt=li+Dr)-(et=ai+Li)),Rt=.5411961*lt+Ct,Ot=1.306562965*et+Ct,At=.707106781*(Te=Dr+ai),Lt=Li+At,xn=Li-At;Cn[Cr+5]=xn+Rt,Cn[Cr+3]=xn-Rt,Cn[Cr+1]=Lt+Ot,Cn[Cr+7]=Lt-Ot,Cr+=8}for(Cr=0,Sr=0;Sr<8;++Sr){Jn=Cn[Cr],Hr=Cn[Cr+8],Vt=Cn[Cr+16],Ln=Cn[Cr+24],$n=Cn[Cr+32],Dn=Cn[Cr+40],Mr=Cn[Cr+48];var On=Jn+(xr=Cn[Cr+56]),An=Jn-xr,Lr=Hr+Mr,Ir=Hr-Mr,zr=Vt+Dn,wr=Vt-Dn,Ei=Ln+$n,to=Ln-$n,po=On+Ei,Wo=On-Ei,no=Lr+zr,_s=Lr-zr;Cn[Cr]=po+no,Cn[Cr+32]=po-no;var ro=.707106781*(_s+Wo);Cn[Cr+16]=Wo+ro,Cn[Cr+48]=Wo-ro;var Ps=.382683433*((po=to+wr)-(_s=Ir+An)),fa=.5411961*po+Ps,Sl=1.306562965*_s+Ps,al=.707106781*(no=wr+Ir),Vi=An+al,Ql=An-al;Cn[Cr+40]=Ql+fa,Cn[Cr+24]=Ql-fa,Cn[Cr+8]=Vi+Sl,Cn[Cr+56]=Vi-Sl,Cr++}for(Sr=0;Sr<64;++Sr)Er=Cn[Sr]*ir[Sr],k[Sr]=Er>0?Er+.5|0:Er-.5|0;return k})(le,Ne),ln=0;ln<64;++ln)ie[pe[ln]]=tn[ln];var yn=ie[0]-Oe;Oe=ie[0],yn==0?Re(Je[0]):(Re(Je[V[mt=32767+yn]]),Re(R[mt]));for(var Mn=63;Mn>0&&ie[Mn]==0;)Mn--;if(Mn==0)return Re(dt),Oe;for(var Gt,st=1;st<=Mn;){for(var fr=st;ie[st]==0&&st<=Mn;)++st;var br=st-fr;if(br>=16){Gt=br>>4;for(var Tr=1;Tr<=Gt;++Tr)Re(Dt);br&=15}mt=32767+ie[st],Re(rt[(br<<4)+V[mt]]),Re(R[mt]),st++}return Mn!=63&&Re(dt),Oe}function xe(le){le=Math.min(Math.max(le,1),100),u!=le&&((function(Ne){for(var Oe=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],Je=0;Je<64;Je++){var rt=m((Oe[Je]*Ne+50)/100);rt=Math.min(Math.max(rt,1),255),_[pe[Je]]=rt}for(var mt=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],dt=0;dt<64;dt++){var Dt=m((mt[dt]*Ne+50)/100);Dt=Math.min(Math.max(Dt,1),255),o[pe[dt]]=Dt}for(var tn=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],ln=0,yn=0;yn<8;yn++)for(var Mn=0;Mn<8;Mn++)w[ln]=1/(_[pe[ln]]*tn[yn]*tn[Mn]*8),I[ln]=1/(o[pe[ln]]*tn[yn]*tn[Mn]*8),ln++})(le<50?Math.floor(5e3/le):Math.floor(200-2*le)),u=le)}this.encode=function(le,Ne){Ne&&xe(Ne),ae=new Array,fe=0,J=7,De(65496),De(65504),De(16),we(74),we(70),we(73),we(70),we(0),we(1),we(1),we(0),De(1),De(1),we(0),we(0),(function(){De(65499),De(132),we(0);for(var Hr=0;Hr<64;Hr++)we(_[Hr]);we(1);for(var Vt=0;Vt<64;Vt++)we(o[Vt])})(),(function(Hr,Vt){De(65472),De(17),we(8),De(Vt),De(Hr),we(3),we(1),we(17),we(0),we(2),we(17),we(1),we(3),we(17),we(1)})(le.width,le.height),(function(){De(65476),De(418),we(0);for(var Hr=0;Hr<16;Hr++)we(U[Hr+1]);for(var Vt=0;Vt<=11;Vt++)we(F[Vt]);we(16);for(var Ln=0;Ln<16;Ln++)we(q[Ln+1]);for(var $n=0;$n<=161;$n++)we(j[$n]);we(1);for(var Dn=0;Dn<16;Dn++)we(H[Dn+1]);for(var Mr=0;Mr<=11;Mr++)we(Z[Mr]);we(17);for(var xr=0;xr<16;xr++)we(be[xr+1]);for(var Sr=0;Sr<=161;Sr++)we(Me[Sr])})(),De(65498),De(12),we(3),we(1),we(0),we(2),we(17),we(3),we(17),we(0),we(63),we(0);var Oe=0,Je=0,rt=0;fe=0,J=7,this.encode.displayName="_encode_";for(var mt,dt,Dt,tn,ln,yn,Mn,Gt,st,fr=le.data,br=le.width,Tr=le.height,Cn=4*br,ir=0;ir<Tr;){for(mt=0;mt<Cn;){for(ln=Cn*ir+mt,Mn=-1,Gt=0,st=0;st<64;st++)yn=ln+(Gt=st>>3)*Cn+(Mn=4*(7&st)),ir+Gt>=Tr&&(yn-=Cn*(ir+1+Gt-Tr)),mt+Mn>=Cn&&(yn-=mt+Mn-Cn+4),dt=fr[yn++],Dt=fr[yn++],tn=fr[yn++],ne[st]=(ze[dt]+ze[Dt+256|0]+ze[tn+512|0]>>16)-128,me[st]=(ze[dt+768|0]+ze[Dt+1024|0]+ze[tn+1280|0]>>16)-128,ue[st]=(ze[dt+1280|0]+ze[Dt+1536|0]+ze[tn+1792|0]>>16)-128;Oe=nt(ne,w,Oe,e,i),Je=nt(me,I,Je,t,c),rt=nt(ue,I,rt,t,c),mt+=32}ir+=8}if(J>=0){var Jn=[];Jn[1]=J+1,Jn[0]=(1<<J+1)-1,Re(Jn)}return De(65497),new Uint8Array(ae)},n=n||50,(function(){for(var le=String.fromCharCode,Ne=0;Ne<256;Ne++)ke[Ne]=le(Ne)})(),e=Be(U,F),t=Be(H,Z),i=Be(q,j),c=Be(be,Me),(function(){for(var le=1,Ne=2,Oe=1;Oe<=15;Oe++){for(var Je=le;Je<Ne;Je++)V[32767+Je]=Oe,R[32767+Je]=[],R[32767+Je][1]=Oe,R[32767+Je][0]=Je;for(var rt=-(Ne-1);rt<=-le;rt++)V[32767+rt]=Oe,R[32767+rt]=[],R[32767+rt][1]=Oe,R[32767+rt][0]=Ne-1+rt;le<<=1,Ne<<=1}})(),(function(){for(var le=0;le<256;le++)ze[le]=19595*le,ze[le+256|0]=38470*le,ze[le+512|0]=7471*le+32768,ze[le+768|0]=-11059*le,ze[le+1024|0]=-21709*le,ze[le+1280|0]=32768*le+8421375,ze[le+1536|0]=-27439*le,ze[le+1792|0]=-5329*le})(),xe(n)}/**
 * @license
 * Copyright (c) 2017 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */function Hd(n,e){if(this.pos=0,this.buffer=n,this.datav=new DataView(n.buffer),this.is_with_alpha=!!e,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function US(n){function e(F){if(!F)throw Error("assert :P")}function t(F,q,j){for(var H=0;4>H;H++)if(F[q+H]!=j.charCodeAt(H))return!0;return!1}function i(F,q,j,H,Z){for(var be=0;be<Z;be++)F[q+be]=j[H+be]}function c(F,q,j,H){for(var Z=0;Z<H;Z++)F[q+Z]=j}function u(F){return new Int32Array(F)}function m(F,q){for(var j=[],H=0;H<F;H++)j.push(new q);return j}function _(F,q){var j=[];return(function H(Z,be,Me){for(var Be=Me[be],Re=0;Re<Be&&(Z.push(Me.length>be+1?[]:new q),!(Me.length<be+1));Re++)H(Z[Re],be+1,Me)})(j,0,F),j}var o=function(){var F=this;function q(C,B){for(var ee=1<<B-1>>>0;C&ee;)ee>>>=1;return ee?(C&ee-1)+ee:C}function j(C,B,ee,oe,Pe){e(!(oe%ee));do C[B+(oe-=ee)]=Pe;while(0<oe)}function H(C,B,ee,oe,Pe){if(e(2328>=Pe),512>=Pe)var je=u(512);else if((je=u(Pe))==null)return 0;return(function(Ke,Ye,tt,ut,Nt,rn){var ft,zt,Jt=Ye,En=1<<tt,y=u(16),a=u(16);for(e(Nt!=0),e(ut!=null),e(Ke!=null),e(0<tt),zt=0;zt<Nt;++zt){if(15<ut[zt])return 0;++y[ut[zt]]}if(y[0]==Nt)return 0;for(a[1]=0,ft=1;15>ft;++ft){if(y[ft]>1<<ft)return 0;a[ft+1]=a[ft]+y[ft]}for(zt=0;zt<Nt;++zt)ft=ut[zt],0<ut[zt]&&(rn[a[ft]++]=zt);if(a[15]==1)return(ut=new Z).g=0,ut.value=rn[0],j(Ke,Jt,1,En,ut),En;var f,v=-1,S=En-1,T=0,N=1,z=1,$=1<<tt;for(zt=0,ft=1,Nt=2;ft<=tt;++ft,Nt<<=1){if(N+=z<<=1,0>(z-=y[ft]))return 0;for(;0<y[ft];--y[ft])(ut=new Z).g=ft,ut.value=rn[zt++],j(Ke,Jt+T,Nt,$,ut),T=q(T,ft)}for(ft=tt+1,Nt=2;15>=ft;++ft,Nt<<=1){if(N+=z<<=1,0>(z-=y[ft]))return 0;for(;0<y[ft];--y[ft]){if(ut=new Z,(T&S)!=v){for(Jt+=$,f=1<<(v=ft)-tt;15>v&&!(0>=(f-=y[v]));)++v,f<<=1;En+=$=1<<(f=v-tt),Ke[Ye+(v=T&S)].g=f+tt,Ke[Ye+v].value=Jt-Ye-v}ut.g=ft-tt,ut.value=rn[zt++],j(Ke,Jt+(T>>tt),Nt,$,ut),T=q(T,ft)}}return N!=2*a[15]-1?0:En})(C,B,ee,oe,Pe,je)}function Z(){this.value=this.g=0}function be(){this.value=this.g=0}function Me(){this.G=m(5,Z),this.H=u(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=m(Nl,be)}function Be(C,B,ee,oe){e(C!=null),e(B!=null),e(2147483648>oe),C.Ca=254,C.I=0,C.b=-8,C.Ka=0,C.oa=B,C.pa=ee,C.Jd=B,C.Yc=ee+oe,C.Zc=4<=oe?ee+oe-4+1:ee,dt(C)}function Re(C,B){for(var ee=0;0<B--;)ee|=tn(C,128)<<B;return ee}function we(C,B){var ee=Re(C,B);return Dt(C)?-ee:ee}function De(C,B,ee,oe){var Pe,je=0;for(e(C!=null),e(B!=null),e(4294967288>oe),C.Sb=oe,C.Ra=0,C.u=0,C.h=0,4<oe&&(oe=4),Pe=0;Pe<oe;++Pe)je+=B[ee+Pe]<<8*Pe;C.Ra=je,C.bb=oe,C.oa=B,C.pa=ee}function nt(C){for(;8<=C.u&&C.bb<C.Sb;)C.Ra>>>=8,C.Ra+=C.oa[C.pa+C.bb]<<aa-8>>>0,++C.bb,C.u-=8;Je(C)&&(C.h=1,C.u=0)}function xe(C,B){if(e(0<=B),!C.h&&B<=No){var ee=Oe(C)&dl[B];return C.u+=B,nt(C),ee}return C.h=1,C.u=0}function le(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function Ne(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function Oe(C){return C.Ra>>>(C.u&aa-1)>>>0}function Je(C){return e(C.bb<=C.Sb),C.h||C.bb==C.Sb&&C.u>aa}function rt(C,B){C.u=B,C.h=Je(C)}function mt(C){C.u>=Dl&&(e(C.u>=Dl),nt(C))}function dt(C){e(C!=null&&C.oa!=null),C.pa<C.Zc?(C.I=(C.oa[C.pa++]|C.I<<8)>>>0,C.b+=8):(e(C!=null&&C.oa!=null),C.pa<C.Yc?(C.b+=8,C.I=C.oa[C.pa++]|C.I<<8):C.Ka?C.b=0:(C.I<<=8,C.b+=8,C.Ka=1))}function Dt(C){return Re(C,1)}function tn(C,B){var ee=C.Ca;0>C.b&&dt(C);var oe=C.b,Pe=ee*B>>>8,je=(C.I>>>oe>Pe)+0;for(je?(ee-=Pe,C.I-=Pe+1<<oe>>>0):ee=Pe+1,oe=ee,Pe=0;256<=oe;)Pe+=8,oe>>=8;return oe=7^Pe+Ec[oe],C.b-=oe,C.Ca=(ee<<oe)-1,je}function ln(C,B,ee){C[B+0]=ee>>24&255,C[B+1]=ee>>16&255,C[B+2]=ee>>8&255,C[B+3]=255&ee}function yn(C,B){return C[B+0]|C[B+1]<<8}function Mn(C,B){return yn(C,B)|C[B+2]<<16}function Gt(C,B){return yn(C,B)|yn(C,B+2)<<16}function st(C,B){var ee=1<<B;return e(C!=null),e(0<B),C.X=u(ee),C.X==null?0:(C.Mb=32-B,C.Xa=B,1)}function fr(C,B){e(C!=null),e(B!=null),e(C.Xa==B.Xa),i(B.X,0,C.X,0,1<<B.Xa)}function br(){this.X=[],this.Xa=this.Mb=0}function Tr(C,B,ee,oe){e(ee!=null),e(oe!=null);var Pe=ee[0],je=oe[0];return Pe==0&&(Pe=(C*je+B/2)/B),je==0&&(je=(B*Pe+C/2)/C),0>=Pe||0>=je?0:(ee[0]=Pe,oe[0]=je,1)}function Cn(C,B){return C+(1<<B)-1>>>B}function ir(C,B){return((4278255360&C)+(4278255360&B)>>>0&4278255360)+((16711935&C)+(16711935&B)>>>0&16711935)>>>0}function Jn(C,B){F[B]=function(ee,oe,Pe,je,Ke,Ye,tt){var ut;for(ut=0;ut<Ke;++ut){var Nt=F[C](Ye[tt+ut-1],Pe,je+ut);Ye[tt+ut]=ir(ee[oe+ut],Nt)}}}function Hr(){this.ud=this.hd=this.jd=0}function Vt(C,B){return((4278124286&(C^B))>>>1)+(C&B)>>>0}function Ln(C){return 0<=C&&256>C?C:0>C?0:255<C?255:void 0}function $n(C,B){return Ln(C+(C-B+.5>>1))}function Dn(C,B,ee){return Math.abs(B-ee)-Math.abs(C-ee)}function Mr(C,B,ee,oe,Pe,je,Ke){for(oe=je[Ke-1],ee=0;ee<Pe;++ee)je[Ke+ee]=oe=ir(C[B+ee],oe)}function xr(C,B,ee,oe,Pe){var je;for(je=0;je<ee;++je){var Ke=C[B+je],Ye=Ke>>8&255,tt=16711935&(tt=(tt=16711935&Ke)+((Ye<<16)+Ye));oe[Pe+je]=(4278255360&Ke)+tt>>>0}}function Sr(C,B){B.jd=255&C,B.hd=C>>8&255,B.ud=C>>16&255}function Er(C,B,ee,oe,Pe,je){var Ke;for(Ke=0;Ke<oe;++Ke){var Ye=B[ee+Ke],tt=Ye>>>8,ut=Ye,Nt=255&(Nt=(Nt=Ye>>>16)+((C.jd<<24>>24)*(tt<<24>>24)>>>5));ut=255&(ut=(ut+=(C.hd<<24>>24)*(tt<<24>>24)>>>5)+((C.ud<<24>>24)*(Nt<<24>>24)>>>5)),Pe[je+Ke]=(4278255360&Ye)+(Nt<<16)+ut}}function Cr(C,B,ee,oe,Pe){F[B]=function(je,Ke,Ye,tt,ut,Nt,rn,ft,zt){for(tt=rn;tt<ft;++tt)for(rn=0;rn<zt;++rn)ut[Nt++]=Pe(Ye[oe(je[Ke++])])},F[C]=function(je,Ke,Ye,tt,ut,Nt,rn){var ft=8>>je.b,zt=je.Ea,Jt=je.K[0],En=je.w;if(8>ft)for(je=(1<<je.b)-1,En=(1<<ft)-1;Ke<Ye;++Ke){var y,a=0;for(y=0;y<zt;++y)y&je||(a=oe(tt[ut++])),Nt[rn++]=Pe(Jt[a&En]),a>>=ft}else F["VP8LMapColor"+ee](tt,ut,Jt,En,Nt,rn,Ke,Ye,zt)}}function Si(C,B,ee,oe,Pe){for(ee=B+ee;B<ee;){var je=C[B++];oe[Pe++]=je>>16&255,oe[Pe++]=je>>8&255,oe[Pe++]=255&je}}function Li(C,B,ee,oe,Pe){for(ee=B+ee;B<ee;){var je=C[B++];oe[Pe++]=je>>16&255,oe[Pe++]=je>>8&255,oe[Pe++]=255&je,oe[Pe++]=je>>24&255}}function or(C,B,ee,oe,Pe){for(ee=B+ee;B<ee;){var je=(Ke=C[B++])>>16&240|Ke>>12&15,Ke=240&Ke|Ke>>28&15;oe[Pe++]=je,oe[Pe++]=Ke}}function ai(C,B,ee,oe,Pe){for(ee=B+ee;B<ee;){var je=(Ke=C[B++])>>16&248|Ke>>13&7,Ke=Ke>>5&224|Ke>>3&31;oe[Pe++]=je,oe[Pe++]=Ke}}function qr(C,B,ee,oe,Pe){for(ee=B+ee;B<ee;){var je=C[B++];oe[Pe++]=255&je,oe[Pe++]=je>>8&255,oe[Pe++]=je>>16&255}}function Dr(C,B,ee,oe,Pe,je){if(je==0)for(ee=B+ee;B<ee;)ln(oe,((je=C[B++])[0]>>24|je[1]>>8&65280|je[2]<<8&16711680|je[3]<<24)>>>0),Pe+=32;else i(oe,Pe,C,B,ee)}function hi(C,B){F[B][0]=F[C+"0"],F[B][1]=F[C+"1"],F[B][2]=F[C+"2"],F[B][3]=F[C+"3"],F[B][4]=F[C+"4"],F[B][5]=F[C+"5"],F[B][6]=F[C+"6"],F[B][7]=F[C+"7"],F[B][8]=F[C+"8"],F[B][9]=F[C+"9"],F[B][10]=F[C+"10"],F[B][11]=F[C+"11"],F[B][12]=F[C+"12"],F[B][13]=F[C+"13"],F[B][14]=F[C+"0"],F[B][15]=F[C+"0"]}function li(C){return C==Ic||C==sc||C==Ii||C==za}function lt(){this.eb=[],this.size=this.A=this.fb=0}function Ee(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function Te(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new lt,this.f.kb=new Ee,this.sd=null}function et(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function ht(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function Ct(C){return alert("todo:WebPSamplerProcessPlane"),C.T}function Rt(C,B){var ee=C.T,oe=B.ba.f.RGBA,Pe=oe.eb,je=oe.fb+C.ka*oe.A,Ke=zl[B.ba.S],Ye=C.y,tt=C.O,ut=C.f,Nt=C.N,rn=C.ea,ft=C.W,zt=B.cc,Jt=B.dc,En=B.Mc,y=B.Nc,a=C.ka,f=C.ka+C.T,v=C.U,S=v+1>>1;for(a==0?Ke(Ye,tt,null,null,ut,Nt,rn,ft,ut,Nt,rn,ft,Pe,je,null,null,v):(Ke(B.ec,B.fc,Ye,tt,zt,Jt,En,y,ut,Nt,rn,ft,Pe,je-oe.A,Pe,je,v),++ee);a+2<f;a+=2)zt=ut,Jt=Nt,En=rn,y=ft,Nt+=C.Rc,ft+=C.Rc,je+=2*oe.A,Ke(Ye,(tt+=2*C.fa)-C.fa,Ye,tt,zt,Jt,En,y,ut,Nt,rn,ft,Pe,je-oe.A,Pe,je,v);return tt+=C.fa,C.j+f<C.o?(i(B.ec,B.fc,Ye,tt,v),i(B.cc,B.dc,ut,Nt,S),i(B.Mc,B.Nc,rn,ft,S),ee--):1&f||Ke(Ye,tt,null,null,ut,Nt,rn,ft,ut,Nt,rn,ft,Pe,je+oe.A,null,null,v),ee}function Ot(C,B,ee){var oe=C.F,Pe=[C.J];if(oe!=null){var je=C.U,Ke=B.ba.S,Ye=Ke==_a||Ke==Ii;B=B.ba.f.RGBA;var tt=[0],ut=C.ka;tt[0]=C.T,C.Kb&&(ut==0?--tt[0]:(--ut,Pe[0]-=C.width),C.j+C.ka+C.T==C.o&&(tt[0]=C.o-C.j-ut));var Nt=B.eb;ut=B.fb+ut*B.A,C=Ws(oe,Pe[0],C.width,je,tt,Nt,ut+(Ye?0:3),B.A),e(ee==tt),C&&li(Ke)&&As(Nt,ut,Ye,je,tt,B.A)}return 0}function At(C){var B=C.ma,ee=B.ba.S,oe=11>ee,Pe=ee==La||ee==ml||ee==_a||ee==Bo||ee==12||li(ee);if(B.memory=null,B.Ib=null,B.Jb=null,B.Nd=null,!Ia(B.Oa,C,Pe?11:12))return 0;if(Pe&&li(ee)&&jc(),C.da)alert("todo:use_scaling");else{if(oe){if(B.Ib=Ct,C.Kb){if(ee=C.U+1>>1,B.memory=u(C.U+2*ee),B.memory==null)return 0;B.ec=B.memory,B.fc=0,B.cc=B.ec,B.dc=B.fc+C.U,B.Mc=B.cc,B.Nc=B.dc+ee,B.Ib=Rt,jc()}}else alert("todo:EmitYUV");Pe&&(B.Jb=Ot,oe&&qo())}if(oe&&!Ua){for(C=0;256>C;++C)yl[C]=89858*(C-128)+lc>>Lc,_l[C]=-22014*(C-128)+lc,rl[C]=-45773*(C-128),qc[C]=113618*(C-128)+lc>>Lc;for(C=Ao;C<$i;++C)B=76283*(C-16)+lc>>Lc,Sh[C-Ao]=Di(B,255),Ul[C-Ao]=Di(B+8>>4,15);Ua=1}return 1}function Lt(C){var B=C.ma,ee=C.U,oe=C.T;return e(!(1&C.ka)),0>=ee||0>=oe?0:(ee=B.Ib(C,B),B.Jb!=null&&B.Jb(C,B,ee),B.Dc+=ee,1)}function xn(C){C.ma.memory=null}function On(C,B,ee,oe){return xe(C,8)!=47?0:(B[0]=xe(C,14)+1,ee[0]=xe(C,14)+1,oe[0]=xe(C,1),xe(C,3)!=0?0:!C.h)}function An(C,B){if(4>C)return C+1;var ee=C-2>>1;return(2+(1&C)<<ee)+xe(B,ee)+1}function Lr(C,B){return 120<B?B-120:1<=(ee=((ee=gl[B-1])>>4)*C+(8-(15&ee)))?ee:1;var ee}function Ir(C,B,ee){var oe=Oe(ee),Pe=C[B+=255&oe].g-8;return 0<Pe&&(rt(ee,ee.u+8),oe=Oe(ee),B+=C[B].value,B+=oe&(1<<Pe)-1),rt(ee,ee.u+C[B].g),C[B].value}function zr(C,B,ee){return ee.g+=C.g,ee.value+=C.value<<B>>>0,e(8>=ee.g),C.g}function wr(C,B,ee){var oe=C.xc;return e((B=oe==0?0:C.vc[C.md*(ee>>oe)+(B>>oe)])<C.Wb),C.Ya[B]}function Ei(C,B,ee,oe){var Pe=C.ab,je=C.c*B,Ke=C.C;B=Ke+B;var Ye=ee,tt=oe;for(oe=C.Ta,ee=C.Ua;0<Pe--;){var ut=C.gc[Pe],Nt=Ke,rn=B,ft=Ye,zt=tt,Jt=(tt=oe,Ye=ee,ut.Ea);switch(e(Nt<rn),e(rn<=ut.nc),ut.hc){case 2:$o(ft,zt,(rn-Nt)*Jt,tt,Ye);break;case 0:var En=Nt,y=rn,a=tt,f=Ye,v=($=ut).Ea;En==0&&(ma(ft,zt,null,null,1,a,f),Mr(ft,zt+1,0,0,v-1,a,f+1),zt+=v,f+=v,++En);for(var S=1<<$.b,T=S-1,N=Cn(v,$.b),z=$.K,$=$.w+(En>>$.b)*N;En<y;){var Q=z,te=$,ge=1;for(Lo(ft,zt,a,f-v,1,a,f);ge<v;){var Ae=(ge&~T)+S;Ae>v&&(Ae=v),(0,el[Q[te++]>>8&15])(ft,zt+ +ge,a,f+ge-v,Ae-ge,a,f+ge),ge=Ae}zt+=v,f+=v,++En&T||($+=N)}rn!=ut.nc&&i(tt,Ye-Jt,tt,Ye+(rn-Nt-1)*Jt,Jt);break;case 1:for(Jt=ft,y=zt,v=(ft=ut.Ea)-(f=ft&~(a=(zt=1<<ut.b)-1)),En=Cn(ft,ut.b),S=ut.K,ut=ut.w+(Nt>>ut.b)*En;Nt<rn;){for(T=S,N=ut,z=new Hr,$=y+f,Q=y+ft;y<$;)Sr(T[N++],z),Ac(z,Jt,y,zt,tt,Ye),y+=zt,Ye+=zt;y<Q&&(Sr(T[N++],z),Ac(z,Jt,y,v,tt,Ye),y+=v,Ye+=v),++Nt&a||(ut+=En)}break;case 3:if(ft==tt&&zt==Ye&&0<ut.b){for(y=tt,ft=Jt=Ye+(rn-Nt)*Jt-(f=(rn-Nt)*Cn(ut.Ea,ut.b)),zt=tt,a=Ye,En=[],f=(v=f)-1;0<=f;--f)En[f]=zt[a+f];for(f=v-1;0<=f;--f)y[ft+f]=En[f];Ca(ut,Nt,rn,tt,Jt,tt,Ye)}else Ca(ut,Nt,rn,ft,zt,tt,Ye)}Ye=oe,tt=ee}tt!=ee&&i(oe,ee,Ye,tt,je)}function to(C,B){var ee=C.V,oe=C.Ba+C.c*C.C,Pe=B-C.C;if(e(B<=C.l.o),e(16>=Pe),0<Pe){var je=C.l,Ke=C.Ta,Ye=C.Ua,tt=je.width;if(Ei(C,Pe,ee,oe),Pe=Ye=[Ye],e((ee=C.C)<(oe=B)),e(je.v<je.va),oe>je.o&&(oe=je.o),ee<je.j){var ut=je.j-ee;ee=je.j,Pe[0]+=ut*tt}if(ee>=oe?ee=0:(Pe[0]+=4*je.v,je.ka=ee-je.j,je.U=je.va-je.v,je.T=oe-ee,ee=1),ee){if(Ye=Ye[0],11>(ee=C.ca).S){var Nt=ee.f.RGBA,rn=(oe=ee.S,Pe=je.U,je=je.T,ut=Nt.eb,Nt.A),ft=je;for(Nt=Nt.fb+C.Ma*Nt.A;0<ft--;){var zt=Ke,Jt=Ye,En=Pe,y=ut,a=Nt;switch(oe){case iu:Al(zt,Jt,En,y,a);break;case La:pl(zt,Jt,En,y,a);break;case Ic:pl(zt,Jt,En,y,a),As(y,a,0,En,1,0);break;case Ar:_u(zt,Jt,En,y,a);break;case ml:Dr(zt,Jt,En,y,a,1);break;case sc:Dr(zt,Jt,En,y,a,1),As(y,a,0,En,1,0);break;case _a:Dr(zt,Jt,En,y,a,0);break;case Ii:Dr(zt,Jt,En,y,a,0),As(y,a,1,En,1,0);break;case Bo:ic(zt,Jt,En,y,a);break;case za:ic(zt,Jt,En,y,a),Bl(y,a,En,1,0);break;case Fu:Fl(zt,Jt,En,y,a);break;default:e(0)}Ye+=tt,Nt+=rn}C.Ma+=je}else alert("todo:EmitRescaledRowsYUVA");e(C.Ma<=ee.height)}}C.C=B,e(C.C<=C.i)}function po(C){var B;if(0<C.ua)return 0;for(B=0;B<C.Wb;++B){var ee=C.Ya[B].G,oe=C.Ya[B].H;if(0<ee[1][oe[1]+0].g||0<ee[2][oe[2]+0].g||0<ee[3][oe[3]+0].g)return 0}return 1}function Wo(C,B,ee,oe,Pe,je){if(C.Z!=0){var Ke=C.qd,Ye=C.rd;for(e(xa[C.Z]!=null);B<ee;++B)xa[C.Z](Ke,Ye,oe,Pe,oe,Pe,je),Ke=oe,Ye=Pe,Pe+=je;C.qd=Ke,C.rd=Ye}}function no(C,B){var ee=C.l.ma,oe=ee.Z==0||ee.Z==1?C.l.j:C.C;if(oe=C.C<oe?oe:C.C,e(B<=C.l.o),B>oe){var Pe=C.l.width,je=ee.ca,Ke=ee.tb+Pe*oe,Ye=C.V,tt=C.Ba+C.c*oe,ut=C.gc;e(C.ab==1),e(ut[0].hc==3),fl(ut[0],oe,B,Ye,tt,je,Ke),Wo(ee,oe,B,je,Ke,Pe)}C.C=C.Ma=B}function _s(C,B,ee,oe,Pe,je,Ke){var Ye=C.$/oe,tt=C.$%oe,ut=C.m,Nt=C.s,rn=ee+C.$,ft=rn;Pe=ee+oe*Pe;var zt=ee+oe*je,Jt=280+Nt.ua,En=C.Pb?Ye:16777216,y=0<Nt.ua?Nt.Wa:null,a=Nt.wc,f=rn<zt?wr(Nt,tt,Ye):null;e(C.C<je),e(zt<=Pe);var v=!1;e:for(;;){for(;v||rn<zt;){var S=0;if(Ye>=En){var T=rn-ee;e((En=C).Pb),En.wd=En.m,En.xd=T,0<En.s.ua&&fr(En.s.Wa,En.s.vb),En=Ye+ii}if(tt&a||(f=wr(Nt,tt,Ye)),e(f!=null),f.Qb&&(B[rn]=f.qb,v=!0),!v)if(mt(ut),f.jc){S=ut,T=B;var N=rn,z=f.pd[Oe(S)&Nl-1];e(f.jc),256>z.g?(rt(S,S.u+z.g),T[N]=z.value,S=0):(rt(S,S.u+z.g-256),e(256<=z.value),S=z.value),S==0&&(v=!0)}else S=Ir(f.G[0],f.H[0],ut);if(ut.h)break;if(v||256>S){if(!v)if(f.nd)B[rn]=(f.qb|S<<8)>>>0;else{if(mt(ut),v=Ir(f.G[1],f.H[1],ut),mt(ut),T=Ir(f.G[2],f.H[2],ut),N=Ir(f.G[3],f.H[3],ut),ut.h)break;B[rn]=(N<<24|v<<16|S<<8|T)>>>0}if(v=!1,++rn,++tt>=oe&&(tt=0,++Ye,Ke!=null&&Ye<=je&&!(Ye%16)&&Ke(C,Ye),y!=null))for(;ft<rn;)S=B[ft++],y.X[(506832829*S&4294967295)>>>y.Mb]=S}else if(280>S){if(S=An(S-256,ut),T=Ir(f.G[4],f.H[4],ut),mt(ut),T=Lr(oe,T=An(T,ut)),ut.h)break;if(rn-ee<T||Pe-rn<S)break e;for(N=0;N<S;++N)B[rn+N]=B[rn+N-T];for(rn+=S,tt+=S;tt>=oe;)tt-=oe,++Ye,Ke!=null&&Ye<=je&&!(Ye%16)&&Ke(C,Ye);if(e(rn<=Pe),tt&a&&(f=wr(Nt,tt,Ye)),y!=null)for(;ft<rn;)S=B[ft++],y.X[(506832829*S&4294967295)>>>y.Mb]=S}else{if(!(S<Jt))break e;for(v=S-280,e(y!=null);ft<rn;)S=B[ft++],y.X[(506832829*S&4294967295)>>>y.Mb]=S;S=rn,e(!(v>>>(T=y).Xa)),B[S]=T.X[v],v=!0}v||e(ut.h==Je(ut))}if(C.Pb&&ut.h&&rn<Pe)e(C.m.h),C.a=5,C.m=C.wd,C.$=C.xd,0<C.s.ua&&fr(C.s.vb,C.s.Wa);else{if(ut.h)break e;Ke?.(C,Ye>je?je:Ye),C.a=0,C.$=rn-ee}return 1}return C.a=3,0}function ro(C){e(C!=null),C.vc=null,C.yc=null,C.Ya=null;var B=C.Wa;B!=null&&(B.X=null),C.vb=null,e(C!=null)}function Ps(){var C=new $r;return C==null?null:(C.a=0,C.xb=ou,hi("Predictor","VP8LPredictors"),hi("Predictor","VP8LPredictors_C"),hi("PredictorAdd","VP8LPredictorsAdd"),hi("PredictorAdd","VP8LPredictorsAdd_C"),$o=xr,Ac=Er,Al=Si,pl=Li,ic=or,Fl=ai,_u=qr,F.VP8LMapColor32b=rc,F.VP8LMapColor8b=Nu,C)}function fa(C,B,ee,oe,Pe){var je=1,Ke=[C],Ye=[B],tt=oe.m,ut=oe.s,Nt=null,rn=0;e:for(;;){if(ee)for(;je&&xe(tt,1);){var ft=Ke,zt=Ye,Jt=oe,En=1,y=Jt.m,a=Jt.gc[Jt.ab],f=xe(y,2);if(Jt.Oc&1<<f)je=0;else{switch(Jt.Oc|=1<<f,a.hc=f,a.Ea=ft[0],a.nc=zt[0],a.K=[null],++Jt.ab,e(4>=Jt.ab),f){case 0:case 1:a.b=xe(y,3)+2,En=fa(Cn(a.Ea,a.b),Cn(a.nc,a.b),0,Jt,a.K),a.K=a.K[0];break;case 3:var v,S=xe(y,8)+1,T=16<S?0:4<S?1:2<S?2:3;if(ft[0]=Cn(a.Ea,T),a.b=T,v=En=fa(S,1,0,Jt,a.K)){var N,z=S,$=a,Q=1<<(8>>$.b),te=u(Q);if(te==null)v=0;else{var ge=$.K[0],Ae=$.w;for(te[0]=$.K[0][0],N=1;N<1*z;++N)te[N]=ir(ge[Ae+N],te[N-1]);for(;N<4*Q;++N)te[N]=0;$.K[0]=null,$.K[0]=te,v=1}}En=v;break;case 2:break;default:e(0)}je=En}}if(Ke=Ke[0],Ye=Ye[0],je&&xe(tt,1)&&!(je=1<=(rn=xe(tt,4))&&11>=rn)){oe.a=3;break e}var Le;if(Le=je)t:{var Ze,Ue,Xe,_e=oe,Ge=Ke,it=Ye,ot=rn,bt=ee,wt=_e.m,_t=_e.s,Pt=[null],kt=1,jt=0,_n=Jh[ot];n:for(;;){if(bt&&xe(wt,1)){var Ut=xe(wt,3)+2,cn=Cn(Ge,Ut),Wt=Cn(it,Ut),In=cn*Wt;if(!fa(cn,Wt,0,_e,Pt))break n;for(Pt=Pt[0],_t.xc=Ut,Ze=0;Ze<In;++Ze){var Bt=Pt[Ze]>>8&65535;Pt[Ze]=Bt,Bt>=kt&&(kt=Bt+1)}}if(wt.h)break n;for(Ue=0;5>Ue;++Ue){var Yt=Ns[Ue];!Ue&&0<ot&&(Yt+=1<<ot),jt<Yt&&(jt=Yt)}var Tn=m(kt*_n,Z),bn=kt,Rn=m(bn,Me);if(Rn==null)var hr=null;else e(65536>=bn),hr=Rn;var mr=u(jt);if(hr==null||mr==null||Tn==null){_e.a=1;break n}var sr=Tn;for(Ze=Xe=0;Ze<kt;++Ze){var dr=hr[Ze],oi=dr.G,di=dr.H,_r=0,Zr=1,Pi=0;for(Ue=0;5>Ue;++Ue){Yt=Ns[Ue],oi[Ue]=sr,di[Ue]=Xe,!Ue&&0<ot&&(Yt+=1<<ot);i:{var io,oo=Yt,ua=_e,us=mr,uc=sr,Pc=Xe,Ci=0,Qi=ua.m,bo=xe(Qi,1);if(c(us,0,0,oo),bo){var Ts=xe(Qi,1)+1,Va=xe(Qi,1),ts=xe(Qi,Va==0?1:8);us[ts]=1,Ts==2&&(us[ts=xe(Qi,8)]=1);var ps=1}else{var hs=u(19),bs=xe(Qi,4)+4;if(19<bs){ua.a=3;var zo=0;break i}for(io=0;io<bs;++io)hs[va[io]]=xe(Qi,3);var ql=void 0,Il=void 0,Gc=ua,_d=hs,Xs=oo,jh=us,vd=0,Bu=Gc.m,au=8,hc=m(128,Z);r:for(;H(hc,0,7,_d,19);){if(xe(Bu,1)){var Uh=2+2*xe(Bu,3);if((ql=2+xe(Bu,Uh))>Xs)break r}else ql=Xs;for(Il=0;Il<Xs&&ql--;){mt(Bu);var Eh=hc[0+(127&Oe(Bu))];rt(Bu,Bu.u+Eh.g);var dc=Eh.value;if(16>dc)jh[Il++]=dc,dc!=0&&(au=dc);else{var ed=dc==16,lu=dc-16,Ah=Rs[lu],lf=xe(Bu,Un[lu])+Ah;if(Il+lf>Xs)break r;for(var td=ed?au:0;0<lf--;)jh[Il++]=td}}vd=1;break r}vd||(Gc.a=3),ps=vd}(ps=ps&&!Qi.h)&&(Ci=H(uc,Pc,8,us,oo)),ps&&Ci!=0?zo=Ci:(ua.a=3,zo=0)}if(zo==0)break n;if(Zr&&lo[Ue]==1&&(Zr=sr[Xe].g==0),_r+=sr[Xe].g,Xe+=zo,3>=Ue){var xd,nd=mr[0];for(xd=1;xd<Yt;++xd)mr[xd]>nd&&(nd=mr[xd]);Pi+=nd}}if(dr.nd=Zr,dr.Qb=0,Zr&&(dr.qb=(oi[3][di[3]+0].value<<24|oi[1][di[1]+0].value<<16|oi[2][di[2]+0].value)>>>0,_r==0&&256>oi[0][di[0]+0].value&&(dr.Qb=1,dr.qb+=oi[0][di[0]+0].value<<8)),dr.jc=!dr.Qb&&6>Pi,dr.jc){var rh,kc=dr;for(rh=0;rh<Nl;++rh){var cu=rh,fc=kc.pd[cu],pc=kc.G[0][kc.H[0]+cu];256<=pc.value?(fc.g=pc.g+256,fc.value=pc.value):(fc.g=0,fc.value=0,cu>>=zr(pc,8,fc),cu>>=zr(kc.G[1][kc.H[1]+cu],16,fc),cu>>=zr(kc.G[2][kc.H[2]+cu],0,fc),zr(kc.G[3][kc.H[3]+cu],24,fc))}}}_t.vc=Pt,_t.Wb=kt,_t.Ya=hr,_t.yc=Tn,Le=1;break t}Le=0}if(!(je=Le)){oe.a=3;break e}if(0<rn){if(ut.ua=1<<rn,!st(ut.Wa,rn)){oe.a=1,je=0;break e}}else ut.ua=0;var Mc=oe,zu=Ke,Th=Ye,ju=Mc.s,cf=ju.xc;if(Mc.c=zu,Mc.i=Th,ju.md=Cn(zu,cf),ju.wc=cf==0?-1:(1<<cf)-1,ee){oe.xb=xo;break e}if((Nt=u(Ke*Ye))==null){oe.a=1,je=0;break e}je=(je=_s(oe,Nt,0,Ke,Ye,Ye,null))&&!tt.h;break e}return je?(Pe!=null?Pe[0]=Nt:(e(Nt==null),e(ee)),oe.$=0,ee||ro(ut)):ro(ut),je}function Sl(C,B){var ee=C.c*C.i,oe=ee+B+16*B;return e(C.c<=B),C.V=u(oe),C.V==null?(C.Ta=null,C.Ua=0,C.a=1,0):(C.Ta=C.V,C.Ua=C.Ba+ee+B,1)}function al(C,B){var ee=C.C,oe=B-ee,Pe=C.V,je=C.Ba+C.c*ee;for(e(B<=C.l.o);0<oe;){var Ke=16<oe?16:oe,Ye=C.l.ma,tt=C.l.width,ut=tt*Ke,Nt=Ye.ca,rn=Ye.tb+tt*ee,ft=C.Ta,zt=C.Ua;Ei(C,Ke,Pe,je),nu(ft,zt,Nt,rn,ut),Wo(Ye,ee,ee+Ke,Nt,rn,tt),oe-=Ke,Pe+=Ke*C.c,ee+=Ke}e(ee==B),C.C=C.Ma=B}function Vi(){this.ub=this.yd=this.td=this.Rb=0}function Ql(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function Pu(){this.Fb=this.Bb=this.Cb=0,this.Zb=u(4),this.Lb=u(4)}function So(){this.Yb=(function(){var C=[];return(function B(ee,oe,Pe){for(var je=Pe[oe],Ke=0;Ke<je&&(ee.push(Pe.length>oe+1?[]:0),!(Pe.length<oe+1));Ke++)B(ee[Ke],oe+1,Pe)})(C,0,[3,11]),C})()}function mu(){this.jb=u(3),this.Wc=_([4,8],So),this.Xc=_([4,17],So)}function Ea(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new u(4),this.od=new u(4)}function Zo(){this.ld=this.La=this.dd=this.tc=0}function Xa(){this.Na=this.la=0}function kl(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function ec(){this.ad=u(384),this.Za=0,this.Ob=u(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function Aa(){this.uc=this.M=this.Nb=0,this.wa=Array(new Zo),this.Y=0,this.ya=Array(new ec),this.aa=0,this.l=new Yo}function ra(){this.y=u(16),this.f=u(8),this.ea=u(8)}function pn(){this.cb=this.a=0,this.sc="",this.m=new le,this.Od=new Vi,this.Kc=new Ql,this.ed=new Ea,this.Qa=new Pu,this.Ic=this.$c=this.Aa=0,this.D=new Aa,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=m(8,le),this.ia=0,this.pb=m(4,kl),this.Pa=new mu,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new ra),this.Hd=0,this.rb=Array(new Xa),this.sb=0,this.wa=Array(new Zo),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new ec),this.L=this.aa=0,this.gd=_([4,2],Zo),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function Yo(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function ss(){var C=new pn;return C!=null&&(C.a=0,C.sc="OK",C.cb=0,C.Xb=0,Ks||(Ks=Ya)),C}function vi(C,B,ee){return C.a==0&&(C.a=B,C.sc=ee,C.cb=0),0}function gu(C,B,ee){return 3<=ee&&C[B+0]==157&&C[B+1]==1&&C[B+2]==42}function Za(C,B){if(C==null)return 0;if(C.a=0,C.sc="OK",B==null)return vi(C,2,"null VP8Io passed to VP8GetHeaders()");var ee=B.data,oe=B.w,Pe=B.ha;if(4>Pe)return vi(C,7,"Truncated header.");var je=ee[oe+0]|ee[oe+1]<<8|ee[oe+2]<<16,Ke=C.Od;if(Ke.Rb=!(1&je),Ke.td=je>>1&7,Ke.yd=je>>4&1,Ke.ub=je>>5,3<Ke.td)return vi(C,3,"Incorrect keyframe parameters.");if(!Ke.yd)return vi(C,4,"Frame not displayable.");oe+=3,Pe-=3;var Ye=C.Kc;if(Ke.Rb){if(7>Pe)return vi(C,7,"cannot parse picture header");if(!gu(ee,oe,Pe))return vi(C,3,"Bad code word");Ye.c=16383&(ee[oe+4]<<8|ee[oe+3]),Ye.Td=ee[oe+4]>>6,Ye.i=16383&(ee[oe+6]<<8|ee[oe+5]),Ye.Ud=ee[oe+6]>>6,oe+=7,Pe-=7,C.za=Ye.c+15>>4,C.Ub=Ye.i+15>>4,B.width=Ye.c,B.height=Ye.i,B.Da=0,B.j=0,B.v=0,B.va=B.width,B.o=B.height,B.da=0,B.ib=B.width,B.hb=B.height,B.U=B.width,B.T=B.height,c((je=C.Pa).jb,0,255,je.jb.length),e((je=C.Qa)!=null),je.Cb=0,je.Bb=0,je.Fb=1,c(je.Zb,0,0,je.Zb.length),c(je.Lb,0,0,je.Lb)}if(Ke.ub>Pe)return vi(C,7,"bad partition length");Be(je=C.m,ee,oe,Ke.ub),oe+=Ke.ub,Pe-=Ke.ub,Ke.Rb&&(Ye.Ld=Dt(je),Ye.Kd=Dt(je)),Ye=C.Qa;var tt,ut=C.Pa;if(e(je!=null),e(Ye!=null),Ye.Cb=Dt(je),Ye.Cb){if(Ye.Bb=Dt(je),Dt(je)){for(Ye.Fb=Dt(je),tt=0;4>tt;++tt)Ye.Zb[tt]=Dt(je)?we(je,7):0;for(tt=0;4>tt;++tt)Ye.Lb[tt]=Dt(je)?we(je,6):0}if(Ye.Bb)for(tt=0;3>tt;++tt)ut.jb[tt]=Dt(je)?Re(je,8):255}else Ye.Bb=0;if(je.Ka)return vi(C,3,"cannot parse segment header");if((Ye=C.ed).zd=Dt(je),Ye.Tb=Re(je,6),Ye.wb=Re(je,3),Ye.Pc=Dt(je),Ye.Pc&&Dt(je)){for(ut=0;4>ut;++ut)Dt(je)&&(Ye.vd[ut]=we(je,6));for(ut=0;4>ut;++ut)Dt(je)&&(Ye.od[ut]=we(je,6))}if(C.L=Ye.Tb==0?0:Ye.zd?1:2,je.Ka)return vi(C,3,"cannot parse filter header");var Nt=Pe;if(Pe=tt=oe,oe=tt+Nt,Ye=Nt,C.Xb=(1<<Re(C.m,2))-1,Nt<3*(ut=C.Xb))ee=7;else{for(tt+=3*ut,Ye-=3*ut,Nt=0;Nt<ut;++Nt){var rn=ee[Pe+0]|ee[Pe+1]<<8|ee[Pe+2]<<16;rn>Ye&&(rn=Ye),Be(C.Jc[+Nt],ee,tt,rn),tt+=rn,Ye-=rn,Pe+=3}Be(C.Jc[+ut],ee,tt,Ye),ee=tt<oe?0:5}if(ee!=0)return vi(C,ee,"cannot parse partitions");for(ee=Re(tt=C.m,7),Pe=Dt(tt)?we(tt,4):0,oe=Dt(tt)?we(tt,4):0,Ye=Dt(tt)?we(tt,4):0,ut=Dt(tt)?we(tt,4):0,tt=Dt(tt)?we(tt,4):0,Nt=C.Qa,rn=0;4>rn;++rn){if(Nt.Cb){var ft=Nt.Zb[rn];Nt.Fb||(ft+=ee)}else{if(0<rn){C.pb[rn]=C.pb[0];continue}ft=ee}var zt=C.pb[rn];zt.Sc[0]=bu[Di(ft+Pe,127)],zt.Sc[1]=th[Di(ft+0,127)],zt.Eb[0]=2*bu[Di(ft+oe,127)],zt.Eb[1]=101581*th[Di(ft+Ye,127)]>>16,8>zt.Eb[1]&&(zt.Eb[1]=8),zt.Qc[0]=bu[Di(ft+ut,117)],zt.Qc[1]=th[Di(ft+tt,127)],zt.lc=ft+tt}if(!Ke.Rb)return vi(C,4,"Not a key frame.");for(Dt(je),Ke=C.Pa,ee=0;4>ee;++ee){for(Pe=0;8>Pe;++Pe)for(oe=0;3>oe;++oe)for(Ye=0;11>Ye;++Ye)ut=tn(je,nh[ee][Pe][oe][Ye])?Re(je,8):Qh[ee][Pe][oe][Ye],Ke.Wc[ee][Pe].Yb[oe][Ye]=ut;for(Pe=0;17>Pe;++Pe)Ke.Xc[ee][Pe]=Ke.Wc[ee][vo[Pe]]}return C.kc=Dt(je),C.kc&&(C.Bd=Re(je,8)),C.cb=1}function Ya(C,B,ee,oe,Pe,je,Ke){var Ye=B[Pe].Yb[ee];for(ee=0;16>Pe;++Pe){if(!tn(C,Ye[ee+0]))return Pe;for(;!tn(C,Ye[ee+1]);)if(Ye=B[++Pe].Yb[0],ee=0,Pe==16)return 16;var tt=B[Pe+1].Yb;if(tn(C,Ye[ee+2])){var ut=C,Nt=0;if(tn(ut,(ft=Ye)[(rn=ee)+3]))if(tn(ut,ft[rn+6])){for(Ye=0,rn=2*(Nt=tn(ut,ft[rn+8]))+(ft=tn(ut,ft[rn+9+Nt])),Nt=0,ft=Pa[rn];ft[Ye];++Ye)Nt+=Nt+tn(ut,ft[Ye]);Nt+=3+(8<<rn)}else tn(ut,ft[rn+7])?(Nt=7+2*tn(ut,165),Nt+=tn(ut,145)):Nt=5+tn(ut,159);else Nt=tn(ut,ft[rn+4])?3+tn(ut,ft[rn+5]):2;Ye=tt[2]}else Nt=1,Ye=tt[1];tt=Ke+Vc[Pe],0>(ut=C).b&&dt(ut);var rn,ft=ut.b,zt=(rn=ut.Ca>>1)-(ut.I>>ft)>>31;--ut.b,ut.Ca+=zt,ut.Ca|=1,ut.I-=(rn+1&zt)<<ft,je[tt]=((Nt^zt)-zt)*oe[(0<Pe)+0]}return 16}function ll(C){var B=C.rb[C.sb-1];B.la=0,B.Na=0,c(C.zc,0,0,C.zc.length),C.ja=0}function ks(C,B,ee,oe,Pe){Pe=C[B+ee+32*oe]+(Pe>>3),C[B+ee+32*oe]=-256&Pe?0>Pe?0:255:Pe}function er(C,B,ee,oe,Pe,je){ks(C,B,0,ee,oe+Pe),ks(C,B,1,ee,oe+je),ks(C,B,2,ee,oe-je),ks(C,B,3,ee,oe-Pe)}function Fr(C){return(20091*C>>16)+C}function Rr(C,B,ee,oe){var Pe,je=0,Ke=u(16);for(Pe=0;4>Pe;++Pe){var Ye=C[B+0]+C[B+8],tt=C[B+0]-C[B+8],ut=(35468*C[B+4]>>16)-Fr(C[B+12]),Nt=Fr(C[B+4])+(35468*C[B+12]>>16);Ke[je+0]=Ye+Nt,Ke[je+1]=tt+ut,Ke[je+2]=tt-ut,Ke[je+3]=Ye-Nt,je+=4,B++}for(Pe=je=0;4>Pe;++Pe)Ye=(C=Ke[je+0]+4)+Ke[je+8],tt=C-Ke[je+8],ut=(35468*Ke[je+4]>>16)-Fr(Ke[je+12]),ks(ee,oe,0,0,Ye+(Nt=Fr(Ke[je+4])+(35468*Ke[je+12]>>16))),ks(ee,oe,1,0,tt+ut),ks(ee,oe,2,0,tt-ut),ks(ee,oe,3,0,Ye-Nt),je++,oe+=32}function zs(C,B,ee,oe){var Pe=C[B+0]+4,je=35468*C[B+4]>>16,Ke=Fr(C[B+4]),Ye=35468*C[B+1]>>16;er(ee,oe,0,Pe+Ke,C=Fr(C[B+1]),Ye),er(ee,oe,1,Pe+je,C,Ye),er(ee,oe,2,Pe-je,C,Ye),er(ee,oe,3,Pe-Ke,C,Ye)}function Ta(C,B,ee,oe,Pe){Rr(C,B,ee,oe),Pe&&Rr(C,B+16,ee,oe+4)}function xi(C,B,ee,oe){vu(C,B+0,ee,oe,1),vu(C,B+32,ee,oe+128,1)}function Mi(C,B,ee,oe){var Pe;for(C=C[B+0]+4,Pe=0;4>Pe;++Pe)for(B=0;4>B;++B)ks(ee,oe,B,Pe,C)}function El(C,B,ee,oe){C[B+0]&&Go(C,B+0,ee,oe),C[B+16]&&Go(C,B+16,ee,oe+4),C[B+32]&&Go(C,B+32,ee,oe+128),C[B+48]&&Go(C,B+48,ee,oe+128+4)}function ji(C,B,ee,oe){var Pe,je=u(16);for(Pe=0;4>Pe;++Pe){var Ke=C[B+0+Pe]+C[B+12+Pe],Ye=C[B+4+Pe]+C[B+8+Pe],tt=C[B+4+Pe]-C[B+8+Pe],ut=C[B+0+Pe]-C[B+12+Pe];je[0+Pe]=Ke+Ye,je[8+Pe]=Ke-Ye,je[4+Pe]=ut+tt,je[12+Pe]=ut-tt}for(Pe=0;4>Pe;++Pe)Ke=(C=je[0+4*Pe]+3)+je[3+4*Pe],Ye=je[1+4*Pe]+je[2+4*Pe],tt=je[1+4*Pe]-je[2+4*Pe],ut=C-je[3+4*Pe],ee[oe+0]=Ke+Ye>>3,ee[oe+16]=ut+tt>>3,ee[oe+32]=Ke-Ye>>3,ee[oe+48]=ut-tt>>3,oe+=64}function fs(C,B,ee){var oe,Pe=B-32,je=xs,Ke=255-C[Pe-1];for(oe=0;oe<ee;++oe){var Ye,tt=je,ut=Ke+C[B-1];for(Ye=0;Ye<ee;++Ye)C[B+Ye]=tt[ut+C[Pe+Ye]];B+=32}}function Fi(C,B){fs(C,B,4)}function yu(C,B){fs(C,B,8)}function tc(C,B){fs(C,B,16)}function eu(C,B){var ee;for(ee=0;16>ee;++ee)i(C,B+32*ee,C,B-32,16)}function bc(C,B){var ee;for(ee=16;0<ee;--ee)c(C,B,C[B-1],16),B+=32}function nc(C,B,ee){var oe;for(oe=0;16>oe;++oe)c(B,ee+32*oe,C,16)}function Da(C,B){var ee,oe=16;for(ee=0;16>ee;++ee)oe+=C[B-1+32*ee]+C[B+ee-32];nc(oe>>5,C,B)}function Ms(C,B){var ee,oe=8;for(ee=0;16>ee;++ee)oe+=C[B-1+32*ee];nc(oe>>4,C,B)}function Oi(C,B){var ee,oe=8;for(ee=0;16>ee;++ee)oe+=C[B+ee-32];nc(oe>>4,C,B)}function Fa(C,B){nc(128,C,B)}function ci(C,B,ee){return C+2*B+ee+2>>2}function Jo(C,B){var ee,oe=B-32;for(oe=new Uint8Array([ci(C[oe-1],C[oe+0],C[oe+1]),ci(C[oe+0],C[oe+1],C[oe+2]),ci(C[oe+1],C[oe+2],C[oe+3]),ci(C[oe+2],C[oe+3],C[oe+4])]),ee=0;4>ee;++ee)i(C,B+32*ee,oe,0,oe.length)}function Eo(C,B){var ee=C[B-1],oe=C[B-1+32],Pe=C[B-1+64],je=C[B-1+96];ln(C,B+0,16843009*ci(C[B-1-32],ee,oe)),ln(C,B+32,16843009*ci(ee,oe,Pe)),ln(C,B+64,16843009*ci(oe,Pe,je)),ln(C,B+96,16843009*ci(Pe,je,je))}function xh(C,B){var ee,oe=4;for(ee=0;4>ee;++ee)oe+=C[B+ee-32]+C[B-1+32*ee];for(oe>>=3,ee=0;4>ee;++ee)c(C,B+32*ee,oe,4)}function ku(C,B){var ee=C[B-1+0],oe=C[B-1+32],Pe=C[B-1+64],je=C[B-1-32],Ke=C[B+0-32],Ye=C[B+1-32],tt=C[B+2-32],ut=C[B+3-32];C[B+0+96]=ci(oe,Pe,C[B-1+96]),C[B+1+96]=C[B+0+64]=ci(ee,oe,Pe),C[B+2+96]=C[B+1+64]=C[B+0+32]=ci(je,ee,oe),C[B+3+96]=C[B+2+64]=C[B+1+32]=C[B+0+0]=ci(Ke,je,ee),C[B+3+64]=C[B+2+32]=C[B+1+0]=ci(Ye,Ke,je),C[B+3+32]=C[B+2+0]=ci(tt,Ye,Ke),C[B+3+0]=ci(ut,tt,Ye)}function mo(C,B){var ee=C[B+1-32],oe=C[B+2-32],Pe=C[B+3-32],je=C[B+4-32],Ke=C[B+5-32],Ye=C[B+6-32],tt=C[B+7-32];C[B+0+0]=ci(C[B+0-32],ee,oe),C[B+1+0]=C[B+0+32]=ci(ee,oe,Pe),C[B+2+0]=C[B+1+32]=C[B+0+64]=ci(oe,Pe,je),C[B+3+0]=C[B+2+32]=C[B+1+64]=C[B+0+96]=ci(Pe,je,Ke),C[B+3+32]=C[B+2+64]=C[B+1+96]=ci(je,Ke,Ye),C[B+3+64]=C[B+2+96]=ci(Ke,Ye,tt),C[B+3+96]=ci(Ye,tt,tt)}function js(C,B){var ee=C[B-1+0],oe=C[B-1+32],Pe=C[B-1+64],je=C[B-1-32],Ke=C[B+0-32],Ye=C[B+1-32],tt=C[B+2-32],ut=C[B+3-32];C[B+0+0]=C[B+1+64]=je+Ke+1>>1,C[B+1+0]=C[B+2+64]=Ke+Ye+1>>1,C[B+2+0]=C[B+3+64]=Ye+tt+1>>1,C[B+3+0]=tt+ut+1>>1,C[B+0+96]=ci(Pe,oe,ee),C[B+0+64]=ci(oe,ee,je),C[B+0+32]=C[B+1+96]=ci(ee,je,Ke),C[B+1+32]=C[B+2+96]=ci(je,Ke,Ye),C[B+2+32]=C[B+3+96]=ci(Ke,Ye,tt),C[B+3+32]=ci(Ye,tt,ut)}function Mu(C,B){var ee=C[B+0-32],oe=C[B+1-32],Pe=C[B+2-32],je=C[B+3-32],Ke=C[B+4-32],Ye=C[B+5-32],tt=C[B+6-32],ut=C[B+7-32];C[B+0+0]=ee+oe+1>>1,C[B+1+0]=C[B+0+64]=oe+Pe+1>>1,C[B+2+0]=C[B+1+64]=Pe+je+1>>1,C[B+3+0]=C[B+2+64]=je+Ke+1>>1,C[B+0+32]=ci(ee,oe,Pe),C[B+1+32]=C[B+0+96]=ci(oe,Pe,je),C[B+2+32]=C[B+1+96]=ci(Pe,je,Ke),C[B+3+32]=C[B+2+96]=ci(je,Ke,Ye),C[B+3+64]=ci(Ke,Ye,tt),C[B+3+96]=ci(Ye,tt,ut)}function Ko(C,B){var ee=C[B-1+0],oe=C[B-1+32],Pe=C[B-1+64],je=C[B-1+96];C[B+0+0]=ee+oe+1>>1,C[B+2+0]=C[B+0+32]=oe+Pe+1>>1,C[B+2+32]=C[B+0+64]=Pe+je+1>>1,C[B+1+0]=ci(ee,oe,Pe),C[B+3+0]=C[B+1+32]=ci(oe,Pe,je),C[B+3+32]=C[B+1+64]=ci(Pe,je,je),C[B+3+64]=C[B+2+64]=C[B+0+96]=C[B+1+96]=C[B+2+96]=C[B+3+96]=je}function go(C,B){var ee=C[B-1+0],oe=C[B-1+32],Pe=C[B-1+64],je=C[B-1+96],Ke=C[B-1-32],Ye=C[B+0-32],tt=C[B+1-32],ut=C[B+2-32];C[B+0+0]=C[B+2+32]=ee+Ke+1>>1,C[B+0+32]=C[B+2+64]=oe+ee+1>>1,C[B+0+64]=C[B+2+96]=Pe+oe+1>>1,C[B+0+96]=je+Pe+1>>1,C[B+3+0]=ci(Ye,tt,ut),C[B+2+0]=ci(Ke,Ye,tt),C[B+1+0]=C[B+3+32]=ci(ee,Ke,Ye),C[B+1+32]=C[B+3+64]=ci(oe,ee,Ke),C[B+1+64]=C[B+3+96]=ci(Pe,oe,ee),C[B+1+96]=ci(je,Pe,oe)}function Ml(C,B){var ee;for(ee=0;8>ee;++ee)i(C,B+32*ee,C,B-32,8)}function Oa(C,B){var ee;for(ee=0;8>ee;++ee)c(C,B,C[B-1],8),B+=32}function Us(C,B,ee){var oe;for(oe=0;8>oe;++oe)c(B,ee+32*oe,C,8)}function Uo(C,B){var ee,oe=8;for(ee=0;8>ee;++ee)oe+=C[B+ee-32]+C[B-1+32*ee];Us(oe>>4,C,B)}function zc(C,B){var ee,oe=4;for(ee=0;8>ee;++ee)oe+=C[B+ee-32];Us(oe>>3,C,B)}function Xo(C,B){var ee,oe=4;for(ee=0;8>ee;++ee)oe+=C[B-1+32*ee];Us(oe>>3,C,B)}function pa(C,B){Us(128,C,B)}function Ja(C,B,ee){var oe=C[B-ee],Pe=C[B+0],je=3*(Pe-oe)+ru[1020+C[B-2*ee]-C[B+ee]],Ke=oc[112+(je+4>>3)];C[B-ee]=xs[255+oe+oc[112+(je+3>>3)]],C[B+0]=xs[255+Pe-Ke]}function cl(C,B,ee,oe){var Pe=C[B+0],je=C[B+ee];return Ba[255+C[B-2*ee]-C[B-ee]]>oe||Ba[255+je-Pe]>oe}function tu(C,B,ee,oe){return 4*Ba[255+C[B-ee]-C[B+0]]+Ba[255+C[B-2*ee]-C[B+ee]]<=oe}function wc(C,B,ee,oe,Pe){var je=C[B-3*ee],Ke=C[B-2*ee],Ye=C[B-ee],tt=C[B+0],ut=C[B+ee],Nt=C[B+2*ee],rn=C[B+3*ee];return 4*Ba[255+Ye-tt]+Ba[255+Ke-ut]>oe?0:Ba[255+C[B-4*ee]-je]<=Pe&&Ba[255+je-Ke]<=Pe&&Ba[255+Ke-Ye]<=Pe&&Ba[255+rn-Nt]<=Pe&&Ba[255+Nt-ut]<=Pe&&Ba[255+ut-tt]<=Pe}function Vs(C,B,ee,oe){var Pe=2*oe+1;for(oe=0;16>oe;++oe)tu(C,B+oe,ee,Pe)&&Ja(C,B+oe,ee)}function Ai(C,B,ee,oe){var Pe=2*oe+1;for(oe=0;16>oe;++oe)tu(C,B+oe*ee,1,Pe)&&Ja(C,B+oe*ee,1)}function Ss(C,B,ee,oe){var Pe;for(Pe=3;0<Pe;--Pe)Vs(C,B+=4*ee,ee,oe)}function qs(C,B,ee,oe){var Pe;for(Pe=3;0<Pe;--Pe)Ai(C,B+=4,ee,oe)}function ia(C,B,ee,oe,Pe,je,Ke,Ye){for(je=2*je+1;0<Pe--;){if(wc(C,B,ee,je,Ke))if(cl(C,B,ee,Ye))Ja(C,B,ee);else{var tt=C,ut=B,Nt=ee,rn=tt[ut-2*Nt],ft=tt[ut-Nt],zt=tt[ut+0],Jt=tt[ut+Nt],En=tt[ut+2*Nt],y=27*(f=ru[1020+3*(zt-ft)+ru[1020+rn-Jt]])+63>>7,a=18*f+63>>7,f=9*f+63>>7;tt[ut-3*Nt]=xs[255+tt[ut-3*Nt]+f],tt[ut-2*Nt]=xs[255+rn+a],tt[ut-Nt]=xs[255+ft+y],tt[ut+0]=xs[255+zt-y],tt[ut+Nt]=xs[255+Jt-a],tt[ut+2*Nt]=xs[255+En-f]}B+=oe}}function oa(C,B,ee,oe,Pe,je,Ke,Ye){for(je=2*je+1;0<Pe--;){if(wc(C,B,ee,je,Ke))if(cl(C,B,ee,Ye))Ja(C,B,ee);else{var tt=C,ut=B,Nt=ee,rn=tt[ut-Nt],ft=tt[ut+0],zt=tt[ut+Nt],Jt=oc[112+(4+(En=3*(ft-rn))>>3)],En=oc[112+(En+3>>3)],y=Jt+1>>1;tt[ut-2*Nt]=xs[255+tt[ut-2*Nt]+y],tt[ut-Nt]=xs[255+rn+En],tt[ut+0]=xs[255+ft-Jt],tt[ut+Nt]=xs[255+zt-y]}B+=oe}}function ul(C,B,ee,oe,Pe,je){ia(C,B,ee,1,16,oe,Pe,je)}function $s(C,B,ee,oe,Pe,je){ia(C,B,1,ee,16,oe,Pe,je)}function Gs(C,B,ee,oe,Pe,je){var Ke;for(Ke=3;0<Ke;--Ke)oa(C,B+=4*ee,ee,1,16,oe,Pe,je)}function Sc(C,B,ee,oe,Pe,je){var Ke;for(Ke=3;0<Ke;--Ke)oa(C,B+=4,1,ee,16,oe,Pe,je)}function W(C,B,ee,oe,Pe,je,Ke,Ye){ia(C,B,Pe,1,8,je,Ke,Ye),ia(ee,oe,Pe,1,8,je,Ke,Ye)}function Ce(C,B,ee,oe,Pe,je,Ke,Ye){ia(C,B,1,Pe,8,je,Ke,Ye),ia(ee,oe,1,Pe,8,je,Ke,Ye)}function pt(C,B,ee,oe,Pe,je,Ke,Ye){oa(C,B+4*Pe,Pe,1,8,je,Ke,Ye),oa(ee,oe+4*Pe,Pe,1,8,je,Ke,Ye)}function yt(C,B,ee,oe,Pe,je,Ke,Ye){oa(C,B+4,1,Pe,8,je,Ke,Ye),oa(ee,oe+4,1,Pe,8,je,Ke,Ye)}function qt(){this.ba=new Te,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new ht,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function Qt(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function Fn(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function Nr(){this.ua=0,this.Wa=new br,this.vb=new br,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new Me,this.yc=new Z}function $r(){this.xb=this.a=0,this.l=new Yo,this.ca=new Te,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new Ne,this.Pb=0,this.wd=new Ne,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new Nr,this.ab=0,this.gc=m(4,Fn),this.Oc=0}function yi(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new Yo,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function Ti(C,B,ee,oe,Pe,je,Ke){for(C=C==null?0:C[B+0],B=0;B<Ke;++B)Pe[je+B]=C+ee[oe+B]&255,C=Pe[je+B]}function yo(C,B,ee,oe,Pe,je,Ke){var Ye;if(C==null)Ti(null,null,ee,oe,Pe,je,Ke);else for(Ye=0;Ye<Ke;++Ye)Pe[je+Ye]=C[B+Ye]+ee[oe+Ye]&255}function _o(C,B,ee,oe,Pe,je,Ke){if(C==null)Ti(null,null,ee,oe,Pe,je,Ke);else{var Ye,tt=C[B+0],ut=tt,Nt=tt;for(Ye=0;Ye<Ke;++Ye)ut=Nt+(tt=C[B+Ye])-ut,Nt=ee[oe+Ye]+(-256&ut?0>ut?0:255:ut)&255,ut=tt,Pe[je+Ye]=Nt}}function Qo(C,B,ee,oe){var Pe=B.width,je=B.o;if(e(C!=null&&B!=null),0>ee||0>=oe||ee+oe>je)return null;if(!C.Cc){if(C.ga==null){var Ke;if(C.ga=new yi,(Ke=C.ga==null)||(Ke=B.width*B.o,e(C.Gb.length==0),C.Gb=u(Ke),C.Uc=0,C.Gb==null?Ke=0:(C.mb=C.Gb,C.nb=C.Uc,C.rc=null,Ke=1),Ke=!Ke),!Ke){Ke=C.ga;var Ye=C.Fa,tt=C.P,ut=C.qc,Nt=C.mb,rn=C.nb,ft=tt+1,zt=ut-1,Jt=Ke.l;if(e(Ye!=null&&Nt!=null&&B!=null),xa[0]=null,xa[1]=Ti,xa[2]=yo,xa[3]=_o,Ke.ca=Nt,Ke.tb=rn,Ke.c=B.width,Ke.i=B.height,e(0<Ke.c&&0<Ke.i),1>=ut)B=0;else if(Ke.$a=3&Ye[tt+0],Ke.Z=Ye[tt+0]>>2&3,Ke.Lc=Ye[tt+0]>>4&3,tt=Ye[tt+0]>>6&3,0>Ke.$a||1<Ke.$a||4<=Ke.Z||1<Ke.Lc||tt)B=0;else if(Jt.put=Lt,Jt.ac=At,Jt.bc=xn,Jt.ma=Ke,Jt.width=B.width,Jt.height=B.height,Jt.Da=B.Da,Jt.v=B.v,Jt.va=B.va,Jt.j=B.j,Jt.o=B.o,Ke.$a)e:{e(Ke.$a==1),B=Ps();t:for(;;){if(B==null){B=0;break e}if(e(Ke!=null),Ke.mc=B,B.c=Ke.c,B.i=Ke.i,B.l=Ke.l,B.l.ma=Ke,B.l.width=Ke.c,B.l.height=Ke.i,B.a=0,De(B.m,Ye,ft,zt),!fa(Ke.c,Ke.i,1,B,null)||(B.ab==1&&B.gc[0].hc==3&&po(B.s)?(Ke.ic=1,Ye=B.c*B.i,B.Ta=null,B.Ua=0,B.V=u(Ye),B.Ba=0,B.V==null?(B.a=1,B=0):B=1):(Ke.ic=0,B=Sl(B,Ke.c)),!B))break t;B=1;break e}Ke.mc=null,B=0}else B=zt>=Ke.c*Ke.i;Ke=!B}if(Ke)return null;C.ga.Lc!=1?C.Ga=0:oe=je-ee}e(C.ga!=null),e(ee+oe<=je);e:{if(B=(Ye=C.ga).c,je=Ye.l.o,Ye.$a==0){if(ft=C.rc,zt=C.Vc,Jt=C.Fa,tt=C.P+1+ee*B,ut=C.mb,Nt=C.nb+ee*B,e(tt<=C.P+C.qc),Ye.Z!=0)for(e(xa[Ye.Z]!=null),Ke=0;Ke<oe;++Ke)xa[Ye.Z](ft,zt,Jt,tt,ut,Nt,B),ft=ut,zt=Nt,Nt+=B,tt+=B;else for(Ke=0;Ke<oe;++Ke)i(ut,Nt,Jt,tt,B),ft=ut,zt=Nt,Nt+=B,tt+=B;C.rc=ft,C.Vc=zt}else{if(e(Ye.mc!=null),B=ee+oe,e((Ke=Ye.mc)!=null),e(B<=Ke.i),Ke.C>=B)B=1;else if(Ye.ic||qo(),Ye.ic){Ye=Ke.V,ft=Ke.Ba,zt=Ke.c;var En=Ke.i,y=(Jt=1,tt=Ke.$/zt,ut=Ke.$%zt,Nt=Ke.m,rn=Ke.s,Ke.$),a=zt*En,f=zt*B,v=rn.wc,S=y<f?wr(rn,ut,tt):null;e(y<=a),e(B<=En),e(po(rn));t:for(;;){for(;!Nt.h&&y<f;){if(ut&v||(S=wr(rn,ut,tt)),e(S!=null),mt(Nt),256>(En=Ir(S.G[0],S.H[0],Nt)))Ye[ft+y]=En,++y,++ut>=zt&&(ut=0,++tt<=B&&!(tt%16)&&no(Ke,tt));else{if(!(280>En)){Jt=0;break t}En=An(En-256,Nt);var T,N=Ir(S.G[4],S.H[4],Nt);if(mt(Nt),!(y>=(N=Lr(zt,N=An(N,Nt)))&&a-y>=En)){Jt=0;break t}for(T=0;T<En;++T)Ye[ft+y+T]=Ye[ft+y+T-N];for(y+=En,ut+=En;ut>=zt;)ut-=zt,++tt<=B&&!(tt%16)&&no(Ke,tt);y<f&&ut&v&&(S=wr(rn,ut,tt))}e(Nt.h==Je(Nt))}no(Ke,tt>B?B:tt);break t}!Jt||Nt.h&&y<a?(Jt=0,Ke.a=Nt.h?5:3):Ke.$=y,B=Jt}else B=_s(Ke,Ke.V,Ke.Ba,Ke.c,Ke.i,B,al);if(!B){oe=0;break e}}ee+oe>=je&&(C.Cc=1),oe=1}if(!oe)return null;if(C.Cc&&((oe=C.ga)!=null&&(oe.mc=null),C.ga=null,0<C.Ga))return alert("todo:WebPDequantizeLevels"),null}return C.nb+ee*Pe}function Mo(C,B,ee,oe,Pe,je){for(;0<Pe--;){var Ke,Ye=C,tt=B+(ee?1:0),ut=C,Nt=B+(ee?0:3);for(Ke=0;Ke<oe;++Ke){var rn=ut[Nt+4*Ke];rn!=255&&(rn*=32897,Ye[tt+4*Ke+0]=Ye[tt+4*Ke+0]*rn>>23,Ye[tt+4*Ke+1]=Ye[tt+4*Ke+1]*rn>>23,Ye[tt+4*Ke+2]=Ye[tt+4*Ke+2]*rn>>23)}B+=je}}function Vo(C,B,ee,oe,Pe){for(;0<oe--;){var je;for(je=0;je<ee;++je){var Ke=C[B+2*je+0],Ye=15&(ut=C[B+2*je+1]),tt=4369*Ye,ut=(240&ut|ut>>4)*tt>>16;C[B+2*je+0]=(240&Ke|Ke>>4)*tt>>16&240|(15&Ke|Ke<<4)*tt>>16>>4&15,C[B+2*je+1]=240&ut|Ye}B+=Pe}}function es(C,B,ee,oe,Pe,je,Ke,Ye){var tt,ut,Nt=255;for(ut=0;ut<Pe;++ut){for(tt=0;tt<oe;++tt){var rn=C[B+tt];je[Ke+4*tt]=rn,Nt&=rn}B+=ee,Ke+=Ye}return Nt!=255}function cs(C,B,ee,oe,Pe){var je;for(je=0;je<Pe;++je)ee[oe+je]=C[B+je]>>8}function qo(){As=Mo,Bl=Vo,Ws=es,nu=cs}function Es(C,B,ee){F[C]=function(oe,Pe,je,Ke,Ye,tt,ut,Nt,rn,ft,zt,Jt,En,y,a,f,v){var S,T=v-1>>1,N=Ye[tt+0]|ut[Nt+0]<<16,z=rn[ft+0]|zt[Jt+0]<<16;e(oe!=null);var $=3*N+z+131074>>2;for(B(oe[Pe+0],255&$,$>>16,En,y),je!=null&&($=3*z+N+131074>>2,B(je[Ke+0],255&$,$>>16,a,f)),S=1;S<=T;++S){var Q=Ye[tt+S]|ut[Nt+S]<<16,te=rn[ft+S]|zt[Jt+S]<<16,ge=N+Q+z+te+524296,Ae=ge+2*(Q+z)>>3;$=Ae+N>>1,N=(ge=ge+2*(N+te)>>3)+Q>>1,B(oe[Pe+2*S-1],255&$,$>>16,En,y+(2*S-1)*ee),B(oe[Pe+2*S-0],255&N,N>>16,En,y+(2*S-0)*ee),je!=null&&($=ge+z>>1,N=Ae+te>>1,B(je[Ke+2*S-1],255&$,$>>16,a,f+(2*S-1)*ee),B(je[Ke+2*S+0],255&N,N>>16,a,f+(2*S+0)*ee)),N=Q,z=te}1&v||($=3*N+z+131074>>2,B(oe[Pe+v-1],255&$,$>>16,En,y+(v-1)*ee),je!=null&&($=3*z+N+131074>>2,B(je[Ke+v-1],255&$,$>>16,a,f+(v-1)*ee)))}}function jc(){zl[iu]=Oh,zl[La]=ka,zl[Ar]=jl,zl[ml]=wh,zl[_a]=su,zl[Bo]=Cc,zl[Fu]=Bh,zl[Ic]=ka,zl[sc]=wh,zl[Ii]=su,zl[za]=Cc}function Qa(C){return C&-16384?0>C?0:255:C>>Ou}function L(C,B){return Qa((19077*C>>8)+(26149*B>>8)-14234)}function se(C,B,ee){return Qa((19077*C>>8)-(6419*B>>8)-(13320*ee>>8)+8708)}function ve(C,B){return Qa((19077*C>>8)+(33050*B>>8)-17685)}function He(C,B,ee,oe,Pe){oe[Pe+0]=L(C,ee),oe[Pe+1]=se(C,B,ee),oe[Pe+2]=ve(C,B)}function Xt(C,B,ee,oe,Pe){oe[Pe+0]=ve(C,B),oe[Pe+1]=se(C,B,ee),oe[Pe+2]=L(C,ee)}function fn(C,B,ee,oe,Pe){var je=se(C,B,ee);B=je<<3&224|ve(C,B)>>3,oe[Pe+0]=248&L(C,ee)|je>>5,oe[Pe+1]=B}function ar(C,B,ee,oe,Pe){var je=240&ve(C,B)|15;oe[Pe+0]=240&L(C,ee)|se(C,B,ee)>>4,oe[Pe+1]=je}function ao(C,B,ee,oe,Pe){oe[Pe+0]=255,He(C,B,ee,oe,Pe+1)}function Fo(C,B,ee,oe,Pe){Xt(C,B,ee,oe,Pe),oe[Pe+3]=255}function qi(C,B,ee,oe,Pe){He(C,B,ee,oe,Pe),oe[Pe+3]=255}function Di(C,B){return 0>C?0:C>B?B:C}function Ro(C,B,ee){F[C]=function(oe,Pe,je,Ke,Ye,tt,ut,Nt,rn){for(var ft=Nt+(-2&rn)*ee;Nt!=ft;)B(oe[Pe+0],je[Ke+0],Ye[tt+0],ut,Nt),B(oe[Pe+1],je[Ke+0],Ye[tt+0],ut,Nt+ee),Pe+=2,++Ke,++tt,Nt+=2*ee;1&rn&&B(oe[Pe+0],je[Ke+0],Ye[tt+0],ut,Nt)}}function sa(C,B,ee){return ee==0?C==0?B==0?6:5:B==0?4:0:ee}function Oo(C,B,ee,oe,Pe){switch(C>>>30){case 3:vu(B,ee,oe,Pe,0);break;case 2:la(B,ee,oe,Pe);break;case 1:Go(B,ee,oe,Pe)}}function Ji(C,B){var ee,oe,Pe=B.M,je=B.Nb,Ke=C.oc,Ye=C.pc+40,tt=C.oc,ut=C.pc+584,Nt=C.oc,rn=C.pc+600;for(ee=0;16>ee;++ee)Ke[Ye+32*ee-1]=129;for(ee=0;8>ee;++ee)tt[ut+32*ee-1]=129,Nt[rn+32*ee-1]=129;for(0<Pe?Ke[Ye-1-32]=tt[ut-1-32]=Nt[rn-1-32]=129:(c(Ke,Ye-32-1,127,21),c(tt,ut-32-1,127,9),c(Nt,rn-32-1,127,9)),oe=0;oe<C.za;++oe){var ft=B.ya[B.aa+oe];if(0<oe){for(ee=-1;16>ee;++ee)i(Ke,Ye+32*ee-4,Ke,Ye+32*ee+12,4);for(ee=-1;8>ee;++ee)i(tt,ut+32*ee-4,tt,ut+32*ee+4,4),i(Nt,rn+32*ee-4,Nt,rn+32*ee+4,4)}var zt=C.Gd,Jt=C.Hd+oe,En=ft.ad,y=ft.Hc;if(0<Pe&&(i(Ke,Ye-32,zt[Jt].y,0,16),i(tt,ut-32,zt[Jt].f,0,8),i(Nt,rn-32,zt[Jt].ea,0,8)),ft.Za){var a=Ke,f=Ye-32+16;for(0<Pe&&(oe>=C.za-1?c(a,f,zt[Jt].y[15],4):i(a,f,zt[Jt+1].y,0,4)),ee=0;4>ee;ee++)a[f+128+ee]=a[f+256+ee]=a[f+384+ee]=a[f+0+ee];for(ee=0;16>ee;++ee,y<<=2)a=Ke,f=Ye+Vl[ee],ja[ft.Ob[ee]](a,f),Oo(y,En,16*+ee,a,f)}else if(a=sa(oe,Pe,ft.Ob[0]),ca[a](Ke,Ye),y!=0)for(ee=0;16>ee;++ee,y<<=2)Oo(y,En,16*+ee,Ke,Ye+Vl[ee]);for(ee=ft.Gc,a=sa(oe,Pe,ft.Dd),nl[a](tt,ut),nl[a](Nt,rn),y=En,a=tt,f=ut,255&(ft=0|ee)&&(170&ft?ga(y,256,a,f):Po(y,256,a,f)),ft=Nt,y=rn,255&(ee>>=8)&&(170&ee?ga(En,320,ft,y):Po(En,320,ft,y)),Pe<C.Ub-1&&(i(zt[Jt].y,0,Ke,Ye+480,16),i(zt[Jt].f,0,tt,ut+224,8),i(zt[Jt].ea,0,Nt,rn+224,8)),ee=8*je*C.B,zt=C.sa,Jt=C.ta+16*oe+16*je*C.R,En=C.qa,ft=C.ra+8*oe+ee,y=C.Ha,a=C.Ia+8*oe+ee,ee=0;16>ee;++ee)i(zt,Jt+ee*C.R,Ke,Ye+32*ee,16);for(ee=0;8>ee;++ee)i(En,ft+ee*C.B,tt,ut+32*ee,8),i(y,a+ee*C.B,Nt,rn+32*ee,8)}}function Rl(C,B,ee,oe,Pe,je,Ke,Ye,tt){var ut=[0],Nt=[0],rn=0,ft=tt!=null?tt.kd:0,zt=tt??new Qt;if(C==null||12>ee)return 7;zt.data=C,zt.w=B,zt.ha=ee,B=[B],ee=[ee],zt.gb=[zt.gb];e:{var Jt=B,En=ee,y=zt.gb;if(e(C!=null),e(En!=null),e(y!=null),y[0]=0,12<=En[0]&&!t(C,Jt[0],"RIFF")){if(t(C,Jt[0]+8,"WEBP")){y=3;break e}var a=Gt(C,Jt[0]+4);if(12>a||4294967286<a){y=3;break e}if(ft&&a>En[0]-8){y=7;break e}y[0]=a,Jt[0]+=12,En[0]-=12}y=0}if(y!=0)return y;for(a=0<zt.gb[0],ee=ee[0];;){e:{var f=C;En=B,y=ee;var v=ut,S=Nt,T=Jt=[0];if(($=rn=[rn])[0]=0,8>y[0])y=7;else{if(!t(f,En[0],"VP8X")){if(Gt(f,En[0]+4)!=10){y=3;break e}if(18>y[0]){y=7;break e}var N=Gt(f,En[0]+8),z=1+Mn(f,En[0]+12);if(2147483648<=z*(f=1+Mn(f,En[0]+15))){y=3;break e}T!=null&&(T[0]=N),v!=null&&(v[0]=z),S!=null&&(S[0]=f),En[0]+=18,y[0]-=18,$[0]=1}y=0}}if(rn=rn[0],Jt=Jt[0],y!=0)return y;if(En=!!(2&Jt),!a&&rn)return 3;if(je!=null&&(je[0]=!!(16&Jt)),Ke!=null&&(Ke[0]=En),Ye!=null&&(Ye[0]=0),Ke=ut[0],Jt=Nt[0],rn&&En&&tt==null){y=0;break}if(4>ee){y=7;break}if(a&&rn||!a&&!rn&&!t(C,B[0],"ALPH")){ee=[ee],zt.na=[zt.na],zt.P=[zt.P],zt.Sa=[zt.Sa];e:{N=C,y=B,a=ee;var $=zt.gb;v=zt.na,S=zt.P,T=zt.Sa,z=22,e(N!=null),e(a!=null),f=y[0];var Q=a[0];for(e(v!=null),e(T!=null),v[0]=null,S[0]=null,T[0]=0;;){if(y[0]=f,a[0]=Q,8>Q){y=7;break e}var te=Gt(N,f+4);if(4294967286<te){y=3;break e}var ge=8+te+1&-2;if(z+=ge,0<$&&z>$){y=3;break e}if(!t(N,f,"VP8 ")||!t(N,f,"VP8L")){y=0;break e}if(Q[0]<ge){y=7;break e}t(N,f,"ALPH")||(v[0]=N,S[0]=f+8,T[0]=te),f+=ge,Q-=ge}}if(ee=ee[0],zt.na=zt.na[0],zt.P=zt.P[0],zt.Sa=zt.Sa[0],y!=0)break}ee=[ee],zt.Ja=[zt.Ja],zt.xa=[zt.xa];e:if($=C,y=B,a=ee,v=zt.gb[0],S=zt.Ja,T=zt.xa,N=y[0],f=!t($,N,"VP8 "),z=!t($,N,"VP8L"),e($!=null),e(a!=null),e(S!=null),e(T!=null),8>a[0])y=7;else{if(f||z){if($=Gt($,N+4),12<=v&&$>v-12){y=3;break e}if(ft&&$>a[0]-8){y=7;break e}S[0]=$,y[0]+=8,a[0]-=8,T[0]=z}else T[0]=5<=a[0]&&$[N+0]==47&&!($[N+4]>>5),S[0]=a[0];y=0}if(ee=ee[0],zt.Ja=zt.Ja[0],zt.xa=zt.xa[0],B=B[0],y!=0)break;if(4294967286<zt.Ja)return 3;if(Ye==null||En||(Ye[0]=zt.xa?2:1),Ke=[Ke],Jt=[Jt],zt.xa){if(5>ee){y=7;break}Ye=Ke,ft=Jt,En=je,C==null||5>ee?C=0:5<=ee&&C[B+0]==47&&!(C[B+4]>>5)?(a=[0],$=[0],v=[0],De(S=new Ne,C,B,ee),On(S,a,$,v)?(Ye!=null&&(Ye[0]=a[0]),ft!=null&&(ft[0]=$[0]),En!=null&&(En[0]=v[0]),C=1):C=0):C=0}else{if(10>ee){y=7;break}Ye=Jt,C==null||10>ee||!gu(C,B+3,ee-3)?C=0:(ft=C[B+0]|C[B+1]<<8|C[B+2]<<16,En=16383&(C[B+7]<<8|C[B+6]),C=16383&(C[B+9]<<8|C[B+8]),1&ft||3<(ft>>1&7)||!(ft>>4&1)||ft>>5>=zt.Ja||!En||!C?C=0:(Ke&&(Ke[0]=En),Ye&&(Ye[0]=C),C=1))}if(!C||(Ke=Ke[0],Jt=Jt[0],rn&&(ut[0]!=Ke||Nt[0]!=Jt)))return 3;tt!=null&&(tt[0]=zt,tt.offset=B-tt.w,e(4294967286>B-tt.w),e(tt.offset==tt.ha-ee));break}return y==0||y==7&&rn&&tt==null?(je!=null&&(je[0]|=zt.na!=null&&0<zt.na.length),oe!=null&&(oe[0]=Ke),Pe!=null&&(Pe[0]=Jt),0):y}function Ia(C,B,ee){var oe=B.width,Pe=B.height,je=0,Ke=0,Ye=oe,tt=Pe;if(B.Da=C!=null&&0<C.Da,B.Da&&(Ye=C.cd,tt=C.bd,je=C.v,Ke=C.j,11>ee||(je&=-2,Ke&=-2),0>je||0>Ke||0>=Ye||0>=tt||je+Ye>oe||Ke+tt>Pe))return 0;if(B.v=je,B.j=Ke,B.va=je+Ye,B.o=Ke+tt,B.U=Ye,B.T=tt,B.da=C!=null&&0<C.da,B.da){if(!Tr(Ye,tt,ee=[C.ib],je=[C.hb]))return 0;B.ib=ee[0],B.hb=je[0]}return B.ob=C!=null&&C.ob,B.Kb=C==null||!C.Sd,B.da&&(B.ob=B.ib<3*oe/4&&B.hb<3*Pe/4,B.Kb=0),1}function Ru(C){if(C==null)return 2;if(11>C.S){var B=C.f.RGBA;B.fb+=(C.height-1)*B.A,B.A=-B.A}else B=C.f.kb,C=C.height,B.O+=(C-1)*B.fa,B.fa=-B.fa,B.N+=(C-1>>1)*B.Ab,B.Ab=-B.Ab,B.W+=(C-1>>1)*B.Db,B.Db=-B.Db,B.F!=null&&(B.J+=(C-1)*B.lb,B.lb=-B.lb);return 0}function hl(C,B,ee,oe){if(oe==null||0>=C||0>=B)return 2;if(ee!=null){if(ee.Da){var Pe=ee.cd,je=ee.bd,Ke=-2&ee.v,Ye=-2&ee.j;if(0>Ke||0>Ye||0>=Pe||0>=je||Ke+Pe>C||Ye+je>B)return 2;C=Pe,B=je}if(ee.da){if(!Tr(C,B,Pe=[ee.ib],je=[ee.hb]))return 2;C=Pe[0],B=je[0]}}oe.width=C,oe.height=B;e:{var tt=oe.width,ut=oe.height;if(C=oe.S,0>=tt||0>=ut||!(C>=iu&&13>C))C=2;else{if(0>=oe.Rd&&oe.sd==null){Ke=je=Pe=B=0;var Nt=(Ye=tt*$c[C])*ut;if(11>C||(je=(ut+1)/2*(B=(tt+1)/2),C==12&&(Ke=(Pe=tt)*ut)),(ut=u(Nt+2*je+Ke))==null){C=1;break e}oe.sd=ut,11>C?((tt=oe.f.RGBA).eb=ut,tt.fb=0,tt.A=Ye,tt.size=Nt):((tt=oe.f.kb).y=ut,tt.O=0,tt.fa=Ye,tt.Fd=Nt,tt.f=ut,tt.N=0+Nt,tt.Ab=B,tt.Cd=je,tt.ea=ut,tt.W=0+Nt+je,tt.Db=B,tt.Ed=je,C==12&&(tt.F=ut,tt.J=0+Nt+2*je),tt.Tc=Ke,tt.lb=Pe)}if(B=1,Pe=oe.S,je=oe.width,Ke=oe.height,Pe>=iu&&13>Pe)if(11>Pe)C=oe.f.RGBA,B&=(Ye=Math.abs(C.A))*(Ke-1)+je<=C.size,B&=Ye>=je*$c[Pe],B&=C.eb!=null;else{C=oe.f.kb,Ye=(je+1)/2,Nt=(Ke+1)/2,tt=Math.abs(C.fa),ut=Math.abs(C.Ab);var rn=Math.abs(C.Db),ft=Math.abs(C.lb),zt=ft*(Ke-1)+je;B&=tt*(Ke-1)+je<=C.Fd,B&=ut*(Nt-1)+Ye<=C.Cd,B=(B&=rn*(Nt-1)+Ye<=C.Ed)&tt>=je&ut>=Ye&rn>=Ye,B&=C.y!=null,B&=C.f!=null,B&=C.ea!=null,Pe==12&&(B&=ft>=je,B&=zt<=C.Tc,B&=C.F!=null)}else B=0;C=B?0:2}}return C!=0||ee!=null&&ee.fd&&(C=Ru(oe)),C}var Nl=64,dl=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],No=24,aa=32,Dl=8,Ec=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];Jn("Predictor0","PredictorAdd0"),F.Predictor0=function(){return 4278190080},F.Predictor1=function(C){return C},F.Predictor2=function(C,B,ee){return B[ee+0]},F.Predictor3=function(C,B,ee){return B[ee+1]},F.Predictor4=function(C,B,ee){return B[ee-1]},F.Predictor5=function(C,B,ee){return Vt(Vt(C,B[ee+1]),B[ee+0])},F.Predictor6=function(C,B,ee){return Vt(C,B[ee-1])},F.Predictor7=function(C,B,ee){return Vt(C,B[ee+0])},F.Predictor8=function(C,B,ee){return Vt(B[ee-1],B[ee+0])},F.Predictor9=function(C,B,ee){return Vt(B[ee+0],B[ee+1])},F.Predictor10=function(C,B,ee){return Vt(Vt(C,B[ee-1]),Vt(B[ee+0],B[ee+1]))},F.Predictor11=function(C,B,ee){var oe=B[ee+0];return 0>=Dn(oe>>24&255,C>>24&255,(B=B[ee-1])>>24&255)+Dn(oe>>16&255,C>>16&255,B>>16&255)+Dn(oe>>8&255,C>>8&255,B>>8&255)+Dn(255&oe,255&C,255&B)?oe:C},F.Predictor12=function(C,B,ee){var oe=B[ee+0];return(Ln((C>>24&255)+(oe>>24&255)-((B=B[ee-1])>>24&255))<<24|Ln((C>>16&255)+(oe>>16&255)-(B>>16&255))<<16|Ln((C>>8&255)+(oe>>8&255)-(B>>8&255))<<8|Ln((255&C)+(255&oe)-(255&B)))>>>0},F.Predictor13=function(C,B,ee){var oe=B[ee-1];return($n((C=Vt(C,B[ee+0]))>>24&255,oe>>24&255)<<24|$n(C>>16&255,oe>>16&255)<<16|$n(C>>8&255,oe>>8&255)<<8|$n(255&C,255&oe))>>>0};var ma=F.PredictorAdd0;F.PredictorAdd1=Mr,Jn("Predictor2","PredictorAdd2"),Jn("Predictor3","PredictorAdd3"),Jn("Predictor4","PredictorAdd4"),Jn("Predictor5","PredictorAdd5"),Jn("Predictor6","PredictorAdd6"),Jn("Predictor7","PredictorAdd7"),Jn("Predictor8","PredictorAdd8"),Jn("Predictor9","PredictorAdd9"),Jn("Predictor10","PredictorAdd10"),Jn("Predictor11","PredictorAdd11"),Jn("Predictor12","PredictorAdd12"),Jn("Predictor13","PredictorAdd13");var Lo=F.PredictorAdd2;Cr("ColorIndexInverseTransform","MapARGB","32b",function(C){return C>>8&255},function(C){return C}),Cr("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(C){return C},function(C){return C>>8&255});var $o,Ca=F.ColorIndexInverseTransform,rc=F.MapARGB,fl=F.VP8LColorIndexInverseTransformAlpha,Nu=F.MapAlpha,el=F.VP8LPredictorsAdd=[];el.length=16,(F.VP8LPredictors=[]).length=16,(F.VP8LPredictorsAdd_C=[]).length=16,(F.VP8LPredictors_C=[]).length=16;var Ac,Al,pl,ic,Fl,_u,vs,vu,la,ga,Go,Po,Hs,ya,Ol,Dh,Ju,xu,Du,Uc,bh,Fh,tl,Tc,As,Bl,Ws,nu,jr=u(511),Qu=u(2041),eh=u(225),Bi=u(767),Tl=0,ru=Qu,oc=eh,xs=Bi,Ba=jr,iu=0,La=1,Ar=2,ml=3,_a=4,Bo=5,Fu=6,Ic=7,sc=8,Ii=9,za=10,Un=[2,3,7],Rs=[3,3,11],Ns=[280,256,256,256,40],lo=[0,1,1,1,0],va=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],gl=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],Jh=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],ii=8,bu=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],th=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],Ks=null,Pa=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],Vc=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],ac=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],Qh=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],Zf=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],nh=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],vo=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],ca=[],ja=[],nl=[],xo=1,ou=2,xa=[],zl=[];Es("UpsampleRgbLinePair",He,3),Es("UpsampleBgrLinePair",Xt,3),Es("UpsampleRgbaLinePair",qi,4),Es("UpsampleBgraLinePair",Fo,4),Es("UpsampleArgbLinePair",ao,4),Es("UpsampleRgba4444LinePair",ar,2),Es("UpsampleRgb565LinePair",fn,2);var Oh=F.UpsampleRgbLinePair,jl=F.UpsampleBgrLinePair,ka=F.UpsampleRgbaLinePair,wh=F.UpsampleBgraLinePair,su=F.UpsampleArgbLinePair,Cc=F.UpsampleRgba4444LinePair,Bh=F.UpsampleRgb565LinePair,Lc=16,lc=1<<Lc-1,Ao=-227,$i=482,Ou=6,Ua=0,yl=u(256),qc=u(256),rl=u(256),_l=u(256),Sh=u($i-Ao),Ul=u($i-Ao);Ro("YuvToRgbRow",He,3),Ro("YuvToBgrRow",Xt,3),Ro("YuvToRgbaRow",qi,4),Ro("YuvToBgraRow",Fo,4),Ro("YuvToArgbRow",ao,4),Ro("YuvToRgba4444Row",ar,2),Ro("YuvToRgb565Row",fn,2);var Vl=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],cc=[0,2,8],zh=[8,7,6,4,4,2,2,2,1,1,1,1],lr=1;this.WebPDecodeRGBA=function(C,B,ee,oe,Pe){var je=La,Ke=new qt,Ye=new Te;Ke.ba=Ye,Ye.S=je,Ye.width=[Ye.width],Ye.height=[Ye.height];var tt=Ye.width,ut=Ye.height,Nt=new et;if(Nt==null||C==null)var rn=2;else e(Nt!=null),rn=Rl(C,B,ee,Nt.width,Nt.height,Nt.Pd,Nt.Qd,Nt.format,null);if(rn!=0?tt=0:(tt!=null&&(tt[0]=Nt.width[0]),ut!=null&&(ut[0]=Nt.height[0]),tt=1),tt){Ye.width=Ye.width[0],Ye.height=Ye.height[0],oe!=null&&(oe[0]=Ye.width),Pe!=null&&(Pe[0]=Ye.height);e:{if(oe=new Yo,(Pe=new Qt).data=C,Pe.w=B,Pe.ha=ee,Pe.kd=1,B=[0],e(Pe!=null),((C=Rl(Pe.data,Pe.w,Pe.ha,null,null,null,B,null,Pe))==0||C==7)&&B[0]&&(C=4),(B=C)==0){if(e(Ke!=null),oe.data=Pe.data,oe.w=Pe.w+Pe.offset,oe.ha=Pe.ha-Pe.offset,oe.put=Lt,oe.ac=At,oe.bc=xn,oe.ma=Ke,Pe.xa){if((C=Ps())==null){Ke=1;break e}if((function(ft,zt){var Jt=[0],En=[0],y=[0];t:for(;;){if(ft==null)return 0;if(zt==null)return ft.a=2,0;if(ft.l=zt,ft.a=0,De(ft.m,zt.data,zt.w,zt.ha),!On(ft.m,Jt,En,y)){ft.a=3;break t}if(ft.xb=ou,zt.width=Jt[0],zt.height=En[0],!fa(Jt[0],En[0],1,ft,null))break t;return 1}return e(ft.a!=0),0})(C,oe)){if(oe=(B=hl(oe.width,oe.height,Ke.Oa,Ke.ba))==0){t:{oe=C;n:for(;;){if(oe==null){oe=0;break t}if(e(oe.s.yc!=null),e(oe.s.Ya!=null),e(0<oe.s.Wb),e((ee=oe.l)!=null),e((Pe=ee.ma)!=null),oe.xb!=0){if(oe.ca=Pe.ba,oe.tb=Pe.tb,e(oe.ca!=null),!Ia(Pe.Oa,ee,ml)){oe.a=2;break n}if(!Sl(oe,ee.width)||ee.da)break n;if((ee.da||li(oe.ca.S))&&qo(),11>oe.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),oe.ca.f.kb.F!=null&&qo()),oe.Pb&&0<oe.s.ua&&oe.s.vb.X==null&&!st(oe.s.vb,oe.s.Wa.Xa)){oe.a=1;break n}oe.xb=0}if(!_s(oe,oe.V,oe.Ba,oe.c,oe.i,ee.o,to))break n;Pe.Dc=oe.Ma,oe=1;break t}e(oe.a!=0),oe=0}oe=!oe}oe&&(B=C.a)}else B=C.a}else{if((C=new ss)==null){Ke=1;break e}if(C.Fa=Pe.na,C.P=Pe.P,C.qc=Pe.Sa,Za(C,oe)){if((B=hl(oe.width,oe.height,Ke.Oa,Ke.ba))==0){if(C.Aa=0,ee=Ke.Oa,e((Pe=C)!=null),ee!=null){if(0<(tt=0>(tt=ee.Md)?0:100<tt?255:255*tt/100)){for(ut=Nt=0;4>ut;++ut)12>(rn=Pe.pb[ut]).lc&&(rn.ia=tt*zh[0>rn.lc?0:rn.lc]>>3),Nt|=rn.ia;Nt&&(alert("todo:VP8InitRandom"),Pe.ia=1)}Pe.Ga=ee.Id,100<Pe.Ga?Pe.Ga=100:0>Pe.Ga&&(Pe.Ga=0)}(function(ft,zt){if(ft==null)return 0;if(zt==null)return vi(ft,2,"NULL VP8Io parameter in VP8Decode().");if(!ft.cb&&!Za(ft,zt))return 0;if(e(ft.cb),zt.ac==null||zt.ac(zt)){zt.ob&&(ft.L=0);var Jt=cc[ft.L];if(ft.L==2?(ft.yb=0,ft.zb=0):(ft.yb=zt.v-Jt>>4,ft.zb=zt.j-Jt>>4,0>ft.yb&&(ft.yb=0),0>ft.zb&&(ft.zb=0)),ft.Va=zt.o+15+Jt>>4,ft.Hb=zt.va+15+Jt>>4,ft.Hb>ft.za&&(ft.Hb=ft.za),ft.Va>ft.Ub&&(ft.Va=ft.Ub),0<ft.L){var En=ft.ed;for(Jt=0;4>Jt;++Jt){var y;if(ft.Qa.Cb){var a=ft.Qa.Lb[Jt];ft.Qa.Fb||(a+=En.Tb)}else a=En.Tb;for(y=0;1>=y;++y){var f=ft.gd[Jt][y],v=a;if(En.Pc&&(v+=En.vd[0],y&&(v+=En.od[0])),0<(v=0>v?0:63<v?63:v)){var S=v;0<En.wb&&(S=4<En.wb?S>>2:S>>1)>9-En.wb&&(S=9-En.wb),1>S&&(S=1),f.dd=S,f.tc=2*v+S,f.ld=40<=v?2:15<=v?1:0}else f.tc=0;f.La=y}}}Jt=0}else vi(ft,6,"Frame setup failed"),Jt=ft.a;if(Jt=Jt==0){if(Jt){ft.$c=0,0<ft.Aa||(ft.Ic=lr);t:{Jt=ft.Ic,En=4*(S=ft.za);var T=32*S,N=S+1,z=0<ft.L?S*(0<ft.Aa?2:1):0,$=(ft.Aa==2?2:1)*S;if((f=En+832+(y=3*(16*Jt+cc[ft.L])/2*T)+(a=ft.Fa!=null&&0<ft.Fa.length?ft.Kc.c*ft.Kc.i:0))!=f)Jt=0;else{if(f>ft.Vb){if(ft.Vb=0,ft.Ec=u(f),ft.Fc=0,ft.Ec==null){Jt=vi(ft,1,"no memory during frame initialization.");break t}ft.Vb=f}f=ft.Ec,v=ft.Fc,ft.Ac=f,ft.Bc=v,v+=En,ft.Gd=m(T,ra),ft.Hd=0,ft.rb=m(N+1,Xa),ft.sb=1,ft.wa=z?m(z,Zo):null,ft.Y=0,ft.D.Nb=0,ft.D.wa=ft.wa,ft.D.Y=ft.Y,0<ft.Aa&&(ft.D.Y+=S),e(!0),ft.oc=f,ft.pc=v,v+=832,ft.ya=m($,ec),ft.aa=0,ft.D.ya=ft.ya,ft.D.aa=ft.aa,ft.Aa==2&&(ft.D.aa+=S),ft.R=16*S,ft.B=8*S,S=(T=cc[ft.L])*ft.R,T=T/2*ft.B,ft.sa=f,ft.ta=v+S,ft.qa=ft.sa,ft.ra=ft.ta+16*Jt*ft.R+T,ft.Ha=ft.qa,ft.Ia=ft.ra+8*Jt*ft.B+T,ft.$c=0,v+=y,ft.mb=a?f:null,ft.nb=a?v:null,e(v+a<=ft.Fc+ft.Vb),ll(ft),c(ft.Ac,ft.Bc,0,En),Jt=1}}if(Jt){if(zt.ka=0,zt.y=ft.sa,zt.O=ft.ta,zt.f=ft.qa,zt.N=ft.ra,zt.ea=ft.Ha,zt.Vd=ft.Ia,zt.fa=ft.R,zt.Rc=ft.B,zt.F=null,zt.J=0,!Tl){for(Jt=-255;255>=Jt;++Jt)jr[255+Jt]=0>Jt?-Jt:Jt;for(Jt=-1020;1020>=Jt;++Jt)Qu[1020+Jt]=-128>Jt?-128:127<Jt?127:Jt;for(Jt=-112;112>=Jt;++Jt)eh[112+Jt]=-16>Jt?-16:15<Jt?15:Jt;for(Jt=-255;510>=Jt;++Jt)Bi[255+Jt]=0>Jt?0:255<Jt?255:Jt;Tl=1}vs=ji,vu=Ta,ga=xi,Go=Mi,Po=El,la=zs,Hs=ul,ya=$s,Ol=W,Dh=Ce,Ju=Gs,xu=Sc,Du=pt,Uc=yt,bh=Vs,Fh=Ai,tl=Ss,Tc=qs,ja[0]=xh,ja[1]=Fi,ja[2]=Jo,ja[3]=Eo,ja[4]=ku,ja[5]=js,ja[6]=mo,ja[7]=Mu,ja[8]=go,ja[9]=Ko,ca[0]=Da,ca[1]=tc,ca[2]=eu,ca[3]=bc,ca[4]=Ms,ca[5]=Oi,ca[6]=Fa,nl[0]=Uo,nl[1]=yu,nl[2]=Ml,nl[3]=Oa,nl[4]=Xo,nl[5]=zc,nl[6]=pa,Jt=1}else Jt=0}Jt&&(Jt=(function(Q,te){for(Q.M=0;Q.M<Q.Va;++Q.M){var ge,Ae=Q.Jc[Q.M&Q.Xb],Le=Q.m,Ze=Q;for(ge=0;ge<Ze.za;++ge){var Ue=Le,Xe=Ze,_e=Xe.Ac,Ge=Xe.Bc+4*ge,it=Xe.zc,ot=Xe.ya[Xe.aa+ge];if(Xe.Qa.Bb?ot.$b=tn(Ue,Xe.Pa.jb[0])?2+tn(Ue,Xe.Pa.jb[2]):tn(Ue,Xe.Pa.jb[1]):ot.$b=0,Xe.kc&&(ot.Ad=tn(Ue,Xe.Bd)),ot.Za=!tn(Ue,145)+0,ot.Za){var bt=ot.Ob,wt=0;for(Xe=0;4>Xe;++Xe){var _t,Pt=it[0+Xe];for(_t=0;4>_t;++_t){Pt=Zf[_e[Ge+_t]][Pt];for(var kt=ac[tn(Ue,Pt[0])];0<kt;)kt=ac[2*kt+tn(Ue,Pt[kt])];Pt=-kt,_e[Ge+_t]=Pt}i(bt,wt,_e,Ge,4),wt+=4,it[0+Xe]=Pt}}else Pt=tn(Ue,156)?tn(Ue,128)?1:3:tn(Ue,163)?2:0,ot.Ob[0]=Pt,c(_e,Ge,Pt,4),c(it,0,Pt,4);ot.Dd=tn(Ue,142)?tn(Ue,114)?tn(Ue,183)?1:3:2:0}if(Ze.m.Ka)return vi(Q,7,"Premature end-of-partition0 encountered.");for(;Q.ja<Q.za;++Q.ja){if(Ze=Ae,Ue=(Le=Q).rb[Le.sb-1],_e=Le.rb[Le.sb+Le.ja],ge=Le.ya[Le.aa+Le.ja],Ge=Le.kc?ge.Ad:0)Ue.la=_e.la=0,ge.Za||(Ue.Na=_e.Na=0),ge.Hc=0,ge.Gc=0,ge.ia=0;else{var jt,_n;if(Ue=_e,_e=Ze,Ge=Le.Pa.Xc,it=Le.ya[Le.aa+Le.ja],ot=Le.pb[it.$b],Xe=it.ad,bt=0,wt=Le.rb[Le.sb-1],Pt=_t=0,c(Xe,bt,0,384),it.Za)var Ut=0,cn=Ge[3];else{kt=u(16);var Wt=Ue.Na+wt.Na;if(Wt=Ks(_e,Ge[1],Wt,ot.Eb,0,kt,0),Ue.Na=wt.Na=(0<Wt)+0,1<Wt)vs(kt,0,Xe,bt);else{var In=kt[0]+3>>3;for(kt=0;256>kt;kt+=16)Xe[bt+kt]=In}Ut=1,cn=Ge[0]}var Bt=15&Ue.la,Yt=15&wt.la;for(kt=0;4>kt;++kt){var Tn=1&Yt;for(In=_n=0;4>In;++In)Bt=Bt>>1|(Tn=(Wt=Ks(_e,cn,Wt=Tn+(1&Bt),ot.Sc,Ut,Xe,bt))>Ut)<<7,_n=_n<<2|(3<Wt?3:1<Wt?2:Xe[bt+0]!=0),bt+=16;Bt>>=4,Yt=Yt>>1|Tn<<7,_t=(_t<<8|_n)>>>0}for(cn=Bt,Ut=Yt>>4,jt=0;4>jt;jt+=2){for(_n=0,Bt=Ue.la>>4+jt,Yt=wt.la>>4+jt,kt=0;2>kt;++kt){for(Tn=1&Yt,In=0;2>In;++In)Wt=Tn+(1&Bt),Bt=Bt>>1|(Tn=0<(Wt=Ks(_e,Ge[2],Wt,ot.Qc,0,Xe,bt)))<<3,_n=_n<<2|(3<Wt?3:1<Wt?2:Xe[bt+0]!=0),bt+=16;Bt>>=2,Yt=Yt>>1|Tn<<5}Pt|=_n<<4*jt,cn|=Bt<<4<<jt,Ut|=(240&Yt)<<jt}Ue.la=cn,wt.la=Ut,it.Hc=_t,it.Gc=Pt,it.ia=43690&Pt?0:ot.ia,Ge=!(_t|Pt)}if(0<Le.L&&(Le.wa[Le.Y+Le.ja]=Le.gd[ge.$b][ge.Za],Le.wa[Le.Y+Le.ja].La|=!Ge),Ze.Ka)return vi(Q,7,"Premature end-of-file encountered.")}if(ll(Q),Le=te,Ze=1,ge=(Ae=Q).D,Ue=0<Ae.L&&Ae.M>=Ae.zb&&Ae.M<=Ae.Va,Ae.Aa==0)t:{if(ge.M=Ae.M,ge.uc=Ue,Ji(Ae,ge),Ze=1,ge=(_n=Ae.D).Nb,Ue=(Pt=cc[Ae.L])*Ae.R,_e=Pt/2*Ae.B,kt=16*ge*Ae.R,In=8*ge*Ae.B,Ge=Ae.sa,it=Ae.ta-Ue+kt,ot=Ae.qa,Xe=Ae.ra-_e+In,bt=Ae.Ha,wt=Ae.Ia-_e+In,Yt=(Bt=_n.M)==0,_t=Bt>=Ae.Va-1,Ae.Aa==2&&Ji(Ae,_n),_n.uc)for(Tn=(Wt=Ae).D.M,e(Wt.D.uc),_n=Wt.yb;_n<Wt.Hb;++_n){Ut=_n,cn=Tn;var bn=(Rn=(Pi=Wt).D).Nb;jt=Pi.R;var Rn=Rn.wa[Rn.Y+Ut],hr=Pi.sa,mr=Pi.ta+16*bn*jt+16*Ut,sr=Rn.dd,dr=Rn.tc;if(dr!=0)if(e(3<=dr),Pi.L==1)0<Ut&&Fh(hr,mr,jt,dr+4),Rn.La&&Tc(hr,mr,jt,dr),0<cn&&bh(hr,mr,jt,dr+4),Rn.La&&tl(hr,mr,jt,dr);else{var oi=Pi.B,di=Pi.qa,_r=Pi.ra+8*bn*oi+8*Ut,Zr=Pi.Ha,Pi=Pi.Ia+8*bn*oi+8*Ut;bn=Rn.ld,0<Ut&&(ya(hr,mr,jt,dr+4,sr,bn),Dh(di,_r,Zr,Pi,oi,dr+4,sr,bn)),Rn.La&&(xu(hr,mr,jt,dr,sr,bn),Uc(di,_r,Zr,Pi,oi,dr,sr,bn)),0<cn&&(Hs(hr,mr,jt,dr+4,sr,bn),Ol(di,_r,Zr,Pi,oi,dr+4,sr,bn)),Rn.La&&(Ju(hr,mr,jt,dr,sr,bn),Du(di,_r,Zr,Pi,oi,dr,sr,bn))}}if(Ae.ia&&alert("todo:DitherRow"),Le.put!=null){if(_n=16*Bt,Bt=16*(Bt+1),Yt?(Le.y=Ae.sa,Le.O=Ae.ta+kt,Le.f=Ae.qa,Le.N=Ae.ra+In,Le.ea=Ae.Ha,Le.W=Ae.Ia+In):(_n-=Pt,Le.y=Ge,Le.O=it,Le.f=ot,Le.N=Xe,Le.ea=bt,Le.W=wt),_t||(Bt-=Pt),Bt>Le.o&&(Bt=Le.o),Le.F=null,Le.J=null,Ae.Fa!=null&&0<Ae.Fa.length&&_n<Bt&&(Le.J=Qo(Ae,Le,_n,Bt-_n),Le.F=Ae.mb,Le.F==null&&Le.F.length==0)){Ze=vi(Ae,3,"Could not decode alpha data.");break t}_n<Le.j&&(Pt=Le.j-_n,_n=Le.j,e(!(1&Pt)),Le.O+=Ae.R*Pt,Le.N+=Ae.B*(Pt>>1),Le.W+=Ae.B*(Pt>>1),Le.F!=null&&(Le.J+=Le.width*Pt)),_n<Bt&&(Le.O+=Le.v,Le.N+=Le.v>>1,Le.W+=Le.v>>1,Le.F!=null&&(Le.J+=Le.v),Le.ka=_n-Le.j,Le.U=Le.va-Le.v,Le.T=Bt-_n,Ze=Le.put(Le))}ge+1!=Ae.Ic||_t||(i(Ae.sa,Ae.ta-Ue,Ge,it+16*Ae.R,Ue),i(Ae.qa,Ae.ra-_e,ot,Xe+8*Ae.B,_e),i(Ae.Ha,Ae.Ia-_e,bt,wt+8*Ae.B,_e))}if(!Ze)return vi(Q,6,"Output aborted.")}return 1})(ft,zt)),zt.bc!=null&&zt.bc(zt),Jt&=1}return Jt?(ft.cb=0,Jt):0})(C,oe)||(B=C.a)}}else B=C.a}B==0&&Ke.Oa!=null&&Ke.Oa.fd&&(B=Ru(Ke.ba))}Ke=B}je=Ke!=0?null:11>je?Ye.f.RGBA.eb:Ye.f.kb.y}else je=null;return je};var $c=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function w(F,q){for(var j="",H=0;H<4;H++)j+=String.fromCharCode(F[q++]);return j}function I(F,q){return F[q+0]|F[q+1]<<8}function R(F,q){return(F[q+0]|F[q+1]<<8|F[q+2]<<16)>>>0}function V(F,q){return(F[q+0]|F[q+1]<<8|F[q+2]<<16|F[q+3]<<24)>>>0}new o;var k=[0],ie=[0],ae=[],fe=new o,J=n,ne=(function(F,q){var j={},H=0,Z=!1,be=0,Me=0;if(j.frames=[],!(function(le,Ne){for(var Oe=0;Oe<4;Oe++)if(le[Ne+Oe]!="RIFF".charCodeAt(Oe))return!0;return!1})(F,q)){for(V(F,q+=4),q+=8;q<F.length;){var Be=w(F,q),Re=V(F,q+=4);q+=4;var we=Re+(1&Re);switch(Be){case"VP8 ":case"VP8L":j.frames[H]===void 0&&(j.frames[H]={}),(xe=j.frames[H]).src_off=Z?Me:q-8,xe.src_size=be+Re+8,H++,Z&&(Z=!1,be=0,Me=0);break;case"VP8X":(xe=j.header={}).feature_flags=F[q];var De=q+4;xe.canvas_width=1+R(F,De),De+=3,xe.canvas_height=1+R(F,De),De+=3;break;case"ALPH":Z=!0,be=we+8,Me=q-8;break;case"ANIM":(xe=j.header).bgcolor=V(F,q),De=q+4,xe.loop_count=I(F,De),De+=2;break;case"ANMF":var nt,xe;(xe=j.frames[H]={}).offset_x=2*R(F,q),q+=3,xe.offset_y=2*R(F,q),q+=3,xe.width=1+R(F,q),q+=3,xe.height=1+R(F,q),q+=3,xe.duration=R(F,q),q+=3,nt=F[q++],xe.dispose=1&nt,xe.blend=nt>>1&1}Be!="ANMF"&&(q+=we)}return j}})(J,0);ne.response=J,ne.rgbaoutput=!0,ne.dataurl=!1;var me=ne.header?ne.header:null,ue=ne.frames?ne.frames:null;if(me){me.loop_counter=me.loop_count,k=[me.canvas_height],ie=[me.canvas_width];for(var ke=0;ke<ue.length&&ue[ke].blend!=0;ke++);}var ze=ue[0],pe=fe.WebPDecodeRGBA(J,ze.src_off,ze.src_size,ie,k);ze.rgba=pe,ze.imgwidth=ie[0],ze.imgheight=k[0];for(var U=0;U<ie[0]*k[0]*4;U++)ae[U]=pe[U];return this.width=ie,this.height=k,this.data=ae,this}(function(n){var e,t,i,c,u,m,_,o,w,I=function(le){return le=le||{},this.isStrokeTransparent=le.isStrokeTransparent||!1,this.strokeOpacity=le.strokeOpacity||1,this.strokeStyle=le.strokeStyle||"#000000",this.fillStyle=le.fillStyle||"#000000",this.isFillTransparent=le.isFillTransparent||!1,this.fillOpacity=le.fillOpacity||1,this.font=le.font||"10px sans-serif",this.textBaseline=le.textBaseline||"alphabetic",this.textAlign=le.textAlign||"left",this.lineWidth=le.lineWidth||1,this.lineJoin=le.lineJoin||"miter",this.lineCap=le.lineCap||"butt",this.path=le.path||[],this.transform=le.transform!==void 0?le.transform.clone():new o,this.globalCompositeOperation=le.globalCompositeOperation||"normal",this.globalAlpha=le.globalAlpha||1,this.clip_path=le.clip_path||[],this.currentPoint=le.currentPoint||new m,this.miterLimit=le.miterLimit||10,this.lastPoint=le.lastPoint||new m,this.lineDashOffset=le.lineDashOffset||0,this.lineDash=le.lineDash||[],this.margin=le.margin||[0,0,0,0],this.prevPageLastElemOffset=le.prevPageLastElemOffset||0,this.ignoreClearRect=typeof le.ignoreClearRect!="boolean"||le.ignoreClearRect,this};n.events.push(["initialized",function(){this.context2d=new R(this),e=this.internal.f2,t=this.internal.getCoordinateString,i=this.internal.getVerticalCoordinateString,c=this.internal.getHorizontalCoordinate,u=this.internal.getVerticalCoordinate,m=this.internal.Point,_=this.internal.Rectangle,o=this.internal.Matrix,w=new I}]);var R=function(le){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var Ne=le;Object.defineProperty(this,"pdf",{get:function(){return Ne}});var Oe=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return Oe},set:function(Gt){Oe=!!Gt}});var Je=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return Je},set:function(Gt){Je=!!Gt}});var rt=0;Object.defineProperty(this,"posX",{get:function(){return rt},set:function(Gt){isNaN(Gt)||(rt=Gt)}});var mt=0;Object.defineProperty(this,"posY",{get:function(){return mt},set:function(Gt){isNaN(Gt)||(mt=Gt)}}),Object.defineProperty(this,"margin",{get:function(){return w.margin},set:function(Gt){var st;typeof Gt=="number"?st=[Gt,Gt,Gt,Gt]:((st=new Array(4))[0]=Gt[0],st[1]=Gt.length>=2?Gt[1]:st[0],st[2]=Gt.length>=3?Gt[2]:st[0],st[3]=Gt.length>=4?Gt[3]:st[1]),w.margin=st}});var dt=!1;Object.defineProperty(this,"autoPaging",{get:function(){return dt},set:function(Gt){dt=Gt}});var Dt=0;Object.defineProperty(this,"lastBreak",{get:function(){return Dt},set:function(Gt){Dt=Gt}});var tn=[];Object.defineProperty(this,"pageBreaks",{get:function(){return tn},set:function(Gt){tn=Gt}}),Object.defineProperty(this,"ctx",{get:function(){return w},set:function(Gt){Gt instanceof I&&(w=Gt)}}),Object.defineProperty(this,"path",{get:function(){return w.path},set:function(Gt){w.path=Gt}});var ln=[];Object.defineProperty(this,"ctxStack",{get:function(){return ln},set:function(Gt){ln=Gt}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(Gt){var st;st=V(Gt),this.ctx.fillStyle=st.style,this.ctx.isFillTransparent=st.a===0,this.ctx.fillOpacity=st.a,this.pdf.setFillColor(st.r,st.g,st.b,{a:st.a}),this.pdf.setTextColor(st.r,st.g,st.b,{a:st.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(Gt){var st=V(Gt);this.ctx.strokeStyle=st.style,this.ctx.isStrokeTransparent=st.a===0,this.ctx.strokeOpacity=st.a,st.a===0?this.pdf.setDrawColor(255,255,255):(st.a,this.pdf.setDrawColor(st.r,st.g,st.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(Gt){["butt","round","square"].indexOf(Gt)!==-1&&(this.ctx.lineCap=Gt,this.pdf.setLineCap(Gt))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(Gt){isNaN(Gt)||(this.ctx.lineWidth=Gt,this.pdf.setLineWidth(Gt))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(Gt){["bevel","round","miter"].indexOf(Gt)!==-1&&(this.ctx.lineJoin=Gt,this.pdf.setLineJoin(Gt))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(Gt){isNaN(Gt)||(this.ctx.miterLimit=Gt,this.pdf.setMiterLimit(Gt))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(Gt){this.ctx.textBaseline=Gt}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(Gt){["right","end","center","left","start"].indexOf(Gt)!==-1&&(this.ctx.textAlign=Gt)}});var yn=null,Mn=null;Object.defineProperty(this,"fontFaces",{get:function(){return Mn},set:function(Gt){yn=null,Mn=Gt}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(Gt){var st;if(this.ctx.font=Gt,(st=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(Gt))!==null){var fr=st[1];st[2];var br=st[3],Tr=st[4];st[5];var Cn=st[6],ir=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(Tr)[2];Tr=Math.floor(ir==="px"?parseFloat(Tr)*this.pdf.internal.scaleFactor:ir==="em"?parseFloat(Tr)*this.pdf.getFontSize():parseFloat(Tr)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(Tr);var Jn=(function(Er){var Cr,Si,Li=[],or=Er.trim();if(or==="")return Cb;if(or in TS)return[TS[or]];for(;or!=="";){switch(Si=null,Cr=(or=CS(or)).charAt(0)){case'"':case"'":Si=UM(or.substring(1),Cr);break;default:Si=VM(or)}if(Si===null||(Li.push(Si[0]),(or=CS(Si[1]))!==""&&or.charAt(0)!==","))return Cb;or=or.replace(/^,/,"")}return Li})(Cn);if(this.fontFaces){var Hr=(function(Er,Cr){if(yn===null){var Si=(function(Li){var or=[];return Object.keys(Li).forEach(function(ai){Li[ai].forEach(function(qr){var Dr=null;switch(qr){case"bold":Dr={family:ai,weight:"bold"};break;case"italic":Dr={family:ai,style:"italic"};break;case"bolditalic":Dr={family:ai,weight:"bold",style:"italic"};break;case"":case"normal":Dr={family:ai}}Dr!==null&&(Dr.ref={name:ai,style:qr},or.push(Dr))})}),or})(Er.getFontList());yn=(function(Li){for(var or={},ai=0;ai<Li.length;++ai){var qr=Ib(Li[ai]),Dr=qr.family,hi=qr.stretch,li=qr.style,lt=qr.weight;or[Dr]=or[Dr]||{},or[Dr][hi]=or[Dr][hi]||{},or[Dr][hi][li]=or[Dr][hi][li]||{},or[Dr][hi][li][lt]=qr}return or})(Si.concat(Cr))}return yn})(this.pdf,this.fontFaces),Vt=Jn.map(function(Er){return{family:Er,stretch:"normal",weight:br,style:fr}}),Ln=(function(Er,Cr,Si){for(var Li=(Si=Si||{}).defaultFontFamily||"times",or=Object.assign({},jM,Si.genericFontFamilies||{}),ai=null,qr=null,Dr=0;Dr<Cr.length;++Dr)if(or[(ai=Ib(Cr[Dr])).family]&&(ai.family=or[ai.family]),Er.hasOwnProperty(ai.family)){qr=Er[ai.family];break}if(!(qr=qr||Er[Li]))throw new Error("Could not find a font-family for the rule '"+IS(ai)+"' and default family '"+Li+"'.");if(qr=(function(hi,li){if(li[hi])return li[hi];var lt=S5[hi],Ee=lt<=S5.normal?-1:1,Te=AS(li,U6,lt,Ee);if(!Te)throw new Error("Could not find a matching font-stretch value for "+hi);return Te})(ai.stretch,qr),qr=(function(hi,li){if(li[hi])return li[hi];for(var lt=j6[hi],Ee=0;Ee<lt.length;++Ee)if(li[lt[Ee]])return li[lt[Ee]];throw new Error("Could not find a matching font-style for "+hi)})(ai.style,qr),!(qr=(function(hi,li){if(li[hi])return li[hi];if(hi===400&&li[500])return li[500];if(hi===500&&li[400])return li[400];var lt=zM[hi],Ee=AS(li,V6,lt,hi<400?-1:1);if(!Ee)throw new Error("Could not find a matching font-weight for value "+hi);return Ee})(ai.weight,qr)))throw new Error("Failed to resolve a font for the rule '"+IS(ai)+"'.");return qr})(Hr,Vt);this.pdf.setFont(Ln.ref.name,Ln.ref.style)}else{var $n="";(br==="bold"||parseInt(br,10)>=700||fr==="bold")&&($n="bold"),fr==="italic"&&($n+="italic"),$n.length===0&&($n="normal");for(var Dn="",Mr={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},xr=0;xr<Jn.length;xr++){if(this.pdf.internal.getFont(Jn[xr],$n,{noFallback:!0,disableWarning:!0})!==void 0){Dn=Jn[xr];break}if($n==="bolditalic"&&this.pdf.internal.getFont(Jn[xr],"bold",{noFallback:!0,disableWarning:!0})!==void 0)Dn=Jn[xr],$n="bold";else if(this.pdf.internal.getFont(Jn[xr],"normal",{noFallback:!0,disableWarning:!0})!==void 0){Dn=Jn[xr],$n="normal";break}}if(Dn===""){for(var Sr=0;Sr<Jn.length;Sr++)if(Mr[Jn[Sr]]){Dn=Mr[Jn[Sr]];break}}Dn=Dn===""?"Times":Dn,this.pdf.setFont(Dn,$n)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(Gt){this.ctx.globalCompositeOperation=Gt}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(Gt){this.ctx.globalAlpha=Gt}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(Gt){this.ctx.lineDashOffset=Gt,xe.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(Gt){this.ctx.lineDash=Gt,xe.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(Gt){this.ctx.ignoreClearRect=!!Gt}})};R.prototype.setLineDash=function(le){this.lineDash=le},R.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},R.prototype.fill=function(){ue.call(this,"fill",!1)},R.prototype.stroke=function(){ue.call(this,"stroke",!1)},R.prototype.beginPath=function(){this.path=[{type:"begin"}]},R.prototype.moveTo=function(le,Ne){if(isNaN(le)||isNaN(Ne))throw Ka.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var Oe=this.ctx.transform.applyToPoint(new m(le,Ne));this.path.push({type:"mt",x:Oe.x,y:Oe.y}),this.ctx.lastPoint=new m(le,Ne)},R.prototype.closePath=function(){var le=new m(0,0),Ne=0;for(Ne=this.path.length-1;Ne!==-1;Ne--)if(this.path[Ne].type==="begin"&&wa(this.path[Ne+1])==="object"&&typeof this.path[Ne+1].x=="number"){le=new m(this.path[Ne+1].x,this.path[Ne+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new m(le.x,le.y)},R.prototype.lineTo=function(le,Ne){if(isNaN(le)||isNaN(Ne))throw Ka.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var Oe=this.ctx.transform.applyToPoint(new m(le,Ne));this.path.push({type:"lt",x:Oe.x,y:Oe.y}),this.ctx.lastPoint=new m(Oe.x,Oe.y)},R.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),ue.call(this,null,!0)},R.prototype.quadraticCurveTo=function(le,Ne,Oe,Je){if(isNaN(Oe)||isNaN(Je)||isNaN(le)||isNaN(Ne))throw Ka.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var rt=this.ctx.transform.applyToPoint(new m(Oe,Je)),mt=this.ctx.transform.applyToPoint(new m(le,Ne));this.path.push({type:"qct",x1:mt.x,y1:mt.y,x:rt.x,y:rt.y}),this.ctx.lastPoint=new m(rt.x,rt.y)},R.prototype.bezierCurveTo=function(le,Ne,Oe,Je,rt,mt){if(isNaN(rt)||isNaN(mt)||isNaN(le)||isNaN(Ne)||isNaN(Oe)||isNaN(Je))throw Ka.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var dt=this.ctx.transform.applyToPoint(new m(rt,mt)),Dt=this.ctx.transform.applyToPoint(new m(le,Ne)),tn=this.ctx.transform.applyToPoint(new m(Oe,Je));this.path.push({type:"bct",x1:Dt.x,y1:Dt.y,x2:tn.x,y2:tn.y,x:dt.x,y:dt.y}),this.ctx.lastPoint=new m(dt.x,dt.y)},R.prototype.arc=function(le,Ne,Oe,Je,rt,mt){if(isNaN(le)||isNaN(Ne)||isNaN(Oe)||isNaN(Je)||isNaN(rt))throw Ka.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(mt=!!mt,!this.ctx.transform.isIdentity){var dt=this.ctx.transform.applyToPoint(new m(le,Ne));le=dt.x,Ne=dt.y;var Dt=this.ctx.transform.applyToPoint(new m(0,Oe)),tn=this.ctx.transform.applyToPoint(new m(0,0));Oe=Math.sqrt(Math.pow(Dt.x-tn.x,2)+Math.pow(Dt.y-tn.y,2))}Math.abs(rt-Je)>=2*Math.PI&&(Je=0,rt=2*Math.PI),this.path.push({type:"arc",x:le,y:Ne,radius:Oe,startAngle:Je,endAngle:rt,counterclockwise:mt})},R.prototype.arcTo=function(le,Ne,Oe,Je,rt){throw new Error("arcTo not implemented.")},R.prototype.rect=function(le,Ne,Oe,Je){if(isNaN(le)||isNaN(Ne)||isNaN(Oe)||isNaN(Je))throw Ka.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(le,Ne),this.lineTo(le+Oe,Ne),this.lineTo(le+Oe,Ne+Je),this.lineTo(le,Ne+Je),this.lineTo(le,Ne),this.lineTo(le+Oe,Ne),this.lineTo(le,Ne)},R.prototype.fillRect=function(le,Ne,Oe,Je){if(isNaN(le)||isNaN(Ne)||isNaN(Oe)||isNaN(Je))throw Ka.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!k.call(this)){var rt={};this.lineCap!=="butt"&&(rt.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(rt.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(le,Ne,Oe,Je),this.fill(),rt.hasOwnProperty("lineCap")&&(this.lineCap=rt.lineCap),rt.hasOwnProperty("lineJoin")&&(this.lineJoin=rt.lineJoin)}},R.prototype.strokeRect=function(le,Ne,Oe,Je){if(isNaN(le)||isNaN(Ne)||isNaN(Oe)||isNaN(Je))throw Ka.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");ie.call(this)||(this.beginPath(),this.rect(le,Ne,Oe,Je),this.stroke())},R.prototype.clearRect=function(le,Ne,Oe,Je){if(isNaN(le)||isNaN(Ne)||isNaN(Oe)||isNaN(Je))throw Ka.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(le,Ne,Oe,Je))},R.prototype.save=function(le){le=typeof le!="boolean"||le;for(var Ne=this.pdf.internal.getCurrentPageInfo().pageNumber,Oe=0;Oe<this.pdf.internal.getNumberOfPages();Oe++)this.pdf.setPage(Oe+1),this.pdf.internal.out("q");if(this.pdf.setPage(Ne),le){this.ctx.fontSize=this.pdf.internal.getFontSize();var Je=new I(this.ctx);this.ctxStack.push(this.ctx),this.ctx=Je}},R.prototype.restore=function(le){le=typeof le!="boolean"||le;for(var Ne=this.pdf.internal.getCurrentPageInfo().pageNumber,Oe=0;Oe<this.pdf.internal.getNumberOfPages();Oe++)this.pdf.setPage(Oe+1),this.pdf.internal.out("Q");this.pdf.setPage(Ne),le&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},R.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var V=function(le){var Ne,Oe,Je,rt;if(le.isCanvasGradient===!0&&(le=le.getColor()),!le)return{r:0,g:0,b:0,a:0,style:le};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(le))Ne=0,Oe=0,Je=0,rt=0;else{var mt=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(le);if(mt!==null)Ne=parseInt(mt[1]),Oe=parseInt(mt[2]),Je=parseInt(mt[3]),rt=1;else if((mt=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(le))!==null)Ne=parseInt(mt[1]),Oe=parseInt(mt[2]),Je=parseInt(mt[3]),rt=parseFloat(mt[4]);else{if(rt=1,typeof le=="string"&&le.charAt(0)!=="#"){var dt=new R6(le);le=dt.ok?dt.toHex():"#000000"}le.length===4?(Ne=le.substring(1,2),Ne+=Ne,Oe=le.substring(2,3),Oe+=Oe,Je=le.substring(3,4),Je+=Je):(Ne=le.substring(1,3),Oe=le.substring(3,5),Je=le.substring(5,7)),Ne=parseInt(Ne,16),Oe=parseInt(Oe,16),Je=parseInt(Je,16)}}return{r:Ne,g:Oe,b:Je,a:rt,style:le}},k=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},ie=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};R.prototype.fillText=function(le,Ne,Oe,Je){if(isNaN(Ne)||isNaN(Oe)||typeof le!="string")throw Ka.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(Je=isNaN(Je)?void 0:Je,!k.call(this)){var rt=we(this.ctx.transform.rotation),mt=this.ctx.transform.scaleX;H.call(this,{text:le,x:Ne,y:Oe,scale:mt,angle:rt,align:this.textAlign,maxWidth:Je})}},R.prototype.strokeText=function(le,Ne,Oe,Je){if(isNaN(Ne)||isNaN(Oe)||typeof le!="string")throw Ka.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!ie.call(this)){Je=isNaN(Je)?void 0:Je;var rt=we(this.ctx.transform.rotation),mt=this.ctx.transform.scaleX;H.call(this,{text:le,x:Ne,y:Oe,scale:mt,renderingMode:"stroke",angle:rt,align:this.textAlign,maxWidth:Je})}},R.prototype.measureText=function(le){if(typeof le!="string")throw Ka.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var Ne=this.pdf,Oe=this.pdf.internal.scaleFactor,Je=Ne.internal.getFontSize(),rt=Ne.getStringUnitWidth(le)*Je/Ne.internal.scaleFactor;return new function(mt){var dt=(mt=mt||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return dt}}),this}({width:rt*=Math.round(96*Oe/72*1e4)/1e4})},R.prototype.scale=function(le,Ne){if(isNaN(le)||isNaN(Ne))throw Ka.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var Oe=new o(le,0,0,Ne,0,0);this.ctx.transform=this.ctx.transform.multiply(Oe)},R.prototype.rotate=function(le){if(isNaN(le))throw Ka.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var Ne=new o(Math.cos(le),Math.sin(le),-Math.sin(le),Math.cos(le),0,0);this.ctx.transform=this.ctx.transform.multiply(Ne)},R.prototype.translate=function(le,Ne){if(isNaN(le)||isNaN(Ne))throw Ka.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var Oe=new o(1,0,0,1,le,Ne);this.ctx.transform=this.ctx.transform.multiply(Oe)},R.prototype.transform=function(le,Ne,Oe,Je,rt,mt){if(isNaN(le)||isNaN(Ne)||isNaN(Oe)||isNaN(Je)||isNaN(rt)||isNaN(mt))throw Ka.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var dt=new o(le,Ne,Oe,Je,rt,mt);this.ctx.transform=this.ctx.transform.multiply(dt)},R.prototype.setTransform=function(le,Ne,Oe,Je,rt,mt){le=isNaN(le)?1:le,Ne=isNaN(Ne)?0:Ne,Oe=isNaN(Oe)?0:Oe,Je=isNaN(Je)?1:Je,rt=isNaN(rt)?0:rt,mt=isNaN(mt)?0:mt,this.ctx.transform=new o(le,Ne,Oe,Je,rt,mt)};var ae=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};R.prototype.drawImage=function(le,Ne,Oe,Je,rt,mt,dt,Dt,tn){var ln=this.pdf.getImageProperties(le),yn=1,Mn=1,Gt=1,st=1;Je!==void 0&&Dt!==void 0&&(Gt=Dt/Je,st=tn/rt,yn=ln.width/Je*Dt/Je,Mn=ln.height/rt*tn/rt),mt===void 0&&(mt=Ne,dt=Oe,Ne=0,Oe=0),Je!==void 0&&Dt===void 0&&(Dt=Je,tn=rt),Je===void 0&&Dt===void 0&&(Dt=ln.width,tn=ln.height);for(var fr,br=this.ctx.transform.decompose(),Tr=we(br.rotate.shx),Cn=new o,ir=(Cn=(Cn=(Cn=Cn.multiply(br.translate)).multiply(br.skew)).multiply(br.scale)).applyToRectangle(new _(mt-Ne*Gt,dt-Oe*st,Je*yn,rt*Mn)),Jn=fe.call(this,ir),Hr=[],Vt=0;Vt<Jn.length;Vt+=1)Hr.indexOf(Jn[Vt])===-1&&Hr.push(Jn[Vt]);if(me(Hr),this.autoPaging)for(var Ln=Hr[0],$n=Hr[Hr.length-1],Dn=Ln;Dn<$n+1;Dn++){this.pdf.setPage(Dn);var Mr=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],xr=Dn===1?this.posY+this.margin[0]:this.margin[0],Sr=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Er=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Cr=Dn===1?0:Sr+(Dn-2)*Er;if(this.ctx.clip_path.length!==0){var Si=this.path;fr=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=ne(fr,this.posX+this.margin[3],-Cr+xr+this.ctx.prevPageLastElemOffset),ke.call(this,"fill",!0),this.path=Si}var Li=JSON.parse(JSON.stringify(ir));Li=ne([Li],this.posX+this.margin[3],-Cr+xr+this.ctx.prevPageLastElemOffset)[0];var or=(Dn>Ln||Dn<$n)&&ae.call(this);or&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Mr,Er,null).clip().discardPath()),this.pdf.addImage(le,"JPEG",Li.x,Li.y,Li.w,Li.h,null,null,Tr),or&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(le,"JPEG",ir.x,ir.y,ir.w,ir.h,null,null,Tr)};var fe=function(le,Ne,Oe){var Je=[];Ne=Ne||this.pdf.internal.pageSize.width,Oe=Oe||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var rt=this.posY+this.ctx.prevPageLastElemOffset;switch(le.type){default:case"mt":case"lt":Je.push(Math.floor((le.y+rt)/Oe)+1);break;case"arc":Je.push(Math.floor((le.y+rt-le.radius)/Oe)+1),Je.push(Math.floor((le.y+rt+le.radius)/Oe)+1);break;case"qct":var mt=De(this.ctx.lastPoint.x,this.ctx.lastPoint.y,le.x1,le.y1,le.x,le.y);Je.push(Math.floor((mt.y+rt)/Oe)+1),Je.push(Math.floor((mt.y+mt.h+rt)/Oe)+1);break;case"bct":var dt=nt(this.ctx.lastPoint.x,this.ctx.lastPoint.y,le.x1,le.y1,le.x2,le.y2,le.x,le.y);Je.push(Math.floor((dt.y+rt)/Oe)+1),Je.push(Math.floor((dt.y+dt.h+rt)/Oe)+1);break;case"rect":Je.push(Math.floor((le.y+rt)/Oe)+1),Je.push(Math.floor((le.y+le.h+rt)/Oe)+1)}for(var Dt=0;Dt<Je.length;Dt+=1)for(;this.pdf.internal.getNumberOfPages()<Je[Dt];)J.call(this);return Je},J=function(){var le=this.fillStyle,Ne=this.strokeStyle,Oe=this.font,Je=this.lineCap,rt=this.lineWidth,mt=this.lineJoin;this.pdf.addPage(),this.fillStyle=le,this.strokeStyle=Ne,this.font=Oe,this.lineCap=Je,this.lineWidth=rt,this.lineJoin=mt},ne=function(le,Ne,Oe){for(var Je=0;Je<le.length;Je++)switch(le[Je].type){case"bct":le[Je].x2+=Ne,le[Je].y2+=Oe;case"qct":le[Je].x1+=Ne,le[Je].y1+=Oe;default:le[Je].x+=Ne,le[Je].y+=Oe}return le},me=function(le){return le.sort(function(Ne,Oe){return Ne-Oe})},ue=function(le,Ne){for(var Oe,Je,rt=this.fillStyle,mt=this.strokeStyle,dt=this.lineCap,Dt=this.lineWidth,tn=Math.abs(Dt*this.ctx.transform.scaleX),ln=this.lineJoin,yn=JSON.parse(JSON.stringify(this.path)),Mn=JSON.parse(JSON.stringify(this.path)),Gt=[],st=0;st<Mn.length;st++)if(Mn[st].x!==void 0)for(var fr=fe.call(this,Mn[st]),br=0;br<fr.length;br+=1)Gt.indexOf(fr[br])===-1&&Gt.push(fr[br]);for(var Tr=0;Tr<Gt.length;Tr++)for(;this.pdf.internal.getNumberOfPages()<Gt[Tr];)J.call(this);if(me(Gt),this.autoPaging)for(var Cn=Gt[0],ir=Gt[Gt.length-1],Jn=Cn;Jn<ir+1;Jn++){this.pdf.setPage(Jn),this.fillStyle=rt,this.strokeStyle=mt,this.lineCap=dt,this.lineWidth=tn,this.lineJoin=ln;var Hr=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Vt=Jn===1?this.posY+this.margin[0]:this.margin[0],Ln=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],$n=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Dn=Jn===1?0:Ln+(Jn-2)*$n;if(this.ctx.clip_path.length!==0){var Mr=this.path;Oe=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=ne(Oe,this.posX+this.margin[3],-Dn+Vt+this.ctx.prevPageLastElemOffset),ke.call(this,le,!0),this.path=Mr}if(Je=JSON.parse(JSON.stringify(yn)),this.path=ne(Je,this.posX+this.margin[3],-Dn+Vt+this.ctx.prevPageLastElemOffset),Ne===!1||Jn===0){var xr=(Jn>Cn||Jn<ir)&&ae.call(this);xr&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Hr,$n,null).clip().discardPath()),ke.call(this,le,Ne),xr&&this.pdf.restoreGraphicsState()}this.lineWidth=Dt}else this.lineWidth=tn,ke.call(this,le,Ne),this.lineWidth=Dt;this.path=yn},ke=function(le,Ne){if((le!=="stroke"||Ne||!ie.call(this))&&(le==="stroke"||Ne||!k.call(this))){for(var Oe,Je,rt=[],mt=this.path,dt=0;dt<mt.length;dt++){var Dt=mt[dt];switch(Dt.type){case"begin":rt.push({begin:!0});break;case"close":rt.push({close:!0});break;case"mt":rt.push({start:Dt,deltas:[],abs:[]});break;case"lt":var tn=rt.length;if(mt[dt-1]&&!isNaN(mt[dt-1].x)&&(Oe=[Dt.x-mt[dt-1].x,Dt.y-mt[dt-1].y],tn>0)){for(;tn>=0;tn--)if(rt[tn-1].close!==!0&&rt[tn-1].begin!==!0){rt[tn-1].deltas.push(Oe),rt[tn-1].abs.push(Dt);break}}break;case"bct":Oe=[Dt.x1-mt[dt-1].x,Dt.y1-mt[dt-1].y,Dt.x2-mt[dt-1].x,Dt.y2-mt[dt-1].y,Dt.x-mt[dt-1].x,Dt.y-mt[dt-1].y],rt[rt.length-1].deltas.push(Oe);break;case"qct":var ln=mt[dt-1].x+2/3*(Dt.x1-mt[dt-1].x),yn=mt[dt-1].y+2/3*(Dt.y1-mt[dt-1].y),Mn=Dt.x+2/3*(Dt.x1-Dt.x),Gt=Dt.y+2/3*(Dt.y1-Dt.y),st=Dt.x,fr=Dt.y;Oe=[ln-mt[dt-1].x,yn-mt[dt-1].y,Mn-mt[dt-1].x,Gt-mt[dt-1].y,st-mt[dt-1].x,fr-mt[dt-1].y],rt[rt.length-1].deltas.push(Oe);break;case"arc":rt.push({deltas:[],abs:[],arc:!0}),Array.isArray(rt[rt.length-1].abs)&&rt[rt.length-1].abs.push(Dt)}}Je=Ne?null:le==="stroke"?"stroke":"fill";for(var br=!1,Tr=0;Tr<rt.length;Tr++)if(rt[Tr].arc)for(var Cn=rt[Tr].abs,ir=0;ir<Cn.length;ir++){var Jn=Cn[ir];Jn.type==="arc"?U.call(this,Jn.x,Jn.y,Jn.radius,Jn.startAngle,Jn.endAngle,Jn.counterclockwise,void 0,Ne,!br):Z.call(this,Jn.x,Jn.y),br=!0}else if(rt[Tr].close===!0)this.pdf.internal.out("h"),br=!1;else if(rt[Tr].begin!==!0){var Hr=rt[Tr].start.x,Vt=rt[Tr].start.y;be.call(this,rt[Tr].deltas,Hr,Vt),br=!0}Je&&F.call(this,Je),Ne&&q.call(this)}},ze=function(le){var Ne=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,Oe=Ne*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return le-Oe;case"top":return le+Ne-Oe;case"hanging":return le+Ne-2*Oe;case"middle":return le+Ne/2-Oe;default:return le}},pe=function(le){return le+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};R.prototype.createLinearGradient=function(){var le=function(){};return le.colorStops=[],le.addColorStop=function(Ne,Oe){this.colorStops.push([Ne,Oe])},le.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},le.isCanvasGradient=!0,le},R.prototype.createPattern=function(){return this.createLinearGradient()},R.prototype.createRadialGradient=function(){return this.createLinearGradient()};var U=function(le,Ne,Oe,Je,rt,mt,dt,Dt,tn){for(var ln=Be.call(this,Oe,Je,rt,mt),yn=0;yn<ln.length;yn++){var Mn=ln[yn];yn===0&&(tn?j.call(this,Mn.x1+le,Mn.y1+Ne):Z.call(this,Mn.x1+le,Mn.y1+Ne)),Me.call(this,le,Ne,Mn.x2,Mn.y2,Mn.x3,Mn.y3,Mn.x4,Mn.y4)}Dt?q.call(this):F.call(this,dt)},F=function(le){switch(le){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},q=function(){this.pdf.clip(),this.pdf.discardPath()},j=function(le,Ne){this.pdf.internal.out(t(le)+" "+i(Ne)+" m")},H=function(le){var Ne;switch(le.align){case"right":case"end":Ne="right";break;case"center":Ne="center";break;default:Ne="left"}var Oe=this.pdf.getTextDimensions(le.text),Je=ze.call(this,le.y),rt=pe.call(this,Je)-Oe.h,mt=this.ctx.transform.applyToPoint(new m(le.x,Je)),dt=this.ctx.transform.decompose(),Dt=new o;Dt=(Dt=(Dt=Dt.multiply(dt.translate)).multiply(dt.skew)).multiply(dt.scale);for(var tn,ln,yn,Mn=this.ctx.transform.applyToRectangle(new _(le.x,Je,Oe.w,Oe.h)),Gt=Dt.applyToRectangle(new _(le.x,rt,Oe.w,Oe.h)),st=fe.call(this,Gt),fr=[],br=0;br<st.length;br+=1)fr.indexOf(st[br])===-1&&fr.push(st[br]);if(me(fr),this.autoPaging)for(var Tr=fr[0],Cn=fr[fr.length-1],ir=Tr;ir<Cn+1;ir++){this.pdf.setPage(ir);var Jn=ir===1?this.posY+this.margin[0]:this.margin[0],Hr=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Vt=this.pdf.internal.pageSize.height-this.margin[2],Ln=Vt-this.margin[0],$n=this.pdf.internal.pageSize.width-this.margin[1],Dn=$n-this.margin[3],Mr=ir===1?0:Hr+(ir-2)*Ln;if(this.ctx.clip_path.length!==0){var xr=this.path;tn=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=ne(tn,this.posX+this.margin[3],-1*Mr+Jn),ke.call(this,"fill",!0),this.path=xr}var Sr=ne([JSON.parse(JSON.stringify(Gt))],this.posX+this.margin[3],-Mr+Jn+this.ctx.prevPageLastElemOffset)[0];le.scale>=.01&&(ln=this.pdf.internal.getFontSize(),this.pdf.setFontSize(ln*le.scale),yn=this.lineWidth,this.lineWidth=yn*le.scale);var Er=this.autoPaging!=="text";if(Er||Sr.y+Sr.h<=Vt){if(Er||Sr.y>=Jn&&Sr.x<=$n){var Cr=Er?le.text:this.pdf.splitTextToSize(le.text,le.maxWidth||$n-Sr.x)[0],Si=ne([JSON.parse(JSON.stringify(Mn))],this.posX+this.margin[3],-Mr+Jn+this.ctx.prevPageLastElemOffset)[0],Li=Er&&(ir>Tr||ir<Cn)&&ae.call(this);Li&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Dn,Ln,null).clip().discardPath()),this.pdf.text(Cr,Si.x,Si.y,{angle:le.angle,align:Ne,renderingMode:le.renderingMode}),Li&&this.pdf.restoreGraphicsState()}}else Sr.y<Vt&&(this.ctx.prevPageLastElemOffset+=Vt-Sr.y);le.scale>=.01&&(this.pdf.setFontSize(ln),this.lineWidth=yn)}else le.scale>=.01&&(ln=this.pdf.internal.getFontSize(),this.pdf.setFontSize(ln*le.scale),yn=this.lineWidth,this.lineWidth=yn*le.scale),this.pdf.text(le.text,mt.x+this.posX,mt.y+this.posY,{angle:le.angle,align:Ne,renderingMode:le.renderingMode,maxWidth:le.maxWidth}),le.scale>=.01&&(this.pdf.setFontSize(ln),this.lineWidth=yn)},Z=function(le,Ne,Oe,Je){Oe=Oe||0,Je=Je||0,this.pdf.internal.out(t(le+Oe)+" "+i(Ne+Je)+" l")},be=function(le,Ne,Oe){return this.pdf.lines(le,Ne,Oe,null,null)},Me=function(le,Ne,Oe,Je,rt,mt,dt,Dt){this.pdf.internal.out([e(c(Oe+le)),e(u(Je+Ne)),e(c(rt+le)),e(u(mt+Ne)),e(c(dt+le)),e(u(Dt+Ne)),"c"].join(" "))},Be=function(le,Ne,Oe,Je){for(var rt=2*Math.PI,mt=Math.PI/2;Ne>Oe;)Ne-=rt;var dt=Math.abs(Oe-Ne);dt<rt&&Je&&(dt=rt-dt);for(var Dt=[],tn=Je?-1:1,ln=Ne;dt>1e-5;){var yn=ln+tn*Math.min(dt,mt);Dt.push(Re.call(this,le,ln,yn)),dt-=Math.abs(yn-ln),ln=yn}return Dt},Re=function(le,Ne,Oe){var Je=(Oe-Ne)/2,rt=le*Math.cos(Je),mt=le*Math.sin(Je),dt=rt,Dt=-mt,tn=dt*dt+Dt*Dt,ln=tn+dt*rt+Dt*mt,yn=4/3*(Math.sqrt(2*tn*ln)-ln)/(dt*mt-Dt*rt),Mn=dt-yn*Dt,Gt=Dt+yn*dt,st=Mn,fr=-Gt,br=Je+Ne,Tr=Math.cos(br),Cn=Math.sin(br);return{x1:le*Math.cos(Ne),y1:le*Math.sin(Ne),x2:Mn*Tr-Gt*Cn,y2:Mn*Cn+Gt*Tr,x3:st*Tr-fr*Cn,y3:st*Cn+fr*Tr,x4:le*Math.cos(Oe),y4:le*Math.sin(Oe)}},we=function(le){return 180*le/Math.PI},De=function(le,Ne,Oe,Je,rt,mt){var dt=le+.5*(Oe-le),Dt=Ne+.5*(Je-Ne),tn=rt+.5*(Oe-rt),ln=mt+.5*(Je-mt),yn=Math.min(le,rt,dt,tn),Mn=Math.max(le,rt,dt,tn),Gt=Math.min(Ne,mt,Dt,ln),st=Math.max(Ne,mt,Dt,ln);return new _(yn,Gt,Mn-yn,st-Gt)},nt=function(le,Ne,Oe,Je,rt,mt,dt,Dt){var tn,ln,yn,Mn,Gt,st,fr,br,Tr,Cn,ir,Jn,Hr,Vt,Ln=Oe-le,$n=Je-Ne,Dn=rt-Oe,Mr=mt-Je,xr=dt-rt,Sr=Dt-mt;for(ln=0;ln<41;ln++)Tr=(fr=(yn=le+(tn=ln/40)*Ln)+tn*((Gt=Oe+tn*Dn)-yn))+tn*(Gt+tn*(rt+tn*xr-Gt)-fr),Cn=(br=(Mn=Ne+tn*$n)+tn*((st=Je+tn*Mr)-Mn))+tn*(st+tn*(mt+tn*Sr-st)-br),ln==0?(ir=Tr,Jn=Cn,Hr=Tr,Vt=Cn):(ir=Math.min(ir,Tr),Jn=Math.min(Jn,Cn),Hr=Math.max(Hr,Tr),Vt=Math.max(Vt,Cn));return new _(Math.round(ir),Math.round(Jn),Math.round(Hr-ir),Math.round(Vt-Jn))},xe=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var le,Ne,Oe=(le=this.ctx.lineDash,Ne=this.ctx.lineDashOffset,JSON.stringify({lineDash:le,lineDashOffset:Ne}));this.prevLineDash!==Oe&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=Oe)}}})(wi.API),(function(n){var e=function(m){var _,o,w,I,R,V,k,ie,ae,fe;for(o=[],w=0,I=(m+=_="\0\0\0\0".slice(m.length%4||4)).length;I>w;w+=4)(R=(m.charCodeAt(w)<<24)+(m.charCodeAt(w+1)<<16)+(m.charCodeAt(w+2)<<8)+m.charCodeAt(w+3))!==0?(V=(R=((R=((R=((R=(R-(fe=R%85))/85)-(ae=R%85))/85)-(ie=R%85))/85)-(k=R%85))/85)%85,o.push(V+33,k+33,ie+33,ae+33,fe+33)):o.push(122);return(function(J,ne){for(var me=ne;me>0;me--)J.pop()})(o,_.length),String.fromCharCode.apply(String,o)+"~>"},t=function(m){var _,o,w,I,R,V=String,k="length",ie=255,ae="charCodeAt",fe="slice",J="replace";for(m[fe](-2),m=m[fe](0,-2)[J](/\s/g,"")[J]("z","!!!!!"),w=[],I=0,R=(m+=_="uuuuu"[fe](m[k]%5||5))[k];R>I;I+=5)o=52200625*(m[ae](I)-33)+614125*(m[ae](I+1)-33)+7225*(m[ae](I+2)-33)+85*(m[ae](I+3)-33)+(m[ae](I+4)-33),w.push(ie&o>>24,ie&o>>16,ie&o>>8,ie&o);return(function(ne,me){for(var ue=me;ue>0;ue--)ne.pop()})(w,_[k]),V.fromCharCode.apply(V,w)},i=function(m){return m.split("").map(function(_){return("0"+_.charCodeAt().toString(16)).slice(-2)}).join("")+">"},c=function(m){var _=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((m=m.replace(/\s/g,"")).indexOf(">")!==-1&&(m=m.substr(0,m.indexOf(">"))),m.length%2&&(m+="0"),_.test(m)===!1)return"";for(var o="",w=0;w<m.length;w+=2)o+=String.fromCharCode("0x"+(m[w]+m[w+1]));return o},u=function(m){for(var _=new Uint8Array(m.length),o=m.length;o--;)_[o]=m.charCodeAt(o);return(_=g5(_)).reduce(function(w,I){return w+String.fromCharCode(I)},"")};n.processDataByFilters=function(m,_){var o=0,w=m||"",I=[];for(typeof(_=_||[])=="string"&&(_=[_]),o=0;o<_.length;o+=1)switch(_[o]){case"ASCII85Decode":case"/ASCII85Decode":w=t(w),I.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":w=e(w),I.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":w=c(w),I.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":w=i(w),I.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":w=u(w),I.push("/FlateDecode");break;default:throw new Error('The filter: "'+_[o]+'" is not implemented')}return{data:w,reverseChain:I.reverse().join(" ")}}})(wi.API),(function(n){n.loadFile=function(e,t,i){return(function(c,u,m){u=u!==!1,m=typeof m=="function"?m:function(){};var _=void 0;try{_=(function(o,w,I){var R=new XMLHttpRequest,V=0,k=function(ie){var ae=ie.length,fe=[],J=String.fromCharCode;for(V=0;V<ae;V+=1)fe.push(J(255&ie.charCodeAt(V)));return fe.join("")};if(R.open("GET",o,!w),R.overrideMimeType("text/plain; charset=x-user-defined"),w===!1&&(R.onload=function(){R.status===200?I(k(this.responseText)):I(void 0)}),R.send(null),w&&R.status===200)return k(R.responseText)})(c,u,m)}catch{}return _})(e,t,i)},n.loadImageFile=n.loadFile})(wi.API),(function(n){function e(){return(so.html2canvas?Promise.resolve(so.html2canvas):cb(()=>import("./html2canvas.esm-B0tyYwQk.js"),[])).catch(function(_){return Promise.reject(new Error("Could not load html2canvas: "+_))}).then(function(_){return _.default?_.default:_})}function t(){return(so.DOMPurify?Promise.resolve(so.DOMPurify):cb(()=>import("./purify.es-B6FQ9oRL.js"),[])).catch(function(_){return Promise.reject(new Error("Could not load dompurify: "+_))}).then(function(_){return _.default?_.default:_})}var i=function(_){var o=wa(_);return o==="undefined"?"undefined":o==="string"||_ instanceof String?"string":o==="number"||_ instanceof Number?"number":o==="function"||_ instanceof Function?"function":_&&_.constructor===Array?"array":_&&_.nodeType===1?"element":o==="object"?"object":"unknown"},c=function(_,o){var w=document.createElement(_);for(var I in o.className&&(w.className=o.className),o.innerHTML&&o.dompurify&&(w.innerHTML=o.dompurify.sanitize(o.innerHTML)),o.style)w.style[I]=o.style[I];return w},u=function _(o,w){for(var I=o.nodeType===3?document.createTextNode(o.nodeValue):o.cloneNode(!1),R=o.firstChild;R;R=R.nextSibling)w!==!0&&R.nodeType===1&&R.nodeName==="SCRIPT"||I.appendChild(_(R,w));return o.nodeType===1&&(o.nodeName==="CANVAS"?(I.width=o.width,I.height=o.height,I.getContext("2d").drawImage(o,0,0)):o.nodeName!=="TEXTAREA"&&o.nodeName!=="SELECT"||(I.value=o.value),I.addEventListener("load",function(){I.scrollTop=o.scrollTop,I.scrollLeft=o.scrollLeft},!0)),I},m=function _(o){var w=Object.assign(_.convert(Promise.resolve()),JSON.parse(JSON.stringify(_.template))),I=_.convert(Promise.resolve(),w);return(I=I.setProgress(1,_,1,[_])).set(o)};(m.prototype=Object.create(Promise.prototype)).constructor=m,m.convert=function(_,o){return _.__proto__=o||m.prototype,_},m.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},m.prototype.from=function(_,o){return this.then(function(){switch(o=o||(function(w){switch(i(w)){case"string":return"string";case"element":return w.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}})(_),o){case"string":return this.then(t).then(function(w){return this.set({src:c("div",{innerHTML:_,dompurify:w})})});case"element":return this.set({src:_});case"canvas":return this.set({canvas:_});case"img":return this.set({img:_});default:return this.error("Unknown source type.")}})},m.prototype.to=function(_){switch(_){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},m.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var _={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},o=u(this.prop.src,this.opt.html2canvas.javascriptEnabled);o.tagName==="BODY"&&(_.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=c("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=c("div",{className:"html2pdf__container",style:_}),this.prop.container.appendChild(o),this.prop.container.firstChild.appendChild(c("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},m.prototype.toCanvas=function(){var _=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(_).then(e).then(function(o){var w=Object.assign({},this.opt.html2canvas);return delete w.onrendered,o(this.prop.container,w)}).then(function(o){(this.opt.html2canvas.onrendered||function(){})(o),this.prop.canvas=o,document.body.removeChild(this.prop.overlay)})},m.prototype.toContext2d=function(){var _=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(_).then(e).then(function(o){var w=this.opt.jsPDF,I=this.opt.fontFaces,R=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,V=Object.assign({async:!0,allowTaint:!0,scale:R,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete V.onrendered,w.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,w.context2d.posX=this.opt.x,w.context2d.posY=this.opt.y,w.context2d.margin=this.opt.margin,w.context2d.fontFaces=I,I)for(var k=0;k<I.length;++k){var ie=I[k],ae=ie.src.find(function(fe){return fe.format==="truetype"});ae&&w.addFont(ae.url,ie.ref.name,ie.ref.style)}return V.windowHeight=V.windowHeight||0,V.windowHeight=V.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):V.windowHeight,w.context2d.save(!0),o(this.prop.container,V)}).then(function(o){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(o),this.prop.canvas=o,document.body.removeChild(this.prop.overlay)})},m.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var _=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=_})},m.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},m.prototype.output=function(_,o,w){return(w=w||"pdf").toLowerCase()==="img"||w.toLowerCase()==="image"?this.outputImg(_,o):this.outputPdf(_,o)},m.prototype.outputPdf=function(_,o){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(_,o)})},m.prototype.outputImg=function(_){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(_){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+_+'" is not supported.'}})},m.prototype.save=function(_){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(_?{filename:_}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},m.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},m.prototype.set=function(_){if(i(_)!=="object")return this;var o=Object.keys(_||{}).map(function(w){if(w in m.template.prop)return function(){this.prop[w]=_[w]};switch(w){case"margin":return this.setMargin.bind(this,_.margin);case"jsPDF":return function(){return this.opt.jsPDF=_.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,_.pageSize);default:return function(){this.opt[w]=_[w]}}},this);return this.then(function(){return this.thenList(o)})},m.prototype.get=function(_,o){return this.then(function(){var w=_ in m.template.prop?this.prop[_]:this.opt[_];return o?o(w):w})},m.prototype.setMargin=function(_){return this.then(function(){switch(i(_)){case"number":_=[_,_,_,_];case"array":if(_.length===2&&(_=[_[0],_[1],_[0],_[1]]),_.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=_}).then(this.setPageSize)},m.prototype.setPageSize=function(_){function o(w,I){return Math.floor(w*I/72*96)}return this.then(function(){(_=_||wi.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(_.inner={width:_.width-this.opt.margin[1]-this.opt.margin[3],height:_.height-this.opt.margin[0]-this.opt.margin[2]},_.inner.px={width:o(_.inner.width,_.k),height:o(_.inner.height,_.k)},_.inner.ratio=_.inner.height/_.inner.width),this.prop.pageSize=_})},m.prototype.setProgress=function(_,o,w,I){return _!=null&&(this.progress.val=_),o!=null&&(this.progress.state=o),w!=null&&(this.progress.n=w),I!=null&&(this.progress.stack=I),this.progress.ratio=this.progress.val/this.progress.state,this},m.prototype.updateProgress=function(_,o,w,I){return this.setProgress(_?this.progress.val+_:null,o||null,w?this.progress.n+w:null,I?this.progress.stack.concat(I):null)},m.prototype.then=function(_,o){var w=this;return this.thenCore(_,o,function(I,R){return w.updateProgress(null,null,1,[I]),Promise.prototype.then.call(this,function(V){return w.updateProgress(null,I),V}).then(I,R).then(function(V){return w.updateProgress(1),V})})},m.prototype.thenCore=function(_,o,w){w=w||Promise.prototype.then;var I=this;_&&(_=_.bind(I)),o&&(o=o.bind(I));var R=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?I:m.convert(Object.assign({},I),Promise.prototype),V=w.call(R,_,o);return m.convert(V,I.__proto__)},m.prototype.thenExternal=function(_,o){return Promise.prototype.then.call(this,_,o)},m.prototype.thenList=function(_){var o=this;return _.forEach(function(w){o=o.thenCore(w)}),o},m.prototype.catch=function(_){_&&(_=_.bind(this));var o=Promise.prototype.catch.call(this,_);return m.convert(o,this)},m.prototype.catchExternal=function(_){return Promise.prototype.catch.call(this,_)},m.prototype.error=function(_){return this.then(function(){throw new Error(_)})},m.prototype.using=m.prototype.set,m.prototype.saveAs=m.prototype.save,m.prototype.export=m.prototype.output,m.prototype.run=m.prototype.then,wi.getPageSize=function(_,o,w){if(wa(_)==="object"){var I=_;_=I.orientation,o=I.unit||o,w=I.format||w}o=o||"mm",w=w||"a4",_=(""+(_||"P")).toLowerCase();var R,V=(""+w).toLowerCase(),k={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(o){case"pt":R=1;break;case"mm":R=72/25.4;break;case"cm":R=72/2.54;break;case"in":R=72;break;case"px":R=.75;break;case"pc":case"em":R=12;break;case"ex":R=6;break;default:throw"Invalid unit: "+o}var ie,ae=0,fe=0;if(k.hasOwnProperty(V))ae=k[V][1]/R,fe=k[V][0]/R;else try{ae=w[1],fe=w[0]}catch{throw new Error("Invalid format: "+w)}if(_==="p"||_==="portrait")_="p",fe>ae&&(ie=fe,fe=ae,ae=ie);else{if(_!=="l"&&_!=="landscape")throw"Invalid orientation: "+_;_="l",ae>fe&&(ie=fe,fe=ae,ae=ie)}return{width:fe,height:ae,unit:o,k:R,orientation:_}},n.html=function(_,o){(o=o||{}).callback=o.callback||function(){},o.html2canvas=o.html2canvas||{},o.html2canvas.canvas=o.html2canvas.canvas||this.canvas,o.jsPDF=o.jsPDF||this,o.fontFaces=o.fontFaces?o.fontFaces.map(Ib):null;var w=new m(o);return o.worker?w:w.from(_).doCallback()}})(wi.API),wi.API.addJS=function(n){return PS=n,this.internal.events.subscribe("postPutResources",function(){y1=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(y1+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),LS=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+PS+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){y1!==void 0&&LS!==void 0&&this.internal.out("/Names <</JavaScript "+y1+" 0 R>>")}),this},(function(n){var e;n.events.push(["postPutResources",function(){var t=this,i=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var c=t.outline.render().split(/\r\n/),u=0;u<c.length;u++){var m=c[u],_=i.exec(m);if(_!=null){var o=_[1];t.internal.newObjectDeferredBegin(o,!1)}t.internal.write(m)}if(this.outline.createNamedDestinations){var w=this.internal.pages.length,I=[];for(u=0;u<w;u++){var R=t.internal.newObject();I.push(R);var V=t.internal.getPageInfo(u+1);t.internal.write("<< /D["+V.objId+" 0 R /XYZ null null null]>> endobj")}var k=t.internal.newObject();for(t.internal.write("<< /Names [ "),u=0;u<I.length;u++)t.internal.write("(page_"+(u+1)+")"+I[u]+" 0 R");t.internal.write(" ] >>","endobj"),e=t.internal.newObject(),t.internal.write("<< /Dests "+k+" 0 R"),t.internal.write(">>","endobj")}}]),n.events.push(["putCatalog",function(){var t=this;t.outline.root.children.length>0&&(t.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&t.internal.write("/Names "+e+" 0 R"))}]),n.events.push(["initialized",function(){var t=this;t.outline={createNamedDestinations:!1,root:{children:[]}},t.outline.add=function(i,c,u){var m={title:c,options:u,children:[]};return i==null&&(i=this.root),i.children.push(m),m},t.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=t,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},t.outline.genIds_r=function(i){i.id=t.internal.newObjectDeferred();for(var c=0;c<i.children.length;c++)this.genIds_r(i.children[c])},t.outline.renderRoot=function(i){this.objStart(i),this.line("/Type /Outlines"),i.children.length>0&&(this.line("/First "+this.makeRef(i.children[0])),this.line("/Last "+this.makeRef(i.children[i.children.length-1]))),this.line("/Count "+this.count_r({count:0},i)),this.objEnd()},t.outline.renderItems=function(i){for(var c=this.ctx.pdf.internal.getVerticalCoordinateString,u=0;u<i.children.length;u++){var m=i.children[u];this.objStart(m),this.line("/Title "+this.makeString(m.title)),this.line("/Parent "+this.makeRef(i)),u>0&&this.line("/Prev "+this.makeRef(i.children[u-1])),u<i.children.length-1&&this.line("/Next "+this.makeRef(i.children[u+1])),m.children.length>0&&(this.line("/First "+this.makeRef(m.children[0])),this.line("/Last "+this.makeRef(m.children[m.children.length-1])));var _=this.count=this.count_r({count:0},m);if(_>0&&this.line("/Count "+_),m.options&&m.options.pageNumber){var o=t.internal.getPageInfo(m.options.pageNumber);this.line("/Dest ["+o.objId+" 0 R /XYZ 0 "+c(0)+" 0]")}this.objEnd()}for(var w=0;w<i.children.length;w++)this.renderItems(i.children[w])},t.outline.line=function(i){this.ctx.val+=i+`\r
`},t.outline.makeRef=function(i){return i.id+" 0 R"},t.outline.makeString=function(i){return"("+t.internal.pdfEscape(i)+")"},t.outline.objStart=function(i){this.ctx.val+=`\r
`+i.id+` 0 obj\r
<<\r
`},t.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},t.outline.count_r=function(i,c){for(var u=0;u<c.children.length;u++)i.count++,this.count_r(i,c.children[u]);return i.count}}])})(wi.API),(function(n){var e=[192,193,194,195,196,197,198,199];n.processJPEG=function(t,i,c,u,m,_){var o,w=this.decode.DCT_DECODE,I=null;if(typeof t=="string"||this.__addimage__.isArrayBuffer(t)||this.__addimage__.isArrayBufferView(t)){switch(t=m||t,t=this.__addimage__.isArrayBuffer(t)?new Uint8Array(t):t,o=(function(R){for(var V,k=256*R.charCodeAt(4)+R.charCodeAt(5),ie=R.length,ae={width:0,height:0,numcomponents:1},fe=4;fe<ie;fe+=2){if(fe+=k,e.indexOf(R.charCodeAt(fe+1))!==-1){V=256*R.charCodeAt(fe+5)+R.charCodeAt(fe+6),ae={width:256*R.charCodeAt(fe+7)+R.charCodeAt(fe+8),height:V,numcomponents:R.charCodeAt(fe+9)};break}k=256*R.charCodeAt(fe+2)+R.charCodeAt(fe+3)}return ae})(t=this.__addimage__.isArrayBufferView(t)?this.__addimage__.arrayBufferToBinaryString(t):t),o.numcomponents){case 1:_=this.color_spaces.DEVICE_GRAY;break;case 4:_=this.color_spaces.DEVICE_CMYK;break;case 3:_=this.color_spaces.DEVICE_RGB}I={data:t,width:o.width,height:o.height,colorSpace:_,bitsPerComponent:8,filter:w,index:i,alias:c}}return I}})(wi.API),wi.API.processPNG=function(n,e,t,i){if(this.__addimage__.isArrayBuffer(n)&&(n=new Uint8Array(n)),this.__addimage__.isArrayBufferView(n)){var c,u=AM(n,{checkCrc:!0}),m=u.width,_=u.height,o=u.channels,w=u.palette,I=u.depth;c=w&&o===1?(function(U){for(var F=U.width,q=U.height,j=U.data,H=U.palette,Z=U.depth,be=!1,Me=[],Be=[],Re=void 0,we=!1,De=0,nt=0;nt<H.length;nt++){var xe=N2(H[nt],4),le=xe[0],Ne=xe[1],Oe=xe[2],Je=xe[3];Me.push(le,Ne,Oe),Je!=null&&(Je===0?(De++,Be.length<1&&Be.push(nt)):Je<255&&(we=!0))}if(we||De>1){be=!0,Be=void 0;var rt=F*q;Re=new Uint8Array(rt);for(var mt=new DataView(j.buffer),dt=0;dt<rt;dt++){var Dt=Lb(mt,dt,Z),tn=N2(H[Dt],4)[3];Re[dt]=tn}}else De===0&&(Be=void 0);return{colorSpace:"Indexed",colorsPerPixel:1,sMaskBitsPerComponent:be?8:void 0,colorBytes:j,alphaBytes:Re,needSMask:be,palette:Me,mask:Be}})(u):o===2||o===4?(function(U){for(var F=U.data,q=U.width,j=U.height,H=U.channels,Z=U.depth,be=H===2?"DeviceGray":"DeviceRGB",Me=H-1,Be=q*j,Re=Me,we=Be*Re,De=1*Be,nt=Math.ceil(we*Z/8),xe=Math.ceil(De*Z/8),le=new Uint8Array(nt),Ne=new Uint8Array(xe),Oe=new DataView(F.buffer),Je=new DataView(le.buffer),rt=new DataView(Ne.buffer),mt=!1,dt=0;dt<Be;dt++){for(var Dt=dt*H,tn=0;tn<Re;tn++)zS(Je,Lb(Oe,Dt+tn,Z),dt*Re+tn,Z);var ln=Lb(Oe,Dt+Re,Z);ln<(1<<Z)-1&&(mt=!0),zS(rt,ln,1*dt,Z)}return{colorSpace:be,colorsPerPixel:Me,sMaskBitsPerComponent:mt?Z:void 0,colorBytes:le,alphaBytes:Ne,needSMask:mt}})(u):(function(U){var F=U.data,q=U.channels===1?"DeviceGray":"DeviceRGB";return{colorSpace:q,colorsPerPixel:q==="DeviceGray"?1:3,colorBytes:F instanceof Uint16Array?(function(j){for(var H=j.length,Z=new Uint8Array(2*H),be=new DataView(Z.buffer,Z.byteOffset,Z.byteLength),Me=0;Me<H;Me++)be.setUint16(2*Me,j[Me],!1);return Z})(F):F,needSMask:!1}})(u);var R,V,k,ie=c,ae=ie.colorSpace,fe=ie.colorsPerPixel,J=ie.sMaskBitsPerComponent,ne=ie.colorBytes,me=ie.alphaBytes,ue=ie.needSMask,ke=ie.palette,ze=ie.mask,pe=null;return i!==wi.API.image_compression.NONE&&typeof g5=="function"?(pe=(function(U){var F;switch(U){case wi.API.image_compression.FAST:F=11;break;case wi.API.image_compression.MEDIUM:F=13;break;case wi.API.image_compression.SLOW:F=14;break;default:F=12}return F})(i),R=this.decode.FLATE_DECODE,V="/Predictor ".concat(pe," /Colors ").concat(fe," /BitsPerComponent ").concat(I," /Columns ").concat(m),n=NS(ne,Math.ceil(m*fe*I/8),fe,I,i),ue&&(k=NS(me,Math.ceil(m*J/8),1,J,i))):(R=void 0,V=void 0,n=ne,ue&&(k=me)),(this.__addimage__.isArrayBuffer(n)||this.__addimage__.isArrayBufferView(n))&&(n=this.__addimage__.arrayBufferToBinaryString(n)),(k&&this.__addimage__.isArrayBuffer(k)||this.__addimage__.isArrayBufferView(k))&&(k=this.__addimage__.arrayBufferToBinaryString(k)),{alias:t,data:n,index:e,filter:R,decodeParameters:V,transparency:ze,palette:ke,sMask:k,predictor:pe,width:m,height:_,bitsPerComponent:I,sMaskBitsPerComponent:J,colorSpace:ae}}},(function(n){n.processGIF89A=function(e,t,i,c){var u=new HM(e),m=u.width,_=u.height,o=[];u.decodeAndBlitFrameRGBA(0,o);var w={data:o,width:m,height:_},I=new Pb(100).encode(w,100);return n.processJPEG.call(this,I,t,i,c)},n.processGIF87A=n.processGIF89A})(wi.API),Hd.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var n=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(n);for(var e=0;e<n;e++){var t=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),c=this.datav.getUint8(this.pos++,!0),u=this.datav.getUint8(this.pos++,!0);this.palette[e]={red:c,green:i,blue:t,quad:u}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},Hd.prototype.parseBGR=function(){this.pos=this.offset;try{var n="bit"+this.bitPP,e=this.width*this.height*4;this.data=new Uint8Array(e),this[n]()}catch(t){Ka.log("bit decode error:"+t)}},Hd.prototype.bit1=function(){var n,e=Math.ceil(this.width/8),t=e%4;for(n=this.height-1;n>=0;n--){for(var i=this.bottom_up?n:this.height-1-n,c=0;c<e;c++)for(var u=this.datav.getUint8(this.pos++,!0),m=i*this.width*4+8*c*4,_=0;_<8&&8*c+_<this.width;_++){var o=this.palette[u>>7-_&1];this.data[m+4*_]=o.blue,this.data[m+4*_+1]=o.green,this.data[m+4*_+2]=o.red,this.data[m+4*_+3]=255}t!==0&&(this.pos+=4-t)}},Hd.prototype.bit4=function(){for(var n=Math.ceil(this.width/2),e=n%4,t=this.height-1;t>=0;t--){for(var i=this.bottom_up?t:this.height-1-t,c=0;c<n;c++){var u=this.datav.getUint8(this.pos++,!0),m=i*this.width*4+2*c*4,_=u>>4,o=15&u,w=this.palette[_];if(this.data[m]=w.blue,this.data[m+1]=w.green,this.data[m+2]=w.red,this.data[m+3]=255,2*c+1>=this.width)break;w=this.palette[o],this.data[m+4]=w.blue,this.data[m+4+1]=w.green,this.data[m+4+2]=w.red,this.data[m+4+3]=255}e!==0&&(this.pos+=4-e)}},Hd.prototype.bit8=function(){for(var n=this.width%4,e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,i=0;i<this.width;i++){var c=this.datav.getUint8(this.pos++,!0),u=t*this.width*4+4*i;if(c<this.palette.length){var m=this.palette[c];this.data[u]=m.red,this.data[u+1]=m.green,this.data[u+2]=m.blue,this.data[u+3]=255}else this.data[u]=255,this.data[u+1]=255,this.data[u+2]=255,this.data[u+3]=255}n!==0&&(this.pos+=4-n)}},Hd.prototype.bit15=function(){for(var n=this.width%3,e=parseInt("11111",2),t=this.height-1;t>=0;t--){for(var i=this.bottom_up?t:this.height-1-t,c=0;c<this.width;c++){var u=this.datav.getUint16(this.pos,!0);this.pos+=2;var m=(u&e)/e*255|0,_=(u>>5&e)/e*255|0,o=(u>>10&e)/e*255|0,w=u>>15?255:0,I=i*this.width*4+4*c;this.data[I]=o,this.data[I+1]=_,this.data[I+2]=m,this.data[I+3]=w}this.pos+=n}},Hd.prototype.bit16=function(){for(var n=this.width%3,e=parseInt("11111",2),t=parseInt("111111",2),i=this.height-1;i>=0;i--){for(var c=this.bottom_up?i:this.height-1-i,u=0;u<this.width;u++){var m=this.datav.getUint16(this.pos,!0);this.pos+=2;var _=(m&e)/e*255|0,o=(m>>5&t)/t*255|0,w=(m>>11)/e*255|0,I=c*this.width*4+4*u;this.data[I]=w,this.data[I+1]=o,this.data[I+2]=_,this.data[I+3]=255}this.pos+=n}},Hd.prototype.bit24=function(){for(var n=this.height-1;n>=0;n--){for(var e=this.bottom_up?n:this.height-1-n,t=0;t<this.width;t++){var i=this.datav.getUint8(this.pos++,!0),c=this.datav.getUint8(this.pos++,!0),u=this.datav.getUint8(this.pos++,!0),m=e*this.width*4+4*t;this.data[m]=u,this.data[m+1]=c,this.data[m+2]=i,this.data[m+3]=255}this.pos+=this.width%4}},Hd.prototype.bit32=function(){for(var n=this.height-1;n>=0;n--)for(var e=this.bottom_up?n:this.height-1-n,t=0;t<this.width;t++){var i=this.datav.getUint8(this.pos++,!0),c=this.datav.getUint8(this.pos++,!0),u=this.datav.getUint8(this.pos++,!0),m=this.datav.getUint8(this.pos++,!0),_=e*this.width*4+4*t;this.data[_]=u,this.data[_+1]=c,this.data[_+2]=i,this.data[_+3]=m}},Hd.prototype.getData=function(){return this.data},(function(n){n.processBMP=function(e,t,i,c){var u=new Hd(e,!1),m=u.width,_=u.height,o={data:u.getData(),width:m,height:_},w=new Pb(100).encode(o,100);return n.processJPEG.call(this,w,t,i,c)}})(wi.API),US.prototype.getData=function(){return this.data},(function(n){n.processWEBP=function(e,t,i,c){var u=new US(e),m=u.width,_=u.height,o={data:u.getData(),width:m,height:_},w=new Pb(100).encode(o,100);return n.processJPEG.call(this,w,t,i,c)}})(wi.API),wi.API.processRGBA=function(n,e,t){for(var i=n.data,c=i.length,u=new Uint8Array(c/4*3),m=new Uint8Array(c/4),_=0,o=0,w=0;w<c;w+=4){var I=i[w],R=i[w+1],V=i[w+2],k=i[w+3];u[_++]=I,u[_++]=R,u[_++]=V,m[o++]=k}var ie=this.__addimage__.arrayBufferToBinaryString(u);return{alpha:this.__addimage__.arrayBufferToBinaryString(m),data:ie,index:e,alias:t,colorSpace:"DeviceRGB",bitsPerComponent:8,width:n.width,height:n.height}},wi.API.setLanguage=function(n){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[n]!==void 0&&(this.internal.languageSettings.languageCode=n,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},Gg=wi.API,_1=Gg.getCharWidthsArray=function(n,e){var t,i,c=(e=e||{}).font||this.internal.getFont(),u=e.fontSize||this.internal.getFontSize(),m=e.charSpace||this.internal.getCharSpace(),_=e.widths?e.widths:c.metadata.Unicode.widths,o=_.fof?_.fof:1,w=e.kerning?e.kerning:c.metadata.Unicode.kerning,I=w.fof?w.fof:1,R=e.doKerning!==!1,V=0,k=n.length,ie=0,ae=_[0]||o,fe=[];for(t=0;t<k;t++)i=n.charCodeAt(t),typeof c.metadata.widthOfString=="function"?fe.push((c.metadata.widthOfGlyph(c.metadata.characterToGlyph(i))+m*(1e3/u)||0)/1e3):(V=R&&wa(w[i])==="object"&&!isNaN(parseInt(w[i][ie],10))?w[i][ie]/I:0,fe.push((_[i]||ae)/o+V)),ie=i;return fe},kS=Gg.getStringUnitWidth=function(n,e){var t=(e=e||{}).fontSize||this.internal.getFontSize(),i=e.font||this.internal.getFont(),c=e.charSpace||this.internal.getCharSpace();return Gg.processArabic&&(n=Gg.processArabic(n)),typeof i.metadata.widthOfString=="function"?i.metadata.widthOfString(n,t,c)/t:_1.apply(this,arguments).reduce(function(u,m){return u+m},0)},MS=function(n,e,t,i){for(var c=[],u=0,m=n.length,_=0;u!==m&&_+e[u]<t;)_+=e[u],u++;c.push(n.slice(0,u));var o=u;for(_=0;u!==m;)_+e[u]>i&&(c.push(n.slice(o,u)),_=0,o=u),_+=e[u],u++;return o!==u&&c.push(n.slice(o,u)),c},RS=function(n,e,t){t||(t={});var i,c,u,m,_,o,w,I=[],R=[I],V=t.textIndent||0,k=0,ie=0,ae=n.split(" "),fe=_1.apply(this,[" ",t])[0];if(o=t.lineIndent===-1?ae[0].length+2:t.lineIndent||0){var J=Array(o).join(" "),ne=[];ae.map(function(ue){(ue=ue.split(/\s*\n/)).length>1?ne=ne.concat(ue.map(function(ke,ze){return(ze&&ke.length?`
`:"")+ke})):ne.push(ue[0])}),ae=ne,o=kS.apply(this,[J,t])}for(u=0,m=ae.length;u<m;u++){var me=0;if(i=ae[u],o&&i[0]==`
`&&(i=i.substr(1),me=1),V+k+(ie=(c=_1.apply(this,[i,t])).reduce(function(ue,ke){return ue+ke},0))>e||me){if(ie>e){for(_=MS.apply(this,[i,c,e-(V+k),e]),I.push(_.shift()),I=[_.pop()];_.length;)R.push([_.shift()]);ie=c.slice(i.length-(I[0]?I[0].length:0)).reduce(function(ue,ke){return ue+ke},0)}else I=[i];R.push(I),V=ie+o,k=fe}else I.push(i),V+=k+ie,k=fe}return w=o?function(ue,ke){return(ke?J:"")+ue.join(" ")}:function(ue){return ue.join(" ")},R.map(w)},Gg.splitTextToSize=function(n,e,t){var i,c=(t=t||{}).fontSize||this.internal.getFontSize(),u=(function(I){if(I.widths&&I.kerning)return{widths:I.widths,kerning:I.kerning};var R=this.internal.getFont(I.fontName,I.fontStyle),V="Unicode";return R.metadata[V]?{widths:R.metadata[V].widths||{0:1},kerning:R.metadata[V].kerning||{}}:{font:R.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,t);i=Array.isArray(n)?n:String(n).split(/\r?\n/);var m=1*this.internal.scaleFactor*e/c;u.textIndent=t.textIndent?1*t.textIndent*this.internal.scaleFactor/c:0,u.lineIndent=t.lineIndent;var _,o,w=[];for(_=0,o=i.length;_<o;_++)w=w.concat(RS.apply(this,[i[_],m,u]));return w},(function(n){n.__fontmetrics__=n.__fontmetrics__||{};for(var e="0123456789abcdef",t="klmnopqrstuvwxyz",i={},c={},u=0;u<16;u++)i[t[u]]=e[u],c[e[u]]=t[u];var m=function(V){return"0x"+parseInt(V,10).toString(16)},_=n.__fontmetrics__.compress=function(V){var k,ie,ae,fe,J=["{"];for(var ne in V){if(k=V[ne],isNaN(parseInt(ne,10))?ie="'"+ne+"'":(ne=parseInt(ne,10),ie=(ie=m(ne).slice(2)).slice(0,-1)+c[ie.slice(-1)]),typeof k=="number")k<0?(ae=m(k).slice(3),fe="-"):(ae=m(k).slice(2),fe=""),ae=fe+ae.slice(0,-1)+c[ae.slice(-1)];else{if(wa(k)!=="object")throw new Error("Don't know what to do with value type "+wa(k)+".");ae=_(k)}J.push(ie+ae)}return J.push("}"),J.join("")},o=n.__fontmetrics__.uncompress=function(V){if(typeof V!="string")throw new Error("Invalid argument passed to uncompress.");for(var k,ie,ae,fe,J={},ne=1,me=J,ue=[],ke="",ze="",pe=V.length-1,U=1;U<pe;U+=1)(fe=V[U])=="'"?k?(ae=k.join(""),k=void 0):k=[]:k?k.push(fe):fe=="{"?(ue.push([me,ae]),me={},ae=void 0):fe=="}"?((ie=ue.pop())[0][ie[1]]=me,ae=void 0,me=ie[0]):fe=="-"?ne=-1:ae===void 0?i.hasOwnProperty(fe)?(ke+=i[fe],ae=parseInt(ke,16)*ne,ne=1,ke=""):ke+=fe:i.hasOwnProperty(fe)?(ze+=i[fe],me[ae]=parseInt(ze,16)*ne,ne=1,ae=void 0,ze=""):ze+=fe;return J},w={codePages:["WinAnsiEncoding"],WinAnsiEncoding:o("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},I={Unicode:{Courier:w,"Courier-Bold":w,"Courier-BoldOblique":w,"Courier-Oblique":w,Helvetica:w,"Helvetica-Bold":w,"Helvetica-BoldOblique":w,"Helvetica-Oblique":w,"Times-Roman":w,"Times-Bold":w,"Times-BoldItalic":w,"Times-Italic":w}},R={Unicode:{"Courier-Oblique":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":o("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":o("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":o("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:o("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:o("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":o("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:o("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":o("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":o("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":o("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};n.events.push(["addFont",function(V){var k=V.font,ie=R.Unicode[k.postScriptName];ie&&(k.metadata.Unicode={},k.metadata.Unicode.widths=ie.widths,k.metadata.Unicode.kerning=ie.kerning);var ae=I.Unicode[k.postScriptName];ae&&(k.metadata.Unicode.encoding=ae,k.encoding=ae.codePages[0])}])})(wi.API),(function(n){var e=function(t){for(var i=t.length,c=new Uint8Array(i),u=0;u<i;u++)c[u]=t.charCodeAt(u);return c};n.API.events.push(["addFont",function(t){var i=void 0,c=t.font,u=t.instance;if(!c.isStandardFont){if(u===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+c.postScriptName+"').");if(typeof(i=u.existsFileInVFS(c.postScriptName)===!1?u.loadFile(c.postScriptName):u.getFileFromVFS(c.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+c.postScriptName+"').");(function(m,_){_=/^\x00\x01\x00\x00/.test(_)?e(_):e(z1(_)),m.metadata=n.API.TTFFont.open(_),m.metadata.Unicode=m.metadata.Unicode||{encoding:{},kerning:{},widths:[]},m.metadata.glyIdsUsed=[0]})(c,i)}}])})(wi),wi.API.addSvgAsImage=function(n,e,t,i,c,u,m,_){if(isNaN(e)||isNaN(t))throw Ka.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(i)||isNaN(c))throw Ka.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var o=document.createElement("canvas");o.width=i,o.height=c;var w=o.getContext("2d");w.fillStyle="#fff",w.fillRect(0,0,o.width,o.height);var I={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},R=this;return(so.canvg?Promise.resolve(so.canvg):cb(()=>import("./index.es-DLMX0k7m.js"),[])).catch(function(V){return Promise.reject(new Error("Could not load canvg: "+V))}).then(function(V){return V.default?V.default:V}).then(function(V){return V.fromString(w,n,I)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(V){return V.render(I)}).then(function(){R.addImage(o.toDataURL("image/jpeg",1),e,t,i,c,m,_)})},wi.API.putTotalPages=function(n){var e,t=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(e=new RegExp(n,"g"),t=this.internal.getNumberOfPages()):(e=new RegExp(this.pdfEscape16(n,this.internal.getFont()),"g"),t=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var i=1;i<=this.internal.getNumberOfPages();i++)for(var c=0;c<this.internal.pages[i].length;c++)this.internal.pages[i][c]=this.internal.pages[i][c].replace(e,t);return this},wi.API.viewerPreferences=function(n,e){var t;n=n||{},e=e||!1;var i,c,u,m={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},_=Object.keys(m),o=[],w=0,I=0,R=0;function V(ie,ae){var fe,J=!1;for(fe=0;fe<ie.length;fe+=1)ie[fe]===ae&&(J=!0);return J}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(m)),this.internal.viewerpreferences.isSubscribed=!1),t=this.internal.viewerpreferences.configuration,n==="reset"||e===!0){var k=_.length;for(R=0;R<k;R+=1)t[_[R]].value=t[_[R]].defaultValue,t[_[R]].explicitSet=!1}if(wa(n)==="object"){for(c in n)if(u=n[c],V(_,c)&&u!==void 0){if(t[c].type==="boolean"&&typeof u=="boolean")t[c].value=u;else if(t[c].type==="name"&&V(t[c].valueSet,u))t[c].value=u;else if(t[c].type==="integer"&&Number.isInteger(u))t[c].value=u;else if(t[c].type==="array"){for(w=0;w<u.length;w+=1)if(i=!0,u[w].length===1&&typeof u[w][0]=="number")o.push(String(u[w]-1));else if(u[w].length>1){for(I=0;I<u[w].length;I+=1)typeof u[w][I]!="number"&&(i=!1);i===!0&&o.push([u[w][0]-1,u[w][1]-1].join(" "))}t[c].value="["+o.join(" ")+"]"}else t[c].value=t[c].defaultValue;t[c].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var ie,ae=[];for(ie in t)t[ie].explicitSet===!0&&(t[ie].type==="name"?ae.push("/"+ie+" /"+t[ie].value):ae.push("/"+ie+" "+t[ie].value));ae.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+ae.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=t,this},(function(n){var e=function(){var i='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',c=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),u=unescape(encodeURIComponent(i)),m=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),_=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),o=unescape(encodeURIComponent("</x:xmpmeta>")),w=u.length+m.length+_.length+c.length+o.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+w+" >>"),this.internal.write("stream"),this.internal.write(c+u+m+_+o),this.internal.write("endstream"),this.internal.write("endobj")},t=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};n.addMetadata=function(i,c){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:i,namespaceuri:c||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",t),this.internal.events.subscribe("postPutResources",e)),this}})(wi.API),(function(n){var e=n.API,t=e.pdfEscape16=function(u,m){for(var _,o=m.metadata.Unicode.widths,w=["","0","00","000","0000"],I=[""],R=0,V=u.length;R<V;++R){if(_=m.metadata.characterToGlyph(u.charCodeAt(R)),m.metadata.glyIdsUsed.push(_),m.metadata.toUnicode[_]=u.charCodeAt(R),o.indexOf(_)==-1&&(o.push(_),o.push([parseInt(m.metadata.widthOfGlyph(_),10)])),_=="0")return I.join("");_=_.toString(16),I.push(w[4-_.length],_)}return I.join("")},i=function(u){var m,_,o,w,I,R,V;for(I=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,o=[],R=0,V=(_=Object.keys(u).sort(function(k,ie){return k-ie})).length;R<V;R++)m=_[R],o.length>=100&&(I+=`
`+o.length+` beginbfchar
`+o.join(`
`)+`
endbfchar`,o=[]),u[m]!==void 0&&u[m]!==null&&typeof u[m].toString=="function"&&(w=("0000"+u[m].toString(16)).slice(-4),m=("0000"+(+m).toString(16)).slice(-4),o.push("<"+m+"><"+w+">"));return o.length&&(I+=`
`+o.length+` beginbfchar
`+o.join(`
`)+`
endbfchar
`),I+`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};e.events.push(["putFont",function(u){(function(m){var _=m.font,o=m.out,w=m.newObject,I=m.putStream;if(_.metadata instanceof n.API.TTFFont&&_.encoding==="Identity-H"){for(var R=_.metadata.Unicode.widths,V=_.metadata.subset.encode(_.metadata.glyIdsUsed,1),k="",ie=0;ie<V.length;ie++)k+=String.fromCharCode(V[ie]);var ae=w();I({data:k,addLength1:!0,objectId:ae}),o("endobj");var fe=w();I({data:i(_.metadata.toUnicode),addLength1:!0,objectId:fe}),o("endobj");var J=w();o("<<"),o("/Type /FontDescriptor"),o("/FontName /"+Qg(_.fontName)),o("/FontFile2 "+ae+" 0 R"),o("/FontBBox "+n.API.PDFObject.convert(_.metadata.bbox)),o("/Flags "+_.metadata.flags),o("/StemV "+_.metadata.stemV),o("/ItalicAngle "+_.metadata.italicAngle),o("/Ascent "+_.metadata.ascender),o("/Descent "+_.metadata.decender),o("/CapHeight "+_.metadata.capHeight),o(">>"),o("endobj");var ne=w();o("<<"),o("/Type /Font"),o("/BaseFont /"+Qg(_.fontName)),o("/FontDescriptor "+J+" 0 R"),o("/W "+n.API.PDFObject.convert(R)),o("/CIDToGIDMap /Identity"),o("/DW 1000"),o("/Subtype /CIDFontType2"),o("/CIDSystemInfo"),o("<<"),o("/Supplement 0"),o("/Registry (Adobe)"),o("/Ordering ("+_.encoding+")"),o(">>"),o(">>"),o("endobj"),_.objectNumber=w(),o("<<"),o("/Type /Font"),o("/Subtype /Type0"),o("/ToUnicode "+fe+" 0 R"),o("/BaseFont /"+Qg(_.fontName)),o("/Encoding /"+_.encoding),o("/DescendantFonts ["+ne+" 0 R]"),o(">>"),o("endobj"),_.isAlreadyPutted=!0}})(u)}]),e.events.push(["putFont",function(u){(function(m){var _=m.font,o=m.out,w=m.newObject,I=m.putStream;if(_.metadata instanceof n.API.TTFFont&&_.encoding==="WinAnsiEncoding"){for(var R=_.metadata.rawData,V="",k=0;k<R.length;k++)V+=String.fromCharCode(R[k]);var ie=w();I({data:V,addLength1:!0,objectId:ie}),o("endobj");var ae=w();I({data:i(_.metadata.toUnicode),addLength1:!0,objectId:ae}),o("endobj");var fe=w();o("<<"),o("/Descent "+_.metadata.decender),o("/CapHeight "+_.metadata.capHeight),o("/StemV "+_.metadata.stemV),o("/Type /FontDescriptor"),o("/FontFile2 "+ie+" 0 R"),o("/Flags 96"),o("/FontBBox "+n.API.PDFObject.convert(_.metadata.bbox)),o("/FontName /"+Qg(_.fontName)),o("/ItalicAngle "+_.metadata.italicAngle),o("/Ascent "+_.metadata.ascender),o(">>"),o("endobj"),_.objectNumber=w();for(var J=0;J<_.metadata.hmtx.widths.length;J++)_.metadata.hmtx.widths[J]=parseInt(_.metadata.hmtx.widths[J]*(1e3/_.metadata.head.unitsPerEm));o("<</Subtype/TrueType/Type/Font/ToUnicode "+ae+" 0 R/BaseFont/"+Qg(_.fontName)+"/FontDescriptor "+fe+" 0 R/Encoding/"+_.encoding+" /FirstChar 29 /LastChar 255 /Widths "+n.API.PDFObject.convert(_.metadata.hmtx.widths)+">>"),o("endobj"),_.isAlreadyPutted=!0}})(u)}]);var c=function(u){var m,_=u.text||"",o=u.x,w=u.y,I=u.options||{},R=u.mutex||{},V=R.pdfEscape,k=R.activeFontKey,ie=R.fonts,ae=k,fe="",J=0,ne="",me=ie[ae].encoding;if(ie[ae].encoding!=="Identity-H")return{text:_,x:o,y:w,options:I,mutex:R};for(ne=_,ae=k,Array.isArray(_)&&(ne=_[0]),J=0;J<ne.length;J+=1)ie[ae].metadata.hasOwnProperty("cmap")&&(m=ie[ae].metadata.cmap.unicode.codeMap[ne[J].charCodeAt(0)]),m||ne[J].charCodeAt(0)<256&&ie[ae].metadata.hasOwnProperty("Unicode")?fe+=ne[J]:fe+="";var ue="";return parseInt(ae.slice(1))<14||me==="WinAnsiEncoding"?ue=V(fe,ae).split("").map(function(ke){return ke.charCodeAt(0).toString(16)}).join(""):me==="Identity-H"&&(ue=t(fe,ie[ae])),R.isHex=!0,{text:ue,x:o,y:w,options:I,mutex:R}};e.events.push(["postProcessText",function(u){var m=u.text||"",_=[],o={text:m,x:u.x,y:u.y,options:u.options,mutex:u.mutex};if(Array.isArray(m)){var w=0;for(w=0;w<m.length;w+=1)Array.isArray(m[w])&&m[w].length===3?_.push([c(Object.assign({},o,{text:m[w][0]})).text,m[w][1],m[w][2]]):_.push(c(Object.assign({},o,{text:m[w]})).text);u.text=_}else u.text=c(Object.assign({},o,{text:m})).text}])})(wi),(function(n){var e=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};n.existsFileInVFS=function(t){return e.call(this),this.internal.vFS[t]!==void 0},n.addFileToVFS=function(t,i){return e.call(this),this.internal.vFS[t]=i,this},n.getFileFromVFS=function(t){return e.call(this),this.internal.vFS[t]!==void 0?this.internal.vFS[t]:null}})(wi.API),(function(n){n.__bidiEngine__=n.prototype.__bidiEngine__=function(i){var c,u,m,_,o,w,I,R=e,V=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],k=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],ie={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},ae={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},fe=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],J=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),ne=!1,me=0;this.__bidiEngine__={};var ue=function(j){var H=j.charCodeAt(),Z=H>>8,be=ae[Z];return be!==void 0?R[256*be+(255&H)]:Z===252||Z===253?"AL":J.test(Z)?"L":Z===8?"R":"N"},ke=function(j){for(var H,Z=0;Z<j.length;Z++){if((H=ue(j.charAt(Z)))==="L")return!1;if(H==="R")return!0}return!1},ze=function(j,H,Z,be){var Me,Be,Re,we,De=H[be];switch(De){case"L":case"R":case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":ne=!1;break;case"N":case"AN":break;case"EN":ne&&(De="AN");break;case"AL":ne=!0,De="R";break;case"WS":case"BN":De="N";break;case"CS":be<1||be+1>=H.length||(Me=Z[be-1])!=="EN"&&Me!=="AN"||(Be=H[be+1])!=="EN"&&Be!=="AN"?De="N":ne&&(Be="AN"),De=Be===Me?Be:"N";break;case"ES":De=(Me=be>0?Z[be-1]:"B")==="EN"&&be+1<H.length&&H[be+1]==="EN"?"EN":"N";break;case"ET":if(be>0&&Z[be-1]==="EN"){De="EN";break}if(ne){De="N";break}for(Re=be+1,we=H.length;Re<we&&H[Re]==="ET";)Re++;De=Re<we&&H[Re]==="EN"?"EN":"N";break;case"NSM":if(m&&!_){for(we=H.length,Re=be+1;Re<we&&H[Re]==="NSM";)Re++;if(Re<we){var nt=j[be],xe=nt>=1425&&nt<=2303||nt===64286;if(Me=H[Re],xe&&(Me==="R"||Me==="AL")){De="R";break}}}De=be<1||(Me=H[be-1])==="B"?"N":Z[be-1];break;case"B":ne=!1,c=!0,De=me;break;case"S":u=!0,De="N"}return De},pe=function(j,H,Z){var be=j.split("");return Z&&U(be,Z,{hiLevel:me}),be.reverse(),H&&H.reverse(),be.join("")},U=function(j,H,Z){var be,Me,Be,Re,we,De=-1,nt=j.length,xe=0,le=[],Ne=me?k:V,Oe=[];for(ne=!1,c=!1,u=!1,Me=0;Me<nt;Me++)Oe[Me]=ue(j[Me]);for(Be=0;Be<nt;Be++){if(we=xe,le[Be]=ze(j,Oe,le,Be),be=240&(xe=Ne[we][ie[le[Be]]]),xe&=15,H[Be]=Re=Ne[xe][5],be>0)if(be===16){for(Me=De;Me<Be;Me++)H[Me]=1;De=-1}else De=-1;if(Ne[xe][6])De===-1&&(De=Be);else if(De>-1){for(Me=De;Me<Be;Me++)H[Me]=Re;De=-1}Oe[Be]==="B"&&(H[Be]=0),Z.hiLevel|=Re}u&&(function(Je,rt,mt){for(var dt=0;dt<mt;dt++)if(Je[dt]==="S"){rt[dt]=me;for(var Dt=dt-1;Dt>=0&&Je[Dt]==="WS";Dt--)rt[Dt]=me}})(Oe,H,nt)},F=function(j,H,Z,be,Me){if(!(Me.hiLevel<j)){if(j===1&&me===1&&!c)return H.reverse(),void(Z&&Z.reverse());for(var Be,Re,we,De,nt=H.length,xe=0;xe<nt;){if(be[xe]>=j){for(we=xe+1;we<nt&&be[we]>=j;)we++;for(De=xe,Re=we-1;De<Re;De++,Re--)Be=H[De],H[De]=H[Re],H[Re]=Be,Z&&(Be=Z[De],Z[De]=Z[Re],Z[Re]=Be);xe=we}xe++}}},q=function(j,H,Z){var be=j.split(""),Me={hiLevel:me};return Z||(Z=[]),U(be,Z,Me),(function(Be,Re,we){if(we.hiLevel!==0&&I)for(var De,nt=0;nt<Be.length;nt++)Re[nt]===1&&(De=fe.indexOf(Be[nt]))>=0&&(Be[nt]=fe[De+1])})(be,Z,Me),F(2,be,H,Z,Me),F(1,be,H,Z,Me),be.join("")};return this.__bidiEngine__.doBidiReorder=function(j,H,Z){if((function(Me,Be){if(Be)for(var Re=0;Re<Me.length;Re++)Be[Re]=Re;_===void 0&&(_=ke(Me)),w===void 0&&(w=ke(Me))})(j,H),m||!o||w)if(m&&o&&_^w)me=_?1:0,j=pe(j,H,Z);else if(!m&&o&&w)me=_?1:0,j=q(j,H,Z),j=pe(j,H);else if(!m||_||o||w){if(m&&!o&&_^w)j=pe(j,H),_?(me=0,j=q(j,H,Z)):(me=1,j=q(j,H,Z),j=pe(j,H));else if(m&&_&&!o&&w)me=1,j=q(j,H,Z),j=pe(j,H);else if(!m&&!o&&_^w){var be=I;_?(me=1,j=q(j,H,Z),me=0,I=!1,j=q(j,H,Z),I=be):(me=0,j=q(j,H,Z),j=pe(j,H),me=1,I=!1,j=q(j,H,Z),I=be,j=pe(j,H))}}else me=0,j=q(j,H,Z);else me=_?1:0,j=q(j,H,Z);return j},this.__bidiEngine__.setOptions=function(j){j&&(m=j.isInputVisual,o=j.isOutputVisual,_=j.isInputRtl,w=j.isOutputRtl,I=j.isSymmetricSwapping)},this.__bidiEngine__.setOptions(i),this.__bidiEngine__};var e=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],t=new n.__bidiEngine__({isInputVisual:!0});n.API.events.push(["postProcessText",function(i){var c=i.text;i.x,i.y;var u=i.options||{};i.mutex,u.lang;var m=[];if(u.isInputVisual=typeof u.isInputVisual!="boolean"||u.isInputVisual,t.setOptions(u),Object.prototype.toString.call(c)==="[object Array]"){var _=0;for(m=[],_=0;_<c.length;_+=1)Object.prototype.toString.call(c[_])==="[object Array]"?m.push([t.doBidiReorder(c[_][0]),c[_][1],c[_][2]]):m.push([t.doBidiReorder(c[_])]);i.text=m}else i.text=t.doBidiReorder(c);t.setOptions({isInputVisual:!0})}])})(wi),wi.API.TTFFont=(function(){function n(e){var t;if(this.rawData=e,t=this.contents=new mm(e),this.contents.pos=4,t.readString(4)==="ttcf")throw new Error("TTCF not supported.");t.pos=0,this.parse(),this.subset=new aR(this),this.registerTTF()}return n.open=function(e){return new n(e)},n.prototype.parse=function(){return this.directory=new WM(this.contents),this.head=new XM(this),this.name=new eR(this),this.cmap=new $6(this),this.toUnicode={},this.hhea=new ZM(this),this.maxp=new tR(this),this.hmtx=new nR(this),this.post=new JM(this),this.os2=new YM(this),this.loca=new sR(this),this.glyf=new rR(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},n.prototype.registerTTF=function(){var e,t,i,c,u;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var m,_,o,w;for(w=[],m=0,_=(o=this.bbox).length;m<_;m++)e=o[m],w.push(Math.round(e*this.scaleFactor));return w}).call(this),this.stemV=0,this.post.exists?(i=255&(c=this.post.italic_angle),32768&(t=c>>16)&&(t=-(1+(65535^t))),this.italicAngle=+(t+"."+i)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(u=this.familyClass)===1||u===2||u===3||u===4||u===5||u===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},n.prototype.characterToGlyph=function(e){var t;return((t=this.cmap.unicode)!=null?t.codeMap[e]:void 0)||0},n.prototype.widthOfGlyph=function(e){var t;return t=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(e).advance*t},n.prototype.widthOfString=function(e,t,i){var c,u,m,_;for(m=0,u=0,_=(e=""+e).length;0<=_?u<_:u>_;u=0<=_?++u:--u)c=e.charCodeAt(u),m+=this.widthOfGlyph(this.characterToGlyph(c))+i*(1e3/t)||0;return m*(t/1e3)},n.prototype.lineHeight=function(e,t){var i;return t==null&&(t=!1),i=t?this.lineGap:0,(this.ascender+i-this.decender)/1e3*e},n})();var af,mm=(function(){function n(e){this.data=e??[],this.pos=0,this.length=this.data.length}return n.prototype.readByte=function(){return this.data[this.pos++]},n.prototype.writeByte=function(e){return this.data[this.pos++]=e},n.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},n.prototype.writeUInt32=function(e){return this.writeByte(e>>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e)},n.prototype.readInt32=function(){var e;return(e=this.readUInt32())>=2147483648?e-4294967296:e},n.prototype.writeInt32=function(e){return e<0&&(e+=4294967296),this.writeUInt32(e)},n.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},n.prototype.writeUInt16=function(e){return this.writeByte(e>>8&255),this.writeByte(255&e)},n.prototype.readInt16=function(){var e;return(e=this.readUInt16())>=32768?e-65536:e},n.prototype.writeInt16=function(e){return e<0&&(e+=65536),this.writeUInt16(e)},n.prototype.readString=function(e){var t,i;for(i=[],t=0;0<=e?t<e:t>e;t=0<=e?++t:--t)i[t]=String.fromCharCode(this.readByte());return i.join("")},n.prototype.writeString=function(e){var t,i,c;for(c=[],t=0,i=e.length;0<=i?t<i:t>i;t=0<=i?++t:--t)c.push(this.writeByte(e.charCodeAt(t)));return c},n.prototype.readShort=function(){return this.readInt16()},n.prototype.writeShort=function(e){return this.writeInt16(e)},n.prototype.readLongLong=function(){var e,t,i,c,u,m,_,o;return e=this.readByte(),t=this.readByte(),i=this.readByte(),c=this.readByte(),u=this.readByte(),m=this.readByte(),_=this.readByte(),o=this.readByte(),128&e?-1*(72057594037927940*(255^e)+281474976710656*(255^t)+1099511627776*(255^i)+4294967296*(255^c)+16777216*(255^u)+65536*(255^m)+256*(255^_)+(255^o)+1):72057594037927940*e+281474976710656*t+1099511627776*i+4294967296*c+16777216*u+65536*m+256*_+o},n.prototype.writeLongLong=function(e){var t,i;return t=Math.floor(e/4294967296),i=4294967295&e,this.writeByte(t>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t),this.writeByte(i>>24&255),this.writeByte(i>>16&255),this.writeByte(i>>8&255),this.writeByte(255&i)},n.prototype.readInt=function(){return this.readInt32()},n.prototype.writeInt=function(e){return this.writeInt32(e)},n.prototype.read=function(e){var t,i;for(t=[],i=0;0<=e?i<e:i>e;i=0<=e?++i:--i)t.push(this.readByte());return t},n.prototype.write=function(e){var t,i,c,u;for(u=[],i=0,c=e.length;i<c;i++)t=e[i],u.push(this.writeByte(t));return u},n})(),WM=(function(){var n;function e(t){var i,c,u;for(this.scalarType=t.readInt(),this.tableCount=t.readShort(),this.searchRange=t.readShort(),this.entrySelector=t.readShort(),this.rangeShift=t.readShort(),this.tables={},c=0,u=this.tableCount;0<=u?c<u:c>u;c=0<=u?++c:--c)i={tag:t.readString(4),checksum:t.readInt(),offset:t.readInt(),length:t.readInt()},this.tables[i.tag]=i}return e.prototype.encode=function(t){var i,c,u,m,_,o,w,I,R,V,k,ie,ae;for(ae in k=Object.keys(t).length,o=Math.log(2),R=16*Math.floor(Math.log(k)/o),m=Math.floor(R/o),I=16*k-R,(c=new mm).writeInt(this.scalarType),c.writeShort(k),c.writeShort(R),c.writeShort(m),c.writeShort(I),u=16*k,w=c.pos+u,_=null,ie=[],t)for(V=t[ae],c.writeString(ae),c.writeInt(n(V)),c.writeInt(w),c.writeInt(V.length),ie=ie.concat(V),ae==="head"&&(_=w),w+=V.length;w%4;)ie.push(0),w++;return c.write(ie),i=2981146554-n(c.data),c.pos=_+8,c.writeUInt32(i),c.data},n=function(t){var i,c,u,m;for(t=G6.call(t);t.length%4;)t.push(0);for(u=new mm(t),c=0,i=0,m=t.length;i<m;i=i+=4)c+=u.readUInt32();return 4294967295&c},e})(),KM={}.hasOwnProperty,Xf=function(n,e){for(var t in e)KM.call(e,t)&&(n[t]=e[t]);function i(){this.constructor=n}return i.prototype=e.prototype,n.prototype=new i,n.__super__=e.prototype,n};af=(function(){function n(e){var t;this.file=e,t=this.file.directory.tables[this.tag],this.exists=!!t,t&&(this.offset=t.offset,this.length=t.length,this.parse(this.file.contents))}return n.prototype.parse=function(){},n.prototype.encode=function(){},n.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},n})();var XM=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Xf(n,af),n.prototype.tag="head",n.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.revision=e.readInt(),this.checkSumAdjustment=e.readInt(),this.magicNumber=e.readInt(),this.flags=e.readShort(),this.unitsPerEm=e.readShort(),this.created=e.readLongLong(),this.modified=e.readLongLong(),this.xMin=e.readShort(),this.yMin=e.readShort(),this.xMax=e.readShort(),this.yMax=e.readShort(),this.macStyle=e.readShort(),this.lowestRecPPEM=e.readShort(),this.fontDirectionHint=e.readShort(),this.indexToLocFormat=e.readShort(),this.glyphDataFormat=e.readShort()},n.prototype.encode=function(e){var t;return(t=new mm).writeInt(this.version),t.writeInt(this.revision),t.writeInt(this.checkSumAdjustment),t.writeInt(this.magicNumber),t.writeShort(this.flags),t.writeShort(this.unitsPerEm),t.writeLongLong(this.created),t.writeLongLong(this.modified),t.writeShort(this.xMin),t.writeShort(this.yMin),t.writeShort(this.xMax),t.writeShort(this.yMax),t.writeShort(this.macStyle),t.writeShort(this.lowestRecPPEM),t.writeShort(this.fontDirectionHint),t.writeShort(e),t.writeShort(this.glyphDataFormat),t.data},n})(),VS=(function(){function n(e,t){var i,c,u,m,_,o,w,I,R,V,k,ie,ae,fe,J,ne,me;switch(this.platformID=e.readUInt16(),this.encodingID=e.readShort(),this.offset=t+e.readInt(),R=e.pos,e.pos=this.offset,this.format=e.readUInt16(),this.length=e.readUInt16(),this.language=e.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(o=0;o<256;++o)this.codeMap[o]=e.readByte();break;case 4:for(k=e.readUInt16(),V=k/2,e.pos+=6,u=(function(){var ue,ke;for(ke=[],o=ue=0;0<=V?ue<V:ue>V;o=0<=V?++ue:--ue)ke.push(e.readUInt16());return ke})(),e.pos+=2,ae=(function(){var ue,ke;for(ke=[],o=ue=0;0<=V?ue<V:ue>V;o=0<=V?++ue:--ue)ke.push(e.readUInt16());return ke})(),w=(function(){var ue,ke;for(ke=[],o=ue=0;0<=V?ue<V:ue>V;o=0<=V?++ue:--ue)ke.push(e.readUInt16());return ke})(),I=(function(){var ue,ke;for(ke=[],o=ue=0;0<=V?ue<V:ue>V;o=0<=V?++ue:--ue)ke.push(e.readUInt16());return ke})(),c=(this.length-e.pos+this.offset)/2,_=(function(){var ue,ke;for(ke=[],o=ue=0;0<=c?ue<c:ue>c;o=0<=c?++ue:--ue)ke.push(e.readUInt16());return ke})(),o=J=0,me=u.length;J<me;o=++J)for(fe=u[o],i=ne=ie=ae[o];ie<=fe?ne<=fe:ne>=fe;i=ie<=fe?++ne:--ne)I[o]===0?m=i+w[o]:(m=_[I[o]/2+(i-ie)-(V-o)]||0)!==0&&(m+=w[o]),this.codeMap[i]=65535&m}e.pos=R}return n.encode=function(e,t){var i,c,u,m,_,o,w,I,R,V,k,ie,ae,fe,J,ne,me,ue,ke,ze,pe,U,F,q,j,H,Z,be,Me,Be,Re,we,De,nt,xe,le,Ne,Oe,Je,rt,mt,dt,Dt,tn,ln,yn;switch(be=new mm,m=Object.keys(e).sort(function(Mn,Gt){return Mn-Gt}),t){case"macroman":for(ae=0,fe=(function(){var Mn=[];for(ie=0;ie<256;++ie)Mn.push(0);return Mn})(),ne={0:0},u={},Me=0,De=m.length;Me<De;Me++)ne[Dt=e[c=m[Me]]]==null&&(ne[Dt]=++ae),u[c]={old:e[c],new:ne[e[c]]},fe[c]=ne[e[c]];return be.writeUInt16(1),be.writeUInt16(0),be.writeUInt32(12),be.writeUInt16(0),be.writeUInt16(262),be.writeUInt16(0),be.write(fe),{charMap:u,subtable:be.data,maxGlyphID:ae+1};case"unicode":for(H=[],R=[],me=0,ne={},i={},J=w=null,Be=0,nt=m.length;Be<nt;Be++)ne[ke=e[c=m[Be]]]==null&&(ne[ke]=++me),i[c]={old:ke,new:ne[ke]},_=ne[ke]-c,J!=null&&_===w||(J&&R.push(J),H.push(c),w=_),J=c;for(J&&R.push(J),R.push(65535),H.push(65535),q=2*(F=H.length),U=2*Math.pow(Math.log(F)/Math.LN2,2),V=Math.log(U/2)/Math.LN2,pe=2*F-U,o=[],ze=[],k=[],ie=Re=0,xe=H.length;Re<xe;ie=++Re){if(j=H[ie],I=R[ie],j===65535){o.push(0),ze.push(0);break}if(j-(Z=i[j].new)>=32768)for(o.push(0),ze.push(2*(k.length+F-ie)),c=we=j;j<=I?we<=I:we>=I;c=j<=I?++we:--we)k.push(i[c].new);else o.push(Z-j),ze.push(0)}for(be.writeUInt16(3),be.writeUInt16(1),be.writeUInt32(12),be.writeUInt16(4),be.writeUInt16(16+8*F+2*k.length),be.writeUInt16(0),be.writeUInt16(q),be.writeUInt16(U),be.writeUInt16(V),be.writeUInt16(pe),mt=0,le=R.length;mt<le;mt++)c=R[mt],be.writeUInt16(c);for(be.writeUInt16(0),dt=0,Ne=H.length;dt<Ne;dt++)c=H[dt],be.writeUInt16(c);for(tn=0,Oe=o.length;tn<Oe;tn++)_=o[tn],be.writeUInt16(_);for(ln=0,Je=ze.length;ln<Je;ln++)ue=ze[ln],be.writeUInt16(ue);for(yn=0,rt=k.length;yn<rt;yn++)ae=k[yn],be.writeUInt16(ae);return{charMap:i,subtable:be.data,maxGlyphID:me+1}}},n})(),$6=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Xf(n,af),n.prototype.tag="cmap",n.prototype.parse=function(e){var t,i,c;for(e.pos=this.offset,this.version=e.readUInt16(),c=e.readUInt16(),this.tables=[],this.unicode=null,i=0;0<=c?i<c:i>c;i=0<=c?++i:--i)t=new VS(e,this.offset),this.tables.push(t),t.isUnicode&&this.unicode==null&&(this.unicode=t);return!0},n.encode=function(e,t){var i,c;return t==null&&(t="macroman"),i=VS.encode(e,t),(c=new mm).writeUInt16(0),c.writeUInt16(1),i.table=c.data.concat(i.subtable),i},n})(),ZM=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Xf(n,af),n.prototype.tag="hhea",n.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.ascender=e.readShort(),this.decender=e.readShort(),this.lineGap=e.readShort(),this.advanceWidthMax=e.readShort(),this.minLeftSideBearing=e.readShort(),this.minRightSideBearing=e.readShort(),this.xMaxExtent=e.readShort(),this.caretSlopeRise=e.readShort(),this.caretSlopeRun=e.readShort(),this.caretOffset=e.readShort(),e.pos+=8,this.metricDataFormat=e.readShort(),this.numberOfMetrics=e.readUInt16()},n})(),YM=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Xf(n,af),n.prototype.tag="OS/2",n.prototype.parse=function(e){if(e.pos=this.offset,this.version=e.readUInt16(),this.averageCharWidth=e.readShort(),this.weightClass=e.readUInt16(),this.widthClass=e.readUInt16(),this.type=e.readShort(),this.ySubscriptXSize=e.readShort(),this.ySubscriptYSize=e.readShort(),this.ySubscriptXOffset=e.readShort(),this.ySubscriptYOffset=e.readShort(),this.ySuperscriptXSize=e.readShort(),this.ySuperscriptYSize=e.readShort(),this.ySuperscriptXOffset=e.readShort(),this.ySuperscriptYOffset=e.readShort(),this.yStrikeoutSize=e.readShort(),this.yStrikeoutPosition=e.readShort(),this.familyClass=e.readShort(),this.panose=(function(){var t,i;for(i=[],t=0;t<10;++t)i.push(e.readByte());return i})(),this.charRange=(function(){var t,i;for(i=[],t=0;t<4;++t)i.push(e.readInt());return i})(),this.vendorID=e.readString(4),this.selection=e.readShort(),this.firstCharIndex=e.readShort(),this.lastCharIndex=e.readShort(),this.version>0&&(this.ascent=e.readShort(),this.descent=e.readShort(),this.lineGap=e.readShort(),this.winAscent=e.readShort(),this.winDescent=e.readShort(),this.codePageRange=(function(){var t,i;for(i=[],t=0;t<2;t=++t)i.push(e.readInt());return i})(),this.version>1))return this.xHeight=e.readShort(),this.capHeight=e.readShort(),this.defaultChar=e.readShort(),this.breakChar=e.readShort(),this.maxContext=e.readShort()},n})(),JM=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Xf(n,af),n.prototype.tag="post",n.prototype.parse=function(e){var t,i,c;switch(e.pos=this.offset,this.format=e.readInt(),this.italicAngle=e.readInt(),this.underlinePosition=e.readShort(),this.underlineThickness=e.readShort(),this.isFixedPitch=e.readInt(),this.minMemType42=e.readInt(),this.maxMemType42=e.readInt(),this.minMemType1=e.readInt(),this.maxMemType1=e.readInt(),this.format){case 65536:case 196608:break;case 131072:var u;for(i=e.readUInt16(),this.glyphNameIndex=[],u=0;0<=i?u<i:u>i;u=0<=i?++u:--u)this.glyphNameIndex.push(e.readUInt16());for(this.names=[],c=[];e.pos<this.offset+this.length;)t=e.readByte(),c.push(this.names.push(e.readString(t)));return c;case 151552:return i=e.readUInt16(),this.offsets=e.read(i);case 262144:return this.map=(function(){var m,_,o;for(o=[],u=m=0,_=this.file.maxp.numGlyphs;0<=_?m<_:m>_;u=0<=_?++m:--m)o.push(e.readUInt32());return o}).call(this)}},n})(),QM=function(n,e){this.raw=n,this.length=n.length,this.platformID=e.platformID,this.encodingID=e.encodingID,this.languageID=e.languageID},eR=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Xf(n,af),n.prototype.tag="name",n.prototype.parse=function(e){var t,i,c,u,m,_,o,w,I,R,V;for(e.pos=this.offset,e.readShort(),t=e.readShort(),_=e.readShort(),i=[],u=0;0<=t?u<t:u>t;u=0<=t?++u:--u)i.push({platformID:e.readShort(),encodingID:e.readShort(),languageID:e.readShort(),nameID:e.readShort(),length:e.readShort(),offset:this.offset+_+e.readShort()});for(o={},u=I=0,R=i.length;I<R;u=++I)c=i[u],e.pos=c.offset,w=e.readString(c.length),m=new QM(w,c),o[V=c.nameID]==null&&(o[V]=[]),o[c.nameID].push(m);this.strings=o,this.copyright=o[0],this.fontFamily=o[1],this.fontSubfamily=o[2],this.uniqueSubfamily=o[3],this.fontName=o[4],this.version=o[5];try{this.postscriptName=o[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=o[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=o[7],this.manufacturer=o[8],this.designer=o[9],this.description=o[10],this.vendorUrl=o[11],this.designerUrl=o[12],this.license=o[13],this.licenseUrl=o[14],this.preferredFamily=o[15],this.preferredSubfamily=o[17],this.compatibleFull=o[18],this.sampleText=o[19]},n})(),tR=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Xf(n,af),n.prototype.tag="maxp",n.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.numGlyphs=e.readUInt16(),this.maxPoints=e.readUInt16(),this.maxContours=e.readUInt16(),this.maxCompositePoints=e.readUInt16(),this.maxComponentContours=e.readUInt16(),this.maxZones=e.readUInt16(),this.maxTwilightPoints=e.readUInt16(),this.maxStorage=e.readUInt16(),this.maxFunctionDefs=e.readUInt16(),this.maxInstructionDefs=e.readUInt16(),this.maxStackElements=e.readUInt16(),this.maxSizeOfInstructions=e.readUInt16(),this.maxComponentElements=e.readUInt16(),this.maxComponentDepth=e.readUInt16()},n})(),nR=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Xf(n,af),n.prototype.tag="hmtx",n.prototype.parse=function(e){var t,i,c,u,m,_,o;for(e.pos=this.offset,this.metrics=[],t=0,_=this.file.hhea.numberOfMetrics;0<=_?t<_:t>_;t=0<=_?++t:--t)this.metrics.push({advance:e.readUInt16(),lsb:e.readInt16()});for(c=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=(function(){var w,I;for(I=[],t=w=0;0<=c?w<c:w>c;t=0<=c?++w:--w)I.push(e.readInt16());return I})(),this.widths=(function(){var w,I,R,V;for(V=[],w=0,I=(R=this.metrics).length;w<I;w++)u=R[w],V.push(u.advance);return V}).call(this),i=this.widths[this.widths.length-1],o=[],t=m=0;0<=c?m<c:m>c;t=0<=c?++m:--m)o.push(this.widths.push(i));return o},n.prototype.forGlyph=function(e){return e in this.metrics?this.metrics[e]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[e-this.metrics.length]}},n})(),G6=[].slice,rR=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Xf(n,af),n.prototype.tag="glyf",n.prototype.parse=function(){return this.cache={}},n.prototype.glyphFor=function(e){var t,i,c,u,m,_,o,w,I,R;return e in this.cache?this.cache[e]:(u=this.file.loca,t=this.file.contents,i=u.indexOf(e),(c=u.lengthOf(e))===0?this.cache[e]=null:(t.pos=this.offset+i,m=(_=new mm(t.read(c))).readShort(),w=_.readShort(),R=_.readShort(),o=_.readShort(),I=_.readShort(),this.cache[e]=m===-1?new oR(_,w,R,o,I):new iR(_,m,w,R,o,I),this.cache[e]))},n.prototype.encode=function(e,t,i){var c,u,m,_,o;for(m=[],u=[],_=0,o=t.length;_<o;_++)c=e[t[_]],u.push(m.length),c&&(m=m.concat(c.encode(i)));return u.push(m.length),{table:m,offsets:u}},n})(),iR=(function(){function n(e,t,i,c,u,m){this.raw=e,this.numberOfContours=t,this.xMin=i,this.yMin=c,this.xMax=u,this.yMax=m,this.compound=!1}return n.prototype.encode=function(){return this.raw.data},n})(),oR=(function(){function n(e,t,i,c,u){var m,_;for(this.raw=e,this.xMin=t,this.yMin=i,this.xMax=c,this.yMax=u,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],m=this.raw;_=m.readShort(),this.glyphOffsets.push(m.pos),this.glyphIDs.push(m.readUInt16()),32&_;)m.pos+=1&_?4:2,128&_?m.pos+=8:64&_?m.pos+=4:8&_&&(m.pos+=2)}return n.prototype.encode=function(){var e,t,i;for(t=new mm(G6.call(this.raw.data)),e=0,i=this.glyphIDs.length;e<i;++e)t.pos=this.glyphOffsets[e];return t.data},n})(),sR=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Xf(n,af),n.prototype.tag="loca",n.prototype.parse=function(e){var t,i;return e.pos=this.offset,t=this.file.head.indexToLocFormat,this.offsets=t===0?(function(){var c,u;for(u=[],i=0,c=this.length;i<c;i+=2)u.push(2*e.readUInt16());return u}).call(this):(function(){var c,u;for(u=[],i=0,c=this.length;i<c;i+=4)u.push(e.readUInt32());return u}).call(this)},n.prototype.indexOf=function(e){return this.offsets[e]},n.prototype.lengthOf=function(e){return this.offsets[e+1]-this.offsets[e]},n.prototype.encode=function(e,t){for(var i=new Uint32Array(this.offsets.length),c=0,u=0,m=0;m<i.length;++m)if(i[m]=c,u<t.length&&t[u]==m){++u,i[m]=c;var _=this.offsets[m],o=this.offsets[m+1]-_;o>0&&(c+=o)}for(var w=new Array(4*i.length),I=0;I<i.length;++I)w[4*I+3]=255&i[I],w[4*I+2]=(65280&i[I])>>8,w[4*I+1]=(16711680&i[I])>>16,w[4*I]=(4278190080&i[I])>>24;return w},n})(),aR=(function(){function n(e){this.font=e,this.subset={},this.unicodes={},this.next=33}return n.prototype.generateCmap=function(){var e,t,i,c,u;for(t in c=this.font.cmap.tables[0].codeMap,e={},u=this.subset)i=u[t],e[t]=c[i];return e},n.prototype.glyphsFor=function(e){var t,i,c,u,m,_,o;for(c={},m=0,_=e.length;m<_;m++)c[u=e[m]]=this.font.glyf.glyphFor(u);for(u in t=[],c)(i=c[u])!=null&&i.compound&&t.push.apply(t,i.glyphIDs);if(t.length>0)for(u in o=this.glyphsFor(t))i=o[u],c[u]=i;return c},n.prototype.encode=function(e,t){var i,c,u,m,_,o,w,I,R,V,k,ie,ae,fe,J;for(c in i=$6.encode(this.generateCmap(),"unicode"),m=this.glyphsFor(e),k={0:0},J=i.charMap)k[(o=J[c]).old]=o.new;for(ie in V=i.maxGlyphID,m)ie in k||(k[ie]=V++);return I=(function(ne){var me,ue;for(me in ue={},ne)ue[ne[me]]=me;return ue})(k),R=Object.keys(I).sort(function(ne,me){return ne-me}),ae=(function(){var ne,me,ue;for(ue=[],ne=0,me=R.length;ne<me;ne++)_=R[ne],ue.push(I[_]);return ue})(),u=this.font.glyf.encode(m,ae,k),w=this.font.loca.encode(u.offsets,ae),fe={cmap:this.font.cmap.raw(),glyf:u.table,loca:w,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(t)},this.font.os2.exists&&(fe["OS/2"]=this.font.os2.raw()),this.font.directory.encode(fe)},n})();wi.API.PDFObject=(function(){var n;function e(){}return n=function(t,i){return(Array(i+1).join("0")+t).slice(-i)},e.convert=function(t){var i,c,u,m;if(Array.isArray(t))return"["+(function(){var _,o,w;for(w=[],_=0,o=t.length;_<o;_++)i=t[_],w.push(e.convert(i));return w})().join(" ")+"]";if(typeof t=="string")return"/"+t;if(t?.isString)return"("+t+")";if(t instanceof Date)return"(D:"+n(t.getUTCFullYear(),4)+n(t.getUTCMonth(),2)+n(t.getUTCDate(),2)+n(t.getUTCHours(),2)+n(t.getUTCMinutes(),2)+n(t.getUTCSeconds(),2)+"Z)";if({}.toString.call(t)==="[object Object]"){for(c in u=["<<"],t)m=t[c],u.push("/"+c+" "+e.convert(m));return u.push(">>"),u.join(`
`)}return""+t},e})();var qS={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H6=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let c=n.charCodeAt(i);c<128?e[t++]=c:c<2048?(e[t++]=c>>6|192,e[t++]=c&63|128):(c&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(c=65536+((c&1023)<<10)+(n.charCodeAt(++i)&1023),e[t++]=c>>18|240,e[t++]=c>>12&63|128,e[t++]=c>>6&63|128,e[t++]=c&63|128):(e[t++]=c>>12|224,e[t++]=c>>6&63|128,e[t++]=c&63|128)}return e},lR=function(n){const e=[];let t=0,i=0;for(;t<n.length;){const c=n[t++];if(c<128)e[i++]=String.fromCharCode(c);else if(c>191&&c<224){const u=n[t++];e[i++]=String.fromCharCode((c&31)<<6|u&63)}else if(c>239&&c<365){const u=n[t++],m=n[t++],_=n[t++],o=((c&7)<<18|(u&63)<<12|(m&63)<<6|_&63)-65536;e[i++]=String.fromCharCode(55296+(o>>10)),e[i++]=String.fromCharCode(56320+(o&1023))}else{const u=n[t++],m=n[t++];e[i++]=String.fromCharCode((c&15)<<12|(u&63)<<6|m&63)}}return e.join("")},W6={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let c=0;c<n.length;c+=3){const u=n[c],m=c+1<n.length,_=m?n[c+1]:0,o=c+2<n.length,w=o?n[c+2]:0,I=u>>2,R=(u&3)<<4|_>>4;let V=(_&15)<<2|w>>6,k=w&63;o||(k=64,m||(V=64)),i.push(t[I],t[R],t[V],t[k])}return i.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(H6(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):lR(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let c=0;c<n.length;){const u=t[n.charAt(c++)],_=c<n.length?t[n.charAt(c)]:0;++c;const w=c<n.length?t[n.charAt(c)]:64;++c;const R=c<n.length?t[n.charAt(c)]:64;if(++c,u==null||_==null||w==null||R==null)throw new cR;const V=u<<2|_>>4;if(i.push(V),w!==64){const k=_<<4&240|w>>2;if(i.push(k),R!==64){const ie=w<<6&192|R;i.push(ie)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class cR extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const uR=function(n){const e=H6(n);return W6.encodeByteArray(e,!0)},mv=function(n){return uR(n).replace(/\./g,"")},K6=function(n){try{return W6.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hR(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dR=()=>hR().__FIREBASE_DEFAULTS__,fR=()=>{if(typeof process>"u"||typeof qS>"u")return;const n=qS.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},pR=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&K6(n[1]);return e&&JSON.parse(e)},Jv=()=>{try{return dR()||fR()||pR()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},X6=n=>{var e,t;return(t=(e=Jv())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},mR=n=>{const e=X6(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),i]:[e.substring(0,t),i]},Z6=()=>{var n;return(n=Jv())===null||n===void 0?void 0:n.config},Y6=n=>{var e;return(e=Jv())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gR{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,i))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yR(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},i=e||"demo-project",c=n.iat||0,u=n.sub||n.user_id;if(!u)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const m=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:c,exp:c+3600,auth_time:c,sub:u,user_id:u,firebase:{sign_in_provider:"custom",identities:{}}},n);return[mv(JSON.stringify(t)),mv(JSON.stringify(m)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vh(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function _R(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(vh())}function vR(){var n;const e=(n=Jv())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function xR(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function bR(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function wR(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function SR(){const n=vh();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function ER(){return!vR()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function AR(){try{return typeof indexedDB=="object"}catch{return!1}}function TR(){return new Promise((n,e)=>{try{let t=!0;const i="validate-browser-context-for-indexeddb-analytics-module",c=self.indexedDB.open(i);c.onsuccess=()=>{c.result.close(),t||self.indexedDB.deleteDatabase(i),n(!0)},c.onupgradeneeded=()=>{t=!1},c.onerror=()=>{var u;e(((u=c.error)===null||u===void 0?void 0:u.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IR="FirebaseError";class Pp extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name=IR,Object.setPrototypeOf(this,Pp.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,b_.prototype.create)}}class b_{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){const i=t[0]||{},c=`${this.service}/${e}`,u=this.errors[e],m=u?CR(u,i):"Error",_=`${this.serviceName}: ${m} (${c}).`;return new Pp(c,_,i)}}function CR(n,e){return n.replace(LR,(t,i)=>{const c=e[i];return c!=null?String(c):`<${i}?>`})}const LR=/\{\$([^}]+)}/g;function PR(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function gv(n,e){if(n===e)return!0;const t=Object.keys(n),i=Object.keys(e);for(const c of t){if(!i.includes(c))return!1;const u=n[c],m=e[c];if($S(u)&&$S(m)){if(!gv(u,m))return!1}else if(u!==m)return!1}for(const c of i)if(!t.includes(c))return!1;return!0}function $S(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w_(n){const e=[];for(const[t,i]of Object.entries(n))Array.isArray(i)?i.forEach(c=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(c))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}function kR(n,e){const t=new MR(n,e);return t.subscribe.bind(t)}class MR{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(i=>{this.error(i)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,i){let c;if(e===void 0&&t===void 0&&i===void 0)throw new Error("Missing Observer.");RR(e,["next","error","complete"])?c=e:c={next:e,error:t,complete:i},c.next===void 0&&(c.next=kb),c.error===void 0&&(c.error=kb),c.complete===void 0&&(c.complete=kb);const u=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?c.error(this.finalError):c.complete()}catch{}}),this.observers.push(c),u}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function RR(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function kb(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nh(n){return n&&n._delegate?n._delegate:n}class rg{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gm="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NR{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const i=new gR;if(this.instancesDeferred.set(t,i),this.isInitialized(t)||this.shouldAutoInitialize())try{const c=this.getOrInitializeService({instanceIdentifier:t});c&&i.resolve(c)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const i=this.normalizeInstanceIdentifier(e?.identifier),c=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(u){if(c)return null;throw u}else{if(c)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(FR(e))try{this.getOrInitializeService({instanceIdentifier:Gm})}catch{}for(const[t,i]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(t);try{const u=this.getOrInitializeService({instanceIdentifier:c});i.resolve(u)}catch{}}}}clearInstance(e=Gm){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Gm){return this.instances.has(e)}getOptions(e=Gm){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const c=this.getOrInitializeService({instanceIdentifier:i,options:t});for(const[u,m]of this.instancesDeferred.entries()){const _=this.normalizeInstanceIdentifier(u);i===_&&m.resolve(c)}return c}onInit(e,t){var i;const c=this.normalizeInstanceIdentifier(t),u=(i=this.onInitCallbacks.get(c))!==null&&i!==void 0?i:new Set;u.add(e),this.onInitCallbacks.set(c,u);const m=this.instances.get(c);return m&&e(m,c),()=>{u.delete(e)}}invokeOnInitCallbacks(e,t){const i=this.onInitCallbacks.get(t);if(i)for(const c of i)try{c(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:DR(e),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=Gm){return this.component?this.component.multipleInstances?e:Gm:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function DR(n){return n===Gm?void 0:n}function FR(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OR{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new NR(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ys;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(ys||(ys={}));const BR={debug:ys.DEBUG,verbose:ys.VERBOSE,info:ys.INFO,warn:ys.WARN,error:ys.ERROR,silent:ys.SILENT},zR=ys.INFO,jR={[ys.DEBUG]:"log",[ys.VERBOSE]:"log",[ys.INFO]:"info",[ys.WARN]:"warn",[ys.ERROR]:"error"},UR=(n,e,...t)=>{if(e<n.logLevel)return;const i=new Date().toISOString(),c=jR[e];if(c)console[c](`[${i}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class bw{constructor(e){this.name=e,this._logLevel=zR,this._logHandler=UR,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ys))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?BR[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ys.DEBUG,...e),this._logHandler(this,ys.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ys.VERBOSE,...e),this._logHandler(this,ys.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ys.INFO,...e),this._logHandler(this,ys.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ys.WARN,...e),this._logHandler(this,ys.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ys.ERROR,...e),this._logHandler(this,ys.ERROR,...e)}}const VR=(n,e)=>e.some(t=>n instanceof t);let GS,HS;function qR(){return GS||(GS=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function $R(){return HS||(HS=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const J6=new WeakMap,E5=new WeakMap,Q6=new WeakMap,Mb=new WeakMap,ww=new WeakMap;function GR(n){const e=new Promise((t,i)=>{const c=()=>{n.removeEventListener("success",u),n.removeEventListener("error",m)},u=()=>{t(lm(n.result)),c()},m=()=>{i(n.error),c()};n.addEventListener("success",u),n.addEventListener("error",m)});return e.then(t=>{t instanceof IDBCursor&&J6.set(t,n)}).catch(()=>{}),ww.set(e,n),e}function HR(n){if(E5.has(n))return;const e=new Promise((t,i)=>{const c=()=>{n.removeEventListener("complete",u),n.removeEventListener("error",m),n.removeEventListener("abort",m)},u=()=>{t(),c()},m=()=>{i(n.error||new DOMException("AbortError","AbortError")),c()};n.addEventListener("complete",u),n.addEventListener("error",m),n.addEventListener("abort",m)});E5.set(n,e)}let A5={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return E5.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Q6.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return lm(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function WR(n){A5=n(A5)}function KR(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const i=n.call(Rb(this),e,...t);return Q6.set(i,e.sort?e.sort():[e]),lm(i)}:$R().includes(n)?function(...e){return n.apply(Rb(this),e),lm(J6.get(this))}:function(...e){return lm(n.apply(Rb(this),e))}}function XR(n){return typeof n=="function"?KR(n):(n instanceof IDBTransaction&&HR(n),VR(n,qR())?new Proxy(n,A5):n)}function lm(n){if(n instanceof IDBRequest)return GR(n);if(Mb.has(n))return Mb.get(n);const e=XR(n);return e!==n&&(Mb.set(n,e),ww.set(e,n)),e}const Rb=n=>ww.get(n);function ZR(n,e,{blocked:t,upgrade:i,blocking:c,terminated:u}={}){const m=indexedDB.open(n,e),_=lm(m);return i&&m.addEventListener("upgradeneeded",o=>{i(lm(m.result),o.oldVersion,o.newVersion,lm(m.transaction),o)}),t&&m.addEventListener("blocked",o=>t(o.oldVersion,o.newVersion,o)),_.then(o=>{u&&o.addEventListener("close",()=>u()),c&&o.addEventListener("versionchange",w=>c(w.oldVersion,w.newVersion,w))}).catch(()=>{}),_}const YR=["get","getKey","getAll","getAllKeys","count"],JR=["put","add","delete","clear"],Nb=new Map;function WS(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Nb.get(e))return Nb.get(e);const t=e.replace(/FromIndex$/,""),i=e!==t,c=JR.includes(t);if(!(t in(i?IDBIndex:IDBObjectStore).prototype)||!(c||YR.includes(t)))return;const u=async function(m,..._){const o=this.transaction(m,c?"readwrite":"readonly");let w=o.store;return i&&(w=w.index(_.shift())),(await Promise.all([w[t](..._),c&&o.done]))[0]};return Nb.set(e,u),u}WR(n=>({...n,get:(e,t,i)=>WS(e,t)||n.get(e,t,i),has:(e,t)=>!!WS(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QR{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(eN(t)){const i=t.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(t=>t).join(" ")}}function eN(n){const e=n.getComponent();return e?.type==="VERSION"}const T5="@firebase/app",KS="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ap=new bw("@firebase/app"),tN="@firebase/app-compat",nN="@firebase/analytics-compat",rN="@firebase/analytics",iN="@firebase/app-check-compat",oN="@firebase/app-check",sN="@firebase/auth",aN="@firebase/auth-compat",lN="@firebase/database",cN="@firebase/data-connect",uN="@firebase/database-compat",hN="@firebase/functions",dN="@firebase/functions-compat",fN="@firebase/installations",pN="@firebase/installations-compat",mN="@firebase/messaging",gN="@firebase/messaging-compat",yN="@firebase/performance",_N="@firebase/performance-compat",vN="@firebase/remote-config",xN="@firebase/remote-config-compat",bN="@firebase/storage",wN="@firebase/storage-compat",SN="@firebase/firestore",EN="@firebase/vertexai-preview",AN="@firebase/firestore-compat",TN="firebase",IN="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I5="[DEFAULT]",CN={[T5]:"fire-core",[tN]:"fire-core-compat",[rN]:"fire-analytics",[nN]:"fire-analytics-compat",[oN]:"fire-app-check",[iN]:"fire-app-check-compat",[sN]:"fire-auth",[aN]:"fire-auth-compat",[lN]:"fire-rtdb",[cN]:"fire-data-connect",[uN]:"fire-rtdb-compat",[hN]:"fire-fn",[dN]:"fire-fn-compat",[fN]:"fire-iid",[pN]:"fire-iid-compat",[mN]:"fire-fcm",[gN]:"fire-fcm-compat",[yN]:"fire-perf",[_N]:"fire-perf-compat",[vN]:"fire-rc",[xN]:"fire-rc-compat",[bN]:"fire-gcs",[wN]:"fire-gcs-compat",[SN]:"fire-fst",[AN]:"fire-fst-compat",[EN]:"fire-vertex","fire-js":"fire-js",[TN]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yv=new Map,LN=new Map,C5=new Map;function XS(n,e){try{n.container.addComponent(e)}catch(t){Ap.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function x0(n){const e=n.name;if(C5.has(e))return Ap.debug(`There were multiple attempts to register component ${e}.`),!1;C5.set(e,n);for(const t of yv.values())XS(t,n);for(const t of LN.values())XS(t,n);return!0}function Sw(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Df(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PN={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},cm=new b_("app","Firebase",PN);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kN{constructor(e,t,i){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new rg("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw cm.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D0=IN;function e9(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const i=Object.assign({name:I5,automaticDataCollectionEnabled:!1},e),c=i.name;if(typeof c!="string"||!c)throw cm.create("bad-app-name",{appName:String(c)});if(t||(t=Z6()),!t)throw cm.create("no-options");const u=yv.get(c);if(u){if(gv(t,u.options)&&gv(i,u.config))return u;throw cm.create("duplicate-app",{appName:c})}const m=new OR(c);for(const o of C5.values())m.addComponent(o);const _=new kN(t,i,m);return yv.set(c,_),_}function t9(n=I5){const e=yv.get(n);if(!e&&n===I5&&Z6())return e9();if(!e)throw cm.create("no-app",{appName:n});return e}function um(n,e,t){var i;let c=(i=CN[n])!==null&&i!==void 0?i:n;t&&(c+=`-${t}`);const u=c.match(/\s|\//),m=e.match(/\s|\//);if(u||m){const _=[`Unable to register library "${c}" with version "${e}":`];u&&_.push(`library name "${c}" contains illegal characters (whitespace or "/")`),u&&m&&_.push("and"),m&&_.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ap.warn(_.join(" "));return}x0(new rg(`${c}-version`,()=>({library:c,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MN="firebase-heartbeat-database",RN=1,o_="firebase-heartbeat-store";let Db=null;function n9(){return Db||(Db=ZR(MN,RN,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(o_)}catch(t){console.warn(t)}}}}).catch(n=>{throw cm.create("idb-open",{originalErrorMessage:n.message})})),Db}async function NN(n){try{const t=(await n9()).transaction(o_),i=await t.objectStore(o_).get(r9(n));return await t.done,i}catch(e){if(e instanceof Pp)Ap.warn(e.message);else{const t=cm.create("idb-get",{originalErrorMessage:e?.message});Ap.warn(t.message)}}}async function ZS(n,e){try{const i=(await n9()).transaction(o_,"readwrite");await i.objectStore(o_).put(e,r9(n)),await i.done}catch(t){if(t instanceof Pp)Ap.warn(t.message);else{const i=cm.create("idb-set",{originalErrorMessage:t?.message});Ap.warn(i.message)}}}function r9(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DN=1024,FN=720*60*60*1e3;class ON{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new zN(t),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){var e,t;try{const c=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),u=YS();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===u||this._heartbeatsCache.heartbeats.some(m=>m.date===u)?void 0:(this._heartbeatsCache.heartbeats.push({date:u,agent:c}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(m=>{const _=new Date(m.date).valueOf();return Date.now()-_<=FN}),this._storage.overwrite(this._heartbeatsCache))}catch(i){Ap.warn(i)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=YS(),{heartbeatsToSend:i,unsentEntries:c}=BN(this._heartbeatsCache.heartbeats),u=mv(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=t,c.length>0?(this._heartbeatsCache.heartbeats=c,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),u}catch(t){return Ap.warn(t),""}}}function YS(){return new Date().toISOString().substring(0,10)}function BN(n,e=DN){const t=[];let i=n.slice();for(const c of n){const u=t.find(m=>m.agent===c.agent);if(u){if(u.dates.push(c.date),JS(t)>e){u.dates.pop();break}}else if(t.push({agent:c.agent,dates:[c.date]}),JS(t)>e){t.pop();break}i=i.slice(1)}return{heartbeatsToSend:t,unsentEntries:i}}class zN{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return AR()?TR().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await NN(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const c=await this.read();return ZS(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:c.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const c=await this.read();return ZS(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:c.lastSentHeartbeatDate,heartbeats:[...c.heartbeats,...e.heartbeats]})}else return}}function JS(n){return mv(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jN(n){x0(new rg("platform-logger",e=>new QR(e),"PRIVATE")),x0(new rg("heartbeat",e=>new ON(e),"PRIVATE")),um(T5,KS,n),um(T5,KS,"esm2017"),um("fire-js","")}jN("");var UN="firebase",VN="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */um(UN,VN,"app");var QS=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var eg,i9;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(pe,U){function F(){}F.prototype=U.prototype,pe.D=U.prototype,pe.prototype=new F,pe.prototype.constructor=pe,pe.C=function(q,j,H){for(var Z=Array(arguments.length-2),be=2;be<arguments.length;be++)Z[be-2]=arguments[be];return U.prototype[j].apply(q,Z)}}function t(){this.blockSize=-1}function i(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(i,t),i.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function c(pe,U,F){F||(F=0);var q=Array(16);if(typeof U=="string")for(var j=0;16>j;++j)q[j]=U.charCodeAt(F++)|U.charCodeAt(F++)<<8|U.charCodeAt(F++)<<16|U.charCodeAt(F++)<<24;else for(j=0;16>j;++j)q[j]=U[F++]|U[F++]<<8|U[F++]<<16|U[F++]<<24;U=pe.g[0],F=pe.g[1],j=pe.g[2];var H=pe.g[3],Z=U+(H^F&(j^H))+q[0]+3614090360&4294967295;U=F+(Z<<7&4294967295|Z>>>25),Z=H+(j^U&(F^j))+q[1]+3905402710&4294967295,H=U+(Z<<12&4294967295|Z>>>20),Z=j+(F^H&(U^F))+q[2]+606105819&4294967295,j=H+(Z<<17&4294967295|Z>>>15),Z=F+(U^j&(H^U))+q[3]+3250441966&4294967295,F=j+(Z<<22&4294967295|Z>>>10),Z=U+(H^F&(j^H))+q[4]+4118548399&4294967295,U=F+(Z<<7&4294967295|Z>>>25),Z=H+(j^U&(F^j))+q[5]+1200080426&4294967295,H=U+(Z<<12&4294967295|Z>>>20),Z=j+(F^H&(U^F))+q[6]+2821735955&4294967295,j=H+(Z<<17&4294967295|Z>>>15),Z=F+(U^j&(H^U))+q[7]+4249261313&4294967295,F=j+(Z<<22&4294967295|Z>>>10),Z=U+(H^F&(j^H))+q[8]+1770035416&4294967295,U=F+(Z<<7&4294967295|Z>>>25),Z=H+(j^U&(F^j))+q[9]+2336552879&4294967295,H=U+(Z<<12&4294967295|Z>>>20),Z=j+(F^H&(U^F))+q[10]+4294925233&4294967295,j=H+(Z<<17&4294967295|Z>>>15),Z=F+(U^j&(H^U))+q[11]+2304563134&4294967295,F=j+(Z<<22&4294967295|Z>>>10),Z=U+(H^F&(j^H))+q[12]+1804603682&4294967295,U=F+(Z<<7&4294967295|Z>>>25),Z=H+(j^U&(F^j))+q[13]+4254626195&4294967295,H=U+(Z<<12&4294967295|Z>>>20),Z=j+(F^H&(U^F))+q[14]+2792965006&4294967295,j=H+(Z<<17&4294967295|Z>>>15),Z=F+(U^j&(H^U))+q[15]+1236535329&4294967295,F=j+(Z<<22&4294967295|Z>>>10),Z=U+(j^H&(F^j))+q[1]+4129170786&4294967295,U=F+(Z<<5&4294967295|Z>>>27),Z=H+(F^j&(U^F))+q[6]+3225465664&4294967295,H=U+(Z<<9&4294967295|Z>>>23),Z=j+(U^F&(H^U))+q[11]+643717713&4294967295,j=H+(Z<<14&4294967295|Z>>>18),Z=F+(H^U&(j^H))+q[0]+3921069994&4294967295,F=j+(Z<<20&4294967295|Z>>>12),Z=U+(j^H&(F^j))+q[5]+3593408605&4294967295,U=F+(Z<<5&4294967295|Z>>>27),Z=H+(F^j&(U^F))+q[10]+38016083&4294967295,H=U+(Z<<9&4294967295|Z>>>23),Z=j+(U^F&(H^U))+q[15]+3634488961&4294967295,j=H+(Z<<14&4294967295|Z>>>18),Z=F+(H^U&(j^H))+q[4]+3889429448&4294967295,F=j+(Z<<20&4294967295|Z>>>12),Z=U+(j^H&(F^j))+q[9]+568446438&4294967295,U=F+(Z<<5&4294967295|Z>>>27),Z=H+(F^j&(U^F))+q[14]+3275163606&4294967295,H=U+(Z<<9&4294967295|Z>>>23),Z=j+(U^F&(H^U))+q[3]+4107603335&4294967295,j=H+(Z<<14&4294967295|Z>>>18),Z=F+(H^U&(j^H))+q[8]+1163531501&4294967295,F=j+(Z<<20&4294967295|Z>>>12),Z=U+(j^H&(F^j))+q[13]+2850285829&4294967295,U=F+(Z<<5&4294967295|Z>>>27),Z=H+(F^j&(U^F))+q[2]+4243563512&4294967295,H=U+(Z<<9&4294967295|Z>>>23),Z=j+(U^F&(H^U))+q[7]+1735328473&4294967295,j=H+(Z<<14&4294967295|Z>>>18),Z=F+(H^U&(j^H))+q[12]+2368359562&4294967295,F=j+(Z<<20&4294967295|Z>>>12),Z=U+(F^j^H)+q[5]+4294588738&4294967295,U=F+(Z<<4&4294967295|Z>>>28),Z=H+(U^F^j)+q[8]+2272392833&4294967295,H=U+(Z<<11&4294967295|Z>>>21),Z=j+(H^U^F)+q[11]+1839030562&4294967295,j=H+(Z<<16&4294967295|Z>>>16),Z=F+(j^H^U)+q[14]+4259657740&4294967295,F=j+(Z<<23&4294967295|Z>>>9),Z=U+(F^j^H)+q[1]+2763975236&4294967295,U=F+(Z<<4&4294967295|Z>>>28),Z=H+(U^F^j)+q[4]+1272893353&4294967295,H=U+(Z<<11&4294967295|Z>>>21),Z=j+(H^U^F)+q[7]+4139469664&4294967295,j=H+(Z<<16&4294967295|Z>>>16),Z=F+(j^H^U)+q[10]+3200236656&4294967295,F=j+(Z<<23&4294967295|Z>>>9),Z=U+(F^j^H)+q[13]+681279174&4294967295,U=F+(Z<<4&4294967295|Z>>>28),Z=H+(U^F^j)+q[0]+3936430074&4294967295,H=U+(Z<<11&4294967295|Z>>>21),Z=j+(H^U^F)+q[3]+3572445317&4294967295,j=H+(Z<<16&4294967295|Z>>>16),Z=F+(j^H^U)+q[6]+76029189&4294967295,F=j+(Z<<23&4294967295|Z>>>9),Z=U+(F^j^H)+q[9]+3654602809&4294967295,U=F+(Z<<4&4294967295|Z>>>28),Z=H+(U^F^j)+q[12]+3873151461&4294967295,H=U+(Z<<11&4294967295|Z>>>21),Z=j+(H^U^F)+q[15]+530742520&4294967295,j=H+(Z<<16&4294967295|Z>>>16),Z=F+(j^H^U)+q[2]+3299628645&4294967295,F=j+(Z<<23&4294967295|Z>>>9),Z=U+(j^(F|~H))+q[0]+4096336452&4294967295,U=F+(Z<<6&4294967295|Z>>>26),Z=H+(F^(U|~j))+q[7]+1126891415&4294967295,H=U+(Z<<10&4294967295|Z>>>22),Z=j+(U^(H|~F))+q[14]+2878612391&4294967295,j=H+(Z<<15&4294967295|Z>>>17),Z=F+(H^(j|~U))+q[5]+4237533241&4294967295,F=j+(Z<<21&4294967295|Z>>>11),Z=U+(j^(F|~H))+q[12]+1700485571&4294967295,U=F+(Z<<6&4294967295|Z>>>26),Z=H+(F^(U|~j))+q[3]+2399980690&4294967295,H=U+(Z<<10&4294967295|Z>>>22),Z=j+(U^(H|~F))+q[10]+4293915773&4294967295,j=H+(Z<<15&4294967295|Z>>>17),Z=F+(H^(j|~U))+q[1]+2240044497&4294967295,F=j+(Z<<21&4294967295|Z>>>11),Z=U+(j^(F|~H))+q[8]+1873313359&4294967295,U=F+(Z<<6&4294967295|Z>>>26),Z=H+(F^(U|~j))+q[15]+4264355552&4294967295,H=U+(Z<<10&4294967295|Z>>>22),Z=j+(U^(H|~F))+q[6]+2734768916&4294967295,j=H+(Z<<15&4294967295|Z>>>17),Z=F+(H^(j|~U))+q[13]+1309151649&4294967295,F=j+(Z<<21&4294967295|Z>>>11),Z=U+(j^(F|~H))+q[4]+4149444226&4294967295,U=F+(Z<<6&4294967295|Z>>>26),Z=H+(F^(U|~j))+q[11]+3174756917&4294967295,H=U+(Z<<10&4294967295|Z>>>22),Z=j+(U^(H|~F))+q[2]+718787259&4294967295,j=H+(Z<<15&4294967295|Z>>>17),Z=F+(H^(j|~U))+q[9]+3951481745&4294967295,pe.g[0]=pe.g[0]+U&4294967295,pe.g[1]=pe.g[1]+(j+(Z<<21&4294967295|Z>>>11))&4294967295,pe.g[2]=pe.g[2]+j&4294967295,pe.g[3]=pe.g[3]+H&4294967295}i.prototype.u=function(pe,U){U===void 0&&(U=pe.length);for(var F=U-this.blockSize,q=this.B,j=this.h,H=0;H<U;){if(j==0)for(;H<=F;)c(this,pe,H),H+=this.blockSize;if(typeof pe=="string"){for(;H<U;)if(q[j++]=pe.charCodeAt(H++),j==this.blockSize){c(this,q),j=0;break}}else for(;H<U;)if(q[j++]=pe[H++],j==this.blockSize){c(this,q),j=0;break}}this.h=j,this.o+=U},i.prototype.v=function(){var pe=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);pe[0]=128;for(var U=1;U<pe.length-8;++U)pe[U]=0;var F=8*this.o;for(U=pe.length-8;U<pe.length;++U)pe[U]=F&255,F/=256;for(this.u(pe),pe=Array(16),U=F=0;4>U;++U)for(var q=0;32>q;q+=8)pe[F++]=this.g[U]>>>q&255;return pe};function u(pe,U){var F=_;return Object.prototype.hasOwnProperty.call(F,pe)?F[pe]:F[pe]=U(pe)}function m(pe,U){this.h=U;for(var F=[],q=!0,j=pe.length-1;0<=j;j--){var H=pe[j]|0;q&&H==U||(F[j]=H,q=!1)}this.g=F}var _={};function o(pe){return-128<=pe&&128>pe?u(pe,function(U){return new m([U|0],0>U?-1:0)}):new m([pe|0],0>pe?-1:0)}function w(pe){if(isNaN(pe)||!isFinite(pe))return R;if(0>pe)return fe(w(-pe));for(var U=[],F=1,q=0;pe>=F;q++)U[q]=pe/F|0,F*=4294967296;return new m(U,0)}function I(pe,U){if(pe.length==0)throw Error("number format error: empty string");if(U=U||10,2>U||36<U)throw Error("radix out of range: "+U);if(pe.charAt(0)=="-")return fe(I(pe.substring(1),U));if(0<=pe.indexOf("-"))throw Error('number format error: interior "-" character');for(var F=w(Math.pow(U,8)),q=R,j=0;j<pe.length;j+=8){var H=Math.min(8,pe.length-j),Z=parseInt(pe.substring(j,j+H),U);8>H?(H=w(Math.pow(U,H)),q=q.j(H).add(w(Z))):(q=q.j(F),q=q.add(w(Z)))}return q}var R=o(0),V=o(1),k=o(16777216);n=m.prototype,n.m=function(){if(ae(this))return-fe(this).m();for(var pe=0,U=1,F=0;F<this.g.length;F++){var q=this.i(F);pe+=(0<=q?q:4294967296+q)*U,U*=4294967296}return pe},n.toString=function(pe){if(pe=pe||10,2>pe||36<pe)throw Error("radix out of range: "+pe);if(ie(this))return"0";if(ae(this))return"-"+fe(this).toString(pe);for(var U=w(Math.pow(pe,6)),F=this,q="";;){var j=ue(F,U).g;F=J(F,j.j(U));var H=((0<F.g.length?F.g[0]:F.h)>>>0).toString(pe);if(F=j,ie(F))return H+q;for(;6>H.length;)H="0"+H;q=H+q}},n.i=function(pe){return 0>pe?0:pe<this.g.length?this.g[pe]:this.h};function ie(pe){if(pe.h!=0)return!1;for(var U=0;U<pe.g.length;U++)if(pe.g[U]!=0)return!1;return!0}function ae(pe){return pe.h==-1}n.l=function(pe){return pe=J(this,pe),ae(pe)?-1:ie(pe)?0:1};function fe(pe){for(var U=pe.g.length,F=[],q=0;q<U;q++)F[q]=~pe.g[q];return new m(F,~pe.h).add(V)}n.abs=function(){return ae(this)?fe(this):this},n.add=function(pe){for(var U=Math.max(this.g.length,pe.g.length),F=[],q=0,j=0;j<=U;j++){var H=q+(this.i(j)&65535)+(pe.i(j)&65535),Z=(H>>>16)+(this.i(j)>>>16)+(pe.i(j)>>>16);q=Z>>>16,H&=65535,Z&=65535,F[j]=Z<<16|H}return new m(F,F[F.length-1]&-2147483648?-1:0)};function J(pe,U){return pe.add(fe(U))}n.j=function(pe){if(ie(this)||ie(pe))return R;if(ae(this))return ae(pe)?fe(this).j(fe(pe)):fe(fe(this).j(pe));if(ae(pe))return fe(this.j(fe(pe)));if(0>this.l(k)&&0>pe.l(k))return w(this.m()*pe.m());for(var U=this.g.length+pe.g.length,F=[],q=0;q<2*U;q++)F[q]=0;for(q=0;q<this.g.length;q++)for(var j=0;j<pe.g.length;j++){var H=this.i(q)>>>16,Z=this.i(q)&65535,be=pe.i(j)>>>16,Me=pe.i(j)&65535;F[2*q+2*j]+=Z*Me,ne(F,2*q+2*j),F[2*q+2*j+1]+=H*Me,ne(F,2*q+2*j+1),F[2*q+2*j+1]+=Z*be,ne(F,2*q+2*j+1),F[2*q+2*j+2]+=H*be,ne(F,2*q+2*j+2)}for(q=0;q<U;q++)F[q]=F[2*q+1]<<16|F[2*q];for(q=U;q<2*U;q++)F[q]=0;return new m(F,0)};function ne(pe,U){for(;(pe[U]&65535)!=pe[U];)pe[U+1]+=pe[U]>>>16,pe[U]&=65535,U++}function me(pe,U){this.g=pe,this.h=U}function ue(pe,U){if(ie(U))throw Error("division by zero");if(ie(pe))return new me(R,R);if(ae(pe))return U=ue(fe(pe),U),new me(fe(U.g),fe(U.h));if(ae(U))return U=ue(pe,fe(U)),new me(fe(U.g),U.h);if(30<pe.g.length){if(ae(pe)||ae(U))throw Error("slowDivide_ only works with positive integers.");for(var F=V,q=U;0>=q.l(pe);)F=ke(F),q=ke(q);var j=ze(F,1),H=ze(q,1);for(q=ze(q,2),F=ze(F,2);!ie(q);){var Z=H.add(q);0>=Z.l(pe)&&(j=j.add(F),H=Z),q=ze(q,1),F=ze(F,1)}return U=J(pe,j.j(U)),new me(j,U)}for(j=R;0<=pe.l(U);){for(F=Math.max(1,Math.floor(pe.m()/U.m())),q=Math.ceil(Math.log(F)/Math.LN2),q=48>=q?1:Math.pow(2,q-48),H=w(F),Z=H.j(U);ae(Z)||0<Z.l(pe);)F-=q,H=w(F),Z=H.j(U);ie(H)&&(H=V),j=j.add(H),pe=J(pe,Z)}return new me(j,pe)}n.A=function(pe){return ue(this,pe).h},n.and=function(pe){for(var U=Math.max(this.g.length,pe.g.length),F=[],q=0;q<U;q++)F[q]=this.i(q)&pe.i(q);return new m(F,this.h&pe.h)},n.or=function(pe){for(var U=Math.max(this.g.length,pe.g.length),F=[],q=0;q<U;q++)F[q]=this.i(q)|pe.i(q);return new m(F,this.h|pe.h)},n.xor=function(pe){for(var U=Math.max(this.g.length,pe.g.length),F=[],q=0;q<U;q++)F[q]=this.i(q)^pe.i(q);return new m(F,this.h^pe.h)};function ke(pe){for(var U=pe.g.length+1,F=[],q=0;q<U;q++)F[q]=pe.i(q)<<1|pe.i(q-1)>>>31;return new m(F,pe.h)}function ze(pe,U){var F=U>>5;U%=32;for(var q=pe.g.length-F,j=[],H=0;H<q;H++)j[H]=0<U?pe.i(H+F)>>>U|pe.i(H+F+1)<<32-U:pe.i(H+F);return new m(j,pe.h)}i.prototype.digest=i.prototype.v,i.prototype.reset=i.prototype.s,i.prototype.update=i.prototype.u,i9=i,m.prototype.add=m.prototype.add,m.prototype.multiply=m.prototype.j,m.prototype.modulo=m.prototype.A,m.prototype.compare=m.prototype.l,m.prototype.toNumber=m.prototype.m,m.prototype.toString=m.prototype.toString,m.prototype.getBits=m.prototype.i,m.fromNumber=w,m.fromString=I,eg=m}).apply(typeof QS<"u"?QS:typeof self<"u"?self:typeof window<"u"?window:{});var v1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var o9,Py,s9,$1,L5,a9,l9,c9;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(L,se,ve){return L==Array.prototype||L==Object.prototype||(L[se]=ve.value),L};function t(L){L=[typeof globalThis=="object"&&globalThis,L,typeof window=="object"&&window,typeof self=="object"&&self,typeof v1=="object"&&v1];for(var se=0;se<L.length;++se){var ve=L[se];if(ve&&ve.Math==Math)return ve}throw Error("Cannot find global object")}var i=t(this);function c(L,se){if(se)e:{var ve=i;L=L.split(".");for(var He=0;He<L.length-1;He++){var Xt=L[He];if(!(Xt in ve))break e;ve=ve[Xt]}L=L[L.length-1],He=ve[L],se=se(He),se!=He&&se!=null&&e(ve,L,{configurable:!0,writable:!0,value:se})}}function u(L,se){L instanceof String&&(L+="");var ve=0,He=!1,Xt={next:function(){if(!He&&ve<L.length){var fn=ve++;return{value:se(fn,L[fn]),done:!1}}return He=!0,{done:!0,value:void 0}}};return Xt[Symbol.iterator]=function(){return Xt},Xt}c("Array.prototype.values",function(L){return L||function(){return u(this,function(se,ve){return ve})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var m=m||{},_=this||self;function o(L){var se=typeof L;return se=se!="object"?se:L?Array.isArray(L)?"array":se:"null",se=="array"||se=="object"&&typeof L.length=="number"}function w(L){var se=typeof L;return se=="object"&&L!=null||se=="function"}function I(L,se,ve){return L.call.apply(L.bind,arguments)}function R(L,se,ve){if(!L)throw Error();if(2<arguments.length){var He=Array.prototype.slice.call(arguments,2);return function(){var Xt=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Xt,He),L.apply(se,Xt)}}return function(){return L.apply(se,arguments)}}function V(L,se,ve){return V=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?I:R,V.apply(null,arguments)}function k(L,se){var ve=Array.prototype.slice.call(arguments,1);return function(){var He=ve.slice();return He.push.apply(He,arguments),L.apply(this,He)}}function ie(L,se){function ve(){}ve.prototype=se.prototype,L.aa=se.prototype,L.prototype=new ve,L.prototype.constructor=L,L.Qb=function(He,Xt,fn){for(var ar=Array(arguments.length-2),ao=2;ao<arguments.length;ao++)ar[ao-2]=arguments[ao];return se.prototype[Xt].apply(He,ar)}}function ae(L){const se=L.length;if(0<se){const ve=Array(se);for(let He=0;He<se;He++)ve[He]=L[He];return ve}return[]}function fe(L,se){for(let ve=1;ve<arguments.length;ve++){const He=arguments[ve];if(o(He)){const Xt=L.length||0,fn=He.length||0;L.length=Xt+fn;for(let ar=0;ar<fn;ar++)L[Xt+ar]=He[ar]}else L.push(He)}}class J{constructor(se,ve){this.i=se,this.j=ve,this.h=0,this.g=null}get(){let se;return 0<this.h?(this.h--,se=this.g,this.g=se.next,se.next=null):se=this.i(),se}}function ne(L){return/^[\s\xa0]*$/.test(L)}function me(){var L=_.navigator;return L&&(L=L.userAgent)?L:""}function ue(L){return ue[" "](L),L}ue[" "]=function(){};var ke=me().indexOf("Gecko")!=-1&&!(me().toLowerCase().indexOf("webkit")!=-1&&me().indexOf("Edge")==-1)&&!(me().indexOf("Trident")!=-1||me().indexOf("MSIE")!=-1)&&me().indexOf("Edge")==-1;function ze(L,se,ve){for(const He in L)se.call(ve,L[He],He,L)}function pe(L,se){for(const ve in L)se.call(void 0,L[ve],ve,L)}function U(L){const se={};for(const ve in L)se[ve]=L[ve];return se}const F="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function q(L,se){let ve,He;for(let Xt=1;Xt<arguments.length;Xt++){He=arguments[Xt];for(ve in He)L[ve]=He[ve];for(let fn=0;fn<F.length;fn++)ve=F[fn],Object.prototype.hasOwnProperty.call(He,ve)&&(L[ve]=He[ve])}}function j(L){var se=1;L=L.split(":");const ve=[];for(;0<se&&L.length;)ve.push(L.shift()),se--;return L.length&&ve.push(L.join(":")),ve}function H(L){_.setTimeout(()=>{throw L},0)}function Z(){var L=De;let se=null;return L.g&&(se=L.g,L.g=L.g.next,L.g||(L.h=null),se.next=null),se}class be{constructor(){this.h=this.g=null}add(se,ve){const He=Me.get();He.set(se,ve),this.h?this.h.next=He:this.g=He,this.h=He}}var Me=new J(()=>new Be,L=>L.reset());class Be{constructor(){this.next=this.g=this.h=null}set(se,ve){this.h=se,this.g=ve,this.next=null}reset(){this.next=this.g=this.h=null}}let Re,we=!1,De=new be,nt=()=>{const L=_.Promise.resolve(void 0);Re=()=>{L.then(xe)}};var xe=()=>{for(var L;L=Z();){try{L.h.call(L.g)}catch(ve){H(ve)}var se=Me;se.j(L),100>se.h&&(se.h++,L.next=se.g,se.g=L)}we=!1};function le(){this.s=this.s,this.C=this.C}le.prototype.s=!1,le.prototype.ma=function(){this.s||(this.s=!0,this.N())},le.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ne(L,se){this.type=L,this.g=this.target=se,this.defaultPrevented=!1}Ne.prototype.h=function(){this.defaultPrevented=!0};var Oe=(function(){if(!_.addEventListener||!Object.defineProperty)return!1;var L=!1,se=Object.defineProperty({},"passive",{get:function(){L=!0}});try{const ve=()=>{};_.addEventListener("test",ve,se),_.removeEventListener("test",ve,se)}catch{}return L})();function Je(L,se){if(Ne.call(this,L?L.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,L){var ve=this.type=L.type,He=L.changedTouches&&L.changedTouches.length?L.changedTouches[0]:null;if(this.target=L.target||L.srcElement,this.g=se,se=L.relatedTarget){if(ke){e:{try{ue(se.nodeName);var Xt=!0;break e}catch{}Xt=!1}Xt||(se=null)}}else ve=="mouseover"?se=L.fromElement:ve=="mouseout"&&(se=L.toElement);this.relatedTarget=se,He?(this.clientX=He.clientX!==void 0?He.clientX:He.pageX,this.clientY=He.clientY!==void 0?He.clientY:He.pageY,this.screenX=He.screenX||0,this.screenY=He.screenY||0):(this.clientX=L.clientX!==void 0?L.clientX:L.pageX,this.clientY=L.clientY!==void 0?L.clientY:L.pageY,this.screenX=L.screenX||0,this.screenY=L.screenY||0),this.button=L.button,this.key=L.key||"",this.ctrlKey=L.ctrlKey,this.altKey=L.altKey,this.shiftKey=L.shiftKey,this.metaKey=L.metaKey,this.pointerId=L.pointerId||0,this.pointerType=typeof L.pointerType=="string"?L.pointerType:rt[L.pointerType]||"",this.state=L.state,this.i=L,L.defaultPrevented&&Je.aa.h.call(this)}}ie(Je,Ne);var rt={2:"touch",3:"pen",4:"mouse"};Je.prototype.h=function(){Je.aa.h.call(this);var L=this.i;L.preventDefault?L.preventDefault():L.returnValue=!1};var mt="closure_listenable_"+(1e6*Math.random()|0),dt=0;function Dt(L,se,ve,He,Xt){this.listener=L,this.proxy=null,this.src=se,this.type=ve,this.capture=!!He,this.ha=Xt,this.key=++dt,this.da=this.fa=!1}function tn(L){L.da=!0,L.listener=null,L.proxy=null,L.src=null,L.ha=null}function ln(L){this.src=L,this.g={},this.h=0}ln.prototype.add=function(L,se,ve,He,Xt){var fn=L.toString();L=this.g[fn],L||(L=this.g[fn]=[],this.h++);var ar=Mn(L,se,He,Xt);return-1<ar?(se=L[ar],ve||(se.fa=!1)):(se=new Dt(se,this.src,fn,!!He,Xt),se.fa=ve,L.push(se)),se};function yn(L,se){var ve=se.type;if(ve in L.g){var He=L.g[ve],Xt=Array.prototype.indexOf.call(He,se,void 0),fn;(fn=0<=Xt)&&Array.prototype.splice.call(He,Xt,1),fn&&(tn(se),L.g[ve].length==0&&(delete L.g[ve],L.h--))}}function Mn(L,se,ve,He){for(var Xt=0;Xt<L.length;++Xt){var fn=L[Xt];if(!fn.da&&fn.listener==se&&fn.capture==!!ve&&fn.ha==He)return Xt}return-1}var Gt="closure_lm_"+(1e6*Math.random()|0),st={};function fr(L,se,ve,He,Xt){if(Array.isArray(se)){for(var fn=0;fn<se.length;fn++)fr(L,se[fn],ve,He,Xt);return null}return ve=$n(ve),L&&L[mt]?L.K(se,ve,w(He)?!!He.capture:!1,Xt):br(L,se,ve,!1,He,Xt)}function br(L,se,ve,He,Xt,fn){if(!se)throw Error("Invalid event type");var ar=w(Xt)?!!Xt.capture:!!Xt,ao=Vt(L);if(ao||(L[Gt]=ao=new ln(L)),ve=ao.add(se,ve,He,ar,fn),ve.proxy)return ve;if(He=Tr(),ve.proxy=He,He.src=L,He.listener=ve,L.addEventListener)Oe||(Xt=ar),Xt===void 0&&(Xt=!1),L.addEventListener(se.toString(),He,Xt);else if(L.attachEvent)L.attachEvent(Jn(se.toString()),He);else if(L.addListener&&L.removeListener)L.addListener(He);else throw Error("addEventListener and attachEvent are unavailable.");return ve}function Tr(){function L(ve){return se.call(L.src,L.listener,ve)}const se=Hr;return L}function Cn(L,se,ve,He,Xt){if(Array.isArray(se))for(var fn=0;fn<se.length;fn++)Cn(L,se[fn],ve,He,Xt);else He=w(He)?!!He.capture:!!He,ve=$n(ve),L&&L[mt]?(L=L.i,se=String(se).toString(),se in L.g&&(fn=L.g[se],ve=Mn(fn,ve,He,Xt),-1<ve&&(tn(fn[ve]),Array.prototype.splice.call(fn,ve,1),fn.length==0&&(delete L.g[se],L.h--)))):L&&(L=Vt(L))&&(se=L.g[se.toString()],L=-1,se&&(L=Mn(se,ve,He,Xt)),(ve=-1<L?se[L]:null)&&ir(ve))}function ir(L){if(typeof L!="number"&&L&&!L.da){var se=L.src;if(se&&se[mt])yn(se.i,L);else{var ve=L.type,He=L.proxy;se.removeEventListener?se.removeEventListener(ve,He,L.capture):se.detachEvent?se.detachEvent(Jn(ve),He):se.addListener&&se.removeListener&&se.removeListener(He),(ve=Vt(se))?(yn(ve,L),ve.h==0&&(ve.src=null,se[Gt]=null)):tn(L)}}}function Jn(L){return L in st?st[L]:st[L]="on"+L}function Hr(L,se){if(L.da)L=!0;else{se=new Je(se,this);var ve=L.listener,He=L.ha||L.src;L.fa&&ir(L),L=ve.call(He,se)}return L}function Vt(L){return L=L[Gt],L instanceof ln?L:null}var Ln="__closure_events_fn_"+(1e9*Math.random()>>>0);function $n(L){return typeof L=="function"?L:(L[Ln]||(L[Ln]=function(se){return L.handleEvent(se)}),L[Ln])}function Dn(){le.call(this),this.i=new ln(this),this.M=this,this.F=null}ie(Dn,le),Dn.prototype[mt]=!0,Dn.prototype.removeEventListener=function(L,se,ve,He){Cn(this,L,se,ve,He)};function Mr(L,se){var ve,He=L.F;if(He)for(ve=[];He;He=He.F)ve.push(He);if(L=L.M,He=se.type||se,typeof se=="string")se=new Ne(se,L);else if(se instanceof Ne)se.target=se.target||L;else{var Xt=se;se=new Ne(He,L),q(se,Xt)}if(Xt=!0,ve)for(var fn=ve.length-1;0<=fn;fn--){var ar=se.g=ve[fn];Xt=xr(ar,He,!0,se)&&Xt}if(ar=se.g=L,Xt=xr(ar,He,!0,se)&&Xt,Xt=xr(ar,He,!1,se)&&Xt,ve)for(fn=0;fn<ve.length;fn++)ar=se.g=ve[fn],Xt=xr(ar,He,!1,se)&&Xt}Dn.prototype.N=function(){if(Dn.aa.N.call(this),this.i){var L=this.i,se;for(se in L.g){for(var ve=L.g[se],He=0;He<ve.length;He++)tn(ve[He]);delete L.g[se],L.h--}}this.F=null},Dn.prototype.K=function(L,se,ve,He){return this.i.add(String(L),se,!1,ve,He)},Dn.prototype.L=function(L,se,ve,He){return this.i.add(String(L),se,!0,ve,He)};function xr(L,se,ve,He){if(se=L.i.g[String(se)],!se)return!0;se=se.concat();for(var Xt=!0,fn=0;fn<se.length;++fn){var ar=se[fn];if(ar&&!ar.da&&ar.capture==ve){var ao=ar.listener,Fo=ar.ha||ar.src;ar.fa&&yn(L.i,ar),Xt=ao.call(Fo,He)!==!1&&Xt}}return Xt&&!He.defaultPrevented}function Sr(L,se,ve){if(typeof L=="function")ve&&(L=V(L,ve));else if(L&&typeof L.handleEvent=="function")L=V(L.handleEvent,L);else throw Error("Invalid listener argument");return 2147483647<Number(se)?-1:_.setTimeout(L,se||0)}function Er(L){L.g=Sr(()=>{L.g=null,L.i&&(L.i=!1,Er(L))},L.l);const se=L.h;L.h=null,L.m.apply(null,se)}class Cr extends le{constructor(se,ve){super(),this.m=se,this.l=ve,this.h=null,this.i=!1,this.g=null}j(se){this.h=arguments,this.g?this.i=!0:Er(this)}N(){super.N(),this.g&&(_.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Si(L){le.call(this),this.h=L,this.g={}}ie(Si,le);var Li=[];function or(L){ze(L.g,function(se,ve){this.g.hasOwnProperty(ve)&&ir(se)},L),L.g={}}Si.prototype.N=function(){Si.aa.N.call(this),or(this)},Si.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ai=_.JSON.stringify,qr=_.JSON.parse,Dr=class{stringify(L){return _.JSON.stringify(L,void 0)}parse(L){return _.JSON.parse(L,void 0)}};function hi(){}hi.prototype.h=null;function li(L){return L.h||(L.h=L.i())}function lt(){}var Ee={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Te(){Ne.call(this,"d")}ie(Te,Ne);function et(){Ne.call(this,"c")}ie(et,Ne);var ht={},Ct=null;function Rt(){return Ct=Ct||new Dn}ht.La="serverreachability";function Ot(L){Ne.call(this,ht.La,L)}ie(Ot,Ne);function At(L){const se=Rt();Mr(se,new Ot(se))}ht.STAT_EVENT="statevent";function Lt(L,se){Ne.call(this,ht.STAT_EVENT,L),this.stat=se}ie(Lt,Ne);function xn(L){const se=Rt();Mr(se,new Lt(se,L))}ht.Ma="timingevent";function On(L,se){Ne.call(this,ht.Ma,L),this.size=se}ie(On,Ne);function An(L,se){if(typeof L!="function")throw Error("Fn must not be null and must be a function");return _.setTimeout(function(){L()},se)}function Lr(){this.g=!0}Lr.prototype.xa=function(){this.g=!1};function Ir(L,se,ve,He,Xt,fn){L.info(function(){if(L.g)if(fn)for(var ar="",ao=fn.split("&"),Fo=0;Fo<ao.length;Fo++){var qi=ao[Fo].split("=");if(1<qi.length){var Di=qi[0];qi=qi[1];var Ro=Di.split("_");ar=2<=Ro.length&&Ro[1]=="type"?ar+(Di+"="+qi+"&"):ar+(Di+"=redacted&")}}else ar=null;else ar=fn;return"XMLHTTP REQ ("+He+") [attempt "+Xt+"]: "+se+`
`+ve+`
`+ar})}function zr(L,se,ve,He,Xt,fn,ar){L.info(function(){return"XMLHTTP RESP ("+He+") [ attempt "+Xt+"]: "+se+`
`+ve+`
`+fn+" "+ar})}function wr(L,se,ve,He){L.info(function(){return"XMLHTTP TEXT ("+se+"): "+to(L,ve)+(He?" "+He:"")})}function Ei(L,se){L.info(function(){return"TIMEOUT: "+se})}Lr.prototype.info=function(){};function to(L,se){if(!L.g)return se;if(!se)return null;try{var ve=JSON.parse(se);if(ve){for(L=0;L<ve.length;L++)if(Array.isArray(ve[L])){var He=ve[L];if(!(2>He.length)){var Xt=He[1];if(Array.isArray(Xt)&&!(1>Xt.length)){var fn=Xt[0];if(fn!="noop"&&fn!="stop"&&fn!="close")for(var ar=1;ar<Xt.length;ar++)Xt[ar]=""}}}}return ai(ve)}catch{return se}}var po={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Wo={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},no;function _s(){}ie(_s,hi),_s.prototype.g=function(){return new XMLHttpRequest},_s.prototype.i=function(){return{}},no=new _s;function ro(L,se,ve,He){this.j=L,this.i=se,this.l=ve,this.R=He||1,this.U=new Si(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ps}function Ps(){this.i=null,this.g="",this.h=!1}var fa={},Sl={};function al(L,se,ve){L.L=1,L.v=El(Rr(se)),L.m=ve,L.P=!0,Vi(L,null)}function Vi(L,se){L.F=Date.now(),So(L),L.A=Rr(L.v);var ve=L.A,He=L.R;Array.isArray(He)||(He=[String(He)]),ci(ve.i,"t",He),L.C=0,ve=L.j.J,L.h=new Ps,L.g=Vo(L.j,ve?se:null,!L.m),0<L.O&&(L.M=new Cr(V(L.Y,L,L.g),L.O)),se=L.U,ve=L.g,He=L.ca;var Xt="readystatechange";Array.isArray(Xt)||(Xt&&(Li[0]=Xt.toString()),Xt=Li);for(var fn=0;fn<Xt.length;fn++){var ar=fr(ve,Xt[fn],He||se.handleEvent,!1,se.h||se);if(!ar)break;se.g[ar.key]=ar}se=L.H?U(L.H):{},L.m?(L.u||(L.u="POST"),se["Content-Type"]="application/x-www-form-urlencoded",L.g.ea(L.A,L.u,L.m,se)):(L.u="GET",L.g.ea(L.A,L.u,null,se)),At(),Ir(L.i,L.u,L.A,L.l,L.R,L.m)}ro.prototype.ca=function(L){L=L.target;const se=this.M;se&&Ss(L)==3?se.j():this.Y(L)},ro.prototype.Y=function(L){try{if(L==this.g)e:{const Ro=Ss(this.g);var se=this.g.Ba();const sa=this.g.Z();if(!(3>Ro)&&(Ro!=3||this.g&&(this.h.h||this.g.oa()||qs(this.g)))){this.J||Ro!=4||se==7||(se==8||0>=sa?At(3):At(2)),Ea(this);var ve=this.g.Z();this.X=ve;t:if(Ql(this)){var He=qs(this.g);L="";var Xt=He.length,fn=Ss(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Xa(this),Zo(this);var ar="";break t}this.h.i=new _.TextDecoder}for(se=0;se<Xt;se++)this.h.h=!0,L+=this.h.i.decode(He[se],{stream:!(fn&&se==Xt-1)});He.length=0,this.h.g+=L,this.C=0,ar=this.h.g}else ar=this.g.oa();if(this.o=ve==200,zr(this.i,this.u,this.A,this.l,this.R,Ro,ve),this.o){if(this.T&&!this.K){t:{if(this.g){var ao,Fo=this.g;if((ao=Fo.g?Fo.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!ne(ao)){var qi=ao;break t}}qi=null}if(ve=qi)wr(this.i,this.l,ve,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,kl(this,ve);else{this.o=!1,this.s=3,xn(12),Xa(this),Zo(this);break e}}if(this.P){ve=!0;let Oo;for(;!this.J&&this.C<ar.length;)if(Oo=Pu(this,ar),Oo==Sl){Ro==4&&(this.s=4,xn(14),ve=!1),wr(this.i,this.l,null,"[Incomplete Response]");break}else if(Oo==fa){this.s=4,xn(15),wr(this.i,this.l,ar,"[Invalid Chunk]"),ve=!1;break}else wr(this.i,this.l,Oo,null),kl(this,Oo);if(Ql(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ro!=4||ar.length!=0||this.h.h||(this.s=1,xn(16),ve=!1),this.o=this.o&&ve,!ve)wr(this.i,this.l,ar,"[Invalid Chunked Response]"),Xa(this),Zo(this);else if(0<ar.length&&!this.W){this.W=!0;var Di=this.j;Di.g==this&&Di.ba&&!Di.M&&(Di.j.info("Great, no buffering proxy detected. Bytes received: "+ar.length),Nr(Di),Di.M=!0,xn(11))}}else wr(this.i,this.l,ar,null),kl(this,ar);Ro==4&&Xa(this),this.o&&!this.J&&(Ro==4?Ti(this.j,this):(this.o=!1,So(this)))}else ia(this.g),ve==400&&0<ar.indexOf("Unknown SID")?(this.s=3,xn(12)):(this.s=0,xn(13)),Xa(this),Zo(this)}}}catch{}finally{}};function Ql(L){return L.g?L.u=="GET"&&L.L!=2&&L.j.Ca:!1}function Pu(L,se){var ve=L.C,He=se.indexOf(`
`,ve);return He==-1?Sl:(ve=Number(se.substring(ve,He)),isNaN(ve)?fa:(He+=1,He+ve>se.length?Sl:(se=se.slice(He,He+ve),L.C=He+ve,se)))}ro.prototype.cancel=function(){this.J=!0,Xa(this)};function So(L){L.S=Date.now()+L.I,mu(L,L.I)}function mu(L,se){if(L.B!=null)throw Error("WatchDog timer not null");L.B=An(V(L.ba,L),se)}function Ea(L){L.B&&(_.clearTimeout(L.B),L.B=null)}ro.prototype.ba=function(){this.B=null;const L=Date.now();0<=L-this.S?(Ei(this.i,this.A),this.L!=2&&(At(),xn(17)),Xa(this),this.s=2,Zo(this)):mu(this,this.S-L)};function Zo(L){L.j.G==0||L.J||Ti(L.j,L)}function Xa(L){Ea(L);var se=L.M;se&&typeof se.ma=="function"&&se.ma(),L.M=null,or(L.U),L.g&&(se=L.g,L.g=null,se.abort(),se.ma())}function kl(L,se){try{var ve=L.j;if(ve.G!=0&&(ve.g==L||Yo(ve.h,L))){if(!L.K&&Yo(ve.h,L)&&ve.G==3){try{var He=ve.Da.g.parse(se)}catch{He=null}if(Array.isArray(He)&&He.length==3){var Xt=He;if(Xt[0]==0){e:if(!ve.u){if(ve.g)if(ve.g.F+3e3<L.F)yi(ve),Gs(ve);else break e;Fn(ve),xn(18)}}else ve.za=Xt[1],0<ve.za-ve.T&&37500>Xt[2]&&ve.F&&ve.v==0&&!ve.C&&(ve.C=An(V(ve.Za,ve),6e3));if(1>=pn(ve.h)&&ve.ca){try{ve.ca()}catch{}ve.ca=void 0}}else _o(ve,11)}else if((L.K||ve.g==L)&&yi(ve),!ne(se))for(Xt=ve.Da.g.parse(se),se=0;se<Xt.length;se++){let qi=Xt[se];if(ve.T=qi[0],qi=qi[1],ve.G==2)if(qi[0]=="c"){ve.K=qi[1],ve.ia=qi[2];const Di=qi[3];Di!=null&&(ve.la=Di,ve.j.info("VER="+ve.la));const Ro=qi[4];Ro!=null&&(ve.Aa=Ro,ve.j.info("SVER="+ve.Aa));const sa=qi[5];sa!=null&&typeof sa=="number"&&0<sa&&(He=1.5*sa,ve.L=He,ve.j.info("backChannelRequestTimeoutMs_="+He)),He=ve;const Oo=L.g;if(Oo){const Ji=Oo.g?Oo.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ji){var fn=He.h;fn.g||Ji.indexOf("spdy")==-1&&Ji.indexOf("quic")==-1&&Ji.indexOf("h2")==-1||(fn.j=fn.l,fn.g=new Set,fn.h&&(ss(fn,fn.h),fn.h=null))}if(He.D){const Rl=Oo.g?Oo.g.getResponseHeader("X-HTTP-Session-Id"):null;Rl&&(He.ya=Rl,Mi(He.I,He.D,Rl))}}ve.G=3,ve.l&&ve.l.ua(),ve.ba&&(ve.R=Date.now()-L.F,ve.j.info("Handshake RTT: "+ve.R+"ms")),He=ve;var ar=L;if(He.qa=Mo(He,He.J?He.ia:null,He.W),ar.K){vi(He.h,ar);var ao=ar,Fo=He.L;Fo&&(ao.I=Fo),ao.B&&(Ea(ao),So(ao)),He.g=ar}else Qt(He);0<ve.i.length&&W(ve)}else qi[0]!="stop"&&qi[0]!="close"||_o(ve,7);else ve.G==3&&(qi[0]=="stop"||qi[0]=="close"?qi[0]=="stop"?_o(ve,7):$s(ve):qi[0]!="noop"&&ve.l&&ve.l.ta(qi),ve.v=0)}}At(4)}catch{}}var ec=class{constructor(L,se){this.g=L,this.map=se}};function Aa(L){this.l=L||10,_.PerformanceNavigationTiming?(L=_.performance.getEntriesByType("navigation"),L=0<L.length&&(L[0].nextHopProtocol=="hq"||L[0].nextHopProtocol=="h2")):L=!!(_.chrome&&_.chrome.loadTimes&&_.chrome.loadTimes()&&_.chrome.loadTimes().wasFetchedViaSpdy),this.j=L?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ra(L){return L.h?!0:L.g?L.g.size>=L.j:!1}function pn(L){return L.h?1:L.g?L.g.size:0}function Yo(L,se){return L.h?L.h==se:L.g?L.g.has(se):!1}function ss(L,se){L.g?L.g.add(se):L.h=se}function vi(L,se){L.h&&L.h==se?L.h=null:L.g&&L.g.has(se)&&L.g.delete(se)}Aa.prototype.cancel=function(){if(this.i=gu(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const L of this.g.values())L.cancel();this.g.clear()}};function gu(L){if(L.h!=null)return L.i.concat(L.h.D);if(L.g!=null&&L.g.size!==0){let se=L.i;for(const ve of L.g.values())se=se.concat(ve.D);return se}return ae(L.i)}function Za(L){if(L.V&&typeof L.V=="function")return L.V();if(typeof Map<"u"&&L instanceof Map||typeof Set<"u"&&L instanceof Set)return Array.from(L.values());if(typeof L=="string")return L.split("");if(o(L)){for(var se=[],ve=L.length,He=0;He<ve;He++)se.push(L[He]);return se}se=[],ve=0;for(He in L)se[ve++]=L[He];return se}function Ya(L){if(L.na&&typeof L.na=="function")return L.na();if(!L.V||typeof L.V!="function"){if(typeof Map<"u"&&L instanceof Map)return Array.from(L.keys());if(!(typeof Set<"u"&&L instanceof Set)){if(o(L)||typeof L=="string"){var se=[];L=L.length;for(var ve=0;ve<L;ve++)se.push(ve);return se}se=[],ve=0;for(const He in L)se[ve++]=He;return se}}}function ll(L,se){if(L.forEach&&typeof L.forEach=="function")L.forEach(se,void 0);else if(o(L)||typeof L=="string")Array.prototype.forEach.call(L,se,void 0);else for(var ve=Ya(L),He=Za(L),Xt=He.length,fn=0;fn<Xt;fn++)se.call(void 0,He[fn],ve&&ve[fn],L)}var ks=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function er(L,se){if(L){L=L.split("&");for(var ve=0;ve<L.length;ve++){var He=L[ve].indexOf("="),Xt=null;if(0<=He){var fn=L[ve].substring(0,He);Xt=L[ve].substring(He+1)}else fn=L[ve];se(fn,Xt?decodeURIComponent(Xt.replace(/\+/g," ")):"")}}}function Fr(L){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,L instanceof Fr){this.h=L.h,zs(this,L.j),this.o=L.o,this.g=L.g,Ta(this,L.s),this.l=L.l;var se=L.i,ve=new Da;ve.i=se.i,se.g&&(ve.g=new Map(se.g),ve.h=se.h),xi(this,ve),this.m=L.m}else L&&(se=String(L).match(ks))?(this.h=!1,zs(this,se[1]||"",!0),this.o=ji(se[2]||""),this.g=ji(se[3]||"",!0),Ta(this,se[4]),this.l=ji(se[5]||"",!0),xi(this,se[6]||"",!0),this.m=ji(se[7]||"")):(this.h=!1,this.i=new Da(null,this.h))}Fr.prototype.toString=function(){var L=[],se=this.j;se&&L.push(fs(se,yu,!0),":");var ve=this.g;return(ve||se=="file")&&(L.push("//"),(se=this.o)&&L.push(fs(se,yu,!0),"@"),L.push(encodeURIComponent(String(ve)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),ve=this.s,ve!=null&&L.push(":",String(ve))),(ve=this.l)&&(this.g&&ve.charAt(0)!="/"&&L.push("/"),L.push(fs(ve,ve.charAt(0)=="/"?eu:tc,!0))),(ve=this.i.toString())&&L.push("?",ve),(ve=this.m)&&L.push("#",fs(ve,nc)),L.join("")};function Rr(L){return new Fr(L)}function zs(L,se,ve){L.j=ve?ji(se,!0):se,L.j&&(L.j=L.j.replace(/:$/,""))}function Ta(L,se){if(se){if(se=Number(se),isNaN(se)||0>se)throw Error("Bad port number "+se);L.s=se}else L.s=null}function xi(L,se,ve){se instanceof Da?(L.i=se,Eo(L.i,L.h)):(ve||(se=fs(se,bc)),L.i=new Da(se,L.h))}function Mi(L,se,ve){L.i.set(se,ve)}function El(L){return Mi(L,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),L}function ji(L,se){return L?se?decodeURI(L.replace(/%25/g,"%2525")):decodeURIComponent(L):""}function fs(L,se,ve){return typeof L=="string"?(L=encodeURI(L).replace(se,Fi),ve&&(L=L.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),L):null}function Fi(L){return L=L.charCodeAt(0),"%"+(L>>4&15).toString(16)+(L&15).toString(16)}var yu=/[#\/\?@]/g,tc=/[#\?:]/g,eu=/[#\?]/g,bc=/[#\?@]/g,nc=/#/g;function Da(L,se){this.h=this.g=null,this.i=L||null,this.j=!!se}function Ms(L){L.g||(L.g=new Map,L.h=0,L.i&&er(L.i,function(se,ve){L.add(decodeURIComponent(se.replace(/\+/g," ")),ve)}))}n=Da.prototype,n.add=function(L,se){Ms(this),this.i=null,L=Jo(this,L);var ve=this.g.get(L);return ve||this.g.set(L,ve=[]),ve.push(se),this.h+=1,this};function Oi(L,se){Ms(L),se=Jo(L,se),L.g.has(se)&&(L.i=null,L.h-=L.g.get(se).length,L.g.delete(se))}function Fa(L,se){return Ms(L),se=Jo(L,se),L.g.has(se)}n.forEach=function(L,se){Ms(this),this.g.forEach(function(ve,He){ve.forEach(function(Xt){L.call(se,Xt,He,this)},this)},this)},n.na=function(){Ms(this);const L=Array.from(this.g.values()),se=Array.from(this.g.keys()),ve=[];for(let He=0;He<se.length;He++){const Xt=L[He];for(let fn=0;fn<Xt.length;fn++)ve.push(se[He])}return ve},n.V=function(L){Ms(this);let se=[];if(typeof L=="string")Fa(this,L)&&(se=se.concat(this.g.get(Jo(this,L))));else{L=Array.from(this.g.values());for(let ve=0;ve<L.length;ve++)se=se.concat(L[ve])}return se},n.set=function(L,se){return Ms(this),this.i=null,L=Jo(this,L),Fa(this,L)&&(this.h-=this.g.get(L).length),this.g.set(L,[se]),this.h+=1,this},n.get=function(L,se){return L?(L=this.V(L),0<L.length?String(L[0]):se):se};function ci(L,se,ve){Oi(L,se),0<ve.length&&(L.i=null,L.g.set(Jo(L,se),ae(ve)),L.h+=ve.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const L=[],se=Array.from(this.g.keys());for(var ve=0;ve<se.length;ve++){var He=se[ve];const fn=encodeURIComponent(String(He)),ar=this.V(He);for(He=0;He<ar.length;He++){var Xt=fn;ar[He]!==""&&(Xt+="="+encodeURIComponent(String(ar[He]))),L.push(Xt)}}return this.i=L.join("&")};function Jo(L,se){return se=String(se),L.j&&(se=se.toLowerCase()),se}function Eo(L,se){se&&!L.j&&(Ms(L),L.i=null,L.g.forEach(function(ve,He){var Xt=He.toLowerCase();He!=Xt&&(Oi(this,He),ci(this,Xt,ve))},L)),L.j=se}function xh(L,se){const ve=new Lr;if(_.Image){const He=new Image;He.onload=k(mo,ve,"TestLoadImage: loaded",!0,se,He),He.onerror=k(mo,ve,"TestLoadImage: error",!1,se,He),He.onabort=k(mo,ve,"TestLoadImage: abort",!1,se,He),He.ontimeout=k(mo,ve,"TestLoadImage: timeout",!1,se,He),_.setTimeout(function(){He.ontimeout&&He.ontimeout()},1e4),He.src=L}else se(!1)}function ku(L,se){const ve=new Lr,He=new AbortController,Xt=setTimeout(()=>{He.abort(),mo(ve,"TestPingServer: timeout",!1,se)},1e4);fetch(L,{signal:He.signal}).then(fn=>{clearTimeout(Xt),fn.ok?mo(ve,"TestPingServer: ok",!0,se):mo(ve,"TestPingServer: server error",!1,se)}).catch(()=>{clearTimeout(Xt),mo(ve,"TestPingServer: error",!1,se)})}function mo(L,se,ve,He,Xt){try{Xt&&(Xt.onload=null,Xt.onerror=null,Xt.onabort=null,Xt.ontimeout=null),He(ve)}catch{}}function js(){this.g=new Dr}function Mu(L,se,ve){const He=ve||"";try{ll(L,function(Xt,fn){let ar=Xt;w(Xt)&&(ar=ai(Xt)),se.push(He+fn+"="+encodeURIComponent(ar))})}catch(Xt){throw se.push(He+"type="+encodeURIComponent("_badmap")),Xt}}function Ko(L){this.l=L.Ub||null,this.j=L.eb||!1}ie(Ko,hi),Ko.prototype.g=function(){return new go(this.l,this.j)},Ko.prototype.i=(function(L){return function(){return L}})({});function go(L,se){Dn.call(this),this.D=L,this.o=se,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}ie(go,Dn),n=go.prototype,n.open=function(L,se){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=L,this.A=se,this.readyState=1,Us(this)},n.send=function(L){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const se={headers:this.u,method:this.B,credentials:this.m,cache:void 0};L&&(se.body=L),(this.D||_).fetch(new Request(this.A,se)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Oa(this)),this.readyState=0},n.Sa=function(L){if(this.g&&(this.l=L,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=L.headers,this.readyState=2,Us(this)),this.g&&(this.readyState=3,Us(this),this.g)))if(this.responseType==="arraybuffer")L.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof _.ReadableStream<"u"&&"body"in L){if(this.j=L.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Ml(this)}else L.text().then(this.Ra.bind(this),this.ga.bind(this))};function Ml(L){L.j.read().then(L.Pa.bind(L)).catch(L.ga.bind(L))}n.Pa=function(L){if(this.g){if(this.o&&L.value)this.response.push(L.value);else if(!this.o){var se=L.value?L.value:new Uint8Array(0);(se=this.v.decode(se,{stream:!L.done}))&&(this.response=this.responseText+=se)}L.done?Oa(this):Us(this),this.readyState==3&&Ml(this)}},n.Ra=function(L){this.g&&(this.response=this.responseText=L,Oa(this))},n.Qa=function(L){this.g&&(this.response=L,Oa(this))},n.ga=function(){this.g&&Oa(this)};function Oa(L){L.readyState=4,L.l=null,L.j=null,L.v=null,Us(L)}n.setRequestHeader=function(L,se){this.u.append(L,se)},n.getResponseHeader=function(L){return this.h&&this.h.get(L.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const L=[],se=this.h.entries();for(var ve=se.next();!ve.done;)ve=ve.value,L.push(ve[0]+": "+ve[1]),ve=se.next();return L.join(`\r
`)};function Us(L){L.onreadystatechange&&L.onreadystatechange.call(L)}Object.defineProperty(go.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(L){this.m=L?"include":"same-origin"}});function Uo(L){let se="";return ze(L,function(ve,He){se+=He,se+=":",se+=ve,se+=`\r
`}),se}function zc(L,se,ve){e:{for(He in ve){var He=!1;break e}He=!0}He||(ve=Uo(ve),typeof L=="string"?ve!=null&&encodeURIComponent(String(ve)):Mi(L,se,ve))}function Xo(L){Dn.call(this),this.headers=new Map,this.o=L||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}ie(Xo,Dn);var pa=/^https?$/i,Ja=["POST","PUT"];n=Xo.prototype,n.Ha=function(L){this.J=L},n.ea=function(L,se,ve,He){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+L);se=se?se.toUpperCase():"GET",this.D=L,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():no.g(),this.v=this.o?li(this.o):li(no),this.g.onreadystatechange=V(this.Ea,this);try{this.B=!0,this.g.open(se,String(L),!0),this.B=!1}catch(fn){cl(this,fn);return}if(L=ve||"",ve=new Map(this.headers),He)if(Object.getPrototypeOf(He)===Object.prototype)for(var Xt in He)ve.set(Xt,He[Xt]);else if(typeof He.keys=="function"&&typeof He.get=="function")for(const fn of He.keys())ve.set(fn,He.get(fn));else throw Error("Unknown input type for opt_headers: "+String(He));He=Array.from(ve.keys()).find(fn=>fn.toLowerCase()=="content-type"),Xt=_.FormData&&L instanceof _.FormData,!(0<=Array.prototype.indexOf.call(Ja,se,void 0))||He||Xt||ve.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[fn,ar]of ve)this.g.setRequestHeader(fn,ar);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Ai(this),this.u=!0,this.g.send(L),this.u=!1}catch(fn){cl(this,fn)}};function cl(L,se){L.h=!1,L.g&&(L.j=!0,L.g.abort(),L.j=!1),L.l=se,L.m=5,tu(L),Vs(L)}function tu(L){L.A||(L.A=!0,Mr(L,"complete"),Mr(L,"error"))}n.abort=function(L){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=L||7,Mr(this,"complete"),Mr(this,"abort"),Vs(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Vs(this,!0)),Xo.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?wc(this):this.bb())},n.bb=function(){wc(this)};function wc(L){if(L.h&&typeof m<"u"&&(!L.v[1]||Ss(L)!=4||L.Z()!=2)){if(L.u&&Ss(L)==4)Sr(L.Ea,0,L);else if(Mr(L,"readystatechange"),Ss(L)==4){L.h=!1;try{const ar=L.Z();e:switch(ar){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var se=!0;break e;default:se=!1}var ve;if(!(ve=se)){var He;if(He=ar===0){var Xt=String(L.D).match(ks)[1]||null;!Xt&&_.self&&_.self.location&&(Xt=_.self.location.protocol.slice(0,-1)),He=!pa.test(Xt?Xt.toLowerCase():"")}ve=He}if(ve)Mr(L,"complete"),Mr(L,"success");else{L.m=6;try{var fn=2<Ss(L)?L.g.statusText:""}catch{fn=""}L.l=fn+" ["+L.Z()+"]",tu(L)}}finally{Vs(L)}}}}function Vs(L,se){if(L.g){Ai(L);const ve=L.g,He=L.v[0]?()=>{}:null;L.g=null,L.v=null,se||Mr(L,"ready");try{ve.onreadystatechange=He}catch{}}}function Ai(L){L.I&&(_.clearTimeout(L.I),L.I=null)}n.isActive=function(){return!!this.g};function Ss(L){return L.g?L.g.readyState:0}n.Z=function(){try{return 2<Ss(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(L){if(this.g){var se=this.g.responseText;return L&&se.indexOf(L)==0&&(se=se.substring(L.length)),qr(se)}};function qs(L){try{if(!L.g)return null;if("response"in L.g)return L.g.response;switch(L.H){case"":case"text":return L.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in L.g)return L.g.mozResponseArrayBuffer}return null}catch{return null}}function ia(L){const se={};L=(L.g&&2<=Ss(L)&&L.g.getAllResponseHeaders()||"").split(`\r
`);for(let He=0;He<L.length;He++){if(ne(L[He]))continue;var ve=j(L[He]);const Xt=ve[0];if(ve=ve[1],typeof ve!="string")continue;ve=ve.trim();const fn=se[Xt]||[];se[Xt]=fn,fn.push(ve)}pe(se,function(He){return He.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function oa(L,se,ve){return ve&&ve.internalChannelParams&&ve.internalChannelParams[L]||se}function ul(L){this.Aa=0,this.i=[],this.j=new Lr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=oa("failFast",!1,L),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=oa("baseRetryDelayMs",5e3,L),this.cb=oa("retryDelaySeedMs",1e4,L),this.Wa=oa("forwardChannelMaxRetries",2,L),this.wa=oa("forwardChannelRequestTimeoutMs",2e4,L),this.pa=L&&L.xmlHttpFactory||void 0,this.Xa=L&&L.Tb||void 0,this.Ca=L&&L.useFetchStreams||!1,this.L=void 0,this.J=L&&L.supportsCrossDomainXhr||!1,this.K="",this.h=new Aa(L&&L.concurrentRequestLimit),this.Da=new js,this.P=L&&L.fastHandshake||!1,this.O=L&&L.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=L&&L.Rb||!1,L&&L.xa&&this.j.xa(),L&&L.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&L&&L.detectBufferingProxy||!1,this.ja=void 0,L&&L.longPollingTimeout&&0<L.longPollingTimeout&&(this.ja=L.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=ul.prototype,n.la=8,n.G=1,n.connect=function(L,se,ve,He){xn(0),this.W=L,this.H=se||{},ve&&He!==void 0&&(this.H.OSID=ve,this.H.OAID=He),this.F=this.X,this.I=Mo(this,null,this.W),W(this)};function $s(L){if(Sc(L),L.G==3){var se=L.U++,ve=Rr(L.I);if(Mi(ve,"SID",L.K),Mi(ve,"RID",se),Mi(ve,"TYPE","terminate"),yt(L,ve),se=new ro(L,L.j,se),se.L=2,se.v=El(Rr(ve)),ve=!1,_.navigator&&_.navigator.sendBeacon)try{ve=_.navigator.sendBeacon(se.v.toString(),"")}catch{}!ve&&_.Image&&(new Image().src=se.v,ve=!0),ve||(se.g=Vo(se.j,null),se.g.ea(se.v)),se.F=Date.now(),So(se)}Qo(L)}function Gs(L){L.g&&(Nr(L),L.g.cancel(),L.g=null)}function Sc(L){Gs(L),L.u&&(_.clearTimeout(L.u),L.u=null),yi(L),L.h.cancel(),L.s&&(typeof L.s=="number"&&_.clearTimeout(L.s),L.s=null)}function W(L){if(!ra(L.h)&&!L.s){L.s=!0;var se=L.Ga;Re||nt(),we||(Re(),we=!0),De.add(se,L),L.B=0}}function Ce(L,se){return pn(L.h)>=L.h.j-(L.s?1:0)?!1:L.s?(L.i=se.D.concat(L.i),!0):L.G==1||L.G==2||L.B>=(L.Va?0:L.Wa)?!1:(L.s=An(V(L.Ga,L,se),yo(L,L.B)),L.B++,!0)}n.Ga=function(L){if(this.s)if(this.s=null,this.G==1){if(!L){this.U=Math.floor(1e5*Math.random()),L=this.U++;const Xt=new ro(this,this.j,L);let fn=this.o;if(this.S&&(fn?(fn=U(fn),q(fn,this.S)):fn=this.S),this.m!==null||this.O||(Xt.H=fn,fn=null),this.P)e:{for(var se=0,ve=0;ve<this.i.length;ve++){t:{var He=this.i[ve];if("__data__"in He.map&&(He=He.map.__data__,typeof He=="string")){He=He.length;break t}He=void 0}if(He===void 0)break;if(se+=He,4096<se){se=ve;break e}if(se===4096||ve===this.i.length-1){se=ve+1;break e}}se=1e3}else se=1e3;se=qt(this,Xt,se),ve=Rr(this.I),Mi(ve,"RID",L),Mi(ve,"CVER",22),this.D&&Mi(ve,"X-HTTP-Session-Id",this.D),yt(this,ve),fn&&(this.O?se="headers="+encodeURIComponent(String(Uo(fn)))+"&"+se:this.m&&zc(ve,this.m,fn)),ss(this.h,Xt),this.Ua&&Mi(ve,"TYPE","init"),this.P?(Mi(ve,"$req",se),Mi(ve,"SID","null"),Xt.T=!0,al(Xt,ve,null)):al(Xt,ve,se),this.G=2}}else this.G==3&&(L?pt(this,L):this.i.length==0||ra(this.h)||pt(this))};function pt(L,se){var ve;se?ve=se.l:ve=L.U++;const He=Rr(L.I);Mi(He,"SID",L.K),Mi(He,"RID",ve),Mi(He,"AID",L.T),yt(L,He),L.m&&L.o&&zc(He,L.m,L.o),ve=new ro(L,L.j,ve,L.B+1),L.m===null&&(ve.H=L.o),se&&(L.i=se.D.concat(L.i)),se=qt(L,ve,1e3),ve.I=Math.round(.5*L.wa)+Math.round(.5*L.wa*Math.random()),ss(L.h,ve),al(ve,He,se)}function yt(L,se){L.H&&ze(L.H,function(ve,He){Mi(se,He,ve)}),L.l&&ll({},function(ve,He){Mi(se,He,ve)})}function qt(L,se,ve){ve=Math.min(L.i.length,ve);var He=L.l?V(L.l.Na,L.l,L):null;e:{var Xt=L.i;let fn=-1;for(;;){const ar=["count="+ve];fn==-1?0<ve?(fn=Xt[0].g,ar.push("ofs="+fn)):fn=0:ar.push("ofs="+fn);let ao=!0;for(let Fo=0;Fo<ve;Fo++){let qi=Xt[Fo].g;const Di=Xt[Fo].map;if(qi-=fn,0>qi)fn=Math.max(0,Xt[Fo].g-100),ao=!1;else try{Mu(Di,ar,"req"+qi+"_")}catch{He&&He(Di)}}if(ao){He=ar.join("&");break e}}}return L=L.i.splice(0,ve),se.D=L,He}function Qt(L){if(!L.g&&!L.u){L.Y=1;var se=L.Fa;Re||nt(),we||(Re(),we=!0),De.add(se,L),L.v=0}}function Fn(L){return L.g||L.u||3<=L.v?!1:(L.Y++,L.u=An(V(L.Fa,L),yo(L,L.v)),L.v++,!0)}n.Fa=function(){if(this.u=null,$r(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var L=2*this.R;this.j.info("BP detection timer enabled: "+L),this.A=An(V(this.ab,this),L)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,xn(10),Gs(this),$r(this))};function Nr(L){L.A!=null&&(_.clearTimeout(L.A),L.A=null)}function $r(L){L.g=new ro(L,L.j,"rpc",L.Y),L.m===null&&(L.g.H=L.o),L.g.O=0;var se=Rr(L.qa);Mi(se,"RID","rpc"),Mi(se,"SID",L.K),Mi(se,"AID",L.T),Mi(se,"CI",L.F?"0":"1"),!L.F&&L.ja&&Mi(se,"TO",L.ja),Mi(se,"TYPE","xmlhttp"),yt(L,se),L.m&&L.o&&zc(se,L.m,L.o),L.L&&(L.g.I=L.L);var ve=L.g;L=L.ia,ve.L=1,ve.v=El(Rr(se)),ve.m=null,ve.P=!0,Vi(ve,L)}n.Za=function(){this.C!=null&&(this.C=null,Gs(this),Fn(this),xn(19))};function yi(L){L.C!=null&&(_.clearTimeout(L.C),L.C=null)}function Ti(L,se){var ve=null;if(L.g==se){yi(L),Nr(L),L.g=null;var He=2}else if(Yo(L.h,se))ve=se.D,vi(L.h,se),He=1;else return;if(L.G!=0){if(se.o)if(He==1){ve=se.m?se.m.length:0,se=Date.now()-se.F;var Xt=L.B;He=Rt(),Mr(He,new On(He,ve)),W(L)}else Qt(L);else if(Xt=se.s,Xt==3||Xt==0&&0<se.X||!(He==1&&Ce(L,se)||He==2&&Fn(L)))switch(ve&&0<ve.length&&(se=L.h,se.i=se.i.concat(ve)),Xt){case 1:_o(L,5);break;case 4:_o(L,10);break;case 3:_o(L,6);break;default:_o(L,2)}}}function yo(L,se){let ve=L.Ta+Math.floor(Math.random()*L.cb);return L.isActive()||(ve*=2),ve*se}function _o(L,se){if(L.j.info("Error code "+se),se==2){var ve=V(L.fb,L),He=L.Xa;const Xt=!He;He=new Fr(He||"//www.google.com/images/cleardot.gif"),_.location&&_.location.protocol=="http"||zs(He,"https"),El(He),Xt?xh(He.toString(),ve):ku(He.toString(),ve)}else xn(2);L.G=0,L.l&&L.l.sa(se),Qo(L),Sc(L)}n.fb=function(L){L?(this.j.info("Successfully pinged google.com"),xn(2)):(this.j.info("Failed to ping google.com"),xn(1))};function Qo(L){if(L.G=0,L.ka=[],L.l){const se=gu(L.h);(se.length!=0||L.i.length!=0)&&(fe(L.ka,se),fe(L.ka,L.i),L.h.i.length=0,ae(L.i),L.i.length=0),L.l.ra()}}function Mo(L,se,ve){var He=ve instanceof Fr?Rr(ve):new Fr(ve);if(He.g!="")se&&(He.g=se+"."+He.g),Ta(He,He.s);else{var Xt=_.location;He=Xt.protocol,se=se?se+"."+Xt.hostname:Xt.hostname,Xt=+Xt.port;var fn=new Fr(null);He&&zs(fn,He),se&&(fn.g=se),Xt&&Ta(fn,Xt),ve&&(fn.l=ve),He=fn}return ve=L.D,se=L.ya,ve&&se&&Mi(He,ve,se),Mi(He,"VER",L.la),yt(L,He),He}function Vo(L,se,ve){if(se&&!L.J)throw Error("Can't create secondary domain capable XhrIo object.");return se=L.Ca&&!L.pa?new Xo(new Ko({eb:ve})):new Xo(L.pa),se.Ha(L.J),se}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function es(){}n=es.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function cs(){}cs.prototype.g=function(L,se){return new qo(L,se)};function qo(L,se){Dn.call(this),this.g=new ul(se),this.l=L,this.h=se&&se.messageUrlParams||null,L=se&&se.messageHeaders||null,se&&se.clientProtocolHeaderRequired&&(L?L["X-Client-Protocol"]="webchannel":L={"X-Client-Protocol":"webchannel"}),this.g.o=L,L=se&&se.initMessageHeaders||null,se&&se.messageContentType&&(L?L["X-WebChannel-Content-Type"]=se.messageContentType:L={"X-WebChannel-Content-Type":se.messageContentType}),se&&se.va&&(L?L["X-WebChannel-Client-Profile"]=se.va:L={"X-WebChannel-Client-Profile":se.va}),this.g.S=L,(L=se&&se.Sb)&&!ne(L)&&(this.g.m=L),this.v=se&&se.supportsCrossDomainXhr||!1,this.u=se&&se.sendRawJson||!1,(se=se&&se.httpSessionIdParam)&&!ne(se)&&(this.g.D=se,L=this.h,L!==null&&se in L&&(L=this.h,se in L&&delete L[se])),this.j=new Qa(this)}ie(qo,Dn),qo.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},qo.prototype.close=function(){$s(this.g)},qo.prototype.o=function(L){var se=this.g;if(typeof L=="string"){var ve={};ve.__data__=L,L=ve}else this.u&&(ve={},ve.__data__=ai(L),L=ve);se.i.push(new ec(se.Ya++,L)),se.G==3&&W(se)},qo.prototype.N=function(){this.g.l=null,delete this.j,$s(this.g),delete this.g,qo.aa.N.call(this)};function Es(L){Te.call(this),L.__headers__&&(this.headers=L.__headers__,this.statusCode=L.__status__,delete L.__headers__,delete L.__status__);var se=L.__sm__;if(se){e:{for(const ve in se){L=ve;break e}L=void 0}(this.i=L)&&(L=this.i,se=se!==null&&L in se?se[L]:void 0),this.data=se}else this.data=L}ie(Es,Te);function jc(){et.call(this),this.status=1}ie(jc,et);function Qa(L){this.g=L}ie(Qa,es),Qa.prototype.ua=function(){Mr(this.g,"a")},Qa.prototype.ta=function(L){Mr(this.g,new Es(L))},Qa.prototype.sa=function(L){Mr(this.g,new jc)},Qa.prototype.ra=function(){Mr(this.g,"b")},cs.prototype.createWebChannel=cs.prototype.g,qo.prototype.send=qo.prototype.o,qo.prototype.open=qo.prototype.m,qo.prototype.close=qo.prototype.close,c9=function(){return new cs},l9=function(){return Rt()},a9=ht,L5={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},po.NO_ERROR=0,po.TIMEOUT=8,po.HTTP_ERROR=6,$1=po,Wo.COMPLETE="complete",s9=Wo,lt.EventType=Ee,Ee.OPEN="a",Ee.CLOSE="b",Ee.ERROR="c",Ee.MESSAGE="d",Dn.prototype.listen=Dn.prototype.K,Py=lt,Xo.prototype.listenOnce=Xo.prototype.L,Xo.prototype.getLastError=Xo.prototype.Ka,Xo.prototype.getLastErrorCode=Xo.prototype.Ba,Xo.prototype.getStatus=Xo.prototype.Z,Xo.prototype.getResponseJson=Xo.prototype.Oa,Xo.prototype.getResponseText=Xo.prototype.oa,Xo.prototype.send=Xo.prototype.ea,Xo.prototype.setWithCredentials=Xo.prototype.Ha,o9=Xo}).apply(typeof v1<"u"?v1:typeof self<"u"?self:typeof window<"u"?window:{});const eE="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yh{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}yh.UNAUTHENTICATED=new yh(null),yh.GOOGLE_CREDENTIALS=new yh("google-credentials-uid"),yh.FIRST_PARTY=new yh("first-party-uid"),yh.MOCK_USER=new yh("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let F0="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ig=new bw("@firebase/firestore");function Ey(){return ig.logLevel}function _i(n,...e){if(ig.logLevel<=ys.DEBUG){const t=e.map(Ew);ig.debug(`Firestore (${F0}): ${n}`,...t)}}function Tp(n,...e){if(ig.logLevel<=ys.ERROR){const t=e.map(Ew);ig.error(`Firestore (${F0}): ${n}`,...t)}}function b0(n,...e){if(ig.logLevel<=ys.WARN){const t=e.map(Ew);ig.warn(`Firestore (${F0}): ${n}`,...t)}}function Ew(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(t){return JSON.stringify(t)})(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fo(n="Unexpected state"){const e=`FIRESTORE (${F0}) INTERNAL ASSERTION FAILED: `+n;throw Tp(e),new Error(e)}function Sa(n,e){n||fo()}function Co(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yn={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ui extends Pp{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bp{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u9{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class qN{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(yh.UNAUTHENTICATED)))}shutdown(){}}class $N{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class GN{constructor(e){this.t=e,this.currentUser=yh.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Sa(this.o===void 0);let i=this.i;const c=o=>this.i!==i?(i=this.i,t(o)):Promise.resolve();let u=new bp;this.o=()=>{this.i++,this.currentUser=this.u(),u.resolve(),u=new bp,e.enqueueRetryable((()=>c(this.currentUser)))};const m=()=>{const o=u;e.enqueueRetryable((async()=>{await o.promise,await c(this.currentUser)}))},_=o=>{_i("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=o,this.o&&(this.auth.addAuthTokenListener(this.o),m())};this.t.onInit((o=>_(o))),setTimeout((()=>{if(!this.auth){const o=this.t.getImmediate({optional:!0});o?_(o):(_i("FirebaseAuthCredentialsProvider","Auth not yet detected"),u.resolve(),u=new bp)}}),0),m()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((i=>this.i!==e?(_i("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(Sa(typeof i.accessToken=="string"),new u9(i.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Sa(e===null||typeof e=="string"),new yh(e)}}class HN{constructor(e,t,i){this.l=e,this.h=t,this.P=i,this.type="FirstParty",this.user=yh.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class WN{constructor(e,t,i){this.l=e,this.h=t,this.P=i}getToken(){return Promise.resolve(new HN(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable((()=>t(yh.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class KN{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class XN{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){Sa(this.o===void 0);const i=u=>{u.error!=null&&_i("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${u.error.message}`);const m=u.token!==this.R;return this.R=u.token,_i("FirebaseAppCheckTokenProvider",`Received ${m?"new":"existing"} token.`),m?t(u.token):Promise.resolve()};this.o=u=>{e.enqueueRetryable((()=>i(u)))};const c=u=>{_i("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=u,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit((u=>c(u))),setTimeout((()=>{if(!this.appCheck){const u=this.A.getImmediate({optional:!0});u?c(u):_i("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(Sa(typeof t.token=="string"),this.R=t.token,new KN(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZN(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let i=0;i<n;i++)t[i]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h9{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let i="";for(;i.length<20;){const c=ZN(40);for(let u=0;u<c.length;++u)i.length<20&&c[u]<t&&(i+=e.charAt(c[u]%e.length))}return i}}function Bs(n,e){return n<e?-1:n>e?1:0}function w0(n,e,t){return n.length===e.length&&n.every(((i,c)=>t(i,e[c])))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pu{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new ui(Yn.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new ui(Yn.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new ui(Yn.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ui(Yn.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return pu.fromMillis(Date.now())}static fromDate(e){return pu.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),i=Math.floor(1e6*(e-1e3*t));return new pu(t,i)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Bs(this.nanoseconds,e.nanoseconds):Bs(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Io{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Io(e)}static min(){return new Io(new pu(0,0))}static max(){return new Io(new pu(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s_{constructor(e,t,i){t===void 0?t=0:t>e.length&&fo(),i===void 0?i=e.length-t:i>e.length-t&&fo(),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return s_.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof s_?e.forEach((i=>{t.push(i)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const i=Math.min(e.length,t.length);for(let c=0;c<i;c++){const u=e.get(c),m=t.get(c);if(u<m)return-1;if(u>m)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class bl extends s_{construct(e,t,i){return new bl(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const i of e){if(i.indexOf("//")>=0)throw new ui(Yn.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter((c=>c.length>0)))}return new bl(t)}static emptyPath(){return new bl([])}}const YN=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Xu extends s_{construct(e,t,i){return new Xu(e,t,i)}static isValidIdentifier(e){return YN.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Xu.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Xu(["__name__"])}static fromServerFormat(e){const t=[];let i="",c=0;const u=()=>{if(i.length===0)throw new ui(Yn.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""};let m=!1;for(;c<e.length;){const _=e[c];if(_==="\\"){if(c+1===e.length)throw new ui(Yn.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const o=e[c+1];if(o!=="\\"&&o!=="."&&o!=="`")throw new ui(Yn.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=o,c+=2}else _==="`"?(m=!m,c++):_!=="."||m?(i+=_,c++):(u(),c++)}if(u(),m)throw new ui(Yn.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Xu(t)}static emptyPath(){return new Xu([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zi{constructor(e){this.path=e}static fromPath(e){return new zi(bl.fromString(e))}static fromName(e){return new zi(bl.fromString(e).popFirst(5))}static empty(){return new zi(bl.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&bl.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return bl.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new zi(new bl(e.slice()))}}function JN(n,e){const t=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,c=Io.fromTimestamp(i===1e9?new pu(t+1,0):new pu(t,i));return new gm(c,zi.empty(),e)}function QN(n){return new gm(n.readTime,n.key,-1)}class gm{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new gm(Io.min(),zi.empty(),-1)}static max(){return new gm(Io.max(),zi.empty(),-1)}}function eD(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=zi.comparator(n.documentKey,e.documentKey),t!==0?t:Bs(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tD="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class nD{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function S_(n){if(n.code!==Yn.FAILED_PRECONDITION||n.message!==tD)throw n;_i("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ur{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&fo(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new ur(((i,c)=>{this.nextCallback=u=>{this.wrapSuccess(e,u).next(i,c)},this.catchCallback=u=>{this.wrapFailure(t,u).next(i,c)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof ur?t:ur.resolve(t)}catch(t){return ur.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):ur.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):ur.reject(t)}static resolve(e){return new ur(((t,i)=>{t(e)}))}static reject(e){return new ur(((t,i)=>{i(e)}))}static waitFor(e){return new ur(((t,i)=>{let c=0,u=0,m=!1;e.forEach((_=>{++c,_.next((()=>{++u,m&&u===c&&t()}),(o=>i(o)))})),m=!0,u===c&&t()}))}static or(e){let t=ur.resolve(!1);for(const i of e)t=t.next((c=>c?ur.resolve(c):i()));return t}static forEach(e,t){const i=[];return e.forEach(((c,u)=>{i.push(t.call(this,c,u))})),this.waitFor(i)}static mapArray(e,t){return new ur(((i,c)=>{const u=e.length,m=new Array(u);let _=0;for(let o=0;o<u;o++){const w=o;t(e[w]).next((I=>{m[w]=I,++_,_===u&&i(m)}),(I=>c(I)))}}))}static doWhile(e,t){return new ur(((i,c)=>{const u=()=>{e()===!0?t().next((()=>{u()}),c):i()};u()}))}}function rD(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function E_(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aw{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=i=>this.ie(i),this.se=i=>t.writeSequenceNumber(i))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}Aw.oe=-1;function Qv(n){return n==null}function _v(n){return n===0&&1/n==-1/0}function iD(n){return typeof n=="number"&&Number.isInteger(n)&&!_v(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tE(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function O0(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function d9(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jl{constructor(e,t){this.comparator=e,this.root=t||Ku.EMPTY}insert(e,t){return new Jl(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ku.BLACK,null,null))}remove(e){return new Jl(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ku.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const i=this.comparator(e,t.key);if(i===0)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){const c=this.comparator(e,i.key);if(c===0)return t+i.left.size;c<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,i)=>(e(t,i),!1)))}toString(){const e=[];return this.inorderTraversal(((t,i)=>(e.push(`${t}:${i}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new x1(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new x1(this.root,e,this.comparator,!1)}getReverseIterator(){return new x1(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new x1(this.root,e,this.comparator,!0)}}class x1{constructor(e,t,i,c){this.isReverse=c,this.nodeStack=[];let u=1;for(;!e.isEmpty();)if(u=t?i(e.key,t):1,t&&c&&(u*=-1),u<0)e=this.isReverse?e.left:e.right;else{if(u===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ku{constructor(e,t,i,c,u){this.key=e,this.value=t,this.color=i??Ku.RED,this.left=c??Ku.EMPTY,this.right=u??Ku.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,i,c,u){return new Ku(e??this.key,t??this.value,i??this.color,c??this.left,u??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let c=this;const u=i(e,c.key);return c=u<0?c.copy(null,null,null,c.left.insert(e,t,i),null):u===0?c.copy(null,t,null,null,null):c.copy(null,null,null,null,c.right.insert(e,t,i)),c.fixUp()}removeMin(){if(this.left.isEmpty())return Ku.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let i,c=this;if(t(e,c.key)<0)c.left.isEmpty()||c.left.isRed()||c.left.left.isRed()||(c=c.moveRedLeft()),c=c.copy(null,null,null,c.left.remove(e,t),null);else{if(c.left.isRed()&&(c=c.rotateRight()),c.right.isEmpty()||c.right.isRed()||c.right.left.isRed()||(c=c.moveRedRight()),t(e,c.key)===0){if(c.right.isEmpty())return Ku.EMPTY;i=c.right.min(),c=c.copy(i.key,i.value,null,null,c.right.removeMin())}c=c.copy(null,null,null,null,c.right.remove(e,t))}return c.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ku.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ku.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw fo();const e=this.left.check();if(e!==this.right.check())throw fo();return e+(this.isRed()?0:1)}}Ku.EMPTY=null,Ku.RED=!0,Ku.BLACK=!1;Ku.EMPTY=new class{constructor(){this.size=0}get key(){throw fo()}get value(){throw fo()}get color(){throw fo()}get left(){throw fo()}get right(){throw fo()}copy(e,t,i,c,u){return this}insert(e,t,i){return new Ku(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zu{constructor(e){this.comparator=e,this.data=new Jl(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,i)=>(e(t),!1)))}forEachInRange(e,t){const i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){const c=i.getNext();if(this.comparator(c.key,e[1])>=0)return;t(c.key)}}forEachWhile(e,t){let i;for(i=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new nE(this.data.getIterator())}getIteratorFrom(e){return new nE(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((i=>{t=t.add(i)})),t}isEqual(e){if(!(e instanceof Zu)||this.size!==e.size)return!1;const t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){const c=t.getNext().key,u=i.getNext().key;if(this.comparator(c,u)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Zu(this.comparator);return t.data=e,t}}class nE{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ef{constructor(e){this.fields=e,e.sort(Xu.comparator)}static empty(){return new ef([])}unionWith(e){let t=new Zu(Xu.comparator);for(const i of this.fields)t=t.add(i);for(const i of e)t=t.add(i);return new ef(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return w0(this.fields,e.fields,((t,i)=>t.isEqual(i)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f9 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yu{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(c){try{return atob(c)}catch(u){throw typeof DOMException<"u"&&u instanceof DOMException?new f9("Invalid base64 string: "+u):u}})(e);return new Yu(t)}static fromUint8Array(e){const t=(function(c){let u="";for(let m=0;m<c.length;++m)u+=String.fromCharCode(c[m]);return u})(e);return new Yu(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const i=new Uint8Array(t.length);for(let c=0;c<t.length;c++)i[c]=t.charCodeAt(c);return i})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Bs(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Yu.EMPTY_BYTE_STRING=new Yu("");const oD=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ym(n){if(Sa(!!n),typeof n=="string"){let e=0;const t=oD.exec(n);if(Sa(!!t),t[1]){let c=t[1];c=(c+"000000000").substr(0,9),e=Number(c)}const i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Dc(n.seconds),nanos:Dc(n.nanos)}}function Dc(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function og(n){return typeof n=="string"?Yu.fromBase64String(n):Yu.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tw(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function Iw(n){const e=n.mapValue.fields.__previous_value__;return Tw(e)?Iw(e):e}function a_(n){const e=ym(n.mapValue.fields.__local_write_time__.timestampValue);return new pu(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sD{constructor(e,t,i,c,u,m,_,o,w){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=c,this.ssl=u,this.forceLongPolling=m,this.autoDetectLongPolling=_,this.longPollingOptions=o,this.useFetchStreams=w}}class l_{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new l_("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof l_&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b1={mapValue:{}};function sg(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Tw(n)?4:lD(n)?9007199254740991:aD(n)?10:11:fo()}function Gf(n,e){if(n===e)return!0;const t=sg(n);if(t!==sg(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return a_(n).isEqual(a_(e));case 3:return(function(c,u){if(typeof c.timestampValue=="string"&&typeof u.timestampValue=="string"&&c.timestampValue.length===u.timestampValue.length)return c.timestampValue===u.timestampValue;const m=ym(c.timestampValue),_=ym(u.timestampValue);return m.seconds===_.seconds&&m.nanos===_.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(c,u){return og(c.bytesValue).isEqual(og(u.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(c,u){return Dc(c.geoPointValue.latitude)===Dc(u.geoPointValue.latitude)&&Dc(c.geoPointValue.longitude)===Dc(u.geoPointValue.longitude)})(n,e);case 2:return(function(c,u){if("integerValue"in c&&"integerValue"in u)return Dc(c.integerValue)===Dc(u.integerValue);if("doubleValue"in c&&"doubleValue"in u){const m=Dc(c.doubleValue),_=Dc(u.doubleValue);return m===_?_v(m)===_v(_):isNaN(m)&&isNaN(_)}return!1})(n,e);case 9:return w0(n.arrayValue.values||[],e.arrayValue.values||[],Gf);case 10:case 11:return(function(c,u){const m=c.mapValue.fields||{},_=u.mapValue.fields||{};if(tE(m)!==tE(_))return!1;for(const o in m)if(m.hasOwnProperty(o)&&(_[o]===void 0||!Gf(m[o],_[o])))return!1;return!0})(n,e);default:return fo()}}function c_(n,e){return(n.values||[]).find((t=>Gf(t,e)))!==void 0}function S0(n,e){if(n===e)return 0;const t=sg(n),i=sg(e);if(t!==i)return Bs(t,i);switch(t){case 0:case 9007199254740991:return 0;case 1:return Bs(n.booleanValue,e.booleanValue);case 2:return(function(u,m){const _=Dc(u.integerValue||u.doubleValue),o=Dc(m.integerValue||m.doubleValue);return _<o?-1:_>o?1:_===o?0:isNaN(_)?isNaN(o)?0:-1:1})(n,e);case 3:return rE(n.timestampValue,e.timestampValue);case 4:return rE(a_(n),a_(e));case 5:return Bs(n.stringValue,e.stringValue);case 6:return(function(u,m){const _=og(u),o=og(m);return _.compareTo(o)})(n.bytesValue,e.bytesValue);case 7:return(function(u,m){const _=u.split("/"),o=m.split("/");for(let w=0;w<_.length&&w<o.length;w++){const I=Bs(_[w],o[w]);if(I!==0)return I}return Bs(_.length,o.length)})(n.referenceValue,e.referenceValue);case 8:return(function(u,m){const _=Bs(Dc(u.latitude),Dc(m.latitude));return _!==0?_:Bs(Dc(u.longitude),Dc(m.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return iE(n.arrayValue,e.arrayValue);case 10:return(function(u,m){var _,o,w,I;const R=u.fields||{},V=m.fields||{},k=(_=R.value)===null||_===void 0?void 0:_.arrayValue,ie=(o=V.value)===null||o===void 0?void 0:o.arrayValue,ae=Bs(((w=k?.values)===null||w===void 0?void 0:w.length)||0,((I=ie?.values)===null||I===void 0?void 0:I.length)||0);return ae!==0?ae:iE(k,ie)})(n.mapValue,e.mapValue);case 11:return(function(u,m){if(u===b1.mapValue&&m===b1.mapValue)return 0;if(u===b1.mapValue)return 1;if(m===b1.mapValue)return-1;const _=u.fields||{},o=Object.keys(_),w=m.fields||{},I=Object.keys(w);o.sort(),I.sort();for(let R=0;R<o.length&&R<I.length;++R){const V=Bs(o[R],I[R]);if(V!==0)return V;const k=S0(_[o[R]],w[I[R]]);if(k!==0)return k}return Bs(o.length,I.length)})(n.mapValue,e.mapValue);default:throw fo()}}function rE(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Bs(n,e);const t=ym(n),i=ym(e),c=Bs(t.seconds,i.seconds);return c!==0?c:Bs(t.nanos,i.nanos)}function iE(n,e){const t=n.values||[],i=e.values||[];for(let c=0;c<t.length&&c<i.length;++c){const u=S0(t[c],i[c]);if(u)return u}return Bs(t.length,i.length)}function E0(n){return P5(n)}function P5(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const i=ym(t);return`time(${i.seconds},${i.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return og(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return zi.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let i="[",c=!0;for(const u of t.values||[])c?c=!1:i+=",",i+=P5(u);return i+"]"})(n.arrayValue):"mapValue"in n?(function(t){const i=Object.keys(t.fields||{}).sort();let c="{",u=!0;for(const m of i)u?u=!1:c+=",",c+=`${m}:${P5(t.fields[m])}`;return c+"}"})(n.mapValue):fo()}function oE(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function k5(n){return!!n&&"integerValue"in n}function Cw(n){return!!n&&"arrayValue"in n}function sE(n){return!!n&&"nullValue"in n}function aE(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function G1(n){return!!n&&"mapValue"in n}function aD(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function qy(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return O0(n.mapValue.fields,((t,i)=>e.mapValue.fields[t]=qy(i))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=qy(n.arrayValue.values[t]);return e}return Object.assign({},n)}function lD(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nd{constructor(e){this.value=e}static empty(){return new Nd({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!G1(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=qy(t)}setAll(e){let t=Xu.emptyPath(),i={},c=[];e.forEach(((m,_)=>{if(!t.isImmediateParentOf(_)){const o=this.getFieldsMap(t);this.applyChanges(o,i,c),i={},c=[],t=_.popLast()}m?i[_.lastSegment()]=qy(m):c.push(_.lastSegment())}));const u=this.getFieldsMap(t);this.applyChanges(u,i,c)}delete(e){const t=this.field(e.popLast());G1(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Gf(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let c=t.mapValue.fields[e.get(i)];G1(c)&&c.mapValue.fields||(c={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=c),t=c}return t.mapValue.fields}applyChanges(e,t,i){O0(t,((c,u)=>e[c]=u));for(const c of i)delete e[c]}clone(){return new Nd(qy(this.value))}}function p9(n){const e=[];return O0(n.fields,((t,i)=>{const c=new Xu([t]);if(G1(i)){const u=p9(i.mapValue).fields;if(u.length===0)e.push(c);else for(const m of u)e.push(c.child(m))}else e.push(c)})),new ef(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _h{constructor(e,t,i,c,u,m,_){this.key=e,this.documentType=t,this.version=i,this.readTime=c,this.createTime=u,this.data=m,this.documentState=_}static newInvalidDocument(e){return new _h(e,0,Io.min(),Io.min(),Io.min(),Nd.empty(),0)}static newFoundDocument(e,t,i,c){return new _h(e,1,t,Io.min(),i,c,0)}static newNoDocument(e,t){return new _h(e,2,t,Io.min(),Io.min(),Nd.empty(),0)}static newUnknownDocument(e,t){return new _h(e,3,t,Io.min(),Io.min(),Nd.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Io.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Nd.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Nd.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Io.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof _h&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new _h(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vv{constructor(e,t){this.position=e,this.inclusive=t}}function lE(n,e,t){let i=0;for(let c=0;c<n.position.length;c++){const u=e[c],m=n.position[c];if(u.field.isKeyField()?i=zi.comparator(zi.fromName(m.referenceValue),t.key):i=S0(m,t.data.field(u.field)),u.dir==="desc"&&(i*=-1),i!==0)break}return i}function cE(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Gf(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xv{constructor(e,t="asc"){this.field=e,this.dir=t}}function cD(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m9{}class Jc extends m9{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,i):new hD(e,t,i):t==="array-contains"?new pD(e,i):t==="in"?new mD(e,i):t==="not-in"?new gD(e,i):t==="array-contains-any"?new yD(e,i):new Jc(e,t,i)}static createKeyFieldInFilter(e,t,i){return t==="in"?new dD(e,i):new fD(e,i)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(S0(t,this.value)):t!==null&&sg(this.value)===sg(t)&&this.matchesComparison(S0(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return fo()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class of extends m9{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new of(e,t)}matches(e){return g9(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function g9(n){return n.op==="and"}function y9(n){return uD(n)&&g9(n)}function uD(n){for(const e of n.filters)if(e instanceof of)return!1;return!0}function M5(n){if(n instanceof Jc)return n.field.canonicalString()+n.op.toString()+E0(n.value);if(y9(n))return n.filters.map((e=>M5(e))).join(",");{const e=n.filters.map((t=>M5(t))).join(",");return`${n.op}(${e})`}}function _9(n,e){return n instanceof Jc?(function(i,c){return c instanceof Jc&&i.op===c.op&&i.field.isEqual(c.field)&&Gf(i.value,c.value)})(n,e):n instanceof of?(function(i,c){return c instanceof of&&i.op===c.op&&i.filters.length===c.filters.length?i.filters.reduce(((u,m,_)=>u&&_9(m,c.filters[_])),!0):!1})(n,e):void fo()}function v9(n){return n instanceof Jc?(function(t){return`${t.field.canonicalString()} ${t.op} ${E0(t.value)}`})(n):n instanceof of?(function(t){return t.op.toString()+" {"+t.getFilters().map(v9).join(" ,")+"}"})(n):"Filter"}class hD extends Jc{constructor(e,t,i){super(e,t,i),this.key=zi.fromName(i.referenceValue)}matches(e){const t=zi.comparator(e.key,this.key);return this.matchesComparison(t)}}class dD extends Jc{constructor(e,t){super(e,"in",t),this.keys=x9("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class fD extends Jc{constructor(e,t){super(e,"not-in",t),this.keys=x9("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function x9(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map((i=>zi.fromName(i.referenceValue)))}class pD extends Jc{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Cw(t)&&c_(t.arrayValue,this.value)}}class mD extends Jc{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&c_(this.value.arrayValue,t)}}class gD extends Jc{constructor(e,t){super(e,"not-in",t)}matches(e){if(c_(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!c_(this.value.arrayValue,t)}}class yD extends Jc{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Cw(t)||!t.arrayValue.values)&&t.arrayValue.values.some((i=>c_(this.value.arrayValue,i)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _D{constructor(e,t=null,i=[],c=[],u=null,m=null,_=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=c,this.limit=u,this.startAt=m,this.endAt=_,this.ue=null}}function uE(n,e=null,t=[],i=[],c=null,u=null,m=null){return new _D(n,e,t,i,c,u,m)}function Lw(n){const e=Co(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((i=>M5(i))).join(","),t+="|ob:",t+=e.orderBy.map((i=>(function(u){return u.field.canonicalString()+u.dir})(i))).join(","),Qv(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((i=>E0(i))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((i=>E0(i))).join(",")),e.ue=t}return e.ue}function Pw(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!cD(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!_9(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!cE(n.startAt,e.startAt)&&cE(n.endAt,e.endAt)}function R5(n){return zi.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A_{constructor(e,t=null,i=[],c=[],u=null,m="F",_=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=c,this.limit=u,this.limitType=m,this.startAt=_,this.endAt=o,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function vD(n,e,t,i,c,u,m,_){return new A_(n,e,t,i,c,u,m,_)}function ex(n){return new A_(n)}function hE(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function b9(n){return n.collectionGroup!==null}function $y(n){const e=Co(n);if(e.ce===null){e.ce=[];const t=new Set;for(const u of e.explicitOrderBy)e.ce.push(u),t.add(u.field.canonicalString());const i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(m){let _=new Zu(Xu.comparator);return m.filters.forEach((o=>{o.getFlattenedFilters().forEach((w=>{w.isInequality()&&(_=_.add(w.field))}))})),_})(e).forEach((u=>{t.has(u.canonicalString())||u.isKeyField()||e.ce.push(new xv(u,i))})),t.has(Xu.keyField().canonicalString())||e.ce.push(new xv(Xu.keyField(),i))}return e.ce}function zf(n){const e=Co(n);return e.le||(e.le=xD(e,$y(n))),e.le}function xD(n,e){if(n.limitType==="F")return uE(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((c=>{const u=c.dir==="desc"?"asc":"desc";return new xv(c.field,u)}));const t=n.endAt?new vv(n.endAt.position,n.endAt.inclusive):null,i=n.startAt?new vv(n.startAt.position,n.startAt.inclusive):null;return uE(n.path,n.collectionGroup,e,n.filters,n.limit,t,i)}}function N5(n,e){const t=n.filters.concat([e]);return new A_(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function D5(n,e,t){return new A_(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function tx(n,e){return Pw(zf(n),zf(e))&&n.limitType===e.limitType}function w9(n){return`${Lw(zf(n))}|lt:${n.limitType}`}function e0(n){return`Query(target=${(function(t){let i=t.path.canonicalString();return t.collectionGroup!==null&&(i+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(i+=`, filters: [${t.filters.map((c=>v9(c))).join(", ")}]`),Qv(t.limit)||(i+=", limit: "+t.limit),t.orderBy.length>0&&(i+=`, orderBy: [${t.orderBy.map((c=>(function(m){return`${m.field.canonicalString()} (${m.dir})`})(c))).join(", ")}]`),t.startAt&&(i+=", startAt: ",i+=t.startAt.inclusive?"b:":"a:",i+=t.startAt.position.map((c=>E0(c))).join(",")),t.endAt&&(i+=", endAt: ",i+=t.endAt.inclusive?"a:":"b:",i+=t.endAt.position.map((c=>E0(c))).join(",")),`Target(${i})`})(zf(n))}; limitType=${n.limitType})`}function nx(n,e){return e.isFoundDocument()&&(function(i,c){const u=c.key.path;return i.collectionGroup!==null?c.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(u):zi.isDocumentKey(i.path)?i.path.isEqual(u):i.path.isImmediateParentOf(u)})(n,e)&&(function(i,c){for(const u of $y(i))if(!u.field.isKeyField()&&c.data.field(u.field)===null)return!1;return!0})(n,e)&&(function(i,c){for(const u of i.filters)if(!u.matches(c))return!1;return!0})(n,e)&&(function(i,c){return!(i.startAt&&!(function(m,_,o){const w=lE(m,_,o);return m.inclusive?w<=0:w<0})(i.startAt,$y(i),c)||i.endAt&&!(function(m,_,o){const w=lE(m,_,o);return m.inclusive?w>=0:w>0})(i.endAt,$y(i),c))})(n,e)}function bD(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function S9(n){return(e,t)=>{let i=!1;for(const c of $y(n)){const u=wD(c,e,t);if(u!==0)return u;i=i||c.field.isKeyField()}return 0}}function wD(n,e,t){const i=n.field.isKeyField()?zi.comparator(e.key,t.key):(function(u,m,_){const o=m.data.field(u),w=_.data.field(u);return o!==null&&w!==null?S0(o,w):fo()})(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return fo()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B0{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i!==void 0){for(const[c,u]of i)if(this.equalsFn(c,e))return u}}has(e){return this.get(e)!==void 0}set(e,t){const i=this.mapKeyFn(e),c=this.inner[i];if(c===void 0)return this.inner[i]=[[e,t]],void this.innerSize++;for(let u=0;u<c.length;u++)if(this.equalsFn(c[u][0],e))return void(c[u]=[e,t]);c.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i===void 0)return!1;for(let c=0;c<i.length;c++)if(this.equalsFn(i[c][0],e))return i.length===1?delete this.inner[t]:i.splice(c,1),this.innerSize--,!0;return!1}forEach(e){O0(this.inner,((t,i)=>{for(const[c,u]of i)e(c,u)}))}isEmpty(){return d9(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SD=new Jl(zi.comparator);function Ip(){return SD}const E9=new Jl(zi.comparator);function ky(...n){let e=E9;for(const t of n)e=e.insert(t.key,t);return e}function A9(n){let e=E9;return n.forEach(((t,i)=>e=e.insert(t,i.overlayedDocument))),e}function Xm(){return Gy()}function T9(){return Gy()}function Gy(){return new B0((n=>n.toString()),((n,e)=>n.isEqual(e)))}const ED=new Jl(zi.comparator),AD=new Zu(zi.comparator);function ds(...n){let e=AD;for(const t of n)e=e.add(t);return e}const TD=new Zu(Bs);function ID(){return TD}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kw(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:_v(e)?"-0":e}}function I9(n){return{integerValue:""+n}}function CD(n,e){return iD(e)?I9(e):kw(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rx{constructor(){this._=void 0}}function LD(n,e,t){return n instanceof u_?(function(c,u){const m={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:c.seconds,nanos:c.nanoseconds}}}};return u&&Tw(u)&&(u=Iw(u)),u&&(m.fields.__previous_value__=u),{mapValue:m}})(t,e):n instanceof h_?L9(n,e):n instanceof d_?P9(n,e):(function(c,u){const m=C9(c,u),_=dE(m)+dE(c.Pe);return k5(m)&&k5(c.Pe)?I9(_):kw(c.serializer,_)})(n,e)}function PD(n,e,t){return n instanceof h_?L9(n,e):n instanceof d_?P9(n,e):t}function C9(n,e){return n instanceof bv?(function(i){return k5(i)||(function(u){return!!u&&"doubleValue"in u})(i)})(e)?e:{integerValue:0}:null}class u_ extends rx{}class h_ extends rx{constructor(e){super(),this.elements=e}}function L9(n,e){const t=k9(e);for(const i of n.elements)t.some((c=>Gf(c,i)))||t.push(i);return{arrayValue:{values:t}}}class d_ extends rx{constructor(e){super(),this.elements=e}}function P9(n,e){let t=k9(e);for(const i of n.elements)t=t.filter((c=>!Gf(c,i)));return{arrayValue:{values:t}}}class bv extends rx{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function dE(n){return Dc(n.integerValue||n.doubleValue)}function k9(n){return Cw(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kD{constructor(e,t){this.field=e,this.transform=t}}function MD(n,e){return n.field.isEqual(e.field)&&(function(i,c){return i instanceof h_&&c instanceof h_||i instanceof d_&&c instanceof d_?w0(i.elements,c.elements,Gf):i instanceof bv&&c instanceof bv?Gf(i.Pe,c.Pe):i instanceof u_&&c instanceof u_})(n.transform,e.transform)}class RD{constructor(e,t){this.version=e,this.transformResults=t}}class jf{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new jf}static exists(e){return new jf(void 0,e)}static updateTime(e){return new jf(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function H1(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class ix{}function M9(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new N9(n.key,jf.none()):new T_(n.key,n.data,jf.none());{const t=n.data,i=Nd.empty();let c=new Zu(Xu.comparator);for(let u of e.fields)if(!c.has(u)){let m=t.field(u);m===null&&u.length>1&&(u=u.popLast(),m=t.field(u)),m===null?i.delete(u):i.set(u,m),c=c.add(u)}return new pg(n.key,i,new ef(c.toArray()),jf.none())}}function ND(n,e,t){n instanceof T_?(function(c,u,m){const _=c.value.clone(),o=pE(c.fieldTransforms,u,m.transformResults);_.setAll(o),u.convertToFoundDocument(m.version,_).setHasCommittedMutations()})(n,e,t):n instanceof pg?(function(c,u,m){if(!H1(c.precondition,u))return void u.convertToUnknownDocument(m.version);const _=pE(c.fieldTransforms,u,m.transformResults),o=u.data;o.setAll(R9(c)),o.setAll(_),u.convertToFoundDocument(m.version,o).setHasCommittedMutations()})(n,e,t):(function(c,u,m){u.convertToNoDocument(m.version).setHasCommittedMutations()})(0,e,t)}function Hy(n,e,t,i){return n instanceof T_?(function(u,m,_,o){if(!H1(u.precondition,m))return _;const w=u.value.clone(),I=mE(u.fieldTransforms,o,m);return w.setAll(I),m.convertToFoundDocument(m.version,w).setHasLocalMutations(),null})(n,e,t,i):n instanceof pg?(function(u,m,_,o){if(!H1(u.precondition,m))return _;const w=mE(u.fieldTransforms,o,m),I=m.data;return I.setAll(R9(u)),I.setAll(w),m.convertToFoundDocument(m.version,I).setHasLocalMutations(),_===null?null:_.unionWith(u.fieldMask.fields).unionWith(u.fieldTransforms.map((R=>R.field)))})(n,e,t,i):(function(u,m,_){return H1(u.precondition,m)?(m.convertToNoDocument(m.version).setHasLocalMutations(),null):_})(n,e,t)}function DD(n,e){let t=null;for(const i of n.fieldTransforms){const c=e.data.field(i.field),u=C9(i.transform,c||null);u!=null&&(t===null&&(t=Nd.empty()),t.set(i.field,u))}return t||null}function fE(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(i,c){return i===void 0&&c===void 0||!(!i||!c)&&w0(i,c,((u,m)=>MD(u,m)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class T_ extends ix{constructor(e,t,i,c=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=c,this.type=0}getFieldMask(){return null}}class pg extends ix{constructor(e,t,i,c,u=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=c,this.fieldTransforms=u,this.type=1}getFieldMask(){return this.fieldMask}}function R9(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const i=n.data.field(t);e.set(t,i)}})),e}function pE(n,e,t){const i=new Map;Sa(n.length===t.length);for(let c=0;c<t.length;c++){const u=n[c],m=u.transform,_=e.data.field(u.field);i.set(u.field,PD(m,_,t[c]))}return i}function mE(n,e,t){const i=new Map;for(const c of n){const u=c.transform,m=t.data.field(c.field);i.set(c.field,LD(u,m,e))}return i}class N9 extends ix{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class FD extends ix{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OD{constructor(e,t,i,c){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=c}applyToRemoteDocument(e,t){const i=t.mutationResults;for(let c=0;c<this.mutations.length;c++){const u=this.mutations[c];u.key.isEqual(e.key)&&ND(u,e,i[c])}}applyToLocalView(e,t){for(const i of this.baseMutations)i.key.isEqual(e.key)&&(t=Hy(i,e,t,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(e.key)&&(t=Hy(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const i=T9();return this.mutations.forEach((c=>{const u=e.get(c.key),m=u.overlayedDocument;let _=this.applyToLocalView(m,u.mutatedFields);_=t.has(c.key)?null:_;const o=M9(m,_);o!==null&&i.set(c.key,o),m.isValidDocument()||m.convertToNoDocument(Io.min())})),i}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),ds())}isEqual(e){return this.batchId===e.batchId&&w0(this.mutations,e.mutations,((t,i)=>fE(t,i)))&&w0(this.baseMutations,e.baseMutations,((t,i)=>fE(t,i)))}}class Mw{constructor(e,t,i,c){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=c}static from(e,t,i){Sa(e.mutations.length===i.length);let c=(function(){return ED})();const u=e.mutations;for(let m=0;m<u.length;m++)c=c.insert(u[m].key,i[m].version);return new Mw(e,t,i,c)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BD{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zD{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Yc,ws;function jD(n){switch(n){default:return fo();case Yn.CANCELLED:case Yn.UNKNOWN:case Yn.DEADLINE_EXCEEDED:case Yn.RESOURCE_EXHAUSTED:case Yn.INTERNAL:case Yn.UNAVAILABLE:case Yn.UNAUTHENTICATED:return!1;case Yn.INVALID_ARGUMENT:case Yn.NOT_FOUND:case Yn.ALREADY_EXISTS:case Yn.PERMISSION_DENIED:case Yn.FAILED_PRECONDITION:case Yn.ABORTED:case Yn.OUT_OF_RANGE:case Yn.UNIMPLEMENTED:case Yn.DATA_LOSS:return!0}}function D9(n){if(n===void 0)return Tp("GRPC error has no .code"),Yn.UNKNOWN;switch(n){case Yc.OK:return Yn.OK;case Yc.CANCELLED:return Yn.CANCELLED;case Yc.UNKNOWN:return Yn.UNKNOWN;case Yc.DEADLINE_EXCEEDED:return Yn.DEADLINE_EXCEEDED;case Yc.RESOURCE_EXHAUSTED:return Yn.RESOURCE_EXHAUSTED;case Yc.INTERNAL:return Yn.INTERNAL;case Yc.UNAVAILABLE:return Yn.UNAVAILABLE;case Yc.UNAUTHENTICATED:return Yn.UNAUTHENTICATED;case Yc.INVALID_ARGUMENT:return Yn.INVALID_ARGUMENT;case Yc.NOT_FOUND:return Yn.NOT_FOUND;case Yc.ALREADY_EXISTS:return Yn.ALREADY_EXISTS;case Yc.PERMISSION_DENIED:return Yn.PERMISSION_DENIED;case Yc.FAILED_PRECONDITION:return Yn.FAILED_PRECONDITION;case Yc.ABORTED:return Yn.ABORTED;case Yc.OUT_OF_RANGE:return Yn.OUT_OF_RANGE;case Yc.UNIMPLEMENTED:return Yn.UNIMPLEMENTED;case Yc.DATA_LOSS:return Yn.DATA_LOSS;default:return fo()}}(ws=Yc||(Yc={}))[ws.OK=0]="OK",ws[ws.CANCELLED=1]="CANCELLED",ws[ws.UNKNOWN=2]="UNKNOWN",ws[ws.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ws[ws.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ws[ws.NOT_FOUND=5]="NOT_FOUND",ws[ws.ALREADY_EXISTS=6]="ALREADY_EXISTS",ws[ws.PERMISSION_DENIED=7]="PERMISSION_DENIED",ws[ws.UNAUTHENTICATED=16]="UNAUTHENTICATED",ws[ws.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ws[ws.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ws[ws.ABORTED=10]="ABORTED",ws[ws.OUT_OF_RANGE=11]="OUT_OF_RANGE",ws[ws.UNIMPLEMENTED=12]="UNIMPLEMENTED",ws[ws.INTERNAL=13]="INTERNAL",ws[ws.UNAVAILABLE=14]="UNAVAILABLE",ws[ws.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UD(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VD=new eg([4294967295,4294967295],0);function gE(n){const e=UD().encode(n),t=new i9;return t.update(e),new Uint8Array(t.digest())}function yE(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),i=e.getUint32(4,!0),c=e.getUint32(8,!0),u=e.getUint32(12,!0);return[new eg([t,i],0),new eg([c,u],0)]}class Rw{constructor(e,t,i){if(this.bitmap=e,this.padding=t,this.hashCount=i,t<0||t>=8)throw new My(`Invalid padding: ${t}`);if(i<0)throw new My(`Invalid hash count: ${i}`);if(e.length>0&&this.hashCount===0)throw new My(`Invalid hash count: ${i}`);if(e.length===0&&t!==0)throw new My(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=eg.fromNumber(this.Ie)}Ee(e,t,i){let c=e.add(t.multiply(eg.fromNumber(i)));return c.compare(VD)===1&&(c=new eg([c.getBits(0),c.getBits(1)],0)),c.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=gE(e),[i,c]=yE(t);for(let u=0;u<this.hashCount;u++){const m=this.Ee(i,c,u);if(!this.de(m))return!1}return!0}static create(e,t,i){const c=e%8==0?0:8-e%8,u=new Uint8Array(Math.ceil(e/8)),m=new Rw(u,c,t);return i.forEach((_=>m.insert(_))),m}insert(e){if(this.Ie===0)return;const t=gE(e),[i,c]=yE(t);for(let u=0;u<this.hashCount;u++){const m=this.Ee(i,c,u);this.Ae(m)}}Ae(e){const t=Math.floor(e/8),i=e%8;this.bitmap[t]|=1<<i}}class My extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ox{constructor(e,t,i,c,u){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=i,this.documentUpdates=c,this.resolvedLimboDocuments=u}static createSynthesizedRemoteEventForCurrentChange(e,t,i){const c=new Map;return c.set(e,I_.createSynthesizedTargetChangeForCurrentChange(e,t,i)),new ox(Io.min(),c,new Jl(Bs),Ip(),ds())}}class I_{constructor(e,t,i,c,u){this.resumeToken=e,this.current=t,this.addedDocuments=i,this.modifiedDocuments=c,this.removedDocuments=u}static createSynthesizedTargetChangeForCurrentChange(e,t,i){return new I_(i,t,ds(),ds(),ds())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W1{constructor(e,t,i,c){this.Re=e,this.removedTargetIds=t,this.key=i,this.Ve=c}}class F9{constructor(e,t){this.targetId=e,this.me=t}}class O9{constructor(e,t,i=Yu.EMPTY_BYTE_STRING,c=null){this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=c}}class _E{constructor(){this.fe=0,this.ge=xE(),this.pe=Yu.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=ds(),t=ds(),i=ds();return this.ge.forEach(((c,u)=>{switch(u){case 0:e=e.add(c);break;case 2:t=t.add(c);break;case 1:i=i.add(c);break;default:fo()}})),new I_(this.pe,this.ye,e,t,i)}Ce(){this.we=!1,this.ge=xE()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Sa(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class qD{constructor(e){this.Le=e,this.Be=new Map,this.ke=Ip(),this.qe=vE(),this.Qe=new Jl(Bs)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,(t=>{const i=this.Ge(t);switch(e.state){case 0:this.ze(t)&&i.De(e.resumeToken);break;case 1:i.Oe(),i.Se||i.Ce(),i.De(e.resumeToken);break;case 2:i.Oe(),i.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(i.Ne(),i.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),i.De(e.resumeToken));break;default:fo()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach(((i,c)=>{this.ze(c)&&t(c)}))}He(e){const t=e.targetId,i=e.me.count,c=this.Je(t);if(c){const u=c.target;if(R5(u))if(i===0){const m=new zi(u.path);this.Ue(t,m,_h.newNoDocument(m,Io.min()))}else Sa(i===1);else{const m=this.Ye(t);if(m!==i){const _=this.Ze(e),o=_?this.Xe(_,e,m):1;if(o!==0){this.je(t);const w=o===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,w)}}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:i="",padding:c=0},hashCount:u=0}=t;let m,_;try{m=og(i).toUint8Array()}catch(o){if(o instanceof f9)return b0("Decoding the base64 bloom filter in existence filter failed ("+o.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw o}try{_=new Rw(m,c,u)}catch(o){return b0(o instanceof My?"BloomFilter error: ":"Applying bloom filter failed: ",o),null}return _.Ie===0?null:_}Xe(e,t,i){return t.me.count===i-this.nt(e,t.targetId)?0:2}nt(e,t){const i=this.Le.getRemoteKeysForTarget(t);let c=0;return i.forEach((u=>{const m=this.Le.tt(),_=`projects/${m.projectId}/databases/${m.database}/documents/${u.path.canonicalString()}`;e.mightContain(_)||(this.Ue(t,u,null),c++)})),c}rt(e){const t=new Map;this.Be.forEach(((u,m)=>{const _=this.Je(m);if(_){if(u.current&&R5(_.target)){const o=new zi(_.target.path);this.ke.get(o)!==null||this.it(m,o)||this.Ue(m,o,_h.newNoDocument(o,e))}u.be&&(t.set(m,u.ve()),u.Ce())}}));let i=ds();this.qe.forEach(((u,m)=>{let _=!0;m.forEachWhile((o=>{const w=this.Je(o);return!w||w.purpose==="TargetPurposeLimboResolution"||(_=!1,!1)})),_&&(i=i.add(u))})),this.ke.forEach(((u,m)=>m.setReadTime(e)));const c=new ox(e,t,this.Qe,this.ke,i);return this.ke=Ip(),this.qe=vE(),this.Qe=new Jl(Bs),c}$e(e,t){if(!this.ze(e))return;const i=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,i),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,i){if(!this.ze(e))return;const c=this.Ge(e);this.it(e,t)?c.Fe(t,1):c.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),i&&(this.ke=this.ke.insert(t,i))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new _E,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Zu(Bs),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||_i("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new _E),this.Le.getRemoteKeysForTarget(e).forEach((t=>{this.Ue(e,t,null)}))}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function vE(){return new Jl(zi.comparator)}function xE(){return new Jl(zi.comparator)}const $D={asc:"ASCENDING",desc:"DESCENDING"},GD={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},HD={and:"AND",or:"OR"};class WD{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function F5(n,e){return n.useProto3Json||Qv(e)?e:{value:e}}function wv(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function B9(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function KD(n,e){return wv(n,e.toTimestamp())}function Uf(n){return Sa(!!n),Io.fromTimestamp((function(t){const i=ym(t);return new pu(i.seconds,i.nanos)})(n))}function Nw(n,e){return O5(n,e).canonicalString()}function O5(n,e){const t=(function(c){return new bl(["projects",c.projectId,"databases",c.database])})(n).child("documents");return e===void 0?t:t.child(e)}function z9(n){const e=bl.fromString(n);return Sa($9(e)),e}function B5(n,e){return Nw(n.databaseId,e.path)}function Fb(n,e){const t=z9(e);if(t.get(1)!==n.databaseId.projectId)throw new ui(Yn.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new ui(Yn.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new zi(U9(t))}function j9(n,e){return Nw(n.databaseId,e)}function XD(n){const e=z9(n);return e.length===4?bl.emptyPath():U9(e)}function z5(n){return new bl(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function U9(n){return Sa(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function bE(n,e,t){return{name:B5(n,e),fields:t.value.mapValue.fields}}function ZD(n,e){let t;if("targetChange"in e){e.targetChange;const i=(function(w){return w==="NO_CHANGE"?0:w==="ADD"?1:w==="REMOVE"?2:w==="CURRENT"?3:w==="RESET"?4:fo()})(e.targetChange.targetChangeType||"NO_CHANGE"),c=e.targetChange.targetIds||[],u=(function(w,I){return w.useProto3Json?(Sa(I===void 0||typeof I=="string"),Yu.fromBase64String(I||"")):(Sa(I===void 0||I instanceof Buffer||I instanceof Uint8Array),Yu.fromUint8Array(I||new Uint8Array))})(n,e.targetChange.resumeToken),m=e.targetChange.cause,_=m&&(function(w){const I=w.code===void 0?Yn.UNKNOWN:D9(w.code);return new ui(I,w.message||"")})(m);t=new O9(i,c,u,_||null)}else if("documentChange"in e){e.documentChange;const i=e.documentChange;i.document,i.document.name,i.document.updateTime;const c=Fb(n,i.document.name),u=Uf(i.document.updateTime),m=i.document.createTime?Uf(i.document.createTime):Io.min(),_=new Nd({mapValue:{fields:i.document.fields}}),o=_h.newFoundDocument(c,u,m,_),w=i.targetIds||[],I=i.removedTargetIds||[];t=new W1(w,I,o.key,o)}else if("documentDelete"in e){e.documentDelete;const i=e.documentDelete;i.document;const c=Fb(n,i.document),u=i.readTime?Uf(i.readTime):Io.min(),m=_h.newNoDocument(c,u),_=i.removedTargetIds||[];t=new W1([],_,m.key,m)}else if("documentRemove"in e){e.documentRemove;const i=e.documentRemove;i.document;const c=Fb(n,i.document),u=i.removedTargetIds||[];t=new W1([],u,c,null)}else{if(!("filter"in e))return fo();{e.filter;const i=e.filter;i.targetId;const{count:c=0,unchangedNames:u}=i,m=new zD(c,u),_=i.targetId;t=new F9(_,m)}}return t}function YD(n,e){let t;if(e instanceof T_)t={update:bE(n,e.key,e.value)};else if(e instanceof N9)t={delete:B5(n,e.key)};else if(e instanceof pg)t={update:bE(n,e.key,e.data),updateMask:sF(e.fieldMask)};else{if(!(e instanceof FD))return fo();t={verify:B5(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((i=>(function(u,m){const _=m.transform;if(_ instanceof u_)return{fieldPath:m.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(_ instanceof h_)return{fieldPath:m.field.canonicalString(),appendMissingElements:{values:_.elements}};if(_ instanceof d_)return{fieldPath:m.field.canonicalString(),removeAllFromArray:{values:_.elements}};if(_ instanceof bv)return{fieldPath:m.field.canonicalString(),increment:_.Pe};throw fo()})(0,i)))),e.precondition.isNone||(t.currentDocument=(function(c,u){return u.updateTime!==void 0?{updateTime:KD(c,u.updateTime)}:u.exists!==void 0?{exists:u.exists}:fo()})(n,e.precondition)),t}function JD(n,e){return n&&n.length>0?(Sa(e!==void 0),n.map((t=>(function(c,u){let m=c.updateTime?Uf(c.updateTime):Uf(u);return m.isEqual(Io.min())&&(m=Uf(u)),new RD(m,c.transformResults||[])})(t,e)))):[]}function QD(n,e){return{documents:[j9(n,e.path)]}}function eF(n,e){const t={structuredQuery:{}},i=e.path;let c;e.collectionGroup!==null?(c=i,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(c=i.popLast(),t.structuredQuery.from=[{collectionId:i.lastSegment()}]),t.parent=j9(n,c);const u=(function(w){if(w.length!==0)return q9(of.create(w,"and"))})(e.filters);u&&(t.structuredQuery.where=u);const m=(function(w){if(w.length!==0)return w.map((I=>(function(V){return{field:t0(V.field),direction:rF(V.dir)}})(I)))})(e.orderBy);m&&(t.structuredQuery.orderBy=m);const _=F5(n,e.limit);return _!==null&&(t.structuredQuery.limit=_),e.startAt&&(t.structuredQuery.startAt=(function(w){return{before:w.inclusive,values:w.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(w){return{before:!w.inclusive,values:w.position}})(e.endAt)),{_t:t,parent:c}}function tF(n){let e=XD(n.parent);const t=n.structuredQuery,i=t.from?t.from.length:0;let c=null;if(i>0){Sa(i===1);const I=t.from[0];I.allDescendants?c=I.collectionId:e=e.child(I.collectionId)}let u=[];t.where&&(u=(function(R){const V=V9(R);return V instanceof of&&y9(V)?V.getFilters():[V]})(t.where));let m=[];t.orderBy&&(m=(function(R){return R.map((V=>(function(ie){return new xv(n0(ie.field),(function(fe){switch(fe){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(ie.direction))})(V)))})(t.orderBy));let _=null;t.limit&&(_=(function(R){let V;return V=typeof R=="object"?R.value:R,Qv(V)?null:V})(t.limit));let o=null;t.startAt&&(o=(function(R){const V=!!R.before,k=R.values||[];return new vv(k,V)})(t.startAt));let w=null;return t.endAt&&(w=(function(R){const V=!R.before,k=R.values||[];return new vv(k,V)})(t.endAt)),vD(e,c,m,u,_,"F",o,w)}function nF(n,e){const t=(function(c){switch(c){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return fo()}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function V9(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const i=n0(t.unaryFilter.field);return Jc.create(i,"==",{doubleValue:NaN});case"IS_NULL":const c=n0(t.unaryFilter.field);return Jc.create(c,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const u=n0(t.unaryFilter.field);return Jc.create(u,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const m=n0(t.unaryFilter.field);return Jc.create(m,"!=",{nullValue:"NULL_VALUE"});default:return fo()}})(n):n.fieldFilter!==void 0?(function(t){return Jc.create(n0(t.fieldFilter.field),(function(c){switch(c){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return fo()}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return of.create(t.compositeFilter.filters.map((i=>V9(i))),(function(c){switch(c){case"AND":return"and";case"OR":return"or";default:return fo()}})(t.compositeFilter.op))})(n):fo()}function rF(n){return $D[n]}function iF(n){return GD[n]}function oF(n){return HD[n]}function t0(n){return{fieldPath:n.canonicalString()}}function n0(n){return Xu.fromServerFormat(n.fieldPath)}function q9(n){return n instanceof Jc?(function(t){if(t.op==="=="){if(aE(t.value))return{unaryFilter:{field:t0(t.field),op:"IS_NAN"}};if(sE(t.value))return{unaryFilter:{field:t0(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(aE(t.value))return{unaryFilter:{field:t0(t.field),op:"IS_NOT_NAN"}};if(sE(t.value))return{unaryFilter:{field:t0(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:t0(t.field),op:iF(t.op),value:t.value}}})(n):n instanceof of?(function(t){const i=t.getFilters().map((c=>q9(c)));return i.length===1?i[0]:{compositeFilter:{op:oF(t.op),filters:i}}})(n):fo()}function sF(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function $9(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class om{constructor(e,t,i,c,u=Io.min(),m=Io.min(),_=Yu.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=i,this.sequenceNumber=c,this.snapshotVersion=u,this.lastLimboFreeSnapshotVersion=m,this.resumeToken=_,this.expectedCount=o}withSequenceNumber(e){return new om(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new om(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new om(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new om(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aF{constructor(e){this.ct=e}}function lF(n){const e=tF({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?D5(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cF{constructor(){this.un=new uF}addToCollectionParentIndex(e,t){return this.un.add(t),ur.resolve()}getCollectionParents(e,t){return ur.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return ur.resolve()}deleteFieldIndex(e,t){return ur.resolve()}deleteAllFieldIndexes(e){return ur.resolve()}createTargetIndexes(e,t){return ur.resolve()}getDocumentsMatchingTarget(e,t){return ur.resolve(null)}getIndexType(e,t){return ur.resolve(0)}getFieldIndexes(e,t){return ur.resolve([])}getNextCollectionGroupToUpdate(e){return ur.resolve(null)}getMinOffset(e,t){return ur.resolve(gm.min())}getMinOffsetFromCollectionGroup(e,t){return ur.resolve(gm.min())}updateCollectionGroup(e,t,i){return ur.resolve()}updateIndexEntries(e,t){return ur.resolve()}}class uF{constructor(){this.index={}}add(e){const t=e.lastSegment(),i=e.popLast(),c=this.index[t]||new Zu(bl.comparator),u=!c.has(i);return this.index[t]=c.add(i),u}has(e){const t=e.lastSegment(),i=e.popLast(),c=this.index[t];return c&&c.has(i)}getEntries(e){return(this.index[e]||new Zu(bl.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A0{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new A0(0)}static kn(){return new A0(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hF{constructor(){this.changes=new B0((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,_h.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const i=this.changes.get(t);return i!==void 0?ur.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dF{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fF{constructor(e,t,i,c){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=c}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next((c=>(i=c,this.remoteDocumentCache.getEntry(e,t)))).next((c=>(i!==null&&Hy(i.mutation,c,ef.empty(),pu.now()),c)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((i=>this.getLocalViewOfDocuments(e,i,ds()).next((()=>i))))}getLocalViewOfDocuments(e,t,i=ds()){const c=Xm();return this.populateOverlays(e,c,t).next((()=>this.computeViews(e,t,c,i).next((u=>{let m=ky();return u.forEach(((_,o)=>{m=m.insert(_,o.overlayedDocument)})),m}))))}getOverlayedDocuments(e,t){const i=Xm();return this.populateOverlays(e,i,t).next((()=>this.computeViews(e,t,i,ds())))}populateOverlays(e,t,i){const c=[];return i.forEach((u=>{t.has(u)||c.push(u)})),this.documentOverlayCache.getOverlays(e,c).next((u=>{u.forEach(((m,_)=>{t.set(m,_)}))}))}computeViews(e,t,i,c){let u=Ip();const m=Gy(),_=(function(){return Gy()})();return t.forEach(((o,w)=>{const I=i.get(w.key);c.has(w.key)&&(I===void 0||I.mutation instanceof pg)?u=u.insert(w.key,w):I!==void 0?(m.set(w.key,I.mutation.getFieldMask()),Hy(I.mutation,w,I.mutation.getFieldMask(),pu.now())):m.set(w.key,ef.empty())})),this.recalculateAndSaveOverlays(e,u).next((o=>(o.forEach(((w,I)=>m.set(w,I))),t.forEach(((w,I)=>{var R;return _.set(w,new dF(I,(R=m.get(w))!==null&&R!==void 0?R:null))})),_)))}recalculateAndSaveOverlays(e,t){const i=Gy();let c=new Jl(((m,_)=>m-_)),u=ds();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((m=>{for(const _ of m)_.keys().forEach((o=>{const w=t.get(o);if(w===null)return;let I=i.get(o)||ef.empty();I=_.applyToLocalView(w,I),i.set(o,I);const R=(c.get(_.batchId)||ds()).add(o);c=c.insert(_.batchId,R)}))})).next((()=>{const m=[],_=c.getReverseIterator();for(;_.hasNext();){const o=_.getNext(),w=o.key,I=o.value,R=T9();I.forEach((V=>{if(!u.has(V)){const k=M9(t.get(V),i.get(V));k!==null&&R.set(V,k),u=u.add(V)}})),m.push(this.documentOverlayCache.saveOverlays(e,w,R))}return ur.waitFor(m)})).next((()=>i))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((i=>this.recalculateAndSaveOverlays(e,i)))}getDocumentsMatchingQuery(e,t,i,c){return(function(m){return zi.isDocumentKey(m.path)&&m.collectionGroup===null&&m.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):b9(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i,c):this.getDocumentsMatchingCollectionQuery(e,t,i,c)}getNextDocuments(e,t,i,c){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,c).next((u=>{const m=c-u.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,c-u.size):ur.resolve(Xm());let _=-1,o=u;return m.next((w=>ur.forEach(w,((I,R)=>(_<R.largestBatchId&&(_=R.largestBatchId),u.get(I)?ur.resolve():this.remoteDocumentCache.getEntry(e,I).next((V=>{o=o.insert(I,V)}))))).next((()=>this.populateOverlays(e,w,u))).next((()=>this.computeViews(e,o,w,ds()))).next((I=>({batchId:_,changes:A9(I)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new zi(t)).next((i=>{let c=ky();return i.isFoundDocument()&&(c=c.insert(i.key,i)),c}))}getDocumentsMatchingCollectionGroupQuery(e,t,i,c){const u=t.collectionGroup;let m=ky();return this.indexManager.getCollectionParents(e,u).next((_=>ur.forEach(_,(o=>{const w=(function(R,V){return new A_(V,null,R.explicitOrderBy.slice(),R.filters.slice(),R.limit,R.limitType,R.startAt,R.endAt)})(t,o.child(u));return this.getDocumentsMatchingCollectionQuery(e,w,i,c).next((I=>{I.forEach(((R,V)=>{m=m.insert(R,V)}))}))})).next((()=>m))))}getDocumentsMatchingCollectionQuery(e,t,i,c){let u;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId).next((m=>(u=m,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,i,u,c)))).next((m=>{u.forEach(((o,w)=>{const I=w.getKey();m.get(I)===null&&(m=m.insert(I,_h.newInvalidDocument(I)))}));let _=ky();return m.forEach(((o,w)=>{const I=u.get(o);I!==void 0&&Hy(I.mutation,w,ef.empty(),pu.now()),nx(t,w)&&(_=_.insert(o,w))})),_}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pF{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return ur.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,(function(c){return{id:c.id,version:c.version,createTime:Uf(c.createTime)}})(t)),ur.resolve()}getNamedQuery(e,t){return ur.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,(function(c){return{name:c.name,query:lF(c.bundledQuery),readTime:Uf(c.readTime)}})(t)),ur.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mF{constructor(){this.overlays=new Jl(zi.comparator),this.Ir=new Map}getOverlay(e,t){return ur.resolve(this.overlays.get(t))}getOverlays(e,t){const i=Xm();return ur.forEach(t,(c=>this.getOverlay(e,c).next((u=>{u!==null&&i.set(c,u)})))).next((()=>i))}saveOverlays(e,t,i){return i.forEach(((c,u)=>{this.ht(e,t,u)})),ur.resolve()}removeOverlaysForBatchId(e,t,i){const c=this.Ir.get(i);return c!==void 0&&(c.forEach((u=>this.overlays=this.overlays.remove(u))),this.Ir.delete(i)),ur.resolve()}getOverlaysForCollection(e,t,i){const c=Xm(),u=t.length+1,m=new zi(t.child("")),_=this.overlays.getIteratorFrom(m);for(;_.hasNext();){const o=_.getNext().value,w=o.getKey();if(!t.isPrefixOf(w.path))break;w.path.length===u&&o.largestBatchId>i&&c.set(o.getKey(),o)}return ur.resolve(c)}getOverlaysForCollectionGroup(e,t,i,c){let u=new Jl(((w,I)=>w-I));const m=this.overlays.getIterator();for(;m.hasNext();){const w=m.getNext().value;if(w.getKey().getCollectionGroup()===t&&w.largestBatchId>i){let I=u.get(w.largestBatchId);I===null&&(I=Xm(),u=u.insert(w.largestBatchId,I)),I.set(w.getKey(),w)}}const _=Xm(),o=u.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach(((w,I)=>_.set(w,I))),!(_.size()>=c)););return ur.resolve(_)}ht(e,t,i){const c=this.overlays.get(i.key);if(c!==null){const m=this.Ir.get(c.largestBatchId).delete(i.key);this.Ir.set(c.largestBatchId,m)}this.overlays=this.overlays.insert(i.key,new BD(t,i));let u=this.Ir.get(t);u===void 0&&(u=ds(),this.Ir.set(t,u)),this.Ir.set(t,u.add(i.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gF{constructor(){this.sessionToken=Yu.EMPTY_BYTE_STRING}getSessionToken(e){return ur.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,ur.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dw{constructor(){this.Tr=new Zu(Iu.Er),this.dr=new Zu(Iu.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const i=new Iu(e,t);this.Tr=this.Tr.add(i),this.dr=this.dr.add(i)}Rr(e,t){e.forEach((i=>this.addReference(i,t)))}removeReference(e,t){this.Vr(new Iu(e,t))}mr(e,t){e.forEach((i=>this.removeReference(i,t)))}gr(e){const t=new zi(new bl([])),i=new Iu(t,e),c=new Iu(t,e+1),u=[];return this.dr.forEachInRange([i,c],(m=>{this.Vr(m),u.push(m.key)})),u}pr(){this.Tr.forEach((e=>this.Vr(e)))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new zi(new bl([])),i=new Iu(t,e),c=new Iu(t,e+1);let u=ds();return this.dr.forEachInRange([i,c],(m=>{u=u.add(m.key)})),u}containsKey(e){const t=new Iu(e,0),i=this.Tr.firstAfterOrEqual(t);return i!==null&&e.isEqual(i.key)}}class Iu{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return zi.comparator(e.key,t.key)||Bs(e.wr,t.wr)}static Ar(e,t){return Bs(e.wr,t.wr)||zi.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yF{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new Zu(Iu.Er)}checkEmpty(e){return ur.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,i,c){const u=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const m=new OD(u,t,i,c);this.mutationQueue.push(m);for(const _ of c)this.br=this.br.add(new Iu(_.key,u)),this.indexManager.addToCollectionParentIndex(e,_.key.path.popLast());return ur.resolve(m)}lookupMutationBatch(e,t){return ur.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const i=t+1,c=this.vr(i),u=c<0?0:c;return ur.resolve(this.mutationQueue.length>u?this.mutationQueue[u]:null)}getHighestUnacknowledgedBatchId(){return ur.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return ur.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const i=new Iu(t,0),c=new Iu(t,Number.POSITIVE_INFINITY),u=[];return this.br.forEachInRange([i,c],(m=>{const _=this.Dr(m.wr);u.push(_)})),ur.resolve(u)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new Zu(Bs);return t.forEach((c=>{const u=new Iu(c,0),m=new Iu(c,Number.POSITIVE_INFINITY);this.br.forEachInRange([u,m],(_=>{i=i.add(_.wr)}))})),ur.resolve(this.Cr(i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,c=i.length+1;let u=i;zi.isDocumentKey(u)||(u=u.child(""));const m=new Iu(new zi(u),0);let _=new Zu(Bs);return this.br.forEachWhile((o=>{const w=o.key.path;return!!i.isPrefixOf(w)&&(w.length===c&&(_=_.add(o.wr)),!0)}),m),ur.resolve(this.Cr(_))}Cr(e){const t=[];return e.forEach((i=>{const c=this.Dr(i);c!==null&&t.push(c)})),t}removeMutationBatch(e,t){Sa(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let i=this.br;return ur.forEach(t.mutations,(c=>{const u=new Iu(c.key,t.batchId);return i=i.delete(u),this.referenceDelegate.markPotentiallyOrphaned(e,c.key)})).next((()=>{this.br=i}))}On(e){}containsKey(e,t){const i=new Iu(t,0),c=this.br.firstAfterOrEqual(i);return ur.resolve(t.isEqual(c&&c.key))}performConsistencyCheck(e){return this.mutationQueue.length,ur.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _F{constructor(e){this.Mr=e,this.docs=(function(){return new Jl(zi.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const i=t.key,c=this.docs.get(i),u=c?c.size:0,m=this.Mr(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:m}),this.size+=m-u,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const i=this.docs.get(t);return ur.resolve(i?i.document.mutableCopy():_h.newInvalidDocument(t))}getEntries(e,t){let i=Ip();return t.forEach((c=>{const u=this.docs.get(c);i=i.insert(c,u?u.document.mutableCopy():_h.newInvalidDocument(c))})),ur.resolve(i)}getDocumentsMatchingQuery(e,t,i,c){let u=Ip();const m=t.path,_=new zi(m.child("")),o=this.docs.getIteratorFrom(_);for(;o.hasNext();){const{key:w,value:{document:I}}=o.getNext();if(!m.isPrefixOf(w.path))break;w.path.length>m.length+1||eD(QN(I),i)<=0||(c.has(I.key)||nx(t,I))&&(u=u.insert(I.key,I.mutableCopy()))}return ur.resolve(u)}getAllFromCollectionGroup(e,t,i,c){fo()}Or(e,t){return ur.forEach(this.docs,(i=>t(i)))}newChangeBuffer(e){return new vF(this)}getSize(e){return ur.resolve(this.size)}}class vF extends hF{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach(((i,c)=>{c.isValidDocument()?t.push(this.cr.addEntry(e,c)):this.cr.removeEntry(i)})),ur.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xF{constructor(e){this.persistence=e,this.Nr=new B0((t=>Lw(t)),Pw),this.lastRemoteSnapshotVersion=Io.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Dw,this.targetCount=0,this.kr=A0.Bn()}forEachTarget(e,t){return this.Nr.forEach(((i,c)=>t(c))),ur.resolve()}getLastRemoteSnapshotVersion(e){return ur.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ur.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),ur.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this.Lr&&(this.Lr=t),ur.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new A0(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,ur.resolve()}updateTargetData(e,t){return this.Kn(t),ur.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,ur.resolve()}removeTargets(e,t,i){let c=0;const u=[];return this.Nr.forEach(((m,_)=>{_.sequenceNumber<=t&&i.get(_.targetId)===null&&(this.Nr.delete(m),u.push(this.removeMatchingKeysForTargetId(e,_.targetId)),c++)})),ur.waitFor(u).next((()=>c))}getTargetCount(e){return ur.resolve(this.targetCount)}getTargetData(e,t){const i=this.Nr.get(t)||null;return ur.resolve(i)}addMatchingKeys(e,t,i){return this.Br.Rr(t,i),ur.resolve()}removeMatchingKeys(e,t,i){this.Br.mr(t,i);const c=this.persistence.referenceDelegate,u=[];return c&&t.forEach((m=>{u.push(c.markPotentiallyOrphaned(e,m))})),ur.waitFor(u)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),ur.resolve()}getMatchingKeysForTargetId(e,t){const i=this.Br.yr(t);return ur.resolve(i)}containsKey(e,t){return ur.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bF{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Aw(0),this.Kr=!1,this.Kr=!0,this.$r=new gF,this.referenceDelegate=e(this),this.Ur=new xF(this),this.indexManager=new cF,this.remoteDocumentCache=(function(c){return new _F(c)})((i=>this.referenceDelegate.Wr(i))),this.serializer=new aF(t),this.Gr=new pF(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new mF,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this.qr[e.toKey()];return i||(i=new yF(t,this.referenceDelegate),this.qr[e.toKey()]=i),i}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,i){_i("MemoryPersistence","Starting transaction:",e);const c=new wF(this.Qr.next());return this.referenceDelegate.zr(),i(c).next((u=>this.referenceDelegate.jr(c).next((()=>u)))).toPromise().then((u=>(c.raiseOnCommittedEvent(),u)))}Hr(e,t){return ur.or(Object.values(this.qr).map((i=>()=>i.containsKey(e,t))))}}class wF extends nD{constructor(e){super(),this.currentSequenceNumber=e}}class Fw{constructor(e){this.persistence=e,this.Jr=new Dw,this.Yr=null}static Zr(e){return new Fw(e)}get Xr(){if(this.Yr)return this.Yr;throw fo()}addReference(e,t,i){return this.Jr.addReference(i,t),this.Xr.delete(i.toString()),ur.resolve()}removeReference(e,t,i){return this.Jr.removeReference(i,t),this.Xr.add(i.toString()),ur.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),ur.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach((c=>this.Xr.add(c.toString())));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next((c=>{c.forEach((u=>this.Xr.add(u.toString())))})).next((()=>i.removeTargetData(e,t)))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ur.forEach(this.Xr,(i=>{const c=zi.fromPath(i);return this.ei(e,c).next((u=>{u||t.removeEntry(c,Io.min())}))})).next((()=>(this.Yr=null,t.apply(e))))}updateLimboDocument(e,t){return this.ei(e,t).next((i=>{i?this.Xr.delete(t.toString()):this.Xr.add(t.toString())}))}Wr(e){return 0}ei(e,t){return ur.or([()=>ur.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ow{constructor(e,t,i,c){this.targetId=e,this.fromCache=t,this.$i=i,this.Ui=c}static Wi(e,t){let i=ds(),c=ds();for(const u of t.docChanges)switch(u.type){case 0:i=i.add(u.doc.key);break;case 1:c=c.add(u.doc.key)}return new Ow(e,t.fromCache,i,c)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SF{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EF{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=(function(){return ER()?8:rD(vh())>0?6:4})()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,i,c){const u={result:null};return this.Yi(e,t).next((m=>{u.result=m})).next((()=>{if(!u.result)return this.Zi(e,t,c,i).next((m=>{u.result=m}))})).next((()=>{if(u.result)return;const m=new SF;return this.Xi(e,t,m).next((_=>{if(u.result=_,this.zi)return this.es(e,t,m,_.size)}))})).next((()=>u.result))}es(e,t,i,c){return i.documentReadCount<this.ji?(Ey()<=ys.DEBUG&&_i("QueryEngine","SDK will not create cache indexes for query:",e0(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),ur.resolve()):(Ey()<=ys.DEBUG&&_i("QueryEngine","Query:",e0(t),"scans",i.documentReadCount,"local documents and returns",c,"documents as results."),i.documentReadCount>this.Hi*c?(Ey()<=ys.DEBUG&&_i("QueryEngine","The SDK decides to create cache indexes for query:",e0(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,zf(t))):ur.resolve())}Yi(e,t){if(hE(t))return ur.resolve(null);let i=zf(t);return this.indexManager.getIndexType(e,i).next((c=>c===0?null:(t.limit!==null&&c===1&&(t=D5(t,null,"F"),i=zf(t)),this.indexManager.getDocumentsMatchingTarget(e,i).next((u=>{const m=ds(...u);return this.Ji.getDocuments(e,m).next((_=>this.indexManager.getMinOffset(e,i).next((o=>{const w=this.ts(t,_);return this.ns(t,w,m,o.readTime)?this.Yi(e,D5(t,null,"F")):this.rs(e,w,t,o)}))))})))))}Zi(e,t,i,c){return hE(t)||c.isEqual(Io.min())?ur.resolve(null):this.Ji.getDocuments(e,i).next((u=>{const m=this.ts(t,u);return this.ns(t,m,i,c)?ur.resolve(null):(Ey()<=ys.DEBUG&&_i("QueryEngine","Re-using previous result from %s to execute query: %s",c.toString(),e0(t)),this.rs(e,m,t,JN(c,-1)).next((_=>_)))}))}ts(e,t){let i=new Zu(S9(e));return t.forEach(((c,u)=>{nx(e,u)&&(i=i.add(u))})),i}ns(e,t,i,c){if(e.limit===null)return!1;if(i.size!==t.size)return!0;const u=e.limitType==="F"?t.last():t.first();return!!u&&(u.hasPendingWrites||u.version.compareTo(c)>0)}Xi(e,t,i){return Ey()<=ys.DEBUG&&_i("QueryEngine","Using full collection scan to execute query:",e0(t)),this.Ji.getDocumentsMatchingQuery(e,t,gm.min(),i)}rs(e,t,i,c){return this.Ji.getDocumentsMatchingQuery(e,i,c).next((u=>(t.forEach((m=>{u=u.insert(m.key,m)})),u)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AF{constructor(e,t,i,c){this.persistence=e,this.ss=t,this.serializer=c,this.os=new Jl(Bs),this._s=new B0((u=>Lw(u)),Pw),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(i)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new fF(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.os)))}}function TF(n,e,t,i){return new AF(n,e,t,i)}async function G9(n,e){const t=Co(n);return await t.persistence.runTransaction("Handle user change","readonly",(i=>{let c;return t.mutationQueue.getAllMutationBatches(i).next((u=>(c=u,t.ls(e),t.mutationQueue.getAllMutationBatches(i)))).next((u=>{const m=[],_=[];let o=ds();for(const w of c){m.push(w.batchId);for(const I of w.mutations)o=o.add(I.key)}for(const w of u){_.push(w.batchId);for(const I of w.mutations)o=o.add(I.key)}return t.localDocuments.getDocuments(i,o).next((w=>({hs:w,removedBatchIds:m,addedBatchIds:_})))}))}))}function IF(n,e){const t=Co(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(i=>{const c=e.batch.keys(),u=t.cs.newChangeBuffer({trackRemovals:!0});return(function(_,o,w,I){const R=w.batch,V=R.keys();let k=ur.resolve();return V.forEach((ie=>{k=k.next((()=>I.getEntry(o,ie))).next((ae=>{const fe=w.docVersions.get(ie);Sa(fe!==null),ae.version.compareTo(fe)<0&&(R.applyToRemoteDocument(ae,w),ae.isValidDocument()&&(ae.setReadTime(w.commitVersion),I.addEntry(ae)))}))})),k.next((()=>_.mutationQueue.removeMutationBatch(o,R)))})(t,i,e,u).next((()=>u.apply(i))).next((()=>t.mutationQueue.performConsistencyCheck(i))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(i,c,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,(function(_){let o=ds();for(let w=0;w<_.mutationResults.length;++w)_.mutationResults[w].transformResults.length>0&&(o=o.add(_.batch.mutations[w].key));return o})(e)))).next((()=>t.localDocuments.getDocuments(i,c)))}))}function H9(n){const e=Co(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Ur.getLastRemoteSnapshotVersion(t)))}function CF(n,e){const t=Co(n),i=e.snapshotVersion;let c=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(u=>{const m=t.cs.newChangeBuffer({trackRemovals:!0});c=t.os;const _=[];e.targetChanges.forEach(((I,R)=>{const V=c.get(R);if(!V)return;_.push(t.Ur.removeMatchingKeys(u,I.removedDocuments,R).next((()=>t.Ur.addMatchingKeys(u,I.addedDocuments,R))));let k=V.withSequenceNumber(u.currentSequenceNumber);e.targetMismatches.get(R)!==null?k=k.withResumeToken(Yu.EMPTY_BYTE_STRING,Io.min()).withLastLimboFreeSnapshotVersion(Io.min()):I.resumeToken.approximateByteSize()>0&&(k=k.withResumeToken(I.resumeToken,i)),c=c.insert(R,k),(function(ae,fe,J){return ae.resumeToken.approximateByteSize()===0||fe.snapshotVersion.toMicroseconds()-ae.snapshotVersion.toMicroseconds()>=3e8?!0:J.addedDocuments.size+J.modifiedDocuments.size+J.removedDocuments.size>0})(V,k,I)&&_.push(t.Ur.updateTargetData(u,k))}));let o=Ip(),w=ds();if(e.documentUpdates.forEach((I=>{e.resolvedLimboDocuments.has(I)&&_.push(t.persistence.referenceDelegate.updateLimboDocument(u,I))})),_.push(LF(u,m,e.documentUpdates).next((I=>{o=I.Ps,w=I.Is}))),!i.isEqual(Io.min())){const I=t.Ur.getLastRemoteSnapshotVersion(u).next((R=>t.Ur.setTargetsMetadata(u,u.currentSequenceNumber,i)));_.push(I)}return ur.waitFor(_).next((()=>m.apply(u))).next((()=>t.localDocuments.getLocalViewOfDocuments(u,o,w))).next((()=>o))})).then((u=>(t.os=c,u)))}function LF(n,e,t){let i=ds(),c=ds();return t.forEach((u=>i=i.add(u))),e.getEntries(n,i).next((u=>{let m=Ip();return t.forEach(((_,o)=>{const w=u.get(_);o.isFoundDocument()!==w.isFoundDocument()&&(c=c.add(_)),o.isNoDocument()&&o.version.isEqual(Io.min())?(e.removeEntry(_,o.readTime),m=m.insert(_,o)):!w.isValidDocument()||o.version.compareTo(w.version)>0||o.version.compareTo(w.version)===0&&w.hasPendingWrites?(e.addEntry(o),m=m.insert(_,o)):_i("LocalStore","Ignoring outdated watch update for ",_,". Current version:",w.version," Watch version:",o.version)})),{Ps:m,Is:c}}))}function PF(n,e){const t=Co(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(i=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(i,e))))}function kF(n,e){const t=Co(n);return t.persistence.runTransaction("Allocate target","readwrite",(i=>{let c;return t.Ur.getTargetData(i,e).next((u=>u?(c=u,ur.resolve(c)):t.Ur.allocateTargetId(i).next((m=>(c=new om(e,m,"TargetPurposeListen",i.currentSequenceNumber),t.Ur.addTargetData(i,c).next((()=>c)))))))})).then((i=>{const c=t.os.get(i.targetId);return(c===null||i.snapshotVersion.compareTo(c.snapshotVersion)>0)&&(t.os=t.os.insert(i.targetId,i),t._s.set(e,i.targetId)),i}))}async function j5(n,e,t){const i=Co(n),c=i.os.get(e),u=t?"readwrite":"readwrite-primary";try{t||await i.persistence.runTransaction("Release target",u,(m=>i.persistence.referenceDelegate.removeTarget(m,c)))}catch(m){if(!E_(m))throw m;_i("LocalStore",`Failed to update sequence numbers for target ${e}: ${m}`)}i.os=i.os.remove(e),i._s.delete(c.target)}function wE(n,e,t){const i=Co(n);let c=Io.min(),u=ds();return i.persistence.runTransaction("Execute query","readwrite",(m=>(function(o,w,I){const R=Co(o),V=R._s.get(I);return V!==void 0?ur.resolve(R.os.get(V)):R.Ur.getTargetData(w,I)})(i,m,zf(e)).next((_=>{if(_)return c=_.lastLimboFreeSnapshotVersion,i.Ur.getMatchingKeysForTargetId(m,_.targetId).next((o=>{u=o}))})).next((()=>i.ss.getDocumentsMatchingQuery(m,e,t?c:Io.min(),t?u:ds()))).next((_=>(MF(i,bD(e),_),{documents:_,Ts:u})))))}function MF(n,e,t){let i=n.us.get(e)||Io.min();t.forEach(((c,u)=>{u.readTime.compareTo(i)>0&&(i=u.readTime)})),n.us.set(e,i)}class SE{constructor(){this.activeTargetIds=ID()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class RF{constructor(){this.so=new SE,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,i){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new SE,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NF{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EE{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){_i("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){_i("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let w1=null;function Ob(){return w1===null?w1=(function(){return 268435456+Math.round(2147483648*Math.random())})():w1++,"0x"+w1.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DF={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FF{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fh="WebChannelConnection";class OF extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const i=t.ssl?"https":"http",c=encodeURIComponent(this.databaseId.projectId),u=encodeURIComponent(this.databaseId.database);this.Do=i+"://"+t.host,this.vo=`projects/${c}/databases/${u}`,this.Co=this.databaseId.database==="(default)"?`project_id=${c}`:`project_id=${c}&database_id=${u}`}get Fo(){return!1}Mo(t,i,c,u,m){const _=Ob(),o=this.xo(t,i.toUriEncodedString());_i("RestConnection",`Sending RPC '${t}' ${_}:`,o,c);const w={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(w,u,m),this.No(t,o,w,c).then((I=>(_i("RestConnection",`Received RPC '${t}' ${_}: `,I),I)),(I=>{throw b0("RestConnection",`RPC '${t}' ${_} failed with error: `,I,"url: ",o,"request:",c),I}))}Lo(t,i,c,u,m,_){return this.Mo(t,i,c,u,m)}Oo(t,i,c){t["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+F0})(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),i&&i.headers.forEach(((u,m)=>t[m]=u)),c&&c.headers.forEach(((u,m)=>t[m]=u))}xo(t,i){const c=DF[t];return`${this.Do}/v1/${i}:${c}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,i,c){const u=Ob();return new Promise(((m,_)=>{const o=new o9;o.setWithCredentials(!0),o.listenOnce(s9.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case $1.NO_ERROR:const I=o.getResponseJson();_i(fh,`XHR for RPC '${e}' ${u} received:`,JSON.stringify(I)),m(I);break;case $1.TIMEOUT:_i(fh,`RPC '${e}' ${u} timed out`),_(new ui(Yn.DEADLINE_EXCEEDED,"Request time out"));break;case $1.HTTP_ERROR:const R=o.getStatus();if(_i(fh,`RPC '${e}' ${u} failed with status:`,R,"response text:",o.getResponseText()),R>0){let V=o.getResponseJson();Array.isArray(V)&&(V=V[0]);const k=V?.error;if(k&&k.status&&k.message){const ie=(function(fe){const J=fe.toLowerCase().replace(/_/g,"-");return Object.values(Yn).indexOf(J)>=0?J:Yn.UNKNOWN})(k.status);_(new ui(ie,k.message))}else _(new ui(Yn.UNKNOWN,"Server responded with status "+o.getStatus()))}else _(new ui(Yn.UNAVAILABLE,"Connection failed."));break;default:fo()}}finally{_i(fh,`RPC '${e}' ${u} completed.`)}}));const w=JSON.stringify(c);_i(fh,`RPC '${e}' ${u} sending request:`,c),o.send(t,"POST",w,i,15)}))}Bo(e,t,i){const c=Ob(),u=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],m=c9(),_=l9(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},w=this.longPollingOptions.timeoutSeconds;w!==void 0&&(o.longPollingTimeout=Math.round(1e3*w)),this.useFetchStreams&&(o.useFetchStreams=!0),this.Oo(o.initMessageHeaders,t,i),o.encodeInitMessageHeaders=!0;const I=u.join("");_i(fh,`Creating RPC '${e}' stream ${c}: ${I}`,o);const R=m.createWebChannel(I,o);let V=!1,k=!1;const ie=new FF({Io:fe=>{k?_i(fh,`Not sending because RPC '${e}' stream ${c} is closed:`,fe):(V||(_i(fh,`Opening RPC '${e}' stream ${c} transport.`),R.open(),V=!0),_i(fh,`RPC '${e}' stream ${c} sending:`,fe),R.send(fe))},To:()=>R.close()}),ae=(fe,J,ne)=>{fe.listen(J,(me=>{try{ne(me)}catch(ue){setTimeout((()=>{throw ue}),0)}}))};return ae(R,Py.EventType.OPEN,(()=>{k||(_i(fh,`RPC '${e}' stream ${c} transport opened.`),ie.yo())})),ae(R,Py.EventType.CLOSE,(()=>{k||(k=!0,_i(fh,`RPC '${e}' stream ${c} transport closed`),ie.So())})),ae(R,Py.EventType.ERROR,(fe=>{k||(k=!0,b0(fh,`RPC '${e}' stream ${c} transport errored:`,fe),ie.So(new ui(Yn.UNAVAILABLE,"The operation could not be completed")))})),ae(R,Py.EventType.MESSAGE,(fe=>{var J;if(!k){const ne=fe.data[0];Sa(!!ne);const me=ne,ue=me.error||((J=me[0])===null||J===void 0?void 0:J.error);if(ue){_i(fh,`RPC '${e}' stream ${c} received error:`,ue);const ke=ue.status;let ze=(function(F){const q=Yc[F];if(q!==void 0)return D9(q)})(ke),pe=ue.message;ze===void 0&&(ze=Yn.INTERNAL,pe="Unknown error status: "+ke+" with message "+ue.message),k=!0,ie.So(new ui(ze,pe)),R.close()}else _i(fh,`RPC '${e}' stream ${c} received:`,ne),ie.bo(ne)}})),ae(_,a9.STAT_EVENT,(fe=>{fe.stat===L5.PROXY?_i(fh,`RPC '${e}' stream ${c} detected buffering proxy`):fe.stat===L5.NOPROXY&&_i(fh,`RPC '${e}' stream ${c} detected no buffering proxy`)})),setTimeout((()=>{ie.wo()}),0),ie}}function Bb(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sx(n){return new WD(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W9{constructor(e,t,i=1e3,c=1.5,u=6e4){this.ui=e,this.timerId=t,this.ko=i,this.qo=c,this.Qo=u,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),i=Math.max(0,Date.now()-this.Uo),c=Math.max(0,t-i);c>0&&_i("ExponentialBackoff",`Backing off for ${c} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,c,(()=>(this.Uo=Date.now(),e()))),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K9{constructor(e,t,i,c,u,m,_,o){this.ui=e,this.Ho=i,this.Jo=c,this.connection=u,this.authCredentialsProvider=m,this.appCheckCredentialsProvider=_,this.listener=o,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new W9(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,(()=>this.__())))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===Yn.RESOURCE_EXHAUSTED?(Tp(t.toString()),Tp("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===Yn.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([i,c])=>{this.Yo===t&&this.P_(i,c)}),(i=>{e((()=>{const c=new ui(Yn.UNKNOWN,"Fetching auth token failed: "+i.message);return this.I_(c)}))}))}P_(e,t){const i=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo((()=>{i((()=>this.listener.Eo()))})),this.stream.Ro((()=>{i((()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,(()=>(this.r_()&&(this.state=3),Promise.resolve()))),this.listener.Ro())))})),this.stream.mo((c=>{i((()=>this.I_(c)))})),this.stream.onMessage((c=>{i((()=>++this.e_==1?this.E_(c):this.onNext(c)))}))}i_(){this.state=5,this.t_.Go((async()=>{this.state=0,this.start()}))}I_(e){return _i("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget((()=>this.Yo===e?t():(_i("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class BF extends K9{constructor(e,t,i,c,u,m){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,i,c,m),this.serializer=u}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=ZD(this.serializer,e),i=(function(u){if(!("targetChange"in u))return Io.min();const m=u.targetChange;return m.targetIds&&m.targetIds.length?Io.min():m.readTime?Uf(m.readTime):Io.min()})(e);return this.listener.d_(t,i)}A_(e){const t={};t.database=z5(this.serializer),t.addTarget=(function(u,m){let _;const o=m.target;if(_=R5(o)?{documents:QD(u,o)}:{query:eF(u,o)._t},_.targetId=m.targetId,m.resumeToken.approximateByteSize()>0){_.resumeToken=B9(u,m.resumeToken);const w=F5(u,m.expectedCount);w!==null&&(_.expectedCount=w)}else if(m.snapshotVersion.compareTo(Io.min())>0){_.readTime=wv(u,m.snapshotVersion.toTimestamp());const w=F5(u,m.expectedCount);w!==null&&(_.expectedCount=w)}return _})(this.serializer,e);const i=nF(this.serializer,e);i&&(t.labels=i),this.a_(t)}R_(e){const t={};t.database=z5(this.serializer),t.removeTarget=e,this.a_(t)}}class zF extends K9{constructor(e,t,i,c,u,m){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,c,m),this.serializer=u}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return Sa(!!e.streamToken),this.lastStreamToken=e.streamToken,Sa(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Sa(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=JD(e.writeResults,e.commitTime),i=Uf(e.commitTime);return this.listener.g_(i,t)}p_(){const e={};e.database=z5(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map((i=>YD(this.serializer,i)))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jF extends class{}{constructor(e,t,i,c){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=i,this.serializer=c,this.y_=!1}w_(){if(this.y_)throw new ui(Yn.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,i,c){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([u,m])=>this.connection.Mo(e,O5(t,i),c,u,m))).catch((u=>{throw u.name==="FirebaseError"?(u.code===Yn.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),u):new ui(Yn.UNKNOWN,u.toString())}))}Lo(e,t,i,c,u){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([m,_])=>this.connection.Lo(e,O5(t,i),c,m,_,u))).catch((m=>{throw m.name==="FirebaseError"?(m.code===Yn.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),m):new ui(Yn.UNKNOWN,m.toString())}))}terminate(){this.y_=!0,this.connection.terminate()}}class UF{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve()))))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Tp(t),this.D_=!1):_i("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VF{constructor(e,t,i,c,u){this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=u,this.k_._o((m=>{i.enqueueAndForget((async()=>{mg(this)&&(_i("RemoteStore","Restarting streams for network reachability change."),await(async function(o){const w=Co(o);w.L_.add(4),await C_(w),w.q_.set("Unknown"),w.L_.delete(4),await ax(w)})(this))}))})),this.q_=new UF(i,c)}}async function ax(n){if(mg(n))for(const e of n.B_)await e(!0)}async function C_(n){for(const e of n.B_)await e(!1)}function X9(n,e){const t=Co(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Uw(t)?jw(t):z0(t).r_()&&zw(t,e))}function Bw(n,e){const t=Co(n),i=z0(t);t.N_.delete(e),i.r_()&&Z9(t,e),t.N_.size===0&&(i.r_()?i.o_():mg(t)&&t.q_.set("Unknown"))}function zw(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Io.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}z0(n).A_(e)}function Z9(n,e){n.Q_.xe(e),z0(n).R_(e)}function jw(n){n.Q_=new qD({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),z0(n).start(),n.q_.v_()}function Uw(n){return mg(n)&&!z0(n).n_()&&n.N_.size>0}function mg(n){return Co(n).L_.size===0}function Y9(n){n.Q_=void 0}async function qF(n){n.q_.set("Online")}async function $F(n){n.N_.forEach(((e,t)=>{zw(n,e)}))}async function GF(n,e){Y9(n),Uw(n)?(n.q_.M_(e),jw(n)):n.q_.set("Unknown")}async function HF(n,e,t){if(n.q_.set("Online"),e instanceof O9&&e.state===2&&e.cause)try{await(async function(c,u){const m=u.cause;for(const _ of u.targetIds)c.N_.has(_)&&(await c.remoteSyncer.rejectListen(_,m),c.N_.delete(_),c.Q_.removeTarget(_))})(n,e)}catch(i){_i("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),i),await Sv(n,i)}else if(e instanceof W1?n.Q_.Ke(e):e instanceof F9?n.Q_.He(e):n.Q_.We(e),!t.isEqual(Io.min()))try{const i=await H9(n.localStore);t.compareTo(i)>=0&&await(function(u,m){const _=u.Q_.rt(m);return _.targetChanges.forEach(((o,w)=>{if(o.resumeToken.approximateByteSize()>0){const I=u.N_.get(w);I&&u.N_.set(w,I.withResumeToken(o.resumeToken,m))}})),_.targetMismatches.forEach(((o,w)=>{const I=u.N_.get(o);if(!I)return;u.N_.set(o,I.withResumeToken(Yu.EMPTY_BYTE_STRING,I.snapshotVersion)),Z9(u,o);const R=new om(I.target,o,w,I.sequenceNumber);zw(u,R)})),u.remoteSyncer.applyRemoteEvent(_)})(n,t)}catch(i){_i("RemoteStore","Failed to raise snapshot:",i),await Sv(n,i)}}async function Sv(n,e,t){if(!E_(e))throw e;n.L_.add(1),await C_(n),n.q_.set("Offline"),t||(t=()=>H9(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{_i("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await ax(n)}))}function J9(n,e){return e().catch((t=>Sv(n,t,e)))}async function lx(n){const e=Co(n),t=_m(e);let i=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;WF(e);)try{const c=await PF(e.localStore,i);if(c===null){e.O_.length===0&&t.o_();break}i=c.batchId,KF(e,c)}catch(c){await Sv(e,c)}Q9(e)&&eI(e)}function WF(n){return mg(n)&&n.O_.length<10}function KF(n,e){n.O_.push(e);const t=_m(n);t.r_()&&t.V_&&t.m_(e.mutations)}function Q9(n){return mg(n)&&!_m(n).n_()&&n.O_.length>0}function eI(n){_m(n).start()}async function XF(n){_m(n).p_()}async function ZF(n){const e=_m(n);for(const t of n.O_)e.m_(t.mutations)}async function YF(n,e,t){const i=n.O_.shift(),c=Mw.from(i,e,t);await J9(n,(()=>n.remoteSyncer.applySuccessfulWrite(c))),await lx(n)}async function JF(n,e){e&&_m(n).V_&&await(async function(i,c){if((function(m){return jD(m)&&m!==Yn.ABORTED})(c.code)){const u=i.O_.shift();_m(i).s_(),await J9(i,(()=>i.remoteSyncer.rejectFailedWrite(u.batchId,c))),await lx(i)}})(n,e),Q9(n)&&eI(n)}async function AE(n,e){const t=Co(n);t.asyncQueue.verifyOperationInProgress(),_i("RemoteStore","RemoteStore received new credentials");const i=mg(t);t.L_.add(3),await C_(t),i&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await ax(t)}async function QF(n,e){const t=Co(n);e?(t.L_.delete(2),await ax(t)):e||(t.L_.add(2),await C_(t),t.q_.set("Unknown"))}function z0(n){return n.K_||(n.K_=(function(t,i,c){const u=Co(t);return u.w_(),new BF(i,u.connection,u.authCredentials,u.appCheckCredentials,u.serializer,c)})(n.datastore,n.asyncQueue,{Eo:qF.bind(null,n),Ro:$F.bind(null,n),mo:GF.bind(null,n),d_:HF.bind(null,n)}),n.B_.push((async e=>{e?(n.K_.s_(),Uw(n)?jw(n):n.q_.set("Unknown")):(await n.K_.stop(),Y9(n))}))),n.K_}function _m(n){return n.U_||(n.U_=(function(t,i,c){const u=Co(t);return u.w_(),new zF(i,u.connection,u.authCredentials,u.appCheckCredentials,u.serializer,c)})(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:XF.bind(null,n),mo:JF.bind(null,n),f_:ZF.bind(null,n),g_:YF.bind(null,n)}),n.B_.push((async e=>{e?(n.U_.s_(),await lx(n)):(await n.U_.stop(),n.O_.length>0&&(_i("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))}))),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vw{constructor(e,t,i,c,u){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=c,this.removalCallback=u,this.deferred=new bp,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((m=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,i,c,u){const m=Date.now()+i,_=new Vw(e,t,m,c,u);return _.start(i),_}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ui(Yn.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function qw(n,e){if(Tp("AsyncQueue",`${e}: ${n}`),E_(n))return new ui(Yn.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m0{constructor(e){this.comparator=e?(t,i)=>e(t,i)||zi.comparator(t.key,i.key):(t,i)=>zi.comparator(t.key,i.key),this.keyedMap=ky(),this.sortedSet=new Jl(this.comparator)}static emptySet(e){return new m0(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,i)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof m0)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;t.hasNext();){const c=t.getNext().key,u=i.getNext().key;if(!c.isEqual(u))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const i=new m0;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=t,i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TE{constructor(){this.W_=new Jl(zi.comparator)}track(e){const t=e.doc.key,i=this.W_.get(t);i?e.type!==0&&i.type===3?this.W_=this.W_.insert(t,e):e.type===3&&i.type!==1?this.W_=this.W_.insert(t,{type:i.type,doc:e.doc}):e.type===2&&i.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&i.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&i.type===0?this.W_=this.W_.remove(t):e.type===1&&i.type===2?this.W_=this.W_.insert(t,{type:1,doc:i.doc}):e.type===0&&i.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):fo():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal(((t,i)=>{e.push(i)})),e}}class T0{constructor(e,t,i,c,u,m,_,o,w){this.query=e,this.docs=t,this.oldDocs=i,this.docChanges=c,this.mutatedKeys=u,this.fromCache=m,this.syncStateChanged=_,this.excludesMetadataChanges=o,this.hasCachedResults=w}static fromInitialDocuments(e,t,i,c,u){const m=[];return t.forEach((_=>{m.push({type:0,doc:_})})),new T0(e,t,m0.emptySet(t),m,i,c,!0,!1,u)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&tx(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,i=e.docChanges;if(t.length!==i.length)return!1;for(let c=0;c<t.length;c++)if(t[c].type!==i[c].type||!t[c].doc.isEqual(i[c].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eO{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some((e=>e.J_()))}}class tO{constructor(){this.queries=IE(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,i){const c=Co(t),u=c.queries;c.queries=IE(),u.forEach(((m,_)=>{for(const o of _.j_)o.onError(i)}))})(this,new ui(Yn.ABORTED,"Firestore shutting down"))}}function IE(){return new B0((n=>w9(n)),tx)}async function $w(n,e){const t=Co(n);let i=3;const c=e.query;let u=t.queries.get(c);u?!u.H_()&&e.J_()&&(i=2):(u=new eO,i=e.J_()?0:1);try{switch(i){case 0:u.z_=await t.onListen(c,!0);break;case 1:u.z_=await t.onListen(c,!1);break;case 2:await t.onFirstRemoteStoreListen(c)}}catch(m){const _=qw(m,`Initialization of query '${e0(e.query)}' failed`);return void e.onError(_)}t.queries.set(c,u),u.j_.push(e),e.Z_(t.onlineState),u.z_&&e.X_(u.z_)&&Hw(t)}async function Gw(n,e){const t=Co(n),i=e.query;let c=3;const u=t.queries.get(i);if(u){const m=u.j_.indexOf(e);m>=0&&(u.j_.splice(m,1),u.j_.length===0?c=e.J_()?0:1:!u.H_()&&e.J_()&&(c=2))}switch(c){case 0:return t.queries.delete(i),t.onUnlisten(i,!0);case 1:return t.queries.delete(i),t.onUnlisten(i,!1);case 2:return t.onLastRemoteStoreUnlisten(i);default:return}}function nO(n,e){const t=Co(n);let i=!1;for(const c of e){const u=c.query,m=t.queries.get(u);if(m){for(const _ of m.j_)_.X_(c)&&(i=!0);m.z_=c}}i&&Hw(t)}function rO(n,e,t){const i=Co(n),c=i.queries.get(e);if(c)for(const u of c.j_)u.onError(t);i.queries.delete(e)}function Hw(n){n.Y_.forEach((e=>{e.next()}))}var U5,CE;(CE=U5||(U5={})).ea="default",CE.Cache="cache";class Ww{constructor(e,t,i){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=i||{}}X_(e){if(!this.options.includeMetadataChanges){const i=[];for(const c of e.docChanges)c.type!==3&&i.push(c);e=new T0(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const i=t!=="Offline";return(!this.options._a||!i)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=T0.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==U5.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tI{constructor(e){this.key=e}}class nI{constructor(e){this.key=e}}class iO{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=ds(),this.mutatedKeys=ds(),this.Aa=S9(e),this.Ra=new m0(this.Aa)}get Va(){return this.Ta}ma(e,t){const i=t?t.fa:new TE,c=t?t.Ra:this.Ra;let u=t?t.mutatedKeys:this.mutatedKeys,m=c,_=!1;const o=this.query.limitType==="F"&&c.size===this.query.limit?c.last():null,w=this.query.limitType==="L"&&c.size===this.query.limit?c.first():null;if(e.inorderTraversal(((I,R)=>{const V=c.get(I),k=nx(this.query,R)?R:null,ie=!!V&&this.mutatedKeys.has(V.key),ae=!!k&&(k.hasLocalMutations||this.mutatedKeys.has(k.key)&&k.hasCommittedMutations);let fe=!1;V&&k?V.data.isEqual(k.data)?ie!==ae&&(i.track({type:3,doc:k}),fe=!0):this.ga(V,k)||(i.track({type:2,doc:k}),fe=!0,(o&&this.Aa(k,o)>0||w&&this.Aa(k,w)<0)&&(_=!0)):!V&&k?(i.track({type:0,doc:k}),fe=!0):V&&!k&&(i.track({type:1,doc:V}),fe=!0,(o||w)&&(_=!0)),fe&&(k?(m=m.add(k),u=ae?u.add(I):u.delete(I)):(m=m.delete(I),u=u.delete(I)))})),this.query.limit!==null)for(;m.size>this.query.limit;){const I=this.query.limitType==="F"?m.last():m.first();m=m.delete(I.key),u=u.delete(I.key),i.track({type:1,doc:I})}return{Ra:m,fa:i,ns:_,mutatedKeys:u}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,i,c){const u=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const m=e.fa.G_();m.sort(((I,R)=>(function(k,ie){const ae=fe=>{switch(fe){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return fo()}};return ae(k)-ae(ie)})(I.type,R.type)||this.Aa(I.doc,R.doc))),this.pa(i),c=c!=null&&c;const _=t&&!c?this.ya():[],o=this.da.size===0&&this.current&&!c?1:0,w=o!==this.Ea;return this.Ea=o,m.length!==0||w?{snapshot:new T0(this.query,e.Ra,u,m,e.mutatedKeys,o===0,w,!1,!!i&&i.resumeToken.approximateByteSize()>0),wa:_}:{wa:_}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new TE,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach((t=>this.Ta=this.Ta.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ta=this.Ta.delete(t))),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=ds(),this.Ra.forEach((i=>{this.Sa(i.key)&&(this.da=this.da.add(i.key))}));const t=[];return e.forEach((i=>{this.da.has(i)||t.push(new nI(i))})),this.da.forEach((i=>{e.has(i)||t.push(new tI(i))})),t}ba(e){this.Ta=e.Ts,this.da=ds();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return T0.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class oO{constructor(e,t,i){this.query=e,this.targetId=t,this.view=i}}class sO{constructor(e){this.key=e,this.va=!1}}class aO{constructor(e,t,i,c,u,m){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=c,this.currentUser=u,this.maxConcurrentLimboResolutions=m,this.Ca={},this.Fa=new B0((_=>w9(_)),tx),this.Ma=new Map,this.xa=new Set,this.Oa=new Jl(zi.comparator),this.Na=new Map,this.La=new Dw,this.Ba={},this.ka=new Map,this.qa=A0.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function lO(n,e,t=!0){const i=lI(n);let c;const u=i.Fa.get(e);return u?(i.sharedClientState.addLocalQueryTarget(u.targetId),c=u.view.Da()):c=await rI(i,e,t,!0),c}async function cO(n,e){const t=lI(n);await rI(t,e,!0,!1)}async function rI(n,e,t,i){const c=await kF(n.localStore,zf(e)),u=c.targetId,m=n.sharedClientState.addLocalQueryTarget(u,t);let _;return i&&(_=await uO(n,e,u,m==="current",c.resumeToken)),n.isPrimaryClient&&t&&X9(n.remoteStore,c),_}async function uO(n,e,t,i,c){n.Ka=(R,V,k)=>(async function(ae,fe,J,ne){let me=fe.view.ma(J);me.ns&&(me=await wE(ae.localStore,fe.query,!1).then((({documents:pe})=>fe.view.ma(pe,me))));const ue=ne&&ne.targetChanges.get(fe.targetId),ke=ne&&ne.targetMismatches.get(fe.targetId)!=null,ze=fe.view.applyChanges(me,ae.isPrimaryClient,ue,ke);return PE(ae,fe.targetId,ze.wa),ze.snapshot})(n,R,V,k);const u=await wE(n.localStore,e,!0),m=new iO(e,u.Ts),_=m.ma(u.documents),o=I_.createSynthesizedTargetChangeForCurrentChange(t,i&&n.onlineState!=="Offline",c),w=m.applyChanges(_,n.isPrimaryClient,o);PE(n,t,w.wa);const I=new oO(e,t,m);return n.Fa.set(e,I),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),w.snapshot}async function hO(n,e,t){const i=Co(n),c=i.Fa.get(e),u=i.Ma.get(c.targetId);if(u.length>1)return i.Ma.set(c.targetId,u.filter((m=>!tx(m,e)))),void i.Fa.delete(e);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(c.targetId),i.sharedClientState.isActiveQueryTarget(c.targetId)||await j5(i.localStore,c.targetId,!1).then((()=>{i.sharedClientState.clearQueryState(c.targetId),t&&Bw(i.remoteStore,c.targetId),V5(i,c.targetId)})).catch(S_)):(V5(i,c.targetId),await j5(i.localStore,c.targetId,!0))}async function dO(n,e){const t=Co(n),i=t.Fa.get(e),c=t.Ma.get(i.targetId);t.isPrimaryClient&&c.length===1&&(t.sharedClientState.removeLocalQueryTarget(i.targetId),Bw(t.remoteStore,i.targetId))}async function fO(n,e,t){const i=xO(n);try{const c=await(function(m,_){const o=Co(m),w=pu.now(),I=_.reduce(((k,ie)=>k.add(ie.key)),ds());let R,V;return o.persistence.runTransaction("Locally write mutations","readwrite",(k=>{let ie=Ip(),ae=ds();return o.cs.getEntries(k,I).next((fe=>{ie=fe,ie.forEach(((J,ne)=>{ne.isValidDocument()||(ae=ae.add(J))}))})).next((()=>o.localDocuments.getOverlayedDocuments(k,ie))).next((fe=>{R=fe;const J=[];for(const ne of _){const me=DD(ne,R.get(ne.key).overlayedDocument);me!=null&&J.push(new pg(ne.key,me,p9(me.value.mapValue),jf.exists(!0)))}return o.mutationQueue.addMutationBatch(k,w,J,_)})).next((fe=>{V=fe;const J=fe.applyToLocalDocumentSet(R,ae);return o.documentOverlayCache.saveOverlays(k,fe.batchId,J)}))})).then((()=>({batchId:V.batchId,changes:A9(R)})))})(i.localStore,e);i.sharedClientState.addPendingMutation(c.batchId),(function(m,_,o){let w=m.Ba[m.currentUser.toKey()];w||(w=new Jl(Bs)),w=w.insert(_,o),m.Ba[m.currentUser.toKey()]=w})(i,c.batchId,t),await L_(i,c.changes),await lx(i.remoteStore)}catch(c){const u=qw(c,"Failed to persist write");t.reject(u)}}async function iI(n,e){const t=Co(n);try{const i=await CF(t.localStore,e);e.targetChanges.forEach(((c,u)=>{const m=t.Na.get(u);m&&(Sa(c.addedDocuments.size+c.modifiedDocuments.size+c.removedDocuments.size<=1),c.addedDocuments.size>0?m.va=!0:c.modifiedDocuments.size>0?Sa(m.va):c.removedDocuments.size>0&&(Sa(m.va),m.va=!1))})),await L_(t,i,e)}catch(i){await S_(i)}}function LE(n,e,t){const i=Co(n);if(i.isPrimaryClient&&t===0||!i.isPrimaryClient&&t===1){const c=[];i.Fa.forEach(((u,m)=>{const _=m.view.Z_(e);_.snapshot&&c.push(_.snapshot)})),(function(m,_){const o=Co(m);o.onlineState=_;let w=!1;o.queries.forEach(((I,R)=>{for(const V of R.j_)V.Z_(_)&&(w=!0)})),w&&Hw(o)})(i.eventManager,e),c.length&&i.Ca.d_(c),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function pO(n,e,t){const i=Co(n);i.sharedClientState.updateQueryState(e,"rejected",t);const c=i.Na.get(e),u=c&&c.key;if(u){let m=new Jl(zi.comparator);m=m.insert(u,_h.newNoDocument(u,Io.min()));const _=ds().add(u),o=new ox(Io.min(),new Map,new Jl(Bs),m,_);await iI(i,o),i.Oa=i.Oa.remove(u),i.Na.delete(e),Kw(i)}else await j5(i.localStore,e,!1).then((()=>V5(i,e,t))).catch(S_)}async function mO(n,e){const t=Co(n),i=e.batch.batchId;try{const c=await IF(t.localStore,e);sI(t,i,null),oI(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),await L_(t,c)}catch(c){await S_(c)}}async function gO(n,e,t){const i=Co(n);try{const c=await(function(m,_){const o=Co(m);return o.persistence.runTransaction("Reject batch","readwrite-primary",(w=>{let I;return o.mutationQueue.lookupMutationBatch(w,_).next((R=>(Sa(R!==null),I=R.keys(),o.mutationQueue.removeMutationBatch(w,R)))).next((()=>o.mutationQueue.performConsistencyCheck(w))).next((()=>o.documentOverlayCache.removeOverlaysForBatchId(w,I,_))).next((()=>o.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(w,I))).next((()=>o.localDocuments.getDocuments(w,I)))}))})(i.localStore,e);sI(i,e,t),oI(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),await L_(i,c)}catch(c){await S_(c)}}function oI(n,e){(n.ka.get(e)||[]).forEach((t=>{t.resolve()})),n.ka.delete(e)}function sI(n,e,t){const i=Co(n);let c=i.Ba[i.currentUser.toKey()];if(c){const u=c.get(e);u&&(t?u.reject(t):u.resolve(),c=c.remove(e)),i.Ba[i.currentUser.toKey()]=c}}function V5(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const i of n.Ma.get(e))n.Fa.delete(i),t&&n.Ca.$a(i,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach((i=>{n.La.containsKey(i)||aI(n,i)}))}function aI(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(Bw(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),Kw(n))}function PE(n,e,t){for(const i of t)i instanceof tI?(n.La.addReference(i.key,e),yO(n,i)):i instanceof nI?(_i("SyncEngine","Document no longer in limbo: "+i.key),n.La.removeReference(i.key,e),n.La.containsKey(i.key)||aI(n,i.key)):fo()}function yO(n,e){const t=e.key,i=t.path.canonicalString();n.Oa.get(t)||n.xa.has(i)||(_i("SyncEngine","New document in limbo: "+t),n.xa.add(i),Kw(n))}function Kw(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new zi(bl.fromString(e)),i=n.qa.next();n.Na.set(i,new sO(t)),n.Oa=n.Oa.insert(t,i),X9(n.remoteStore,new om(zf(ex(t.path)),i,"TargetPurposeLimboResolution",Aw.oe))}}async function L_(n,e,t){const i=Co(n),c=[],u=[],m=[];i.Fa.isEmpty()||(i.Fa.forEach(((_,o)=>{m.push(i.Ka(o,e,t).then((w=>{var I;if((w||t)&&i.isPrimaryClient){const R=w?!w.fromCache:(I=t?.targetChanges.get(o.targetId))===null||I===void 0?void 0:I.current;i.sharedClientState.updateQueryState(o.targetId,R?"current":"not-current")}if(w){c.push(w);const R=Ow.Wi(o.targetId,w);u.push(R)}})))})),await Promise.all(m),i.Ca.d_(c),await(async function(o,w){const I=Co(o);try{await I.persistence.runTransaction("notifyLocalViewChanges","readwrite",(R=>ur.forEach(w,(V=>ur.forEach(V.$i,(k=>I.persistence.referenceDelegate.addReference(R,V.targetId,k))).next((()=>ur.forEach(V.Ui,(k=>I.persistence.referenceDelegate.removeReference(R,V.targetId,k)))))))))}catch(R){if(!E_(R))throw R;_i("LocalStore","Failed to update sequence numbers: "+R)}for(const R of w){const V=R.targetId;if(!R.fromCache){const k=I.os.get(V),ie=k.snapshotVersion,ae=k.withLastLimboFreeSnapshotVersion(ie);I.os=I.os.insert(V,ae)}}})(i.localStore,u))}async function _O(n,e){const t=Co(n);if(!t.currentUser.isEqual(e)){_i("SyncEngine","User change. New user:",e.toKey());const i=await G9(t.localStore,e);t.currentUser=e,(function(u,m){u.ka.forEach((_=>{_.forEach((o=>{o.reject(new ui(Yn.CANCELLED,m))}))})),u.ka.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),await L_(t,i.hs)}}function vO(n,e){const t=Co(n),i=t.Na.get(e);if(i&&i.va)return ds().add(i.key);{let c=ds();const u=t.Ma.get(e);if(!u)return c;for(const m of u){const _=t.Fa.get(m);c=c.unionWith(_.view.Va)}return c}}function lI(n){const e=Co(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=iI.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=vO.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=pO.bind(null,e),e.Ca.d_=nO.bind(null,e.eventManager),e.Ca.$a=rO.bind(null,e.eventManager),e}function xO(n){const e=Co(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=mO.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=gO.bind(null,e),e}class Ev{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=sx(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return TF(this.persistence,new EF,e.initialUser,this.serializer)}Ga(e){return new bF(Fw.Zr,this.serializer)}Wa(e){return new RF}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Ev.provider={build:()=>new Ev};class q5{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>LE(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=_O.bind(null,this.syncEngine),await QF(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new tO})()}createDatastore(e){const t=sx(e.databaseInfo.databaseId),i=(function(u){return new OF(u)})(e.databaseInfo);return(function(u,m,_,o){return new jF(u,m,_,o)})(e.authCredentials,e.appCheckCredentials,i,t)}createRemoteStore(e){return(function(i,c,u,m,_){return new VF(i,c,u,m,_)})(this.localStore,this.datastore,e.asyncQueue,(t=>LE(this.syncEngine,t,0)),(function(){return EE.D()?new EE:new NF})())}createSyncEngine(e,t){return(function(c,u,m,_,o,w,I){const R=new aO(c,u,m,_,o,w);return I&&(R.Qa=!0),R})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await(async function(c){const u=Co(c);_i("RemoteStore","RemoteStore shutting down."),u.L_.add(5),await C_(u),u.k_.shutdown(),u.q_.set("Unknown")})(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}q5.provider={build:()=>new q5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xw{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Tp("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bO{constructor(e,t,i,c,u){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this.databaseInfo=c,this.user=yh.UNAUTHENTICATED,this.clientId=h9.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=u,this.authCredentials.start(i,(async m=>{_i("FirestoreClient","Received user=",m.uid),await this.authCredentialListener(m),this.user=m})),this.appCheckCredentials.start(i,(m=>(_i("FirestoreClient","Received new app check token=",m),this.appCheckCredentialListener(m,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new bp;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const i=qw(t,"Failed to shutdown persistence");e.reject(i)}})),e.promise}}async function zb(n,e){n.asyncQueue.verifyOperationInProgress(),_i("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let i=t.initialUser;n.setCredentialChangeListener((async c=>{i.isEqual(c)||(await G9(e.localStore,c),i=c)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function kE(n,e){n.asyncQueue.verifyOperationInProgress();const t=await wO(n);_i("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((i=>AE(e.remoteStore,i))),n.setAppCheckTokenChangeListener(((i,c)=>AE(e.remoteStore,c))),n._onlineComponents=e}async function wO(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){_i("FirestoreClient","Using user provided OfflineComponentProvider");try{await zb(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(c){return c.name==="FirebaseError"?c.code===Yn.FAILED_PRECONDITION||c.code===Yn.UNIMPLEMENTED:!(typeof DOMException<"u"&&c instanceof DOMException)||c.code===22||c.code===20||c.code===11})(t))throw t;b0("Error using user provided cache. Falling back to memory cache: "+t),await zb(n,new Ev)}}else _i("FirestoreClient","Using default OfflineComponentProvider"),await zb(n,new Ev);return n._offlineComponents}async function cI(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(_i("FirestoreClient","Using user provided OnlineComponentProvider"),await kE(n,n._uninitializedComponentsProvider._online)):(_i("FirestoreClient","Using default OnlineComponentProvider"),await kE(n,new q5))),n._onlineComponents}function SO(n){return cI(n).then((e=>e.syncEngine))}async function Av(n){const e=await cI(n),t=e.eventManager;return t.onListen=lO.bind(null,e.syncEngine),t.onUnlisten=hO.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=cO.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=dO.bind(null,e.syncEngine),t}function EO(n,e,t={}){const i=new bp;return n.asyncQueue.enqueueAndForget((async()=>(function(u,m,_,o,w){const I=new Xw({next:V=>{I.Za(),m.enqueueAndForget((()=>Gw(u,R)));const k=V.docs.has(_);!k&&V.fromCache?w.reject(new ui(Yn.UNAVAILABLE,"Failed to get document because the client is offline.")):k&&V.fromCache&&o&&o.source==="server"?w.reject(new ui(Yn.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):w.resolve(V)},error:V=>w.reject(V)}),R=new Ww(ex(_.path),I,{includeMetadataChanges:!0,_a:!0});return $w(u,R)})(await Av(n),n.asyncQueue,e,t,i))),i.promise}function AO(n,e,t={}){const i=new bp;return n.asyncQueue.enqueueAndForget((async()=>(function(u,m,_,o,w){const I=new Xw({next:V=>{I.Za(),m.enqueueAndForget((()=>Gw(u,R))),V.fromCache&&o.source==="server"?w.reject(new ui(Yn.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):w.resolve(V)},error:V=>w.reject(V)}),R=new Ww(_,I,{includeMetadataChanges:!0,_a:!0});return $w(u,R)})(await Av(n),n.asyncQueue,e,t,i))),i.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uI(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ME=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hI(n,e,t){if(!t)throw new ui(Yn.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function TO(n,e,t,i){if(e===!0&&i===!0)throw new ui(Yn.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function RE(n){if(!zi.isDocumentKey(n))throw new ui(Yn.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function NE(n){if(zi.isDocumentKey(n))throw new ui(Yn.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function cx(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(i){return i.constructor?i.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":fo()}function tf(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new ui(Yn.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=cx(n);throw new ui(Yn.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DE{constructor(e){var t,i;if(e.host===void 0){if(e.ssl!==void 0)throw new ui(Yn.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new ui(Yn.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}TO("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=uI((i=e.experimentalLongPollingOptions)!==null&&i!==void 0?i:{}),(function(u){if(u.timeoutSeconds!==void 0){if(isNaN(u.timeoutSeconds))throw new ui(Yn.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (must not be NaN)`);if(u.timeoutSeconds<5)throw new ui(Yn.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (minimum allowed value is 5)`);if(u.timeoutSeconds>30)throw new ui(Yn.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(i,c){return i.timeoutSeconds===c.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class ux{constructor(e,t,i,c){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=c,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new DE({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ui(Yn.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new ui(Yn.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new DE(e),e.credentials!==void 0&&(this._authCredentials=(function(i){if(!i)return new qN;switch(i.type){case"firstParty":return new WN(i.sessionIndex||"0",i.iamToken||null,i.authTokenFactory||null);case"provider":return i.client;default:throw new ui(Yn.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const i=ME.get(t);i&&(_i("ComponentProvider","Removing Datastore"),ME.delete(t),i.terminate())})(this),Promise.resolve()}}function IO(n,e,t,i={}){var c;const u=(n=tf(n,ux))._getSettings(),m=`${e}:${t}`;if(u.host!=="firestore.googleapis.com"&&u.host!==m&&b0("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},u),{host:m,ssl:!1})),i.mockUserToken){let _,o;if(typeof i.mockUserToken=="string")_=i.mockUserToken,o=yh.MOCK_USER;else{_=yR(i.mockUserToken,(c=n._app)===null||c===void 0?void 0:c.options.projectId);const w=i.mockUserToken.sub||i.mockUserToken.user_id;if(!w)throw new ui(Yn.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");o=new yh(w)}n._authCredentials=new $N(new u9(_,o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gg{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new gg(this.firestore,e,this._query)}}class Rh{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new hm(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Rh(this.firestore,e,this._key)}}class hm extends gg{constructor(e,t,i){super(e,t,ex(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Rh(this.firestore,null,new zi(e))}withConverter(e){return new hm(this.firestore,e,this._path)}}function Bm(n,e,...t){if(n=Nh(n),hI("collection","path",e),n instanceof ux){const i=bl.fromString(e,...t);return NE(i),new hm(n,null,i)}{if(!(n instanceof Rh||n instanceof hm))throw new ui(Yn.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(bl.fromString(e,...t));return NE(i),new hm(n.firestore,null,i)}}function s0(n,e,...t){if(n=Nh(n),arguments.length===1&&(e=h9.newId()),hI("doc","path",e),n instanceof ux){const i=bl.fromString(e,...t);return RE(i),new Rh(n,null,new zi(i))}{if(!(n instanceof Rh||n instanceof hm))throw new ui(Yn.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(bl.fromString(e,...t));return RE(i),new Rh(n.firestore,n instanceof hm?n.converter:null,new zi(i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FE{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new W9(this,"async_queue_retry"),this.Vu=()=>{const i=Bb();i&&_i("AsyncQueue","Visibility state changed to "+i.visibilityState),this.t_.jo()},this.mu=e;const t=Bb();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=Bb();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise((()=>{}));const t=new bp;return this.gu((()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Pu.push(e),this.pu())))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!E_(e))throw e;_i("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go((()=>this.pu()))}}gu(e){const t=this.mu.then((()=>(this.du=!0,e().catch((i=>{this.Eu=i,this.du=!1;const c=(function(m){let _=m.message||"";return m.stack&&(_=m.stack.includes(m.message)?m.stack:m.message+`
`+m.stack),_})(i);throw Tp("INTERNAL UNHANDLED ERROR: ",c),i})).then((i=>(this.du=!1,i))))));return this.mu=t,t}enqueueAfterDelay(e,t,i){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const c=Vw.createAndSchedule(this,e,t,i,(u=>this.yu(u)));return this.Tu.push(c),c}fu(){this.Eu&&fo()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then((()=>{this.Tu.sort(((t,i)=>t.targetTimeMs-i.targetTimeMs));for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()}))}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function OE(n){return(function(t,i){if(typeof t!="object"||t===null)return!1;const c=t;for(const u of i)if(u in c&&typeof c[u]=="function")return!0;return!1})(n,["next","error","complete"])}class ag extends ux{constructor(e,t,i,c){super(e,t,i,c),this.type="firestore",this._queue=new FE,this._persistenceKey=c?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new FE(e),this._firestoreClient=void 0,await e}}}function CO(n,e){const t=typeof n=="object"?n:t9(),i=typeof n=="string"?n:"(default)",c=Sw(t,"firestore").getImmediate({identifier:i});if(!c._initialized){const u=mR("firestore");u&&IO(c,...u)}return c}function hx(n){if(n._terminated)throw new ui(Yn.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||LO(n),n._firestoreClient}function LO(n){var e,t,i;const c=n._freezeSettings(),u=(function(_,o,w,I){return new sD(_,o,w,I.host,I.ssl,I.experimentalForceLongPolling,I.experimentalAutoDetectLongPolling,uI(I.experimentalLongPollingOptions),I.useFetchStreams)})(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,c);n._componentsProvider||!((t=c.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((i=c.localCache)===null||i===void 0)&&i._onlineComponentProvider)&&(n._componentsProvider={_offline:c.localCache._offlineComponentProvider,_online:c.localCache._onlineComponentProvider}),n._firestoreClient=new bO(n._authCredentials,n._appCheckCredentials,n._queue,u,n._componentsProvider&&(function(_){const o=_?._online.build();return{_offline:_?._offline.build(o),_online:o}})(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I0{constructor(e){this._byteString=e}static fromBase64String(e){try{return new I0(Yu.fromBase64String(e))}catch(t){throw new ui(Yn.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new I0(Yu.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zw{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new ui(Yn.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Xu(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yw{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dx{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new ui(Yn.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new ui(Yn.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Bs(this._lat,e._lat)||Bs(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jw{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(i,c){if(i.length!==c.length)return!1;for(let u=0;u<i.length;++u)if(i[u]!==c[u])return!1;return!0})(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PO=/^__.*__$/;class kO{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return this.fieldMask!==null?new pg(e,this.data,this.fieldMask,t,this.fieldTransforms):new T_(e,this.data,t,this.fieldTransforms)}}function dI(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw fo()}}class Qw{constructor(e,t,i,c,u,m){this.settings=e,this.databaseId=t,this.serializer=i,this.ignoreUndefinedProperties=c,u===void 0&&this.vu(),this.fieldTransforms=u||[],this.fieldMask=m||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Qw(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const i=(t=this.path)===null||t===void 0?void 0:t.child(e),c=this.Fu({path:i,xu:!1});return c.Ou(e),c}Nu(e){var t;const i=(t=this.path)===null||t===void 0?void 0:t.child(e),c=this.Fu({path:i,xu:!1});return c.vu(),c}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Tv(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(dI(this.Cu)&&PO.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class MO{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=i||sx(e)}Qu(e,t,i,c=!1){return new Qw({Cu:e,methodName:t,qu:i,path:Xu.emptyPath(),xu:!1,ku:c},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function e3(n){const e=n._freezeSettings(),t=sx(n._databaseId);return new MO(n._databaseId,!!e.ignoreUndefinedProperties,t)}function fI(n,e,t,i,c,u={}){const m=n.Qu(u.merge||u.mergeFields?2:0,e,t,c);gI("Data must be an object, but it was:",m,i);const _=pI(i,m);let o,w;if(u.merge)o=new ef(m.fieldMask),w=m.fieldTransforms;else if(u.mergeFields){const I=[];for(const R of u.mergeFields){const V=NO(e,R,t);if(!m.contains(V))throw new ui(Yn.INVALID_ARGUMENT,`Field '${V}' is specified in your field mask but missing from your input data.`);FO(I,V)||I.push(V)}o=new ef(I),w=m.fieldTransforms.filter((R=>o.covers(R.field)))}else o=null,w=m.fieldTransforms;return new kO(new Nd(_),o,w)}class t3 extends Yw{_toFieldTransform(e){return new kD(e.path,new u_)}isEqual(e){return e instanceof t3}}function RO(n,e,t,i=!1){return n3(t,n.Qu(i?4:3,e))}function n3(n,e){if(mI(n=Nh(n)))return gI("Unsupported field value:",e,n),pI(n,e);if(n instanceof Yw)return(function(i,c){if(!dI(c.Cu))throw c.Bu(`${i._methodName}() can only be used with update() and set()`);if(!c.path)throw c.Bu(`${i._methodName}() is not currently supported inside arrays`);const u=i._toFieldTransform(c);u&&c.fieldTransforms.push(u)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return(function(i,c){const u=[];let m=0;for(const _ of i){let o=n3(_,c.Lu(m));o==null&&(o={nullValue:"NULL_VALUE"}),u.push(o),m++}return{arrayValue:{values:u}}})(n,e)}return(function(i,c){if((i=Nh(i))===null)return{nullValue:"NULL_VALUE"};if(typeof i=="number")return CD(c.serializer,i);if(typeof i=="boolean")return{booleanValue:i};if(typeof i=="string")return{stringValue:i};if(i instanceof Date){const u=pu.fromDate(i);return{timestampValue:wv(c.serializer,u)}}if(i instanceof pu){const u=new pu(i.seconds,1e3*Math.floor(i.nanoseconds/1e3));return{timestampValue:wv(c.serializer,u)}}if(i instanceof dx)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof I0)return{bytesValue:B9(c.serializer,i._byteString)};if(i instanceof Rh){const u=c.databaseId,m=i.firestore._databaseId;if(!m.isEqual(u))throw c.Bu(`Document reference is for database ${m.projectId}/${m.database} but should be for database ${u.projectId}/${u.database}`);return{referenceValue:Nw(i.firestore._databaseId||c.databaseId,i._key.path)}}if(i instanceof Jw)return(function(m,_){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:m.toArray().map((o=>{if(typeof o!="number")throw _.Bu("VectorValues must only contain numeric values.");return kw(_.serializer,o)}))}}}}}})(i,c);throw c.Bu(`Unsupported field value: ${cx(i)}`)})(n,e)}function pI(n,e){const t={};return d9(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):O0(n,((i,c)=>{const u=n3(c,e.Mu(i));u!=null&&(t[i]=u)})),{mapValue:{fields:t}}}function mI(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof pu||n instanceof dx||n instanceof I0||n instanceof Rh||n instanceof Yw||n instanceof Jw)}function gI(n,e,t){if(!mI(t)||!(function(c){return typeof c=="object"&&c!==null&&(Object.getPrototypeOf(c)===Object.prototype||Object.getPrototypeOf(c)===null)})(t)){const i=cx(t);throw i==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+i)}}function NO(n,e,t){if((e=Nh(e))instanceof Zw)return e._internalPath;if(typeof e=="string")return yI(n,e);throw Tv("Field path arguments must be of type string or ",n,!1,void 0,t)}const DO=new RegExp("[~\\*/\\[\\]]");function yI(n,e,t){if(e.search(DO)>=0)throw Tv(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Zw(...e.split("."))._internalPath}catch{throw Tv(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Tv(n,e,t,i,c){const u=i&&!i.isEmpty(),m=c!==void 0;let _=`Function ${e}() called with invalid data`;t&&(_+=" (via `toFirestore()`)"),_+=". ";let o="";return(u||m)&&(o+=" (found",u&&(o+=` in field ${i}`),m&&(o+=` in document ${c}`),o+=")"),new ui(Yn.INVALID_ARGUMENT,_+n+o)}function FO(n,e){return n.some((t=>t.isEqual(e)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _I{constructor(e,t,i,c,u){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=c,this._converter=u}get id(){return this._key.path.lastSegment()}get ref(){return new Rh(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new OO(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(r3("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class OO extends _I{data(){return super.data()}}function r3(n,e){return typeof e=="string"?yI(n,e):e instanceof Zw?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vI(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new ui(Yn.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class i3{}class BO extends i3{}function BE(n,e,...t){let i=[];e instanceof i3&&i.push(e),i=i.concat(t),(function(u){const m=u.filter((o=>o instanceof o3)).length,_=u.filter((o=>o instanceof fx)).length;if(m>1||m>0&&_>0)throw new ui(Yn.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(i);for(const c of i)n=c._apply(n);return n}class fx extends BO{constructor(e,t,i){super(),this._field=e,this._op=t,this._value=i,this.type="where"}static _create(e,t,i){return new fx(e,t,i)}_apply(e){const t=this._parse(e);return xI(e._query,t),new gg(e.firestore,e.converter,N5(e._query,t))}_parse(e){const t=e3(e.firestore);return(function(u,m,_,o,w,I,R){let V;if(w.isKeyField()){if(I==="array-contains"||I==="array-contains-any")throw new ui(Yn.INVALID_ARGUMENT,`Invalid Query. You can't perform '${I}' queries on documentId().`);if(I==="in"||I==="not-in"){jE(R,I);const k=[];for(const ie of R)k.push(zE(o,u,ie));V={arrayValue:{values:k}}}else V=zE(o,u,R)}else I!=="in"&&I!=="not-in"&&I!=="array-contains-any"||jE(R,I),V=RO(_,m,R,I==="in"||I==="not-in");return Jc.create(w,I,V)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function zO(n,e,t){const i=e,c=r3("where",n);return fx._create(c,i,t)}class o3 extends i3{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new o3(e,t)}_parse(e){const t=this._queryConstraints.map((i=>i._parse(e))).filter((i=>i.getFilters().length>0));return t.length===1?t[0]:of.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(c,u){let m=c;const _=u.getFlattenedFilters();for(const o of _)xI(m,o),m=N5(m,o)})(e._query,t),new gg(e.firestore,e.converter,N5(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function zE(n,e,t){if(typeof(t=Nh(t))=="string"){if(t==="")throw new ui(Yn.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!b9(e)&&t.indexOf("/")!==-1)throw new ui(Yn.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const i=e.path.child(bl.fromString(t));if(!zi.isDocumentKey(i))throw new ui(Yn.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return oE(n,new zi(i))}if(t instanceof Rh)return oE(n,t._key);throw new ui(Yn.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${cx(t)}.`)}function jE(n,e){if(!Array.isArray(n)||n.length===0)throw new ui(Yn.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function xI(n,e){const t=(function(c,u){for(const m of c)for(const _ of m.getFlattenedFilters())if(u.indexOf(_.op)>=0)return _.op;return null})(n.filters,(function(c){switch(c){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new ui(Yn.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new ui(Yn.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class jO{convertValue(e,t="none"){switch(sg(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Dc(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(og(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw fo()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const i={};return O0(e,((c,u)=>{i[c]=this.convertValue(u,t)})),i}convertVectorValue(e){var t,i,c;const u=(c=(i=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||i===void 0?void 0:i.values)===null||c===void 0?void 0:c.map((m=>Dc(m.doubleValue)));return new Jw(u)}convertGeoPoint(e){return new dx(Dc(e.latitude),Dc(e.longitude))}convertArray(e,t){return(e.values||[]).map((i=>this.convertValue(i,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const i=Iw(e);return i==null?null:this.convertValue(i,t);case"estimate":return this.convertTimestamp(a_(e));default:return null}}convertTimestamp(e){const t=ym(e);return new pu(t.seconds,t.nanos)}convertDocumentKey(e,t){const i=bl.fromString(e);Sa($9(i));const c=new l_(i.get(1),i.get(3)),u=new zi(i.popFirst(5));return c.isEqual(t)||Tp(`Document ${u} contains a document reference within a different database (${c.projectId}/${c.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bI(n,e,t){let i;return i=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ry{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class wI extends _I{constructor(e,t,i,c,u,m){super(e,t,i,c,m),this._firestore=e,this._firestoreImpl=e,this.metadata=u}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new K1(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const i=this._document.data.field(r3("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}}class K1 extends wI{data(e={}){return super.data(e)}}class SI{constructor(e,t,i,c){this._firestore=e,this._userDataWriter=t,this._snapshot=c,this.metadata=new Ry(c.hasPendingWrites,c.fromCache),this.query=i}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((i=>{e.call(t,new K1(this._firestore,this._userDataWriter,i.key,i,new Ry(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new ui(Yn.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(c,u){if(c._snapshot.oldDocs.isEmpty()){let m=0;return c._snapshot.docChanges.map((_=>{const o=new K1(c._firestore,c._userDataWriter,_.doc.key,_.doc,new Ry(c._snapshot.mutatedKeys.has(_.doc.key),c._snapshot.fromCache),c.query.converter);return _.doc,{type:"added",doc:o,oldIndex:-1,newIndex:m++}}))}{let m=c._snapshot.oldDocs;return c._snapshot.docChanges.filter((_=>u||_.type!==3)).map((_=>{const o=new K1(c._firestore,c._userDataWriter,_.doc.key,_.doc,new Ry(c._snapshot.mutatedKeys.has(_.doc.key),c._snapshot.fromCache),c.query.converter);let w=-1,I=-1;return _.type!==0&&(w=m.indexOf(_.doc.key),m=m.delete(_.doc.key)),_.type!==1&&(m=m.add(_.doc),I=m.indexOf(_.doc.key)),{type:UO(_.type),doc:o,oldIndex:w,newIndex:I}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function UO(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return fo()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UE(n){n=tf(n,Rh);const e=tf(n.firestore,ag);return EO(hx(e),n._key).then((t=>AI(e,n,t)))}class s3 extends jO{constructor(e){super(),this.firestore=e}convertBytes(e){return new I0(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Rh(this.firestore,null,t)}}function S1(n){n=tf(n,gg);const e=tf(n.firestore,ag),t=hx(e),i=new s3(e);return vI(n._query),AO(t,n._query).then((c=>new SI(e,i,n,c)))}function $5(n,e,t){n=tf(n,Rh);const i=tf(n.firestore,ag),c=bI(n.converter,e,t);return EI(i,[fI(e3(i),"setDoc",n._key,c,n.converter!==null,t).toMutation(n._key,jf.none())])}function VE(n,e){const t=tf(n.firestore,ag),i=s0(n),c=bI(n.converter,e);return EI(t,[fI(e3(n.firestore),"addDoc",i._key,c,n.converter!==null,{}).toMutation(i._key,jf.exists(!1))]).then((()=>i))}function VO(n,...e){var t,i,c;n=Nh(n);let u={includeMetadataChanges:!1,source:"default"},m=0;typeof e[m]!="object"||OE(e[m])||(u=e[m],m++);const _={includeMetadataChanges:u.includeMetadataChanges,source:u.source};if(OE(e[m])){const R=e[m];e[m]=(t=R.next)===null||t===void 0?void 0:t.bind(R),e[m+1]=(i=R.error)===null||i===void 0?void 0:i.bind(R),e[m+2]=(c=R.complete)===null||c===void 0?void 0:c.bind(R)}let o,w,I;if(n instanceof Rh)w=tf(n.firestore,ag),I=ex(n._key.path),o={next:R=>{e[m]&&e[m](AI(w,n,R))},error:e[m+1],complete:e[m+2]};else{const R=tf(n,gg);w=tf(R.firestore,ag),I=R._query;const V=new s3(w);o={next:k=>{e[m]&&e[m](new SI(w,V,R,k))},error:e[m+1],complete:e[m+2]},vI(n._query)}return(function(V,k,ie,ae){const fe=new Xw(ae),J=new Ww(k,fe,ie);return V.asyncQueue.enqueueAndForget((async()=>$w(await Av(V),J))),()=>{fe.Za(),V.asyncQueue.enqueueAndForget((async()=>Gw(await Av(V),J)))}})(hx(w),I,_,o)}function EI(n,e){return(function(i,c){const u=new bp;return i.asyncQueue.enqueueAndForget((async()=>fO(await SO(i),c,u))),u.promise})(hx(n),e)}function AI(n,e,t){const i=t.docs.get(e._key),c=new s3(n);return new wI(n,c,e._key,i,new Ry(t.hasPendingWrites,t.fromCache),e.converter)}function E1(){return new t3("serverTimestamp")}(function(e,t=!0){(function(c){F0=c})(D0),x0(new rg("firestore",((i,{instanceIdentifier:c,options:u})=>{const m=i.getProvider("app").getImmediate(),_=new ag(new GN(i.getProvider("auth-internal")),new XN(i.getProvider("app-check-internal")),(function(w,I){if(!Object.prototype.hasOwnProperty.apply(w.options,["projectId"]))throw new ui(Yn.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new l_(w.options.projectId,I)})(m,c),m);return u=Object.assign({useFetchStreams:t},u),_._setSettings(u),_}),"PUBLIC").setMultipleInstances(!0)),um(eE,"4.7.3",e),um(eE,"4.7.3","esm2017")})();function a3(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,i=Object.getOwnPropertySymbols(n);c<i.length;c++)e.indexOf(i[c])<0&&Object.prototype.propertyIsEnumerable.call(n,i[c])&&(t[i[c]]=n[i[c]]);return t}function TI(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const qO=TI,II=new b_("auth","Firebase",TI());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Iv=new bw("@firebase/auth");function $O(n,...e){Iv.logLevel<=ys.WARN&&Iv.warn(`Auth (${D0}): ${n}`,...e)}function X1(n,...e){Iv.logLevel<=ys.ERROR&&Iv.error(`Auth (${D0}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hf(n,...e){throw c3(n,...e)}function nf(n,...e){return c3(n,...e)}function l3(n,e,t){const i=Object.assign(Object.assign({},qO()),{[e]:t});return new b_("auth","Firebase",i).create(e,{appName:n.name})}function dm(n){return l3(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function CI(n,e,t){const i=t;if(!(e instanceof i))throw i.name!==e.constructor.name&&Hf(n,"argument-error"),l3(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function c3(n,...e){if(typeof n!="string"){const t=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(t,...i)}return II.create(n,...e)}function ho(n,e,...t){if(!n)throw c3(e,...t)}function yp(n){const e="INTERNAL ASSERTION FAILED: "+n;throw X1(e),new Error(e)}function Cp(n,e){n||yp(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function G5(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function GO(){return qE()==="http:"||qE()==="https:"}function qE(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HO(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(GO()||bR()||"connection"in navigator)?navigator.onLine:!0}function WO(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P_{constructor(e,t){this.shortDelay=e,this.longDelay=t,Cp(t>e,"Short delay should be less than long delay!"),this.isMobile=_R()||wR()}get(){return HO()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u3(n,e){Cp(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LI{static initialize(e,t,i){this.fetchImpl=e,t&&(this.headersImpl=t),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;yp("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;yp("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;yp("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KO={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XO=new P_(3e4,6e4);function h3(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function j0(n,e,t,i,c={}){return PI(n,c,async()=>{let u={},m={};i&&(e==="GET"?m=i:u={body:JSON.stringify(i)});const _=w_(Object.assign({key:n.config.apiKey},m)).slice(1),o=await n._getAdditionalHeaders();o["Content-Type"]="application/json",n.languageCode&&(o["X-Firebase-Locale"]=n.languageCode);const w=Object.assign({method:e,headers:o},u);return xR()||(w.referrerPolicy="no-referrer"),LI.fetch()(kI(n,n.config.apiHost,t,_),w)})}async function PI(n,e,t){n._canInitEmulator=!1;const i=Object.assign(Object.assign({},KO),e);try{const c=new YO(n),u=await Promise.race([t(),c.promise]);c.clearNetworkTimeout();const m=await u.json();if("needConfirmation"in m)throw A1(n,"account-exists-with-different-credential",m);if(u.ok&&!("errorMessage"in m))return m;{const _=u.ok?m.errorMessage:m.error.message,[o,w]=_.split(" : ");if(o==="FEDERATED_USER_ID_ALREADY_LINKED")throw A1(n,"credential-already-in-use",m);if(o==="EMAIL_EXISTS")throw A1(n,"email-already-in-use",m);if(o==="USER_DISABLED")throw A1(n,"user-disabled",m);const I=i[o]||o.toLowerCase().replace(/[_\s]+/g,"-");if(w)throw l3(n,I,w);Hf(n,I)}}catch(c){if(c instanceof Pp)throw c;Hf(n,"network-request-failed",{message:String(c)})}}async function ZO(n,e,t,i,c={}){const u=await j0(n,e,t,i,c);return"mfaPendingCredential"in u&&Hf(n,"multi-factor-auth-required",{_serverResponse:u}),u}function kI(n,e,t,i){const c=`${e}${t}?${i}`;return n.config.emulator?u3(n.config,c):`${n.config.apiScheme}://${c}`}class YO{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,i)=>{this.timer=setTimeout(()=>i(nf(this.auth,"network-request-failed")),XO.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function A1(n,e,t){const i={appName:n.name};t.email&&(i.email=t.email),t.phoneNumber&&(i.phoneNumber=t.phoneNumber);const c=nf(n,e,i);return c.customData._tokenResponse=t,c}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function JO(n,e){return j0(n,"POST","/v1/accounts:delete",e)}async function MI(n,e){return j0(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wy(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function QO(n,e=!1){const t=Nh(n),i=await t.getIdToken(e),c=d3(i);ho(c&&c.exp&&c.auth_time&&c.iat,t.auth,"internal-error");const u=typeof c.firebase=="object"?c.firebase:void 0,m=u?.sign_in_provider;return{claims:c,token:i,authTime:Wy(jb(c.auth_time)),issuedAtTime:Wy(jb(c.iat)),expirationTime:Wy(jb(c.exp)),signInProvider:m||null,signInSecondFactor:u?.sign_in_second_factor||null}}function jb(n){return Number(n)*1e3}function d3(n){const[e,t,i]=n.split(".");if(e===void 0||t===void 0||i===void 0)return X1("JWT malformed, contained fewer than 3 sections"),null;try{const c=K6(t);return c?JSON.parse(c):(X1("Failed to decode base64 JWT payload"),null)}catch(c){return X1("Caught error parsing JWT payload as JSON",c?.toString()),null}}function $E(n){const e=d3(n);return ho(e,"internal-error"),ho(typeof e.exp<"u","internal-error"),ho(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function f_(n,e,t=!1){if(t)return e;try{return await e}catch(i){throw i instanceof Pp&&eB(i)&&n.auth.currentUser===n&&await n.auth.signOut(),i}}function eB({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tB{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const i=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),i}else{this.errorBackoff=3e4;const c=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,c)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H5{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Wy(this.lastLoginAt),this.creationTime=Wy(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Cv(n){var e;const t=n.auth,i=await n.getIdToken(),c=await f_(n,MI(t,{idToken:i}));ho(c?.users.length,t,"internal-error");const u=c.users[0];n._notifyReloadListener(u);const m=!((e=u.providerUserInfo)===null||e===void 0)&&e.length?RI(u.providerUserInfo):[],_=rB(n.providerData,m),o=n.isAnonymous,w=!(n.email&&u.passwordHash)&&!_?.length,I=o?w:!1,R={uid:u.localId,displayName:u.displayName||null,photoURL:u.photoUrl||null,email:u.email||null,emailVerified:u.emailVerified||!1,phoneNumber:u.phoneNumber||null,tenantId:u.tenantId||null,providerData:_,metadata:new H5(u.createdAt,u.lastLoginAt),isAnonymous:I};Object.assign(n,R)}async function nB(n){const e=Nh(n);await Cv(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function rB(n,e){return[...n.filter(i=>!e.some(c=>c.providerId===i.providerId)),...e]}function RI(n){return n.map(e=>{var{providerId:t}=e,i=a3(e,["providerId"]);return{providerId:t,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iB(n,e){const t=await PI(n,{},async()=>{const i=w_({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:c,apiKey:u}=n.config,m=kI(n,c,"/v1/token",`key=${u}`),_=await n._getAdditionalHeaders();return _["Content-Type"]="application/x-www-form-urlencoded",LI.fetch()(m,{method:"POST",headers:_,body:i})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function oB(n,e){return j0(n,"POST","/v2/accounts:revokeToken",h3(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g0{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ho(e.idToken,"internal-error"),ho(typeof e.idToken<"u","internal-error"),ho(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):$E(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){ho(e.length!==0,"internal-error");const t=$E(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(ho(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:i,refreshToken:c,expiresIn:u}=await iB(e,t);this.updateTokensAndExpiration(i,c,Number(u))}updateTokensAndExpiration(e,t,i){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(e,t){const{refreshToken:i,accessToken:c,expirationTime:u}=t,m=new g0;return i&&(ho(typeof i=="string","internal-error",{appName:e}),m.refreshToken=i),c&&(ho(typeof c=="string","internal-error",{appName:e}),m.accessToken=c),u&&(ho(typeof u=="number","internal-error",{appName:e}),m.expirationTime=u),m}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new g0,this.toJSON())}_performRefresh(){return yp("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zp(n,e){ho(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class _p{constructor(e){var{uid:t,auth:i,stsTokenManager:c}=e,u=a3(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new tB(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=i,this.stsTokenManager=c,this.accessToken=c.accessToken,this.displayName=u.displayName||null,this.email=u.email||null,this.emailVerified=u.emailVerified||!1,this.phoneNumber=u.phoneNumber||null,this.photoURL=u.photoURL||null,this.isAnonymous=u.isAnonymous||!1,this.tenantId=u.tenantId||null,this.providerData=u.providerData?[...u.providerData]:[],this.metadata=new H5(u.createdAt||void 0,u.lastLoginAt||void 0)}async getIdToken(e){const t=await f_(this,this.stsTokenManager.getToken(this.auth,e));return ho(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return QO(this,e)}reload(){return nB(this)}_assign(e){this!==e&&(ho(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new _p(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){ho(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let i=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),i=!0),t&&await Cv(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Df(this.auth.app))return Promise.reject(dm(this.auth));const e=await this.getIdToken();return await f_(this,JO(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var i,c,u,m,_,o,w,I;const R=(i=t.displayName)!==null&&i!==void 0?i:void 0,V=(c=t.email)!==null&&c!==void 0?c:void 0,k=(u=t.phoneNumber)!==null&&u!==void 0?u:void 0,ie=(m=t.photoURL)!==null&&m!==void 0?m:void 0,ae=(_=t.tenantId)!==null&&_!==void 0?_:void 0,fe=(o=t._redirectEventId)!==null&&o!==void 0?o:void 0,J=(w=t.createdAt)!==null&&w!==void 0?w:void 0,ne=(I=t.lastLoginAt)!==null&&I!==void 0?I:void 0,{uid:me,emailVerified:ue,isAnonymous:ke,providerData:ze,stsTokenManager:pe}=t;ho(me&&pe,e,"internal-error");const U=g0.fromJSON(this.name,pe);ho(typeof me=="string",e,"internal-error"),Zp(R,e.name),Zp(V,e.name),ho(typeof ue=="boolean",e,"internal-error"),ho(typeof ke=="boolean",e,"internal-error"),Zp(k,e.name),Zp(ie,e.name),Zp(ae,e.name),Zp(fe,e.name),Zp(J,e.name),Zp(ne,e.name);const F=new _p({uid:me,auth:e,email:V,emailVerified:ue,displayName:R,isAnonymous:ke,photoURL:ie,phoneNumber:k,tenantId:ae,stsTokenManager:U,createdAt:J,lastLoginAt:ne});return ze&&Array.isArray(ze)&&(F.providerData=ze.map(q=>Object.assign({},q))),fe&&(F._redirectEventId=fe),F}static async _fromIdTokenResponse(e,t,i=!1){const c=new g0;c.updateFromServerResponse(t);const u=new _p({uid:t.localId,auth:e,stsTokenManager:c,isAnonymous:i});return await Cv(u),u}static async _fromGetAccountInfoResponse(e,t,i){const c=t.users[0];ho(c.localId!==void 0,"internal-error");const u=c.providerUserInfo!==void 0?RI(c.providerUserInfo):[],m=!(c.email&&c.passwordHash)&&!u?.length,_=new g0;_.updateFromIdToken(i);const o=new _p({uid:c.localId,auth:e,stsTokenManager:_,isAnonymous:m}),w={uid:c.localId,displayName:c.displayName||null,photoURL:c.photoUrl||null,email:c.email||null,emailVerified:c.emailVerified||!1,phoneNumber:c.phoneNumber||null,tenantId:c.tenantId||null,providerData:u,metadata:new H5(c.createdAt,c.lastLoginAt),isAnonymous:!(c.email&&c.passwordHash)&&!u?.length};return Object.assign(o,w),o}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GE=new Map;function vp(n){Cp(n instanceof Function,"Expected a class definition");let e=GE.get(n);return e?(Cp(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,GE.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NI{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}NI.type="NONE";const HE=NI;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z1(n,e,t){return`firebase:${n}:${e}:${t}`}class y0{constructor(e,t,i){this.persistence=e,this.auth=t,this.userKey=i;const{config:c,name:u}=this.auth;this.fullUserKey=Z1(this.userKey,c.apiKey,u),this.fullPersistenceKey=Z1("persistence",c.apiKey,u),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?_p._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,i="authUser"){if(!t.length)return new y0(vp(HE),e,i);const c=(await Promise.all(t.map(async w=>{if(await w._isAvailable())return w}))).filter(w=>w);let u=c[0]||vp(HE);const m=Z1(i,e.config.apiKey,e.name);let _=null;for(const w of t)try{const I=await w._get(m);if(I){const R=_p._fromJSON(e,I);w!==u&&(_=R),u=w;break}}catch{}const o=c.filter(w=>w._shouldAllowMigration);return!u._shouldAllowMigration||!o.length?new y0(u,e,i):(u=o[0],_&&await u._set(m,_.toJSON()),await Promise.all(t.map(async w=>{if(w!==u)try{await w._remove(m)}catch{}})),new y0(u,e,i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WE(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(BI(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(DI(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(jI(e))return"Blackberry";if(UI(e))return"Webos";if(FI(e))return"Safari";if((e.includes("chrome/")||OI(e))&&!e.includes("edge/"))return"Chrome";if(zI(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=n.match(t);if(i?.length===2)return i[1]}return"Other"}function DI(n=vh()){return/firefox\//i.test(n)}function FI(n=vh()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function OI(n=vh()){return/crios\//i.test(n)}function BI(n=vh()){return/iemobile/i.test(n)}function zI(n=vh()){return/android/i.test(n)}function jI(n=vh()){return/blackberry/i.test(n)}function UI(n=vh()){return/webos/i.test(n)}function f3(n=vh()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function sB(n=vh()){var e;return f3(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function aB(){return SR()&&document.documentMode===10}function VI(n=vh()){return f3(n)||zI(n)||UI(n)||jI(n)||/windows phone/i.test(n)||BI(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qI(n,e=[]){let t;switch(n){case"Browser":t=WE(vh());break;case"Worker":t=`${WE(vh())}-${n}`;break;default:t=n}const i=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${D0}/${i}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lB{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const i=u=>new Promise((m,_)=>{try{const o=e(u);m(o)}catch(o){_(o)}});i.onAbort=t,this.queue.push(i);const c=this.queue.length-1;return()=>{this.queue[c]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const i of this.queue)await i(e),i.onAbort&&t.push(i.onAbort)}catch(i){t.reverse();for(const c of t)try{c()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i?.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cB(n,e={}){return j0(n,"GET","/v2/passwordPolicy",h3(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uB=6;class hB{constructor(e){var t,i,c,u;const m=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=m.minPasswordLength)!==null&&t!==void 0?t:uB,m.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=m.maxPasswordLength),m.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=m.containsLowercaseCharacter),m.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=m.containsUppercaseCharacter),m.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=m.containsNumericCharacter),m.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=m.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(c=(i=e.allowedNonAlphanumericCharacters)===null||i===void 0?void 0:i.join(""))!==null&&c!==void 0?c:"",this.forceUpgradeOnSignin=(u=e.forceUpgradeOnSignin)!==null&&u!==void 0?u:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,i,c,u,m,_;const o={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,o),this.validatePasswordCharacterOptions(e,o),o.isValid&&(o.isValid=(t=o.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),o.isValid&&(o.isValid=(i=o.meetsMaxPasswordLength)!==null&&i!==void 0?i:!0),o.isValid&&(o.isValid=(c=o.containsLowercaseLetter)!==null&&c!==void 0?c:!0),o.isValid&&(o.isValid=(u=o.containsUppercaseLetter)!==null&&u!==void 0?u:!0),o.isValid&&(o.isValid=(m=o.containsNumericCharacter)!==null&&m!==void 0?m:!0),o.isValid&&(o.isValid=(_=o.containsNonAlphanumericCharacter)!==null&&_!==void 0?_:!0),o}validatePasswordLengthOptions(e,t){const i=this.customStrengthOptions.minPasswordLength,c=this.customStrengthOptions.maxPasswordLength;i&&(t.meetsMinPasswordLength=e.length>=i),c&&(t.meetsMaxPasswordLength=e.length<=c)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let i;for(let c=0;c<e.length;c++)i=e.charAt(c),this.updatePasswordCharacterOptionsStatuses(t,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(e,t,i,c,u){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=c)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dB{constructor(e,t,i,c){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=i,this.config=c,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new KE(this),this.idTokenSubscription=new KE(this),this.beforeStateQueue=new lB(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=II,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=c.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=vp(t)),this._initializationPromise=this.queue(async()=>{var i,c;if(!this._deleted&&(this.persistenceManager=await y0.create(this,e),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((c=this.currentUser)===null||c===void 0?void 0:c.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await MI(this,{idToken:e}),i=await _p._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(i)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(Df(this.app)){const m=this.app.settings.authIdToken;return m?new Promise(_=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(m).then(_,_))}):this.directlySetCurrentUser(null)}const i=await this.assertedPersistence.getCurrentUser();let c=i,u=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const m=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,_=c?._redirectEventId,o=await this.tryRedirectSignIn(e);(!m||m===_)&&o?.user&&(c=o.user,u=!0)}if(!c)return this.directlySetCurrentUser(null);if(!c._redirectEventId){if(u)try{await this.beforeStateQueue.runMiddleware(c)}catch(m){c=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(m))}return c?this.reloadAndSetCurrentUserOrClear(c):this.directlySetCurrentUser(null)}return ho(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===c._redirectEventId?this.directlySetCurrentUser(c):this.reloadAndSetCurrentUserOrClear(c)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Cv(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=WO()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Df(this.app))return Promise.reject(dm(this));const t=e?Nh(e):null;return t&&ho(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&ho(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Df(this.app)?Promise.reject(dm(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Df(this.app)?Promise.reject(dm(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(vp(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await cB(this),t=new hB(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new b_("auth","Firebase",e())}onAuthStateChanged(e,t,i){return this.registerStateListener(this.authStateSubscription,e,t,i)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,i){return this.registerStateListener(this.idTokenSubscription,e,t,i)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const i=this.onAuthStateChanged(()=>{i(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(i.tenantId=this.tenantId),await oB(this,i)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const i=await this.getOrInitRedirectPersistenceManager(t);return e===null?i.removeCurrentUser():i.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&vp(e)||this._popupRedirectResolver;ho(t,this,"argument-error"),this.redirectPersistenceManager=await y0.create(this,[vp(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,i;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const i=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,i,c){if(this._deleted)return()=>{};const u=typeof t=="function"?t:t.next.bind(t);let m=!1;const _=this._isInitialized?Promise.resolve():this._initializationPromise;if(ho(_,this,"internal-error"),_.then(()=>{m||u(this.currentUser)}),typeof t=="function"){const o=e.addObserver(t,i,c);return()=>{m=!0,o()}}else{const o=e.addObserver(t);return()=>{m=!0,o()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ho(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=qI(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const i=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());i&&(t["X-Firebase-Client"]=i);const c=await this._getAppCheckToken();return c&&(t["X-Firebase-AppCheck"]=c),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t?.error&&$O(`Error while retrieving App Check token: ${t.error}`),t?.token}}function U0(n){return Nh(n)}class KE{constructor(e){this.auth=e,this.observer=null,this.addObserver=kR(t=>this.observer=t)}get next(){return ho(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let p3={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function fB(n){p3=n}function pB(n){return p3.loadJS(n)}function mB(){return p3.gapiScript}function gB(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yB(n,e){const t=Sw(n,"auth");if(t.isInitialized()){const c=t.getImmediate(),u=t.getOptions();if(gv(u,e??{}))return c;Hf(c,"already-initialized")}return t.initialize({options:e})}function _B(n,e){const t=e?.persistence||[],i=(Array.isArray(t)?t:[t]).map(vp);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(i,e?.popupRedirectResolver)}function vB(n,e,t){const i=U0(n);ho(i._canInitEmulator,i,"emulator-config-failed"),ho(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");const c=!1,u=$I(e),{host:m,port:_}=xB(e),o=_===null?"":`:${_}`;i.config.emulator={url:`${u}//${m}${o}/`},i.settings.appVerificationDisabledForTesting=!0,i.emulatorConfig=Object.freeze({host:m,port:_,protocol:u.replace(":",""),options:Object.freeze({disableWarnings:c})}),bB()}function $I(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function xB(n){const e=$I(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const i=t[2].split("@").pop()||"",c=/^(\[[^\]]+\])(:|$)/.exec(i);if(c){const u=c[1];return{host:u,port:XE(i.substr(u.length+1))}}else{const[u,m]=i.split(":");return{host:u,port:XE(m)}}}function XE(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function bB(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GI{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return yp("not implemented")}_getIdTokenResponse(e){return yp("not implemented")}_linkToIdToken(e,t){return yp("not implemented")}_getReauthenticationResolver(e){return yp("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _0(n,e){return ZO(n,"POST","/v1/accounts:signInWithIdp",h3(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wB="http://localhost";class lg extends GI{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new lg(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Hf("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:i,signInMethod:c}=t,u=a3(t,["providerId","signInMethod"]);if(!i||!c)return null;const m=new lg(i,c);return m.idToken=u.idToken||void 0,m.accessToken=u.accessToken||void 0,m.secret=u.secret,m.nonce=u.nonce,m.pendingToken=u.pendingToken||null,m}_getIdTokenResponse(e){const t=this.buildRequest();return _0(e,t)}_linkToIdToken(e,t){const i=this.buildRequest();return i.idToken=t,_0(e,i)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,_0(e,t)}buildRequest(){const e={requestUri:wB,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=w_(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class px{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k_ extends px{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tm extends k_{constructor(){super("facebook.com")}static credential(e){return lg._fromParams({providerId:tm.PROVIDER_ID,signInMethod:tm.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return tm.credentialFromTaggedObject(e)}static credentialFromError(e){return tm.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return tm.credential(e.oauthAccessToken)}catch{return null}}}tm.FACEBOOK_SIGN_IN_METHOD="facebook.com";tm.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rf extends k_{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return lg._fromParams({providerId:Rf.PROVIDER_ID,signInMethod:Rf.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Rf.credentialFromTaggedObject(e)}static credentialFromError(e){return Rf.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:i}=e;if(!t&&!i)return null;try{return Rf.credential(t,i)}catch{return null}}}Rf.GOOGLE_SIGN_IN_METHOD="google.com";Rf.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nm extends k_{constructor(){super("github.com")}static credential(e){return lg._fromParams({providerId:nm.PROVIDER_ID,signInMethod:nm.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return nm.credentialFromTaggedObject(e)}static credentialFromError(e){return nm.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return nm.credential(e.oauthAccessToken)}catch{return null}}}nm.GITHUB_SIGN_IN_METHOD="github.com";nm.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rm extends k_{constructor(){super("twitter.com")}static credential(e,t){return lg._fromParams({providerId:rm.PROVIDER_ID,signInMethod:rm.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return rm.credentialFromTaggedObject(e)}static credentialFromError(e){return rm.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:i}=e;if(!t||!i)return null;try{return rm.credential(t,i)}catch{return null}}}rm.TWITTER_SIGN_IN_METHOD="twitter.com";rm.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C0{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,i,c=!1){const u=await _p._fromIdTokenResponse(e,i,c),m=ZE(i);return new C0({user:u,providerId:m,_tokenResponse:i,operationType:t})}static async _forOperation(e,t,i){await e._updateTokensIfNecessary(i,!0);const c=ZE(i);return new C0({user:e,providerId:c,_tokenResponse:i,operationType:t})}}function ZE(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lv extends Pp{constructor(e,t,i,c){var u;super(t.code,t.message),this.operationType=i,this.user=c,Object.setPrototypeOf(this,Lv.prototype),this.customData={appName:e.name,tenantId:(u=e.tenantId)!==null&&u!==void 0?u:void 0,_serverResponse:t.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(e,t,i,c){return new Lv(e,t,i,c)}}function HI(n,e,t,i){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(u=>{throw u.code==="auth/multi-factor-auth-required"?Lv._fromErrorAndOperation(n,u,e,i):u})}async function SB(n,e,t=!1){const i=await f_(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return C0._forOperation(n,"link",i)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function EB(n,e,t=!1){const{auth:i}=n;if(Df(i.app))return Promise.reject(dm(i));const c="reauthenticate";try{const u=await f_(n,HI(i,c,e,n),t);ho(u.idToken,i,"internal-error");const m=d3(u.idToken);ho(m,i,"internal-error");const{sub:_}=m;return ho(n.uid===_,i,"user-mismatch"),C0._forOperation(n,c,u)}catch(u){throw u?.code==="auth/user-not-found"&&Hf(i,"user-mismatch"),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function AB(n,e,t=!1){if(Df(n.app))return Promise.reject(dm(n));const i="signIn",c=await HI(n,i,e),u=await C0._fromIdTokenResponse(n,i,c);return t||await n._updateCurrentUser(u.user),u}function TB(n,e,t,i){return Nh(n).onIdTokenChanged(e,t,i)}function IB(n,e,t){return Nh(n).beforeAuthStateChanged(e,t)}function CB(n,e,t,i){return Nh(n).onAuthStateChanged(e,t,i)}function LB(n){return Nh(n).signOut()}const Pv="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WI{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Pv,"1"),this.storage.removeItem(Pv),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PB=1e3,kB=10;class KI extends WI{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=VI(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const i=this.storage.getItem(t),c=this.localCache[t];i!==c&&e(t,c,i)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((m,_,o)=>{this.notifyListeners(m,o)});return}const i=e.key;t?this.detachListener():this.stopPolling();const c=()=>{const m=this.storage.getItem(i);!t&&this.localCache[i]===m||this.notifyListeners(i,m)},u=this.storage.getItem(i);aB()&&u!==e.newValue&&e.newValue!==e.oldValue?setTimeout(c,kB):c()}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const c of Array.from(i))c(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:i}),!0)})},PB)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}KI.type="LOCAL";const MB=KI;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XI extends WI{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}XI.type="SESSION";const ZI=XI;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RB(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mx{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(c=>c.isListeningto(e));if(t)return t;const i=new mx(e);return this.receivers.push(i),i}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:i,eventType:c,data:u}=t.data,m=this.handlersMap[c];if(!m?.size)return;t.ports[0].postMessage({status:"ack",eventId:i,eventType:c});const _=Array.from(m).map(async w=>w(t.origin,u)),o=await RB(_);t.ports[0].postMessage({status:"done",eventId:i,eventType:c,response:o})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}mx.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m3(n="",e=10){let t="";for(let i=0;i<e;i++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NB{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,i=50){const c=typeof MessageChannel<"u"?new MessageChannel:null;if(!c)throw new Error("connection_unavailable");let u,m;return new Promise((_,o)=>{const w=m3("",20);c.port1.start();const I=setTimeout(()=>{o(new Error("unsupported_event"))},i);m={messageChannel:c,onMessage(R){const V=R;if(V.data.eventId===w)switch(V.data.status){case"ack":clearTimeout(I),u=setTimeout(()=>{o(new Error("timeout"))},3e3);break;case"done":clearTimeout(u),_(V.data.response);break;default:clearTimeout(I),clearTimeout(u),o(new Error("invalid_response"));break}}},this.handlers.add(m),c.port1.addEventListener("message",m.onMessage),this.target.postMessage({eventType:e,eventId:w,data:t},[c.port2])}).finally(()=>{m&&this.removeMessageHandler(m)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vf(){return window}function DB(n){Vf().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YI(){return typeof Vf().WorkerGlobalScope<"u"&&typeof Vf().importScripts=="function"}async function FB(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function OB(){var n;return((n=navigator?.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function BB(){return YI()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JI="firebaseLocalStorageDb",zB=1,kv="firebaseLocalStorage",QI="fbase_key";class M_{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function gx(n,e){return n.transaction([kv],e?"readwrite":"readonly").objectStore(kv)}function jB(){const n=indexedDB.deleteDatabase(JI);return new M_(n).toPromise()}function W5(){const n=indexedDB.open(JI,zB);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const i=n.result;try{i.createObjectStore(kv,{keyPath:QI})}catch(c){t(c)}}),n.addEventListener("success",async()=>{const i=n.result;i.objectStoreNames.contains(kv)?e(i):(i.close(),await jB(),e(await W5()))})})}async function YE(n,e,t){const i=gx(n,!0).put({[QI]:e,value:t});return new M_(i).toPromise()}async function UB(n,e){const t=gx(n,!1).get(e),i=await new M_(t).toPromise();return i===void 0?null:i.value}function JE(n,e){const t=gx(n,!0).delete(e);return new M_(t).toPromise()}const VB=800,qB=3;class e8{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await W5(),this.db)}async _withRetries(e){let t=0;for(;;)try{const i=await this._openDb();return await e(i)}catch(i){if(t++>qB)throw i;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return YI()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=mx._getInstance(BB()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await FB(),!this.activeServiceWorker)return;this.sender=new NB(this.activeServiceWorker);const i=await this.sender._send("ping",{},800);i&&!((e=i[0])===null||e===void 0)&&e.fulfilled&&!((t=i[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||OB()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await W5();return await YE(e,Pv,"1"),await JE(e,Pv),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(i=>YE(i,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(i=>UB(i,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>JE(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(c=>{const u=gx(c,!1).getAll();return new M_(u).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],i=new Set;if(e.length!==0)for(const{fbase_key:c,value:u}of e)i.add(c),JSON.stringify(this.localCache[c])!==JSON.stringify(u)&&(this.notifyListeners(c,u),t.push(c));for(const c of Object.keys(this.localCache))this.localCache[c]&&!i.has(c)&&(this.notifyListeners(c,null),t.push(c));return t}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const c of Array.from(i))c(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),VB)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}e8.type="LOCAL";const $B=e8;new P_(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g3(n,e){return e?vp(e):(ho(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y3 extends GI{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return _0(e,this._buildIdpRequest())}_linkToIdToken(e,t){return _0(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return _0(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function GB(n){return AB(n.auth,new y3(n),n.bypassAuthState)}function HB(n){const{auth:e,user:t}=n;return ho(t,e,"internal-error"),EB(t,new y3(n),n.bypassAuthState)}async function WB(n){const{auth:e,user:t}=n;return ho(t,e,"internal-error"),SB(t,new y3(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t8{constructor(e,t,i,c,u=!1){this.auth=e,this.resolver=i,this.user=c,this.bypassAuthState=u,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:i,postBody:c,tenantId:u,error:m,type:_}=e;if(m){this.reject(m);return}const o={auth:this.auth,requestUri:t,sessionId:i,tenantId:u||void 0,postBody:c||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(_)(o))}catch(w){this.reject(w)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return GB;case"linkViaPopup":case"linkViaRedirect":return WB;case"reauthViaPopup":case"reauthViaRedirect":return HB;default:Hf(this.auth,"internal-error")}}resolve(e){Cp(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Cp(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KB=new P_(2e3,1e4);async function XB(n,e,t){if(Df(n.app))return Promise.reject(nf(n,"operation-not-supported-in-this-environment"));const i=U0(n);CI(n,e,px);const c=g3(i,t);return new Zm(i,"signInViaPopup",e,c).executeNotNull()}class Zm extends t8{constructor(e,t,i,c,u){super(e,t,c,u),this.provider=i,this.authWindow=null,this.pollId=null,Zm.currentPopupAction&&Zm.currentPopupAction.cancel(),Zm.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ho(e,this.auth,"internal-error"),e}async onExecution(){Cp(this.filter.length===1,"Popup operations only handle one event");const e=m3();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(nf(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(nf(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Zm.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,i;if(!((i=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||i===void 0)&&i.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(nf(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,KB.get())};e()}}Zm.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZB="pendingRedirect",Y1=new Map;class YB extends t8{constructor(e,t,i=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,i),this.eventId=null}async execute(){let e=Y1.get(this.auth._key());if(!e){try{const i=await JB(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(i)}catch(t){e=()=>Promise.reject(t)}Y1.set(this.auth._key(),e)}return this.bypassAuthState||Y1.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function JB(n,e){const t=r8(e),i=n8(n);if(!await i._isAvailable())return!1;const c=await i._get(t)==="true";return await i._remove(t),c}async function QB(n,e){return n8(n)._set(r8(e),"true")}function ez(n,e){Y1.set(n._key(),e)}function n8(n){return vp(n._redirectPersistence)}function r8(n){return Z1(ZB,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tz(n,e,t){return nz(n,e,t)}async function nz(n,e,t){if(Df(n.app))return Promise.reject(dm(n));const i=U0(n);CI(n,e,px),await i._initializationPromise;const c=g3(i,t);return await QB(c,i),c._openRedirect(i,e,"signInViaRedirect")}async function rz(n,e){return await U0(n)._initializationPromise,i8(n,e,!1)}async function i8(n,e,t=!1){if(Df(n.app))return Promise.reject(dm(n));const i=U0(n),c=g3(i,e),m=await new YB(i,c,t).execute();return m&&!t&&(delete m.user._redirectEventId,await i._persistUserIfCurrent(m.user),await i._setRedirectUser(null,e)),m}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iz=600*1e3;class oz{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(e,i)&&(t=!0,this.sendToConsumer(e,i),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!sz(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var i;if(e.error&&!o8(e)){const c=((i=e.error.code)===null||i===void 0?void 0:i.split("auth/")[1])||"internal-error";t.onError(nf(this.auth,c))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const i=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&i}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=iz&&this.cachedEventUids.clear(),this.cachedEventUids.has(QE(e))}saveEventToCache(e){this.cachedEventUids.add(QE(e)),this.lastProcessedEventTime=Date.now()}}function QE(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function o8({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function sz(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return o8(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function az(n,e={}){return j0(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lz=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,cz=/^https?/;async function uz(n){if(n.config.emulator)return;const{authorizedDomains:e}=await az(n);for(const t of e)try{if(hz(t))return}catch{}Hf(n,"unauthorized-domain")}function hz(n){const e=G5(),{protocol:t,hostname:i}=new URL(e);if(n.startsWith("chrome-extension://")){const m=new URL(n);return m.hostname===""&&i===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&m.hostname===i}if(!cz.test(t))return!1;if(lz.test(n))return i===n;const c=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+c+"|"+c+")$","i").test(i)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dz=new P_(3e4,6e4);function eA(){const n=Vf().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function fz(n){return new Promise((e,t)=>{var i,c,u;function m(){eA(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{eA(),t(nf(n,"network-request-failed"))},timeout:dz.get()})}if(!((c=(i=Vf().gapi)===null||i===void 0?void 0:i.iframes)===null||c===void 0)&&c.Iframe)e(gapi.iframes.getContext());else if(!((u=Vf().gapi)===null||u===void 0)&&u.load)m();else{const _=gB("iframefcb");return Vf()[_]=()=>{gapi.load?m():t(nf(n,"network-request-failed"))},pB(`${mB()}?onload=${_}`).catch(o=>t(o))}}).catch(e=>{throw J1=null,e})}let J1=null;function pz(n){return J1=J1||fz(n),J1}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mz=new P_(5e3,15e3),gz="__/auth/iframe",yz="emulator/auth/iframe",_z={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},vz=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function xz(n){const e=n.config;ho(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?u3(e,yz):`https://${n.config.authDomain}/${gz}`,i={apiKey:e.apiKey,appName:n.name,v:D0},c=vz.get(n.config.apiHost);c&&(i.eid=c);const u=n._getFrameworks();return u.length&&(i.fw=u.join(",")),`${t}?${w_(i).slice(1)}`}async function bz(n){const e=await pz(n),t=Vf().gapi;return ho(t,n,"internal-error"),e.open({where:document.body,url:xz(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:_z,dontclear:!0},i=>new Promise(async(c,u)=>{await i.restyle({setHideOnLeave:!1});const m=nf(n,"network-request-failed"),_=Vf().setTimeout(()=>{u(m)},mz.get());function o(){Vf().clearTimeout(_),c(i)}i.ping(o).then(o,()=>{u(m)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wz={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Sz=500,Ez=600,Az="_blank",Tz="http://localhost";class tA{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Iz(n,e,t,i=Sz,c=Ez){const u=Math.max((window.screen.availHeight-c)/2,0).toString(),m=Math.max((window.screen.availWidth-i)/2,0).toString();let _="";const o=Object.assign(Object.assign({},wz),{width:i.toString(),height:c.toString(),top:u,left:m}),w=vh().toLowerCase();t&&(_=OI(w)?Az:t),DI(w)&&(e=e||Tz,o.scrollbars="yes");const I=Object.entries(o).reduce((V,[k,ie])=>`${V}${k}=${ie},`,"");if(sB(w)&&_!=="_self")return Cz(e||"",_),new tA(null);const R=window.open(e||"",_,I);ho(R,n,"popup-blocked");try{R.focus()}catch{}return new tA(R)}function Cz(n,e){const t=document.createElement("a");t.href=n,t.target=e;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lz="__/auth/handler",Pz="emulator/auth/handler",kz=encodeURIComponent("fac");async function nA(n,e,t,i,c,u){ho(n.config.authDomain,n,"auth-domain-config-required"),ho(n.config.apiKey,n,"invalid-api-key");const m={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:i,v:D0,eventId:c};if(e instanceof px){e.setDefaultLanguage(n.languageCode),m.providerId=e.providerId||"",PR(e.getCustomParameters())||(m.customParameters=JSON.stringify(e.getCustomParameters()));for(const[I,R]of Object.entries({}))m[I]=R}if(e instanceof k_){const I=e.getScopes().filter(R=>R!=="");I.length>0&&(m.scopes=I.join(","))}n.tenantId&&(m.tid=n.tenantId);const _=m;for(const I of Object.keys(_))_[I]===void 0&&delete _[I];const o=await n._getAppCheckToken(),w=o?`#${kz}=${encodeURIComponent(o)}`:"";return`${Mz(n)}?${w_(_).slice(1)}${w}`}function Mz({config:n}){return n.emulator?u3(n,Pz):`https://${n.authDomain}/${Lz}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ub="webStorageSupport";class Rz{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ZI,this._completeRedirectFn=i8,this._overrideRedirectResult=ez}async _openPopup(e,t,i,c){var u;Cp((u=this.eventManagers[e._key()])===null||u===void 0?void 0:u.manager,"_initialize() not called before _openPopup()");const m=await nA(e,t,i,G5(),c);return Iz(e,m,m3())}async _openRedirect(e,t,i,c){await this._originValidation(e);const u=await nA(e,t,i,G5(),c);return DB(u),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:c,promise:u}=this.eventManagers[t];return c?Promise.resolve(c):(Cp(u,"If manager is not set, promise should be"),u)}const i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}async initAndGetManager(e){const t=await bz(e),i=new oz(e);return t.register("authEvent",c=>(ho(c?.authEvent,e,"invalid-auth-event"),{status:i.onEvent(c.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:i},this.iframes[e._key()]=t,i}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Ub,{type:Ub},c=>{var u;const m=(u=c?.[0])===null||u===void 0?void 0:u[Ub];m!==void 0&&t(!!m),Hf(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=uz(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return VI()||FI()||f3()}}const Nz=Rz;var rA="@firebase/auth",iA="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dz{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(i=>{e(i?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){ho(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fz(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Oz(n){x0(new rg("auth",(e,{options:t})=>{const i=e.getProvider("app").getImmediate(),c=e.getProvider("heartbeat"),u=e.getProvider("app-check-internal"),{apiKey:m,authDomain:_}=i.options;ho(m&&!m.includes(":"),"invalid-api-key",{appName:i.name});const o={apiKey:m,authDomain:_,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:qI(n)},w=new dB(i,c,u,o);return _B(w,t),w},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,i)=>{e.getProvider("auth-internal").initialize()})),x0(new rg("auth-internal",e=>{const t=U0(e.getProvider("auth").getImmediate());return(i=>new Dz(i))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),um(rA,iA,Fz(n)),um(rA,iA,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bz=300,zz=Y6("authIdTokenMaxAge")||Bz;let oA=null;const jz=n=>async e=>{const t=e&&await e.getIdTokenResult(),i=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(i&&i>zz)return;const c=t?.token;oA!==c&&(oA=c,await fetch(n,{method:c?"POST":"DELETE",headers:c?{Authorization:`Bearer ${c}`}:{}}))};function Q1(n=t9()){const e=Sw(n,"auth");if(e.isInitialized())return e.getImmediate();const t=yB(n,{popupRedirectResolver:Nz,persistence:[$B,MB,ZI]}),i=Y6("authTokenSyncURL");if(i&&typeof isSecureContext=="boolean"&&isSecureContext){const u=new URL(i,location.origin);if(location.origin===u.origin){const m=jz(u.toString());IB(t,m,()=>m(t.currentUser)),TB(t,_=>m(_))}}const c=X6("auth");return c&&vB(t,`http://${c}`),t}function Uz(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}fB({loadJS(n){return new Promise((e,t)=>{const i=document.createElement("script");i.setAttribute("src",n),i.onload=e,i.onerror=c=>{const u=nf("internal-error");u.customData=c,t(u)},i.type="text/javascript",i.charset="UTF-8",Uz().appendChild(i)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Oz("Browser");const Vz={apiKey:"AIzaSyDqdNAi8z3vx8TJcbVwUN37GJtt4vGH_Cs",authDomain:"stakeholder-map-a4bdc.firebaseapp.com",projectId:"stakeholder-map-a4bdc",storageBucket:"stakeholder-map-a4bdc.firebasestorage.app",messagingSenderId:"201968932417",appId:"1:201968932417:web:c6053a304f5dc5f2ffd8c0",measurementId:"G-BEB17GFMBJ"},s8=e9(Vz),mh=CO(s8);Q1(s8);new Rf;const qz=[{value:5,label:"5 - Excellent"},{value:4,label:"4 - Good"},{value:3,label:"3 - Adequate"},{value:2,label:"2 - Poor"},{value:1,label:"1 - Very Poor"},{value:0,label:"0 - Not Set"}],sA={buildingName:"",notes:"",scores:{architecture:{exterior:0,entrances:0,interiorFinishes:0,lifeSafety:0,codesAndAccessibility:0},engineering:{superstructure:0,conveyingSystems:0,fireProtection:0,plumbing:0,mechanical:0,power:0,lighting:0},functionality:{telecomm:0,fireAlarm:0,spaceSize:0,technology:0}}},$z=({buildingId:n,assessments:e,onClose:t,onSave:i,universityId:c,panelPos:u,isAdminRole:m})=>{const[_,o]=Nn.useState(sA);Nn.useEffect(()=>{if(n&&e){const k=e[n]||{...sA,buildingName:n};o(k)}},[n,e]);const w=(k,ie,ae)=>{o(fe=>({...fe,scores:{...fe.scores,[k]:{...fe.scores[k],[ie]:Number(ae)}}}))},I=k=>{o(ie=>({...ie,notes:k.target.value}))},R=async()=>{if(!m){alert("Save failed: you are not signed in as an admin.");return}if(!n||!c)return;const k=n.replace(/\//g,"__"),ie=s0(mh,"universities",c,"buildingAssessments",k),ae={..._,originalId:n};try{await $5(ie,ae),i(ae),alert("Assessment saved successfully!"),t()}catch(fe){console.error("Error saving assessment:",fe),alert("Failed to save assessment. See console for details.")}};if(!n)return null;const V=u?{position:"absolute",left:u.x??80,top:u.y??160,zIndex:6}:void 0;return Y.jsxs("div",{className:"assessment-panel",style:V,children:[Y.jsxs("div",{className:"panel-header",children:[Y.jsx("h3",{children:"Technical Assessment"}),Y.jsx("button",{onClick:t,className:"close-button",children:""})]}),Y.jsxs("div",{className:"panel-content",children:[Y.jsx("h4",{children:_.buildingName||n}),_.scores&&Object.entries(_.scores).map(([k,ie])=>Y.jsxs("div",{className:"category-section",children:[Y.jsx("h5",{children:k.charAt(0).toUpperCase()+k.slice(1)}),Object.entries(ie).map(([ae,fe])=>Y.jsxs("div",{className:"score-item",children:[Y.jsx("label",{children:ae.replace(/([A-Z])/g," $1").trim()}),Y.jsx("select",{value:fe,onChange:J=>w(k,ae,J.target.value),children:qz.map(J=>Y.jsx("option",{value:J.value,children:J.label},J.value))})]},ae))]},k)),Y.jsxs("div",{className:"notes-section",children:[Y.jsx("h5",{children:"Notes"}),Y.jsx("textarea",{value:_.notes||"",onChange:I,rows:"4"})]}),Y.jsx("button",{className:"save-button",onClick:R,children:"Save Changes"})]})]})},Gz=({buildingId:n,buildingName:e,currentCondition:t,onSave:i,onOpenTechnical:c,onClose:u,floorplans:m,onSelectFloorplan:_})=>{const[o,w]=Nn.useState(t??"");Nn.useEffect(()=>{w(t??"")},[n,t]);const I=()=>{n&&o&&i(n,o)},R=(o||"")!==(t||"");return Y.jsxs("div",{className:"interaction-panel",children:[Y.jsx("button",{className:"close-button",onClick:u,children:""}),Y.jsx("h4",{children:e||n}),Y.jsxs("div",{className:"control-section",children:[Y.jsx("h5",{children:"Stakeholder Condition"}),Y.jsxs("select",{value:o,onChange:V=>w(V.target.value),children:[Y.jsx("option",{value:"",disabled:!0,children:"Select condition..."}),Y.jsx("option",{value:"5",children:"5 = Excellent"}),Y.jsx("option",{value:"4",children:"4 = Good"}),Y.jsx("option",{value:"3",children:"3 = Adequate"}),Y.jsx("option",{value:"2",children:"2 = Poor"}),Y.jsx("option",{value:"1",children:"1 = Very Poor"})]}),Y.jsx("div",{className:"button-row",style:{marginTop:8},children:Y.jsx("button",{onClick:I,disabled:!R||!o,children:"Save Stakeholder Condition"})})]}),Y.jsx("div",{className:"button-row",style:{marginTop:8},children:Y.jsx("button",{onClick:c,children:"Technical Assessment"})}),m&&m.length>0&&Y.jsxs("div",{className:"control-section",children:[Y.jsx("h5",{children:"Floor Plans"}),Y.jsx("div",{className:"floorplan-buttons",children:m.map((V,k)=>Y.jsx("button",{onClick:()=>_?.(V),children:V.name},k))})]})]})},aA={"This is one of my go-to study spots":"#006400","This is a go-to hangout spot for me and my friends":"#008000","I would like to use this space more, but it needs improvement":"#9cdef1ff","This space feels outdated or run-down":"#f4e806ff","The furniture in this space is uncomfortable or not functional":"#e9a804ff","The lighting or temperature in this space makes it uncomfortable":"#f29008ff","I rarely or never use this space":"#f05555ff","I do not feel safe in this space":"#e00905bc","Just leave a comment about this space":"#9E9E9E"},Hz={"This space supports my teaching and/or professional work effectively":"#007330ff","I wish this space were more flexible or adaptable for different uses":"#31f579ff","I would like to use this space more, but it needs some improvement":"#94d2bd","The layout or furniture is not functional for my needs":"#e9d8a6","The technology in this space is inadequate or unreliable":"#f4d804ff","This space lacks the privacy needed for my work":"#f97c3eff","I rarely or never use this space":"#f25f54ff","I do not feel safe in this space":"#ae2012","Just leave a comment about this space":"#9E9E9E"},T1={student:aA,staff:Hz,default:aA};var Hu=63710088e-1,a8={centimeters:Hu*100,centimetres:Hu*100,degrees:360/(2*Math.PI),feet:Hu*3.28084,inches:Hu*39.37,kilometers:Hu/1e3,kilometres:Hu/1e3,meters:Hu,metres:Hu,miles:Hu/1609.344,millimeters:Hu*1e3,millimetres:Hu*1e3,nauticalmiles:Hu/1852,radians:1,yards:Hu*1.0936};function _3(n,e,t={}){const i={type:"Feature"};return(t.id===0||t.id)&&(i.id=t.id),t.bbox&&(i.bbox=t.bbox),i.properties=e||{},i.geometry=n,i}function Ls(n,e,t={}){if(!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!lA(n[0])||!lA(n[1]))throw new Error("coordinates must contain numbers");return _3({type:"Point",coordinates:n},e,t)}function v3(n,e,t={}){for(const c of n){if(c.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(c[c.length-1].length!==c[0].length)throw new Error("First and last Position are not equivalent.");for(let u=0;u<c[c.length-1].length;u++)if(c[c.length-1][u]!==c[0][u])throw new Error("First and last Position are not equivalent.")}return _3({type:"Polygon",coordinates:n},e,t)}function x3(n,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=n,t}function Wz(n,e,t={}){return _3({type:"MultiPolygon",coordinates:n},e,t)}function l8(n,e="kilometers"){const t=a8[e];if(!t)throw new Error(e+" units is invalid");return n*t}function Kz(n,e="kilometers"){const t=a8[e];if(!t)throw new Error(e+" units is invalid");return n/t}function c8(n){return n%(2*Math.PI)*180/Math.PI}function gd(n){return n%360*Math.PI/180}function u8(n,e="kilometers",t="kilometers"){if(!(n>=0))throw new Error("length must be a positive number");return l8(Kz(n,e),t)}function lA(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function b3(n){return n!==null&&typeof n=="object"&&!Array.isArray(n)}function yd(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function w3(n){if(Array.isArray(n))return n;if(n.type==="Feature"){if(n.geometry!==null)return n.geometry.coordinates}else if(n.coordinates)return n.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Xz(n){return n.type==="Feature"?n.geometry:n}function Zz(n,e){return n.type==="FeatureCollection"?"FeatureCollection":n.type==="GeometryCollection"?"GeometryCollection":n.type==="Feature"&&n.geometry!==null?n.geometry.type:n.type}function Hm(n,e,t={}){if(t.final===!0)return Yz(n,e);const i=yd(n),c=yd(e),u=gd(i[0]),m=gd(c[0]),_=gd(i[1]),o=gd(c[1]),w=Math.sin(m-u)*Math.cos(o),I=Math.cos(_)*Math.sin(o)-Math.sin(_)*Math.cos(o)*Math.cos(m-u);return c8(Math.atan2(w,I))}function Yz(n,e){let t=Hm(e,n);return t=(t+180)%360,t}function Mf(n,e,t={}){var i=yd(n),c=yd(e),u=gd(c[1]-i[1]),m=gd(c[0]-i[0]),_=gd(i[1]),o=gd(c[1]),w=Math.pow(Math.sin(u/2),2)+Math.pow(Math.sin(m/2),2)*Math.cos(_)*Math.cos(o);return l8(2*Math.atan2(Math.sqrt(w),Math.sqrt(1-w)),t.units)}function h8(n,e,t={}){let i;return t.final?i=cA(yd(e),yd(n)):i=cA(yd(n),yd(e)),i>180?-(360-i):i}function cA(n,e){const t=gd(n[1]),i=gd(e[1]);let c=gd(e[0]-n[0]);c>Math.PI&&(c-=2*Math.PI),c<-Math.PI&&(c+=2*Math.PI);const u=Math.log(Math.tan(i/2+Math.PI/4)/Math.tan(t/2+Math.PI/4)),m=Math.atan2(c,u);return(c8(m)+360)%360}function yg(n,e,t){if(n!==null)for(var i,c,u,m,_,o,w,I=0,R=0,V,k=n.type,ie=k==="FeatureCollection",ae=k==="Feature",fe=ie?n.features.length:1,J=0;J<fe;J++){w=ie?n.features[J].geometry:ae?n.geometry:n,V=w?w.type==="GeometryCollection":!1,_=V?w.geometries.length:1;for(var ne=0;ne<_;ne++){var me=0,ue=0;if(m=V?w.geometries[ne]:w,m!==null){o=m.coordinates;var ke=m.type;switch(I=t&&(ke==="Polygon"||ke==="MultiPolygon")?1:0,ke){case null:break;case"Point":if(e(o,R,J,me,ue)===!1)return!1;R++,me++;break;case"LineString":case"MultiPoint":for(i=0;i<o.length;i++){if(e(o[i],R,J,me,ue)===!1)return!1;R++,ke==="MultiPoint"&&me++}ke==="LineString"&&me++;break;case"Polygon":case"MultiLineString":for(i=0;i<o.length;i++){for(c=0;c<o[i].length-I;c++){if(e(o[i][c],R,J,me,ue)===!1)return!1;R++}ke==="MultiLineString"&&me++,ke==="Polygon"&&ue++}ke==="Polygon"&&me++;break;case"MultiPolygon":for(i=0;i<o.length;i++){for(ue=0,c=0;c<o[i].length;c++){for(u=0;u<o[i][c].length-I;u++){if(e(o[i][c][u],R,J,me,ue)===!1)return!1;R++}ue++}me++}break;case"GeometryCollection":for(i=0;i<m.geometries.length;i++)if(yg(m.geometries[i],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Jz(n,e){if(n.type==="Feature")e(n,0);else if(n.type==="FeatureCollection")for(var t=0;t<n.features.length&&e(n.features[t],t)!==!1;t++);}function d8(n,e){var t,i,c,u,m,_,o,w,I,R,V=0,k=n.type==="FeatureCollection",ie=n.type==="Feature",ae=k?n.features.length:1;for(t=0;t<ae;t++){for(_=k?n.features[t].geometry:ie?n.geometry:n,w=k?n.features[t].properties:ie?n.properties:{},I=k?n.features[t].bbox:ie?n.bbox:void 0,R=k?n.features[t].id:ie?n.id:void 0,o=_?_.type==="GeometryCollection":!1,m=o?_.geometries.length:1,c=0;c<m;c++){if(u=o?_.geometries[c]:_,u===null){if(e(null,V,w,I,R)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(u,V,w,I,R)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<u.geometries.length;i++)if(e(u.geometries[i],V,w,I,R)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}V++}}function Qz(n,e,t){var i=t;return d8(n,function(c,u,m,_,o){i=e(i,c,u,m,_,o)}),i}function uA(n){return Qz(n,(e,t)=>e+ej(t),0)}function ej(n){let e=0,t;switch(n.type){case"Polygon":return hA(n.coordinates);case"MultiPolygon":for(t=0;t<n.coordinates.length;t++)e+=hA(n.coordinates[t]);return e;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function hA(n){let e=0;if(n&&n.length>0){e+=Math.abs(dA(n[0]));for(let t=1;t<n.length;t++)e-=Math.abs(dA(n[t]))}return e}var tj=Hu*Hu/2,Vb=Math.PI/180;function dA(n){const e=n.length-1;if(e<=2)return 0;let t=0,i=0;for(;i<e;){const c=n[i],u=n[i+1===e?0:i+1],m=n[i+2>=e?(i+2)%e:i+2],_=c[0]*Vb,o=u[1]*Vb,w=m[0]*Vb;t+=(w-_)*Math.sin(o),i++}return t*tj}function Lu(n,e={}){if(n.bbox!=null&&e.recompute!==!0)return n.bbox;const t=[1/0,1/0,-1/0,-1/0];return yg(n,i=>{t[0]>i[0]&&(t[0]=i[0]),t[1]>i[1]&&(t[1]=i[1]),t[2]<i[0]&&(t[2]=i[0]),t[3]<i[1]&&(t[3]=i[1])}),t}const wp=11102230246251565e-32,ph=134217729,nj=(3+8*wp)*wp;function qb(n,e,t,i,c){let u,m,_,o,w=e[0],I=i[0],R=0,V=0;I>w==I>-w?(u=w,w=e[++R]):(u=I,I=i[++V]);let k=0;if(R<n&&V<t)for(I>w==I>-w?(m=w+u,_=u-(m-w),w=e[++R]):(m=I+u,_=u-(m-I),I=i[++V]),u=m,_!==0&&(c[k++]=_);R<n&&V<t;)I>w==I>-w?(m=u+w,o=m-u,_=u-(m-o)+(w-o),w=e[++R]):(m=u+I,o=m-u,_=u-(m-o)+(I-o),I=i[++V]),u=m,_!==0&&(c[k++]=_);for(;R<n;)m=u+w,o=m-u,_=u-(m-o)+(w-o),w=e[++R],u=m,_!==0&&(c[k++]=_);for(;V<t;)m=u+I,o=m-u,_=u-(m-o)+(I-o),I=i[++V],u=m,_!==0&&(c[k++]=_);return(u!==0||k===0)&&(c[k++]=u),k}function rj(n,e){let t=e[0];for(let i=1;i<n;i++)t+=e[i];return t}function R_(n){return new Float64Array(n)}const ij=(3+16*wp)*wp,oj=(2+12*wp)*wp,sj=(9+64*wp)*wp*wp,Hg=R_(4),fA=R_(8),pA=R_(12),mA=R_(16),kh=R_(4);function aj(n,e,t,i,c,u,m){let _,o,w,I,R,V,k,ie,ae,fe,J,ne,me,ue,ke,ze,pe,U;const F=n-c,q=t-c,j=e-u,H=i-u;ue=F*H,V=ph*F,k=V-(V-F),ie=F-k,V=ph*H,ae=V-(V-H),fe=H-ae,ke=ie*fe-(ue-k*ae-ie*ae-k*fe),ze=j*q,V=ph*j,k=V-(V-j),ie=j-k,V=ph*q,ae=V-(V-q),fe=q-ae,pe=ie*fe-(ze-k*ae-ie*ae-k*fe),J=ke-pe,R=ke-J,Hg[0]=ke-(J+R)+(R-pe),ne=ue+J,R=ne-ue,me=ue-(ne-R)+(J-R),J=me-ze,R=me-J,Hg[1]=me-(J+R)+(R-ze),U=ne+J,R=U-ne,Hg[2]=ne-(U-R)+(J-R),Hg[3]=U;let Z=rj(4,Hg),be=oj*m;if(Z>=be||-Z>=be||(R=n-F,_=n-(F+R)+(R-c),R=t-q,w=t-(q+R)+(R-c),R=e-j,o=e-(j+R)+(R-u),R=i-H,I=i-(H+R)+(R-u),_===0&&o===0&&w===0&&I===0)||(be=sj*m+nj*Math.abs(Z),Z+=F*I+H*_-(j*w+q*o),Z>=be||-Z>=be))return Z;ue=_*H,V=ph*_,k=V-(V-_),ie=_-k,V=ph*H,ae=V-(V-H),fe=H-ae,ke=ie*fe-(ue-k*ae-ie*ae-k*fe),ze=o*q,V=ph*o,k=V-(V-o),ie=o-k,V=ph*q,ae=V-(V-q),fe=q-ae,pe=ie*fe-(ze-k*ae-ie*ae-k*fe),J=ke-pe,R=ke-J,kh[0]=ke-(J+R)+(R-pe),ne=ue+J,R=ne-ue,me=ue-(ne-R)+(J-R),J=me-ze,R=me-J,kh[1]=me-(J+R)+(R-ze),U=ne+J,R=U-ne,kh[2]=ne-(U-R)+(J-R),kh[3]=U;const Me=qb(4,Hg,4,kh,fA);ue=F*I,V=ph*F,k=V-(V-F),ie=F-k,V=ph*I,ae=V-(V-I),fe=I-ae,ke=ie*fe-(ue-k*ae-ie*ae-k*fe),ze=j*w,V=ph*j,k=V-(V-j),ie=j-k,V=ph*w,ae=V-(V-w),fe=w-ae,pe=ie*fe-(ze-k*ae-ie*ae-k*fe),J=ke-pe,R=ke-J,kh[0]=ke-(J+R)+(R-pe),ne=ue+J,R=ne-ue,me=ue-(ne-R)+(J-R),J=me-ze,R=me-J,kh[1]=me-(J+R)+(R-ze),U=ne+J,R=U-ne,kh[2]=ne-(U-R)+(J-R),kh[3]=U;const Be=qb(Me,fA,4,kh,pA);ue=_*I,V=ph*_,k=V-(V-_),ie=_-k,V=ph*I,ae=V-(V-I),fe=I-ae,ke=ie*fe-(ue-k*ae-ie*ae-k*fe),ze=o*w,V=ph*o,k=V-(V-o),ie=o-k,V=ph*w,ae=V-(V-w),fe=w-ae,pe=ie*fe-(ze-k*ae-ie*ae-k*fe),J=ke-pe,R=ke-J,kh[0]=ke-(J+R)+(R-pe),ne=ue+J,R=ne-ue,me=ue-(ne-R)+(J-R),J=me-ze,R=me-J,kh[1]=me-(J+R)+(R-ze),U=ne+J,R=U-ne,kh[2]=ne-(U-R)+(J-R),kh[3]=U;const Re=qb(Be,pA,4,kh,mA);return mA[Re-1]}function lj(n,e,t,i,c,u){const m=(e-u)*(t-c),_=(n-c)*(i-u),o=m-_,w=Math.abs(m+_);return Math.abs(o)>=ij*w?o:-aj(n,e,t,i,c,u,w)}function cj(n,e){var t,i,c=0,u,m,_,o,w,I,R,V=n[0],k=n[1],ie=e.length;for(t=0;t<ie;t++){i=0;var ae=e[t],fe=ae.length-1;if(I=ae[0],I[0]!==ae[fe][0]&&I[1]!==ae[fe][1])throw new Error("First and last coordinates in a ring must be the same");for(m=I[0]-V,_=I[1]-k,i;i<fe;i++){if(R=ae[i+1],o=R[0]-V,w=R[1]-k,_===0&&w===0){if(o<=0&&m>=0||m<=0&&o>=0)return 0}else if(w>=0&&_<=0||w<=0&&_>=0){if(u=lj(m,o,_,w,0,0),u===0)return 0;(u>0&&w>0&&_<=0||u<0&&w<=0&&_>0)&&c++}I=R,_=w,m=o}}return c%2!==0}function uj(n,e,t={}){if(!n)throw new Error("point is required");if(!e)throw new Error("polygon is required");const i=yd(n),c=Xz(e),u=c.type,m=e.bbox;let _=c.coordinates;if(m&&hj(i,m)===!1)return!1;u==="Polygon"&&(_=[_]);let o=!1;for(var w=0;w<_.length;++w){const I=cj(i,_[w]);if(I===0)return!t.ignoreBoundary;I&&(o=!0)}return o}function hj(n,e){return e[0]<=n[0]&&e[1]<=n[1]&&e[2]>=n[0]&&e[3]>=n[1]}function dj(n,e={}){const t=Lu(n),i=(t[0]+t[2])/2,c=(t[1]+t[3])/2;return Ls([i,c],e.properties,e)}function xc(n,e={}){let t=0,i=0,c=0;return yg(n,function(u){t+=u[0],i+=u[1],c++},!0),Ls([t/c,i/c],e.properties)}var I1={exports:{}},ev={exports:{}},fj=ev.exports,gA;function pj(){return gA||(gA=1,(function(n,e){(function(t,i){n.exports=i()})(fj,function(){function t(ne,me,ue,ke,ze){(function pe(U,F,q,j,H){for(;j>q;){if(j-q>600){var Z=j-q+1,be=F-q+1,Me=Math.log(Z),Be=.5*Math.exp(2*Me/3),Re=.5*Math.sqrt(Me*Be*(Z-Be)/Z)*(be-Z/2<0?-1:1),we=Math.max(q,Math.floor(F-be*Be/Z+Re)),De=Math.min(j,Math.floor(F+(Z-be)*Be/Z+Re));pe(U,F,we,De,H)}var nt=U[F],xe=q,le=j;for(i(U,q,F),H(U[j],nt)>0&&i(U,q,j);xe<le;){for(i(U,xe,le),xe++,le--;H(U[xe],nt)<0;)xe++;for(;H(U[le],nt)>0;)le--}H(U[q],nt)===0?i(U,q,le):i(U,++le,j),le<=F&&(q=le+1),F<=le&&(j=le-1)}})(ne,me,ue||0,ke||ne.length-1,ze||c)}function i(ne,me,ue){var ke=ne[me];ne[me]=ne[ue],ne[ue]=ke}function c(ne,me){return ne<me?-1:ne>me?1:0}var u=function(ne){ne===void 0&&(ne=9),this._maxEntries=Math.max(4,ne),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function m(ne,me,ue){if(!ue)return me.indexOf(ne);for(var ke=0;ke<me.length;ke++)if(ue(ne,me[ke]))return ke;return-1}function _(ne,me){o(ne,0,ne.children.length,me,ne)}function o(ne,me,ue,ke,ze){ze||(ze=fe(null)),ze.minX=1/0,ze.minY=1/0,ze.maxX=-1/0,ze.maxY=-1/0;for(var pe=me;pe<ue;pe++){var U=ne.children[pe];w(ze,ne.leaf?ke(U):U)}return ze}function w(ne,me){return ne.minX=Math.min(ne.minX,me.minX),ne.minY=Math.min(ne.minY,me.minY),ne.maxX=Math.max(ne.maxX,me.maxX),ne.maxY=Math.max(ne.maxY,me.maxY),ne}function I(ne,me){return ne.minX-me.minX}function R(ne,me){return ne.minY-me.minY}function V(ne){return(ne.maxX-ne.minX)*(ne.maxY-ne.minY)}function k(ne){return ne.maxX-ne.minX+(ne.maxY-ne.minY)}function ie(ne,me){return ne.minX<=me.minX&&ne.minY<=me.minY&&me.maxX<=ne.maxX&&me.maxY<=ne.maxY}function ae(ne,me){return me.minX<=ne.maxX&&me.minY<=ne.maxY&&me.maxX>=ne.minX&&me.maxY>=ne.minY}function fe(ne){return{children:ne,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function J(ne,me,ue,ke,ze){for(var pe=[me,ue];pe.length;)if(!((ue=pe.pop())-(me=pe.pop())<=ke)){var U=me+Math.ceil((ue-me)/ke/2)*ke;t(ne,U,me,ue,ze),pe.push(me,U,U,ue)}}return u.prototype.all=function(){return this._all(this.data,[])},u.prototype.search=function(ne){var me=this.data,ue=[];if(!ae(ne,me))return ue;for(var ke=this.toBBox,ze=[];me;){for(var pe=0;pe<me.children.length;pe++){var U=me.children[pe],F=me.leaf?ke(U):U;ae(ne,F)&&(me.leaf?ue.push(U):ie(ne,F)?this._all(U,ue):ze.push(U))}me=ze.pop()}return ue},u.prototype.collides=function(ne){var me=this.data;if(!ae(ne,me))return!1;for(var ue=[];me;){for(var ke=0;ke<me.children.length;ke++){var ze=me.children[ke],pe=me.leaf?this.toBBox(ze):ze;if(ae(ne,pe)){if(me.leaf||ie(ne,pe))return!0;ue.push(ze)}}me=ue.pop()}return!1},u.prototype.load=function(ne){if(!ne||!ne.length)return this;if(ne.length<this._minEntries){for(var me=0;me<ne.length;me++)this.insert(ne[me]);return this}var ue=this._build(ne.slice(),0,ne.length-1,0);if(this.data.children.length)if(this.data.height===ue.height)this._splitRoot(this.data,ue);else{if(this.data.height<ue.height){var ke=this.data;this.data=ue,ue=ke}this._insert(ue,this.data.height-ue.height-1,!0)}else this.data=ue;return this},u.prototype.insert=function(ne){return ne&&this._insert(ne,this.data.height-1),this},u.prototype.clear=function(){return this.data=fe([]),this},u.prototype.remove=function(ne,me){if(!ne)return this;for(var ue,ke,ze,pe=this.data,U=this.toBBox(ne),F=[],q=[];pe||F.length;){if(pe||(pe=F.pop(),ke=F[F.length-1],ue=q.pop(),ze=!0),pe.leaf){var j=m(ne,pe.children,me);if(j!==-1)return pe.children.splice(j,1),F.push(pe),this._condense(F),this}ze||pe.leaf||!ie(pe,U)?ke?(ue++,pe=ke.children[ue],ze=!1):pe=null:(F.push(pe),q.push(ue),ue=0,ke=pe,pe=pe.children[0])}return this},u.prototype.toBBox=function(ne){return ne},u.prototype.compareMinX=function(ne,me){return ne.minX-me.minX},u.prototype.compareMinY=function(ne,me){return ne.minY-me.minY},u.prototype.toJSON=function(){return this.data},u.prototype.fromJSON=function(ne){return this.data=ne,this},u.prototype._all=function(ne,me){for(var ue=[];ne;)ne.leaf?me.push.apply(me,ne.children):ue.push.apply(ue,ne.children),ne=ue.pop();return me},u.prototype._build=function(ne,me,ue,ke){var ze,pe=ue-me+1,U=this._maxEntries;if(pe<=U)return _(ze=fe(ne.slice(me,ue+1)),this.toBBox),ze;ke||(ke=Math.ceil(Math.log(pe)/Math.log(U)),U=Math.ceil(pe/Math.pow(U,ke-1))),(ze=fe([])).leaf=!1,ze.height=ke;var F=Math.ceil(pe/U),q=F*Math.ceil(Math.sqrt(U));J(ne,me,ue,q,this.compareMinX);for(var j=me;j<=ue;j+=q){var H=Math.min(j+q-1,ue);J(ne,j,H,F,this.compareMinY);for(var Z=j;Z<=H;Z+=F){var be=Math.min(Z+F-1,H);ze.children.push(this._build(ne,Z,be,ke-1))}}return _(ze,this.toBBox),ze},u.prototype._chooseSubtree=function(ne,me,ue,ke){for(;ke.push(me),!me.leaf&&ke.length-1!==ue;){for(var ze=1/0,pe=1/0,U=void 0,F=0;F<me.children.length;F++){var q=me.children[F],j=V(q),H=(Z=ne,be=q,(Math.max(be.maxX,Z.maxX)-Math.min(be.minX,Z.minX))*(Math.max(be.maxY,Z.maxY)-Math.min(be.minY,Z.minY))-j);H<pe?(pe=H,ze=j<ze?j:ze,U=q):H===pe&&j<ze&&(ze=j,U=q)}me=U||me.children[0]}var Z,be;return me},u.prototype._insert=function(ne,me,ue){var ke=ue?ne:this.toBBox(ne),ze=[],pe=this._chooseSubtree(ke,this.data,me,ze);for(pe.children.push(ne),w(pe,ke);me>=0&&ze[me].children.length>this._maxEntries;)this._split(ze,me),me--;this._adjustParentBBoxes(ke,ze,me)},u.prototype._split=function(ne,me){var ue=ne[me],ke=ue.children.length,ze=this._minEntries;this._chooseSplitAxis(ue,ze,ke);var pe=this._chooseSplitIndex(ue,ze,ke),U=fe(ue.children.splice(pe,ue.children.length-pe));U.height=ue.height,U.leaf=ue.leaf,_(ue,this.toBBox),_(U,this.toBBox),me?ne[me-1].children.push(U):this._splitRoot(ue,U)},u.prototype._splitRoot=function(ne,me){this.data=fe([ne,me]),this.data.height=ne.height+1,this.data.leaf=!1,_(this.data,this.toBBox)},u.prototype._chooseSplitIndex=function(ne,me,ue){for(var ke,ze,pe,U,F,q,j,H=1/0,Z=1/0,be=me;be<=ue-me;be++){var Me=o(ne,0,be,this.toBBox),Be=o(ne,be,ue,this.toBBox),Re=(ze=Me,pe=Be,U=void 0,F=void 0,q=void 0,j=void 0,U=Math.max(ze.minX,pe.minX),F=Math.max(ze.minY,pe.minY),q=Math.min(ze.maxX,pe.maxX),j=Math.min(ze.maxY,pe.maxY),Math.max(0,q-U)*Math.max(0,j-F)),we=V(Me)+V(Be);Re<H?(H=Re,ke=be,Z=we<Z?we:Z):Re===H&&we<Z&&(Z=we,ke=be)}return ke||ue-me},u.prototype._chooseSplitAxis=function(ne,me,ue){var ke=ne.leaf?this.compareMinX:I,ze=ne.leaf?this.compareMinY:R;this._allDistMargin(ne,me,ue,ke)<this._allDistMargin(ne,me,ue,ze)&&ne.children.sort(ke)},u.prototype._allDistMargin=function(ne,me,ue,ke){ne.children.sort(ke);for(var ze=this.toBBox,pe=o(ne,0,me,ze),U=o(ne,ue-me,ue,ze),F=k(pe)+k(U),q=me;q<ue-me;q++){var j=ne.children[q];w(pe,ne.leaf?ze(j):j),F+=k(pe)}for(var H=ue-me-1;H>=me;H--){var Z=ne.children[H];w(U,ne.leaf?ze(Z):Z),F+=k(U)}return F},u.prototype._adjustParentBBoxes=function(ne,me,ue){for(var ke=ue;ke>=0;ke--)w(me[ke],ne)},u.prototype._condense=function(ne){for(var me=ne.length-1,ue=void 0;me>=0;me--)ne[me].children.length===0?me>0?(ue=ne[me-1].children).splice(ue.indexOf(ne[me]),1):this.clear():_(ne[me],this.toBBox)},u})})(ev)),ev.exports}class mj{constructor(e=[],t=gj){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:i}=this,c=t[e];for(;e>0;){const u=e-1>>1,m=t[u];if(i(c,m)>=0)break;t[e]=m,e=u}t[e]=c}_down(e){const{data:t,compare:i}=this,c=this.length>>1,u=t[e];for(;e<c;){let m=(e<<1)+1,_=t[m];const o=m+1;if(o<this.length&&i(t[o],_)<0&&(m=o,_=t[o]),i(_,u)>=0)break;t[e]=_,e=m}t[e]=u}}function gj(n,e){return n<e?-1:n>e?1:0}const yj=Object.freeze(Object.defineProperty({__proto__:null,default:mj},Symbol.toStringTag,{value:"Module"})),_j=ML(yj);var Ay={exports:{}},$b,yA;function vj(){return yA||(yA=1,$b=function(e,t,i,c){var u=e[0],m=e[1],_=!1;i===void 0&&(i=0),c===void 0&&(c=t.length);for(var o=(c-i)/2,w=0,I=o-1;w<o;I=w++){var R=t[i+w*2+0],V=t[i+w*2+1],k=t[i+I*2+0],ie=t[i+I*2+1],ae=V>m!=ie>m&&u<(k-R)*(m-V)/(ie-V)+R;ae&&(_=!_)}return _}),$b}var Gb,_A;function xj(){return _A||(_A=1,Gb=function(e,t,i,c){var u=e[0],m=e[1],_=!1;i===void 0&&(i=0),c===void 0&&(c=t.length);for(var o=c-i,w=0,I=o-1;w<o;I=w++){var R=t[w+i][0],V=t[w+i][1],k=t[I+i][0],ie=t[I+i][1],ae=V>m!=ie>m&&u<(k-R)*(m-V)/(ie-V)+R;ae&&(_=!_)}return _}),Gb}var vA;function bj(){if(vA)return Ay.exports;vA=1;var n=vj(),e=xj();return Ay.exports=function(i,c,u,m){return c.length>0&&Array.isArray(c[0])?e(i,c,u,m):n(i,c,u,m)},Ay.exports.nested=e,Ay.exports.flat=n,Ay.exports}var Ny={exports:{}},wj=Ny.exports,xA;function Sj(){return xA||(xA=1,(function(n,e){(function(t,i){i(e)})(wj,function(t){const c=33306690738754706e-32;function u(ae,fe,J,ne,me){let ue,ke,ze,pe,U=fe[0],F=ne[0],q=0,j=0;F>U==F>-U?(ue=U,U=fe[++q]):(ue=F,F=ne[++j]);let H=0;if(q<ae&&j<J)for(F>U==F>-U?(ze=ue-((ke=U+ue)-U),U=fe[++q]):(ze=ue-((ke=F+ue)-F),F=ne[++j]),ue=ke,ze!==0&&(me[H++]=ze);q<ae&&j<J;)F>U==F>-U?(ze=ue-((ke=ue+U)-(pe=ke-ue))+(U-pe),U=fe[++q]):(ze=ue-((ke=ue+F)-(pe=ke-ue))+(F-pe),F=ne[++j]),ue=ke,ze!==0&&(me[H++]=ze);for(;q<ae;)ze=ue-((ke=ue+U)-(pe=ke-ue))+(U-pe),U=fe[++q],ue=ke,ze!==0&&(me[H++]=ze);for(;j<J;)ze=ue-((ke=ue+F)-(pe=ke-ue))+(F-pe),F=ne[++j],ue=ke,ze!==0&&(me[H++]=ze);return ue===0&&H!==0||(me[H++]=ue),H}function m(ae){return new Float64Array(ae)}const _=33306690738754716e-32,o=22204460492503146e-32,w=11093356479670487e-47,I=m(4),R=m(8),V=m(12),k=m(16),ie=m(4);t.orient2d=function(ae,fe,J,ne,me,ue){const ke=(fe-ue)*(J-me),ze=(ae-me)*(ne-ue),pe=ke-ze;if(ke===0||ze===0||ke>0!=ze>0)return pe;const U=Math.abs(ke+ze);return Math.abs(pe)>=_*U?pe:-(function(F,q,j,H,Z,be,Me){let Be,Re,we,De,nt,xe,le,Ne,Oe,Je,rt,mt,dt,Dt,tn,ln,yn,Mn;const Gt=F-Z,st=j-Z,fr=q-be,br=H-be;nt=(tn=(Ne=Gt-(le=(xe=134217729*Gt)-(xe-Gt)))*(Je=br-(Oe=(xe=134217729*br)-(xe-br)))-((Dt=Gt*br)-le*Oe-Ne*Oe-le*Je))-(rt=tn-(yn=(Ne=fr-(le=(xe=134217729*fr)-(xe-fr)))*(Je=st-(Oe=(xe=134217729*st)-(xe-st)))-((ln=fr*st)-le*Oe-Ne*Oe-le*Je))),I[0]=tn-(rt+nt)+(nt-yn),nt=(dt=Dt-((mt=Dt+rt)-(nt=mt-Dt))+(rt-nt))-(rt=dt-ln),I[1]=dt-(rt+nt)+(nt-ln),nt=(Mn=mt+rt)-mt,I[2]=mt-(Mn-nt)+(rt-nt),I[3]=Mn;let Tr=(function(Vt,Ln){let $n=Ln[0];for(let Dn=1;Dn<Vt;Dn++)$n+=Ln[Dn];return $n})(4,I),Cn=o*Me;if(Tr>=Cn||-Tr>=Cn||(Be=F-(Gt+(nt=F-Gt))+(nt-Z),we=j-(st+(nt=j-st))+(nt-Z),Re=q-(fr+(nt=q-fr))+(nt-be),De=H-(br+(nt=H-br))+(nt-be),Be===0&&Re===0&&we===0&&De===0)||(Cn=w*Me+c*Math.abs(Tr),(Tr+=Gt*De+br*Be-(fr*we+st*Re))>=Cn||-Tr>=Cn))return Tr;nt=(tn=(Ne=Be-(le=(xe=134217729*Be)-(xe-Be)))*(Je=br-(Oe=(xe=134217729*br)-(xe-br)))-((Dt=Be*br)-le*Oe-Ne*Oe-le*Je))-(rt=tn-(yn=(Ne=Re-(le=(xe=134217729*Re)-(xe-Re)))*(Je=st-(Oe=(xe=134217729*st)-(xe-st)))-((ln=Re*st)-le*Oe-Ne*Oe-le*Je))),ie[0]=tn-(rt+nt)+(nt-yn),nt=(dt=Dt-((mt=Dt+rt)-(nt=mt-Dt))+(rt-nt))-(rt=dt-ln),ie[1]=dt-(rt+nt)+(nt-ln),nt=(Mn=mt+rt)-mt,ie[2]=mt-(Mn-nt)+(rt-nt),ie[3]=Mn;const ir=u(4,I,4,ie,R);nt=(tn=(Ne=Gt-(le=(xe=134217729*Gt)-(xe-Gt)))*(Je=De-(Oe=(xe=134217729*De)-(xe-De)))-((Dt=Gt*De)-le*Oe-Ne*Oe-le*Je))-(rt=tn-(yn=(Ne=fr-(le=(xe=134217729*fr)-(xe-fr)))*(Je=we-(Oe=(xe=134217729*we)-(xe-we)))-((ln=fr*we)-le*Oe-Ne*Oe-le*Je))),ie[0]=tn-(rt+nt)+(nt-yn),nt=(dt=Dt-((mt=Dt+rt)-(nt=mt-Dt))+(rt-nt))-(rt=dt-ln),ie[1]=dt-(rt+nt)+(nt-ln),nt=(Mn=mt+rt)-mt,ie[2]=mt-(Mn-nt)+(rt-nt),ie[3]=Mn;const Jn=u(ir,R,4,ie,V);nt=(tn=(Ne=Be-(le=(xe=134217729*Be)-(xe-Be)))*(Je=De-(Oe=(xe=134217729*De)-(xe-De)))-((Dt=Be*De)-le*Oe-Ne*Oe-le*Je))-(rt=tn-(yn=(Ne=Re-(le=(xe=134217729*Re)-(xe-Re)))*(Je=we-(Oe=(xe=134217729*we)-(xe-we)))-((ln=Re*we)-le*Oe-Ne*Oe-le*Je))),ie[0]=tn-(rt+nt)+(nt-yn),nt=(dt=Dt-((mt=Dt+rt)-(nt=mt-Dt))+(rt-nt))-(rt=dt-ln),ie[1]=dt-(rt+nt)+(nt-ln),nt=(Mn=mt+rt)-mt,ie[2]=mt-(Mn-nt)+(rt-nt),ie[3]=Mn;const Hr=u(Jn,V,4,ie,k);return k[Hr-1]})(ae,fe,J,ne,me,ue,U)},t.orient2dfast=function(ae,fe,J,ne,me,ue){return(fe-ue)*(J-me)-(ae-me)*(ne-ue)},Object.defineProperty(t,"__esModule",{value:!0})})})(Ny,Ny.exports)),Ny.exports}var bA;function Ej(){if(bA)return I1.exports;bA=1;var n=pj(),e=_j,t=bj(),i=Sj().orient2d;e.default&&(e=e.default),I1.exports=c,I1.exports.default=c;function c(ue,ke,ze){ke=Math.max(0,ke===void 0?2:ke),ze=ze||0;var pe=k(ue),U=new n(16);U.toBBox=function(le){return{minX:le[0],minY:le[1],maxX:le[0],maxY:le[1]}},U.compareMinX=function(le,Ne){return le[0]-Ne[0]},U.compareMinY=function(le,Ne){return le[1]-Ne[1]},U.load(ue);for(var F=[],q=0,j;q<pe.length;q++){var H=pe[q];U.remove(H),j=ie(H,j),F.push(j)}var Z=new n(16);for(q=0;q<F.length;q++)Z.insert(V(F[q]));for(var be=ke*ke,Me=ze*ze;F.length;){var Be=F.shift(),Re=Be.p,we=Be.next.p,De=ae(Re,we);if(!(De<Me)){var nt=De/be;H=u(U,Be.prev.p,Re,we,Be.next.next.p,nt,Z),H&&Math.min(ae(H,Re),ae(H,we))<=nt&&(F.push(Be),F.push(ie(H,Be)),U.remove(H),Z.remove(Be),Z.insert(V(Be)),Z.insert(V(Be.next)))}}Be=j;var xe=[];do xe.push(Be.p),Be=Be.next;while(Be!==j);return xe.push(Be.p),xe}function u(ue,ke,ze,pe,U,F,q){for(var j=new e([],m),H=ue.data;H;){for(var Z=0;Z<H.children.length;Z++){var be=H.children[Z],Me=H.leaf?fe(be,ze,pe):_(ze,pe,be);Me>F||j.push({node:be,dist:Me})}for(;j.length&&!j.peek().node.children;){var Be=j.pop(),Re=Be.node,we=fe(Re,ke,ze),De=fe(Re,pe,U);if(Be.dist<we&&Be.dist<De&&w(ze,Re,q)&&w(pe,Re,q))return Re}H=j.pop(),H&&(H=H.node)}return null}function m(ue,ke){return ue.dist-ke.dist}function _(ue,ke,ze){if(o(ue,ze)||o(ke,ze))return 0;var pe=J(ue[0],ue[1],ke[0],ke[1],ze.minX,ze.minY,ze.maxX,ze.minY);if(pe===0)return 0;var U=J(ue[0],ue[1],ke[0],ke[1],ze.minX,ze.minY,ze.minX,ze.maxY);if(U===0)return 0;var F=J(ue[0],ue[1],ke[0],ke[1],ze.maxX,ze.minY,ze.maxX,ze.maxY);if(F===0)return 0;var q=J(ue[0],ue[1],ke[0],ke[1],ze.minX,ze.maxY,ze.maxX,ze.maxY);return q===0?0:Math.min(pe,U,F,q)}function o(ue,ke){return ue[0]>=ke.minX&&ue[0]<=ke.maxX&&ue[1]>=ke.minY&&ue[1]<=ke.maxY}function w(ue,ke,ze){for(var pe=Math.min(ue[0],ke[0]),U=Math.min(ue[1],ke[1]),F=Math.max(ue[0],ke[0]),q=Math.max(ue[1],ke[1]),j=ze.search({minX:pe,minY:U,maxX:F,maxY:q}),H=0;H<j.length;H++)if(R(j[H].p,j[H].next.p,ue,ke))return!1;return!0}function I(ue,ke,ze){return i(ue[0],ue[1],ke[0],ke[1],ze[0],ze[1])}function R(ue,ke,ze,pe){return ue!==pe&&ke!==ze&&I(ue,ke,ze)>0!=I(ue,ke,pe)>0&&I(ze,pe,ue)>0!=I(ze,pe,ke)>0}function V(ue){var ke=ue.p,ze=ue.next.p;return ue.minX=Math.min(ke[0],ze[0]),ue.minY=Math.min(ke[1],ze[1]),ue.maxX=Math.max(ke[0],ze[0]),ue.maxY=Math.max(ke[1],ze[1]),ue}function k(ue){for(var ke=ue[0],ze=ue[0],pe=ue[0],U=ue[0],F=0;F<ue.length;F++){var q=ue[F];q[0]<ke[0]&&(ke=q),q[0]>pe[0]&&(pe=q),q[1]<ze[1]&&(ze=q),q[1]>U[1]&&(U=q)}var j=[ke,ze,pe,U],H=j.slice();for(F=0;F<ue.length;F++)t(ue[F],j)||H.push(ue[F]);return me(H)}function ie(ue,ke){var ze={p:ue,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return ke?(ze.next=ke.next,ze.prev=ke,ke.next.prev=ze,ke.next=ze):(ze.prev=ze,ze.next=ze),ze}function ae(ue,ke){var ze=ue[0]-ke[0],pe=ue[1]-ke[1];return ze*ze+pe*pe}function fe(ue,ke,ze){var pe=ke[0],U=ke[1],F=ze[0]-pe,q=ze[1]-U;if(F!==0||q!==0){var j=((ue[0]-pe)*F+(ue[1]-U)*q)/(F*F+q*q);j>1?(pe=ze[0],U=ze[1]):j>0&&(pe+=F*j,U+=q*j)}return F=ue[0]-pe,q=ue[1]-U,F*F+q*q}function J(ue,ke,ze,pe,U,F,q,j){var H=ze-ue,Z=pe-ke,be=q-U,Me=j-F,Be=ue-U,Re=ke-F,we=H*H+Z*Z,De=H*be+Z*Me,nt=be*be+Me*Me,xe=H*Be+Z*Re,le=be*Be+Me*Re,Ne=we*nt-De*De,Oe,Je,rt,mt,dt=Ne,Dt=Ne;Ne===0?(Je=0,dt=1,mt=le,Dt=nt):(Je=De*le-nt*xe,mt=we*le-De*xe,Je<0?(Je=0,mt=le,Dt=nt):Je>dt&&(Je=dt,mt=le+De,Dt=nt)),mt<0?(mt=0,-xe<0?Je=0:-xe>we?Je=dt:(Je=-xe,dt=we)):mt>Dt&&(mt=Dt,-xe+De<0?Je=0:-xe+De>we?Je=dt:(Je=-xe+De,dt=we)),Oe=Je===0?0:Je/dt,rt=mt===0?0:mt/Dt;var tn=(1-Oe)*ue+Oe*ze,ln=(1-Oe)*ke+Oe*pe,yn=(1-rt)*U+rt*q,Mn=(1-rt)*F+rt*j,Gt=yn-tn,st=Mn-ln;return Gt*Gt+st*st}function ne(ue,ke){return ue[0]===ke[0]?ue[1]-ke[1]:ue[0]-ke[0]}function me(ue){ue.sort(ne);for(var ke=[],ze=0;ze<ue.length;ze++){for(;ke.length>=2&&I(ke[ke.length-2],ke[ke.length-1],ue[ze])<=0;)ke.pop();ke.push(ue[ze])}for(var pe=[],U=ue.length-1;U>=0;U--){for(;pe.length>=2&&I(pe[pe.length-2],pe[pe.length-1],ue[U])<=0;)pe.pop();pe.push(ue[U])}return pe.pop(),ke.pop(),ke.concat(pe)}return I1.exports}var Aj=Ej();const Tj=Wv(Aj);function Ij(n,e={}){e.concavity=e.concavity||1/0;const t=[];if(yg(n,c=>{t.push([c[0],c[1]])}),!t.length)return null;const i=Tj(t,e.concavity);return i.length>3?v3([i]):null}function S3(n){if(!n)throw new Error("geojson is required");switch(n.type){case"Feature":return f8(n);case"FeatureCollection":return Cj(n);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return E3(n);default:throw new Error("unknown GeoJSON type")}}function f8(n){const e={type:"Feature"};return Object.keys(n).forEach(t=>{switch(t){case"type":case"properties":case"geometry":return;default:e[t]=n[t]}}),e.properties=p8(n.properties),n.geometry==null?e.geometry=null:e.geometry=E3(n.geometry),e}function p8(n){const e={};return n&&Object.keys(n).forEach(t=>{const i=n[t];typeof i=="object"?i===null?e[t]=null:Array.isArray(i)?e[t]=i.map(c=>c):e[t]=p8(i):e[t]=i}),e}function Cj(n){const e={type:"FeatureCollection"};return Object.keys(n).forEach(t=>{switch(t){case"type":case"features":return;default:e[t]=n[t]}}),e.features=n.features.map(t=>f8(t)),e}function E3(n){const e={type:n.type};return n.bbox&&(e.bbox=n.bbox),n.type==="GeometryCollection"?(e.geometries=n.geometries.map(t=>E3(t)),e):(e.coordinates=m8(n.coordinates),e)}function m8(n){const e=n;return typeof e[0]!="object"?e.slice():e.map(t=>m8(t))}var Lj=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,Hb=Math.ceil,kd=Math.floor,Xh="[BigNumber Error] ",wA=Xh+"Number primitive has more than 15 significant digits: ",Wd=1e14,ko=14,Wb=9007199254740991,Kb=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],Yp=1e7,Au=1e9;function g8(n){var e,t,i,c=ne.prototype={constructor:ne,toString:null,valueOf:null},u=new ne(1),m=20,_=4,o=-7,w=21,I=-1e7,R=1e7,V=!1,k=1,ie=0,ae={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"",suffix:""},fe="0123456789abcdefghijklmnopqrstuvwxyz",J=!0;function ne(U,F){var q,j,H,Z,be,Me,Be,Re,we=this;if(!(we instanceof ne))return new ne(U,F);if(F==null){if(U&&U._isBigNumber===!0){we.s=U.s,!U.c||U.e>R?we.c=we.e=null:U.e<I?we.c=[we.e=0]:(we.e=U.e,we.c=U.c.slice());return}if((Me=typeof U=="number")&&U*0==0){if(we.s=1/U<0?(U=-U,-1):1,U===~~U){for(Z=0,be=U;be>=10;be/=10,Z++);Z>R?we.c=we.e=null:(we.e=Z,we.c=[U]);return}Re=String(U)}else{if(!Lj.test(Re=String(U)))return i(we,Re,Me);we.s=Re.charCodeAt(0)==45?(Re=Re.slice(1),-1):1}(Z=Re.indexOf("."))>-1&&(Re=Re.replace(".","")),(be=Re.search(/e/i))>0?(Z<0&&(Z=be),Z+=+Re.slice(be+1),Re=Re.substring(0,be)):Z<0&&(Z=Re.length)}else{if(Zl(F,2,fe.length,"Base"),F==10&&J)return we=new ne(U),ze(we,m+we.e+1,_);if(Re=String(U),Me=typeof U=="number"){if(U*0!=0)return i(we,Re,Me,F);if(we.s=1/U<0?(Re=Re.slice(1),-1):1,ne.DEBUG&&Re.replace(/^0\.0*|\./,"").length>15)throw Error(wA+U)}else we.s=Re.charCodeAt(0)===45?(Re=Re.slice(1),-1):1;for(q=fe.slice(0,F),Z=be=0,Be=Re.length;be<Be;be++)if(q.indexOf(j=Re.charAt(be))<0){if(j=="."){if(be>Z){Z=Be;continue}}else if(!H&&(Re==Re.toUpperCase()&&(Re=Re.toLowerCase())||Re==Re.toLowerCase()&&(Re=Re.toUpperCase()))){H=!0,be=-1,Z=0;continue}return i(we,String(U),Me,F)}Me=!1,Re=t(Re,F,10,we.s),(Z=Re.indexOf("."))>-1?Re=Re.replace(".",""):Z=Re.length}for(be=0;Re.charCodeAt(be)===48;be++);for(Be=Re.length;Re.charCodeAt(--Be)===48;);if(Re=Re.slice(be,++Be)){if(Be-=be,Me&&ne.DEBUG&&Be>15&&(U>Wb||U!==kd(U)))throw Error(wA+we.s*U);if((Z=Z-be-1)>R)we.c=we.e=null;else if(Z<I)we.c=[we.e=0];else{if(we.e=Z,we.c=[],be=(Z+1)%ko,Z<0&&(be+=ko),be<Be){for(be&&we.c.push(+Re.slice(0,be)),Be-=ko;be<Be;)we.c.push(+Re.slice(be,be+=ko));be=ko-(Re=Re.slice(be)).length}else be-=Be;for(;be--;Re+="0");we.c.push(+Re)}}else we.c=[we.e=0]}ne.clone=g8,ne.ROUND_UP=0,ne.ROUND_DOWN=1,ne.ROUND_CEIL=2,ne.ROUND_FLOOR=3,ne.ROUND_HALF_UP=4,ne.ROUND_HALF_DOWN=5,ne.ROUND_HALF_EVEN=6,ne.ROUND_HALF_CEIL=7,ne.ROUND_HALF_FLOOR=8,ne.EUCLID=9,ne.config=ne.set=function(U){var F,q;if(U!=null)if(typeof U=="object"){if(U.hasOwnProperty(F="DECIMAL_PLACES")&&(q=U[F],Zl(q,0,Au,F),m=q),U.hasOwnProperty(F="ROUNDING_MODE")&&(q=U[F],Zl(q,0,8,F),_=q),U.hasOwnProperty(F="EXPONENTIAL_AT")&&(q=U[F],q&&q.pop?(Zl(q[0],-Au,0,F),Zl(q[1],0,Au,F),o=q[0],w=q[1]):(Zl(q,-Au,Au,F),o=-(w=q<0?-q:q))),U.hasOwnProperty(F="RANGE"))if(q=U[F],q&&q.pop)Zl(q[0],-Au,-1,F),Zl(q[1],1,Au,F),I=q[0],R=q[1];else if(Zl(q,-Au,Au,F),q)I=-(R=q<0?-q:q);else throw Error(Xh+F+" cannot be zero: "+q);if(U.hasOwnProperty(F="CRYPTO"))if(q=U[F],q===!!q)if(q)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))V=q;else throw V=!q,Error(Xh+"crypto unavailable");else V=q;else throw Error(Xh+F+" not true or false: "+q);if(U.hasOwnProperty(F="MODULO_MODE")&&(q=U[F],Zl(q,0,9,F),k=q),U.hasOwnProperty(F="POW_PRECISION")&&(q=U[F],Zl(q,0,Au,F),ie=q),U.hasOwnProperty(F="FORMAT"))if(q=U[F],typeof q=="object")ae=q;else throw Error(Xh+F+" not an object: "+q);if(U.hasOwnProperty(F="ALPHABET"))if(q=U[F],typeof q=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(q))J=q.slice(0,10)=="0123456789",fe=q;else throw Error(Xh+F+" invalid: "+q)}else throw Error(Xh+"Object expected: "+U);return{DECIMAL_PLACES:m,ROUNDING_MODE:_,EXPONENTIAL_AT:[o,w],RANGE:[I,R],CRYPTO:V,MODULO_MODE:k,POW_PRECISION:ie,FORMAT:ae,ALPHABET:fe}},ne.isBigNumber=function(U){if(!U||U._isBigNumber!==!0)return!1;if(!ne.DEBUG)return!0;var F,q,j=U.c,H=U.e,Z=U.s;e:if({}.toString.call(j)=="[object Array]"){if((Z===1||Z===-1)&&H>=-Au&&H<=Au&&H===kd(H)){if(j[0]===0){if(H===0&&j.length===1)return!0;break e}if(F=(H+1)%ko,F<1&&(F+=ko),String(j[0]).length==F){for(F=0;F<j.length;F++)if(q=j[F],q<0||q>=Wd||q!==kd(q))break e;if(q!==0)return!0}}}else if(j===null&&H===null&&(Z===null||Z===1||Z===-1))return!0;throw Error(Xh+"Invalid BigNumber: "+U)},ne.maximum=ne.max=function(){return ue(arguments,-1)},ne.minimum=ne.min=function(){return ue(arguments,1)},ne.random=(function(){var U=9007199254740992,F=Math.random()*U&2097151?function(){return kd(Math.random()*U)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(q){var j,H,Z,be,Me,Be=0,Re=[],we=new ne(u);if(q==null?q=m:Zl(q,0,Au),be=Hb(q/ko),V)if(crypto.getRandomValues){for(j=crypto.getRandomValues(new Uint32Array(be*=2));Be<be;)Me=j[Be]*131072+(j[Be+1]>>>11),Me>=9e15?(H=crypto.getRandomValues(new Uint32Array(2)),j[Be]=H[0],j[Be+1]=H[1]):(Re.push(Me%1e14),Be+=2);Be=be/2}else if(crypto.randomBytes){for(j=crypto.randomBytes(be*=7);Be<be;)Me=(j[Be]&31)*281474976710656+j[Be+1]*1099511627776+j[Be+2]*4294967296+j[Be+3]*16777216+(j[Be+4]<<16)+(j[Be+5]<<8)+j[Be+6],Me>=9e15?crypto.randomBytes(7).copy(j,Be):(Re.push(Me%1e14),Be+=7);Be=be/7}else throw V=!1,Error(Xh+"crypto unavailable");if(!V)for(;Be<be;)Me=F(),Me<9e15&&(Re[Be++]=Me%1e14);for(be=Re[--Be],q%=ko,be&&q&&(Me=Kb[ko-q],Re[Be]=kd(be/Me)*Me);Re[Be]===0;Re.pop(),Be--);if(Be<0)Re=[Z=0];else{for(Z=-1;Re[0]===0;Re.splice(0,1),Z-=ko);for(Be=1,Me=Re[0];Me>=10;Me/=10,Be++);Be<ko&&(Z-=ko-Be)}return we.e=Z,we.c=Re,we}})(),ne.sum=function(){for(var U=1,F=arguments,q=new ne(F[0]);U<F.length;)q=q.plus(F[U++]);return q},t=(function(){var U="0123456789";function F(q,j,H,Z){for(var be,Me=[0],Be,Re=0,we=q.length;Re<we;){for(Be=Me.length;Be--;Me[Be]*=j);for(Me[0]+=Z.indexOf(q.charAt(Re++)),be=0;be<Me.length;be++)Me[be]>H-1&&(Me[be+1]==null&&(Me[be+1]=0),Me[be+1]+=Me[be]/H|0,Me[be]%=H)}return Me.reverse()}return function(q,j,H,Z,be){var Me,Be,Re,we,De,nt,xe,le,Ne=q.indexOf("."),Oe=m,Je=_;for(Ne>=0&&(we=ie,ie=0,q=q.replace(".",""),le=new ne(j),nt=le.pow(q.length-Ne),ie=we,le.c=F(dp(Pd(nt.c),nt.e,"0"),10,H,U),le.e=le.c.length),xe=F(q,j,H,be?(Me=fe,U):(Me=U,fe)),Re=we=xe.length;xe[--we]==0;xe.pop());if(!xe[0])return Me.charAt(0);if(Ne<0?--Re:(nt.c=xe,nt.e=Re,nt.s=Z,nt=e(nt,le,Oe,Je,H),xe=nt.c,De=nt.r,Re=nt.e),Be=Re+Oe+1,Ne=xe[Be],we=H/2,De=De||Be<0||xe[Be+1]!=null,De=Je<4?(Ne!=null||De)&&(Je==0||Je==(nt.s<0?3:2)):Ne>we||Ne==we&&(Je==4||De||Je==6&&xe[Be-1]&1||Je==(nt.s<0?8:7)),Be<1||!xe[0])q=De?dp(Me.charAt(1),-Oe,Me.charAt(0)):Me.charAt(0);else{if(xe.length=Be,De)for(--H;++xe[--Be]>H;)xe[Be]=0,Be||(++Re,xe=[1].concat(xe));for(we=xe.length;!xe[--we];);for(Ne=0,q="";Ne<=we;q+=Me.charAt(xe[Ne++]));q=dp(q,Re,Me.charAt(0))}return q}})(),e=(function(){function U(j,H,Z){var be,Me,Be,Re,we=0,De=j.length,nt=H%Yp,xe=H/Yp|0;for(j=j.slice();De--;)Be=j[De]%Yp,Re=j[De]/Yp|0,be=xe*Be+Re*nt,Me=nt*Be+be%Yp*Yp+we,we=(Me/Z|0)+(be/Yp|0)+xe*Re,j[De]=Me%Z;return we&&(j=[we].concat(j)),j}function F(j,H,Z,be){var Me,Be;if(Z!=be)Be=Z>be?1:-1;else for(Me=Be=0;Me<Z;Me++)if(j[Me]!=H[Me]){Be=j[Me]>H[Me]?1:-1;break}return Be}function q(j,H,Z,be){for(var Me=0;Z--;)j[Z]-=Me,Me=j[Z]<H[Z]?1:0,j[Z]=Me*be+j[Z]-H[Z];for(;!j[0]&&j.length>1;j.splice(0,1));}return function(j,H,Z,be,Me){var Be,Re,we,De,nt,xe,le,Ne,Oe,Je,rt,mt,dt,Dt,tn,ln,yn,Mn=j.s==H.s?1:-1,Gt=j.c,st=H.c;if(!Gt||!Gt[0]||!st||!st[0])return new ne(!j.s||!H.s||(Gt?st&&Gt[0]==st[0]:!st)?NaN:Gt&&Gt[0]==0||!st?Mn*0:Mn/0);for(Ne=new ne(Mn),Oe=Ne.c=[],Re=j.e-H.e,Mn=Z+Re+1,Me||(Me=Wd,Re=Md(j.e/ko)-Md(H.e/ko),Mn=Mn/ko|0),we=0;st[we]==(Gt[we]||0);we++);if(st[we]>(Gt[we]||0)&&Re--,Mn<0)Oe.push(1),De=!0;else{for(Dt=Gt.length,ln=st.length,we=0,Mn+=2,nt=kd(Me/(st[0]+1)),nt>1&&(st=U(st,nt,Me),Gt=U(Gt,nt,Me),ln=st.length,Dt=Gt.length),dt=ln,Je=Gt.slice(0,ln),rt=Je.length;rt<ln;Je[rt++]=0);yn=st.slice(),yn=[0].concat(yn),tn=st[0],st[1]>=Me/2&&tn++;do{if(nt=0,Be=F(st,Je,ln,rt),Be<0){if(mt=Je[0],ln!=rt&&(mt=mt*Me+(Je[1]||0)),nt=kd(mt/tn),nt>1)for(nt>=Me&&(nt=Me-1),xe=U(st,nt,Me),le=xe.length,rt=Je.length;F(xe,Je,le,rt)==1;)nt--,q(xe,ln<le?yn:st,le,Me),le=xe.length,Be=1;else nt==0&&(Be=nt=1),xe=st.slice(),le=xe.length;if(le<rt&&(xe=[0].concat(xe)),q(Je,xe,rt,Me),rt=Je.length,Be==-1)for(;F(st,Je,ln,rt)<1;)nt++,q(Je,ln<rt?yn:st,rt,Me),rt=Je.length}else Be===0&&(nt++,Je=[0]);Oe[we++]=nt,Je[0]?Je[rt++]=Gt[dt]||0:(Je=[Gt[dt]],rt=1)}while((dt++<Dt||Je[0]!=null)&&Mn--);De=Je[0]!=null,Oe[0]||Oe.splice(0,1)}if(Me==Wd){for(we=1,Mn=Oe[0];Mn>=10;Mn/=10,we++);ze(Ne,Z+(Ne.e=we+Re*ko-1)+1,be,De)}else Ne.e=Re,Ne.r=+De;return Ne}})();function me(U,F,q,j){var H,Z,be,Me,Be;if(q==null?q=_:Zl(q,0,8),!U.c)return U.toString();if(H=U.c[0],be=U.e,F==null)Be=Pd(U.c),Be=j==1||j==2&&(be<=o||be>=w)?L1(Be,be):dp(Be,be,"0");else if(U=ze(new ne(U),F,q),Z=U.e,Be=Pd(U.c),Me=Be.length,j==1||j==2&&(F<=Z||Z<=o)){for(;Me<F;Be+="0",Me++);Be=L1(Be,Z)}else if(F-=be+(j===2&&Z>be),Be=dp(Be,Z,"0"),Z+1>Me){if(--F>0)for(Be+=".";F--;Be+="0");}else if(F+=Z-Me,F>0)for(Z+1==Me&&(Be+=".");F--;Be+="0");return U.s<0&&H?"-"+Be:Be}function ue(U,F){for(var q,j,H=1,Z=new ne(U[0]);H<U.length;H++)j=new ne(U[H]),(!j.s||(q=zm(Z,j))===F||q===0&&Z.s===F)&&(Z=j);return Z}function ke(U,F,q){for(var j=1,H=F.length;!F[--H];F.pop());for(H=F[0];H>=10;H/=10,j++);return(q=j+q*ko-1)>R?U.c=U.e=null:q<I?U.c=[U.e=0]:(U.e=q,U.c=F),U}i=(function(){var U=/^(-?)0([xbo])(?=\w[\w.]*$)/i,F=/^([^.]+)\.$/,q=/^\.([^.]+)$/,j=/^-?(Infinity|NaN)$/,H=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(Z,be,Me,Be){var Re,we=Me?be:be.replace(H,"");if(j.test(we))Z.s=isNaN(we)?null:we<0?-1:1;else{if(!Me&&(we=we.replace(U,function(De,nt,xe){return Re=(xe=xe.toLowerCase())=="x"?16:xe=="b"?2:8,!Be||Be==Re?nt:De}),Be&&(Re=Be,we=we.replace(F,"$1").replace(q,"0.$1")),be!=we))return new ne(we,Re);if(ne.DEBUG)throw Error(Xh+"Not a"+(Be?" base "+Be:"")+" number: "+be);Z.s=null}Z.c=Z.e=null}})();function ze(U,F,q,j){var H,Z,be,Me,Be,Re,we,De=U.c,nt=Kb;if(De){e:{for(H=1,Me=De[0];Me>=10;Me/=10,H++);if(Z=F-H,Z<0)Z+=ko,be=F,Be=De[Re=0],we=kd(Be/nt[H-be-1]%10);else if(Re=Hb((Z+1)/ko),Re>=De.length)if(j){for(;De.length<=Re;De.push(0));Be=we=0,H=1,Z%=ko,be=Z-ko+1}else break e;else{for(Be=Me=De[Re],H=1;Me>=10;Me/=10,H++);Z%=ko,be=Z-ko+H,we=be<0?0:kd(Be/nt[H-be-1]%10)}if(j=j||F<0||De[Re+1]!=null||(be<0?Be:Be%nt[H-be-1]),j=q<4?(we||j)&&(q==0||q==(U.s<0?3:2)):we>5||we==5&&(q==4||j||q==6&&(Z>0?be>0?Be/nt[H-be]:0:De[Re-1])%10&1||q==(U.s<0?8:7)),F<1||!De[0])return De.length=0,j?(F-=U.e+1,De[0]=nt[(ko-F%ko)%ko],U.e=-F||0):De[0]=U.e=0,U;if(Z==0?(De.length=Re,Me=1,Re--):(De.length=Re+1,Me=nt[ko-Z],De[Re]=be>0?kd(Be/nt[H-be]%nt[be])*Me:0),j)for(;;)if(Re==0){for(Z=1,be=De[0];be>=10;be/=10,Z++);for(be=De[0]+=Me,Me=1;be>=10;be/=10,Me++);Z!=Me&&(U.e++,De[0]==Wd&&(De[0]=1));break}else{if(De[Re]+=Me,De[Re]!=Wd)break;De[Re--]=0,Me=1}for(Z=De.length;De[--Z]===0;De.pop());}U.e>R?U.c=U.e=null:U.e<I&&(U.c=[U.e=0])}return U}function pe(U){var F,q=U.e;return q===null?U.toString():(F=Pd(U.c),F=q<=o||q>=w?L1(F,q):dp(F,q,"0"),U.s<0?"-"+F:F)}return c.absoluteValue=c.abs=function(){var U=new ne(this);return U.s<0&&(U.s=1),U},c.comparedTo=function(U,F){return zm(this,new ne(U,F))},c.decimalPlaces=c.dp=function(U,F){var q,j,H,Z=this;if(U!=null)return Zl(U,0,Au),F==null?F=_:Zl(F,0,8),ze(new ne(Z),U+Z.e+1,F);if(!(q=Z.c))return null;if(j=((H=q.length-1)-Md(this.e/ko))*ko,H=q[H])for(;H%10==0;H/=10,j--);return j<0&&(j=0),j},c.dividedBy=c.div=function(U,F){return e(this,new ne(U,F),m,_)},c.dividedToIntegerBy=c.idiv=function(U,F){return e(this,new ne(U,F),0,1)},c.exponentiatedBy=c.pow=function(U,F){var q,j,H,Z,be,Me,Be,Re,we,De=this;if(U=new ne(U),U.c&&!U.isInteger())throw Error(Xh+"Exponent not an integer: "+pe(U));if(F!=null&&(F=new ne(F)),Me=U.e>14,!De.c||!De.c[0]||De.c[0]==1&&!De.e&&De.c.length==1||!U.c||!U.c[0])return we=new ne(Math.pow(+pe(De),Me?U.s*(2-C1(U)):+pe(U))),F?we.mod(F):we;if(Be=U.s<0,F){if(F.c?!F.c[0]:!F.s)return new ne(NaN);j=!Be&&De.isInteger()&&F.isInteger(),j&&(De=De.mod(F))}else{if(U.e>9&&(De.e>0||De.e<-1||(De.e==0?De.c[0]>1||Me&&De.c[1]>=24e7:De.c[0]<8e13||Me&&De.c[0]<=9999975e7)))return Z=De.s<0&&C1(U)?-0:0,De.e>-1&&(Z=1/Z),new ne(Be?1/Z:Z);ie&&(Z=Hb(ie/ko+2))}for(Me?(q=new ne(.5),Be&&(U.s=1),Re=C1(U)):(H=Math.abs(+pe(U)),Re=H%2),we=new ne(u);;){if(Re){if(we=we.times(De),!we.c)break;Z?we.c.length>Z&&(we.c.length=Z):j&&(we=we.mod(F))}if(H){if(H=kd(H/2),H===0)break;Re=H%2}else if(U=U.times(q),ze(U,U.e+1,1),U.e>14)Re=C1(U);else{if(H=+pe(U),H===0)break;Re=H%2}De=De.times(De),Z?De.c&&De.c.length>Z&&(De.c.length=Z):j&&(De=De.mod(F))}return j?we:(Be&&(we=u.div(we)),F?we.mod(F):Z?ze(we,ie,_,be):we)},c.integerValue=function(U){var F=new ne(this);return U==null?U=_:Zl(U,0,8),ze(F,F.e+1,U)},c.isEqualTo=c.eq=function(U,F){return zm(this,new ne(U,F))===0},c.isFinite=function(){return!!this.c},c.isGreaterThan=c.gt=function(U,F){return zm(this,new ne(U,F))>0},c.isGreaterThanOrEqualTo=c.gte=function(U,F){return(F=zm(this,new ne(U,F)))===1||F===0},c.isInteger=function(){return!!this.c&&Md(this.e/ko)>this.c.length-2},c.isLessThan=c.lt=function(U,F){return zm(this,new ne(U,F))<0},c.isLessThanOrEqualTo=c.lte=function(U,F){return(F=zm(this,new ne(U,F)))===-1||F===0},c.isNaN=function(){return!this.s},c.isNegative=function(){return this.s<0},c.isPositive=function(){return this.s>0},c.isZero=function(){return!!this.c&&this.c[0]==0},c.minus=function(U,F){var q,j,H,Z,be=this,Me=be.s;if(U=new ne(U,F),F=U.s,!Me||!F)return new ne(NaN);if(Me!=F)return U.s=-F,be.plus(U);var Be=be.e/ko,Re=U.e/ko,we=be.c,De=U.c;if(!Be||!Re){if(!we||!De)return we?(U.s=-F,U):new ne(De?be:NaN);if(!we[0]||!De[0])return De[0]?(U.s=-F,U):new ne(we[0]?be:_==3?-0:0)}if(Be=Md(Be),Re=Md(Re),we=we.slice(),Me=Be-Re){for((Z=Me<0)?(Me=-Me,H=we):(Re=Be,H=De),H.reverse(),F=Me;F--;H.push(0));H.reverse()}else for(j=(Z=(Me=we.length)<(F=De.length))?Me:F,Me=F=0;F<j;F++)if(we[F]!=De[F]){Z=we[F]<De[F];break}if(Z&&(H=we,we=De,De=H,U.s=-U.s),F=(j=De.length)-(q=we.length),F>0)for(;F--;we[q++]=0);for(F=Wd-1;j>Me;){if(we[--j]<De[j]){for(q=j;q&&!we[--q];we[q]=F);--we[q],we[j]+=Wd}we[j]-=De[j]}for(;we[0]==0;we.splice(0,1),--Re);return we[0]?ke(U,we,Re):(U.s=_==3?-1:1,U.c=[U.e=0],U)},c.modulo=c.mod=function(U,F){var q,j,H=this;return U=new ne(U,F),!H.c||!U.s||U.c&&!U.c[0]?new ne(NaN):!U.c||H.c&&!H.c[0]?new ne(H):(k==9?(j=U.s,U.s=1,q=e(H,U,0,3),U.s=j,q.s*=j):q=e(H,U,0,k),U=H.minus(q.times(U)),!U.c[0]&&k==1&&(U.s=H.s),U)},c.multipliedBy=c.times=function(U,F){var q,j,H,Z,be,Me,Be,Re,we,De,nt,xe,le,Ne,Oe,Je=this,rt=Je.c,mt=(U=new ne(U,F)).c;if(!rt||!mt||!rt[0]||!mt[0])return!Je.s||!U.s||rt&&!rt[0]&&!mt||mt&&!mt[0]&&!rt?U.c=U.e=U.s=null:(U.s*=Je.s,!rt||!mt?U.c=U.e=null:(U.c=[0],U.e=0)),U;for(j=Md(Je.e/ko)+Md(U.e/ko),U.s*=Je.s,Be=rt.length,De=mt.length,Be<De&&(le=rt,rt=mt,mt=le,H=Be,Be=De,De=H),H=Be+De,le=[];H--;le.push(0));for(Ne=Wd,Oe=Yp,H=De;--H>=0;){for(q=0,nt=mt[H]%Oe,xe=mt[H]/Oe|0,be=Be,Z=H+be;Z>H;)Re=rt[--be]%Oe,we=rt[be]/Oe|0,Me=xe*Re+we*nt,Re=nt*Re+Me%Oe*Oe+le[Z]+q,q=(Re/Ne|0)+(Me/Oe|0)+xe*we,le[Z--]=Re%Ne;le[Z]=q}return q?++j:le.splice(0,1),ke(U,le,j)},c.negated=function(){var U=new ne(this);return U.s=-U.s||null,U},c.plus=function(U,F){var q,j=this,H=j.s;if(U=new ne(U,F),F=U.s,!H||!F)return new ne(NaN);if(H!=F)return U.s=-F,j.minus(U);var Z=j.e/ko,be=U.e/ko,Me=j.c,Be=U.c;if(!Z||!be){if(!Me||!Be)return new ne(H/0);if(!Me[0]||!Be[0])return Be[0]?U:new ne(Me[0]?j:H*0)}if(Z=Md(Z),be=Md(be),Me=Me.slice(),H=Z-be){for(H>0?(be=Z,q=Be):(H=-H,q=Me),q.reverse();H--;q.push(0));q.reverse()}for(H=Me.length,F=Be.length,H-F<0&&(q=Be,Be=Me,Me=q,F=H),H=0;F;)H=(Me[--F]=Me[F]+Be[F]+H)/Wd|0,Me[F]=Wd===Me[F]?0:Me[F]%Wd;return H&&(Me=[H].concat(Me),++be),ke(U,Me,be)},c.precision=c.sd=function(U,F){var q,j,H,Z=this;if(U!=null&&U!==!!U)return Zl(U,1,Au),F==null?F=_:Zl(F,0,8),ze(new ne(Z),U,F);if(!(q=Z.c))return null;if(H=q.length-1,j=H*ko+1,H=q[H]){for(;H%10==0;H/=10,j--);for(H=q[0];H>=10;H/=10,j++);}return U&&Z.e+1>j&&(j=Z.e+1),j},c.shiftedBy=function(U){return Zl(U,-Wb,Wb),this.times("1e"+U)},c.squareRoot=c.sqrt=function(){var U,F,q,j,H,Z=this,be=Z.c,Me=Z.s,Be=Z.e,Re=m+4,we=new ne("0.5");if(Me!==1||!be||!be[0])return new ne(!Me||Me<0&&(!be||be[0])?NaN:be?Z:1/0);if(Me=Math.sqrt(+pe(Z)),Me==0||Me==1/0?(F=Pd(be),(F.length+Be)%2==0&&(F+="0"),Me=Math.sqrt(+F),Be=Md((Be+1)/2)-(Be<0||Be%2),Me==1/0?F="5e"+Be:(F=Me.toExponential(),F=F.slice(0,F.indexOf("e")+1)+Be),q=new ne(F)):q=new ne(Me+""),q.c[0]){for(Be=q.e,Me=Be+Re,Me<3&&(Me=0);;)if(H=q,q=we.times(H.plus(e(Z,H,Re,1))),Pd(H.c).slice(0,Me)===(F=Pd(q.c)).slice(0,Me))if(q.e<Be&&--Me,F=F.slice(Me-3,Me+1),F=="9999"||!j&&F=="4999"){if(!j&&(ze(H,H.e+m+2,0),H.times(H).eq(Z))){q=H;break}Re+=4,Me+=4,j=1}else{(!+F||!+F.slice(1)&&F.charAt(0)=="5")&&(ze(q,q.e+m+2,1),U=!q.times(q).eq(Z));break}}return ze(q,q.e+m+1,_,U)},c.toExponential=function(U,F){return U!=null&&(Zl(U,0,Au),U++),me(this,U,F,1)},c.toFixed=function(U,F){return U!=null&&(Zl(U,0,Au),U=U+this.e+1),me(this,U,F)},c.toFormat=function(U,F,q){var j,H=this;if(q==null)U!=null&&F&&typeof F=="object"?(q=F,F=null):U&&typeof U=="object"?(q=U,U=F=null):q=ae;else if(typeof q!="object")throw Error(Xh+"Argument not an object: "+q);if(j=H.toFixed(U,F),H.c){var Z,be=j.split("."),Me=+q.groupSize,Be=+q.secondaryGroupSize,Re=q.groupSeparator||"",we=be[0],De=be[1],nt=H.s<0,xe=nt?we.slice(1):we,le=xe.length;if(Be&&(Z=Me,Me=Be,Be=Z,le-=Z),Me>0&&le>0){for(Z=le%Me||Me,we=xe.substr(0,Z);Z<le;Z+=Me)we+=Re+xe.substr(Z,Me);Be>0&&(we+=Re+xe.slice(Z)),nt&&(we="-"+we)}j=De?we+(q.decimalSeparator||"")+((Be=+q.fractionGroupSize)?De.replace(new RegExp("\\d{"+Be+"}\\B","g"),"$&"+(q.fractionGroupSeparator||"")):De):we}return(q.prefix||"")+j+(q.suffix||"")},c.toFraction=function(U){var F,q,j,H,Z,be,Me,Be,Re,we,De,nt,xe=this,le=xe.c;if(U!=null&&(Me=new ne(U),!Me.isInteger()&&(Me.c||Me.s!==1)||Me.lt(u)))throw Error(Xh+"Argument "+(Me.isInteger()?"out of range: ":"not an integer: ")+pe(Me));if(!le)return new ne(xe);for(F=new ne(u),Re=q=new ne(u),j=Be=new ne(u),nt=Pd(le),Z=F.e=nt.length-xe.e-1,F.c[0]=Kb[(be=Z%ko)<0?ko+be:be],U=!U||Me.comparedTo(F)>0?Z>0?F:Re:Me,be=R,R=1/0,Me=new ne(nt),Be.c[0]=0;we=e(Me,F,0,1),H=q.plus(we.times(j)),H.comparedTo(U)!=1;)q=j,j=H,Re=Be.plus(we.times(H=Re)),Be=H,F=Me.minus(we.times(H=F)),Me=H;return H=e(U.minus(q),j,0,1),Be=Be.plus(H.times(Re)),q=q.plus(H.times(j)),Be.s=Re.s=xe.s,Z=Z*2,De=e(Re,j,Z,_).minus(xe).abs().comparedTo(e(Be,q,Z,_).minus(xe).abs())<1?[Re,j]:[Be,q],R=be,De},c.toNumber=function(){return+pe(this)},c.toPrecision=function(U,F){return U!=null&&Zl(U,1,Au),me(this,U,F,2)},c.toString=function(U){var F,q=this,j=q.s,H=q.e;return H===null?j?(F="Infinity",j<0&&(F="-"+F)):F="NaN":(U==null?F=H<=o||H>=w?L1(Pd(q.c),H):dp(Pd(q.c),H,"0"):U===10&&J?(q=ze(new ne(q),m+H+1,_),F=dp(Pd(q.c),q.e,"0")):(Zl(U,2,fe.length,"Base"),F=t(dp(Pd(q.c),H,"0"),10,U,j,!0)),j<0&&q.c[0]&&(F="-"+F)),F},c.valueOf=c.toJSON=function(){return pe(this)},c._isBigNumber=!0,c[Symbol.toStringTag]="BigNumber",c[Symbol.for("nodejs.util.inspect.custom")]=c.valueOf,n!=null&&ne.set(n),ne}function Md(n){var e=n|0;return n>0||n===e?e:e-1}function Pd(n){for(var e,t,i=1,c=n.length,u=n[0]+"";i<c;){for(e=n[i++]+"",t=ko-e.length;t--;e="0"+e);u+=e}for(c=u.length;u.charCodeAt(--c)===48;);return u.slice(0,c+1||1)}function zm(n,e){var t,i,c=n.c,u=e.c,m=n.s,_=e.s,o=n.e,w=e.e;if(!m||!_)return null;if(t=c&&!c[0],i=u&&!u[0],t||i)return t?i?0:-_:m;if(m!=_)return m;if(t=m<0,i=o==w,!c||!u)return i?0:!c^t?1:-1;if(!i)return o>w^t?1:-1;for(_=(o=c.length)<(w=u.length)?o:w,m=0;m<_;m++)if(c[m]!=u[m])return c[m]>u[m]^t?1:-1;return o==w?0:o>w^t?1:-1}function Zl(n,e,t,i){if(n<e||n>t||n!==kd(n))throw Error(Xh+(i||"Argument")+(typeof n=="number"?n<e||n>t?" out of range: ":" not an integer: ":" not a primitive number: ")+String(n))}function C1(n){var e=n.c.length-1;return Md(n.e/ko)==e&&n.c[e]%2!=0}function L1(n,e){return(n.length>1?n.charAt(0)+"."+n.slice(1):n)+(e<0?"e":"e+")+e}function dp(n,e,t){var i,c;if(e<0){for(c=t+".";++e;c+=t);n=c+n}else if(i=n.length,++e>i){for(c=t,e-=i;--e;c+=t);n+=c}else e<i&&(n=n.slice(0,e)+"."+n.slice(e));return n}var Ff=g8(),Pj=class{key;left=null;right=null;constructor(n){this.key=n}},Ty=class extends Pj{constructor(n){super(n)}},kj=class{size=0;modificationCount=0;splayCount=0;splay(n){const e=this.root;if(e==null)return this.compare(n,n),-1;let t=null,i=null,c=null,u=null,m=e;const _=this.compare;let o;for(;;)if(o=_(m.key,n),o>0){let w=m.left;if(w==null||(o=_(w.key,n),o>0&&(m.left=w.right,w.right=m,m=w,w=m.left,w==null)))break;t==null?i=m:t.left=m,t=m,m=w}else if(o<0){let w=m.right;if(w==null||(o=_(w.key,n),o<0&&(m.right=w.left,w.left=m,m=w,w=m.right,w==null)))break;c==null?u=m:c.right=m,c=m,m=w}else break;return c!=null&&(c.right=m.left,m.left=u),t!=null&&(t.left=m.right,m.right=i),this.root!==m&&(this.root=m,this.splayCount++),o}splayMin(n){let e=n,t=e.left;for(;t!=null;){const i=t;e.left=i.right,i.right=e,e=i,t=e.left}return e}splayMax(n){let e=n,t=e.right;for(;t!=null;){const i=t;e.right=i.left,i.left=e,e=i,t=e.right}return e}_delete(n){if(this.root==null||this.splay(n)!=0)return null;let t=this.root;const i=t,c=t.left;if(this.size--,c==null)this.root=t.right;else{const u=t.right;t=this.splayMax(c),t.right=u,this.root=t}return this.modificationCount++,i}addNewRoot(n,e){this.size++,this.modificationCount++;const t=this.root;if(t==null){this.root=n;return}e<0?(n.left=t,n.right=t.right,t.right=null):(n.right=t,n.left=t.left,t.left=null),this.root=n}_first(){const n=this.root;return n==null?null:(this.root=this.splayMin(n),this.root)}_last(){const n=this.root;return n==null?null:(this.root=this.splayMax(n),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(n){return this.validKey(n)&&this.splay(n)==0}defaultCompare(){return(n,e)=>n<e?-1:n>e?1:0}wrap(){return{getRoot:()=>this.root,setRoot:n=>{this.root=n},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:n=>{this.splayCount=n},splay:n=>this.splay(n),has:n=>this.has(n)}}},Mv=class Dy extends kj{root=null;compare;validKey;constructor(e,t){super(),this.compare=e??this.defaultCompare(),this.validKey=t??(i=>i!=null&&i!=null)}delete(e){return this.validKey(e)?this._delete(e)!=null:!1}deleteAll(e){for(const t of e)this.delete(t)}forEach(e){const t=this[Symbol.iterator]();let i;for(;i=t.next(),!i.done;)e(i.value,i.value,this)}add(e){const t=this.splay(e);return t!=0&&this.addNewRoot(new Ty(e),t),this}addAndReturn(e){const t=this.splay(e);return t!=0&&this.addNewRoot(new Ty(e),t),this.root.key}addAll(e){for(const t of e)this.add(t)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)<0)return this.root.key;let i=this.root.left;if(i==null)return null;let c=i.right;for(;c!=null;)i=c,c=i.right;return i.key}firstAfter(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)>0)return this.root.key;let i=this.root.right;if(i==null)return null;let c=i.left;for(;c!=null;)i=c,c=i.left;return i.key}retainAll(e){const t=new Dy(this.compare,this.validKey),i=this.modificationCount;for(const c of e){if(i!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(c)&&this.splay(c)==0&&t.add(this.root.key)}t.size!=this.size&&(this.root=t.root,this.size=t.size,this.modificationCount++)}lookup(e){return!this.validKey(e)||this.splay(e)!=0?null:this.root.key}intersection(e){const t=new Dy(this.compare,this.validKey);for(const i of this)e.has(i)&&t.add(i);return t}difference(e){const t=new Dy(this.compare,this.validKey);for(const i of this)e.has(i)||t.add(i);return t}union(e){const t=this.clone();return t.addAll(e),t}clone(){const e=new Dy(this.compare,this.validKey);return e.size=this.size,e.root=this.copyNode(this.root),e}copyNode(e){if(e==null)return null;function t(c,u){let m,_;do{if(m=c.left,_=c.right,m!=null){const o=new Ty(m.key);u.left=o,t(m,o)}if(_!=null){const o=new Ty(_.key);u.right=o,c=_,u=o}}while(_!=null)}const i=new Ty(e.key);return t(e,i),i}toSet(){return this.clone()}entries(){return new Rj(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[Symbol.iterator](){return new Mj(this.wrap())}[Symbol.toStringTag]="[object Set]"},y8=class{tree;path=new Array;modificationCount=null;splayCount;constructor(n){this.tree=n,this.splayCount=n.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;const n=this.path[this.path.length-1];return this.getValue(n)}rebuildPath(n){this.path.splice(0,this.path.length),this.tree.splay(n),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(n){for(;n!=null;)this.path.push(n),n=n.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let t=this.tree.getRoot();for(;t!=null;)this.path.push(t),t=t.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let n=this.path[this.path.length-1],e=n.right;if(e!=null){for(;e!=null;)this.path.push(e),e=e.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===n;)n=this.path.pop();return this.path.length>0}},Mj=class extends y8{getValue(n){return n.key}},Rj=class extends y8{getValue(n){return[n.key,n.key]}},_8=n=>()=>n,K5=n=>{const e=n?(t,i)=>i.minus(t).abs().isLessThanOrEqualTo(n):_8(!1);return(t,i)=>e(t,i)?0:t.comparedTo(i)};function Nj(n){const e=n?(t,i,c,u,m)=>t.exponentiatedBy(2).isLessThanOrEqualTo(u.minus(i).exponentiatedBy(2).plus(m.minus(c).exponentiatedBy(2)).times(n)):_8(!1);return(t,i,c)=>{const u=t.x,m=t.y,_=c.x,o=c.y,w=m.minus(o).times(i.x.minus(_)).minus(u.minus(_).times(i.y.minus(o)));return e(w,u,m,_,o)?0:w.comparedTo(0)}}var Dj=n=>n,Fj=n=>{if(n){const e=new Mv(K5(n)),t=new Mv(K5(n)),i=(u,m)=>m.addAndReturn(u),c=u=>({x:i(u.x,e),y:i(u.y,t)});return c({x:new Ff(0),y:new Ff(0)}),c}return Dj},X5=n=>({set:e=>{Lp=X5(e)},reset:()=>X5(n),compare:K5(n),snap:Fj(n),orient:Nj(n)}),Lp=X5(),Iy=(n,e)=>n.ll.x.isLessThanOrEqualTo(e.x)&&e.x.isLessThanOrEqualTo(n.ur.x)&&n.ll.y.isLessThanOrEqualTo(e.y)&&e.y.isLessThanOrEqualTo(n.ur.y),Z5=(n,e)=>{if(e.ur.x.isLessThan(n.ll.x)||n.ur.x.isLessThan(e.ll.x)||e.ur.y.isLessThan(n.ll.y)||n.ur.y.isLessThan(e.ll.y))return null;const t=n.ll.x.isLessThan(e.ll.x)?e.ll.x:n.ll.x,i=n.ur.x.isLessThan(e.ur.x)?n.ur.x:e.ur.x,c=n.ll.y.isLessThan(e.ll.y)?e.ll.y:n.ll.y,u=n.ur.y.isLessThan(e.ur.y)?n.ur.y:e.ur.y;return{ll:{x:t,y:c},ur:{x:i,y:u}}},tv=(n,e)=>n.x.times(e.y).minus(n.y.times(e.x)),v8=(n,e)=>n.x.times(e.x).plus(n.y.times(e.y)),Rv=n=>v8(n,n).sqrt(),Oj=(n,e,t)=>{const i={x:e.x.minus(n.x),y:e.y.minus(n.y)},c={x:t.x.minus(n.x),y:t.y.minus(n.y)};return tv(c,i).div(Rv(c)).div(Rv(i))},Bj=(n,e,t)=>{const i={x:e.x.minus(n.x),y:e.y.minus(n.y)},c={x:t.x.minus(n.x),y:t.y.minus(n.y)};return v8(c,i).div(Rv(c)).div(Rv(i))},SA=(n,e,t)=>e.y.isZero()?null:{x:n.x.plus(e.x.div(e.y).times(t.minus(n.y))),y:t},EA=(n,e,t)=>e.x.isZero()?null:{x:t,y:n.y.plus(e.y.div(e.x).times(t.minus(n.x)))},zj=(n,e,t,i)=>{if(e.x.isZero())return EA(t,i,n.x);if(i.x.isZero())return EA(n,e,t.x);if(e.y.isZero())return SA(t,i,n.y);if(i.y.isZero())return SA(n,e,t.y);const c=tv(e,i);if(c.isZero())return null;const u={x:t.x.minus(n.x),y:t.y.minus(n.y)},m=tv(u,e).div(c),_=tv(u,i).div(c),o=n.x.plus(_.times(e.x)),w=t.x.plus(m.times(i.x)),I=n.y.plus(_.times(e.y)),R=t.y.plus(m.times(i.y)),V=o.plus(w).div(2),k=I.plus(R).div(2);return{x:V,y:k}},Pf=class x8{point;isLeft;segment;otherSE;consumedBy;static compare(e,t){const i=x8.comparePoints(e.point,t.point);return i!==0?i:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:Nv.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x.isLessThan(t.x)?-1:e.x.isGreaterThan(t.x)?1:e.y.isLessThan(t.y)?-1:e.y.isGreaterThan(t.y)?1:0}constructor(e,t){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let i=0,c=t.length;i<c;i++){const u=t[i];this.point.events.push(u),u.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const i=this.point.events[t];if(i.segment.consumedBy===void 0)for(let c=t+1;c<e;c++){const u=this.point.events[c];u.consumedBy===void 0&&i.otherSE.point.events===u.otherSE.point.events&&i.segment.consume(u.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,i=this.point.events.length;t<i;t++){const c=this.point.events[t];c!==this&&!c.segment.ringOut&&c.segment.isInResult()&&e.push(c)}return e}getLeftmostComparator(e){const t=new Map,i=c=>{const u=c.otherSE;t.set(c,{sine:Oj(this.point,e.point,u.point),cosine:Bj(this.point,e.point,u.point)})};return(c,u)=>{t.has(c)||i(c),t.has(u)||i(u);const{sine:m,cosine:_}=t.get(c),{sine:o,cosine:w}=t.get(u);return m.isGreaterThanOrEqualTo(0)&&o.isGreaterThanOrEqualTo(0)?_.isLessThan(w)?1:_.isGreaterThan(w)?-1:0:m.isLessThan(0)&&o.isLessThan(0)?_.isLessThan(w)?-1:_.isGreaterThan(w)?1:0:o.isLessThan(m)?-1:o.isGreaterThan(m)?1:0}}},jj=class Y5{events;poly;_isExteriorRing;_enclosingRing;static factory(e){const t=[];for(let i=0,c=e.length;i<c;i++){const u=e[i];if(!u.isInResult()||u.ringOut)continue;let m=null,_=u.leftSE,o=u.rightSE;const w=[_],I=_.point,R=[];for(;m=_,_=o,w.push(_),_.point!==I;)for(;;){const V=_.getAvailableLinkedEvents();if(V.length===0){const ae=w[0].point,fe=w[w.length-1].point;throw new Error(`Unable to complete output ring starting at [${ae.x}, ${ae.y}]. Last matching segment found ends at [${fe.x}, ${fe.y}].`)}if(V.length===1){o=V[0].otherSE;break}let k=null;for(let ae=0,fe=R.length;ae<fe;ae++)if(R[ae].point===_.point){k=ae;break}if(k!==null){const ae=R.splice(k)[0],fe=w.splice(ae.index);fe.unshift(fe[0].otherSE),t.push(new Y5(fe.reverse()));continue}R.push({index:w.length,point:_.point});const ie=_.getLeftmostComparator(m);o=V.sort(ie)[0].otherSE;break}t.push(new Y5(w))}return t}constructor(e){this.events=e;for(let t=0,i=e.length;t<i;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const t=[e];for(let w=1,I=this.events.length-1;w<I;w++){const R=this.events[w].point,V=this.events[w+1].point;Lp.orient(R,e,V)!==0&&(t.push(R),e=R)}if(t.length===1)return null;const i=t[0],c=t[1];Lp.orient(i,e,c)===0&&t.shift(),t.push(t[0]);const u=this.isExteriorRing()?1:-1,m=this.isExteriorRing()?0:t.length-1,_=this.isExteriorRing()?t.length:-1,o=[];for(let w=m;w!=_;w+=u)o.push([t[w].x.toNumber(),t[w].y.toNumber()]);return o}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let c=1,u=this.events.length;c<u;c++){const m=this.events[c];Pf.compare(e,m)>0&&(e=m)}let t=e.segment.prevInResult(),i=t?t.prevInResult():null;for(;;){if(!t)return null;if(!i)return t.ringOut;if(i.ringOut!==t.ringOut)return i.ringOut?.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut?.enclosingRing();t=i.prevInResult(),i=t?t.prevInResult():null}}},AA=class{exteriorRing;interiorRings;constructor(n){this.exteriorRing=n,n.poly=this,this.interiorRings=[]}addInterior(n){this.interiorRings.push(n),n.poly=this}getGeom(){const n=this.exteriorRing.getGeom();if(n===null)return null;const e=[n];for(let t=0,i=this.interiorRings.length;t<i;t++){const c=this.interiorRings[t].getGeom();c!==null&&e.push(c)}return e}},Uj=class{rings;polys;constructor(n){this.rings=n,this.polys=this._composePolys(n)}getGeom(){const n=[];for(let e=0,t=this.polys.length;e<t;e++){const i=this.polys[e].getGeom();i!==null&&n.push(i)}return n}_composePolys(n){const e=[];for(let t=0,i=n.length;t<i;t++){const c=n[t];if(!c.poly)if(c.isExteriorRing())e.push(new AA(c));else{const u=c.enclosingRing();u?.poly||e.push(new AA(u)),u?.poly?.addInterior(c)}}return e}},Vj=class{queue;tree;segments;constructor(n,e=Nv.compare){this.queue=n,this.tree=new Mv(e),this.segments=[]}process(n){const e=n.segment,t=[];if(n.consumedBy)return n.isLeft?this.queue.delete(n.otherSE):this.tree.delete(e),t;n.isLeft&&this.tree.add(e);let i=e,c=e;do i=this.tree.lastBefore(i);while(i!=null&&i.consumedBy!=null);do c=this.tree.firstAfter(c);while(c!=null&&c.consumedBy!=null);if(n.isLeft){let u=null;if(i){const _=i.getIntersection(e);if(_!==null&&(e.isAnEndpoint(_)||(u=_),!i.isAnEndpoint(_))){const o=this._splitSafely(i,_);for(let w=0,I=o.length;w<I;w++)t.push(o[w])}}let m=null;if(c){const _=c.getIntersection(e);if(_!==null&&(e.isAnEndpoint(_)||(m=_),!c.isAnEndpoint(_))){const o=this._splitSafely(c,_);for(let w=0,I=o.length;w<I;w++)t.push(o[w])}}if(u!==null||m!==null){let _=null;u===null?_=m:m===null?_=u:_=Pf.comparePoints(u,m)<=0?u:m,this.queue.delete(e.rightSE),t.push(e.rightSE);const o=e.split(_);for(let w=0,I=o.length;w<I;w++)t.push(o[w])}t.length>0?(this.tree.delete(e),t.push(n)):(this.segments.push(e),e.prev=i)}else{if(i&&c){const u=i.getIntersection(c);if(u!==null){if(!i.isAnEndpoint(u)){const m=this._splitSafely(i,u);for(let _=0,o=m.length;_<o;_++)t.push(m[_])}if(!c.isAnEndpoint(u)){const m=this._splitSafely(c,u);for(let _=0,o=m.length;_<o;_++)t.push(m[_])}}}this.tree.delete(e)}return t}_splitSafely(n,e){this.tree.delete(n);const t=n.rightSE;this.queue.delete(t);const i=n.split(e);return i.push(t),n.consumedBy===void 0&&this.tree.add(n),i}},qj=class{type;numMultiPolys;run(n,e,t){Fy.type=n;const i=[new IA(e,!0)];for(let w=0,I=t.length;w<I;w++)i.push(new IA(t[w],!1));if(Fy.numMultiPolys=i.length,Fy.type==="difference"){const w=i[0];let I=1;for(;I<i.length;)Z5(i[I].bbox,w.bbox)!==null?I++:i.splice(I,1)}if(Fy.type==="intersection")for(let w=0,I=i.length;w<I;w++){const R=i[w];for(let V=w+1,k=i.length;V<k;V++)if(Z5(R.bbox,i[V].bbox)===null)return[]}const c=new Mv(Pf.compare);for(let w=0,I=i.length;w<I;w++){const R=i[w].getSweepEvents();for(let V=0,k=R.length;V<k;V++)c.add(R[V])}const u=new Vj(c);let m=null;for(c.size!=0&&(m=c.first(),c.delete(m));m;){const w=u.process(m);for(let I=0,R=w.length;I<R;I++){const V=w[I];V.consumedBy===void 0&&c.add(V)}c.size!=0?(m=c.first(),c.delete(m)):m=null}Lp.reset();const _=jj.factory(u.segments);return new Uj(_).getGeom()}},Fy=new qj,J5=Fy,$j=0,Nv=class nv{id;leftSE;rightSE;rings;windings;ringOut;consumedBy;prev;_prevInResult;_beforeState;_afterState;_isInResult;static compare(e,t){const i=e.leftSE.point.x,c=t.leftSE.point.x,u=e.rightSE.point.x,m=t.rightSE.point.x;if(m.isLessThan(i))return 1;if(u.isLessThan(c))return-1;const _=e.leftSE.point.y,o=t.leftSE.point.y,w=e.rightSE.point.y,I=t.rightSE.point.y;if(i.isLessThan(c)){if(o.isLessThan(_)&&o.isLessThan(w))return 1;if(o.isGreaterThan(_)&&o.isGreaterThan(w))return-1;const R=e.comparePoint(t.leftSE.point);if(R<0)return 1;if(R>0)return-1;const V=t.comparePoint(e.rightSE.point);return V!==0?V:-1}if(i.isGreaterThan(c)){if(_.isLessThan(o)&&_.isLessThan(I))return-1;if(_.isGreaterThan(o)&&_.isGreaterThan(I))return 1;const R=t.comparePoint(e.leftSE.point);if(R!==0)return R;const V=e.comparePoint(t.rightSE.point);return V<0?1:V>0?-1:1}if(_.isLessThan(o))return-1;if(_.isGreaterThan(o))return 1;if(u.isLessThan(m)){const R=t.comparePoint(e.rightSE.point);if(R!==0)return R}if(u.isGreaterThan(m)){const R=e.comparePoint(t.rightSE.point);if(R<0)return 1;if(R>0)return-1}if(!u.eq(m)){const R=w.minus(_),V=u.minus(i),k=I.minus(o),ie=m.minus(c);if(R.isGreaterThan(V)&&k.isLessThan(ie))return 1;if(R.isLessThan(V)&&k.isGreaterThan(ie))return-1}return u.isGreaterThan(m)?1:u.isLessThan(m)||w.isLessThan(I)?-1:w.isGreaterThan(I)?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,i,c){this.id=++$j,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=i,this.windings=c}static fromRing(e,t,i){let c,u,m;const _=Pf.comparePoints(e,t);if(_<0)c=e,u=t,m=1;else if(_>0)c=t,u=e,m=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const o=new Pf(c,!0),w=new Pf(u,!1);return new nv(o,w,[i],[m])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e.isLessThan(t)?e:t},ur:{x:this.rightSE.point.x,y:e.isGreaterThan(t)?e:t}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(e){return e.x.eq(this.leftSE.point.x)&&e.y.eq(this.leftSE.point.y)||e.x.eq(this.rightSE.point.x)&&e.y.eq(this.rightSE.point.y)}comparePoint(e){return Lp.orient(this.leftSE.point,e,this.rightSE.point)}getIntersection(e){const t=this.bbox(),i=e.bbox(),c=Z5(t,i);if(c===null)return null;const u=this.leftSE.point,m=this.rightSE.point,_=e.leftSE.point,o=e.rightSE.point,w=Iy(t,_)&&this.comparePoint(_)===0,I=Iy(i,u)&&e.comparePoint(u)===0,R=Iy(t,o)&&this.comparePoint(o)===0,V=Iy(i,m)&&e.comparePoint(m)===0;if(I&&w)return V&&!R?m:!V&&R?o:null;if(I)return R&&u.x.eq(o.x)&&u.y.eq(o.y)?null:u;if(w)return V&&m.x.eq(_.x)&&m.y.eq(_.y)?null:_;if(V&&R)return null;if(V)return m;if(R)return o;const k=zj(u,this.vector(),_,e.vector());return k===null||!Iy(c,k)?null:Lp.snap(k)}split(e){const t=[],i=e.events!==void 0,c=new Pf(e,!0),u=new Pf(e,!1),m=this.rightSE;this.replaceRightSE(u),t.push(u),t.push(c);const _=new nv(c,m,this.rings.slice(),this.windings.slice());return Pf.comparePoints(_.leftSE.point,_.rightSE.point)>0&&_.swapEvents(),Pf.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(c.checkForConsuming(),u.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,i=this.windings.length;t<i;t++)this.windings[t]*=-1}consume(e){let t=this,i=e;for(;t.consumedBy;)t=t.consumedBy;for(;i.consumedBy;)i=i.consumedBy;const c=nv.compare(t,i);if(c!==0){if(c>0){const u=t;t=i,i=u}if(t.prev===i){const u=t;t=i,i=u}for(let u=0,m=i.rings.length;u<m;u++){const _=i.rings[u],o=i.windings[u],w=t.rings.indexOf(_);w===-1?(t.rings.push(_),t.windings.push(o)):t.windings[w]+=o}i.rings=null,i.windings=null,i.consumedBy=t,i.leftSE.consumedBy=t.leftSE,i.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,i=this._afterState.windings,c=this._afterState.multiPolys;for(let _=0,o=this.rings.length;_<o;_++){const w=this.rings[_],I=this.windings[_],R=t.indexOf(w);R===-1?(t.push(w),i.push(I)):i[R]+=I}const u=[],m=[];for(let _=0,o=t.length;_<o;_++){if(i[_]===0)continue;const w=t[_],I=w.poly;if(m.indexOf(I)===-1)if(w.isExterior)u.push(I);else{m.indexOf(I)===-1&&m.push(I);const R=u.indexOf(w.poly);R!==-1&&u.splice(R,1)}}for(let _=0,o=u.length;_<o;_++){const w=u[_].multiPoly;c.indexOf(w)===-1&&c.push(w)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(J5.type){case"union":{const i=e.length===0,c=t.length===0;this._isInResult=i!==c;break}case"intersection":{let i,c;e.length<t.length?(i=e.length,c=t.length):(i=t.length,c=e.length),this._isInResult=c===J5.numMultiPolys&&i<c;break}case"xor":{const i=Math.abs(e.length-t.length);this._isInResult=i%2===1;break}case"difference":{const i=c=>c.length===1&&c[0].isSubject;this._isInResult=i(e)!==i(t);break}}return this._isInResult}},TA=class{poly;isExterior;segments;bbox;constructor(n,e,t){if(!Array.isArray(n)||n.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=t,this.segments=[],typeof n[0][0]!="number"||typeof n[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const i=Lp.snap({x:new Ff(n[0][0]),y:new Ff(n[0][1])});this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};let c=i;for(let u=1,m=n.length;u<m;u++){if(typeof n[u][0]!="number"||typeof n[u][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const _=Lp.snap({x:new Ff(n[u][0]),y:new Ff(n[u][1])});_.x.eq(c.x)&&_.y.eq(c.y)||(this.segments.push(Nv.fromRing(c,_,this)),_.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=_.x),_.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=_.y),_.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=_.x),_.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=_.y),c=_)}(!i.x.eq(c.x)||!i.y.eq(c.y))&&this.segments.push(Nv.fromRing(c,i,this))}getSweepEvents(){const n=[];for(let e=0,t=this.segments.length;e<t;e++){const i=this.segments[e];n.push(i.leftSE),n.push(i.rightSE)}return n}},Gj=class{multiPoly;exteriorRing;interiorRings;bbox;constructor(n,e){if(!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new TA(n[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let t=1,i=n.length;t<i;t++){const c=new TA(n[t],this,!1);c.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=c.bbox.ll.x),c.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=c.bbox.ll.y),c.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=c.bbox.ur.x),c.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=c.bbox.ur.y),this.interiorRings.push(c)}this.multiPoly=e}getSweepEvents(){const n=this.exteriorRing.getSweepEvents();for(let e=0,t=this.interiorRings.length;e<t;e++){const i=this.interiorRings[e].getSweepEvents();for(let c=0,u=i.length;c<u;c++)n.push(i[c])}return n}},IA=class{isSubject;polys;bbox;constructor(n,e){if(!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof n[0][0][0]=="number"&&(n=[n])}catch{}this.polys=[],this.bbox={ll:{x:new Ff(Number.POSITIVE_INFINITY),y:new Ff(Number.POSITIVE_INFINITY)},ur:{x:new Ff(Number.NEGATIVE_INFINITY),y:new Ff(Number.NEGATIVE_INFINITY)}};for(let t=0,i=n.length;t<i;t++){const c=new Gj(n[t],this);c.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=c.bbox.ll.x),c.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=c.bbox.ll.y),c.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=c.bbox.ur.x),c.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=c.bbox.ur.y),this.polys.push(c)}this.isSubject=e}getSweepEvents(){const n=[];for(let e=0,t=this.polys.length;e<t;e++){const i=this.polys[e].getSweepEvents();for(let c=0,u=i.length;c<u;c++)n.push(i[c])}return n}},Hj=(n,...e)=>J5.run("intersection",n,e);Lp.set;function A3(n,e,t,i={}){const c=e<0;let u=u8(Math.abs(e),i.units,"meters");c&&(u=-Math.abs(u));const m=yd(n),_=Wj(m,u,t);return _[0]+=_[0]-m[0]>180?-360:m[0]-_[0]>180?360:0,Ls(_,i.properties)}function Wj(n,e,t,i){i=i===void 0?Hu:Number(i);const c=e/i,u=n[0]*Math.PI/180,m=gd(n[1]),_=gd(t),o=c*Math.cos(_);let w=m+o;Math.abs(w)>Math.PI/2&&(w=w>0?Math.PI-w:-Math.PI-w);const I=Math.log(Math.tan(w/2+Math.PI/4)/Math.tan(m/2+Math.PI/4)),R=Math.abs(I)>1e-11?o/I:Math.cos(m),V=c*Math.sin(_)/R;return[((u+V)*180/Math.PI+540)%360-180,w*180/Math.PI]}function b8(n,e,t={}){const i=yd(n),c=yd(e);c[0]+=c[0]-i[0]>180?-360:i[0]-c[0]>180?360:0;const u=Kj(i,c);return u8(u,"meters",t.units)}function Kj(n,e,t){t=t===void 0?Hu:Number(t);const i=t,c=n[1]*Math.PI/180,u=e[1]*Math.PI/180,m=u-c;let _=Math.abs(e[0]-n[0])*Math.PI/180;_>Math.PI&&(_-=2*Math.PI);const o=Math.log(Math.tan(u/2+Math.PI/4)/Math.tan(c/2+Math.PI/4)),w=Math.abs(o)>1e-11?m/o:Math.cos(c);return Math.sqrt(m*m+w*w*_*_)*i}function Zh(n,e,t){if(t=t||{},!b3(t))throw new Error("options is invalid");const i=t.pivot,c=t.mutate;if(!n)throw new Error("geojson is required");if(e==null||isNaN(e))throw new Error("angle is required");if(e===0)return n;const u=i??xc(n);return(c===!1||c===void 0)&&(n=S3(n)),yg(n,function(m){const o=h8(u,m)+e,w=b8(u,m),I=w3(A3(u,w,o));m[0]=I[0],m[1]=I[1]}),n}function w8(n,e={}){const t=[];if(d8(n,c=>{t.push(c.coordinates)}),t.length<2)throw new Error("Must specify at least 2 geometries");const i=Hj(t[0],...t.slice(1));return i.length===0?null:i.length===1?v3(i[0],e.properties):Wz(i,e.properties)}function L0(n,e,t){if(t=t||{},!b3(t))throw new Error("options is invalid");const i=t.origin||"centroid",c=t.mutate||!1;if(!n)throw new Error("geojson required");if(typeof e!="number"||e<=0)throw new Error("invalid factor");const u=Array.isArray(i)||typeof i=="object";return c!==!0&&(n=S3(n)),n.type==="FeatureCollection"&&!u?(Jz(n,function(m,_){n.features[_]=CA(m,e,i)}),n):CA(n,e,i)}function CA(n,e,t){const i=Zz(n)==="Point",c=Xj(n,t);return e===1||i||(yg(n,function(u){const m=b8(c,u),_=h8(c,u),o=m*e,w=w3(A3(c,o,_));u[0]=w[0],u[1]=w[1],u.length===3&&(u[2]*=e)}),delete n.bbox),n}function Xj(n,e){if(e==null&&(e="centroid"),Array.isArray(e)||typeof e=="object")return yd(e);const t=n.bbox?n.bbox:Lu(n,{recompute:!0}),i=t[0],c=t[1],u=t[2],m=t[3];switch(e){case"sw":case"southwest":case"westsouth":case"bottomleft":return Ls([i,c]);case"se":case"southeast":case"eastsouth":case"bottomright":return Ls([u,c]);case"nw":case"northwest":case"westnorth":case"topleft":return Ls([i,m]);case"ne":case"northeast":case"eastnorth":case"topright":return Ls([u,m]);case"center":return dj(n);case void 0:case null:case"centroid":return xc(n);default:throw new Error("invalid origin")}}function Ym(n,e,t,i){if(i=i||{},!b3(i))throw new Error("options is invalid");var c=i.units,u=i.zTranslation,m=i.mutate;if(!n)throw new Error("geojson is required");if(e==null||isNaN(e))throw new Error("distance is required");if(u&&typeof u!="number"&&isNaN(u))throw new Error("zTranslation is not a number");if(u=u!==void 0?u:0,e===0&&u===0)return n;if(t==null||isNaN(t))throw new Error("direction is required");return e<0&&(e=-e,t=t+180),(m===!1||m===void 0)&&(n=S3(n)),yg(n,function(_){var o=w3(A3(_,e,t,{units:c}));_[0]=o[0],_[1]=o[1],u&&_.length===3&&(_[2]+=u)}),n}function Qc(n){return String(n??"").trim().toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,"")||"na"}function fp(n){return Qc(n)}function Na(n){return Qc(n)}function Yd(...n){if(!n?.length)return"na";const e=n.flatMap(t=>Array.isArray(t)?t:[t]).map(t=>t==null?"":String(t)).map(t=>t.trim()).filter(Boolean);if(!e.length)return"na";if(e.length===1){const t=e[0];return t.match(/^\d+$/)?t:Qc(t)}return Qc(e.join("_"))}const T3={"Academic Support":"#f68a69",Admissions:"#b3b3b3","Admin-General":"#dcf4b4","Alumni & Foundation":"#4CAF50",Art:"#ea0ea0",Athletics:"#ea550a",Biology:"#17becf","Bronco Blend":"#5a4b22","Business Economics":"#d77cf8","Business Office":"#C44E52","Career Services":"#ff7f50",Chaplain:"#7B7F9E",Chemistry:"#f24516",Classroom:"#c20583",CFO:"#789051",CIO:"#2282bd",Communication:"#109014","Creighton Coll of Nursing":"#76C7C0","Digital Art":"#ffb347",Esports:"#00B894",Facilities:"#2CA02C","Financial Aid":"#8C564B",Forensics:"#aef2e1","Health Center":"#f50909","History, Religion, Philosophy":"#649515",Housing:"#f54d4d",HR:"#3498DB",IR:"#3b580e",IT:"#836377","Languages & Literatures":"#4a64b9",Library:"#079c29","Maintenance & Facilities":"#a6a6a6",Math:"#427b75",Music:"#9467bd",Offline:"#515250",OMC:"#9273f7",Open:"#95A5A6","Physical Education":"#a6d854",PM:"#d7a0fa","President Office":"#d884d8",Psychology:"#2bf087",Registrar:"#F1C40F","Service Learning/Chaplain":"#66c2a5","Student Accounts":"#86e6ed","Student Engagement":"#1584ed","Student Union":"#7cb0ef","Teacher Education":"#2E86AB",Theatre:"#f1374c",Unknown:"#8d776c",VPAA:"#1568f9","VPAA - Academic Admin":"#dde80d",Physics:"#ff24ab"},LA=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"];function Zj(n){let e=0;for(let t=0;t<n.length;t++)e=e*31+n.charCodeAt(t)>>>0;return e}function Qd(n){if(!n)return"#AAAAAA";const e=T3[n];if(e)return e;const t=Zj(n)%LA.length;return LA[t]}function PA(n){const e=n||{},t=Array.isArray(e.features)?e.features:[];let i=0,c=0,u=0,m=0;const _=new Map;for(const I of t){const R=I.properties||{},V=R.__areaSf??R.Area_SF??R.Area_SF??R.area??R.Area??R.SF??R["Area (SF)"]??R.NetArea??0,k=Number(V);if(!Number.isFinite(k)||k<=0)continue;c+=1,i+=k;const ie=String(R.__roomType??R.NCES_Type??"").trim(),ae=R.Name??R.Room??R["Room Name"]??"",fe=String(ae).toUpperCase(),J=ie.toUpperCase();(J.includes("CLASSROOM")||J.includes("LECTURE")||fe.includes("CLASSROOM")||fe.includes("LECTURE"))&&(m+=1,u+=k);const me=R.__dept??R.NCES_Department??R.NCES_Department??R.NCES_Dept??R["NCES Dept"]??R.department??R.Department??R.Dept??"",ue=String(me).trim();ue&&_.set(ue,(_.get(ue)||0)+k)}const o=Array.from(_.entries()).sort((I,R)=>R[1]-I[1]).slice(0,12).map(([I,R])=>({name:I,sf:R,color:Qd(I)})),w=Object.fromEntries(_);return{totalSf:i,rooms:c,classroomSf:u,classroomCount:m,totalsByDept:w,keyDepts:o}}const Yj=n=>Number.isFinite(n)?Math.max(0,Math.min(n,100)):null,Jj=n=>Number.isFinite(n)?`${Math.round(n)}%`:"--",kA=({label:n,value:e,color:t,compact:i})=>{if(!Number.isFinite(e))return Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8,alignItems:"center"},children:[Y.jsx("div",{style:{fontSize:i?11:12,color:"#344054"},children:n}),Y.jsx("div",{style:{fontSize:i?11:12,color:"#667085"},children:"--"})]});const c=Yj(e),u=i?6:8;return Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8,alignItems:"center"},children:[Y.jsxs("div",{children:[Y.jsx("div",{style:{fontSize:i?11:12,color:"#344054",marginBottom:3},children:n}),Y.jsx("div",{style:{height:u,background:"#e4e7ec",borderRadius:999,overflow:"hidden"},children:Y.jsx("div",{style:{width:`${c}%`,height:"100%",background:t}})})]}),Y.jsx("div",{style:{fontSize:i?11:12,color:"#475467",fontWeight:600},children:Jj(e)})]})};function S8({timePct:n,seatPct:e,compact:t=!1}){return Number.isFinite(n)||Number.isFinite(e)?Y.jsxs("div",{style:{display:"grid",gap:t?6:10},children:[Y.jsx(kA,{label:"Time Utilization",value:n,color:"#3b82f6",compact:t}),Y.jsx(kA,{label:"Seat Utilization",value:e,color:"#f59e0b",compact:t})]}):null}function Qj({buildingName:n,stats:e,keyDepts:t=[],floors:i=[],selectedFloor:c,onChangeFloor:u,onLoadFloorplan:m,onClose:_,onExportPDF:o,onExportCSV:w,onExplainBuilding:I,explainBuildingLoading:R=!1,explainBuildingDisabled:V=!1,explainBuildingError:k="",utilization:ie,dragHandleProps:ae}){const fe=pe=>Number.isFinite(pe)?Math.round(pe).toLocaleString():"-",J=pe=>Number.isFinite(pe)?Number(pe).toLocaleString():"-",ne=!!ae,{style:me,...ue}=ae||{},ke=ie&&(Number.isFinite(ie.timeUtilization)||Number.isFinite(ie.seatUtilization)),ze={display:"flex",justifyContent:"space-between",alignItems:"center",paddingRight:6,...ne?{cursor:"grab",userSelect:"none",touchAction:"none"}:{},...me||{}};return Y.jsxs("div",{style:{minWidth:320,maxWidth:360,padding:12,fontSize:13},children:[Y.jsxs("div",{style:ze,...ue,children:[Y.jsx("div",{style:{fontWeight:700},children:n}),Y.jsx("button",{onClick:_,"aria-label":"Close",style:{marginRight:4},children:""})]}),Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(0, 1fr) minmax(0, 1fr)",gap:8,marginTop:8},children:[Y.jsxs("div",{children:[Y.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"BUILDING TOTALS"}),Y.jsxs("div",{children:[Y.jsx("b",{children:"Total SF:"})," ",fe(e?.totalSf)]}),Y.jsxs("div",{children:[Y.jsx("b",{children:"Rooms:"})," ",J(e?.rooms)]}),Y.jsxs("div",{children:[Y.jsx("b",{children:"Classroom SF:"})," ",fe(e?.classroomSf)]}),Y.jsxs("div",{children:[Y.jsx("b",{children:"Classrooms:"})," ",J(e?.classroomCount)]}),Y.jsxs("div",{children:[Y.jsx("b",{children:"Levels:"})," ",i?.length??0]})]}),Y.jsxs("div",{children:[Y.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"Key Departments"}),t.length===0?Y.jsx("div",{style:{color:"#666"},children:""}):t.map(pe=>Y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4,fontSize:12,lineHeight:1.25},children:[Y.jsx("div",{style:{width:14,height:14,borderRadius:3,background:Qd(pe.name),border:"1px solid #999"}}),Y.jsxs("div",{style:{flex:1},children:[pe.name," ",Number.isFinite(pe.areaSf||pe.Area||pe.sf)?` (${Math.round(pe.areaSf||pe.Area||pe.sf).toLocaleString()} SF)`:""]})]},pe.name))]})]}),ke?Y.jsxs("div",{style:{marginTop:10},children:[Y.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"Classroom Utilization"}),Y.jsx(S8,{timePct:ie.timeUtilization,seatPct:ie.seatUtilization,compact:!0})]}):null,Y.jsxs("div",{style:{marginTop:12,display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[Y.jsx("div",{children:Y.jsx("b",{children:"Floor"})}),Y.jsx("select",{value:c??"",onChange:pe=>u?.(pe.target.value),children:i.map(pe=>Y.jsx("option",{value:pe,children:pe},pe))}),Y.jsx("button",{className:"btn primary",onClick:m,children:"Load"}),Y.jsx("button",{className:"btn secondary",onClick:o,children:"Export to PDF"}),Y.jsx("button",{className:"btn",onClick:w,children:"Export CSV"}),Y.jsx("button",{className:"btn",onClick:I,disabled:V||R,children:R?"Explaining...":" Explain this building"})]}),k?Y.jsx("div",{style:{color:"crimson",marginTop:6,fontSize:12},children:k}):null]})}function eU({buildingName:n,floorLabel:e,stats:t,legendItems:i=[],floors:c=[],selectedFloor:u,onChangeFloor:m,onLoadFloorplan:_,onUnloadFloorplan:o,onClose:w,onExportPDF:I,onExportCSV:R,colorMode:V="department",onChangeColorMode:k,legendTitle:ie="Key Departments",legendSelection:ae,onLegendClick:fe,onExplainFloor:J,explainLoading:ne=!1,explainDisabled:me=!1,explainError:ue="",moveScenarioMode:ke=!1,onToggleMoveScenarioMode:ze,rotateActive:pe=!1,moveActive:U=!1,rotateValue:F=0,scaleValue:q=1,rotateNotice:j="",rotateStored:H=!1,adjustDebugInfo:Z=null,onStartRotate:be,onStartMove:Me,onCancelRotate:Be,onClearRotate:Re,onScaleChange:we,onSaveAdjust:De,saveAdjustDisabled:nt=!1,dragHandleProps:xe}){const le=dt=>Number.isFinite(dt)?Math.round(dt).toLocaleString():"-",Ne=dt=>Number.isFinite(dt)?Number(dt).toLocaleString():"-",Oe=!!xe,{style:Je,...rt}=xe||{},mt={display:"flex",justifyContent:"space-between",...Oe?{cursor:"grab",userSelect:"none",touchAction:"none"}:{},...Je||{}};return Y.jsxs("div",{style:{minWidth:340,maxWidth:380,padding:12,fontSize:13},children:[Y.jsxs("div",{style:mt,...rt,children:[Y.jsx("div",{style:{fontWeight:700},children:n}),Y.jsx("button",{onClick:w,"aria-label":"Close",children:""})]}),Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(0, 0.95fr) minmax(0, 1.05fr)",gap:10,marginTop:8},children:[Y.jsxs("div",{children:[Y.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"FLOOR TOTALS"}),Y.jsxs("div",{children:[Y.jsx("b",{children:"Floor:"})," ",e??"-"]}),Y.jsxs("div",{children:[Y.jsx("b",{children:"Total SF:"})," ",le(t?.totalSf)]}),Y.jsxs("div",{children:[Y.jsx("b",{children:"Rooms:"})," ",Ne(t?.rooms)]}),Y.jsxs("div",{children:[Y.jsx("b",{children:"Classroom SF:"})," ",le(t?.classroomSf)]}),Y.jsxs("div",{children:[Y.jsx("b",{children:"Classrooms:"})," ",Ne(t?.classroomCount)]})]}),Y.jsxs("div",{children:[Y.jsx("div",{style:{fontWeight:600,marginBottom:6},children:ie}),i.length===0?Y.jsx("div",{style:{color:"#666"},children:""}):Y.jsx("div",{style:{maxHeight:"46vh",overflowY:"auto"},children:i.map(dt=>Y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4,padding:"2px 0",borderRadius:4,cursor:fe?"pointer":"default",background:ae===dt.name?"#f0f4ff":"transparent",fontSize:12,lineHeight:1.25},onClick:()=>fe?.(dt.name),children:[Y.jsx("div",{style:{width:14,height:14,borderRadius:3,background:dt.color||Qd(dt.name),border:"1px solid #999"}}),Y.jsxs("div",{style:{flex:1},children:[dt.name," ",Number.isFinite(dt.areaSf||dt.Area||dt.sf)?` (${Math.round(dt.areaSf||dt.Area||dt.sf).toLocaleString()} SF)`:""]})]},dt.name))})]})]}),Y.jsxs("div",{style:{marginTop:12,display:"flex",flexDirection:"column",gap:10},children:[Y.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[Y.jsx("div",{children:Y.jsx("b",{children:"Floor"})}),Y.jsx("select",{value:u??"",onChange:dt=>m?.(dt.target.value),children:c.map(dt=>Y.jsx("option",{value:dt,children:dt},dt))}),Y.jsx("button",{className:"btn primary",onClick:_,children:"Load"}),o?Y.jsx("button",{className:"btn",onClick:o,children:"Unload"}):null]}),Y.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginTop:6},children:[Y.jsx("button",{className:"btn secondary",onClick:I,children:"Export to PDF"}),R?Y.jsx("button",{className:"btn",onClick:R,children:"Export CSV"}):null,Y.jsx("button",{className:"btn",onClick:J,disabled:me||ne,children:ne?"Explaining...":" Explain this floor"})]}),ue?Y.jsx("div",{style:{color:"crimson",fontSize:12},children:ue}):null,Y.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[Y.jsx("div",{style:{fontWeight:600},children:"Highlight By"}),Y.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:6},children:[{key:"department",label:"Department"},{key:"type",label:"Type"},{key:"occupancy",label:"Occupancy"}].map(dt=>Y.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,fontSize:13},children:[Y.jsx("input",{type:"radio",name:"highlight-mode",value:dt.key,checked:V===dt.key,onChange:Dt=>k?.(Dt.target.value)}),dt.label]},dt.key))}),ze?Y.jsxs("div",{style:{marginTop:6},children:[Y.jsxs("button",{className:"btn",style:{width:"100%",fontWeight:600},onClick:ze,children:["Move Scenario Mode ",ke?"ON":"OFF"]}),Y.jsx("div",{style:{marginTop:4,fontSize:11,color:"#555",textAlign:"center"},children:"Click rooms to add/remove them from a what-if scenario. Real data is not changed."})]}):null,be?Y.jsxs("div",{style:{marginTop:10,paddingTop:8,borderTop:"1px solid #e5e5e5"},children:[Y.jsx("div",{style:{fontWeight:600},children:"Adjust Floorplan"}),Y.jsx("div",{style:{fontSize:12,color:"#555",marginTop:2},children:pe||U?"Drag on the map. Release to save.":"Use Rotate or Move, then drag on the map to adjust rooms + linework together."}),Y.jsxs("div",{style:{fontSize:12,marginTop:2},children:["Rotation: ",Number.isFinite(F)?`${F.toFixed(1)}`:"0","  Scale: ",Number.isFinite(q)?q.toFixed(2):"1.00"]}),Y.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginTop:6},children:[Y.jsx("button",{className:"btn",onClick:pe?Be:be,children:pe?"Cancel Rotate":"Rotate"}),Me?Y.jsx("button",{className:"btn",onClick:U?Be:Me,children:U?"Cancel Move":"Move"}):null,we?Y.jsxs(Y.Fragment,{children:[Y.jsx("button",{className:"btn",onClick:()=>we(-.02),children:"- Scale"}),Y.jsx("button",{className:"btn",onClick:()=>we(.02),children:"+ Scale"})]}):null,De?Y.jsx("button",{className:"btn primary",onClick:De,disabled:nt,children:"Save Adjust"}):null,Re?Y.jsx("button",{className:"btn",onClick:Re,disabled:!H,children:"Clear Adjust"}):null]}),j?Y.jsx("div",{style:{color:"crimson",fontSize:12,marginTop:4},children:j}):null,null]}):null]})]})]})}function MA({label:n,value:e,onChange:t,options:i,placeholder:c}){const[u,m]=Nn.useState(!1),[_,o]=Nn.useState(""),w=Nn.useRef(null),I=Nn.useMemo(()=>{const ie=new Set,ae=[];return(i||[]).forEach(fe=>{const J=typeof fe=="string"?{value:fe,label:fe}:fe;!J||!J.value||ie.has(J.value)||(ie.add(J.value),ae.push({value:J.value,label:J.label??J.value}))}),ae},[i]),R=Nn.useMemo(()=>I.find(ae=>ae.value===e)?.label??e??"",[I,e]),V=Nn.useMemo(()=>{const ie=(_||"").toLowerCase();return ie?I.filter(ae=>{const fe=(ae.label??"").toLowerCase(),J=(ae.value??"").toLowerCase();return fe.includes(ie)||J.includes(ie)}):I},[I,_]),k=_||R||"";return Y.jsxs("div",{className:"mf-form-row",style:{position:"relative"},children:[Y.jsx("label",{children:n}),Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8},children:[Y.jsx("input",{ref:w,className:"mf-input",placeholder:c,value:k,onChange:ie=>{const ae=ie.target.value;o(ae),t?.(ae)},onFocus:()=>m(!0)}),Y.jsx("button",{type:"button",className:"mf-input",style:{width:34,padding:0,display:"grid",placeItems:"center"},onClick:()=>{m(ie=>{const ae=!ie;return ae&&w.current?.focus(),ae})},title:"Toggle options",children:""})]}),u&&Y.jsx("div",{style:{position:"absolute",zIndex:9999,left:0,right:0,top:"100%",background:"#fff",border:"1px solid #ddd",borderRadius:8,maxHeight:240,overflow:"auto",marginTop:6,boxShadow:"0 8px 24px rgba(0,0,0,.12)"},onMouseDown:ie=>ie.preventDefault(),children:V.length===0?Y.jsx("div",{style:{padding:10,color:"#777"},children:"No matches"}):V.map(ie=>Y.jsx("div",{style:{padding:"8px 10px",cursor:"pointer"},onClick:()=>{t?.(ie.value),o(""),m(!1)},children:ie.label},ie.value))})]})}function pp(n,e=8){if(!n)return[];const t=Object.entries(n);return t.sort((i,c)=>(c[1]||0)-(i[1]||0)),t.slice(0,e).map(([i,c])=>({name:i,areaSf:c}))}const tU=n=>{const e=Number(n||0);return Number.isFinite(e)?Math.round(e).toLocaleString():"0"},nU=({label:n,value:e})=>Y.jsxs("div",{style:{background:"#f9fafb",border:"1px solid #e4e7ec",borderRadius:8,padding:8},children:[Y.jsx("div",{style:{fontSize:10,textTransform:"uppercase",letterSpacing:.4,color:"#667085"},children:n}),Y.jsx("div",{style:{fontSize:16,fontWeight:800,color:"#1d2939"},children:e})]}),Xb=({children:n,style:e})=>Y.jsx("div",{style:{background:"#f9fafb",border:"1px solid #e4e7ec",borderRadius:8,padding:8,...e},children:n}),rU=({pct:n,occupied:e=0,vacant:t=0,unknown:i=0,scopeLabel:c=""})=>{const u=Number.isFinite(n)?Math.max(0,Math.min(1,n)):null,m=-90+(u||0)*180,_=u==null?"--":`${Math.round(u*100)}%`;return Y.jsxs("div",{className:"mf-gauge",children:[Y.jsx("div",{className:"mf-gauge-title",children:"OFFICE OCCUPANCY"}),c?Y.jsx("div",{style:{fontSize:11,color:"#667085",marginTop:-2,marginBottom:6},children:c}):null,Y.jsxs("svg",{width:"170",height:"110",viewBox:"0 0 200 130","aria-label":"Office Occupancy",children:[Y.jsx("path",{d:"M 20 110 A 80 80 0 0 1 80 30",fill:"none",stroke:"#d64545",strokeWidth:"16",strokeLinecap:"round"}),Y.jsx("path",{d:"M 80 30 A 80 80 0 0 1 120 30",fill:"none",stroke:"#f0a23b",strokeWidth:"16",strokeLinecap:"round"}),Y.jsx("path",{d:"M 120 30 A 80 80 0 0 1 180 110",fill:"none",stroke:"#2aa84a",strokeWidth:"16",strokeLinecap:"round"}),Y.jsxs("g",{transform:`translate(100 110) rotate(${m})`,children:[Y.jsx("line",{x1:"0",y1:"0",x2:"0",y2:"-70",stroke:"#222",strokeWidth:"3"}),Y.jsx("circle",{cx:"0",cy:"0",r:"6",fill:"#222"})]}),Y.jsx("text",{x:"20",y:"125",fontSize:"11",fill:"#666",children:"low"}),Y.jsx("text",{x:"92",y:"20",fontSize:"11",fill:"#666",children:"mid"}),Y.jsx("text",{x:"168",y:"125",fontSize:"11",fill:"#666",children:"high"}),Y.jsx("text",{x:"100",y:"90",textAnchor:"middle",fontSize:"16",fontWeight:"700",fill:"#1d2939",children:_})]}),Y.jsxs("div",{className:"mf-gauge-meta",children:[u==null?Y.jsx("div",{className:"muted",children:"No occupancy data"}):Y.jsxs("div",{children:[Y.jsx("b",{children:_})," occupied"]}),Y.jsxs("div",{className:"muted",children:["Occ: ",e," | Vac: ",t," | Unk: ",i]})]})]})},iU=({entries:n=[],maxSlices:e=8})=>{const t=n.slice(0,e),i=n.slice(e).reduce((V,k)=>V+Number(k?.sf||0),0),c=i>0?[...t,{name:"Other",sf:i}]:t,u=c.reduce((V,k)=>V+Number(k?.sf||0),0)||1,m="#94a3b8";let _=0;const o=60,w=60,I=50,R=c.map((V,k)=>{const ie=V?.name||"Unknown",ae=Number(V?.sf||0),fe=ae/u,J=_+fe*Math.PI*2,ne=o+I*Math.cos(_),me=w+I*Math.sin(_),ue=o+I*Math.cos(J),ke=w+I*Math.sin(J),ze=fe>.5?1:0,pe=[`M ${o} ${w}`,`L ${ne} ${me}`,`A ${I} ${I} 0 ${ze} 1 ${ue} ${ke}`,"Z"].join(" "),U=ie==="Other"?m:Qd(ie);return _=J,{d:pe,name:ie,sf:ae,color:U}});return Y.jsxs("div",{className:"mf-pie",children:[Y.jsx("div",{className:"mf-section-title",children:"Departments (SF)"}),Y.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[Y.jsx("svg",{width:"120",height:"120",viewBox:"0 0 120 120","aria-label":"Department share by SF",children:R.map((V,k)=>Y.jsx("path",{d:V.d,fill:V.color,stroke:"#fff",strokeWidth:"1"},k))}),Y.jsx("div",{className:"mf-pie-legend",children:R.slice(0,6).map((V,k)=>Y.jsxs("div",{className:"mf-legend-row",children:[Y.jsx("span",{className:"mf-swatch",style:{background:V.color}}),Y.jsx("span",{className:"mf-legend-name",title:V.name,children:V.name}),Y.jsx("span",{className:"mf-legend-sf",children:Math.round(V.sf).toLocaleString()})]},k))})]})]})};function oU({title:n,metrics:e,loading:t,error:i,scopeLabel:c,utilization:u,utilizationScopeLabel:m,heatmapOn:_,onToggleHeatmap:o}){const w=e?.officeOccupancy||{},I=u&&(Number.isFinite(u.timeUtilization)||Number.isFinite(u.seatUtilization));return Y.jsxs("div",{style:{padding:6,width:"100%",display:"flex",flexDirection:"column",height:"100%"},children:[Y.jsx("div",{style:{fontWeight:800,fontSize:13,marginBottom:6},children:n}),t&&Y.jsx("div",{style:{fontSize:12,color:"#667085"},children:"Loading dashboard..."}),i&&Y.jsx("div",{style:{fontSize:12,color:"#b00020"},children:String(i)}),!t&&!i&&e&&Y.jsxs(Y.Fragment,{children:[Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(0, 1fr) 1.3fr",gap:6},children:[Y.jsx(nU,{label:"Total SF",value:tU(e.totalSf)}),Y.jsx(Xb,{children:Y.jsx(rU,{pct:w.pct,occupied:w.occupied,vacant:w.vacant,unknown:w.unknown,scopeLabel:c})})]}),Y.jsxs("div",{style:{flex:1,overflowY:"auto",paddingRight:4,marginTop:8},children:[Y.jsx(Xb,{children:Y.jsx(iU,{entries:e.byDept||[]})}),I?Y.jsxs(Xb,{style:{marginTop:8},children:[Y.jsx("div",{className:"mf-section-title",children:"Classroom Utilization"}),m?Y.jsx("div",{style:{fontSize:11,color:"#667085",marginTop:-2,marginBottom:6},children:m}):null,Y.jsx(S8,{timePct:u.timeUtilization,seatPct:u.seatUtilization,compact:!0}),Y.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,marginTop:8,fontSize:12},children:[Y.jsx("input",{type:"checkbox",checked:!!_,onChange:R=>o?.(R.target.checked)}),"Classroom Utilization Heat Map"]})]}):null]})]})]})}function E8(n={}){const e=n.area??n.Area??n["Area (SF)"]??n.SF??n.NetArea??n.Area_SF??n.Area_SF??0,t=Number(e);return!Number.isFinite(t)||t<=0?null:t}function I3(n={}){const e=n.occupancyStatus??n["Occupancy Status"]??n.vacancy??n.Vacancy??n.Vacant??n.Occupancy??n.OccupancyStatus??n.Status??"",t=String(e).trim().toUpperCase(),i=typeof e=="string"&&t.length>0||typeof e=="boolean"||typeof e=="number",c=e===!0||t==="VACANT"||t.includes("VACANT")||t.includes("UNOCCUPIED")||t.includes("AVAILABLE"),u=e===!1||t==="OCCUPIED"||t.includes("OCCUPIED");return i?c&&!u?"Vacant":u?"Occupied":"Unknown":(n.occupant??n.Occupant??n.AssignedTo??n.Assignee??"").toString().trim().length>0?"Occupied":"Unknown"}const sU=["Office - Staff","Office - Prof and Admin","Office - Prof & Admin","Office - Prof/Admin","Office - Faculty","Office - Adjunct Faculty","Office - Emeritus Faculty"],A8=n=>String(n||"").toLowerCase().replace(/[^a-z0-9]+/g," ").replace(/\b(and|&)\b/g," ").replace(/\s+/g," ").trim(),aU=new Set(sU.map(A8).filter(Boolean));function lU(n={}){const e=(n.NCES_Type??n.NCES_Type_Desc??n.__roomType??n.RoomTypeName??n.RoomType??n.Type??n.type??"").toString().toLowerCase();return aU.has(A8(e))}function cU(n){const e=Array.isArray(n)?n:Array.isArray(n?.features)?n.features:[];let t=0,i=0,c=0;for(const u of e){const m=u?.properties||{};if(!lU(m))continue;const _=I3(m);_==="Occupied"?t+=1:_==="Vacant"?i+=1:c+=1}return{pct:t+i>0?t/(t+i):null,occupied:t,vacant:i,unknown:c,totalOffices:t+i+c}}function uU(n={}){const e=E8(n);if(!e)return null;const t=(n.NCES_Department??n.department??n.Department??n.Dept??"").toString().trim()||"Unspecified",i=(n.NCES_Type??n.NCES_Type_Desc??n.RoomTypeName??n.RoomType??n.Type??n.type??"").toString().trim()||"Unknown",c=I3(n);return{sf:e,dept:t,type:i,occupancy:c}}function hU(n){const e=Array.isArray(n)?n:Array.isArray(n?.features)?n.features:[];let t=0,i=0,c=0,u=0,m=0,_=0;for(const I of e){const R=I?.properties||{},V=E8(R);if(!V)continue;const k=I3(R);k==="Vacant"?(i+=V,m+=1):k==="Occupied"?(t+=V,u+=1):(c+=V,_+=1)}const o=t+i+c,w=u+m+_;return{totalSF:o,totalRooms:w,occupiedSF:t,vacantSF:i,unknownSF:c,occupiedRooms:u,vacantRooms:m,unknownRooms:_,occupancyRate:o>0?t/o:null}}function dU(n=[]){let e=0,t=0;const i=new Map,c=new Map,u=new Map,m=I=>{const R=String(I||"").trim();if(!R)return!1;const V=R.toUpperCase();return/^rec[a-z0-9]{6,}$/i.test(R)?!1:V!=="UNSPECIFIED"&&V!=="UNKNOWN"&&V!=="N/A"&&V!=="NA"};for(const I of n){const R=uU(I?.properties||{});R&&(t+=1,e+=R.sf,m(R.dept)&&i.set(R.dept,(i.get(R.dept)||0)+R.sf),c.set(R.type,(c.get(R.type)||0)+R.sf),u.set(R.occupancy,(u.get(R.occupancy)||0)+R.sf))}const _=(I,R=10)=>Array.from(I.entries()).map(([V,k])=>({name:V,sf:k})).sort((V,k)=>k.sf-V.sf).slice(0,R),o=hU(n),w=cU(n);return{totalSf:e,roomCount:t,byDept:_(i,10),byType:_(c,10),byOccupancy:_(u,6),occupancySummary:o,officeOccupancy:w}}const fU={},{useRef:wo,useEffect:gi,useState:jn,useCallback:Qn,useMemo:Wa}=OL,pU="https://github-stakeholder-ai.onrender.com";function T8(){const n="".trim();return n||(typeof window<"u"&&window.location.hostname.includes("github.io")?pU:"")}function mU(){const n=[];for(const[e,t]of Object.entries(T3))n.push(e,t);return["match",["coalesce",["feature-state","department"],["get","department"],["get","Department"],["get","Dept"],["get","NCES_Department"],["get","NCES_Dept"]],...n,"#e6e6e6"]}const gU=n=>{let e=0;for(let t=0;t<n.length;t++)e=e*31+n.charCodeAt(t)>>>0;return e},RA=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],Q5=n=>n?String(n).trim().toLowerCase()==="public corridor"?"#D9D9D9":RA[gU(String(n).toLowerCase())%RA.length]:"#CCCCCC";function yU(n){return n?.length?n.map(e=>{const t=e.dept||e.name||e.Dept||e.Department;return t?`<div style="display:flex;align-items:center;gap:8px;margin:3px 0;">
        <span style="width:14px;height:14px;border-radius:3px;background:${Qd(t)};border:1px solid #00000022"></span>
        <span>${t}</span>
      </div>`:""}).filter(Boolean).join(""):""}const NA=(n,e,t)=>Math.max(e,Math.min(n,t)),_U=n=>n instanceof Element?!!n.closest('button, a, input, select, textarea, [role="button"]'):!1,Cy=(n,e,t,i)=>{if(n.button!==0||_U(n.target))return;const c=e.current;if(!c||!i)return;const u=i();if(!u)return;n.preventDefault(),n.stopPropagation();const m=c.getBoundingClientRect(),_=n.clientX-m.left,o=n.clientY-m.top,w=8,I=document.body.style.userSelect,R=(ie,ae)=>{const fe=ie-u.left-_,J=ae-u.top-o,ne=Math.max(w,u.width-m.width-w),me=Math.max(w,u.height-m.height-w);t({x:NA(fe,w,ne),y:NA(J,w,me)})},V=ie=>{R(ie.clientX,ie.clientY)},k=()=>{window.removeEventListener("pointermove",V),window.removeEventListener("pointerup",k),window.removeEventListener("pointercancel",k),document.body.style.userSelect=I};document.body.style.userSelect="none",window.addEventListener("pointermove",V),window.addEventListener("pointerup",k),window.addEventListener("pointercancel",k)},vU=["Classroom - General (111)","Classroom - Lecture Hall","Classroom - Indoor Amphitheater / Auditorium","Classroom - Multipurpose","Classroom - Service","Classroom - Seminar","Classroom - Dist Ed / Interactive","Classroom - Computer","Classroom - Collaborative","Laboratory - Class","Laboratory - Computer (non-scheduled)","Laboratory - Studio","Laboratory - Service","Laboratory - Open (non-scheduled)","Laboratory - Music Practice (non-scheduled)","Laboratory - Special Nonclass","Special Nonclass Lab Svs","Office - Prof and Admin (310)","Office - Staff (311)","Office - Faculty","Office - Adjunct Faculty","Office - Graduate / Post Doc Students","Office - Service","Office - Research / Non-Faculty","Office - Emeritus Faculty","Office - Other","Office - Waiting / Reception","Office - Student / Organization","Office - Pantry / Kitchenette","Office - Lounge / Lunch Room","Office - File Room","Office - Work Room","Office - Mail Room","Office - Vault","Office - Department / Suite Circulation","Office - Conference Room","Office - Conference Room Service","Office - Library / Reference Room","Office - Collaborative Work Space","Library - Study / Collaborative Area","Library / Testing / Study Room Service","Training / Tutorial Room","Library - Resource Room","Library Circulation or Reference","Library - Stack","Library / Testing / Study - Storage","Library - Open Stack, Study Area","Library - Processing Room","Academic Assistance","Academic Testing","Interview Room","Departmental Library","Recreation - Health or Physical Education","Athletics - Intercollegiate Sports","Spectator Seating","Fitness Area","Recreation - Service","Athletics - Intercollegiate Sports Service","Ice Rink","Swimming Pool","Athletics - Locker Room or Shower Area","Media - Multi Media Production","Media - Television Studio","Media - Radio Station","Media - Newspaper or Publications","Media - Service","Clinic - (Non-Health care)","Clinic - Observation Room (Non-Health care)","Clinic - Service (Non-Health care)","Clinic - Interview Room (Non-Health care)","Demonstration","Demonstration Service","Special Use - Other (All Purpose)","Public Performance / Assembly","Auditorium","Multi-Purpose Room","Dressing Room","Checkroom","Assembly Room Service (All Types)","Gallery","Museum","Exhibition / Display","Museum / Display / Exhibit Service","Dining / Food Facility","Vending","Dining / Food Service","Kitchen","Dry Food Storage","Cold Food Storage","Lounge - Public","Lounge - Faculty","Lounge - Staff","Lounge - Student","Lounge - Service","Merchandising","Bookstore","Merchandising Service","Recreation - General Use","Recreation Service - General Use","General - Locker Room","General - Locker Room (All Gender)","General - Locker Room Service","Computing or Networking (Central)","Telecom Room (Central)","Telecom / Audio / Video Room","Server Room","IT / Telecom / Network Service","Shop","Shop Service","Storage Room - Central","Storage Room - General","Vehicle / Equipment Storage","Vehicle / Equipment Storage Service","Central Services","Laundry - Central","Central Service Support","Hazardous Materials","Hazardous Materials Service","Parking Garage","Parking Garage Service","Patient Bedroom","Patient Bedroom Service","Health Care - Nurse Station","Utility Room","Record Room","Health Care - Recovery Room","Health Care - Treatment / Examination","Procedure Room","Health Care - Examining Room","Health Care - Therapy Room","Recreation Room","Health Care - Treatment / Examination Service","Health Care - X-Ray Treatment Room","Pharmacy","Health Care - Miscellaneous Storage","Health Care - Patient Reception","Dorm - Sleep / Study NO Toilet & Bath","Dorm - Bedroom Closet","Dorm - Lounge / Study Room","Dorm - Hallway","Dorm - Living Room","Dorm - Toilet or Bath","Sleep / Study WITH Toilet & Bath","Staff Quarters With Bath","Sleep / Study Service","Residence - Laundry","Residence - Storage Room","Apartment - Whole Building","Apartment - Whole Unit","Apartment - Bedroom","Apartment - Closet","Apartment - Living Room","Apartment - Service","Apartment - Kitchen","Apartment - Hallway","Apartment - Bathroom","Apartment - Storage","House","Rental House","Visiting/Special Residence","Other University Residence","Vacant - Assigned","Inactive Area","Available Unassigned","Alteration or Conversion Area","Unfinished Area","Clear Story (open to below)","Leased to Others","Unknown / No Data","Public Corridor","Non-Public Corridor","Lobby","Stairway","Escalator","Elevators","Vestibule","Ramp","Receiving / Loading Dock","Exterior Space - Covered","Commons Area","Custodial Area","Custodial Storage","Custodial Locker Room","Utility Room","Building Storage","Women's Restroom","Men's Restroom","Single Stall Restroom","Private Restroom","Trash / Recycle Room","Nursing / Lactation Room","Emergency Management Command Room","Mechanical Area","Mechanical Duct / Chase or Shaft Area","Interior Incinerator","Central Utility Plant Facility","Electrical Equipment Area","Structural Area","Storage Room - General","Testing"],C3=["Teacher Education","Business Office","Registrar","VPAA - Academic Admin","Chaplain","Financial Aid","Facilities","HR","Music","Open","Physical Education","Admissions","IT","Library","Student Accounts","Student Engagement","Health Center","Biology","Chemistry","Physics","Psychology","History, Religion, Philosophy","Languages & Literatures","Math","Art","Digital Art","Communication","Academic Support","Athletics","Esports","Forensics","CIO","CFO","President Office","Alumni & Foundation","Business Economics","Classroom","Creighton Coll of Nursing","Admin-General","Bronco Blend"],na=n=>(n??"").toString().trim(),a0=n=>{if(n==null)return"";if(typeof n=="string"||typeof n=="number")return String(n).trim();if(typeof n=="object"){const e=n.id??n.floorId??n.floor??n.name??n.label??n.value??"";return e!=null?String(e).trim():""}return String(n).trim()},Wg=(n,e)=>{if(!n)return null;const t=typeof n=="object"?n.id??n.buildingId??n.name??n.label??n.value??"":n;return t?e(t):null};function Ky(n={}){return n.Department||n.department||n.Dept||n.NCES_Department||n.NCES_Department||n["Department Owner Text"]||""}function qf(n={},e=[]){if(!n||!Array.isArray(e))return null;for(const t of e){const i=n[t];if(i!=null&&String(i).trim()!=="")return i}return null}function xU(n,e,t){const i=(n||"").toString().trim(),c=na(e),u=na(t);return c&&u?`${c} - ${u} ${i}`.trim():c?`${c} ${i}`.trim():i||""}function I8(n,e={}){const t=na(n);if(!t)return null;const i=na(e.typeDesc??e.typeLabel??e.typeName),c=xU(i||t,e.categoryCode,e.typeCode)||t;return{value:t,label:c}}function bU(n=[]){const e=new Map;return(n||[]).forEach(t=>{const i=I8(t);i&&e.set(i.value,i)}),Array.from(e.values()).sort((t,i)=>t.label.localeCompare(i.label))}function wU(n=[],e=[]){const t=new Map;return(n||[]).forEach(i=>{i?.value&&t.set(i.value,i)}),(e||[]).forEach(i=>{i?.value&&t.set(i.value,i)}),Array.from(t.values()).sort((i,c)=>i.label.localeCompare(c.label))}function C8(n,e=.35){if(!n)return`rgba(255,165,0,${e})`;const t=n.replace("#","");if(!/^[0-9a-fA-F]+$/.test(t))return`rgba(255,165,0,${e})`;const i=parseInt(t,16);if(Number.isNaN(i))return`rgba(255,165,0,${e})`;const c=i>>16&255,u=i>>8&255,m=i&255;return`rgba(${c},${u},${m},${e})`}function L8(n={}){const e=qf(n,["RoomCategory","Category","CategoryCode","rm_cat","rm_cat_id","NCES_Category","NCES Category","NCES_Category_Code","NCES Category Code"]);return e?String(e).trim():null}function Zb(n={}){const e=n.seatCount??n.SeatCount??n["Seat Count"]??n.Seats??n.Capacity??n.rm_seats??n.SeatingCapacity??n["NCES_Seat Count"]??n.NCES_Seat_Count??n["NCES_Seat Count"]??n.NCES_SeatCount??null,t=Number(e);return Number.isFinite(t)&&t>0?t:null}function P8(n){if(!n)return!1;const e=String(n).trim();return e.length>0&&e.startsWith("3")}function SU(n){if(!n)return!1;const t=String(n).trim().charAt(0);return t==="1"||t==="2"}function k8(n={}){const e=qf(n,["RoomType","roomType","Name","type","RoomTypeName","NCES_Type Description_Sh","NCES_Type Description","NCES Type Description","NCES_Type Description_Short"])??"",t=String(e).toLowerCase(),i=t.includes("office"),c=t.includes("classroom")||t.includes("lab")||t.includes("studio");return{norm:t,isOfficeText:i,isTeachingText:c}}function v0(n={}){const e=qf(n,["FeatureClass","featureClass","Layer","layer","Type","type","Feature","feature","Name","name"])??"",t=String(e).toLowerCase();return t.includes("door")||t.includes("entrance")?"door":t.includes("stair")?"stair":"room"}function EU(n){const e=new Map,t=new Set(C3.map(na)),i=_=>qf(_,["NCES_Category","NCES Category","NCES_Category_Code","NCES Category Code"]),c=_=>qf(_,["NCES_Type","NCES Type","NCES_Type_Code","NCES Type Code"]),u=_=>qf(_,["NCES_Type Description_Sh","NCES_Type Description","NCES Type Description","NCES_Type Description_Short"]),m=(_,o={})=>{const w=I8(_,o);w&&e.set(w.value,w)};for(const _ of n||[]){const o=_.properties||{},w=na(pd(o)),I=na(o.department??o.Department??o.Dept),R=i(o),V=c(o),k=u(o);w&&m(w,{categoryCode:R,typeCode:V,typeDesc:k}),I&&t.add(I)}return{typeOptions:Array.from(e.values()).sort((_,o)=>_.label.localeCompare(o.label)),deptOptions:Array.from(t).filter(Boolean).sort()}}function AU(n,e={}){if(!n||!Array.isArray(n.features)||!n.features.length)return null;const t=Lu(n);if(!t||t.some(pe=>!Number.isFinite(pe)))return null;const i=720,c=t[2]-t[0],u=t[3]-t[1];if(c<=0||u<=0)return null;const m=u/c,_=Math.max(260,Math.round(i*Math.max(.33,Math.min(m,2.5)))),o=document.createElement("canvas");o.width=i,o.height=_;const w=o.getContext("2d");w.fillStyle="#ffffff",w.fillRect(0,0,i,_);const I=pe=>{const U=(pe[0]-t[0])/c*i,F=_-(pe[1]-t[1])/u*_;return[U,F]},R=pe=>{if(!Array.isArray(pe))return;w.beginPath();const U=I(pe[0]);w.moveTo(U[0],U[1]);for(let F=1;F<pe.length;F++){const q=I(pe[F]);w.lineTo(q[0],q[1])}w.closePath()},V=pe=>{if(!Array.isArray(pe))return;w.beginPath();const U=I(pe[0]);w.moveTo(U[0],U[1]);for(let F=1;F<pe.length;F++){const q=I(pe[F]);w.lineTo(q[0],q[1])}},k=pe=>na(pe?.department??pe?.Department??pe?.Dept??"")||"",ie=pe=>{if(Number.isFinite(pe))return pe;const U=Number(pe);return Number.isFinite(U)?U:pe!=null?String(pe):null},ae=new Set((e?.selectedIds||[]).map(pe=>ie(pe)).filter(pe=>pe!=null)),fe=e?.solidFill===!0,J=e?.labelOptions||{},ne=J.enabled!==!1,me=J.hideDrawing===!0,ue={font:J.font||'bold 10px "Open Sans", Arial, sans-serif',lineHeight:J.lineHeight||12,maxLines:J.maxLines||4,minWidth:J.minWidth||32,minHeight:J.minHeight||14},ke=(pe,U,F,q)=>{const j=[],H=Z=>{const be=na(Z);be&&(me&&be.toLowerCase()==="drawing"||j.length>=ue.maxLines||j.push(be))};return H(pe?.Number??pe?.RoomNumber??pe?.number),H(pd(pe)||pe?.Name),H(U||F),q>0&&H(`${Math.round(q).toLocaleString()} SF`),j},ze=(pe,U)=>{if(!ne||!U.length)return;const q=xc(pe)?.geometry?.coordinates;if(!q)return;const j=Lu(pe);if(!j)return;const H=(j[2]-j[0])/c*i,Z=(j[3]-j[1])/u*_,be=ue.lineHeight*U.length;if(H<ue.minWidth||Z<Math.max(be,ue.minHeight))return;const[Me,Be]=I(q),Re=ue.lineHeight*U.length,we=Be-Re/2+ue.lineHeight/2;w.save(),w.font=ue.font,w.textAlign="center",w.textBaseline="middle",w.lineJoin="round",w.fillStyle="#101010",w.strokeStyle="rgba(255,255,255,0.95)",w.lineWidth=3;for(let De=0;De<U.length;De+=1){const nt=we+De*ue.lineHeight;w.strokeText(U[De],Me,nt),w.fillText(U[De],Me,nt)}w.restore()};for(const pe of n.features){const U=pe?.properties||{},F=v0(U),q=na(U?.scenarioDepartment??U?.ScenarioDepartment??U?.scenarioDept??""),j=k(U),H=q||j,Z=U?.__roomType||pd(U)||U?.Name||"",be=(U?.occupant??U?.Occupant??"").toString().trim(),Me=e?.colorMode||"department";let Be="#f7f7f7";Me==="type"?Be=Q5(Z):Me==="occupancy"?Be=be?"#29b6f6":"#e0e0e0":Me==="vacancy"?Be=be?"#29b6f6":"#ff7043":Be=H?Qd(H):"#f7f7f7";let Re=Be?C8(Be,fe?1:q?.9:.4):"#f7f7f7",we="#2b2b2b",De=F==="room"?2.2:1.5;const nt=ie(pe?.id??U?.RevitId??U?.Revit_UniqueId??U?.RevitUniqueId??U?.Revit_UniqueID??U?.["Revit Unique Id"]??U?.["Room GUID"]??U?.roomGuid??U?.id),xe=nt!=null&&ae.has(nt);F==="door"?(Re="#1d1d1d",we="#0d0d0d",De=1.5):F==="stair"?(Re="#6b6b6b",we="#3a3a3a",De=1.5):Be&&(we="#202020"),xe&&(F==="room"&&(Re="rgba(0, 200, 255, 0.35)"),we="#00c8ff",De=4);const le=pe?.geometry;if(!le||!le.coordinates)continue;const Ne=(rt,mt)=>{Array.isArray(rt)&&(mt==="Polygon"?(w.fillStyle=Re,w.strokeStyle=we,w.lineWidth=De,rt.forEach(dt=>{R(dt),w.fill(),w.stroke()})):mt==="MultiPolygon"?rt.forEach(dt=>Ne(dt,"Polygon")):mt==="LineString"?(w.strokeStyle=we,w.lineWidth=F==="door"?2:1.5,V(rt),w.stroke()):mt==="MultiLineString"&&rt.forEach(dt=>Ne(dt,"LineString")))};Ne(le.coordinates,le.type);const Oe=Number(U?.Area_SF??U?.Area??U?.["Area (SF)"]??U?.Area_sf??U?.NetArea??U?.SF??0),Je=Number.isFinite(Oe)&&Oe>0?Oe:0;if(F==="room"){const rt=ke(U,q,j,Je);ze(pe,rt)}}return{width:o.width,height:o.height,data:o.toDataURL("image/png")}}function Kg(n={}){const e=n?.fc??n;return e?AU(e,n):null}const pd=(n={})=>{const e=n["Room Type Description"]??n.RoomTypeDescription??n.roomTypeDescription;if(e&&String(e).trim())return String(e).trim();const t=n.NCES_Type??n["NCES Type"]??n["NCES Types"]??n.NCES_Types??n.nces_type??n.ncesType;if(t&&String(t).trim())return String(t).trim();const i=n["NCES_Type Description_Sh"]??n["NCES_Type Description"]??n["NCES Type Description"]??n["NCES_Type Description_Short"]??n["NCES Type Description Short"];return i&&String(i).trim()?String(i).trim():(n["Room Type"]||n.RoomType||n.RoomTypeName||n.Type||n.type||n.Category||n.category||n.Name||n["Room Name"]||"").toString().trim()};function L3(n={}){return(n.NCES_Type??n["NCES Types"]??n.NCES_Types??n.nces_type??n.ncesType??"").toString().trim()}function M8(n={}){return(n.NCES_Department??n.NCES_Department??n.NCES_Dept??n["NCES Dept"]??n.department??n.Department??n.Dept??"").toString().trim()}function R8(n={}){const e=n.Area_SF??n.Area_SF??n.area??n.Area??n.SF??n["Area (SF)"]??n.NetArea??0,t=Number(e);return Number.isFinite(t)?t:0}function TU(n){if(!n?.features?.length)return n;const e=n.features.map(t=>{const i=t?.properties||{};if("__roomType"in i)return t;const c=L3(i),u=c&&String(c).trim();return u?{...t,properties:{...i,__roomType:u}}:t});return{...n,features:e}}function N8(n){if(!n)return null;const e=n.anchor_feet||n.anchorFeet||n.anchor;return[n.target_lon??n.targetLon,n.target_lat??n.targetLat,n.rotation_deg_cw??n.rotation_deg,n.scale_deg_per_foot??n.scale_deg_per_ft??n.scale,Array.isArray(e)?e.join(","):""].map(i=>i==null?"":String(i)).join("|")}const IU="mfDrawingAlign:",Xy=new Map,D8="mfFloorAdjust:",F8="mfFloorAdjustUrl:",O8="mfFloorAdjustFloor:",Zy=new Map,Yy=new Map,Jy=new Map;function P3(n,e){const t=Qc(n||""),i=Na(e||"");return`${IU}${t}/${i}`}function yx(n,e){const t=Qc(n||""),i=Na(e||"");return`${D8}${t}/${i}`}function _x(n){const e=Qc(n||"");return`${F8}${e}`}function vx(n,e){const t=n?Fd(n):"",i=Qc(t||n||""),c=Na(e||"");return`${O8}${i}/${c}`}function B8(n){return n?[n.rotationDeg,n.scale,Array.isArray(n.pivot)?n.pivot.join(","):"",Array.isArray(n.target)?n.target.join(","):""].map(t=>t==null?"":String(t)).join("|"):null}function z8(n,e){const t=P3(n,e);if(!t)return null;if(Xy.has(t))return Xy.get(t);if(typeof window>"u"||!window.localStorage)return null;try{const i=window.localStorage.getItem(t);if(!i)return null;const c=JSON.parse(i);return!c||!Array.isArray(c.pivot)||!Array.isArray(c.target)?null:(Xy.set(t,c),c)}catch{return null}}function Wm(n,e){const t=yx(n,e);if(!t)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};if(Zy.has(t))return Zy.get(t);if(typeof window>"u"||!window.localStorage)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};try{const i=window.localStorage.getItem(t);if(!i)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};const c=JSON.parse(i),u=Number(c?.rotationDeg),m=Number(c?.scale),_=Array.isArray(c?.translateMeters)?c.translateMeters:[0,0],o=Array.isArray(c?.translateLngLat)?c.translateLngLat:null,w=Number(c?.savedAt),I=Array.isArray(c?.pivot)?c.pivot:null,R=Array.isArray(c?.anchorLngLat)?c.anchorLngLat:null,V={rotationDeg:Number.isFinite(u)?u:0,scale:Number.isFinite(m)&&m>0?m:1,translateMeters:[Number.isFinite(_[0])?_[0]:0,Number.isFinite(_[1])?_[1]:0],translateLngLat:Array.isArray(o)?[Number.isFinite(o[0])?o[0]:0,Number.isFinite(o[1])?o[1]:0]:null,anchorLngLat:Array.isArray(R)?[Number.isFinite(R[0])?R[0]:0,Number.isFinite(R[1])?R[1]:0]:null,savedAt:Number.isFinite(w)?w:0,pivot:Array.isArray(I)&&I.length>=2?I:null};return Zy.set(t,V),V}catch{return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0}}}function Oy(n){const e=_x(n);if(!e)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};if(Yy.has(e))return Yy.get(e);if(typeof window>"u"||!window.localStorage)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};try{const t=window.localStorage.getItem(e);if(!t)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};const i=JSON.parse(t),c=Number(i?.rotationDeg),u=Number(i?.scale),m=Array.isArray(i?.translateMeters)?i.translateMeters:[0,0],_=Array.isArray(i?.translateLngLat)?i.translateLngLat:null,o=Number(i?.savedAt),w=Array.isArray(i?.pivot)?i.pivot:null,I=Array.isArray(i?.anchorLngLat)?i.anchorLngLat:null,R={rotationDeg:Number.isFinite(c)?c:0,scale:Number.isFinite(u)&&u>0?u:1,translateMeters:[Number.isFinite(m[0])?m[0]:0,Number.isFinite(m[1])?m[1]:0],translateLngLat:Array.isArray(_)?[Number.isFinite(_[0])?_[0]:0,Number.isFinite(_[1])?_[1]:0]:null,anchorLngLat:Array.isArray(I)?[Number.isFinite(I[0])?I[0]:0,Number.isFinite(I[1])?I[1]:0]:null,savedAt:Number.isFinite(o)?o:0,pivot:Array.isArray(w)&&w.length>=2?w:null};return Yy.set(e,R),R}catch{return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0}}}function By(n,e){const t=vx(n,e);if(!t)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};if(Jy.has(t))return Jy.get(t);if(typeof window>"u"||!window.localStorage)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};try{const i=window.localStorage.getItem(t);if(!i)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};const c=JSON.parse(i),u=Number(c?.rotationDeg),m=Number(c?.scale),_=Array.isArray(c?.translateMeters)?c.translateMeters:[0,0],o=Array.isArray(c?.translateLngLat)?c.translateLngLat:null,w=Number(c?.savedAt),I=Array.isArray(c?.pivot)?c.pivot:null,R=Array.isArray(c?.anchorLngLat)?c.anchorLngLat:null,V={rotationDeg:Number.isFinite(u)?u:0,scale:Number.isFinite(m)&&m>0?m:1,translateMeters:[Number.isFinite(_[0])?_[0]:0,Number.isFinite(_[1])?_[1]:0],translateLngLat:Array.isArray(o)?[Number.isFinite(o[0])?o[0]:0,Number.isFinite(o[1])?o[1]:0]:null,anchorLngLat:Array.isArray(R)?[Number.isFinite(R[0])?R[0]:0,Number.isFinite(R[1])?R[1]:0]:null,savedAt:Number.isFinite(w)?w:0,pivot:Array.isArray(I)&&I.length>=2?I:null};return Jy.set(t,V),V}catch{return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0}}}function CU(n,e,t){const i=P3(n,e);if(!i||!t||typeof window>"u"||!window.localStorage)return!1;try{return window.localStorage.setItem(i,JSON.stringify(t)),Xy.set(i,t),!0}catch{return!1}}function P1(n,e,t){const i=yx(n,e);if(!i||!t||typeof window>"u"||!window.localStorage)return!1;const c=Array.isArray(t.pivot)?t.pivot:null,u=Array.isArray(t.translateLngLat)?t.translateLngLat:null,m=Array.isArray(t.anchorLngLat)?t.anchorLngLat:null,_={rotationDeg:Number.isFinite(t.rotationDeg)?t.rotationDeg:0,scale:Number.isFinite(t.scale)&&t.scale>0?t.scale:1,translateMeters:Array.isArray(t.translateMeters)?[Number.isFinite(t.translateMeters[0])?t.translateMeters[0]:0,Number.isFinite(t.translateMeters[1])?t.translateMeters[1]:0]:[0,0],translateLngLat:Array.isArray(u)?[Number.isFinite(u[0])?u[0]:0,Number.isFinite(u[1])?u[1]:0]:null,anchorLngLat:Array.isArray(m)?[Number.isFinite(m[0])?m[0]:0,Number.isFinite(m[1])?m[1]:0]:null,savedAt:Date.now(),pivot:Array.isArray(c)&&c.length>=2?c:null};try{return window.localStorage.setItem(i,JSON.stringify(_)),Zy.set(i,_),!0}catch{return!1}}function k1(n,e){const t=_x(n);if(!t||!e||typeof window>"u"||!window.localStorage)return!1;const i=Array.isArray(e.pivot)?e.pivot:null,c=Array.isArray(e.translateLngLat)?e.translateLngLat:null,u=Array.isArray(e.anchorLngLat)?e.anchorLngLat:null,m={rotationDeg:Number.isFinite(e.rotationDeg)?e.rotationDeg:0,scale:Number.isFinite(e.scale)&&e.scale>0?e.scale:1,translateMeters:Array.isArray(e.translateMeters)?[Number.isFinite(e.translateMeters[0])?e.translateMeters[0]:0,Number.isFinite(e.translateMeters[1])?e.translateMeters[1]:0]:[0,0],translateLngLat:Array.isArray(c)?[Number.isFinite(c[0])?c[0]:0,Number.isFinite(c[1])?c[1]:0]:null,anchorLngLat:Array.isArray(u)?[Number.isFinite(u[0])?u[0]:0,Number.isFinite(u[1])?u[1]:0]:null,savedAt:Date.now(),pivot:Array.isArray(i)&&i.length>=2?i:null};try{return window.localStorage.setItem(t,JSON.stringify(m)),Yy.set(t,m),!0}catch{return!1}}function M1(n,e,t){const i=vx(n,e);if(!i||!t||typeof window>"u"||!window.localStorage)return!1;const c=Array.isArray(t.pivot)?t.pivot:null,u=Array.isArray(t.translateLngLat)?t.translateLngLat:null,m=Array.isArray(t.anchorLngLat)?t.anchorLngLat:null,_={rotationDeg:Number.isFinite(t.rotationDeg)?t.rotationDeg:0,scale:Number.isFinite(t.scale)&&t.scale>0?t.scale:1,translateMeters:Array.isArray(t.translateMeters)?[Number.isFinite(t.translateMeters[0])?t.translateMeters[0]:0,Number.isFinite(t.translateMeters[1])?t.translateMeters[1]:0]:[0,0],translateLngLat:Array.isArray(u)?[Number.isFinite(u[0])?u[0]:0,Number.isFinite(u[1])?u[1]:0]:null,anchorLngLat:Array.isArray(m)?[Number.isFinite(m[0])?m[0]:0,Number.isFinite(m[1])?m[1]:0]:null,savedAt:Date.now(),pivot:Array.isArray(c)&&c.length>=2?c:null};try{return window.localStorage.setItem(i,JSON.stringify(_)),Jy.set(i,_),!0}catch{return!1}}function LU(n,e){const t=P3(n,e);if(t&&(Xy.delete(t),!(typeof window>"u"||!window.localStorage)))try{window.localStorage.removeItem(t)}catch{}}function PU(n,e){const t=yx(n,e);if(t&&(Zy.delete(t),!(typeof window>"u"||!window.localStorage)))try{window.localStorage.removeItem(t)}catch{}}function kU(n){const e=_x(n);if(e&&(Yy.delete(e),!(typeof window>"u"||!window.localStorage)))try{window.localStorage.removeItem(e)}catch{}}function MU(n,e){const t=vx(n,e);if(t&&(Jy.delete(t),!(typeof window>"u"||!window.localStorage)))try{window.localStorage.removeItem(t)}catch{}}function RU(n,e){if(!n?.features?.length||!e)return n;const t=B8(e);if(t&&n.__mfDrawingAlignSignature===t)return n;const i=Array.isArray(e.pivot)?e.pivot:null,c=Array.isArray(e.target)?e.target:null;if(!i||!c)return n;const u=Number.isFinite(e.scale)?e.scale:1,_=(Number.isFinite(e.rotationDeg)?e.rotationDeg:0)*Math.PI/180,o=Math.cos(_),w=Math.sin(_),[I,R]=i,[V,k]=c,ie=J=>{const ne=J[0]-I,me=J[1]-R,ue=(ne*o-me*w)*u,ke=(ne*w+me*o)*u;return[V+ue,k+ke]},ae=n.features.map(J=>!Mh(J?.properties||{})||!J?.geometry?J:{...J,geometry:{...J.geometry,coordinates:Of(J.geometry.coordinates,ie)}}),fe={...n,features:ae};return t&&(fe.__mfDrawingAlignSignature=t),fe}function Dv({buildingLabel:n,buildingId:e,floorBasePath:t,fitBuilding:i}={}){const c=n||e||i?.properties?.id||i?.properties?.name||"",u=Cf(c)||c;if(u)return u;if(t){const m=Fd(t);if(m)return u0?.[m]||m}return""}function NU({buildingLabel:n,buildingId:e,floorBasePath:t,fitBuilding:i}={}){const c=t?Fd(t):null;return c||Dv({buildingLabel:n,buildingId:e,floorBasePath:t,fitBuilding:i})}function Fv(n){return n?[n.rotationDeg,n.scale,Array.isArray(n.translateMeters)?n.translateMeters.join(","):"",Array.isArray(n.translateLngLat)?n.translateLngLat.join(","):"",Array.isArray(n.anchorLngLat)?n.anchorLngLat.join(","):""].map(t=>t==null?"":String(t)).join("|"):null}function mp(n){return n?Math.abs(n.rotationDeg||0)>1e-6||Math.abs((n.scale||1)-1)>1e-6||Math.abs(n.translateMeters?.[0]||0)>1e-6||Math.abs(n.translateMeters?.[1]||0)>1e-6||Math.abs(n.translateLngLat?.[0]||0)>1e-12||Math.abs(n.translateLngLat?.[1]||0)>1e-12||Math.abs(n.anchorLngLat?.[0]||0)>1e-12||Math.abs(n.anchorLngLat?.[1]||0)>1e-12:!1}function ew({base:n,url:e,label:t}){const i=[{source:"basePath",adjust:n},{source:"url",adjust:e},{source:"label",adjust:t}].filter(m=>m.adjust),c=i.filter(m=>mp(m.adjust));if(c.length){let m=null;for(const _ of c){const o=Number(_.adjust?.savedAt)||0;(!m||o>m.savedAt)&&(m={..._,savedAt:o})}if(m)return m}return i.find(m=>m.source==="label")||i[0]||{source:"label",adjust:null,savedAt:0}}function rv(n){if(!n?.features?.length)return null;try{const e=xc(n)?.geometry?.coordinates||null;return!Array.isArray(e)||e.length<2||!Number.isFinite(e[0])||!Number.isFinite(e[1])?null:e}catch{return null}}function DU(n,e,t){if(!n?.features?.length||!e)return{fc:n,fitTransform:t};const i=Fv(e);if(i&&n.__mfUserAdjustSignature===i)return{fc:n,fitTransform:t};const c=Number.isFinite(e.rotationDeg)?e.rotationDeg:0,u=Number.isFinite(e.scale)?e.scale:1,m=Array.isArray(e.translateMeters)?e.translateMeters:[0,0],_=Array.isArray(e.translateLngLat)?e.translateLngLat:null,o=Array.isArray(e.anchorLngLat)?e.anchorLngLat:null;let w=n;const I=(Array.isArray(e.pivot)?e.pivot:null)||t?.scaleOrigin||t?.rotationPivot||xc(w)?.geometry?.coordinates||null;if(Number.isFinite(u)&&Math.abs(u-1)>1e-6&&I&&(w=L0(w,u,{origin:I})),Number.isFinite(c)&&Math.abs(c)>1e-6&&I&&(w=Zh(w,c,{pivot:I})),_&&(Math.abs(_[0]||0)>1e-12||Math.abs(_[1]||0)>1e-12)?w=nw(w,_):m&&(Math.abs(m[0]||0)>1e-6||Math.abs(m[1]||0)>1e-6)&&(w=M3(w,m)),o&&Number.isFinite(o[0])&&Number.isFinite(o[1])){const V=rv(w);if(V){const k=o[0]-V[0],ie=o[1]-V[1];(Math.abs(k)>1e-12||Math.abs(ie)>1e-12)&&(w=nw(w,[k,ie]))}}w&&typeof w=="object"&&(w.__mfUserAdjustSignature=i);let R=t;if((Number.isFinite(u)||Number.isFinite(c)||Array.isArray(m))&&(R=R||{rotationDeg:0,rotationPivot:I,scale:1,scaleOrigin:I,translateKm:0,translateBearing:0,nudgeMeters:[0,0],refineRotationDeg:0,refineRotationPivot:I},I&&(Array.isArray(R.rotationPivot)||(R.rotationPivot=I),Array.isArray(R.scaleOrigin)||(R.scaleOrigin=I),Array.isArray(R.refineRotationPivot)||(R.refineRotationPivot=I)),Number.isFinite(u)&&Math.abs(u-1)>1e-6&&(R.scale=(Number.isFinite(R.scale)?R.scale:1)*u),Number.isFinite(c)&&Math.abs(c)>1e-6&&(R.rotationDeg=(Number.isFinite(R.rotationDeg)?R.rotationDeg:0)+c),Array.isArray(m))){const V=Array.isArray(R.nudgeMeters)?R.nudgeMeters:[0,0];R.nudgeMeters=[(Number(V[0])||0)+(Number(m[0])||0),(Number(V[1])||0)+(Number(m[1])||0)]}return{fc:w,fitTransform:R}}function Mh(n={}){return n?String(n.type??n.Type??"").toLowerCase()==="drawing"?!0:n.interactive===!1:!1}function FU(n,e){if(!n?.geometry||!Array.isArray(e))return e;const t=Od(n.geometry,4e3);if(!t.length)return e;let i=e,c=1/0;for(const[u,m]of t){const _=u-e[0],o=m-e[1],w=_*_+o*o;w<c&&(c=w,i=[u,m])}return i}function OU(n,e=4e3){let t=1/0,i=1/0,c=-1/0,u=-1/0,m=0;const _=o=>{if(!(!Array.isArray(o)||m>=e)){if(o.length>=2&&typeof o[0]=="number"&&typeof o[1]=="number"){const w=o[0],I=o[1];w<t&&(t=w),I<i&&(i=I),w>c&&(c=w),I>u&&(u=I),m+=1;return}o.forEach(_)}};return _(n),m?{minX:t,minY:i,maxX:c,maxY:u}:null}function BU(n,e=.12){if(!n?.features?.length)return n;const t=n.features.filter(J=>!Mh(J?.properties||{}));if(!t.length)return n;let i=1/0,c=1/0,u=-1/0,m=-1/0,_=0;for(const J of t){const ne=Od(J?.geometry,4e3);for(const[me,ue]of ne)me<i&&(i=me),ue<c&&(c=ue),me>u&&(u=me),ue>m&&(m=ue),_+=1;if(_>2e4)break}if(!_)return n;const o=Math.max(1e-9,u-i),w=Math.max(1e-9,m-c),I=o*e,R=w*e,V=i-I,k=c-R,ie=u+I,ae=m+R,fe=[];for(const J of n.features){if(!Mh(J?.properties||{})){fe.push(J);continue}const ne=OU(J?.geometry?.coordinates,4e3);if(!ne)continue;!(ne.maxX<V||ne.minX>ie||ne.maxY<k||ne.minY>ae)&&fe.push(J)}return fe.length===n.features.length?n:{...n,features:fe}}function zU(n,e={}){if(!n?.features?.length||n.__mfAutoDrawingAlign)return n;const t=n.features.filter(fe=>Mh(fe?.properties||{})),i=n.features.filter(fe=>!Mh(fe?.properties||{}));if(!t.length||!i.length)return n;const c=(fe,J=2e4)=>{let ne=1/0,me=1/0,ue=-1/0,ke=-1/0,ze=0;for(const pe of fe){const U=Od(pe?.geometry,Math.max(0,J-ze));ze+=U.length;for(const[F,q]of U)F<ne&&(ne=F),q<me&&(me=q),F>ue&&(ue=F),q>ke&&(ke=q);if(ze>=J)break}return!Number.isFinite(ne)||!Number.isFinite(me)||!Number.isFinite(ue)||!Number.isFinite(ke)?null:{minX:ne,minY:me,maxX:ue,maxY:ke,spanX:ue-ne,spanY:ke-me,cx:(ne+ue)/2,cy:(me+ke)/2}},u=c(i),m=c(t);if(!u||!m||!(m.maxX<u.minX||m.minX>u.maxX||m.maxY<u.minY||m.minY>u.maxY))return n;const o=u.spanX>0?m.spanX/u.spanX:0,w=u.spanY>0?m.spanY/u.spanY:0;if(o<.5||o>2||w<.5||w>2)return n;const I=VV(e.buildingLabel,e.floorId);let R=n.features;if(I){const fe=[m.cx,m.cy];R=R.map(J=>!Mh(J?.properties||{})||!J?.geometry?J:{...J,geometry:{...J.geometry,coordinates:Of(J.geometry.coordinates,ne=>zy(ne,fe,180))}})}const V=c(R.filter(fe=>Mh(fe?.properties||{})));if(!V)return n;const k=u.cx-V.cx,ie=u.cy-V.cy;if(!Number.isFinite(k)||!Number.isFinite(ie))return n;const ae={...n,features:R.map(fe=>!Mh(fe?.properties||{})||!fe?.geometry?fe:{...fe,geometry:{...fe.geometry,coordinates:Of(fe.geometry.coordinates,([J,ne])=>[J+k,ne+ie])}})};return ae.__mfAutoDrawingAlign=!0,ae}function Yb({map:n,fc:e,isDrawing:t,screenPoint:i,maxPixels:c,maxPoints:u}){if(!n||!e?.features?.length||!i)return null;const m=Number.isFinite(c)?c:null,_=Number.isFinite(u)?u:8e3;let o=null,w=1/0,I=0;for(const R of e.features){const V=R?.properties||{},k=Mh(V),ie=R?.geometry?.type||"",fe=k||(ie==="LineString"||ie==="MultiLineString");if((t?!fe:fe)||!R?.geometry)continue;const J=Od(R.geometry,Math.max(0,_-I));I+=J.length;for(const[ne,me]of J){const ue=n.project({lng:ne,lat:me}),ke=ue.x-i.x,ze=ue.y-i.y,pe=ke*ke+ze*ze;pe<w&&(w=pe,o=[ne,me])}if(I>=_)break}return o&&(m==null||w<=m*m)?o:null}function jU(n){if(!n||!Array.isArray(n.features)||n.features.length===0)return n;const e=n.features.filter(t=>!Mh(t?.properties||{}));return e.length===0||e.length===n.features.length?n:{...n,features:e,__mfFitCandidate:!0}}const DA=[{key:"roomA",label:"Click room point A (rooms layer)"},{key:"roomB",label:"Click room point B (rooms layer)"},{key:"drawingA",label:"Click drawing point A (linework)"},{key:"drawingB",label:"Click drawing point B (linework)"}],UU=40,VU=140,Jb=12e3,j8=fU?"/StakeholderMap/":"/",Jd=n=>`${j8}${n}`.replace(/\/{2,}/g,"/"),iv=Jd("floorplans/manifest.json"),tw="Hastings",qU=!1,l0=["==",["get","Element"],"Room"];async function p_(n){try{const e=await fetch(n,{cache:"no-store"});if(!e.ok)return null;const t=(e.headers.get("content-type")||"").toLowerCase(),i=await e.text();if(t.includes("text/html"))return null;const c=i.replace(/^\uFEFF/,"");try{return JSON.parse(c)}catch{return null}}catch{return null}}async function U8(n){if(!n)return null;try{const e=await fetch(n,{cache:"no-store"});if(!e.ok)return null;const t=(e.headers.get("content-type")||"").toLowerCase(),i=await e.text();if(t.includes("text/html"))return null;try{const c=i.replace(/^\uFEFF/,"");return JSON.parse(c)}catch{return null}}catch{return null}}function k3(n){return n?n.type==="FeatureCollection"&&Array.isArray(n.features)?n:Array.isArray(n.features)?{type:"FeatureCollection",features:n.features}:n.type==="Feature"?{type:"FeatureCollection",features:[n]}:null:null}function ov(n,e){if(!n||!e||n.__mfAffineApplied||lV(n))return n;const t=$8(n,e);return t&&typeof t=="object"&&(t.__mfAffineApplied=!0,t.__mfAffineSignature=N8(e)),t}function V8(n,e,t){if(!n||!Number.isFinite(e)||Math.abs(e)<1e-6||n.__mfRotationOverride===e)return n;try{const i=Array.isArray(t)&&t.length>=2?t:t?.geometry?.coordinates||xc(n)?.geometry?.coordinates||null,c=Zh(n,e,i?{pivot:i}:void 0);if(c&&typeof c=="object")return c.__mfRotationOverride=e,i&&(c.__mfRotationPivot=i),n.__mfFitTransform&&(c.__mfFitTransform=n.__mfFitTransform),n.__mfFitted&&(c.__mfFitted=n.__mfFitted),n.__mfFittedBuilding&&(c.__mfFittedBuilding=n.__mfFittedBuilding),n.__mfAffineApplied&&(c.__mfAffineApplied=n.__mfAffineApplied),c}catch{}return n}function Qb(n){if(!n)return null;const e=String(n).split("?")[0],t=e.lastIndexOf("/Rooms/");if(t>=0)return e.slice(0,t);const i=e.lastIndexOf("/");return i>0?e.slice(0,i):null}function M3(n,e){if(!n||!Array.isArray(e)||e.length<2)return n;const t=Number(e[0]),i=Number(e[1]);let c=n;if(Number.isFinite(t)&&Math.abs(t)>1e-6){const u=Math.abs(t)/1e3,m=t>=0?90:270;c=Ym(c,u,m,{units:"kilometers"})}if(Number.isFinite(i)&&Math.abs(i)>1e-6){const u=Math.abs(i)/1e3,m=i>=0?0:180;c=Ym(c,u,m,{units:"kilometers"})}return c}function nw(n,e){if(!n||!Array.isArray(e)||e.length<2)return n;const t=Number(e[0]),i=Number(e[1]);if(!Number.isFinite(t)&&!Number.isFinite(i))return n;const c=u=>[u[0]+(Number.isFinite(t)?t:0),u[1]+(Number.isFinite(i)?i:0)];return{...n,features:(n.features||[]).map(u=>({...u,geometry:u.geometry?{...u.geometry,coordinates:Of(u.geometry.coordinates,c)}:u.geometry}))}}function q8(n,e){if(!n||!e||n.__mfFitTransformApplied)return n;let t=n;try{const{rotationDeg:i,rotationPivot:c,scale:u,scaleOrigin:m,translateKm:_,translateBearing:o,nudgeMeters:w,refineRotationDeg:I,refineRotationPivot:R}=e;Number.isFinite(i)&&Math.abs(i)>1e-6&&Array.isArray(c)&&(t=Zh(t,i,{pivot:c})),Number.isFinite(u)&&u>0&&Math.abs(u-1)>1e-6&&Array.isArray(m)&&(t=L0(t,u,{origin:m})),Number.isFinite(_)&&Number.isFinite(o)&&Math.abs(_)>1e-9&&(t=Ym(t,_,o,{units:"kilometers"})),Array.isArray(w)&&(t=M3(t,w)),Number.isFinite(I)&&Math.abs(I)>1e-6&&Array.isArray(R)&&(t=Zh(t,I,{pivot:R}))}catch{}return t&&typeof t=="object"&&(t.__mfFitTransformApplied=!0),t}function sv(n,e){if(!n||!e)return null;try{const t=n.getSource("buildings");let c=(t?._data||t?.serialize?.().data||null)?.features||[];if(!c.length&&typeof n.querySourceFeatures=="function")try{c=n.querySourceFeatures("buildings")||[]}catch{}return If(c,e)}catch{return null}}function $U(n,e){if(!n||!Number.isFinite(e)||Math.abs(e)<1e-6||!Array.isArray(n.features)||!n.features.length)return n;const t=Math.PI/180,i=-e*t,c=Math.cos(i),u=Math.sin(i),m=o=>{const w=o*t,I=Math.sin(w),R=Math.cos(w),V=I*c-R*u,k=I*u+R*c;return(Math.atan2(V,k)/t+360)%360};return{...n,features:n.features.map(o=>{const w=o?.properties||{},I=Number(w.bearing_deg);if(!Number.isFinite(I))return o;const R=m(I);return{...o,properties:{...w,bearing_deg:R}}})}}function GU(n,e,t,i={}){if(!n)return n;const c=i.adjustBearings&&Number.isFinite(i.bearingRotationDeg)&&Math.abs(i.bearingRotationDeg)>1e-6;if(!e&&!t&&!c||n.__mfOverlayTransformApplied)return n;let u=n;if(e?.deg!=null&&(u=V8(u,e.deg,e.pivot)),t&&(u=q8(u,t)),i.adjustBearings){const m=(Number.isFinite(i.bearingRotationDeg)?i.bearingRotationDeg:0)+(Number.isFinite(e?.deg)?e.deg:0)+(Number.isFinite(t?.rotationDeg)?t.rotationDeg:0)+(Number.isFinite(t?.refineRotationDeg)?t.refineRotationDeg:0);u=$U(u,m)}return u&&typeof u=="object"&&(u.__mfOverlayTransformApplied=!0),u}const HU=new Set(["calvin_french_chapel/basement","kiewit/level_2"]);async function r0(n,e){if(!n||!e)return null;const t=Qc(Fd(n)||""),i=Na(e),u=HU.has(`${t}/${i}`)?[`${n}/${e}_Dept.affine.json`,`${n}/affine.json`]:[`${n}/affine.json`],m=Array.from(new Set([...u,...u.map(_=>{try{return encodeURI(_)}catch{return _}})]));for(const _ of m){const o=await U8(_);if(o)return o}return null}async function WU(n){for(const e of(n||[]).filter(Boolean)){const t=await U8(e);if(t)return{url:e,data:t}}return{url:n?.[0]||"",data:null}}async function KU({basePath:n,floorId:e,skipAffine:t=!1}){const i=[`${n}/Rooms/${e}_Dept_Rooms.geojson`,`${n}/Rooms/${e}_Dept.geojson`,`${n}/${e}_Dept_Rooms.geojson`,`${n}/${e}_Dept.geojson`],[{data:c},u]=await Promise.all([WU(i),t?Promise.resolve(null):r0(n,e)]),m=k3(c);if(!m)return{rawFC:null,patchedFC:null,affine:null};m.features=(m.features||[]).map(o=>{const w=o?.properties||{},I=L3(w),R=M8(w);return{...o,properties:{...w,__roomType:I||"",__dept:R||"",__areaSf:R8(w)}}});const _=ov(m,u);return{rawFC:m,patchedFC:_,affine:u}}function XU(n,e){function t(i){if(!i)return i;if(typeof i[0]=="number"){const c=i[0],u=i[1];return[e.a*c+e.b*u+e.c,e.d*c+e.e*u+e.f]}return i.map(t)}return{...n,features:n.features.map(i=>({...i,geometry:i.geometry?{...i.geometry,coordinates:t(i.geometry.coordinates)}:i.geometry}))}}function $8(n,e){if(!n||!e)return n;const t=e.anchor_feet||e.anchorFeet||e.anchor;if(!Array.isArray(t)||t.length<2)return n;const i=Number(e.target_lon??e.targetLon),c=Number(e.target_lat??e.targetLat);if(!Number.isFinite(i)||!Number.isFinite(c))return n;const u=Number(e.rotation_deg_cw??e.rotation_deg??0),m=e.effective_scale_deg_per_foot!=null,_=Number(m?e.effective_scale_deg_per_foot:e.scale_deg_per_foot??e.scale_deg_per_ft??e.scale);if(!Number.isFinite(_)||_===0)return n;const o=Number(e.scale_percent??100),w=m?_:_*(Number.isFinite(o)?o/100:1),I=c*Math.PI/180,R=Math.max(1e-9,Math.cos(I)),V=w/R,k=u*Math.PI/180,ie=Math.cos(k),ae=Math.sin(k),[fe,J]=t,ne=V*ie,me=-V*ae,ue=i-(ne*fe+me*J),ke=w*ae,ze=w*ie,pe=c-(ke*fe+ze*J);return XU(n,{a:ne,b:me,c:ue,d:ke,e:ze,f:pe})}async function G8(n){for(const e of(n||[]).filter(Boolean))try{const t=await fetch(e,{cache:"no-store"}),i=(t.headers.get("content-type")||"").toLowerCase(),c=await t.text();if(!t.ok||i.includes("text/html"))continue;try{const u=c.replace(/^\uFEFF/,""),m=JSON.parse(u);return{ok:!0,url:e,data:m}}catch{continue}}catch{continue}return{ok:!1,url:n?.[0]||"",error:"No valid JSON response from any candidate URL."}}async function ZU({basePath:n,floorId:e,map:t,roomsFC:i,affine:c,rotationOverride:u,fitTransform:m}){if(!n||!e||!t)return;const _=String(e).trim(),o=[`${n}/${_}_-_Map_Export_Walls_RAW.geojson`,`${n}/${_}_Walls_RAW.geojson`,`${n}/${_}_-_Map_Export_Walls.geojson`,`${n}/${_}_Walls.geojson`],w=await dd(o);let I=k3(w);if(!I?.features?.length)return;console.log("[walls] loaded features",I.features.length);function R(ae,fe=20){let J=0;const ne=me=>{if(!me||J>=fe)return!0;if(typeof me[0]=="number"&&typeof me[1]=="number"){const ue=me[0],ke=me[1];return J+=1,Math.abs(ue)<=180&&Math.abs(ke)<=90}for(const ue of me)if(!ne(ue))return!1;return!0};for(const me of ae?.features||[]){if(!ne(me?.geometry?.coordinates))return!1;if(J>=fe)break}return J>0}c&&!R(I)?(I=$8(I,c),console.log("[walls] applied affine")):c&&console.log("[walls] skipped affine (already lon/lat)"),I=GU(I,u,m,{adjustBearings:!1});const k="walls-source",ie="walls-layer";t.getSource(k)?t.getSource(k).setData(I):t.addSource(k,{type:"geojson",data:I});try{const ae=Lu(I);console.log("[walls] bbox",ae)}catch{console.log("[walls] first coord",I.features?.[0]?.geometry?.coordinates?.[0]?.[0])}if(!t.getLayer(ie)){const ae=t.getLayer(jo)?jo:void 0;t.addLayer({id:ie,type:"line",source:k,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#000","line-width":["interpolate",["linear"],["zoom"],16,.15,18,.25,20,.45],"line-opacity":.25}},ae)}}async function YU({basePath:n,floorId:e,map:t,affine:i,rotationOverride:c,fitTransform:u,roomsFC:m,buildingLabel:_}){}function FA(n,e){if(!e||!Array.isArray(n)||n.length<2)return n;const t=Number(e.target_lon??e.targetLon),i=Number(e.target_lat??e.targetLat),c=Number(e.rotation_deg_cw??e.rotation_deg??0),u=Number(e.effective_scale_deg_per_foot??e.scale_deg_per_foot??e.scale_deg_per_ft??e.scale),m=e.anchor_feet||e.anchorFeet||e.anchor;if(!Number.isFinite(t)||!Number.isFinite(i)||!Number.isFinite(u)||!Array.isArray(m))return n;const _=u,o=_/Math.max(1e-9,Math.cos(i*Math.PI/180)),[w,I]=n,R=(w-t)/o,V=(I-i)/_,k=c*Math.PI/180,ie=Math.cos(k),ae=Math.sin(k),[fe,J]=m;return[ie*R+ae*V+fe,-ae*R+ie*V+J]}function zy(n,e,t){if(!Array.isArray(n)||n.length<2)return n;const[i,c]=n,[u,m]=e||[0,0],_=t*Math.PI/180,o=Math.cos(_),w=Math.sin(_),I=i-u,R=c-m;return[u+o*I-w*R,m+w*I+o*R]}function Of(n,e){return n&&(typeof n[0]=="number"?e(n):n.map(t=>Of(t,e)))}function jm(n){let e=1/0,t=1/0,i=-1/0,c=-1/0;return n.forEach(([u,m])=>{!Number.isFinite(u)||!Number.isFinite(m)||(u<e&&(e=u),m<t&&(t=m),u>i&&(i=u),m>c&&(c=m))}),{minx:e,miny:t,maxx:i,maxy:c,spanX:i-e,spanY:c-t,cx:(e+i)/2,cy:(t+c)/2}}function JU({buildingLabel:n,floorId:e,floorBasePath:t}={}){if(Na(e||"")!=="basement")return!1;if(t&&String(t).includes("/Calvin French Chapel/"))return!0;const c=Xr(n);return c&&[Xr("Calvin French Chapel"),Xr("Calvin H. French Chapel"),Xr("Calvin H. French Memorial Chapel")].includes(c)}function OA({buildingLabel:n,floorId:e,floorBasePath:t}={}){if(Na(e||"")!=="level_3")return!1;if(t&&(()=>{try{return decodeURIComponent(String(t))}catch{return String(t)}})().includes("/Babcock Hall/"))return!0;const c=Xr(n);return c&&[Xr("Babcock Hall"),Xr("Babcock Hall Residence")].includes(c)}function BA(n){let e=0,t=0,i=0;const c=u=>{if(Array.isArray(u)){if(u.length>=2&&typeof u[0]=="number"&&typeof u[1]=="number"){e+=u[0],t+=u[1],i+=1;return}u.forEach(c)}};return(n||[]).forEach(u=>{u?.geometry?.coordinates&&c(u.geometry.coordinates)}),i?[e/i,t/i]:null}function zA(n,e,t){if(!n?.features?.length||n.__mfBabcockL3AutoRotated)return n;const i=90*Math.PI/180,c=Math.cos(i),u=Math.sin(i),m=o=>{const w=o[0],I=o[1];return[w*c-I*u,w*u+I*c]},_=n.features.map(o=>!Mh(o?.properties||{})||!o?.geometry?o:{...o,geometry:{...o.geometry,coordinates:Of(o.geometry.coordinates,m)}});return{...n,features:_,__mfBabcockL3AutoRotated:!0}}function QU(n,e,t){if(!n?.features?.length||n.__mfBasementFixed)return n;const i=n.features.filter(xe=>Mh(xe?.properties||{})),c=n.features.filter(xe=>!Mh(xe?.properties||{}));if(i.length&&c.length){const xe={type:"FeatureCollection",features:i},le={type:"FeatureCollection",features:c},Ne=fm(xe,1200)||xe,Oe=fm(le,1200)||le,Je=i0(Ne,2e3),rt=i0(Oe,2e3),mt=jm(Je),dt=jm(rt),Dt=BA(i)||(mt?[mt.cx,mt.cy]:null),tn=BA(c)||(dt?[dt.cx,dt.cy]:null);if(mt&&dt&&Dt&&tn){const ln=Math.max(dt.spanX||0,dt.spanY||0,1e-9);if(Math.hypot(Dt[0]-tn[0],Dt[1]-tn[1])>ln*.18){const Gt=c0(Ne?.geometry)??0,st=c0(Oe?.geometry)??0,fr=lv(st-Gt),br=mt.spanX?dt.spanX/mt.spanX:1,Tr=mt.spanY?dt.spanY/mt.spanY:1;let Cn=1;Number.isFinite(br)&&Number.isFinite(Tr)&&br>0&&Tr>0&&(Cn=Math.min(br,Tr)),Cn=Math.max(.2,Math.min(5,Cn||1));const ir=fr*Math.PI/180,Jn=Math.cos(ir),Hr=Math.sin(ir),[Vt,Ln]=Dt,[$n,Dn]=tn,Mr=Er=>{const Cr=Er[0]-Vt,Si=Er[1]-Ln,Li=(Cr*Jn-Si*Hr)*Cn,or=(Cr*Hr+Si*Jn)*Cn;return[$n+Li,Dn+or]},xr=n.features.map(Er=>!Mh(Er?.properties||{})||!Er?.geometry?Er:{...Er,geometry:{...Er.geometry,coordinates:Of(Er.geometry.coordinates,Mr)}}),Sr={...n,features:xr};return Sr.__mfBasementFixed=!0,Sr}}}if(!e||!t)return n;const u=n.features.map((xe,le)=>{const Ne=xe?.geometry?.coordinates;if(!Ne)return null;const Oe=Od({coordinates:Ne},1e3);if(!Oe.length)return null;const Je=Oe.reduce((mt,dt)=>mt+dt[0],0)/Oe.length,rt=Oe.reduce((mt,dt)=>mt+dt[1],0)/Oe.length;return{i:le,c:[Je,rt]}}).filter(Boolean);if(u.length<6)return n;const m=u.map(xe=>xe.c[0]).sort((xe,le)=>xe-le),_=m[Math.floor(m.length/2)],o=new Set(u.filter(xe=>xe.c[0]<=_).map(xe=>xe.i));if(!o.size||o.size===n.features.length)return n;const w={type:"FeatureCollection",features:n.features.filter((xe,le)=>o.has(le))},I=fm(w,1200),R=c0(t?.geometry)??0,V=c0(I?.geometry)??0,k=Number.isFinite(R)&&Number.isFinite(V)?R-V:0,ie=xc(t)?.geometry?.coordinates||null;if(!ie)return n;const ae=xe=>zy(xe,ie,-R),fe=xe=>zy(xe,ie,R),J={type:"Feature",properties:{},geometry:{...t.geometry,coordinates:Of(t.geometry.coordinates,ae)}},ne=i0(J,4e3),me=jm(ne);if(!Number.isFinite(me.cx))return n;const ue=me.cx,ke=v3([[[ue-10,me.miny-10],[ue,me.miny-10],[ue,me.maxy+10],[ue-10,me.maxy+10],[ue-10,me.miny-10]]]),ze=w8(x3([J,ke]));if(!ze?.geometry)return n;const pe={type:"Feature",geometry:{...ze.geometry,coordinates:Of(ze.geometry.coordinates,fe)}},U=i0(pe,4e3),F=jm(U);if(!Number.isFinite(F.minx))return n;const q=jm([FA([F.minx,F.miny],e),FA([F.maxx,F.maxy],e)]),j=i0(w,4e3),H=jm(j),Z=[H.cx,H.cy],be=j.map(xe=>zy(xe,Z,k)),Me=jm(be);if(!Number.isFinite(Me.spanX)||!Number.isFinite(Me.spanY))return n;const Be=Math.min(q.spanX/Math.max(1e-9,Me.spanX),q.spanY/Math.max(1e-9,Me.spanY)),Re=[q.cx-Me.cx,q.cy-Me.cy],we=xe=>{const le=zy(xe,Z,k),Ne=[(le[0]-Me.cx)*Be+Me.cx,(le[1]-Me.cy)*Be+Me.cy];return[Ne[0]+Re[0],Ne[1]+Re[1]]},De=n.features.map((xe,le)=>!o.has(le)||!xe?.geometry?.coordinates?xe:{...xe,geometry:{...xe.geometry,coordinates:Of(xe.geometry.coordinates,we)}}),nt={...n,features:De};return nt.__mfBasementFixed=!0,nt}async function eV({basePath:n,floorId:e,map:t,affine:i,rotationOverride:c,fitTransform:u}){}let e5=0;function H8(n){if(!n||/^https?:\/\//i.test(n))return n;const e=T8();if(!e)return n;const t=e.replace(/\/$/,""),i=n.startsWith("/")?n:`/${n}`,c=i.startsWith("/ai/")?i.replace(/^\/ai/,""):i;return`${t}${c}`}async function Kd(n,e={}){const t=Date.now();if(t<e5)throw new Error(`Rate limited. Try again in ${Math.ceil((e5-t)/1e3)}s`);const i=Number(e.timeoutMs),c=Number.isFinite(i)&&i>0?new AbortController:null,u={...e};c&&(u.signal=c.signal),delete u.timeoutMs;let m=null;c&&(m=setTimeout(()=>c.abort(),i));let _;try{_=await fetch(H8(n),u)}finally{m&&clearTimeout(m)}if(_.status===429)throw e5=Date.now()+6e4,new Error("Rate limited (429). AI paused for 60 seconds.");return _}async function jA(n,e=tw){if(!n)return[];const t=k=>String(k||"").trim().toLowerCase().replace(/[^a-z0-9]/g,""),i=(k=[])=>{const ie=Array.isArray(k)?k:k?[k]:[];return ie.length?ie.map(ae=>{if(typeof ae=="string")return{id:ae,url:null};if(!ae)return null;const fe=a0(ae.id||ae.floorId||ae.name||ae.label),J=ae.url||ae.path||null;return fe?{id:fe,url:J}:null}).filter(Boolean):[]},c=encodeURIComponent(e),u=encodeURIComponent(n),m=Jd(`floorplans/${c}/${u}/manifest.json`),_=await p_(m),w=(await p_(iv))?.floorsByBuilding||{};let I=w[n];if(!I){const k=Object.keys(w).find(ie=>t(ie)===t(n));I=k?w[k]:null}const R=i(I||[]),V=i(_?.floors);if(!V.length)return R;if(R.length&&V.some(k=>!k.url)){const k=new Map(R.filter(ie=>ie?.id&&ie?.url).map(ie=>[ie.id,ie.url]));return V.map(ie=>({...ie,url:ie.url||k.get(ie.id)||null}))}return V}const tV=()=>{if(typeof window>"u")return"";const n=String(window.__MAPBOX_PUBLIC_TOKEN__??"").trim();if(n)return n;try{const e=String(window.localStorage?.getItem("MAPBOX_PUBLIC_TOKEN")??"").trim();if(e)return e}catch{}return""};Rd.accessToken=tV();console.log("Mapbox token length:",(Rd.accessToken||"").length);const da="floor-source",jo="floor-fill",Dd="floor-line",Sp="floor-drawing",Bf="floor-highlight",cg="floor-highlight-border",gh="floor-room-labels",Ov="floor-doors",Bv="floor-stairs",Um="engagement-heat-source",Xd="engagement-heat-warm-halo-layer",Zd="engagement-heat-cool-halo-layer",zv="walls-source",P0="walls-layer",UA="doors-source",VA="stairs-source",jv="doors-layer",Uv="stairs-layer",gs=new Map,Wu=new Map,t5=new Map,nV=n=>n?/^https?:\/\//i.test(n)||n.startsWith(j8)?n:Jd(String(n).replace(/^\//,"")):null;async function rV(n){const e=nV(n);if(!e)return[];if(t5.has(e))return t5.get(e);const t=await p_(e),i=Array.isArray(t?.features)?t.features:[];return t5.set(e,i),i}async function iV(n,e,t){const i=[],c=[...n],u=Math.max(1,Number(e)||1),m=Array.from({length:u},async()=>{for(;c.length;){const _=c.shift();try{i.push(await t(_))}catch(o){console.warn("dashboard fetch failed",_,o)}}});return await Promise.all(m),i}function qA(n){if(!n)return;const e="buildings-fill";if(n.getLayer(e))try{n.setPaintProperty(e,"fill-color",hd("#ffffff")),n.setPaintProperty(e,"fill-opacity",1),n.setPaintProperty(e,"fill-outline-color","#cbd5e1")}catch{}}const oV={"fill-color":"#e6e6e6","fill-opacity":1};function rw(n,e="department",t={}){if(!n||!n.getLayer(jo))return;const i=[">",["length",["coalesce",["to-string",["get","occupant"]],["to-string",["get","Occupant"]],""]],0],u=["upcase",["to-string",["coalesce",["get","occupancyStatus"],["get","Occupancy Status"],["get","OccupancyStatus"],["get","Occupancy"],["get","Vacancy"],["get","vacancy"],["get","Vacant"],""]]],_=["in",["upcase",["to-string",["coalesce",["get","__roomType"],["get","NCES_Type"],["get","RoomType"],["get","Room Type"],["get","Type"],["get","type"],["get","Name"],""]]],["literal",WV]],R=["case",[">",["length",u],0],["case",["any",[">=",["index-of","VACANT",u],0],[">=",["index-of","UNOCCUPIED",u],0],[">=",["index-of","AVAILABLE",u],0],[">=",["index-of","UNASSIGNED",u],0]],"Vacant",[">=",["index-of","OCCUPIED",u],0],"Occupied","Unknown"],i,"Occupied","Unknown"],V=["case",_,["match",R,"Occupied","#29b6f6","Vacant","#ff7043","Unknown","#e0e0e0","#e0e0e0"],"#e6e6e6"],k=["case",_,["match",R,"Vacant","#ff7043","Occupied","#cfd8dc","Unknown","#cfd8dc","#cfd8dc"],"#e6e6e6"];try{e==="occupancy"?n.setPaintProperty(jo,"fill-color",V):e==="vacancy"?n.setPaintProperty(jo,"fill-color",k):n.setPaintProperty(jo,"fill-color",mU()),n.setPaintProperty(jo,"fill-opacity",1)}catch{}}function sV(n){if(!(!n||n.getLayer(Bf)))try{n.addLayer({id:Bf,type:"fill",source:da,paint:{"fill-color":"rgba(0,255,255,0.4)","fill-outline-color":"#00ffff"},filter:["==",["id"],-1]},jo),n.addLayer({id:cg,type:"line",source:da,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#00ffff","line-width":6,"line-opacity":1,"line-gap-width":0},filter:["==",["id"],-1]})}catch{}}async function $A(n,e,t){if(!n||!e||!t)return;try{if(n.hasImage(e))return}catch{}const i=await new Promise((c,u)=>{n.loadImage(t,(m,_)=>m?u(m):c(_))});try{n.addImage(e,i,{sdf:!0})}catch(c){console.warn("addImage failed for",e,c)}}function aV(n){if(n)try{n.getLayer(P0)&&n.getLayer(jo)&&n.moveLayer(P0,jo),n.getLayer(Dd)&&n.getLayer(jo)&&n.moveLayer(Dd),n.getLayer(Sp)&&(n.getLayer(gh)?n.moveLayer(Sp,gh):n.moveLayer(Sp)),n.getLayer(jv)&&n.moveLayer(jv),n.getLayer(Uv)&&n.moveLayer(Uv)}catch{}}function GA(n=[],e=[]){const t=[];return n.length&&t.push(["in",["id"],["literal",n]]),e.length&&t.push(["in",["get","RevitId"],["literal",e]]),t.length?t.length===1?t[0]:["any",...t]:["==",["id"],""]}async function dd(n){const e=Array.isArray(n)?n.filter(Boolean):[n].filter(Boolean);if(!e.length)return null;const t=await G8(e);return t.ok?t.data:(console.debug("GeoJSON fetch failed",{tried:e,lastUrl:t.url,error:t.error}),null)}function lV(n){try{if(!n?.features?.length)return!1;const e=Lu(n);if(!e||e.some(o=>!Number.isFinite(o)))return!1;const[t,i,c,u]=e;if(t<-180||c>180||i<-90||u>90)return!1;const m=Math.abs(c-t),_=Math.abs(u-i);return m<=.25&&_<=.25}catch{return!1}}async function cV(n,e,t,i,c={}){if(!n||!e)return;const{buildingId:u,floor:m,roomPatches:_,onOptionsCollected:o,currentFloorContextRef:w,airtableLookup:I}=c,R=c?.roomsBasePath||c?.wallsBasePath,V=c?.roomsFloorId||c?.wallsFloorId||m||null;let k=i?.fitBuilding||null;if(!k&&u&&(k=sv(n,u)),!k&&R){const Vt=Fd(R);Vt&&(k=sv(n,Vt))}if(!k&&R){const Vt=await o5();if(Vt?.features?.length){const Ln=Fd(R),$n=u0?.[Ln]||Ln;k=If(Vt.features,u)||If(Vt.features,$n)||If(Vt.features,Ln)||null}}if(!k&&R){const Vt=Fd(R),Ln=u0?.[Vt]||Vt,Dn=Xr(u||Ln);Dn&&sw.has(Dn)&&(k=sv(n,Ln))}let ie=e_(k);const ae=k?.properties?.id||k?.properties?.name||u||"",fe=Dv({buildingLabel:ae,buildingId:u,floorBasePath:R,fitBuilding:k}),J=NU({buildingLabel:ae,buildingId:u,floorBasePath:R,fitBuilding:k}),ne=SV({buildingLabel:ae}),me=UV(ae||u||"",V||m||"")||0,ue=R&&V?By(R,V):null,ke=Oy(e),ze=Wm(J,V||m),U=ew({base:ue,url:ke,label:ze}).adjust,F=me;let q=null,j=null,H=gs.get(e);const Z=z8(fe,V||m),be=B8(Z);if(H&&qV(ae||u||"",V||m||"")&&(gs.delete(e),Wu.delete(e),H=null),H&&ie&&(H.__mfTransformed||H.__mfFitted||H.__mfFitTransform)&&(gs.delete(e),H=null),H&&Number.isFinite(F)&&H.__mfPostRotation!==F&&(gs.delete(e),Wu.delete(e),H=null),H&&R&&V&&!ne){const Vt=await r0(R,V),Ln=N8(Vt);Ln&&H.__mfAffineSignature&&H.__mfAffineSignature!==Ln||Ln&&H.__mfAffineApplied&&!H.__mfAffineSignature?(gs.delete(e),Wu.delete(e),H=null):q=Vt}if(H&&!q&&!ne&&V){const Vt=Qb(e);Vt&&(q=await r0(Vt,V))}if(H&&(H.__mfDrawingAlignSignature||be)&&H.__mfDrawingAlignSignature!==be&&(gs.delete(e),Wu.delete(e),H=null),H){const Vt=Fv(U);(Vt&&H.__mfUserAdjustSignature&&H.__mfUserAdjustSignature!==Vt||Vt&&H.__mfTransformed&&!H.__mfUserAdjustSignature)&&(gs.delete(e),Wu.delete(e),H=null)}if(!H){if(R&&V){const Vt=await KU({basePath:R,floorId:V,skipAffine:ne});if(!Vt.rawFC){console.warn("Floor summary: no data returned",`${R}/${V}_Dept.geojson`);return}if(H=Vt.rawFC,q=Vt.affine,!ne&&!q){const Ln=Qb(e);Ln&&(q=await r0(Ln,V))}if(ne&&(q=null),JU({buildingLabel:u,floorId:V,floorBasePath:R})){const Ln=QU(Vt.rawFC,q,k);j=ov(Ln,q)}else if(OA({buildingLabel:u,floorId:V,floorBasePath:R})){const Ln=zA(Vt.rawFC);j=ov(Ln,q)}else j=Vt.patchedFC}else if(H=await dd(e),!H)return;gs.set(e,H)}if(!j){if(j=k3(H)||Tu(H),!j?.features?.length)return;if(!ne&&!q&&V&&(R&&(q=await r0(R,V)),!q)){const Vt=Qb(e);Vt&&(q=await r0(Vt,V))}OA({buildingLabel:u,floorId:V,floorBasePath:R})&&(j=zA(j)),j=ov(j,q)}Z&&(j=RU(j,Z)),j=zU(j,{buildingLabel:ae||u||"",floorId:V||m||""}),j=BU(j),j=TU(j);const Me=ae||k?.properties?.id||k?.properties?.name||u||"";if(GV(Me,V||m||"")&&(j.__mfNoFit=!0),!k&&R){const Vt=await o5();if(Vt?.features?.length){const Ln=Fd(R),$n=u0?.[Ln]||Ln;k=If(Vt.features,u)||If(Vt.features,$n)||If(Vt.features,Ln)||null,ie=e_(k)}}if(!k&&R){const Vt=Fd(R),Ln=u0?.[Vt]||Vt,Dn=Xr(u||Ln);if(Dn&&sw.has(Dn)){const Mr=await o5();Mr?.features?.length&&(k=If(Mr.features,Ln)||If(Mr.features,Vt)||null,ie=e_(k))}}const Re=Number.isFinite(i?.rotationOverrideDeg)?i.rotationOverrideDeg:null,we=Wu.get(e)||{};ie&&delete we.fitTransform;let De=null;if(Re!=null){const Vt=we.rotationPivot||xc(j)?.geometry?.coordinates||null;De=Vt?{deg:Re,pivot:Vt}:{deg:Re},!we.rotationPivot&&Vt&&(we.rotationPivot=Vt,Wu.set(e,we));const Ln=V8(j,Re,Vt);Ln&&Ln!==j&&(j=Ln,ie||gs.set(e,j))}j.features.forEach((Vt,Ln)=>{Vt&&Vt.id==null&&(Vt.id=Vt.properties?.RevitId??Ln)});const nt=[],xe=[],le=[],Ne=[];j.features.forEach(Vt=>{if(!Vt)return;const Ln=Vt.id??Vt.properties?.RevitId??Vt.properties?.id;if(Ln==null)return;const $n=v0(Vt.properties);$n==="door"?(nt.push(Ln),Vt.properties?.RevitId!=null&&xe.push(Vt.properties.RevitId)):$n==="stair"&&(le.push(Ln),Vt.properties?.RevitId!=null&&Ne.push(Vt.properties.RevitId))});const Oe=(Vt,Ln)=>{if(!Vt)return;const $n=Ln?.features;if(!(!Array.isArray($n)||$n.length===0))try{const Dn=selectedBuildingIdRef.current||selectedBuilding||i?.fitBuilding?.properties?.id,Mr=i?.floorLabel||$n[0]?.properties?.Floor||e?.match(/(BASEMENT|LEVEL_\\d+|LEVEL|L\\d+)/)?.[0]||"LEVEL_1";if(Dn){const Sr={...floorStatsByBuildingRef.current[Dn]||{},[Mr]:Vt};floorStatsByBuildingRef.current[Dn]=Sr,setFloorStatsByBuilding({...floorStatsByBuildingRef.current})}panelBuildingKeyRef.current&&panelBuildingKeyRef.current===Dn&&setPanelStats(xr=>({...xr||{},floor:Vt}))}catch{}};let Je=PA(j);Oe(Je,j);const rt=jU(j),mt=rt&&rt!==j?rt:j;let dt=j?.__mfFitTransform||we.fitTransform||null;try{if(k&&LV(mt,k)){const Vt=_V(mt,k);if(Vt?.features?.length){if(dt=Vt.__mfFitTransform||null,mt!==j&&dt){const Ln=q8(j,dt);Ln?.features?.length&&(j.__mfAffineApplied&&(Ln.__mfAffineApplied=j.__mfAffineApplied),j.__mfRotationOverride!=null&&(Ln.__mfRotationOverride=j.__mfRotationOverride),j.__mfRotationPivot&&(Ln.__mfRotationPivot=j.__mfRotationPivot),Ln.__mfFitted=!0,Ln.__mfFittedBuilding=Vt.__mfFittedBuilding||"",Ln.__mfFitTransform=dt,j=Ln)}else j=Vt;H.__mfTransformed=!0,ie||gs.set(e,j)}}}catch{}const Dt=jV(ae||u||"",V||m||"");if(Number.isFinite(Dt)&&Math.abs(Dt-1)>.001){const Vt=dt?.scaleOrigin||xc(j)?.geometry?.coordinates||null;Vt&&(j=L0(j,Dt,{origin:Vt}),dt=dt||{rotationDeg:0,rotationPivot:null,scale:1,scaleOrigin:Vt,translateKm:0,translateBearing:0,nudgeMeters:null,refineRotationDeg:0,refineRotationPivot:null},dt.scale=(Number.isFinite(dt.scale)?dt.scale:1)*Dt,dt.scaleOrigin=Vt,H.__mfTransformed=!0,ie||gs.set(e,j))}if(Number.isFinite(F)&&Math.abs(F)>.001){const Vt=dt?.scaleOrigin||dt?.rotationPivot||xc(k||j)?.geometry?.coordinates||null;Vt&&(j=Zh(j,F,{pivot:Vt}),dt=dt||{rotationDeg:0,rotationPivot:null,scale:1,scaleOrigin:Vt,translateKm:0,translateBearing:0,nudgeMeters:null,refineRotationDeg:0,refineRotationPivot:null},dt.refineRotationDeg=(Number.isFinite(dt.refineRotationDeg)?dt.refineRotationDeg:0)+F,dt.refineRotationPivot=Vt,H.__mfTransformed=!0,H.__mfPostRotation=F,ie||gs.set(e,j))}const tn=dt?.scaleOrigin||dt?.rotationPivot||xc(j)?.geometry?.coordinates||null;if(U&&mp(U)){const Ln=DU(j,U,dt);Ln?.fc&&Ln.fc!==j&&(j=Ln.fc,dt=Ln.fitTransform||dt,H.__mfTransformed=!0,ie||gs.set(e,j))}dt&&(we.fitTransform=dt,Wu.set(e,we)),j&&Array.isArray(j.features)&&w&&typeof w=="object"&&(w.current={url:e,buildingId:u,floor:m,fc:j,floorAdjustLabel:J,floorAdjustFloorId:V||m||"",floorAdjustBasePath:R||null,floorAdjustBasePivot:tn||null});let ln=j,yn=[];const Mn=u&&m&&_ instanceof Map,Gt=!!I;if(Mn||Gt){const Vt=(j.features||[]).map(Ln=>{const $n=Ln.properties||{};let Dn=$n;if(Gt&&v0($n)==="room"){const xr=sC($n,I,u,m);xr&&(Dn=qv(Dn,xr))}if(Mn){const xr=Ln.id??$n.RevitId??$n.id,Sr=Yd(u,m,xr),Er=_.get(Sr);Er&&(Dn=qv(Dn,Er))}const Mr=pd(Dn);return{...Ln,properties:{...Dn,__roomType:Mr?String(Mr).trim():Dn.__roomType||""}}});if(ln={...j,features:Vt},typeof o=="function"){const{typeOptions:Ln,deptOptions:$n}=EU(Vt);o({typeOptions:Ln,deptOptions:$n})}}w&&typeof w=="object"&&(w.current={...w.current||{},buildingId:u,floor:V||m||"",fc:ln}),Array.isArray(ln?.features)&&(yn=ln.features.map(Vt=>{const Ln=Vt?.properties??{},$n=Vt?.id??Ln.RevitId??Ln.id,Dn=u&&m&&$n!=null?Yd(u,m,$n):null,Mr=_ instanceof Map&&Dn&&_.get(Dn)||null;return{geo:{...Ln},db:Mr?{...Mr}:null,roomId:Dn||String($n??"")}}));const st=Array.isArray(ln?.features)&&ln.features.length?PA(ln):null;st&&(Je=st),Oe(Je,ln),lC(n);const fr=Gu(n,da);if(fr?fr.setData(ln):n.addSource(da,{type:"geojson",data:ln,promoteId:"RevitId"}),!n.getLayer(jo))n.addLayer({id:jo,type:"fill",source:da,paint:oV,filter:l0});else try{n.setFilter(jo,l0)}catch{}if(rw(n),sV(n),!$V(ae||u||"",V||m||"")&&Array.isArray(ln?.features)&&ln.features.some(Vt=>Vt?.properties?.interactive===!1||Vt?.properties?.type==="drawing")){const Vt=["downcase",["to-string",["coalesce",["get","Layer"],["get","layer"],["get","FeatureClass"],["get","featureClass"],["get","type"],["get","Type"]]]],$n=["all",["==",["get","interactive"],!1],["!",["any",[">=",["index-of","grid",Vt],0],[">=",["index-of","area-bndy",Vt],0],[">=",["index-of","area bndy",Vt],0]]]];if(!n.getLayer(Sp))n.addLayer({id:Sp,type:"line",source:da,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#2f2f2f","line-width":["interpolate",["linear"],["zoom"],16,.15,18,.25,20,.45],"line-opacity":.6},filter:$n});else try{n.setFilter(Sp,$n)}catch{}}if(!n.getLayer(Dd))n.addLayer({id:Dd,type:"line",source:da,paint:{"line-color":"#444","line-width":["interpolate",["linear"],["zoom"],16,.4,18,.8,20,1.2],"line-opacity":.7},filter:l0});else try{n.setFilter(Dd,l0)}catch{}if(cC(n),c?.enableWalls&&c?.wallsBasePath){const Vt=c.wallsFloorId||m||e?.match(/(BASEMENT|LEVEL_\d+|LEVEL|L\d+)/)?.[0]||null;await ZU({basePath:c.wallsBasePath,floorId:Vt,map:n,roomsFC:ln,affine:q,rotationOverride:De,fitTransform:dt});try{n.setPaintProperty(jo,"fill-opacity",.25)}catch{}}const Cn=c?.roomsBasePath||c?.wallsBasePath,ir=u||i?.fitBuilding?.properties?.id||i?.fitBuilding?.properties?.name||null;if(Cn){const Vt=c?.roomsFloorId||c?.wallsFloorId||m||e?.match(/(BASEMENT|LEVEL_\d+|LEVEL|L\d+)/)?.[0]||null;Vt&&(await YU({basePath:Cn,floorId:Vt,map:n,affine:q,rotationOverride:De,fitTransform:dt||we.fitTransform||null,roomsFC:ln,buildingLabel:ir}),await eV({basePath:Cn,floorId:Vt,map:n,affine:q,rotationOverride:De,fitTransform:dt||we.fitTransform||null}))}aV(n);const Jn=GA(nt,xe),Hr=GA(le,Ne);try{n.getLayer(Ov)&&n.setFilter(Ov,Jn),n.getLayer(Bv)&&n.setFilter(Bv,Hr)}catch{}try{n.getLayer(Bf)&&n.getLayer(Dd)&&n.moveLayer(Bf,Dd)}catch{}if(t!=null&&n.getLayer(Bf)){const Vt=Array.isArray(t)?t.filter($n=>$n!=null):[t],Ln=Vt.length?["any",["in",["id"],["literal",Vt]],["in",["get","RevitId"],["literal",Vt]]]:["==",["id"],""];n.setFilter(Bf,Ln),n.getLayer(cg)&&n.setFilter(cg,Ln)}try{const Vt=Lu(j);Vt&&isFinite(Vt[0])&&n.fitBounds([[Vt[0],Vt[1]],[Vt[2],Vt[3]]],{padding:40,duration:400})}catch{}return{summary:Je,rooms:yn}}function Tu(n){return n?n.type==="FeatureCollection"?n:n.type==="Feature"?{type:"FeatureCollection",features:[n]}:n.type==="GeometryCollection"?{type:"FeatureCollection",features:(n.geometries||[]).map(e=>({type:"Feature",geometry:e,properties:{}}))}:n.type&&n.coordinates?{type:"FeatureCollection",features:[{type:"Feature",geometry:n,properties:{}}]}:null:null}function uV(n){if(n==null)return 0;if(typeof n=="number")return n;const e=Number(String(n).replace(/,/g,""));return Number.isFinite(e)?e:0}function kf(n={}){if(Number.isFinite(n.areaSF))return Number(n.areaSF);const e=n.Area_SF??n.Area??n["Area SF"];return e==null||e===""?null:uV(e)}function av(){return{totalSf:0,rooms:0,classroomSf:0,classroomCount:0,labSf:0,labCount:0,officeSf:0,officeCount:0,deptCounts:new Map}}function hV(n={}){const e=L8(n)||"",t=String(e).trim().charAt(0),i=qf(n,["NCES_Type","NCES Type","NCES_Type_Code","NCES Type Code"]),c=String(i||"").trim().charAt(0),u=k8(n),m=(u?.norm||"").toLowerCase(),_=m.includes("classroom")||m.includes("lecture")||t==="1"||c==="1",o=m.includes("lab")||m.includes("laboratory")||m.includes("studio")||t==="2"||c==="2",w=u?.isOfficeText||P8(e);return _?"classroom":o?"lab":w?"office":"other"}function iw(n,e={}){if(!n)return;const t=kf(e),i=Number.isFinite(t)?t:0;n.totalSf+=i,n.rooms+=1;const c=hV(e);c==="classroom"?(n.classroomSf+=i,n.classroomCount+=1):c==="lab"?(n.labSf+=i,n.labCount+=1):c==="office"&&(n.officeSf+=i,n.officeCount+=1);const u=na(Ky(e));u&&n.deptCounts.set(u,(n.deptCounts.get(u)||0)+i)}function R3(n=[]){const e=av();return n.forEach(t=>iw(e,t?.properties)),jy(e)}function jy(n){if(!n)return null;const t=Array.from((n.deptCounts||new Map).entries()).sort((c,u)=>u[1]-c[1]),i=Object.fromEntries(t);return{totalSf:n.totalSf||0,classroomSf:n.classroomSf||0,labSf:n.labSf||0,officeSf:n.officeSf||0,rooms:n.rooms||0,classroomCount:n.classroomCount||0,labCount:n.labCount||0,officeCount:n.officeCount||0,deptCounts:i,totalsByDept:i,keyDepts:t.slice(0,6).map(([c])=>c)}}function dV(n){const e=String(n||"").trim();if(!e||O3(e))return!1;const t=e.toUpperCase();return t!=="UNSPECIFIED"&&t!=="UNKNOWN"&&t!=="N/A"&&t!=="NA"}function em(n){const t=Object.entries(n||{}).filter(([i])=>dV(i));return Object.fromEntries(t)}function Xg(n=[]){const e=(n||[]).map(aC).filter(Boolean);if(!e.length)return null;const t=R3(e);if(!t)return null;const i=em(t.totalsByDept||t.deptCounts||{}),c=Object.entries(i).sort((u,m)=>(m[1]||0)-(u[1]||0));return{...t,deptCounts:i,totalsByDept:i,keyDepts:c.slice(0,6).map(([u])=>u)}}function fV(n=[]){const e=R3(n);if(!e)return null;const t=em(e.totalsByDept||e.deptCounts||{}),i=Object.entries(t).sort((c,u)=>(u[1]||0)-(c[1]||0));return{...e,deptCounts:t,totalsByDept:t,keyDepts:i.slice(0,6).map(([c])=>c)}}function pV(n,e){const t=(e||"").trim().toLowerCase();if(!t||!Array.isArray(n))return null;let i=0,c=0;const u={},m={};for(const _ of n){const o=_?.properties||{};if(String(Ky(o)||"").trim().toLowerCase()!==t)continue;const I=pd(o)||"Unspecified",R=kf(o),V=Number.isFinite(R)?R:Number(o.sf??o.SF??o.AreaSF??o.Area??o.area??o.areaSF??o["Area SF"]??0)||0;c+=1,i+=V,u[I]=(u[I]||0)+1,m[I]=(m[I]||0)+V}return{totalSF:i,rooms:c,roomTypes:u,sfByRoomType:m}}function n5(n,e=1200){return Array.isArray(n)?n.slice(0,e).map((i,c)=>{const u=String(i.buildingName??i.buildingLabel??i.building??"").trim(),m=String(i.floor??i.floorId??"").trim(),_=String(i.roomNumber??i.roomLabel??i.name??"").trim(),o=String(i.roomId??i.revitId??i.id??"").trim(),w=i.roomGuid??i.roomGUID??i.revitUniqueId??i.revitUniqueID??i["Room GUID"]??null,I=[u,m,_].filter(Boolean).join("|")||`room-${c}`,R=o||I,V=String(i.occupant??"").trim(),k=String(i.vacancy??(V?"Occupied":"Unknown")).trim();return{id:R,revitId:i.revitId??w??null,roomGuid:w,roomId:o||I,buildingLabel:u,floorId:m,floorName:m,roomLabel:_,type:String(i.type??i.roomType??"").trim(),sf:Number(i.sf??i.areaSF??i.area??0)||0,department:String(i.department??"").trim(),occupant:V,vacancy:k,occupancyStatus:V?"Occupied":"Vacant",occupantDept:String(i.department??"").trim()||null}}).filter(i=>i.id):null}function W8(n){return Array.isArray(n)?n.map(e=>({id:e?.id??e?.roomId??"",roomId:e?.roomId??e?.id??"",revitId:e?.revitId??e?.roomGuid??null,buildingLabel:e?.buildingLabel??e?.buildingName??e?.building??"",floorId:e?.floorId??e?.floorName??"",floorName:e?.floorName??e?.floorId??"",roomLabel:e?.roomLabel??e?.roomNumber??"",type:e?.type??e?.roomType??"",sf:Number(e?.sf??e?.area??e?.areaSF??0)||0,department:e?.department??""})).filter(e=>e.id||e.roomId):[]}function K8(n,e={}){if(!Array.isArray(n)||n.length===0)return[];const t=Number.isFinite(e.maxTotal)?e.maxTotal:700,i=Number.isFinite(e.maxPerBuilding)?e.maxPerBuilding:120,c=Number.isFinite(e.maxPerType)?e.maxPerType:30,u=W8(n);if(u.length<=t)return u;const m=new Map;for(const I of u){const R=uo(I.buildingLabel||""),V=ug(I.type||"")||"other";m.has(R)||m.set(R,new Map);const k=m.get(R);k.has(V)||k.set(V,[]),k.get(V).push(I)}const _=[],o=(I,R)=>{if(!(!Array.isArray(I)||R<=0)){I.sort((V,k)=>(Number(k.sf)||0)-(Number(V.sf)||0));for(const V of I.slice(0,R))if(_.push(V),_.length>=t)return}};for(const[,I]of m.entries()){if(_.length>=t)break;let R=0;for(const V of I.values()){if(_.length>=t)break;const k=i-R;if(k<=0)break;const ie=Math.min(c,k);o(V,ie),R+=Math.min(V.length,ie)}}if(_.length>=t)return _.slice(0,t);const w=new Set(_.map(I=>I.id||I.roomId));for(const I of u){if(_.length>=t)break;const R=I.id||I.roomId;w.has(R)||(_.push(I),w.add(R))}return _.slice(0,t)}function mV(n=[]){const e={totalSF:0,rooms:0,roomTypes:{},sfByRoomType:{}};return(n||[]).forEach(t=>{const i=Number(t?.sf??0)||0,c=na(t?.type??t?.roomType??"Unknown")||"Unknown";e.rooms+=1,e.totalSF+=i,e.roomTypes[c]=(e.roomTypes[c]||0)+1,e.sfByRoomType[c]=(e.sfByRoomType[c]||0)+i}),e}function gV(n,e,t={}){if(!Array.isArray(n)||!e)return n||[];const i=Number.isFinite(t.maxTotal)?t.maxTotal:180,c=Number.isFinite(t.minPerType)?t.minPerType:4,u=Number.isFinite(t.maxPerType)?t.maxPerType:30,m=e?.sfByRoomType||{},_=e?.roomTypes||{},o=Number(e?.totalSF??0)||0,w=Number(e?.rooms??0)||0,I=Object.entries(m).map(([J,ne])=>{const me=ug(J),ue=Number(ne||0)||0,ke=Number(_[J]||0)||0;return{key:me,label:J,sf:ue,count:ke}}).filter(J=>J.key);if(!I.length)return K8(n,{maxTotal:i,maxPerBuilding:i,maxPerType:u});I.sort((J,ne)=>(ne.sf||0)-(J.sf||0));const R=new Map;I.forEach(J=>{const ne=o>0?J.sf/o:0,me=w>0?J.count/w:0,ue=Math.round(ne*i),ke=Math.round(me*i),ze=Math.max(c,ue,ke);R.set(J.key,Math.min(u,ze))});const V=new Map;n.forEach(J=>{const ne=ug(J?.type??J?.roomType??"")||"other";V.has(ne)||V.set(ne,[]),V.get(ne).push(J)}),V.forEach(J=>J.sort((ne,me)=>(Number(me.sf)||0)-(Number(ne.sf)||0)));const k=[],ie=new Set,ae=J=>{const ne=String(J?.roomId??J?.id??J?.revitId??"");!ne||ie.has(ne)||(k.push(J),ie.add(ne))};for(const J of I){if(k.length>=i)break;const ne=V.get(J.key)||[],me=R.get(J.key)||0;let ue=0;for(const ke of ne){if(k.length>=i||ue>=me)break;ae(ke),ue+=1}}if(k.length>=i)return k.slice(0,i);const fe=[];V.forEach(J=>J.forEach(ne=>{const me=String(ne?.roomId??ne?.id??ne?.revitId??"");!me||ie.has(me)||fe.push(ne)})),fe.sort((J,ne)=>(Number(ne.sf)||0)-(Number(J.sf)||0));for(const J of fe){if(k.length>=i)break;ae(J)}return k.slice(0,i)}function HA(n,e,t,i={}){if(!t||!Array.isArray(e))return{candidates:n||[],added:0};const c=Number(t.totalSF??0)||0;if(!c)return{candidates:n||[],added:0};const u=Number.isFinite(i.targetTolerance)?i.targetTolerance:.1,m=c*(1-u),_=Number.isFinite(i.maxCandidates)?i.maxCandidates:25,o=i.primaryBuilding||"",w=Array.isArray(n)?[...n]:[],I=mV(w);if(I.totalSF>=m||w.length>=_)return{candidates:w,added:0};const R=new Set(w.map(J=>String(J?.roomId??J?.id??J?.revitId??""))),V=new Map;e.forEach(J=>{const ne=String(J?.roomId??J?.id??J?.revitId??"");if(!ne||R.has(ne))return;const me=ug(J?.type??J?.roomType??"")||"other";V.has(me)||V.set(me,[]),V.get(me).push(J)}),V.forEach(J=>J.sort((ne,me)=>X8(ne,me,o)));const k=Object.entries(t.sfByRoomType||{}).map(([J,ne])=>({key:ug(J),label:J,sf:Number(ne||0)||0})).filter(J=>J.key);k.sort((J,ne)=>{const me=Vv(J.label),ue=Vv(ne.label);return me!==ue?me-ue:(ne.sf||0)-(J.sf||0)});const ie=k.map(J=>J.key);let ae=0;const fe=(J,ne)=>!J||w.length>=_?!1:(w.push({roomId:J?.roomId??J?.id??"",id:J?.id??J?.roomId??"",revitId:J?.revitId??J?.roomGuid??null,buildingLabel:J?.buildingLabel??"",floorId:J?.floorId??J?.floorName??"",floorName:J?.floorName??J?.floorId??"",roomLabel:J?.roomLabel??"",type:J?.type??"",sf:Number(J?.sf??0)||0,rationale:ne||"Added to reach baseline target."}),I.totalSF+=Number(J?.sf??0)||0,ae+=1,!0);for(const J of ie){if(I.totalSF>=m||w.length>=_)break;const ne=V.get(J)||[];for(;ne.length&&I.totalSF<m&&w.length<_;){const me=ne.shift();fe(me,"Added to better match baseline room-type mix.")}}if(I.totalSF<m&&w.length<_){const J=[];V.forEach(me=>me.forEach(ue=>J.push(ue)));const ne=Z8(J,o);for(const me of ne){if(I.totalSF>=m||w.length>=_)break;fe(me,"Added to reach baseline total SF.")}}return{candidates:w,added:ae}}function r5(n){return n&&String(n).replace(/^\s*vacant\s*[:\-]\s*/i,"").replace(/^\s*vacant\?\s*[:\-]\s*/i,"").replace(/\bvacancy status\b/ig,"availability").replace(/\bvacant\b/ig,"available")}const Vv=n=>{const e=String(n??"").toLowerCase();return e?/(office|workstation|admin|faculty|staff|suite|open office)/i.test(e)?0:/(lab|laboratory|studio|shop|clinic|research)/i.test(e)?2:/(classroom|lecture|seminar|training|teaching)/i.test(e)?3:1:1},WA=n=>/(lab|laboratory|studio|shop|clinic|research)/i.test(String(n??"")),KA=n=>/(classroom|lecture|seminar|training|teaching)/i.test(String(n??"")),XA=n=>uo(n?.buildingLabel??n?.buildingName??n?.building??""),X8=(n,e,t)=>{const i=uo(t||""),c=XA(n),u=XA(e);if(i){const I=c===i;if(I!==(u===i))return I?-1:1}const m=Number(n?.sf??n?.area??n?.areaSF??0)||0,_=Number(e?.sf??e?.area??e?.areaSF??0)||0;if(m!==_)return _-m;const o=Vv(n?.type??n?.roomType??""),w=Vv(e?.type??e?.roomType??"");return o!==w?o-w:0},Z8=(n,e)=>{if(!Array.isArray(n))return[];const t=[...n];return t.sort((i,c)=>X8(i,c,e)),t},ZA=(n=[])=>{if(!Array.isArray(n)||!n.length)return"";const e=new Map;return n.forEach(t=>{const i=na(t?.buildingLabel||"");if(!i)return;const c=Number(t?.sf??t?.area??t?.areaSF??0)||0;e.set(i,(e.get(i)||0)+c)}),Array.from(e.entries()).sort((t,i)=>i[1]-t[1])[0]?.[0]||""};function Gu(n,e){try{const t=n?.getSource(e);return t&&typeof t.setData=="function"?t:null}catch{return null}}function yV(n,e="",t="",i=1200){return Array.isArray(n)?n.slice(0,i).map((c,u)=>{const m=c?.properties||{},_=c?.id??m.RevitId??m.id??m.roomId??m.RoomId,o=String(m.roomNumber??m.RoomNumber??m.Number??m.Room??m.Name??"").trim(),w=pd(m)||"Unknown",I=String(m.department??m.Department??m.Dept??"").trim(),R=String(m.occupant??m.Occupant??"").trim(),V=kf(m),k=Number.isFinite(V)?V:Number(m.sf??m.SF??m.AreaSF??m.Area??m.area??0)||0,ie=[e,t||m.Floor,o||u].filter(Boolean).join("|")||`feat-${u}`,ae=String(_??"").trim()||ie;return{id:ae,revitId:m.RevitId??_??null,roomId:ae,buildingLabel:e||String(m.buildingLabel??m.Building??m.building??"").trim(),floorId:t||String(m.floorId??m.floor??m.Floor??"").trim(),floorName:t||String(m.floorId??m.floor??m.Floor??"").trim(),roomLabel:o,type:w,sf:k,department:I,occupant:R,vacancy:R?"Occupied":"Unknown",occupancyStatus:R?"Occupied":"Vacant",occupantDept:I||null}}).filter(c=>c.id):null}const YA=async(n,e)=>{const{ensureFloorsForBuilding:t,buildFloorUrl:i,floorCache:c,fetchGeoJSON:u}=e||{},m=(n||"").trim();if(!m)return{perBuilding:{},campusTotals:null};const _=m.toLowerCase(),o={},w={totalSF:0,rooms:0,roomTypes:{},sfByRoomType:{}};for(const I of fd){const R=I?.name;if(!R)continue;let V=await t(R);if(!V?.length)continue;const k={totalSF:0,rooms:0,roomTypes:{},sfByRoomType:{}};for(const ie of V){const ae=i(R,ie);if(!ae)continue;let fe=c.get(ae);if(!fe)try{fe=await u(ae),fe&&c.set(ae,fe)}catch{continue}const J=Tu(fe),ne=pV(J?.features||[],_);ne&&(k.totalSF+=ne.totalSF||0,k.rooms+=ne.rooms||0,Object.entries(ne.roomTypes||{}).forEach(([me,ue])=>{k.roomTypes[me]=(k.roomTypes[me]||0)+ue}),Object.entries(ne.sfByRoomType||{}).forEach(([me,ue])=>{k.sfByRoomType[me]=(k.sfByRoomType[me]||0)+ue}))}(k.rooms||k.totalSF)&&(o[R]=k,w.totalSF+=k.totalSF,w.rooms+=k.rooms,Object.entries(k.roomTypes||{}).forEach(([ie,ae])=>{w.roomTypes[ie]=(w.roomTypes[ie]||0)+ae}),Object.entries(k.sfByRoomType||{}).forEach(([ie,ae])=>{w.sfByRoomType[ie]=(w.sfByRoomType[ie]||0)+ae}))}return!w.rooms&&!w.totalSF?{perBuilding:{},campusTotals:null}:{perBuilding:o,campusTotals:w}};function $u(n,e){if(!n)return{loading:!1,mode:e,totalSf:"-",classroomSf:"-",rooms:"-",classroomCount:"-",labSf:"-",officeSf:"-",labCount:"-",officeCount:"-",deptCount:"-",keyDepts:[]};const t=u=>Number.isFinite(u)?Math.round(u).toLocaleString():"-",i=u=>Number.isFinite(u)?Number(u).toLocaleString():"-",c=n.deptCounts?Object.keys(n.deptCounts).length:0;return{loading:!1,mode:e,totalSf:t(n.totalSf),classroomSf:t(n.classroomSf),labSf:t(n.labSf),officeSf:t(n.officeSf),rooms:i(n.rooms),classroomCount:i(n.classroomCount),labCount:i(n.labCount),officeCount:i(n.officeCount),deptCount:c?c.toString():"-",keyDepts:n.keyDepts||[]}}function _V(n,e){try{if(!n||!Array.isArray(n.features)||n.features.length===0)return n;const t=e?.type==="Feature"?e:e?.type?{type:"Feature",properties:{},geometry:e}:null;if(!t)return n;const i=e_(t);if(i){const Re={rotationDeg:0,rotationPivot:null,scale:1,scaleOrigin:null,translateKm:0,translateBearing:0,nudgeMeters:null,refineRotationDeg:0,refineRotationPivot:null,snapCorner:i},we=IV(t),De=AV(t),nt=Array.isArray(De)?De[0]:null,xe=Array.isArray(De)?De[1]:null,le=!!(nt&&xe),Ne=TV(t);let Oe=n,Je=xc(n);if(we!=="none"&&!le){const ht=ow(n,t);if(Number.isFinite(ht)&&Math.abs(ht)>1.5){const Ct=Je?.geometry?.coordinates||null;Re.rotationDeg=ht,Re.rotationPivot=Ct;const Rt=Zh(n,ht,Ct?{pivot:Ct}:void 0);Rt?.features?.length&&(Oe=Rt,Je=xc(Oe))}}const[rt,mt,dt,Dt]=Lu(Oe),[tn,ln,yn,Mn]=Lu(t);if(![rt,mt,dt,Dt,tn,ln,yn,Mn].every(Number.isFinite))return n;const Gt=Math.max(1e-9,dt-rt),st=Math.max(1e-9,Dt-mt),fr=Math.max(1e-9,yn-tn),br=Math.max(1e-9,Mn-ln),Cn=s5(t)==="directional",ir=Cn?Qp(Oe):Jp([rt,mt,dt,Dt]),Jn=Cn?Qp(t):Jp([tn,ln,yn,Mn]);let Hr=null,Vt=0,Ln=null,$n=null,Dn=null,Mr=null;if(nt&&xe&&ir&&Jn&&(Ln=ir[nt],$n=ir[xe],Dn=Jn[nt],Mr=Jn[xe],Ln&&$n&&Dn&&Mr)){const ht=Mf(Ls(Ln),Ls($n),{units:"kilometers"}),Ct=Mf(Ls(Dn),Ls(Mr),{units:"kilometers"});Number.isFinite(ht)&&Number.isFinite(Ct)&&ht>0&&(Hr=Ct/ht);const Rt=Hm(Ls(Ln),Ls($n)),At=(Hm(Ls(Dn),Ls(Mr))-Rt+540)%360-180;Number.isFinite(At)&&(Vt=At)}const xr=Ln||Je?.geometry?.coordinates||null;Re.scaleOrigin=xr;const Sr=.96,Er=eT(t),Cr=Math.min(fr/Gt,br/st)*Sr,Si=Ne!=="legacy"&&Number.isFinite(Hr)&&Hr>0,Li=(Si?Hr:Cr)*Er,ai=Si||Math.abs(Er-1)>1e-6||Li<.9||Li>1.1;Re.scale=ai?Li:1;let qr=ai?L0(Oe,Li,xr?{origin:xr}:void 0):Oe;const Dr=EV(t),hi=(Number.isFinite(Vt)?Vt:0)+(Number.isFinite(Dr)?Dr:0);le&&Ne!=="legacy"&&Number.isFinite(hi)&&Math.abs(hi)>1e-6&&Array.isArray(xr)&&(qr=Zh(qr,hi,{pivot:xr}),Re.rotationDeg=hi,Re.rotationPivot=xr);const li=Cn?null:Lu(qr),lt=Cn?Qp(qr):Jp(li),Ee=Jn||(Cn?Qp(t):Jp([tn,ln,yn,Mn]));if(lt&&Ee){const ht=nt===i&&xe,Ct=ht?lt[nt]:lt[i],Rt=ht?Ee[nt]:Ee[i];if(Ct&&Rt){const Ot=Ls(Ct),At=Ls(Rt),Lt=Mf(Ot,At,{units:"kilometers"}),xn=Hm(Ot,At);Number.isFinite(Lt)&&Number.isFinite(xn)&&(qr=Lt>0?Ym(qr,Lt,xn,{units:"kilometers"}):qr,Re.translateKm=Lt,Re.translateBearing=xn)}if(le&&ht&&Ne!=="legacy"&&Ne!=="match"){const Ot=lt[nt],At=Ee[nt];if(Ot&&At){const Lt=Mf(Ls(Ot),Ls(At),{units:"kilometers"}),xn=Hm(Ls(Ot),Ls(At));Number.isFinite(Lt)&&Number.isFinite(xn)&&Lt>1e-9&&(qr=Ym(qr,Lt,xn,{units:"kilometers"}),Re.translateKm=(Re.translateKm||0)+Lt,Re.translateBearing=xn)}}}const Te=Dn||Ee?.[i]||null;if(le&&Ne==="legacy"&&Number.isFinite(hi)&&Math.abs(hi)>1e-6&&Te&&(qr=Zh(qr,hi,{pivot:Te}),Re.refineRotationDeg=(Re.refineRotationDeg||0)+hi,Re.refineRotationPivot=Te),Te&&we!=="none"&&!le){const ht=QA(qr,t,Te,{maxDeg:6,stepDeg:.4,fineStep:.1,fineWindow:1.5,hullLimit:1200});ht?.fc&&(qr=ht.fc),Re.refineRotationDeg=ht?.angle||0,Re.refineRotationPivot=Te}le||Number.isFinite(Dr)&&Math.abs(Dr)>1e-6&&Te&&(qr=Zh(qr,Dr,{pivot:Te}),Re.refineRotationDeg=(Re.refineRotationDeg||0)+Dr,Re.refineRotationPivot=Te);const et=CV(t);return Array.isArray(et)&&(qr=M3(qr,et),Re.nudgeMeters=et),qr&&typeof qr=="object"&&(qr.__mfFitted=!0,qr.__mfFittedBuilding=t?.properties?.id||t?.properties?.name||"",qr.__mfFitTransform=Re,n.__mfAffineApplied&&(qr.__mfAffineApplied=n.__mfAffineApplied),n.__mfRotationOverride!=null&&(qr.__mfRotationOverride=n.__mfRotationOverride),n.__mfRotationPivot&&(qr.__mfRotationPivot=n.__mfRotationPivot),n.__mfFitTransformApplied&&(qr.__mfFitTransformApplied=n.__mfFitTransformApplied)),qr}let c=xc(n);const u=xc(t),m={rotationDeg:0,rotationPivot:null,scale:1,scaleOrigin:null,translateKm:0,translateBearing:0,nudgeMeters:null,refineRotationDeg:0,refineRotationPivot:null},_=ow(n,t);if(Number.isFinite(_)&&Math.abs(_)>1.5){const Re=c?.geometry?.coordinates||null;m.rotationDeg=_,m.rotationPivot=Re;const we=Zh(n,_,Re?{pivot:Re}:void 0);we?.features?.length&&(n=we,c=xc(n))}const[o,w,I,R]=Lu(n),[V,k,ie,ae]=Lu(t),fe=Math.max(1e-9,I-o),J=Math.max(1e-9,R-w),ne=Math.max(1e-9,ie-V),me=Math.max(1e-9,ae-k),ue=.96,ke=eT(t),ze=Math.min(ne/fe,me/J)*ue*ke,pe=ze<.9||ze>1.1,U=c?.geometry?.coordinates||null;m.scale=pe?ze:1,m.scaleOrigin=U;let F=pe?L0(n,ze,U?{origin:U}:void 0):n;const q=Lu(F),j=[(V+ie)/2,(k+ae)/2],H=Array.isArray(q)&&q.length===4&&q.every(Re=>Number.isFinite(Re)),Z=Number.isFinite(j[0])&&Number.isFinite(j[1]);if(i&&H){const we=s5(t)==="directional",De=we?Qp(F):Jp(q),nt=we?Qp(t):Jp([V,k,ie,ae]);if(De&&nt){const xe=De[i],le=nt[i];if(xe&&le){const Ne=Ls(xe),Oe=Ls(le),Je=Mf(Ne,Oe,{units:"kilometers"}),rt=Hm(Ne,Oe);Number.isFinite(Je)&&Number.isFinite(rt)&&(F=Je>0?Ym(F,Je,rt,{units:"kilometers"}):F,m.translateKm=Je,m.translateBearing=rt,m.snapCorner=i)}}}else{const Re=[],we=(De,nt,xe)=>{if(!Array.isArray(nt)||!Array.isArray(xe))return;const le=Ls(nt),Ne=Ls(xe),Oe=Mf(le,Ne,{units:"kilometers"}),Je=Hm(le,Ne);if(!Number.isFinite(Oe)||!Number.isFinite(Je))return;const rt=Oe>0?Ym(F,Oe,Je,{units:"kilometers"}):F,mt=fm(rt,1200),dt=mt?Qy(mt,t):0;Re.push({label:De,distKm:Oe,bearing:Je,fc:rt,score:dt})};if(H&&Z){const De=[(q[0]+q[2])/2,(q[1]+q[3])/2];we("center",De,j);const xe=s5(t)==="directional",le=xe?Qp(F):Jp(q),Ne=xe?Qp(t):Jp([V,k,ie,ae]);le&&Ne&&Object.keys(le).forEach(Oe=>{we(`corner-${Oe}`,le[Oe],Ne[Oe])})}else we("centroid",c?.geometry?.coordinates,u?.geometry?.coordinates);if(Re.length){const De=Re.reduce((nt,xe)=>!nt||xe.score>nt.score+1e-6||Math.abs(xe.score-nt.score)<=1e-6&&xe.distKm<nt.distKm?xe:nt,null);De?.fc&&(F=De.fc,m.translateKm=De.distKm,m.translateBearing=De.bearing)}}const be=u?.geometry?.coordinates||j,Me=QA(F,t,be,{maxDeg:6,stepDeg:.4,fineStep:.1,fineWindow:1.5,hullLimit:1200}),Be=Me?.fc||F;return m.refineRotationDeg=Me?.angle||0,m.refineRotationPivot=be,Be&&typeof Be=="object"&&(Be.__mfFitted=!0,Be.__mfFittedBuilding=t?.properties?.id||t?.properties?.name||"",Be.__mfFitTransform=m,n.__mfAffineApplied&&(Be.__mfAffineApplied=n.__mfAffineApplied),n.__mfRotationOverride!=null&&(Be.__mfRotationOverride=n.__mfRotationOverride),n.__mfRotationPivot&&(Be.__mfRotationPivot=n.__mfRotationPivot),n.__mfFitTransformApplied&&(Be.__mfFitTransformApplied=n.__mfFitTransformApplied)),Be}catch{return n}}function Od(n,e=1/0){const t=[];function i(c){if(!(!c||t.length>=e)){if(typeof c[0]=="number"){t.push([c[0],c[1]]);return}for(const u of c){if(t.length>=e)break;i(u)}}}return n?.type==="GeometryCollection"?(n.geometries||[]).forEach(c=>i(c.coordinates)):i(n?.coordinates),t}function i0(n,e=1/0){if(!n)return[];if(n.type==="FeatureCollection"){const t=[];for(const i of n.features||[]){if(t.length>=e)break;const c=Od(i.geometry,e-t.length);c?.length&&t.push(...c)}return t}return n.type==="Feature"?Od(n.geometry,e):n.type?Od(n,e):[]}function Y8(n){if(!Array.isArray(n)||n.length<2)return 0;let e=0,t=0;n.forEach(([_,o])=>{e+=_,t+=o}),e/=n.length,t/=n.length;let i=0,c=0,u=0;return n.forEach(([_,o])=>{const w=_-e,I=o-t;i+=w*w,c+=I*I,u+=w*I}),!Number.isFinite(i)||!Number.isFinite(c)||!Number.isFinite(u)?0:.5*Math.atan2(2*u,i-c)*180/Math.PI}function Jm(n){return Array.isArray(n)&&n.length>=2&&typeof n[0]=="number"&&typeof n[1]=="number"}function N3(n,e){if(Array.isArray(n)){if(n.length&&Jm(n[0])){e.push(n);return}n.forEach(t=>N3(t,e))}}function c0(n){if(!n?.coordinates)return null;const e=[];N3(n.coordinates,e);let t=0,i=null;const c=(u,m)=>Math.abs(u[0]-m[0])<1e-9&&Math.abs(u[1]-m[1])<1e-9;return e.forEach(u=>{if(!Array.isArray(u)||u.length<2)return;for(let o=0;o<u.length-1;o+=1){const w=u[o],I=u[o+1];if(!Jm(w)||!Jm(I))continue;const R=I[0]-w[0],V=I[1]-w[1],k=Math.hypot(R,V);k>t&&(t=k,i=Math.atan2(V,R)*180/Math.PI)}const m=u[u.length-1],_=u[0];if(Jm(m)&&Jm(_)&&!c(m,_)){const o=_[0]-m[0],w=_[1]-m[1],I=Math.hypot(o,w);I>t&&(t=I,i=Math.atan2(w,o)*180/Math.PI)}}),i}function JA(n){if(!n?.coordinates)return null;const e=[];N3(n.coordinates,e);let t=0,i=0,c=0;return e.forEach(m=>{if(!(!Array.isArray(m)||m.length<2))for(let _=0;_<m.length-1;_+=1){const o=m[_],w=m[_+1];if(!Jm(o)||!Jm(w))continue;const I=w[0]-o[0],R=w[1]-o[1],V=Math.hypot(I,R);if(V<=0)continue;const k=Math.atan2(R,I);i+=V*Math.cos(2*k),t+=V*Math.sin(2*k),c+=V}}),c<=0?null:.5*Math.atan2(t,i)*180/Math.PI}function lv(n){let e=(n+180)%360-180;return e>90&&(e-=180),e<-90&&(e+=180),e}function vV(n,e=2e3){if(!n?.geometry)return 0;const t=Od(n.geometry,e);return Y8(t)}function xV(n,e=4e3){if(!n?.features?.length)return 0;const t=[];for(const i of n.features){if(t.length>=e)break;const c=Od(i.geometry,e-t.length);c?.length&&t.push(...c)}return Y8(t)}function fm(n,e=3e3){if(!n?.features?.length)return null;const t=[];for(const u of n.features){if(t.length>=e)break;const m=Od(u.geometry,e-t.length);m?.length&&t.push(...m)}if(t.length<3)return null;const i=t.map(u=>Ls(u));return Ij(x3(i))||null}function ow(n,e){const t=fm(n),i=c0(t?.geometry),c=c0(e?.geometry),u=xV(n),m=vV(e),_=JA(t?.geometry),o=JA(e?.geometry),w=[];return Number.isFinite(i)&&Number.isFinite(c)&&w.push(lv(c-i)),Number.isFinite(u)&&Number.isFinite(m)&&w.push(lv(m-u)),Number.isFinite(_)&&Number.isFinite(o)&&w.push(lv(o-_)),w.length?w.length===1?w[0]:(w.sort((I,R)=>I-R),w[Math.floor(w.length/2)]):null}function Qy(n,e){try{const t=w8(x3([n,e]));if(!t)return 0;const i=uA(t),c=uA(n);return!Number.isFinite(i)||!Number.isFinite(c)||c<=0?0:i/c}catch{return 0}}function QA(n,e,t,i={}){if(!n||!e||!t)return{fc:n,angle:0};const c=Number.isFinite(i.maxDeg)?i.maxDeg:5,u=Number.isFinite(i.stepDeg)?i.stepDeg:.5,m=Number.isFinite(i.fineStep)?i.fineStep:.1,_=Number.isFinite(i.fineWindow)?i.fineWindow:1.2,o=fm(n,i.hullLimit||1200);if(!o)return{fc:n,angle:0};const w=Qy(o,e);let I=0,R=w;for(let k=-c;k<=c;k+=u){if(Math.abs(k)<1e-6)continue;const ie=Zh(o,k,{pivot:t}),ae=Qy(ie,e);ae>R+1e-4&&(R=ae,I=k)}if(m>0&&_>0){const k=I-_,ie=I+_;for(let ae=k;ae<=ie;ae+=m){if(Math.abs(ae)<1e-6)continue;const fe=Zh(o,ae,{pivot:t}),J=Qy(fe,e);J>R+1e-4&&(R=J,I=ae)}}if(Math.abs(I)<.001)return{fc:n,angle:0};const V=Zh(n,I,{pivot:t});return{fc:V?.features?.length?V:n,angle:I}}function bV(n){let e=1/0,t=1/0,i=-1/0,c=-1/0;return(n?.features||[]).forEach(u=>{Od(u.geometry).forEach(([m,_])=>{m<e&&(e=m),_<t&&(t=_),m>i&&(i=m),_>c&&(c=_)})}),[e,t,i,c]}function Jp(n){if(!Array.isArray(n)||n.length!==4)return null;const[e,t,i,c]=n;return[e,t,i,c].every(Number.isFinite)?{nw:[e,c],ne:[i,c],sw:[e,t],se:[i,t]}:null}function Qp(n,e=4e3){let t=n;if(n?.type==="FeatureCollection"){const m=fm(n,e);m?.geometry&&(t=m)}const i=i0(t,e);if(!i.length)return null;const c={nw:[-1,1],ne:[1,1],sw:[-1,-1],se:[1,-1]},u={nw:{score:-1/0,pt:null},ne:{score:-1/0,pt:null},sw:{score:-1/0,pt:null},se:{score:-1/0,pt:null}};for(const[m,_]of i)if(!(!Number.isFinite(m)||!Number.isFinite(_)))for(const o of Object.keys(c)){const[w,I]=c[o],R=m*w+_*I;R>u[o].score&&(u[o]={score:R,pt:[m,_]})}return{nw:u.nw.pt,ne:u.ne.pt,sw:u.sw.pt,se:u.se.pt}}function Xr(n){return String(n||"").replace(/\u00a0/g," ").trim().toLowerCase().replace(/\bthe\b/g,"").replace(/\bmemorial\b/g,"").replace(/\bresidence\b/g,"").replace(/\bresidency\b/g,"").replace(/\b[a-z]\b/g,"").replace(/theatre/g,"theater").replace(/centre/g,"center").replace(/[^a-z0-9]/g,"")}const N_=[{keys:["Morrison Reeves","Morrison-Reeves Science Center"],corner:"nw",cornerMethod:"directional",cornerPair:["nw","sw"],pairMode:"match",rotationMode:"none"},{keys:["Calvin French Chapel","Calvin H. French Chapel","French Memorial Chapel"],corner:"nw",cornerMethod:"directional",cornerPair:["nw","sw"],pairMode:"match"}];function D_(n,e){const t={};return n.forEach(i=>{!i||!i.keys||i[e]==null||i.keys.forEach(c=>{const u=Xr(c);u&&(t[u]=i[e])})}),t}const wV=new Set([]),sw=new Set([Xr("Calvin French Chapel"),Xr("Calvin H. French Chapel"),Xr("Calvin H. French Memorial Chapel"),Xr("Kiewit Building"),Xr("Taylor Hall"),Xr("Taylor Hall Residence")]);function SV({buildingLabel:n}={}){const e=Xr(n);return e&&wV.has(e)}let i5=null;async function o5(){if(i5)return i5;try{const n=[Jd("Hastings_College_Buildings.json"),"/Hastings_College_Buildings.json","Hastings_College_Buildings.json"],e=await G8(n);if(e?.ok&&e.data&&Array.isArray(e.data.features))return i5=e.data,e.data}catch{}return null}function Fd(n){const t=(()=>{try{return decodeURIComponent(String(n||""))}catch{return String(n||"")}})().split("/").filter(Boolean);if(!t.length)return"";const i=t.indexOf("floorplans");return i>=0&&t.length>i+2?t[i+2]:t[t.length-1]||""}function e_(n){if(!n)return null;const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const c=Xr(i);if(c&&nT[c])return nT[c]}return null}function EV(n){if(!n)return null;const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const c=Xr(i);if(c&&Number.isFinite(rT[c]))return rT[c]}return null}function s5(n){if(!n)return"bbox";const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const c=Xr(i);if(c&&iT[c])return iT[c]}return"bbox"}function AV(n){if(!n)return null;const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const c=Xr(i);if(c&&oT[c])return oT[c]}return null}function TV(n){if(!n)return"match";const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const c=Xr(i);if(c&&sT[c])return sT[c]}return"match"}function IV(n){if(!n)return"auto";const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const c=Xr(i);if(c&&aT[c])return aT[c]}return"auto"}function eT(n){if(!n)return 1;const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const c=Xr(i),u=DV[c];if(c&&Number.isFinite(u))return u}return 1}function CV(n){if(!n)return null;const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const c=Xr(i),u=FV[c];if(c&&Array.isArray(u)&&u.length>=2)return u}return null}function If(n=[],e){if(!Array.isArray(n)||!n.length||!e)return null;const t=Xr(e);if(!t)return null;let i=null,c=0;for(const u of n){const m=u?.properties||{},_=[Xr(m.id),Xr(m.name),Xr(m.Name),Xr(m.buildingId),Xr(m.buildingName),Xr(m.Building),Xr(m.building)].filter(Boolean);for(const o of _){if(!o)continue;const w=o===t,I=o.includes(t)||t.includes(o);if(!w&&!I)continue;const R=o.length;R>c&&(i=u,c=R)}}return i}function LV(n,e){try{if(!n||!n.features?.length||!e||n.__mfGeoreferenced||n.__mfNoFit)return!1;const t=Xr(e?.properties?.id||e?.properties?.name||"");if(t&&sw.has(t)||e_(e))return!0;if(n?.__mfFitted)return!1;const[i,c,u,m]=Lu(n),[_,o,w,I]=Lu(e);if(![i,c,u,m,_,o,w,I].every(Number.isFinite))return!1;const R=Math.max(1e-9,u-i),V=Math.max(1e-9,m-c),k=Math.max(1e-9,w-_),ie=Math.max(1e-9,I-o),ae=Math.min(k/R,ie/V),fe=ae<.75||ae>1.35,J=xc(n),ne=xc(e),me=Mf(J,ne,{units:"kilometers"}),ue=Number.isFinite(me)&&me>.06,ke=Mf(Ls([_,o]),Ls([w,I]),{units:"kilometers"}),pe=(Number.isFinite(me)&&Number.isFinite(ke)&&ke>0?me/ke:0)>.18,U=u<_||i>w||m<o||c>I,F=ow(n,e),q=Number.isFinite(F)&&Math.abs(F)>1.5,j=fm(n,1200),H=j?Qy(j,e):1,Z=H>0&&H<.85;return fe||ue||U||q||pe||Z}catch{return!1}}const fd=[{name:"Hurley-McDonald Hall",folder:"HurleyMcDonald"},{name:"Gray Center",folder:"Gray Center"},{name:"Morrison-Reeves Science Center",folder:"Morrison Reeves"},{name:"1882",folder:"1882"},{name:"Altman Hall",folder:"Altman Hall"},{name:"Babcock Hall",folder:"Babcock Hall"},{name:"Barrett Alumni",folder:"Barrett Alumni"},{name:"Batchelder Services Bldg",folder:"Batchelder"},{name:"Bronc Hall",folder:"Bronc Hall"},{name:"Bronco Village Apt 911",folder:"Bronco Village Apt 911"},{name:"Bronco Village Apt 915",folder:"Bronco Village Apt 915"},{name:"Bronco Village Apt 917",folder:"Bronco Village Apt 917"},{name:"Bronco Village Apt 919",folder:"Bronco Village Apt 919"},{name:"Bronco Village Apt 921",folder:"Bronco Village Apt 921"},{name:"Bronco Village Apt 923",folder:"Bronco Village Apt 923"},{name:"Calvin H. French Chapel",folder:"Calvin French Chapel"},{name:"Daugherty Student Engagement Center",folder:"Daugherty"},{name:"Farrell-Fleharty",folder:"Fleharty"},{name:"Hazelrigg Student Union",folder:"Hazzelrig"},{name:"Jackson Dinsdale Art Center",folder:"Jackson Dinsdale"},{name:"Kiewit Building",folder:"Kiewit"},{name:"Lloyd Wilson Stadium",folder:"Lloyd Wilson Stadium"},{name:"McCormick Hall",folder:"McCormick"},{name:"Perkins Library",folder:"Perkins"},{name:"Physical Fitness Facility",folder:"Physical Fitness Facility"},{name:"Scott Studio Theater",folder:"Scott Theater"},{name:"Stone Health Center",folder:"Stone Health Center"},{name:"Taylor Hall",folder:"Taylor Hall"},{name:"Wilson Center",folder:"WilsonCenter"}],sm=Object.fromEntries(fd.map(n=>[n.name,n.folder])),J8=new Set(fd.map(n=>n.folder)),u0=Object.fromEntries(fd.map(n=>[n.folder,n.name])),Q8=n=>String(n||"").replace(/\u00a0/g," ").trim().toLowerCase().replace(/theatre/g,"theater").replace(/centre/g,"center").replace(/\bmemorial\b/g,""),m_=n=>Q8(n).replace(/[^a-z0-9]/g,""),aw=n=>Q8(n).replace(/\b[a-z]\b/gi,"").replace(/[^a-z0-9]/g,""),PV=n=>{if(!n)return null;const e=m_(n);if(!e)return null;const t=tC?.[e];if(t&&sm[t])return t;for(const i of Object.keys(sm))if(m_(i)===e)return i;return null},Cf=n=>{if(!n)return null;if(sm[n])return n;if(J8.has(n))return u0[n]||null;const e=D3[n];if(e&&sm[e])return e;const t=m_(n),i=aw(n),c=t&&tC?.[t]||i&&kV?.[i]||null;if(c&&sm[c])return c;let u=null,m=0;for(const _ of Object.keys(sm)){const o=m_(_),w=aw(_),I=t===o||i===w,R=t&&o&&(t.includes(o)||o.includes(t))||i&&w&&(i.includes(w)||w.includes(i));if(!I&&!R)continue;const V=o.length;V>m&&(u=_,m=V)}return u},eC={1882:"The 1882 Residence Hall","Altman Hall":"Altman Hall Residency","Babcock Hall":"Babcock Hall Residence","Barrett Alumni":"Barrett Alumni Center","Batchelder Services Bldg":"Batchelder General Services","Bronc Hall":"Bronc Hall Residence","Hurley-McDonald Hall":"hurley_mcdonald","Gray Center":"gray_center","Hazelrigg Student Union":"Hazelrigg Student Union","Lloyd Wilson Stadium":"Lloyd Wilson Field/Stadium","Morrison-Reeves Science Center":"morrison_reeves","Scott Studio Theater":"Scott Studio Theatre","Stone Health Center":"The Stone Health Center","Taylor Hall":"Taylor Hall Residence","Wilson Center":"wilson_center","Farrell-Fleharty":"Lynn Farrell Arena/Fleharty Educational Center","Calvin H. French Chapel":"Calvin French Chapel","Bronco Village Apt 911":"Bronco Village Apartments 1","Bronco Village Apt 915":"Bronco Village Apartments 2","Bronco Village Apt 917":"Bronco Village Apartments 3","Bronco Village Apt 919":"Bronco Village Apartments 4","Bronco Village Apt 921":"Bronco Village Apartments 5","Bronco Village Apt 923":"Bronco Village Apartments 6"},D3={...Object.fromEntries(Object.entries(eC).map(([n,e])=>[e,n])),"Farrell Arena Fleharty Educational Center":"Farrell-Fleharty","Daugherty Center for Student Engagement":"Daugherty Student Engagement Center","Daugherty Center For Student Engagement":"Daugherty Student Engagement Center","Fleharty Center":"Farrell-Fleharty","Calvin H. French Memorial Chapel":"Calvin H. French Chapel","French Memorial Chapel":"Calvin H. French Chapel","Hazzelrig Student Union":"Hazelrigg Student Union","Hazelrigg Student Union":"Hazelrigg Student Union",Kiewit:"Kiewit Building","Scott Theatre":"Scott Studio Theater","Scott Theater":"Scott Studio Theater","Wilson Math and Computer Sci Center":"Wilson Center"},tC=Object.fromEntries(Object.entries(D3).map(([n,e])=>[m_(n),e])),kV=Object.fromEntries(Object.entries(D3).map(([n,e])=>[aw(n),e])),MV="Data/Utilization/classroom_utilization.csv",tT=n=>{const e=[];let t="",i=!1;for(let c=0;c<n.length;c+=1){const u=n[c];if(u==='"'){i&&n[c+1]==='"'?(t+='"',c+=1):i=!i;continue}if(u===","&&!i){e.push(t),t="";continue}t+=u}return e.push(t),e},Zg=n=>{const e=String(n??"").replace(/,/g,"").trim();if(!e)return null;const t=Number(e);return Number.isFinite(t)?t:null},Yg=n=>{const e=String(n??"").replace(/[%\s]/g,"").replace(/,/g,"").trim();if(!e)return null;const t=Number(e);return Number.isFinite(t)?t:null},RV=n=>{const e=String(n??"").trim().toLowerCase();return e?/^0+\d+$/.test(e)?String(Number(e)):e:""},nC=(n,e)=>`${n}||${RV(e)}`,NV=(n="")=>{const e=n.split(/\r?\n/).filter(ie=>ie.trim().length>0);if(!e.length)return{buildings:{},rooms:{},campus:null};const t=tT(e[0]).map(ie=>ie.trim()),i=t.findIndex(ie=>ie.toLowerCase().includes("building")),c=t.findIndex(ie=>ie.toLowerCase().includes("weekly")),u=t.findIndex(ie=>ie.toLowerCase().includes("enrollment")),m=t.findIndex(ie=>ie.toLowerCase().includes("capacity")),_=t.findIndex(ie=>ie.toLowerCase().includes("time")),o=t.findIndex(ie=>ie.toLowerCase().includes("seat")),w=t.findIndex(ie=>ie.toLowerCase().includes("overall"));if(i<0)return{buildings:{},rooms:{},campus:null};const I={},R={};let V=null,k=null;for(let ie=1;ie<e.length;ie+=1){const ae=tT(e[ie]),fe=(ae[i]??"").trim();if(!fe)continue;if(/^grand total$/i.test(fe)){V={weeklyHours:Zg(ae[c]),finalEnrollment:Zg(ae[u]),totalCapacity:Zg(ae[m]),timeUtilization:Yg(ae[_]),seatUtilization:Yg(ae[o]),overallUtilization:Yg(ae[w])},k=null;continue}const ne=PV(fe)||null,me=Zg(ae[c]),ue=Zg(ae[u]),ke=Zg(ae[m]),ze=Yg(ae[_]),pe=Yg(ae[o]),U=Yg(ae[w]);if(ne){k=ne,I[ne]={weeklyHours:me,finalEnrollment:ue,totalCapacity:ke,timeUtilization:ze,seatUtilization:pe,overallUtilization:U};continue}if(!k)continue;const F=nC(k,fe);R[F]={building:k,roomLabel:fe,weeklyHours:me,finalEnrollment:ue,totalCapacity:ke,timeUtilization:ze,seatUtilization:pe,overallUtilization:U}}return{buildings:I,rooms:R,campus:V}},nT={[Xr("Babcock Hall")]:"nw",[Xr("Babcock Hall Residence")]:"nw",[Xr("Gray Center")]:"sw",[Xr("Lloyd Wilson Stadium")]:"nw",[Xr("Lloyd Wilson Field/Stadium")]:"nw",[Xr("Stone Health Center")]:"nw",[Xr("The Stone Health Center")]:"nw",[Xr("McCormick Hall")]:"nw",[Xr("Jackson Dinsdale Art Center")]:"nw",[Xr("Farrell-Fleharty")]:"nw",[Xr("Lynn Farrell Arena/Fleharty Educational Center")]:"nw",...D_(N_,"corner")},rT={[Xr("Gray Center")]:0,[Xr("McCormick Hall")]:90},iT={[Xr("Gray Center")]:"directional",[Xr("Lloyd Wilson Stadium")]:"directional",[Xr("Lloyd Wilson Field/Stadium")]:"directional",...D_(N_,"cornerMethod")},oT={[Xr("Gray Center")]:["sw","nw"],[Xr("Lloyd Wilson Stadium")]:["nw","sw"],[Xr("Lloyd Wilson Field/Stadium")]:["nw","sw"],[Xr("Stone Health Center")]:["nw","sw"],[Xr("The Stone Health Center")]:["nw","sw"],[Xr("Jackson Dinsdale Art Center")]:["nw","sw"],[Xr("Farrell-Fleharty")]:["nw","sw"],[Xr("Lynn Farrell Arena/Fleharty Educational Center")]:["nw","sw"],[Xr("Daugherty Student Engagement Center")]:["nw","sw"],[Xr("McCormick Hall")]:["nw","sw"],...D_(N_,"cornerPair")},sT={[Xr("Lloyd Wilson Stadium")]:"match",[Xr("Lloyd Wilson Field/Stadium")]:"match",[Xr("Stone Health Center")]:"legacy",[Xr("The Stone Health Center")]:"legacy",...D_(N_,"pairMode")},aT={[Xr("Babcock Hall")]:"none",[Xr("Babcock Hall Residence")]:"none",...D_(N_,"rotationMode")},DV={[Xr("Gray Center")]:1.035,[Xr("Lloyd Wilson Stadium")]:1,[Xr("Lloyd Wilson Field/Stadium")]:1},FV={},lT={"wilson_center/basement":184.5,"wilson_center/level_1":180.5,"daugherty_student_engagement_center/basement":42,"daugherty_student_engagement_center/level_1":42,hurley_mcdonald_hall:180,"mccormick_hall/basement":84.5,"mccormick_hall/level_1":88.5,"mccormick_hall/level_2":88.5,"mccormick_hall/level_3":100,morrison_reeves_science_center:0,morrison_reeves:0,"morrison_reeves/level_1":0,"morrison_reeves/level_2":0},cT={"babcock_hall/level_2":1.12},uT={},hT=new Set(["kiewit/level_2","kiewit_building/level_2","babcock_hall/level_3","taylor_hall","taylor_hall_residence"]),dT=new Set(["calvin_french_chapel/level_2","calvin_h_french_chapel/level_2","calvin_h_french_memorial_chapel/level_2"]),OV=new Set(["bronc_hall/basement","bronc_hall_residence/basement"]),BV=new Set(["calvin_french_chapel/basement","calvin_h_french_chapel/basement","calvin_h_french_memorial_chapel/basement","kiewit/level_2","kiewit_building/level_2"]);function zV(n,e){if(!n)return null;const t=Qc(n),i=e?Na(e):null;if(i){const u=`${t}/${i}`,m=lT[u];if(Number.isFinite(m))return m}const c=lT[t];return Number.isFinite(c)?c:null}function jV(n,e){if(!n||!e)return null;const t=Qc(n),i=Na(e),c=`${t}/${i}`,u=cT[c]??cT[t];return Number.isFinite(u)?u:null}function UV(n,e){if(!n||!e)return null;const t=Qc(n),i=Na(e),c=`${t}/${i}`,u=uT[c]??uT[t];return Number.isFinite(u)?u:null}function VV(n,e){if(!n||!e)return!1;const t=Qc(n),i=Na(e);return OV.has(`${t}/${i}`)}function qV(n,e){if(!n||!e)return!1;const t=Qc(n),i=Na(e);return hT.has(`${t}/${i}`)||hT.has(t)}function $V(n,e){if(!n||!e)return!1;const t=Qc(n),i=Na(e);return dT.has(`${t}/${i}`)||dT.has(t)}function GV(n,e){if(!n||!e)return!1;const t=Qc(n),i=Na(e);return BV.has(`${t}/${i}`)}const qv=(n,e)=>({...n,...e}),uo=n=>{const e=String(n??"").trim();if(!e)return"";const t=Cf(e)||e;return Qc(t)},vm=n=>String(n||"").trim().toLowerCase().replace(/[^a-z0-9]/g,""),HV=/[0-9a-f]{8}(?:-[0-9a-f]{4}){3}-[0-9a-f]{12}/i,F3=n=>{const e=String(n||"").trim();if(!e)return[];const t=new Set,i=vm(e);i&&t.add(i);const c=e.match(HV);if(c&&c[0]){const u=vm(c[0]);u&&t.add(u)}return Array.from(t)},fT=n=>{const e=String(n||"").trim();if(!e)return"";const t=vm(e);return t?t.startsWith("room")&&t.length>4?t.slice(4):t:""},ug=n=>String(n||"").toLowerCase().replace(/[^a-z0-9]+/g," ").trim(),k0=n=>String(n||"").toLowerCase().replace(/&/g,"and").replace(/[^a-z0-9]+/g," ").trim(),t_=n=>n?.building??n?.buildingName??n?.buildingLabel??"",pT=(n=[])=>{const e=new Map;return(C3||[]).forEach(t=>{const i=k0(t);i&&e.set(i,t)}),(n||[]).forEach(t=>{const i=String(t?.department??"").trim(),c=k0(i);c&&e.set(c,i)}),Array.from(e.values())},mT=(n,e=[])=>{const t=k0(n);if(!t)return"";let i="",c=0;return(e||[]).forEach(u=>{const m=k0(u);m&&t.includes(m)&&m.length>c&&(i=u,c=m.length)}),i},$v=n=>String(n||"").toLowerCase().replace(/&/g,"and").replace(/[^a-z0-9]+/g," ").trim(),gT=(n=[])=>{const e=new Map;return(fd||[]).forEach(t=>{const i=String(t?.name||"").trim(),c=$v(i);c&&e.set(c,i)}),(n||[]).forEach(t=>{const i=String(t?.building??t?.buildingName??t?.buildingLabel??"").trim(),c=$v(i);c&&e.set(c,i)}),Array.from(e.values())},yT=(n,e=[])=>{const t=$v(n);if(!t)return"";let i="",c=0;return(e||[]).forEach(u=>{const m=$v(u);m&&t.includes(m)&&m.length>c&&(i=u,c=m.length)}),i},_T=(n=[],e="")=>{const t=k0(e);if(!t)return[];const i=new Set;return(n||[]).forEach(c=>{const u=k0(c?.department??"");if(u&&u===t){const m=t_(c);m&&i.add(m)}}),Array.from(i)},a5=n=>{if(n==null)return[];const e=new Set,t=String(n);t&&e.add(t);const i=Number(t);return Number.isFinite(i)&&e.add(i),Array.from(e)},O3=n=>/^rec[a-z0-9]{6,}$/i.test(String(n||"")),Gv=n=>Array.isArray(n)&&n.length>0&&n.every(e=>O3(e)),rC=["Office - Staff","Office - Prof and Admin","Office - Prof & Admin","Office - Prof/Admin","Office - Faculty","Office - Adjunct Faculty","Office - Emeritus Faculty"],WV=rC.map(n=>n.toUpperCase()),iC=n=>String(n||"").toLowerCase().replace(/[^a-z0-9]+/g," ").replace(/\b(and|&)\b/g," ").replace(/\s+/g," ").trim(),KV=new Set(rC.map(iC).filter(Boolean)),cv=n=>KV.has(iC(n)),XV=/^[{(]?[0-9a-f]{8}(?:-[0-9a-f]{4}){3}-[0-9a-f]{12}(?:-[0-9a-f]{2,})?[)}]?$/i,ZV=/^[0-9a-f]{24,}$/i,YV=/[0-9a-f]{8}(?:-[0-9a-f]{4}){3}-[0-9a-f]{12}(?:-[0-9a-f]{2,})?/i,am=n=>{const e=String(n||"").trim();return e?!!(XV.test(e)||YV.test(e)&&e.length>=24||ZV.test(e)||e.includes("|")||/^[a-f0-9-]{24,}$/i.test(e)||O3(e)):!1},B3=n=>{const e=[n?.roomNumber,n?.roomLabel,n?.number,n?.Number,n?.RoomNumber,n?.Room];for(const i of e){const c=String(i??"").trim();if(c&&!am(c))return c}const t=String(n?.roomId??"").trim();return t&&!am(t)?t:""},JV=(n="")=>{const e=String(n||"").toLowerCase();return!/\bvacan(t|cy)\b/.test(e)||!/\boffice(s)?\b/.test(e)?!1:/\b(list|show|give|display|return|all|which|what)\b/.test(e)},QV=(n="")=>{const e=String(n||"").toLowerCase();return!/\bvacan(t|cy)\b/.test(e)||!/\boffice(s)?\b/.test(e)?!1:/\bhow many\b|\bcount\b|\bnumber of\b/.test(e)},eq=(n="")=>{const e=String(n||"").toLowerCase();return/\bclassroom(s)?\b/.test(e)?/\bhow many\b|\bcount\b|\bnumber of\b/.test(e):!1},tq=n=>{const e=String(n?.occupancyStatus??n?.occupancy??n?.Vacancy??n?.vacancy??"").toLowerCase();return String(n?.occupant??"").trim()||e.includes("occupied")||e.includes("assigned")&&!e.includes("unassigned")?!1:e.includes("vacant")||e.includes("available")},vT=(n=[])=>{const e=new Set,t=[];return(n||[]).forEach(i=>{const c=String(i?.type??i?.roomType??"").trim();if(!c||!c.toLowerCase().includes("office")&&!cv(c)||!tq(i))return;const m=String(t_(i)||"").trim(),_=String(i?.floor??i?.floorName??i?.floorId??"").trim(),o=B3(i),w=vm(i?.roomGuid??i?.revitId??i?.roomId??i?.id??""),I=Number(i?.areaSF??i?.area??i?.sf??0),R=Number.isFinite(I)&&I>0?Math.round(I):"",V=[m,_,o,c,R].join("|").toLowerCase();e.has(V)||(e.add(V),t.push({Building:m||"Unknown","Room Number":o,"Room Type":c,"Square Feet":R,__lookupKey:w,__floor:_}))}),t.sort((i,c)=>String(i.Building||"").localeCompare(String(c.Building||""),void 0,{sensitivity:"base"})||String(i["Room Number"]||"").localeCompare(String(c["Room Number"]||""),void 0,{numeric:!0,sensitivity:"base"})),t},nq=n=>{if(B3(n))return!1;const t=String(n?.roomId??n?.id??"").trim();return String(n?.roomGuid??n?.revitId??n?.revitUniqueId??"").trim()||!t?!0:am(t)},rq=n=>String(n||"").toLowerCase().replace(/[^a-z0-9]+/g," ").trim(),R1=n=>{const e=rq(n);return e?e.includes("classroom")?!0:e.includes("laboratory class")||e.includes("laboratory studio")||e.includes("lab class")||e.includes("lab studio"):!1},Lf=n=>{const e=String(n??"").trim();if(!e)return[];const t=new Set,i=Na(e);t.add(i);const c=Number(e);return Number.isFinite(c)&&(t.add(`level_${c}`),c===0&&t.add("basement")),Array.from(t)},Tf=(n,e)=>{if(!e?.length)return!0;const t=Lf(n);return t.length?t.some(i=>e.includes(i)):!1},N1=(n,e=[])=>{const t=a0(n);if(!t)return"";if(e.includes(t))return t;const i=Lf(t);return i.length&&e.find(c=>Tf(c,i))||""};function oC(n=[]){const e=new Map,t=new Map;if(!Array.isArray(n))return{byGuid:e,byComposite:t};const i=(c,u,m)=>{if(!u)return;if(!c.has(u)){c.set(u,m);return}c.get(u)!==m&&c.set(u,null)};return n.forEach(c=>{if(!c)return;const u=c.roomGuid??c.revitId??c.revitUniqueId??c["Room GUID"]??c.roomId??"";F3(u).forEach(I=>i(e,I,c));const _=vm(c.roomId??c.roomNumber??c.roomLabel??c.id??""),o=uo(c.building??c.buildingName??c.buildingLabel??""),w=uo(c.floor??c.floorName??c.floorId??"");if(_&&o&&w){const I=`${o}|${w}|${_}`;t.has(I)||t.set(I,c)}}),{byGuid:e,byComposite:t}}function iq(n=[],e=[]){if(!Array.isArray(n)||n.length===0)return[];if(!Array.isArray(e)||e.length===0)return n;const t=oC(e);return n.map(i=>{if(!i)return i;const c=i.roomGuid??i.revitId??i.roomId??i.revitUniqueId??"",m=F3(c).reduce((I,R)=>I||t.byGuid.get(R)||null,null);if(!m)return i;const _={...i};!_.roomGuid&&m.roomGuid&&(_.roomGuid=m.roomGuid),!_.roomId&&m.roomId&&(_.roomId=m.roomId);const o=String(_.roomNumber??"").trim(),w=String(_.roomLabel??"").trim();if((!o||am(o))&&m.roomNumber){const I=String(m.roomNumber).trim();I&&!am(I)&&(_.roomNumber=I)}if((!w||am(w))&&m.roomLabel){const I=String(m.roomLabel).trim();I&&!am(I)&&(_.roomLabel=I)}return!_.building&&m.building&&(_.building=m.building),!_.floor&&m.floor&&(_.floor=m.floor),(!_.type||Gv(_.type))&&m.type&&(_.type=m.type),(!_.department||Gv(_.department))&&m.department&&(_.department=m.department),(!Number.isFinite(Number(_.areaSF))||Number(_.areaSF)<=0)&&Number.isFinite(Number(m.areaSF))&&Number(m.areaSF)>0&&(_.areaSF=Number(m.areaSF)),_})}function sC(n={},e,t,i){if(!e)return null;let c=null;const u=n.Revit_UniqueId??n.RevitUniqueId??n["Room GUID"]??n.roomGuid??"";if(F3(u).forEach(k=>{c||(c=e.byGuid.get(k)||null)}),!c){const k=vm(n.Number??n.RoomNumber??n.number??n.Room??n.roomNumber??""),ie=uo(t??n.Building??n.BuildingName??n.buildingId??""),ae=uo(i??n.Floor??n.floor??"");k&&ie&&ae&&(c=e.byComposite.get(`${ie}|${ae}|${k}`)||null)}if(!c)return null;const _=String(c.occupancyStatus??"").trim(),o=String(c.occupant??"").trim(),w=String(c.type??"").trim(),I=String(c.department??"").trim();if(!_&&!o&&!w&&!I)return null;const R={};_&&(R.occupancyStatus=_,R.OccupancyStatus=_,R["Occupancy Status"]=_),o&&(R.occupant=o,R.Occupant=o),w&&(R.type=w,R.Type=w,R["Room Type"]=w,R["Room Type Description"]=w),I&&(R.department=I,R.Department=I);const V=Number(c.seatCount??c.SeatCount??c["Seat Count"]??0);return Number.isFinite(V)&&V>0&&(R.seatCount=V,R.SeatCount=V,R["Seat Count"]=V),R}const oq=n=>{const e=Number(n?.areaSF??n?.area??n?.sf??0);return Number.isFinite(e)&&e>0},sq=(n,e)=>{if(!n)return null;const t=n?.properties||{},i=R8(t);if(!Number.isFinite(i)||i<=0)return null;const c=(t.occupancyStatus??t["Occupancy Status"]??t.OccupancyStatus??t.vacancy??t.Vacancy??t.Occupancy??t.Status??"").toString().trim(),u=(t.occupant??t.Occupant??t.AssignedTo??t.Assignee??"").toString().trim(),m=String(t.Revit_UniqueId??t.RevitUniqueId??t["Room GUID"]??"").trim(),_=String(t.Number??t.RoomNumber??t.number??t.Room??"").trim(),o=t.Floor??t.Level??t.LevelName??t["Level Name"]??"";return{building:e||"",floor:o,areaSF:i,area:i,sf:i,roomId:_||"",roomNumber:_||"",roomLabel:_||"",roomGuid:m,department:M8(t),type:L3(t),occupancyStatus:c,occupant:u}},xT=async n=>{const e=n?.floorsByBuilding||{},t=[],i=new Map;return Array.isArray(n?.buildings)?n.buildings.forEach(u=>{u?.id&&i.set(String(u.id),u?.name||u.id)}):n?.buildings&&typeof n.buildings=="object"&&Object.entries(n.buildings).forEach(([u,m])=>{u&&i.set(String(u),m?.name||u)}),Object.entries(e).forEach(([u,m])=>{const _=i.get(String(u))||u;(m||[]).forEach(o=>{const w=typeof o=="string"?o:o?.url;w&&t.push({url:w,buildingLabel:_})})}),t.length?(await iV(t,6,async u=>{const m=await rV(u.url),_=[];return(m||[]).forEach(o=>{const w=sq(o,u.buildingLabel);w&&_.push(w)}),_})).flat():[]},aC=n=>{if(!n)return null;const e=Number(n.areaSF??n.area??n.sf??0);if(!Number.isFinite(e)||e<=0)return null;const t=String(n.department??"").trim(),i=String(n.type??"").trim(),c=String(n.occupancyStatus??"").trim(),u=String(n.occupant??"").trim();return{type:"Feature",properties:{Area_SF:e,Area:e,area:e,"Area (SF)":e,NCES_Department:t,Department:t,department:t,NCES_Type:i,__roomType:i,OccupancyStatus:c,"Occupancy Status":c,occupancyStatus:c,Occupant:u,occupant:u}}};function lC(n,e){if(n){try{n.getLayer(Bf)&&n.removeLayer(Bf),n.getLayer(cg)&&n.removeLayer(cg),n.getLayer(gh)&&n.removeLayer(gh),n.getLayer(Sp)&&n.removeLayer(Sp),n.getLayer(Dd)&&n.removeLayer(Dd),n.getLayer(Ov)&&n.removeLayer(Ov),n.getLayer(Bv)&&n.removeLayer(Bv),n.getLayer(jo)&&n.removeLayer(jo),Gu(n,da)&&n.removeSource(da),n.getLayer(P0)&&n.removeLayer(P0),n.getSource(zv)&&n.removeSource(zv),n.getLayer(jv)&&n.removeLayer(jv),n.getSource(UA)&&n.removeSource(UA),n.getLayer(Uv)&&n.removeLayer(Uv),n.getSource(VA)&&n.removeSource(VA)}catch{}e&&(e.current=null)}}function bT(n){try{const e=Gu(n,da),t=e?._data||e?.serialize?.()?.data,i=Tu(t);if(!i)return;const c=Lu(i);c&&isFinite(c[0])&&n.fitBounds([[c[0],c[1]],[c[2],c[3]]],{padding:40,duration:500})}catch{}}function cC(n){if(!n)return;const i=["case",["==",["get","Element"],"Room"],["concat",["coalesce",["get","Number"],["get","RoomNumber"],["get","name"],["literal","-"]],`
`,["coalesce",["get","__roomType"],["get","RoomType"],["get","Room Type"],["get","Type"],["get","type"],["get","Name"],["literal","-"]],`
`,["coalesce",["get","scenarioDepartment"],["get","department"],["get","Department"],["literal","-"]],`
`,["concat",["to-string",["round",["coalesce",["get","Area_SF"],["get","Area"],0]]]," SF"]],""],c=["interpolate",["linear"],["zoom"],14,0,15,0,16,3,17,5,18,7,19,10];if(n.getLayer(gh)){try{n.setLayoutProperty(gh,"text-field",i),n.setLayoutProperty(gh,"text-size",c),n.setLayoutProperty(gh,"symbol-placement","point"),n.setLayoutProperty(gh,"text-allow-overlap",!1),n.setLayoutProperty(gh,"text-ignore-placement",!1),n.setLayoutProperty(gh,"text-max-width",6),n.setLayoutProperty(gh,"visibility","visible"),n.setFilter(gh,l0)}catch{}lw(n);return}try{n.addLayer({id:gh,type:"symbol",source:da,filter:["all",l0,["!=",["id"],-1]],layout:{"text-field":i,"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":c,"text-line-height":1,"text-variable-anchor":["center"],"text-radial-offset":0,"text-anchor":"center","text-justify":"center","symbol-placement":"point","text-allow-overlap":!1,"text-ignore-placement":!1,"text-max-width":6,visibility:"visible"},paint:{"text-color":"#0b0b0b","text-halo-color":"rgba(255,255,255,0.95)","text-halo-width":1}},Dd),lw(n)}catch{}}function lw(n){if(n)try{n.getLayer(gh)&&n.moveLayer(gh)}catch{}}const aq={5:{label:"5 = Excellent condition",color:"#4CAF50"},4:{label:"4 = Good condition",color:"#8BC34A"},3:{label:"3 = Adequate condition",color:"#FFEB3B"},2:{label:"2 = Poor condition",color:"#FF9800"},1:{label:"1 = Very poor condition",color:"#F44336"}},lq={0:"#85474b",1:"#aed6f1",2:"#5dade2",3:"#2e86c1"},Vm="#85474b",cq=["603 E 9th St","603 E. 9th St","607 E 9th St","MacKay House","McKay House","905 N Elm St","905 N Elm Ave","Name 1","Name1","706 E. 7th St","706 E 7th St","706 E. 7th St. Residence","710 E. 7th St.","710 E 7th St","710 E. 7th St. Residence","714 E. 7th St.","714 E 7th St","714 E. 7th St. Residence","812 N Ash St","812 N Ash Ave","906 E 9th St","Campus Safety","The 1882 Residence Hall","1882 Residence Hall","Hayes M. Fuhr Hall of Music","Hayes M Fuhr Hall of Music"],uq=cq.map(n=>String(n||"").toLowerCase()),hq=["downcase",["to-string",["coalesce",["get","id"],["get","name"]]]],dq=["in",hq,["literal",uq]],hd=(n,e="#d1d5db")=>["case",dq,e,n],fq=n=>Number.isFinite(n)?n>=80?"#22c55e":n>=60?"#84cc16":n>=40?"#facc15":n>=20?"#f97316":"#ef4444":"#e5e7eb",pm={study:{color:"#ef4444",heatValue:1,rgb:"255,69,69",haloRgb:"255,207,120"},hangout:{color:"#fb923c",heatValue:.95,rgb:"255,150,62",haloRgb:"255,218,140"},improve:{color:"#facc15",heatValue:.9,rgb:"255,212,45",haloRgb:"255,233,153"},outdated:{color:"#60a5fa",heatValue:.8,rgb:"82,148,255",haloRgb:"180,220,255"},rarely:{color:"#67e8f9",heatValue:.9,rgb:"78,228,250",haloRgb:"190,246,255"},unsafe:{color:"#1d4ed8",heatValue:1.03,rgb:"30,78,216",haloRgb:"142,181,255"},comment:{color:"#9ca3af",heatValue:0,rgb:"156,163,175",haloRgb:"125,250,255"}},pq={study:"Go-to Study",hangout:"Go-to Hang Out",improve:"Needs Improvement",outdated:"Outdated / Run Down",rarely:"Rarely / Never Use",unsafe:"Do Not Feel Safe",comment:"Comment"},mq=["study","hangout","improve","rarely","outdated","unsafe","comment"],cw={study:"This is a go to study spot",hangout:"This is a go to hang out spot",improve:"I would like to use this space more, but it needs improvement",rarely:"I rarely or never use this space",outdated:"This space feels outdated or run down",unsafe:"I do not feel safe in this space",comment:"Just leave a comment"},gq=mq.reduce((n,e)=>{const t=cw[e];return n[t]=pm[e]?.color||"#9ca3af",n},{}),l5=24,yq=["study","hangout","improve"],_q=["outdated","rarely","unsafe"],Hv=["coalesce",["get","weight"],0],c5=[">",Hv,0],wT=!0,ST=[{category:"rarely",layerId:"engagement-heat-rarely"},{category:"outdated",layerId:"engagement-heat-outdated"},{category:"unsafe",layerId:"engagement-heat-unsafe"},{category:"improve",layerId:"engagement-heat-improve"},{category:"hangout",layerId:"engagement-heat-hangout"},{category:"study",layerId:"engagement-heat-study"}],g_=n=>{const e=String(n||"").trim().toLowerCase();return!e||/just leave a ?comment|leave a comment about this space/.test(e)?"comment":/do not feel safe|unsafe/.test(e)?"unsafe":/rarely|never/.test(e)?"rarely":/outdated|run-down|run down/.test(e)||/furniture.*uncomfortable|layout.*not functional|lighting|temperature|technology.*inadequate|unreliable|privacy/.test(e)?"outdated":/needs improvement|need improvement|more flexible|adaptable|wish this space were more flexible|improv/.test(e)?"improve":/go[- ]to hang ?out|hang ?out/.test(e)?"hangout":/go[- ]to study|study spot|supports my teaching|professional work effectively|supports .*work effectively/.test(e)?"study":"comment"},vq=n=>cw[g_(n)]||cw.comment,xq=n=>pm[g_(n)]?.heatValue??0,ET=n=>pm[g_(n)]?.color||"#9ca3af",bq=n=>n==="outdated"||n==="rarely"||n==="unsafe",wq=n=>{const e=pm[n]?.rgb||"156,163,175",t=pm[n]?.haloRgb||e;return bq(n)?["interpolate",["linear"],["heatmap-density"],0,"rgba(0,0,0,0)",.03,`rgba(${t},0.12)`,.1,`rgba(${t},0.24)`,.2,`rgba(${e},0.58)`,.36,`rgba(${e},0.82)`,.62,`rgba(${e},0.93)`,1,`rgba(${e},0.995)`]:["interpolate",["linear"],["heatmap-density"],0,"rgba(0,0,0,0)",.03,`rgba(${t},0.10)`,.12,`rgba(${t},0.22)`,.24,`rgba(${t},0.40)`,.4,`rgba(${e},0.66)`,.65,`rgba(${e},0.86)`,1,`rgba(${e},0.98)`]},Sq=()=>["interpolate",["linear"],["heatmap-density"],0,"rgba(0,0,0,0)",.06,"rgba(255,237,128,0.20)",.22,"rgba(253,224,71,0.40)",.48,"rgba(251,146,60,0.58)",.72,"rgba(239,68,68,0.70)",1,"rgba(220,38,38,0.82)"],Eq=()=>["interpolate",["linear"],["heatmap-density"],0,"rgba(0,0,0,0)",.05,"rgba(207,250,254,0.24)",.18,"rgba(125,250,255,0.44)",.42,"rgba(56,189,248,0.62)",.7,"rgba(59,130,246,0.78)",1,"rgba(30,64,175,0.90)"],AT=n=>{const e=["coalesce",["get","weight"],0];return n==="unsafe"?["*",e,1.08]:n==="rarely"?["*",e,.95]:n==="outdated"?["*",e,.88]:n==="improve"?["*",e,.88]:n==="hangout"?["*",e,1.02]:n==="study"?["*",e,1.12]:["*",e,1]},TT=()=>["*",Hv,["match",["coalesce",["get","heatCategory"],""],"study",1.12,"hangout",1,"improve",.74,1]],IT=(n=!1)=>n?["interpolate",["linear"],["zoom"],16,1.02,18,1.14,20,1.24,22,1.32]:["interpolate",["linear"],["zoom"],10,.86,13,.96,15,1.06,17,1.16,19,1.24],CT=(n=!1)=>n?["interpolate",["linear"],["zoom"],16,20,18,30,20,44,22,60]:["interpolate",["linear"],["zoom"],10,34,12,52,14,74,16,98,18,124,20,152],LT=(n=!1)=>n?["interpolate",["linear"],["zoom"],16,.84,18,.89,20,.94,22,.97]:["interpolate",["linear"],["zoom"],10,.68,13,.72,16,.76,19,.8],PT=(n=!1)=>n?["interpolate",["linear"],["zoom"],16,1.04,18,1.14,20,1.24,22,1.32]:["interpolate",["linear"],["zoom"],10,.9,13,1,15,1.1,17,1.18,19,1.26],kT=(n=!1)=>n?["interpolate",["linear"],["zoom"],16,18,18,28,20,40,22,54]:["interpolate",["linear"],["zoom"],10,28,12,42,14,58,16,78,18,98,20,120],MT=(n=!1)=>n?["interpolate",["linear"],["zoom"],16,.82,18,.88,20,.94,22,.97]:["interpolate",["linear"],["zoom"],10,.62,13,.68,16,.74,19,.8],RT=(n,e=!1)=>e?n==="unsafe"?["interpolate",["linear"],["zoom"],16,7,18,11,20,16,22,22]:n==="rarely"||n==="outdated"?["interpolate",["linear"],["zoom"],16,8,18,12,20,18,22,24]:n==="improve"?["interpolate",["linear"],["zoom"],16,11,18,16,20,22,22,30]:["interpolate",["linear"],["zoom"],16,11,18,18,20,24,22,34]:n==="unsafe"?["interpolate",["linear"],["zoom"],10,13,12,18,14,26,16,36,18,46,20,56]:n==="rarely"||n==="outdated"?["interpolate",["linear"],["zoom"],10,14,12,22,14,30,16,40,18,52,20,64]:n==="improve"?["interpolate",["linear"],["zoom"],10,18,12,28,14,40,16,54,18,70,20,86]:["interpolate",["linear"],["zoom"],10,20,12,30,14,44,16,58,18,76,20,94],NT=(n,e=!1)=>e?n==="unsafe"?["interpolate",["linear"],["zoom"],16,1.24,18,1.34,20,1.44,22,1.56]:n==="rarely"||n==="outdated"?["interpolate",["linear"],["zoom"],16,1.16,18,1.26,20,1.36,22,1.48]:["interpolate",["linear"],["zoom"],16,1.14,18,1.24,20,1.34,22,1.46]:n==="unsafe"?["interpolate",["linear"],["zoom"],10,1.12,13,1.22,15,1.32,17,1.44,19,1.54]:n==="rarely"||n==="outdated"?["interpolate",["linear"],["zoom"],10,1,13,1.1,15,1.2,17,1.3,19,1.38]:["interpolate",["linear"],["zoom"],10,.98,13,1.08,15,1.18,17,1.3,19,1.4],DT=(n,e=!1)=>e?n==="unsafe"?["interpolate",["linear"],["zoom"],16,1,18,1,20,1,22,1]:n==="rarely"||n==="outdated"?["interpolate",["linear"],["zoom"],16,.94,18,.97,20,.99,22,1]:["interpolate",["linear"],["zoom"],16,.97,18,.99,20,1,22,1]:n==="unsafe"?["interpolate",["linear"],["zoom"],10,.88,13,.92,16,.95,19,.97]:n==="rarely"||n==="outdated"?["interpolate",["linear"],["zoom"],10,.78,13,.83,16,.89,19,.93]:["interpolate",["linear"],["zoom"],10,.85,13,.89,16,.93,19,.96],u5=(n,e,t)=>{try{if(!n?.getLayer(e))return;n.setLayoutProperty(e,"visibility",t?"visible":"none")}catch{}},uC=({config:n,universityId:e,mode:t="public",persona:i,engagementMode:c=!1})=>{const u=wo(null),m=wo(null),_=wo(null),o=wo(null),w=wo({}),I=wo(null),R=wo(null),V=wo(null),[k,ie]=jn(!1),[ae,fe]=jn("select"),[J,ne]=jn(t==="admin"),[me,ue]=jn([]),[ke,ze]=jn({}),[pe,U]=jn({}),[F,q]=jn(null),[j,H]=jn(fd[0]?.name||""),be=n?.universityName||n?.name||""||e||"Campus",Me={SPACE_DATA:"space-data",ASSESSMENT:"assessment",TECHNICAL:"technical"},Be=c?Me.ASSESSMENT:Me.SPACE_DATA,[Re,we]=jn(Be),[De,nt]=jn(!!c),[xe,le]=jn(()=>{if(typeof window>"u")return!1;try{const O=new URLSearchParams(window.location.search||""),he=String(O.get("presentation")||"").trim().toLowerCase();return he==="1"||he==="true"||he==="yes"}catch{return!1}}),[Ne,Oe]=jn(!1),Je=[{value:Me.SPACE_DATA,label:"Space Data"},{value:Me.ASSESSMENT,label:"Assessment Progress"},{value:Me.TECHNICAL,label:"Technical"}],rt=t==="admin"?Je:Je.filter(O=>O.value===Me.SPACE_DATA),[mt,dt]=jn(!0),[Dt,tn]=jn(!1),[ln,yn]=jn(!0),[Mn,Gt]=jn(!1),[st,fr]=jn(""),[br,Tr]=jn("");gi(()=>{if(!(!Mn||st))try{const O=String(window.localStorage?.getItem("MAPBOX_PUBLIC_TOKEN")??"").trim();O&&fr(O)}catch{}},[Mn,st]),gi(()=>{const O=m.current;if(!O)return()=>{};const he=()=>{O.querySelectorAll('.mapboxgl-popup-close-button[aria-hidden="true"]').forEach(Qe=>Qe.removeAttribute("aria-hidden"))};he();const Ie=new MutationObserver(he);return Ie.observe(O,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["aria-hidden"]}),()=>Ie.disconnect()},[]);const[Cn,ir]=jn(!0),Jn=Wa(()=>bU(vU),[]),Hr=Wa(()=>Array.from(new Set([...Object.keys(T3),...C3])).sort(),[]),[Vt,Ln]=jn(null),[$n,Dn]=jn(null),[Mr,xr]=jn(null),[Sr,Er]=jn(null),[Cr,Si]=jn("building"),[Li,or]=jn(null),[ai,qr]=jn({}),[Dr,hi]=jn(0),[li,lt]=jn([]),[Ee,Te]=jn(new Map),[et,ht]=jn(null),Ct=wo([]),[Rt,Ot]=jn(null),[At,Lt]=jn(""),xn=wo(null),On=wo(!1),An=wo(""),[Lr,Ir]=jn(null),[zr,wr]=jn(""),Ei=wo(null),to=wo(!1),po=wo(""),Wo=wo(null),[no,_s]=jn(Jn),[ro,Ps]=jn(Hr),[fa,Sl]=jn(new Set),[al,Vi]=jn("__all__"),[Ql,Pu]=jn(""),[So,mu]=jn("rooms"),[Ea,Zo]=jn(!1),[Xa,kl]=jn(""),[ec,Aa]=jn(!1),[ra,pn]=jn(!1),[Yo,ss]=jn(""),[vi,gu]=jn(null),[Za,Ya]=jn(!1),[ll,ks]=jn(!1),[er,Fr]=jn(""),[Rr,zs]=jn(null),[Ta,xi]=jn(!1),[Mi,El]=jn(!1),[ji,fs]=jn(""),[Fi,yu]=jn(null),[tc,eu]=jn(!1),[bc,nc]=jn(!1),[Da,Ms]=jn(""),[Oi,Fa]=jn(null),[ci,Jo]=jn(!1),[Eo,xh]=jn(""),[ku,mo]=jn(!1),[js,Mu]=jn(""),[Ko,go]=jn(null),[Ml,Oa]=jn(!0),[Us,Uo]=jn(!1),[zc,Xo]=jn(!1),[pa,Ja]=jn(""),[cl,tu]=jn(!1),[wc,Vs]=jn(""),[Ai,Ss]=jn(null),[qs,ia]=jn(null),[oa,ul]=jn("Campus Summary"),[$s,Gs]=jn(!1),[Sc,W]=jn(null),[Ce,pt]=jn([]),[yt,qt]=jn([]),[Qt,Fn]=jn(!1),[Nr,$r]=jn(!1),[yi,Ti]=jn(""),[yo,_o]=jn(null),[Qo,Mo]=jn({buildings:{},rooms:{},campus:null}),[Vo,es]=jn(!1),cs=wo(null),qo=wo(null),Es=Wa(()=>oC(Ce.length?Ce:yt),[Ce,yt]),jc=Wa(()=>Qo?.buildings||{},[Qo]),Qa=Wa(()=>Qo?.rooms||{},[Qo]),L=Qo?.campus||null,se=Wa(()=>{const O={};return Object.entries(jc||{}).forEach(([he,Ie])=>{if(!he)return;O[he]=Ie;const qe=eC[he];qe&&(O[qe]=Ie)}),O},[jc]),ve=Qn(O=>{if(!O)return null;const he=Cf(O)||O;return jc[he]||null},[jc]),He=Qn((O,he)=>{if(!O||!he)return null;const Ie=Cf(O)||O,qe=nC(Ie,he);return Qa[qe]||null},[Qa]),[Xt,fn]=jn(null),[ar,ao]=jn(!1),[Fo,qi]=jn("unknown"),Di=Fo==="down",Ro=Fo==="ok",sa=Fo==="unknown",Oo=Wa(()=>({DEPARTMENT:"department",TYPE:"type",OCCUPANCY:"occupancy",VACANCY:"vacancy",PLAIN:"plain"}),[]),[Ji,Rl]=jn("department"),[Ia,Ru]=jn(!1),[hl,Nl]=jn(!1),dl=(O,he)=>{const Ie=new Set(O);return(he||[]).forEach(qe=>{qe&&Ie.add(qe)}),Array.from(Ie).sort()},No=Qn(O=>{const he=_.current;if(!he||!he.getLayer(Bf))return;const Ie=Array.isArray(O)?O.filter(Qe=>Qe!=null):O!=null?[O]:[];Ct.current=Ie;const qe=Ie.length?["any",["in",["id"],["literal",Ie]],["in",["get","RevitId"],["literal",Ie]]]:["==",["id"],""];try{he.setFilter(Bf,qe),he.getLayer(cg)&&he.setFilter(cg,qe)}catch{}},[]),[aa,Dl]=jn(new Map),[Ec,ma]=jn(!1),[Lo,$o]=jn(null),[Ca,rc]=jn([]),[fl,Nu]=jn(null),el=wo([]),Ac=Qn((O=[])=>(O||[]).map(he=>he?.highlightId??he?.revitId??he?.roomId??null).filter(he=>he!=null),[]),Al=Qn((O=[])=>{const he=Ac(O);No(he.length?he:null)},[Ac,No]),pl=Qn(()=>{el.current=[],rc([]),Al([])},[Al]),ic=Qn(O=>{const he=_.current,Ie=Gu(he,da);if(!Ie)return;const qe=Ie._data||Ie.serialize?.()?.data||null,Qe=Tu(qe);if(!Qe?.features?.length)return;const Fe=new Map,$e=new Map,St=gt=>{if(Number.isFinite(gt))return gt;const Zt=Number(gt);return Number.isFinite(Zt)?Zt:String(gt)};Qe.features.forEach(gt=>{const Zt=gt.properties||{},Kt=kf(Zt);if(!Number.isFinite(Kt)||Kt<=0)return;const gn=Zt.__roomType??Zt.NCES_Type??Zt.RoomType??Zt["Room Type"]??Zt.Type??Zt.type??Zt.Name??"",en=cv(gn);let $t="",un="#e6e6e6";const vr=(rr={})=>{const ni=rr.occupancyStatus??rr["Occupancy Status"]??rr.OccupancyStatus??rr.Occupancy??rr.Vacancy??rr.vacancy??rr.Vacant??"",Yr=String(ni??"").trim();if(Yr){const Gi=Yr.toUpperCase();return Gi.includes("VACANT")||Gi.includes("UNOCCUPIED")||Gi.includes("AVAILABLE")||Gi.includes("UNASSIGNED")?"Vacant":Gi.includes("OCCUPIED")?"Occupied":"Unknown"}return(rr.occupant??rr.Occupant??"").toString().trim()?"Occupied":"Unknown"};if(O===Oo.TYPE)$t=(Zt.__roomType||"").toString().trim()||"Unknown",un=Q5($t);else if(O===Oo.OCCUPANCY){if(!en)return;$t=vr(Zt),un=$t==="Occupied"?"#29b6f6":$t==="Vacant"?"#ff7043":"#cfd8dc"}else if(O===Oo.VACANCY){if(!en)return;$t=vr(Zt),un=$t==="Vacant"?"#ff7043":"#cfd8dc"}else $t=Ky(Zt)||"Unspecified",un=Qd($t)||"#e6e6e6";const Pr=Fe.get($t)||{name:$t,areaSf:0,color:un};Pr.areaSf+=Kt,Pr.color=un,Fe.set($t,Pr);const Gn=St(gt.id??Zt.RevitId??Zt.id);if(Gn!=null){const rr=$e.get($t)||[];rr.push(Gn),$e.set($t,rr)}});const Mt=Array.from(Fe.values()).map(gt=>({...gt,ids:$e.get(gt.name)||[]})).sort((gt,Zt)=>(Zt.areaSf||0)-(gt.areaSf||0));lt(Mt),Te(new Map(Mt.map(gt=>[gt.name,gt.ids||[]])))},[Oo.OCCUPANCY,Oo.TYPE,Oo.VACANCY]),Fl=Qn(O=>{const he=_.current;if(!he||!he.getLayer(jo))return;const Ie=Gu(he,da),qe=Ie&&(Ie._data||Ie.serialize?.().data)||null,Qe=Tu(qe),Fe=O===Oo.VACANCY?Oo.OCCUPANCY:O,$e=c?Oo.PLAIN:Fe;if(!(c&&Ia)){if($e===Oo.PLAIN)try{he.setPaintProperty(jo,"fill-color","#f3f4f6"),he.setPaintProperty(jo,"fill-opacity",.86),lt([]),Te(new Map),ht(null);return}catch{}if($e===Oo.DEPARTMENT&&Qe?.features?.length){const St=new Map,Mt=new Map,gt=new Map,Zt=en=>{if(Number.isFinite(en))return en;const $t=Number(en);return Number.isFinite($t)?$t:en!=null?String(en):null};Qe.features.forEach(en=>{const $t=en.properties||{},un=Ky($t)||"Unspecified",vr=Qd(un)||"#e6e6e6";St.set(un,vr);const Pr=kf($t);if(Number.isFinite(Pr)&&Pr>0){const rr=Mt.get(un)||0;Mt.set(un,rr+Pr)}const Gn=Zt(en.id??$t.RevitId??$t.id);if(Gn!=null){const rr=gt.get(un)||[];rr.push(Gn),gt.set(un,rr)}});const Kt=[];St.forEach((en,$t)=>{Kt.push($t,en)});const gn=["match",["coalesce",["feature-state","department"],["get","department"],["get","Department"],["get","Dept"],["get","NCES_Department"],["get","NCES_Dept"]],...Kt,"#e6e6e6"];try{he.setPaintProperty(jo,"fill-color",gn),he.setPaintProperty(jo,"fill-opacity",1);const en=Array.from(St.entries()).map(([$t,un])=>({name:$t,color:un,areaSf:Mt.get($t)||0,ids:gt.get($t)||[]})).sort(($t,un)=>(un.areaSf||0)-($t.areaSf||0));lt(en),Te(new Map(en.map($t=>[$t.name,$t.ids||[]])));return}catch{}}if($e===Oo.TYPE&&Qe?.features?.length){const St=new Map,Mt=new Map,gt=new Map,Zt=$t=>{if(Number.isFinite($t))return $t;const un=Number($t);return Number.isFinite(un)?un:$t!=null?String($t):null};Qe.features.forEach($t=>{const un=$t.properties||{},vr=(un.__roomType||"").toString().trim()||"Unknown",Pr=Q5(vr);St.set(vr,Pr);const Gn=kf(un);if(Number.isFinite(Gn)&&Gn>0){const ni=Mt.get(vr)||0;Mt.set(vr,ni+Gn)}const rr=Zt($t.id??un.RevitId??un.id);if(rr!=null){const ni=gt.get(vr)||[];ni.push(rr),gt.set(vr,ni)}});const Kt=[];St.forEach(($t,un)=>{Kt.push(un,$t)});const en=["match",["case",["any",["!",["has","__roomType"]],["==",["get","__roomType"],""]],"Unknown",["get","__roomType"]],...Kt,"#e6e6e6"];try{he.setPaintProperty(jo,"fill-color",en),he.setPaintProperty(jo,"fill-opacity",1);const $t=Array.from(St.entries()).map(([un,vr])=>({name:un,color:vr,areaSf:Mt.get(un)||0,ids:gt.get(un)||[]})).sort((un,vr)=>(vr.areaSf||0)-(un.areaSf||0));lt($t),Te(new Map($t.map(un=>[un.name,un.ids||[]])));return}catch{}}rw(he,$e),ic($e),Rl($e)}},[Oo.OCCUPANCY,Oo.PLAIN,Oo.TYPE,Oo.VACANCY,rw,ic,c,Ia]);gi(()=>{el.current=Ca},[Ca]);const _u=Qn(()=>{ma(!1),$o(null),pl(),No(null),Sl(new Set),Nu(null)},[pl,No]);gi(()=>{c&&(ma(!1),$o(null),Sl(new Set),Nu(null),pl(),No(null))},[c,pl,No]);const vs=Lo?.targets?.length?Lo.targets:Lo?[Lo]:[],ga={...(vs[0]||null)?.feature?.properties||{},...Lo?.properties||{}},Go=["Occupied","Vacant","Unknown"],Po=(O={})=>O.occupancyStatus??O["Occupancy Status"]??O.OccupancyStatus??O.Occupancy??O.occupancy??"",Hs=(O={})=>O.seatCount??O.SeatCount??O["Seat Count"]??O.Seats??O.Capacity??O.rm_seats??O.SeatingCapacity??O["NCES_Seat Count"]??O.NCES_Seat_Count??O["NCES_Seat Count"]??O.NCES_SeatCount??"",ya=(O=[])=>{const he=Array.from(new Set((O||[]).map(Ie=>(Ie??"").toString().trim()).filter(Boolean)));return he.length?he.length===1?he[0]:"__MIXED__":""},Ol=vs.length>1,Dh=Lo?.properties?.occupancyStatus,Ju=Dh!=null?String(Dh).trim():"",xu=Ju.length>0,Du=Ol?xu?Ju:ya(vs.map(O=>{const he={...O?.feature?.properties||{},...O?.properties||{}};return Po(he)})):Ju||String(Po(ga)||"").trim(),Uc=Lo?.properties?.seatCount,bh=Uc!=null?String(Uc).trim():"",Fh=Ol?bh||ya(vs.map(O=>{const he={...O?.feature?.properties||{},...O?.properties||{}};return Hs(he)})):bh||String(Hs(ga)||"").trim(),tl=vs.length>0&&vs.every(O=>{const he={...O?.feature?.properties||{},...O?.properties||{},...Lo?.properties||{}},Ie=pd(he)||he.type||he["Room Type"]||he["Room Type Description"]||"";return cv(Ie)}),Tc=vs.length>0&&vs.every(O=>{const he={...O?.feature?.properties||{},...O?.properties||{},...Lo?.properties||{}},Ie=pd(he)||he.type||he["Room Type"]||he["Room Type Description"]||"";return R1(Ie)});qf(ga,["NCES_Category","NCES Category","NCES_Category_Code","NCES Category Code"]),qf(ga,["NCES_Type","NCES Type","NCES_Type_Code","NCES Type Code"]),qf(ga,["NCES_Type Description_Sh","NCES_Type Description","NCES Type Description","NCES_Type Description_Short"]);const As=wo(null),Bl=wo(null),Ws=wo(null),nu=wo(null),jr=wo({url:null,key:null,buildingId:null,floorId:null}),Qu=wo(null),eh=wo({}),Bi=wo({}),Tl=wo(new Map),ru=wo(new Map);wo({});const oc=wo(""),xs=wo(null),Ba=wo(null);wo({});const[iu,La]=jn(()=>c?"campus":"floor"),[Ar,ml]=jn("LEVEL_1"),[_a,Bo]=jn([]),Fu=wo(new Map),Ic=wo(new Map),sc=Wa(()=>{const O=n?.buildings?.features||[],he=O.find(qe=>String(qe?.properties?.id)===String(F));return he||O.find(qe=>(qe?.properties?.name||"")===(j||""))||null},[n,F,j]),Ii=sc?.properties?.name||j||F||"Building",za=Ar??(_a?.[0]||""),Un=c&&iu==="floor",Rs=Qn(O=>O?Fu.current.get(O)??[]:[],[]),Ns=Qn(O=>{if(!O)return null;const he=Cf(O);return he&&sm[he]?sm[he]:J8.has(O)?O:null},[]),lo=Qn((O,he)=>{const Ie=a0(he);if(!O||!Ie)return null;const qe=Ns(O);if(!qe||!Rs(qe).includes(Ie))return null;const $e=Ic.current.get(qe)?.get(Ie);if($e)return/^https?:\/\//i.test($e)?$e:Jd($e);const St=encodeURIComponent(tw),Mt=encodeURIComponent(qe),gt=encodeURIComponent(Ie);return Jd(`floorplans/${St}/${Mt}/Rooms/${gt}_Dept_Rooms.geojson`)},[Rs,Ns]),va=Qn(async O=>{const he=Ns(O);if(!he)return[];const Ie=Rs(he),qe=Ic.current.has(he);if(Ie.length&&qe)return Ie;const Qe=await jA(he),Fe=(Qe||[]).map(St=>a0(St?.id)).filter(Boolean),$e=new Map((Qe||[]).filter(St=>St?.id&&St?.url).map(St=>[St.id,St.url]));return Fu.current.set(he,Fe),Ic.current.set(he,$e),Fe},[Ns,Rs]),[gl,Jh]=jn([]),[ii,bu]=jn(!1);wo([]);const th=wo(null),Ks=Wa(()=>lo(j,Ar),[j,Ar,lo]);gi(()=>{th.current=Ks},[Ks]),gi(()=>{xn.current=Rt,On.current=!!Rt},[Rt]),gi(()=>{Ei.current=Lr,to.current=!!Lr},[Lr]),gi(()=>{if(!k||!_.current)return;const he=_.current.getCanvas();if(he){if(Rt){An.current=he.style.cursor||"",he.style.cursor="crosshair";return}Lr||(he.style.cursor=An.current||"")}},[k,Rt]),gi(()=>{if(!k||!_.current)return;const he=_.current.getCanvas();if(he){if(Lr){po.current=he.style.cursor||"",he.style.cursor=Lr==="move"?"move":"grab";return}Rt||(he.style.cursor=po.current||"")}},[k,Lr,Rt]),gi(()=>{!k||!Ks||Fl(Ji)},[k,Ks,Ji,Fl]),gi(()=>{!k||!Ks||ic(Ji)},[k,Ks,Ji,ic]),gi(()=>{ht(null),No(null)},[Ji,Ks,No]),gi(()=>{pl()},[F,Ks,pl]),gi(()=>{Aa(!1),pn(!1),gu(null),ss(""),Ya(!1),ks(!1),zs(null),Fr(""),Jo(!1),mo(!1),go(null),Mu("")},[F,j,Ar]),gi(()=>{Rt&&(Ot(null),Lt(""))},[F,j,Ar]),gi(()=>{Lr&&(Ir(null),wr(""))},[F,j,Ar]);const[Pa,Vc]=jn(!1),[ac,Qh]=jn(new Set),[Zf,nh]=jn({}),[vo,ca]=jn(""),[ja,nl]=jn(""),[xo,ou]=jn({totalSF:0,rooms:0,roomTypes:{},sfByRoomType:{}}),xa=Wa(()=>{const O=new Set([...Object.keys(xo.roomTypes||{}),...Object.keys(xo.sfByRoomType||{})]);return Array.from(O).map(he=>({type:he,count:xo.roomTypes?.[he]??0,sf:xo.sfByRoomType?.[he]??0}))},[xo]),[zl,Oh]=jn(!1),jl=wo(new Map),ka=wo(new Set),[wh,su]=jn(20),[Cc,Bh]=jn(null),Lc=wo(null),lc=wo(null),Ao="scenario-highlight",$i="rgba(255, 159, 64, 0.9)",Ou="#ff9f40",Ua=Qn(()=>{const O=_.current;if(O&&O.getLayer(Ao))try{O.removeLayer(Ao)}catch{}},[]),yl=Qn((O=[])=>{if(!O.length)return;const he=_.current;if(!he)return;const Ie=Gu(he,da);if(!Ie)return;const qe=Ie._data||Ie.serialize?.()?.data,Qe=Tu(qe);if(!Qe?.features?.length)return;const Fe=new Map;if(O.forEach(({revitId:gt,dept:Zt})=>{gt!=null&&Fe.set(String(gt),Zt??null)}),!Fe.size)return;let $e=!1;const St=Qe.features.map(gt=>{const Zt=gt.id??gt.properties?.RevitId;if(Zt==null)return gt;const Kt=String(Zt);if(!Fe.has(Kt))return gt;const gn=Fe.get(Kt),en={...gt.properties||{}},$t=gt.properties?.scenarioDepartment??null;gn?en.scenarioDepartment=gn:delete en.scenarioDepartment;const un=en.scenarioDepartment??null;return $t===un?gt:($e=!0,{...gt,properties:en})});if(!$e)return;const Mt={...Qe,features:St};try{Ie.setData(Mt)}catch{}jr.current&&(jr.current={...jr.current||{},fc:Mt})},[]),qc=Qn((O=[],he=jl.current)=>{const Ie=_.current;Ie&&Gu(Ie,da)&&O.forEach(qe=>{const Qe=he.get(qe);if(Qe?.revitId)try{a5(Qe.revitId).forEach($e=>{Ie.removeFeatureState({source:da,id:$e},"scenarioColor"),Ie.removeFeatureState({source:da,id:$e},"scenarioOutlineColor"),Ie.removeFeatureState({source:da,id:$e},"scenarioDepartment")})}catch{}})},[]),rl=Qn(()=>{const he=Array.from(jl.current.values()).filter(Ie=>Ie?.revitId!=null).map(Ie=>({revitId:Ie.revitId,dept:null}));qc(Array.from(ka.current),jl.current),he.length&&yl(he),jl.current=new Map,ka.current=new Set,Qh(new Set),nh({}),ou({totalSF:0,rooms:0,roomTypes:{},sfByRoomType:{}}),ca(""),nl(""),Oh(!1),Bh(null),su(20),Uo(!1),Ua()},[qc,Ua,yl]),_l=Qn(()=>{rl()},[rl]),Sh=Qn(()=>{const O=_.current;if(!(!O||!Gu(O,da))&&!O.getLayer(Ao))try{O.addLayer({id:Ao,type:"fill",source:da,paint:{"fill-color":["coalesce",["feature-state","scenarioColor"],$i],"fill-outline-color":["coalesce",["feature-state","scenarioOutlineColor"],Ou],"fill-opacity":1},filter:["==",["get","id"],""]}),O.getLayer(Dd)&&O.moveLayer(Ao,Dd),lw(O)}catch{}},[]),Ul=Qn(O=>{Sh();const he=_.current;if(!he||!he.getLayer(Ao))return;const Ie=Array.isArray(O)?O.flatMap(Fe=>a5(Fe)):[],qe=Array.from(new Set(Ie)),Qe=qe.length?["any",["in",["id"],["literal",qe]],["in",["get","RevitId"],["literal",qe]],["in",["get","Revit_UniqueId"],["literal",qe]],["in",["get","Revit Unique Id"],["literal",qe]],["in",["get","Room GUID"],["literal",qe]]]:["==",["id"],""];try{he.setFilter(Ao,Qe)}catch{}},[Sh]),Vl=Qn(O=>{const he={totalSF:0,rooms:0,roomTypes:{},sfByRoomType:{}},Ie=[],qe=jl.current;return O.forEach(Qe=>{const Fe=qe.get(Qe);if(!Fe)return;const $e=Number.isFinite(Number(Fe.area))?Number(Fe.area):0,St=na(Fe.roomType??Fe.type??"Unknown")||"Unknown";he.rooms+=1,he.totalSF+=$e,he.roomTypes[St]=(he.roomTypes[St]||0)+1,he.sfByRoomType[St]=(he.sfByRoomType[St]||0)+$e,Fe.revitId!=null&&Ie.push(Fe.revitId),Fe.roomGuid&&Fe.roomGuid!==Fe.revitId&&Ie.push(Fe.roomGuid)}),{totals:he,highlightIds:Ie}},[]),cc=Qn((O,he)=>{const Ie=O?.buildingLabel&&(O?.floorName||O?.floorId)&&O?.revitId!=null?Yd(O.buildingLabel,O.floorName||O.floorId,O.revitId):null,qe=O?.roomId||Ie||O?.id||[O?.buildingLabel,O?.floorName||O?.floorId,O?.roomLabel,he].filter(Boolean).join("|")||`cand-${he}`,Qe=O?.roomGuid??O?.revitUniqueId??O?.revitUniqueID??null,Fe=O?.revitId??Qe??null;return{roomId:qe,buildingId:O?.buildingLabel||"",buildingName:O?.buildingLabel||"",floorName:O?.floorName||O?.floorId||"",revitId:Fe,roomGuid:Qe,roomNumber:O?.roomLabel||"",roomType:O?.type||"Unspecified",department:O?.department||"",area:Number(O?.sf||0)||0}},[]),zh=Qn(O=>{nh(he=>{const Ie={};return O.forEach(qe=>{he[qe]&&(Ie[qe]=he[qe])}),Ie})},[]),lr=Qn(O=>{const{totals:he,highlightIds:Ie}=Vl(O),qe=ka.current,Qe=Array.from(qe).filter(Fe=>!O.has(Fe));Qe.length&&qc(Qe,jl.current),ka.current=new Set(O),ou(he),Oh(O.size>0),Ul(Ie),zh(O)},[Vl,Ul,qc,zh]),$c=Qn((O=[])=>{const he=ka.current;he?.size&&qc(Array.from(he),jl.current),jl.current=new Map,ka.current=new Set;const Ie=new Set;(O||[]).forEach((qe,Qe)=>{const Fe=cc(qe,Qe);Fe?.roomId&&(jl.current.set(Fe.roomId,Fe),Ie.add(Fe.roomId))}),Qh(Ie),lr(Ie)},[cc,qc,lr]),C=Qn(O=>{O?.roomId&&Qh(he=>{const Ie=new Set(he);return Ie.has(O.roomId)?Ie.delete(O.roomId):(Ie.add(O.roomId),jl.current.set(O.roomId,O)),lr(Ie),Ie})},[lr]),B=Qn((O,he=.35)=>C8(O,he),[]),ee=Qn((O,he={})=>{const Ie=jl.current.get(O);if(!Ie?.revitId)return;const qe=_.current;if(!qe||!Gu(qe,da))return;const Qe={...he};if(Object.keys(Qe).length)try{a5(Ie.revitId).forEach($e=>{qe.setFeatureState({source:da,id:$e},Qe)})}catch{}},[]),oe=Qn(()=>{if(!vo||ac.size===0)return;const O=Qd(vo)||Ou,he=B(O,.9);nh(qe=>{const Qe={...qe};return ac.forEach(Fe=>{Qe[Fe]=vo,ee(Fe,{scenarioColor:he,scenarioOutlineColor:O,scenarioDepartment:vo})}),Qe});const Ie=[];ac.forEach(qe=>{const Qe=jl.current.get(qe);Qe?.revitId!=null&&Ie.push({revitId:Qe.revitId,dept:vo})}),Ie.length&&yl(Ie)},[vo,ac,ee,B,yl]),Pe=Qn(async()=>{if(!Oi){alert("No scenario comparison available yet.");return}try{const O=new wi("p","pt","letter"),he=O.internal.pageSize.getWidth(),Ie=O.internal.pageSize.getHeight(),qe=36,Qe=he-qe*2,Fe=14;let $e=qe;const St=(kr=Fe)=>{$e+kr>Ie-qe&&(O.addPage(),$e=qe)},Mt=(kr,Kr={})=>{const ki=Kr.indent||0;St(Fe),O.text(String(kr),qe+ki,$e),$e+=Fe},gt=(kr,Kr={})=>{const ki=Kr.indent||0,Vn=Math.max(50,Qe-ki);O.splitTextToSize(String(kr),Vn).forEach(hn=>Mt(hn,{indent:ki}))},Zt=kr=>{kr&&(St(Fe*1.2),O.setFont(void 0,"bold"),O.setFontSize(12),gt(kr),O.setFont(void 0,"normal"),O.setFontSize(11))},Kt=(kr=[])=>{const Kr=Array.isArray(kr)?kr:[];Kr.length&&Kr.forEach(ki=>gt(`- ${ki}`,{indent:8}))},gn=(kr={})=>{let Kr=0,ki=0,Vn=0;for(const[on,hn]of Object.entries(kr||{})){const Hn=String(on||"").toLowerCase(),tr=Number(hn||0)||0;Hn.includes("office")?Kr+=tr:Hn.includes("class")?ki+=tr:Hn.includes("lab")&&(Vn+=tr)}return{offices:Kr,classrooms:ki,labs:Vn}},en=Oi?.scenarioDept||vo||"Scenario",$t=Xt?.__label||"baseline",un=Ii||j||F||"scenario",vr=Ar?` (${Ar})`:"";O.setFontSize(16),O.setFont(void 0,"bold"),Mt("Scenario Comparison"),O.setFont(void 0,"normal"),O.setFontSize(11),gt(`${en} - ${$t} to ${un}${vr}`),Oi.summary&&(Zt("Summary"),gt(Oi.summary)),Zt("Totals");const Pr=Xt||{},Gn=xo||{},rr=gn(Pr.roomTypes),ni=gn(Gn.roomTypes);Mt(`Baseline (${$t})`),Mt(`Total SF: ${Math.round(Pr.totalSF||0).toLocaleString()}`,{indent:8}),Mt(`Rooms: ${Math.round(Pr.rooms||0).toLocaleString()}`,{indent:8}),(rr.offices||rr.classrooms||rr.labs)&&(Mt(`Offices: ${rr.offices}`,{indent:8}),Mt(`Classrooms: ${rr.classrooms}`,{indent:8}),Mt(`Labs: ${rr.labs}`,{indent:8})),$e+=Fe/2,Mt(`Scenario (${un})`),Mt(`Total SF: ${Math.round(Gn.totalSF||0).toLocaleString()}`,{indent:8}),Mt(`Rooms: ${Math.round(Gn.rooms||0).toLocaleString()}`,{indent:8}),(ni.offices||ni.classrooms||ni.labs)&&(Mt(`Offices: ${ni.offices}`,{indent:8}),Mt(`Classrooms: ${ni.classrooms}`,{indent:8}),Mt(`Labs: ${ni.labs}`,{indent:8}));const Yr=(Gn.totalSF||0)-(Pr.totalSF||0),Jr=(Gn.rooms||0)-(Pr.rooms||0);Mt(`Delta SF: ${Math.round(Yr).toLocaleString()}`,{indent:8}),Mt(`Delta Rooms: ${Math.round(Jr).toLocaleString()}`,{indent:8}),Oi?.scenarioPros?.length&&(Zt("Pluses"),Kt(Oi.scenarioPros)),Oi?.scenarioCons?.length&&(Zt("Minuses"),Kt(Oi.scenarioCons)),Oi?.risks?.length&&(Zt("Risks / watchouts"),Kt(Oi.risks)),Oi?.notes?.length&&(Zt("Notes"),Kt(Oi.notes)),Array.isArray(Oi?.data_used)&&Oi.data_used.length&&(Zt("Data used"),gt(Oi.data_used.join(", ")));const Gi=(kr,Kr)=>{if(!kr?.data)return;O.addPage();const ki=36,Vn=O.internal.pageSize.getWidth(),on=O.internal.pageSize.getHeight(),hn=Kr?`Floorplan - ${Kr}`:"Floorplan";O.setFont(void 0,"bold"),O.setFontSize(14),O.text(hn,ki,ki),O.setFont(void 0,"normal"),O.setFontSize(11);const Hn=kr.height&&kr.width?kr.height/kr.width:1;let tr=Vn-ki*2,Qr=tr*Hn;const co=on-ki*2-18;Qr>co&&(Qr=co,tr=Qr/(Hn||1));const Do=ki,ei=ki+18;O.addImage(kr.data,"PNG",Do,ei,tr,Qr)},Or=new Map;ac.forEach(kr=>{const Kr=jl.current.get(kr);if(!Kr)return;const ki=Kr?.buildingName||Kr?.buildingId||Ii||j||"",Vn=Kr?.floorName||Kr?.floorId||Ar||"";if(!ki||!Vn)return;const on=`${Qc(ki)}|${Na(Vn)}`;Or.has(on)||Or.set(on,{buildingLabel:ki,floorLabel:Vn,ids:[]});const hn=Or.get(on);Kr?.revitId!=null&&hn.ids.push(Kr.revitId),Kr?.roomGuid&&Kr.roomGuid!==Kr.revitId&&hn.ids.push(Kr.roomGuid)});const Ur=[];if(Or.size)for(const kr of Or.values()){const Kr=await va(kr.buildingLabel),ki=N1(kr.floorLabel,Kr)||kr.floorLabel,Vn=lo(kr.buildingLabel,ki);if(!Vn)continue;let on=gs.get(Vn);if(!on)try{on=await dd(Vn),on&&gs.set(Vn,on)}catch{}const hn=Tu(on);if(!hn?.features?.length)continue;const Hn=Kg({fc:hn,colorMode:Ji,solidFill:!0,selectedIds:kr.ids,labelOptions:{hideDrawing:!0}});Hn?.data&&Ur.push({img:Hn,label:`${kr.buildingLabel} - ${ki}`})}if(Ur.length)Ur.forEach(kr=>Gi(kr.img,kr.label));else{const kr=[];ac.forEach(Vn=>{const on=jl.current.get(Vn);on?.revitId!=null&&kr.push(on.revitId),on?.roomGuid&&on.roomGuid!==on.revitId&&kr.push(on.roomGuid)});const Kr=jr?.current;let ki=Kr?.fc?Kg({...Kr,colorMode:Ji,solidFill:!0,selectedIds:kr,labelOptions:{hideDrawing:!0}}):null;if(!ki?.data&&j&&Ar){const Vn=lo(j,Ar);if(Vn){let on=gs.get(Vn);if(!on)try{on=await dd(Vn),on&&gs.set(Vn,on)}catch{}const hn=Tu(on);hn?.features?.length&&(ki=Kg({fc:hn,colorMode:Ji,solidFill:!0,selectedIds:kr,labelOptions:{hideDrawing:!0}}))}}if(ki?.data){const Vn=Kr?.floor||Kr?.floorId||Ar||"";Gi(ki,Vn||"")}}const Ui=`${en}-scenario-compare`.replace(/\s+/g,"-").replace(/[^\w-]+/g,"").toLowerCase();O.save(`${Ui}.pdf`)}catch(O){console.error("Scenario export failed",O),alert("Export failed - see console for details.")}},[Oi,vo,Xt,xo,Ii,j,F,Ar,ac,Ji,va,N1,lo,dd]);gi(()=>{Pa&&Sh()},[Pa,Sh]),gi(()=>{if(!Pa||ac.size===0)return;const{highlightIds:O}=Vl(ac);Ul(O)},[Pa,ac,Ks,Vl,Ul]);const[je,Ke]=jn(!1),[Ye,tt]=jn(null),[ut,Nt]=jn(null);gi(()=>{je||Pa||Al(Ca)},[Ca,Al,je,Pa]);const rn=O=>{const he=m.current?.clientWidth??0,Ie=m.current?.clientHeight??0,qe=he||1e3,Qe=Ie||800,Fe=O.x+110,$e=O.y-160,St=Math.max(8,Qe*.15),Mt=Math.max(St,Math.min(Qe-220,Qe*.65));return{x:Math.min(Math.max(Fe,8),qe-260),y:Math.min(Math.max($e,St),Mt)}},ft=Qn(O=>{!O||Cc||su(()=>{const he=m.current?.clientHeight??0,Ie=Math.max(360,(he||0)*.7),qe=Math.max(8,(he||800)-Ie-40),Qe=O.y-120;return Math.max(8,Math.min(Qe,qe))})},[Cc]),zt=Qn(()=>{Cc||su(O=>{const he=m.current?.clientHeight??0,Ie=Math.max(360,(he||0)*.7),qe=Math.max(8,(he||800)-Ie-40);return Math.max(8,Math.min(O-40,qe))})},[Cc]),[Jt,En]=jn(null),[y,a]=jn(!1),[f,v]=jn(!1),[S,T]=jn(!1),[N,z]=jn([]),$=Qn(O=>O?Cf(O):null,[]),Q=Qn(async O=>{if(!O)return null;const he=[];if(typeof O=="string"&&O.endsWith("_Dept.geojson")){const $e=O.replace(/\/([^/]+)$/,"/Rooms/$1");he.push(O.replace("_Dept.geojson","_Dept_Rooms.geojson").replace(/\/([^/]+)$/,"/Rooms/$1")),he.push($e),he.push(O.replace("_Dept.geojson","_Dept_Rooms.geojson")),he.push(O)}else he.push(O);for(const $e of he)if(Bi.current[$e])return Bi.current[$e];let Ie=null,qe=null;for(const $e of he)if(Ie=gs.get($e),Ie||(Ie=await dd($e),Ie&&gs.set($e,Ie)),Ie){qe=$e;break}if(!Ie)return console.warn("Floor summary: no data returned",O),null;const Qe=Tu(Ie);if(!Array.isArray(Qe?.features))return console.warn("Floor summary: no features, skipping",qe||O),null;const Fe=R3(Qe.features);for(const $e of he)Bi.current[$e]=Fe;return Fe},[]),te=Qn(async(O,he)=>{const Ie=lo(O,he);return Ie?Q(Ie):null},[lo,Q]),ge=Qn(async O=>{if(!O)return null;const he=$(O)||O;if(!he)return null;if(eh.current[he])return eh.current[he];const Ie=Ns(he);let qe=Ie?Rs(Ie):[];if(qe.length||(qe=await va(he)),!qe.length)return null;const Qe=fp(O),Fe={totalSf:0,classroomSf:0,labSf:0,officeSf:0,rooms:0,classroomCount:0,labCount:0,officeCount:0,deptCounts:new Map};for(const St of qe){const Mt=lo(he,St);if(!Mt)continue;const gt=Na(St),Zt=`${Qe}/${gt}`;let Kt=Tl.current.get(Zt);Kt||(Kt=Bi.current[Mt],Kt||(Kt=await te(he,St)),Kt&&Tl.current.set(Zt,Kt)),Kt&&(Fe.totalSf+=Kt.totalSf||0,Fe.classroomSf+=Kt.classroomSf||0,Fe.labSf+=Kt.labSf||0,Fe.officeSf+=Kt.officeSf||0,Fe.rooms+=Kt.rooms||0,Fe.classroomCount+=Kt.classroomCount||0,Fe.labCount+=Kt.labCount||0,Fe.officeCount+=Kt.officeCount||0,Object.entries(Kt.deptCounts||{}).forEach(([gn,en])=>{Fe.deptCounts.set(gn,(Fe.deptCounts.get(gn)||0)+en)}))}const $e=jy(Fe);return eh.current[he]=$e,$e},[te,$,Rs,Ns,lo,va]),Ae=Qn(async O=>{if(!O)return{totalSf:void 0,rooms:void 0,classroomSf:void 0,classroomCount:void 0,labSf:void 0,labCount:void 0,officeSf:void 0,officeCount:void 0,totalsByDept:{}};if(Qt&&Array.isArray(yt)&&yt.length){const Ie=uo(O);if(Ie){const qe=yt.filter(Fe=>{const $e=Fe?.building??Fe?.buildingName??Fe?.buildingLabel??"";return uo($e)===Ie}),Qe=Xg(qe);if(Qe)return Qe}}return await ge(O)??{totalSf:void 0,rooms:void 0,classroomSf:void 0,classroomCount:void 0,labSf:void 0,labCount:void 0,officeSf:void 0,officeCount:void 0,totalsByDept:{}}},[ge,Qt,yt]),Le=Qn(async()=>{const O=av();return(await Promise.all(fd.map(async Ie=>{if(!Ie?.name)return null;try{return await Ae(Ie.name)}catch(qe){return console.warn("Campus summary: failed to load building stats for",Ie.name,qe),null}}))).forEach(Ie=>{if(!Ie)return;O.totalSf+=Ie.totalSf||0,O.classroomSf+=Ie.classroomSf||0,O.labSf+=Ie.labSf||0,O.officeSf+=Ie.officeSf||0,O.rooms+=Ie.rooms||0,O.classroomCount+=Ie.classroomCount||0,O.labCount+=Ie.labCount||0,O.officeCount+=Ie.officeCount||0;const qe=Ie.deptCounts||Ie.totalsByDept||{};Object.entries(qe).forEach(([Qe,Fe])=>{const $e=Number(Fe)||0;O.deptCounts.set(Qe,(O.deptCounts.get(Qe)||0)+$e)})}),jy(O)},[Ae]);gi(()=>{let O=!1;return(async()=>{try{const Ie=await Le();if(O)return;xr(Ie),Er($u(Ie,"campus"))}catch(Ie){if(O)return;console.warn("Campus summary load failed",Ie),xr(null),Er($u(null,"campus"))}})(),()=>{O=!0}},[Le]);const Ze=Qn(async O=>{const he=Ns(O);if(!he)return;let Ie=Rs(he);if(Ie.length||(Ie=await va(O)),!!Ie.length)try{await Promise.all(Ie.map(qe=>te(O,qe)))}catch(qe){console.warn("Floor summary prefetch failed:",qe)}},[Ns,Rs,te,va]),Ue=Qn(O=>{if(Si("building"),Dn(null),!O){Ln(null),or($u(null,"building"));return}const he=$(O)||O;if(xs.current=he,Ws.current=null,jr.current={url:null,key:null,buildingId:null,floorId:null},or({loading:!0,mode:"building"}),Qt&&Array.isArray(yt)&&yt.length){const Ie=uo(O);if(Ie){const qe=yt.filter(Fe=>{const $e=Fe?.building??Fe?.buildingName??Fe?.buildingLabel??"";return uo($e)===Ie}),Qe=Xg(qe);if(Qe){Ln(Qe),or($u(Qe,"building"));return}}}Ae(O).then(Ie=>{xs.current===he&&(Ws.current||(Ln(Ie),or($u(Ie,"building"))))}).catch(()=>{xs.current===he&&(Ws.current||(Ln(null),or($u(null,"building"))))})},[Ae,$]),Xe=Qn(O=>{if(!O)return;Si("floor"),Ws.current=O,or({loading:!0,mode:"floor"});const he=jr.current;if(Qt&&Array.isArray(yt)&&yt.length){const qe=he?.buildingId||F||j,Qe=he?.floorLabel||Ar||"",Fe=yt.filter(St=>{const Mt=St?.building??St?.buildingName??St?.buildingLabel??"";if(uo(Mt)!==uo(qe))return!1;if(!Qe)return!0;const gt=Lf(Qe);return gt.length?Tf(St?.floor??St?.floorName??St?.floorId??"",gt):!0}),$e=Xg(Fe);if($e){const St={...$e,floorLabel:Qe};Bi.current[O]=$e,Dn(St),lt(pp(em($e.totalsByDept))),or($u($e,"floor"));return}}const Ie=Bi.current[O];if(Ie){const qe=he?.floorLabel||Ar||"";Dn({...Ie,floorLabel:qe}),lt(pp(em(Ie.totalsByDept))),or($u(Ie,"floor"));return}if(he?.url===O&&he?.key){const qe=Tl.current.get(he.key);if(qe){const Qe=he.floorLabel||Ar||"";Dn({...qe,floorLabel:Qe}),lt(pp(em(qe.totalsByDept))),or($u(qe,"floor"));return}}Q(O).then(qe=>{if(Ws.current!==O)return;const Qe=jr.current;Qe?.url===O&&Qe?.key&&qe&&Tl.current.set(Qe.key,qe);const Fe=Qe?.floorLabel||Ar||"";Dn(qe?{...qe,floorLabel:Fe}:null),lt(pp(em(qe?.totalsByDept))),or($u(qe,"floor"))}).catch(()=>{Ws.current===O&&(Dn(null),or($u(null,"floor")))})},[Q,Ar]),_e=Qn(async()=>{try{const O=await Kd("/ai/api/rooms",{cache:"no-store",timeoutMs:8e3});let he=null;try{he=await O.json()}catch{}if(O.ok&&he?.ok&&Array.isArray(he.rooms))return pt(he.rooms),_o(new Date),!0}catch{}return!1},[]),Ge=Qn(()=>{qo.current||(qo.current=setTimeout(()=>{qo.current=null,_e()},300))},[_e]),it=Qn(async()=>{if(Nr)return;$r(!0),Ti("");const O=await _e(),he=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});Ti(O?`Refreshed ${he}`:"Refresh failed"),$r(!1)},[Nr,_e]);gi(()=>()=>{qo.current&&(clearTimeout(qo.current),qo.current=null)},[]);const ot=Qn(async O=>{if(t!=="admin"||!y||!O||!e)return null;const{buildingId:he,buildingName:Ie,floorName:qe,revitId:Qe,roomId:Fe,roomLabel:$e,roomNumber:St,roomGuid:Mt,properties:gt={}}=O;if(!he||!qe||Qe==null)return console.warn("Missing ids for room edit",O),null;const Zt=Yd(he,qe,Qe);try{const Kt=s0(mh,"universities",e,"buildings",he,"floors",qe,"rooms",Zt),gn=String(gt.type??"").trim(),en=pd(gt)||gn,$t=cv(en),un=$t?String(gt.occupancyStatus??"").trim():"",vr=String(gt.department??"").trim(),Pr=gt.occupant!=null,Gn=String(gt.occupant??"").trim(),rr=gt.seatCount!=null,ni=gt.seatCount,Yr=Number(ni),Jr=Number.isFinite(Yr)&&Yr>0?Yr:null,Gi={type:gn||"",department:vr||"",comments:gt.comments||"",updatedAt:E1()};$t&&(Gi.occupant=gt.occupant||"",Gi.occupancyStatus=gt.occupancyStatus||""),rr&&(Gi.seatCount=Jr),await $5(Kt,Gi,{merge:!0});const Or=gt.airtableId||gt.AirtableId||gt.airtableID||gt["Airtable ID"]||gt["Airtable Id"]||null,Ur={};un&&(Ur.occupancyStatus=un),gn&&(Ur.type=gn),vr&&(Ur.department=vr),$t&&Pr&&(Ur.occupant=Gn),rr&&(Ur.seatCount=Jr);const Ui=String(St??gt.roomNumber??gt.RoomNumber??gt.Number??$e??"").trim(),kr=String(Mt??gt.Revit_UniqueId??gt.revit_unique_id??gt.revitUniqueId??gt.RevitUniqueId??gt["Room GUID"]??gt.roomGuid??"").trim();let Kr=!1;if(Or&&Object.keys(Ur).length)try{const on=await Kd(`/ai/api/rooms/${Or}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(Ur)});if(on.ok)Kr=!0;else{const hn=await on.text().catch(()=>"");console.warn("Airtable update failed",on.status,hn)}}catch(on){console.warn("Airtable update failed",on)}if(!Kr&&(kr||Ui)&&Object.keys(Ur).length)try{const on=await Kd("/ai/api/rooms",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({roomId:kr||Ui,roomGuid:kr||void 0,building:he,buildingName:Ie||"",floor:qe,...Ur})});if(on.ok)Kr=!0;else{const hn=await on.text().catch(()=>"");console.warn("Airtable update by roomId failed",on.status,hn)}}catch(on){console.warn("Airtable update by roomId failed",on)}const ki={type:gt.type||"",department:gt.department||"",occupant:$t?gt.occupant||"":gt.occupant??"",occupancyStatus:$t?gt.occupancyStatus||"":gt.occupancyStatus??"",comments:gt.comments||""};rr&&(ki.seatCount=Jr,ki.SeatCount=Jr,ki["Seat Count"]=Jr),Dl(on=>{const hn=new Map(on||[]),Hn=Fe||Zt,tr=hn.get(Hn)||{};return hn.set(Hn,{...tr,...ki}),hn});let Vn=!1;qt(on=>{if(!Array.isArray(on)||!on.length)return on;const hn=gt.airtableId||gt.AirtableId||gt.airtableID||gt["Airtable ID"]||gt["Airtable Id"]||null,Hn=Wn=>String(Wn||"").trim().toLowerCase().replace(/[^a-z0-9]/g,""),tr=String(Fe??"").trim(),Qr=String($e??"").trim(),co=Qe!=null?String(Qe):"",Do=gt.area??gt.areaSF??gt["Area (SF)"]??gt.Area_SF??gt.Area??null,ei=Number(Do)||0,Hi=uo(he),Bn=uo(qe),$a=Hn(he),Zs=Hn(qe),mc=[];let ns=on.map((Wn,ba)=>{if(!Wn)return Wn;const Hc=Wn.airtableId||Wn.AirtableId||Wn["Airtable ID"]||null,Sd=String(Wn.roomId??Wn.id??"").trim(),gc=uo(Wn.building??Wn.buildingName??Wn.buildingLabel??""),jd=uo(Wn.floor??Wn.floorId??Wn.floorName??""),Nc=Hn(Wn.building??Wn.buildingName??Wn.buildingLabel??""),Vh=Hn(Wn.floor??Wn.floorId??Wn.floorName??""),Is=Hi&&gc===Hi||$a&&Nc===$a,$l=Bn&&jd===Bn||Zs&&Vh===Zs,uu=hn&&Hc&&String(Hc)===String(hn)||tr&&Sd===tr||co&&Sd===co||Qr&&Sd===Qr;let Ed=!1;if(!uu&&Is&&$l&&Qr){const qh=String(Wn.roomLabel??Wn.name??Wn.number??Wn.roomNumber??"").trim(),Vr=String(Wn.roomId??Wn.id??"").trim();Ed=qh&&qh===Qr||Vr&&Vr===Qr}if(!uu&&!Ed){if(Qr&&!Is&&!$l){const qh=String(Wn.roomId??Wn.id??"").trim();qh&&qh===Qr&&mc.push(ba)}return Wn}return Vn=!0,{...Wn,type:gt.type!=null?gt.type:Wn.type,department:gt.department!=null?gt.department:Wn.department,occupant:gt.occupant!=null?gt.occupant:Wn.occupant,occupancyStatus:gt.occupancyStatus!=null?gt.occupancyStatus:Wn.occupancyStatus,seatCount:rr?Jr:Wn.seatCount??Wn.SeatCount??Wn["Seat Count"],area:ei>0?ei:Wn.area??Wn.areaSF??Wn.sf??Wn.Area_SF??Wn.Area??Wn["Area (SF)"],areaSF:ei>0?ei:Wn.areaSF??Wn.sf??Wn.area??Wn.Area_SF??Wn.Area??Wn["Area (SF)"],sf:ei>0?ei:Wn.sf??Wn.areaSF??Wn.area??Wn.Area_SF??Wn.Area??Wn["Area (SF)"],roomLabel:Wn.roomLabel??Wn.name??Wn.number??Wn.roomNumber??Qr,comments:gt.comments!=null?gt.comments:Wn.comments}});if(!Vn&&Qr&&mc.length===1){const Wn=mc[0];ns[Wn]&&(Vn=!0,ns[Wn]={...ns[Wn],type:gt.type!=null?gt.type:ns[Wn].type,department:gt.department!=null?gt.department:ns[Wn].department,occupant:gt.occupant!=null?gt.occupant:ns[Wn].occupant,occupancyStatus:gt.occupancyStatus!=null?gt.occupancyStatus:ns[Wn].occupancyStatus,seatCount:rr?Jr:ns[Wn].seatCount??ns[Wn].SeatCount??ns[Wn]["Seat Count"],area:ei>0?ei:ns[Wn].area??ns[Wn].areaSF??ns[Wn].sf,areaSF:ei>0?ei:ns[Wn].areaSF??ns[Wn].sf??ns[Wn].area,sf:ei>0?ei:ns[Wn].sf??ns[Wn].areaSF??ns[Wn].area,roomLabel:ns[Wn].roomLabel??ns[Wn].name??ns[Wn].number??Qr,comments:gt.comments!=null?gt.comments:ns[Wn].comments})}if(!Vn&&Qr){const Wn=Hn(Qr),ba=Hn(he),Hc=Hn(qe);ns.some(gc=>{const jd=Hn(gc?.building??gc?.buildingName??gc?.buildingLabel??""),Nc=Hn(gc?.floor??gc?.floorId??gc?.floorName??""),Vh=Hn(gc?.roomLabel??gc?.name??gc?.number??gc?.roomNumber??gc?.roomId??gc?.id??"");return Vh&&Vh===Wn&&(!ba||jd===ba)&&(!Hc||Nc===Hc)})||(Vn=!0,ns=[...ns,{roomId:Qr,roomLabel:Qr,building:he,floor:qe,area:ei||0,areaSF:ei||0,sf:ei||0,type:gt.type||"",department:gt.department||"",occupant:gt.occupant||"",occupancyStatus:gt.occupancyStatus||"",seatCount:rr?Jr:null,comments:gt.comments||""}])}return ns}),Kr&&Ge();try{const on=jr.current;on&&on.url===Ws.current&&Tl.current.get(on.key)&&Tl.current.delete(on.key)}catch(on){console.warn("Failed to invalidate floor summary cache",on)}return Gi}catch(Kt){return console.error("Failed to save room edits",Kt),null}},[mh,e,Ge,t,y]);gi(()=>{if(j||!fd.length)return;const O=fd[0].name;H(O),ml("LEVEL_1")},[]),Qn(O=>{const he=_.current,Ie=m.current?.clientWidth||1e3,qe=m.current?.clientHeight||800;if(!he||!O?.geometry)return null;const Qe=Lu(O);if(!Qe||Qe.length!==4||Qe.some(gt=>!Number.isFinite(gt)))return null;const Fe=(Qe[1]+Qe[3])/2,$e=he.project({lng:Qe[2],lat:Fe}),St=Math.min(Math.max($e.x+12,8),Ie-360),Mt=Math.min(Math.max($e.y-120,8),qe-260);return{x:St,y:Mt}},[]);const bt=Qn(async O=>{await Zr(O)},[Zr]),wt=Qn(()=>{const O=Ii;return{buildingLabel:Dv({buildingLabel:O,buildingId:F||j||""})||O,floorId:za||Ar||""}},[Ii,F,j,za,Ar]),_t=Qn(()=>{const O=za||Ar||"",he=jr.current?.url||null,Ie=jr.current?.floorAdjustBasePath||null,qe=he?Fd(he):null,Qe=Ns(F||j)||qe,Fe=jr.current?.floorAdjustLabel||null,$e=jr.current?.floorAdjustFloorId||null,St=Ii,Mt=Fe||Qe||Dv({buildingLabel:St,buildingId:F||j||""})||St,gt=$e&&Na($e)===Na(O)?$e:O;return{buildingLabel:Mt,floorId:gt,url:he,basePath:Ie}},[Ii,F,j,za,Ar,Ns]),Pt=Qn((O,he)=>{const Ie=Qc(O||""),qe=Na(he||"");return`${Ie}__${qe}`},[]),kt=Qn(async(O,he)=>{if(!e||!O||!he)return null;const Ie=Pt(O,he);if(!Ie)return null;try{const qe=s0(mh,"universities",e,"floorAdjustments",Ie),Qe=await UE(qe);return Qe.exists()&&Qe.data()||null}catch{return null}},[mh,e,Pt]),jt=Qn(async(O,he,Ie)=>{if(!e||!O||!he||!Ie)return;const qe=Pt(O,he);if(qe)try{const Qe=s0(mh,"universities",e,"floorAdjustments",qe);await $5(Qe,{buildingLabel:O,floorId:he,rotationDeg:Number.isFinite(Ie.rotationDeg)?Ie.rotationDeg:0,scale:Number.isFinite(Ie.scale)?Ie.scale:1,translateMeters:Array.isArray(Ie.translateMeters)?Ie.translateMeters:[0,0],translateLngLat:Array.isArray(Ie.translateLngLat)?Ie.translateLngLat:null,anchorLngLat:Array.isArray(Ie.anchorLngLat)?Ie.anchorLngLat:null,pivot:Array.isArray(Ie.pivot)?Ie.pivot:null,updatedAt:E1(),updatedBy:Jt?.uid||Jt?.email||null},{merge:!0})}catch{}},[mh,e,Pt,Jt]),_n=Qn((O,he)=>{if(!Array.isArray(O)||O.length<2||!Array.isArray(he)||he.length<2)return null;const[Ie,qe]=O,[Qe,Fe]=he,$e=qe[0]-Ie[0],St=qe[1]-Ie[1],Mt=Fe[0]-Qe[0],gt=Fe[1]-Qe[1],Zt=Math.hypot($e,St),Kt=Math.hypot(Mt,gt);if(!Number.isFinite(Zt)||!Number.isFinite(Kt)||Zt<=0||Kt<=0)return null;const gn=Math.atan2(St,$e),en=Math.atan2(gt,Mt),$t=(gn-en)*180/Math.PI,un=Zt/Kt;return{rotationDeg:$t,scale:un,pivot:Qe,target:Ie}},[]);Qn(()=>{Ot(null),Lt("")},[]),Qn(()=>{if(!_.current||!_.current.getLayer(jo)){alert("Load a floorplan first, then start align.");return}const{buildingLabel:O,floorId:he}=wt();if(!O||!he){alert("Select a building and floor before aligning.");return}Lt(""),Ot({buildingLabel:O,floorId:he,roomPts:[],drawingPts:[],step:0})},[wt]),Qn(async()=>{const{buildingLabel:O,floorId:he}=wt();if(!O||!he)return;LU(O,he),Lt("");const Ie=lo(j,he);Ie&&(gs.delete(Ie),Wu.delete(Ie)),await Zr(he)},[wt,j,lo,Zr]);const Ut=Qn(()=>{if(!_.current||!_.current.getLayer(jo)){alert("Load a floorplan first, then rotate.");return}const{buildingLabel:O,floorId:he}=_t();if(!O||!he){alert("Select a building and floor before rotating.");return}wr(""),Ir("rotate")},[_t]),cn=Qn(()=>{if(!_.current||!_.current.getLayer(jo)){alert("Load a floorplan first, then move.");return}const{buildingLabel:O,floorId:he}=_t();if(!O||!he){alert("Select a building and floor before moving.");return}wr(""),Ir("move")},[_t]),Wt=Qn(()=>{Ir(null),wr("");try{_.current?.dragPan?.enable()}catch{}},[]),In=Qn(async()=>{const{buildingLabel:O,floorId:he}=_t();if(!O||!he)return;const Ie=jr.current?.floorAdjustLabel||O;PU(Ie,he);const qe=jr.current?.floorAdjustBasePath||null;qe&&MU(qe,he);const Qe=jr.current?.url||lo(j,he);Qe&&kU(Qe);try{await jt(Ie,he,{rotationDeg:0,scale:1,translateMeters:[0,0],translateLngLat:null,anchorLngLat:null,pivot:null})}catch{}wr("");const Fe=Qe||lo(j,he);Fe&&(gs.delete(Fe),Wu.delete(Fe)),await Zr(he)},[_t,j,lo,Zr,jt]),Bt=wt();z8(Bt.buildingLabel,Bt.floorId),Rt&&DA[Rt.step]?.label,Rt&&Rt.step;const Yt=_t(),Tn=Yt.basePath?By(Yt.basePath,Yt.floorId):null,bn=Yt.url?Oy(Yt.url):null,Rn=Wm(Yt.buildingLabel,Yt.floorId),hr=ew({base:Tn,url:bn,label:Rn}),mr=hr.adjust,sr=y?{source:hr.source,labelKey:yx(Yt.buildingLabel,Yt.floorId),urlKey:Yt.url?_x(Yt.url):null,baseKey:Yt.basePath?vx(Yt.basePath,Yt.floorId):null,floorId:Yt.floorId,url:Yt.url,basePath:Yt.basePath,savedAt:mr?.savedAt||0,rotationDeg:mr?.rotationDeg||0,scale:mr?.scale||1,translateMeters:mr?.translateMeters||[0,0],translateLngLat:mr?.translateLngLat||null,anchorLngLat:mr?.anchorLngLat||null,pivot:mr?.pivot||jr.current?.floorAdjustBasePivot||null,storedKeys:(()=>{if(typeof window>"u"||!window.localStorage)return[];try{const O=Object.keys(window.localStorage).filter(Ie=>Ie.startsWith(D8)||Ie.startsWith(F8)||Ie.startsWith(O8)),he=Na(Yt.floorId||"");return O.filter(Ie=>he&&Ie.includes(`/${he}`))}catch{return[]}})()}:null,dr=mr?.rotationDeg||0,oi=mr?.scale||1;mr?.translateMeters;const di=mp(mr),_r=Qn(()=>{za&&(za!==Ar&&ml(za),bt(za))},[za,bt,Ar]);async function Zr(O){if(!k||!_.current)return!1;const Ie=!!(O&&typeof O=="object"&&("nativeEvent"in O||"target"in O||"preventDefault"in O))?null:O,qe=a0(Ie||Ar),Qe=Wg(F,Ns)||Wg(j,Ns);let Fe=Qe?Rs(Qe):_a;(!Fe||Fe.length===0)&&Qe&&(Fe=await va(Qe));let $e=N1(qe,Fe),St=null;if(!$e&&Fe?.length&&($e=Fe[0]),!$e&&qe&&Ie&&Qe&&(!Fe||Fe.length===0)&&($e=qe,St=Jd(`floorplans/${tw}/${Qe}/Rooms/${$e}_Dept_Rooms.geojson`),Fe&&!Fe.includes($e)&&(Fe=[...Fe,$e],Fu.current.set(Qe,Fe))),!$e)return alert("This floor is not available for this building."),!1;$e!==Ar&&ml($e);const Mt=St||lo(j,$e);if(!Mt)return alert("No file mapped for that floor."),!1;try{Si("floor"),Dn(null),or({loading:!0,mode:"floor"});const gt=w.current?.[Mt],Zt=Wg(F,Ns)||Wg(j,Ns),Kt=Zt?Jd(`floorplans/Hastings/${Zt}`):null,gn=Mt?Fd(Mt):null,en=Qe||gn||Cf(F||j||"")||F||j,$t=Kt?By(Kt,$e):null,un=Mt?Oy(Mt):null,vr=Wm(en,$e),Gn=ew({base:$t,url:un,label:vr}).adjust,rr=mp(Gn),ni=Number(Gn?.savedAt)||0,Yr=await kt(en,$e);if(Yr){const hn={rotationDeg:Number(Yr.rotationDeg)||0,scale:Number(Yr.scale)||1,translateMeters:Array.isArray(Yr.translateMeters)?Yr.translateMeters:[0,0],translateLngLat:Array.isArray(Yr.translateLngLat)?Yr.translateLngLat:null,anchorLngLat:Array.isArray(Yr.anchorLngLat)?Yr.anchorLngLat:null,pivot:Array.isArray(Yr.pivot)?Yr.pivot:null},Hn=mp(hn),tr=(()=>{const co=Yr.updatedAt;return co?.toMillis?co.toMillis():Number.isFinite(co?.seconds)?co.seconds*1e3:0})();(tr?tr>=ni:!rr&&Hn)&&(P1(en,$e,hn),Mt&&k1(Mt,hn),Kt&&M1(Kt,$e,hn),Mt&&(gs.delete(Mt),Wu.delete(Mt)))}let Jr=Bl.current||null;const Gi=String(F||j||"");try{const hn=Xr(Gi),Hn=Xr(Jr?.properties?.id||Jr?.properties?.name||"");(!Hn||hn&&Hn!==hn)&&(Jr=null)}catch{}if(!Jr)try{const hn=n?.buildings?.features||[],Hn=hn.find(tr=>String(tr.properties?.id)===Gi)||null;Hn?Jr=Hn:Jr=If(hn,Gi),Jr&&(Bl.current=Jr)}catch{}!Jr&&sc&&(Jr=sc,Bl.current=sc),Jr||(Jr=sv(_.current,Gi),Jr&&(Bl.current=Jr));const Or=zV(Jr?.properties?.id||Jr?.properties?.name||F||j,$e),Ur=t==="admin"&&qU,Ui=await cV(_.current,Mt,gt,{fitBuilding:Jr,rotationOverrideDeg:Or},{buildingId:F||j,floor:$e,roomPatches:aa,airtableLookup:Es,currentFloorContextRef:jr,roomsBasePath:Kt,roomsFloorId:$e,enableWalls:Ur,wallsBasePath:Kt,wallsFloorId:$e,onOptionsCollected:({typeOptions:hn,deptOptions:Hn})=>{hn?.length&&_s(tr=>wU(tr,hn)),Hn&&Ps(tr=>dl(tr,Hn))}});if(!Ui)return or($u(null,"floor")),!1;bu(!0),hi(hn=>hn+1),Ws.current=Mt,nu.current=Mt;const kr=fp(F||j||""),Kr=Na($e||""),ki=kr&&Kr?`${kr}/${Kr}`:null;ki&&Ui.summary&&(Tl.current.set(ki,Ui.summary),ru.current.set(ki,Ui.rooms)),jr.current={...jr.current||{},url:Mt,key:ki,buildingId:kr,floorId:Kr,floorLabel:$e,floorAdjustLabel:en||jr.current?.floorAdjustLabel||null,floorAdjustFloorId:$e,floorAdjustBasePath:Kt||jr.current?.floorAdjustBasePath||null};const on=(Qt&&Array.isArray(yt)&&yt.length?Xg(yt.filter(hn=>{const Hn=hn?.building??hn?.buildingName??hn?.buildingLabel??"";if(uo(Hn)!==uo(F||j))return!1;const tr=Lf($e);return tr.length?Tf(hn?.floor??hn?.floorName??hn?.floorId??"",tr):!0})):null)||Ui.summary||null;if(on){Bi.current[Mt]=on,Tl.current.set(Mt,on);const hn={...on,floorLabel:$e};Dn(hn),lt(pp(em(on.totalsByDept))),Ws.current===Mt&&or($u(on,"floor"))}else Dn(null),or($u(null,"floor"));try{Fl(Ji),ic(Ji)}catch{}return ir(!1),Si("floor"),dc({x:12,y:12}),Re===Me.SPACE_DATA&&qA(_.current),!0}catch(gt){return console.error(gt),alert("Failed to load floor plan. See console for details."),bu(!1),!1}}const Pi=(O,he,Ie,qe,Qe,Fe,$e="Key Departments")=>{if(!he&&!Fe&&!Ie?.length)return;const St=14,Mt=qe+6,gt=24,Zt=Fe||"Totals";O.setFontSize(12),O.setFont(void 0,"bold"),O.text(Zt,Mt,gt);let Kt=gt+St;if(O.setFont(void 0,"normal"),he&&[he.totalSF!=null?`Total SF: ${Math.round(he.totalSF).toLocaleString()}`:null,he.rooms!=null?`Rooms: ${he.rooms}`:null,he.classroomSf!=null?`Classroom SF: ${Math.round(he.classroomSf).toLocaleString()}`:null,he.classroomCount!=null?`Classrooms: ${he.classroomCount}`:null,he.levels!=null?`Levels: ${he.levels}`:null].filter(Boolean).forEach(en=>{O.text(en,Mt,Kt),Kt+=St}),Ie?.length){Kt+=St/2,O.setFont(void 0,"bold"),O.text($e,Mt,Kt),Kt+=St,O.setFont(void 0,"normal");const gn=10;Ie.slice(0,8).forEach(en=>{const $t=en.color||Qd(en.name);O.setFillColor($t),O.rect(qe+6,Kt-8,gn,gn,"F"),O.setTextColor("#000");const un=en.areaSf?`${en.name} (${Math.round(en.areaSf).toLocaleString()} SF)`:en.name;O.text(un,qe+6+gn+4,Kt),Kt+=St})}},io=Qn((O,he={})=>{if(!Array.isArray(O)||!O.length){alert("No floorplan data to export.");return}try{const Ie=new wi("p","pt","letter"),qe=Ie.internal.pageSize.getWidth(),Qe=Ie.internal.pageSize.getHeight(),Fe=24,$e=he.stats||null,St=he.keyDepts||[],Mt=he.summaryLabel||"",gt=he.legendTitle||"Key Departments",Zt=he.filenameBase||"floorplan",Kt=!!($e||St&&St.length),gn=Kt?130:0,en=Kt?gn-12:0;O.forEach((un,vr)=>{const Pr=un?.img;if(!Pr?.data)return;vr>0&&Ie.addPage();const Gn=Pr.height&&Pr.width?Pr.height/Pr.width:1,rr=Kt?qe-Fe*2-gn-Fe:qe-Fe*2;let ni=Math.min(rr,Pr.width),Yr=ni*Gn;const Jr=Qe-Fe*2-40;Yr>Jr&&(Yr=Jr,ni=Yr/(Gn||1));const Gi=Fe;Ie.addImage(Pr.data,"PNG",Gi,Fe+20,ni,Yr),Ie.setFontSize(12);const Or=un.label||"";if(Or&&Ie.text(Or,Fe,Fe),Kt){const Ur=Math.min(qe-gn-Fe,Gi+ni+Fe*.75);Pi(Ie,$e,St,Ur,en,Mt||Or,gt)}});const $t=`${Zt.replace(/\s+/g,"-").toLowerCase()}.pdf`;Ie.save($t)}catch(Ie){console.error("Floor export failed",Ie),alert("Export failed - see console for details.")}},[]),oo=Qn(async({context:O,floorStats:he,panelStats:Ie})=>{const qe=await Kd("/ai/explain-floor",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context:O,floorStats:he,panelStats:Ie})}),Qe=await qe.text();let Fe=null;try{Fe=JSON.parse(Qe)}catch{}if(!qe.ok)throw new Error(Fe?.error||Qe||`HTTP ${qe.status}`);return Fe},[]),ua=Qn(async({context:O,campusStats:he,panelStats:Ie})=>{const qe=await Kd("/ai/explain-campus",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context:O,campusStats:he,panelStats:Ie})}),Qe=await qe.text();let Fe=null;try{Fe=JSON.parse(Qe)}catch{}if(!qe.ok)throw new Error(Fe?.error||Qe||`HTTP ${qe.status}`);return Fe},[]),us=Qn(async({context:O,baselineStats:he,scenarioStats:Ie,deltas:qe})=>{const Qe=await Kd("/ai/compare-scenario",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context:O,baselineStats:he,scenarioStats:Ie,deltas:qe})}),Fe=await Qe.text();let $e=null;try{$e=JSON.parse(Fe)}catch{}if(!Qe.ok)throw new Error($e?.error||Fe||`HTTP ${Qe.status}`);return $e},[]),uc=Qn(async({request:O,context:he,inventory:Ie,constraints:qe})=>{const Qe=await Kd("/ai/create-move-scenario",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({request:O,context:he,inventory:Ie,constraints:qe})}),Fe=await Qe.text();let $e=null;try{$e=JSON.parse(Fe)}catch{}if(!Qe.ok)throw new Error($e?.error||Fe||`HTTP ${Qe.status}`);return $e},[]),Pc=Qn(async({question:O,context:he,data:Ie})=>{const qe=await Kd("/ai/ask-mapfluence",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:O,context:he,data:Ie})}),Qe=await qe.text();let Fe=null;try{Fe=JSON.parse(Qe)}catch{}if(!qe.ok)throw new Error(Fe?.error||Qe||`HTTP ${qe.status}`);return Fe},[]),Ci=Qn(async({context:O,buildingStats:he,panelStats:Ie})=>{const qe=await Kd("/ai/explain-building",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context:O,buildingStats:he,panelStats:Ie})}),Qe=await qe.text();let Fe=null;try{Fe=JSON.parse(Qe)}catch{}if(!qe.ok)throw new Error(Fe?.error||Qe||`HTTP ${qe.status}`);return Fe},[]),Qi=Qn(async()=>{ss(""),pn(!0),gu(null);try{const O=jr.current,he={universityId:e,buildingId:O?.buildingId||F||j||"",buildingLabel:O?.buildingLabel||"",floorId:O?.floorId||Ar||"",floorLabel:O?.floorLabel||$n?.floorLabel||Ar||"",url:O?.url||""},Ie=await oo({context:he,floorStats:$n,panelStats:Li});gu(Ie),Aa(!0)}catch(O){ss(String(O?.message||O))}finally{pn(!1)}},[oo,$n,Li,F,j,Ar,e]),bo=Qn(async()=>{fs(""),El(!0),yu(null);try{const O=qs?{totalSf:Math.round(qs.totalSf||0),rooms:Math.round(qs.roomCount||0),totalsByDept:Object.fromEntries((qs.byDept||[]).map(qe=>[qe.name,Math.round(Number(qe.sf||0))])),byType:(qs.byType||[]).map(qe=>({type:qe.name,sf:Math.round(Number(qe.sf||0))})),occupancySummary:qs.occupancySummary||null,officeOccupancy:qs.officeOccupancy||null}:null,Ie=await ua({context:{universityId:e,campusLabel:be||e||"Campus",buildingId:"",buildingLabel:"",floorId:"",floorLabel:"",url:""},campusStats:O||Mr,panelStats:Sr});yu(Ie),xi(!0)}catch(O){fs(String(O?.message||O))}finally{El(!1)}},[be,Sr,Mr,qs,ua,e]),Ts=Qn(async()=>{Ms(""),nc(!0),Fa(null);try{if(!xo)throw new Error("No scenario totals available. Turn on Move Scenario Mode and make changes.");if(!vo)throw new Error("Select a department for the scenario before comparing.");const{perBuilding:O,campusTotals:he}=await YA(vo,{ensureFloorsForBuilding:va,buildFloorUrl:lo,floorCache:gs,fetchGeoJSON:dd});if(!he)throw new Error("No baseline stats for the selected department on this campus.");const qe=na(Ii||j||F||"").toLowerCase(),Qe=Object.entries(O||{}).sort(($t,un)=>(un[1]?.totalSF||0)-($t[1]?.totalSF||0)||(un[1]?.rooms||0)-($t[1]?.rooms||0)),Fe=Qe.find(([$t])=>na($t).toLowerCase()!==qe)||Qe[0]||null,$e=Fe?Fe[0]:"campus",St=Fe?Fe[1]:he;St&&(St.__label=$e||"campus");const Mt="campus",gt=F||j||"",Zt=Cf(F||j)||j||F||"",Kt={universityId:e,baselineScope:Mt,buildingId:gt,buildingLabel:Ii||"",floorId:Ar||"",scenarioDepartment:vo,baselineLabel:`Current allocation for ${vo} (${$e})`};console.log("Scenario compare baseline (dept campus-wide):",St),console.log("Scenario compare scenario (selection totals):",xo),fn(St);const gn={totalSF:(xo?.totalSF||0)-(St?.totalSF||0),rooms:(xo?.rooms||0)-(St?.rooms||0)},en=await us({context:Kt,baselineStats:St,scenarioStats:xo,deltas:gn,scenarioDept:vo||""});Fa(en),eu(!0)}catch(O){Ms(String(O?.message||O))}finally{nc(!1)}},[Ii,us,vo,xo,Ii,va,lo,gs,dd,j,F,Ar,e]);gi(()=>{Us&&(!vo||!xo?.rooms||(Uo(!1),Ts()))},[Us,vo,xo,Ts]);const Va=Qn(async()=>{Fr(""),ks(!0),zs(null);try{const Ie=await Ci({context:{universityId:e,buildingId:F||j||"",buildingLabel:Ii||"",floorId:"",floorLabel:"",url:""},buildingStats:Vt,panelStats:Li});zs(Ie),Ya(!0)}catch(O){Fr(String(O?.message||O))}finally{ks(!1)}},[Ii,Vt,Ci,Li,j,F,e]);gi(()=>{const O=T8();if(typeof window<"u"&&window.location.hostname.includes("github.io"))return qi(O?"ok":"down"),()=>{};if(!O)return qi("down"),()=>{};const Ie=H8("/ai/health"),qe=async()=>{try{const Fe=await Kd(Ie,{cache:"no-store",timeoutMs:3e3});qi(Fe.ok?"ok":"down")}catch{qi("down")}};qe();const Qe=setInterval(qe,3e4);return()=>clearInterval(Qe)},[]);const ts=Qn(()=>{const O=jr?.current;if(!O?.fc){alert("No floor loaded.");return}const he=et?Ee.get(et)||[]:[],Ie=Ac(el.current||[]),qe=Ct.current||[],Qe=Array.from(new Set([...he||[],...Ie||[],...qe||[]])),Fe=Kg({...O,colorMode:Ji,selectedIds:Qe,solidFill:!0,labelOptions:{hideDrawing:!0}});if(!Fe){alert("Unable to render floorplan.");return}const $e=`${Ii} - ${O.floorLabel||Ar||""}`.trim()||"Floor",St=O?.url?Bi.current[O.url]:null,Mt=$n??(St?{...St,floorLabel:O.floorLabel||Ar}:null),gt=li&&li.length?li:pp(Mt?.totalsByDept),Zt={department:"Key Departments",type:"Key Types",occupancy:"Occupancy",vacancy:"Vacancy"}[Ji]||"Legend";io([{img:Fe,label:$e}],{filenameBase:`${Ii}-${O.floorLabel||Ar||"floor"}`,stats:Mt,keyDepts:gt,summaryLabel:`${Ii} - ${O.floorLabel||Ar||""} (${Ji||"department"})`,legendTitle:Zt})},[Ii,Ar,io,Ji,li]),ps=Qn(()=>{lC(_.current,Ws);try{const he=_.current;he?.getLayer(P0)&&he.removeLayer(P0),he?.getSource(zv)&&he.removeSource(zv)}catch{}bu(!1),c&&La("campus"),oc.current="",Ws.current=null,nu.current=null,jr.current={url:null,key:null,buildingId:null,floorId:null},Dn(null),Si("building");const O=As.current||j;O&&Ue(O)},[j,Ue,c]);Qn(()=>{bT(_.current)},[]);const hs=Qn(()=>{const O=!Pa;Vc(O),O?(Oh(!0),Bh(null),su(20)):_l()},[_l,Pa,Oh]),bs=Qn(()=>{try{const O={markers:me,buildingConditions:ke,buildingAssessments:pe},he=new Blob([JSON.stringify(O,null,2)],{type:"application/json"}),Ie=document.createElement("a");Ie.href=URL.createObjectURL(he),Ie.download=`${e||"campus"}-map-data.json`,document.body.appendChild(Ie),Ie.click(),document.body.removeChild(Ie)}catch(O){console.warn("Export failed",O),alert("Export failed. See console for details.")}},[me,ke,pe,e]);Qn(()=>{alert("Export Drawing Entries not implemented in this build.")},[]);const zo=Qn(async(O="__all__",he="")=>{const Ie=O&&O!=="__all__"?[O]:fd.map(Fe=>Fe.name).filter(Boolean),qe=he.toLowerCase().trim(),Qe=[];for(const Fe of Ie){if(!Fe)continue;const $e=await va(Fe);if($e?.length)for(const St of $e){const Mt=lo(Fe,St);if(!Mt)continue;let gt;try{const Zt=await dd(Mt);gt=Tu(Zt)}catch(Zt){console.warn("Space export: failed to load",Mt,Zt);continue}if(gt?.features?.length)for(const Zt of gt.features){const Kt=Zt?.properties||{},gn=Zt?.id??Kt.RevitId??Kt.id,en=Fe&&St&&gn!=null?Yd(Fe,St,gn):null,$t=en&&aa instanceof Map?aa.get(en):null,un=$t?{...Kt,...$t}:Kt,vr=un.Number??un.RoomNumber??un.number??un.Room??"",Pr=pd(un)||un.Name||"",Gn=(un.department??un.Department??un.Dept??"").toString().trim();if(qe&&!Gn.toLowerCase().includes(qe))continue;const rr=kf(un),ni=Zb(un),Yr=un.occupant??un.Occupant??"";Qe.push({building:Fe,floor:St,roomNumber:vr||"",type:Pr||"",department:Gn||"",area:Number.isFinite(rr)?rr:"",seatCount:ni??"",occupant:Yr||"",roomId:en||"",revitId:gn??null})}}}return Qe},[lo,va,aa]);Qn(async()=>{const O=await zo("__all__","");return n5(O,250)||[]},[zo]);const ql=Qn(async(O="__all__",he="")=>{const Ie=O&&O!=="__all__"?[O]:fd.map(Zt=>Zt.name).filter(Boolean),qe=he.toLowerCase().trim(),Qe=[],Fe=av(),$e=(Zt,Kt,gn)=>{if(!Zt)return null;const en=un=>Number.isFinite(un)?Math.round(un):"",$t=un=>Number.isFinite(un)?Number(un):0;return{buildingId:gn||fp(Kt||""),buildingName:Kt||"",totalSf:en(Zt.totalSf),rooms:$t(Zt.rooms),classroomSf:en(Zt.classroomSf),classrooms:$t(Zt.classroomCount),labSf:en(Zt.labSf),labs:$t(Zt.labCount),officeSf:en(Zt.officeSf),offices:$t(Zt.officeCount),keyDepts:(Zt.keyDepts||[]).join("; ")}};for(const Zt of Ie){if(!Zt)continue;const Kt=await va(Zt);if(!Kt?.length)continue;const gn=av();for(const un of Kt){const vr=lo(Zt,un);if(!vr)continue;let Pr=gs.get(vr);Pr||(Pr=await dd(vr),Pr&&gs.set(vr,Pr));const Gn=Tu(Pr);if(Gn?.features?.length)for(const rr of Gn.features){const ni=rr?.properties||{},Yr=rr?.id??ni.RevitId??ni.id,Jr=Zt&&un&&Yr!=null?Yd(Zt,un,Yr):null,Gi=Jr&&aa instanceof Map?aa.get(Jr):null,Or=Gi?{...ni,...Gi}:ni,Ur=(Or.department??Or.Department??Or.Dept??"").toString().trim();qe&&!Ur.toLowerCase().includes(qe)||(iw(gn,Or),iw(Fe,Or))}}const en=jy(gn),$t=en?$e(en,Zt):null;$t&&($t.rooms||$t.totalSf)&&Qe.push($t)}const St=jy(Fe);return{campusRow:(!O||O==="__all__")&&St&&(St.rooms||St.totalSf)?$e(St,"Campus Total","campus"):null,buildingRows:Qe}},[lo,va,aa]),Il=Qn(async()=>{Mu(""),mo(!0),go(null);try{if(Fo==="down")throw new Error("AI server is offline.");const O=(Eo||"").trim();if(!O)throw new Error("Enter a short request for the move scenario.");const he=Qt&&Array.isArray(yt)?yt:[],Ie=pT(he),qe=vo||mT(O,Ie)||"",Qe=qe?_T(he,qe):[],Fe=new Set((Qe||[]).map(Vn=>uo(Vn)).filter(Boolean)),$e=gT(he),St=yT(O,$e)||"",Mt=St||"",gt="";let Zt=[];if(Qt&&Array.isArray(yt)&&yt.length)Zt=n5(yt,2e3)||[];else try{const Vn=await zo("__all__","");Zt=n5(Vn,250)||[]}catch{}if(!Zt.length){const Vn=jr?.current?.fc?.features||[];Zt=yV(Vn,Mt,gt,250)||[]}if(!Zt.length)throw new Error("No room inventory loaded yet. Load Space Data or a floorplan first.");if(St){const Vn=uo(St),on=Zt.filter(hn=>{const Hn=hn?.buildingLabel??hn?.building??hn?.buildingName??"";return uo(Hn)===Vn});if(!on.length)throw new Error(`No rooms found for ${St}.`);Zt=on}if(Fe.size){const Vn=Zt.filter(on=>{const hn=on?.buildingLabel??on?.building??on?.buildingName??"";return!Fe.has(uo(hn))});if(!Vn.length)throw new Error(`No rooms available outside the current ${qe||"department"} home building(s).`);Zt=Vn}Zt=W8(Zt);let Kt=null,gn="";if(qe)try{const{perBuilding:Vn,campusTotals:on}=await YA(qe,{ensureFloorsForBuilding:va,buildFloorUrl:lo,floorCache:gs,fetchGeoJSON:dd}),hn=Object.entries(Vn||{}).sort((Hn,tr)=>(tr[1]?.totalSF||0)-(Hn[1]?.totalSF||0)||(tr[1]?.rooms||0)-(Hn[1]?.rooms||0))[0]||null;Kt=hn?hn[1]:on,gn=hn?hn[0]:"",Kt&&(Kt={...Kt,__label:gn||"campus"})}catch{}const en=St?{maxTotal:260,maxPerBuilding:260,maxPerType:35}:{maxTotal:220,maxPerBuilding:90,maxPerType:25};Kt&&Zt.length>en.maxTotal?Zt=gV(Zt,Kt,{maxTotal:en.maxTotal,minPerType:St?8:5,maxPerType:St?45:35}):Zt=K8(Zt,en);const $t=new Map;Zt.forEach(Vn=>{if(!Vn)return;[Vn.roomId,Vn.id,Vn.revitId].filter(hn=>hn!=null).map(hn=>String(hn)).forEach(hn=>{$t.has(hn)||$t.set(hn,Vn)})});const un=Vn=>{if(!Vn||!Zt.length)return null;const on=uo(Vn?.buildingLabel||""),hn=Lf(Vn?.floorName||Vn?.floorId||""),Hn=fT(Vn?.roomLabel||Vn?.roomNumber||"");if(Hn){const Hi=Zt.find(Bn=>{const $a=uo(Bn?.buildingLabel??Bn?.buildingName??Bn?.building??"");if(on&&$a!==on||hn.length&&!Tf(Bn?.floorName??Bn?.floorId??"",hn))return!1;const Zs=fT(Bn?.roomLabel??Bn?.roomNumber??"");return Zs&&Zs===Hn});if(Hi)return Hi}const tr=ug(Vn?.type||""),Qr=Number(Vn?.sf||0),co=Number.isFinite(Qr)&&Qr>0;let Do=null,ei=Number.POSITIVE_INFINITY;return Zt.forEach(Hi=>{const Bn=uo(Hi?.buildingLabel??Hi?.buildingName??Hi?.building??"");if(on&&Bn!==on||hn.length&&!Tf(Hi?.floorName??Hi?.floorId??"",hn))return;const $a=ug(Hi?.type||Hi?.roomType||"");let Zs=0;if(tr&&$a?Zs+=$a===tr?0:1e3:tr&&(Zs+=500),co){const mc=Number(Hi?.sf??Hi?.area??Hi?.areaSF??0);Number.isFinite(mc)&&(Zs+=Math.abs(mc-Qr))}Zs<ei&&(ei=Zs,Do=Hi)}),Do},vr={universityId:e,campusLabel:be||e||"Campus",buildingLabel:St||"",floorId:gt,moveScenarioMode:!0,scenarioDepartment:vo||qe||"",targetDepartment:qe||vo||"",excludeBuildings:Qe||[],scenarioLabel:(ja||"").trim(),scope:St?"building":"campus"},Pr=Kt?{totalSF:Math.round(Kt.totalSF||0),rooms:Math.round(Kt.rooms||0),sfByType:Object.entries(Kt.sfByRoomType||{}).map(([Vn,on])=>({type:Vn,sf:Math.round(Number(on||0)||0)})),roomTypes:Object.entries(Kt.roomTypes||{}).map(([Vn,on])=>({type:Vn,count:Math.round(Number(on||0)||0)}))}:null,Gn=Pr?{baselineTotals:Pr,targetSfTolerance:Ml?.05:.1}:null,rr=await uc({request:O,context:vr,inventory:Zt,constraints:Gn}),ni=Array.isArray(rr?.recommendedCandidates)?rr.recommendedCandidates.map(Vn=>{const hn=[Vn?.roomId,Vn?.id,Vn?.revitId].filter(Qr=>Qr!=null).map(Qr=>String(Qr)).map(Qr=>$t.get(Qr)).find(Boolean)||un(Vn);if(!hn)return{...Vn,floorName:Vn?.floorName||Vn?.floorId||"",rationale:r5(Vn?.rationale)};const Hn=Number(hn.sf??hn.area??hn.areaSF??0),tr=Number(Vn?.sf??0);return{...Vn,roomId:Vn?.roomId||hn.roomId||hn.id||"",id:Vn?.id||hn.id||hn.roomId||"",revitId:Vn?.revitId??hn.revitId??null,roomGuid:Vn?.roomGuid??hn.roomGuid??hn.revitId??null,buildingLabel:Vn?.buildingLabel||hn.buildingLabel||hn.buildingName||hn.building||"",roomLabel:Vn?.roomLabel||hn.roomLabel||hn.roomNumber||"",type:Vn?.type||hn.type||hn.roomType||"",sf:Number.isFinite(tr)&&tr>0?tr:Number.isFinite(Hn)?Hn:0,vacancy:hn.vacancy??Vn.vacancy,occupant:hn.occupant??Vn.occupant,occupancyStatus:hn.occupancyStatus??Vn.occupancyStatus,occupantDept:hn.occupantDept??Vn.occupantDept,department:hn.department??Vn.department,floorName:Vn?.floorName||Vn?.floorId||hn.floorName||hn.floorId||"",rationale:r5(Vn?.rationale)}}):[],Yr=na(St||ZA(ni)||"");let Jr=ni,Gi="";if(Kt){const{candidates:Vn,added:on}=HA(ni,Zt,Kt,{targetTolerance:Gn?.targetSfTolerance??.1,maxCandidates:Ml?40:30,primaryBuilding:Yr});on>0&&(Jr=Vn,Gi=`Auto-filled ${on} rooms to better match baseline SF and room-type mix.`)}const Or=Vn=>KA(Vn?.type)||WA(Vn?.type),Ur=Yr||ZA(Jr)||"";if(Ur){const Vn=Jr.filter(on=>na(on?.buildingLabel||"")===Ur?!0:Or(on));if(Vn.length&&(Jr=Vn,Gi=`${Gi?Gi+" ":""}Constrained scenario to a single building (${Ur}), allowing labs/classrooms to remain outside if needed.`),Kt){const on=Zt.filter(tr=>{if(na(tr?.buildingLabel??tr?.building??tr?.buildingName??"")===Ur)return!0;const co=tr?.type??tr?.roomType??"";return KA(co)||WA(co)}),{candidates:hn,added:Hn}=HA(Jr,on,Kt,{targetTolerance:Gn?.targetSfTolerance??.1,maxCandidates:Ml?40:30,primaryBuilding:Ur});Hn>0&&(Jr=hn,Gi=`${Gi?Gi+" ":""}Auto-filled ${Hn} rooms to better match baseline SF.`)}}Jr=Z8(Jr,Ur);const Ui=Kt?.totalSF||rr?.baselineTotals?.totalSF||0,kr=Math.round((Gn?.targetSfTolerance??.1)*100),Kr=Ui?[`Aim for total SF within +/-${kr}% of baseline department total SF (${Math.round(Ui).toLocaleString()} SF).`]:[],ki=Array.isArray(rr?.selectionCriteria)?rr.selectionCriteria.filter(Vn=>!/baseline|total\s*sf|sf within/i.test(Vn||"")):[];go({...rr,baselineTotals:Kt||rr?.baselineTotals,selectionCriteria:[...Kr,...Gi?[Gi]:[],...ki],recommendedCandidates:Jr}),Jo(!1)}catch(O){Mu(String(O?.message||O))}finally{mo(!1)}},[Ii,be,Eo,Fo,Qt,yt,zo,uc,va,lo,dd,vo,ja,j,Ar,e]),Gc=Qn(async()=>{Vs(""),tu(!0),Ss(null);try{const O=(pa||"").trim();if(!O)throw new Error("Type a question first.");const he=Qt&&Array.isArray(yt)?yt:[],Ie=pT(he),qe=mT(O,Ie)||"",Qe=gT(he),Fe=yT(O,Qe)||"",$e=/best new suitable home|suitable home|best home|relocat|move|find space|new home|anywhere|entire campus|campus[-\s]?wide|across campus/i.test(O),St=/\b(basement|ground floor|first floor|second floor|third floor|fourth floor|fifth floor|sixth floor|seventh floor|eighth floor|ninth floor|tenth floor|level\s*\d+|level\s*(one|two|three|four|five|six|seven|eight|nine|ten)|lvl\s*\d+|floor\s*\d+|floor\s*(one|two|three|four|five|six|seven|eight|nine|ten))\b/i.test(O),Mt=/\b(entire campus|campus[-\s]?wide|across campus|anywhere on campus)\b/i.test(O)||/\bwhere\s+(is|are)\b|\blocation of\b|\bwhere\b.*\b(located|location)\b|\bwhich building\b|\bwhat building\b/i.test(O)&&!Fe,gt=$e&&qe?_T(he,qe):[],Zt=new Set((gt||[]).map(on=>uo(on)).filter(Boolean)),Kt={first:1,second:2,third:3,fourth:4,fifth:5,sixth:6,seventh:7,eighth:8,ninth:9,tenth:10},gn=(()=>{if(!St)return"";const on=O.toLowerCase();if(on.includes("basement"))return"BASEMENT";if(on.includes("ground floor"))return"LEVEL_1";const hn=on.match(/level\s*(\d+)/);if(hn)return`LEVEL_${hn[1]}`;const Hn=on.match(/floor\s*(\d+)/);if(Hn)return`LEVEL_${Hn[1]}`;const tr=on.match(/\b(first|second|third|fourth|fifth|sixth|seventh|eighth|ninth|tenth)\s+floor\b/);return tr?`LEVEL_${Kt[tr[1]]}`:""})(),en=Fe||"",$t=Fe||"",un=!Fe||$e||Mt,vr=!un&&!!Fe&&!!gn,Pr={universityId:e,campusLabel:be||e||"Campus",buildingId:en,buildingLabel:Fe||"",floorId:vr?gn:"",scope:un?"campus":vr?"floor":Fe?"building":"campus",targetDepartment:qe||"",excludeBuildings:gt||[]},Gn=(()=>{if(!Qt)return[];if(un||!Fe)return yt;const on=uo(Fe);if(!on)return yt;const hn=yt.filter(tr=>{const Qr=tr?.building??tr?.buildingName??tr?.buildingLabel??"";return uo(Qr)===on});if(!vr)return hn;const Hn=Lf(gn);return Hn.length?hn.filter(tr=>Tf(tr?.floor??tr?.floorName??tr?.floorId??"",Hn)):hn})(),rr=Zt.size?Gn.filter(on=>{const hn=t_(on);return!Zt.has(uo(hn))}):Gn,ni=(on,hn={})=>{if(!Array.isArray(on))return[];const Hn=Number(hn.maxRows||400);if(on.length<=Hn)return on;const tr=uo(hn.inferredDept||"");let Qr=on;if(tr&&(Qr=on.filter(Bn=>{const $a=String(Bn?.department??Bn?.occupantDept??"").trim();return uo($a)===tr}),Qr.length<=Hn))return Qr;const co=new Map;Qr.forEach(Bn=>{const $a=uo(t_(Bn));co.has($a)||co.set($a,[]),co.get($a).push(Bn)});const Do=Math.max(1,Math.floor(Hn/Math.max(1,co.size||1))),ei=[];if(co.forEach(Bn=>{ei.push(...Bn.slice(0,Do))}),ei.length>=Hn)return ei.slice(0,Hn);const Hi=Qr.filter(Bn=>!ei.includes(Bn));return ei.concat(Hi.slice(0,Math.max(0,Hn-ei.length)))};if(eq(O)){const on=rr.filter(Hn=>R1(Hn?.type??Hn?.roomType??"")),hn=un?"campus":Fe||"selected scope";Ss({answer:`Found ${on.length.toLocaleString()} classrooms in ${hn}.`,bullets:["Count is based on room type labels that include classroom/teaching room definitions."],resultType:"none",columns:[],rows:[],dataUsed:["roomRows"],missingData:[]});return}if(QV(O)){const on=vT(rr),hn=un?"campus":Fe||"selected scope";Ss({answer:`Found ${on.length.toLocaleString()} vacant offices in ${hn}.`,bullets:["Only rooms marked vacant/available and without an occupant are counted."],resultType:"none",columns:[],rows:[],dataUsed:["roomRows"],missingData:on.length?[]:["Vacancy status","Room inventory"]});return}if(JV(O)){let on=vT(rr);if(on.some(tr=>!String(tr?.["Room Number"]||"").trim()))try{const Qr=await zo(un?"__all__":$t||"__all__",""),co=new Map;(Qr||[]).forEach(Do=>{const ei=String(Do?.roomNumber??"").trim();if(!ei||am(ei))return;const Hi=vm(Do?.revitId??Do?.roomId??"");Hi&&(co.has(Hi)||co.set(Hi,ei))}),on=on.map(Do=>{if(String(Do?.["Room Number"]||"").trim())return Do;const Hi=vm(Do?.__lookupKey??"");if(!Hi)return Do;const Bn=co.get(Hi)||"";return Bn?{...Do,"Room Number":Bn}:Do})}catch{}const hn=un?"campus":Fe||"selected scope",Hn=on.length?`Found ${on.length.toLocaleString()} vacant offices in ${hn}.`:`No vacant offices were found in ${hn} with explicit vacancy data.`;Ss({answer:Hn,bullets:["Only rooms marked as vacant/available and not currently assigned to an occupant are included."],resultType:on.length?"table":"none",columns:on.length?["Building","Room Number","Room Type","Square Feet"]:[],rows:on,dataUsed:["roomRows"],missingData:on.length?[]:["Vacancy status","Room inventory"]});return}const Yr=/\bwhere\s+(is|are)\b|\blocation of\b|\bwhere\b.*\b(located|location)\b|\bwhich building\b|\bwhat building\b/i.test(O),Jr=(()=>{const on=[];if(qe&&on.push(qe),/\bpresident'?s?\b/i.test(O)&&on.push("president"),/\bprovost\b/i.test(O)&&on.push("provost"),/\bdean\b/i.test(O)&&on.push("dean"),!on.length)return[];const hn=on.map(Hn=>uo(Hn)).filter(Boolean);return rr.filter(Hn=>{const tr=String(Hn?.department??Hn?.occupantDept??"").trim(),Qr=String(Hn?.occupant??"").trim(),co=String(Hn?.roomNumber??Hn?.roomLabel??"").trim(),Do=uo(`${tr} ${Qr} ${co}`);return hn.some(ei=>ei&&Do.includes(ei))})})();if(Yr&&Jr.length){const on=new Map;Jr.forEach(Hn=>{const tr=t_(Hn)||"Unknown Building";on.has(tr)||on.set(tr,[]),on.get(tr).push(Hn)});const hn=Array.from(on.entries()).map(([Hn,tr])=>{const Qr=tr.map(Bn=>Bn?.roomNumber||Bn?.roomLabel||Bn?.roomId||Bn?.id||Bn?.revitId||"").filter(Boolean),co=Array.from(new Set(Qr)),Do=tr.map(Bn=>Bn?.occupant||Bn?.department||Bn?.type||"").filter(Boolean),ei=Array.from(new Set(Do)),Hi=co.length?`Rooms: ${co.slice(0,12).join(", ")}`:ei.length?`Rooms: (not labeled)  ${ei.slice(0,3).join(", ")}`:"Rooms: (not labeled)";return`${Hn}  ${Hi}`});Ss({answer:"Here are the rooms matching that request across campus.",bullets:hn,resultType:"none",columns:[],rows:[],dataUsed:["roomRows"],missingData:[]});return}const Gi=Jr.length?Jr:rr,Or=ni(Gi,{maxRows:qe?180:100,inferredDept:qe}),Ur=Xg(rr),Ui=vr&&Ur?{...Ur,floorLabel:gn}:null,kr=!vr&&Fe&&Ur?Ur:null;let Kr=null;if(Or.length)Kr=Or.map(on=>{const hn=Number(on?.areaSF??on?.area??on?.sf??0),Hn=Number(on?.seatCount??on?.SeatCount??on?.["Seat Count"]??0),tr=B3(on);return{building:on?.building??on?.buildingName??on?.buildingLabel??$t,floor:on?.floor??on?.floorName??on?.floorId??"",roomNumber:tr||"",type:String(on?.type??on?.roomType??"").trim(),department:String(on?.department??"").trim(),area:Number.isFinite(hn)?Math.round(hn):"",seatCount:Number.isFinite(Hn)&&Hn>0?Hn:"",occupant:String(on?.occupant??"").trim(),occupancyStatus:String(on?.occupancyStatus??"").trim()}});else try{const hn=await zo(un?"__all__":$t||"__all__","");if(Array.isArray(hn)){const Hn=Zt.size?hn.filter(Qr=>!Zt.has(uo(Qr.building))):hn,tr=ni(Hn,{maxRows:qe?180:100,inferredDept:qe});Kr=$t?tr:tr.slice(0,qe?180:100)}else Kr=null}catch{Kr=null}const Vn=await Pc({question:O,context:Pr,data:{campusStats:Mr,buildingStats:!un&&Fe&&!vr&&kr||void 0,floorStats:vr&&Ui||void 0,dashboardMetrics:void 0,scopeSummary:Ur||void 0,roomRows:Kr||void 0}});Ss(Vn)}catch(O){Vs(String(O?.message||O))}finally{tu(!1)}},[Ii,be,pa,F,j,Ar,e,Qt,yt,Mr,Vt,$n,qs,ii,Pc,Cf,zo]),_d=Qn(()=>{if(Ai)try{const O=new wi("p","pt","letter"),he=O.internal.pageSize.getWidth(),Ie=O.internal.pageSize.getHeight(),qe=24,Qe=he-qe*2,Fe=14;let $e=qe;const St=(en=Fe)=>{$e+en<=Ie-qe||(O.addPage(),$e=qe)},Mt=(en,$t={})=>{const un=String(en??"").trim();if(!un)return;const vr=$t.fontStyle||"normal",Pr=$t.fontSize||11;O.setFont(void 0,vr),O.setFontSize(Pr),O.splitTextToSize(un,Qe).forEach(rr=>{St(Fe),O.text(rr,qe,$e),$e+=Fe})},gt=(en=8)=>{St(en),$e+=en};Mt("Ask Mapfluence",{fontStyle:"bold",fontSize:14}),gt(4),Mt(`Question: ${pa||"(no question)"}`,{fontSize:10}),gt(8),Mt(`Answer: ${Ai.answer||""}`),Array.isArray(Ai.bullets)&&Ai.bullets.length&&(gt(8),Mt("Notes:",{fontStyle:"bold"}),Ai.bullets.forEach(en=>Mt(`- ${en}`)));const Zt=Array.isArray(Ai.columns)?Ai.columns:[],Kt=Array.isArray(Ai.rows)?Ai.rows:[];Zt.length&&Kt.length&&(gt(10),Mt("Table:",{fontStyle:"bold"}),Mt(Zt.join(" | "),{fontStyle:"bold",fontSize:10}),Kt.forEach(en=>{const $t=Zt.map(un=>{const vr=en&&en[un]!=null?en[un]:"";return String(vr)});Mt($t.join(" | "),{fontSize:10})})),Array.isArray(Ai.missingData)&&Ai.missingData.length&&(gt(8),Mt(`Missing data: ${Ai.missingData.join(", ")}`,{fontSize:10}));const gn=String(pa||"ask-mapfluence").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").slice(0,60)||"ask-mapfluence";O.save(`${gn}.pdf`)}catch(O){console.error("Ask Mapfluence PDF export failed",O),alert("PDF export failed - see console for details.")}},[Ai,pa]),Xs=Qn(async()=>{if(!Ai)return;const O=Array.isArray(Ai.columns)?Ai.columns:[],he=Array.isArray(Ai.rows)?Ai.rows:[];if(!O.length||!he.length){alert("No table data available to copy.");return}const Ie=Fe=>{if(Fe==null)return"";const $e=String(Fe);return/[",\n]/.test($e)?`"${$e.replace(/"/g,'""')}"`:$e},qe=[O.map(Ie).join(",")];he.forEach(Fe=>{qe.push(O.map($e=>Ie(Fe&&Fe[$e]!=null?Fe[$e]:"")).join(","))});const Qe=qe.join(`
`);try{if(navigator?.clipboard?.writeText)await navigator.clipboard.writeText(Qe);else throw new Error("Clipboard API unavailable")}catch{try{const Fe=document.createElement("textarea");Fe.value=Qe,Fe.setAttribute("readonly",""),Fe.style.position="fixed",Fe.style.left="-9999px",document.body.appendChild(Fe),Fe.select(),document.execCommand("copy"),document.body.removeChild(Fe)}catch{alert("Copy failed. Please use Export PDF.");return}}alert(`Copied ${he.length.toLocaleString()} rows to clipboard (CSV).`)},[Ai]),jh=Qn(()=>{const O=String(st||"").trim();if(!/^pk\./i.test(O)){Tr("Enter a valid Mapbox public token (starts with pk.).");return}try{window.localStorage.setItem("MAPBOX_PUBLIC_TOKEN",O)}catch{}Rd.accessToken=O,Tr(""),Gt(!1),window.location.reload()},[st]);gi(()=>{const O=Lc.current;if(!O||O.buildingLabel!==j||O.floorId!==Ar)return;Lc.current=null;const he=lc.current||[];lc.current=null,(async()=>{try{if(!await Zr())return}catch{}$c(he)})()},[j,Ar,Zr,$c]);const vd=Qn(async()=>{const O=Ko?.recommendedCandidates||[];if(!O.length)return;const he=Ko?.scenarioDept||vo||"";Vc(!0),he&&ca(he);const Ie=O[0],qe=Ie?.buildingLabel||j,Qe=Ie?.floorName||Ie?.floorId||Ar;let Fe=Qe;if(qe){const St=await va(qe);Fe=N1(Qe,St)||St?.[0]||Qe}if(qe&&Fe&&(qe!==j||Fe!==Ar)){Lc.current={buildingLabel:qe,floorId:Fe},lc.current=O,H(qe),ml(Fe);return}$c(O)},[Ko?.recommendedCandidates,Ko?.scenarioDept,$c,va,vo,j,Ar,Vc,ca,H,ml]),Bu=Qn(O=>{const he=O?.recommendedCandidates||[];if(!he.length)return;const Ie=O?.scenarioDept||vo||"";Vc(!0),Ie&&ca(Ie),$c(he),Uo(!0)},[$c,vo,Vc,ca]),au=Qn(async(O,he)=>{const Ie=O&&typeof O=="object"?null:O,qe=he||So||"rooms";Zo(!0),kl(qe==="summary"?"Preparing summary export...":"Building export data...");try{const Qe=gn=>{if(gn==null)return"";const en=String(gn);return/[",\n]/.test(en)?`"${en.replace(/"/g,'""')}"`:en};if(qe==="summary"){const{campusRow:gn,buildingRows:en}=await ql(Ie||al,Ql),$t=[...gn?[gn]:[],...en];if(!$t.length){kl("No matching rooms found."),Zo(!1);return}const vr=[["BuildingId","BuildingName","TotalSF","Rooms","ClassroomSF","Classrooms","LabSF","Labs","OfficeSF","Offices","KeyDepts"].join(",")];$t.forEach(Yr=>{vr.push([Qe(Yr.buildingId),Qe(Yr.buildingName),Qe(Yr.totalSf),Qe(Yr.rooms),Qe(Yr.classroomSf),Qe(Yr.classrooms),Qe(Yr.labSf),Qe(Yr.labs),Qe(Yr.officeSf),Qe(Yr.offices),Qe(Yr.keyDepts)].join(","))});const Pr=new Blob([vr.join(`
`)],{type:"text/csv;charset=utf-8;"}),Gn=document.createElement("a");Gn.href=URL.createObjectURL(Pr);const rr=Ie||al,ni=rr&&rr!=="__all__"?rr.replace(/\s+/g,"-").toLowerCase():"campus";Gn.download=`${ni}-space-summary.csv`,document.body.appendChild(Gn),Gn.click(),document.body.removeChild(Gn),kl(`Exported ${$t.length} summary rows`);return}const Fe=await zo(Ie||al,Ql);if(!Fe.length){kl("No matching rooms found."),Zo(!1);return}const St=[["Building","Floor","Room","Type","Department","AreaSF","SeatCount","Occupant"].join(",")];Fe.forEach(gn=>{St.push([Qe(gn.building),Qe(gn.floor),Qe(gn.roomNumber),Qe(gn.type),Qe(gn.department),Qe(gn.area),Qe(gn.seatCount),Qe(gn.occupant)].join(","))});const Mt=new Blob([St.join(`
`)],{type:"text/csv;charset=utf-8;"}),gt=document.createElement("a");gt.href=URL.createObjectURL(Mt);const Zt=Ie||al,Kt=Zt&&Zt!=="__all__"?Zt.replace(/\s+/g,"-").toLowerCase():"campus";gt.download=`${Kt}-space-data.csv`,document.body.appendChild(gt),gt.click(),document.body.removeChild(gt),kl(`Exported ${Fe.length} rows`)}catch(Qe){console.warn("Space export failed",Qe),kl("Export failed. See console.")}finally{Zo(!1)}},[zo,ql,al,Ql,So]);Qn(()=>{try{ue([]),z([])}catch{}},[]),Qn(()=>{try{const he=_.current?.getCanvas?.();if(!he){alert("Map is not ready yet.");return}const Ie=new Date().toISOString().replace(/[:.]/g,"-"),qe=De?"heatmap":"markers",Qe=(e||"campus").replace(/\s+/g,"-").toLowerCase(),Fe=document.createElement("a");Fe.href=he.toDataURL("image/png"),Fe.download=`${Qe}-${qe}-${Ie}.png`,document.body.appendChild(Fe),Fe.click(),document.body.removeChild(Fe)}catch(O){console.warn("PNG export failed",O),alert("PNG export failed. See console for details.")}},[De,e]);const hc=Qn(()=>{le(O=>{const he=!O;try{const Ie=new URL(window.location.href);he?Ie.searchParams.set("presentation","1"):Ie.searchParams.delete("presentation"),window.history.replaceState({},"",`${Ie.pathname}${Ie.search}${Ie.hash}`)}catch{}return he})},[]);Qn(()=>{const he=_.current?.getCanvas?.();if(!he){alert("Map is not ready yet.");return}const Ie=xe,qe=mt;Oe(!0),le(!0),dt(!1);const Qe=()=>{try{const Fe=new Date().toISOString().replace(/[:.]/g,"-"),$e=(e||"campus").replace(/\s+/g,"-").toLowerCase(),St=document.createElement("a");St.href=he.toDataURL("image/png"),St.download=`${$e}-presentation-${Fe}.png`,document.body.appendChild(St),St.click(),document.body.removeChild(St)}catch(Fe){console.warn("Clean PNG export failed",Fe),alert("Clean PNG export failed. See console for details.")}finally{le(Ie),dt(qe),Oe(!1)}};requestAnimationFrame(()=>requestAnimationFrame(Qe))},[xe,mt,e]);const Uh=Qn(()=>{try{ze({}),U({})}catch{}},[]),[Eh,dc]=jn(null),[ed,lu]=jn(null),[Ah,lf]=jn(null),[td,xd]=jn(null),nd=Qn(()=>u.current?.getBoundingClientRect()||{left:0,top:0,width:window.innerWidth,height:window.innerHeight},[]),rh=Qn(()=>({left:0,top:0,width:window.innerWidth,height:window.innerHeight}),[]),kc=Qn(O=>Cy(O,I,lu,nd),[nd]),cu=Qn(O=>Cy(O,R,Nu,rh),[rh]),fc=Qn(O=>Cy(O,V,Bh,nd),[nd]),pc=wo(null),Mc=wo(null),zu=Qn(O=>Cy(O,pc,lf,rh),[rh]),Th=Qn(O=>Cy(O,Mc,xd,rh),[rh]),ju={onPointerDown:kc,style:{cursor:"grab",userSelect:"none",touchAction:"none"}},cf={onPointerDown:cu,style:{cursor:"grab",userSelect:"none",touchAction:"none"}},_g={onPointerDown:fc,style:{cursor:"grab",userSelect:"none",touchAction:"none"}},xm={onPointerDown:zu,style:{cursor:"grab",userSelect:"none",touchAction:"none"}},vg={onPointerDown:Th,style:{cursor:"grab",userSelect:"none",touchAction:"none"}};if(wo(null),!e)return Y.jsx("div",{children:"Loading University..."});const zd=Wa(()=>Bm(mh,"universities",e,"markers"),[e]),kp=Wa(()=>Bm(mh,"universities",e,"buildingConditions"),[e]),ih=Wa(()=>Bm(mh,"universities",e,"buildingAssessments"),[e]);Wa(()=>Bm(mh,"universities",e,"drawingEntries"),[e]);const bm=Wa(()=>Bm(mh,"moves"),[mh]),V0=({person:O,from:he,to:Ie,effectiveDate:qe,comments:Qe,createdBy:Fe})=>({person:O||"",fromRoomId:he?.roomId||"",toRoomId:Ie?.roomId||"",fromBuildingId:he?.buildingId||"",toBuildingId:Ie?.buildingId||"",fromFloorId:he?.floorId||"",toFloorId:Ie?.floorId||"",fromRoomLabel:he?.roomLabel||"",toRoomLabel:Ie?.roomLabel||"",effectiveDate:qe||"",comments:Qe||"",createdAt:E1(),createdBy:Fe||"unknown"}),qa=Qn(async O=>{if(O)try{await VE(bm,O)}catch(he){console.warn("Failed to log move",he)}},[bm]),Wr=()=>{tt(null),Nt(null),No(null)},rd=async()=>{if(!ut)return;const{from:O,to:he,effectiveDate:Ie,comments:qe,person:Qe}=ut,Fe=na(Qe||O?.occupantName||"");if(!(!O||!he||!Fe))try{const $e=await ot({roomId:O.roomId,buildingId:O.buildingId,buildingName:O.buildingName,floorName:O.floorId,revitId:O.revitId,roomLabel:O.roomLabel,properties:{occupant:""}}),St=await ot({roomId:he.roomId,buildingId:he.buildingId,buildingName:he.buildingName,floorName:he.floorId,revitId:he.revitId,roomLabel:he.roomLabel,properties:{occupant:Fe}});$e&&St?await qa(V0({person:Fe,from:O,to:he,effectiveDate:Ie,comments:qe,createdBy:Jt?.email||"unknown"})):console.warn("Move update incomplete, skipping move log.")}catch($e){console.warn("Move confirmation failed",$e)}finally{Wr()}},uf=Wa(()=>t!=="admin"?me:me.filter(O=>{const he=(O.persona||"").toLowerCase();return he.includes("student")?f:he.includes("staff")||he.includes("faculty")?S:!0}),[me,f,S,t]),il=Wa(()=>{if(!c||!ii)return me;const O=jr.current||{},he=fp(O?.buildingId||F||j||""),Ie=Na(O?.floorId||Ar||""),qe=String(O?.floorLabel||Ar||"").trim(),Qe=Lf(qe||Ie);return(me||[]).filter(Fe=>{if(fp(Fe?.buildingId||Fe?.buildingName||Fe?.building||"")!==he)return!1;const St=String(Fe?.floorId||Fe?.floorLabel||Fe?.floor||"").trim();return Na(St)===Ie?!0:Qe.length?Tf(St,Qe):!1})},[me,c,ii,F,j,Ar,Dr]),Mp=Wa(()=>({type:"FeatureCollection",features:(il||[]).filter(O=>Array.isArray(O?.coordinates)&&Number.isFinite(Number(O.coordinates[0]))&&Number.isFinite(Number(O.coordinates[1]))).map(O=>({type:"Feature",properties:{heatCategory:g_(O?.type),weight:xq(O?.type),markerType:O?.type||""},geometry:{type:"Point",coordinates:[Number(O.coordinates[0]),Number(O.coordinates[1])]}}))}),[il]),bd=Wa(()=>{const O={matchPairs:[],legendItems:[],roomCount:0,markerCount:0};if(!c||!Ia||!ii||!Un)return O;const he=_.current,Ie=he?Gu(he,da):null,qe=Ie&&(Ie._data||Ie.serialize?.().data)||null,Qe=Tu(qe);if(!Qe?.features?.length)return O;const Fe=Qe.features.filter(gn=>v0(gn?.properties)==="room").filter(gn=>{const en=String(gn?.geometry?.type||"");return en==="Polygon"||en==="MultiPolygon"}).map(gn=>{const en=gn.properties||{},$t=gn.id??en.RevitId??en.id;if($t==null)return null;const un=kf(en);return{feature:gn,idRaw:$t,idKey:String($t),areaSf:Number.isFinite(un)?un:0}}).filter(Boolean);if(!Fe.length)return O;const $e=new Map;Fe.forEach(gn=>$e.set(gn.idKey,{counts:new Map,total:0}));let St=0;(il||[]).filter(gn=>Array.isArray(gn?.coordinates)).forEach(gn=>{const en=Number(gn?.coordinates?.[0]),$t=Number(gn?.coordinates?.[1]);if(!Number.isFinite(en)||!Number.isFinite($t))return;const un=Ls([en,$t]);for(const vr of Fe){let Pr=!1;try{Pr=uj(un,vr.feature)}catch{Pr=!1}if(!Pr)continue;const Gn=g_(gn?.type),rr=$e.get(vr.idKey),ni=rr.counts.get(Gn)||0;rr.counts.set(Gn,ni+1),rr.total+=1,St+=1;break}});const Mt=new Map,gt=[];let Zt=0;Fe.forEach(gn=>{const en=$e.get(gn.idKey);if(!en||!en.total)return;Zt+=1;const un=Array.from(en.counts.entries()).sort((Gn,rr)=>{if((rr[1]||0)!==(Gn[1]||0))return(rr[1]||0)-(Gn[1]||0);const ni=pm[Gn[0]]?.heatValue??0;return(pm[rr[0]]?.heatValue??0)-ni})[0]?.[0]||"comment",vr=pm[un]?.color||"#9ca3af";gt.push(gn.idKey,vr);const Pr=Mt.get(un)||{category:un,label:pq[un]||un,color:vr,roomCount:0,markerCount:0,areaSf:0};Pr.roomCount+=1,Pr.markerCount+=en.total,Pr.areaSf+=gn.areaSf||0,Mt.set(un,Pr)});const Kt=Array.from(Mt.values()).sort((gn,en)=>(en.roomCount||0)-(gn.roomCount||0));return{matchPairs:gt,legendItems:Kt,roomCount:Zt,markerCount:St}},[c,Ia,ii,Un,il,Dr]);gi(()=>{if(!k)return;const O=_.current;if(!(!O||!O.getLayer(jo))&&!(!c||!Ia||!ii||!Un))try{const he=bd.matchPairs.length?["match",["to-string",["coalesce",["id"],["get","RevitId"],["get","id"]]],...bd.matchPairs,"#f3f4f6"]:"#f3f4f6";O.setPaintProperty(jo,"fill-color",he),O.setPaintProperty(jo,"fill-opacity",.9)}catch{}},[k,c,Ia,ii,Un,bd,Dr]),gi(()=>{!k||!c||!ii||Ia||Fl(Ji)},[k,c,ii,Ia,Ji,Fl]),gi(()=>{Ia||hl&&Nl(!1)},[Ia,hl]),gi(()=>{ii&&Un||hl&&Nl(!1)},[ii,Un,hl]);const Rc=Wa(()=>c?gq:t==="admin"?{...T1.student,...T1.staff}:T1[i]||T1.default,[i,t,c]),wu=Wa(()=>{const O={};return Object.keys(Rc||{}).forEach(he=>{O[he]=ET(he)}),O},[Rc]);gi(()=>{const O=Q1();rz(O).catch(()=>{});const he=CB(O,async Ie=>{if(En(Ie||null),!Ie){a(!1);return}try{const qe=await UE(s0(mh,"universities",e,"roles",Ie.uid));a(!!qe.exists()&&qe.data()?.role==="admin")}catch{a(!1)}});return()=>he()},[e]);async function id(){try{const O=Q1(),he=new Rf;try{await XB(O,he)}catch{await tz(O,he)}}catch{}}function wd(){try{LB(Q1())}catch{}}gi(()=>{e&&(async()=>{try{const O=Bm(mh,"universities",e,"buildings"),he=await S1(O);if(!he.empty){const qe=he.docs.map(Qe=>({id:Qe.id,name:Qe.data()?.name||Qe.id}));!j&&qe.length&&H(qe[0].id);return}const Ie=await fetch(iv);if(Ie.ok){const qe=await Ie.json(),Qe=Object.entries(qe.buildings||{}).map(([Fe,$e])=>({id:Fe,name:$e?.name||Fe}));!j&&Qe.length&&H(Qe[0].id)}}catch(O){console.warn("Building options load failed:",O)}})()},[e]),gi(()=>{let O=!1;const he=()=>{Bo([]),ml(void 0)};return(async()=>{const Ie=Wg(F,Ns)||Wg(j,Ns);if(!Ie){he();return}const qe=await jA(Ie);if(O)return;const Qe=(qe||[]).map($e=>a0($e?.id)).filter(Boolean),Fe=new Map((qe||[]).filter($e=>$e?.id&&$e?.url).map($e=>[$e.id,$e.url]));Fu.current.set(Ie,Qe),Ic.current.set(Ie,Fe),Qe.length?(Bo(Qe),ml($e=>$e&&Qe.includes($e)?$e:Qe[0])):he()})(),()=>{O=!0}},[F,j,Ns]),gi(()=>{let O=!1;return(async()=>{Gs(!0),W(null),ul("Campus Summary");try{const he=await Kd("/ai/api/rooms",{cache:"no-store",timeoutMs:8e3});let Ie=null;try{Ie=await he.json()}catch{}if(!he.ok){const qe=Ie?.error||Ie?.message||`Rooms fetch failed (${he.status})`;throw new Error(qe)}if(Ie?.ok&&Array.isArray(Ie.rooms)&&(O||(pt(Ie.rooms),_o(new Date)),Ie.rooms.some(oq)))return;throw new Error("Rooms payload missing or invalid")}catch{try{let Ie=cs.current;Ie||(Ie=await p_(iv),cs.current=Ie);const qe=await xT(Ie);if(!qe.length)throw new Error("No floorplan rooms found for dashboard");O||(qt(qe),W(null),Fn(!0))}catch(Ie){O||W(Ie)}}finally{O||Gs(!1)}})(),()=>{O=!0}},[e]),gi(()=>{const he=setInterval(()=>{_e()},18e5);return()=>clearInterval(he)},[_e]),gi(()=>{let O=!1;return(async()=>{try{const he=await fetch(Jd(MV),{cache:"no-store"});if(!he.ok)throw new Error(`Utilization CSV fetch failed (${he.status})`);const Ie=await he.text(),qe=NV(Ie);O||Mo(qe)}catch(he){console.warn("Unable to load classroom utilization data",he)}})(),()=>{O=!0}},[]);const od=Wa(()=>{if(!Qt)return[];if(!(!!F||ii))return yt;const he=na(Ii);if(!!!he)return yt;const qe=new Set([uo(Ii),uo(F),uo(j)].filter(Boolean));if(!qe.size)return yt;const Qe=yt.filter(Mt=>{const gt=Mt?.building??Mt?.buildingName??Mt?.buildingLabel??"";return qe.has(uo(gt))});if(!!!(ii&&he))return Qe;const $e=na(jr.current?.floorLabel||Ar||""),St=Lf($e);return St.length?Qe.filter(Mt=>Tf(Mt?.floor??Mt?.floorName??Mt?.floorId??"",St)):Qe},[yt,Qt,Ii,F,j,ii,Ar]),Rp=Wa(()=>{if(!(!!F||ii))return"Campus";const he=na(Ii);if(!!!he)return"Campus";const qe=na($n?.floorLabel||jr.current?.floorLabel||Ar||"");return!!(ii&&he&&qe)?`${he} ${qe}`:he},[Ii,F,j,ii,Ar,$n]),Yf=Wa(()=>{if(!!F||ii){const he=na(Ii);return he?ve(he):null}return L},[Ii,F,j,ii,L,ve]),Np=Wa(()=>!!F||ii?na(Ii)||"":L?be:"",[Ii,F,j,ii,L,be]),Ih=Wa(()=>{if(!ii)return[];const O=jr.current||{},he=uo(F||j||""),Ie=uo(O.buildingLabel||O.buildingId||O.building||"");if(he&&Ie&&he!==Ie)return[];const qe=Lf(Ar||"");if(qe.length){const $e=O.floorLabel||O.floorId||O.floor||"";if(!Tf($e,qe))return[]}const Qe=O.fc,Fe=Array.isArray(Qe?.features)?Qe.features:[];return Fe.length?Fe.filter($e=>v0($e?.properties)==="room"):[]},[ii,Dr,F,j,Ar]),Dp=Wa(()=>ii?Ih:(od||[]).map(aC).filter(Boolean),[od,Ih,ii]);gi(()=>{if(!Ce.length)return;let O=!1;if(!Ce.some(Ie=>Gv(Ie?.type)||Gv(Ie?.department)||nq(Ie))){O||(qt(Ce),Fn(!0));return}return(async()=>{try{let Ie=cs.current;Ie||(Ie=await p_(iv),cs.current=Ie);const qe=await xT(Ie);if(O)return;const Qe=iq(Ce,qe);qt(Qe),Fn(!0)}catch{O||(qt(Ce),Fn(!0))}})(),()=>{O=!0}},[Ce]),gi(()=>{if(!Qt)return;const O=!!F||ii,he=na(Ii),Ie=na($n?.floorLabel||jr.current?.floorLabel||Ar||""),Fe=!!(ii&&he&&Ie)?`${he} ${Ie} Summary`:!!(O&&he)?`${he} Summary`:"Campus Summary";ul(Fe);try{const $e=dU(Dp);ia($e)}catch($e){W($e)}},[Qt,Dp,Ii,F,j,ii,Ar,$n]),gi(()=>{if(!Qt||!Array.isArray(yt)||!yt.length||ii)return;const O=F||j;if(!O)return;const he=uo(O);if(!he)return;const Ie=yt.filter(Qe=>{const Fe=Qe?.building??Qe?.buildingName??Qe?.buildingLabel??"";return uo(Fe)===he}),qe=Xg(Ie);qe&&(Ln(qe),or($u(qe,"building")))},[Qt,yt,ii,F,j]),gi(()=>{if(!ii||!Ih.length)return;const O=jr.current||{},he=O.url||Ws.current,Ie=O.floorLabel||Ar||O.floor||"";if(!he)return;const qe=fV(Ih);if(!qe)return;const Qe={...qe,floorLabel:Ie};Bi.current[he]=qe,Tl.current.set(he,qe),O.key&&Tl.current.set(O.key,qe),Dn(Qe),lt(pp(em(qe.totalsByDept))),or($u(qe,"floor"))},[ii,Ih,Ar]),gi(()=>{if(!k||!_.current||!ii)return;const O=!!(Es?.byGuid?.size||Es?.byComposite?.size),he=aa instanceof Map&&aa.size>0;if(!O&&!he)return;const Ie=_.current,qe=Gu(Ie,da);if(!qe)return;const Qe=qe._data||qe.serialize?.()?.data||null,Fe=Tu(Qe);if(!Fe?.features?.length)return;const $e=jr.current||{},St=$e.buildingId||F||j,Mt=$e.floorLabel||$e.floorId||$e.floor||Ar;let gt=!1;const Zt=Fe.features.map(gn=>{if(!gn)return gn;const en=gn.properties||{};if(v0(en)!=="room")return gn;let $t=en,un=!1;if(O){const Gn=sC(en,Es,St,Mt);Gn&&($t=qv($t,Gn),un=!0)}if(he&&St&&Mt){const Gn=gn.id??en.RevitId??en.id,rr=Gn!=null?Yd(St,Mt,Gn):null,ni=rr&&aa.get(rr)||null;ni&&($t=qv($t,ni),un=!0)}const vr=pd($t),Pr=vr?String(vr).trim():$t.__roomType||"";return!un&&Pr===en.__roomType?gn:(gt=!0,{...gn,properties:{...$t,__roomType:Pr}})});if(!gt)return;const Kt={...Fe,features:Zt};try{qe.setData(Kt)}catch{}jr.current&&(jr.current={...jr.current,fc:Kt}),hi(gn=>gn+1);try{Fl(Ji)}catch{}},[Es,aa,Ji,ii,k,F,j,Ar,Fl]),gi(()=>{if(!n)return;let O=null,he=null;const Ie=m.current;if(!Ie)return;const qe=()=>Ie.clientWidth>0&&Ie.clientHeight>0,Qe=()=>{if(_.current)return;const $e=n&&n.style||"mapbox://styles/mapbox/streets-v12",St=typeof $e=="string"&&/^mapbox:\/\//i.test($e),Mt=!!(Rd.accessToken||"").trim();if(St&&!Mt){Gt(!0);return}Gt(!1);const gt=$e,Zt=n?.initialCenter||[-98.3739,40.5939],Kt=n?.initialZoom??16;console.log("Mapbox token length:",(Rd.accessToken||"").length),console.log("Using style:",gt);let gn=null;try{gn=new Rd.Map({container:Ie,style:gt,center:Zt,zoom:Kt,attributionControl:!1,preserveDrawingBuffer:!0})}catch(en){console.error("Map constructor failed:",en);return}if(!gn){console.error("Map was not created (mapInstance is falsy).");return}gn.on("error",en=>{const $t=String(en?.error?.message||"");/access token/i.test($t)&&Gt(!0)}),_.current=gn,typeof window<"u"&&(window.__map=gn);try{gn.addControl(new Rd.NavigationControl,"top-right")}catch(en){console.warn("Adding controls failed:",en)}gn.once("load",()=>{(async()=>{try{await $A(gn,"mf-door-swing","/StakeholderMap/icons/door-swing.png")}catch(en){console.warn("Door icon load failed:",en)}try{await $A(gn,"mf-stairs-run","/StakeholderMap/icons/stairs-run.png")}catch(en){console.warn("Stairs icon load failed:",en)}ie(!0);try{gn.resize()}catch(en){console.warn("resize() failed:",en)}try{const en=Tu(n?.boundary);if(en?.features?.length){const[$t,un,vr,Pr]=bV(en);Number.isFinite($t)&&Number.isFinite(un)&&Number.isFinite(vr)&&Number.isFinite(Pr)&&gn.fitBounds([[$t,un],[vr,Pr]],{padding:40,duration:0})}}catch(en){console.warn("fitBounds from boundary failed:",en)}})()})};if(qe())Qe();else{try{he=new ResizeObserver(()=>{if(qe()){try{he.disconnect()}catch{}he=void 0,Qe()}}),he.observe(Ie)}catch{}O=requestAnimationFrame(()=>{if(qe()){if(he){try{he.disconnect()}catch{}he=void 0}Qe()}})}const Fe=()=>{if(_.current)try{_.current.resize()}catch{}};try{window.addEventListener("resize",Fe)}catch{}return()=>{if(O&&cancelAnimationFrame(O),he)try{he.disconnect()}catch{}try{window.removeEventListener("resize",Fe)}catch{}if(_.current){try{_.current.remove()}catch{}_.current=null}}},[n]),gi(()=>{t!=="admin"&&(!Ec&&!Lo&&Ca.length===0||(ma(!1),$o(null),rc([]),el.current=[]))},[t,Ec,Lo,Ca.length]),gi(()=>{(async()=>{try{let O;if(t==="admin"||c)O=BE(zd);else{if(!i){ue([]);return}O=BE(zd,zO("persona","==",i))}const he=await S1(O);if(ue(he.docs.map($e=>({id:$e.id,...$e.data(),coordinates:[$e.data().coordinates.longitude,$e.data().coordinates.latitude]}))),t!=="admin"){ze({}),U({});return}const[Ie,qe]=await Promise.all([S1(kp),S1(ih)]),Qe={};Ie.forEach($e=>{const St=$e.data().originalId||$e.id.replace(/__/g,"/");Qe[St]=$e.data().condition}),ze(Qe);const Fe={};qe.forEach($e=>{const St=$e.data().originalId||$e.id.replace(/__/g,"/");Fe[St]=$e.data()}),U(Fe)}catch(O){console.error("Failed to fetch data:",O),t==="admin"&&(ze({}),U({}))}})()},[t,c,e,i,zd,kp,ih]),gi(()=>{if(!F)return;const O=$(F)||F;j!==O&&H(O)},[F,$,j]),gi(()=>{if(!c||!k)return;if(!Un){oc.current="";return}const O=fp(F||j||""),he=Na(Ar||""),Ie=Rs(O),qe=Ie.some(Mt=>Na(Mt)===he);if(!Ie.length||!qe){oc.current="";return}const Qe=jr.current||{},Fe=fp(Qe.buildingId||""),$e=Na(Qe.floorId||""),St=`${O}/${he}`;if(ii&&Fe===O&&$e===he){oc.current=St;return}oc.current!==St&&(oc.current=St,Zr(Ar))},[c,Un,k,F,j,Ar,Rs,ii,Dr]),gi(()=>{c&&(Un||ii&&ps())},[c,Un,ii,ps]),gi(()=>{c&&(Un||nt(!0))},[c,Un]),gi(()=>{(!c||!Un||!ii)&&Ru(!1)},[c,Un,ii]),gi(()=>{if(Ba.current){try{Ba.current()}catch{}Ba.current=null}const O=F||j;if(!O||!Ar||!e)return;const he=Qc(e),Ie=fp(O),qe=Na(Ar),Qe=Bm(mh,"universities",he,"buildings",Ie,"floors",qe,"rooms");return Ba.current=VO(Qe,Fe=>{const $e=new Map;Fe.forEach(St=>{const Mt=St.data();$e.set(St.id,{...Mt,buildingId:Mt.original?.buildingName??O,floor:Mt.original?.floorLabel??Ar,revitId:Mt.original?.featureId??Mt.revitId??St.id})}),Dl($e)}),()=>{if(Ba.current){try{Ba.current()}catch{}Ba.current=null}}},[F,j,Ar,e]),gi(()=>{As.current=F,F||(xs.current=null,Bl.current=null,Ln(null),Dn(null),Si("building"),Ws.current||or(null))},[F]),gi(()=>{if(c||!k||!_.current||!n)return;const O=_.current;if(!O.getSource("buildings")){if(O.addSource("buildings",{type:"geojson",data:n.buildings,promoteId:"id"}),O.addLayer({id:"buildings-layer",type:"fill-extrusion",source:"buildings",paint:{"fill-extrusion-color":hd(Vm),"fill-extrusion-height":15,"fill-extrusion-opacity":.7}}),O.addLayer({id:"buildings-outline-base",type:"line",source:"buildings",paint:{"line-color":"rgba(0,0,0,0.35)","line-width":1.6,"line-opacity":.8}}),O.addLayer({id:"buildings-outline",type:"line",source:"buildings",paint:{"line-color":"#1d4ed8","line-width":2.6,"line-opacity":["case",["boolean",["feature-state","selected"],!1],1,0]}}),!O.getLayer("buildings-fill"))try{O.addLayer({id:"buildings-fill",type:"fill",source:"buildings",paint:{"fill-opacity":0}},"buildings-outline")}catch{O.addLayer({id:"buildings-fill",type:"fill",source:"buildings",paint:{"fill-opacity":0}})}O.addLayer({id:"buildings-labels",type:"symbol",source:"buildings",layout:{"text-field":["coalesce",["get","name"],["get","id"]],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":10,"text-anchor":"center","text-variable-anchor":["center"],"text-offset":[0,0],"text-line-height":1,"text-allow-overlap":!1,"text-max-width":10,"symbol-placement":"point"},paint:{"text-color":"#111111","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":1}}),O.getLayer("buildings-hit")||O.addLayer({id:"buildings-hit",type:"line",source:"buildings",paint:{"line-color":"#007aff","line-width":2},filter:["==",["get","id"],F||""]})}if(n.boundary&&!O.getSource("boundary")){const he=Tu(n.boundary);he?(O.addSource("boundary",{type:"geojson",data:he}),O.addLayer({id:"boundary-layer",type:"line",source:"boundary",paint:{"line-color":"#a9040e","line-width":3,"line-dasharray":[2,2]}})):console.warn("Boundary provided but could not normalize to FeatureCollection.")}},[k,n]),gi(()=>{if(!k||!_.current||!n)return;const O=_.current;O.getSource("buildings")||(O.addSource("buildings",{type:"geojson",data:n.buildings,promoteId:"id"}),O.addLayer({id:"buildings-layer",type:"fill-extrusion",source:"buildings",paint:{"fill-extrusion-color":hd(Vm),"fill-extrusion-height":15,"fill-extrusion-opacity":.7}}),O.addLayer({id:"buildings-outline",type:"line",source:"buildings",paint:{"line-color":"#1d4ed8","line-width":2.2,"line-opacity":["case",["boolean",["feature-state","selected"],!1],1,0]}}),O.getLayer("buildings-fill")||O.addLayer({id:"buildings-fill",type:"fill",source:"buildings",paint:{"fill-opacity":0}},"buildings-outline"));const he=async Ie=>{if(!O)return;let qe=null;try{if(O.getLayer(jo)){const St=O.queryRenderedFeatures(Ie.point,{layers:[jo]});qe=St&&St[0]}}catch{}if(qe)return;const Qe=Ie.features&&Ie.features[0];if(!Qe)return;Bl.current=Qe;const Fe=Qe.properties?.id;if(!Fe)return;try{o.current&&O.setFeatureState({source:"buildings",id:o.current},{selected:!1}),O.setFeatureState({source:"buildings",id:Fe},{selected:!0}),o.current=Fe}catch{}q(Fe),As.current=Fe;const $e=O.project(Ie.lngLat);dc(rn($e)),ir(!1),Si("building"),Dn(null),Ln(null),or({loading:!0,mode:"building"}),Ze(Fe);try{const St=await Ae(Fe);if(As.current!==Fe)return;if(Ws.current||(Ln(St),or($u(St,"building"))),Re!==Me.SPACE_DATA){const Mt=await ge?.(Fe)||St||{},gt=en=>Number.isFinite(en)?Math.round(en).toLocaleString():"-",Zt=en=>Number.isFinite(en)?Number(en).toLocaleString():"-",Kt=yU(Mt.keyDepts||[]),gn=`
          <div class="mf-popup mf-popup--building" style="min-width:280px;padding:8px 10px;">
            <div style="display:flex;gap:18px;align-items:flex-start;">
              <div style="flex:1">
                <div style="font-weight:700;margin-bottom:6px;">${buildingName}</div>
                <div><b>Total SF:</b> ${gt(Mt.totalSf)}</div>
                <div><b>Rooms:</b> ${Zt(Mt.rooms)}</div>
                <div><b>Classroom SF:</b> ${gt(Mt.classroomSf)}</div>
                <div><b>Classrooms:</b> ${Zt(Mt.classroomCount)}</div>
              </div>
              <div style="min-width:180px;">
                <div style="font-weight:600;margin-bottom:4px;">Key Departments</div>
                ${Kt||'<div class="mf-subtle">?</div>'}
              </div>
            </div>
          </div>`;new Rd.Popup({offset:12}).setLngLat(Ie.lngLat).setHTML(gn).addTo(O)}}catch(St){console.warn("Failed to load building totals for popup:",St)}};return O.__mf_building_click_bound||(O.on("click","buildings-fill",he),O.__mf_building_click_bound=!0),()=>{try{O.__mf_building_click_bound&&(O.off("click","buildings-fill",he),O.__mf_building_click_bound=!1)}catch{}}},[c,k,n,Re,Ze,Ae,ge]),gi(()=>{if(!k||!_.current)return;const O=_.current,he=(Fe,$e)=>{try{O.setPaintProperty("buildings-layer","fill-extrusion-color",Fe),O.setPaintProperty("buildings-layer","fill-extrusion-opacity",$e)}catch{}},Ie=(Fe,$e,St)=>{try{O.setPaintProperty(Fe,"fill-color",$e),O.setPaintProperty(Fe,"fill-opacity",St)}catch{}},qe=O.getLayer("buildings-layer"),Qe=O.getLayer("buildings-fill");if(Re===Me.SPACE_DATA)qe&&(qe.type==="fill-extrusion"?he(hd("#ffffff"),1):Ie("buildings-layer",hd("#ffffff"),1)),qA(O);else if(qe&&(qe.type==="fill-extrusion"?he(hd(Vm),.7):Ie("buildings-layer",hd(Vm),.7)),Qe){Ie("buildings-fill",hd(Vm),.2);try{O.setPaintProperty("buildings-fill","fill-outline-color","#00000000")}catch{}cC(O)}},[k,Re]),gi(()=>{if(!k||!_.current)return;const O=_.current;try{O.getLayer("buildings-hit")&&O.setFilter("buildings-hit",["==",["get","id"],F||""])}catch{}},[F,k]),gi(()=>{if(!k||!_.current)return;const O=_.current;o.current&&O.setFeatureState({source:"buildings",id:o.current},{selected:!1}),F&&O.setFeatureState({source:"buildings",id:F},{selected:!0}),o.current=F},[F,k,t]),gi(()=>{if(!k||!_.current)return;const O=_.current,he=()=>{const qe=O.getStyle?.(),Qe=qe?.layers||[],Fe=qe?.sources||{};try{O.getLayer(Xd)&&O.removeLayer(Xd)}catch{}try{O.getLayer(Zd)&&O.removeLayer(Zd)}catch{}Qe.map($e=>$e?.id).filter($e=>typeof $e=="string"&&$e.startsWith("engagement-heat-layer-")).forEach($e=>{try{O.removeLayer($e)}catch{}}),Object.keys(Fe).filter($e=>$e.startsWith("engagement-heat-source-")).forEach($e=>{try{O.removeSource($e)}catch{}})},Ie=()=>{ST.forEach(({layerId:qe})=>{try{O.getLayer(qe)&&O.removeLayer(qe)}catch{}});try{O.getLayer(Xd)&&O.removeLayer(Xd)}catch{}try{O.getLayer(Zd)&&O.removeLayer(Zd)}catch{}try{O.getSource(Um)&&O.removeSource(Um)}catch{}};if(!c){Ie(),he();return}try{he();const qe=O.getSource(Um);qe&&typeof qe.setData=="function"?qe.setData(Mp):O.addSource(Um,{type:"geojson",data:Mp});const Qe=O.getLayer("boundary-layer")?"boundary-layer":O.getLayer("buildings-labels")?"buildings-labels":void 0,Fe=!0,$e=!!ii;O.getLayer(Xd)||O.addLayer({id:Xd,type:"heatmap",source:Um,maxzoom:l5,filter:["all",["in",["coalesce",["get","heatCategory"],""],["literal",yq]],c5],paint:{"heatmap-weight":TT(),"heatmap-intensity":IT(Fe),"heatmap-radius":CT($e),"heatmap-opacity":LT(Fe),"heatmap-color":Sq()}},Qe),O.setPaintProperty(Xd,"heatmap-weight",TT()),O.setPaintProperty(Xd,"heatmap-intensity",IT(Fe)),O.setPaintProperty(Xd,"heatmap-radius",CT($e)),O.setPaintProperty(Xd,"heatmap-opacity",LT(Fe)),u5(O,Xd,De&&wT),O.getLayer(Zd)||O.addLayer({id:Zd,type:"heatmap",source:Um,maxzoom:l5,filter:["all",["in",["coalesce",["get","heatCategory"],""],["literal",_q]],c5],paint:{"heatmap-weight":["*",Hv,.98],"heatmap-intensity":PT(Fe),"heatmap-radius":kT($e),"heatmap-opacity":MT(Fe),"heatmap-color":Eq()}},Qe),O.setPaintProperty(Zd,"heatmap-weight",["*",Hv,.98]),O.setPaintProperty(Zd,"heatmap-intensity",PT(Fe)),O.setPaintProperty(Zd,"heatmap-radius",kT($e)),O.setPaintProperty(Zd,"heatmap-opacity",MT(Fe)),u5(O,Zd,De&&wT),ST.forEach(({category:St,layerId:Mt})=>{O.getLayer(Mt)||O.addLayer({id:Mt,type:"heatmap",source:Um,maxzoom:l5,filter:["all",["==",["coalesce",["get","heatCategory"],""],St],c5],paint:{"heatmap-weight":AT(St),"heatmap-intensity":NT(St,Fe),"heatmap-radius":RT(St,$e),"heatmap-opacity":DT(St,Fe),"heatmap-color":wq(St)}},Qe),O.setPaintProperty(Mt,"heatmap-weight",AT(St)),O.setPaintProperty(Mt,"heatmap-intensity",NT(St,Fe)),O.setPaintProperty(Mt,"heatmap-radius",RT(St,$e)),O.setPaintProperty(Mt,"heatmap-opacity",DT(St,Fe)),u5(O,Mt,De)})}catch(qe){console.warn("Engagement heatmap update failed",qe)}},[k,c,Mp,De,ii]),gi(()=>{if(!k||!_.current)return;const O=_.current;O.getCanvas().parentElement.querySelectorAll(".custom-mapbox-marker").forEach(qe=>qe.remove());const he=t==="admin"?J?uf:[]:c?il:N;c&&(De||hl)||he.forEach(qe=>{const Qe=document.createElement("div");Qe.className="custom-marker custom-mapbox-marker";const Fe=c?ET(qe.type):Rc[qe.type]||"#9E9E9E";Qe.style.backgroundColor=Fe;const $e=new Rd.Marker(Qe).setLngLat(qe.coordinates);if(Re!==Me.SPACE_DATA){const St=c?vq(qe.type):qe.type;$e.setPopup(new Rd.Popup({offset:25}).setText(qe.comment||St))}$e.addTo(O)})},[uf,N,il,Rc,wu,k,t,J,c,De,hl]),gi(()=>{if(!k||!_.current||!_.current.getSource("buildings"))return;const O=_.current;if(Re===Me.SPACE_DATA){if(Vo&&se&&Object.keys(se).length>0){const Qe=["match",["get","id"]];Object.entries(se).forEach(([$e,St])=>{const Mt=Number.isFinite(St?.overallUtilization)?St.overallUtilization:null,gt=fq(Mt);Qe.push($e,gt)}),Qe.push("#e5e7eb");const Fe=hd(Qe);try{O.setPaintProperty("buildings-layer","fill-extrusion-color",Fe),O.setPaintProperty("buildings-layer","fill-extrusion-opacity",.2),O.getLayer("buildings-fill")&&(O.setPaintProperty("buildings-fill","fill-color",Fe),O.setPaintProperty("buildings-fill","fill-opacity",.55),O.setPaintProperty("buildings-fill","fill-outline-color","rgba(0,0,0,0)"))}catch{}}else try{O.setPaintProperty("buildings-layer","fill-extrusion-color",hd("#ffffff")),O.setPaintProperty("buildings-layer","fill-extrusion-opacity",.7),O.getLayer("buildings-fill")&&(O.setPaintProperty("buildings-fill","fill-color",hd("#ffffff")),O.setPaintProperty("buildings-fill","fill-opacity",0))}catch{}return}if(O.getLayer("buildings-fill"))try{O.setPaintProperty("buildings-fill","fill-opacity",0)}catch{}try{O.setPaintProperty("buildings-layer","fill-extrusion-opacity",.7)}catch{}const he=["match",["get","id"]];let Ie=!1;t==="admin"&&Re===Me.ASSESSMENT&&Object.keys(pe).length>0?Object.entries(pe).forEach(Qe=>{const Fe=Qe[0],$e=Qe[1];let St=0;const Mt=$e&&$e.scores?$e.scores:{};Mt.architecture&&Object.values(Mt.architecture).some(gt=>gt>0)&&St++,Mt.engineering&&Object.values(Mt.engineering).some(gt=>gt>0)&&St++,Mt.functionality&&Object.values(Mt.functionality).some(gt=>gt>0)&&St++,he.push($e&&$e.originalId||Fe,lq[St]),Ie=!0}):t==="admin"&&Re===Me.SPACE_DATA&&Object.keys(ke).length>0&&Object.entries(ke).forEach(Qe=>{const Fe=Qe[0],$e=Qe[1],St=aq[$e];St&&(he.push(Fe,St.color),Ie=!0)}),he.push(Vm);const qe=hd(he);Ie?O.setPaintProperty("buildings-layer","fill-extrusion-color",qe):O.setPaintProperty("buildings-layer","fill-extrusion-color",hd(Vm))},[ke,pe,k,t,Re,Vo,se]);const hf=Qn(O=>{if(!_.current)return;const he=document.createElement("div");he.className="marker-prompt-popup",he.innerHTML=`
      <h4>Add a Marker</h4>
      <select id="marker-type">${Object.keys(Rc).map(qe=>`<option value="${qe}">${qe}</option>`).join("")}</select>
      <textarea id="marker-comment" placeholder="Optional comment..."></textarea>
      <div class="button-group">
        <button id="confirm-marker">Add</button>
        <button id="cancel-marker">Cancel</button>
      </div>`;const Ie=new Rd.Popup({closeOnClick:!1,maxWidth:"280px"}).setDOMContent(he).setLngLat(O).addTo(_.current);he.querySelector("#confirm-marker").addEventListener("click",async()=>{const qe=he.querySelector("#marker-type").value,Qe=he.querySelector("#marker-comment").value.trim(),Fe=jr.current||{},$e=Un&&ii,St=$e&&(Fe.buildingId||F||j)||"",Mt=fp(St||""),gt=String(Cf(St)||Ii).trim(),Zt=$e?Na(Fe.floorId||Ar||""):"",Kt=$e?String(Fe.floorLabel||Ar||"").trim():"",gn=$e?String(Fe.url||Ks||"").trim():"",en={coordinates:new dx(O.lat,O.lng),type:qe,comment:Qe,buildingId:Mt,buildingName:gt,floorId:Zt,floorLabel:Kt,floorUrl:gn,persona:i||(c?"student":"admin"),createdAt:E1()},$t=await VE(zd,en),un={...en,id:$t.id,coordinates:[O.lng,O.lat]};ue(vr=>[...vr,un]),z(vr=>[...vr,un]),Ie.remove()}),he.querySelector("#cancel-marker").addEventListener("click",()=>Ie.remove())},[Rc,zd,i,c,F,j,Ar,Ks,Ii,Un,ii]);gi(()=>{if(!c||t==="admin"||!k||!_.current)return;const O=_.current,he=Ie=>{if(!(On.current||to.current)&&!(Un&&!ii)){try{if(Un){const qe=O.queryRenderedFeatures(Ie.point,{layers:["buildings-fill"]})||[],Qe=String(qe[0]?.properties?.id||""),Fe=String(As.current||F||j||"");if(Qe&&Fe&&Qe!==Fe)return}}catch{}hf(Ie.lngLat)}};return O.on("click",he),()=>{try{O.off("click",he)}catch{}}},[c,t,k,hf,ii,F,j,Un]),gi(()=>{if(!k||!_.current)return;const O=_.current,he=Ie=>{const qe=xn.current;if(!qe)return;try{Ie.preventDefault?.(),Ie.originalEvent&&(Ie.originalEvent.preventDefault?.(),Ie.originalEvent.stopPropagation?.(),Ie.originalEvent.cancelBubble=!0)}catch{}const Qe=Number(qe.step)||0,Fe=Qe<2,$e=Fe?jo:Sp,Mt=jr.current?.fc||null;let gt=null;if(Fe){if(O.getLayer($e)){const Kt=O.queryRenderedFeatures(Ie.point,{layers:[$e]})||[];if(Kt.length){const gn=[Ie.lngLat.lng,Ie.lngLat.lat];gt=FU(Kt[0],gn)}}if(!gt&&Mt&&(gt=Yb({map:O,fc:Mt,isDrawing:!1,screenPoint:Ie.point,maxPixels:UU,maxPoints:Jb})),!gt){Lt("Click closer to a room polygon (or zoom in).");return}}else{const Kt=!!Mt?.features?.some(gn=>{const en=gn?.geometry?.type||"";return Mh(gn?.properties||{})||en==="LineString"||en==="MultiLineString"});if(Mt&&(gt=Yb({map:O,fc:Mt,isDrawing:!0,screenPoint:Ie.point,maxPixels:VU,maxPoints:Jb})),!gt&&Kt&&Mt&&(gt=Yb({map:O,fc:Mt,isDrawing:!0,screenPoint:Ie.point,maxPixels:null,maxPoints:Jb})),!gt){Lt(Kt?"No drawing vertex nearby. Zoom in and click closer to linework.":"No drawing linework found on this floor.");return}}const Zt={...qe,roomPts:Array.isArray(qe.roomPts)?[...qe.roomPts]:[],drawingPts:Array.isArray(qe.drawingPts)?[...qe.drawingPts]:[]};if(Fe?Zt.roomPts.push(gt):Zt.drawingPts.push(gt),Zt.step=Qe+1,Zt.step>=DA.length){const Kt=_n(Zt.roomPts,Zt.drawingPts);if(!Kt){Lt("Unable to compute alignment from those points.");return}if(!CU(qe.buildingLabel,qe.floorId,Kt)){Lt("Failed to save alignment in local storage.");return}Ot(null),Lt("");const en=lo(j,qe.floorId);en&&(gs.delete(en),Wu.delete(en)),Zr(qe.floorId);return}Lt(""),Ot(Zt)};return O.on("click",he),()=>{try{O.off("click",he)}catch{}}},[k,j,lo,Zr,_n]),gi(()=>{if(!k||!_.current)return;const O=_.current,he=(Fe,$e)=>{const St=Mf(Ls([Fe.lng,Fe.lat]),Ls([$e.lng,Fe.lat]),{units:"kilometers"}),Mt=Mf(Ls([Fe.lng,Fe.lat]),Ls([Fe.lng,$e.lat]),{units:"kilometers"}),gt=($e.lng>=Fe.lng?1:-1)*St*1e3,Zt=($e.lat>=Fe.lat?1:-1)*Mt*1e3;return[gt,Zt]},Ie=Fe=>{if(!to.current)return;try{Fe.preventDefault?.(),Fe.originalEvent&&(Fe.originalEvent.preventDefault?.(),Fe.originalEvent.stopPropagation?.(),Fe.originalEvent.cancelBubble=!0)}catch{}const $e=Ei.current;if(!$e)return;const St=_t(),Mt=St.url||lo(j,St.floorId),gt=St.basePath||jr.current?.floorAdjustBasePath||null,Zt=jr.current?.floorAdjustBasePivot||null,Kt=gt?By(gt,St.floorId):null,gn=mp(Kt),en=Mt?Oy(Mt):null,$t=mp(en),un=gn?Kt:$t?en:Wm(St.buildingLabel,St.floorId),vr=Array.isArray(un.translateLngLat)?un.translateLngLat:[0,0],Pr=jr.current?.floorAdjustLabel||(Mt?Fd(Mt):null)||St.buildingLabel,rr=Gu(O,da)?._data||jr.current?.fc||null;if(!rr){wr("No floor data to adjust.");return}let ni=null;try{ni=xc(rr)?.geometry?.coordinates||null}catch{ni=null}if(!ni){wr("Unable to find a transform pivot.");return}const Yr=O.project({lng:ni[0],lat:ni[1]}),Jr=Math.atan2(Fe.point.y-Yr.y,Fe.point.x-Yr.x);Wo.current={mode:$e,baseData:JSON.parse(JSON.stringify(rr)),pivot:ni,pivotScreen:Yr,startAngle:Jr,startRotation:un.rotationDeg||0,startScale:un.scale||1,startTranslate:un.translateMeters||[0,0],startTranslateLngLat:vr,startLngLat:Fe.lngLat,buildingLabel:St.buildingLabel,floorId:St.floorId,adjustUrl:Mt,adjustLabel:Pr,adjustBasePath:gt,basePivot:Zt};try{O.dragPan.disable()}catch{}try{O.getCanvas().style.cursor="grabbing"}catch{}},qe=Fe=>{const $e=Wo.current;if(!$e)return;const St=Gu(O,da);if(St){if($e.mode==="rotate"){const gt=(Math.atan2(Fe.point.y-$e.pivotScreen.y,Fe.point.x-$e.pivotScreen.x)-$e.startAngle)*180/Math.PI,Zt=Zh($e.baseData,gt,{pivot:$e.pivot});St.setData(Zt);return}if($e.mode==="move"){he($e.startLngLat,Fe.lngLat);const Mt=Fe.lngLat.lng-$e.startLngLat.lng,gt=Fe.lngLat.lat-$e.startLngLat.lat,Zt=nw($e.baseData,[Mt,gt]);St.setData(Zt)}}},Qe=Fe=>{const $e=Wo.current;if(!$e)return;let St=Wm($e.buildingLabel,$e.floorId);if($e.mode==="rotate"){const un=(Math.atan2(Fe.point.y-$e.pivotScreen.y,Fe.point.x-$e.pivotScreen.x)-$e.startAngle)*180/Math.PI,vr=Array.isArray($e.basePivot)?$e.basePivot:Array.isArray($e.pivot)?$e.pivot:St.pivot;St={...St,rotationDeg:($e.startRotation||0)+un,pivot:vr}}else if($e.mode==="move"){const[$t,un]=he($e.startLngLat,Fe.lngLat),vr=Fe.lngLat.lng-$e.startLngLat.lng,Pr=Fe.lngLat.lat-$e.startLngLat.lat,Gn=Array.isArray($e.basePivot)?$e.basePivot:Array.isArray($e.pivot)?$e.pivot:St.pivot;St={...St,translateMeters:[($e.startTranslate?.[0]||0)+$t,($e.startTranslate?.[1]||0)+un],translateLngLat:[($e.startTranslateLngLat?.[0]||0)+vr,($e.startTranslateLngLat?.[1]||0)+Pr],pivot:Gn}}const gt=Gu(O,da)?._data||jr.current?.fc||null,Zt=rv(gt);Zt&&(St={...St,anchorLngLat:Zt});const Kt=$e.adjustLabel||$e.buildingLabel;P1(Kt,$e.floorId,St),$e.adjustUrl&&k1($e.adjustUrl,St),$e.adjustBasePath&&M1($e.adjustBasePath,$e.floorId,St);try{jt(Kt,$e.floorId,St)}catch{}const gn=Fv(St);if(gn&&gt){const $t={...gt,__mfUserAdjustSignature:gn};$e.adjustUrl&&gs.set($e.adjustUrl,$t),jr.current={...jr.current||{},fc:$t}}Wo.current=null,Ir(null),wr("");const en=$e.adjustUrl||lo(j,$e.floorId);en&&!$e.adjustUrl&&(gs.delete(en),Wu.delete(en));try{O.dragPan.enable()}catch{}try{O.getCanvas().style.cursor=$e.mode==="move"?"move":"grab"}catch{}};return O.on("mousedown",Ie),O.on("mousemove",qe),O.on("mouseup",Qe),()=>{try{O.off("mousedown",Ie)}catch{}try{O.off("mousemove",qe)}catch{}try{O.off("mouseup",Qe)}catch{}}},[k,j,lo,_t,jt]),gi(()=>{if(!k||!_.current)return;const O=_.current,he=Qe=>{try{Qe.preventDefault?.(),Qe.originalEvent&&(Qe.originalEvent.preventDefault?.(),Qe.originalEvent.stopPropagation?.(),Qe.originalEvent.cancelBubble=!0)}catch{}if(On.current||to.current)return;if(c){No(null);return}Qu.current=null;const Fe=Qe.features?.[0];if(!Fe)return;if(Pa){try{const Vr=Fe.properties||{},ms=F||j||Vr.Building||Vr.buildingId||"",as=Vr.Floor||Ar||Ks?.match(/(BASEMENT|LEVEL_\d+|LEVEL|L\d+)/)?.[0]||"LEVEL_1",hu=Fe.id??Vr.RevitId??Vr.revitId??null,vl=Vr.Number??Vr.RoomNumber??Vr.number??Vr.Room??"",Ch=na(pd(Vr)||Vr.__roomType||""),Ad=Vr.department??Vr.Department??Vr.Dept??"",$h=kf(Vr),Jf=Number.isFinite($h)?$h:0,Lh=ms&&as&&hu!=null?Yd(ms,as,hu):null;if(!Lh){console.warn("Scenario click: could not build roomId",{buildingId:ms,floorName:as,revitId:hu,props:Vr});return}const ff=Qe.point||O.project(Qe.lngLat);C({roomId:Lh,buildingId:ms,buildingName:Vr.BuildingName||Vr.buildingName||ms,floorName:as,revitId:hu,roomNumber:vl,roomType:Ch,department:Ad,area:Number(Jf)||0}),ft(ff),zt()}catch(Vr){console.warn("Scenario click failed",Vr)}return}Qu.current=Fe;const $e=Fe.id??Fe.properties?.RevitId??null;je||No($e),Ks&&(w.current||(w.current={}),w.current[Ks]=$e);const St=Fe.properties||{},Mt=F||j,gt=Ii,Zt=Fe.id??St.RevitId??null,Kt=St.Floor||Ar||Ks?.match(/(BASEMENT|LEVEL_\d+|LEVEL|L\d+)/)?.[0]||"LEVEL_1",gn=Mt&&Zt!=null?Yd(Mt,Kt,Zt):null;if(Pa){if(!gn)return;Qh(Vr=>{const ms=new Set(Vr);return ms.has(gn)?ms.delete(gn):ms.add(gn),lr(ms),ms});return}const en=gn?aa.get(gn):null,$t=en?{...St,...en}:St,un=$t.Number??$t.RoomNumber??$t.number??$t.Room??"",vr=na(pd($t)||$t.__roomType||""),Pr=na($t.__dept||Ky($t)||""),Gn=$t.occupant??$t.Occupant??"",rr=$t.comments??$t.Comments??"",ni=Po($t),Yr=kf($t);let Jr=vr,Gi=Pr,Or=Number.isFinite(Yr)?Yr:null,Ur=Gn;const Ui=L8($t),kr=Zb($t),Kr=k8($t),ki=P8(Ui)||Kr.isOfficeText,Vn=R1(vr)||SU(Ui)||Kr.isTeachingText,on=Mt&&Kt&&Zt!=null?Yd(Mt,Kt,Zt):null,hn=(Ur??"").toString().trim(),Hn=un||"-",tr=String($t.Revit_UniqueId??$t.RevitUniqueId??St.Revit_UniqueId??St.RevitUniqueId??St["Room GUID"]??"").trim(),Qr=uo(Mt),co=Lf(Kt),Do=String(un??"").trim(),ei=Ce?.length?Ce:yt,Hi=Array.isArray(ei)?ei.find(Vr=>{if(!Vr)return!1;const ms=String(Vr?.roomId??Vr?.roomNumber??Vr?.roomLabel??"").trim(),as=String(Vr?.roomGuid??Vr?.revitUniqueId??"").trim();if(tr&&(as===tr||ms===tr))return!0;const hu=uo(Vr?.building??Vr?.buildingName??Vr?.buildingLabel??"");return Qr&&hu!==Qr||co.length&&!Tf(Vr?.floor??Vr?.floorName??Vr?.floorId??"",co)?!1:Do&&ms===Do}):null,Bn=Hi?.airtableId||Hi?.AirtableId||Hi?.["Airtable ID"]||null;if(je){if(!Ye){if(!hn||!on||$e==null){console.warn("Cannot start move: missing occupant or identifiers.");return}tt({roomId:on,roomLabel:Hn,buildingId:Mt,buildingName:gt,floorId:Kt,occupantName:hn,revitId:Zt,highlightId:$e}),Nt(null),No($e);return}if($e===Ye.highlightId){tt(null),Nt(null),No(null);return}if(Mt!==Ye.buildingId||Kt!==Ye.floorId){tt(null),Nt(null),No(null);return}Nt({person:Ye.occupantName,effectiveDate:"",comments:"",from:Ye,to:{roomId:on,roomLabel:Hn,buildingId:Mt,buildingName:gt,floorId:Kt,revitId:Zt,highlightId:$e}});return}const $a=y,Zs=$t.Floor||Kt,mc=!!(t==="admin"&&$a&&Mt&&Zs&&Zt!=null&&e),ns=mc?Yd(Mt,Zs,Zt):null,Wn=mc?{roomId:ns,buildingId:Mt,floorName:Zs,revitId:Zt,roomGuid:tr||null,roomLabel:Hn,roomNumber:un||"",feature:Fe,flags:{isOffice:ki,isTeaching:Vn},highlightId:$e,properties:{type:Jr||"",department:Gi||"",area:Number.isFinite(Or)?Or:"",occupant:Ur||"",occupancyStatus:ni||"",comments:rr||"",roomGuid:tr||"",Revit_UniqueId:tr||"",airtableId:Bn}}:null;let ba=el.current||[];if(Wn){const Vr=el.current||[];Vr.findIndex(as=>as.roomId===Wn.roomId)>=0?ba=Vr.filter(as=>as.roomId!==Wn.roomId):ba=[...Vr,Wn],el.current=ba,rc(ba),Al(ba)}const Hc=()=>{const Vr=Number.isFinite(Or)&&Or!==0?Math.round(Or).toLocaleString():"",as=(el.current||[]).length,hu=as>0,vl=as>1?`Edit ${as} Rooms`:"Edit",Ch=mc?`<div class="mf-popup-actions" style="margin-top:6px;padding-top:6px;gap:6px;flex-wrap:wrap;width:100%;">
               <button id="mf-room-edit-btn" class="mf-btn tiny">${vl}</button>
               ${hu?'<button id="mf-clear-edit-selection" class="mf-btn tiny" style="background:#f4f4f4;color:#333;">Clear Selection</button>':""}
             </div>`:"",Ad=Number.isFinite(kr)&&kr>0,$h=(Ur??"").toString().trim(),Jf=R1(Jr||""),Lh=Ad?kr.toLocaleString():"-",ff=Jf?`<div><b>Seat Count:</b> ${Lh}</div>`:"",Gl=$h.length?$h:"-",ti=Jf?"":`<div><b>Occupant:</b> ${Gl}</div>`,Ma=Jf?He(gt,un||Hn):null,Cs=Ma&&(Number.isFinite(Ma.timeUtilization)||Number.isFinite(Ma.seatUtilization)),Ys=(Ho,Td,Ra)=>{if(!Number.isFinite(Td))return"";const Qf=Math.max(0,Math.min(Td,100));return`
            <div style="margin-top:3px;">
              <div style="font-size:10px;color:#444;">${Ho}: ${Math.round(Td)}%</div>
              <div style="height:4px;background:#e4e7ec;border-radius:999px;overflow:hidden;">
                <div style="width:${Qf}%;height:100%;background:${Ra};"></div>
              </div>
            </div>
          `},Ga=Cs?`
            <div style="margin-top:6px; width:100%; max-width:220px;">
              ${Ys("Time Util",Ma.timeUtilization,"#3b82f6")}
              ${Ys("Seat Util",Ma.seatUtilization,"#f59e0b")}
            </div>
          `:"",yc=mc&&as?`<div style="font-size:11px;color:#555;margin-top:6px;">Rooms selected: ${as}</div>`:"";return`
          <div class="mf-popup" style="min-width:340px;max-width:460px;background:#fff;border-radius:8px;box-shadow:0 8px 24px rgba(0,0,0,0.15);padding:2px;">
            <div class="mf-popup-body" style="padding:8px 12px 16px 12px;">
              <div class="mf-title">Room ${un||"-"}</div>
              <div><b>Room Type:</b></div>
              <div style="white-space:normal;word-break:break-word;margin-bottom:2px;">${Jr||"-"}</div>
              <div><b>Department:</b> ${Gi||"-"}</div>
              <div><b>Area (SF):</b> ${Vr||"-"}</div>
              <div><b>Floor:</b> ${Zs}</div>
              ${ff}
              ${ti}
              ${Ga}
              ${yc}
              ${Ch}
            </div>
          </div>`},Sd=O.project(Qe.lngLat),gc=m.current?.clientWidth||1e3,jd=Sd.x>gc*.56?"right":"left",Nc=jd==="left"?240:-240,Vh={top:[Nc,12],"top-left":[Nc,12],"top-right":[Nc,12],bottom:[Nc,-12],"bottom-left":[Nc,-12],"bottom-right":[Nc,-12],left:[Nc,0],right:[Nc,0]},Is=new Rd.Popup({closeButton:!0,offset:Vh,anchor:jd,maxWidth:"520px"}).setLngLat(Qe.lngLat).setHTML(Hc()).addTo(O);Is.on("close",()=>{if(!je&&!Ye){const Vr=Ac(el.current||[]);No(Vr.length?Vr:null)}});const $l=async()=>{try{Is.remove()}catch{}const Vr=Ws.current||nu.current;if(Vr){we(Me.SPACE_DATA),tn(!1),ir(!1);try{const ms=O.project(Qe.lngLat);dc(rn(ms))}catch{}As.current?q(As.current):j&&q(j),Xe(Vr)}},uu=()=>{if(!mc)return;const ms=Ca.length?ns&&Ca.some(Ch=>Ch.roomId===ns)||!Wn?Ca:[...Ca,Wn]:Wn?[Wn]:[];if(!ms.length)return;const as=vl=>{const Ch=ms.map($h=>$h?.properties?.[vl]??""),Ad=Ch[0];return Ch.every($h=>$h===Ad)?Ad:""},hu={type:as("type"),department:as("department"),occupant:as("occupant"),occupancyStatus:as("occupancyStatus"),comments:as("comments"),area:as("area")};$o({...ms[0],targets:ms,roomLabel:ms.length===1?ms[0]?.roomLabel||"-":`${ms.length} rooms`,properties:hu,includedKeys:new Set(ms.map(vl=>vl.roomId||String(vl.revitId??""))),refreshPopup:()=>{Is.setHTML(Hc()),qh()},onApply:vl=>{"type"in vl&&(Jr=vl.type),"department"in vl&&(Gi=vl.department),"occupant"in vl&&(Ur=vl.occupant)}}),Sl(new Set(ms.map(vl=>vl.roomId||String(vl.revitId??"")))),ma(!0)},Ed=()=>{el.current=[],rc([]),Al([]);try{Is.remove()}catch{}};function qh(){const Vr=Is.getElement();Vr&&(Vr.querySelector("#mf-show-floor")?.addEventListener("click",$l),mc&&(Vr.querySelector("#mf-room-edit-btn")?.addEventListener("click",uu),Vr.querySelector("#mf-clear-edit-selection")?.addEventListener("click",Ed)))}qh()},Ie=()=>{if(!(On.current||to.current)&&!c)try{O.getCanvas().style.cursor="pointer"}catch{}},qe=()=>{if(!(On.current||to.current))try{O.getCanvas().style.cursor=""}catch{}};return O.on("click",jo,he),O.on("mouseenter",jo,Ie),O.on("mouseleave",jo,qe),()=>{try{O.off("click",jo,he),O.off("mouseenter",jo,Ie),O.off("mouseleave",jo,qe)}catch{}Qu.current=null}},[k,Ks,j,F,Ar,Xe,we,tn,ir,dc,Li,aa,yt,Ce,y,Jt,e,$,ge,Q,Re,ai,Pa,je,Ye,No,Ca,pl,Al,Ac,c]),gi(()=>{if(!k||!_.current)return;const O=_.current,he=Ie=>{const qe=_.current;if(!qe||On.current||to.current)return;const Qe=As.current;if(!Qe)return;if(!!!qe.getLayer(jo)){Ue(Qe);return}const $e=Ie.point,St=qe.queryRenderedFeatures($e,{layers:[jo]});if(St&&St.length||!!!qe.getLayer("buildings-fill"))return;qe.queryRenderedFeatures($e,{layers:["buildings-fill"]})?.some(Kt=>Kt.properties?.id===Qe)&&(Ws.current=null,Ue(Qe))};return O.on("click",he),()=>{try{O.off("click",he)}catch{}}},[k,Ue]);const xg=Qn(()=>{},[]),df=Qn(async()=>{const O=xs.current||F||j;if(!O){alert("No building selected for export.");return}if(!_a.length){alert("No floors available for export.");return}const he=[];for(const Fe of _a){const $e=lo(O,Fe);if(!$e)continue;const St=await dd($e),Mt=Tu(St);if(!Mt?.features?.length)continue;const gt=Kg({fc:Mt,colorMode:Ji,solidFill:!0,labelOptions:{hideDrawing:!0}});gt&&he.push({img:gt,label:`${Ii} - ${Fe}`})}if(!he.length){alert("No floorplans could be rendered for export.");return}const Ie=pp(Vt?.totalsByDept),qe={totalSF:Vt?.totalSf,rooms:Vt?.rooms,classroomSf:Vt?.classroomSf,classroomCount:Vt?.classroomCount,levels:_a.length},Qe=`${Ii.replace(/\s+/g,"-").toLowerCase()}-floors`;io(he,{filenameBase:Qe,stats:qe,keyDepts:Ie,summaryLabel:`${Ii} Floors`})},[_a,Ii,lo,io,j,F]);return Y.jsxs("div",{ref:u,className:"map-page-container",children:[Y.jsx("div",{className:"page",children:Y.jsx("div",{className:"map-wrapper",children:Y.jsx("div",{ref:m,className:"map-container"})})}),Mn&&Y.jsx("div",{style:{position:"fixed",inset:0,zIndex:10010,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Y.jsxs("div",{className:"mf-ai-modal-panel",style:{width:"min(560px, 92vw)",padding:16},children:[Y.jsx("div",{style:{fontWeight:700,fontSize:16},children:"Mapbox Token Required"}),Y.jsx("div",{style:{marginTop:8,fontSize:13,color:"#333"},children:"Enter a Mapbox public token (`pk...`) once for this browser to load the map."}),Y.jsx("input",{value:st,onChange:O=>{fr(O.target.value),br&&Tr("")},placeholder:"pk.eyJ...",style:{width:"100%",marginTop:10,padding:"8px 10px",borderRadius:8,border:"1px solid #d0d0d0"}}),br?Y.jsx("div",{style:{marginTop:8,color:"crimson",fontSize:12},children:br}):null,Y.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:12},children:[Y.jsx("button",{className:"btn",onClick:()=>{try{window.localStorage.removeItem("MAPBOX_PUBLIC_TOKEN")}catch{}fr("")},children:"Clear"}),Y.jsx("button",{className:"btn primary",onClick:jh,children:"Save & Reload"})]})]})}),t==="admin"&&!xe&&Y.jsx("button",{className:"controls-toggle-button",onClick:()=>dt(O=>!O),children:mt?"Hide Controls":"Show Controls"}),c&&xe&&!Ne&&Y.jsx("div",{style:{position:"absolute",left:16,top:16,zIndex:40,display:"flex",gap:8},children:Y.jsx("button",{className:"btn",onClick:hc,children:"Exit Presentation"})}),zc&&Y.jsx("div",{style:{position:"fixed",inset:0,zIndex:10002,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Y.jsxs("div",{className:"mf-ai-modal-panel",style:{width:"min(520px, 92vw)",padding:16,lineHeight:1.4},children:[Y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[Y.jsxs("div",{children:[Y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[Y.jsx("div",{style:{fontWeight:700,fontSize:16},children:"Ask Mapfluence"}),Y.jsx("span",{title:"AI-generated response based on currently loaded space data.",style:{fontSize:11,padding:"2px 8px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:"#f7f7ff"},children:" AI"})]}),Y.jsx("div",{style:{fontSize:12,color:"#555"},children:"Ask questions about loaded campus data."})]}),Y.jsx("button",{className:"btn",onClick:()=>Xo(!1),children:"Close"})]}),Y.jsxs("div",{style:{marginTop:10},children:[Y.jsx("label",{style:{fontWeight:600,fontSize:12},children:"Question"}),Y.jsx("textarea",{value:pa,onChange:O=>Ja(O.target.value),rows:3,placeholder:"e.g. How many vacant offices are on campus?",style:{width:"100%",resize:"vertical",padding:8,borderRadius:8,border:"1px solid #d0d0d0",marginTop:4}})]}),wc?Y.jsx("div",{style:{color:"crimson",marginTop:6,fontSize:12},children:wc}):null,Y.jsx("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:10},children:Y.jsx("button",{className:"btn",disabled:cl||!pa.trim()||Di,onClick:Gc,children:cl?"Asking...":"Ask"})})]})}),Ai&&Y.jsx("div",{style:{position:"fixed",inset:0,zIndex:10004,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Y.jsxs("div",{className:"mf-ai-modal-panel",style:{width:"min(720px, 94vw)",padding:16,lineHeight:1.45,maxHeight:"86vh",overflowY:"auto"},children:[Y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,alignItems:"center"},children:[Y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[Y.jsx("div",{style:{fontWeight:700,fontSize:16},children:"Ask Mapfluence"}),Y.jsx("span",{title:"AI-generated response based on currently loaded space data.",style:{fontSize:11,padding:"2px 8px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:"#f7f7ff"},children:" AI"})]}),Y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[Y.jsx("button",{className:"btn",onClick:Xs,children:"Copy CSV"}),Y.jsx("button",{className:"btn",onClick:_d,children:"Export PDF"}),Y.jsx("button",{className:"btn",onClick:()=>Ss(null),children:"Close"})]})]}),Y.jsx("p",{style:{marginTop:10},children:Ai.answer}),Ai.bullets?.length?Y.jsx("ul",{style:{margin:"6px 0 10px 18px",padding:0},children:Ai.bullets.map((O,he)=>Y.jsx("li",{children:O},he))}):null,Ai.resultType==="table"&&Ai.columns?.length&&Ai.rows?.length?Y.jsx("div",{style:{marginTop:10,overflowX:"auto"},children:Y.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[Y.jsx("thead",{style:{background:"#f8f9fb"},children:Y.jsx("tr",{children:Ai.columns.map(O=>Y.jsx("th",{style:{textAlign:"left",padding:"6px 8px",borderBottom:"1px solid #e0e0e0"},children:O},O))})}),Y.jsx("tbody",{children:Ai.rows.map((O,he)=>Y.jsx("tr",{style:{borderBottom:"1px solid #f0f0f0"},children:Ai.columns.map(Ie=>Y.jsx("td",{style:{padding:"6px 8px"},children:O&&O[Ie]!=null?String(O[Ie]):""},Ie))},he))})]})}):null,Ai.missingData?.length?Y.jsxs("div",{style:{marginTop:10,fontSize:12,color:"#555"},children:["Missing data: ",Ai.missingData.join(", ")]}):null]})}),!xe&&Y.jsxs("div",{className:"mf-right-rail",children:[Y.jsxs("div",{className:"mf-right-logos",children:[Y.jsxs("div",{className:"logo-box",children:[Y.jsx("div",{className:"mapfluence-title",children:"MAPFLUENCE"}),Y.jsx("img",{className:"mf-logo mf-logo--mapfluence",src:Jd("Clark_Enersen_Logo.png"),alt:"Clark & Enersen Logo"})]}),Y.jsx("div",{className:"logo-box",children:Y.jsx("img",{className:"mf-logo mf-logo--hc",src:Jd("HC_image.png"),alt:"Hastings College"})})]}),!c&&Y.jsx("div",{className:"dashboard-box",children:Y.jsx(oU,{title:oa,scopeLabel:Rp,metrics:qs,loading:$s,error:Sc,utilization:Yf,utilizationScopeLabel:Np,heatmapOn:Vo,onToggleHeatmap:es})})]}),t==="admin"&&Y.jsxs(Y.Fragment,{children:[Re===Me.ASSESSMENT&&F&&!Dt&&Eh&&Y.jsx("div",{className:"floating-panel",style:{position:"absolute",zIndex:40,left:Math.max(8,Math.min(Eh.x+12,(m.current?.clientWidth||1e3)-360)),top:Math.max(8,Math.min(Eh.y+12,(m.current?.clientHeight||800)-260)),width:340},children:Y.jsx(Gz,{buildingId:F,buildingName:n?.buildings?.features?.find(O=>O.properties.id===F)?.properties?.name,currentCondition:ke[F],onSave:xg,onOpenTechnical:()=>tn(!0),onClose:()=>{q(null),tn(!1),dc(null)},canWrite:y})}),Re===Me.TECHNICAL&&F&&Dt&&Y.jsx($z,{buildingId:F,assessments:pe,universityId:e,panelPos:Eh,isAdminRole:y,onClose:()=>tn(!1),onSave:handleAssessmentSave})]}),Re===Me.SPACE_DATA&&(F||j)&&!Cn&&(()=>{const O=m.current?.clientWidth||1e3,he=m.current?.clientHeight||800,Ie=360,qe=420,Qe=16,Fe=260,$e=24,St=140,Mt=(Or,Ur,Ui)=>Math.max(Ur,Math.min(Or,Ui)),gt=Math.max(300,Math.min(Ie,O-Qe*2)),Zt=Qe+40,Kt=Mt(O-gt-Zt,12,O-gt-12),gn=Mt(O-gt-Fe-$e-St,320,O-gt-12),en=12,$t=Eh||{y:he*.65},un=Mt($t.y,8,he-qe-8),vr=gn,Pr=un,Gn=Bl.current;let rr=null;if(Gn&&Gn.geometry)try{const Or=Lu(Gn);if(Or&&Or.length===4&&Or.every(Ur=>Number.isFinite(Ur))){const Ur=(Or[1]+Or[3])/2,Ui=_.current?.project?_.current.project({lng:Or[2],lat:Ur}):null;if(Ui){const kr=Kt,Kr=Mt(Ui.y-qe*.35,8,he-qe-8);rr={left:kr,top:Kr}}}}catch{}const ni={position:"absolute",zIndex:40,left:vr,top:Pr,width:gt,maxHeight:"75vh",overflow:"auto"},Yr=rr?{position:"absolute",zIndex:40,left:Math.max(12,Math.min(rr.left,O-gt-Qe)),top:en,width:gt,maxHeight:"80vh",overflow:"auto"}:ni,Jr=Cr==="floor"?Yr:ni,Gi=ed?{...Jr,left:ed.x,top:ed.y}:Jr;return Y.jsxs("div",{ref:I,className:"floating-panel",style:Gi,children:[Cr==="building"&&Y.jsx(Qj,{buildingName:Ii,stats:Vt,keyDepts:pp(Vt?.totalsByDept),utilization:ve(Ii),floors:_a,selectedFloor:za,onChangeFloor:Or=>ml(Or),onLoadFloorplan:_r,onExportCSV:()=>au(Ii),onClose:()=>{ir(!0),q(null),dc(null),lu(null),Ws.current=null,xs.current=null,Bl.current=null,Ln(null),Dn(null),or(null),Si("building")},onExportPDF:df,onExplainBuilding:Va,explainBuildingLoading:ll,explainBuildingDisabled:Di||!Vt,explainBuildingError:er,dragHandleProps:ju}),Cr==="floor"&&Y.jsx(eU,{buildingName:Ii,floorLabel:$n?.floorLabel||za,stats:$n,legendItems:li,legendTitle:{department:"Key Departments",type:"Key Types",occupancy:"Occupancy",vacancy:"Vacancy"}[Ji]||"Legend",floors:_a,selectedFloor:za,onChangeFloor:Or=>ml(Or),onLoadFloorplan:_r,onUnloadFloorplan:ps,onExportCSV:()=>au(Ii),colorMode:Ji,onChangeColorMode:Or=>{Rl(Or),Fl(Or)},legendSelection:et,onLegendClick:Or=>{const Ur=Ee.get(Or)||[];ht(Ui=>{const kr=Ui===Or?null:Or;return No(kr?Ur:null),kr})},onClose:()=>{ir(!0),q(null),dc(null),lu(null),Ws.current=null,xs.current=null,Bl.current=null,Ln(null),Dn(null),or(null),Si("building")},onExportPDF:ts,onExplainFloor:Qi,explainLoading:ra,explainDisabled:Di||!$n,explainError:Yo,moveScenarioMode:Pa,onToggleMoveScenarioMode:hs,rotateActive:t==="admin"&&Lr==="rotate",moveActive:t==="admin"&&Lr==="move",rotateValue:t==="admin"?dr:0,scaleValue:t==="admin"?oi:1,rotateNotice:t==="admin"?zr:"",rotateStored:t==="admin"?di:!1,adjustDebugInfo:t==="admin"?sr:null,onStartRotate:t==="admin"?Ut:void 0,onStartMove:t==="admin"?cn:void 0,onCancelRotate:t==="admin"?Wt:void 0,onClearRotate:t==="admin"?In:void 0,onSaveAdjust:t==="admin"?async()=>{const Or=_t();if(!Or?.buildingLabel||!Or?.floorId)return;const Ur=jr.current?.floorAdjustLabel||Or.buildingLabel,Ui=Or.url||jr.current?.url||lo(j,Or.floorId),kr=Or.basePath||jr.current?.floorAdjustBasePath||null,Kr=mr||Wm(Ur,Or.floorId),ki=jr.current?.floorAdjustBasePivot||jr.current?.fc&&xc(jr.current.fc)?.geometry?.coordinates||null,on=Gu(_.current,da)?._data||jr.current?.fc||null,hn=rv(on),Hn={...Kr,pivot:Array.isArray(Kr.pivot)?Kr.pivot:Array.isArray(ki)?ki:null,anchorLngLat:hn||Kr.anchorLngLat||null};P1(Ur,Or.floorId,Hn),Ui&&k1(Ui,Hn),kr&&M1(kr,Or.floorId,Hn);try{await jt(Ur,Or.floorId,Hn)}catch{}Ui&&(gs.delete(Ui),Wu.delete(Ui))}:void 0,saveAdjustDisabled:t==="admin"?!di:!0,onScaleChange:t==="admin"?Or=>{const Ur=_t();if(!Ur?.buildingLabel||!Ur?.floorId)return;const Ui=Ur.url||jr.current?.url||lo(j,Ur.floorId),kr=Ur.basePath||jr.current?.floorAdjustBasePath||null,Kr=kr?By(kr,Ur.floorId):null,ki=mp(Kr),Vn=Ui?Oy(Ui):null,on=mp(Vn),hn=ki?Kr:on?Vn:Wm(Ur.buildingLabel,Ur.floorId),Hn=Math.max(.5,Math.min(2.5,(hn.scale||1)+Or)),tr=Hn/(hn.scale||1),Qr=Gu(_.current,da),co=Qr?._data||jr.current?.fc||null,Do=co&&xc(co)?.geometry?.coordinates||null;let ei=null;co&&Do&&Number.isFinite(tr)&&Math.abs(tr-1)>1e-6&&(ei=L0(co,tr,{origin:Do}),Qr&&Qr.setData(ei));const Hi={...hn,scale:Hn},Bn=jr.current?.floorAdjustLabel||Ur.buildingLabel,$a=jr.current?.floorAdjustBasePivot||co&&xc(co)?.geometry?.coordinates||null,Zs={...Hi,pivot:Array.isArray($a)?$a:Hi.pivot,anchorLngLat:rv(ei||Qr?._data||co)||Hi.anchorLngLat||null};P1(Bn,Ur.floorId,Zs),Ui&&k1(Ui,Zs),kr&&M1(kr,Ur.floorId,Zs);try{jt(Bn,Ur.floorId,Zs)}catch{}const mc=Fv(Zs),ns=co||jr.current?.fc||null;if(mc&&ns){const ba={...ns,__mfUserAdjustSignature:mc};Ui&&gs.set(Ui,ba),jr.current={...jr.current||{},fc:ba}}const Wn=Ui||lo(j,Ur.floorId);Wn&&!Ui&&(gs.delete(Wn),Wu.delete(Wn))}:void 0,dragHandleProps:ju})]})})(),Pa&&zl&&Y.jsxs("div",{ref:V,className:"floating-panel mf-move-scenario-panel",style:{position:"absolute",zIndex:60,right:Cc?"auto":16,left:Cc?Cc.x:"auto",top:Cc?Cc.y:wh,width:320,maxHeight:"70vh",overflow:"auto",padding:12,fontSize:13},children:[Y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6},..._g,children:[Y.jsx("div",{style:{fontWeight:600},children:"Move Scenario"}),Y.jsx("button",{className:"btn secondary",style:{fontSize:11,padding:"2px 6px"},onClick:_l,children:"Clear"})]}),Y.jsxs("div",{style:{marginBottom:8},children:[Y.jsx("label",{style:{display:"block",fontSize:12,marginBottom:2},children:"Scenario label (optional)"}),Y.jsx("input",{className:"mf-input",value:ja,onChange:O=>nl(O.target.value),placeholder:"e.g. Art Dept to Hurley - Option A",style:{width:"100%"}})]}),Y.jsxs("div",{style:{marginBottom:8},children:[Y.jsxs("div",{children:[Y.jsx("b",{children:"Total SF:"})," ",Math.round(xo.totalSF).toLocaleString()]}),Y.jsxs("div",{children:[Y.jsx("b",{children:"Rooms:"})," ",xo.rooms]})]}),Y.jsxs("div",{style:{marginBottom:8},children:[Y.jsx("div",{style:{fontWeight:600,marginBottom:2},children:"Rooms by Room Type Description"}),xa.length===0?Y.jsx("div",{style:{fontSize:12,fontStyle:"italic",color:"#666"},children:"No rooms selected."}):Y.jsxs("table",{style:{width:"100%",fontSize:12},children:[Y.jsx("thead",{children:Y.jsxs("tr",{children:[Y.jsx("th",{style:{textAlign:"left"},children:"Room Type Description"}),Y.jsx("th",{style:{textAlign:"right"},children:"Qty"}),Y.jsx("th",{style:{textAlign:"right"},children:"SF"})]})}),Y.jsx("tbody",{children:xa.map(({type:O,count:he,sf:Ie})=>Y.jsxs("tr",{children:[Y.jsx("td",{children:O}),Y.jsx("td",{style:{textAlign:"right"},children:he}),Y.jsx("td",{style:{textAlign:"right"},children:Math.round(Ie).toLocaleString()})]},O))})]})]}),Y.jsxs("div",{style:{marginTop:4},children:[Y.jsx("label",{style:{fontSize:12},children:"Scenario Department"}),Y.jsxs("select",{className:"mf-input",value:vo,onChange:O=>ca(O.target.value),children:[Y.jsx("option",{value:"",children:"Choose department..."}),ro.map(O=>Y.jsx("option",{value:O,children:O},O))]}),Y.jsx("button",{className:"btn primary",style:{marginTop:6},onClick:oe,disabled:!vo||ac.size===0,children:"Commit"})]}),Y.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap",marginTop:8},children:[Y.jsx("button",{className:"btn primary",onClick:Ts,disabled:Di||bc||!vo||!xo,title:vo?xo?"Compare scenario vs current allocation for this department.":"Enable Move Scenario Mode and create a scenario to compare.":"Select a department for the scenario before comparing.",children:bc?"Comparing...":" Compare scenario vs current"}),Da?Y.jsx("div",{style:{color:"crimson",fontSize:12},children:Da}):null]}),Y.jsx("button",{className:"btn secondary",style:{width:"100%",marginTop:6},onClick:async()=>{try{const O=new wi("p","pt","letter"),he=O.internal.pageSize.getWidth(),Ie=O.internal.pageSize.getHeight(),qe=20,Qe=Kg({...jr.current,labelOptions:{hideDrawing:!0}});let Fe=!1,$e=0,St=0;if(Qe){const Or=Qe.height&&Qe.width?Qe.height/Qe.width:1,Ur=Math.min(he*.55,he-qe*3),Ui=Ie-qe*2;$e=Ur,St=$e*Or,St>Ui&&(St=Ui,$e=St/(Or||1)),O.addImage(Qe.data,"PNG",qe,qe,$e,St),Fe=!0}const Mt="Move Scenario",gt=ja||"Move Scenario",Zt=ja?.trim()?ja.trim():"",Kt=Fe?$e+qe*2:qe,gn=he-Kt-qe,en=16;let $t=qe;O.setFontSize(14),O.text(Mt,Kt,$t),Zt&&O.text(Zt,Kt+gn,$t,{align:"right"}),$t+=en,O.setFontSize(12);const un=Or=>{O.text(Or,Kt,$t,{maxWidth:gn}),$t+=en},vr=vo||"None selected",Pr=Qd(vo)||"#AAAAAA",Gn=14;O.setDrawColor(0),O.setFillColor(Pr),O.rect(Kt,$t,Gn,Gn,"FD");const rr=`Scenario Dept: ${vr}`;O.setTextColor("#000000"),O.setFont(void 0,"bold");const ni=O.splitTextToSize(rr,Math.max(50,gn-Gn-6));ni.forEach((Or,Ur)=>{O.text(Or,Kt+Gn+6,$t+Gn-4+Ur*en)}),O.setFont(void 0,"normal"),$t+=Math.max(Gn,ni.length*en)+en/2,O.setFontSize(12),un(`Total SF: ${Math.round(xo.totalSF).toLocaleString()}`),un(`Rooms: ${xo.rooms}`),$t+=en/2,O.setFont(void 0,"bold"),O.text("Rooms by Type",Kt,$t),$t+=en;const Yr=Kt+gn*.65,Jr=Kt+gn;if(O.setFontSize(11),O.text("Type",Kt,$t),O.text("Qty",Yr,$t,{align:"right"}),O.text("SF",Jr,$t,{align:"right"}),$t+=en,O.setFont(void 0,"normal"),!xa.length)O.text("No rooms selected.",Kt,$t),$t+=en;else{const Or=Math.max(gn-120,100);xa.forEach(({type:Ur,count:Ui,sf:kr})=>{const Kr=Math.round(kr).toLocaleString(),ki=O.splitTextToSize(Ur,Or);ki.forEach((Vn,on)=>{O.text(Vn,Kt,$t+on*(en*.9))}),O.text(String(Ui),Yr,$t,{align:"right"}),O.text(Kr,Jr,$t,{align:"right"}),$t+=en*Math.max(1,ki.length*.9)})}O.setFont(void 0,"normal"),O.setFontSize(12),$t+=en/4;const Gi=`${(gt||"move-scenario").replace(/\s+/g,"-").toLowerCase()}.pdf`;O.save(Gi)}catch(O){console.error("Scenario export failed",O),alert("Export failed - see console for details.")}},children:"Export Scenario (PDF)"})]}),mt&&!xe&&Y.jsx("div",{className:"map-controls-panel",style:{width:270,fontSize:12.5,lineHeight:1.25},children:Y.jsxs("div",{className:"map-controls",children:[t==="admin"&&Y.jsx("div",{className:"control-section",style:{background:"#fff",padding:6,border:"1px solid #ddd",borderRadius:6,marginBottom:4},children:Y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,justifyContent:"space-between"},children:[Y.jsx("h5",{style:{margin:0,fontSize:13},children:"Admin access"}),Jt?Y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[Y.jsxs("span",{style:{fontSize:12,whiteSpace:"nowrap"},children:[Jt.email," ",y?"(admin)":"(no admin)"]}),Y.jsx("button",{onClick:wd,children:"Sign out"})]}):Y.jsx("button",{onClick:id,children:"Sign in with Google"})]})}),!c&&Y.jsxs("div",{className:"control-section theme-selector",style:{marginTop:6},children:[Y.jsx("label",{htmlFor:"theme-select",style:{marginRight:8},children:"Map View:"}),Y.jsx("select",{id:"theme-select",value:Re,onChange:O=>we(O.target.value),disabled:rt.length<=1,children:rt.map(O=>Y.jsx("option",{value:O.value,children:O.label},O.value))})]}),c&&Y.jsxs("div",{className:"legend",style:{marginTop:6},children:[Y.jsx("h4",{children:"Legend"}),Y.jsxs("div",{style:{display:"grid",gap:6,marginBottom:10},children:[Y.jsx("button",{className:"btn",onClick:()=>{const O=!De;nt(O),O&&Nl(!1)},children:De?"Show Marker Dots":"Show Engagement Heatmap"}),Y.jsx("button",{className:"btn",onClick:()=>Ru(O=>!O),disabled:!ii||!Un,children:Ia?"Hide Room Sentiment":"Show Room Sentiment"}),Y.jsx("button",{className:"btn",onClick:()=>{const O=!hl;Nl(O),O&&(nt(!1),Ru(!0))},disabled:!ii||!Un,children:hl?"Exit Room Sentiment Only":"Room Sentiment Only"}),Y.jsx("button",{className:"btn",onClick:hc,children:xe?"Exit Presentation":"Presentation Mode"}),Y.jsx("div",{style:{fontSize:11,color:"#555"},children:"Tip: use `?presentation=1` in the URL for clean preview mode."}),(!ii||!Un)&&Y.jsx("div",{style:{fontSize:11,color:"#666"},children:"Room sentiment coloring is available in Floorplan mode with a loaded floor."})]}),De&&Y.jsxs("div",{className:"legend-section",style:{marginBottom:10},children:[Y.jsx("h5",{children:"Heat Colors"}),Y.jsx("div",{style:{height:10,borderRadius:6,border:"1px solid #ddd",background:"linear-gradient(90deg, #1d4ed8 0%, #60a5fa 14%, #67e8f9 30%, #facc15 56%, #fb923c 78%, #ef4444 100%)"}}),Y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:11,color:"#555",marginTop:4},children:[Y.jsx("span",{children:"Cool"}),Y.jsx("span",{children:"Warm"})]}),Y.jsx("div",{style:{fontSize:11,color:"#666",marginTop:4},children:"Category cores plus thermal multicolor halo (comments stay gray dots only)."})]}),Ia&&ii&&Un&&Y.jsxs("div",{className:"legend-section",style:{marginBottom:10},children:[Y.jsx("h5",{children:"Room Sentiment (Dominant)"}),bd.legendItems.length?Y.jsxs(Y.Fragment,{children:[bd.legendItems.map(O=>Y.jsxs("div",{className:"legend-item",style:{justifyContent:"space-between"},children:[Y.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[Y.jsx("span",{className:"legend-color-box",style:{backgroundColor:O.color}}),Y.jsx("span",{children:O.label})]}),Y.jsxs("span",{style:{fontSize:11,color:"#555"},children:[O.roomCount," rooms"]})]},O.category)),Y.jsxs("div",{style:{fontSize:11,color:"#666",marginTop:4},children:[bd.markerCount.toLocaleString()," markers matched inside ",bd.roomCount.toLocaleString()," rooms."]})]}):Y.jsx("div",{style:{fontSize:11,color:"#666"},children:"No markers are currently inside room polygons on this loaded floor."})]}),Y.jsxs("div",{className:"legend-section",children:[Y.jsx("h5",{children:"Marker Types"}),Object.entries(Rc||{}).map(([O,he])=>Y.jsxs("div",{className:"legend-item",children:[Y.jsx("span",{className:"legend-color-box",style:{backgroundColor:c&&wu[O]||he}}),Y.jsx("span",{children:O})]},O))]})]}),Y.jsxs("div",{className:"floorplans-section",style:{marginTop:8,padding:6,borderRadius:8,border:"1px solid rgba(0,0,0,0.25)",background:"linear-gradient(180deg, rgba(235,250,240,0.9), rgba(220,242,230,0.9))"},children:[Y.jsx("h4",{style:{margin:"0 0 6px 0",fontSize:12.5},children:"Floorplans"}),Y.jsxs("div",{className:"floorplans",style:{display:"grid",gap:6},children:[c&&Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6},children:[Y.jsx("button",{className:"btn",style:{width:"100%",fontWeight:iu==="campus"?700:500,borderColor:iu==="campus"?"#1f2937":void 0},onClick:()=>{La("campus"),ps()},children:"Campus"}),Y.jsx("button",{className:"btn",style:{width:"100%",fontWeight:iu==="floor"?700:500,borderColor:iu==="floor"?"#1f2937":void 0},onClick:()=>{La("floor"),ii||Zr()},disabled:!_a.length,children:"Floorplan"})]}),Y.jsx("select",{id:"fp-building",style:{width:"100%"},value:j,onChange:O=>{const he=O.target.value;H(he)},children:fd.map(O=>Y.jsx("option",{value:O.name,children:O.name},O.name))}),Y.jsx("select",{id:"fp-floor",style:{width:"100%"},value:Ar??"",onChange:O=>ml(O.target.value),disabled:!_a.length,children:_a.map(O=>Y.jsx("option",{value:O,children:O},O))}),Y.jsx("button",{className:"btn",style:{width:"100%"},onClick:()=>{c&&La("floor"),Zr()},disabled:!_a.length,children:"Load"}),Y.jsx("button",{className:"btn",style:{width:"100%"},onClick:()=>{c&&La("campus"),ps()},children:"Unload"}),Y.jsx("button",{className:"btn",style:{width:"100%"},onClick:()=>bT(_.current),disabled:!ii,children:"Center"})]}),!c&&Y.jsxs("div",{style:{marginTop:8},children:[Y.jsxs("button",{className:"mf-btn",style:{width:"100%",fontWeight:600},onClick:hs,children:["Move Scenario Mode ",Pa?"ON":"OFF"]}),Pa&&Y.jsx("div",{style:{marginTop:6,fontSize:11,color:"#555",textAlign:"center"},children:"Click rooms to add/remove them from a what-if scenario. Real data is not changed."})]})]}),!c&&Y.jsxs("div",{className:"floorplans-section",style:{marginTop:8,padding:6,borderRadius:8,border:"1px solid rgba(0,0,0,0.25)",background:"linear-gradient(180deg, rgba(255,247,235,0.9), rgba(255,239,219,0.9))"},children:[Y.jsx("h4",{style:{margin:"2px 0 4px 0",fontSize:12.5},children:"Space Data Export"}),Y.jsxs("div",{style:{display:"grid",gap:6},children:[Y.jsxs("select",{style:{width:"100%"},value:al,onChange:O=>Vi(O.target.value),children:[Y.jsx("option",{value:"__all__",children:"All buildings"}),fd.map(O=>Y.jsx("option",{value:O.name,children:O.name},O.name))]}),Y.jsx("input",{className:"mf-input",style:{width:"100%"},placeholder:"Filter department (optional)",value:Ql,onChange:O=>Pu(O.target.value)}),Y.jsxs("select",{style:{width:"100%"},value:So,onChange:O=>mu(O.target.value),children:[Y.jsx("option",{value:"rooms",children:"Room rows"}),Y.jsx("option",{value:"summary",children:"Building summary"})]}),Y.jsx("button",{className:"btn",style:{width:"100%"},onClick:()=>au(),disabled:Ea,children:Ea?"Exporting...":So==="summary"?"Export Summary CSV":"Export Space CSV"}),t==="admin"&&Y.jsx("button",{className:"btn",style:{width:"100%"},onClick:it,disabled:Nr,children:Nr?"Refreshing Airtable...":"Refresh Airtable Data"})]}),Y.jsx("div",{style:{fontSize:11,color:"#555",marginTop:2,minHeight:0},children:Xa||(So==="summary"?"Summary export adds a campus total (when exporting all buildings) plus one row per building.":"")}),t==="admin"&&yi&&Y.jsx("div",{style:{fontSize:11,color:"#555",marginTop:2},children:yi}),t==="admin"&&Y.jsxs("div",{style:{fontSize:11,color:"#555",marginTop:2},children:["Last synced: ",yo?yo.toLocaleString([],{hour:"2-digit",minute:"2-digit",month:"short",day:"numeric"}):"Not yet"]})]}),!c&&Y.jsxs("div",{style:{marginTop:4,padding:6,borderRadius:8,border:"1px solid rgba(0,0,0,0.25)",background:"linear-gradient(180deg, rgba(240,246,255,0.94), rgba(228,238,255,0.94))",boxShadow:"0 2px 6px rgba(0,0,0,0.05)"},children:[Y.jsx("style",{children:"@keyframes aiSparklePulse { 0% { transform: translateY(0); } 50% { transform: translateY(-1px); } 100% { transform: translateY(0); } }"}),Y.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:10},children:[Y.jsxs("div",{children:[Y.jsxs("div",{style:{fontWeight:800,letterSpacing:.2,display:"flex",alignItems:"center",gap:6,flexWrap:"nowrap"},children:[Y.jsx("span",{style:{color:"#c62828",fontFamily:"'Trebuchet MS', 'Gill Sans', 'Helvetica Neue', Arial, sans-serif",fontWeight:700},children:"MAPFLUENCE"}),Y.jsx("span",{children:"AI"}),Y.jsx("span",{title:"AI-generated summaries based on currently loaded space data.",style:{display:"inline-flex",alignItems:"center",marginLeft:"auto",padding:"2px 6px",borderRadius:999,fontSize:10,fontWeight:700,border:"1px solid rgba(0,0,0,0.15)",background:"rgba(255,255,255,0.9)",animation:Ro?"aiSparklePulse 2.8s ease-in-out infinite":"none"},children:" AI Summary"})]}),Y.jsxs("div",{style:{marginTop:4,fontSize:11,opacity:.8,display:"flex",alignItems:"center",justifyContent:"space-between",gap:6},children:[Y.jsx("span",{children:"Summaries from loaded space data"}),Y.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:4},children:[Y.jsx("span",{style:{fontSize:10,padding:"2px 6px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:Ro?"rgba(0,255,0,0.10)":sa?"rgba(255,193,7,0.18)":"rgba(255,0,0,0.08)"},title:Ro?"AI server available":sa?"Checking AI status":"AI server not reachable",children:Ro?"Online":sa?"Checking":"Unavailable"}),Y.jsx("button",{onClick:()=>ao(!0),title:"What Mapfluence AI is doing",style:{border:"1px solid rgba(0,0,0,0.15)",borderRadius:999,background:"white",width:18,height:18,display:"inline-flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:10},"aria-label":"What Mapfluence AI is doing",children:"?"})]})]})]}),Y.jsxs("div",{style:{display:"none",alignItems:"center",gap:6,marginTop:10},children:[Y.jsx("span",{style:{fontSize:10,padding:"2px 6px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:Ro?"rgba(0,255,0,0.10)":sa?"rgba(255,193,7,0.18)":"rgba(255,0,0,0.08)"},title:Ro?"AI server available":sa?"Checking AI status":"AI server not reachable",children:Ro?"Online":sa?"Checking":"Unavailable"}),Y.jsx("button",{onClick:()=>ao(!0),title:"What Mapfluence AI is doing",style:{border:"1px solid rgba(0,0,0,0.15)",borderRadius:999,background:"white",width:20,height:20,display:"inline-flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:11,marginTop:2},"aria-label":"What Mapfluence AI is doing",children:"i"})]})]}),Y.jsxs("div",{style:{display:"grid",gap:6,marginTop:6},children:[Y.jsx("button",{style:{padding:"5px 7px",fontSize:11},disabled:Di||!$n||ra,onClick:Qi,children:ra?"Explaining...":" Explain this floor"}),Y.jsx("button",{style:{padding:"5px 7px",fontSize:11},disabled:Di||!Vt||ll,onClick:Va,children:ll?"Explaining...":" Explain this building"}),Y.jsx("button",{style:{padding:"5px 7px",fontSize:11},disabled:Di||!Mr||Mi,onClick:bo,children:Mi?"Explaining...":" Explain campus"})]}),Y.jsx("div",{style:{marginTop:6,display:"grid",gap:4},children:Y.jsx("button",{style:{padding:"5px 7px",fontSize:11},onClick:()=>Xo(!0),children:" Ask Mapfluence"})}),t==="admin"&&Y.jsx("div",{style:{marginTop:6},children:Y.jsx("button",{disabled:Di,onClick:()=>Jo(!0),style:{width:"100%",padding:"5px 7px",fontSize:11},children:" Create move scenario"})}),Y.jsx("div",{style:{marginTop:10,fontSize:11,opacity:.75,lineHeight:1.35},children:"Results are descriptive and do not modify project data."}),Yo||er||ji?Y.jsx("div",{style:{marginTop:8,color:"crimson",fontSize:12},children:Yo||er||ji}):null]})]})}),t==="admin"&&mt&&!xe&&Y.jsxs("div",{style:{position:"absolute",left:20,bottom:20,width:270,borderRadius:8,border:"1px solid rgba(0,0,0,0.25)",background:"linear-gradient(180deg, rgba(245,245,245,0.96), rgba(230,230,230,0.96))",padding:8,boxShadow:"0 2px 6px rgba(0,0,0,0.05)"},children:[Y.jsx("h4",{style:{margin:"0 0 6px 0",fontSize:12.5},children:"Data Filters"}),Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:8},children:[Y.jsx("button",{className:"btn",onClick:bs,children:"Export Map Data"}),Y.jsx("button",{className:"btn",onClick:Uh,children:"Clear Conditions"})]})]}),c&&ln&&!xe&&Y.jsxs("div",{className:"help-panel",style:{right:20,bottom:20},children:[Y.jsx("button",{className:"close-button","aria-label":"Close help",onClick:()=>yn(!1),children:""}),Y.jsx("h4",{children:"How to Use This Map"}),Y.jsxs("ul",{children:[Y.jsx("li",{children:"Click anywhere on the map to add a marker."}),Y.jsx("li",{children:"Select a marker type and add an optional comment."}),Y.jsx("li",{children:"Markers are saved to the engagement demo dataset."})]}),Y.jsx("button",{className:"close-button-main",onClick:()=>yn(!1),children:"Close"})]}),!c&&Ec&&Lo&&Y.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e4,background:"rgba(0,0,0,0.35)"},children:Y.jsxs("div",{ref:R,className:"mf-room-edit-panel",style:{position:"absolute",left:fl?fl.x:"50%",top:fl?fl.y:"50%",transform:fl?"none":"translate(-50%, -50%)",width:520,maxWidth:"90vw",background:"#fff",borderRadius:14,padding:16,boxShadow:"0 18px 36px rgba(0,0,0,0.2)"},children:[Y.jsx("div",{style:{display:"flex",alignItems:"center",marginBottom:12},...cf,children:Y.jsx("h4",{style:{margin:0},children:vs.length>1?`Edit ${vs.length} Rooms`:`Edit Room ${Lo.feature?.properties?.name||Lo.roomLabel||""}`})}),vs.length>1&&Y.jsxs("div",{style:{marginBottom:12},children:[Y.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"Selected Rooms"}),Y.jsx("div",{style:{maxHeight:180,overflow:"auto",border:"1px solid #e5e5e5",borderRadius:6},children:Y.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[Y.jsx("thead",{style:{background:"#f9f9f9",position:"sticky",top:0},children:Y.jsxs("tr",{children:[Y.jsx("th",{style:{padding:"6px 8px",width:40,textAlign:"center"},children:Y.jsx("input",{type:"checkbox",checked:fa.size===vs.length,onChange:O=>{const he=O.target.checked?new Set(vs.map(Ie=>Ie.roomId||String(Ie.revitId??""))):new Set;Sl(he)}})}),Y.jsx("th",{style:{padding:"6px 8px",textAlign:"left"},children:"Room"}),Y.jsx("th",{style:{padding:"6px 8px",textAlign:"right"},children:"Area (SF)"}),Y.jsx("th",{style:{padding:"6px 8px",textAlign:"left"},children:"Department"}),Y.jsx("th",{style:{padding:"6px 8px",textAlign:"left"},children:"Room Type Description"})]})}),Y.jsx("tbody",{children:vs.map(O=>{const he=O.roomId||String(O.revitId??""),Ie=fa.has(he),qe=Number.isFinite(O.properties?.area)?Math.round(O.properties.area):"";return Y.jsxs("tr",{style:{borderTop:"1px solid #f0f0f0"},children:[Y.jsx("td",{style:{padding:"6px 8px",textAlign:"center"},children:Y.jsx("input",{type:"checkbox",checked:Ie,onChange:Qe=>{Sl(Fe=>{const $e=new Set(Fe||[]);return Qe.target.checked?$e.add(he):$e.delete(he),$e})}})}),Y.jsx("td",{style:{padding:"6px 8px",fontWeight:600},children:O.roomLabel||O.feature?.properties?.name||he}),Y.jsx("td",{style:{padding:"6px 8px",textAlign:"right",whiteSpace:"nowrap"},children:qe?qe.toLocaleString():""}),Y.jsx("td",{style:{padding:"6px 8px"},children:O.properties?.department||O.feature?.properties?.department||""}),Y.jsx("td",{style:{padding:"6px 8px"},children:O.properties?.type||O.feature?.properties?.type||""})]},he)})})]})})]}),Y.jsx(MA,{label:"Room Type",value:Lo.properties?.type??Lo.feature?.properties?.type??"",onChange:O=>$o(he=>he&&{...he,properties:{...he.properties,type:O}}),options:no,placeholder:"Search or choose a type..."}),Y.jsx(MA,{label:"Department",value:Lo.properties?.department??Lo.feature?.properties?.department??"",onChange:O=>$o(he=>he&&{...he,properties:{...he.properties,department:O}}),options:ro,placeholder:"Search or choose a department..."}),tl&&Y.jsxs("div",{className:"mf-form-row",children:[Y.jsx("label",{children:"Occupant"}),Y.jsx("input",{className:"mf-input",type:"text",value:Lo.properties?.occupant??"",onChange:O=>$o(he=>he&&{...he,properties:{...he.properties,occupant:O.target.value}}),placeholder:"(optional)"})]}),Y.jsxs("div",{className:"mf-form-row",children:[Y.jsx("label",{children:"Area (SF)"}),Y.jsx("input",{className:"mf-input",value:Lo.properties?.area??"",disabled:!0,readOnly:!0})]}),Tc&&Y.jsxs("div",{className:"mf-form-row",children:[Y.jsx("label",{children:"Seat Count"}),Y.jsx("input",{className:"mf-input",type:"number",min:"0",value:Fh==="__MIXED__"?"":Fh,placeholder:Ol&&Fh==="__MIXED__"?"varies":"",onChange:O=>{const he=O.target.value;$o(Ie=>Ie&&{...Ie,properties:{...Ie.properties,seatCount:he}})}})]}),tl&&Y.jsxs("div",{className:"mf-form-row",children:[Y.jsx("label",{children:"Occupancy Status"}),Y.jsxs("select",{className:"mf-input",value:Du==="__MIXED__"?"":Du,onChange:O=>{const he=O.target.value;$o(Ie=>Ie&&{...Ie,properties:{...Ie.properties,occupancyStatus:he||(Ol?null:"")}})},children:[Ol&&Du==="__MIXED__"?Y.jsx("option",{value:"",children:"-- Mixed --"}):Y.jsx("option",{value:"",children:"--"}),Go.map(O=>Y.jsx("option",{value:O,children:O},O))]})]}),Y.jsxs("div",{className:"mf-form-row",children:[Y.jsx("label",{children:"Comments"}),Y.jsx("textarea",{className:"mf-input",rows:3,value:Lo.properties?.comments??"",onChange:O=>$o(he=>he&&{...he,properties:{...he.properties,comments:O.target.value}})})]}),Y.jsxs("div",{className:"mf-actions",children:[Y.jsx("button",{className:"btn",onClick:_u,children:"Cancel"}),Y.jsx("button",{className:"btn",onClick:async()=>{const O=fa,he=vs.length?vs.filter(gt=>O.has(gt.roomId||String(gt.revitId??""))):[];if(!he.length)return;let Ie=0;const qe=he.length>1,Qe=Lo.properties||{},Fe=_.current,$e=Gu(Fe,da),St=$e&&($e._data||$e.serialize?.().data)||null,Mt=St?Tu(St)?.features||[]:[];for(const gt of he){const Zt={type:gt.properties?.type??gt.feature?.properties?.type??"",department:gt.properties?.department??gt.feature?.properties?.department??"",occupant:gt.properties?.occupant??gt.feature?.properties?.occupant??"",occupancyStatus:gt.properties?.occupancyStatus??gt.feature?.properties?.occupancyStatus??gt.properties?.["Occupancy Status"]??gt.feature?.properties?.["Occupancy Status"]??gt.properties?.OccupancyStatus??gt.feature?.properties?.OccupancyStatus??"",comments:gt.properties?.comments??gt.feature?.properties?.comments??"",seatCount:Zb({...gt.feature?.properties||{},...gt.properties||{}})},gn=Qe.occupancyStatus!=null&&String(Qe.occupancyStatus).trim()!==""?Qe.occupancyStatus:Zt.occupancyStatus,en=tl?qe?Qe.occupant!=null&&String(Qe.occupant).trim()!==""?Qe.occupant:Zt.occupant:Qe.occupant??Zt.occupant:void 0,$t=Tc?Qe.seatCount!=null?Qe.seatCount:Zt.seatCount:void 0,un={...gt.properties,...Qe,type:Qe.type!=null&&String(Qe.type).trim()!==""?Qe.type:Zt.type,department:Qe.department!=null&&String(Qe.department).trim()!==""?Qe.department:Zt.department,...tl?{occupancyStatus:gn,occupant:en}:{},...Tc?{seatCount:$t}:{}};if(tl&&(un.OccupancyStatus=gn,un["Occupancy Status"]=gn),await ot({roomId:gt.roomId,buildingId:gt.buildingId,buildingName:gt.buildingName,floorName:gt.floorName,revitId:gt.revitId,roomLabel:gt.roomLabel,roomNumber:gt.roomNumber,properties:un})&&(Ie+=1,Mt.length)){const Pr=gt.revitId??gt.feature?.id??gt.feature?.properties?.RevitId??null;if(Pr!=null){const Gn=Mt.find(rr=>(rr.id??rr.properties?.RevitId)===Pr);Gn&&Gn.properties&&(Gn.properties.department=un.department??Gn.properties.department,Gn.properties.department=Gn.properties.department||un.department||"",Gn.properties.Department=Gn.properties.department,Gn.properties.type=un.type??Gn.properties.type,Gn.properties.Type=Gn.properties.type,Gn.properties.RoomType=Gn.properties.type,tl&&(Gn.properties.Occupant=un.occupant??Gn.properties.Occupant,Gn.properties.occupant=Gn.properties.Occupant,Gn.properties.occupancyStatus=un.occupancyStatus??Gn.properties.occupancyStatus,Gn.properties.OccupancyStatus=un.OccupancyStatus??Gn.properties.OccupancyStatus,Gn.properties["Occupancy Status"]=un["Occupancy Status"]??Gn.properties["Occupancy Status"]),Tc&&(Gn.properties.SeatCount=un.seatCount??Gn.properties.SeatCount,Gn.properties["Seat Count"]=un.seatCount??Gn.properties["Seat Count"],Gn.properties.seatCount=un.seatCount??Gn.properties.seatCount))}}}if(Ie>0){try{if($e&&Mt.length){const gt=Tu(St)||{type:"FeatureCollection",features:[]};gt.features=Mt,$e.setData(gt)}}catch{}Lo.refreshPopup?.(),pl(),_u()}},children:vs.length>1?`Save ${vs.length} Rooms`:"Save"})]})]})}),ec&&vi&&Y.jsx("div",{style:{position:"fixed",inset:0,zIndex:10001,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Y.jsxs("div",{className:"mf-ai-modal-panel",style:{width:"min(760px, 92vw)",padding:16},children:[Y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,alignItems:"center"},children:[Y.jsxs("div",{children:[Y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[Y.jsx("div",{style:{fontWeight:700,fontSize:16},children:vi.title&&vi.title.includes("Summary")?vi.title:`${vi.title||"Level"} - Summary`}),Y.jsx("span",{title:"AI-generated summary based on currently loaded space data.",style:{fontSize:11,padding:"2px 8px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:"#f7f7ff"},children:" AI Summary"})]}),Y.jsx("div",{style:{fontSize:12,color:"#555",marginTop:2},children:"AI-assisted overview"})]}),Y.jsx("button",{className:"btn",onClick:()=>Aa(!1),children:"Close"})]}),Y.jsxs("div",{style:{marginTop:10,lineHeight:1.45},children:[vi.summary?Y.jsx("p",{style:{margin:"6px 0 10px 0"},children:vi.summary}):null,Y.jsxs("div",{children:[Y.jsx("h4",{style:{margin:"8px 0 4px 0"},children:"Insights"}),Y.jsx("ul",{style:{margin:"0 0 10px 18px",padding:0},children:(vi.insights||[]).map((O,he)=>Y.jsx("li",{children:O},he))})]}),Array.isArray(vi.watchouts)&&vi.watchouts.length?Y.jsxs("div",{children:[Y.jsx("h4",{style:{margin:"8px 0 4px 0"},children:"Watchouts"}),Y.jsx("ul",{style:{margin:"0 0 10px 18px",padding:0},children:vi.watchouts.map((O,he)=>Y.jsx("li",{children:O},he))})]}):null,Array.isArray(vi.data_used)&&vi.data_used.length?Y.jsxs("small",{style:{color:"#555"},children:["Data used: ",vi.data_used.join(", ")]}):null,Y.jsx("div",{style:{marginTop:12,fontSize:11,color:"#666"},children:"AI summaries reflect available data at the time of generation."})]})]})}),Za&&Rr&&Y.jsx("div",{style:{position:"fixed",inset:0,zIndex:10001,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Y.jsxs("div",{className:"mf-ai-modal-panel",style:{width:"min(760px, 92vw)",padding:16},children:[Y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,alignItems:"center"},children:[Y.jsxs("div",{children:[Y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[Y.jsx("div",{style:{fontWeight:700,fontSize:16},children:Rr.title&&Rr.title.includes("Summary")?Rr.title:`${Rr.title||"Building"} - Summary`}),Y.jsx("span",{title:"AI-generated summary based on currently loaded space data.",style:{fontSize:11,padding:"2px 8px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:"#f7f7ff"},children:" AI Summary"})]}),Y.jsx("div",{style:{fontSize:12,color:"#555",marginTop:2},children:"AI-assisted overview"})]}),Y.jsx("button",{className:"btn",onClick:()=>Ya(!1),children:"Close"})]}),Y.jsxs("div",{style:{marginTop:10,lineHeight:1.45},children:[Rr.summary?Y.jsx("p",{style:{margin:"6px 0 10px 0"},children:Rr.summary}):null,Y.jsxs("div",{children:[Y.jsx("h4",{style:{margin:"8px 0 4px 0"},children:"Insights"}),Y.jsx("ul",{style:{margin:"0 0 10px 18px",padding:0},children:(Rr.insights||[]).map((O,he)=>Y.jsx("li",{children:O},he))})]}),Array.isArray(Rr.watchouts)&&Rr.watchouts.length?Y.jsxs("div",{children:[Y.jsx("h4",{style:{margin:"8px 0 4px 0"},children:"Watchouts"}),Y.jsx("ul",{style:{margin:"0 0 10px 18px",padding:0},children:Rr.watchouts.map((O,he)=>Y.jsx("li",{children:O},he))})]}):null,Array.isArray(Rr.data_used)&&Rr.data_used.length?Y.jsxs("small",{style:{color:"#555"},children:["Data used: ",Rr.data_used.join(", ")]}):null,Y.jsx("div",{style:{marginTop:12,fontSize:11,color:"#666"},children:"AI summaries reflect available data at the time of generation."})]})]})}),Ta&&Fi&&Y.jsx("div",{style:{position:"fixed",inset:0,zIndex:10001,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Y.jsxs("div",{className:"mf-ai-modal-panel",style:{width:"min(760px, 92vw)",padding:16},children:[Y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,alignItems:"center"},children:[Y.jsxs("div",{children:[Y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[Y.jsx("div",{style:{fontWeight:700,fontSize:16},children:Fi.title&&Fi.title.includes("Summary")?Fi.title:`${Fi.title||be} - Summary`}),Y.jsx("span",{title:"AI-generated summary based on currently loaded space data.",style:{fontSize:11,padding:"2px 8px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:"#f7f7ff"},children:" AI Summary"})]}),Y.jsx("div",{style:{fontSize:12,color:"#555",marginTop:2},children:"AI-assisted overview"})]}),Y.jsx("button",{className:"btn",onClick:()=>xi(!1),children:"Close"})]}),Y.jsxs("div",{style:{marginTop:10,lineHeight:1.45},children:[Fi.summary?Y.jsx("p",{style:{margin:"6px 0 10px 0"},children:Fi.summary}):null,Y.jsxs("div",{children:[Y.jsx("h4",{style:{margin:"8px 0 4px 0"},children:"Insights"}),Y.jsx("ul",{style:{margin:"0 0 10px 18px",padding:0},children:(Fi.insights||[]).map((O,he)=>Y.jsx("li",{children:O},he))})]}),Array.isArray(Fi.watchouts)&&Fi.watchouts.length?Y.jsxs("div",{children:[Y.jsx("h4",{style:{margin:"8px 0 4px 0"},children:"Watchouts"}),Y.jsx("ul",{style:{margin:"0 0 10px 18px",padding:0},children:Fi.watchouts.map((O,he)=>Y.jsx("li",{children:O},he))})]}):null,Array.isArray(Fi.data_used)&&Fi.data_used.length?Y.jsxs("small",{style:{color:"#555"},children:["Data used: ",Fi.data_used.join(", ")]}):null,Y.jsx("div",{style:{marginTop:12,fontSize:11,color:"#666"},children:"AI summaries reflect available data at the time of generation."})]})]})}),tc&&Oi&&(()=>{const O=(Zt={})=>{let Kt=0,gn=0,en=0;for(const[$t,un]of Object.entries(Zt||{})){const vr=String($t||"").toLowerCase(),Pr=Number(un||0)||0;vr.includes("office")?Kt+=Pr:vr.includes("class")?gn+=Pr:vr.includes("lab")&&(en+=Pr)}return{offices:Kt,classrooms:gn,labs:en}},he=Xt||{},Ie=xo||{},qe=Oi?.scenarioDept||vo||"Selected Dept",Qe=Xt?.__label||"baseline",Fe=Ii,$e=`Baseline (${qe} in ${Qe})`,St=`Scenario (${qe} to ${Fe})`,Mt=O(he.roomTypes),gt=O(Ie.roomTypes);return Y.jsx("div",{style:{position:"fixed",inset:0,zIndex:10006,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Y.jsxs("div",{ref:pc,className:"mf-ai-modal-panel",style:{position:"fixed",left:Ah?Ah.x:"50%",top:Ah?Ah.y:"50%",transform:Ah?"none":"translate(-50%, -50%)",width:"min(760px, 92vw)",padding:16,maxHeight:"90vh",overflow:"auto"},children:[Y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,alignItems:"center"},children:[Y.jsx("div",{...xm,style:{fontWeight:700},children:`${vo||"Scenario"} - ${Xt?.__label||"baseline"} to ${Ii}${Ar?` (${Ar})`:""}`}),Y.jsxs("div",{style:{display:"flex",gap:8},children:[Y.jsx("button",{className:"btn",onClick:Pe,children:"Export Scenario (PDF)"}),Y.jsx("button",{className:"btn",onClick:()=>eu(!1),children:"Close"})]})]}),Y.jsx("p",{style:{marginTop:10},children:Oi.summary}),Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(160px, 1fr))",gap:10,marginBottom:10},children:[Y.jsxs("div",{style:{border:"1px solid #e0e0e0",borderRadius:8,padding:10},children:[Y.jsx("div",{style:{fontWeight:700,marginBottom:4},children:$e}),Y.jsxs("div",{style:{fontSize:13},children:["SF: ",Math.round(Xt?.totalSF||0).toLocaleString()]}),Y.jsxs("div",{style:{fontSize:13},children:["Rooms: ",Math.round(Xt?.rooms||0).toLocaleString()]}),Mt.offices||Mt.classrooms||Mt.labs?Y.jsxs(Y.Fragment,{children:[Y.jsxs("div",{style:{fontSize:13},children:["Offices: ",Mt.offices]}),Y.jsxs("div",{style:{fontSize:13},children:["Classrooms: ",Mt.classrooms]}),Y.jsxs("div",{style:{fontSize:13},children:["Labs: ",Mt.labs]})]}):null]}),Y.jsxs("div",{style:{border:"1px solid #e0e0e0",borderRadius:8,padding:10},children:[Y.jsx("div",{style:{fontWeight:700,marginBottom:4},children:St}),Y.jsxs("div",{style:{fontSize:13},children:["SF: ",Math.round(xo?.totalSF||0).toLocaleString()]}),Y.jsxs("div",{style:{fontSize:13},children:["Rooms: ",Math.round(xo?.rooms||0).toLocaleString()]}),gt.offices||gt.classrooms||gt.labs?Y.jsxs(Y.Fragment,{children:[Y.jsxs("div",{style:{fontSize:13},children:["Offices: ",gt.offices]}),Y.jsxs("div",{style:{fontSize:13},children:["Classrooms: ",gt.classrooms]}),Y.jsxs("div",{style:{fontSize:13},children:["Labs: ",gt.labs]})]}):null]})]}),Y.jsx("b",{children:`Scenario - ${Oi?.scenarioDept||vo||"Selected Dept"}`}),Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginTop:8},children:[Y.jsxs("div",{style:{border:"1px solid #e0e0e0",borderRadius:8,padding:10},children:[Y.jsx("div",{style:{fontWeight:700,marginBottom:6},children:"Pluses"}),Y.jsx("ul",{style:{margin:0,paddingLeft:18},children:(Oi?.scenarioPros||[]).map((Zt,Kt)=>Y.jsx("li",{children:Zt},Kt))})]}),Y.jsxs("div",{style:{border:"1px solid #e0e0e0",borderRadius:8,padding:10},children:[Y.jsx("div",{style:{fontWeight:700,marginBottom:6},children:"Minuses"}),Y.jsx("ul",{style:{margin:0,paddingLeft:18},children:(Oi?.scenarioCons||[]).map((Zt,Kt)=>Y.jsx("li",{children:Zt},Kt))})]})]}),Oi.risks?.length?Y.jsxs(Y.Fragment,{children:[Y.jsx("b",{children:"Risks / watchouts"}),Y.jsx("ul",{children:Oi.risks.map((Zt,Kt)=>Y.jsx("li",{children:Zt},Kt))})]}):null,Oi.notes?.length?Y.jsxs(Y.Fragment,{children:[Y.jsx("b",{children:"Notes"}),Y.jsx("ul",{children:Oi.notes.map((Zt,Kt)=>Y.jsx("li",{children:Zt},Kt))})]}):null]})})})(),ci&&Y.jsx("div",{style:{position:"fixed",inset:0,zIndex:10002,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Y.jsxs("div",{className:"mf-ai-modal-panel",style:{width:"min(560px, 92vw)",padding:16,lineHeight:1.4},children:[Y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[Y.jsxs("div",{children:[Y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[Y.jsx("div",{style:{fontWeight:700,fontSize:16},children:"Create move scenario (AI)"}),Y.jsx("span",{title:"AI-generated scenario plan based on currently loaded space data.",style:{fontSize:11,padding:"2px 8px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:"#f7f7ff"},children:" AI"})]}),Y.jsx("div",{style:{fontSize:12,color:"#555"},children:"Uses campus-wide room inventory to suggest candidates."})]}),Y.jsx("button",{className:"btn",onClick:()=>Jo(!1),children:"Close"})]}),Y.jsxs("div",{style:{marginTop:10},children:[Y.jsx("label",{style:{fontWeight:600,fontSize:12},children:"Request"}),Y.jsx("textarea",{value:Eo,onChange:O=>xh(O.target.value),rows:3,placeholder:"e.g. Find a new home for Physics; move the Art department to the Gray Center.",style:{width:"100%",resize:"vertical",padding:8,borderRadius:8,border:"1px solid #d0d0d0",marginTop:4}})]}),js?Y.jsx("div",{style:{color:"crimson",marginTop:6,fontSize:12},children:js}):null,Y.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,marginTop:10},children:[Y.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,fontSize:12,color:"#444"},children:[Y.jsx("input",{type:"checkbox",checked:Ml,onChange:O=>Oa(O.target.checked)}),"Strict fit (5% target)"]}),Y.jsx("button",{className:"btn",disabled:ku||!Eo.trim()||Di,onClick:Il,children:ku?"Planning...":"Create move scenario"})]})]})}),Ko&&Y.jsx("div",{style:{position:"fixed",inset:0,zIndex:10004,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Y.jsxs("div",{ref:Mc,className:"mf-ai-modal-panel",style:{position:"fixed",left:td?td.x:"50%",top:td?td.y:"50%",transform:td?"none":"translate(-50%, -50%)",width:"min(760px, 92vw)",padding:12,lineHeight:1.35,fontSize:12,maxHeight:"90vh",overflow:"auto"},children:[Y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,alignItems:"center"},children:[Y.jsxs("div",{children:[Y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},...vg,children:[Y.jsx("div",{style:{fontWeight:700,fontSize:16},children:Ko.title||"Move scenario plan"}),Y.jsx("span",{title:"AI-generated scenario plan based on currently loaded space data.",style:{fontSize:11,padding:"2px 8px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:"#f7f7ff"},children:" AI"})]}),Ko.interpretedIntent?Y.jsx("div",{style:{fontSize:12,color:"#555"},children:Ko.interpretedIntent}):null]}),Y.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[Y.jsx("button",{className:"btn",onClick:()=>Bu(Ko),children:"Add to Scenario Comparison"}),Y.jsx("button",{className:"btn",onClick:()=>go(null),children:"Close"})]})]}),Ko.selectionCriteria?.filter(O=>!/vacan/i.test(O||"")).length?Y.jsxs("div",{style:{marginTop:10},children:[Y.jsx("b",{children:"Selection criteria"}),Y.jsx("ul",{style:{margin:"6px 0 10px 18px",padding:0},children:Ko.selectionCriteria.filter(O=>!/vacan/i.test(O||"")).map((O,he)=>Y.jsx("li",{children:O},he))})]}):null,Y.jsxs("div",{style:{marginTop:10},children:[Y.jsx("b",{children:"Recommended candidates"}),Ko.recommendedCandidates?.length?Y.jsxs("div",{style:{marginTop:6,border:"1px solid #e0e0e0",borderRadius:8,overflow:"hidden"},children:[Y.jsx("div",{style:{display:"flex",justifyContent:"flex-end",padding:"6px 8px",background:"#f8f9fb"},children:Y.jsx("button",{className:"btn",onClick:vd,children:"Select these rooms in Move Scenario"})}),Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 3fr",background:"#f8f9fb",padding:"6px 8px",fontWeight:600,fontSize:12},children:[Y.jsx("div",{children:"Location"}),Y.jsx("div",{children:"Room"}),Y.jsx("div",{style:{textAlign:"right"},children:"SF"}),Y.jsx("div",{style:{textAlign:"right"},children:"Match / Notes"}),Y.jsx("div",{children:"Rationale"})]}),Y.jsx("div",{children:Ko.recommendedCandidates.map((O,he)=>Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 3fr",padding:"6px 8px",borderTop:"1px solid #f0f0f0",fontSize:12},children:[Y.jsxs("div",{children:[Y.jsx("div",{style:{fontWeight:600},children:O.buildingLabel||"Building"}),Y.jsx("div",{style:{opacity:.75},children:O.floorId||""})]}),Y.jsxs("div",{children:[Y.jsx("div",{style:{fontWeight:600},children:O.roomLabel||"Room"}),Y.jsx("div",{style:{opacity:.75},children:O.type||"Unspecified"})]}),Y.jsx("div",{style:{textAlign:"right"},children:Math.round(Number(O.sf||0)).toLocaleString()}),Y.jsx("div",{style:{textAlign:"right"},children:(()=>{const Ie=String(O.occupant||"").trim(),qe=String(O.occupantDept||O.department||"").trim();return Ie?` Occupied  requires relocation${qe?` of ${qe}`:""}`:""})()}),Y.jsx("div",{children:r5(O.rationale)||""})]},O.id||he))})]}):Y.jsx("div",{style:{marginTop:6,fontSize:12,color:"#666"},children:"No candidates returned."})]}),Ko.assumptions?.length?Y.jsxs("div",{style:{marginTop:10},children:[Y.jsx("b",{children:"Assumptions"}),Y.jsx("ul",{style:{margin:"6px 0 10px 18px",padding:0},children:Ko.assumptions.map((O,he)=>Y.jsx("li",{children:O},he))})]}):null,Ko.nextSteps?.length?Y.jsxs("div",{style:{marginTop:10},children:[Y.jsx("b",{children:"Next steps"}),Y.jsx("ul",{style:{margin:"6px 0 10px 18px",padding:0},children:Ko.nextSteps.map((O,he)=>Y.jsx("li",{children:O},he))})]}):null]})}),ar&&Y.jsx("div",{style:{position:"fixed",inset:0,zIndex:10002,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Y.jsxs("div",{style:{width:"min(520px, 92vw)",background:"#fff",borderRadius:12,padding:16,boxShadow:"0 22px 44px rgba(0,0,0,0.25)",lineHeight:1.5,fontSize:13},children:[Y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[Y.jsx("div",{style:{fontWeight:700,fontSize:16},children:"What Mapfluence AI is doing"}),Y.jsx("button",{className:"btn",onClick:()=>ao(!1),children:"Close"})]}),Y.jsxs("div",{style:{marginTop:10},children:[Y.jsx("div",{style:{fontWeight:600,marginBottom:4},children:"What Mapfluence AI is doing"}),Y.jsxs("ul",{style:{paddingLeft:18,margin:"0 0 10px 0"},children:[Y.jsx("li",{children:"Generates summaries and comparisons from the statistics currently loaded in this session."}),Y.jsx("li",{children:"Uses your selected scope (campus / building / floor) and scenario totals when available."}),Y.jsx("li",{children:"Produces descriptive output and does not modify project data."})]}),Y.jsx("div",{style:{fontWeight:600,marginBottom:4},children:"What Mapfluence AI is not doing"}),Y.jsxs("ul",{style:{paddingLeft:18,margin:0},children:[Y.jsx("li",{children:"Not writing to the database automatically."}),Y.jsx("li",{children:"Not making final planning decisions."}),Y.jsx("li",{children:"Not inventing missing data; it will note what's unavailable."})]})]})]})}),ut&&Y.jsx("div",{style:{position:"fixed",inset:0,zIndex:10001,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Y.jsxs("div",{style:{width:480,maxWidth:"90vw",background:"#fff",borderRadius:14,padding:18,boxShadow:"0 22px 44px rgba(0,0,0,0.25)"},children:[Y.jsx("h4",{style:{margin:"0 0 10px 0"},children:"Confirm Move"}),Y.jsx("div",{style:{fontSize:13,color:"#333",marginBottom:10},children:`Move ${ut.person||ut.from?.occupantName||"-"} from ${ut.from?.buildingId||""} ${ut.from?.roomLabel||"-"} to ${ut.to?.buildingId||""} ${ut.to?.roomLabel||"-"}.`}),Y.jsxs("div",{className:"mf-form-row",children:[Y.jsx("label",{children:"Person"}),Y.jsx("input",{className:"mf-input",value:ut.person||"",onChange:O=>Nt(he=>he&&{...he,person:O.target.value})})]}),Y.jsxs("div",{className:"mf-form-row",children:[Y.jsx("label",{children:"Effective Date"}),Y.jsx("input",{className:"mf-input",type:"date",value:ut.effectiveDate||"",onChange:O=>Nt(he=>he&&{...he,effectiveDate:O.target.value})})]}),Y.jsxs("div",{className:"mf-form-row",children:[Y.jsx("label",{children:"Comments"}),Y.jsx("textarea",{className:"mf-input",rows:3,value:ut.comments||"",onChange:O=>Nt(he=>he&&{...he,comments:O.target.value})})]}),Y.jsxs("div",{className:"mf-actions",style:{marginTop:12,display:"flex",gap:8,justifyContent:"flex-end"},children:[Y.jsx("button",{className:"btn",onClick:Wr,children:"Cancel"}),Y.jsx("button",{className:"btn",onClick:rd,children:"Confirm move"})]})]})})]})},Aq=({config:n,universityId:e,persona:t,engagementMode:i=!1})=>Y.jsx(uC,{config:n,universityId:e,persona:t,engagementMode:i}),Tq=({config:n,universityId:e})=>Y.jsx("div",{className:"admin-page",style:{width:"100%",height:"100%"},children:Y.jsx(uC,{config:n,universityId:e,mode:"admin"})}),Iq=[{universityName:"Hastings College",enableDrawingEntry:!0,buildings:"Hastings_College_Buildings.geojson",boundary:"Hastings_College_Boundary.geojson",outdoorSpacesUrl:"geojson/HC_Outdoor_map.geojson",style:"mapbox://styles/mapbox/streets-v12",lng:-98.371164,lat:40.592958,zoom:15.8,pitch:39,bearing:0,logos:{clarkEnersen:"Clark_Enersen_Logo.png",university:"HC_image.png"}}],Cq="rockhurst",Lq="Rockhurst University",Pq=!1,kq="mapbox://styles/mapbox/light-v10",Mq=39.038,Rq=-94.57,Nq=16,Dq=45,Fq=-17.6,Oq={universityId:Cq,universityName:Lq,enableDrawingEntry:Pq,style:kq,lat:Mq,lng:Rq,zoom:Nq,pitch:Dq,bearing:Fq},Bq=`\uFEFF{"type":"FeatureCollection", "features": [\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37413233965788,40.590313487951285],[-98.37471259730057,40.59032045203848],[-98.37471509841112,40.5901317883289],[-98.3741348407684,40.590126090423354],[-98.37413233965788,40.590313487951285]]]},"properties":{"id":"Perkins Library"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.3736191179045,40.59064334156154],[-98.37362033072382,40.59056689953065],[-98.37387380996378,40.59057058348595],[-98.37387866124111,40.5903256000165],[-98.3736639922197,40.59032283703991],[-98.37366520503903,40.59030073322319],[-98.37333455263524,40.590296927283184],[-98.37333901987164,40.59001629518303],[-98.37333621176148,40.59001558437107],[-98.37294307634048,40.59001416274713],[-98.37294319965034,40.59029870430257],[-98.37297039172454,40.59029870430257],[-98.37297048222555,40.590645772706125],[-98.3736191179045,40.59064334156154]]]},"properties":{"id":"Kiewit Building"}},\r
{\r
  "type": "Feature",\r
  "geometry": {\r
    "type": "Polygon",\r
    "coordinates": [\r
      [\r
        [-98.374702, 40.590876],\r
        [-98.374710, 40.590479],\r
        [-98.374496, 40.590477],\r
        [-98.374487, 40.590874],\r
        [-98.374702, 40.590876]\r
      ]\r
    ]\r
  },\r
  "properties": {\r
    "id": "Hurley-McDonald Hall",\r
    "floorplans": [\r
      {\r
        "name": "Basement",\r
        "url": "/floorplans/hastings/Hurley_McDonald_Floor0.png",\r
        "bounds": [\r
          [-98.374714, 40.590887], \r
          [-98.374499, 40.590891], \r
          [-98.374507, 40.590498], \r
          [-98.374739, 40.590506]  \r
        ]\r
      },\r
      {\r
        "name": "First Floor",\r
        "url": "/floorplans/hastings/Hurley_McDonald_Floor1.png",\r
        "bounds": [\r
          [-98.374714, 40.590887],\r
          [-98.374499, 40.590891],\r
          [-98.374507, 40.590498],\r
          [-98.374739, 40.590506]\r
        ]\r
      },\r
      {\r
        "name": "Second Floor",\r
        "url": "/floorplans/hastings/HurleyMcDonald_Floor2.png",\r
        "bounds": [\r
          [-98.374714, 40.590887],\r
          [-98.374499, 40.590891],\r
          [-98.374507, 40.590498],\r
          [-98.374739, 40.590506]\r
        ]\r
      }\r
    ]\r
  }\r
},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37353314553962,40.59087905110178],[-98.37353314553962,40.590708779882675],[-98.37343235743603,40.590709639839424],[-98.37342896008421,40.59087905110178],[-98.37353314553962,40.59087905110178]]]},"properties":{"id":"Name1"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37382750296666,40.591193020762205],[-98.37382980649612,40.59115891068626],[-98.37386551120254,40.59115891068626],[-98.37387127002614,40.590980488467004],[-98.37383211002555,40.59097961384712],[-98.37382980649612,40.59094812752329],[-98.37358217708065,40.59094462904195],[-98.37357987355122,40.5911921461451],[-98.37382750296666,40.591193020762205]]]},"properties":{"id":"Daugherty Student Engagement Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37229446140842,40.59159148756918],[-98.37223367991126,40.591483310642786],[-98.37238183481058,40.59144580926746],[-98.37226027181626,40.59117752958438],[-98.37226217123805,40.59064529412409],[-98.37211591576053,40.59063952461079],[-98.3721178151823,40.59070587398362],[-98.372022844093,40.59070731636056],[-98.372022844093,40.590756357157964],[-98.37191647647298,40.590759241909645],[-98.3719107782076,40.59114002803756],[-98.37187278977188,40.591154451711894],[-98.37211211691694,40.59164773950174],[-98.37229446140842,40.59159148756918]]]},"properties":{"id":"Morrison-Reeves Science Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37336463965526,40.591802138119164],[-98.37337046026076,40.59172257877987],[-98.37363587987099,40.59172611475252],[-98.3736393722343,40.59156345981731],[-98.37337046026076,40.59155903984072],[-98.37337395262405,40.59147948021219],[-98.37323658633453,40.591475060230046],[-98.37323891457672,40.59155903984072],[-98.373206319186,40.59155815584537],[-98.37320748330708,40.591719042807036],[-98.37323891457672,40.591719042807036],[-98.37323658633453,40.59179860215054],[-98.37336463965526,40.591802138119164]]]},"properties":{"id":"Calvin H. French Memorial Chapel"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37201576628836,40.59262743658687],[-98.37201700980901,40.592578334337375],[-98.37203317557764,40.592578334337375],[-98.37204312374293,40.59206842423039],[-98.37202695797433,40.59206747994882],[-98.37202944501566,40.59201271159418],[-98.3719846782718,40.59201271159418],[-98.37198343475114,40.592025931545955],[-98.37195607729657,40.592026875828125],[-98.37195483377592,40.5920627585407],[-98.37188768366015,40.592063702822344],[-98.3718789790155,40.592578334337375],[-98.37194364208995,40.59257927861174],[-98.37194239856929,40.59260666256263],[-98.3719809477098,40.59260666256263],[-98.37197970418916,40.59262743658687],[-98.37201576628836,40.59262743658687]]]},"properties":{"id":"Altman Hall Residency"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37345908377378,40.592428311631785],[-98.37346414649254,40.592127677901516],[-98.37348540991137,40.592127677901516],[-98.37354717508036,40.59209077136578],[-98.37348844754263,40.59203771818496],[-98.3731381074038,40.59203694929797],[-98.3731340572288,40.592211486417455],[-98.37322214853538,40.59221379307237],[-98.3732170858166,40.592428311631785],[-98.37345908377378,40.592428311631785]]]},"properties":{"id":"Scott Studio Theatre"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37378031069133,40.59233336628362],[-98.37378112606382,40.592306742401384],[-98.37381863319813,40.59230736156156],[-98.37382271006055,40.592159382117295],[-98.37378520292624,40.59215876295575],[-98.37378520292624,40.59213151984219],[-98.37363680513397,40.59212966235677],[-98.37363680513397,40.59215133301679],[-98.37359522113724,40.59215133301679],[-98.37359032890232,40.59231107652247],[-98.37363272827155,40.59231107652247],[-98.37363354364403,40.59233336628362],[-98.37378031069133,40.59233336628362]]]},"properties":{"id":"McCormick Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37472106546831,40.59285396151976],[-98.3747264832459,40.59266057179469],[-98.3747658645213,40.59266160297934],[-98.37476450654628,40.59255229731774],[-98.37474549489609,40.59255126613141],[-98.37474549489609,40.59250692510384],[-98.37467895412038,40.59250692510384],[-98.37467895412038,40.592480114235705],[-98.37464228879502,40.592479083048254],[-98.37464093082,40.59250795629086],[-98.37457846396934,40.59250795629086],[-98.37457826932462,40.59254912199468],[-98.37452034258709,40.59254809904091],[-98.37451764832021,40.59265857795722],[-98.37457018652402,40.59265755500513],[-98.37456479799032,40.59285498446884],[-98.37472106546831,40.59285396151976]]]},"properties":{"id":"Taylor Hall Residence"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.3737386139963,40.592822505804655],[-98.3737406459065,40.592765417120646],[-98.37377315646964,40.59276618858968],[-98.37377417242475,40.59266744048179],[-98.37374369377179,40.59266666901163],[-98.37374470972688,40.59260417989853],[-98.37339826903835,40.59259955107303],[-98.37339217330776,40.592818648462675],[-98.3737386139963,40.592822505804655]]]},"properties":{"id":"Wilson Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.3710880581408,40.59285384881594],[-98.37108495134117,40.59269460559814],[-98.37111757273735,40.59269460559814],[-98.37111912613716,40.592625010294974],[-98.37109116494044,40.59262265113089],[-98.37109116494044,40.592462227777595],[-98.37088766956425,40.59245986860776],[-98.37088922296408,40.59250115406781],[-98.3708488345688,40.59249997448359],[-98.37084572776917,40.59285384881594],[-98.3710880581408,40.59285384881594]]]},"properties":{"id":"Batchelder General Services"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37139804641792,40.59329458891759],[-98.37139804641792,40.59319899088562],[-98.37129990788338,40.59319823814465],[-98.3712969339884,40.59329308343783],[-98.37139804641792,40.59329458891759]]]},"properties":{"id":"Campus Safety"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37252975651616,40.593156827790594],[-98.37252881637454,40.59312398858383],[-98.37250813325893,40.59312327468785],[-98.37251095368379,40.59305259894826],[-98.37230600281096,40.59304902946449],[-98.37230882323581,40.59292195571781],[-98.37217062241788,40.59292195571781],[-98.37217062241788,40.593047601670925],[-98.37191960460574,40.593045459980516],[-98.37191866446413,40.59312184689587],[-98.37189234049882,40.59312184689587],[-98.37189328064044,40.593152544416704],[-98.3719572102705,40.593152544416704],[-98.3719572102705,40.59316468064199],[-98.37217062241788,40.59316468064199],[-98.37217156255952,40.59315325831238],[-98.37224959431384,40.593155399999326],[-98.37224865417222,40.59316682232858],[-98.37246206631963,40.59316967791059],[-98.37246394660288,40.59315468610369],[-98.37252975651616,40.593156827790594]]]},"properties":{"id":"Bronc Hall Residence"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37189410131195,40.59411717917972],[-98.3718924278385,40.594065714506016],[-98.37190665236291,40.594065714506016],[-98.37190748909967,40.593829357718064],[-98.37189410131195,40.59382999308689],[-98.37189661152215,40.59378170503864],[-98.37176022343498,40.59378043430005],[-98.37175938669823,40.59382745161154],[-98.37174683564726,40.59382745161154],[-98.3717451621738,40.5940663498726],[-98.37175603975129,40.5940663498726],[-98.37175603975129,40.5941152730814],[-98.37189410131195,40.59411717917972]]]},"properties":{"id":"The 1882 Residence Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37297358496218,40.594287236848594],[-98.37302656725574,40.594179361354826],[-98.37318062346203,40.59422593696438],[-98.37321057883548,40.59415661511511],[-98.37328903338498,40.594179361354826],[-98.3734202664496,40.59391832071013],[-98.37334181190009,40.59389665754029],[-98.37335892925634,40.5938717448863],[-98.37293670113542,40.593748264638194],[-98.37292243667187,40.59377317733819],[-98.37255726640511,40.593660528533846],[-98.37249307631916,40.59376559521309],[-98.37264713252546,40.593813254270884],[-98.37260576558117,40.59390857228456],[-98.37245313582125,40.59386199645395],[-98.37236130461655,40.5940333213648],[-98.37244344372661,40.594057941663856],[-98.37243407698598,40.59407927924903],[-98.3725123372465,40.594103359502135],[-98.37250152675315,40.59412524968894],[-98.37257936230517,40.59414878163177],[-98.37257071391052,40.594169030041066],[-98.37297358496218,40.594287236848594]]]},"properties":{"id":"Hazelrigg Student Union"}},
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37003093644454,40.59489319890186],[-98.37002539427893,40.594554427576305],[-98.36991824574359,40.594554427576305],[-98.36991824574359,40.594491302294855],[-98.36939635848097,40.59449551064881],[-98.36939635848097,40.59456985819158],[-98.36930768383104,40.59456915680006],[-98.36931045491386,40.5949002127828],[-98.37003093644454,40.59489319890186]]]},"properties":{"id":"Physical Fitness Facility"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.3707569741431,40.595997812186724],[-98.3707609796432,40.59595345634213],[-98.37093925863765,40.59595608489197],[-98.37093579690959,40.59587065696967],[-98.37126985366618,40.59587459979926],[-98.37126985366618,40.595589401192704],[-98.37099983887846,40.59558677262847],[-98.37099983887846,40.595392258587665],[-98.36994747355205,40.59538963001566],[-98.3699455880793,40.59587362637473],[-98.3702990362079,40.59587224653109],[-98.37030085342192,40.59595296733678],[-98.37043169283199,40.59595227741577],[-98.37042896701095,40.595997812186724],[-98.3707569741431,40.595997812186724]]]},"properties":{"id":"Lynn Farrell Arena/Fleharty Educational Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37211946976164,40.595036751142146],[-98.37209853033835,40.595007397045535],[-98.37215327445425,40.59498984579718],[-98.37194527282195,40.59469129454744],[-98.37194712982472,40.594305952303756],[-98.37169736008775,40.5943052575816],[-98.37169708368509,40.594470035453604],[-98.37176513394347,40.59446865751005],[-98.37176604128025,40.5945802708457],[-98.37153514181085,40.59467504115343],[-98.37155328864164,40.59470053315958],[-98.37153877117701,40.59470397802453],[-98.37157052813086,40.594785965758],[-98.37158504559547,40.59478114295293],[-98.37158595293702,40.59481421360927],[-98.37186178476472,40.594816280524746],[-98.37186178476472,40.59482661510118],[-98.3718844683032,40.59482799304458],[-98.3718826536201,40.59485210704955],[-98.37185180400779,40.59486313059177],[-98.37190170779242,40.59493685048371],[-98.3718871903278,40.594941673277546],[-98.37198881258011,40.59508980177594],[-98.37211946976164,40.595036751142146]]]},"properties":{"id":"Hayes M. Fuhr Hall of Music"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37538555821986,40.59328018799004],[-98.37538724870973,40.59309726484104],[-98.37520974727416,40.59309405565852],[-98.37521059251908,40.5931608066232],[-98.37519875909004,40.5931608066232],[-98.37519537811033,40.59327890432057],[-98.37538555821986,40.59328018799004]]]},"properties":{"id":"The Stone Health Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37471015347589,40.59324279822121],[-98.37471437942709,40.592969393604285],[-98.37457407784693,40.5929681100119],[-98.37457069708597,40.59313433502105],[-98.37436278028643,40.59313369322644],[-98.3743602447157,40.59324023104691],[-98.37471015347589,40.59324279822121]]]},"properties":{"id":"Babcock Hall Residence"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37464990421633,40.59375608706591],[-98.37465352180178,40.593639797917334],[-98.37456187630376,40.59363888225395],[-98.3745570528565,40.59375608706591],[-98.37464990421633,40.59375608706591]]]},"properties":{"id":"MacKay House"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.3742242349953,40.593824761664976],[-98.3742242349953,40.593780809929704],[-98.37426523429703,40.593780809929704],[-98.37427005774431,40.593658111182506],[-98.37412414846457,40.59365627985621],[-98.37412173674093,40.593824761664976],[-98.3742242349953,40.593824761664976]]]},"properties":{"id":"905 N Elm Ave"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37328303907076,40.59576922084294],[-98.37317465862661,40.595267009011295],[-98.37290194299486,40.59530583646519],[-98.37292020520233,40.595377020072085],[-98.3728508088139,40.595386264690795],[-98.37291395234293,40.595698179498136],[-98.37300321983061,40.59568449262486],[-98.37301866997268,40.59575031994207],[-98.37316630466383,40.59573076728035],[-98.37316973802872,40.59576335504669],[-98.37323926366815,40.59575227520792],[-98.37324527205675,40.59577573839374],[-98.37328303907076,40.59576922084294]]]},"properties":{"id":"Gray Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37355669887391,40.59683971651677],[-98.37346882100307,40.59659623606328],[-98.37349312764819,40.59659197692209],[-98.3734622769063,40.596499695463045],[-98.37332952522907,40.596526670056555],[-98.37330428371297,40.59644929553547],[-98.37297801374571,40.59651176304569],[-98.37254797310115,40.59649259688399],[-98.37254516848826,40.596542996778915],[-98.37256106129469,40.59659481634959],[-98.37255171258502,40.596682128686005],[-98.37264706942358,40.59668425825375],[-98.37264426481069,40.596737497425636],[-98.3727667329073,40.59674175655755],[-98.37276766777826,40.59669277652411],[-98.37282376003624,40.596682128686005],[-98.37300979935856,40.59668851738907],[-98.37300512500373,40.596779378877706],[-98.37291163790708,40.59679499568363],[-98.3729247261006,40.59683758695397],[-98.37296586042312,40.5968361672454],[-98.37296586042312,40.596802094230576],[-98.37299110193923,40.596887986588825],[-98.37307617519718,40.59686882053498],[-98.37309393774554,40.596929158093324],[-98.37355669887391,40.59683971651677]]]},"properties":{"id":"Jackson Dinsdale Art Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.36946922209306,40.59663009808219],[-98.36946309192157,40.59646951080968],[-98.36938339969201,40.596471838164206],[-98.36938646477778,40.59621582868018],[-98.36946922209306,40.59621582868018],[-98.36946309192157,40.59595516347105],[-98.36938952986353,40.59595516347105],[-98.36938646477778,40.59568984248238],[-98.36946615700731,40.59568984248238],[-98.36946309192157,40.59554321727376],[-98.36923321049021,40.595536235112945],[-98.36923321049021,40.596632425431125],[-98.36946922209306,40.59663009808219]]]},"properties":{"id":"Lloyd Wilson Field/Stadium"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.36635224661157,40.5952162806942],[-98.36635339463838,40.594929482162954],[-98.36611345703568,40.594929482162954],[-98.36611116098207,40.595215408968],[-98.36635224661157,40.5952162806942]]]},"properties":{"id":"Bronco Village Apartments 3"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.36594778233456,40.59521075896037],[-98.36594433215241,40.595025407005174],[-98.36560448920957,40.59502671691478],[-98.36560621430067,40.595043090782795],[-98.36556481211473,40.595043090782795],[-98.36556912484242,40.59519242027393],[-98.36560362666404,40.595191765320756],[-98.36560362666404,40.59521337877231],[-98.36594778233456,40.59521075896037]]]},"properties":{"id":"Bronco Village Apartments 4"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.36581753737377,40.59488116136897],[-98.36582035820989,40.594594140268],[-98.36557917672252,40.594593069291435],[-98.36557776630447,40.59489829691811],[-98.36562431010026,40.59489936788978],[-98.36562431010026,40.594879019425015],[-98.36581753737377,40.59488116136897]]]},"properties":{"id":"Bronco Village Apartments 1"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.36636763296093,40.59478975582371],[-98.3663640756504,40.59460499524451],[-98.36598486634739,40.594606075717216],[-98.36598842365792,40.59476814642561],[-98.36602186237695,40.59476868666066],[-98.36602186237695,40.59479029605858],[-98.36636763296093,40.59478975582371]]]},"properties":{"id":"Bronco Village Apartments 2"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.36542716760385,40.59439543172675],[-98.36542432429836,40.59422414915383],[-98.36538736132702,40.594225588505026],[-98.36538830909551,40.59420543758567],[-98.36508217987125,40.59420543758567],[-98.36508407540826,40.59422630818061],[-98.3650442691314,40.59422630818061],[-98.3650433213629,40.59437815955442],[-98.36508217987125,40.59437815955442],[-98.36508312763975,40.59439615140052],[-98.36542716760385,40.59439543172675]]]},"properties":{"id":"Bronco Village Apartments 5"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.36597687333165,40.594175930871394],[-98.36597687333165,40.59398737546289],[-98.3655949226277,40.59398881481917],[-98.36559302709068,40.594155060260746],[-98.36563188559904,40.5941543405844],[-98.36563283336753,40.59417521119527],[-98.36597687333165,40.594175930871394]]]},"properties":{"id":"Bronco Village Apartments 6"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.3646686039858,40.595412581009995],[-98.36494650785933,40.595223709584495],[-98.36492058096735,40.59520402262996],[-98.36498701862807,40.595156035653986],[-98.36490680730597,40.595086515999505],[-98.36483631856838,40.59513450302537],[-98.36481120189175,40.59511481604457],[-98.36470911475455,40.595181874799174],[-98.36465645075519,40.59513327258924],[-98.36458110072535,40.595182490016796],[-98.36463295450933,40.59522801610503],[-98.3645316775875,40.59529938126202],[-98.3646686039858,40.595412581009995]]]},"properties":{"id":"Barrett Alumni Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37338949046577,40.58959597891962],[-98.3733933780237,40.58945132240717],[-98.37327675128608,40.589449551101],[-98.37327286372816,40.58959361718315],[-98.37338949046577,40.58959597891962]]]},"properties":{"id":"706 E. 7th St. Residence"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37321144031304,40.58958535110486],[-98.37321299533619,40.589450141536396],[-98.37309792362176,40.5894489606656],[-98.37309559108701,40.58958535110486],[-98.37321144031304,40.58958535110486]]]},"properties":{"id":"710 E. 7th St. Residence"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37301550739384,40.58959538848551],[-98.3730225049981,40.58935803355154],[-98.37315079440947,40.58935921442396],[-98.37315312694422,40.58927655330535],[-98.37305827053098,40.58927537243149],[-98.37305749301939,40.58930607514516],[-98.37299218204632,40.58930489427181],[-98.37299140453474,40.5893633474772],[-98.37294008877019,40.5893633474772],[-98.37294164379337,40.58939582145811],[-98.37290976581842,40.58939523102224],[-98.3729058782605,40.58959538848551],[-98.37301550739384,40.58959538848551]]]},"properties":{"id":"714 E. 7th St. Residence"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37481677520717,40.59378243356543],[-98.3748159702016,40.59364459103049],[-98.37470492415694,40.59364364015712],[-98.37470219608254,40.59378243356543],[-98.37481677520717,40.59378243356543]]]},"properties":{"id":"607 E 9th St"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37505232877834,40.59378603329276],[-98.37505232877834,40.59363389370436],[-98.3749411932886,40.59363270511246],[-98.37493806271144,40.59378603329276],[-98.37505232877834,40.59378603329276]]]},"properties":{"id":"603 E 9th St"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37020808429642,40.59325096070355],[-98.3702087922692,40.59304678270344],[-98.37012640522326,40.59305025829369],[-98.37007453189801,40.59300275854457],[-98.3700699548399,40.59284403962595],[-98.36997383661961,40.59284403962595],[-98.36996925956151,40.59300275854457],[-98.37007148052594,40.59305373388376],[-98.37007497105584,40.59325096070355],[-98.37020808429642,40.59325096070355]]]},"properties":{"id":"906 E 9th St"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.3713716620568,40.59216760861196],[-98.3713716620568,40.59208501885758],[-98.37123658640381,40.592083686763935],[-98.37123658640381,40.592170272795876],[-98.3713716620568,40.59216760861196]]]},"properties":{"id":"812 N Ash Ave"}}\r
]}
`,zq=`{"type":"GeometryCollection", "geometries": [\r
{"type":"Polygon","coordinates":[[[-98.3702723467576,40.59295246060802],[-98.3712898200761,40.59296962250515],[-98.37127145248702,40.593452202532475],[-98.3693821617939,40.59343919245249],[-98.3693821617939,40.59396210621867],[-98.36898697694681,40.59395690670241],[-98.36897317608825,40.595313897438444],[-98.36666104991127,40.59530626415921],[-98.3666645004967,40.59434137689304],[-98.3660775631237,40.594328458560554],[-98.3660903226318,40.59391184099969],[-98.36552890427502,40.593908611396046],[-98.3655251986316,40.59414249211982],[-98.36432525734347,40.59413791286647],[-98.36427367897022,40.59707709495426],[-98.37377329389933,40.59709097965043],[-98.37386191086847,40.59401359006412],[-98.37508078915154,40.594020829208134],[-98.37509913072566,40.59343618356128],[-98.37541607762186,40.59342916474601],[-98.37541607762186,40.59304686495786],[-98.37491595389913,40.593044333163895],[-98.37497941341485,40.58982081072618],[-98.37347119813148,40.58981164082747],[-98.373477248548,40.58922812309826],[-98.37287220689669,40.589232717745936],[-98.37286010606364,40.58981164082747],[-98.37161977067842,40.58981164082747],[-98.37159980641273,40.59071814140597],[-98.37034264550859,40.590714592488666],[-98.37035943903622,40.59162321748957],[-98.37107540475405,40.59163250297191],[-98.37106656585733,40.592037456704084],[-98.37065419418758,40.59203614756078],[-98.37065535506281,40.59209797250316],[-98.37051258408789,40.59209551837214],[-98.37051409247337,40.59219975052995],[-98.37028934303831,40.59219975052995],[-98.3702875945045,40.59227459272085],[-98.37028731105269,40.59253351783216],[-98.37009609918391,40.59252977623261],[-98.36990069493494,40.59252314685871],[-98.36990818515268,40.5933535522459],[-98.37026022538576,40.59335639608224],[-98.3702723467576,40.59295246060802]]]}\r
]}`,jq='{"type":"FeatureCollection","features":[{"type":"Feature","properties":{"id":"Kiewit_MR_SEcorner"},"geometry":{"coordinates":[[[-98.37163503619607,40.59063976074893],[-98.37216212045448,40.590601318073],[-98.37257008962634,40.59062619274795],[-98.37289765611462,40.59063523808223],[-98.37286192158837,40.59039101362893],[-98.37285894371118,40.590234980871685],[-98.37290658974618,40.58994326648016],[-98.37282320918538,40.5896877326733],[-98.3716618370903,40.58968320994222],[-98.37163503619607,40.59063976074893]]],"type":"Polygon"},"id":0},{"type":"Feature","properties":{"id":"Daughtery_MR_Chapel"},"geometry":{"coordinates":[[[-98.37352702156389,40.5914658384647],[-98.37355230279564,40.59090910098766],[-98.37337280605138,40.590895662440005],[-98.37336774980503,40.59069984328954],[-98.37309471250403,40.590674885905486],[-98.3723160505715,40.590648008712265],[-98.37231099432515,40.591164432888604],[-98.3724626817145,40.5914312824801],[-98.37242728799043,40.591569506310634],[-98.37239189426599,40.5917653229138],[-98.37310482499674,40.5917787612872],[-98.37321100616931,40.591446640697654],[-98.37352702156389,40.5914658384647]]],"type":"Polygon"},"id":1},{"type":"Feature","properties":{"id":"801 Block"},"geometry":{"coordinates":[[[-98.37164381749396,40.591608632859675],[-98.37164919913825,40.59068913232153],[-98.37024189916244,40.59066052543514],[-98.37033069629301,40.591596372935584],[-98.37164381749396,40.591608632859675]]],"type":"Polygon"},"id":2},{"type":"Feature","properties":{"id":"South of Arboretum"},"geometry":{"coordinates":[[[-98.37476627281052,40.5910136742458],[-98.37477964615867,40.59092227590415],[-98.37446537247885,40.590915505651594],[-98.37446537247885,40.59037726838508],[-98.37394604079577,40.590356957462575],[-98.37393266744795,40.59120662589234],[-98.37434278345529,40.591032292413445],[-98.37476627281052,40.5910136742458]]],"type":"Polygon"},"id":3},{"type":"Feature","properties":{"id":"Arboretum"},"geometry":{"coordinates":[[[-98.37489112509611,40.59219972777811],[-98.37490794950106,40.591069061838084],[-98.37470325257557,40.59106054450788],[-98.37460230614677,40.59105628584243],[-98.37443686616615,40.59106693250561],[-98.37431068312993,40.59109035515871],[-98.37407514146206,40.591215985611285],[-98.3739938235057,40.59130328799105],[-98.37399101943821,40.59197189267704],[-98.37412561467688,40.59209965077304],[-98.37435554820935,40.59219333988858],[-98.37489112509611,40.59219972777811]]],"type":"Polygon"},"id":4},{"type":"Feature","properties":{"id":"North of Arboretum"},"geometry":{"coordinates":[[[-98.37431231320465,40.59336193656449],[-98.37433594448096,40.593078415557756],[-98.37448482150404,40.59306047115021],[-98.37451081590508,40.59293306571445],[-98.37449191088317,40.59276797661897],[-98.37448245837369,40.59257776476619],[-98.37449900026525,40.592471891896395],[-98.37483456434931,40.5924557417828],[-98.37483929060404,40.59226194011691],[-98.37479202805706,40.592233228710995],[-98.37449191088317,40.59222963978439],[-98.37424378251136,40.59221348961228],[-98.3740381904318,40.59213453315965],[-98.37391767093679,40.59193355267803],[-98.37388222402663,40.59336014213147],[-98.37431231320465,40.59336193656449]]],"type":"Polygon"},"id":5},{"type":"Feature","properties":{"id":"PickleBall Cts"},"geometry":{"coordinates":[[[-98.37301888192918,40.592758212922234],[-98.37305404173038,40.59270862956615],[-98.3730665988024,40.59181802995374],[-98.3720670558787,40.591791330852686],[-98.3720544988067,40.59201445872537],[-98.3720821243651,40.59211553349891],[-98.3720896586079,40.59233866028978],[-98.37207961295069,40.5925408087046],[-98.3720544988067,40.592636161518556],[-98.37203691890592,40.592884078198324],[-98.37301888192918,40.592758212922234]]],"type":"Polygon"},"id":6},{"type":"Feature","properties":{"id":"Steinhart Plz"},"geometry":{"coordinates":[[[-98.37375767305471,40.59380937954694],[-98.37381334284255,40.59285824408735],[-98.37336179901064,40.592860592586646],[-98.37332777858475,40.59276195554597],[-98.37319478964805,40.59273847051469],[-98.3726349990074,40.59282771358974],[-98.37261334964592,40.59363559284384],[-98.37317004752059,40.59373422859568],[-98.37375767305471,40.59380937954694]]],"type":"Polygon"},"id":7},{"type":"Feature","properties":{"id":"SE of Union"},"geometry":{"coordinates":[[[-98.37251903104057,40.59362476563635],[-98.37254773304886,40.593196135370334],[-98.37197369288644,40.59318887042687],[-98.37166753813338,40.593159810645574],[-98.37171059114546,40.59367925233752],[-98.37217939061152,40.593824549991155],[-98.37251903104057,40.59362476563635]]],"type":"Polygon"},"id":8},{"type":"Feature","properties":{"id":"Heartwell"},"geometry":{"coordinates":[[[-98.37407601600557,40.595375081069506],[-98.37397063105409,40.594673938335205],[-98.37389033775756,40.594109970364855],[-98.37308740479394,40.59428906881678],[-98.37294689152506,40.59433098540674],[-98.37263575500172,40.5942509628037],[-98.37250527839498,40.59418237192435],[-98.37237982011926,40.594094727921146],[-98.37199842696151,40.594033758112204],[-98.37202351861642,40.594334796004546],[-98.37202853694748,40.59470823353095],[-98.37212890356825,40.594822550724416],[-98.37225436184359,40.59499021558764],[-98.37219916020231,40.5950397528529],[-98.37206366526487,40.595108342852654],[-98.37216403188529,40.59528362808683],[-98.3728164149183,40.595218848814255],[-98.37322289973137,40.595119774511886],[-98.37330821135897,40.5956418182227],[-98.37353905458613,40.595710407604884],[-98.37407601600557,40.595375081069506]]],"type":"Polygon"},"id":9},{"type":"Feature","properties":{"id":"Heartwell North"},"geometry":{"coordinates":[[[-98.37364723125614,40.59642709268644],[-98.37372717366044,40.595729025036405],[-98.37348068458046,40.595744200497705],[-98.37331413790477,40.59580996078944],[-98.37317423869737,40.5958504286296],[-98.37308763442599,40.59580996078944],[-98.37296772081977,40.595789726860176],[-98.37289444028254,40.595739142010984],[-98.37274121734099,40.59567844014052],[-98.37272123173979,40.59534963738679],[-98.37165533301602,40.59529905220464],[-98.37130891593102,40.59546598316149],[-98.3713555489995,40.59585548710561],[-98.37149803178302,40.59612724032186],[-98.37170454966062,40.59618288333169],[-98.37166457845869,40.59672413564374],[-98.37141142751166,40.59705293163782],[-98.37241070756525,40.596997289352856],[-98.37251063557076,40.596410513342704],[-98.37364723125614,40.59642709268644]]],"type":"Polygon"},"id":10},{"type":"Feature","properties":{"id":"Athletic Parking lot"},"geometry":{"coordinates":[[[-98.37135713636462,40.59703881753842],[-98.37159398256752,40.59675342106121],[-98.37164547087292,40.59621781068529],[-98.37141377350018,40.59613570944552],[-98.37124901092368,40.59594804909017],[-98.37084225331375,40.5960575176949],[-98.37024498897541,40.59604578892433],[-98.36962198048437,40.5960184217856],[-98.36954474802666,40.596280363943634],[-98.3695498968572,40.59707400332135],[-98.37135713636462,40.59703881753842]]],"type":"Polygon"},"id":11},{"type":"Feature","properties":{"id":"Fle+PFF"},"geometry":{"coordinates":[[[-98.36986465261369,40.595478850474535],[-98.37011842595624,40.594928288639665],[-98.36931682444536,40.59493746470747],[-98.36901874147125,40.59488240828182],[-98.36905499480616,40.59548190913873],[-98.36986465261369,40.595478850474535]]],"type":"Polygon"},"id":12},{"type":"Feature","properties":{"id":"Football field"},"geometry":{"coordinates":[[[-98.36913306842247,40.59687166324542],[-98.36912125095233,40.595575039769074],[-98.36904443739681,40.59551222692079],[-98.36897944131144,40.59530135478337],[-98.36831766298764,40.59536416782973],[-98.36827630184256,40.596880636330724],[-98.36913306842247,40.59687166324542]]],"type":"Polygon"},"id":13},{"type":"Feature","properties":{"id":"Practice field"},"geometry":{"coordinates":[[[-98.36817488651938,40.596967941434826],[-98.3682206392564,40.5952830148853],[-98.36668220346046,40.59530907080216],[-98.36580718237055,40.59530907080216],[-98.36588153056778,40.59700268176945],[-98.36817488651938,40.596967941434826]]],"type":"Polygon"},"id":14},{"type":"Feature","properties":{"id":"track"},"geometry":{"coordinates":[[[-98.3658412178937,40.597004912936484],[-98.36577780942038,40.595387736092704],[-98.36551671491901,40.59541889048063],[-98.3653525983754,40.59530276950733],[-98.36468494243638,40.59548119921246],[-98.36468494243638,40.59674435461838],[-98.36463272353635,40.59700491285406],[-98.3658412178937,40.597004912936484]]],"type":"Polygon"},"id":15},{"type":"Feature","properties":{"id":"BVH outdoor"},"geometry":{"coordinates":[[[-98.36606218586846,40.594981336403094],[-98.36621039516318,40.5948299194323],[-98.36602176515188,40.59482378089922],[-98.36595709200517,40.59480741147544],[-98.36594361843285,40.59475011845865],[-98.36585738757081,40.59474807227855],[-98.36586277699975,40.594981336403094],[-98.36606218586846,40.594981336403094]]],"type":"Polygon"},"id":16},{"type":"Feature","properties":{"id":"BVH south outdoor"},"geometry":{"coordinates":[[[-98.36605957398896,40.59455423531671],[-98.36605957398896,40.59420722418943],[-98.36571163584682,40.59422694077912],[-98.36549871847637,40.59418750759389],[-98.36547794604984,40.59433735357291],[-98.36543120809051,40.59455817861465],[-98.36605957398896,40.59455423531671]]],"type":"Polygon"},"id":17}]}',Uq=`{"type":"FeatureCollection", "features": [\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.5732546949417,39.033957896346706],[-94.57326522382158,39.033796212560006],[-94.5729226302682,39.033781742786736],[-94.57291453112981,39.03394783044083],[-94.5732546949417,39.033957896346706]]]},"properties":{"id":"Physical Plant Operations"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57330618126248,39.03329184109743],[-94.57333069079144,39.032868879640596],[-94.57332112401924,39.03286702180975],[-94.57332590740536,39.03279828203385],[-94.57289061927166,39.032835438677765],[-94.57286046661933,39.03328233695542],[-94.57330618126248,39.03329184109743]]]},"properties":{"id":"St. Luke's Urgent Care"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57151501542803,39.03292423985276],[-94.57151293405649,39.032993004805604],[-94.57184717798721,39.03300418514015],[-94.57184478733176,39.03304318257621],[-94.57179856799333,39.03305618171678],[-94.57179298979729,39.03312055837771],[-94.571829646514,39.033121177383784],[-94.57181849012196,39.033266024655184],[-94.5720280709153,39.03327654773599],[-94.57204321173309,39.033054943703505],[-94.5720575556657,39.03305556271014],[-94.5720631338617,39.03295156951771],[-94.572026477145,39.032949093487446],[-94.57203205534103,39.03290576294391],[-94.57191730388003,39.03289895385609],[-94.57191252256916,39.0329466174571],[-94.57185434995351,39.03294537944191],[-94.57185275618323,39.03297261577139],[-94.57165911309279,39.032966425697424],[-94.57166230063338,39.032929904250025],[-94.57151501542803,39.03292423985276]]]},"properties":{"id":"St. Peter Claver Jesuit Community"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57320143143617,39.03248280295288],[-94.5732236476623,39.03206766728228],[-94.57287806192237,39.03205807982458],[-94.57285214299189,39.0324693805906],[-94.57320143143617,39.03248280295288]]]},"properties":{"id":"Greenlease Library"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57258061133909,39.03244157711775],[-94.57259171945215,39.03223353009446],[-94.57203878226827,39.03221147899157],[-94.57202520568563,39.03242240230252],[-94.57258061133909,39.03244157711775]]]},"properties":{"id":"Conway Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.5729983573256,39.031851550588144],[-94.57299756184071,39.031777457537544],[-94.57321564931763,39.03178334435931],[-94.57323249004943,39.03143209646873],[-94.57296205948676,39.031423909721845],[-94.57296447934267,39.03135905846342],[-94.57280960856365,39.03135529896836],[-94.5728071887077,39.03138819454341],[-94.57269708526324,39.03138631479668],[-94.57269708526324,39.03142109010315],[-94.57267409663196,39.03142015023023],[-94.572672886704,39.03149158053676],[-94.57274790223761,39.0314934602807],[-94.57273580295798,39.03168519389932],[-94.5727950894281,39.031686133768716],[-94.57279387950013,39.031724668403285],[-94.5728701049617,39.03172748800987],[-94.57286526524985,39.03184873098651],[-94.5729983573256,39.031851550588144]]]},"properties":{"id":"Sedgewick Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57326241323847,39.03143368161774],[-94.57327626990363,39.03124423732891],[-94.5730261570974,39.03123347343362],[-94.57301275849636,39.0314254445335],[-94.57326241323847,39.03143368161774]]]},"properties":{"id":"Greenlease Gallery"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.573095990435,39.03111733680814],[-94.57308496704151,39.031231510274026],[-94.57308922652759,39.0312361877],[-94.57325910712441,39.03124349870881],[-94.57328155089225,39.03098889143854],[-94.57264954299825,39.03095820723238],[-94.57262565897899,39.031273611693024],[-94.57279744019438,39.0312828882735],[-94.57281213805237,39.03110377869681],[-94.573095990435,39.03111733680814]]]},"properties":{"id":"Van Ackeren Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57168446809365,39.032022569107156],[-94.57169184016705,39.03180937961588],[-94.57179868570213,39.031816109120946],[-94.57180734885364,39.0318116227843],[-94.57183045059094,39.03127774669104],[-94.57147526137969,39.031266530763475],[-94.57148969996551,39.030961456851074],[-94.57133665095579,39.03095921365567],[-94.57130690259424,39.031697853704856],[-94.57146028857838,39.031697853704856],[-94.57144848965653,39.032017331773794],[-94.57168446809365,39.032022569107156]]]},"properties":{"id":"Massman Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57102622899816,39.03227668523504],[-94.57041136868395,39.032248511124756],[-94.57038028024108,39.03258659970685],[-94.57099514055531,39.03261611529995],[-94.57102622899816,39.03227668523504]]]},"properties":{"id":"Mason-Halpin Fieldhouse"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57102622899816,39.03227668523504],[-94.5710435003553,39.03201775132257],[-94.57017475109112,39.0319855522205],[-94.57016266114111,39.03223509487781],[-94.57102622899816,39.03227668523504]]]},"properties":{"id":"Convocation Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57003078591215,39.032220762006155],[-94.57011418121974,39.032159390693046],[-94.57010430545964,39.032152571654976],[-94.57011857044647,39.0321355240569],[-94.57007906740601,39.03210654313074],[-94.57011857044647,39.03207244790827],[-94.57010211084628,39.03205880981468],[-94.57012515428654,39.03204005743169],[-94.57007687279265,39.03200340503239],[-94.57005492665907,39.03201960028093],[-94.57003627244553,39.03200425741399],[-94.56983546532327,39.03214575261624],[-94.56986180068357,39.03216620973048],[-94.56983985454998,39.03218837159754],[-94.56987935759042,39.03221479535305],[-94.56989910911065,39.032200304907704],[-94.56992434716427,39.03221905724818],[-94.56996714212474,39.03218496207999],[-94.57000993708525,39.032220762006155],[-94.57001981284535,39.03221309059493],[-94.57003078591215,39.032220762006155]]]},"properties":{"id":"Student Activities Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.5700079120054,39.03251153999033],[-94.57007391952787,39.03239788275361],[-94.56962616850038,39.03226029743301],[-94.56963937000486,39.03224064236535],[-94.56956236122863,39.03221756901809],[-94.569545859348,39.0322355149555],[-94.56911791057726,39.032091092758456],[-94.56905630355628,39.03220047764487],[-94.56942814593293,39.03231926260322],[-94.56943254643443,39.03240899211564],[-94.56956566160477,39.032447447586094],[-94.56962836875111,39.03238335512371],[-94.5700079120054,39.03251153999033]]]},"properties":{"id":"Corcoran Residence Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.56854799775466,39.03168092891154],[-94.56855120851591,39.03148472512313],[-94.5683842489311,39.03148306237683],[-94.56838210842359,39.031552066315285],[-94.56833501725863,39.03155040357058],[-94.5683318064974,39.03160527412545],[-94.56837889766234,39.031604442753725],[-94.5683756869011,39.03167843479901],[-94.56854799775466,39.03168092891154]]]},"properties":{"id":"Town House Village"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.5694451877561,39.031137040617324],[-94.56944931800915,39.031079289457125],[-94.56924142860419,39.03107180319216],[-94.56923729835111,39.031130623824076],[-94.5694451877561,39.031137040617324]]]},"properties":{"id":"The Birdhouse"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57023544284519,39.03101832984793],[-94.57024370335134,39.03090603569337],[-94.56974669623084,39.03088999365672],[-94.56974531947982,39.03083117282454],[-94.56960626762614,39.03082582547373],[-94.56960351412411,39.03088250737171],[-94.56911752101182,39.03087074320795],[-94.56911201400773,39.03097982901504],[-94.57023544284519,39.03101832984793]]]},"properties":{"id":"Xavier-Loyola Residence Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57110683934017,39.030625006944845],[-94.5711103812666,39.03058465303729],[-94.57115524566798,39.03058648730631],[-94.57116351016298,39.030412231536324],[-94.57103836209599,39.030407645852364],[-94.57103836209599,39.03042507144983],[-94.57075146605564,39.030415900083284],[-94.5707502854135,39.03054338197162],[-94.57072076935995,39.03054429910667],[-94.57071722743352,39.03061583560425],[-94.57110683934017,39.030625006944845]]]},"properties":{"id":"Magis Activity Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57198788526269,39.03047484462258],[-94.57200861727132,39.03025032364125],[-94.57210130154519,39.03026832323989],[-94.57212569214357,39.03018021989759],[-94.57206837423735,39.02993485624719],[-94.57194154312575,39.02995664533168],[-94.57194032359583,39.029975592356216],[-94.57188544474947,39.02997275030286],[-94.57188544474947,39.029948119168985],[-94.57170739338125,39.029948119168985],[-94.57155373261142,39.029932961543864],[-94.57155373261142,39.02994906652044],[-94.57146348739738,39.0299414877084],[-94.57145373115803,39.03010916873508],[-94.57150129282489,39.03011201078295],[-94.57148665846586,39.03031758527588],[-94.57179885812519,39.03032705874041],[-94.5717927604756,39.030445476939825],[-94.57185373697156,39.03044831897417],[-94.57185495650148,39.030468213211414],[-94.57198788526269,39.03047484462258]]]},"properties":{"id":"Pedro Arrupe, S.J., Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57284047860178,39.0302797832297],[-94.57286427952926,39.029831426558175],[-94.5727080859427,39.02982911543394],[-94.572694697921,39.03005444969102],[-94.5725905688633,39.03005329413256],[-94.57258164351548,39.030234716579436],[-94.57268279745728,39.030237027690404],[-94.57267982234133,39.03027631656532],[-94.57284047860178,39.0302797832297]]]},"properties":{"id":"McGee Residence Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.5730942108803,39.03066445893382],[-94.57317199672308,39.030664613464],[-94.57325985414333,39.030643791903515],[-94.57335366799886,39.03057901367613],[-94.57337898284875,39.03051307863372],[-94.57340366198356,39.02995448923646],[-94.57335443753462,39.029949304371044],[-94.57335193459656,39.029918843279034],[-94.57318507205777,39.02991495462804],[-94.57317172305467,39.03002707731239],[-94.57310581235186,39.03002837352735],[-94.5730700106048,39.030426554038584],[-94.57268280619707,39.03041812687501],[-94.57267696475127,39.03046998632717],[-94.57261938478547,39.03048035821303],[-94.57261604681642,39.03052508695338],[-94.57264692302996,39.03053999652721],[-94.57264692302996,39.030585373471666],[-94.57268864764288,39.03067936847824],[-94.5730858659577,39.03068714736974],[-94.5730942108803,39.03066445893382]]]},"properties":{"id":"St. Ignatius Science Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57292884511348,39.02885017929442],[-94.57292884511348,39.02878607947923],[-94.57289583924593,39.02878607947923],[-94.57289790211264,39.02876043953688],[-94.57268542684032,39.02875242705299],[-94.57268336397358,39.02881973188946],[-94.57272049557459,39.02881973188946],[-94.57271843270787,39.02884697430505],[-94.57292884511348,39.02885017929442]]]},"properties":{"id":"University Marketing and Communication"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57283326901032,39.028729445595104],[-94.57284341632814,39.02854814224998],[-94.57270405983009,39.028544463626574],[-94.57270270685437,39.028568111916584],[-94.57268511817016,39.028568111916584],[-94.57268308870658,39.028620663643835],[-94.5727020303665,39.028622240195055],[-94.57270000090294,39.02865902638007],[-94.57268241221873,39.02865902638007],[-94.57268173573087,39.02870684839195],[-94.5727006773908,39.028707899424816],[-94.5726993244151,39.028725766981125],[-94.57283326901032,39.028729445595104]]]},"properties":{"id":"Rock Row Housing N"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57284691787102,39.02851897602392],[-94.57285908326953,39.0283383666503],[-94.57271782947576,39.02833311637091],[-94.57271715362029,39.02835674262511],[-94.5726975538116,39.02835726765288],[-94.57269417453423,39.02840924538392],[-94.57271512605388,39.02840924538392],[-94.572712422632,39.02844599729188],[-94.5726975538116,39.02844809740033],[-94.5726948503897,39.0284948247972],[-94.572712422632,39.028496399877454],[-94.57271174677652,39.02851582586437],[-94.57284691787102,39.02851897602392]]]},"properties":{"id":"Rock Row Housing S"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57359514381248,39.02847208180017],[-94.57361271431651,39.028083475715746],[-94.57327990829927,39.02807143210462],[-94.57325923711807,39.028461644061366],[-94.57359514381248,39.02847208180017]]]},"properties":{"id":"Security Department"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57480409573863,39.03238485708068],[-94.57475834188774,39.03234294052741],[-94.57478743748095,39.0323230514835],[-94.57466523598949,39.03222270213117],[-94.57465592539967,39.03222903047291],[-94.57456281950141,39.032149474135494],[-94.57455234508787,39.032154898434065],[-94.57453256008448,39.03213591338722],[-94.5745418706743,39.03212868098708],[-94.57443596271503,39.03204189212767],[-94.57444294565741,39.03200392196817],[-94.57448600713533,39.031963239631786],[-94.57446854977943,39.03195419910939],[-94.57445691154213,39.0319668558404],[-94.57437893535234,39.031978608517164],[-94.57437078858625,39.03197318420506],[-94.57426022533207,39.03199216929562],[-94.57421018091178,39.031950582900116],[-94.57410660059993,39.03202561920467],[-94.5741217303084,39.03203737187166],[-94.57391816391097,39.03218429006349],[-94.5739193483118,39.03221373112918],[-94.57398567475879,39.03222937169034],[-94.57396790874621,39.03229653406067],[-94.57383525585222,39.03238485708068],[-94.5738127522363,39.03243637879136],[-94.57379024862033,39.03244833918312],[-94.57380209262874,39.03245661945314],[-94.573822227443,39.03244281900256],[-94.57387552548074,39.03242901854928],[-94.57400462517222,39.032327815142885],[-94.57410885244606,39.03231401466714],[-94.57411122124773,39.032375656771244],[-94.57415030647543,39.03237933689516],[-94.5743552078206,39.03223397185472],[-94.574367051829,39.03224501224803],[-94.57443811587935,39.03218705016392],[-94.57453642114899,39.032267093029475],[-94.57452220833892,39.03227813341762],[-94.57461577600522,39.03235817618002],[-94.57462880441446,39.032348055835755],[-94.57464538602619,39.03236553642948],[-94.57466078323709,39.03235541608627],[-94.57474369129585,39.03242809851896],[-94.57480409573863,39.03238485708068]]]},"properties":{"id":"St. Francis Xavier Church"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57151501542803,39.03292423985276],[-94.57133748256577,39.032919396176545],[-94.57133184858787,39.03302943092199],[-94.57151052617259,39.03303443249725],[-94.57151501542803,39.03292423985276]]]},"properties":{"id":"Campus Ministry Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57133184858787,39.03302943092199],[-94.57132503847693,39.033133258595875],[-94.57150408963523,39.03313923484835],[-94.57151052617259,39.03303443249725],[-94.57133184858787,39.03302943092199]]]},"properties":{"id":"Kateri Community Residence"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57286010900144,39.03328693338342],[-94.57283532620258,39.03371719964933],[-94.5732878874704,39.0337356369808],[-94.57330546295397,39.03329801918155],[-94.57286010900144,39.03328693338342]]]},"properties":{"id":"Prosperity Center for Financial Opportunity"}}\r
]}`,Vq=`{"type":"GeometryCollection", "geometries": [\r
{"type":"Polygon","coordinates":[[[-94.5733601221702,39.033991702842954],[-94.57343057843688,39.032627336829854],[-94.57483618218124,39.03266045740923],[-94.57483618218124,39.03225653248882],[-94.57456975228335,39.031925844267924],[-94.57443769998508,39.031865057522765],[-94.5734766527032,39.03184416206704],[-94.5737667714431,39.02721317928421],[-94.57318118713299,39.027186419902776],[-94.5731396822614,39.02830719202791],[-94.5726236948803,39.02827994478758],[-94.57256476148764,39.028963612429386],[-94.5679483123955,39.02883237317173],[-94.56774097288552,39.032390935290124],[-94.5688957036816,39.03245419936561],[-94.57042657308332,39.032720791128675],[-94.57108453863592,39.03274057444863],[-94.57121364975842,39.03280827134139],[-94.57119428309004,39.03315176939054],[-94.57150092200602,39.03315929122695],[-94.57153965534276,39.03306150729117],[-94.57173977758268,39.03306652185526],[-94.57178173869748,39.03329719141926],[-94.57214002206244,39.033307220513656],[-94.57216584428696,39.0332119440594],[-94.57283722212401,39.03322949499484],[-94.57279848878727,39.033964123097064],[-94.5733601221702,39.033991702842954]]]}\r
]}`;function F_(n){return typeof n=="string"?n.replace(/^\uFEFF/,""):n}const qq=JSON.parse(F_(Bq)),$q=JSON.parse(F_(zq)),Gq=JSON.parse(F_(jq)),Hq=JSON.parse(F_(Uq)),Wq=JSON.parse(F_(Vq));function hC(n){return Array.isArray(n)?n[0]||{}:n||{}}const Kq=hC(Iq),Xq=hC(Oq),FT={...Kq,buildings:qq,boundary:$q,outdoorSpaces:Gq},Zq={...Xq,buildings:Hq,boundary:Wq},Yq={hastings:FT,"hastings-demo":FT,rockhurst:Zq};function Jq(n){return Yq[n]}function Ly({engagementMode:n=!1}){const{universityId:e,persona:t}=bP(),i=Jq(e);return i?window.location.pathname.includes("/admin")?Y.jsx(Tq,{config:i,universityId:e}):Y.jsx(Aq,{config:i,universityId:e,persona:t,engagementMode:n}):Y.jsxs("div",{children:['Error: Configuration not found for "',e,'".']})}function Qq(){return Y.jsx(o7,{basename:"/StakeholderMap",children:Y.jsxs(FP,{children:[Y.jsx(qm,{path:"/:universityId/admin",element:Y.jsx(Ly,{})}),Y.jsx(qm,{path:"/:universityId/engagement",element:Y.jsx(Ly,{engagementMode:!0})}),Y.jsx(qm,{path:"/:universityId/:persona",element:Y.jsx(Ly,{})}),Y.jsx(qm,{path:"/:universityId/survey",element:Y.jsx(Ly,{})}),Y.jsx(qm,{path:"/:universityId",element:Y.jsx(Ly,{})}),Y.jsx(qm,{path:"/",element:Y.jsx("div",{children:"Please select a university by navigating to its URL (e.g., /hastings)"})})]})})}const e$=$L.createRoot(document.getElementById("root"));e$.render(Y.jsx(Qq,{}));export{wa as _,t$ as c,Wv as g};
