function KL(n,e){for(var t=0;t<e.length;t++){const i=e[t];if(typeof i!="string"&&!Array.isArray(i)){for(const c in i)if(c!=="default"&&!(c in n)){const u=Object.getOwnPropertyDescriptor(i,c);u&&Object.defineProperty(n,c,u.get?u:{enumerable:!0,get:()=>i[c]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))i(c);new MutationObserver(c=>{for(const u of c)if(u.type==="childList")for(const m of u.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&i(m)}).observe(document,{childList:!0,subtree:!0});function t(c){const u={};return c.integrity&&(u.integrity=c.integrity),c.referrerPolicy&&(u.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?u.credentials="include":c.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function i(c){if(c.ep)return;c.ep=!0;const u=t(c);fetch(c.href,u)}})();var b$=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Yv(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function XL(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function i(){var c=!1;try{c=this instanceof i}catch{}return c?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(i){var c=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,c.get?c:{enumerable:!0,get:function(){return n[i]}})}),t}var sb={exports:{}},wy={},ab={exports:{}},os={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var y2;function ZL(){if(y2)return os;y2=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),c=Symbol.for("react.profiler"),u=Symbol.for("react.provider"),m=Symbol.for("react.context"),_=Symbol.for("react.forward_ref"),o=Symbol.for("react.suspense"),b=Symbol.for("react.memo"),I=Symbol.for("react.lazy"),M=Symbol.iterator;function V(xe){return xe===null||typeof xe!="object"?null:(xe=M&&xe[M]||xe["@@iterator"],typeof xe=="function"?xe:null)}var k={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ie=Object.assign,se={};function de(xe,le,Ne){this.props=xe,this.context=le,this.refs=se,this.updater=Ne||k}de.prototype.isReactComponent={},de.prototype.setState=function(xe,le){if(typeof xe!="object"&&typeof xe!="function"&&xe!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,xe,le,"setState")},de.prototype.forceUpdate=function(xe){this.updater.enqueueForceUpdate(this,xe,"forceUpdate")};function J(){}J.prototype=de.prototype;function ne(xe,le,Ne){this.props=xe,this.context=le,this.refs=se,this.updater=Ne||k}var me=ne.prototype=new J;me.constructor=ne,ie(me,de.prototype),me.isPureReactComponent=!0;var ue=Array.isArray,ke=Object.prototype.hasOwnProperty,ze={current:null},pe={key:!0,ref:!0,__self:!0,__source:!0};function U(xe,le,Ne){var Be,Qe={},rt=null,gt=null;if(le!=null)for(Be in le.ref!==void 0&&(gt=le.ref),le.key!==void 0&&(rt=""+le.key),le)ke.call(le,Be)&&!pe.hasOwnProperty(Be)&&(Qe[Be]=le[Be]);var pt=arguments.length-2;if(pt===1)Qe.children=Ne;else if(1<pt){for(var Mt=Array(pt),Jt=0;Jt<pt;Jt++)Mt[Jt]=arguments[Jt+2];Qe.children=Mt}if(xe&&xe.defaultProps)for(Be in pt=xe.defaultProps,pt)Qe[Be]===void 0&&(Qe[Be]=pt[Be]);return{$$typeof:n,type:xe,key:rt,ref:gt,props:Qe,_owner:ze.current}}function F(xe,le){return{$$typeof:n,type:xe.type,key:le,ref:xe.ref,props:xe.props,_owner:xe._owner}}function q(xe){return typeof xe=="object"&&xe!==null&&xe.$$typeof===n}function j(xe){var le={"=":"=0",":":"=2"};return"$"+xe.replace(/[=:]/g,function(Ne){return le[Ne]})}var H=/\/+/g;function Z(xe,le){return typeof xe=="object"&&xe!==null&&xe.key!=null?j(""+xe.key):le.toString(36)}function be(xe,le,Ne,Be,Qe){var rt=typeof xe;(rt==="undefined"||rt==="boolean")&&(xe=null);var gt=!1;if(xe===null)gt=!0;else switch(rt){case"string":case"number":gt=!0;break;case"object":switch(xe.$$typeof){case n:case e:gt=!0}}if(gt)return gt=xe,Qe=Qe(gt),xe=Be===""?"."+Z(gt,0):Be,ue(Qe)?(Ne="",xe!=null&&(Ne=xe.replace(H,"$&/")+"/"),be(Qe,le,Ne,"",function(Jt){return Jt})):Qe!=null&&(q(Qe)&&(Qe=F(Qe,Ne+(!Qe.key||gt&&gt.key===Qe.key?"":(""+Qe.key).replace(H,"$&/")+"/")+xe)),le.push(Qe)),1;if(gt=0,Be=Be===""?".":Be+":",ue(xe))for(var pt=0;pt<xe.length;pt++){rt=xe[pt];var Mt=Be+Z(rt,pt);gt+=be(rt,le,Ne,Mt,Qe)}else if(Mt=V(xe),typeof Mt=="function")for(xe=Mt.call(xe),pt=0;!(rt=xe.next()).done;)rt=rt.value,Mt=Be+Z(rt,pt++),gt+=be(rt,le,Ne,Mt,Qe);else if(rt==="object")throw le=String(xe),Error("Objects are not valid as a React child (found: "+(le==="[object Object]"?"object with keys {"+Object.keys(xe).join(", ")+"}":le)+"). If you meant to render a collection of children, use an array instead.");return gt}function Re(xe,le,Ne){if(xe==null)return xe;var Be=[],Qe=0;return be(xe,Be,"","",function(rt){return le.call(Ne,rt,Qe++)}),Be}function Oe(xe){if(xe._status===-1){var le=xe._result;le=le(),le.then(function(Ne){(xe._status===0||xe._status===-1)&&(xe._status=1,xe._result=Ne)},function(Ne){(xe._status===0||xe._status===-1)&&(xe._status=2,xe._result=Ne)}),xe._status===-1&&(xe._status=0,xe._result=le)}if(xe._status===1)return xe._result.default;throw xe._result}var Me={current:null},we={transition:null},De={ReactCurrentDispatcher:Me,ReactCurrentBatchConfig:we,ReactCurrentOwner:ze};function tt(){throw Error("act(...) is not supported in production builds of React.")}return os.Children={map:Re,forEach:function(xe,le,Ne){Re(xe,function(){le.apply(this,arguments)},Ne)},count:function(xe){var le=0;return Re(xe,function(){le++}),le},toArray:function(xe){return Re(xe,function(le){return le})||[]},only:function(xe){if(!q(xe))throw Error("React.Children.only expected to receive a single React element child.");return xe}},os.Component=de,os.Fragment=t,os.Profiler=c,os.PureComponent=ne,os.StrictMode=i,os.Suspense=o,os.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=De,os.act=tt,os.cloneElement=function(xe,le,Ne){if(xe==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+xe+".");var Be=ie({},xe.props),Qe=xe.key,rt=xe.ref,gt=xe._owner;if(le!=null){if(le.ref!==void 0&&(rt=le.ref,gt=ze.current),le.key!==void 0&&(Qe=""+le.key),xe.type&&xe.type.defaultProps)var pt=xe.type.defaultProps;for(Mt in le)ke.call(le,Mt)&&!pe.hasOwnProperty(Mt)&&(Be[Mt]=le[Mt]===void 0&&pt!==void 0?pt[Mt]:le[Mt])}var Mt=arguments.length-2;if(Mt===1)Be.children=Ne;else if(1<Mt){pt=Array(Mt);for(var Jt=0;Jt<Mt;Jt++)pt[Jt]=arguments[Jt+2];Be.children=pt}return{$$typeof:n,type:xe.type,key:Qe,ref:rt,props:Be,_owner:gt}},os.createContext=function(xe){return xe={$$typeof:m,_currentValue:xe,_currentValue2:xe,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},xe.Provider={$$typeof:u,_context:xe},xe.Consumer=xe},os.createElement=U,os.createFactory=function(xe){var le=U.bind(null,xe);return le.type=xe,le},os.createRef=function(){return{current:null}},os.forwardRef=function(xe){return{$$typeof:_,render:xe}},os.isValidElement=q,os.lazy=function(xe){return{$$typeof:I,_payload:{_status:-1,_result:xe},_init:Oe}},os.memo=function(xe,le){return{$$typeof:b,type:xe,compare:le===void 0?null:le}},os.startTransition=function(xe){var le=we.transition;we.transition={};try{xe()}finally{we.transition=le}},os.unstable_act=tt,os.useCallback=function(xe,le){return Me.current.useCallback(xe,le)},os.useContext=function(xe){return Me.current.useContext(xe)},os.useDebugValue=function(){},os.useDeferredValue=function(xe){return Me.current.useDeferredValue(xe)},os.useEffect=function(xe,le){return Me.current.useEffect(xe,le)},os.useId=function(){return Me.current.useId()},os.useImperativeHandle=function(xe,le,Ne){return Me.current.useImperativeHandle(xe,le,Ne)},os.useInsertionEffect=function(xe,le){return Me.current.useInsertionEffect(xe,le)},os.useLayoutEffect=function(xe,le){return Me.current.useLayoutEffect(xe,le)},os.useMemo=function(xe,le){return Me.current.useMemo(xe,le)},os.useReducer=function(xe,le,Ne){return Me.current.useReducer(xe,le,Ne)},os.useRef=function(xe){return Me.current.useRef(xe)},os.useState=function(xe){return Me.current.useState(xe)},os.useSyncExternalStore=function(xe,le,Ne){return Me.current.useSyncExternalStore(xe,le,Ne)},os.useTransition=function(){return Me.current.useTransition()},os.version="18.3.1",os}var _2;function pw(){return _2||(_2=1,ab.exports=ZL()),ab.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var v2;function YL(){if(v2)return wy;v2=1;var n=pw(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,c=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function m(_,o,b){var I,M={},V=null,k=null;b!==void 0&&(V=""+b),o.key!==void 0&&(V=""+o.key),o.ref!==void 0&&(k=o.ref);for(I in o)i.call(o,I)&&!u.hasOwnProperty(I)&&(M[I]=o[I]);if(_&&_.defaultProps)for(I in o=_.defaultProps,o)M[I]===void 0&&(M[I]=o[I]);return{$$typeof:e,type:_,key:V,ref:k,props:M,_owner:c.current}}return wy.Fragment=t,wy.jsx=m,wy.jsxs=m,wy}var x2;function JL(){return x2||(x2=1,sb.exports=YL()),sb.exports}var Y=JL(),On=pw();const QL=Yv(On),eP=KL({__proto__:null,default:QL},[On]);var u1={},lb={exports:{}},$h={},cb={exports:{}},ub={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var b2;function tP(){return b2||(b2=1,(function(n){function e(we,De){var tt=we.length;we.push(De);e:for(;0<tt;){var xe=tt-1>>>1,le=we[xe];if(0<c(le,De))we[xe]=De,we[tt]=le,tt=xe;else break e}}function t(we){return we.length===0?null:we[0]}function i(we){if(we.length===0)return null;var De=we[0],tt=we.pop();if(tt!==De){we[0]=tt;e:for(var xe=0,le=we.length,Ne=le>>>1;xe<Ne;){var Be=2*(xe+1)-1,Qe=we[Be],rt=Be+1,gt=we[rt];if(0>c(Qe,tt))rt<le&&0>c(gt,Qe)?(we[xe]=gt,we[rt]=tt,xe=rt):(we[xe]=Qe,we[Be]=tt,xe=Be);else if(rt<le&&0>c(gt,tt))we[xe]=gt,we[rt]=tt,xe=rt;else break e}}return De}function c(we,De){var tt=we.sortIndex-De.sortIndex;return tt!==0?tt:we.id-De.id}if(typeof performance=="object"&&typeof performance.now=="function"){var u=performance;n.unstable_now=function(){return u.now()}}else{var m=Date,_=m.now();n.unstable_now=function(){return m.now()-_}}var o=[],b=[],I=1,M=null,V=3,k=!1,ie=!1,se=!1,de=typeof setTimeout=="function"?setTimeout:null,J=typeof clearTimeout=="function"?clearTimeout:null,ne=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function me(we){for(var De=t(b);De!==null;){if(De.callback===null)i(b);else if(De.startTime<=we)i(b),De.sortIndex=De.expirationTime,e(o,De);else break;De=t(b)}}function ue(we){if(se=!1,me(we),!ie)if(t(o)!==null)ie=!0,Oe(ke);else{var De=t(b);De!==null&&Me(ue,De.startTime-we)}}function ke(we,De){ie=!1,se&&(se=!1,J(U),U=-1),k=!0;var tt=V;try{for(me(De),M=t(o);M!==null&&(!(M.expirationTime>De)||we&&!j());){var xe=M.callback;if(typeof xe=="function"){M.callback=null,V=M.priorityLevel;var le=xe(M.expirationTime<=De);De=n.unstable_now(),typeof le=="function"?M.callback=le:M===t(o)&&i(o),me(De)}else i(o);M=t(o)}if(M!==null)var Ne=!0;else{var Be=t(b);Be!==null&&Me(ue,Be.startTime-De),Ne=!1}return Ne}finally{M=null,V=tt,k=!1}}var ze=!1,pe=null,U=-1,F=5,q=-1;function j(){return!(n.unstable_now()-q<F)}function H(){if(pe!==null){var we=n.unstable_now();q=we;var De=!0;try{De=pe(!0,we)}finally{De?Z():(ze=!1,pe=null)}}else ze=!1}var Z;if(typeof ne=="function")Z=function(){ne(H)};else if(typeof MessageChannel<"u"){var be=new MessageChannel,Re=be.port2;be.port1.onmessage=H,Z=function(){Re.postMessage(null)}}else Z=function(){de(H,0)};function Oe(we){pe=we,ze||(ze=!0,Z())}function Me(we,De){U=de(function(){we(n.unstable_now())},De)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(we){we.callback=null},n.unstable_continueExecution=function(){ie||k||(ie=!0,Oe(ke))},n.unstable_forceFrameRate=function(we){0>we||125<we?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<we?Math.floor(1e3/we):5},n.unstable_getCurrentPriorityLevel=function(){return V},n.unstable_getFirstCallbackNode=function(){return t(o)},n.unstable_next=function(we){switch(V){case 1:case 2:case 3:var De=3;break;default:De=V}var tt=V;V=De;try{return we()}finally{V=tt}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(we,De){switch(we){case 1:case 2:case 3:case 4:case 5:break;default:we=3}var tt=V;V=we;try{return De()}finally{V=tt}},n.unstable_scheduleCallback=function(we,De,tt){var xe=n.unstable_now();switch(typeof tt=="object"&&tt!==null?(tt=tt.delay,tt=typeof tt=="number"&&0<tt?xe+tt:xe):tt=xe,we){case 1:var le=-1;break;case 2:le=250;break;case 5:le=1073741823;break;case 4:le=1e4;break;default:le=5e3}return le=tt+le,we={id:I++,callback:De,priorityLevel:we,startTime:tt,expirationTime:le,sortIndex:-1},tt>xe?(we.sortIndex=tt,e(b,we),t(o)===null&&we===t(b)&&(se?(J(U),U=-1):se=!0,Me(ue,tt-xe))):(we.sortIndex=le,e(o,we),ie||k||(ie=!0,Oe(ke))),we},n.unstable_shouldYield=j,n.unstable_wrapCallback=function(we){var De=V;return function(){var tt=V;V=De;try{return we.apply(this,arguments)}finally{V=tt}}}})(ub)),ub}var w2;function nP(){return w2||(w2=1,cb.exports=tP()),cb.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var S2;function rP(){if(S2)return $h;S2=1;var n=pw(),e=nP();function t(d){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+d,E=1;E<arguments.length;E++)g+="&args[]="+encodeURIComponent(arguments[E]);return"Minified React error #"+d+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,c={};function u(d,g){m(d,g),m(d+"Capture",g)}function m(d,g){for(c[d]=g,d=0;d<g.length;d++)i.add(g[d])}var _=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),o=Object.prototype.hasOwnProperty,b=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,I={},M={};function V(d){return o.call(M,d)?!0:o.call(I,d)?!1:b.test(d)?M[d]=!0:(I[d]=!0,!1)}function k(d,g,E,D){if(E!==null&&E.type===0)return!1;switch(typeof g){case"function":case"symbol":return!0;case"boolean":return D?!1:E!==null?!E.acceptsBooleans:(d=d.toLowerCase().slice(0,5),d!=="data-"&&d!=="aria-");default:return!1}}function ie(d,g,E,D){if(g===null||typeof g>"u"||k(d,g,E,D))return!0;if(D)return!1;if(E!==null)switch(E.type){case 3:return!g;case 4:return g===!1;case 5:return isNaN(g);case 6:return isNaN(g)||1>g}return!1}function se(d,g,E,D,K,ce,je){this.acceptsBooleans=g===2||g===3||g===4,this.attributeName=D,this.attributeNamespace=K,this.mustUseProperty=E,this.propertyName=d,this.type=g,this.sanitizeURL=ce,this.removeEmptyString=je}var de={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(d){de[d]=new se(d,0,!1,d,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(d){var g=d[0];de[g]=new se(g,1,!1,d[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(d){de[d]=new se(d,2,!1,d.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(d){de[d]=new se(d,2,!1,d,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(d){de[d]=new se(d,3,!1,d.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(d){de[d]=new se(d,3,!0,d,null,!1,!1)}),["capture","download"].forEach(function(d){de[d]=new se(d,4,!1,d,null,!1,!1)}),["cols","rows","size","span"].forEach(function(d){de[d]=new se(d,6,!1,d,null,!1,!1)}),["rowSpan","start"].forEach(function(d){de[d]=new se(d,5,!1,d.toLowerCase(),null,!1,!1)});var J=/[\-:]([a-z])/g;function ne(d){return d[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(d){var g=d.replace(J,ne);de[g]=new se(g,1,!1,d,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(d){var g=d.replace(J,ne);de[g]=new se(g,1,!1,d,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(d){var g=d.replace(J,ne);de[g]=new se(g,1,!1,d,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(d){de[d]=new se(d,1,!1,d.toLowerCase(),null,!1,!1)}),de.xlinkHref=new se("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(d){de[d]=new se(d,1,!1,d.toLowerCase(),null,!0,!0)});function me(d,g,E,D){var K=de.hasOwnProperty(g)?de[g]:null;(K!==null?K.type!==0:D||!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(ie(g,E,K,D)&&(E=null),D||K===null?V(g)&&(E===null?d.removeAttribute(g):d.setAttribute(g,""+E)):K.mustUseProperty?d[K.propertyName]=E===null?K.type===3?!1:"":E:(g=K.attributeName,D=K.attributeNamespace,E===null?d.removeAttribute(g):(K=K.type,E=K===3||K===4&&E===!0?"":""+E,D?d.setAttributeNS(D,g,E):d.setAttribute(g,E))))}var ue=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ke=Symbol.for("react.element"),ze=Symbol.for("react.portal"),pe=Symbol.for("react.fragment"),U=Symbol.for("react.strict_mode"),F=Symbol.for("react.profiler"),q=Symbol.for("react.provider"),j=Symbol.for("react.context"),H=Symbol.for("react.forward_ref"),Z=Symbol.for("react.suspense"),be=Symbol.for("react.suspense_list"),Re=Symbol.for("react.memo"),Oe=Symbol.for("react.lazy"),Me=Symbol.for("react.offscreen"),we=Symbol.iterator;function De(d){return d===null||typeof d!="object"?null:(d=we&&d[we]||d["@@iterator"],typeof d=="function"?d:null)}var tt=Object.assign,xe;function le(d){if(xe===void 0)try{throw Error()}catch(E){var g=E.stack.trim().match(/\n( *(at )?)/);xe=g&&g[1]||""}return`
`+xe+d}var Ne=!1;function Be(d,g){if(!d||Ne)return"";Ne=!0;var E=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(_n){var D=_n}Reflect.construct(d,[],g)}else{try{g.call()}catch(_n){D=_n}d.call(g.prototype)}else{try{throw Error()}catch(_n){D=_n}d()}}catch(_n){if(_n&&D&&typeof _n.stack=="string"){for(var K=_n.stack.split(`
`),ce=D.stack.split(`
`),je=K.length-1,Et=ce.length-1;1<=je&&0<=Et&&K[je]!==ce[Et];)Et--;for(;1<=je&&0<=Et;je--,Et--)if(K[je]!==ce[Et]){if(je!==1||Et!==1)do if(je--,Et--,0>Et||K[je]!==ce[Et]){var Ft=`
`+K[je].replace(" at new "," at ");return d.displayName&&Ft.includes("<anonymous>")&&(Ft=Ft.replace("<anonymous>",d.displayName)),Ft}while(1<=je&&0<=Et);break}}}finally{Ne=!1,Error.prepareStackTrace=E}return(d=d?d.displayName||d.name:"")?le(d):""}function Qe(d){switch(d.tag){case 5:return le(d.type);case 16:return le("Lazy");case 13:return le("Suspense");case 19:return le("SuspenseList");case 0:case 2:case 15:return d=Be(d.type,!1),d;case 11:return d=Be(d.type.render,!1),d;case 1:return d=Be(d.type,!0),d;default:return""}}function rt(d){if(d==null)return null;if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case pe:return"Fragment";case ze:return"Portal";case F:return"Profiler";case U:return"StrictMode";case Z:return"Suspense";case be:return"SuspenseList"}if(typeof d=="object")switch(d.$$typeof){case j:return(d.displayName||"Context")+".Consumer";case q:return(d._context.displayName||"Context")+".Provider";case H:var g=d.render;return d=d.displayName,d||(d=g.displayName||g.name||"",d=d!==""?"ForwardRef("+d+")":"ForwardRef"),d;case Re:return g=d.displayName||null,g!==null?g:rt(d.type)||"Memo";case Oe:g=d._payload,d=d._init;try{return rt(d(g))}catch{}}return null}function gt(d){var g=d.type;switch(d.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return d=g.render,d=d.displayName||d.name||"",g.displayName||(d!==""?"ForwardRef("+d+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return rt(g);case 8:return g===U?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function pt(d){switch(typeof d){case"boolean":case"number":case"string":case"undefined":return d;case"object":return d;default:return""}}function Mt(d){var g=d.type;return(d=d.nodeName)&&d.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function Jt(d){var g=Mt(d)?"checked":"value",E=Object.getOwnPropertyDescriptor(d.constructor.prototype,g),D=""+d[g];if(!d.hasOwnProperty(g)&&typeof E<"u"&&typeof E.get=="function"&&typeof E.set=="function"){var K=E.get,ce=E.set;return Object.defineProperty(d,g,{configurable:!0,get:function(){return K.call(this)},set:function(je){D=""+je,ce.call(this,je)}}),Object.defineProperty(d,g,{enumerable:E.enumerable}),{getValue:function(){return D},setValue:function(je){D=""+je},stopTracking:function(){d._valueTracker=null,delete d[g]}}}}function hn(d){d._valueTracker||(d._valueTracker=Jt(d))}function yn(d){if(!d)return!1;var g=d._valueTracker;if(!g)return!0;var E=g.getValue(),D="";return d&&(D=Mt(d)?d.checked?"true":"false":d.value),d=D,d!==E?(g.setValue(d),!0):!1}function Mn(d){if(d=d||(typeof document<"u"?document:void 0),typeof d>"u")return null;try{return d.activeElement||d.body}catch{return d.body}}function Gt(d,g){var E=g.checked;return tt({},g,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:E??d._wrapperState.initialChecked})}function ot(d,g){var E=g.defaultValue==null?"":g.defaultValue,D=g.checked!=null?g.checked:g.defaultChecked;E=pt(g.value!=null?g.value:E),d._wrapperState={initialChecked:D,initialValue:E,controlled:g.type==="checkbox"||g.type==="radio"?g.checked!=null:g.value!=null}}function dr(d,g){g=g.checked,g!=null&&me(d,"checked",g,!1)}function wr(d,g){dr(d,g);var E=pt(g.value),D=g.type;if(E!=null)D==="number"?(E===0&&d.value===""||d.value!=E)&&(d.value=""+E):d.value!==""+E&&(d.value=""+E);else if(D==="submit"||D==="reset"){d.removeAttribute("value");return}g.hasOwnProperty("value")?Ln(d,g.type,E):g.hasOwnProperty("defaultValue")&&Ln(d,g.type,pt(g.defaultValue)),g.checked==null&&g.defaultChecked!=null&&(d.defaultChecked=!!g.defaultChecked)}function Cr(d,g,E){if(g.hasOwnProperty("value")||g.hasOwnProperty("defaultValue")){var D=g.type;if(!(D!=="submit"&&D!=="reset"||g.value!==void 0&&g.value!==null))return;g=""+d._wrapperState.initialValue,E||g===d.value||(d.value=g),d.defaultValue=g}E=d.name,E!==""&&(d.name=""),d.defaultChecked=!!d._wrapperState.initialChecked,E!==""&&(d.name=E)}function Ln(d,g,E){(g!=="number"||Mn(d.ownerDocument)!==d)&&(E==null?d.defaultValue=""+d._wrapperState.initialValue:d.defaultValue!==""+E&&(d.defaultValue=""+E))}var ir=Array.isArray;function Qn(d,g,E,D){if(d=d.options,g){g={};for(var K=0;K<E.length;K++)g["$"+E[K]]=!0;for(E=0;E<d.length;E++)K=g.hasOwnProperty("$"+d[E].value),d[E].selected!==K&&(d[E].selected=K),K&&D&&(d[E].defaultSelected=!0)}else{for(E=""+pt(E),g=null,K=0;K<d.length;K++){if(d[K].value===E){d[K].selected=!0,D&&(d[K].defaultSelected=!0);return}g!==null||d[K].disabled||(g=d[K])}g!==null&&(g.selected=!0)}}function Kr(d,g){if(g.dangerouslySetInnerHTML!=null)throw Error(t(91));return tt({},g,{value:void 0,defaultValue:void 0,children:""+d._wrapperState.initialValue})}function qt(d,g){var E=g.value;if(E==null){if(E=g.children,g=g.defaultValue,E!=null){if(g!=null)throw Error(t(92));if(ir(E)){if(1<E.length)throw Error(t(93));E=E[0]}g=E}g==null&&(g=""),E=g}d._wrapperState={initialValue:pt(E)}}function Pn(d,g){var E=pt(g.value),D=pt(g.defaultValue);E!=null&&(E=""+E,E!==d.value&&(d.value=E),g.defaultValue==null&&d.defaultValue!==E&&(d.defaultValue=E)),D!=null&&(d.defaultValue=""+D)}function Hn(d){var g=d.textContent;g===d._wrapperState.initialValue&&g!==""&&g!==null&&(d.value=g)}function Bn(d){switch(d){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Rr(d,g){return d==null||d==="http://www.w3.org/1999/xhtml"?Bn(g):d==="http://www.w3.org/2000/svg"&&g==="foreignObject"?"http://www.w3.org/1999/xhtml":d}var vr,Tr=(function(d){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(g,E,D,K){MSApp.execUnsafeLocalFunction(function(){return d(g,E,D,K)})}:d})(function(d,g){if(d.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in d)d.innerHTML=g;else{for(vr=vr||document.createElement("div"),vr.innerHTML="<svg>"+g.valueOf().toString()+"</svg>",g=vr.firstChild;d.firstChild;)d.removeChild(d.firstChild);for(;g.firstChild;)d.appendChild(g.firstChild)}});function Ir(d,g){if(g){var E=d.firstChild;if(E&&E===d.lastChild&&E.nodeType===3){E.nodeValue=g;return}}d.textContent=g}var Pr={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Si=["Webkit","ms","Moz","O"];Object.keys(Pr).forEach(function(d){Si.forEach(function(g){g=g+d.charAt(0).toUpperCase()+d.substring(1),Pr[g]=Pr[d]})});function ki(d,g,E){return g==null||typeof g=="boolean"||g===""?"":E||typeof g!="number"||g===0||Pr.hasOwnProperty(d)&&Pr[d]?(""+g).trim():g+"px"}function or(d,g){d=d.style;for(var E in g)if(g.hasOwnProperty(E)){var D=E.indexOf("--")===0,K=ki(E,g[E],D);E==="float"&&(E="cssFloat"),D?d.setProperty(E,K):d[E]=K}}var oi=tt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Gr(d,g){if(g){if(oi[d]&&(g.children!=null||g.dangerouslySetInnerHTML!=null))throw Error(t(137,d));if(g.dangerouslySetInnerHTML!=null){if(g.children!=null)throw Error(t(60));if(typeof g.dangerouslySetInnerHTML!="object"||!("__html"in g.dangerouslySetInnerHTML))throw Error(t(61))}if(g.style!=null&&typeof g.style!="object")throw Error(t(62))}}function Or(d,g){if(d.indexOf("-")===-1)return typeof g.is=="string";switch(d){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var hi=null;function si(d){return d=d.target||d.srcElement||window,d.correspondingUseElement&&(d=d.correspondingUseElement),d.nodeType===3?d.parentNode:d}var lt=null,Ee=null,Te=null;function et(d){if(d=Ia(d)){if(typeof lt!="function")throw Error(t(280));var g=d.stateNode;g&&(g=Yh(g),lt(d.stateNode,d.type,g))}}function ht(d){Ee?Te?Te.push(d):Te=[d]:Ee=d}function Lt(){if(Ee){var d=Ee,g=Te;if(Te=Ee=null,et(d),g)for(d=0;d<g.length;d++)et(g[d])}}function Rt(d,g){return d(g)}function Ot(){}var At=!1;function Pt(d,g,E){if(At)return d(g,E);At=!0;try{return Rt(d,g,E)}finally{At=!1,(Ee!==null||Te!==null)&&(Ot(),Lt())}}function xn(d,g){var E=d.stateNode;if(E===null)return null;var D=Yh(E);if(D===null)return null;E=D[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(D=!D.disabled)||(d=d.type,D=!(d==="button"||d==="input"||d==="select"||d==="textarea")),d=!D;break e;default:d=!1}if(d)return null;if(E&&typeof E!="function")throw Error(t(231,g,typeof E));return E}var Un=!1;if(_)try{var In={};Object.defineProperty(In,"passive",{get:function(){Un=!0}}),window.addEventListener("test",In,In),window.removeEventListener("test",In,In)}catch{Un=!1}function kr(d,g,E,D,K,ce,je,Et,Ft){var _n=Array.prototype.slice.call(arguments,3);try{g.apply(E,_n)}catch(tr){this.onError(tr)}}var Lr=!1,jr=null,Er=!1,Ei=null,oo={onError:function(d){Lr=!0,jr=d}};function _o(d,g,E,D,K,ce,je,Et,Ft){Lr=!1,jr=null,kr.apply(oo,arguments)}function Ho(d,g,E,D,K,ce,je,Et,Ft){if(_o.apply(this,arguments),Lr){if(Lr){var _n=jr;Lr=!1,jr=null}else throw Error(t(198));Er||(Er=!0,Ei=_n)}}function so(d){var g=d,E=d;if(d.alternate)for(;g.return;)g=g.return;else{d=g;do g=d,(g.flags&4098)!==0&&(E=g.return),d=g.return;while(d)}return g.tag===3?E:null}function _s(d){if(d.tag===13){var g=d.memoizedState;if(g===null&&(d=d.alternate,d!==null&&(g=d.memoizedState)),g!==null)return g.dehydrated}return null}function ao(d){if(so(d)!==d)throw Error(t(188))}function Cs(d){var g=d.alternate;if(!g){if(g=so(d),g===null)throw Error(t(188));return g!==d?null:d}for(var E=d,D=g;;){var K=E.return;if(K===null)break;var ce=K.alternate;if(ce===null){if(D=K.return,D!==null){E=D;continue}break}if(K.child===ce.child){for(ce=K.child;ce;){if(ce===E)return ao(K),d;if(ce===D)return ao(K),g;ce=ce.sibling}throw Error(t(188))}if(E.return!==D.return)E=K,D=ce;else{for(var je=!1,Et=K.child;Et;){if(Et===E){je=!0,E=K,D=ce;break}if(Et===D){je=!0,D=K,E=ce;break}Et=Et.sibling}if(!je){for(Et=ce.child;Et;){if(Et===E){je=!0,E=ce,D=K;break}if(Et===D){je=!0,D=ce,E=K;break}Et=Et.sibling}if(!je)throw Error(t(189))}}if(E.alternate!==D)throw Error(t(190))}if(E.tag!==3)throw Error(t(188));return E.stateNode.current===E?d:g}function ma(d){return d=Cs(d),d!==null?bl(d):null}function bl(d){if(d.tag===5||d.tag===6)return d;for(d=d.child;d!==null;){var g=bl(d);if(g!==null)return g;d=d.sibling}return null}var ll=e.unstable_scheduleCallback,Hi=e.unstable_cancelCallback,nc=e.unstable_shouldYield,Lu=e.unstable_requestPaint,To=e.unstable_now,fu=e.unstable_getCurrentPriorityLevel,wa=e.unstable_ImmediatePriority,Zo=e.unstable_UserBlockingPriority,Ha=e.unstable_NormalPriority,Bl=e.unstable_LowPriority,rc=e.unstable_IdlePriority,Sa=null,ra=null;function mn(d){if(ra&&typeof ra.onCommitFiberRoot=="function")try{ra.onCommitFiberRoot(Sa,d,void 0,(d.current.flags&128)===128)}catch{}}var Yo=Math.clz32?Math.clz32:pu,ss=Math.log,_i=Math.LN2;function pu(d){return d>>>=0,d===0?32:31-(ss(d)/_i|0)|0}var Wa=64,Ka=4194304;function cl(d){switch(d&-d){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return d&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return d}}function Ls(d,g){var E=d.pendingLanes;if(E===0)return 0;var D=0,K=d.suspendedLanes,ce=d.pingedLanes,je=E&268435455;if(je!==0){var Et=je&~K;Et!==0?D=cl(Et):(ce&=je,ce!==0&&(D=cl(ce)))}else je=E&~K,je!==0?D=cl(je):ce!==0&&(D=cl(ce));if(D===0)return 0;if(g!==0&&g!==D&&(g&K)===0&&(K=D&-D,ce=g&-g,K>=ce||K===16&&(ce&4194240)!==0))return g;if((D&4)!==0&&(D|=E&16),g=d.entangledLanes,g!==0)for(d=d.entanglements,g&=D;0<g;)E=31-Yo(g),K=1<<E,D|=d[E],g&=~K;return D}function er(d,g){switch(d){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Br(d,g){for(var E=d.suspendedLanes,D=d.pingedLanes,K=d.expirationTimes,ce=d.pendingLanes;0<ce;){var je=31-Yo(ce),Et=1<<je,Ft=K[je];Ft===-1?((Et&E)===0||(Et&D)!==0)&&(K[je]=er(Et,g)):Ft<=g&&(d.expiredLanes|=Et),ce&=~Et}}function Mr(d){return d=d.pendingLanes&-1073741825,d!==0?d:d&1073741824?1073741824:0}function js(){var d=Wa;return Wa<<=1,(Wa&4194240)===0&&(Wa=64),d}function Ea(d){for(var g=[],E=0;31>E;E++)g.push(d);return g}function vi(d,g,E){d.pendingLanes|=g,g!==536870912&&(d.suspendedLanes=0,d.pingedLanes=0),d=d.eventTimes,g=31-Yo(g),d[g]=E}function Mi(d,g){var E=d.pendingLanes&~g;d.pendingLanes=g,d.suspendedLanes=0,d.pingedLanes=0,d.expiredLanes&=g,d.mutableReadLanes&=g,d.entangledLanes&=g,g=d.entanglements;var D=d.eventTimes;for(d=d.expirationTimes;0<E;){var K=31-Yo(E),ce=1<<K;g[K]=0,D[K]=-1,d[K]=-1,E&=~ce}}function wl(d,g){var E=d.entangledLanes|=g;for(d=d.entanglements;E;){var D=31-Yo(E),K=1<<D;K&g|d[D]&g&&(d[D]|=g),E&=~K}}var qi=0;function fs(d){return d&=-d,1<d?4<d?(d&268435455)!==0?16:536870912:4:1}var zi,mu,ic,Jc,yc,oc=!1,Ma=[],Ps=null,ji=null,Na=null,ai=new Map,Jo=new Map,Io=[],vh="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Pu(d,g){switch(d){case"focusin":case"focusout":Ps=null;break;case"dragenter":case"dragleave":ji=null;break;case"mouseover":case"mouseout":Na=null;break;case"pointerover":case"pointerout":ai.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":Jo.delete(g.pointerId)}}function vo(d,g,E,D,K,ce){return d===null||d.nativeEvent!==ce?(d={blockedOn:g,domEventName:E,eventSystemFlags:D,nativeEvent:ce,targetContainers:[K]},g!==null&&(g=Ia(g),g!==null&&mu(g)),d):(d.eventSystemFlags|=D,g=d.targetContainers,K!==null&&g.indexOf(K)===-1&&g.push(K),d)}function Us(d,g,E,D,K){switch(g){case"focusin":return Ps=vo(Ps,d,g,E,D,K),!0;case"dragenter":return ji=vo(ji,d,g,E,D,K),!0;case"mouseover":return Na=vo(Na,d,g,E,D,K),!0;case"pointerover":var ce=K.pointerId;return ai.set(ce,vo(ai.get(ce)||null,d,g,E,D,K)),!0;case"gotpointercapture":return ce=K.pointerId,Jo.set(ce,vo(Jo.get(ce)||null,d,g,E,D,K)),!0}return!1}function ku(d){var g=el(d.target);if(g!==null){var E=so(g);if(E!==null){if(g=E.tag,g===13){if(g=_s(E),g!==null){d.blockedOn=g,yc(d.priority,function(){ic(E)});return}}else if(g===3&&E.stateNode.current.memoizedState.isDehydrated){d.blockedOn=E.tag===3?E.stateNode.containerInfo:null;return}}}d.blockedOn=null}function Wo(d){if(d.blockedOn!==null)return!1;for(var g=d.targetContainers;0<g.length;){var E=Qc(d.domEventName,d.eventSystemFlags,g[0],d.nativeEvent);if(E===null){E=d.nativeEvent;var D=new E.constructor(E.type,E);hi=D,E.target.dispatchEvent(D),hi=null}else return g=Ia(E),g!==null&&mu(g),d.blockedOn=E,!1;g.shift()}return!0}function xo(d,g,E){Wo(d)&&E.delete(g)}function zl(){oc=!1,Ps!==null&&Wo(Ps)&&(Ps=null),ji!==null&&Wo(ji)&&(ji=null),Na!==null&&Wo(Na)&&(Na=null),ai.forEach(xo),Jo.forEach(xo)}function Da(d,g){d.blockedOn===g&&(d.blockedOn=null,oc||(oc=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,zl)))}function Vs(d){function g(K){return Da(K,d)}if(0<Ma.length){Da(Ma[0],d);for(var E=1;E<Ma.length;E++){var D=Ma[E];D.blockedOn===d&&(D.blockedOn=null)}}for(Ps!==null&&Da(Ps,d),ji!==null&&Da(ji,d),Na!==null&&Da(Na,d),ai.forEach(g),Jo.forEach(g),E=0;E<Io.length;E++)D=Io[E],D.blockedOn===d&&(D.blockedOn=null);for(;0<Io.length&&(E=Io[0],E.blockedOn===null);)ku(E),E.blockedOn===null&&Io.shift()}var Bo=ue.ReactCurrentBatchConfig,Dc=!0;function Ko(d,g,E,D){var K=qi,ce=Bo.transition;Bo.transition=null;try{qi=1,Xa(d,g,E,D)}finally{qi=K,Bo.transition=ce}}function ga(d,g,E,D){var K=qi,ce=Bo.transition;Bo.transition=null;try{qi=4,Xa(d,g,E,D)}finally{qi=K,Bo.transition=ce}}function Xa(d,g,E,D){if(Dc){var K=Qc(d,g,E,D);if(K===null)ou(d,g,D,ul,E),Pu(d,D);else if(Us(K,d,g,E,D))D.stopPropagation();else if(Pu(d,D),g&4&&-1<vh.indexOf(d)){for(;K!==null;){var ce=Ia(K);if(ce!==null&&zi(ce),ce=Qc(d,g,E,D),ce===null&&ou(d,g,D,ul,E),ce===K)break;K=ce}K!==null&&D.stopPropagation()}else ou(d,g,D,null,E)}}var ul=null;function Qc(d,g,E,D){if(ul=null,d=si(D),d=el(d),d!==null)if(g=so(d),g===null)d=null;else if(E=g.tag,E===13){if(d=_s(g),d!==null)return d;d=null}else if(E===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;d=null}else g!==d&&(d=null);return ul=d,null}function _c(d){switch(d){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(fu()){case wa:return 1;case Zo:return 4;case Ha:case Bl:return 16;case rc:return 536870912;default:return 16}default:return 16}}var qs=null,Ai=null,Ss=null;function $s(){if(Ss)return Ss;var d,g=Ai,E=g.length,D,K="value"in qs?qs.value:qs.textContent,ce=K.length;for(d=0;d<E&&g[d]===K[d];d++);var je=E-d;for(D=1;D<=je&&g[E-D]===K[ce-D];D++);return Ss=K.slice(d,1<D?1-D:void 0)}function ia(d){var g=d.keyCode;return"charCode"in d?(d=d.charCode,d===0&&g===13&&(d=13)):d=g,d===10&&(d=13),32<=d||d===13?d:0}function oa(){return!0}function hl(){return!1}function Gs(d){function g(E,D,K,ce,je){this._reactName=E,this._targetInst=K,this.type=D,this.nativeEvent=ce,this.target=je,this.currentTarget=null;for(var Et in d)d.hasOwnProperty(Et)&&(E=d[Et],this[Et]=E?E(ce):ce[Et]);return this.isDefaultPrevented=(ce.defaultPrevented!=null?ce.defaultPrevented:ce.returnValue===!1)?oa:hl,this.isPropagationStopped=hl,this}return tt(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var E=this.nativeEvent;E&&(E.preventDefault?E.preventDefault():typeof E.returnValue!="unknown"&&(E.returnValue=!1),this.isDefaultPrevented=oa)},stopPropagation:function(){var E=this.nativeEvent;E&&(E.stopPropagation?E.stopPropagation():typeof E.cancelBubble!="unknown"&&(E.cancelBubble=!0),this.isPropagationStopped=oa)},persist:function(){},isPersistent:oa}),g}var Hs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(d){return d.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},vc=Gs(Hs),W=tt({},Hs,{view:0,detail:0}),Ce=Gs(W),mt,yt,$t,Zt=tt({},W,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Za,button:0,buttons:0,relatedTarget:function(d){return d.relatedTarget===void 0?d.fromElement===d.srcElement?d.toElement:d.fromElement:d.relatedTarget},movementX:function(d){return"movementX"in d?d.movementX:(d!==$t&&($t&&d.type==="mousemove"?(mt=d.screenX-$t.screenX,yt=d.screenY-$t.screenY):yt=mt=0,$t=d),mt)},movementY:function(d){return"movementY"in d?d.movementY:yt}}),zn=Gs(Zt),Nr=tt({},Zt,{dataTransfer:0}),Hr=Gs(Nr),gi=tt({},W,{relatedTarget:0}),Ti=Gs(gi),bo=tt({},Hs,{animationName:0,elapsedTime:0,pseudoElement:0}),wo=Gs(bo),Qo=tt({},Hs,{clipboardData:function(d){return"clipboardData"in d?d.clipboardData:window.clipboardData}}),Mo=Gs(Qo),zo=tt({},Hs,{data:0}),es=Gs(zo),us={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},jo={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Es={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Fc(d){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(d):(d=Es[d])?!!g[d]:!1}function Za(){return Fc}var L=tt({},W,{key:function(d){if(d.key){var g=us[d.key]||d.key;if(g!=="Unidentified")return g}return d.type==="keypress"?(d=ia(d),d===13?"Enter":String.fromCharCode(d)):d.type==="keydown"||d.type==="keyup"?jo[d.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Za,charCode:function(d){return d.type==="keypress"?ia(d):0},keyCode:function(d){return d.type==="keydown"||d.type==="keyup"?d.keyCode:0},which:function(d){return d.type==="keypress"?ia(d):d.type==="keydown"||d.type==="keyup"?d.keyCode:0}}),ae=Gs(L),ve=tt({},Zt,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),He=Gs(ve),Kt=tt({},W,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Za}),pn=Gs(Kt),sr=tt({},Hs,{propertyName:0,elapsedTime:0,pseudoElement:0}),ho=Gs(sr),Fo=tt({},Zt,{deltaX:function(d){return"deltaX"in d?d.deltaX:"wheelDeltaX"in d?-d.wheelDeltaX:0},deltaY:function(d){return"deltaY"in d?d.deltaY:"wheelDeltaY"in d?-d.wheelDeltaY:"wheelDelta"in d?-d.wheelDelta:0},deltaZ:0,deltaMode:0}),Wi=Gs(Fo),Oi=[9,13,27,32],No=_&&"CompositionEvent"in window,sa=null;_&&"documentMode"in document&&(sa=document.documentMode);var Oo=_&&"TextEvent"in window&&!sa,$i=_&&(!No||sa&&8<sa&&11>=sa),jl=" ",aa=!1;function Ru(d,g){switch(d){case"keyup":return Oi.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function dl(d){return d=d.detail,typeof d=="object"&&"data"in d?d.data:null}var xc=!1;function ks(d,g){switch(d){case"compositionend":return dl(g);case"keypress":return g.which!==32?null:(aa=!0,jl);case"textInput":return d=g.data,d===jl&&aa?null:d;default:return null}}function ya(d,g){if(xc)return d==="compositionend"||!No&&Ru(d,g)?(d=$s(),Ss=Ai=qs=null,xc=!1,d):null;switch(d){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return $i&&g.locale!=="ko"?null:g.data;default:return null}}var gu={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ts(d){var g=d&&d.nodeName&&d.nodeName.toLowerCase();return g==="input"?!!gu[d.type]:g==="textarea"}function Ws(d,g,E,D){ht(D),g=Ts(g,"onChange"),0<g.length&&(E=new vc("onChange","change",null,E,D),d.push({event:E,listeners:g}))}var Fa=null,Ul=null;function vs(d){mr(d,0)}function Uo(d){var g=Ac(d);if(yn(g))return d}function Aa(d,g){if(d==="change")return g}var Ks=!1;if(_){var yu;if(_){var bc="oninput"in document;if(!bc){var eu=document.createElement("div");eu.setAttribute("oninput","return;"),bc=typeof eu.oninput=="function"}yu=bc}else yu=!1;Ks=yu&&(!document.documentMode||9<document.documentMode)}function Oa(){Fa&&(Fa.detachEvent("onpropertychange",sc),Ul=Fa=null)}function sc(d){if(d.propertyName==="value"&&Uo(Ul)){var g=[];Ws(g,Ul,d,si(d)),Pt(vs,g)}}function Sl(d,g,E){d==="focusin"?(Oa(),Fa=g,Ul=E,Fa.attachEvent("onpropertychange",sc)):d==="focusout"&&Oa()}function Vl(d){if(d==="selectionchange"||d==="keyup"||d==="keydown")return Uo(Ul)}function wc(d,g){if(d==="click")return Uo(g)}function El(d,g){if(d==="input"||d==="change")return Uo(g)}function Oc(d,g){return d===g&&(d!==0||1/d===1/g)||d!==d&&g!==g}var lo=typeof Object.is=="function"?Object.is:Oc;function Al(d,g){if(lo(d,g))return!0;if(typeof d!="object"||d===null||typeof g!="object"||g===null)return!1;var E=Object.keys(d),D=Object.keys(g);if(E.length!==D.length)return!1;for(D=0;D<E.length;D++){var K=E[D];if(!o.call(g,K)||!lo(d[K],g[K]))return!1}return!0}function Xo(d){for(;d&&d.firstChild;)d=d.firstChild;return d}function So(d,g){var E=Xo(d);d=0;for(var D;E;){if(E.nodeType===3){if(D=d+E.textContent.length,d<=g&&D>=g)return{node:E,offset:g-d};d=D}e:{for(;E;){if(E.nextSibling){E=E.nextSibling;break e}E=E.parentNode}E=void 0}E=Xo(E)}}function la(d,g){return d&&g?d===g?!0:d&&d.nodeType===3?!1:g&&g.nodeType===3?la(d,g.parentNode):"contains"in d?d.contains(g):d.compareDocumentPosition?!!(d.compareDocumentPosition(g)&16):!1:!1}function ca(){for(var d=window,g=Mn();g instanceof d.HTMLIFrameElement;){try{var E=typeof g.contentWindow.location.href=="string"}catch{E=!1}if(E)d=g.contentWindow;else break;g=Mn(d.document)}return g}function Bc(d){var g=d&&d.nodeName&&d.nodeName.toLowerCase();return g&&(g==="input"&&(d.type==="text"||d.type==="search"||d.type==="tel"||d.type==="url"||d.type==="password")||g==="textarea"||d.contentEditable==="true")}function kh(d){var g=ca(),E=d.focusedElem,D=d.selectionRange;if(g!==E&&E&&E.ownerDocument&&la(E.ownerDocument.documentElement,E)){if(D!==null&&Bc(E)){if(g=D.start,d=D.end,d===void 0&&(d=g),"selectionStart"in E)E.selectionStart=g,E.selectionEnd=Math.min(d,E.value.length);else if(d=(g=E.ownerDocument||document)&&g.defaultView||window,d.getSelection){d=d.getSelection();var K=E.textContent.length,ce=Math.min(D.start,K);D=D.end===void 0?ce:Math.min(D.end,K),!d.extend&&ce>D&&(K=D,D=ce,ce=K),K=So(E,ce);var je=So(E,D);K&&je&&(d.rangeCount!==1||d.anchorNode!==K.node||d.anchorOffset!==K.offset||d.focusNode!==je.node||d.focusOffset!==je.offset)&&(g=g.createRange(),g.setStart(K.node,K.offset),d.removeAllRanges(),ce>D?(d.addRange(g),d.extend(je.node,je.offset)):(g.setEnd(je.node,je.offset),d.addRange(g)))}}for(g=[],d=E;d=d.parentNode;)d.nodeType===1&&g.push({element:d,left:d.scrollLeft,top:d.scrollTop});for(typeof E.focus=="function"&&E.focus(),E=0;E<g.length;E++)d=g[E],d.element.scrollLeft=d.left,d.element.scrollTop=d.top}}var _u=_&&"documentMode"in document&&11>=document.documentMode,tu=null,Mu=null,nu=null,xh=!1;function Zh(d,g,E){var D=E.window===E?E.document:E.nodeType===9?E:E.ownerDocument;xh||tu==null||tu!==Mn(D)||(D=tu,"selectionStart"in D&&Bc(D)?D={start:D.selectionStart,end:D.selectionEnd}:(D=(D.ownerDocument&&D.ownerDocument.defaultView||window).getSelection(),D={anchorNode:D.anchorNode,anchorOffset:D.anchorOffset,focusNode:D.focusNode,focusOffset:D.focusOffset}),nu&&Al(nu,D)||(nu=D,D=Ts(Mu,"onSelect"),0<D.length&&(g=new vc("onSelect","select",null,g,E),d.push({event:g,listeners:D}),g.target=tu)))}function ql(d,g){var E={};return E[d.toLowerCase()]=g.toLowerCase(),E["Webkit"+d]="webkit"+g,E["Moz"+d]="moz"+g,E}var zc={animationend:ql("Animation","AnimationEnd"),animationiteration:ql("Animation","AnimationIteration"),animationstart:ql("Animation","AnimationStart"),transitionend:ql("Transition","TransitionEnd")},Xs={},vu={};_&&(vu=document.createElement("div").style,"AnimationEvent"in window||(delete zc.animationend.animation,delete zc.animationiteration.animation,delete zc.animationstart.animation),"TransitionEvent"in window||delete zc.transitionend.transition);function Sc(d){if(Xs[d])return Xs[d];if(!zc[d])return d;var g=zc[d],E;for(E in g)if(g.hasOwnProperty(E)&&E in vu)return Xs[d]=g[E];return d}var fl=Sc("animationend"),As=Sc("animationiteration"),Yu=Sc("animationstart"),$r=Sc("transitionend"),co=new Map,Nu="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ba(d,g){co.set(d,g),u(g,[d])}for(var Ya=0;Ya<Nu.length;Ya++){var Ta=Nu[Ya],Ja=Ta.toLowerCase(),Ec=Ta[0].toUpperCase()+Ta.slice(1);Ba(Ja,"on"+Ec)}Ba(fl,"onAnimationEnd"),Ba(As,"onAnimationIteration"),Ba(Yu,"onAnimationStart"),Ba("dblclick","onDoubleClick"),Ba("focusin","onFocus"),Ba("focusout","onBlur"),Ba($r,"onTransitionEnd"),m("onMouseEnter",["mouseout","mouseover"]),m("onMouseLeave",["mouseout","mouseover"]),m("onPointerEnter",["pointerout","pointerover"]),m("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ua="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),bh=new Set("cancel close invalid load scroll toggle".split(" ").concat(ua));function jc(d,g,E){var D=d.type||"unknown-event";d.currentTarget=E,Ho(D,g,void 0,d),d.currentTarget=null}function mr(d,g){g=(g&4)!==0;for(var E=0;E<d.length;E++){var D=d[E],K=D.event;D=D.listeners;e:{var ce=void 0;if(g)for(var je=D.length-1;0<=je;je--){var Et=D[je],Ft=Et.instance,_n=Et.currentTarget;if(Et=Et.listener,Ft!==ce&&K.isPropagationStopped())break e;jc(K,Et,_n),ce=Ft}else for(je=0;je<D.length;je++){if(Et=D[je],Ft=Et.instance,_n=Et.currentTarget,Et=Et.listener,Ft!==ce&&K.isPropagationStopped())break e;jc(K,Et,_n),ce=Ft}}}if(Er)throw d=Ei,Er=!1,Ei=null,d}function eo(d,g){var E=g[Il];E===void 0&&(E=g[Il]=new Set);var D=d+"__bubble";E.has(D)||(iu(g,d,2,!1),E.add(D))}function pl(d,g,E){var D=0;g&&(D|=4),iu(E,d,D,g)}var ru="_reactListening"+Math.random().toString(36).slice(2);function ac(d){if(!d[ru]){d[ru]=!0,i.forEach(function(E){E!=="selectionchange"&&(bh.has(E)||pl(E,!1,d),pl(E,!0,d))});var g=d.nodeType===9?d:d.ownerDocument;g===null||g[ru]||(g[ru]=!0,pl("selectionchange",!1,g))}}function iu(d,g,E,D){switch(_c(g)){case 1:var K=Ko;break;case 4:K=ga;break;default:K=Xa}E=K.bind(null,g,E,d),K=void 0,!Un||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(K=!0),D?K!==void 0?d.addEventListener(g,E,{capture:!0,passive:K}):d.addEventListener(g,E,!0):K!==void 0?d.addEventListener(g,E,{passive:K}):d.addEventListener(g,E,!1)}function ou(d,g,E,D,K){var ce=D;if((g&1)===0&&(g&2)===0&&D!==null)e:for(;;){if(D===null)return;var je=D.tag;if(je===3||je===4){var Et=D.stateNode.containerInfo;if(Et===K||Et.nodeType===8&&Et.parentNode===K)break;if(je===4)for(je=D.return;je!==null;){var Ft=je.tag;if((Ft===3||Ft===4)&&(Ft=je.stateNode.containerInfo,Ft===K||Ft.nodeType===8&&Ft.parentNode===K))return;je=je.return}for(;Et!==null;){if(je=el(Et),je===null)return;if(Ft=je.tag,Ft===5||Ft===6){D=ce=je;continue e}Et=Et.parentNode}}D=D.return}Pt(function(){var _n=ce,tr=si(E),ar=[];e:{var Kn=co.get(d);if(Kn!==void 0){var Wr=vc,ii=d;switch(d){case"keypress":if(ia(E)===0)break e;case"keydown":case"keyup":Wr=ae;break;case"focusin":ii="focus",Wr=Ti;break;case"focusout":ii="blur",Wr=Ti;break;case"beforeblur":case"afterblur":Wr=Ti;break;case"click":if(E.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Wr=zn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Wr=Hr;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Wr=pn;break;case fl:case As:case Yu:Wr=wo;break;case $r:Wr=ho;break;case"scroll":Wr=Ce;break;case"wheel":Wr=Wi;break;case"copy":case"cut":case"paste":Wr=Mo;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Wr=He}var di=(g&4)!==0,Dl=!di&&d==="scroll",an=di?Kn!==null?Kn+"Capture":null:Kn;di=[];for(var Ht=_n,gn;Ht!==null;){gn=Ht;var gr=gn.stateNode;if(gn.tag===5&&gr!==null&&(gn=gr,an!==null&&(gr=xn(Ht,an),gr!=null&&di.push(An(Ht,gr,gn)))),Dl)break;Ht=Ht.return}0<di.length&&(Kn=new Wr(Kn,ii,null,E,tr),ar.push({event:Kn,listeners:di}))}}if((g&7)===0){e:{if(Kn=d==="mouseover"||d==="pointerover",Wr=d==="mouseout"||d==="pointerout",Kn&&E!==hi&&(ii=E.relatedTarget||E.fromElement)&&(el(ii)||ii[to]))break e;if((Wr||Kn)&&(Kn=tr.window===tr?tr:(Kn=tr.ownerDocument)?Kn.defaultView||Kn.parentWindow:window,Wr?(ii=E.relatedTarget||E.toElement,Wr=_n,ii=ii?el(ii):null,ii!==null&&(Dl=so(ii),ii!==Dl||ii.tag!==5&&ii.tag!==6)&&(ii=null)):(Wr=null,ii=_n),Wr!==ii)){if(di=zn,gr="onMouseLeave",an="onMouseEnter",Ht="mouse",(d==="pointerout"||d==="pointerover")&&(di=He,gr="onPointerLeave",an="onPointerEnter",Ht="pointer"),Dl=Wr==null?Kn:Ac(Wr),gn=ii==null?Kn:Ac(ii),Kn=new di(gr,Ht+"leave",Wr,E,tr),Kn.target=Dl,Kn.relatedTarget=gn,gr=null,el(tr)===_n&&(di=new di(an,Ht+"enter",ii,E,tr),di.target=gn,di.relatedTarget=Dl,gr=di),Dl=gr,Wr&&ii)t:{for(di=Wr,an=ii,Ht=0,gn=di;gn;gn=Vo(gn))Ht++;for(gn=0,gr=an;gr;gr=Vo(gr))gn++;for(;0<Ht-gn;)di=Vo(di),Ht--;for(;0<gn-Ht;)an=Vo(an),gn--;for(;Ht--;){if(di===an||an!==null&&di===an.alternate)break t;di=Vo(di),an=Vo(an)}di=null}else di=null;Wr!==null&&Tl(ar,Kn,Wr,di,!1),ii!==null&&Dl!==null&&Tl(ar,Dl,ii,di,!0)}}e:{if(Kn=_n?Ac(_n):window,Wr=Kn.nodeName&&Kn.nodeName.toLowerCase(),Wr==="select"||Wr==="input"&&Kn.type==="file")var fi=Aa;else if(ts(Kn))if(Ks)fi=El;else{fi=Vl;var Di=Sl}else(Wr=Kn.nodeName)&&Wr.toLowerCase()==="input"&&(Kn.type==="checkbox"||Kn.type==="radio")&&(fi=wc);if(fi&&(fi=fi(d,_n))){Ws(ar,fi,E,tr);break e}Di&&Di(d,Kn,_n),d==="focusout"&&(Di=Kn._wrapperState)&&Di.controlled&&Kn.type==="number"&&Ln(Kn,"number",Kn.value)}switch(Di=_n?Ac(_n):window,d){case"focusin":(ts(Di)||Di.contentEditable==="true")&&(tu=Di,Mu=_n,nu=null);break;case"focusout":nu=Mu=tu=null;break;case"mousedown":xh=!0;break;case"contextmenu":case"mouseup":case"dragend":xh=!1,Zh(ar,E,tr);break;case"selectionchange":if(_u)break;case"keydown":case"keyup":Zh(ar,E,tr)}var Fi;if(No)e:{switch(d){case"compositionstart":var io="onCompositionStart";break e;case"compositionend":io="onCompositionEnd";break e;case"compositionupdate":io="onCompositionUpdate";break e}io=void 0}else xc?Ru(d,E)&&(io="onCompositionEnd"):d==="keydown"&&E.keyCode===229&&(io="onCompositionStart");io&&($i&&E.locale!=="ko"&&(xc||io!=="onCompositionStart"?io==="onCompositionEnd"&&xc&&(Fi=$s()):(qs=tr,Ai="value"in qs?qs.value:qs.textContent,xc=!0)),Di=Ts(_n,io),0<Di.length&&(io=new es(io,d,null,E,tr),ar.push({event:io,listeners:Di}),Fi?io.data=Fi:(Fi=dl(E),Fi!==null&&(io.data=Fi)))),(Fi=Oo?ks(d,E):ya(d,E))&&(_n=Ts(_n,"onBeforeInput"),0<_n.length&&(tr=new es("onBeforeInput","beforeinput",null,E,tr),ar.push({event:tr,listeners:_n}),tr.data=Fi))}mr(ar,g)})}function An(d,g,E){return{instance:d,listener:g,currentTarget:E}}function Ts(d,g){for(var E=g+"Capture",D=[];d!==null;){var K=d,ce=K.stateNode;K.tag===5&&ce!==null&&(K=ce,ce=xn(d,E),ce!=null&&D.unshift(An(d,ce,K)),ce=xn(d,g),ce!=null&&D.push(An(d,ce,K))),d=d.return}return D}function Vo(d){if(d===null)return null;do d=d.return;while(d&&d.tag!==5);return d||null}function Tl(d,g,E,D,K){for(var ce=g._reactName,je=[];E!==null&&E!==D;){var Et=E,Ft=Et.alternate,_n=Et.stateNode;if(Ft!==null&&Ft===D)break;Et.tag===5&&_n!==null&&(Et=_n,K?(Ft=xn(E,ce),Ft!=null&&je.unshift(An(E,Ft,Et))):K||(Ft=xn(E,ce),Ft!=null&&je.push(An(E,Ft,Et)))),E=E.return}je.length!==0&&d.push({event:g,listeners:je})}var _a=/\r\n?/g,Ri=/\u0000|\uFFFD/g;function ha(d){return(typeof d=="string"?d:""+d).replace(_a,`
`).replace(Ri,"")}function Rh(d,g,E){if(g=ha(g),ha(d)!==g&&E)throw Error(t(425))}function wh(){}var Qr=null,xu=null;function Mh(d,g){return d==="textarea"||d==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var Zs=typeof setTimeout=="function"?setTimeout:void 0,Qa=typeof clearTimeout=="function"?clearTimeout:void 0,Nh=typeof Promise=="function"?Promise:void 0,Uc=typeof queueMicrotask=="function"?queueMicrotask:typeof Nh<"u"?function(d){return Nh.resolve(null).then(d).catch(Du)}:Zs;function Du(d){setTimeout(function(){throw d})}function gd(d,g){var E=g,D=0;do{var K=E.nextSibling;if(d.removeChild(E),K&&K.nodeType===8)if(E=K.data,E==="/$"){if(D===0){d.removeChild(K),Vs(g);return}D--}else E!=="$"&&E!=="$?"&&E!=="$!"||D++;E=K}while(E);Vs(g)}function za(d){for(;d!=null;d=d.nextSibling){var g=d.nodeType;if(g===1||g===3)break;if(g===8){if(g=d.data,g==="$"||g==="$!"||g==="$?")break;if(g==="/$")return null}}return d}function Ui(d){d=d.previousSibling;for(var g=0;d;){if(d.nodeType===8){var E=d.data;if(E==="$"||E==="$!"||E==="$?"){if(g===0)return d;g--}else E==="/$"&&g++}d=d.previousSibling}return null}var da=Math.random().toString(36).slice(2),ja="__reactFiber$"+da,su="__reactProps$"+da,to="__reactContainer$"+da,Il="__reactEvents$"+da,Dh="__reactListeners$"+da,df="__reactHandles$"+da;function el(d){var g=d[ja];if(g)return g;for(var E=d.parentNode;E;){if(g=E[to]||E[ja]){if(E=g.alternate,g.child!==null||E!==null&&E.child!==null)for(d=Ui(d);d!==null;){if(E=d[ja])return E;d=Ui(d)}return g}d=E,E=d.parentNode}return null}function Ia(d){return d=d[ja]||d[to],!d||d.tag!==5&&d.tag!==6&&d.tag!==13&&d.tag!==3?null:d}function Ac(d){if(d.tag===5||d.tag===6)return d.stateNode;throw Error(t(33))}function Yh(d){return d[su]||null}var Sh=[],Ua=-1;function lc(d){return{current:d}}function qo(d){0>Ua||(d.current=Sh[Ua],Sh[Ua]=null,Ua--)}function Gi(d,g){Ua++,Sh[Ua]=d.current,d.current=g}var cc={},tl=lc(cc),$l=lc(!1),Ju=cc;function Ca(d,g){var E=d.type.contextTypes;if(!E)return cc;var D=d.stateNode;if(D&&D.__reactInternalMemoizedUnmaskedChildContext===g)return D.__reactInternalMemoizedMaskedChildContext;var K={},ce;for(ce in E)K[ce]=g[ce];return D&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=g,d.__reactInternalMemoizedMaskedChildContext=K),K}function La(d){return d=d.childContextTypes,d!=null}function Jh(){qo($l),qo(tl)}function uc(d,g,E){if(tl.current!==cc)throw Error(t(168));Gi(tl,g),Gi($l,E)}function Gl(d,g,E){var D=d.stateNode;if(g=g.childContextTypes,typeof D.getChildContext!="function")return E;D=D.getChildContext();for(var K in D)if(!(K in g))throw Error(t(108,gt(d)||"Unknown",K));return tt({},E,D)}function Cl(d){return d=(d=d.stateNode)&&d.__reactInternalMemoizedMergedChildContext||cc,Ju=tl.current,Gi(tl,d),Gi($l,$l.current),!0}function Qu(d,g,E){var D=d.stateNode;if(!D)throw Error(t(169));E?(d=Gl(d,g,Ju),D.__reactInternalMemoizedMergedChildContext=d,qo($l),qo(tl),Gi(tl,d)):qo($l),Gi($l,E)}var ur=null,eh=!1,C=!1;function B(d){ur===null?ur=[d]:ur.push(d)}function ee(d){eh=!0,B(d)}function oe(){if(!C&&ur!==null){C=!0;var d=0,g=qi;try{var E=ur;for(qi=1;d<E.length;d++){var D=E[d];do D=D(!0);while(D!==null)}ur=null,eh=!1}catch(K){throw ur!==null&&(ur=ur.slice(d+1)),ll(wa,oe),K}finally{qi=g,C=!1}}return null}var Pe=[],Ve=0,We=null,Je=0,nt=[],ut=0,Nt=null,Yt=1,dt="";function jt(d,g){Pe[Ve++]=Je,Pe[Ve++]=We,We=d,Je=g}function Qt(d,g,E){nt[ut++]=Yt,nt[ut++]=dt,nt[ut++]=Nt,Nt=d;var D=Yt;d=dt;var K=32-Yo(D)-1;D&=~(1<<K),E+=1;var ce=32-Yo(g)+K;if(30<ce){var je=K-K%5;ce=(D&(1<<je)-1).toString(32),D>>=je,K-=je,Yt=1<<32-Yo(g)+K|E<<K|D,dt=ce+d}else Yt=1<<ce|E<<K|D,dt=d}function En(d){d.return!==null&&(jt(d,1),Qt(d,1,0))}function y(d){for(;d===We;)We=Pe[--Ve],Pe[Ve]=null,Je=Pe[--Ve],Pe[Ve]=null;for(;d===Nt;)Nt=nt[--ut],nt[ut]=null,dt=nt[--ut],nt[ut]=null,Yt=nt[--ut],nt[ut]=null}var a=null,f=null,v=!1,S=null;function T(d,g){var E=$c(5,null,null,0);E.elementType="DELETED",E.stateNode=g,E.return=d,g=d.deletions,g===null?(d.deletions=[E],d.flags|=16):g.push(E)}function N(d,g){switch(d.tag){case 5:var E=d.type;return g=g.nodeType!==1||E.toLowerCase()!==g.nodeName.toLowerCase()?null:g,g!==null?(d.stateNode=g,a=d,f=za(g.firstChild),!0):!1;case 6:return g=d.pendingProps===""||g.nodeType!==3?null:g,g!==null?(d.stateNode=g,a=d,f=null,!0):!1;case 13:return g=g.nodeType!==8?null:g,g!==null?(E=Nt!==null?{id:Yt,overflow:dt}:null,d.memoizedState={dehydrated:g,treeContext:E,retryLane:1073741824},E=$c(18,null,null,0),E.stateNode=g,E.return=d,d.child=E,a=d,f=null,!0):!1;default:return!1}}function z(d){return(d.mode&1)!==0&&(d.flags&128)===0}function G(d){if(v){var g=f;if(g){var E=g;if(!N(d,g)){if(z(d))throw Error(t(418));g=za(E.nextSibling);var D=a;g&&N(d,g)?T(D,E):(d.flags=d.flags&-4097|2,v=!1,a=d)}}else{if(z(d))throw Error(t(418));d.flags=d.flags&-4097|2,v=!1,a=d}}}function Q(d){for(d=d.return;d!==null&&d.tag!==5&&d.tag!==3&&d.tag!==13;)d=d.return;a=d}function te(d){if(d!==a)return!1;if(!v)return Q(d),v=!0,!1;var g;if((g=d.tag!==3)&&!(g=d.tag!==5)&&(g=d.type,g=g!=="head"&&g!=="body"&&!Mh(d.type,d.memoizedProps)),g&&(g=f)){if(z(d))throw ge(),Error(t(418));for(;g;)T(d,g),g=za(g.nextSibling)}if(Q(d),d.tag===13){if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(t(317));e:{for(d=d.nextSibling,g=0;d;){if(d.nodeType===8){var E=d.data;if(E==="/$"){if(g===0){f=za(d.nextSibling);break e}g--}else E!=="$"&&E!=="$!"&&E!=="$?"||g++}d=d.nextSibling}f=null}}else f=a?za(d.stateNode.nextSibling):null;return!0}function ge(){for(var d=f;d;)d=za(d.nextSibling)}function Ae(){f=a=null,v=!1}function Le(d){S===null?S=[d]:S.push(d)}var Xe=ue.ReactCurrentBatchConfig;function Ue(d,g,E){if(d=E.ref,d!==null&&typeof d!="function"&&typeof d!="object"){if(E._owner){if(E=E._owner,E){if(E.tag!==1)throw Error(t(309));var D=E.stateNode}if(!D)throw Error(t(147,d));var K=D,ce=""+d;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===ce?g.ref:(g=function(je){var Et=K.refs;je===null?delete Et[ce]:Et[ce]=je},g._stringRef=ce,g)}if(typeof d!="string")throw Error(t(284));if(!E._owner)throw Error(t(290,d))}return d}function Ze(d,g){throw d=Object.prototype.toString.call(g),Error(t(31,d==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":d))}function _e(d){var g=d._init;return g(d._payload)}function $e(d){function g(an,Ht){if(d){var gn=an.deletions;gn===null?(an.deletions=[Ht],an.flags|=16):gn.push(Ht)}}function E(an,Ht){if(!d)return null;for(;Ht!==null;)g(an,Ht),Ht=Ht.sibling;return null}function D(an,Ht){for(an=new Map;Ht!==null;)Ht.key!==null?an.set(Ht.key,Ht):an.set(Ht.index,Ht),Ht=Ht.sibling;return an}function K(an,Ht){return an=wf(an,Ht),an.index=0,an.sibling=null,an}function ce(an,Ht,gn){return an.index=gn,d?(gn=an.alternate,gn!==null?(gn=gn.index,gn<Ht?(an.flags|=2,Ht):gn):(an.flags|=2,Ht)):(an.flags|=1048576,Ht)}function je(an){return d&&an.alternate===null&&(an.flags|=2),an}function Et(an,Ht,gn,gr){return Ht===null||Ht.tag!==6?(Ht=Q0(gn,an.mode,gr),Ht.return=an,Ht):(Ht=K(Ht,gn),Ht.return=an,Ht)}function Ft(an,Ht,gn,gr){var fi=gn.type;return fi===pe?tr(an,Ht,gn.props.children,gr,gn.key):Ht!==null&&(Ht.elementType===fi||typeof fi=="object"&&fi!==null&&fi.$$typeof===Oe&&_e(fi)===Ht.type)?(gr=K(Ht,gn.props),gr.ref=Ue(an,Ht,gn),gr.return=an,gr):(gr=Lg(gn.type,gn.key,gn.props,null,an.mode,gr),gr.ref=Ue(an,Ht,gn),gr.return=an,gr)}function _n(an,Ht,gn,gr){return Ht===null||Ht.tag!==4||Ht.stateNode.containerInfo!==gn.containerInfo||Ht.stateNode.implementation!==gn.implementation?(Ht=ey(gn,an.mode,gr),Ht.return=an,Ht):(Ht=K(Ht,gn.children||[]),Ht.return=an,Ht)}function tr(an,Ht,gn,gr,fi){return Ht===null||Ht.tag!==7?(Ht=sp(gn,an.mode,gr,fi),Ht.return=an,Ht):(Ht=K(Ht,gn),Ht.return=an,Ht)}function ar(an,Ht,gn){if(typeof Ht=="string"&&Ht!==""||typeof Ht=="number")return Ht=Q0(""+Ht,an.mode,gn),Ht.return=an,Ht;if(typeof Ht=="object"&&Ht!==null){switch(Ht.$$typeof){case ke:return gn=Lg(Ht.type,Ht.key,Ht.props,null,an.mode,gn),gn.ref=Ue(an,null,Ht),gn.return=an,gn;case ze:return Ht=ey(Ht,an.mode,gn),Ht.return=an,Ht;case Oe:var gr=Ht._init;return ar(an,gr(Ht._payload),gn)}if(ir(Ht)||De(Ht))return Ht=sp(Ht,an.mode,gn,null),Ht.return=an,Ht;Ze(an,Ht)}return null}function Kn(an,Ht,gn,gr){var fi=Ht!==null?Ht.key:null;if(typeof gn=="string"&&gn!==""||typeof gn=="number")return fi!==null?null:Et(an,Ht,""+gn,gr);if(typeof gn=="object"&&gn!==null){switch(gn.$$typeof){case ke:return gn.key===fi?Ft(an,Ht,gn,gr):null;case ze:return gn.key===fi?_n(an,Ht,gn,gr):null;case Oe:return fi=gn._init,Kn(an,Ht,fi(gn._payload),gr)}if(ir(gn)||De(gn))return fi!==null?null:tr(an,Ht,gn,gr,null);Ze(an,gn)}return null}function Wr(an,Ht,gn,gr,fi){if(typeof gr=="string"&&gr!==""||typeof gr=="number")return an=an.get(gn)||null,Et(Ht,an,""+gr,fi);if(typeof gr=="object"&&gr!==null){switch(gr.$$typeof){case ke:return an=an.get(gr.key===null?gn:gr.key)||null,Ft(Ht,an,gr,fi);case ze:return an=an.get(gr.key===null?gn:gr.key)||null,_n(Ht,an,gr,fi);case Oe:var Di=gr._init;return Wr(an,Ht,gn,Di(gr._payload),fi)}if(ir(gr)||De(gr))return an=an.get(gn)||null,tr(Ht,an,gr,fi,null);Ze(Ht,gr)}return null}function ii(an,Ht,gn,gr){for(var fi=null,Di=null,Fi=Ht,io=Ht=0,Gc=null;Fi!==null&&io<gn.length;io++){Fi.index>io?(Gc=Fi,Fi=null):Gc=Fi.sibling;var rs=Kn(an,Fi,gn[io],gr);if(rs===null){Fi===null&&(Fi=Gc);break}d&&Fi&&rs.alternate===null&&g(an,Fi),Ht=ce(rs,Ht,io),Di===null?fi=rs:Di.sibling=rs,Di=rs,Fi=Gc}if(io===gn.length)return E(an,Fi),v&&jt(an,io),fi;if(Fi===null){for(;io<gn.length;io++)Fi=ar(an,gn[io],gr),Fi!==null&&(Ht=ce(Fi,Ht,io),Di===null?fi=Fi:Di.sibling=Fi,Di=Fi);return v&&jt(an,io),fi}for(Fi=D(an,Fi);io<gn.length;io++)Gc=Wr(Fi,an,io,gn[io],gr),Gc!==null&&(d&&Gc.alternate!==null&&Fi.delete(Gc.key===null?io:Gc.key),Ht=ce(Gc,Ht,io),Di===null?fi=Gc:Di.sibling=Gc,Di=Gc);return d&&Fi.forEach(function(Uh){return g(an,Uh)}),v&&jt(an,io),fi}function di(an,Ht,gn,gr){var fi=De(gn);if(typeof fi!="function")throw Error(t(150));if(gn=fi.call(gn),gn==null)throw Error(t(151));for(var Di=fi=null,Fi=Ht,io=Ht=0,Gc=null,rs=gn.next();Fi!==null&&!rs.done;io++,rs=gn.next()){Fi.index>io?(Gc=Fi,Fi=null):Gc=Fi.sibling;var Uh=Kn(an,Fi,rs.value,gr);if(Uh===null){Fi===null&&(Fi=Gc);break}d&&Fi&&Uh.alternate===null&&g(an,Fi),Ht=ce(Uh,Ht,io),Di===null?fi=Uh:Di.sibling=Uh,Di=Uh,Fi=Gc}if(rs.done)return E(an,Fi),v&&jt(an,io),fi;if(Fi===null){for(;!rs.done;io++,rs=gn.next())rs=ar(an,rs.value,gr),rs!==null&&(Ht=ce(rs,Ht,io),Di===null?fi=rs:Di.sibling=rs,Di=rs);return v&&jt(an,io),fi}for(Fi=D(an,Fi);!rs.done;io++,rs=gn.next())rs=Wr(Fi,an,io,rs.value,gr),rs!==null&&(d&&rs.alternate!==null&&Fi.delete(rs.key===null?io:rs.key),Ht=ce(rs,Ht,io),Di===null?fi=rs:Di.sibling=rs,Di=rs);return d&&Fi.forEach(function($_){return g(an,$_)}),v&&jt(an,io),fi}function Dl(an,Ht,gn,gr){if(typeof gn=="object"&&gn!==null&&gn.type===pe&&gn.key===null&&(gn=gn.props.children),typeof gn=="object"&&gn!==null){switch(gn.$$typeof){case ke:e:{for(var fi=gn.key,Di=Ht;Di!==null;){if(Di.key===fi){if(fi=gn.type,fi===pe){if(Di.tag===7){E(an,Di.sibling),Ht=K(Di,gn.props.children),Ht.return=an,an=Ht;break e}}else if(Di.elementType===fi||typeof fi=="object"&&fi!==null&&fi.$$typeof===Oe&&_e(fi)===Di.type){E(an,Di.sibling),Ht=K(Di,gn.props),Ht.ref=Ue(an,Di,gn),Ht.return=an,an=Ht;break e}E(an,Di);break}else g(an,Di);Di=Di.sibling}gn.type===pe?(Ht=sp(gn.props.children,an.mode,gr,gn.key),Ht.return=an,an=Ht):(gr=Lg(gn.type,gn.key,gn.props,null,an.mode,gr),gr.ref=Ue(an,Ht,gn),gr.return=an,an=gr)}return je(an);case ze:e:{for(Di=gn.key;Ht!==null;){if(Ht.key===Di)if(Ht.tag===4&&Ht.stateNode.containerInfo===gn.containerInfo&&Ht.stateNode.implementation===gn.implementation){E(an,Ht.sibling),Ht=K(Ht,gn.children||[]),Ht.return=an,an=Ht;break e}else{E(an,Ht);break}else g(an,Ht);Ht=Ht.sibling}Ht=ey(gn,an.mode,gr),Ht.return=an,an=Ht}return je(an);case Oe:return Di=gn._init,Dl(an,Ht,Di(gn._payload),gr)}if(ir(gn))return ii(an,Ht,gn,gr);if(De(gn))return di(an,Ht,gn,gr);Ze(an,gn)}return typeof gn=="string"&&gn!==""||typeof gn=="number"?(gn=""+gn,Ht!==null&&Ht.tag===6?(E(an,Ht.sibling),Ht=K(Ht,gn),Ht.return=an,an=Ht):(E(an,Ht),Ht=Q0(gn,an.mode,gr),Ht.return=an,an=Ht),je(an)):E(an,Ht)}return Dl}var it=$e(!0),st=$e(!1),bt=lc(null),wt=null,vt=null,kt=null;function Tt(){kt=vt=wt=null}function Vt(d){var g=bt.current;qo(bt),d._currentValue=g}function vn(d,g,E){for(;d!==null;){var D=d.alternate;if((d.childLanes&g)!==g?(d.childLanes|=g,D!==null&&(D.childLanes|=g)):D!==null&&(D.childLanes&g)!==g&&(D.childLanes|=g),d===E)break;d=d.return}}function Bt(d,g){wt=d,kt=vt=null,d=d.dependencies,d!==null&&d.firstContext!==null&&((d.lanes&g)!==0&&(Fe=!0),d.firstContext=null)}function ln(d){var g=d._currentValue;if(kt!==d)if(d={context:d,memoizedValue:g,next:null},vt===null){if(wt===null)throw Error(t(308));vt=d,wt.dependencies={lanes:0,firstContext:d}}else vt=vt.next=d;return g}var Wt=null;function Cn(d){Wt===null?Wt=[d]:Wt.push(d)}function Ut(d,g,E,D){var K=g.interleaved;return K===null?(E.next=E,Cn(g)):(E.next=K.next,K.next=E),g.interleaved=E,rn(d,D)}function rn(d,g){d.lanes|=g;var E=d.alternate;for(E!==null&&(E.lanes|=g),E=d,d=d.return;d!==null;)d.childLanes|=g,E=d.alternate,E!==null&&(E.childLanes|=g),E=d,d=d.return;return E.tag===3?E.stateNode:null}var Tn=!1;function cn(d){d.updateQueue={baseState:d.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Nn(d,g){d=d.updateQueue,g.updateQueue===d&&(g.updateQueue={baseState:d.baseState,firstBaseUpdate:d.firstBaseUpdate,lastBaseUpdate:d.lastBaseUpdate,shared:d.shared,effects:d.effects})}function hr(d,g){return{eventTime:d,lane:g,tag:0,payload:null,callback:null,next:null}}function Dr(d,g,E){var D=d.updateQueue;if(D===null)return null;if(D=D.shared,(Jr&2)!==0){var K=D.pending;return K===null?g.next=g:(g.next=K.next,K.next=g),D.pending=g,rn(d,E)}return K=D.interleaved,K===null?(g.next=g,Cn(D)):(g.next=K.next,K.next=g),D.interleaved=g,rn(d,E)}function rr(d,g,E){if(g=g.updateQueue,g!==null&&(g=g.shared,(E&4194240)!==0)){var D=g.lanes;D&=d.pendingLanes,E|=D,g.lanes=E,wl(d,E)}}function Jn(d,g){var E=d.updateQueue,D=d.alternate;if(D!==null&&(D=D.updateQueue,E===D)){var K=null,ce=null;if(E=E.firstBaseUpdate,E!==null){do{var je={eventTime:E.eventTime,lane:E.lane,tag:E.tag,payload:E.payload,callback:E.callback,next:null};ce===null?K=ce=je:ce=ce.next=je,E=E.next}while(E!==null);ce===null?K=ce=g:ce=ce.next=g}else K=ce=g;E={baseState:D.baseState,firstBaseUpdate:K,lastBaseUpdate:ce,shared:D.shared,effects:D.effects},d.updateQueue=E;return}d=E.lastBaseUpdate,d===null?E.firstBaseUpdate=g:d.next=g,E.lastBaseUpdate=g}function ni(d,g,E,D){var K=d.updateQueue;Tn=!1;var ce=K.firstBaseUpdate,je=K.lastBaseUpdate,Et=K.shared.pending;if(Et!==null){K.shared.pending=null;var Ft=Et,_n=Ft.next;Ft.next=null,je===null?ce=_n:je.next=_n,je=Ft;var tr=d.alternate;tr!==null&&(tr=tr.updateQueue,Et=tr.lastBaseUpdate,Et!==je&&(Et===null?tr.firstBaseUpdate=_n:Et.next=_n,tr.lastBaseUpdate=Ft))}if(ce!==null){var ar=K.baseState;je=0,tr=_n=Ft=null,Et=ce;do{var Kn=Et.lane,Wr=Et.eventTime;if((D&Kn)===Kn){tr!==null&&(tr=tr.next={eventTime:Wr,lane:0,tag:Et.tag,payload:Et.payload,callback:Et.callback,next:null});e:{var ii=d,di=Et;switch(Kn=g,Wr=E,di.tag){case 1:if(ii=di.payload,typeof ii=="function"){ar=ii.call(Wr,ar,Kn);break e}ar=ii;break e;case 3:ii.flags=ii.flags&-65537|128;case 0:if(ii=di.payload,Kn=typeof ii=="function"?ii.call(Wr,ar,Kn):ii,Kn==null)break e;ar=tt({},ar,Kn);break e;case 2:Tn=!0}}Et.callback!==null&&Et.lane!==0&&(d.flags|=64,Kn=K.effects,Kn===null?K.effects=[Et]:Kn.push(Et))}else Wr={eventTime:Wr,lane:Kn,tag:Et.tag,payload:Et.payload,callback:Et.callback,next:null},tr===null?(_n=tr=Wr,Ft=ar):tr=tr.next=Wr,je|=Kn;if(Et=Et.next,Et===null){if(Et=K.shared.pending,Et===null)break;Kn=Et,Et=Kn.next,Kn.next=null,K.lastBaseUpdate=Kn,K.shared.pending=null}}while(!0);if(tr===null&&(Ft=ar),K.baseState=Ft,K.firstBaseUpdate=_n,K.lastBaseUpdate=tr,g=K.shared.interleaved,g!==null){K=g;do je|=K.lane,K=K.next;while(K!==g)}else ce===null&&(K.shared.lanes=0);ka|=je,d.lanes=je,d.memoizedState=ar}}function mi(d,g,E){if(d=g.effects,g.effects=null,d!==null)for(g=0;g<d.length;g++){var D=d[g],K=D.callback;if(K!==null){if(D.callback=null,D=E,typeof K!="function")throw Error(t(191,K));K.call(D)}}}var xr={},Ii=lc(xr),Ci=lc(xr),Ni=lc(xr);function fo(d){if(d===xr)throw Error(t(174));return d}function Rs(d,g){switch(Gi(Ni,g),Gi(Ci,d),Gi(Ii,xr),d=g.nodeType,d){case 9:case 11:g=(g=g.documentElement)?g.namespaceURI:Rr(null,"");break;default:d=d===8?g.parentNode:g,g=d.namespaceURI||null,d=d.tagName,g=Rr(g,d)}qo(Ii),Gi(Ii,g)}function hs(){qo(Ii),qo(Ci),qo(Ni)}function hc(d){fo(Ni.current);var g=fo(Ii.current),E=Rr(g,d.type);g!==E&&(Gi(Ci,d),Gi(Ii,E))}function Tc(d){Ci.current===d&&(qo(Ii),qo(Ci))}var Li=lc(0);function no(d){for(var g=d;g!==null;){if(g.tag===13){var E=g.memoizedState;if(E!==null&&(E=E.dehydrated,E===null||E.data==="$?"||E.data==="$!"))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===d)break;for(;g.sibling===null;){if(g.return===null||g.return===d)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var po=[];function Ms(){for(var d=0;d<po.length;d++)po[d]._workInProgressVersionPrimary=null;po.length=0}var nl=ue.ReactCurrentDispatcher,$o=ue.ReactCurrentBatchConfig,Ns=0,ps=null,ns=null,xs=null,dc=!1,Ds=!1,Ic=0,yd=0;function Ys(){throw Error(t(321))}function Fh(d,g){if(g===null)return!1;for(var E=0;E<g.length&&E<d.length;E++)if(!lo(d[E],g[E]))return!1;return!0}function _d(d,g,E,D,K,ce){if(Ns=ce,ps=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,nl.current=d===null||d.memoizedState===null?Sm:Bd,d=E(D,K),Ds){ce=0;do{if(Ds=!1,Ic=0,25<=ce)throw Error(t(301));ce+=1,xs=ns=null,g.updateQueue=null,nl.current=Bu,d=E(D,K)}while(Ds)}if(nl.current=Pc,g=ns!==null&&ns.next!==null,Ns=0,xs=ns=ps=null,dc=!1,g)throw Error(t(300));return d}function Fu(){var d=Ic!==0;return Ic=0,d}function Ou(){var d={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return xs===null?ps.memoizedState=xs=d:xs=xs.next=d,xs}function Cc(){if(ns===null){var d=ps.alternate;d=d!==null?d.memoizedState:null}else d=ns.next;var g=xs===null?ps.memoizedState:xs.next;if(g!==null)xs=g,ns=d;else{if(d===null)throw Error(t(310));ns=d,d={memoizedState:ns.memoizedState,baseState:ns.baseState,baseQueue:ns.baseQueue,queue:ns.queue,next:null},xs===null?ps.memoizedState=xs=d:xs=xs.next=d}return xs}function th(d,g){return typeof g=="function"?g(d):g}function vd(d){var g=Cc(),E=g.queue;if(E===null)throw Error(t(311));E.lastRenderedReducer=d;var D=ns,K=D.baseQueue,ce=E.pending;if(ce!==null){if(K!==null){var je=K.next;K.next=ce.next,ce.next=je}D.baseQueue=K=ce,E.pending=null}if(K!==null){ce=K.next,D=D.baseState;var Et=je=null,Ft=null,_n=ce;do{var tr=_n.lane;if((Ns&tr)===tr)Ft!==null&&(Ft=Ft.next={lane:0,action:_n.action,hasEagerState:_n.hasEagerState,eagerState:_n.eagerState,next:null}),D=_n.hasEagerState?_n.eagerState:d(D,_n.action);else{var ar={lane:tr,action:_n.action,hasEagerState:_n.hasEagerState,eagerState:_n.eagerState,next:null};Ft===null?(Et=Ft=ar,je=D):Ft=Ft.next=ar,ps.lanes|=tr,ka|=tr}_n=_n.next}while(_n!==null&&_n!==ce);Ft===null?je=D:Ft.next=Et,lo(D,g.memoizedState)||(Fe=!0),g.memoizedState=D,g.baseState=je,g.baseQueue=Ft,E.lastRenderedState=D}if(d=E.interleaved,d!==null){K=d;do ce=K.lane,ps.lanes|=ce,ka|=ce,K=K.next;while(K!==d)}else K===null&&(E.lanes=0);return[g.memoizedState,E.dispatch]}function nh(d){var g=Cc(),E=g.queue;if(E===null)throw Error(t(311));E.lastRenderedReducer=d;var D=E.dispatch,K=E.pending,ce=g.memoizedState;if(K!==null){E.pending=null;var je=K=K.next;do ce=d(ce,je.action),je=je.next;while(je!==K);lo(ce,g.memoizedState)||(Fe=!0),g.memoizedState=ce,g.baseQueue===null&&(g.baseState=ce),E.lastRenderedState=ce}return[ce,D]}function Eh(){}function Hl(d,g){var E=ps,D=Cc(),K=g(),ce=!lo(D.memoizedState,K);if(ce&&(D.memoizedState=K,Fe=!0),D=D.queue,bu(ed.bind(null,E,D,d),[d]),D.getSnapshot!==g||ce||xs!==null&&xs.memoizedState.tag&1){if(E.flags|=2048,Ll(9,xd.bind(null,E,D,K,g),void 0,null),Ml===null)throw Error(t(349));(Ns&30)!==0||Qh(E,g,K)}return K}function Qh(d,g,E){d.flags|=16384,d={getSnapshot:g,value:E},g=ps.updateQueue,g===null?(g={lastEffect:null,stores:null},ps.updateQueue=g,g.stores=[d]):(E=g.stores,E===null?g.stores=[d]:E.push(d))}function xd(d,g,E,D){g.value=E,g.getSnapshot=D,bd(g)&&Oh(d)}function ed(d,g,E){return E(function(){bd(g)&&Oh(d)})}function bd(d){var g=d.getSnapshot;d=d.value;try{var E=g();return!lo(d,E)}catch{return!0}}function Oh(d){var g=rn(d,1);g!==null&&ad(g,d,1,-1)}function Od(d){var g=Ou();return typeof d=="function"&&(d=d()),g.memoizedState=g.baseState=d,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:th,lastRenderedState:d},g.queue=d,d=d.dispatch=Pa.bind(null,ps,d),[g.memoizedState,d]}function Ll(d,g,E,D){return d={tag:d,create:g,destroy:E,deps:D,next:null},g=ps.updateQueue,g===null?(g={lastEffect:null,stores:null},ps.updateQueue=g,g.lastEffect=d.next=d):(E=g.lastEffect,E===null?g.lastEffect=d.next=d:(D=E.next,E.next=d,d.next=D,g.lastEffect=d)),d}function Pl(){return Cc().memoizedState}function fc(d,g,E,D){var K=Ou();ps.flags|=d,K.memoizedState=Ll(1|g,E,void 0,D===void 0?null:D)}function Lc(d,g,E,D){var K=Cc();D=D===void 0?null:D;var ce=void 0;if(ns!==null){var je=ns.memoizedState;if(ce=je.destroy,D!==null&&Fh(D,je.deps)){K.memoizedState=Ll(g,E,ce,D);return}}ps.flags|=d,K.memoizedState=Ll(1|g,E,ce,D)}function Vc(d,g){return fc(8390656,8,d,g)}function bu(d,g){return Lc(2048,8,d,g)}function rh(d,g){return Lc(4,2,d,g)}function ih(d,g){return Lc(4,4,d,g)}function ff(d,g){if(typeof g=="function")return d=d(),g(d),function(){g(null)};if(g!=null)return d=d(),g.current=d,function(){g.current=null}}function _m(d,g,E){return E=E!=null?E.concat([d]):null,Lc(4,4,ff.bind(null,g,d),E)}function vm(){}function wg(d,g){var E=Cc();g=g===void 0?null:g;var D=E.memoizedState;return D!==null&&g!==null&&Fh(g,D[1])?D[0]:(E.memoizedState=[d,g],d)}function xm(d,g){var E=Cc();g=g===void 0?null:g;var D=E.memoizedState;return D!==null&&g!==null&&Fh(g,D[1])?D[0]:(d=d(),E.memoizedState=[d,g],d)}function bm(d,g,E){return(Ns&21)===0?(d.baseState&&(d.baseState=!1,Fe=!0),d.memoizedState=E):(lo(E,g)||(E=js(),ps.lanes|=E,ka|=E,d.baseState=!0),g)}function au(d,g){var E=qi;qi=E!==0&&4>E?E:4,d(!0);var D=$o.transition;$o.transition={};try{d(!1),g()}finally{qi=E,$o.transition=D}}function wm(){return Cc().memoizedState}function Sg(d,g,E){var D=Id(d);if(E={lane:D,action:E,hasEagerState:!1,eagerState:null,next:null},Zr(d))td(g,E);else if(E=Ut(d,g,E,D),E!==null){var K=Uu();ad(E,d,D,K),pf(E,g,D)}}function Pa(d,g,E){var D=Id(d),K={lane:D,action:E,hasEagerState:!1,eagerState:null,next:null};if(Zr(d))td(g,K);else{var ce=d.alternate;if(d.lanes===0&&(ce===null||ce.lanes===0)&&(ce=g.lastRenderedReducer,ce!==null))try{var je=g.lastRenderedState,Et=ce(je,E);if(K.hasEagerState=!0,K.eagerState=Et,lo(Et,je)){var Ft=g.interleaved;Ft===null?(K.next=K,Cn(g)):(K.next=Ft.next,Ft.next=K),g.interleaved=K;return}}catch{}finally{}E=Ut(d,g,K,D),E!==null&&(K=Uu(),ad(E,d,D,K),pf(E,g,D))}}function Zr(d){var g=d.alternate;return d===ps||g!==null&&g===ps}function td(d,g){Ds=dc=!0;var E=d.pending;E===null?g.next=g:(g.next=E.next,E.next=g),d.pending=g}function pf(d,g,E){if((E&4194240)!==0){var D=g.lanes;D&=d.pendingLanes,E|=D,g.lanes=E,wl(d,E)}}var Pc={readContext:ln,useCallback:Ys,useContext:Ys,useEffect:Ys,useImperativeHandle:Ys,useInsertionEffect:Ys,useLayoutEffect:Ys,useMemo:Ys,useReducer:Ys,useRef:Ys,useState:Ys,useDebugValue:Ys,useDeferredValue:Ys,useTransition:Ys,useMutableSource:Ys,useSyncExternalStore:Ys,useId:Ys,unstable_isNewReconciler:!1},Sm={readContext:ln,useCallback:function(d,g){return Ou().memoizedState=[d,g===void 0?null:g],d},useContext:ln,useEffect:Vc,useImperativeHandle:function(d,g,E){return E=E!=null?E.concat([d]):null,fc(4194308,4,ff.bind(null,g,d),E)},useLayoutEffect:function(d,g){return fc(4194308,4,d,g)},useInsertionEffect:function(d,g){return fc(4,2,d,g)},useMemo:function(d,g){var E=Ou();return g=g===void 0?null:g,d=d(),E.memoizedState=[d,g],d},useReducer:function(d,g,E){var D=Ou();return g=E!==void 0?E(g):g,D.memoizedState=D.baseState=g,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:d,lastRenderedState:g},D.queue=d,d=d.dispatch=Sg.bind(null,ps,d),[D.memoizedState,d]},useRef:function(d){var g=Ou();return d={current:d},g.memoizedState=d},useState:Od,useDebugValue:vm,useDeferredValue:function(d){return Ou().memoizedState=d},useTransition:function(){var d=Od(!1),g=d[0];return d=au.bind(null,d[1]),Ou().memoizedState=d,[g,d]},useMutableSource:function(){},useSyncExternalStore:function(d,g,E){var D=ps,K=Ou();if(v){if(E===void 0)throw Error(t(407));E=E()}else{if(E=g(),Ml===null)throw Error(t(349));(Ns&30)!==0||Qh(D,g,E)}K.memoizedState=E;var ce={value:E,getSnapshot:g};return K.queue=ce,Vc(ed.bind(null,D,ce,d),[d]),D.flags|=2048,Ll(9,xd.bind(null,D,ce,E,g),void 0,null),E},useId:function(){var d=Ou(),g=Ml.identifierPrefix;if(v){var E=dt,D=Yt;E=(D&~(1<<32-Yo(D)-1)).toString(32)+E,g=":"+g+"R"+E,E=Ic++,0<E&&(g+="H"+E.toString(32)),g+=":"}else E=yd++,g=":"+g+"r"+E.toString(32)+":";return d.memoizedState=g},unstable_isNewReconciler:!1},Bd={readContext:ln,useCallback:wg,useContext:ln,useEffect:bu,useImperativeHandle:_m,useInsertionEffect:rh,useLayoutEffect:ih,useMemo:xm,useReducer:vd,useRef:Pl,useState:function(){return vd(th)},useDebugValue:vm,useDeferredValue:function(d){var g=Cc();return bm(g,ns.memoizedState,d)},useTransition:function(){var d=vd(th)[0],g=Cc().memoizedState;return[d,g]},useMutableSource:Eh,useSyncExternalStore:Hl,useId:wm,unstable_isNewReconciler:!1},Bu={readContext:ln,useCallback:wg,useContext:ln,useEffect:bu,useImperativeHandle:_m,useInsertionEffect:rh,useLayoutEffect:ih,useMemo:xm,useReducer:nh,useRef:Pl,useState:function(){return nh(th)},useDebugValue:vm,useDeferredValue:function(d){var g=Cc();return ns===null?g.memoizedState=d:bm(g,ns.memoizedState,d)},useTransition:function(){var d=nh(th)[0],g=Cc().memoizedState;return[d,g]},useMutableSource:Eh,useSyncExternalStore:Hl,useId:wm,unstable_isNewReconciler:!1};function kl(d,g){if(d&&d.defaultProps){g=tt({},g),d=d.defaultProps;for(var E in d)g[E]===void 0&&(g[E]=d[E]);return g}return g}function lu(d,g,E,D){g=d.memoizedState,E=E(D,g),E=E==null?g:tt({},g,E),d.memoizedState=E,d.lanes===0&&(d.updateQueue.baseState=E)}var nd={isMounted:function(d){return(d=d._reactInternals)?so(d)===d:!1},enqueueSetState:function(d,g,E){d=d._reactInternals;var D=Uu(),K=Id(d),ce=hr(D,K);ce.payload=g,E!=null&&(ce.callback=E),g=Dr(d,ce,K),g!==null&&(ad(g,d,K,D),rr(g,d,K))},enqueueReplaceState:function(d,g,E){d=d._reactInternals;var D=Uu(),K=Id(d),ce=hr(D,K);ce.tag=1,ce.payload=g,E!=null&&(ce.callback=E),g=Dr(d,ce,K),g!==null&&(ad(g,d,K,D),rr(g,d,K))},enqueueForceUpdate:function(d,g){d=d._reactInternals;var E=Uu(),D=Id(d),K=hr(E,D);K.tag=2,g!=null&&(K.callback=g),g=Dr(d,K,D),g!==null&&(ad(g,d,D,E),rr(g,d,D))}};function wd(d,g,E,D,K,ce,je){return d=d.stateNode,typeof d.shouldComponentUpdate=="function"?d.shouldComponentUpdate(D,ce,je):g.prototype&&g.prototype.isPureReactComponent?!Al(E,D)||!Al(K,ce):!0}function kp(d,g,E){var D=!1,K=cc,ce=g.contextType;return typeof ce=="object"&&ce!==null?ce=ln(ce):(K=La(g)?Ju:tl.current,D=g.contextTypes,ce=(D=D!=null)?Ca(d,K):cc),g=new g(E,ce),d.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=nd,d.stateNode=g,g._reactInternals=d,D&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=K,d.__reactInternalMemoizedMaskedChildContext=ce),g}function mf(d,g,E,D){d=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(E,D),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(E,D),g.state!==d&&nd.enqueueReplaceState(g,g.state,null)}function Rp(d,g,E,D){var K=d.stateNode;K.props=E,K.state=d.memoizedState,K.refs={},cn(d);var ce=g.contextType;typeof ce=="object"&&ce!==null?K.context=ln(ce):(ce=La(g)?Ju:tl.current,K.context=Ca(d,ce)),K.state=d.memoizedState,ce=g.getDerivedStateFromProps,typeof ce=="function"&&(lu(d,g,ce,E),K.state=d.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof K.getSnapshotBeforeUpdate=="function"||typeof K.UNSAFE_componentWillMount!="function"&&typeof K.componentWillMount!="function"||(g=K.state,typeof K.componentWillMount=="function"&&K.componentWillMount(),typeof K.UNSAFE_componentWillMount=="function"&&K.UNSAFE_componentWillMount(),g!==K.state&&nd.enqueueReplaceState(K,K.state,null),ni(d,E,K,D),K.state=d.memoizedState),typeof K.componentDidMount=="function"&&(d.flags|=4194308)}function zd(d,g){try{var E="",D=g;do E+=Qe(D),D=D.return;while(D);var K=E}catch(ce){K=`
Error generating stack: `+ce.message+`
`+ce.stack}return{value:d,source:g,stack:K,digest:null}}function Em(d,g,E){return{value:d,source:null,stack:E??null,digest:g??null}}function rd(d,g){try{console.error(g.value)}catch(E){setTimeout(function(){throw E})}}var Am=typeof WeakMap=="function"?WeakMap:Map;function jd(d,g,E){E=hr(-1,E),E.tag=3,E.payload={element:null};var D=g.value;return E.callback=function(){Im||(Im=!0,G0=D),rd(d,g)},E}function Ud(d,g,E){E=hr(-1,E),E.tag=3;var D=d.type.getDerivedStateFromError;if(typeof D=="function"){var K=g.value;E.payload=function(){return D(K)},E.callback=function(){rd(d,g)}}var ce=d.stateNode;return ce!==null&&typeof ce.componentDidCatch=="function"&&(E.callback=function(){rd(d,g),typeof D!="function"&&(wu===null?wu=new Set([this]):wu.add(this));var je=g.stack;this.componentDidCatch(g.value,{componentStack:je!==null?je:""})}),E}function Bh(d,g,E){var D=d.pingCache;if(D===null){D=d.pingCache=new Am;var K=new Set;D.set(g,K)}else K=D.get(g),K===void 0&&(K=new Set,D.set(g,K));K.has(E)||(K.add(E),d=J0.bind(null,d,g,E),g.then(d,d))}function O(d){do{var g;if((g=d.tag===13)&&(g=d.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return d;d=d.return}while(d!==null);return null}function fe(d,g,E,D,K){return(d.mode&1)===0?(d===g?d.flags|=65536:(d.flags|=128,E.flags|=131072,E.flags&=-52805,E.tag===1&&(E.alternate===null?E.tag=17:(g=hr(-1,1),g.tag=2,Dr(E,g,1))),E.lanes|=1),d):(d.flags|=65536,d.lanes=K,d)}var Ie=ue.ReactCurrentOwner,Fe=!1;function Ye(d,g,E,D){g.child=d===null?st(g,null,E,D):it(g,d.child,E,D)}function qe(d,g,E,D,K){E=E.render;var ce=g.ref;return Bt(g,K),D=_d(d,g,E,D,ce,K),E=Fu(),d!==null&&!Fe?(g.updateQueue=d.updateQueue,g.flags&=-2053,d.lanes&=~K,Sr(d,g,K)):(v&&E&&En(g),g.flags|=1,Ye(d,g,D,K),g.child)}function Ge(d,g,E,D,K){if(d===null){var ce=E.type;return typeof ce=="function"&&!op(ce)&&ce.defaultProps===void 0&&E.compare===null&&E.defaultProps===void 0?(g.tag=15,g.type=ce,St(d,g,ce,D,K)):(d=Lg(E.type,null,D,g,g.mode,K),d.ref=g.ref,d.return=g,g.child=d)}if(ce=d.child,(d.lanes&K)===0){var je=ce.memoizedProps;if(E=E.compare,E=E!==null?E:Al,E(je,D)&&d.ref===g.ref)return Sr(d,g,K)}return g.flags|=1,d=wf(ce,D),d.ref=g.ref,d.return=g,g.child=d}function St(d,g,E,D,K){if(d!==null){var ce=d.memoizedProps;if(Al(ce,D)&&d.ref===g.ref)if(Fe=!1,g.pendingProps=D=ce,(d.lanes&K)!==0)(d.flags&131072)!==0&&(Fe=!0);else return g.lanes=d.lanes,Sr(d,g,K)}return Xt(d,g,E,D,K)}function Dt(d,g,E){var D=g.pendingProps,K=D.children,ce=d!==null?d.memoizedState:null;if(D.mode==="hidden")if((g.mode&1)===0)g.memoizedState={baseLanes:0,cachePool:null,transitions:null},Gi(Kl,Va),Va|=E;else{if((E&1073741824)===0)return d=ce!==null?ce.baseLanes|E:E,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:d,cachePool:null,transitions:null},g.updateQueue=null,Gi(Kl,Va),Va|=d,null;g.memoizedState={baseLanes:0,cachePool:null,transitions:null},D=ce!==null?ce.baseLanes:E,Gi(Kl,Va),Va|=D}else ce!==null?(D=ce.baseLanes|E,g.memoizedState=null):D=E,Gi(Kl,Va),Va|=D;return Ye(d,g,K,E),g.child}function ft(d,g){var E=g.ref;(d===null&&E!==null||d!==null&&d.ref!==E)&&(g.flags|=512,g.flags|=2097152)}function Xt(d,g,E,D,K){var ce=La(E)?Ju:tl.current;return ce=Ca(g,ce),Bt(g,K),E=_d(d,g,E,D,ce,K),D=Fu(),d!==null&&!Fe?(g.updateQueue=d.updateQueue,g.flags&=-2053,d.lanes&=~K,Sr(d,g,K)):(v&&D&&En(g),g.flags|=1,Ye(d,g,E,K),g.child)}function en(d,g,E,D,K){if(La(E)){var ce=!0;Cl(g)}else ce=!1;if(Bt(g,K),g.stateNode===null)Ar(d,g),kp(g,E,D),Rp(g,E,D,K),D=!0;else if(d===null){var je=g.stateNode,Et=g.memoizedProps;je.props=Et;var Ft=je.context,_n=E.contextType;typeof _n=="object"&&_n!==null?_n=ln(_n):(_n=La(E)?Ju:tl.current,_n=Ca(g,_n));var tr=E.getDerivedStateFromProps,ar=typeof tr=="function"||typeof je.getSnapshotBeforeUpdate=="function";ar||typeof je.UNSAFE_componentWillReceiveProps!="function"&&typeof je.componentWillReceiveProps!="function"||(Et!==D||Ft!==_n)&&mf(g,je,D,_n),Tn=!1;var Kn=g.memoizedState;je.state=Kn,ni(g,D,je,K),Ft=g.memoizedState,Et!==D||Kn!==Ft||$l.current||Tn?(typeof tr=="function"&&(lu(g,E,tr,D),Ft=g.memoizedState),(Et=Tn||wd(g,E,Et,D,Kn,Ft,_n))?(ar||typeof je.UNSAFE_componentWillMount!="function"&&typeof je.componentWillMount!="function"||(typeof je.componentWillMount=="function"&&je.componentWillMount(),typeof je.UNSAFE_componentWillMount=="function"&&je.UNSAFE_componentWillMount()),typeof je.componentDidMount=="function"&&(g.flags|=4194308)):(typeof je.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=D,g.memoizedState=Ft),je.props=D,je.state=Ft,je.context=_n,D=Et):(typeof je.componentDidMount=="function"&&(g.flags|=4194308),D=!1)}else{je=g.stateNode,Nn(d,g),Et=g.memoizedProps,_n=g.type===g.elementType?Et:kl(g.type,Et),je.props=_n,ar=g.pendingProps,Kn=je.context,Ft=E.contextType,typeof Ft=="object"&&Ft!==null?Ft=ln(Ft):(Ft=La(E)?Ju:tl.current,Ft=Ca(g,Ft));var Wr=E.getDerivedStateFromProps;(tr=typeof Wr=="function"||typeof je.getSnapshotBeforeUpdate=="function")||typeof je.UNSAFE_componentWillReceiveProps!="function"&&typeof je.componentWillReceiveProps!="function"||(Et!==ar||Kn!==Ft)&&mf(g,je,D,Ft),Tn=!1,Kn=g.memoizedState,je.state=Kn,ni(g,D,je,K);var ii=g.memoizedState;Et!==ar||Kn!==ii||$l.current||Tn?(typeof Wr=="function"&&(lu(g,E,Wr,D),ii=g.memoizedState),(_n=Tn||wd(g,E,_n,D,Kn,ii,Ft)||!1)?(tr||typeof je.UNSAFE_componentWillUpdate!="function"&&typeof je.componentWillUpdate!="function"||(typeof je.componentWillUpdate=="function"&&je.componentWillUpdate(D,ii,Ft),typeof je.UNSAFE_componentWillUpdate=="function"&&je.UNSAFE_componentWillUpdate(D,ii,Ft)),typeof je.componentDidUpdate=="function"&&(g.flags|=4),typeof je.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof je.componentDidUpdate!="function"||Et===d.memoizedProps&&Kn===d.memoizedState||(g.flags|=4),typeof je.getSnapshotBeforeUpdate!="function"||Et===d.memoizedProps&&Kn===d.memoizedState||(g.flags|=1024),g.memoizedProps=D,g.memoizedState=ii),je.props=D,je.state=ii,je.context=Ft,D=_n):(typeof je.componentDidUpdate!="function"||Et===d.memoizedProps&&Kn===d.memoizedState||(g.flags|=4),typeof je.getSnapshotBeforeUpdate!="function"||Et===d.memoizedProps&&Kn===d.memoizedState||(g.flags|=1024),D=!1)}return bn(d,g,E,D,ce,K)}function bn(d,g,E,D,K,ce){ft(d,g);var je=(g.flags&128)!==0;if(!D&&!je)return K&&Qu(g,E,!1),Sr(d,g,ce);D=g.stateNode,Ie.current=g;var Et=je&&typeof E.getDerivedStateFromError!="function"?null:D.render();return g.flags|=1,d!==null&&je?(g.child=it(g,d.child,null,ce),g.child=it(g,null,Et,ce)):Ye(d,g,Et,ce),g.memoizedState=D.state,K&&Qu(g,E,!0),g.child}function un(d){var g=d.stateNode;g.pendingContext?uc(d,g.pendingContext,g.pendingContext!==g.context):g.context&&uc(d,g.context,!1),Rs(d,g.containerInfo)}function zt(d,g,E,D,K){return Ae(),Le(K),g.flags|=256,Ye(d,g,E,D),g.child}var on={dehydrated:null,treeContext:null,retryLane:0};function fr(d){return{baseLanes:d,cachePool:null,transitions:null}}function _r(d,g,E){var D=g.pendingProps,K=Li.current,ce=!1,je=(g.flags&128)!==0,Et;if((Et=je)||(Et=d!==null&&d.memoizedState===null?!1:(K&2)!==0),Et?(ce=!0,g.flags&=-129):(d===null||d.memoizedState!==null)&&(K|=1),Gi(Li,K&1),d===null)return G(g),d=g.memoizedState,d!==null&&(d=d.dehydrated,d!==null)?((g.mode&1)===0?g.lanes=1:d.data==="$!"?g.lanes=8:g.lanes=1073741824,null):(je=D.children,d=D.fallback,ce?(D=g.mode,ce=g.child,je={mode:"hidden",children:je},(D&1)===0&&ce!==null?(ce.childLanes=0,ce.pendingProps=je):ce=Pg(je,D,0,null),d=sp(d,D,E,null),ce.return=g,d.return=g,ce.sibling=d,g.child=ce,g.child.memoizedState=fr(E),g.memoizedState=on,d):jn(g,je));if(K=d.memoizedState,K!==null&&(Et=K.dehydrated,Et!==null))return ri(d,g,je,D,Et,K,E);if(ce){ce=D.fallback,je=g.mode,K=d.child,Et=K.sibling;var Ft={mode:"hidden",children:D.children};return(je&1)===0&&g.child!==K?(D=g.child,D.childLanes=0,D.pendingProps=Ft,g.deletions=null):(D=wf(K,Ft),D.subtreeFlags=K.subtreeFlags&14680064),Et!==null?ce=wf(Et,ce):(ce=sp(ce,je,E,null),ce.flags|=2),ce.return=g,D.return=g,D.sibling=ce,g.child=D,D=ce,ce=g.child,je=d.child.memoizedState,je=je===null?fr(E):{baseLanes:je.baseLanes|E,cachePool:null,transitions:je.transitions},ce.memoizedState=je,ce.childLanes=d.childLanes&~E,g.memoizedState=on,D}return ce=d.child,d=ce.sibling,D=wf(ce,{mode:"visible",children:D.children}),(g.mode&1)===0&&(D.lanes=E),D.return=g,D.sibling=null,d!==null&&(E=g.deletions,E===null?(g.deletions=[d],g.flags|=16):E.push(d)),g.child=D,g.memoizedState=null,D}function jn(d,g){return g=Pg({mode:"visible",children:g},d.mode,0,null),g.return=d,d.child=g}function cr(d,g,E,D){return D!==null&&Le(D),it(g,d.child,null,E),d=jn(g,g.pendingProps.children),d.flags|=2,g.memoizedState=null,d}function ri(d,g,E,D,K,ce,je){if(E)return g.flags&256?(g.flags&=-257,D=Em(Error(t(422))),cr(d,g,je,D)):g.memoizedState!==null?(g.child=d.child,g.flags|=128,null):(ce=D.fallback,K=g.mode,D=Pg({mode:"visible",children:D.children},K,0,null),ce=sp(ce,K,je,null),ce.flags|=2,D.return=g,ce.return=g,D.sibling=ce,g.child=D,(g.mode&1)!==0&&it(g,d.child,null,je),g.child.memoizedState=fr(je),g.memoizedState=on,ce);if((g.mode&1)===0)return cr(d,g,je,null);if(K.data==="$!"){if(D=K.nextSibling&&K.nextSibling.dataset,D)var Et=D.dgst;return D=Et,ce=Error(t(419)),D=Em(ce,D,void 0),cr(d,g,je,D)}if(Et=(je&d.childLanes)!==0,Fe||Et){if(D=Ml,D!==null){switch(je&-je){case 4:K=2;break;case 16:K=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:K=32;break;case 536870912:K=268435456;break;default:K=0}K=(K&(D.suspendedLanes|je))!==0?0:K,K!==0&&K!==ce.retryLane&&(ce.retryLane=K,rn(d,K),ad(D,d,K,-1))}return K0(),D=Em(Error(t(421))),cr(d,g,je,D)}return K.data==="$?"?(g.flags|=128,g.child=d.child,g=Tx.bind(null,d),K._reactRetry=g,null):(d=ce.treeContext,f=za(K.nextSibling),a=g,v=!0,S=null,d!==null&&(nt[ut++]=Yt,nt[ut++]=dt,nt[ut++]=Nt,Yt=d.id,dt=d.overflow,Nt=g),g=jn(g,D.children),g.flags|=4096,g)}function qr(d,g,E){d.lanes|=g;var D=d.alternate;D!==null&&(D.lanes|=g),vn(d.return,g,E)}function Vr(d,g,E,D,K){var ce=d.memoizedState;ce===null?d.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:D,tail:E,tailMode:K}:(ce.isBackwards=g,ce.rendering=null,ce.renderingStartTime=0,ce.last=D,ce.tail=E,ce.tailMode=K)}function Pi(d,g,E){var D=g.pendingProps,K=D.revealOrder,ce=D.tail;if(Ye(d,g,D.children,E),D=Li.current,(D&2)!==0)D=D&1|2,g.flags|=128;else{if(d!==null&&(d.flags&128)!==0)e:for(d=g.child;d!==null;){if(d.tag===13)d.memoizedState!==null&&qr(d,E,g);else if(d.tag===19)qr(d,E,g);else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===g)break e;for(;d.sibling===null;){if(d.return===null||d.return===g)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}D&=1}if(Gi(Li,D),(g.mode&1)===0)g.memoizedState=null;else switch(K){case"forwards":for(E=g.child,K=null;E!==null;)d=E.alternate,d!==null&&no(d)===null&&(K=E),E=E.sibling;E=K,E===null?(K=g.child,g.child=null):(K=E.sibling,E.sibling=null),Vr(g,!1,K,E,ce);break;case"backwards":for(E=null,K=g.child,g.child=null;K!==null;){if(d=K.alternate,d!==null&&no(d)===null){g.child=K;break}d=K.sibling,K.sibling=E,E=K,K=d}Vr(g,!0,E,null,ce);break;case"together":Vr(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function Ar(d,g){(g.mode&1)===0&&d!==null&&(d.alternate=null,g.alternate=null,g.flags|=2)}function Sr(d,g,E){if(d!==null&&(g.dependencies=d.dependencies),ka|=g.lanes,(E&g.childLanes)===0)return null;if(d!==null&&g.child!==d.child)throw Error(t(153));if(g.child!==null){for(d=g.child,E=wf(d,d.pendingProps),g.child=E,E.return=g;d.sibling!==null;)d=d.sibling,E=E.sibling=wf(d,d.pendingProps),E.return=g;E.sibling=null}return g.child}function Bi(d,g,E){switch(g.tag){case 3:un(g),Ae();break;case 5:hc(g);break;case 1:La(g.type)&&Cl(g);break;case 4:Rs(g,g.stateNode.containerInfo);break;case 10:var D=g.type._context,K=g.memoizedProps.value;Gi(bt,D._currentValue),D._currentValue=K;break;case 13:if(D=g.memoizedState,D!==null)return D.dehydrated!==null?(Gi(Li,Li.current&1),g.flags|=128,null):(E&g.child.childLanes)!==0?_r(d,g,E):(Gi(Li,Li.current&1),d=Sr(d,g,E),d!==null?d.sibling:null);Gi(Li,Li.current&1);break;case 19:if(D=(E&g.childLanes)!==0,(d.flags&128)!==0){if(D)return Pi(d,g,E);g.flags|=128}if(K=g.memoizedState,K!==null&&(K.rendering=null,K.tail=null,K.lastEffect=null),Gi(Li,Li.current),D)break;return null;case 22:case 23:return g.lanes=0,Dt(d,g,E)}return Sr(d,g,E)}var Ur,Fr,xi,Dn;Ur=function(d,g){for(var E=g.child;E!==null;){if(E.tag===5||E.tag===6)d.appendChild(E.stateNode);else if(E.tag!==4&&E.child!==null){E.child.return=E,E=E.child;continue}if(E===g)break;for(;E.sibling===null;){if(E.return===null||E.return===g)return;E=E.return}E.sibling.return=E.return,E=E.sibling}},Fr=function(){},xi=function(d,g,E,D){var K=d.memoizedProps;if(K!==D){d=g.stateNode,fo(Ii.current);var ce=null;switch(E){case"input":K=Gt(d,K),D=Gt(d,D),ce=[];break;case"select":K=tt({},K,{value:void 0}),D=tt({},D,{value:void 0}),ce=[];break;case"textarea":K=Kr(d,K),D=Kr(d,D),ce=[];break;default:typeof K.onClick!="function"&&typeof D.onClick=="function"&&(d.onclick=wh)}Gr(E,D);var je;E=null;for(_n in K)if(!D.hasOwnProperty(_n)&&K.hasOwnProperty(_n)&&K[_n]!=null)if(_n==="style"){var Et=K[_n];for(je in Et)Et.hasOwnProperty(je)&&(E||(E={}),E[je]="")}else _n!=="dangerouslySetInnerHTML"&&_n!=="children"&&_n!=="suppressContentEditableWarning"&&_n!=="suppressHydrationWarning"&&_n!=="autoFocus"&&(c.hasOwnProperty(_n)?ce||(ce=[]):(ce=ce||[]).push(_n,null));for(_n in D){var Ft=D[_n];if(Et=K?.[_n],D.hasOwnProperty(_n)&&Ft!==Et&&(Ft!=null||Et!=null))if(_n==="style")if(Et){for(je in Et)!Et.hasOwnProperty(je)||Ft&&Ft.hasOwnProperty(je)||(E||(E={}),E[je]="");for(je in Ft)Ft.hasOwnProperty(je)&&Et[je]!==Ft[je]&&(E||(E={}),E[je]=Ft[je])}else E||(ce||(ce=[]),ce.push(_n,E)),E=Ft;else _n==="dangerouslySetInnerHTML"?(Ft=Ft?Ft.__html:void 0,Et=Et?Et.__html:void 0,Ft!=null&&Et!==Ft&&(ce=ce||[]).push(_n,Ft)):_n==="children"?typeof Ft!="string"&&typeof Ft!="number"||(ce=ce||[]).push(_n,""+Ft):_n!=="suppressContentEditableWarning"&&_n!=="suppressHydrationWarning"&&(c.hasOwnProperty(_n)?(Ft!=null&&_n==="onScroll"&&eo("scroll",d),ce||Et===Ft||(ce=[])):(ce=ce||[]).push(_n,Ft))}E&&(ce=ce||[]).push("style",E);var _n=ce;(g.updateQueue=_n)&&(g.flags|=4)}},Dn=function(d,g,E,D){E!==D&&(g.flags|=4)};function nn(d,g){if(!v)switch(d.tailMode){case"hidden":g=d.tail;for(var E=null;g!==null;)g.alternate!==null&&(E=g),g=g.sibling;E===null?d.tail=null:E.sibling=null;break;case"collapsed":E=d.tail;for(var D=null;E!==null;)E.alternate!==null&&(D=E),E=E.sibling;D===null?g||d.tail===null?d.tail=null:d.tail.sibling=null:D.sibling=null}}function dn(d){var g=d.alternate!==null&&d.alternate.child===d.child,E=0,D=0;if(g)for(var K=d.child;K!==null;)E|=K.lanes|K.childLanes,D|=K.subtreeFlags&14680064,D|=K.flags&14680064,K.return=d,K=K.sibling;else for(K=d.child;K!==null;)E|=K.lanes|K.childLanes,D|=K.subtreeFlags,D|=K.flags,K.return=d,K=K.sibling;return d.subtreeFlags|=D,d.childLanes=E,g}function Gn(d,g,E){var D=g.pendingProps;switch(y(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return dn(g),null;case 1:return La(g.type)&&Jh(),dn(g),null;case 3:return D=g.stateNode,hs(),qo($l),qo(tl),Ms(),D.pendingContext&&(D.context=D.pendingContext,D.pendingContext=null),(d===null||d.child===null)&&(te(g)?g.flags|=4:d===null||d.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,S!==null&&(Gd(S),S=null))),Fr(d,g),dn(g),null;case 5:Tc(g);var K=fo(Ni.current);if(E=g.type,d!==null&&g.stateNode!=null)xi(d,g,E,D,K),d.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!D){if(g.stateNode===null)throw Error(t(166));return dn(g),null}if(d=fo(Ii.current),te(g)){D=g.stateNode,E=g.type;var ce=g.memoizedProps;switch(D[ja]=g,D[su]=ce,d=(g.mode&1)!==0,E){case"dialog":eo("cancel",D),eo("close",D);break;case"iframe":case"object":case"embed":eo("load",D);break;case"video":case"audio":for(K=0;K<ua.length;K++)eo(ua[K],D);break;case"source":eo("error",D);break;case"img":case"image":case"link":eo("error",D),eo("load",D);break;case"details":eo("toggle",D);break;case"input":ot(D,ce),eo("invalid",D);break;case"select":D._wrapperState={wasMultiple:!!ce.multiple},eo("invalid",D);break;case"textarea":qt(D,ce),eo("invalid",D)}Gr(E,ce),K=null;for(var je in ce)if(ce.hasOwnProperty(je)){var Et=ce[je];je==="children"?typeof Et=="string"?D.textContent!==Et&&(ce.suppressHydrationWarning!==!0&&Rh(D.textContent,Et,d),K=["children",Et]):typeof Et=="number"&&D.textContent!==""+Et&&(ce.suppressHydrationWarning!==!0&&Rh(D.textContent,Et,d),K=["children",""+Et]):c.hasOwnProperty(je)&&Et!=null&&je==="onScroll"&&eo("scroll",D)}switch(E){case"input":hn(D),Cr(D,ce,!0);break;case"textarea":hn(D),Hn(D);break;case"select":case"option":break;default:typeof ce.onClick=="function"&&(D.onclick=wh)}D=K,g.updateQueue=D,D!==null&&(g.flags|=4)}else{je=K.nodeType===9?K:K.ownerDocument,d==="http://www.w3.org/1999/xhtml"&&(d=Bn(E)),d==="http://www.w3.org/1999/xhtml"?E==="script"?(d=je.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild)):typeof D.is=="string"?d=je.createElement(E,{is:D.is}):(d=je.createElement(E),E==="select"&&(je=d,D.multiple?je.multiple=!0:D.size&&(je.size=D.size))):d=je.createElementNS(d,E),d[ja]=g,d[su]=D,Ur(d,g,!1,!1),g.stateNode=d;e:{switch(je=Or(E,D),E){case"dialog":eo("cancel",d),eo("close",d),K=D;break;case"iframe":case"object":case"embed":eo("load",d),K=D;break;case"video":case"audio":for(K=0;K<ua.length;K++)eo(ua[K],d);K=D;break;case"source":eo("error",d),K=D;break;case"img":case"image":case"link":eo("error",d),eo("load",d),K=D;break;case"details":eo("toggle",d),K=D;break;case"input":ot(d,D),K=Gt(d,D),eo("invalid",d);break;case"option":K=D;break;case"select":d._wrapperState={wasMultiple:!!D.multiple},K=tt({},D,{value:void 0}),eo("invalid",d);break;case"textarea":qt(d,D),K=Kr(d,D),eo("invalid",d);break;default:K=D}Gr(E,K),Et=K;for(ce in Et)if(Et.hasOwnProperty(ce)){var Ft=Et[ce];ce==="style"?or(d,Ft):ce==="dangerouslySetInnerHTML"?(Ft=Ft?Ft.__html:void 0,Ft!=null&&Tr(d,Ft)):ce==="children"?typeof Ft=="string"?(E!=="textarea"||Ft!=="")&&Ir(d,Ft):typeof Ft=="number"&&Ir(d,""+Ft):ce!=="suppressContentEditableWarning"&&ce!=="suppressHydrationWarning"&&ce!=="autoFocus"&&(c.hasOwnProperty(ce)?Ft!=null&&ce==="onScroll"&&eo("scroll",d):Ft!=null&&me(d,ce,Ft,je))}switch(E){case"input":hn(d),Cr(d,D,!1);break;case"textarea":hn(d),Hn(d);break;case"option":D.value!=null&&d.setAttribute("value",""+pt(D.value));break;case"select":d.multiple=!!D.multiple,ce=D.value,ce!=null?Qn(d,!!D.multiple,ce,!1):D.defaultValue!=null&&Qn(d,!!D.multiple,D.defaultValue,!0);break;default:typeof K.onClick=="function"&&(d.onclick=wh)}switch(E){case"button":case"input":case"select":case"textarea":D=!!D.autoFocus;break e;case"img":D=!0;break e;default:D=!1}}D&&(g.flags|=4)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return dn(g),null;case 6:if(d&&g.stateNode!=null)Dn(d,g,d.memoizedProps,D);else{if(typeof D!="string"&&g.stateNode===null)throw Error(t(166));if(E=fo(Ni.current),fo(Ii.current),te(g)){if(D=g.stateNode,E=g.memoizedProps,D[ja]=g,(ce=D.nodeValue!==E)&&(d=a,d!==null))switch(d.tag){case 3:Rh(D.nodeValue,E,(d.mode&1)!==0);break;case 5:d.memoizedProps.suppressHydrationWarning!==!0&&Rh(D.nodeValue,E,(d.mode&1)!==0)}ce&&(g.flags|=4)}else D=(E.nodeType===9?E:E.ownerDocument).createTextNode(D),D[ja]=g,g.stateNode=D}return dn(g),null;case 13:if(qo(Li),D=g.memoizedState,d===null||d.memoizedState!==null&&d.memoizedState.dehydrated!==null){if(v&&f!==null&&(g.mode&1)!==0&&(g.flags&128)===0)ge(),Ae(),g.flags|=98560,ce=!1;else if(ce=te(g),D!==null&&D.dehydrated!==null){if(d===null){if(!ce)throw Error(t(318));if(ce=g.memoizedState,ce=ce!==null?ce.dehydrated:null,!ce)throw Error(t(317));ce[ja]=g}else Ae(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;dn(g),ce=!1}else S!==null&&(Gd(S),S=null),ce=!0;if(!ce)return g.flags&65536?g:null}return(g.flags&128)!==0?(g.lanes=E,g):(D=D!==null,D!==(d!==null&&d.memoizedState!==null)&&D&&(g.child.flags|=8192,(g.mode&1)!==0&&(d===null||(Li.current&1)!==0?Go===0&&(Go=3):K0())),g.updateQueue!==null&&(g.flags|=4),dn(g),null);case 4:return hs(),Fr(d,g),d===null&&ac(g.stateNode.containerInfo),dn(g),null;case 10:return Vt(g.type._context),dn(g),null;case 17:return La(g.type)&&Jh(),dn(g),null;case 19:if(qo(Li),ce=g.memoizedState,ce===null)return dn(g),null;if(D=(g.flags&128)!==0,je=ce.rendering,je===null)if(D)nn(ce,!1);else{if(Go!==0||d!==null&&(d.flags&128)!==0)for(d=g.child;d!==null;){if(je=no(d),je!==null){for(g.flags|=128,nn(ce,!1),D=je.updateQueue,D!==null&&(g.updateQueue=D,g.flags|=4),g.subtreeFlags=0,D=E,E=g.child;E!==null;)ce=E,d=D,ce.flags&=14680066,je=ce.alternate,je===null?(ce.childLanes=0,ce.lanes=d,ce.child=null,ce.subtreeFlags=0,ce.memoizedProps=null,ce.memoizedState=null,ce.updateQueue=null,ce.dependencies=null,ce.stateNode=null):(ce.childLanes=je.childLanes,ce.lanes=je.lanes,ce.child=je.child,ce.subtreeFlags=0,ce.deletions=null,ce.memoizedProps=je.memoizedProps,ce.memoizedState=je.memoizedState,ce.updateQueue=je.updateQueue,ce.type=je.type,d=je.dependencies,ce.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),E=E.sibling;return Gi(Li,Li.current&1|2),g.child}d=d.sibling}ce.tail!==null&&To()>Mp&&(g.flags|=128,D=!0,nn(ce,!1),g.lanes=4194304)}else{if(!D)if(d=no(je),d!==null){if(g.flags|=128,D=!0,E=d.updateQueue,E!==null&&(g.updateQueue=E,g.flags|=4),nn(ce,!0),ce.tail===null&&ce.tailMode==="hidden"&&!je.alternate&&!v)return dn(g),null}else 2*To()-ce.renderingStartTime>Mp&&E!==1073741824&&(g.flags|=128,D=!0,nn(ce,!1),g.lanes=4194304);ce.isBackwards?(je.sibling=g.child,g.child=je):(E=ce.last,E!==null?E.sibling=je:g.child=je,ce.last=je)}return ce.tail!==null?(g=ce.tail,ce.rendering=g,ce.tail=g.sibling,ce.renderingStartTime=To(),g.sibling=null,E=Li.current,Gi(Li,D?E&1|2:E&1),g):(dn(g),null);case 22:case 23:return Ig(),D=g.memoizedState!==null,d!==null&&d.memoizedState!==null!==D&&(g.flags|=8192),D&&(g.mode&1)!==0?(Va&1073741824)!==0&&(dn(g),g.subtreeFlags&6&&(g.flags|=8192)):dn(g),null;case 24:return null;case 25:return null}throw Error(t(156,g.tag))}function br(d,g){switch(y(g),g.tag){case 1:return La(g.type)&&Jh(),d=g.flags,d&65536?(g.flags=d&-65537|128,g):null;case 3:return hs(),qo($l),qo(tl),Ms(),d=g.flags,(d&65536)!==0&&(d&128)===0?(g.flags=d&-65537|128,g):null;case 5:return Tc(g),null;case 13:if(qo(Li),d=g.memoizedState,d!==null&&d.dehydrated!==null){if(g.alternate===null)throw Error(t(340));Ae()}return d=g.flags,d&65536?(g.flags=d&-65537|128,g):null;case 19:return qo(Li),null;case 4:return hs(),null;case 10:return Vt(g.type._context),null;case 22:case 23:return Ig(),null;case 24:return null;default:return null}}var ei=!1,li=!1,Co=typeof WeakSet=="function"?WeakSet:Set,Fn=null;function Eo(d,g){var E=d.ref;if(E!==null)if(typeof E=="function")try{E(null)}catch(D){Nl(d,g,D)}else E.current=null}function ro(d,g,E){try{E()}catch(D){Nl(d,g,D)}}var Rl=!1;function rl(d,g){if(Qr=Dc,d=ca(),Bc(d)){if("selectionStart"in d)var E={start:d.selectionStart,end:d.selectionEnd};else e:{E=(E=d.ownerDocument)&&E.defaultView||window;var D=E.getSelection&&E.getSelection();if(D&&D.rangeCount!==0){E=D.anchorNode;var K=D.anchorOffset,ce=D.focusNode;D=D.focusOffset;try{E.nodeType,ce.nodeType}catch{E=null;break e}var je=0,Et=-1,Ft=-1,_n=0,tr=0,ar=d,Kn=null;t:for(;;){for(var Wr;ar!==E||K!==0&&ar.nodeType!==3||(Et=je+K),ar!==ce||D!==0&&ar.nodeType!==3||(Ft=je+D),ar.nodeType===3&&(je+=ar.nodeValue.length),(Wr=ar.firstChild)!==null;)Kn=ar,ar=Wr;for(;;){if(ar===d)break t;if(Kn===E&&++_n===K&&(Et=je),Kn===ce&&++tr===D&&(Ft=je),(Wr=ar.nextSibling)!==null)break;ar=Kn,Kn=ar.parentNode}ar=Wr}E=Et===-1||Ft===-1?null:{start:Et,end:Ft}}else E=null}E=E||{start:0,end:0}}else E=null;for(xu={focusedElem:d,selectionRange:E},Dc=!1,Fn=g;Fn!==null;)if(g=Fn,d=g.child,(g.subtreeFlags&1028)!==0&&d!==null)d.return=g,Fn=d;else for(;Fn!==null;){g=Fn;try{var ii=g.alternate;if((g.flags&1024)!==0)switch(g.tag){case 0:case 11:case 15:break;case 1:if(ii!==null){var di=ii.memoizedProps,Dl=ii.memoizedState,an=g.stateNode,Ht=an.getSnapshotBeforeUpdate(g.elementType===g.type?di:kl(g.type,di),Dl);an.__reactInternalSnapshotBeforeUpdate=Ht}break;case 3:var gn=g.stateNode.containerInfo;gn.nodeType===1?gn.textContent="":gn.nodeType===9&&gn.documentElement&&gn.removeChild(gn.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(gr){Nl(g,g.return,gr)}if(d=g.sibling,d!==null){d.return=g.return,Fn=d;break}Fn=g.return}return ii=Rl,Rl=!1,ii}function il(d,g,E){var D=g.updateQueue;if(D=D!==null?D.lastEffect:null,D!==null){var K=D=D.next;do{if((K.tag&d)===d){var ce=K.destroy;K.destroy=void 0,ce!==void 0&&ro(g,E,ce)}K=K.next}while(K!==D)}}function Yi(d,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var E=g=g.next;do{if((E.tag&d)===d){var D=E.create;E.destroy=D()}E=E.next}while(E!==g)}}function Wn(d){var g=d.ref;if(g!==null){var E=d.stateNode;switch(d.tag){case 5:d=E;break;default:d=E}typeof g=="function"?g(d):g.current=d}}function cu(d){var g=d.alternate;g!==null&&(d.alternate=null,cu(g)),d.child=null,d.deletions=null,d.sibling=null,d.tag===5&&(g=d.stateNode,g!==null&&(delete g[ja],delete g[su],delete g[Il],delete g[Dh],delete g[df])),d.stateNode=null,d.return=null,d.dependencies=null,d.memoizedProps=null,d.memoizedState=null,d.pendingProps=null,d.stateNode=null,d.updateQueue=null}function zh(d){return d.tag===5||d.tag===3||d.tag===4}function Vd(d){e:for(;;){for(;d.sibling===null;){if(d.return===null||zh(d.return))return null;d=d.return}for(d.sibling.return=d.return,d=d.sibling;d.tag!==5&&d.tag!==6&&d.tag!==18;){if(d.flags&2||d.child===null||d.tag===4)continue e;d.child.return=d,d=d.child}if(!(d.flags&2))return d.stateNode}}function ml(d,g,E){var D=d.tag;if(D===5||D===6)d=d.stateNode,g?E.nodeType===8?E.parentNode.insertBefore(d,g):E.insertBefore(d,g):(E.nodeType===8?(g=E.parentNode,g.insertBefore(d,E)):(g=E,g.appendChild(d)),E=E._reactRootContainer,E!=null||g.onclick!==null||(g.onclick=wh));else if(D!==4&&(d=d.child,d!==null))for(ml(d,g,E),d=d.sibling;d!==null;)ml(d,g,E),d=d.sibling}function jh(d,g,E){var D=d.tag;if(D===5||D===6)d=d.stateNode,g?E.insertBefore(d,g):E.appendChild(d);else if(D!==4&&(d=d.child,d!==null))for(jh(d,g,E),d=d.sibling;d!==null;)jh(d,g,E),d=d.sibling}var as=null,gl=!1;function Wl(d,g,E){for(E=E.child;E!==null;)Sd(d,g,E),E=E.sibling}function Sd(d,g,E){if(ra&&typeof ra.onCommitFiberUnmount=="function")try{ra.onCommitFiberUnmount(Sa,E)}catch{}switch(E.tag){case 5:li||Eo(E,g);case 6:var D=as,K=gl;as=null,Wl(d,g,E),as=D,gl=K,as!==null&&(gl?(d=as,E=E.stateNode,d.nodeType===8?d.parentNode.removeChild(E):d.removeChild(E)):as.removeChild(E.stateNode));break;case 18:as!==null&&(gl?(d=as,E=E.stateNode,d.nodeType===8?gd(d.parentNode,E):d.nodeType===1&&gd(d,E),Vs(d)):gd(as,E.stateNode));break;case 4:D=as,K=gl,as=E.stateNode.containerInfo,gl=!0,Wl(d,g,E),as=D,gl=K;break;case 0:case 11:case 14:case 15:if(!li&&(D=E.updateQueue,D!==null&&(D=D.lastEffect,D!==null))){K=D=D.next;do{var ce=K,je=ce.destroy;ce=ce.tag,je!==void 0&&((ce&2)!==0||(ce&4)!==0)&&ro(E,g,je),K=K.next}while(K!==D)}Wl(d,g,E);break;case 1:if(!li&&(Eo(E,g),D=E.stateNode,typeof D.componentWillUnmount=="function"))try{D.props=E.memoizedProps,D.state=E.memoizedState,D.componentWillUnmount()}catch(Et){Nl(E,g,Et)}Wl(d,g,E);break;case 21:Wl(d,g,E);break;case 22:E.mode&1?(li=(D=li)||E.memoizedState!==null,Wl(d,g,E),li=D):Wl(d,g,E);break;default:Wl(d,g,E)}}function gf(d){var g=d.updateQueue;if(g!==null){d.updateQueue=null;var E=d.stateNode;E===null&&(E=d.stateNode=new Co),g.forEach(function(D){var K=Ix.bind(null,d,D);E.has(D)||(E.add(D),D.then(K,K))})}}function pc(d,g){var E=g.deletions;if(E!==null)for(var D=0;D<E.length;D++){var K=E[D];try{var ce=d,je=g,Et=je;e:for(;Et!==null;){switch(Et.tag){case 5:as=Et.stateNode,gl=!1;break e;case 3:as=Et.stateNode.containerInfo,gl=!0;break e;case 4:as=Et.stateNode.containerInfo,gl=!0;break e}Et=Et.return}if(as===null)throw Error(t(160));Sd(ce,je,K),as=null,gl=!1;var Ft=K.alternate;Ft!==null&&(Ft.return=null),K.return=null}catch(_n){Nl(K,g,_n)}}if(g.subtreeFlags&12854)for(g=g.child;g!==null;)Ah(g,d),g=g.sibling}function Ah(d,g){var E=d.alternate,D=d.flags;switch(d.tag){case 0:case 11:case 14:case 15:if(pc(g,d),Yr(d),D&4){try{il(3,d,d.return),Yi(3,d)}catch(di){Nl(d,d.return,di)}try{il(5,d,d.return)}catch(di){Nl(d,d.return,di)}}break;case 1:pc(g,d),Yr(d),D&512&&E!==null&&Eo(E,E.return);break;case 5:if(pc(g,d),Yr(d),D&512&&E!==null&&Eo(E,E.return),d.flags&32){var K=d.stateNode;try{Ir(K,"")}catch(di){Nl(d,d.return,di)}}if(D&4&&(K=d.stateNode,K!=null)){var ce=d.memoizedProps,je=E!==null?E.memoizedProps:ce,Et=d.type,Ft=d.updateQueue;if(d.updateQueue=null,Ft!==null)try{Et==="input"&&ce.type==="radio"&&ce.name!=null&&dr(K,ce),Or(Et,je);var _n=Or(Et,ce);for(je=0;je<Ft.length;je+=2){var tr=Ft[je],ar=Ft[je+1];tr==="style"?or(K,ar):tr==="dangerouslySetInnerHTML"?Tr(K,ar):tr==="children"?Ir(K,ar):me(K,tr,ar,_n)}switch(Et){case"input":wr(K,ce);break;case"textarea":Pn(K,ce);break;case"select":var Kn=K._wrapperState.wasMultiple;K._wrapperState.wasMultiple=!!ce.multiple;var Wr=ce.value;Wr!=null?Qn(K,!!ce.multiple,Wr,!1):Kn!==!!ce.multiple&&(ce.defaultValue!=null?Qn(K,!!ce.multiple,ce.defaultValue,!0):Qn(K,!!ce.multiple,ce.multiple?[]:"",!1))}K[su]=ce}catch(di){Nl(d,d.return,di)}}break;case 6:if(pc(g,d),Yr(d),D&4){if(d.stateNode===null)throw Error(t(162));K=d.stateNode,ce=d.memoizedProps;try{K.nodeValue=ce}catch(di){Nl(d,d.return,di)}}break;case 3:if(pc(g,d),Yr(d),D&4&&E!==null&&E.memoizedState.isDehydrated)try{Vs(g.containerInfo)}catch(di){Nl(d,d.return,di)}break;case 4:pc(g,d),Yr(d);break;case 13:pc(g,d),Yr(d),K=d.child,K.flags&8192&&(ce=K.memoizedState!==null,K.stateNode.isHidden=ce,!ce||K.alternate!==null&&K.alternate.memoizedState!==null||(Tm=To())),D&4&&gf(d);break;case 22:if(tr=E!==null&&E.memoizedState!==null,d.mode&1?(li=(_n=li)||tr,pc(g,d),li=_n):pc(g,d),Yr(d),D&8192){if(_n=d.memoizedState!==null,(d.stateNode.isHidden=_n)&&!tr&&(d.mode&1)!==0)for(Fn=d,tr=d.child;tr!==null;){for(ar=Fn=tr;Fn!==null;){switch(Kn=Fn,Wr=Kn.child,Kn.tag){case 0:case 11:case 14:case 15:il(4,Kn,Kn.return);break;case 1:Eo(Kn,Kn.return);var ii=Kn.stateNode;if(typeof ii.componentWillUnmount=="function"){D=Kn,E=Kn.return;try{g=D,ii.props=g.memoizedProps,ii.state=g.memoizedState,ii.componentWillUnmount()}catch(di){Nl(D,E,di)}}break;case 5:Eo(Kn,Kn.return);break;case 22:if(Kn.memoizedState!==null){yl(ar);continue}}Wr!==null?(Wr.return=Kn,Fn=Wr):yl(ar)}tr=tr.sibling}e:for(tr=null,ar=d;;){if(ar.tag===5){if(tr===null){tr=ar;try{K=ar.stateNode,_n?(ce=K.style,typeof ce.setProperty=="function"?ce.setProperty("display","none","important"):ce.display="none"):(Et=ar.stateNode,Ft=ar.memoizedProps.style,je=Ft!=null&&Ft.hasOwnProperty("display")?Ft.display:null,Et.style.display=ki("display",je))}catch(di){Nl(d,d.return,di)}}}else if(ar.tag===6){if(tr===null)try{ar.stateNode.nodeValue=_n?"":ar.memoizedProps}catch(di){Nl(d,d.return,di)}}else if((ar.tag!==22&&ar.tag!==23||ar.memoizedState===null||ar===d)&&ar.child!==null){ar.child.return=ar,ar=ar.child;continue}if(ar===d)break e;for(;ar.sibling===null;){if(ar.return===null||ar.return===d)break e;tr===ar&&(tr=null),ar=ar.return}tr===ar&&(tr=null),ar.sibling.return=ar.return,ar=ar.sibling}}break;case 19:pc(g,d),Yr(d),D&4&&gf(d);break;case 21:break;default:pc(g,d),Yr(d)}}function Yr(d){var g=d.flags;if(g&2){try{e:{for(var E=d.return;E!==null;){if(zh(E)){var D=E;break e}E=E.return}throw Error(t(160))}switch(D.tag){case 5:var K=D.stateNode;D.flags&32&&(Ir(K,""),D.flags&=-33);var ce=Vd(d);jh(d,ce,K);break;case 3:case 4:var je=D.stateNode.containerInfo,Et=Vd(d);ml(d,Et,je);break;default:throw Error(t(161))}}catch(Ft){Nl(d,d.return,Ft)}d.flags&=-3}g&4096&&(d.flags&=-4097)}function ls(d,g,E){Fn=d,va(d)}function va(d,g,E){for(var D=(d.mode&1)!==0;Fn!==null;){var K=Fn,ce=K.child;if(K.tag===22&&D){var je=K.memoizedState!==null||ei;if(!je){var Et=K.alternate,Ft=Et!==null&&Et.memoizedState!==null||li;Et=ei;var _n=li;if(ei=je,(li=Ft)&&!_n)for(Fn=K;Fn!==null;)je=Fn,Ft=je.child,je.tag===22&&je.memoizedState!==null?id(K):Ft!==null?(Ft.return=je,Fn=Ft):id(K);for(;ce!==null;)Fn=ce,va(ce),ce=ce.sibling;Fn=K,ei=Et,li=_n}zu(d)}else(K.subtreeFlags&8772)!==0&&ce!==null?(ce.return=K,Fn=ce):zu(d)}}function zu(d){for(;Fn!==null;){var g=Fn;if((g.flags&8772)!==0){var E=g.alternate;try{if((g.flags&8772)!==0)switch(g.tag){case 0:case 11:case 15:li||Yi(5,g);break;case 1:var D=g.stateNode;if(g.flags&4&&!li)if(E===null)D.componentDidMount();else{var K=g.elementType===g.type?E.memoizedProps:kl(g.type,E.memoizedProps);D.componentDidUpdate(K,E.memoizedState,D.__reactInternalSnapshotBeforeUpdate)}var ce=g.updateQueue;ce!==null&&mi(g,ce,D);break;case 3:var je=g.updateQueue;if(je!==null){if(E=null,g.child!==null)switch(g.child.tag){case 5:E=g.child.stateNode;break;case 1:E=g.child.stateNode}mi(g,je,E)}break;case 5:var Et=g.stateNode;if(E===null&&g.flags&4){E=Et;var Ft=g.memoizedProps;switch(g.type){case"button":case"input":case"select":case"textarea":Ft.autoFocus&&E.focus();break;case"img":Ft.src&&(E.src=Ft.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(g.memoizedState===null){var _n=g.alternate;if(_n!==null){var tr=_n.memoizedState;if(tr!==null){var ar=tr.dehydrated;ar!==null&&Vs(ar)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}li||g.flags&512&&Wn(g)}catch(Kn){Nl(g,g.return,Kn)}}if(g===d){Fn=null;break}if(E=g.sibling,E!==null){E.return=g.return,Fn=E;break}Fn=g.return}}function yl(d){for(;Fn!==null;){var g=Fn;if(g===d){Fn=null;break}var E=g.sibling;if(E!==null){E.return=g.return,Fn=E;break}Fn=g.return}}function id(d){for(;Fn!==null;){var g=Fn;try{switch(g.tag){case 0:case 11:case 15:var E=g.return;try{Yi(4,g)}catch(Ft){Nl(g,E,Ft)}break;case 1:var D=g.stateNode;if(typeof D.componentDidMount=="function"){var K=g.return;try{D.componentDidMount()}catch(Ft){Nl(g,K,Ft)}}var ce=g.return;try{Wn(g)}catch(Ft){Nl(g,ce,Ft)}break;case 5:var je=g.return;try{Wn(g)}catch(Ft){Nl(g,je,Ft)}}}catch(Ft){Nl(g,g.return,Ft)}if(g===d){Fn=null;break}var Et=g.sibling;if(Et!==null){Et.return=g.return,Fn=Et;break}Fn=g.return}}var yf=Math.ceil,qc=ue.ReactCurrentDispatcher,Ed=ue.ReactCurrentOwner,ol=ue.ReactCurrentBatchConfig,Jr=0,Ml=null,Is=null,bs=0,Va=0,Kl=lc(0),Go=0,_f=null,ka=0,qd=0,Ad=0,$d=null,ju=null,Tm=0,Mp=1/0,od=null,Im=!1,G0=null,wu=null,Td=!1,sd=null,tp=0,np=0,Eg=null,Ag=-1,Cm=0;function Uu(){return(Jr&6)!==0?To():Ag!==-1?Ag:Ag=To()}function Id(d){return(d.mode&1)===0?1:(Jr&2)!==0&&bs!==0?bs&-bs:Xe.transition!==null?(Cm===0&&(Cm=js()),Cm):(d=qi,d!==0||(d=window.event,d=d===void 0?16:_c(d.type)),d)}function ad(d,g,E,D){if(50<np)throw np=0,Eg=null,Error(t(185));vi(d,E,D),((Jr&2)===0||d!==Ml)&&(d===Ml&&((Jr&2)===0&&(qd|=E),Go===4&&vf(d,bs)),Su(d,D),E===1&&Jr===0&&(g.mode&1)===0&&(Mp=To()+500,eh&&oe()))}function Su(d,g){var E=d.callbackNode;Br(d,g);var D=Ls(d,d===Ml?bs:0);if(D===0)E!==null&&Hi(E),d.callbackNode=null,d.callbackPriority=0;else if(g=D&-D,d.callbackPriority!==g){if(E!=null&&Hi(E),g===1)d.tag===0?ee(rp.bind(null,d)):B(rp.bind(null,d)),Uc(function(){(Jr&6)===0&&oe()}),E=null;else{switch(fs(D)){case 1:E=wa;break;case 4:E=Zo;break;case 16:E=Ha;break;case 536870912:E=rc;break;default:E=Ha}E=Pm(E,H0.bind(null,d))}d.callbackPriority=g,d.callbackNode=E}}function H0(d,g){if(Ag=-1,Cm=0,(Jr&6)!==0)throw Error(t(327));var E=d.callbackNode;if(oh()&&d.callbackNode!==E)return null;var D=Ls(d,d===Ml?bs:0);if(D===0)return null;if((D&30)!==0||(D&d.expiredLanes)!==0||g)g=Lm(d,D);else{g=D;var K=Jr;Jr|=2;var ce=W0();(Ml!==d||bs!==g)&&(od=null,Mp=To()+500,ip(d,g));do try{Ax();break}catch(Et){j_(d,Et)}while(!0);Tt(),qc.current=ce,Jr=K,Is!==null?g=0:(Ml=null,bs=0,g=Go)}if(g!==0){if(g===2&&(K=Mr(d),K!==0&&(D=K,g=Tg(d,K))),g===1)throw E=_f,ip(d,0),vf(d,D),Su(d,To()),E;if(g===6)vf(d,D);else{if(K=d.current.alternate,(D&30)===0&&!z_(K)&&(g=Lm(d,D),g===2&&(ce=Mr(d),ce!==0&&(D=ce,g=Tg(d,ce))),g===1))throw E=_f,ip(d,0),vf(d,D),Su(d,To()),E;switch(d.finishedWork=K,d.finishedLanes=D,g){case 0:case 1:throw Error(t(345));case 2:bf(d,ju,od);break;case 3:if(vf(d,D),(D&130023424)===D&&(g=Tm+500-To(),10<g)){if(Ls(d,0)!==0)break;if(K=d.suspendedLanes,(K&D)!==D){Uu(),d.pingedLanes|=d.suspendedLanes&K;break}d.timeoutHandle=Zs(bf.bind(null,d,ju,od),g);break}bf(d,ju,od);break;case 4:if(vf(d,D),(D&4194240)===D)break;for(g=d.eventTimes,K=-1;0<D;){var je=31-Yo(D);ce=1<<je,je=g[je],je>K&&(K=je),D&=~ce}if(D=K,D=To()-D,D=(120>D?120:480>D?480:1080>D?1080:1920>D?1920:3e3>D?3e3:4320>D?4320:1960*yf(D/1960))-D,10<D){d.timeoutHandle=Zs(bf.bind(null,d,ju,od),D);break}bf(d,ju,od);break;case 5:bf(d,ju,od);break;default:throw Error(t(329))}}}return Su(d,To()),d.callbackNode===E?H0.bind(null,d):null}function Tg(d,g){var E=$d;return d.current.memoizedState.isDehydrated&&(ip(d,g).flags|=256),d=Lm(d,g),d!==2&&(g=ju,ju=E,g!==null&&Gd(g)),d}function Gd(d){ju===null?ju=d:ju.push.apply(ju,d)}function z_(d){for(var g=d;;){if(g.flags&16384){var E=g.updateQueue;if(E!==null&&(E=E.stores,E!==null))for(var D=0;D<E.length;D++){var K=E[D],ce=K.getSnapshot;K=K.value;try{if(!lo(ce(),K))return!1}catch{return!1}}}if(E=g.child,g.subtreeFlags&16384&&E!==null)E.return=g,g=E;else{if(g===d)break;for(;g.sibling===null;){if(g.return===null||g.return===d)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function vf(d,g){for(g&=~Ad,g&=~qd,d.suspendedLanes|=g,d.pingedLanes&=~g,d=d.expirationTimes;0<g;){var E=31-Yo(g),D=1<<E;d[E]=-1,g&=~D}}function rp(d){if((Jr&6)!==0)throw Error(t(327));oh();var g=Ls(d,0);if((g&1)===0)return Su(d,To()),null;var E=Lm(d,g);if(d.tag!==0&&E===2){var D=Mr(d);D!==0&&(g=D,E=Tg(d,D))}if(E===1)throw E=_f,ip(d,0),vf(d,g),Su(d,To()),E;if(E===6)throw Error(t(345));return d.finishedWork=d.current.alternate,d.finishedLanes=g,bf(d,ju,od),Su(d,To()),null}function Np(d,g){var E=Jr;Jr|=1;try{return d(g)}finally{Jr=E,Jr===0&&(Mp=To()+500,eh&&oe())}}function xf(d){sd!==null&&sd.tag===0&&(Jr&6)===0&&oh();var g=Jr;Jr|=1;var E=ol.transition,D=qi;try{if(ol.transition=null,qi=1,d)return d()}finally{qi=D,ol.transition=E,Jr=g,(Jr&6)===0&&oe()}}function Ig(){Va=Kl.current,qo(Kl)}function ip(d,g){d.finishedWork=null,d.finishedLanes=0;var E=d.timeoutHandle;if(E!==-1&&(d.timeoutHandle=-1,Qa(E)),Is!==null)for(E=Is.return;E!==null;){var D=E;switch(y(D),D.tag){case 1:D=D.type.childContextTypes,D!=null&&Jh();break;case 3:hs(),qo($l),qo(tl),Ms();break;case 5:Tc(D);break;case 4:hs();break;case 13:qo(Li);break;case 19:qo(Li);break;case 10:Vt(D.type._context);break;case 22:case 23:Ig()}E=E.return}if(Ml=d,Is=d=wf(d.current,null),bs=Va=g,Go=0,_f=null,Ad=qd=ka=0,ju=$d=null,Wt!==null){for(g=0;g<Wt.length;g++)if(E=Wt[g],D=E.interleaved,D!==null){E.interleaved=null;var K=D.next,ce=E.pending;if(ce!==null){var je=ce.next;ce.next=K,D.next=je}E.pending=D}Wt=null}return d}function j_(d,g){do{var E=Is;try{if(Tt(),nl.current=Pc,dc){for(var D=ps.memoizedState;D!==null;){var K=D.queue;K!==null&&(K.pending=null),D=D.next}dc=!1}if(Ns=0,xs=ns=ps=null,Ds=!1,Ic=0,Ed.current=null,E===null||E.return===null){Go=1,_f=g,Is=null;break}e:{var ce=d,je=E.return,Et=E,Ft=g;if(g=bs,Et.flags|=32768,Ft!==null&&typeof Ft=="object"&&typeof Ft.then=="function"){var _n=Ft,tr=Et,ar=tr.tag;if((tr.mode&1)===0&&(ar===0||ar===11||ar===15)){var Kn=tr.alternate;Kn?(tr.updateQueue=Kn.updateQueue,tr.memoizedState=Kn.memoizedState,tr.lanes=Kn.lanes):(tr.updateQueue=null,tr.memoizedState=null)}var Wr=O(je);if(Wr!==null){Wr.flags&=-257,fe(Wr,je,Et,ce,g),Wr.mode&1&&Bh(ce,_n,g),g=Wr,Ft=_n;var ii=g.updateQueue;if(ii===null){var di=new Set;di.add(Ft),g.updateQueue=di}else ii.add(Ft);break e}else{if((g&1)===0){Bh(ce,_n,g),K0();break e}Ft=Error(t(426))}}else if(v&&Et.mode&1){var Dl=O(je);if(Dl!==null){(Dl.flags&65536)===0&&(Dl.flags|=256),fe(Dl,je,Et,ce,g),Le(zd(Ft,Et));break e}}ce=Ft=zd(Ft,Et),Go!==4&&(Go=2),$d===null?$d=[ce]:$d.push(ce),ce=je;do{switch(ce.tag){case 3:ce.flags|=65536,g&=-g,ce.lanes|=g;var an=jd(ce,Ft,g);Jn(ce,an);break e;case 1:Et=Ft;var Ht=ce.type,gn=ce.stateNode;if((ce.flags&128)===0&&(typeof Ht.getDerivedStateFromError=="function"||gn!==null&&typeof gn.componentDidCatch=="function"&&(wu===null||!wu.has(gn)))){ce.flags|=65536,g&=-g,ce.lanes|=g;var gr=Ud(ce,Et,g);Jn(ce,gr);break e}}ce=ce.return}while(ce!==null)}Z0(E)}catch(fi){g=fi,Is===E&&E!==null&&(Is=E=E.return);continue}break}while(!0)}function W0(){var d=qc.current;return qc.current=Pc,d===null?Pc:d}function K0(){(Go===0||Go===3||Go===2)&&(Go=4),Ml===null||(ka&268435455)===0&&(qd&268435455)===0||vf(Ml,bs)}function Lm(d,g){var E=Jr;Jr|=2;var D=W0();(Ml!==d||bs!==g)&&(od=null,ip(d,g));do try{Ex();break}catch(K){j_(d,K)}while(!0);if(Tt(),Jr=E,qc.current=D,Is!==null)throw Error(t(261));return Ml=null,bs=0,Go}function Ex(){for(;Is!==null;)X0(Is)}function Ax(){for(;Is!==null&&!nc();)X0(Is)}function X0(d){var g=Cg(d.alternate,d,Va);d.memoizedProps=d.pendingProps,g===null?Z0(d):Is=g,Ed.current=null}function Z0(d){var g=d;do{var E=g.alternate;if(d=g.return,(g.flags&32768)===0){if(E=Gn(E,g,Va),E!==null){Is=E;return}}else{if(E=br(E,g),E!==null){E.flags&=32767,Is=E;return}if(d!==null)d.flags|=32768,d.subtreeFlags=0,d.deletions=null;else{Go=6,Is=null;return}}if(g=g.sibling,g!==null){Is=g;return}Is=g=d}while(g!==null);Go===0&&(Go=5)}function bf(d,g,E){var D=qi,K=ol.transition;try{ol.transition=null,qi=1,Y0(d,g,E,D)}finally{ol.transition=K,qi=D}return null}function Y0(d,g,E,D){do oh();while(sd!==null);if((Jr&6)!==0)throw Error(t(327));E=d.finishedWork;var K=d.finishedLanes;if(E===null)return null;if(d.finishedWork=null,d.finishedLanes=0,E===d.current)throw Error(t(177));d.callbackNode=null,d.callbackPriority=0;var ce=E.lanes|E.childLanes;if(Mi(d,ce),d===Ml&&(Is=Ml=null,bs=0),(E.subtreeFlags&2064)===0&&(E.flags&2064)===0||Td||(Td=!0,Pm(Ha,function(){return oh(),null})),ce=(E.flags&15990)!==0,(E.subtreeFlags&15990)!==0||ce){ce=ol.transition,ol.transition=null;var je=qi;qi=1;var Et=Jr;Jr|=4,Ed.current=null,rl(d,E),Ah(E,d),kh(xu),Dc=!!Qr,xu=Qr=null,d.current=E,ls(E),Lu(),Jr=Et,qi=je,ol.transition=ce}else d.current=E;if(Td&&(Td=!1,sd=d,tp=K),ce=d.pendingLanes,ce===0&&(wu=null),mn(E.stateNode),Su(d,To()),g!==null)for(D=d.onRecoverableError,E=0;E<g.length;E++)K=g[E],D(K.value,{componentStack:K.stack,digest:K.digest});if(Im)throw Im=!1,d=G0,G0=null,d;return(tp&1)!==0&&d.tag!==0&&oh(),ce=d.pendingLanes,(ce&1)!==0?d===Eg?np++:(np=0,Eg=d):np=0,oe(),null}function oh(){if(sd!==null){var d=fs(tp),g=ol.transition,E=qi;try{if(ol.transition=null,qi=16>d?16:d,sd===null)var D=!1;else{if(d=sd,sd=null,tp=0,(Jr&6)!==0)throw Error(t(331));var K=Jr;for(Jr|=4,Fn=d.current;Fn!==null;){var ce=Fn,je=ce.child;if((Fn.flags&16)!==0){var Et=ce.deletions;if(Et!==null){for(var Ft=0;Ft<Et.length;Ft++){var _n=Et[Ft];for(Fn=_n;Fn!==null;){var tr=Fn;switch(tr.tag){case 0:case 11:case 15:il(8,tr,ce)}var ar=tr.child;if(ar!==null)ar.return=tr,Fn=ar;else for(;Fn!==null;){tr=Fn;var Kn=tr.sibling,Wr=tr.return;if(cu(tr),tr===_n){Fn=null;break}if(Kn!==null){Kn.return=Wr,Fn=Kn;break}Fn=Wr}}}var ii=ce.alternate;if(ii!==null){var di=ii.child;if(di!==null){ii.child=null;do{var Dl=di.sibling;di.sibling=null,di=Dl}while(di!==null)}}Fn=ce}}if((ce.subtreeFlags&2064)!==0&&je!==null)je.return=ce,Fn=je;else e:for(;Fn!==null;){if(ce=Fn,(ce.flags&2048)!==0)switch(ce.tag){case 0:case 11:case 15:il(9,ce,ce.return)}var an=ce.sibling;if(an!==null){an.return=ce.return,Fn=an;break e}Fn=ce.return}}var Ht=d.current;for(Fn=Ht;Fn!==null;){je=Fn;var gn=je.child;if((je.subtreeFlags&2064)!==0&&gn!==null)gn.return=je,Fn=gn;else e:for(je=Ht;Fn!==null;){if(Et=Fn,(Et.flags&2048)!==0)try{switch(Et.tag){case 0:case 11:case 15:Yi(9,Et)}}catch(fi){Nl(Et,Et.return,fi)}if(Et===je){Fn=null;break e}var gr=Et.sibling;if(gr!==null){gr.return=Et.return,Fn=gr;break e}Fn=Et.return}}if(Jr=K,oe(),ra&&typeof ra.onPostCommitFiberRoot=="function")try{ra.onPostCommitFiberRoot(Sa,d)}catch{}D=!0}return D}finally{qi=E,ol.transition=g}}return!1}function Vu(d,g,E){g=zd(E,g),g=jd(d,g,1),d=Dr(d,g,1),g=Uu(),d!==null&&(vi(d,1,g),Su(d,g))}function Nl(d,g,E){if(d.tag===3)Vu(d,d,E);else for(;g!==null;){if(g.tag===3){Vu(g,d,E);break}else if(g.tag===1){var D=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof D.componentDidCatch=="function"&&(wu===null||!wu.has(D))){d=zd(E,d),d=Ud(g,d,1),g=Dr(g,d,1),d=Uu(),g!==null&&(vi(g,1,d),Su(g,d));break}}g=g.return}}function J0(d,g,E){var D=d.pingCache;D!==null&&D.delete(g),g=Uu(),d.pingedLanes|=d.suspendedLanes&E,Ml===d&&(bs&E)===E&&(Go===4||Go===3&&(bs&130023424)===bs&&500>To()-Tm?ip(d,0):Ad|=E),Su(d,g)}function U_(d,g){g===0&&((d.mode&1)===0?g=1:(g=Ka,Ka<<=1,(Ka&130023424)===0&&(Ka=4194304)));var E=Uu();d=rn(d,g),d!==null&&(vi(d,g,E),Su(d,E))}function Tx(d){var g=d.memoizedState,E=0;g!==null&&(E=g.retryLane),U_(d,E)}function Ix(d,g){var E=0;switch(d.tag){case 13:var D=d.stateNode,K=d.memoizedState;K!==null&&(E=K.retryLane);break;case 19:D=d.stateNode;break;default:throw Error(t(314))}D!==null&&D.delete(g),U_(d,E)}var Cg;Cg=function(d,g,E){if(d!==null)if(d.memoizedProps!==g.pendingProps||$l.current)Fe=!0;else{if((d.lanes&E)===0&&(g.flags&128)===0)return Fe=!1,Bi(d,g,E);Fe=(d.flags&131072)!==0}else Fe=!1,v&&(g.flags&1048576)!==0&&Qt(g,Je,g.index);switch(g.lanes=0,g.tag){case 2:var D=g.type;Ar(d,g),d=g.pendingProps;var K=Ca(g,tl.current);Bt(g,E),K=_d(null,g,D,d,K,E);var ce=Fu();return g.flags|=1,typeof K=="object"&&K!==null&&typeof K.render=="function"&&K.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,La(D)?(ce=!0,Cl(g)):ce=!1,g.memoizedState=K.state!==null&&K.state!==void 0?K.state:null,cn(g),K.updater=nd,g.stateNode=K,K._reactInternals=g,Rp(g,D,d,E),g=bn(null,g,D,!0,ce,E)):(g.tag=0,v&&ce&&En(g),Ye(null,g,K,E),g=g.child),g;case 16:D=g.elementType;e:{switch(Ar(d,g),d=g.pendingProps,K=D._init,D=K(D._payload),g.type=D,K=g.tag=Cx(D),d=kl(D,d),K){case 0:g=Xt(null,g,D,d,E);break e;case 1:g=en(null,g,D,d,E);break e;case 11:g=qe(null,g,D,d,E);break e;case 14:g=Ge(null,g,D,kl(D.type,d),E);break e}throw Error(t(306,D,""))}return g;case 0:return D=g.type,K=g.pendingProps,K=g.elementType===D?K:kl(D,K),Xt(d,g,D,K,E);case 1:return D=g.type,K=g.pendingProps,K=g.elementType===D?K:kl(D,K),en(d,g,D,K,E);case 3:e:{if(un(g),d===null)throw Error(t(387));D=g.pendingProps,ce=g.memoizedState,K=ce.element,Nn(d,g),ni(g,D,null,E);var je=g.memoizedState;if(D=je.element,ce.isDehydrated)if(ce={element:D,isDehydrated:!1,cache:je.cache,pendingSuspenseBoundaries:je.pendingSuspenseBoundaries,transitions:je.transitions},g.updateQueue.baseState=ce,g.memoizedState=ce,g.flags&256){K=zd(Error(t(423)),g),g=zt(d,g,D,E,K);break e}else if(D!==K){K=zd(Error(t(424)),g),g=zt(d,g,D,E,K);break e}else for(f=za(g.stateNode.containerInfo.firstChild),a=g,v=!0,S=null,E=st(g,null,D,E),g.child=E;E;)E.flags=E.flags&-3|4096,E=E.sibling;else{if(Ae(),D===K){g=Sr(d,g,E);break e}Ye(d,g,D,E)}g=g.child}return g;case 5:return hc(g),d===null&&G(g),D=g.type,K=g.pendingProps,ce=d!==null?d.memoizedProps:null,je=K.children,Mh(D,K)?je=null:ce!==null&&Mh(D,ce)&&(g.flags|=32),ft(d,g),Ye(d,g,je,E),g.child;case 6:return d===null&&G(g),null;case 13:return _r(d,g,E);case 4:return Rs(g,g.stateNode.containerInfo),D=g.pendingProps,d===null?g.child=it(g,null,D,E):Ye(d,g,D,E),g.child;case 11:return D=g.type,K=g.pendingProps,K=g.elementType===D?K:kl(D,K),qe(d,g,D,K,E);case 7:return Ye(d,g,g.pendingProps,E),g.child;case 8:return Ye(d,g,g.pendingProps.children,E),g.child;case 12:return Ye(d,g,g.pendingProps.children,E),g.child;case 10:e:{if(D=g.type._context,K=g.pendingProps,ce=g.memoizedProps,je=K.value,Gi(bt,D._currentValue),D._currentValue=je,ce!==null)if(lo(ce.value,je)){if(ce.children===K.children&&!$l.current){g=Sr(d,g,E);break e}}else for(ce=g.child,ce!==null&&(ce.return=g);ce!==null;){var Et=ce.dependencies;if(Et!==null){je=ce.child;for(var Ft=Et.firstContext;Ft!==null;){if(Ft.context===D){if(ce.tag===1){Ft=hr(-1,E&-E),Ft.tag=2;var _n=ce.updateQueue;if(_n!==null){_n=_n.shared;var tr=_n.pending;tr===null?Ft.next=Ft:(Ft.next=tr.next,tr.next=Ft),_n.pending=Ft}}ce.lanes|=E,Ft=ce.alternate,Ft!==null&&(Ft.lanes|=E),vn(ce.return,E,g),Et.lanes|=E;break}Ft=Ft.next}}else if(ce.tag===10)je=ce.type===g.type?null:ce.child;else if(ce.tag===18){if(je=ce.return,je===null)throw Error(t(341));je.lanes|=E,Et=je.alternate,Et!==null&&(Et.lanes|=E),vn(je,E,g),je=ce.sibling}else je=ce.child;if(je!==null)je.return=ce;else for(je=ce;je!==null;){if(je===g){je=null;break}if(ce=je.sibling,ce!==null){ce.return=je.return,je=ce;break}je=je.return}ce=je}Ye(d,g,K.children,E),g=g.child}return g;case 9:return K=g.type,D=g.pendingProps.children,Bt(g,E),K=ln(K),D=D(K),g.flags|=1,Ye(d,g,D,E),g.child;case 14:return D=g.type,K=kl(D,g.pendingProps),K=kl(D.type,K),Ge(d,g,D,K,E);case 15:return St(d,g,g.type,g.pendingProps,E);case 17:return D=g.type,K=g.pendingProps,K=g.elementType===D?K:kl(D,K),Ar(d,g),g.tag=1,La(D)?(d=!0,Cl(g)):d=!1,Bt(g,E),kp(g,D,K),Rp(g,D,K,E),bn(null,g,D,!0,d,E);case 19:return Pi(d,g,E);case 22:return Dt(d,g,E)}throw Error(t(156,g.tag))};function Pm(d,g){return ll(d,g)}function V_(d,g,E,D){this.tag=d,this.key=E,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=D,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function $c(d,g,E,D){return new V_(d,g,E,D)}function op(d){return d=d.prototype,!(!d||!d.isReactComponent)}function Cx(d){if(typeof d=="function")return op(d)?1:0;if(d!=null){if(d=d.$$typeof,d===H)return 11;if(d===Re)return 14}return 2}function wf(d,g){var E=d.alternate;return E===null?(E=$c(d.tag,g,d.key,d.mode),E.elementType=d.elementType,E.type=d.type,E.stateNode=d.stateNode,E.alternate=d,d.alternate=E):(E.pendingProps=g,E.type=d.type,E.flags=0,E.subtreeFlags=0,E.deletions=null),E.flags=d.flags&14680064,E.childLanes=d.childLanes,E.lanes=d.lanes,E.child=d.child,E.memoizedProps=d.memoizedProps,E.memoizedState=d.memoizedState,E.updateQueue=d.updateQueue,g=d.dependencies,E.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},E.sibling=d.sibling,E.index=d.index,E.ref=d.ref,E}function Lg(d,g,E,D,K,ce){var je=2;if(D=d,typeof d=="function")op(d)&&(je=1);else if(typeof d=="string")je=5;else e:switch(d){case pe:return sp(E.children,K,ce,g);case U:je=8,K|=8;break;case F:return d=$c(12,E,g,K|2),d.elementType=F,d.lanes=ce,d;case Z:return d=$c(13,E,g,K),d.elementType=Z,d.lanes=ce,d;case be:return d=$c(19,E,g,K),d.elementType=be,d.lanes=ce,d;case Me:return Pg(E,K,ce,g);default:if(typeof d=="object"&&d!==null)switch(d.$$typeof){case q:je=10;break e;case j:je=9;break e;case H:je=11;break e;case Re:je=14;break e;case Oe:je=16,D=null;break e}throw Error(t(130,d==null?d:typeof d,""))}return g=$c(je,E,g,K),g.elementType=d,g.type=D,g.lanes=ce,g}function sp(d,g,E,D){return d=$c(7,d,D,g),d.lanes=E,d}function Pg(d,g,E,D){return d=$c(22,d,D,g),d.elementType=Me,d.lanes=E,d.stateNode={isHidden:!1},d}function Q0(d,g,E){return d=$c(6,d,null,g),d.lanes=E,d}function ey(d,g,E){return g=$c(4,d.children!==null?d.children:[],d.key,g),g.lanes=E,g.stateNode={containerInfo:d.containerInfo,pendingChildren:null,implementation:d.implementation},g}function ty(d,g,E,D,K){this.tag=g,this.containerInfo=d,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ea(0),this.expirationTimes=Ea(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ea(0),this.identifierPrefix=D,this.onRecoverableError=K,this.mutableSourceEagerHydrationData=null}function ny(d,g,E,D,K,ce,je,Et,Ft){return d=new ty(d,g,E,Et,Ft),g===1?(g=1,ce===!0&&(g|=8)):g=0,ce=$c(3,null,null,g),d.current=ce,ce.stateNode=d,ce.memoizedState={element:D,isDehydrated:E,cache:null,transitions:null,pendingSuspenseBoundaries:null},cn(ce),d}function Dp(d,g,E){var D=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ze,key:D==null?null:""+D,children:d,containerInfo:g,implementation:E}}function q_(d){if(!d)return cc;d=d._reactInternals;e:{if(so(d)!==d||d.tag!==1)throw Error(t(170));var g=d;do{switch(g.tag){case 3:g=g.stateNode.context;break e;case 1:if(La(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break e}}g=g.return}while(g!==null);throw Error(t(171))}if(d.tag===1){var E=d.type;if(La(E))return Gl(d,E,g)}return g}function sl(d,g,E,D,K,ce,je,Et,Ft){return d=ny(E,D,!0,d,K,ce,je,Et,Ft),d.context=q_(null),E=d.current,D=Uu(),K=Id(E),ce=hr(D,K),ce.callback=g??null,Dr(E,ce,K),d.current.lanes=K,vi(d,K,D),Su(d,D),d}function ap(d,g,E,D){var K=g.current,ce=Uu(),je=Id(K);return E=q_(E),g.context===null?g.context=E:g.pendingContext=E,g=hr(ce,je),g.payload={element:d},D=D===void 0?null:D,D!==null&&(g.callback=D),d=Dr(K,g,je),d!==null&&(ad(d,K,je,ce),rr(d,K,je)),je}function km(d){if(d=d.current,!d.child)return null;switch(d.child.tag){case 5:return d.child.stateNode;default:return d.child.stateNode}}function Rm(d,g){if(d=d.memoizedState,d!==null&&d.dehydrated!==null){var E=d.retryLane;d.retryLane=E!==0&&E<g?E:g}}function Fp(d,g){Rm(d,g),(d=d.alternate)&&Rm(d,g)}function Mm(){return null}var ry=typeof reportError=="function"?reportError:function(d){console.error(d)};function kg(d){this._internalRoot=d}Sf.prototype.render=kg.prototype.render=function(d){var g=this._internalRoot;if(g===null)throw Error(t(409));ap(d,g,null,null)},Sf.prototype.unmount=kg.prototype.unmount=function(){var d=this._internalRoot;if(d!==null){this._internalRoot=null;var g=d.containerInfo;xf(function(){ap(null,d,null,null)}),g[to]=null}};function Sf(d){this._internalRoot=d}Sf.prototype.unstable_scheduleHydration=function(d){if(d){var g=Jc();d={blockedOn:null,target:d,priority:g};for(var E=0;E<Io.length&&g!==0&&g<Io[E].priority;E++);Io.splice(E,0,d),E===0&&ku(d)}};function Nm(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)}function Op(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11&&(d.nodeType!==8||d.nodeValue!==" react-mount-point-unstable "))}function Rg(){}function Lx(d,g,E,D,K){if(K){if(typeof D=="function"){var ce=D;D=function(){var _n=km(je);ce.call(_n)}}var je=sl(g,D,d,0,null,!1,!1,"",Rg);return d._reactRootContainer=je,d[to]=je.current,ac(d.nodeType===8?d.parentNode:d),xf(),je}for(;K=d.lastChild;)d.removeChild(K);if(typeof D=="function"){var Et=D;D=function(){var _n=km(Ft);Et.call(_n)}}var Ft=ny(d,0,!1,null,null,!1,!1,"",Rg);return d._reactRootContainer=Ft,d[to]=Ft.current,ac(d.nodeType===8?d.parentNode:d),xf(function(){ap(g,Ft,E,D)}),Ft}function Dm(d,g,E,D,K){var ce=E._reactRootContainer;if(ce){var je=ce;if(typeof K=="function"){var Et=K;K=function(){var Ft=km(je);Et.call(Ft)}}ap(g,je,d,K)}else je=Lx(E,g,d,K,D);return km(je)}zi=function(d){switch(d.tag){case 3:var g=d.stateNode;if(g.current.memoizedState.isDehydrated){var E=cl(g.pendingLanes);E!==0&&(wl(g,E|1),Su(g,To()),(Jr&6)===0&&(Mp=To()+500,oe()))}break;case 13:xf(function(){var D=rn(d,1);if(D!==null){var K=Uu();ad(D,d,1,K)}}),Fp(d,1)}},mu=function(d){if(d.tag===13){var g=rn(d,134217728);if(g!==null){var E=Uu();ad(g,d,134217728,E)}Fp(d,134217728)}},ic=function(d){if(d.tag===13){var g=Id(d),E=rn(d,g);if(E!==null){var D=Uu();ad(E,d,g,D)}Fp(d,g)}},Jc=function(){return qi},yc=function(d,g){var E=qi;try{return qi=d,g()}finally{qi=E}},lt=function(d,g,E){switch(g){case"input":if(wr(d,E),g=E.name,E.type==="radio"&&g!=null){for(E=d;E.parentNode;)E=E.parentNode;for(E=E.querySelectorAll("input[name="+JSON.stringify(""+g)+'][type="radio"]'),g=0;g<E.length;g++){var D=E[g];if(D!==d&&D.form===d.form){var K=Yh(D);if(!K)throw Error(t(90));yn(D),wr(D,K)}}}break;case"textarea":Pn(d,E);break;case"select":g=E.value,g!=null&&Qn(d,!!E.multiple,g,!1)}},Rt=Np,Ot=xf;var Fm={usingClientEntryPoint:!1,Events:[Ia,Ac,Yh,ht,Lt,Np]},Om={findFiberByHostInstance:el,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},iy={bundleType:Om.bundleType,version:Om.version,rendererPackageName:Om.rendererPackageName,rendererConfig:Om.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ue.ReactCurrentDispatcher,findHostInstanceByFiber:function(d){return d=ma(d),d===null?null:d.stateNode},findFiberByHostInstance:Om.findFiberByHostInstance||Mm,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Mg=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Mg.isDisabled&&Mg.supportsFiber)try{Sa=Mg.inject(iy),ra=Mg}catch{}}return $h.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Fm,$h.createPortal=function(d,g){var E=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Nm(g))throw Error(t(200));return Dp(d,g,null,E)},$h.createRoot=function(d,g){if(!Nm(d))throw Error(t(299));var E=!1,D="",K=ry;return g!=null&&(g.unstable_strictMode===!0&&(E=!0),g.identifierPrefix!==void 0&&(D=g.identifierPrefix),g.onRecoverableError!==void 0&&(K=g.onRecoverableError)),g=ny(d,1,!1,null,null,E,!1,D,K),d[to]=g.current,ac(d.nodeType===8?d.parentNode:d),new kg(g)},$h.findDOMNode=function(d){if(d==null)return null;if(d.nodeType===1)return d;var g=d._reactInternals;if(g===void 0)throw typeof d.render=="function"?Error(t(188)):(d=Object.keys(d).join(","),Error(t(268,d)));return d=ma(g),d=d===null?null:d.stateNode,d},$h.flushSync=function(d){return xf(d)},$h.hydrate=function(d,g,E){if(!Op(g))throw Error(t(200));return Dm(null,d,g,!0,E)},$h.hydrateRoot=function(d,g,E){if(!Nm(d))throw Error(t(405));var D=E!=null&&E.hydratedSources||null,K=!1,ce="",je=ry;if(E!=null&&(E.unstable_strictMode===!0&&(K=!0),E.identifierPrefix!==void 0&&(ce=E.identifierPrefix),E.onRecoverableError!==void 0&&(je=E.onRecoverableError)),g=sl(g,null,d,1,E??null,K,!1,ce,je),d[to]=g.current,ac(d),D)for(d=0;d<D.length;d++)E=D[d],K=E._getVersion,K=K(E._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[E,K]:g.mutableSourceEagerHydrationData.push(E,K);return new Sf(g)},$h.render=function(d,g,E){if(!Op(g))throw Error(t(200));return Dm(null,d,g,!1,E)},$h.unmountComponentAtNode=function(d){if(!Op(d))throw Error(t(40));return d._reactRootContainer?(xf(function(){Dm(null,null,d,!1,function(){d._reactRootContainer=null,d[to]=null})}),!0):!1},$h.unstable_batchedUpdates=Np,$h.unstable_renderSubtreeIntoContainer=function(d,g,E,D){if(!Op(E))throw Error(t(200));if(d==null||d._reactInternals===void 0)throw Error(t(38));return Dm(d,g,E,!1,D)},$h.version="18.3.1-next-f1338f8080-20240426",$h}var E2;function iP(){if(E2)return lb.exports;E2=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),lb.exports=rP(),lb.exports}var A2;function oP(){if(A2)return u1;A2=1;var n=iP();return u1.createRoot=n.createRoot,u1.hydrateRoot=n.hydrateRoot,u1}var sP=oP();const aP=Yv(sP);/**
 * react-router v7.8.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var T2="popstate";function lP(n={}){function e(i,c){let{pathname:u,search:m,hash:_}=i.location;return p5("",{pathname:u,search:m,hash:_},c.state&&c.state.usr||null,c.state&&c.state.key||"default")}function t(i,c){return typeof c=="string"?c:i_(c)}return uP(e,t,null,n)}function ec(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function Xf(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function cP(){return Math.random().toString(36).substring(2,10)}function I2(n,e){return{usr:n.state,key:n.key,idx:e}}function p5(n,e,t=null,i){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof e=="string"?D0(e):e,state:t,key:e&&e.key||i||cP()}}function i_({pathname:n="/",search:e="",hash:t=""}){return e&&e!=="?"&&(n+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(n+=t.charAt(0)==="#"?t:"#"+t),n}function D0(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substring(t),n=n.substring(0,t));let i=n.indexOf("?");i>=0&&(e.search=n.substring(i),n=n.substring(0,i)),n&&(e.pathname=n)}return e}function uP(n,e,t,i={}){let{window:c=document.defaultView,v5Compat:u=!1}=i,m=c.history,_="POP",o=null,b=I();b==null&&(b=0,m.replaceState({...m.state,idx:b},""));function I(){return(m.state||{idx:null}).idx}function M(){_="POP";let de=I(),J=de==null?null:de-b;b=de,o&&o({action:_,location:se.location,delta:J})}function V(de,J){_="PUSH";let ne=p5(se.location,de,J);b=I()+1;let me=I2(ne,b),ue=se.createHref(ne);try{m.pushState(me,"",ue)}catch(ke){if(ke instanceof DOMException&&ke.name==="DataCloneError")throw ke;c.location.assign(ue)}u&&o&&o({action:_,location:se.location,delta:1})}function k(de,J){_="REPLACE";let ne=p5(se.location,de,J);b=I();let me=I2(ne,b),ue=se.createHref(ne);m.replaceState(me,"",ue),u&&o&&o({action:_,location:se.location,delta:0})}function ie(de){return hP(de)}let se={get action(){return _},get location(){return n(c,m)},listen(de){if(o)throw new Error("A history only accepts one active listener");return c.addEventListener(T2,M),o=de,()=>{c.removeEventListener(T2,M),o=null}},createHref(de){return e(c,de)},createURL:ie,encodeLocation(de){let J=ie(de);return{pathname:J.pathname,search:J.search,hash:J.hash}},push:V,replace:k,go(de){return m.go(de)}};return se}function hP(n,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),ec(t,"No window.location.(origin|href) available to create URL");let i=typeof n=="string"?n:i_(n);return i=i.replace(/ $/,"%20"),!e&&i.startsWith("//")&&(i=t+i),new URL(i,t)}function VT(n,e,t="/"){return dP(n,e,t,!1)}function dP(n,e,t,i){let c=typeof e=="string"?D0(e):e,u=Ep(c.pathname||"/",t);if(u==null)return null;let m=qT(n);fP(m);let _=null;for(let o=0;_==null&&o<m.length;++o){let b=EP(u);_=wP(m[o],b,i)}return _}function qT(n,e=[],t=[],i="",c=!1){let u=(m,_,o=c,b)=>{let I={relativePath:b===void 0?m.path||"":b,caseSensitive:m.caseSensitive===!0,childrenIndex:_,route:m};if(I.relativePath.startsWith("/")){if(!I.relativePath.startsWith(i)&&o)return;ec(I.relativePath.startsWith(i),`Absolute route path "${I.relativePath}" nested under path "${i}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),I.relativePath=I.relativePath.slice(i.length)}let M=xp([i,I.relativePath]),V=t.concat(I);m.children&&m.children.length>0&&(ec(m.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${M}".`),qT(m.children,e,V,M,o)),!(m.path==null&&!m.index)&&e.push({path:M,score:xP(M,m.index),routesMeta:V})};return n.forEach((m,_)=>{if(m.path===""||!m.path?.includes("?"))u(m,_);else for(let o of $T(m.path))u(m,_,!0,o)}),e}function $T(n){let e=n.split("/");if(e.length===0)return[];let[t,...i]=e,c=t.endsWith("?"),u=t.replace(/\?$/,"");if(i.length===0)return c?[u,""]:[u];let m=$T(i.join("/")),_=[];return _.push(...m.map(o=>o===""?u:[u,o].join("/"))),c&&_.push(...m),_.map(o=>n.startsWith("/")&&o===""?"/":o)}function fP(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:bP(e.routesMeta.map(i=>i.childrenIndex),t.routesMeta.map(i=>i.childrenIndex)))}var pP=/^:[\w-]+$/,mP=3,gP=2,yP=1,_P=10,vP=-2,C2=n=>n==="*";function xP(n,e){let t=n.split("/"),i=t.length;return t.some(C2)&&(i+=vP),e&&(i+=gP),t.filter(c=>!C2(c)).reduce((c,u)=>c+(pP.test(u)?mP:u===""?yP:_P),i)}function bP(n,e){return n.length===e.length&&n.slice(0,-1).every((i,c)=>i===e[c])?n[n.length-1]-e[e.length-1]:0}function wP(n,e,t=!1){let{routesMeta:i}=n,c={},u="/",m=[];for(let _=0;_<i.length;++_){let o=i[_],b=_===i.length-1,I=u==="/"?e:e.slice(u.length)||"/",M=fv({path:o.relativePath,caseSensitive:o.caseSensitive,end:b},I),V=o.route;if(!M&&b&&t&&!i[i.length-1].route.index&&(M=fv({path:o.relativePath,caseSensitive:o.caseSensitive,end:!1},I)),!M)return null;Object.assign(c,M.params),m.push({params:c,pathname:xp([u,M.pathname]),pathnameBase:CP(xp([u,M.pathnameBase])),route:V}),M.pathnameBase!=="/"&&(u=xp([u,M.pathnameBase]))}return m}function fv(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,i]=SP(n.path,n.caseSensitive,n.end),c=e.match(t);if(!c)return null;let u=c[0],m=u.replace(/(.)\/+$/,"$1"),_=c.slice(1);return{params:i.reduce((b,{paramName:I,isOptional:M},V)=>{if(I==="*"){let ie=_[V]||"";m=u.slice(0,u.length-ie.length).replace(/(.)\/+$/,"$1")}const k=_[V];return M&&!k?b[I]=void 0:b[I]=(k||"").replace(/%2F/g,"/"),b},{}),pathname:u,pathnameBase:m,pattern:n}}function SP(n,e=!1,t=!0){Xf(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let i=[],c="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(m,_,o)=>(i.push({paramName:_,isOptional:o!=null}),o?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return n.endsWith("*")?(i.push({paramName:"*"}),c+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?c+="\\/*$":n!==""&&n!=="/"&&(c+="(?:(?=\\/|$))"),[new RegExp(c,e?void 0:"i"),i]}function EP(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Xf(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),n}}function Ep(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,i=n.charAt(t);return i&&i!=="/"?null:n.slice(t)||"/"}function AP(n,e="/"){let{pathname:t,search:i="",hash:c=""}=typeof n=="string"?D0(n):n;return{pathname:t?t.startsWith("/")?t:TP(t,e):e,search:LP(i),hash:PP(c)}}function TP(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(c=>{c===".."?t.length>1&&t.pop():c!=="."&&t.push(c)}),t.length>1?t.join("/"):"/"}function hb(n,e,t,i){return`Cannot include a '${n}' character in a manually specified \`to.${e}\` field [${JSON.stringify(i)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function IP(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function GT(n){let e=IP(n);return e.map((t,i)=>i===e.length-1?t.pathname:t.pathnameBase)}function HT(n,e,t,i=!1){let c;typeof n=="string"?c=D0(n):(c={...n},ec(!c.pathname||!c.pathname.includes("?"),hb("?","pathname","search",c)),ec(!c.pathname||!c.pathname.includes("#"),hb("#","pathname","hash",c)),ec(!c.search||!c.search.includes("#"),hb("#","search","hash",c)));let u=n===""||c.pathname==="",m=u?"/":c.pathname,_;if(m==null)_=t;else{let M=e.length-1;if(!i&&m.startsWith("..")){let V=m.split("/");for(;V[0]==="..";)V.shift(),M-=1;c.pathname=V.join("/")}_=M>=0?e[M]:"/"}let o=AP(c,_),b=m&&m!=="/"&&m.endsWith("/"),I=(u||m===".")&&t.endsWith("/");return!o.pathname.endsWith("/")&&(b||I)&&(o.pathname+="/"),o}var xp=n=>n.join("/").replace(/\/\/+/g,"/"),CP=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),LP=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,PP=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function kP(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}var WT=["POST","PUT","PATCH","DELETE"];new Set(WT);var RP=["GET",...WT];new Set(RP);var F0=On.createContext(null);F0.displayName="DataRouter";var Jv=On.createContext(null);Jv.displayName="DataRouterState";On.createContext(!1);var KT=On.createContext({isTransitioning:!1});KT.displayName="ViewTransition";var MP=On.createContext(new Map);MP.displayName="Fetchers";var NP=On.createContext(null);NP.displayName="Await";var Jf=On.createContext(null);Jf.displayName="Navigation";var v_=On.createContext(null);v_.displayName="Location";var Qf=On.createContext({outlet:null,matches:[],isDataRoute:!1});Qf.displayName="Route";var mw=On.createContext(null);mw.displayName="RouteError";function DP(n,{relative:e}={}){ec(x_(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:i}=On.useContext(Jf),{hash:c,pathname:u,search:m}=b_(n,{relative:e}),_=u;return t!=="/"&&(_=u==="/"?t:xp([t,u])),i.createHref({pathname:_,search:m,hash:c})}function x_(){return On.useContext(v_)!=null}function gg(){return ec(x_(),"useLocation() may be used only in the context of a <Router> component."),On.useContext(v_).location}var XT="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function ZT(n){On.useContext(Jf).static||On.useLayoutEffect(n)}function FP(){let{isDataRoute:n}=On.useContext(Qf);return n?ZP():OP()}function OP(){ec(x_(),"useNavigate() may be used only in the context of a <Router> component.");let n=On.useContext(F0),{basename:e,navigator:t}=On.useContext(Jf),{matches:i}=On.useContext(Qf),{pathname:c}=gg(),u=JSON.stringify(GT(i)),m=On.useRef(!1);return ZT(()=>{m.current=!0}),On.useCallback((o,b={})=>{if(Xf(m.current,XT),!m.current)return;if(typeof o=="number"){t.go(o);return}let I=HT(o,JSON.parse(u),c,b.relative==="path");n==null&&e!=="/"&&(I.pathname=I.pathname==="/"?e:xp([e,I.pathname])),(b.replace?t.replace:t.push)(I,b.state,b)},[e,t,u,c,n])}On.createContext(null);function BP(){let{matches:n}=On.useContext(Qf),e=n[n.length-1];return e?e.params:{}}function b_(n,{relative:e}={}){let{matches:t}=On.useContext(Qf),{pathname:i}=gg(),c=JSON.stringify(GT(t));return On.useMemo(()=>HT(n,JSON.parse(c),i,e==="path"),[n,c,i,e])}function zP(n,e){return YT(n,e)}function YT(n,e,t,i){ec(x_(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:c}=On.useContext(Jf),{matches:u}=On.useContext(Qf),m=u[u.length-1],_=m?m.params:{},o=m?m.pathname:"/",b=m?m.pathnameBase:"/",I=m&&m.route;{let J=I&&I.path||"";JT(o,!I||J.endsWith("*")||J.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${o}" (under <Route path="${J}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${J}"> to <Route path="${J==="/"?"*":`${J}/*`}">.`)}let M=gg(),V;if(e){let J=typeof e=="string"?D0(e):e;ec(b==="/"||J.pathname?.startsWith(b),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${b}" but pathname "${J.pathname}" was given in the \`location\` prop.`),V=J}else V=M;let k=V.pathname||"/",ie=k;if(b!=="/"){let J=b.replace(/^\//,"").split("/");ie="/"+k.replace(/^\//,"").split("/").slice(J.length).join("/")}let se=VT(n,{pathname:ie});Xf(I||se!=null,`No routes matched location "${V.pathname}${V.search}${V.hash}" `),Xf(se==null||se[se.length-1].route.element!==void 0||se[se.length-1].route.Component!==void 0||se[se.length-1].route.lazy!==void 0,`Matched leaf route at location "${V.pathname}${V.search}${V.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let de=$P(se&&se.map(J=>Object.assign({},J,{params:Object.assign({},_,J.params),pathname:xp([b,c.encodeLocation?c.encodeLocation(J.pathname).pathname:J.pathname]),pathnameBase:J.pathnameBase==="/"?b:xp([b,c.encodeLocation?c.encodeLocation(J.pathnameBase).pathname:J.pathnameBase])})),u,t,i);return e&&de?On.createElement(v_.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...V},navigationType:"POP"}},de):de}function jP(){let n=XP(),e=kP(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,i="rgba(200,200,200, 0.5)",c={padding:"0.5rem",backgroundColor:i},u={padding:"2px 4px",backgroundColor:i},m=null;return console.error("Error handled by React Router default ErrorBoundary:",n),m=On.createElement(On.Fragment,null,On.createElement("p",null," Hey developer "),On.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",On.createElement("code",{style:u},"ErrorBoundary")," or"," ",On.createElement("code",{style:u},"errorElement")," prop on your route.")),On.createElement(On.Fragment,null,On.createElement("h2",null,"Unexpected Application Error!"),On.createElement("h3",{style:{fontStyle:"italic"}},e),t?On.createElement("pre",{style:c},t):null,m)}var UP=On.createElement(jP,null),VP=class extends On.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,e){return e.location!==n.location||e.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:e.error,location:e.location,revalidation:n.revalidation||e.revalidation}}componentDidCatch(n,e){console.error("React Router caught the following error during render",n,e)}render(){return this.state.error!==void 0?On.createElement(Qf.Provider,{value:this.props.routeContext},On.createElement(mw.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function qP({routeContext:n,match:e,children:t}){let i=On.useContext(F0);return i&&i.static&&i.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=e.route.id),On.createElement(Qf.Provider,{value:n},t)}function $P(n,e=[],t=null,i=null){if(n==null){if(!t)return null;if(t.errors)n=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let c=n,u=t?.errors;if(u!=null){let o=c.findIndex(b=>b.route.id&&u?.[b.route.id]!==void 0);ec(o>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(u).join(",")}`),c=c.slice(0,Math.min(c.length,o+1))}let m=!1,_=-1;if(t)for(let o=0;o<c.length;o++){let b=c[o];if((b.route.HydrateFallback||b.route.hydrateFallbackElement)&&(_=o),b.route.id){let{loaderData:I,errors:M}=t,V=b.route.loader&&!I.hasOwnProperty(b.route.id)&&(!M||M[b.route.id]===void 0);if(b.route.lazy||V){m=!0,_>=0?c=c.slice(0,_+1):c=[c[0]];break}}}return c.reduceRight((o,b,I)=>{let M,V=!1,k=null,ie=null;t&&(M=u&&b.route.id?u[b.route.id]:void 0,k=b.route.errorElement||UP,m&&(_<0&&I===0?(JT("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),V=!0,ie=null):_===I&&(V=!0,ie=b.route.hydrateFallbackElement||null)));let se=e.concat(c.slice(0,I+1)),de=()=>{let J;return M?J=k:V?J=ie:b.route.Component?J=On.createElement(b.route.Component,null):b.route.element?J=b.route.element:J=o,On.createElement(qP,{match:b,routeContext:{outlet:o,matches:se,isDataRoute:t!=null},children:J})};return t&&(b.route.ErrorBoundary||b.route.errorElement||I===0)?On.createElement(VP,{location:t.location,revalidation:t.revalidation,component:k,error:M,children:de(),routeContext:{outlet:null,matches:se,isDataRoute:!0}}):de()},null)}function gw(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function GP(n){let e=On.useContext(F0);return ec(e,gw(n)),e}function HP(n){let e=On.useContext(Jv);return ec(e,gw(n)),e}function WP(n){let e=On.useContext(Qf);return ec(e,gw(n)),e}function yw(n){let e=WP(n),t=e.matches[e.matches.length-1];return ec(t.route.id,`${n} can only be used on routes that contain a unique "id"`),t.route.id}function KP(){return yw("useRouteId")}function XP(){let n=On.useContext(mw),e=HP("useRouteError"),t=yw("useRouteError");return n!==void 0?n:e.errors?.[t]}function ZP(){let{router:n}=GP("useNavigate"),e=yw("useNavigate"),t=On.useRef(!1);return ZT(()=>{t.current=!0}),On.useCallback(async(c,u={})=>{Xf(t.current,XT),t.current&&(typeof c=="number"?n.navigate(c):await n.navigate(c,{fromRouteId:e,...u}))},[n,e])}var L2={};function JT(n,e,t){!e&&!L2[n]&&(L2[n]=!0,Xf(!1,t))}On.memo(YP);function YP({routes:n,future:e,state:t}){return YT(n,void 0,t,e)}function Wm(n){ec(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function JP({basename:n="/",children:e=null,location:t,navigationType:i="POP",navigator:c,static:u=!1}){ec(!x_(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let m=n.replace(/^\/*/,"/"),_=On.useMemo(()=>({basename:m,navigator:c,static:u,future:{}}),[m,c,u]);typeof t=="string"&&(t=D0(t));let{pathname:o="/",search:b="",hash:I="",state:M=null,key:V="default"}=t,k=On.useMemo(()=>{let ie=Ep(o,m);return ie==null?null:{location:{pathname:ie,search:b,hash:I,state:M,key:V},navigationType:i}},[m,o,b,I,M,V,i]);return Xf(k!=null,`<Router basename="${m}"> is not able to match the URL "${o}${b}${I}" because it does not start with the basename, so the <Router> won't render anything.`),k==null?null:On.createElement(Jf.Provider,{value:_},On.createElement(v_.Provider,{children:e,value:k}))}function QP({children:n,location:e}){return zP(m5(n),e)}function m5(n,e=[]){let t=[];return On.Children.forEach(n,(i,c)=>{if(!On.isValidElement(i))return;let u=[...e,c];if(i.type===On.Fragment){t.push.apply(t,m5(i.props.children,u));return}ec(i.type===Wm,`[${typeof i.type=="string"?i.type:i.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),ec(!i.props.index||!i.props.children,"An index route cannot have child routes.");let m={id:i.props.id||u.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,loader:i.props.loader,action:i.props.action,hydrateFallbackElement:i.props.hydrateFallbackElement,HydrateFallback:i.props.HydrateFallback,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.hasErrorBoundary===!0||i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(m.children=m5(i.props.children,u)),t.push(m)}),t}var O1="get",B1="application/x-www-form-urlencoded";function Qv(n){return n!=null&&typeof n.tagName=="string"}function e7(n){return Qv(n)&&n.tagName.toLowerCase()==="button"}function t7(n){return Qv(n)&&n.tagName.toLowerCase()==="form"}function n7(n){return Qv(n)&&n.tagName.toLowerCase()==="input"}function r7(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function i7(n,e){return n.button===0&&(!e||e==="_self")&&!r7(n)}var h1=null;function o7(){if(h1===null)try{new FormData(document.createElement("form"),0),h1=!1}catch{h1=!0}return h1}var s7=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function db(n){return n!=null&&!s7.has(n)?(Xf(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${B1}"`),null):n}function a7(n,e){let t,i,c,u,m;if(t7(n)){let _=n.getAttribute("action");i=_?Ep(_,e):null,t=n.getAttribute("method")||O1,c=db(n.getAttribute("enctype"))||B1,u=new FormData(n)}else if(e7(n)||n7(n)&&(n.type==="submit"||n.type==="image")){let _=n.form;if(_==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let o=n.getAttribute("formaction")||_.getAttribute("action");if(i=o?Ep(o,e):null,t=n.getAttribute("formmethod")||_.getAttribute("method")||O1,c=db(n.getAttribute("formenctype"))||db(_.getAttribute("enctype"))||B1,u=new FormData(_,n),!o7()){let{name:b,type:I,value:M}=n;if(I==="image"){let V=b?`${b}.`:"";u.append(`${V}x`,"0"),u.append(`${V}y`,"0")}else b&&u.append(b,M)}}else{if(Qv(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=O1,i=null,c=B1,m=n}return u&&c==="text/plain"&&(m=u,u=void 0),{action:i,method:t.toLowerCase(),encType:c,formData:u,body:m}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function _w(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function l7(n,e,t){let i=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return i.pathname==="/"?i.pathname=`_root.${t}`:e&&Ep(i.pathname,e)==="/"?i.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:i.pathname=`${i.pathname.replace(/\/$/,"")}.${t}`,i}async function c7(n,e){if(n.id in e)return e[n.id];try{let t=await import(n.module);return e[n.id]=t,t}catch(t){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function u7(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function h7(n,e,t){let i=await Promise.all(n.map(async c=>{let u=e.routes[c.route.id];if(u){let m=await c7(u,t);return m.links?m.links():[]}return[]}));return m7(i.flat(1).filter(u7).filter(c=>c.rel==="stylesheet"||c.rel==="preload").map(c=>c.rel==="stylesheet"?{...c,rel:"prefetch",as:"style"}:{...c,rel:"prefetch"}))}function P2(n,e,t,i,c,u){let m=(o,b)=>t[b]?o.route.id!==t[b].route.id:!0,_=(o,b)=>t[b].pathname!==o.pathname||t[b].route.path?.endsWith("*")&&t[b].params["*"]!==o.params["*"];return u==="assets"?e.filter((o,b)=>m(o,b)||_(o,b)):u==="data"?e.filter((o,b)=>{let I=i.routes[o.route.id];if(!I||!I.hasLoader)return!1;if(m(o,b)||_(o,b))return!0;if(o.route.shouldRevalidate){let M=o.route.shouldRevalidate({currentUrl:new URL(c.pathname+c.search+c.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(n,window.origin),nextParams:o.params,defaultShouldRevalidate:!0});if(typeof M=="boolean")return M}return!0}):[]}function d7(n,e,{includeHydrateFallback:t}={}){return f7(n.map(i=>{let c=e.routes[i.route.id];if(!c)return[];let u=[c.module];return c.clientActionModule&&(u=u.concat(c.clientActionModule)),c.clientLoaderModule&&(u=u.concat(c.clientLoaderModule)),t&&c.hydrateFallbackModule&&(u=u.concat(c.hydrateFallbackModule)),c.imports&&(u=u.concat(c.imports)),u}).flat(1))}function f7(n){return[...new Set(n)]}function p7(n){let e={},t=Object.keys(n).sort();for(let i of t)e[i]=n[i];return e}function m7(n,e){let t=new Set;return new Set(e),n.reduce((i,c)=>{let u=JSON.stringify(p7(c));return t.has(u)||(t.add(u),i.push({key:u,link:c})),i},[])}function QT(){let n=On.useContext(F0);return _w(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function g7(){let n=On.useContext(Jv);return _w(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var vw=On.createContext(void 0);vw.displayName="FrameworkContext";function e6(){let n=On.useContext(vw);return _w(n,"You must render this element inside a <HydratedRouter> element"),n}function y7(n,e){let t=On.useContext(vw),[i,c]=On.useState(!1),[u,m]=On.useState(!1),{onFocus:_,onBlur:o,onMouseEnter:b,onMouseLeave:I,onTouchStart:M}=e,V=On.useRef(null);On.useEffect(()=>{if(n==="render"&&m(!0),n==="viewport"){let se=J=>{J.forEach(ne=>{m(ne.isIntersecting)})},de=new IntersectionObserver(se,{threshold:.5});return V.current&&de.observe(V.current),()=>{de.disconnect()}}},[n]),On.useEffect(()=>{if(i){let se=setTimeout(()=>{m(!0)},100);return()=>{clearTimeout(se)}}},[i]);let k=()=>{c(!0)},ie=()=>{c(!1),m(!1)};return t?n!=="intent"?[u,V,{}]:[u,V,{onFocus:Sy(_,k),onBlur:Sy(o,ie),onMouseEnter:Sy(b,k),onMouseLeave:Sy(I,ie),onTouchStart:Sy(M,k)}]:[!1,V,{}]}function Sy(n,e){return t=>{n&&n(t),t.defaultPrevented||e(t)}}function _7({page:n,...e}){let{router:t}=QT(),i=On.useMemo(()=>VT(t.routes,n,t.basename),[t.routes,n,t.basename]);return i?On.createElement(x7,{page:n,matches:i,...e}):null}function v7(n){let{manifest:e,routeModules:t}=e6(),[i,c]=On.useState([]);return On.useEffect(()=>{let u=!1;return h7(n,e,t).then(m=>{u||c(m)}),()=>{u=!0}},[n,e,t]),i}function x7({page:n,matches:e,...t}){let i=gg(),{manifest:c,routeModules:u}=e6(),{basename:m}=QT(),{loaderData:_,matches:o}=g7(),b=On.useMemo(()=>P2(n,e,o,c,i,"data"),[n,e,o,c,i]),I=On.useMemo(()=>P2(n,e,o,c,i,"assets"),[n,e,o,c,i]),M=On.useMemo(()=>{if(n===i.pathname+i.search+i.hash)return[];let ie=new Set,se=!1;if(e.forEach(J=>{let ne=c.routes[J.route.id];!ne||!ne.hasLoader||(!b.some(me=>me.route.id===J.route.id)&&J.route.id in _&&u[J.route.id]?.shouldRevalidate||ne.hasClientLoader?se=!0:ie.add(J.route.id))}),ie.size===0)return[];let de=l7(n,m,"data");return se&&ie.size>0&&de.searchParams.set("_routes",e.filter(J=>ie.has(J.route.id)).map(J=>J.route.id).join(",")),[de.pathname+de.search]},[m,_,i,c,b,e,n,u]),V=On.useMemo(()=>d7(I,c),[I,c]),k=v7(I);return On.createElement(On.Fragment,null,M.map(ie=>On.createElement("link",{key:ie,rel:"prefetch",as:"fetch",href:ie,...t})),V.map(ie=>On.createElement("link",{key:ie,rel:"modulepreload",href:ie,...t})),k.map(({key:ie,link:se})=>On.createElement("link",{key:ie,nonce:t.nonce,...se})))}function b7(...n){return e=>{n.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var t6=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{t6&&(window.__reactRouterVersion="7.8.1")}catch{}function w7({basename:n,children:e,window:t}){let i=On.useRef();i.current==null&&(i.current=lP({window:t,v5Compat:!0}));let c=i.current,[u,m]=On.useState({action:c.action,location:c.location}),_=On.useCallback(o=>{On.startTransition(()=>m(o))},[m]);return On.useLayoutEffect(()=>c.listen(_),[c,_]),On.createElement(JP,{basename:n,children:e,location:u.location,navigationType:u.action,navigator:c})}var n6=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,r6=On.forwardRef(function({onClick:e,discover:t="render",prefetch:i="none",relative:c,reloadDocument:u,replace:m,state:_,target:o,to:b,preventScrollReset:I,viewTransition:M,...V},k){let{basename:ie}=On.useContext(Jf),se=typeof b=="string"&&n6.test(b),de,J=!1;if(typeof b=="string"&&se&&(de=b,t6))try{let F=new URL(window.location.href),q=b.startsWith("//")?new URL(F.protocol+b):new URL(b),j=Ep(q.pathname,ie);q.origin===F.origin&&j!=null?b=j+q.search+q.hash:J=!0}catch{Xf(!1,`<Link to="${b}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let ne=DP(b,{relative:c}),[me,ue,ke]=y7(i,V),ze=T7(b,{replace:m,state:_,target:o,preventScrollReset:I,relative:c,viewTransition:M});function pe(F){e&&e(F),F.defaultPrevented||ze(F)}let U=On.createElement("a",{...V,...ke,href:de||ne,onClick:J||u?e:pe,ref:b7(k,ue),target:o,"data-discover":!se&&t==="render"?"true":void 0});return me&&!se?On.createElement(On.Fragment,null,U,On.createElement(_7,{page:ne})):U});r6.displayName="Link";var S7=On.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:i="",end:c=!1,style:u,to:m,viewTransition:_,children:o,...b},I){let M=b_(m,{relative:b.relative}),V=gg(),k=On.useContext(Jv),{navigator:ie,basename:se}=On.useContext(Jf),de=k!=null&&k7(M)&&_===!0,J=ie.encodeLocation?ie.encodeLocation(M).pathname:M.pathname,ne=V.pathname,me=k&&k.navigation&&k.navigation.location?k.navigation.location.pathname:null;t||(ne=ne.toLowerCase(),me=me?me.toLowerCase():null,J=J.toLowerCase()),me&&se&&(me=Ep(me,se)||me);const ue=J!=="/"&&J.endsWith("/")?J.length-1:J.length;let ke=ne===J||!c&&ne.startsWith(J)&&ne.charAt(ue)==="/",ze=me!=null&&(me===J||!c&&me.startsWith(J)&&me.charAt(J.length)==="/"),pe={isActive:ke,isPending:ze,isTransitioning:de},U=ke?e:void 0,F;typeof i=="function"?F=i(pe):F=[i,ke?"active":null,ze?"pending":null,de?"transitioning":null].filter(Boolean).join(" ");let q=typeof u=="function"?u(pe):u;return On.createElement(r6,{...b,"aria-current":U,className:F,ref:I,style:q,to:m,viewTransition:_},typeof o=="function"?o(pe):o)});S7.displayName="NavLink";var E7=On.forwardRef(({discover:n="render",fetcherKey:e,navigate:t,reloadDocument:i,replace:c,state:u,method:m=O1,action:_,onSubmit:o,relative:b,preventScrollReset:I,viewTransition:M,...V},k)=>{let ie=L7(),se=P7(_,{relative:b}),de=m.toLowerCase()==="get"?"get":"post",J=typeof _=="string"&&n6.test(_),ne=me=>{if(o&&o(me),me.defaultPrevented)return;me.preventDefault();let ue=me.nativeEvent.submitter,ke=ue?.getAttribute("formmethod")||m;ie(ue||me.currentTarget,{fetcherKey:e,method:ke,navigate:t,replace:c,state:u,relative:b,preventScrollReset:I,viewTransition:M})};return On.createElement("form",{ref:k,method:de,action:se,onSubmit:i?o:ne,...V,"data-discover":!J&&n==="render"?"true":void 0})});E7.displayName="Form";function A7(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function i6(n){let e=On.useContext(F0);return ec(e,A7(n)),e}function T7(n,{target:e,replace:t,state:i,preventScrollReset:c,relative:u,viewTransition:m}={}){let _=FP(),o=gg(),b=b_(n,{relative:u});return On.useCallback(I=>{if(i7(I,e)){I.preventDefault();let M=t!==void 0?t:i_(o)===i_(b);_(n,{replace:M,state:i,preventScrollReset:c,relative:u,viewTransition:m})}},[o,_,b,t,i,e,n,c,u,m])}var I7=0,C7=()=>`__${String(++I7)}__`;function L7(){let{router:n}=i6("useSubmit"),{basename:e}=On.useContext(Jf),t=KP();return On.useCallback(async(i,c={})=>{let{action:u,method:m,encType:_,formData:o,body:b}=a7(i,e);if(c.navigate===!1){let I=c.fetcherKey||C7();await n.fetch(I,t,c.action||u,{preventScrollReset:c.preventScrollReset,formData:o,body:b,formMethod:c.method||m,formEncType:c.encType||_,flushSync:c.flushSync})}else await n.navigate(c.action||u,{preventScrollReset:c.preventScrollReset,formData:o,body:b,formMethod:c.method||m,formEncType:c.encType||_,replace:c.replace,state:c.state,fromRouteId:t,flushSync:c.flushSync,viewTransition:c.viewTransition})},[n,e,t])}function P7(n,{relative:e}={}){let{basename:t}=On.useContext(Jf),i=On.useContext(Qf);ec(i,"useFormAction must be used inside a RouteContext");let[c]=i.matches.slice(-1),u={...b_(n||".",{relative:e})},m=gg();if(n==null){u.search=m.search;let _=new URLSearchParams(u.search),o=_.getAll("index");if(o.some(I=>I==="")){_.delete("index"),o.filter(M=>M).forEach(M=>_.append("index",M));let I=_.toString();u.search=I?`?${I}`:""}}return(!n||n===".")&&c.route.index&&(u.search=u.search?u.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(u.pathname=u.pathname==="/"?t:xp([t,u.pathname])),i_(u)}function k7(n,{relative:e}={}){let t=On.useContext(KT);ec(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=i6("useViewTransitionState"),c=b_(n,{relative:e});if(!t.isTransitioning)return!1;let u=Ep(t.currentLocation.pathname,i)||t.currentLocation.pathname,m=Ep(t.nextLocation.pathname,i)||t.nextLocation.pathname;return fv(c.pathname,m)!=null||fv(c.pathname,u)!=null}var z1={exports:{}},R7=z1.exports,k2;function M7(){return k2||(k2=1,(function(n,e){var t={};(function(i,c){n.exports=c()})(R7,(function(){var i,c,u;function m(o,b){if(!i)i=b;else if(!c)c=b;else{var I="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+i+")(sharedChunk); ("+c+")(sharedChunk); self.onerror = null;",M={};i(M),u=b(M),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(u.workerUrl=window.URL.createObjectURL(new Blob([I],{type:"text/javascript"})))}}m(["exports"],(function(o){var b=typeof self<"u"?self:{},I="2.15.0";let M;const V={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(M==null){const s=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{M=t.API_URL_REGEX!=null?new RegExp(t.API_URL_REGEX):s}catch{M=s}}return M},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!V.API_URL)return null;try{const s=new URL(V.API_URL);return s.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":s.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},k={supported:!1,testSupport:function(s){!de&&se&&(J?ne(s):ie=s)}};let ie,se,de=!1,J=!1;function ne(s){const r=s.createTexture();s.bindTexture(s.TEXTURE_2D,r);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,se),s.isContextLost())return;k.supported=!0}catch{}s.deleteTexture(r),de=!0}b.document&&(se=b.document.createElement("img"),se.onload=function(){ie&&ne(ie),ie=null,J=!0},se.onerror=function(){de=!0,ie=null},se.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const me="01";function ue(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var ke=ze;function ze(s,r,l,h){this.cx=3*s,this.bx=3*(l-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(h-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=r,this.p2x=l,this.p2y=h}ze.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,r){if(r===void 0&&(r=1e-6),s<0)return 0;if(s>1)return 1;for(var l=s,h=0;h<8;h++){var p=this.sampleCurveX(l)-s;if(Math.abs(p)<r)return l;var x=this.sampleCurveDerivativeX(l);if(Math.abs(x)<1e-6)break;l-=p/x}var w=0,A=1;for(l=s,h=0;h<20&&(p=this.sampleCurveX(l),!(Math.abs(p-s)<r));h++)s>p?w=l:A=l,l=.5*(A-w)+w;return l},solve:function(s,r){return this.sampleCurveY(this.solveCurveX(s,r))}};var pe=ue(ke),U=F;function F(s,r){this.x=s,this.y=r}F.prototype={clone:function(){return new F(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,r){return this.clone()._rotateAround(s,r)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var r=s.x-this.x,l=s.y-this.y;return r*r+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,r){return Math.atan2(this.x*r-this.y*s,this.x*s+this.y*r)},_matMult:function(s){var r=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=r,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var r=Math.cos(s),l=Math.sin(s),h=l*this.x+r*this.y;return this.x=r*this.x-l*this.y,this.y=h,this},_rotateAround:function(s,r){var l=Math.cos(s),h=Math.sin(s),p=r.y+h*(this.x-r.x)+l*(this.y-r.y);return this.x=r.x+l*(this.x-r.x)-h*(this.y-r.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},F.convert=function(s){return s instanceof F?s:Array.isArray(s)?new F(s[0],s[1]):s};var q=ue(U);const j=Math.PI/180,H=180/Math.PI;function Z(s){return s*j}function be(s){return s*H}const Re=[[0,0],[1,0],[1,1],[0,1]];function Oe(s){if(s<=0)return 0;if(s>=1)return 1;const r=s*s,l=r*s;return 4*(s<.5?l:3*(s-r)+l-.75)}function Me(s,r,l,h){const p=new pe(s,r,l,h);return function(x){return p.solve(x)}}const we=Me(.25,.1,.25,1);function De(s,r,l){return Math.min(l,Math.max(r,s))}function tt(s,r,l){return(l=De((l-s)/(r-s),0,1))*l*(3-2*l)}function xe(s,r,l){const h=l-r,p=((s-r)%h+h)%h+r;return p===r?l:p}function le(s,r,l){if(!s.length)return l(null,[]);let h=s.length;const p=new Array(s.length);let x=null;s.forEach(((w,A)=>{r(w,((P,R)=>{P&&(x=P),p[A]=R,--h==0&&l(x,p)}))}))}function Ne(s){const r=[];for(const l in s)r.push(s[l]);return r}function Be(s,...r){for(const l of r)for(const h in l)s[h]=l[h];return s}let Qe=1;function rt(){return Qe++}function gt(){return(function s(r){return r?(r^Math.random()*(16>>r/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)})()}function pt(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function Mt(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)}function Jt(s,r){s.forEach((l=>{r[l]&&(r[l]=r[l].bind(r))}))}function hn(s,r){return s.indexOf(r,s.length-r.length)!==-1}function yn(s,r,l){const h={};for(const p in s)h[p]=r.call(this,s[p],p,s);return h}function Mn(s,r,l){const h={};for(const p in s)r.call(l||this,s[p],p,s)&&(h[p]=s[p]);return h}function Gt(s){return Array.isArray(s)?s.map(Gt):typeof s=="object"&&s?yn(s,Gt):s}const ot={};function dr(s){ot[s]||(typeof console<"u"&&console.warn(s),ot[s]=!0)}function wr(s,r,l){return(l.y-s.y)*(r.x-s.x)>(r.y-s.y)*(l.x-s.x)}function Cr(s){let r=0;for(let l,h,p=0,x=s.length,w=x-1;p<x;w=p++)l=s[p],h=s[w],r+=(h.x-l.x)*(l.y+h.y);return r}function Ln(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function ir(s){const r={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((l,h,p,x)=>{const w=p||x;return r[h]=!w||w.toLowerCase(),""})),r["max-age"]){const l=parseInt(r["max-age"],10);isNaN(l)?delete r["max-age"]:r["max-age"]=l}return r}let Qn=null;function Kr(s){if(Qn==null){const r=s.navigator?s.navigator.userAgent:null;Qn=!!s.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return Qn}function qt(s){try{const r=b[s];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch{return!1}}function Pn(s,r){return[s[4*r],s[4*r+1],s[4*r+2],s[4*r+3]]}const Hn="mapbox-tiles";let Bn=500,Rr=50,vr,Tr;function Ir(){try{return b.caches}catch{}}function Pr(){Ir()&&!vr&&(vr=b.caches.open(Hn))}function Si(s){const r=s.indexOf("?");if(r<0)return s;const l=(function(p){const x=p.indexOf("?");return x>0?p.slice(x+1).split("&"):[]})(s),h=l.filter((p=>{const x=p.split("=");return x[0]==="language"||x[0]==="worldview"}));return h.length?`${s.slice(0,r)}?${h.join("&")}`:s.slice(0,r)}let ki=1/0;const or={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(or);class oi extends Error{constructor(r,l,h){l===401&&Rt(h)&&(r+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(r),this.status=l,this.url=h}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Gr=Ln()?()=>self.worker&&self.worker.referrer:()=>(b.location.protocol==="blob:"?b.parent:b).location.href,Or=function(s,r){if(!(/^file:/.test(l=s.url)||/^file:/.test(Gr())&&!/^\w+:/.test(l))){if(b.fetch&&b.Request&&b.AbortController&&b.Request.prototype.hasOwnProperty("signal"))return(function(h,p){const x=new b.AbortController,w=new b.Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:Gr(),referrerPolicy:h.referrerPolicy,signal:x.signal});let A=!1,P=!1;const R=($=w.url).indexOf("sku=")>0&&Rt($);var $;h.type==="json"&&w.headers.set("Accept","application/json");const X=(he,ye,Se)=>{if(P)return;if(he&&he.message!=="SecurityError"&&dr(he.toString()),ye&&Se)return re(ye);const Ke=Date.now();b.fetch(w).then((at=>{if(at.ok){const xt=R?at.clone():null;return re(at,xt,Ke)}return p(new oi(at.statusText,at.status,h.url))})).catch((at=>{at.name!=="AbortError"&&p(new Error(`${at.message} ${h.url}`))}))},re=(he,ye,Se)=>{(h.type==="arrayBuffer"?he.arrayBuffer():h.type==="json"?he.json():he.text()).then((Ke=>{P||(ye&&Se&&(function(at,xt,ct){if(Pr(),!vr)return;const _t={status:xt.status,statusText:xt.statusText,headers:new b.Headers};xt.headers.forEach(((sn,tn)=>_t.headers.set(tn,sn)));const Ct=ir(xt.headers.get("Cache-Control")||"");if(Ct["no-store"])return;Ct["max-age"]&&_t.headers.set("Expires",new Date(ct+1e3*Ct["max-age"]).toUTCString());const It=_t.headers.get("Expires");It&&(new Date(It).getTime()-ct<42e4||(function(sn,tn){if(Tr===void 0)try{new Response(new ReadableStream),Tr=!0}catch{Tr=!1}Tr?tn(sn.body):sn.blob().then(tn)})(xt,(sn=>{const tn=new b.Response(sn,_t);Pr(),vr&&vr.then((Sn=>Sn.put(Si(at.url),tn))).catch((Sn=>dr(Sn.message)))})))})(w,ye,Se),A=!0,p(null,Ke,he.headers.get("Cache-Control"),he.headers.get("Expires")))})).catch((Ke=>{P||p(new Error(Ke.message))}))};return R?(function(he,ye){if(Pr(),!vr)return ye(null);const Se=Si(he.url);vr.then((Ke=>{Ke.match(Se).then((at=>{const xt=(function(ct){if(!ct)return!1;const _t=new Date(ct.headers.get("Expires")||0),Ct=ir(ct.headers.get("Cache-Control")||"");return _t>Date.now()&&!Ct["no-cache"]})(at);Ke.delete(Se),xt&&Ke.put(Se,at.clone()),ye(null,at,xt)})).catch(ye)})).catch(ye)})(w,X):X(null,null),{cancel:()=>{P=!0,A||x.abort()}}})(s,r);if(Ln()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,r,void 0,!0)}var l;return(function(h,p){const x=new b.XMLHttpRequest;x.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(x.responseType="arraybuffer");for(const w in h.headers)x.setRequestHeader(w,h.headers[w]);return h.type==="json"&&(x.responseType="text",x.setRequestHeader("Accept","application/json")),x.withCredentials=h.credentials==="include",x.onerror=()=>{p(new Error(x.statusText))},x.onload=()=>{if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let w=x.response;if(h.type==="json")try{w=JSON.parse(x.response)}catch(A){return p(A)}p(null,w,x.getResponseHeader("Cache-Control"),x.getResponseHeader("Expires"))}else p(new oi(x.statusText,x.status,h.url))},x.send(h.body),{cancel:()=>x.abort()}})(s,r)},hi=function(s,r){return Or(Be(s,{type:"arrayBuffer"}),r)};function si(s){const r=b.document.createElement("a");return r.href=s,r.protocol===b.document.location.protocol&&r.host===b.document.location.host}const lt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ee,Te;Ee=[],Te=0;const et=function(s,r){if(k.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),Te>=V.MAX_PARALLEL_IMAGE_REQUESTS){const x={requestParameters:s,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return Ee.push(x),x}Te++;let l=!1;const h=()=>{if(!l)for(l=!0,Te--;Ee.length&&Te<V.MAX_PARALLEL_IMAGE_REQUESTS;){const x=Ee.shift(),{requestParameters:w,callback:A,cancelled:P}=x;P||(x.cancel=et(w,A).cancel)}},p=hi(s,((x,w,A,P)=>{h(),x?r(x):w&&(b.createImageBitmap?(function(R,$){const X=new b.Blob([new Uint8Array(R)],{type:"image/png"});b.createImageBitmap(X).then((re=>{$(null,re)})).catch((re=>{$(new Error(`Could not load image because of ${re.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))})(w,((R,$)=>r(R,$,A,P))):(function(R,$){const X=new b.Image,re=b.URL;X.onload=()=>{$(null,X),re.revokeObjectURL(X.src),X.onload=null,b.requestAnimationFrame((()=>{X.src=lt}))},X.onerror=()=>$(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const he=new b.Blob([new Uint8Array(R)],{type:"image/png"});X.src=R.byteLength?re.createObjectURL(he):lt})(w,((R,$)=>r(R,$,A,P))))}));return{cancel:()=>{p.cancel(),h()}}},ht="NO_ACCESS_TOKEN";function Lt(s){return s.indexOf("mapbox:")===0}function Rt(s){return V.API_URL_REGEX.test(s)}function Ot(s){return V.API_CDN_URL_REGEX.test(s)}function At(s){return V.API_STYLE_REGEX.test(s)&&!Pt(s)}function Pt(s){return V.API_SPRITE_REGEX.test(s)}const xn=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Un(s){const r=s.match(xn);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function In(s){const r=s.params.length?`?${s.params.join("&")}`:"";return`${s.protocol}://${s.authority}${s.path}${r}`}const kr="mapbox.eventData";function Lr(s){if(!s)return null;const r=s.split(".");if(!r||r.length!==3)return null;try{return JSON.parse(decodeURIComponent(b.atob(r[1]).split("").map((l=>"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2))).join("")))}catch{return null}}class jr{constructor(r){this.type=r,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const l=Lr(V.ACCESS_TOKEN);let h="";return h=l&&l.u?b.btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,((p,x)=>String.fromCharCode(+("0x"+x))))):V.ACCESS_TOKEN||"",r?`${kr}.${r}:${h}`:`${kr}:${h}`}fetchEventData(){const r=qt("localStorage"),l=this.getStorageKey(),h=this.getStorageKey("uuid");if(r)try{const p=b.localStorage.getItem(l);p&&(this.eventData=JSON.parse(p));const x=b.localStorage.getItem(h);x&&(this.anonId=x)}catch{dr("Unable to read from LocalStorage")}}saveEventData(){const r=qt("localStorage"),l=this.getStorageKey(),h=this.getStorageKey("uuid");if(r)try{b.localStorage.setItem(h,this.anonId),Object.keys(this.eventData).length>=1&&b.localStorage.setItem(l,JSON.stringify(this.eventData))}catch{dr("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,l,h,p){if(!V.EVENTS_URL)return;const x=Un(V.EVENTS_URL);x.params.push(`access_token=${p||V.ACCESS_TOKEN||""}`);const w={event:this.type,created:new Date(r).toISOString()},A=l?Be(w,l):w,P={url:In(x),headers:{"Content-Type":"text/plain"},body:JSON.stringify([A])};this.pendingRequest=(function(R,$){return Or(Be(R,{method:"POST"}),$)})(P,(R=>{this.pendingRequest=null,h(R),this.saveEventData(),this.processRequests(p)}))}queueRequest(r,l){this.queue.push(r),this.processRequests(l)}}const Er=new class extends jr{constructor(s){super("appUserTurnstile"),this._customAccessToken=s}postTurnstileEvent(s,r){V.EVENTS_URL&&V.ACCESS_TOKEN&&Array.isArray(s)&&s.some((l=>Lt(l)||Rt(l)))&&this.queueRequest(Date.now(),r)}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=Lr(V.ACCESS_TOKEN),l=r?r.u:V.ACCESS_TOKEN;let h=l!==this.eventData.tokenU;Mt(this.anonId)||(this.anonId=gt(),h=!0);const p=this.queue.shift();if(this.eventData.lastSuccess){const x=new Date(this.eventData.lastSuccess),w=new Date(p),A=(p-this.eventData.lastSuccess)/864e5;h=h||A>=1||A<-1||x.getDate()!==w.getDate()}else h=!0;h?this.postEvent(p,{sdkIdentifier:"mapbox-gl-js",sdkVersion:I,skuId:me,"enabled.telemetry":!1,userId:this.anonId},(x=>{x||(this.eventData.lastSuccess=p,this.eventData.tokenU=l)}),s):this.processRequests()}},Ei=Er.postTurnstileEvent.bind(Er),oo=new class extends jr{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(s,r,l,h){this.skuToken=r,this.errorCb=h,V.EVENTS_URL&&(l||V.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},l):this.errorCb(new Error(ht)))}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:l}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),Mt(this.anonId)||(this.anonId=gt()),this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:I,skuId:me,skuToken:this.skuToken,userId:this.anonId},(h=>{h?this.errorCb(h):r&&(this.success[r]=!0)}),s))}},_o=oo.postMapLoadEvent.bind(oo),Ho=new class extends jr{constructor(){super("gljs.performance")}postPerformanceEvent(s,r){V.EVENTS_URL&&(s||V.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:r},s)}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:r,performanceData:l}=this.queue.shift(),h=(function(p){const x=b.performance.getEntriesByType("resource"),w=b.performance.getEntriesByType("mark"),A=(function(re){const he={};if(re){for(const ye in re)if(ye!=="other")for(const Se of re[ye]){const Ke=`${ye}ResolveRangeMin`,at=`${ye}ResolveRangeMax`,xt=`${ye}RequestCount`,ct=`${ye}RequestCachedCount`;he[Ke]=Math.min(he[Ke]||1/0,Se.startTime),he[at]=Math.max(he[at]||-1/0,Se.responseEnd);const _t=Ct=>{he[Ct]===void 0&&(he[Ct]=0),++he[Ct]};Se.transferSize!==void 0&&Se.transferSize===0&&_t(ct),_t(xt)}}return he})((function(re,he){const ye={};if(re)for(const Se of re){const Ke=he(Se);ye[Ke]===void 0&&(ye[Ke]=[]),ye[Ke].push(Se)}return ye})(x,ll)),P=b.devicePixelRatio,R=b.navigator.connection||b.navigator.mozConnection||b.navigator.webkitConnection,$={counters:[],metadata:[],attributes:[]},X=(re,he,ye)=>{ye!=null&&re.push({name:he,value:ye.toString()})};for(const re in A)X($.counters,re,A[re]);if(p.interactionRange[0]!==1/0&&p.interactionRange[1]!==-1/0&&(X($.counters,"interactionRangeMin",p.interactionRange[0]),X($.counters,"interactionRangeMax",p.interactionRange[1])),w)for(const re of Object.keys(ma)){const he=ma[re],ye=w.find((Se=>Se.name===he));ye&&X($.counters,he,ye.startTime)}return X($.counters,"visibilityHidden",p.visibilityHidden),X($.attributes,"style",(function(re){if(re)for(const he of re){const ye=he.name.split("?")[0];if(At(ye)){const Se=ye.split("/").slice(-2);if(Se.length===2)return`mapbox://styles/${Se[0]}/${Se[1]}`}}})(x)),X($.attributes,"terrainEnabled",p.terrainEnabled?"true":"false"),X($.attributes,"fogEnabled",p.fogEnabled?"true":"false"),X($.attributes,"projection",p.projection),X($.attributes,"zoom",p.zoom),X($.metadata,"devicePixelRatio",P),X($.metadata,"connectionEffectiveType",R?R.effectiveType:void 0),X($.metadata,"navigatorUserAgent",b.navigator.userAgent),X($.metadata,"screenWidth",b.screen.width),X($.metadata,"screenHeight",b.screen.height),X($.metadata,"windowWidth",b.innerWidth),X($.metadata,"windowHeight",b.innerHeight),X($.metadata,"mapWidth",p.width/P),X($.metadata,"mapHeight",p.height/P),X($.metadata,"webglRenderer",p.renderer),X($.metadata,"webglVendor",p.vendor),X($.metadata,"sdkVersion",I),X($.metadata,"sdkIdentifier","mapbox-gl-js"),$})(l);for(const p of h.metadata);for(const p of h.counters);for(const p of h.attributes);this.postEvent(r,h,(()=>{}),s)}},so=Ho.postPerformanceEvent.bind(Ho),_s=new class extends jr{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(s,r,l,h){if(!V.API_URL||!V.SESSION_PATH)return;const p=Un(V.API_URL+V.SESSION_PATH);p.params.push(`sku=${r||""}`),p.params.push(`access_token=${h||V.ACCESS_TOKEN||""}`);const x={url:In(p),headers:{"Content-Type":"text/plain"}};this.pendingRequest=(function(w,A){return Or(Be(w,{method:"GET"}),A)})(x,(w=>{this.pendingRequest=null,l(w),this.saveEventData(),this.processRequests(h)}))}getSessionAPI(s,r,l,h){this.skuToken=r,this.errorCb=h,V.SESSION_PATH&&V.API_URL&&(l||V.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},l):this.errorCb(new Error(ht)))}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:l}=this.queue.shift();r&&this.success[r]||this.getSession(l,this.skuToken,(h=>{h?this.errorCb(h):r&&(this.success[r]=!0)}),s)}},ao=_s.getSessionAPI.bind(_s),Cs=new Set,ma={create:"create",load:"load",fullLoad:"fullLoad"},bl={mark(s){b.performance.mark(s)},measure(s,r,l){b.performance.measure(s,r,l)}};function ll(s){const r=s.name.split("?")[0];return Ot(r)&&r.includes("mapbox-gl.js")?"javascript":Ot(r)&&r.includes("mapbox-gl.css")?"css":(function(l){return V.API_FONTS_REGEX.test(l)})(r)?"fontRange":Pt(r)?"sprite":At(r)?"style":(function(l){return V.API_TILEJSON_REGEX.test(l)})(r)?"tilejson":"other"}const Hi=b.performance;function nc(s){const r=s?s.url.toString():void 0;return Hi.getEntriesByName(r)}let Lu,To,fu,wa;const Zo={now:()=>fu!==void 0?fu:b.performance.now(),setNow(s){fu=s},restoreNow(){fu=void 0},frame(s){const r=b.requestAnimationFrame(s);return{cancel:()=>b.cancelAnimationFrame(r)}},getImageData(s,r=0){const{width:l,height:h}=s;wa||(wa=b.document.createElement("canvas"));const p=wa.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(l>wa.width||h>wa.height)&&(wa.width=l,wa.height=h),p.clearRect(-r,-r,l+2*r,h+2*r),p.drawImage(s,0,0,l,h),p.getImageData(-r,-r,l+2*r,h+2*r)},resolveURL:s=>(Lu||(Lu=b.document.createElement("a")),Lu.href=s,Lu.href),get devicePixelRatio(){return b.devicePixelRatio},get prefersReducedMotion(){return!!b.matchMedia&&(To==null&&(To=b.matchMedia("(prefers-reduced-motion: reduce)")),To.matches)}};function Ha(s,r,l){l[s]&&l[s].indexOf(r)!==-1||(l[s]=l[s]||[],l[s].push(r))}function Bl(s,r,l){if(l&&l[s]){const h=l[s].indexOf(r);h!==-1&&l[s].splice(h,1)}}class rc{constructor(r,l={}){Be(this,l),this.type=r}}class Sa extends rc{constructor(r,l={}){super("error",Be({error:r},l))}}class ra{on(r,l){return this._listeners=this._listeners||{},Ha(r,l,this._listeners),this}off(r,l){return Bl(r,l,this._listeners),Bl(r,l,this._oneTimeListeners),this}once(r,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},Ha(r,l,this._oneTimeListeners),this):new Promise((h=>this.once(r,h)))}fire(r,l){typeof r=="string"&&(r=new rc(r,l||{}));const h=r.type;if(this.listens(h)){r.target=this;const p=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const A of p)A.call(this,r);const x=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const A of x)Bl(h,A,this._oneTimeListeners),A.call(this,r);const w=this._eventedParent;w&&(Be(r,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),w.fire(r))}else r instanceof Sa&&console.error(r.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,l){return this._eventedParent=r,this._eventedParentData=l,this}}var mn=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Yo(s,...r){for(const l of r)for(const h in l)s[h]=l[h];return s}function ss(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function _i(s){if(Array.isArray(s))return s.map(_i);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const r={};for(const l in s)r[l]=_i(s[l]);return r}return ss(s)}class pu extends Error{constructor(r,l){super(l),this.message=l,this.key=r}}var Wa=pu;class Ka{constructor(r,l=[]){this.parent=r,this.bindings={};for(const[h,p]of l)this.bindings[h]=p}concat(r){return new Ka(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}var cl=Ka;const Ls={kind:"null"},er={kind:"number"},Br={kind:"string"},Mr={kind:"boolean"},js={kind:"color"},Ea={kind:"object"},vi={kind:"value"},Mi={kind:"collator"},wl={kind:"formatted"},qi={kind:"resolvedImage"};function fs(s,r){return{kind:"array",itemType:s,N:r}}function zi(s){if(s.kind==="array"){const r=zi(s.itemType);return typeof s.N=="number"?`array<${r}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${r}>`}return s.kind}const mu=[Ls,er,Br,Mr,js,wl,Ea,fs(vi),qi];function ic(s,r){if(r.kind==="error")return null;if(s.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!ic(s.itemType,r.itemType))&&(typeof s.N!="number"||s.N===r.N))return null}else{if(s.kind===r.kind)return null;if(s.kind==="value"){for(const l of mu)if(!ic(l,r))return null}}return`Expected ${zi(s)} but found ${zi(r)} instead.`}function Jc(s,r){return r.some((l=>l.kind===s.kind))}function yc(s,r){return r.some((l=>l==="null"?s===null:l==="array"?Array.isArray(s):l==="object"?s&&!Array.isArray(s)&&typeof s=="object":l===typeof s))}var oc,Ma={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Ps(s){return(s=Math.round(s))<0?0:s>255?255:s}function ji(s){return Ps(s[s.length-1]==="%"?parseFloat(s)/100*255:parseInt(s))}function Na(s){return(r=s[s.length-1]==="%"?parseFloat(s)/100:parseFloat(s))<0?0:r>1?1:r;var r}function ai(s,r,l){return l<0?l+=1:l>1&&(l-=1),6*l<1?s+(r-s)*l*6:2*l<1?r:3*l<2?s+(r-s)*(2/3-l)*6:s}try{oc={}.parseCSSColor=function(s){var r,l=s.replace(/ /g,"").toLowerCase();if(l in Ma)return Ma[l].slice();if(l[0]==="#")return l.length===4?(r=parseInt(l.substr(1),16))>=0&&r<=4095?[(3840&r)>>4|(3840&r)>>8,240&r|(240&r)>>4,15&r|(15&r)<<4,1]:null:l.length===7&&(r=parseInt(l.substr(1),16))>=0&&r<=16777215?[(16711680&r)>>16,(65280&r)>>8,255&r,1]:null;var h=l.indexOf("("),p=l.indexOf(")");if(h!==-1&&p+1===l.length){var x=l.substr(0,h),w=l.substr(h+1,p-(h+1)).split(","),A=1;switch(x){case"rgba":if(w.length!==4)return null;A=Na(w.pop());case"rgb":return w.length!==3?null:[ji(w[0]),ji(w[1]),ji(w[2]),A];case"hsla":if(w.length!==4)return null;A=Na(w.pop());case"hsl":if(w.length!==3)return null;var P=(parseFloat(w[0])%360+360)%360/360,R=Na(w[1]),$=Na(w[2]),X=$<=.5?$*(R+1):$+R-$*R,re=2*$-X;return[Ps(255*ai(re,X,P+1/3)),Ps(255*ai(re,X,P)),Ps(255*ai(re,X,P-1/3)),A];default:return null}}return null}}catch{}class Jo{constructor(r,l,h,p=1){this.r=r,this.g=l,this.b=h,this.a=p}static parse(r){if(!r)return;if(r instanceof Jo)return r;if(typeof r!="string")return;const l=oc(r);return l?new Jo(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){const[r,l,h,p]=this.toArray();return`rgba(${Math.round(r)},${Math.round(l)},${Math.round(h)},${p})`}toArray(){const{r,g:l,b:h,a:p}=this;return p===0?[0,0,0,0]:[255*r/p,255*l/p,255*h/p,p]}toArray01(){const{r,g:l,b:h,a:p}=this;return p===0?[0,0,0,0]:[r/p,l/p,h/p,p]}toArray01PremultipliedAlpha(){const{r,g:l,b:h,a:p}=this;return[r,l,h,p]}}Jo.black=new Jo(0,0,0,1),Jo.white=new Jo(1,1,1,1),Jo.transparent=new Jo(0,0,0,0),Jo.red=new Jo(1,0,0,1),Jo.blue=new Jo(0,0,1,1);var Io=Jo;class vh{constructor(r,l,h){this.sensitivity=r?l?"variant":"case":l?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,l){return this.collator.compare(r,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Pu{constructor(r,l,h,p,x){this.text=r.normalize?r.normalize():r,this.image=l,this.scale=h,this.fontStack=p,this.textColor=x}}class vo{constructor(r){this.sections=r}static fromString(r){return new vo([new Pu(r,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((r=>r.text.length!==0||r.image&&r.image.name.length!==0))}static factory(r){return r instanceof vo?r:vo.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map((r=>r.text)).join("")}serialize(){const r=["format"];for(const l of this.sections){if(l.image){r.push(["image",l.image.name]);continue}r.push(l.text);const h={};l.fontStack&&(h["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(h["font-scale"]=l.scale),l.textColor&&(h["text-color"]=["rgba"].concat(l.textColor.toArray())),r.push(h)}return r}}class Us{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new Us({name:r,available:!1}):null}serialize(){return["image",this.name]}}function ku(s,r,l,h){return typeof s=="number"&&s>=0&&s<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof l=="number"&&l>=0&&l<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[s,r,l,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[s,r,l,h]:[s,r,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Wo(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof Io||s instanceof vh||s instanceof vo||s instanceof Us)return!0;if(Array.isArray(s)){for(const r of s)if(!Wo(r))return!1;return!0}if(typeof s=="object"){for(const r in s)if(!Wo(s[r]))return!1;return!0}return!1}function xo(s){if(s===null)return Ls;if(typeof s=="string")return Br;if(typeof s=="boolean")return Mr;if(typeof s=="number")return er;if(s instanceof Io)return js;if(s instanceof vh)return Mi;if(s instanceof vo)return wl;if(s instanceof Us)return qi;if(Array.isArray(s)){const r=s.length;let l;for(const h of s){const p=xo(h);if(l){if(l===p)continue;l=vi;break}l=p}return fs(l||vi,r)}return Ea}function zl(s){const r=typeof s;return s===null?"":r==="string"||r==="number"||r==="boolean"?String(s):s instanceof Io||s instanceof vo||s instanceof Us?s.toString():JSON.stringify(s)}class Da{constructor(r,l){this.type=r,this.value=l}static parse(r,l){if(r.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!Wo(r[1]))return l.error("invalid value");const h=r[1];let p=xo(h);const x=l.expectedType;return p.kind!=="array"||p.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(p=x),new Da(p,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Io?["rgba"].concat(this.value.toArray()):this.value instanceof vo?this.value.serialize():this.value}}var Vs=Da,Bo=class{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}};const Dc={string:Br,number:er,boolean:Mr,object:Ea};class Ko{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");let h,p=1;const x=r[0];if(x==="array"){let A,P;if(r.length>2){const R=r[1];if(typeof R!="string"||!(R in Dc)||R==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);A=Dc[R],p++}else A=vi;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return l.error('The length argument to "array" must be a positive integer literal',2);P=r[2],p++}h=fs(A,P)}else h=Dc[x];const w=[];for(;p<r.length;p++){const A=l.parse(r[p],p,vi);if(!A)return null;w.push(A)}return new Ko(h,w)}evaluate(r){for(let l=0;l<this.args.length;l++){const h=this.args[l].evaluate(r);if(!ic(this.type,xo(h)))return h;if(l===this.args.length-1)throw new Bo(`Expected value to be of type ${zi(this.type)}, but found ${zi(xo(h))} instead.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every((r=>r.outputDefined()))}serialize(){const r=this.type,l=[r.kind];if(r.kind==="array"){const h=r.itemType;if(h.kind==="string"||h.kind==="number"||h.kind==="boolean"){l.push(h.kind);const p=r.N;(typeof p=="number"||this.args.length>1)&&l.push(p)}}return l.concat(this.args.map((h=>h.serialize())))}}var ga=Ko;class Xa{constructor(r){this.type=wl,this.sections=r}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");const h=r[1];if(!Array.isArray(h)&&typeof h=="object")return l.error("First argument must be an image or text section.");const p=[];let x=!1;for(let w=1;w<=r.length-1;++w){const A=r[w];if(x&&typeof A=="object"&&!Array.isArray(A)){x=!1;let P=null;if(A["font-scale"]&&(P=l.parse(A["font-scale"],1,er),!P))return null;let R=null;if(A["text-font"]&&(R=l.parse(A["text-font"],1,fs(Br)),!R))return null;let $=null;if(A["text-color"]&&($=l.parse(A["text-color"],1,js),!$))return null;const X=p[p.length-1];X.scale=P,X.font=R,X.textColor=$}else{const P=l.parse(r[w],1,vi);if(!P)return null;const R=P.type.kind;if(R!=="string"&&R!=="value"&&R!=="null"&&R!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,p.push({content:P,scale:null,font:null,textColor:null})}}return new Xa(p)}evaluate(r){return new vo(this.sections.map((l=>{const h=l.content.evaluate(r);return xo(h)===qi?new Pu("",h,null,null,null):new Pu(zl(h),null,l.scale?l.scale.evaluate(r):null,l.font?l.font.evaluate(r).join(","):null,l.textColor?l.textColor.evaluate(r):null)})))}eachChild(r){for(const l of this.sections)r(l.content),l.scale&&r(l.scale),l.font&&r(l.font),l.textColor&&r(l.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const l of this.sections){r.push(l.content.serialize());const h={};l.scale&&(h["font-scale"]=l.scale.serialize()),l.font&&(h["text-font"]=l.font.serialize()),l.textColor&&(h["text-color"]=l.textColor.serialize()),r.push(h)}return r}}class ul{constructor(r){this.type=qi,this.input=r}static parse(r,l){if(r.length!==2)return l.error("Expected two arguments.");const h=l.parse(r[1],1,Br);return h?new ul(h):l.error("No image name provided.")}evaluate(r){const l=this.input.evaluate(r),h=Us.fromString(l);return h&&r.availableImages&&(h.available=r.availableImages.indexOf(l)>-1),h}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Qc={"to-boolean":Mr,"to-color":js,"to-number":er,"to-string":Br};class _c{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");const h=r[0];if((h==="to-boolean"||h==="to-string")&&r.length!==2)return l.error("Expected one argument.");const p=Qc[h],x=[];for(let w=1;w<r.length;w++){const A=l.parse(r[w],w,vi);if(!A)return null;x.push(A)}return new _c(p,x)}evaluate(r){if(this.type.kind==="boolean")return!!this.args[0].evaluate(r);if(this.type.kind==="color"){let l,h;for(const p of this.args){if(l=p.evaluate(r),h=null,l instanceof Io)return l;if(typeof l=="string"){const x=r.parseColor(l);if(x)return x}else if(Array.isArray(l)&&(h=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:ku(l[0],l[1],l[2],l[3]),!h))return new Io(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new Bo(h||`Could not parse color from value '${typeof l=="string"?l:String(JSON.stringify(l))}'`)}if(this.type.kind==="number"){let l=null;for(const h of this.args){if(l=h.evaluate(r),l===null)return 0;const p=Number(l);if(!isNaN(p))return p}throw new Bo(`Could not convert ${JSON.stringify(l)} to number.`)}return this.type.kind==="formatted"?vo.fromString(zl(this.args[0].evaluate(r))):this.type.kind==="resolvedImage"?Us.fromString(zl(this.args[0].evaluate(r))):zl(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every((r=>r.outputDefined()))}serialize(){if(this.type.kind==="formatted")return new Xa([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ul(this.args[0]).serialize();const r=[`to-${this.type.kind}`];return this.eachChild((l=>{r.push(l.serialize())})),r}}var qs=_c;const Ai=["Unknown","Point","LineString","Polygon"];var Ss=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ai[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const s=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:l,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*r-s[0])+this.featureDistanceData.bearing[1]*(h*r-s[1])}return 0}parseColor(s){let r=this._parseColorCache[s];return r||(r=this._parseColorCache[s]=Io.parse(s)),r}};class $s{constructor(r,l,h,p){this.name=r,this.type=l,this._evaluate=h,this.args=p}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((r=>r.serialize())))}static parse(r,l){const h=r[0],p=$s.definitions[h];if(!p)return l.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const x=Array.isArray(p)?p[0]:p.type,w=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,A=w.filter((([R])=>!Array.isArray(R)||R.length===r.length-1));let P=null;for(const[R,$]of A){P=new Fc(l.registry,l.path,null,l.scope);const X=[];let re=!1;for(let he=1;he<r.length;he++){const ye=r[he],Se=Array.isArray(R)?R[he-1]:R.type,Ke=P.parse(ye,1+X.length,Se);if(!Ke){re=!0;break}X.push(Ke)}if(!re)if(Array.isArray(R)&&R.length!==X.length)P.error(`Expected ${R.length} arguments, but found ${X.length} instead.`);else{for(let he=0;he<X.length;he++){const ye=Array.isArray(R)?R[he]:R.type,Se=X[he];P.concat(he+1).checkSubtype(ye,Se.type)}if(P.errors.length===0)return new $s(h,x,$,X)}}if(A.length===1)l.errors.push(...P.errors);else{const R=(A.length?A:w).map((([X])=>{return re=X,Array.isArray(re)?`(${re.map(zi).join(", ")})`:`(${zi(re.type)}...)`;var re})).join(" | "),$=[];for(let X=1;X<r.length;X++){const re=l.parse(r[X],1+$.length);if(!re)return null;$.push(zi(re.type))}l.error(`Expected arguments of type ${R}, but found (${$.join(", ")}) instead.`)}return null}static register(r,l){$s.definitions=l;for(const h in l)r[h]=$s}}var ia=$s;class oa{constructor(r,l,h){this.type=Mi,this.locale=h,this.caseSensitive=r,this.diacriticSensitive=l}static parse(r,l){if(r.length!==2)return l.error("Expected one argument.");const h=r[1];if(typeof h!="object"||Array.isArray(h))return l.error("Collator options argument must be an object.");const p=l.parse(h["case-sensitive"]!==void 0&&h["case-sensitive"],1,Mr);if(!p)return null;const x=l.parse(h["diacritic-sensitive"]!==void 0&&h["diacritic-sensitive"],1,Mr);if(!x)return null;let w=null;return h.locale&&(w=l.parse(h.locale,1,Br),!w)?null:new oa(p,x,w)}evaluate(r){return new vh(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}const hl=8192;function Gs(s,r){s[0]=Math.min(s[0],r[0]),s[1]=Math.min(s[1],r[1]),s[2]=Math.max(s[2],r[0]),s[3]=Math.max(s[3],r[1])}function Hs(s,r){return!(s[0]<=r[0]||s[2]>=r[2]||s[1]<=r[1]||s[3]>=r[3])}function vc(s,r){const l=(180+s[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,p=Math.pow(2,r.z);return[Math.round(l*p*hl),Math.round(h*p*hl)]}function W(s,r,l){const h=s[0]-r[0],p=s[1]-r[1],x=s[0]-l[0],w=s[1]-l[1];return h*w-x*p==0&&h*x<=0&&p*w<=0}function Ce(s,r){let l=!1;for(let w=0,A=r.length;w<A;w++){const P=r[w];for(let R=0,$=P.length;R<$-1;R++){if(W(s,P[R],P[R+1]))return!1;(p=P[R])[1]>(h=s)[1]!=(x=P[R+1])[1]>h[1]&&h[0]<(x[0]-p[0])*(h[1]-p[1])/(x[1]-p[1])+p[0]&&(l=!l)}}var h,p,x;return l}function mt(s,r){for(let l=0;l<r.length;l++)if(Ce(s,r[l]))return!0;return!1}function yt(s,r,l,h){const p=h[0]-l[0],x=h[1]-l[1],w=(s[0]-l[0])*x-p*(s[1]-l[1]),A=(r[0]-l[0])*x-p*(r[1]-l[1]);return w>0&&A<0||w<0&&A>0}function $t(s,r,l){for(const R of l)for(let $=0;$<R.length-1;++$)if((A=[(w=R[$+1])[0]-(x=R[$])[0],w[1]-x[1]])[0]*(P=[(p=r)[0]-(h=s)[0],p[1]-h[1]])[1]-A[1]*P[0]!=0&&yt(h,p,x,w)&&yt(x,w,h,p))return!0;var h,p,x,w,A,P;return!1}function Zt(s,r){for(let l=0;l<s.length;++l)if(!Ce(s[l],r))return!1;for(let l=0;l<s.length-1;++l)if($t(s[l],s[l+1],r))return!1;return!0}function zn(s,r){for(let l=0;l<r.length;l++)if(Zt(s,r[l]))return!0;return!1}function Nr(s,r,l){const h=[];for(let p=0;p<s.length;p++){const x=[];for(let w=0;w<s[p].length;w++){const A=vc(s[p][w],l);Gs(r,A),x.push(A)}h.push(x)}return h}function Hr(s,r,l){const h=[];for(let p=0;p<s.length;p++){const x=Nr(s[p],r,l);h.push(x)}return h}function gi(s,r,l,h){if(s[0]<l[0]||s[0]>l[2]){const p=.5*h;let x=s[0]-l[0]>p?-h:l[0]-s[0]>p?h:0;x===0&&(x=s[0]-l[2]>p?-h:l[2]-s[0]>p?h:0),s[0]+=x}Gs(r,s)}function Ti(s,r,l,h){const p=Math.pow(2,h.z)*hl,x=[h.x*hl,h.y*hl],w=[];if(!s)return w;for(const A of s)for(const P of A){const R=[P.x+x[0],P.y+x[1]];gi(R,r,l,p),w.push(R)}return w}function bo(s,r,l,h){const p=Math.pow(2,h.z)*hl,x=[h.x*hl,h.y*hl],w=[];if(!s)return w;for(const P of s){const R=[];for(const $ of P){const X=[$.x+x[0],$.y+x[1]];Gs(r,X),R.push(X)}w.push(R)}if(r[2]-r[0]<=p/2){(A=r)[0]=A[1]=1/0,A[2]=A[3]=-1/0;for(const P of w)for(const R of P)gi(R,r,l,p)}var A;return w}class wo{constructor(r,l){this.type=Mr,this.geojson=r,this.geometries=l}static parse(r,l){if(r.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(Wo(r[1])){const h=r[1];if(h.type==="FeatureCollection")for(let p=0;p<h.features.length;++p){const x=h.features[p].geometry.type;if(x==="Polygon"||x==="MultiPolygon")return new wo(h,h.features[p].geometry)}else if(h.type==="Feature"){const p=h.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new wo(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new wo(h,h)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return(function(l,h){const p=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],w=l.canonicalID();if(!w)return!1;if(h.type==="Polygon"){const A=Nr(h.coordinates,x,w),P=Ti(l.geometry(),p,x,w);if(!Hs(p,x))return!1;for(const R of P)if(!Ce(R,A))return!1}if(h.type==="MultiPolygon"){const A=Hr(h.coordinates,x,w),P=Ti(l.geometry(),p,x,w);if(!Hs(p,x))return!1;for(const R of P)if(!mt(R,A))return!1}return!0})(r,this.geometries);if(r.geometryType()==="LineString")return(function(l,h){const p=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],w=l.canonicalID();if(!w)return!1;if(h.type==="Polygon"){const A=Nr(h.coordinates,x,w),P=bo(l.geometry(),p,x,w);if(!Hs(p,x))return!1;for(const R of P)if(!Zt(R,A))return!1}if(h.type==="MultiPolygon"){const A=Hr(h.coordinates,x,w),P=bo(l.geometry(),p,x,w);if(!Hs(p,x))return!1;for(const R of P)if(!zn(R,A))return!1}return!0})(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Qo=wo;function Mo(s){if(s instanceof ia&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof Qo)return!1;let r=!0;return s.eachChild((l=>{r&&!Mo(l)&&(r=!1)})),r}function zo(s){if(s instanceof ia&&s.name==="feature-state")return!1;let r=!0;return s.eachChild((l=>{r&&!zo(l)&&(r=!1)})),r}function es(s,r){if(s instanceof ia&&r.indexOf(s.name)>=0)return!1;let l=!0;return s.eachChild((h=>{l&&!es(h,r)&&(l=!1)})),l}class us{constructor(r,l){this.type=l.type,this.name=r,this.boundExpression=l}static parse(r,l){if(r.length!==2||typeof r[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");const h=r[1];return l.scope.has(h)?new us(h,l.scope.get(h)):l.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var jo=us;class Es{constructor(r,l=[],h,p=new cl,x=[]){this.registry=r,this.path=l,this.key=l.map((w=>`[${w}]`)).join(""),this.scope=p,this.errors=x,this.expectedType=h}parse(r,l,h,p,x={}){return l?this.concat(l,h,p)._parse(r,x):this._parse(r,x)}_parse(r,l){function h(p,x,w){return w==="assert"?new ga(x,[p]):w==="coerce"?new qs(x,[p]):p}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=r[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const x=this.registry[p];if(x){let w=x.parse(r,this);if(!w)return null;if(this.expectedType){const A=this.expectedType,P=w.type;if(A.kind!=="string"&&A.kind!=="number"&&A.kind!=="boolean"&&A.kind!=="object"&&A.kind!=="array"||P.kind!=="value")if(A.kind!=="color"&&A.kind!=="formatted"&&A.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string"){if(this.checkSubtype(A,P))return null}else w=h(w,A,l.typeAnnotation||"coerce");else w=h(w,A,l.typeAnnotation||"assert")}if(!(w instanceof Vs)&&w.type.kind!=="resolvedImage"&&Za(w)){const A=new Ss;try{w=new Vs(w.type,w.evaluate(A))}catch(P){return this.error(P.message),null}}return w}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,l,h){const p=typeof r=="number"?this.path.concat(r):this.path,x=h?this.scope.concat(h):this.scope;return new Es(this.registry,p,l||null,x,this.errors)}error(r,...l){const h=`${this.key}${l.map((p=>`[${p}]`)).join("")}`;this.errors.push(new Wa(h,r))}checkSubtype(r,l){const h=ic(r,l);return h&&this.error(h),h}}var Fc=Es;function Za(s){if(s instanceof jo)return Za(s.boundExpression);if(s instanceof ia&&s.name==="error"||s instanceof oa||s instanceof Qo)return!1;const r=s instanceof qs||s instanceof ga;let l=!0;return s.eachChild((h=>{l=r?l&&Za(h):l&&h instanceof Vs})),!!l&&Mo(s)&&es(s,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function L(s,r){const l=s.length-1;let h,p,x=0,w=l,A=0;for(;x<=w;)if(A=Math.floor((x+w)/2),h=s[A],p=s[A+1],h<=r){if(A===l||r<p)return A;x=A+1}else{if(!(h>r))throw new Bo("Input is not a number.");w=A-1}return 0}class ae{constructor(r,l,h){this.type=r,this.input=l,this.labels=[],this.outputs=[];for(const[p,x]of h)this.labels.push(p),this.outputs.push(x)}static parse(r,l){if(r.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return l.error("Expected an even number of arguments.");const h=l.parse(r[1],1,er);if(!h)return null;const p=[];let x=null;l.expectedType&&l.expectedType.kind!=="value"&&(x=l.expectedType);for(let w=1;w<r.length;w+=2){const A=w===1?-1/0:r[w],P=r[w+1],R=w,$=w+1;if(typeof A!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(p.length&&p[p.length-1][0]>=A)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',R);const X=l.parse(P,$,x);if(!X)return null;x=x||X.type,p.push([A,X])}return new ae(x,h,p)}evaluate(r){const l=this.labels,h=this.outputs;if(l.length===1)return h[0].evaluate(r);const p=this.input.evaluate(r);if(p<=l[0])return h[0].evaluate(r);const x=l.length;return p>=l[x-1]?h[x-1].evaluate(r):h[L(l,p)].evaluate(r)}eachChild(r){r(this.input);for(const l of this.outputs)r(l)}outputDefined(){return this.outputs.every((r=>r.outputDefined()))}serialize(){const r=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&r.push(this.labels[l]),r.push(this.outputs[l].serialize());return r}}var ve=ae;function He(s,r,l){return s*(1-l)+r*l}var Kt=Object.freeze({__proto__:null,array:function(s,r,l){return s.map(((h,p)=>He(h,r[p],l)))},color:function(s,r,l){return new Io(He(s.r,r.r,l),He(s.g,r.g,l),He(s.b,r.b,l),He(s.a,r.a,l))},number:He});const pn=.95047,sr=1.08883,ho=4/29,Fo=6/29,Wi=3*Fo*Fo,Oi=Fo*Fo*Fo,No=Math.PI/180,sa=180/Math.PI;function Oo(s){return s>Oi?Math.pow(s,1/3):s/Wi+ho}function $i(s){return s>Fo?s*s*s:Wi*(s-ho)}function jl(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function aa(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function Ru(s){const r=aa(s.r),l=aa(s.g),h=aa(s.b),p=Oo((.4124564*r+.3575761*l+.1804375*h)/pn),x=Oo((.2126729*r+.7151522*l+.072175*h)/1);return{l:116*x-16,a:500*(p-x),b:200*(x-Oo((.0193339*r+.119192*l+.9503041*h)/sr)),alpha:s.a}}function dl(s){let r=(s.l+16)/116,l=isNaN(s.a)?r:r+s.a/500,h=isNaN(s.b)?r:r-s.b/200;return r=1*$i(r),l=pn*$i(l),h=sr*$i(h),new Io(jl(3.2404542*l-1.5371385*r-.4985314*h),jl(-.969266*l+1.8760108*r+.041556*h),jl(.0556434*l-.2040259*r+1.0572252*h),s.alpha)}function xc(s,r,l){const h=r-s;return s+l*(h>180||h<-180?h-360*Math.round(h/360):h)}const ks={forward:Ru,reverse:dl,interpolate:function(s,r,l){return{l:He(s.l,r.l,l),a:He(s.a,r.a,l),b:He(s.b,r.b,l),alpha:He(s.alpha,r.alpha,l)}}},ya={forward:function(s){const{l:r,a:l,b:h}=Ru(s),p=Math.atan2(h,l)*sa;return{h:p<0?p+360:p,c:Math.sqrt(l*l+h*h),l:r,alpha:s.a}},reverse:function(s){const r=s.h*No,l=s.c;return dl({l:s.l,a:Math.cos(r)*l,b:Math.sin(r)*l,alpha:s.alpha})},interpolate:function(s,r,l){return{h:xc(s.h,r.h,l),c:He(s.c,r.c,l),l:He(s.l,r.l,l),alpha:He(s.alpha,r.alpha,l)}}};var gu=Object.freeze({__proto__:null,hcl:ya,lab:ks});class ts{constructor(r,l,h,p,x){this.type=r,this.operator=l,this.interpolation=h,this.input=p,this.labels=[],this.outputs=[];for(const[w,A]of x)this.labels.push(w),this.outputs.push(A)}static interpolationFactor(r,l,h,p){let x=0;if(r.name==="exponential")x=Ws(l,r.base,h,p);else if(r.name==="linear")x=Ws(l,1,h,p);else if(r.name==="cubic-bezier"){const w=r.controlPoints;x=new pe(w[0],w[1],w[2],w[3]).solve(Ws(l,1,h,p))}return x}static parse(r,l){let[h,p,x,...w]=r;if(!Array.isArray(p)||p.length===0)return l.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const R=p[1];if(typeof R!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:R}}else{if(p[0]!=="cubic-bezier")return l.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const R=p.slice(1);if(R.length!==4||R.some(($=>typeof $!="number"||$<0||$>1)))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:R}}}if(r.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(x=l.parse(x,2,er),!x)return null;const A=[];let P=null;h==="interpolate-hcl"||h==="interpolate-lab"?P=js:l.expectedType&&l.expectedType.kind!=="value"&&(P=l.expectedType);for(let R=0;R<w.length;R+=2){const $=w[R],X=w[R+1],re=R+3,he=R+4;if(typeof $!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',re);if(A.length&&A[A.length-1][0]>=$)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',re);const ye=l.parse(X,he,P);if(!ye)return null;P=P||ye.type,A.push([$,ye])}return P.kind==="number"||P.kind==="color"||P.kind==="array"&&P.itemType.kind==="number"&&typeof P.N=="number"?new ts(P,h,p,x,A):l.error(`Type ${zi(P)} is not interpolatable.`)}evaluate(r){const l=this.labels,h=this.outputs;if(l.length===1)return h[0].evaluate(r);const p=this.input.evaluate(r);if(p<=l[0])return h[0].evaluate(r);const x=l.length;if(p>=l[x-1])return h[x-1].evaluate(r);const w=L(l,p),A=ts.interpolationFactor(this.interpolation,p,l[w],l[w+1]),P=h[w].evaluate(r),R=h[w+1].evaluate(r);return this.operator==="interpolate"?Kt[this.type.kind.toLowerCase()](P,R,A):this.operator==="interpolate-hcl"?ya.reverse(ya.interpolate(ya.forward(P),ya.forward(R),A)):ks.reverse(ks.interpolate(ks.forward(P),ks.forward(R),A))}eachChild(r){r(this.input);for(const l of this.outputs)r(l)}outputDefined(){return this.outputs.every((r=>r.outputDefined()))}serialize(){let r;r=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const l=[this.operator,r,this.input.serialize()];for(let h=0;h<this.labels.length;h++)l.push(this.labels[h],this.outputs[h].serialize());return l}}function Ws(s,r,l,h){const p=h-l,x=s-l;return p===0?0:r===1?x/p:(Math.pow(r,x)-1)/(Math.pow(r,p)-1)}var Fa=ts;class Ul{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expectected at least one argument.");let h=null;const p=l.expectedType;p&&p.kind!=="value"&&(h=p);const x=[];for(const A of r.slice(1)){const P=l.parse(A,1+x.length,h,void 0,{typeAnnotation:"omit"});if(!P)return null;h=h||P.type,x.push(P)}const w=p&&x.some((A=>ic(p,A.type)));return new Ul(w?vi:h,x)}evaluate(r){let l,h=null,p=0;for(const x of this.args){if(p++,h=x.evaluate(r),h&&h instanceof Us&&!h.available&&(l||(l=h),h=null,p===this.args.length))return l;if(h!==null)break}return h}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every((r=>r.outputDefined()))}serialize(){const r=["coalesce"];return this.eachChild((l=>{r.push(l.serialize())})),r}}var vs=Ul;class Uo{constructor(r,l){this.type=l.type,this.bindings=[].concat(r),this.result=l}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const l of this.bindings)r(l[1]);r(this.result)}static parse(r,l){if(r.length<4)return l.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const h=[];for(let x=1;x<r.length-1;x+=2){const w=r[x];if(typeof w!="string")return l.error(`Expected string, but found ${typeof w} instead.`,x);if(/[^a-zA-Z0-9_]/.test(w))return l.error("Variable names must contain only alphanumeric characters or '_'.",x);const A=l.parse(r[x+1],x+1);if(!A)return null;h.push([w,A])}const p=l.parse(r[r.length-1],r.length-1,l.expectedType,h);return p?new Uo(h,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[l,h]of this.bindings)r.push(l,h.serialize());return r.push(this.result.serialize()),r}}var Aa=Uo;class Ks{constructor(r,l,h){this.type=r,this.index=l,this.input=h}static parse(r,l){if(r.length!==3)return l.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const h=l.parse(r[1],1,er),p=l.parse(r[2],2,fs(l.expectedType||vi));return h&&p?new Ks(p.type.itemType,h,p):null}evaluate(r){const l=this.index.evaluate(r),h=this.input.evaluate(r);if(l<0)throw new Bo(`Array index out of bounds: ${l} < 0.`);if(l>=h.length)throw new Bo(`Array index out of bounds: ${l} > ${h.length-1}.`);if(l!==Math.floor(l))throw new Bo(`Array index must be an integer, but found ${l} instead.`);return h[l]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var yu=Ks;class bc{constructor(r,l){this.type=Mr,this.needle=r,this.haystack=l}static parse(r,l){if(r.length!==3)return l.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const h=l.parse(r[1],1,vi),p=l.parse(r[2],2,vi);return h&&p?Jc(h.type,[Mr,Br,er,Ls,vi])?new bc(h,p):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${zi(h.type)} instead`):null}evaluate(r){const l=this.needle.evaluate(r),h=this.haystack.evaluate(r);if(h==null)return!1;if(!yc(l,["boolean","string","number","null"]))throw new Bo(`Expected first argument to be of type boolean, string, number or null, but found ${zi(xo(l))} instead.`);if(!yc(h,["string","array"]))throw new Bo(`Expected second argument to be of type array or string, but found ${zi(xo(h))} instead.`);return h.indexOf(l)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var eu=bc;class Oa{constructor(r,l,h){this.type=er,this.needle=r,this.haystack=l,this.fromIndex=h}static parse(r,l){if(r.length<=2||r.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const h=l.parse(r[1],1,vi),p=l.parse(r[2],2,vi);if(!h||!p)return null;if(!Jc(h.type,[Mr,Br,er,Ls,vi]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${zi(h.type)} instead`);if(r.length===4){const x=l.parse(r[3],3,er);return x?new Oa(h,p,x):null}return new Oa(h,p)}evaluate(r){const l=this.needle.evaluate(r),h=this.haystack.evaluate(r);if(!yc(l,["boolean","string","number","null"]))throw new Bo(`Expected first argument to be of type boolean, string, number or null, but found ${zi(xo(l))} instead.`);if(!yc(h,["string","array"]))throw new Bo(`Expected second argument to be of type array or string, but found ${zi(xo(h))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(r);return h.indexOf(l,p)}return h.indexOf(l)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var sc=Oa;class Sl{constructor(r,l,h,p,x,w){this.inputType=r,this.type=l,this.input=h,this.cases=p,this.outputs=x,this.otherwise=w}static parse(r,l){if(r.length<5)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return l.error("Expected an even number of arguments.");let h,p;l.expectedType&&l.expectedType.kind!=="value"&&(p=l.expectedType);const x={},w=[];for(let R=2;R<r.length-1;R+=2){let $=r[R];const X=r[R+1];Array.isArray($)||($=[$]);const re=l.concat(R);if($.length===0)return re.error("Expected at least one branch label.");for(const ye of $){if(typeof ye!="number"&&typeof ye!="string")return re.error("Branch labels must be numbers or strings.");if(typeof ye=="number"&&Math.abs(ye)>Number.MAX_SAFE_INTEGER)return re.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ye=="number"&&Math.floor(ye)!==ye)return re.error("Numeric branch labels must be integer values.");if(h){if(re.checkSubtype(h,xo(ye)))return null}else h=xo(ye);if(x[String(ye)]!==void 0)return re.error("Branch labels must be unique.");x[String(ye)]=w.length}const he=l.parse(X,R,p);if(!he)return null;p=p||he.type,w.push(he)}const A=l.parse(r[1],1,vi);if(!A)return null;const P=l.parse(r[r.length-1],r.length-1,p);return P?A.type.kind!=="value"&&l.concat(1).checkSubtype(h,A.type)?null:new Sl(h,p,A,x,w,P):null}evaluate(r){const l=this.input.evaluate(r);return(xo(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every((r=>r.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),h=[],p={};for(const w of l){const A=p[this.cases[w]];A===void 0?(p[this.cases[w]]=h.length,h.push([this.cases[w],[w]])):h[A][1].push(w)}const x=w=>this.inputType.kind==="number"?Number(w):w;for(const[w,A]of h)r.push(A.length===1?x(A[0]):A.map(x)),r.push(this.outputs[w].serialize());return r.push(this.otherwise.serialize()),r}}var Vl=Sl;class wc{constructor(r,l,h){this.type=r,this.branches=l,this.otherwise=h}static parse(r,l){if(r.length<4)return l.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return l.error("Expected an odd number of arguments.");let h;l.expectedType&&l.expectedType.kind!=="value"&&(h=l.expectedType);const p=[];for(let w=1;w<r.length-1;w+=2){const A=l.parse(r[w],w,Mr);if(!A)return null;const P=l.parse(r[w+1],w+1,h);if(!P)return null;p.push([A,P]),h=h||P.type}const x=l.parse(r[r.length-1],r.length-1,h);return x?new wc(h,p,x):null}evaluate(r){for(const[l,h]of this.branches)if(l.evaluate(r))return h.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[l,h]of this.branches)r(l),r(h);r(this.otherwise)}outputDefined(){return this.branches.every((([r,l])=>l.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild((l=>{r.push(l.serialize())})),r}}var El=wc;class Oc{constructor(r,l,h,p){this.type=r,this.input=l,this.beginIndex=h,this.endIndex=p}static parse(r,l){if(r.length<=2||r.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const h=l.parse(r[1],1,vi),p=l.parse(r[2],2,er);if(!h||!p)return null;if(!Jc(h.type,[fs(vi),Br,vi]))return l.error(`Expected first argument to be of type array or string, but found ${zi(h.type)} instead`);if(r.length===4){const x=l.parse(r[3],3,er);return x?new Oc(h.type,h,p,x):null}return new Oc(h.type,h,p)}evaluate(r){const l=this.input.evaluate(r),h=this.beginIndex.evaluate(r);if(!yc(l,["string","array"]))throw new Bo(`Expected first argument to be of type array or string, but found ${zi(xo(l))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(r);return l.slice(h,p)}return l.slice(h)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var lo=Oc;function Al(s,r){return s==="=="||s==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function Xo(s,r,l,h){return h.compare(r,l)===0}function So(s,r,l){const h=s!=="=="&&s!=="!=";return class o6{constructor(x,w,A){this.type=Mr,this.lhs=x,this.rhs=w,this.collator=A,this.hasUntypedArgument=x.type.kind==="value"||w.type.kind==="value"}static parse(x,w){if(x.length!==3&&x.length!==4)return w.error("Expected two or three arguments.");const A=x[0];let P=w.parse(x[1],1,vi);if(!P)return null;if(!Al(A,P.type))return w.concat(1).error(`"${A}" comparisons are not supported for type '${zi(P.type)}'.`);let R=w.parse(x[2],2,vi);if(!R)return null;if(!Al(A,R.type))return w.concat(2).error(`"${A}" comparisons are not supported for type '${zi(R.type)}'.`);if(P.type.kind!==R.type.kind&&P.type.kind!=="value"&&R.type.kind!=="value")return w.error(`Cannot compare types '${zi(P.type)}' and '${zi(R.type)}'.`);h&&(P.type.kind==="value"&&R.type.kind!=="value"?P=new ga(R.type,[P]):P.type.kind!=="value"&&R.type.kind==="value"&&(R=new ga(P.type,[R])));let $=null;if(x.length===4){if(P.type.kind!=="string"&&R.type.kind!=="string"&&P.type.kind!=="value"&&R.type.kind!=="value")return w.error("Cannot use collator to compare non-string types.");if($=w.parse(x[3],3,Mi),!$)return null}return new o6(P,R,$)}evaluate(x){const w=this.lhs.evaluate(x),A=this.rhs.evaluate(x);if(h&&this.hasUntypedArgument){const P=xo(w),R=xo(A);if(P.kind!==R.kind||P.kind!=="string"&&P.kind!=="number")throw new Bo(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${P.kind}, ${R.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const P=xo(w),R=xo(A);if(P.kind!=="string"||R.kind!=="string")return r(x,w,A)}return this.collator?l(x,w,A,this.collator.evaluate(x)):r(x,w,A)}eachChild(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)}outputDefined(){return!0}serialize(){const x=[s];return this.eachChild((w=>{x.push(w.serialize())})),x}}}const la=So("==",(function(s,r,l){return r===l}),Xo),ca=So("!=",(function(s,r,l){return r!==l}),(function(s,r,l,h){return!Xo(0,r,l,h)})),Bc=So("<",(function(s,r,l){return r<l}),(function(s,r,l,h){return h.compare(r,l)<0})),kh=So(">",(function(s,r,l){return r>l}),(function(s,r,l,h){return h.compare(r,l)>0})),_u=So("<=",(function(s,r,l){return r<=l}),(function(s,r,l,h){return h.compare(r,l)<=0})),tu=So(">=",(function(s,r,l){return r>=l}),(function(s,r,l,h){return h.compare(r,l)>=0}));class Mu{constructor(r,l,h,p,x,w){this.type=Br,this.number=r,this.locale=l,this.currency=h,this.unit=p,this.minFractionDigits=x,this.maxFractionDigits=w}static parse(r,l){if(r.length!==3)return l.error("Expected two arguments.");const h=l.parse(r[1],1,er);if(!h)return null;const p=r[2];if(typeof p!="object"||Array.isArray(p))return l.error("NumberFormat options argument must be an object.");let x=null;if(p.locale&&(x=l.parse(p.locale,1,Br),!x))return null;let w=null;if(p.currency&&(w=l.parse(p.currency,1,Br),!w))return null;let A=null;if(p.unit&&(A=l.parse(p.unit,1,Br),!A))return null;let P=null;if(p["min-fraction-digits"]&&(P=l.parse(p["min-fraction-digits"],1,er),!P))return null;let R=null;return p["max-fraction-digits"]&&(R=l.parse(p["max-fraction-digits"],1,er),!R)?null:new Mu(h,x,w,A,P,R)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(r):void 0,unit:this.unit?this.unit.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.unit&&r(this.unit),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.unit&&(r.unit=this.unit.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class nu{constructor(r){this.type=er,this.input=r}static parse(r,l){if(r.length!==2)return l.error(`Expected 1 argument, but found ${r.length-1} instead.`);const h=l.parse(r[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${zi(h.type)} instead.`):new nu(h):null}evaluate(r){const l=this.input.evaluate(r);if(typeof l=="string"||Array.isArray(l))return l.length;throw new Bo(`Expected value to be of type string or array, but found ${zi(xo(l))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild((l=>{r.push(l.serialize())})),r}}const xh={"==":la,"!=":ca,">":kh,"<":Bc,">=":tu,"<=":_u,array:ga,at:yu,boolean:ga,case:El,coalesce:vs,collator:oa,format:Xa,image:ul,in:eu,"index-of":sc,interpolate:Fa,"interpolate-hcl":Fa,"interpolate-lab":Fa,length:nu,let:Aa,literal:Vs,match:Vl,number:ga,"number-format":Mu,object:ga,slice:lo,step:ve,string:ga,"to-boolean":qs,"to-color":qs,"to-number":qs,"to-string":qs,var:jo,within:Qo};function Zh(s,[r,l,h,p]){r=r.evaluate(s),l=l.evaluate(s),h=h.evaluate(s);const x=p?p.evaluate(s):1,w=ku(r,l,h,x);if(w)throw new Bo(w);return new Io(r/255*x,l/255*x,h/255*x,x)}function ql(s,r){return s in r}function zc(s,r){const l=r[s];return l===void 0?null:l}function Xs(s){return{type:s}}ia.register(xh,{error:[{kind:"error"},[Br],(s,[r])=>{throw new Bo(r.evaluate(s))}],typeof:[Br,[vi],(s,[r])=>zi(xo(r.evaluate(s)))],"to-rgba":[fs(er,4),[js],(s,[r])=>r.evaluate(s).toArray()],rgb:[js,[er,er,er],Zh],rgba:[js,[er,er,er,er],Zh],has:{type:Mr,overloads:[[[Br],(s,[r])=>ql(r.evaluate(s),s.properties())],[[Br,Ea],(s,[r,l])=>ql(r.evaluate(s),l.evaluate(s))]]},get:{type:vi,overloads:[[[Br],(s,[r])=>zc(r.evaluate(s),s.properties())],[[Br,Ea],(s,[r,l])=>zc(r.evaluate(s),l.evaluate(s))]]},"feature-state":[vi,[Br],(s,[r])=>zc(r.evaluate(s),s.featureState||{})],properties:[Ea,[],s=>s.properties()],"geometry-type":[Br,[],s=>s.geometryType()],id:[vi,[],s=>s.id()],zoom:[er,[],s=>s.globals.zoom],pitch:[er,[],s=>s.globals.pitch||0],"distance-from-center":[er,[],s=>s.distanceFromCenter()],"heatmap-density":[er,[],s=>s.globals.heatmapDensity||0],"line-progress":[er,[],s=>s.globals.lineProgress||0],"sky-radial-progress":[er,[],s=>s.globals.skyRadialProgress||0],accumulated:[vi,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[er,Xs(er),(s,r)=>{let l=0;for(const h of r)l+=h.evaluate(s);return l}],"*":[er,Xs(er),(s,r)=>{let l=1;for(const h of r)l*=h.evaluate(s);return l}],"-":{type:er,overloads:[[[er,er],(s,[r,l])=>r.evaluate(s)-l.evaluate(s)],[[er],(s,[r])=>-r.evaluate(s)]]},"/":[er,[er,er],(s,[r,l])=>r.evaluate(s)/l.evaluate(s)],"%":[er,[er,er],(s,[r,l])=>r.evaluate(s)%l.evaluate(s)],ln2:[er,[],()=>Math.LN2],pi:[er,[],()=>Math.PI],e:[er,[],()=>Math.E],"^":[er,[er,er],(s,[r,l])=>Math.pow(r.evaluate(s),l.evaluate(s))],sqrt:[er,[er],(s,[r])=>Math.sqrt(r.evaluate(s))],log10:[er,[er],(s,[r])=>Math.log(r.evaluate(s))/Math.LN10],ln:[er,[er],(s,[r])=>Math.log(r.evaluate(s))],log2:[er,[er],(s,[r])=>Math.log(r.evaluate(s))/Math.LN2],sin:[er,[er],(s,[r])=>Math.sin(r.evaluate(s))],cos:[er,[er],(s,[r])=>Math.cos(r.evaluate(s))],tan:[er,[er],(s,[r])=>Math.tan(r.evaluate(s))],asin:[er,[er],(s,[r])=>Math.asin(r.evaluate(s))],acos:[er,[er],(s,[r])=>Math.acos(r.evaluate(s))],atan:[er,[er],(s,[r])=>Math.atan(r.evaluate(s))],min:[er,Xs(er),(s,r)=>Math.min(...r.map((l=>l.evaluate(s))))],max:[er,Xs(er),(s,r)=>Math.max(...r.map((l=>l.evaluate(s))))],abs:[er,[er],(s,[r])=>Math.abs(r.evaluate(s))],round:[er,[er],(s,[r])=>{const l=r.evaluate(s);return l<0?-Math.round(-l):Math.round(l)}],floor:[er,[er],(s,[r])=>Math.floor(r.evaluate(s))],ceil:[er,[er],(s,[r])=>Math.ceil(r.evaluate(s))],"filter-==":[Mr,[Br,vi],(s,[r,l])=>s.properties()[r.value]===l.value],"filter-id-==":[Mr,[vi],(s,[r])=>s.id()===r.value],"filter-type-==":[Mr,[Br],(s,[r])=>s.geometryType()===r.value],"filter-<":[Mr,[Br,vi],(s,[r,l])=>{const h=s.properties()[r.value],p=l.value;return typeof h==typeof p&&h<p}],"filter-id-<":[Mr,[vi],(s,[r])=>{const l=s.id(),h=r.value;return typeof l==typeof h&&l<h}],"filter->":[Mr,[Br,vi],(s,[r,l])=>{const h=s.properties()[r.value],p=l.value;return typeof h==typeof p&&h>p}],"filter-id->":[Mr,[vi],(s,[r])=>{const l=s.id(),h=r.value;return typeof l==typeof h&&l>h}],"filter-<=":[Mr,[Br,vi],(s,[r,l])=>{const h=s.properties()[r.value],p=l.value;return typeof h==typeof p&&h<=p}],"filter-id-<=":[Mr,[vi],(s,[r])=>{const l=s.id(),h=r.value;return typeof l==typeof h&&l<=h}],"filter->=":[Mr,[Br,vi],(s,[r,l])=>{const h=s.properties()[r.value],p=l.value;return typeof h==typeof p&&h>=p}],"filter-id->=":[Mr,[vi],(s,[r])=>{const l=s.id(),h=r.value;return typeof l==typeof h&&l>=h}],"filter-has":[Mr,[vi],(s,[r])=>r.value in s.properties()],"filter-has-id":[Mr,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[Mr,[fs(Br)],(s,[r])=>r.value.indexOf(s.geometryType())>=0],"filter-id-in":[Mr,[fs(vi)],(s,[r])=>r.value.indexOf(s.id())>=0],"filter-in-small":[Mr,[Br,fs(vi)],(s,[r,l])=>l.value.indexOf(s.properties()[r.value])>=0],"filter-in-large":[Mr,[Br,fs(vi)],(s,[r,l])=>(function(h,p,x,w){for(;x<=w;){const A=x+w>>1;if(p[A]===h)return!0;p[A]>h?w=A-1:x=A+1}return!1})(s.properties()[r.value],l.value,0,l.value.length-1)],all:{type:Mr,overloads:[[[Mr,Mr],(s,[r,l])=>r.evaluate(s)&&l.evaluate(s)],[Xs(Mr),(s,r)=>{for(const l of r)if(!l.evaluate(s))return!1;return!0}]]},any:{type:Mr,overloads:[[[Mr,Mr],(s,[r,l])=>r.evaluate(s)||l.evaluate(s)],[Xs(Mr),(s,r)=>{for(const l of r)if(l.evaluate(s))return!0;return!1}]]},"!":[Mr,[Mr],(s,[r])=>!r.evaluate(s)],"is-supported-script":[Mr,[Br],(s,[r])=>{const l=s.globals&&s.globals.isSupportedScript;return!l||l(r.evaluate(s))}],upcase:[Br,[Br],(s,[r])=>r.evaluate(s).toUpperCase()],downcase:[Br,[Br],(s,[r])=>r.evaluate(s).toLowerCase()],concat:[Br,Xs(vi),(s,r)=>r.map((l=>zl(l.evaluate(s)))).join("")],"resolved-locale":[Br,[Mi],(s,[r])=>r.evaluate(s).resolvedLocale()]});var vu=xh;function Sc(s){return{result:"success",value:s}}function fl(s){return{result:"error",value:s}}function As(s){return s["property-type"]==="data-driven"}function Yu(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function $r(s){return!!s.expression&&s.expression.interpolated}function co(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function Nu(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function Ba(s){return s}function Ya(s,r){const l=r.type==="color",h=s.stops&&typeof s.stops[0][0]=="object",p=h||!(h||s.property!==void 0),x=s.type||($r(r)?"exponential":"interval");if(l&&((s=Yo({},s)).stops&&(s.stops=s.stops.map((R=>[R[0],Io.parse(R[1])]))),s.default=Io.parse(s.default?s.default:r.default)),s.colorSpace&&s.colorSpace!=="rgb"&&!gu[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let w,A,P;if(x==="exponential")w=ua;else if(x==="interval")w=Ec;else if(x==="categorical"){w=Ja,A=Object.create(null);for(const R of s.stops)A[R[0]]=R[1];P=typeof s.stops[0][0]}else{if(x!=="identity")throw new Error(`Unknown function type "${x}"`);w=bh}if(h){const R={},$=[];for(let he=0;he<s.stops.length;he++){const ye=s.stops[he],Se=ye[0].zoom;R[Se]===void 0&&(R[Se]={zoom:Se,type:s.type,property:s.property,default:s.default,stops:[]},$.push(Se)),R[Se].stops.push([ye[0].value,ye[1]])}const X=[];for(const he of $)X.push([R[he].zoom,Ya(R[he],r)]);const re={name:"linear"};return{kind:"composite",interpolationType:re,interpolationFactor:Fa.interpolationFactor.bind(void 0,re),zoomStops:X.map((he=>he[0])),evaluate:({zoom:he},ye)=>ua({stops:X,base:s.base},r,he).evaluate(he,ye)}}if(p){const R=x==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:R,interpolationFactor:Fa.interpolationFactor.bind(void 0,R),zoomStops:s.stops.map(($=>$[0])),evaluate:({zoom:$})=>w(s,r,$,A,P)}}return{kind:"source",evaluate(R,$){const X=$&&$.properties?$.properties[s.property]:void 0;return X===void 0?Ta(s.default,r.default):w(s,r,X,A,P)}}}function Ta(s,r,l){return s!==void 0?s:r!==void 0?r:l!==void 0?l:void 0}function Ja(s,r,l,h,p){return Ta(typeof l===p?h[l]:void 0,s.default,r.default)}function Ec(s,r,l){if(co(l)!=="number")return Ta(s.default,r.default);const h=s.stops.length;if(h===1||l<=s.stops[0][0])return s.stops[0][1];if(l>=s.stops[h-1][0])return s.stops[h-1][1];const p=L(s.stops.map((x=>x[0])),l);return s.stops[p][1]}function ua(s,r,l){const h=s.base!==void 0?s.base:1;if(co(l)!=="number")return Ta(s.default,r.default);const p=s.stops.length;if(p===1||l<=s.stops[0][0])return s.stops[0][1];if(l>=s.stops[p-1][0])return s.stops[p-1][1];const x=L(s.stops.map(($=>$[0])),l),w=(function($,X,re,he){const ye=he-re,Se=$-re;return ye===0?0:X===1?Se/ye:(Math.pow(X,Se)-1)/(Math.pow(X,ye)-1)})(l,h,s.stops[x][0],s.stops[x+1][0]),A=s.stops[x][1],P=s.stops[x+1][1];let R=Kt[r.type]||Ba;if(s.colorSpace&&s.colorSpace!=="rgb"){const $=gu[s.colorSpace];R=(X,re)=>$.reverse($.interpolate($.forward(X),$.forward(re),w))}return typeof A.evaluate=="function"?{evaluate(...$){const X=A.evaluate.apply(void 0,$),re=P.evaluate.apply(void 0,$);if(X!==void 0&&re!==void 0)return R(X,re,w)}}:R(A,P,w)}function bh(s,r,l){return r.type==="color"?l=Io.parse(l):r.type==="formatted"?l=vo.fromString(l.toString()):r.type==="resolvedImage"?l=Us.fromString(l.toString()):co(l)===r.type||r.type==="enum"&&r.values[l]||(l=void 0),Ta(l,s.default,r.default)}class jc{constructor(r,l){this.expression=r,this._warningHistory={},this._evaluator=new Ss,this._defaultValue=l?(function(h){return h.type==="color"&&(Nu(h.default)||Array.isArray(h.default))?new Io(0,0,0,0):h.type==="color"?Io.parse(h.default)||null:h.default===void 0?null:h.default})(l):null,this._enumValues=l&&l.type==="enum"?l.values:null}evaluateWithoutErrorHandling(r,l,h,p,x,w,A,P){return this._evaluator.globals=r,this._evaluator.feature=l,this._evaluator.featureState=h,this._evaluator.canonical=p||null,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=w,this._evaluator.featureTileCoord=A||null,this._evaluator.featureDistanceData=P||null,this.expression.evaluate(this._evaluator)}evaluate(r,l,h,p,x,w,A,P){this._evaluator.globals=r,this._evaluator.feature=l||null,this._evaluator.featureState=h||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=w||null,this._evaluator.featureTileCoord=A||null,this._evaluator.featureDistanceData=P||null;try{const R=this.expression.evaluate(this._evaluator);if(R==null||typeof R=="number"&&R!=R)return this._defaultValue;if(this._enumValues&&!(R in this._enumValues))throw new Bo(`Expected value to be one of ${Object.keys(this._enumValues).map(($=>JSON.stringify($))).join(", ")}, but found ${JSON.stringify(R)} instead.`);return R}catch(R){return this._warningHistory[R.message]||(this._warningHistory[R.message]=!0,typeof console<"u"&&console.warn(R.message)),this._defaultValue}}}function mr(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in vu}function eo(s,r){const l=new Fc(vu,[],r?(function(p){const x={color:js,string:Br,number:er,enum:Br,boolean:Mr,formatted:wl,resolvedImage:qi};return p.type==="array"?fs(x[p.value]||vi,p.length):x[p.type]})(r):void 0),h=l.parse(s,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Sc(new jc(h,r)):fl(l.errors)}class pl{constructor(r,l){this.kind=r,this._styleExpression=l,this.isStateDependent=r!=="constant"&&!zo(l.expression)}evaluateWithoutErrorHandling(r,l,h,p,x,w){return this._styleExpression.evaluateWithoutErrorHandling(r,l,h,p,x,w)}evaluate(r,l,h,p,x,w){return this._styleExpression.evaluate(r,l,h,p,x,w)}}class ru{constructor(r,l,h,p){this.kind=r,this.zoomStops=h,this._styleExpression=l,this.isStateDependent=r!=="camera"&&!zo(l.expression),this.interpolationType=p}evaluateWithoutErrorHandling(r,l,h,p,x,w){return this._styleExpression.evaluateWithoutErrorHandling(r,l,h,p,x,w)}evaluate(r,l,h,p,x,w){return this._styleExpression.evaluate(r,l,h,p,x,w)}interpolationFactor(r,l,h){return this.interpolationType?Fa.interpolationFactor(this.interpolationType,r,l,h):0}}function ac(s,r){if((s=eo(s,r)).result==="error")return s;const l=s.value.expression,h=Mo(l);if(!h&&!As(r))return fl([new Wa("","data expressions not supported")]);const p=es(l,["zoom","pitch","distance-from-center"]);if(!p&&!Yu(r))return fl([new Wa("","zoom expressions not supported")]);const x=ou(l);return x||p?x instanceof Wa?fl([x]):x instanceof Fa&&!$r(r)?fl([new Wa("",'"interpolate" expressions cannot be used with this property')]):Sc(x?new ru(h?"camera":"composite",s.value,x.labels,x instanceof Fa?x.interpolation:void 0):new pl(h?"constant":"source",s.value)):fl([new Wa("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class iu{constructor(r,l){this._parameters=r,this._specification=l,Yo(this,Ya(this._parameters,this._specification))}static deserialize(r){return new iu(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function ou(s){let r=null;if(s instanceof Aa)r=ou(s.result);else if(s instanceof vs){for(const l of s.args)if(r=ou(l),r)break}else(s instanceof ve||s instanceof Fa)&&s.input instanceof ia&&s.input.name==="zoom"&&(r=s);return r instanceof Wa||s.eachChild((l=>{const h=ou(l);h instanceof Wa?r=h:!r&&h?r=new Wa("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&h&&r!==h&&(r=new Wa("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),r}class An{constructor(r,l,h,p){this.message=(r?`${r}: `:"")+h,p&&(this.identifier=p),l!=null&&l.__line__&&(this.line=l.__line__)}}function Ts(s){const r=s.key,l=s.value,h=s.valueSpec||{},p=s.objectElementValidators||{},x=s.style,w=s.styleSpec;let A=[];const P=co(l);if(P!=="object")return[new An(r,l,`object expected, ${P} found`)];for(const R in l){const $=R.split(".")[0];let X;p[$]?X=p[$]:h[$]?X=Gi:p["*"]?X=p["*"]:h["*"]&&(X=Gi),X?A=A.concat(X({key:(r&&`${r}.`)+R,value:l[R],valueSpec:h[$]||h["*"],style:x,styleSpec:w,object:l,objectKey:R},l)):A.push(new An(r,l[R],`unknown property "${R}"`))}for(const R in h)p[R]||h[R].required&&h[R].default===void 0&&l[R]===void 0&&A.push(new An(r,l,`missing required property "${R}"`));return A}function Vo(s){const r=s.value,l=s.valueSpec,h=s.style,p=s.styleSpec,x=s.key,w=s.arrayElementValidator||Gi;if(co(r)!=="array")return[new An(x,r,`array expected, ${co(r)} found`)];if(l.length&&r.length!==l.length)return[new An(x,r,`array length ${l.length} expected, length ${r.length} found`)];if(l["min-length"]&&r.length<l["min-length"])return[new An(x,r,`array length at least ${l["min-length"]} expected, length ${r.length} found`)];let A={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};p.$version<7&&(A.function=l.function),co(l.value)==="object"&&(A=l.value);let P=[];for(let R=0;R<r.length;R++)P=P.concat(w({array:r,arrayIndex:R,value:r[R],valueSpec:A,style:h,styleSpec:p,key:`${x}[${R}]`}));return P}function Tl(s){const r=s.key,l=s.value,h=s.valueSpec;let p=co(l);if(p==="number"&&l!=l&&(p="NaN"),p!=="number")return[new An(r,l,`number expected, ${p} found`)];if("minimum"in h){let x=h.minimum;if(co(h.minimum)==="array"&&(x=h.minimum[s.arrayIndex]),l<x)return[new An(r,l,`${l} is less than the minimum value ${x}`)]}if("maximum"in h){let x=h.maximum;if(co(h.maximum)==="array"&&(x=h.maximum[s.arrayIndex]),l>x)return[new An(r,l,`${l} is greater than the maximum value ${x}`)]}return[]}function _a(s){const r=s.valueSpec,l=ss(s.value.type);let h,p,x,w={};const A=l!=="categorical"&&s.value.property===void 0,P=!A,R=co(s.value.stops)==="array"&&co(s.value.stops[0])==="array"&&co(s.value.stops[0][0])==="object",$=Ts({key:s.key,value:s.value,valueSpec:s.styleSpec.function,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(he){if(l==="identity")return[new An(he.key,he.value,'identity function may not have a "stops" property')];let ye=[];const Se=he.value;return ye=ye.concat(Vo({key:he.key,value:Se,valueSpec:he.valueSpec,style:he.style,styleSpec:he.styleSpec,arrayElementValidator:X})),co(Se)==="array"&&Se.length===0&&ye.push(new An(he.key,Se,"array must have at least one stop")),ye},default:function(he){return Gi({key:he.key,value:he.value,valueSpec:r,style:he.style,styleSpec:he.styleSpec})}}});return l==="identity"&&A&&$.push(new An(s.key,s.value,'missing required property "property"')),l==="identity"||s.value.stops||$.push(new An(s.key,s.value,'missing required property "stops"')),l==="exponential"&&s.valueSpec.expression&&!$r(s.valueSpec)&&$.push(new An(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(P&&!As(s.valueSpec)?$.push(new An(s.key,s.value,"property functions not supported")):A&&!Yu(s.valueSpec)&&$.push(new An(s.key,s.value,"zoom functions not supported"))),l!=="categorical"&&!R||s.value.property!==void 0||$.push(new An(s.key,s.value,'"property" property is required')),$;function X(he){let ye=[];const Se=he.value,Ke=he.key;if(co(Se)!=="array")return[new An(Ke,Se,`array expected, ${co(Se)} found`)];if(Se.length!==2)return[new An(Ke,Se,`array length 2 expected, length ${Se.length} found`)];if(R){if(co(Se[0])!=="object")return[new An(Ke,Se,`object expected, ${co(Se[0])} found`)];if(Se[0].zoom===void 0)return[new An(Ke,Se,"object stop key must have zoom")];if(Se[0].value===void 0)return[new An(Ke,Se,"object stop key must have value")];const at=ss(Se[0].zoom);if(typeof at!="number")return[new An(Ke,Se[0].zoom,"stop zoom values must be numbers")];if(x&&x>at)return[new An(Ke,Se[0].zoom,"stop zoom values must appear in ascending order")];at!==x&&(x=at,p=void 0,w={}),ye=ye.concat(Ts({key:`${Ke}[0]`,value:Se[0],valueSpec:{zoom:{}},style:he.style,styleSpec:he.styleSpec,objectElementValidators:{zoom:Tl,value:re}}))}else ye=ye.concat(re({key:`${Ke}[0]`,value:Se[0],style:he.style,styleSpec:he.styleSpec},Se));return mr(_i(Se[1]))?ye.concat([new An(`${Ke}[1]`,Se[1],"expressions are not allowed in function stops.")]):ye.concat(Gi({key:`${Ke}[1]`,value:Se[1],valueSpec:r,style:he.style,styleSpec:he.styleSpec}))}function re(he,ye){const Se=co(he.value),Ke=ss(he.value),at=he.value!==null?he.value:ye;if(h){if(Se!==h)return[new An(he.key,at,`${Se} stop domain type must match previous stop domain type ${h}`)]}else h=Se;if(Se!=="number"&&Se!=="string"&&Se!=="boolean"&&typeof Ke!="number"&&typeof Ke!="string"&&typeof Ke!="boolean")return[new An(he.key,at,"stop domain value must be a number, string, or boolean")];if(Se!=="number"&&l!=="categorical"){let xt=`number expected, ${Se} found`;return As(r)&&l===void 0&&(xt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new An(he.key,at,xt)]}return l!=="categorical"||Se!=="number"||typeof Ke=="number"&&isFinite(Ke)&&Math.floor(Ke)===Ke?l!=="categorical"&&Se==="number"&&typeof Ke=="number"&&typeof p=="number"&&p!==void 0&&Ke<p?[new An(he.key,at,"stop domain values must appear in ascending order")]:(p=Ke,l==="categorical"&&Ke in w?[new An(he.key,at,"stop domain values must be unique")]:(w[Ke]=!0,[])):[new An(he.key,at,`integer expected, found ${String(Ke)}`)]}}function Ri(s){const r=(s.expressionContext==="property"?ac:eo)(_i(s.value),s.valueSpec);if(r.result==="error")return r.value.map((h=>new An(`${s.key}${h.key}`,s.value,h.message)));const l=r.value.expression||r.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!l.outputDefined())return[new An(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!zo(l))return[new An(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter")return ha(l,s);if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!es(l,["zoom","feature-state"]))return[new An(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!Mo(l))return[new An(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ha(s,r){const l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const p of r.valueSpec.expression.parameters)l.delete(p);if(l.size===0)return[];const h=[];return s instanceof ia&&l.has(s.name)?[new An(r.key,r.value,`["${s.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(s.eachChild((p=>{h.push(...ha(p,r))})),h)}function Rh(s){const r=s.key,l=s.value,h=s.valueSpec,p=[];return Array.isArray(h.values)?h.values.indexOf(ss(l))===-1&&p.push(new An(r,l,`expected one of [${h.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(h.values).indexOf(ss(l))===-1&&p.push(new An(r,l,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(l)} found`)),p}function wh(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const r of s.slice(1))if(!wh(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}function Qr(s,r="fill"){if(s==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};wh(s)||(s=Du(s));const l=s;let h=!0;try{h=(function(R){if(!Zs(R))return R;let $=_i(R);return Mh($),$=xu($),$})(l)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(l,null,2)}
        `)}const p=mn[`filter_${r}`],x=eo(h,p);let w=null;if(x.result==="error")throw new Error(x.value.map((R=>`${R.key}: ${R.message}`)).join(", "));w=(R,$,X)=>x.value.evaluate(R,$,{},X);let A=null,P=null;if(h!==l){const R=eo(l,p);if(R.result==="error")throw new Error(R.value.map(($=>`${$.key}: ${$.message}`)).join(", "));A=($,X,re,he,ye)=>R.value.evaluate($,X,{},re,void 0,void 0,he,ye),P=!Mo(R.value.expression)}return{filter:w,dynamicFilter:A||void 0,needGeometry:Uc(h),needFeature:!!P}}function xu(s){if(!Array.isArray(s))return s;const r=(function(l){if(Qa.has(l[0])){for(let h=1;h<l.length;h++)if(Zs(l[h]))return!0}return l})(s);return r===!0?r:r.map((l=>xu(l)))}function Mh(s){let r=!1;const l=[];if(s[0]==="case"){for(let h=1;h<s.length-1;h+=2)r=r||Zs(s[h]),l.push(s[h+1]);l.push(s[s.length-1])}else if(s[0]==="match"){r=r||Zs(s[1]);for(let h=2;h<s.length-1;h+=2)l.push(s[h+1]);l.push(s[s.length-1])}else if(s[0]==="step"){r=r||Zs(s[1]);for(let h=1;h<s.length-1;h+=2)l.push(s[h+1])}r&&(s.length=0,s.push("any",...l));for(let h=1;h<s.length;h++)Mh(s[h])}function Zs(s){if(!Array.isArray(s))return!1;if((r=s[0])==="pitch"||r==="distance-from-center")return!0;var r;for(let l=1;l<s.length;l++)if(Zs(s[l]))return!0;return!1}const Qa=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Nh(s,r){return s<r?-1:s>r?1:0}function Uc(s){if(!Array.isArray(s))return!1;if(s[0]==="within")return!0;for(let r=1;r<s.length;r++)if(Uc(s[r]))return!0;return!1}function Du(s){if(!s)return!0;const r=s[0];return s.length<=1?r!=="any":r==="=="?gd(s[1],s[2],"=="):r==="!="?da(gd(s[1],s[2],"==")):r==="<"||r===">"||r==="<="||r===">="?gd(s[1],s[2],r):r==="any"?(l=s.slice(1),["any"].concat(l.map(Du))):r==="all"?["all"].concat(s.slice(1).map(Du)):r==="none"?["all"].concat(s.slice(1).map(Du).map(da)):r==="in"?za(s[1],s.slice(2)):r==="!in"?da(za(s[1],s.slice(2))):r==="has"?Ui(s[1]):r==="!has"?da(Ui(s[1])):r!=="within"||s;var l}function gd(s,r,l){switch(s){case"$type":return[`filter-type-${l}`,r];case"$id":return[`filter-id-${l}`,r];default:return[`filter-${l}`,s,r]}}function za(s,r){if(r.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some((l=>typeof l!=typeof r[0]))?["filter-in-large",s,["literal",r.sort(Nh)]]:["filter-in-small",s,["literal",r]]}}function Ui(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function da(s){return["!",s]}function ja(s){return wh(_i(s.value))?Ri(Yo({},s,{expressionContext:"filter",valueSpec:s.styleSpec[`filter_${s.layerType||"fill"}`]})):su(s)}function su(s){const r=s.value,l=s.key;if(co(r)!=="array")return[new An(l,r,`array expected, ${co(r)} found`)];const h=s.styleSpec;let p,x=[];if(r.length<1)return[new An(l,r,"filter array must have at least 1 element")];switch(x=x.concat(Rh({key:`${l}[0]`,value:r[0],valueSpec:h.filter_operator,style:s.style,styleSpec:s.styleSpec})),ss(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&ss(r[1])==="$type"&&x.push(new An(l,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&x.push(new An(l,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(p=co(r[1]),p!=="string"&&x.push(new An(`${l}[1]`,r[1],`string expected, ${p} found`)));for(let w=2;w<r.length;w++)p=co(r[w]),ss(r[1])==="$type"?x=x.concat(Rh({key:`${l}[${w}]`,value:r[w],valueSpec:h.geometry_type,style:s.style,styleSpec:s.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&x.push(new An(`${l}[${w}]`,r[w],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let w=1;w<r.length;w++)x=x.concat(su({key:`${l}[${w}]`,value:r[w],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":p=co(r[1]),r.length!==2?x.push(new An(l,r,`filter array for "${r[0]}" operator must have 2 elements`)):p!=="string"&&x.push(new An(`${l}[1]`,r[1],`string expected, ${p} found`));break;case"within":p=co(r[1]),r.length!==2?x.push(new An(l,r,`filter array for "${r[0]}" operator must have 2 elements`)):p!=="object"&&x.push(new An(`${l}[1]`,r[1],`object expected, ${p} found`))}return x}function to(s,r){const l=s.key,h=s.style,p=s.styleSpec,x=s.value,w=s.objectKey,A=p[`${r}_${s.layerType}`];if(!A)return[];const P=w.match(/^(.*)-transition$/);if(r==="paint"&&P&&A[P[1]]&&A[P[1]].transition)return Gi({key:l,value:x,valueSpec:p.transition,style:h,styleSpec:p});const R=s.valueSpec||A[w];if(!R)return[new An(l,x,`unknown property "${w}"`)];let $;if(co(x)==="string"&&As(R)&&!R.tokens&&($=/^{([^}]+)}$/.exec(x))){const re=`\`{ "type": "identity", "property": ${$?JSON.stringify($[1]):'"_"'} }\``;return[new An(l,x,`"${w}" does not support interpolation syntax
Use an identity property function instead: ${re}.`)]}const X=[];return s.layerType==="symbol"&&(w==="text-field"&&h&&!h.glyphs&&X.push(new An(l,x,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&Nu(_i(x))&&ss(x.type)==="identity"&&X.push(new An(l,x,'"text-font" does not support identity functions'))),X.concat(Gi({key:s.key,value:x,valueSpec:R,style:h,styleSpec:p,expressionContext:"property",propertyType:r,propertyKey:w}))}function Il(s){return to(s,"paint")}function Dh(s){return to(s,"layout")}function df(s){let r=[];const l=s.value,h=s.key,p=s.style,x=s.styleSpec;l.type||l.ref||r.push(new An(h,l,'either "type" or "ref" is required'));let w=ss(l.type);const A=ss(l.ref);if(l.id){const P=ss(l.id);for(let R=0;R<s.arrayIndex;R++){const $=p.layers[R];ss($.id)===P&&r.push(new An(h,l.id,`duplicate layer id "${l.id}", previously used at line ${$.id.__line__}`))}}if("ref"in l){let P;["type","source","source-layer","filter","layout"].forEach((R=>{R in l&&r.push(new An(h,l[R],`"${R}" is prohibited for ref layers`))})),p.layers.forEach((R=>{ss(R.id)===A&&(P=R)})),P?P.ref?r.push(new An(h,l.ref,"ref cannot reference another ref layer")):w=ss(P.type):typeof A=="string"&&r.push(new An(h,l.ref,`ref layer "${A}" not found`))}else if(w!=="background"&&w!=="sky")if(l.source){const P=p.sources&&p.sources[l.source],R=P&&ss(P.type);P?R==="vector"&&w==="raster"?r.push(new An(h,l.source,`layer "${l.id}" requires a raster source`)):R==="raster"&&w!=="raster"?r.push(new An(h,l.source,`layer "${l.id}" requires a vector source`)):R!=="vector"||l["source-layer"]?R==="raster-dem"&&w!=="hillshade"?r.push(new An(h,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):w!=="line"||!l.paint||!l.paint["line-gradient"]&&!l.paint["line-trim-offset"]||R==="geojson"&&P.lineMetrics||r.push(new An(h,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new An(h,l,`layer "${l.id}" must specify a "source-layer"`)):r.push(new An(h,l.source,`source "${l.source}" not found`))}else r.push(new An(h,l,'missing required property "source"'));return r=r.concat(Ts({key:h,value:l,valueSpec:x.layer,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Gi({key:`${h}.type`,value:l.type,valueSpec:x.layer.type,style:s.style,styleSpec:s.styleSpec,object:l,objectKey:"type"}),filter:P=>ja(Yo({layerType:w},P)),layout:P=>Ts({layer:l,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":R=>Dh(Yo({layerType:w},R))}}),paint:P=>Ts({layer:l,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":R=>Il(Yo({layerType:w},R))}})}})),r}function el(s){const r=s.value,l=s.key,h=co(r);return h!=="string"?[new An(l,r,`string expected, ${h} found`)]:[]}const Ia={promoteId:function({key:s,value:r}){if(co(r)==="string")return el({key:s,value:r});{const l=[];for(const h in r)l.push(...el({key:`${s}.${h}`,value:r[h]}));return l}}};function Ac(s){const r=s.value,l=s.key,h=s.styleSpec,p=s.style;if(!r.type)return[new An(l,r,'"type" is required')];const x=ss(r.type);let w;switch(x){case"vector":case"raster":case"raster-dem":return w=Ts({key:l,value:r,valueSpec:h[`source_${x.replace("-","_")}`],style:s.style,styleSpec:h,objectElementValidators:Ia}),w;case"geojson":if(w=Ts({key:l,value:r,valueSpec:h.source_geojson,style:p,styleSpec:h,objectElementValidators:Ia}),r.cluster)for(const A in r.clusterProperties){const[P,R]=r.clusterProperties[A],$=typeof P=="string"?[P,["accumulated"],["get",A]]:P;w.push(...Ri({key:`${l}.${A}.map`,value:R,expressionContext:"cluster-map"})),w.push(...Ri({key:`${l}.${A}.reduce`,value:$,expressionContext:"cluster-reduce"}))}return w;case"video":return Ts({key:l,value:r,valueSpec:h.source_video,style:p,styleSpec:h});case"image":return Ts({key:l,value:r,valueSpec:h.source_image,style:p,styleSpec:h});case"canvas":return[new An(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Rh({key:`${l}.type`,value:r.type,valueSpec:{values:Yh(h)}})}}function Yh(s){return s.source.reduce(((r,l)=>{const h=s[l];return h.type.type==="enum"&&(r=r.concat(Object.keys(h.type.values))),r}),[])}function Sh(s){const r=s.value,l=s.styleSpec,h=l.light,p=s.style;let x=[];const w=co(r);if(r===void 0)return x;if(w!=="object")return x=x.concat([new An("light",r,`object expected, ${w} found`)]),x;for(const A in r){const P=A.match(/^(.*)-transition$/);x=x.concat(P&&h[P[1]]&&h[P[1]].transition?Gi({key:A,value:r[A],valueSpec:l.transition,style:p,styleSpec:l}):h[A]?Gi({key:A,value:r[A],valueSpec:h[A],style:p,styleSpec:l}):[new An(A,r[A],`unknown property "${A}"`)])}return x}function Ua(s){const r=s.value,l=s.key,h=s.style,p=s.styleSpec,x=p.terrain;let w=[];const A=co(r);if(r===void 0)return w;if(A!=="object")return w=w.concat([new An("terrain",r,`object expected, ${A} found`)]),w;for(const P in r){const R=P.match(/^(.*)-transition$/);w=w.concat(R&&x[R[1]]&&x[R[1]].transition?Gi({key:P,value:r[P],valueSpec:p.transition,style:h,styleSpec:p}):x[P]?Gi({key:P,value:r[P],valueSpec:x[P],style:h,styleSpec:p}):[new An(P,r[P],`unknown property "${P}"`)])}if(r.source){const P=h.sources&&h.sources[r.source],R=P&&ss(P.type);P?R!=="raster-dem"&&w.push(new An(l,r.source,`terrain cannot be used with a source of type ${String(R)}, it only be used with a "raster-dem" source type`)):w.push(new An(l,r.source,`source "${r.source}" not found`))}else w.push(new An(l,r,'terrain is missing required property "source"'));return w}function lc(s){const r=s.value,l=s.style,h=s.styleSpec,p=h.fog;let x=[];const w=co(r);if(r===void 0)return x;if(w!=="object")return x=x.concat([new An("fog",r,`object expected, ${w} found`)]),x;for(const A in r){const P=A.match(/^(.*)-transition$/);x=x.concat(P&&p[P[1]]&&p[P[1]].transition?Gi({key:A,value:r[A],valueSpec:h.transition,style:l,styleSpec:h}):p[A]?Gi({key:A,value:r[A],valueSpec:p[A],style:l,styleSpec:h}):[new An(A,r[A],`unknown property "${A}"`)])}return x}const qo={"*":()=>[],array:Vo,boolean:function(s){const r=s.value,l=s.key,h=co(r);return h!=="boolean"?[new An(l,r,`boolean expected, ${h} found`)]:[]},number:Tl,color:function(s){const r=s.key,l=s.value,h=co(l);return h!=="string"?[new An(r,l,`color expected, ${h} found`)]:oc(l)===null?[new An(r,l,`color expected, "${l}" found`)]:[]},enum:Rh,filter:ja,function:_a,layer:df,object:Ts,source:Ac,light:Sh,terrain:Ua,fog:lc,string:el,formatted:function(s){return el(s).length===0?[]:Ri(s)},resolvedImage:function(s){return el(s).length===0?[]:Ri(s)},projection:function(s){const r=s.value,l=s.styleSpec,h=l.projection,p=s.style;let x=[];const w=co(r);if(w==="object")for(const A in r)x=x.concat(Gi({key:A,value:r[A],valueSpec:h[A],style:p,styleSpec:l}));else w!=="string"&&(x=x.concat([new An("projection",r,`object or string expected, ${w} found`)]));return x}};function Gi(s){const r=s.value,l=s.valueSpec,h=s.styleSpec;return l.expression&&Nu(ss(r))?_a(s):l.expression&&mr(_i(r))?Ri(s):l.type&&qo[l.type]?qo[l.type](s):Ts(Yo({},s,{valueSpec:l.type?h[l.type]:l}))}function cc(s){const r=s.value,l=s.key,h=el(s);return h.length||(r.indexOf("{fontstack}")===-1&&h.push(new An(l,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&h.push(new An(l,r,'"glyphs" url must include a "{range}" token'))),h}function tl(s,r=mn){return Ca(Gi({key:"",value:s,valueSpec:r.$root,styleSpec:r,style:s,objectElementValidators:{glyphs:cc,"*":()=>[]}}))}const $l=s=>Ca(Il(s)),Ju=s=>Ca(Dh(s));function Ca(s){return s.slice().sort(((r,l)=>r.line&&l.line?r.line-l.line:0))}function La(s,r){let l=!1;if(r&&r.length)for(const h of r)s.fire(new Sa(new Error(h.message))),l=!0;return l}var Jh=Gl,uc=3;function Gl(s,r,l){var h=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var p=new Int32Array(this.arrayBuffer);s=p[0],this.d=(r=p[1])+2*(l=p[2]);for(var x=0;x<this.d*this.d;x++){var w=p[uc+x],A=p[uc+x+1];h.push(w===A?null:p.subarray(w,A))}var P=p[uc+h.length+1];this.keys=p.subarray(p[uc+h.length],P),this.bboxes=p.subarray(P),this.insert=this._insertReadonly}else{this.d=r+2*l;for(var R=0;R<this.d*this.d;R++)h.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=s,this.padding=l,this.scale=r/s,this.uid=0;var $=l/r*s;this.min=-$,this.max=s+$}Gl.prototype.insert=function(s,r,l,h,p){this._forEachCell(r,l,h,p,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(r),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(p)},Gl.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Gl.prototype._insertCell=function(s,r,l,h,p,x){this.cells[p].push(x)},Gl.prototype.query=function(s,r,l,h,p){var x=this.min,w=this.max;if(s<=x&&r<=x&&w<=l&&w<=h&&!p)return Array.prototype.slice.call(this.keys);var A=[];return this._forEachCell(s,r,l,h,this._queryCell,A,{},p),A},Gl.prototype._queryCell=function(s,r,l,h,p,x,w,A){var P=this.cells[p];if(P!==null)for(var R=this.keys,$=this.bboxes,X=0;X<P.length;X++){var re=P[X];if(w[re]===void 0){var he=4*re;(A?A($[he+0],$[he+1],$[he+2],$[he+3]):s<=$[he+2]&&r<=$[he+3]&&l>=$[he+0]&&h>=$[he+1])?(w[re]=!0,x.push(R[re])):w[re]=!1}}},Gl.prototype._forEachCell=function(s,r,l,h,p,x,w,A){for(var P=this._convertToCellCoord(s),R=this._convertToCellCoord(r),$=this._convertToCellCoord(l),X=this._convertToCellCoord(h),re=P;re<=$;re++)for(var he=R;he<=X;he++){var ye=this.d*he+re;if((!A||A(this._convertFromCellCoord(re),this._convertFromCellCoord(he),this._convertFromCellCoord(re+1),this._convertFromCellCoord(he+1)))&&p.call(this,s,r,l,h,ye,x,w,A))return}},Gl.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},Gl.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},Gl.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,r=uc+this.cells.length+1+1,l=0,h=0;h<this.cells.length;h++)l+=this.cells[h].length;var p=new Int32Array(r+l+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var x=r,w=0;w<s.length;w++){var A=s[w];p[uc+w]=x,p.set(A,x),x+=A.length}return p[uc+s.length]=x,p.set(this.keys,x),p[uc+s.length+1]=x+=this.keys.length,p.set(this.bboxes,x),x+=this.bboxes.length,p.buffer};var Cl=ue(Jh);const Qu={};function ur(s,r,l={}){Object.defineProperty(s,"_classRegistryKey",{value:r,writeable:!1}),Qu[r]={klass:s,omit:l.omit||[]}}ur(Object,"Object"),Cl.serialize=function(s,r){const l=s.toArrayBuffer();return r&&r.push(l),{buffer:l}},Cl.deserialize=function(s){return new Cl(s.buffer)},Object.defineProperty(Cl,"name",{value:"Grid"}),ur(Cl,"Grid"),ur(Io,"Color"),ur(Error,"Error"),ur(oi,"AJAXError"),ur(Us,"ResolvedImage"),ur(iu,"StylePropertyFunction"),ur(jc,"StyleExpression",{omit:["_evaluator"]}),ur(ru,"ZoomDependentExpression"),ur(pl,"ZoomConstantExpression"),ur(ia,"CompoundExpression",{omit:["_evaluate"]});for(const s in vu)Qu[vu[s]._classRegistryKey]||ur(vu[s],`Expression${s}`);function eh(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function C(s){return b.ImageBitmap&&s instanceof b.ImageBitmap}function B(s,r){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(eh(s)||C(s))return r&&r.push(s),s;if(ArrayBuffer.isView(s)){const l=s;return r&&r.push(l.buffer),l}if(s instanceof b.ImageData)return r&&r.push(s.data.buffer),s;if(Array.isArray(s)){const l=[];for(const h of s)l.push(B(h,r));return l}if(typeof s=="object"){const l=s.constructor,h=l._classRegistryKey;if(!h)throw new Error(`can't serialize object of unregistered class ${h}`);const p=l.serialize?l.serialize(s,r):{};if(!l.serialize){for(const x in s)s.hasOwnProperty(x)&&(Qu[h].omit.indexOf(x)>=0||(p[x]=B(s[x],r)));s instanceof Error&&(p.message=s.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return h!=="Object"&&(p.$name=h),p}throw new Error("can't serialize object of type "+typeof s)}function ee(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||eh(s)||C(s)||ArrayBuffer.isView(s)||s instanceof b.ImageData)return s;if(Array.isArray(s))return s.map(ee);if(typeof s=="object"){const r=s.$name||"Object",{klass:l}=Qu[r];if(!l)throw new Error(`can't deserialize unregistered class ${r}`);if(l.deserialize)return l.deserialize(s);const h=Object.create(l.prototype);for(const p of Object.keys(s))p!=="$name"&&(h[p]=ee(s[p]));return h}throw new Error("can't deserialize object of type "+typeof s)}const oe={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function Pe(s){for(const r of s)if(Je(r.charCodeAt(0)))return!0;return!1}function Ve(s){for(const r of s)if(!We(r.charCodeAt(0)))return!1;return!0}function We(s){return!(oe.Arabic(s)||oe["Arabic Supplement"](s)||oe["Arabic Extended-A"](s)||oe["Arabic Presentation Forms-A"](s)||oe["Arabic Presentation Forms-B"](s))}function Je(s){return!(s!==746&&s!==747&&(s<4352||!(oe["Bopomofo Extended"](s)||oe.Bopomofo(s)||oe["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||oe["CJK Compatibility Ideographs"](s)||oe["CJK Compatibility"](s)||oe["CJK Radicals Supplement"](s)||oe["CJK Strokes"](s)||!(!oe["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||oe["CJK Unified Ideographs Extension A"](s)||oe["CJK Unified Ideographs"](s)||oe["Enclosed CJK Letters and Months"](s)||oe["Hangul Compatibility Jamo"](s)||oe["Hangul Jamo Extended-A"](s)||oe["Hangul Jamo Extended-B"](s)||oe["Hangul Jamo"](s)||oe["Hangul Syllables"](s)||oe.Hiragana(s)||oe["Ideographic Description Characters"](s)||oe.Kanbun(s)||oe["Kangxi Radicals"](s)||oe["Katakana Phonetic Extensions"](s)||oe.Katakana(s)&&s!==12540||!(!oe["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!oe["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||oe["Unified Canadian Aboriginal Syllabics"](s)||oe["Unified Canadian Aboriginal Syllabics Extended"](s)||oe["Vertical Forms"](s)||oe["Yijing Hexagram Symbols"](s)||oe["Yi Syllables"](s)||oe["Yi Radicals"](s))))}function nt(s){return!(Je(s)||(function(r){return!!(oe["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||oe["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||oe["Letterlike Symbols"](r)||oe["Number Forms"](r)||oe["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||oe["Control Pictures"](r)&&r!==9251||oe["Optical Character Recognition"](r)||oe["Enclosed Alphanumerics"](r)||oe["Geometric Shapes"](r)||oe["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||oe["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||oe["CJK Symbols and Punctuation"](r)||oe.Katakana(r)||oe["Private Use Area"](r)||oe["CJK Compatibility Forms"](r)||oe["Small Form Variants"](r)||oe["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)})(s))}function ut(s){return s>=1424&&s<=2303||oe["Arabic Presentation Forms-A"](s)||oe["Arabic Presentation Forms-B"](s)}function Nt(s,r){return!(!r&&ut(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||oe.Khmer(s))}function Yt(s){for(const r of s)if(ut(r.charCodeAt(0)))return!0;return!1}const dt="deferred",jt="loading",Qt="loaded";let En=null,y="unavailable",a=null;const f=function(s){s&&typeof s=="string"&&s.indexOf("NetworkError")>-1&&(y="error"),En&&En(s)};function v(){S.fire(new rc("pluginStateChange",{pluginStatus:y,pluginURL:a}))}const S=new ra,T=function(){return y},N=function(){if(y!==dt||!a)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");y=jt,v(),a&&hi({url:a},(s=>{s?f(s):(y=Qt,v())}))},z={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>y===Qt||z.applyArabicShaping!=null,isLoading:()=>y===jt,setState(s){y=s.pluginStatus,a=s.pluginURL},isParsed:()=>z.applyArabicShaping!=null&&z.processBidirectionalText!=null&&z.processStyledBidirectionalText!=null,getPluginURL:()=>a};class G{constructor(r,l){this.zoom=r,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.transition=l.transition,this.pitch=l.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(r){return(function(l,h){for(const p of l)if(!Nt(p.charCodeAt(0),h))return!1;return!0})(r,z.isLoaded())}}class Q{constructor(r,l){this.property=r,this.value=l,this.expression=(function(h,p){if(Nu(h))return new iu(h,p);if(mr(h)){const x=ac(h,p);if(x.result==="error")throw new Error(x.value.map((w=>`${w.key}: ${w.message}`)).join(", "));return x.value}{let x=h;return typeof h=="string"&&p.type==="color"&&(x=Io.parse(h)),{kind:"constant",evaluate:()=>x}}})(l===void 0?r.specification.default:l,r.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(r,l,h){return this.property.possiblyEvaluate(this,r,l,h)}}class te{constructor(r){this.property=r,this.value=new Q(r,void 0)}transitioned(r,l){return new Ae(this.property,this.value,l,Be({},r.transition,this.transition),r.now)}untransitioned(){return new Ae(this.property,this.value,null,{},0)}}class ge{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return Gt(this._values[r].value.value)}setValue(r,l){this._values.hasOwnProperty(r)||(this._values[r]=new te(this._values[r].property)),this._values[r].value=new Q(this._values[r].property,l===null?void 0:Gt(l))}getTransition(r){return Gt(this._values[r].transition)}setTransition(r,l){this._values.hasOwnProperty(r)||(this._values[r]=new te(this._values[r].property)),this._values[r].transition=Gt(l)||void 0}serialize(){const r={};for(const l of Object.keys(this._values)){const h=this.getValue(l);h!==void 0&&(r[l]=h);const p=this.getTransition(l);p!==void 0&&(r[`${l}-transition`]=p)}return r}transitioned(r,l){const h=new Le(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].transitioned(r,l._values[p]);return h}untransitioned(){const r=new Le(this._properties);for(const l of Object.keys(this._values))r._values[l]=this._values[l].untransitioned();return r}}class Ae{constructor(r,l,h,p,x){const w=p.delay||0,A=p.duration||0;x=x||0,this.property=r,this.value=l,this.begin=x+w,this.end=this.begin+A,r.specification.transition&&(p.delay||p.duration)&&(this.prior=h)}possiblyEvaluate(r,l,h){const p=r.now||0,x=this.value.possiblyEvaluate(r,l,h),w=this.prior;if(w){if(p>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(p<this.begin)return w.possiblyEvaluate(r,l,h);{const A=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(w.possiblyEvaluate(r,l,h),x,Oe(A))}}return x}}class Le{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,l,h){const p=new Ze(this._properties);for(const x of Object.keys(this._values))p._values[x]=this._values[x].possiblyEvaluate(r,l,h);return p}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class Xe{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}getValue(r){return Gt(this._values[r].value)}setValue(r,l){this._values[r]=new Q(this._values[r].property,l===null?void 0:Gt(l))}serialize(){const r={};for(const l of Object.keys(this._values)){const h=this.getValue(l);h!==void 0&&(r[l]=h)}return r}possiblyEvaluate(r,l,h){const p=new Ze(this._properties);for(const x of Object.keys(this._values))p._values[x]=this._values[x].possiblyEvaluate(r,l,h);return p}}class Ue{constructor(r,l,h){this.property=r,this.value=l,this.parameters=h}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,l,h,p){return this.property.evaluate(this.value,this.parameters,r,l,h,p)}}class Ze{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class _e{constructor(r){this.specification=r}possiblyEvaluate(r,l){return r.expression.evaluate(l)}interpolate(r,l,h){const p=Kt[this.specification.type];return p?p(r,l,h):r}}class $e{constructor(r,l){this.specification=r,this.overrides=l}possiblyEvaluate(r,l,h,p){return new Ue(this,r.expression.kind==="constant"||r.expression.kind==="camera"?{kind:"constant",value:r.expression.evaluate(l,null,{},h,p)}:r.expression,l)}interpolate(r,l,h){if(r.value.kind!=="constant"||l.value.kind!=="constant")return r;if(r.value.value===void 0||l.value.value===void 0)return new Ue(this,{kind:"constant",value:void 0},r.parameters);const p=Kt[this.specification.type];return p?new Ue(this,{kind:"constant",value:p(r.value.value,l.value.value,h)},r.parameters):r}evaluate(r,l,h,p,x,w){return r.kind==="constant"?r.value:r.evaluate(l,h,p,x,w)}}class it{constructor(r){this.specification=r}possiblyEvaluate(r,l,h,p){return!!r.expression.evaluate(l,null,{},h,p)}interpolate(){return!1}}class st{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const l=new G(0,{});for(const h in r){const p=r[h];p.specification.overridable&&this.overridableProperties.push(h);const x=this.defaultPropertyValues[h]=new Q(p,void 0),w=this.defaultTransitionablePropertyValues[h]=new te(p);this.defaultTransitioningPropertyValues[h]=w.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=x.possiblyEvaluate(l)}}}function bt(s,r){return 256*(s=De(Math.floor(s),0,255))+De(Math.floor(r),0,255)}ur($e,"DataDrivenProperty"),ur(_e,"DataConstantProperty"),ur(it,"ColorRampProperty");const wt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class vt{constructor(r,l){this._structArray=r,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class kt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,l){return r._trim(),l&&(r.isTransferred=!0,l.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const l=Object.create(this.prototype);return l.arrayBuffer=r.arrayBuffer,l.length=r.length,l.capacity=r.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Tt(s,r=1){let l=0,h=0;return{members:s.map((p=>{const x=wt[p.type].BYTES_PER_ELEMENT,w=l=Vt(l,Math.max(r,x)),A=p.components||1;return h=Math.max(h,x),l+=x*A,{name:p.name,type:p.type,components:A,offset:w}})),size:Vt(l,Math.max(h,r)),alignment:r}}function Vt(s,r){return Math.ceil(s/r)*r}class vn extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l){const h=this.length;return this.resize(h+1),this.emplace(h,r,l)}emplace(r,l,h){const p=2*r;return this.int16[p+0]=l,this.int16[p+1]=h,r}}vn.prototype.bytesPerElement=4,ur(vn,"StructArrayLayout2i4");class Bt extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,r,l,h)}emplace(r,l,h,p){const x=3*r;return this.int16[x+0]=l,this.int16[x+1]=h,this.int16[x+2]=p,r}}Bt.prototype.bytesPerElement=6,ur(Bt,"StructArrayLayout3i6");class ln extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,h,p){const x=this.length;return this.resize(x+1),this.emplace(x,r,l,h,p)}emplace(r,l,h,p,x){const w=4*r;return this.int16[w+0]=l,this.int16[w+1]=h,this.int16[w+2]=p,this.int16[w+3]=x,r}}ln.prototype.bytesPerElement=8,ur(ln,"StructArrayLayout4i8");class Wt extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x,w,A){const P=this.length;return this.resize(P+1),this.emplace(P,r,l,h,p,x,w,A)}emplace(r,l,h,p,x,w,A,P){const R=6*r,$=12*r,X=3*r;return this.int16[R+0]=l,this.int16[R+1]=h,this.uint8[$+4]=p,this.uint8[$+5]=x,this.uint8[$+6]=w,this.uint8[$+7]=A,this.float32[X+2]=P,r}}Wt.prototype.bytesPerElement=12,ur(Wt,"StructArrayLayout2i4ub1f12");class Cn extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,p){const x=this.length;return this.resize(x+1),this.emplace(x,r,l,h,p)}emplace(r,l,h,p,x){const w=4*r;return this.float32[w+0]=l,this.float32[w+1]=h,this.float32[w+2]=p,this.float32[w+3]=x,r}}Cn.prototype.bytesPerElement=16,ur(Cn,"StructArrayLayout4f16");class Ut extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x){const w=this.length;return this.resize(w+1),this.emplace(w,r,l,h,p,x)}emplace(r,l,h,p,x,w){const A=6*r,P=3*r;return this.uint16[A+0]=l,this.uint16[A+1]=h,this.uint16[A+2]=p,this.uint16[A+3]=x,this.float32[P+2]=w,r}}Ut.prototype.bytesPerElement=12,ur(Ut,"StructArrayLayout4ui1f12");class rn extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,h,p){const x=this.length;return this.resize(x+1),this.emplace(x,r,l,h,p)}emplace(r,l,h,p,x){const w=4*r;return this.uint16[w+0]=l,this.uint16[w+1]=h,this.uint16[w+2]=p,this.uint16[w+3]=x,r}}rn.prototype.bytesPerElement=8,ur(rn,"StructArrayLayout4ui8");class Tn extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x,w){const A=this.length;return this.resize(A+1),this.emplace(A,r,l,h,p,x,w)}emplace(r,l,h,p,x,w,A){const P=6*r;return this.int16[P+0]=l,this.int16[P+1]=h,this.int16[P+2]=p,this.int16[P+3]=x,this.int16[P+4]=w,this.int16[P+5]=A,r}}Tn.prototype.bytesPerElement=12,ur(Tn,"StructArrayLayout6i12");class cn extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x,w,A,P,R,$,X,re){const he=this.length;return this.resize(he+1),this.emplace(he,r,l,h,p,x,w,A,P,R,$,X,re)}emplace(r,l,h,p,x,w,A,P,R,$,X,re,he){const ye=12*r;return this.int16[ye+0]=l,this.int16[ye+1]=h,this.int16[ye+2]=p,this.int16[ye+3]=x,this.uint16[ye+4]=w,this.uint16[ye+5]=A,this.uint16[ye+6]=P,this.uint16[ye+7]=R,this.int16[ye+8]=$,this.int16[ye+9]=X,this.int16[ye+10]=re,this.int16[ye+11]=he,r}}cn.prototype.bytesPerElement=24,ur(cn,"StructArrayLayout4i4ui4i24");class Nn extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x,w){const A=this.length;return this.resize(A+1),this.emplace(A,r,l,h,p,x,w)}emplace(r,l,h,p,x,w,A){const P=10*r,R=5*r;return this.int16[P+0]=l,this.int16[P+1]=h,this.int16[P+2]=p,this.float32[R+2]=x,this.float32[R+3]=w,this.float32[R+4]=A,r}}Nn.prototype.bytesPerElement=20,ur(Nn,"StructArrayLayout3i3f20");class hr extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.uint32[1*r+0]=l,r}}hr.prototype.bytesPerElement=4,ur(hr,"StructArrayLayout1ul4");class Dr extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x,w,A,P,R,$,X,re,he){const ye=this.length;return this.resize(ye+1),this.emplace(ye,r,l,h,p,x,w,A,P,R,$,X,re,he)}emplace(r,l,h,p,x,w,A,P,R,$,X,re,he,ye){const Se=20*r,Ke=10*r;return this.int16[Se+0]=l,this.int16[Se+1]=h,this.int16[Se+2]=p,this.int16[Se+3]=x,this.int16[Se+4]=w,this.float32[Ke+3]=A,this.float32[Ke+4]=P,this.float32[Ke+5]=R,this.float32[Ke+6]=$,this.int16[Se+14]=X,this.uint32[Ke+8]=re,this.uint16[Se+18]=he,this.uint16[Se+19]=ye,r}}Dr.prototype.bytesPerElement=40,ur(Dr,"StructArrayLayout5i4f1i1ul2ui40");class rr extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x,w,A){const P=this.length;return this.resize(P+1),this.emplace(P,r,l,h,p,x,w,A)}emplace(r,l,h,p,x,w,A,P){const R=8*r;return this.int16[R+0]=l,this.int16[R+1]=h,this.int16[R+2]=p,this.int16[R+4]=x,this.int16[R+5]=w,this.int16[R+6]=A,this.int16[R+7]=P,r}}rr.prototype.bytesPerElement=16,ur(rr,"StructArrayLayout3i2i2i16");class Jn extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x){const w=this.length;return this.resize(w+1),this.emplace(w,r,l,h,p,x)}emplace(r,l,h,p,x,w){const A=4*r,P=8*r;return this.float32[A+0]=l,this.float32[A+1]=h,this.float32[A+2]=p,this.int16[P+6]=x,this.int16[P+7]=w,r}}Jn.prototype.bytesPerElement=16,ur(Jn,"StructArrayLayout2f1f2i16");class ni extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,p){const x=this.length;return this.resize(x+1),this.emplace(x,r,l,h,p)}emplace(r,l,h,p,x){const w=12*r,A=3*r;return this.uint8[w+0]=l,this.uint8[w+1]=h,this.float32[A+1]=p,this.float32[A+2]=x,r}}ni.prototype.bytesPerElement=12,ur(ni,"StructArrayLayout2ub2f12");class mi extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,r,l,h)}emplace(r,l,h,p){const x=3*r;return this.float32[x+0]=l,this.float32[x+1]=h,this.float32[x+2]=p,r}}mi.prototype.bytesPerElement=12,ur(mi,"StructArrayLayout3f12");class xr extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,r,l,h)}emplace(r,l,h,p){const x=3*r;return this.uint16[x+0]=l,this.uint16[x+1]=h,this.uint16[x+2]=p,r}}xr.prototype.bytesPerElement=6,ur(xr,"StructArrayLayout3ui6");class Ii extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x,w,A,P,R,$,X,re,he,ye,Se,Ke,at,xt,ct,_t,Ct){const It=this.length;return this.resize(It+1),this.emplace(It,r,l,h,p,x,w,A,P,R,$,X,re,he,ye,Se,Ke,at,xt,ct,_t,Ct)}emplace(r,l,h,p,x,w,A,P,R,$,X,re,he,ye,Se,Ke,at,xt,ct,_t,Ct,It){const sn=30*r,tn=15*r,Sn=60*r;return this.int16[sn+0]=l,this.int16[sn+1]=h,this.int16[sn+2]=p,this.float32[tn+2]=x,this.float32[tn+3]=w,this.uint16[sn+8]=A,this.uint16[sn+9]=P,this.uint32[tn+5]=R,this.uint32[tn+6]=$,this.uint32[tn+7]=X,this.uint16[sn+16]=re,this.uint16[sn+17]=he,this.uint16[sn+18]=ye,this.float32[tn+10]=Se,this.float32[tn+11]=Ke,this.uint8[Sn+48]=at,this.uint8[Sn+49]=xt,this.uint8[Sn+50]=ct,this.uint32[tn+13]=_t,this.int16[sn+28]=Ct,this.uint8[Sn+58]=It,r}}Ii.prototype.bytesPerElement=60,ur(Ii,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ci extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x,w,A,P,R,$,X,re,he,ye,Se,Ke,at,xt,ct,_t,Ct,It,sn,tn,Sn,$n,fn,kn,Rn,Vn){const Xn=this.length;return this.resize(Xn+1),this.emplace(Xn,r,l,h,p,x,w,A,P,R,$,X,re,he,ye,Se,Ke,at,xt,ct,_t,Ct,It,sn,tn,Sn,$n,fn,kn,Rn,Vn)}emplace(r,l,h,p,x,w,A,P,R,$,X,re,he,ye,Se,Ke,at,xt,ct,_t,Ct,It,sn,tn,Sn,$n,fn,kn,Rn,Vn,Xn){const wn=38*r,pr=19*r;return this.int16[wn+0]=l,this.int16[wn+1]=h,this.int16[wn+2]=p,this.float32[pr+2]=x,this.float32[pr+3]=w,this.int16[wn+8]=A,this.int16[wn+9]=P,this.int16[wn+10]=R,this.int16[wn+11]=$,this.int16[wn+12]=X,this.int16[wn+13]=re,this.uint16[wn+14]=he,this.uint16[wn+15]=ye,this.uint16[wn+16]=Se,this.uint16[wn+17]=Ke,this.uint16[wn+18]=at,this.uint16[wn+19]=xt,this.uint16[wn+20]=ct,this.uint16[wn+21]=_t,this.uint16[wn+22]=Ct,this.uint16[wn+23]=It,this.uint16[wn+24]=sn,this.uint16[wn+25]=tn,this.uint16[wn+26]=Sn,this.uint16[wn+27]=$n,this.uint16[wn+28]=fn,this.uint32[pr+15]=kn,this.float32[pr+16]=Rn,this.float32[pr+17]=Vn,this.float32[pr+18]=Xn,r}}Ci.prototype.bytesPerElement=76,ur(Ci,"StructArrayLayout3i2f6i15ui1ul3f76");class Ni extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.float32[1*r+0]=l,r}}Ni.prototype.bytesPerElement=4,ur(Ni,"StructArrayLayout1f4");class fo extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,p,x){const w=this.length;return this.resize(w+1),this.emplace(w,r,l,h,p,x)}emplace(r,l,h,p,x,w){const A=5*r;return this.float32[A+0]=l,this.float32[A+1]=h,this.float32[A+2]=p,this.float32[A+3]=x,this.float32[A+4]=w,r}}fo.prototype.bytesPerElement=20,ur(fo,"StructArrayLayout5f20");class Rs extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,h,p){const x=this.length;return this.resize(x+1),this.emplace(x,r,l,h,p)}emplace(r,l,h,p,x){const w=6*r;return this.uint32[3*r+0]=l,this.uint16[w+2]=h,this.uint16[w+3]=p,this.uint16[w+4]=x,r}}Rs.prototype.bytesPerElement=12,ur(Rs,"StructArrayLayout1ul3ui12");class hs extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l){const h=this.length;return this.resize(h+1),this.emplace(h,r,l)}emplace(r,l,h){const p=2*r;return this.uint16[p+0]=l,this.uint16[p+1]=h,r}}hs.prototype.bytesPerElement=4,ur(hs,"StructArrayLayout2ui4");class hc extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.uint16[1*r+0]=l,r}}hc.prototype.bytesPerElement=2,ur(hc,"StructArrayLayout1ui2");class Tc extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l){const h=this.length;return this.resize(h+1),this.emplace(h,r,l)}emplace(r,l,h){const p=2*r;return this.float32[p+0]=l,this.float32[p+1]=h,r}}Tc.prototype.bytesPerElement=8,ur(Tc,"StructArrayLayout2f8");class Li extends vt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Li.prototype.size=40;class no extends Dr{get(r){return new Li(this,r)}}ur(no,"CollisionBoxArray");class po extends vt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}po.prototype.size=60;class Ms extends Ii{get(r){return new po(this,r)}}ur(Ms,"PlacedSymbolArray");class nl extends vt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(r){this._structArray.uint32[this._pos4+15]=r}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}nl.prototype.size=76;class $o extends Ci{get(r){return new nl(this,r)}}ur($o,"SymbolInstanceArray");class Ns extends Ni{getoffsetX(r){return this.float32[1*r+0]}}ur(Ns,"GlyphOffsetArray");class ps extends vn{getx(r){return this.int16[2*r+0]}gety(r){return this.int16[2*r+1]}}ur(ps,"SymbolLineVertexArray");class ns extends vt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ns.prototype.size=12;class xs extends Rs{get(r){return new ns(this,r)}}ur(xs,"FeatureIndexArray");class dc extends hs{geta_centroid_pos0(r){return this.uint16[2*r+0]}geta_centroid_pos1(r){return this.uint16[2*r+1]}}ur(dc,"FillExtrusionCentroidArray");const Ds=Tt([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Ic=Tt([{name:"a_dash",components:4,type:"Uint16"}]);var yd={exports:{}},Ys={exports:{}};Ys.exports=function(s,r){var l,h,p,x,w,A,P,R;for(h=s.length-(l=3&s.length),p=r,w=3432918353,A=461845907,R=0;R<h;)P=255&s.charCodeAt(R)|(255&s.charCodeAt(++R))<<8|(255&s.charCodeAt(++R))<<16|(255&s.charCodeAt(++R))<<24,++R,p=27492+(65535&(x=5*(65535&(p=(p^=P=(65535&(P=(P=(65535&P)*w+(((P>>>16)*w&65535)<<16)&4294967295)<<15|P>>>17))*A+(((P>>>16)*A&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(P=0,l){case 3:P^=(255&s.charCodeAt(R+2))<<16;case 2:P^=(255&s.charCodeAt(R+1))<<8;case 1:p^=P=(65535&(P=(P=(65535&(P^=255&s.charCodeAt(R)))*w+(((P>>>16)*w&65535)<<16)&4294967295)<<15|P>>>17))*A+(((P>>>16)*A&65535)<<16)&4294967295}return p^=s.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0};var Fh=Ys.exports,_d={exports:{}};_d.exports=function(s,r){for(var l,h=s.length,p=r^h,x=0;h>=4;)l=1540483477*(65535&(l=255&s.charCodeAt(x)|(255&s.charCodeAt(++x))<<8|(255&s.charCodeAt(++x))<<16|(255&s.charCodeAt(++x))<<24))+((1540483477*(l>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),h-=4,++x;switch(h){case 3:p^=(255&s.charCodeAt(x+2))<<16;case 2:p^=(255&s.charCodeAt(x+1))<<8;case 1:p=1540483477*(65535&(p^=255&s.charCodeAt(x)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0};var Fu=Fh,Ou=_d.exports;yd.exports=Fu,yd.exports.murmur3=Fu,yd.exports.murmur2=Ou;var Cc=ue(yd.exports);class th{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,l,h,p){this.ids.push(vd(r)),this.positions.push(l,h,p)}getPositions(r){const l=vd(r);let h=0,p=this.ids.length-1;for(;h<p;){const w=h+p>>1;this.ids[w]>=l?p=w:h=w+1}const x=[];for(;this.ids[h]===l;)x.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return x}static serialize(r,l){const h=new Float64Array(r.ids),p=new Uint32Array(r.positions);return nh(h,p,0,h.length-1),l&&l.push(h.buffer,p.buffer),{ids:h,positions:p}}static deserialize(r){const l=new th;return l.ids=r.ids,l.positions=r.positions,l.indexed=!0,l}}function vd(s){const r=+s;return!isNaN(r)&&Number.MIN_SAFE_INTEGER<=r&&r<=Number.MAX_SAFE_INTEGER?r:Cc(String(s))}function nh(s,r,l,h){for(;l<h;){const p=s[l+h>>1];let x=l-1,w=h+1;for(;;){do x++;while(s[x]<p);do w--;while(s[w]>p);if(x>=w)break;Eh(s,x,w),Eh(r,3*x,3*w),Eh(r,3*x+1,3*w+1),Eh(r,3*x+2,3*w+2)}w-l<h-w?(nh(s,r,l,w),l=w+1):(nh(s,r,w+1,h),h=w)}}function Eh(s,r,l){const h=s[r];s[r]=s[l],s[l]=h}ur(th,"FeaturePositionMap");class Hl{constructor(r){this.gl=r.gl,this.initialized=!1}fetchUniformLocation(r,l){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(r,l),this.initialized=!0),!!this.location}}class Qh extends Hl{constructor(r){super(r),this.current=0}set(r,l,h){this.fetchUniformLocation(r,l)&&this.current!==h&&(this.current=h,this.gl.uniform1f(this.location,h))}}class xd extends Hl{constructor(r){super(r),this.current=[0,0,0,0]}set(r,l,h){this.fetchUniformLocation(r,l)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]&&h[3]===this.current[3]||(this.current=h,this.gl.uniform4f(this.location,h[0],h[1],h[2],h[3])))}}class ed extends Hl{constructor(r){super(r),this.current=Io.transparent}set(r,l,h){this.fetchUniformLocation(r,l)&&(h.r===this.current.r&&h.g===this.current.g&&h.b===this.current.b&&h.a===this.current.a||(this.current=h,this.gl.uniform4f(this.location,h.r,h.g,h.b,h.a)))}}const bd=new Float32Array(16),Oh=new Float32Array(9),Od=new Float32Array(4);function Ll(s){return[bt(255*s.r,255*s.g),bt(255*s.b,255*s.a)]}class Pl{constructor(r,l,h){this.value=r,this.uniformNames=l.map((p=>`u_${p}`)),this.type=h}setUniform(r,l,h,p,x){l.set(r,x,p.constantOr(this.value))}getBinding(r,l){return this.type==="color"?new ed(r):new Qh(r)}}class fc{constructor(r,l){this.uniformNames=l.map((h=>`u_${h}`)),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(r){this.pixelRatio=r.pixelRatio||1,this.pattern=r.tl.concat(r.br)}setUniform(r,l,h,p,x){const w=x==="u_pattern"||x==="u_dash"?this.pattern:x==="u_pixel_ratio"?this.pixelRatio:null;w&&l.set(r,x,w)}getBinding(r,l){return l==="u_pattern"||l==="u_dash"?new xd(r):new Qh(r)}}class Lc{constructor(r,l,h,p){this.expression=r,this.type=h,this.maxValue=0,this.paintVertexAttributes=l.map((x=>({name:`a_${x}`,type:"Float32",components:h==="color"?2:1,offset:0}))),this.paintVertexArray=new p}populatePaintArray(r,l,h,p,x,w){const A=this.paintVertexArray.length,P=this.expression.evaluate(new G(0),l,{},x,p,w);this.paintVertexArray.resize(r),this._setPaintValue(A,r,P)}updatePaintArray(r,l,h,p,x){const w=this.expression.evaluate({zoom:0},h,p,void 0,x);this._setPaintValue(r,l,w)}_setPaintValue(r,l,h){if(this.type==="color"){const p=Ll(h);for(let x=r;x<l;x++)this.paintVertexArray.emplace(x,p[0],p[1])}else{for(let p=r;p<l;p++)this.paintVertexArray.emplace(p,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Vc{constructor(r,l,h,p,x,w){this.expression=r,this.uniformNames=l.map((A=>`u_${A}_t`)),this.type=h,this.useIntegerZoom=p,this.zoom=x,this.maxValue=0,this.paintVertexAttributes=l.map((A=>({name:`a_${A}`,type:"Float32",components:h==="color"?4:2,offset:0}))),this.paintVertexArray=new w}populatePaintArray(r,l,h,p,x,w){const A=this.expression.evaluate(new G(this.zoom),l,{},x,p,w),P=this.expression.evaluate(new G(this.zoom+1),l,{},x,p,w),R=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(R,r,A,P)}updatePaintArray(r,l,h,p,x){const w=this.expression.evaluate({zoom:this.zoom},h,p,void 0,x),A=this.expression.evaluate({zoom:this.zoom+1},h,p,void 0,x);this._setPaintValue(r,l,w,A)}_setPaintValue(r,l,h,p){if(this.type==="color"){const x=Ll(h),w=Ll(p);for(let A=r;A<l;A++)this.paintVertexArray.emplace(A,x[0],x[1],w[0],w[1])}else{for(let x=r;x<l;x++)this.paintVertexArray.emplace(x,h,p);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(p))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,l,h,p,x){const w=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,A=De(this.expression.interpolationFactor(w,this.zoom,this.zoom+1),0,1);l.set(r,x,A)}getBinding(r,l){return new Qh(r)}}class bu{constructor(r,l,h,p,x){this.expression=r,this.layerId=x,this.paintVertexAttributes=(h==="array"?Ic:Ds).members;for(let w=0;w<l.length;++w);this.paintVertexArray=new p}populatePaintArray(r,l,h){const p=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValues(p,r,l.patterns&&l.patterns[this.layerId],h)}updatePaintArray(r,l,h,p,x,w){this._setPaintValues(r,l,h.patterns&&h.patterns[this.layerId],w)}_setPaintValues(r,l,h,p){if(!p||!h)return;const x=p[h];if(!x)return;const{tl:w,br:A,pixelRatio:P}=x;for(let R=r;R<l;R++)this.paintVertexArray.emplace(R,w[0],w[1],A[0],A[1],P)}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class rh{constructor(r,l,h=(()=>!0)){this.binders={},this._buffers=[];const p=[];for(const x in r.paint._values){if(!h(x))continue;const w=r.paint.get(x);if(!(w instanceof Ue&&As(w.property.specification)))continue;const A=_m(x,r.type),P=w.value,R=w.property.specification.type,$=!!w.property.useIntegerZoom,X=x==="line-dasharray"||x.endsWith("pattern"),re=x==="line-dasharray"&&r.layout.get("line-cap").value.kind!=="constant";if(P.kind!=="constant"||re)if(P.kind==="source"||re||X){const he=xm(x,R,"source");this.binders[x]=X?new bu(P,A,R,he,r.id):new Lc(P,A,R,he),p.push(`/a_${x}`)}else{const he=xm(x,R,"composite");this.binders[x]=new Vc(P,A,R,$,l,he),p.push(`/z_${x}`)}else this.binders[x]=X?new fc(P.value,A):new Pl(P.value,A,R),p.push(`/u_${x}`)}this.cacheKey=p.sort().join("")}getMaxValue(r){const l=this.binders[r];return l instanceof Lc||l instanceof Vc?l.maxValue:0}populatePaintArrays(r,l,h,p,x,w){for(const A in this.binders){const P=this.binders[A];(P instanceof Lc||P instanceof Vc||P instanceof bu)&&P.populatePaintArray(r,l,h,p,x,w)}}setConstantPatternPositions(r){for(const l in this.binders){const h=this.binders[l];h instanceof fc&&h.setConstantPatternPositions(r)}}updatePaintArrays(r,l,h,p,x,w){let A=!1;for(const P in r){const R=l.getPositions(P);for(const $ of R){const X=h.feature($.index);for(const re in this.binders){const he=this.binders[re];if((he instanceof Lc||he instanceof Vc||he instanceof bu)&&he.expression.isStateDependent===!0){const ye=p.paint.get(re);he.expression=ye.value,he.updatePaintArray($.start,$.end,X,r[P],x,w),A=!0}}}}return A}defines(){const r=[];for(const l in this.binders){const h=this.binders[l];(h instanceof Pl||h instanceof fc)&&r.push(...h.uniformNames.map((p=>`#define HAS_UNIFORM_${p}`)))}return r}getBinderAttributes(){const r=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof Lc||h instanceof Vc||h instanceof bu)for(let p=0;p<h.paintVertexAttributes.length;p++)r.push(h.paintVertexAttributes[p].name)}return r}getBinderUniforms(){const r=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof Pl||h instanceof fc||h instanceof Vc)for(const p of h.uniformNames)r.push(p)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r){const l=[];for(const h in this.binders){const p=this.binders[h];if(p instanceof Pl||p instanceof fc||p instanceof Vc)for(const x of p.uniformNames)l.push({name:x,property:h,binding:p.getBinding(r,x)})}return l}setUniforms(r,l,h,p,x){for(const{name:w,property:A,binding:P}of h)this.binders[A].setUniform(r,P,x,p.get(A),w)}updatePaintBuffers(){this._buffers=[];for(const r in this.binders){const l=this.binders[r];(l instanceof Lc||l instanceof Vc||l instanceof bu)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(r){for(const l in this.binders){const h=this.binders[l];(h instanceof Lc||h instanceof Vc||h instanceof bu)&&h.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const l=this.binders[r];(l instanceof Lc||l instanceof Vc||l instanceof bu)&&l.destroy()}}}class ih{constructor(r,l,h=(()=>!0)){this.programConfigurations={};for(const p of r)this.programConfigurations[p.id]=new rh(p,l,h);this.needsUpload=!1,this._featureMap=new th,this._bufferOffset=0}populatePaintArrays(r,l,h,p,x,w,A){for(const P in this.programConfigurations)this.programConfigurations[P].populatePaintArrays(r,l,p,x,w,A);l.id!==void 0&&this._featureMap.add(l.id,h,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,l,h,p,x){for(const w of h)this.needsUpload=this.programConfigurations[w.id].updatePaintArrays(r,this._featureMap,l,w,p,x)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const ff={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function _m(s,r){return ff[s]||[s.replace(`${r}-`,"").replace(/-/g,"_")]}const vm={"line-pattern":{source:Ut,composite:Ut},"fill-pattern":{source:Ut,composite:Ut},"fill-extrusion-pattern":{source:Ut,composite:Ut},"line-dasharray":{source:rn,composite:rn}},wg={color:{source:Tc,composite:Cn},number:{source:Ni,composite:Tc}};function xm(s,r,l){const h=vm[s];return h&&h[l]||wg[r][l]}ur(Pl,"ConstantBinder"),ur(fc,"PatternConstantBinder"),ur(Lc,"SourceExpressionBinder"),ur(bu,"PatternCompositeBinder"),ur(Vc,"CompositeExpressionBinder"),ur(rh,"ProgramConfiguration",{omit:["_buffers"]}),ur(ih,"ProgramConfigurationSet");const bm="-transition";class au extends ra{constructor(r,l){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,r.type!=="custom"&&(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&r.type!=="sky"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),l.layout&&(this._unevaluatedLayout=new Xe(l.layout)),l.paint)){this._transitionablePaint=new ge(l.paint);for(const h in r.paint)this.setPaintProperty(h,r.paint[h],{validate:!1});for(const h in r.layout)this.setLayoutProperty(h,r.layout[h],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ze(l.paint)}}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,l,h={}){l!=null&&this._validate(Ju,`layers.${this.id}.layout.${r}`,r,l,h)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,l):this.visibility=l)}getPaintProperty(r){return hn(r,bm)?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)}setPaintProperty(r,l,h={}){if(l!=null&&this._validate($l,`layers.${this.id}.paint.${r}`,r,l,h))return!1;if(hn(r,bm))return this._transitionablePaint.setTransition(r.slice(0,-11),l||void 0),!1;{const p=this._transitionablePaint._values[r],x=p.value.isDataDriven(),w=p.value;this._transitionablePaint.setValue(r,l),this._handleSpecialPaintPropertyUpdate(r);const A=this._transitionablePaint._values[r].value,P=A.isDataDriven(),R=hn(r,"pattern")||r==="line-dasharray";return P||x||R||this._handleOverridablePaintPropertyUpdate(r,w,A)}}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getProgramConfiguration(r){return null}_handleOverridablePaintPropertyUpdate(r,l,h){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,l){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,l)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),Mn(r,((l,h)=>!(l===void 0||h==="layout"&&!Object.keys(l).length||h==="paint"&&!Object.keys(l).length)))}_validate(r,l,h,p,x={}){return(!x||x.validate!==!1)&&La(this,r.call(tl,{key:l,layerType:this.type,objectKey:h,value:p,styleSpec:mn,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const l=this.paint.get(r);if(l instanceof Ue&&As(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Qr(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const wm=Tt([{name:"a_pos",components:2,type:"Int16"}],4),Sg=Tt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Pa{constructor(r=[]){this.segments=r}prepareSegment(r,l,h,p){let x=this.segments[this.segments.length-1];return r>Pa.MAX_VERTEX_ARRAY_LENGTH&&dr(`Max vertices per segment is ${Pa.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!x||x.vertexLength+r>Pa.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==p)&&(x={vertexOffset:l.length,primitiveOffset:h.length,vertexLength:0,primitiveLength:0},p!==void 0&&(x.sortKey=p),this.segments.push(x)),x}get(){return this.segments}destroy(){for(const r of this.segments)for(const l in r.vaos)r.vaos[l].destroy()}static simpleSegment(r,l,h,p){return new Pa([{vertexOffset:r,primitiveOffset:l,vertexLength:h,primitiveLength:p,vaos:{},sortKey:0}])}}Pa.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ur(Pa,"SegmentVector");var Zr=8192;class td{constructor(r,l){r&&(l?this.setSouthWest(r).setNorthEast(l):r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof Jr?new Jr(r.lng,r.lat):Jr.convert(r),this}setSouthWest(r){return this._sw=r instanceof Jr?new Jr(r.lng,r.lat):Jr.convert(r),this}extend(r){const l=this._sw,h=this._ne;let p,x;if(r instanceof Jr)p=r,x=r;else{if(!(r instanceof td))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(td.convert(r)):this.extend(Jr.convert(r)):typeof r=="object"&&r!==null&&r.hasOwnProperty("lat")&&(r.hasOwnProperty("lon")||r.hasOwnProperty("lng"))?this.extend(Jr.convert(r)):this;if(p=r._sw,x=r._ne,!p||!x)return this}return l||h?(l.lng=Math.min(p.lng,l.lng),l.lat=Math.min(p.lat,l.lat),h.lng=Math.max(x.lng,h.lng),h.lat=Math.max(x.lat,h.lat)):(this._sw=new Jr(p.lng,p.lat),this._ne=new Jr(x.lng,x.lat)),this}getCenter(){return new Jr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Jr(this.getWest(),this.getNorth())}getSouthEast(){return new Jr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:l,lat:h}=Jr.convert(r);let p=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&p}static convert(r){return!r||r instanceof td?r:new td(r)}}var pf=1e-6,Pc=typeof Float32Array<"u"?Float32Array:Array;function Sm(){var s=new Pc(9);return Pc!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s}function Bd(s,r,l){var h=r[0],p=r[1],x=r[2],w=r[3],A=r[4],P=r[5],R=r[6],$=r[7],X=r[8],re=l[0],he=l[1],ye=l[2],Se=l[3],Ke=l[4],at=l[5],xt=l[6],ct=l[7],_t=l[8];return s[0]=re*h+he*w+ye*R,s[1]=re*p+he*A+ye*$,s[2]=re*x+he*P+ye*X,s[3]=Se*h+Ke*w+at*R,s[4]=Se*p+Ke*A+at*$,s[5]=Se*x+Ke*P+at*X,s[6]=xt*h+ct*w+_t*R,s[7]=xt*p+ct*A+_t*$,s[8]=xt*x+ct*P+_t*X,s}function Bu(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function kl(s,r){var l=r[0],h=r[1],p=r[2],x=r[3],w=r[4],A=r[5],P=r[6],R=r[7],$=r[8],X=r[9],re=r[10],he=r[11],ye=r[12],Se=r[13],Ke=r[14],at=r[15],xt=l*A-h*w,ct=l*P-p*w,_t=l*R-x*w,Ct=h*P-p*A,It=h*R-x*A,sn=p*R-x*P,tn=$*Se-X*ye,Sn=$*Ke-re*ye,$n=$*at-he*ye,fn=X*Ke-re*Se,kn=X*at-he*Se,Rn=re*at-he*Ke,Vn=xt*Rn-ct*kn+_t*fn+Ct*$n-It*Sn+sn*tn;return Vn?(s[0]=(A*Rn-P*kn+R*fn)*(Vn=1/Vn),s[1]=(p*kn-h*Rn-x*fn)*Vn,s[2]=(Se*sn-Ke*It+at*Ct)*Vn,s[3]=(re*It-X*sn-he*Ct)*Vn,s[4]=(P*$n-w*Rn-R*Sn)*Vn,s[5]=(l*Rn-p*$n+x*Sn)*Vn,s[6]=(Ke*_t-ye*sn-at*ct)*Vn,s[7]=($*sn-re*_t+he*ct)*Vn,s[8]=(w*kn-A*$n+R*tn)*Vn,s[9]=(h*$n-l*kn-x*tn)*Vn,s[10]=(ye*It-Se*_t+at*xt)*Vn,s[11]=(X*_t-$*It-he*xt)*Vn,s[12]=(A*Sn-w*fn-P*tn)*Vn,s[13]=(l*fn-h*Sn+p*tn)*Vn,s[14]=(Se*ct-ye*Ct-Ke*xt)*Vn,s[15]=($*Ct-X*ct+re*xt)*Vn,s):null}function lu(s,r,l){var h=r[0],p=r[1],x=r[2],w=r[3],A=r[4],P=r[5],R=r[6],$=r[7],X=r[8],re=r[9],he=r[10],ye=r[11],Se=r[12],Ke=r[13],at=r[14],xt=r[15],ct=l[0],_t=l[1],Ct=l[2],It=l[3];return s[0]=ct*h+_t*A+Ct*X+It*Se,s[1]=ct*p+_t*P+Ct*re+It*Ke,s[2]=ct*x+_t*R+Ct*he+It*at,s[3]=ct*w+_t*$+Ct*ye+It*xt,s[4]=(ct=l[4])*h+(_t=l[5])*A+(Ct=l[6])*X+(It=l[7])*Se,s[5]=ct*p+_t*P+Ct*re+It*Ke,s[6]=ct*x+_t*R+Ct*he+It*at,s[7]=ct*w+_t*$+Ct*ye+It*xt,s[8]=(ct=l[8])*h+(_t=l[9])*A+(Ct=l[10])*X+(It=l[11])*Se,s[9]=ct*p+_t*P+Ct*re+It*Ke,s[10]=ct*x+_t*R+Ct*he+It*at,s[11]=ct*w+_t*$+Ct*ye+It*xt,s[12]=(ct=l[12])*h+(_t=l[13])*A+(Ct=l[14])*X+(It=l[15])*Se,s[13]=ct*p+_t*P+Ct*re+It*Ke,s[14]=ct*x+_t*R+Ct*he+It*at,s[15]=ct*w+_t*$+Ct*ye+It*xt,s}function nd(s,r,l){var h,p,x,w,A,P,R,$,X,re,he,ye,Se=l[0],Ke=l[1],at=l[2];return r===s?(s[12]=r[0]*Se+r[4]*Ke+r[8]*at+r[12],s[13]=r[1]*Se+r[5]*Ke+r[9]*at+r[13],s[14]=r[2]*Se+r[6]*Ke+r[10]*at+r[14],s[15]=r[3]*Se+r[7]*Ke+r[11]*at+r[15]):(p=r[1],x=r[2],w=r[3],A=r[4],P=r[5],R=r[6],$=r[7],X=r[8],re=r[9],he=r[10],ye=r[11],s[0]=h=r[0],s[1]=p,s[2]=x,s[3]=w,s[4]=A,s[5]=P,s[6]=R,s[7]=$,s[8]=X,s[9]=re,s[10]=he,s[11]=ye,s[12]=h*Se+A*Ke+X*at+r[12],s[13]=p*Se+P*Ke+re*at+r[13],s[14]=x*Se+R*Ke+he*at+r[14],s[15]=w*Se+$*Ke+ye*at+r[15]),s}function wd(s,r,l){var h=l[0],p=l[1],x=l[2];return s[0]=r[0]*h,s[1]=r[1]*h,s[2]=r[2]*h,s[3]=r[3]*h,s[4]=r[4]*p,s[5]=r[5]*p,s[6]=r[6]*p,s[7]=r[7]*p,s[8]=r[8]*x,s[9]=r[9]*x,s[10]=r[10]*x,s[11]=r[11]*x,s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15],s}function kp(s,r,l){var h=Math.sin(l),p=Math.cos(l),x=r[4],w=r[5],A=r[6],P=r[7],R=r[8],$=r[9],X=r[10],re=r[11];return r!==s&&(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[4]=x*p+R*h,s[5]=w*p+$*h,s[6]=A*p+X*h,s[7]=P*p+re*h,s[8]=R*p-x*h,s[9]=$*p-w*h,s[10]=X*p-A*h,s[11]=re*p-P*h,s}function mf(s,r,l){var h=Math.sin(l),p=Math.cos(l),x=r[0],w=r[1],A=r[2],P=r[3],R=r[8],$=r[9],X=r[10],re=r[11];return r!==s&&(s[4]=r[4],s[5]=r[5],s[6]=r[6],s[7]=r[7],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[0]=x*p-R*h,s[1]=w*p-$*h,s[2]=A*p-X*h,s[3]=P*p-re*h,s[8]=x*h+R*p,s[9]=w*h+$*p,s[10]=A*h+X*p,s[11]=P*h+re*p,s}function Rp(s,r){return s[0]=r[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=r[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=r[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function zd(s,r,l){var h,p,x,w=l[0],A=l[1],P=l[2],R=Math.hypot(w,A,P);return R<pf?null:(w*=R=1/R,A*=R,P*=R,h=Math.sin(r),p=Math.cos(r),s[0]=w*w*(x=1-p)+p,s[1]=A*w*x+P*h,s[2]=P*w*x-A*h,s[3]=0,s[4]=w*A*x-P*h,s[5]=A*A*x+p,s[6]=P*A*x+w*h,s[7]=0,s[8]=w*P*x+A*h,s[9]=A*P*x-w*h,s[10]=P*P*x+p,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s)}Math.hypot||(Math.hypot=function(){for(var s=0,r=arguments.length;r--;)s+=arguments[r]*arguments[r];return Math.sqrt(s)});var Em=lu;function rd(){var s=new Pc(3);return Pc!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function Am(s){var r=new Pc(3);return r[0]=s[0],r[1]=s[1],r[2]=s[2],r}function jd(s){return Math.hypot(s[0],s[1],s[2])}function Ud(s,r,l){var h=new Pc(3);return h[0]=s,h[1]=r,h[2]=l,h}function Bh(s,r,l){return s[0]=r[0]+l[0],s[1]=r[1]+l[1],s[2]=r[2]+l[2],s}function O(s,r,l){return s[0]=r[0]-l[0],s[1]=r[1]-l[1],s[2]=r[2]-l[2],s}function fe(s,r,l){return s[0]=r[0]*l[0],s[1]=r[1]*l[1],s[2]=r[2]*l[2],s}function Ie(s,r,l){return s[0]=Math.min(r[0],l[0]),s[1]=Math.min(r[1],l[1]),s[2]=Math.min(r[2],l[2]),s}function Fe(s,r,l){return s[0]=Math.max(r[0],l[0]),s[1]=Math.max(r[1],l[1]),s[2]=Math.max(r[2],l[2]),s}function Ye(s,r,l){return s[0]=r[0]*l,s[1]=r[1]*l,s[2]=r[2]*l,s}function qe(s,r,l,h){return s[0]=r[0]+l[0]*h,s[1]=r[1]+l[1]*h,s[2]=r[2]+l[2]*h,s}function Ge(s,r){var l=r[0],h=r[1],p=r[2],x=l*l+h*h+p*p;return x>0&&(x=1/Math.sqrt(x)),s[0]=r[0]*x,s[1]=r[1]*x,s[2]=r[2]*x,s}function St(s,r){return s[0]*r[0]+s[1]*r[1]+s[2]*r[2]}function Dt(s,r,l){var h=r[0],p=r[1],x=r[2],w=l[0],A=l[1],P=l[2];return s[0]=p*P-x*A,s[1]=x*w-h*P,s[2]=h*A-p*w,s}function ft(s,r,l){var h=r[0],p=r[1],x=r[2],w=l[3]*h+l[7]*p+l[11]*x+l[15];return s[0]=(l[0]*h+l[4]*p+l[8]*x+l[12])/(w=w||1),s[1]=(l[1]*h+l[5]*p+l[9]*x+l[13])/w,s[2]=(l[2]*h+l[6]*p+l[10]*x+l[14])/w,s}function Xt(s,r,l){var h=l[0],p=l[1],x=l[2],w=r[0],A=r[1],P=r[2],R=p*P-x*A,$=x*w-h*P,X=h*A-p*w,re=p*X-x*$,he=x*R-h*X,ye=h*$-p*R,Se=2*l[3];return $*=Se,X*=Se,he*=2,ye*=2,s[0]=w+(R*=Se)+(re*=2),s[1]=A+$+he,s[2]=P+X+ye,s}var en,bn=O,un=fe,zt=jd;function on(s,r,l){return s[0]=r[0]*l,s[1]=r[1]*l,s[2]=r[2]*l,s[3]=r[3]*l,s}function fr(s,r){var l=r[0],h=r[1],p=r[2],x=r[3],w=l*l+h*h+p*p+x*x;return w>0&&(w=1/Math.sqrt(w)),s[0]=l*w,s[1]=h*w,s[2]=p*w,s[3]=x*w,s}function _r(s,r,l){var h=r[0],p=r[1],x=r[2],w=r[3];return s[0]=l[0]*h+l[4]*p+l[8]*x+l[12]*w,s[1]=l[1]*h+l[5]*p+l[9]*x+l[13]*w,s[2]=l[2]*h+l[6]*p+l[10]*x+l[14]*w,s[3]=l[3]*h+l[7]*p+l[11]*x+l[15]*w,s}function jn(){var s=new Pc(4);return Pc!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s[3]=1,s}function cr(s){return s[0]=0,s[1]=0,s[2]=0,s[3]=1,s}function ri(s,r,l){l*=.5;var h=r[0],p=r[1],x=r[2],w=r[3],A=Math.sin(l),P=Math.cos(l);return s[0]=h*P+w*A,s[1]=p*P+x*A,s[2]=x*P-p*A,s[3]=w*P-h*A,s}function qr(s,r,l){l*=.5;var h=r[0],p=r[1],x=r[2],w=r[3],A=Math.sin(l),P=Math.cos(l);return s[0]=h*P-x*A,s[1]=p*P+w*A,s[2]=x*P+h*A,s[3]=w*P-p*A,s}rd(),en=new Pc(4),Pc!=Float32Array&&(en[0]=0,en[1]=0,en[2]=0,en[3]=0);var Vr=fr;rd(),Ud(1,0,0),Ud(0,1,0),jn(),jn(),Sm();const Pi=Tt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Ar}=Pi,Sr=Tt([{name:"a_pos_3",components:3,type:"Int16"}]);var Bi=Tt([{name:"a_pos",type:"Int16",components:2}]);class Ur{constructor(r,l){this.pos=r,this.dir=l}intersectsPlane(r,l,h){const p=St(l,this.dir);if(Math.abs(p)<1e-6)return!1;const x=((r[0]-this.pos[0])*l[0]+(r[1]-this.pos[1])*l[1]+(r[2]-this.pos[2])*l[2])/p;return h[0]=this.pos[0]+this.dir[0]*x,h[1]=this.pos[1]+this.dir[1]*x,h[2]=this.pos[2]+this.dir[2]*x,!0}closestPointOnSphere(r,l,h){if((function(he,ye){var Se=he[0],Ke=he[1],at=he[2],xt=ye[0],ct=ye[1],_t=ye[2];return Math.abs(Se-xt)<=pf*Math.max(1,Math.abs(Se),Math.abs(xt))&&Math.abs(Ke-ct)<=pf*Math.max(1,Math.abs(Ke),Math.abs(ct))&&Math.abs(at-_t)<=pf*Math.max(1,Math.abs(at),Math.abs(_t))})(this.pos,r)||l===0)return h[0]=h[1]=h[2]=0,!1;const[p,x,w]=this.dir,A=this.pos[0]-r[0],P=this.pos[1]-r[1],R=this.pos[2]-r[2],$=p*p+x*x+w*w,X=2*(A*p+P*x+R*w),re=X*X-4*$*(A*A+P*P+R*R-l*l);if(re<0){const he=Math.max(-X/2,0),ye=A+p*he,Se=P+x*he,Ke=R+w*he,at=Math.hypot(ye,Se,Ke);return h[0]=ye*l/at,h[1]=Se*l/at,h[2]=Ke*l/at,!1}{const he=(-X-Math.sqrt(re))/(2*$);if(he<0){const ye=Math.hypot(A,P,R);return h[0]=A*l/ye,h[1]=P*l/ye,h[2]=R*l/ye,!1}return h[0]=A+p*he,h[1]=P+x*he,h[2]=R+w*he,!0}}}class Fr{constructor(r,l,h,p,x){this.TL=r,this.TR=l,this.BR=h,this.BL=p,this.horizon=x}static fromInvProjectionMatrix(r,l,h){const p=[-1,1,1],x=[1,1,1],w=[1,-1,1],A=[-1,-1,1],P=ft(p,p,r),R=ft(x,x,r),$=ft(w,w,r),X=ft(A,A,r);return new Fr(P,R,$,X,l/h)}}class xi{constructor(r,l){this.points=r,this.planes=l}static fromInvProjectionMatrix(r,l,h,p){const x=Math.pow(2,h),w=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((P=>{const R=_r([],P,r),$=1/R[3]/l*x;return(function(X,re,he){return X[0]=re[0]*he[0],X[1]=re[1]*he[1],X[2]=re[2]*he[2],X[3]=re[3]*he[3],X})(R,R,[$,$,p?1/R[3]:$,$])})),A=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((P=>{const R=Ge([],Dt([],bn([],w[P[0]],w[P[1]]),bn([],w[P[2]],w[P[1]]))),$=-St(R,w[P[1]]);return R.concat($)}));return new xi(w,A)}}class Dn{static fromPoints(r){const l=[1/0,1/0,1/0],h=[-1/0,-1/0,-1/0];for(const p of r)Ie(l,l,p),Fe(h,h,p);return new Dn(l,h)}static applyTransform(r,l){const h=r.getCorners();for(let p=0;p<h.length;++p)ft(h[p],h[p],l);return Dn.fromPoints(h)}constructor(r,l){this.min=r,this.max=l,this.center=Ye([],Bh([],this.min,this.max),.5)}quadrant(r){const l=[r%2==0,r<2],h=Am(this.min),p=Am(this.max);for(let x=0;x<l.length;x++)h[x]=l[x]?this.min[x]:this.center[x],p[x]=l[x]?this.center[x]:this.max[x];return p[2]=this.max[2],new Dn(h,p)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}getCorners(){const r=this.min,l=this.max;return[[r[0],r[1],r[2]],[l[0],r[1],r[2]],[l[0],l[1],r[2]],[r[0],l[1],r[2]],[r[0],r[1],l[2]],[l[0],r[1],l[2]],[l[0],l[1],l[2]],[r[0],l[1],l[2]]]}intersects(r){const l=this.getCorners();let h=!0;for(let p=0;p<r.planes.length;p++){const x=r.planes[p];let w=0;for(let A=0;A<l.length;A++)w+=St(x,l[A])+x[3]>=0;if(w===0)return 0;w!==l.length&&(h=!1)}if(h)return 2;for(let p=0;p<3;p++){let x=Number.MAX_VALUE,w=-Number.MAX_VALUE;for(let A=0;A<r.points.length;A++){const P=r.points[A][p]-this.min[p];x=Math.min(x,P),w=Math.max(w,P)}if(w<0||x>this.max[p]-this.min[p])return 0}return 1}}const nn=5,dn=6,Gn=Zr/Math.PI/2,br=16383,ei=64,li=[ei,32,16],Co=-Gn,Fn=Gn,Eo=[new Dn([Co,Co,Co],[Fn,Fn,Fn]),new Dn([Co,Co,Co],[0,0,Fn]),new Dn([0,Co,Co],[Fn,0,Fn]),new Dn([Co,0,Co],[0,Fn,Fn]),new Dn([0,0,Co],[Fn,Fn,Fn])];function ro(s){return s*Gn/qc}function Rl(s,r,l,h=!0){const p=Ye([],s._camera.position,s.worldSize),x=[r,l,1,1];_r(x,x,s.pixelMatrixInverse),on(x,x,1/x[3]);const w=Ge([],bn([],x,p)),A=s.globeMatrix,P=[A[12],A[13],A[14]],R=bn([],P,p),$=jd(R),X=Ge([],R),re=s.worldSize/(2*Math.PI),he=St(X,w),ye=Math.asin(re/$);if(ye<Math.acos(he)){if(!h)return null;const $n=[],fn=[];Ye($n,w,$/he),Ge(fn,bn(fn,$n,R)),Ge(w,Bh(w,R,Ye(w,fn,Math.tan(ye)*$)))}const Se=[];new Ur(p,w).closestPointOnSphere(P,re,Se);const Ke=Ge([],Pn(A,0)),at=Ge([],Pn(A,1)),xt=Ge([],Pn(A,2)),ct=St(Ke,Se),_t=St(at,Se),Ct=St(xt,Se),It=be(Math.asin(-_t/re));let sn=be(Math.atan2(ct,Ct));sn=s.center.lng+(function($n,fn){const kn=(fn-$n+180)%360-180;return kn<-180?kn+360:kn})(s.center.lng,sn);const tn=Is(sn),Sn=De(bs(It),0,1);return new Ad(tn,Sn)}class rl{constructor(r,l,h){this.a=bn([],r,h),this.b=bn([],l,h),this.center=h;const p=Ge([],this.a),x=Ge([],this.b);this.angle=Math.acos(St(p,x))}}function il(s,r){if(s.angle===0)return null;let l;return l=s.a[r]===0?1/s.angle*.5*Math.PI:1/s.angle*Math.atan(s.b[r]/s.a[r]/Math.sin(s.angle)-1/Math.tan(s.angle)),l<0||l>1?null:(function(h,p,x,w){const A=Math.sin(x);return h*(Math.sin((1-w)*x)/A)+p*(Math.sin(w*x)/A)})(s.a[r],s.b[r],s.angle,De(l,0,1))+s.center[r]}function Yi(s){if(s.z<=1)return Eo[s.z+2*s.y+s.x];const r=jh(ml(s));return Dn.fromPoints(r)}function Wn(s,r,l){return Ye(s,s,1-l),qe(s,s,r,l)}function cu(s,r){const l=ls(r.zoom);if(l===0)return Yi(s);const h=ml(s),p=jh(h),x=Is(h.getWest())*r.worldSize,w=Is(h.getEast())*r.worldSize,A=bs(h.getNorth())*r.worldSize,P=bs(h.getSouth())*r.worldSize,R=[x,A,0],$=[w,A,0],X=[x,P,0],re=[w,P,0],he=kl([],r.globeMatrix);return ft(R,R,he),ft($,$,he),ft(X,X,he),ft(re,re,he),p[0]=Wn(p[0],X,l),p[1]=Wn(p[1],re,l),p[2]=Wn(p[2],$,l),p[3]=Wn(p[3],R,l),Dn.fromPoints(p)}function zh(s,r,l){for(const h of s)ft(h,h,r),Ye(h,h,l)}function Vd(s,r,l){const h=r/s.worldSize,p=s.globeMatrix;if(l.z<=1){const tn=Yi(l).getCorners();return zh(tn,p,h),Dn.fromPoints(tn)}const x=ml(l),w=jh(x);zh(w,p,h);const A=Number.MAX_VALUE,P=[-A,-A,-A],R=[A,A,A];if(x.contains(s.center)){for(const $n of w)Ie(R,R,$n),Fe(P,P,$n);P[2]=0;const tn=s.point,Sn=[tn.x*h,tn.y*h,0];return Ie(R,R,Sn),Fe(P,P,Sn),new Dn(R,P)}const $=[p[12]*h,p[13]*h,p[14]*h],X=x.getCenter(),re=De(s.center.lat,-ka,ka),he=De(X.lat,-ka,ka),ye=Is(s.center.lng),Se=bs(re);let Ke=ye-Is(X.lng);const at=Se-bs(he);Ke>.5?Ke-=1:Ke<-.5&&(Ke+=1);let xt=0;Math.abs(Ke)>Math.abs(at)?xt=Ke>=0?1:3:(xt=at>=0?0:2,qe($,$,[p[4]*h,p[5]*h,p[6]*h],-Math.sin(Z(at>=0?x.getSouth():x.getNorth()))*Gn));const ct=w[xt],_t=w[(xt+1)%4],Ct=new rl(ct,_t,$),It=[il(Ct,0)||ct[0],il(Ct,1)||ct[1],il(Ct,2)||ct[2]],sn=ls(s.zoom);if(sn>0){const tn=(function({x:$n,y:fn,z:kn},Rn,Vn,Xn,wn){const pr=1/(1<<kn);let zr=$n*pr,yr=zr+pr,Ki=fn*pr,Zn=Ki+pr,ti=0;const Xi=(zr+yr)/2-Xn;return Xi>.5?ti=-1:Xi<-.5&&(ti=1),zr=((zr+ti)*Rn-(Xn*=Rn))*Vn+Xn,yr=((yr+ti)*Rn-Xn)*Vn+Xn,Ki=(Ki*Rn-(wn*=Rn))*Vn+wn,Zn=(Zn*Rn-wn)*Vn+wn,[[zr,Zn,0],[yr,Zn,0],[yr,Ki,0],[zr,Ki,0]]})(l,r,s._pixelsPerMercatorPixel,ye,Se);for(let $n=0;$n<w.length;$n++)Wn(w[$n],tn[$n],sn);const Sn=Bh([],tn[xt],tn[(xt+1)%4]);Ye(Sn,Sn,.5),Wn(It,Sn,sn)}for(const tn of w)Ie(R,R,tn),Fe(P,P,tn);return R[2]=Math.min(ct[2],_t[2]),Ie(R,R,It),Fe(P,P,It),new Dn(R,P)}function ml({x:s,y:r,z:l}){const h=1/(1<<l),p=new Jr(Kl(s*h),Go((r+1)*h)),x=new Jr(Kl((s+1)*h),Go(r*h));return new td(p,x)}function jh(s){const r=Z(s.getNorth()),l=Z(s.getSouth()),h=Math.cos(r),p=Math.cos(l),x=Math.sin(r),w=Math.sin(l),A=s.getWest(),P=s.getEast();return[as(p,w,A),as(p,w,P),as(h,x,P),as(h,x,A)]}function as(s,r,l,h=Gn){return l=Z(l),[s*Math.sin(l)*h,-r*h,s*Math.cos(l)*h]}function gl(s,r,l){return as(Math.cos(Z(s)),Math.sin(Z(s)),r,l)}function Wl(s,r,l,h){const p=1<<l.z,x=(s/Zr+l.x)/p;return gl(Go((r/Zr+l.y)/p),Kl(x),h)}function Sd({min:s,max:r}){return br/Math.max(r[0]-s[0],r[1]-s[1],r[2]-s[2])}const gf=new Float64Array(16);function pc(s){const r=Sd(s),l=Rp(gf,[r,r,r]);return nd(l,l,((h=[])[0]=-(p=s.min)[0],h[1]=-p[1],h[2]=-p[2],h));var h,p}function Ah(s){const r=(h=s.min,(l=gf)[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=h[0],l[13]=h[1],l[14]=h[2],l[15]=1,l);var l,h;const p=1/Sd(s);return wd(r,r,[p,p,p])}function Yr(s,r,l,h,p){const x=(function(P){const R=Zr/(2*Math.PI);return P/(2*Math.PI)/R})(l),w=[s,r,-l/(2*Math.PI)],A=Bu(new Float64Array(16));return nd(A,A,w),wd(A,A,[x,x,x]),kp(A,A,Z(-p)),mf(A,A,Z(-h)),A}function ls(s){return tt(nn,dn,s)}function va(s,r){const l=gl(r.lat,r.lng),h=(function(ye){const Se=gl(ye._center.lat,ye._center.lng);let Ke=Dt([],Ud(0,1,0),Se);const at=zd([],-ye.angle,Se);Ke=ft(Ke,Ke,at),zd(at,-ye._pitch,Ke);const xt=Ge([],Se);return Ye(xt,xt,ro(ye.cameraToCenterDistance/ye.pixelsPerMeter)),ft(xt,xt,at),Bh([],Se,xt)})(s);return w=(p=O([],h,l))[0],A=p[1],P=p[2],R=(x=l)[0],$=x[1],X=x[2],he=(re=Math.sqrt(w*w+A*A+P*P)*Math.sqrt(R*R+$*$+X*X))&&St(p,x)/re,Math.acos(Math.min(Math.max(he,-1),1));var p,x,w,A,P,R,$,X,re,he}function zu(s,r){return va(s,r)>Math.PI/2*1.01}const yl=Z(85),id=Math.cos(yl),yf=Math.sin(yl),qc=63710088e-1,Ed=2*Math.PI*qc;class ol{constructor(r,l){if(isNaN(r)||isNaN(l))throw new Error(`Invalid LngLat object: (${r}, ${l})`);if(this.lng=+r,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ol(xe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const l=Math.PI/180,h=this.lat*l,p=r.lat*l,x=Math.sin(h)*Math.sin(p)+Math.cos(h)*Math.cos(p)*Math.cos((r.lng-this.lng)*l);return qc*Math.acos(Math.min(x,1))}toBounds(r=0){const l=360*r/40075017,h=l/Math.cos(Math.PI/180*this.lat);return new td(new ol(this.lng-h,this.lat-l),new ol(this.lng+h,this.lat+l))}toEcef(r){const l=ro(r);return gl(this.lat,this.lng,Gn+l)}static convert(r){if(r instanceof ol)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new ol(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new ol(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Jr=ol;function Ml(s){return Ed*Math.cos(s*Math.PI/180)}function Is(s){return(180+s)/360}function bs(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function Va(s,r){return s/Ml(r)}function Kl(s){return 360*s-180}function Go(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function _f(s,r){return s*Ml(Go(r))}const ka=85.051129;function qd(s){return 1/Math.cos(s*Math.PI/180)}class Ad{constructor(r,l,h=0){this.x=+r,this.y=+l,this.z=+h}static fromLngLat(r,l=0){const h=Jr.convert(r);return new Ad(Is(h.lng),bs(h.lat),Va(l,h.lat))}toLngLat(){return new Jr(Kl(this.x),Go(this.y))}toAltitude(){return _f(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ed*qd(Go(this.y))}}function $d(s,r,l,h,p,x,w,A,P){const R=(r+h)/2,$=(l+p)/2,X=new q(R,$);A(X),(function(re,he,ye,Se,Ke,at){const xt=ye-Ke,ct=Se-at;return Math.abs((Se-he)*xt-(ye-re)*ct)/Math.hypot(xt,ct)})(X.x,X.y,x.x,x.y,w.x,w.y)>=P?($d(s,r,l,R,$,x,X,A,P),$d(s,R,$,h,p,X,w,A,P)):s.push(w)}function ju(s,r,l){let h=s[0],p=h.x,x=h.y;r(h);const w=[h];for(let A=1;A<s.length;A++){const P=s[A],{x:R,y:$}=P;r(P),$d(w,p,x,R,$,h,P,r,l),p=R,x=$,h=P}return w}function Tm(s,r,l,h){if(h(r,l)){const p=r.add(l)._mult(.5);Tm(s,r,p,h),Tm(s,p,l,h)}else s.push(l)}function Mp(s,r){let l=s[0];const h=[l];for(let p=1;p<s.length;p++){const x=s[p];Tm(h,l,x,r),l=x}return h}const od=Math.pow(2,14)-1,Im=-od-1;function G0(s,r){const l=Math.round(s.x*r),h=Math.round(s.y*r);return s.x=De(l,Im,od),s.y=De(h,Im,od),(l<s.x||l>s.x+1||h<s.y||h>s.y+1)&&dr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function wu(s,r,l){const h=s.loadGeometry(),p=s.extent,x=Zr/p;if(r&&l&&l.projection.isReprojectedInTileSpace){const w=1<<r.z,{scale:A,x:P,y:R,projection:$}=l,X=re=>{const he=Kl((r.x+re.x/p)/w),ye=Go((r.y+re.y/p)/w),Se=$.project(he,ye);re.x=(Se.x*A-P)*p,re.y=(Se.y*A-R)*p};for(let re=0;re<h.length;re++)if(s.type!==1)h[re]=ju(h[re],X,1);else{const he=[];for(const ye of h[re])ye.x<0||ye.x>=p||ye.y<0||ye.y>=p||(X(ye),he.push(ye));h[re]=he}}for(const w of h)for(const A of w)G0(A,x);return h}function Td(s,r){return{type:s.type,id:s.id,properties:s.properties,geometry:r?wu(s):[]}}function sd(s,r,l,h,p){s.emplaceBack(2*r+(h+1)/2,2*l+(p+1)/2)}function tp(s,r,l){s.emplaceBack(r.x,r.y,r.z,l[0]*16384,l[1]*16384,l[2]*16384)}class np{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((l=>l.id)),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new vn,this.indexArray=new xr,this.segments=new Pa,this.programConfigurations=new ih(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter((l=>l.isStateDependent())).map((l=>l.id))}populate(r,l,h,p){const x=this.layers[0],w=[];let A=null;x.type==="circle"&&(A=x.layout.get("circle-sort-key"));for(const{feature:R,id:$,index:X,sourceLayerIndex:re}of r){const he=this.layers[0]._featureFilter.needGeometry,ye=Td(R,he);if(!this.layers[0]._featureFilter.filter(new G(this.zoom),ye,h))continue;const Se=A?A.evaluate(ye,{},h):void 0,Ke={id:$,properties:R.properties,type:R.type,sourceLayerIndex:re,index:X,geometry:he?ye.geometry:wu(R,h,p),patterns:{},sortKey:Se};w.push(Ke)}A&&w.sort(((R,$)=>R.sortKey-$.sortKey));let P=null;p.projection.name==="globe"&&(this.globeExtVertexArray=new Tn,P=p.projection);for(const R of w){const{geometry:$,index:X,sourceLayerIndex:re}=R,he=r[X].feature;this.addFeature(R,$,X,l.availableImages,h,P),l.featureIndex.insert(he,$,X,re,this.index)}}update(r,l,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,wm.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,Sg.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(r,l,h,p,x,w){for(const A of l)for(const P of A){const R=P.x,$=P.y;if(R<0||R>=Zr||$<0||$>=Zr)continue;if(w){const he=w.projectTilePoint(R,$,x),ye=w.upVector(x,R,$),Se=this.globeExtVertexArray;tp(Se,he,ye),tp(Se,he,ye),tp(Se,he,ye),tp(Se,he,ye)}const X=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),re=X.vertexLength;sd(this.layoutVertexArray,R,$,-1,-1),sd(this.layoutVertexArray,R,$,1,-1),sd(this.layoutVertexArray,R,$,1,1),sd(this.layoutVertexArray,R,$,-1,1),this.indexArray.emplaceBack(re,re+1,re+2),this.indexArray.emplaceBack(re,re+2,re+3),X.vertexLength+=4,X.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,{},p,x)}}function Eg(s,r){for(let l=0;l<s.length;l++)if(Gd(r,s[l]))return!0;for(let l=0;l<r.length;l++)if(Gd(s,r[l]))return!0;return!!Id(s,r)}function Ag(s,r,l){return!!Gd(s,r)||!!Su(r,s,l)}function Cm(s,r){if(s.length===1)return Tg(r,s[0]);for(let l=0;l<r.length;l++){const h=r[l];for(let p=0;p<h.length;p++)if(Gd(s,h[p]))return!0}for(let l=0;l<s.length;l++)if(Tg(r,s[l]))return!0;for(let l=0;l<r.length;l++)if(Id(s,r[l]))return!0;return!1}function Uu(s,r,l){if(s.length>1){if(Id(s,r))return!0;for(let h=0;h<r.length;h++)if(Su(r[h],s,l))return!0}for(let h=0;h<s.length;h++)if(Su(s[h],r,l))return!0;return!1}function Id(s,r){if(s.length===0||r.length===0)return!1;for(let l=0;l<s.length-1;l++){const h=s[l],p=s[l+1];for(let x=0;x<r.length-1;x++)if(ad(h,p,r[x],r[x+1]))return!0}return!1}function ad(s,r,l,h){return wr(s,l,h)!==wr(r,l,h)&&wr(s,r,l)!==wr(s,r,h)}function Su(s,r,l){const h=l*l;if(r.length===1)return s.distSqr(r[0])<h;for(let p=1;p<r.length;p++)if(H0(s,r[p-1],r[p])<h)return!0;return!1}function H0(s,r,l){const h=r.distSqr(l);if(h===0)return s.distSqr(r);const p=((s.x-r.x)*(l.x-r.x)+(s.y-r.y)*(l.y-r.y))/h;return s.distSqr(p<0?r:p>1?l:l.sub(r)._mult(p)._add(r))}function Tg(s,r){let l,h,p,x=!1;for(let w=0;w<s.length;w++){l=s[w];for(let A=0,P=l.length-1;A<l.length;P=A++)h=l[A],p=l[P],h.y>r.y!=p.y>r.y&&r.x<(p.x-h.x)*(r.y-h.y)/(p.y-h.y)+h.x&&(x=!x)}return x}function Gd(s,r){let l=!1;for(let h=0,p=s.length-1;h<s.length;p=h++){const x=s[h],w=s[p];x.y>r.y!=w.y>r.y&&r.x<(w.x-x.x)*(r.y-x.y)/(w.y-x.y)+x.x&&(l=!l)}return l}function z_(s,r,l,h,p){for(const w of s)if(r<=w.x&&l<=w.y&&h>=w.x&&p>=w.y)return!0;const x=[new q(r,l),new q(r,p),new q(h,p),new q(h,l)];if(s.length>2){for(const w of x)if(Gd(s,w))return!0}for(let w=0;w<s.length-1;w++)if(vf(s[w],s[w+1],x))return!0;return!1}function vf(s,r,l){const h=l[0],p=l[2];if(s.x<h.x&&r.x<h.x||s.x>p.x&&r.x>p.x||s.y<h.y&&r.y<h.y||s.y>p.y&&r.y>p.y)return!1;const x=wr(s,r,l[0]);return x!==wr(s,r,l[1])||x!==wr(s,r,l[2])||x!==wr(s,r,l[3])}function rp(s,r,l){const h=r.paint.get(s).value;return h.kind==="constant"?h.value:l.programConfigurations.get(r.id).getMaxValue(s)}function Np(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function xf(s,r,l,h,p){if(!r[0]&&!r[1])return s;const x=q.convert(r)._mult(p);l==="viewport"&&x._rotate(-h);const w=[];for(let A=0;A<s.length;A++)w.push(s[A].sub(x));return w}function Ig(s,r,l,h){const p=q.convert(s)._mult(h);return r==="viewport"&&p._rotate(-l),p}ur(np,"CircleBucket",{omit:["layers"]});const ip=new st({"circle-sort-key":new $e(mn.layout_circle["circle-sort-key"])});var j_={paint:new st({"circle-radius":new $e(mn.paint_circle["circle-radius"]),"circle-color":new $e(mn.paint_circle["circle-color"]),"circle-blur":new $e(mn.paint_circle["circle-blur"]),"circle-opacity":new $e(mn.paint_circle["circle-opacity"]),"circle-translate":new _e(mn.paint_circle["circle-translate"]),"circle-translate-anchor":new _e(mn.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new _e(mn.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new _e(mn.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new $e(mn.paint_circle["circle-stroke-width"]),"circle-stroke-color":new $e(mn.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new $e(mn.paint_circle["circle-stroke-opacity"])}),layout:ip};function W0(s,r,l,h,p,x,w,A,P){if(x&&s.queryGeometry.isAboveHorizon)return!1;x&&(P*=s.pixelToTileUnitsFactor);const R=s.tileID.canonical,$=l.projection.upVectorScale(R,l.center.lat,l.worldSize).metersToTile;for(const X of r)for(const re of X){const he=re.add(A),ye=p&&l.elevation?l.elevation.exaggeration()*p.getElevationAt(he.x,he.y,!0):0,Se=l.projection.projectTilePoint(he.x,he.y,R);if(ye>0){const ct=l.projection.upVector(R,he.x,he.y);Se.x+=ct[0]*$*ye,Se.y+=ct[1]*$*ye,Se.z+=ct[2]*$*ye}const Ke=x?he:K0(Se.x,Se.y,Se.z,h),at=x?s.tilespaceRays.map((ct=>Ax(ct,ye))):s.queryGeometry.screenGeometry,xt=_r([],[Se.x,Se.y,Se.z,1],h);if(!w&&x?P*=xt[3]/l.cameraToCenterDistance:w&&!x&&(P*=l.cameraToCenterDistance/xt[3]),x){const ct=Go((re.y/Zr+R.y)/(1<<R.z));P/=l.projection.pixelsPerMeter(ct,1)/Va(1,ct)}if(Ag(at,Ke,P))return!0}return!1}function K0(s,r,l,h){const p=_r([],[s,r,l,1],h);return new q(p[0]/p[3],p[1]/p[3])}const Lm=Ud(0,0,0),Ex=Ud(0,0,1);function Ax(s,r){const l=rd();return Lm[2]=r,s.intersectsPlane(Lm,Ex,l),new q(l[0],l[1])}class X0 extends np{}function Z0(s,{width:r,height:l},h,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==r*l*h)throw new RangeError("mismatched image size")}else p=new Uint8Array(r*l*h);return s.width=r,s.height=l,s.data=p,s}function bf(s,r,l){const{width:h,height:p}=r;h===s.width&&p===s.height||(Y0(s,r,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,h),height:Math.min(s.height,p)},l),s.width=h,s.height=p,s.data=r.data)}function Y0(s,r,l,h,p,x){if(p.width===0||p.height===0)return r;if(p.width>s.width||p.height>s.height||l.x>s.width-p.width||l.y>s.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>r.width||p.height>r.height||h.x>r.width-p.width||h.y>r.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const w=s.data,A=r.data;for(let P=0;P<p.height;P++){const R=((l.y+P)*s.width+l.x)*x,$=((h.y+P)*r.width+h.x)*x;for(let X=0;X<p.width*x;X++)A[$+X]=w[R+X]}return r}ur(X0,"HeatmapBucket",{omit:["layers"]});class oh{constructor(r,l){Z0(this,r,1,l)}resize(r){bf(this,new oh(r),1)}clone(){return new oh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,l,h,p,x){Y0(r,l,h,p,x,1)}}class Vu{constructor(r,l){Z0(this,r,4,l)}resize(r){bf(this,new Vu(r),4)}replace(r,l){l?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new Vu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,l,h,p,x){Y0(r,l,h,p,x,4)}}ur(oh,"AlphaImage"),ur(Vu,"RGBAImage");var Nl={paint:new st({"heatmap-radius":new $e(mn.paint_heatmap["heatmap-radius"]),"heatmap-weight":new $e(mn.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new _e(mn.paint_heatmap["heatmap-intensity"]),"heatmap-color":new it(mn.paint_heatmap["heatmap-color"]),"heatmap-opacity":new _e(mn.paint_heatmap["heatmap-opacity"])})};function J0(s){const r={},l=s.resolution||256,h=s.clips?s.clips.length:1,p=s.image||new Vu({width:l,height:h}),x=(w,A,P)=>{r[s.evaluationKey]=P;const R=s.expression.evaluate(r);p.data[w+A+0]=Math.floor(255*R.r/R.a),p.data[w+A+1]=Math.floor(255*R.g/R.a),p.data[w+A+2]=Math.floor(255*R.b/R.a),p.data[w+A+3]=Math.floor(255*R.a)};if(s.clips)for(let w=0,A=0;w<h;++w,A+=4*l)for(let P=0,R=0;P<l;P++,R+=4){const $=P/(l-1),{start:X,end:re}=s.clips[w];x(A,R,X*(1-$)+re*$)}else for(let w=0,A=0;w<l;w++,A+=4)x(0,A,w/(l-1));return p}var U_={paint:new st({"hillshade-illumination-direction":new _e(mn.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new _e(mn.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new _e(mn.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new _e(mn.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new _e(mn.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new _e(mn.paint_hillshade["hillshade-accent-color"])})};const Tx=Tt([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ix}=Tx;var Cg={exports:{}};function Pm(s,r,l){l=l||2;var h,p,x,w,A,P,R,$=r&&r.length,X=$?r[0]*l:s.length,re=V_(s,0,X,l,!0),he=[];if(!re||re.next===re.prev)return he;if($&&(re=(function(Se,Ke,at,xt){var ct,_t,Ct,It=[];for(ct=0,_t=Ke.length;ct<_t;ct++)(Ct=V_(Se,Ke[ct]*xt,ct<_t-1?Ke[ct+1]*xt:Se.length,xt,!1))===Ct.next&&(Ct.steiner=!0),It.push(ny(Ct));for(It.sort(Pg),ct=0;ct<It.length;ct++)at=Q0(It[ct],at);return at})(s,r,re,l)),s.length>80*l){h=x=s[0],p=w=s[1];for(var ye=l;ye<X;ye+=l)(A=s[ye])<h&&(h=A),(P=s[ye+1])<p&&(p=P),A>x&&(x=A),P>w&&(w=P);R=(R=Math.max(x-h,w-p))!==0?32767/R:0}return op(re,he,l,h,p,R,0),he}function V_(s,r,l,h,p){var x,w;if(p===Op(s,r,l,h)>0)for(x=r;x<l;x+=h)w=kg(x,s[x],s[x+1],w);else for(x=l-h;x>=r;x-=h)w=kg(x,s[x],s[x+1],w);return w&&ap(w,w.next)&&(Sf(w),w=w.next),w}function $c(s,r){if(!s)return s;r||(r=s);var l,h=s;do if(l=!1,h.steiner||!ap(h,h.next)&&sl(h.prev,h,h.next)!==0)h=h.next;else{if(Sf(h),(h=r=h.prev)===h.next)break;l=!0}while(l||h!==r);return r}function op(s,r,l,h,p,x,w){if(s){!w&&x&&(function($,X,re,he){var ye=$;do ye.z===0&&(ye.z=ty(ye.x,ye.y,X,re,he)),ye.prevZ=ye.prev,ye.nextZ=ye.next,ye=ye.next;while(ye!==$);ye.prevZ.nextZ=null,ye.prevZ=null,(function(Se){var Ke,at,xt,ct,_t,Ct,It,sn,tn=1;do{for(at=Se,Se=null,_t=null,Ct=0;at;){for(Ct++,xt=at,It=0,Ke=0;Ke<tn&&(It++,xt=xt.nextZ);Ke++);for(sn=tn;It>0||sn>0&&xt;)It!==0&&(sn===0||!xt||at.z<=xt.z)?(ct=at,at=at.nextZ,It--):(ct=xt,xt=xt.nextZ,sn--),_t?_t.nextZ=ct:Se=ct,ct.prevZ=_t,_t=ct;at=xt}_t.nextZ=null,tn*=2}while(Ct>1)})(ye)})(s,h,p,x);for(var A,P,R=s;s.prev!==s.next;)if(A=s.prev,P=s.next,x?wf(s,h,p,x):Cx(s))r.push(A.i/l|0),r.push(s.i/l|0),r.push(P.i/l|0),Sf(s),s=P.next,R=P.next;else if((s=P)===R){w?w===1?op(s=Lg($c(s),r,l),r,l,h,p,x,2):w===2&&sp(s,r,l,h,p,x):op($c(s),r,l,h,p,x,1);break}}}function Cx(s){var r=s.prev,l=s,h=s.next;if(sl(r,l,h)>=0)return!1;for(var p=r.x,x=l.x,w=h.x,A=r.y,P=l.y,R=h.y,$=p<x?p<w?p:w:x<w?x:w,X=A<P?A<R?A:R:P<R?P:R,re=p>x?p>w?p:w:x>w?x:w,he=A>P?A>R?A:R:P>R?P:R,ye=h.next;ye!==r;){if(ye.x>=$&&ye.x<=re&&ye.y>=X&&ye.y<=he&&Dp(p,A,x,P,w,R,ye.x,ye.y)&&sl(ye.prev,ye,ye.next)>=0)return!1;ye=ye.next}return!0}function wf(s,r,l,h){var p=s.prev,x=s,w=s.next;if(sl(p,x,w)>=0)return!1;for(var A=p.x,P=x.x,R=w.x,$=p.y,X=x.y,re=w.y,he=A<P?A<R?A:R:P<R?P:R,ye=$<X?$<re?$:re:X<re?X:re,Se=A>P?A>R?A:R:P>R?P:R,Ke=$>X?$>re?$:re:X>re?X:re,at=ty(he,ye,r,l,h),xt=ty(Se,Ke,r,l,h),ct=s.prevZ,_t=s.nextZ;ct&&ct.z>=at&&_t&&_t.z<=xt;){if(ct.x>=he&&ct.x<=Se&&ct.y>=ye&&ct.y<=Ke&&ct!==p&&ct!==w&&Dp(A,$,P,X,R,re,ct.x,ct.y)&&sl(ct.prev,ct,ct.next)>=0||(ct=ct.prevZ,_t.x>=he&&_t.x<=Se&&_t.y>=ye&&_t.y<=Ke&&_t!==p&&_t!==w&&Dp(A,$,P,X,R,re,_t.x,_t.y)&&sl(_t.prev,_t,_t.next)>=0))return!1;_t=_t.nextZ}for(;ct&&ct.z>=at;){if(ct.x>=he&&ct.x<=Se&&ct.y>=ye&&ct.y<=Ke&&ct!==p&&ct!==w&&Dp(A,$,P,X,R,re,ct.x,ct.y)&&sl(ct.prev,ct,ct.next)>=0)return!1;ct=ct.prevZ}for(;_t&&_t.z<=xt;){if(_t.x>=he&&_t.x<=Se&&_t.y>=ye&&_t.y<=Ke&&_t!==p&&_t!==w&&Dp(A,$,P,X,R,re,_t.x,_t.y)&&sl(_t.prev,_t,_t.next)>=0)return!1;_t=_t.nextZ}return!0}function Lg(s,r,l){var h=s;do{var p=h.prev,x=h.next.next;!ap(p,x)&&km(p,h,h.next,x)&&Mm(p,x)&&Mm(x,p)&&(r.push(p.i/l|0),r.push(h.i/l|0),r.push(x.i/l|0),Sf(h),Sf(h.next),h=s=x),h=h.next}while(h!==s);return $c(h)}function sp(s,r,l,h,p,x){var w=s;do{for(var A=w.next.next;A!==w.prev;){if(w.i!==A.i&&q_(w,A)){var P=ry(w,A);return w=$c(w,w.next),P=$c(P,P.next),op(w,r,l,h,p,x,0),void op(P,r,l,h,p,x,0)}A=A.next}w=w.next}while(w!==s)}function Pg(s,r){return s.x-r.x}function Q0(s,r){var l=(function(p,x){var w,A=x,P=p.x,R=p.y,$=-1/0;do{if(R<=A.y&&R>=A.next.y&&A.next.y!==A.y){var X=A.x+(R-A.y)*(A.next.x-A.x)/(A.next.y-A.y);if(X<=P&&X>$&&($=X,w=A.x<A.next.x?A:A.next,X===P))return w}A=A.next}while(A!==x);if(!w)return null;var re,he=w,ye=w.x,Se=w.y,Ke=1/0;A=w;do P>=A.x&&A.x>=ye&&P!==A.x&&Dp(R<Se?P:$,R,ye,Se,R<Se?$:P,R,A.x,A.y)&&(re=Math.abs(R-A.y)/(P-A.x),Mm(A,p)&&(re<Ke||re===Ke&&(A.x>w.x||A.x===w.x&&ey(w,A)))&&(w=A,Ke=re)),A=A.next;while(A!==he);return w})(s,r);if(!l)return r;var h=ry(l,s);return $c(h,h.next),$c(l,l.next)}function ey(s,r){return sl(s.prev,s,r.prev)<0&&sl(r.next,s,s.next)<0}function ty(s,r,l,h,p){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-l)*p|0)|s<<8))|s<<4))|s<<2))|s<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-h)*p|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function ny(s){var r=s,l=s;do(r.x<l.x||r.x===l.x&&r.y<l.y)&&(l=r),r=r.next;while(r!==s);return l}function Dp(s,r,l,h,p,x,w,A){return(p-w)*(r-A)>=(s-w)*(x-A)&&(s-w)*(h-A)>=(l-w)*(r-A)&&(l-w)*(x-A)>=(p-w)*(h-A)}function q_(s,r){return s.next.i!==r.i&&s.prev.i!==r.i&&!(function(l,h){var p=l;do{if(p.i!==l.i&&p.next.i!==l.i&&p.i!==h.i&&p.next.i!==h.i&&km(p,p.next,l,h))return!0;p=p.next}while(p!==l);return!1})(s,r)&&(Mm(s,r)&&Mm(r,s)&&(function(l,h){var p=l,x=!1,w=(l.x+h.x)/2,A=(l.y+h.y)/2;do p.y>A!=p.next.y>A&&p.next.y!==p.y&&w<(p.next.x-p.x)*(A-p.y)/(p.next.y-p.y)+p.x&&(x=!x),p=p.next;while(p!==l);return x})(s,r)&&(sl(s.prev,s,r.prev)||sl(s,r.prev,r))||ap(s,r)&&sl(s.prev,s,s.next)>0&&sl(r.prev,r,r.next)>0)}function sl(s,r,l){return(r.y-s.y)*(l.x-r.x)-(r.x-s.x)*(l.y-r.y)}function ap(s,r){return s.x===r.x&&s.y===r.y}function km(s,r,l,h){var p=Fp(sl(s,r,l)),x=Fp(sl(s,r,h)),w=Fp(sl(l,h,s)),A=Fp(sl(l,h,r));return p!==x&&w!==A||!(p!==0||!Rm(s,l,r))||!(x!==0||!Rm(s,h,r))||!(w!==0||!Rm(l,s,h))||!(A!==0||!Rm(l,r,h))}function Rm(s,r,l){return r.x<=Math.max(s.x,l.x)&&r.x>=Math.min(s.x,l.x)&&r.y<=Math.max(s.y,l.y)&&r.y>=Math.min(s.y,l.y)}function Fp(s){return s>0?1:s<0?-1:0}function Mm(s,r){return sl(s.prev,s,s.next)<0?sl(s,r,s.next)>=0&&sl(s,s.prev,r)>=0:sl(s,r,s.prev)<0||sl(s,s.next,r)<0}function ry(s,r){var l=new Nm(s.i,s.x,s.y),h=new Nm(r.i,r.x,r.y),p=s.next,x=r.prev;return s.next=r,r.prev=s,l.next=p,p.prev=l,h.next=l,l.prev=h,x.next=h,h.prev=x,h}function kg(s,r,l,h){var p=new Nm(s,r,l);return h?(p.next=h.next,p.prev=h,h.next.prev=p,h.next=p):(p.prev=p,p.next=p),p}function Sf(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Nm(s,r,l){this.i=s,this.x=r,this.y=l,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Op(s,r,l,h){for(var p=0,x=r,w=l-h;x<l;x+=h)p+=(s[w]-s[x])*(s[x+1]+s[w+1]),w=x;return p}Cg.exports=Pm,Cg.exports.default=Pm,Pm.deviation=function(s,r,l,h){var p=r&&r.length,x=Math.abs(Op(s,0,p?r[0]*l:s.length,l));if(p)for(var w=0,A=r.length;w<A;w++)x-=Math.abs(Op(s,r[w]*l,w<A-1?r[w+1]*l:s.length,l));var P=0;for(w=0;w<h.length;w+=3){var R=h[w]*l,$=h[w+1]*l,X=h[w+2]*l;P+=Math.abs((s[R]-s[X])*(s[$+1]-s[R+1])-(s[R]-s[$])*(s[X+1]-s[R+1]))}return x===0&&P===0?0:Math.abs((P-x)/x)},Pm.flatten=function(s){for(var r=s[0][0].length,l={vertices:[],holes:[],dimensions:r},h=0,p=0;p<s.length;p++){for(var x=0;x<s[p].length;x++)for(var w=0;w<r;w++)l.vertices.push(s[p][x][w]);p>0&&l.holes.push(h+=s[p-1].length)}return l};var Rg=ue(Cg.exports);function Lx(s,r,l,h,p){Dm(s,r,l,h||s.length-1,p||Om)}function Dm(s,r,l,h,p){for(;h>l;){if(h-l>600){var x=h-l+1,w=r-l+1,A=Math.log(x),P=.5*Math.exp(2*A/3),R=.5*Math.sqrt(A*P*(x-P)/x)*(w-x/2<0?-1:1);Dm(s,r,Math.max(l,Math.floor(r-w*P/x+R)),Math.min(h,Math.floor(r+(x-w)*P/x+R)),p)}var $=s[r],X=l,re=h;for(Fm(s,l,r),p(s[h],$)>0&&Fm(s,l,h);X<re;){for(Fm(s,X,re),X++,re--;p(s[X],$)<0;)X++;for(;p(s[re],$)>0;)re--}p(s[l],$)===0?Fm(s,l,re):Fm(s,++re,h),re<=r&&(l=re+1),r<=re&&(h=re-1)}}function Fm(s,r,l){var h=s[r];s[r]=s[l],s[l]=h}function Om(s,r){return s<r?-1:s>r?1:0}function iy(s,r){const l=s.length;if(l<=1)return[s];const h=[];let p,x;for(let w=0;w<l;w++){const A=Cr(s[w]);A!==0&&(s[w].area=Math.abs(A),x===void 0&&(x=A<0),x===A<0?(p&&h.push(p),p=[s[w]]):p.push(s[w]))}if(p&&h.push(p),r>1)for(let w=0;w<h.length;w++)h[w].length<=r||(Lx(h[w],r,1,h[w].length-1,Mg),h[w]=h[w].slice(0,r));return h}function Mg(s,r){return r.area-s.area}function d(s,r,l){const h=l.patternDependencies;let p=!1;for(const x of r){const w=x.paint.get(`${s}-pattern`);w.isConstant()||(p=!0);const A=w.constantOr(null);A&&(p=!0,h[A]=!0)}return p}function g(s,r,l,h,p){const x=p.patternDependencies;for(const w of r){const A=w.paint.get(`${s}-pattern`).value;if(A.kind!=="constant"){let P=A.evaluate({zoom:h},l,{},p.availableImages);P=P&&P.name?P.name:P,x[P]=!0,l.patterns[w.id]=P}}return l}class E{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((l=>l.id)),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new vn,this.indexArray=new xr,this.indexArray2=new hs,this.programConfigurations=new ih(r.layers,r.zoom),this.segments=new Pa,this.segments2=new Pa,this.stateDependentLayerIds=this.layers.filter((l=>l.isStateDependent())).map((l=>l.id)),this.projection=r.projection}populate(r,l,h,p){this.hasPattern=d("fill",this.layers,l);const x=this.layers[0].layout.get("fill-sort-key"),w=[];for(const{feature:A,id:P,index:R,sourceLayerIndex:$}of r){const X=this.layers[0]._featureFilter.needGeometry,re=Td(A,X);if(!this.layers[0]._featureFilter.filter(new G(this.zoom),re,h))continue;const he=x?x.evaluate(re,{},h,l.availableImages):void 0,ye={id:P,properties:A.properties,type:A.type,sourceLayerIndex:$,index:R,geometry:X?re.geometry:wu(A,h,p),patterns:{},sortKey:he};w.push(ye)}x&&w.sort(((A,P)=>A.sortKey-P.sortKey));for(const A of w){const{geometry:P,index:R,sourceLayerIndex:$}=A;if(this.hasPattern){const X=g("fill",this.layers,A,this.zoom,l);this.patternFeatures.push(X)}else this.addFeature(A,P,R,h,{},l.availableImages);l.featureIndex.insert(r[R].feature,P,R,$,this.index)}}update(r,l,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,h,p)}addFeatures(r,l,h,p,x){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,l,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Ix),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,l,h,p,x,w=[]){for(const A of iy(l,500)){let P=0;for(const ye of A)P+=ye.length;const R=this.segments.prepareSegment(P,this.layoutVertexArray,this.indexArray),$=R.vertexLength,X=[],re=[];for(const ye of A){if(ye.length===0)continue;ye!==A[0]&&re.push(X.length/2);const Se=this.segments2.prepareSegment(ye.length,this.layoutVertexArray,this.indexArray2),Ke=Se.vertexLength;this.layoutVertexArray.emplaceBack(ye[0].x,ye[0].y),this.indexArray2.emplaceBack(Ke+ye.length-1,Ke),X.push(ye[0].x),X.push(ye[0].y);for(let at=1;at<ye.length;at++)this.layoutVertexArray.emplaceBack(ye[at].x,ye[at].y),this.indexArray2.emplaceBack(Ke+at-1,Ke+at),X.push(ye[at].x),X.push(ye[at].y);Se.vertexLength+=ye.length,Se.primitiveLength+=ye.length}const he=Rg(X,re);for(let ye=0;ye<he.length;ye+=3)this.indexArray.emplaceBack($+he[ye],$+he[ye+1],$+he[ye+2]);R.vertexLength+=P,R.primitiveLength+=he.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,x,w,p)}}ur(E,"FillBucket",{omit:["layers","patternFeatures"]});const D=new st({"fill-sort-key":new $e(mn.layout_fill["fill-sort-key"])});var K={paint:new st({"fill-antialias":new _e(mn.paint_fill["fill-antialias"]),"fill-opacity":new $e(mn.paint_fill["fill-opacity"]),"fill-color":new $e(mn.paint_fill["fill-color"]),"fill-outline-color":new $e(mn.paint_fill["fill-outline-color"]),"fill-translate":new _e(mn.paint_fill["fill-translate"]),"fill-translate-anchor":new _e(mn.paint_fill["fill-translate-anchor"]),"fill-pattern":new $e(mn.paint_fill["fill-pattern"])}),layout:D};const ce=Tt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),je=Tt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Et=Tt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Ft}=ce;var _n={},tr=U,ar=Kn;function Kn(s,r,l,h,p){this.properties={},this.extent=l,this.type=0,this._pbf=s,this._geometry=-1,this._keys=h,this._values=p,s.readFields(Wr,this,r)}function Wr(s,r,l){s==1?r.id=l.readVarint():s==2?(function(h,p){for(var x=h.readVarint()+h.pos;h.pos<x;){var w=p._keys[h.readVarint()],A=p._values[h.readVarint()];p.properties[w]=A}})(l,r):s==3?r.type=l.readVarint():s==4&&(r._geometry=l.pos)}function ii(s){for(var r,l,h=0,p=0,x=s.length,w=x-1;p<x;w=p++)h+=((l=s[w]).x-(r=s[p]).x)*(r.y+l.y);return h}Kn.types=["Unknown","Point","LineString","Polygon"],Kn.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var r,l=s.readVarint()+s.pos,h=1,p=0,x=0,w=0,A=[];s.pos<l;){if(p<=0){var P=s.readVarint();h=7&P,p=P>>3}if(p--,h===1||h===2)x+=s.readSVarint(),w+=s.readSVarint(),h===1&&(r&&A.push(r),r=[]),r.push(new tr(x,w));else{if(h!==7)throw new Error("unknown command "+h);r&&r.push(r[0].clone())}}return r&&A.push(r),A},Kn.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var r=s.readVarint()+s.pos,l=1,h=0,p=0,x=0,w=1/0,A=-1/0,P=1/0,R=-1/0;s.pos<r;){if(h<=0){var $=s.readVarint();l=7&$,h=$>>3}if(h--,l===1||l===2)(p+=s.readSVarint())<w&&(w=p),p>A&&(A=p),(x+=s.readSVarint())<P&&(P=x),x>R&&(R=x);else if(l!==7)throw new Error("unknown command "+l)}return[w,P,A,R]},Kn.prototype.toGeoJSON=function(s,r,l){var h,p,x=this.extent*Math.pow(2,l),w=this.extent*s,A=this.extent*r,P=this.loadGeometry(),R=Kn.types[this.type];function $(he){for(var ye=0;ye<he.length;ye++){var Se=he[ye];he[ye]=[360*(Se.x+w)/x-180,360/Math.PI*Math.atan(Math.exp((180-360*(Se.y+A)/x)*Math.PI/180))-90]}}switch(this.type){case 1:var X=[];for(h=0;h<P.length;h++)X[h]=P[h][0];$(P=X);break;case 2:for(h=0;h<P.length;h++)$(P[h]);break;case 3:for(P=(function(he){var ye=he.length;if(ye<=1)return[he];for(var Se,Ke,at=[],xt=0;xt<ye;xt++){var ct=ii(he[xt]);ct!==0&&(Ke===void 0&&(Ke=ct<0),Ke===ct<0?(Se&&at.push(Se),Se=[he[xt]]):Se.push(he[xt]))}return Se&&at.push(Se),at})(P),h=0;h<P.length;h++)for(p=0;p<P[h].length;p++)$(P[h][p])}P.length===1?P=P[0]:R="Multi"+R;var re={type:"Feature",geometry:{type:R,coordinates:P},properties:this.properties};return"id"in this&&(re.id=this.id),re};var di=ar,Dl=an;function an(s,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(Ht,this,r),this.length=this._features.length}function Ht(s,r,l){s===15?r.version=l.readVarint():s===1?r.name=l.readString():s===5?r.extent=l.readVarint():s===2?r._features.push(l.pos):s===3?r._keys.push(l.readString()):s===4&&r._values.push((function(h){for(var p=null,x=h.readVarint()+h.pos;h.pos<x;){var w=h.readVarint()>>3;p=w===1?h.readString():w===2?h.readFloat():w===3?h.readDouble():w===4?h.readVarint64():w===5?h.readVarint():w===6?h.readSVarint():w===7?h.readBoolean():null}return p})(l))}an.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var r=this._pbf.readVarint()+this._pbf.pos;return new di(this._pbf,r,this.extent,this._keys,this._values)};var gn=Dl;function gr(s,r,l){if(s===3){var h=new gn(l,l.readVarint()+l.pos);h.length&&(r[h.name]=h)}}var fi=_n.VectorTile=function(s,r){this.layers=s.readFields(gr,{},r)},Di=_n.VectorTileFeature=ar;function Fi(s,r,l,h){const p=[],x=h===0?(w,A,P,R,$,X)=>{w.push(new q(X,P+(X-A)/(R-A)*($-P)))}:(w,A,P,R,$,X)=>{w.push(new q(A+(X-P)/($-P)*(R-A),X))};for(const w of s){const A=[];for(const P of w){if(P.length<=2)continue;const R=[];for(let re=0;re<P.length-1;re++){const he=P[re].x,ye=P[re].y,Se=P[re+1].x,Ke=P[re+1].y,at=h===0?he:ye,xt=h===0?Se:Ke;at<r?xt>r&&x(R,he,ye,Se,Ke,r):at>l?xt<l&&x(R,he,ye,Se,Ke,l):R.push(P[re]),xt<r&&at>=r&&x(R,he,ye,Se,Ke,r),xt>l&&at<=l&&x(R,he,ye,Se,Ke,l)}let $=P[P.length-1];const X=h===0?$.x:$.y;X>=r&&X<=l&&R.push($),R.length&&($=R[R.length-1],R[0].x===$.x&&R[0].y===$.y||R.push(R[0]),A.push(R))}A.length&&p.push(A)}return p}_n.VectorTileLayer=Dl;const io=Di.types,Gc=Math.pow(2,13);function rs(s,r,l,h,p,x,w,A){s.emplaceBack((r<<1)+w,(l<<1)+x,(Math.floor(h*Gc)<<1)+p,Math.round(A))}function Uh(s,r,l){s.emplaceBack(r.x,r.y,r.z,l[0]*16384,l[1]*16384,l[2]*16384)}class $_{constructor(){this.acc=new q(0,0),this.polyCount=[]}startRing(r){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new q(r.x,r.y),this.max=new q(r.x,r.y))}append(r,l){this.currentPolyCount.edges++,this.acc._add(r);const h=this.min,p=this.max;r.x<h.x?h.x=r.x:r.x>p.x&&(p.x=r.x),r.y<h.y?h.y=r.y:r.y>p.y&&(p.y=r.y),((r.x===0||r.x===Zr)&&r.x===l.x)!=((r.y===0||r.y===Zr)&&r.y===l.y)&&this.processBorderOverlap(r,l),l.x<0!=r.x<0&&this.addBorderIntersection(0,He(l.y,r.y,(0-l.x)/(r.x-l.x))),l.x>Zr!=r.x>Zr&&this.addBorderIntersection(1,He(l.y,r.y,(Zr-l.x)/(r.x-l.x))),l.y<0!=r.y<0&&this.addBorderIntersection(2,He(l.x,r.x,(0-l.y)/(r.y-l.y))),l.y>Zr!=r.y>Zr&&this.addBorderIntersection(3,He(l.x,r.x,(Zr-l.y)/(r.y-l.y)))}addBorderIntersection(r,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const h=this.borders[r];l<h[0]&&(h[0]=l),l>h[1]&&(h[1]=l)}processBorderOverlap(r,l){if(r.x===l.x){if(r.y===l.y)return;const h=r.x===0?0:1;this.addBorderIntersection(h,l.y),this.addBorderIntersection(h,r.y)}else{const h=r.y===0?2:3;this.addBorderIntersection(h,l.x),this.addBorderIntersection(h,r.x)}}centroid(){const r=this.polyCount.reduce(((l,h)=>l+h.edges),0);return r!==0?this.acc.div(r)._round():new q(0,0)}span(){return new q(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce(((r,l)=>r+ +(l[0]!==Number.MAX_VALUE)),0)}}class oy{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((l=>l.id)),this.index=r.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=r.projection,this.layoutVertexArray=new ln,this.centroidVertexArray=new dc,this.indexArray=new xr,this.programConfigurations=new ih(r.layers,r.zoom),this.segments=new Pa,this.stateDependentLayerIds=this.layers.filter((l=>l.isStateDependent())).map((l=>l.id)),this.enableTerrain=r.enableTerrain}populate(r,l,h,p){this.features=[],this.hasPattern=d("fill-extrusion",this.layers,l),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=(function(x){const w=Math.exp(Math.PI*(1-x.y/(1<<x.z)*2));return 80150034*w/(w*w+1)/Zr/(1<<x.z)})(h),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:x,id:w,index:A,sourceLayerIndex:P}of r){const R=this.layers[0]._featureFilter.needGeometry,$=Td(x,R);if(!this.layers[0]._featureFilter.filter(new G(this.zoom),$,h))continue;const X={id:w,sourceLayerIndex:P,index:A,geometry:R?$.geometry:wu(x,h,p),properties:x.properties,type:x.type,patterns:{}},re=this.layoutVertexArray.length;this.hasPattern?this.features.push(g("fill-extrusion",this.layers,X,this.zoom,l)):this.addFeature(X,X.geometry,A,h,{},l.availableImages,p),l.featureIndex.insert(x,X.geometry,A,P,this.index,re)}this.sortBorders()}addFeatures(r,l,h,p,x){for(const w of this.features){const{geometry:A}=w;this.addFeature(w,A,w.index,l,h,p,x)}this.sortBorders()}update(r,l,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Ft),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=r.createVertexBuffer(this.layoutVertexExtArray,Et.members,!0))),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,je.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,l,h,p,x,w,A){const P=[new q(0,0),new q(Zr,Zr)],R=A.projection,$=R.name==="globe",X=this.enableTerrain&&!$?new $_:null,re=io[r.type]==="Polygon";$&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Tn);const he=iy(l,500);for(let at=he.length-1;at>=0;at--){const xt=he[at];(xt.length===0||(ye=xt[0]).every((ct=>ct.x<=0))||ye.every((ct=>ct.x>=Zr))||ye.every((ct=>ct.y<=0))||ye.every((ct=>ct.y>=Zr)))&&he.splice(at,1)}var ye;let Se;if($)Se=X3(he,P,p);else{Se=[];for(const at of he)Se.push({polygon:at,bounds:P})}const Ke=re?this.edgeRadius:0;for(const{polygon:at,bounds:xt}of Se){let ct=0,_t=0;for(const It of at)re&&!It[0].equals(It[It.length-1])&&It.push(It[0]),_t+=re?It.length-1:It.length;const Ct=this.segments.prepareSegment((re?5:4)*_t,this.layoutVertexArray,this.indexArray);if(re){const It=[],sn=[];ct=Ct.vertexLength;for(const Sn of at){let $n,fn;Sn.length&&Sn!==at[0]&&sn.push(It.length/2),$n=Sn[1].sub(Sn[0])._perp()._unit();for(let kn=1;kn<Sn.length;kn++){const Rn=Sn[kn],Vn=Sn[kn===Sn.length-1?1:kn+1];let{x:Xn,y:wn}=Rn;if(Ke){fn=Vn.sub(Rn)._perp()._unit();const pr=$n.add(fn)._unit(),zr=Ke*Math.min(4,1/($n.x*pr.x+$n.y*pr.y));Xn+=zr*pr.x,wn+=zr*pr.y,$n=fn}rs(this.layoutVertexArray,Xn,wn,0,0,1,1,0),Ct.vertexLength++,It.push(Rn.x,Rn.y),$&&Uh(this.layoutVertexExtArray,R.projectTilePoint(Xn,wn,p),R.upVector(p,Xn,wn))}}const tn=Rg(It,sn);for(let Sn=0;Sn<tn.length;Sn+=3)this.indexArray.emplaceBack(ct+tn[Sn],ct+tn[Sn+2],ct+tn[Sn+1]),Ct.primitiveLength++}for(const It of at){X&&It.length&&X.startRing(It[0]);let sn,tn,Sn,$n=It.length>4&&H3(It[It.length-2],It[0],It[1]),fn=Ke?LC(It[It.length-2],It[0],It[1],Ke):0;tn=It[1].sub(It[0])._perp()._unit();let kn=!0;for(let Rn=1,Vn=0;Rn<It.length;Rn++){let Xn=It[Rn-1],wn=It[Rn];const pr=It[Rn===It.length-1?1:Rn+1];if(X&&re&&X.currentPolyCount.top++,G3(wn,Xn,xt)){Ke&&(tn=pr.sub(wn)._perp()._unit(),kn=!kn);continue}X&&X.append(wn,Xn);const zr=wn.sub(Xn)._perp(),yr=zr.x/(Math.abs(zr.x)+Math.abs(zr.y)),Ki=zr.y>0?1:0,Zn=Xn.dist(wn);if(Vn+Zn>32768&&(Vn=0),Ke){Sn=pr.sub(wn)._perp()._unit();let Zi=$3(Xn,wn,pr,q3(tn,Sn),Ke);isNaN(Zi)&&(Zi=0);const bi=wn.sub(Xn)._unit();Xn=Xn.add(bi.mult(fn))._round(),wn=wn.add(bi.mult(-Zi))._round(),fn=Zi,tn=Sn}const ti=Ct.vertexLength,Xi=It.length>4&&H3(Xn,wn,pr);let is=W3(Vn,$n,kn);if(rs(this.layoutVertexArray,Xn.x,Xn.y,yr,Ki,0,0,is),rs(this.layoutVertexArray,Xn.x,Xn.y,yr,Ki,0,1,is),Vn+=Zn,is=W3(Vn,Xi,!kn),$n=Xi,rs(this.layoutVertexArray,wn.x,wn.y,yr,Ki,0,0,is),rs(this.layoutVertexArray,wn.x,wn.y,yr,Ki,0,1,is),Ct.vertexLength+=4,this.indexArray.emplaceBack(ti+0,ti+1,ti+2),this.indexArray.emplaceBack(ti+1,ti+3,ti+2),Ct.primitiveLength+=2,Ke){const Zi=ct+(Rn===1?It.length-2:Rn-2),bi=Rn===1?ct:Zi+1;if(this.indexArray.emplaceBack(ti+1,Zi,ti+3),this.indexArray.emplaceBack(Zi,bi,ti+3),Ct.primitiveLength+=2,sn===void 0&&(sn=ti),!G3(pr,It[Rn],xt)){const fa=Rn===It.length-1?sn:Ct.vertexLength;this.indexArray.emplaceBack(ti+2,ti+3,fa),this.indexArray.emplaceBack(ti+3,fa+1,fa),this.indexArray.emplaceBack(ti+3,bi,fa+1),Ct.primitiveLength+=3}kn=!kn}if($){const Zi=this.layoutVertexExtArray,bi=R.projectTilePoint(Xn.x,Xn.y,p),fa=R.projectTilePoint(wn.x,wn.y,p),Ji=R.upVector(p,Xn.x,Xn.y),Qi=R.upVector(p,wn.x,wn.y);Uh(Zi,bi,Ji),Uh(Zi,bi,Ji),Uh(Zi,fa,Qi),Uh(Zi,fa,Qi)}}re&&(ct+=It.length-1)}}if(X&&X.polyCount.length>0){if(X.borders){X.vertexArrayOffset=this.centroidVertexArray.length;const at=X.borders,xt=this.featuresOnBorder.push(X)-1;for(let ct=0;ct<4;ct++)at[ct][0]!==Number.MAX_VALUE&&this.borders[ct].push(xt)}this.encodeCentroid(X.borders?void 0:X.centroid(),X)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,x,w,p)}sortBorders(){for(let r=0;r<4;r++)this.borders[r].sort(((l,h)=>this.featuresOnBorder[l].borders[r][0]-this.featuresOnBorder[h].borders[r][0]))}encodeCentroid(r,l,h=!0){let p,x;if(r)if(r.y!==0){const A=l.span()._mult(this.tileToMeter);p=(Math.max(r.x,1)<<3)+Math.min(7,Math.round(A.x/10)),x=(Math.max(r.y,1)<<3)+Math.min(7,Math.round(A.y/10))}else p=Math.ceil(7*(r.x+450)),x=0;else p=0,x=+h;let w=h?this.centroidVertexArray.length:l.vertexArrayOffset;for(const A of l.polyCount){h&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*A.edges+A.top);for(let P=0;P<A.top;P++)this.centroidVertexArray.emplace(w++,p,x);for(let P=0;P<2*A.edges;P++)this.centroidVertexArray.emplace(w++,0,x),this.centroidVertexArray.emplace(w++,p,x)}}}function q3(s,r){const l=s.add(r)._unit();return s.x*l.x+s.y*l.y}function LC(s,r,l,h){const p=r.sub(s)._perp()._unit(),x=l.sub(r)._perp()._unit();return $3(s,r,l,q3(p,x),h)}function $3(s,r,l,h,p){const x=Math.sqrt(1-h*h);return Math.min(s.dist(r)/3,r.dist(l)/3,p*x/h)}function G3(s,r,l){return s.x<l[0].x&&r.x<l[0].x||s.x>l[1].x&&r.x>l[1].x||s.y<l[0].y&&r.y<l[0].y||s.y>l[1].y&&r.y>l[1].y}function H3(s,r,l){if(s.x<0||s.x>=Zr||r.x<0||r.x>=Zr||l.x<0||l.x>=Zr)return!1;const h=l.sub(r),p=h.perp(),x=s.sub(r);return(h.x*x.x+h.y*x.y)/Math.sqrt((h.x*h.x+h.y*h.y)*(x.x*x.x+x.y*x.y))>-.866&&p.x*x.x+p.y*x.y<0}function W3(s,r,l){const h=r?2|s:-3&s;return l?1|h:-2&h}function K3(){const s=Math.PI/32,r=Math.tan(s),l=qc;return l*Math.sqrt(1+2*r*r)-l}function X3(s,r,l){const h=1<<l.z,p=Kl(l.x/h),x=Kl((l.x+1)/h),w=Go(l.y/h),A=Go((l.y+1)/h);return(function(P,R,$,X,re=0,he){const ye=[];if(!P.length||!$||!X)return ye;const Se=(It,sn)=>{for(const tn of It)ye.push({polygon:tn,bounds:sn})},Ke=Math.ceil(Math.log2($)),at=Math.ceil(Math.log2(X)),xt=Ke-at,ct=[];for(let It=0;It<Math.abs(xt);It++)ct.push(xt>0?0:1);for(let It=0;It<Math.min(Ke,at);It++)ct.push(0),ct.push(1);let _t=P;if(_t=Fi(_t,R[0].y-re,R[1].y+re,1),_t=Fi(_t,R[0].x-re,R[1].x+re,0),!_t.length)return ye;const Ct=[];for(ct.length?Ct.push({polygons:_t,bounds:R,depth:0}):Se(_t,R);Ct.length;){const It=Ct.pop(),sn=It.depth,tn=ct[sn],Sn=It.bounds[0],$n=It.bounds[1],fn=tn===0?Sn.x:Sn.y,kn=tn===0?$n.x:$n.y,Rn=he?he(tn,fn,kn):.5*(fn+kn),Vn=Fi(It.polygons,fn-re,Rn+re,tn),Xn=Fi(It.polygons,Rn-re,kn+re,tn);if(Vn.length){const wn=[Sn,new q(tn===0?Rn:$n.x,tn===1?Rn:$n.y)];ct.length>sn+1?Ct.push({polygons:Vn,bounds:wn,depth:sn+1}):Se(Vn,wn)}if(Xn.length){const wn=[new q(tn===0?Rn:Sn.x,tn===1?Rn:Sn.y),$n];ct.length>sn+1?Ct.push({polygons:Xn,bounds:wn,depth:sn+1}):Se(Xn,wn)}}return ye})(s,r,Math.ceil((x-p)/11.25),Math.ceil((w-A)/11.25),1,((P,R,$)=>{if(P===0)return .5*(R+$);{const X=Go((l.y+R/Zr)/h);return(bs(.5*(Go((l.y+$/Zr)/h)+X))*h-l.y)*Zr}}))}ur(oy,"FillExtrusionBucket",{omit:["layers","features"]}),ur($_,"PartMetadata");const PC=new st({"fill-extrusion-edge-radius":new _e(mn["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var kC={paint:new st({"fill-extrusion-opacity":new _e(mn["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new $e(mn["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new _e(mn["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new _e(mn["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new $e(mn["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new $e(mn["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new $e(mn["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new _e(mn["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new _e(mn["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new _e(mn["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new _e(mn["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:PC};function Z3(s,r,l){var h=2*Math.PI*6378137/256/Math.pow(2,l);return[s*h-2*Math.PI*6378137/2,r*h-2*Math.PI*6378137/2]}class G_{constructor(r,l,h){this.z=r,this.x=l,this.y=h,this.key=sy(0,r,r,l,h)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,l){const h=(function(x,w,A){var P=Z3(256*x,256*(w=Math.pow(2,A)-w-1),A),R=Z3(256*(x+1),256*(w+1),A);return P[0]+","+P[1]+","+R[0]+","+R[1]})(this.x,this.y,this.z),p=(function(x,w,A){let P,R="";for(let $=x;$>0;$--)P=1<<$-1,R+=(w&P?1:0)+(A&P?2:0);return R})(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",h)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Y3{constructor(r,l){this.wrap=r,this.canonical=l,this.key=sy(r,l.z,l.z,l.x,l.y)}}class sh{constructor(r,l,h,p,x){this.overscaledZ=r,this.wrap=l,this.canonical=new G_(h,+p,+x),this.key=l===0&&r===h?this.canonical.key:sy(l,r,h,p,x)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const l=this.canonical.z-r;return r>this.canonical.z?new sh(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new sh(r,this.wrap,r,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(r,l=!0){if(this.overscaledZ===r&&l)return this.key;if(r>this.canonical.z)return sy(this.wrap*+l,r,this.canonical.z,this.canonical.x,this.canonical.y);{const h=this.canonical.z-r;return sy(this.wrap*+l,r,r,this.canonical.x>>h,this.canonical.y>>h)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const l=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>l&&r.canonical.y===this.canonical.y>>l}children(r){if(this.overscaledZ>=r)return[new sh(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,h=2*this.canonical.x,p=2*this.canonical.y;return[new sh(l,this.wrap,l,h,p),new sh(l,this.wrap,l,h+1,p),new sh(l,this.wrap,l,h,p+1),new sh(l,this.wrap,l,h+1,p+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new sh(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new sh(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Y3(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function sy(s,r,l,h,p){const x=1<<Math.min(l,22);let w=x*(p%x)+h%x;return s&&l<22&&(w+=x*x*((s<0?-2*s-1:2*s)%(1<<2*(22-l)))),16*(32*w+l)+(r-l)}ur(G_,"CanonicalTileID"),ur(sh,"OverscaledTileID",{omit:["projMatrix"]});class Ng extends q{constructor(r,l,h){super(r,l),this.z=h}}function ay(s,r){return s.x*r.x+s.y*r.y}function J3(s,r){if(s.length===1){let l=0;const h=r[l++];let p;for(;!p||h.equals(p);)if(p=r[l++],!p)return 1/0;for(;l<r.length;l++){const x=r[l],w=s[0],A=p.sub(h),P=x.sub(h),R=w.sub(h),$=ay(A,A),X=ay(A,P),re=ay(P,P),he=ay(R,A),ye=ay(R,P),Se=$*re-X*X,Ke=(re*he-X*ye)/Se,at=($*ye-X*he)/Se,xt=h.z*(1-Ke-at)+p.z*Ke+x.z*at;if(isFinite(xt))return xt}return 1/0}{let l=1/0;for(const h of r)l=Math.min(l,h.z);return l}}function Q3(s,r,l,h,p,x,w,A){const P=w*p.getElevationAt(s,r,!0,!0),R=x[0]!==0,$=R?x[1]===0?w*(x[0]/7-450):w*(function(X,re,he){const ye=Math.floor(re[0]/8),Se=Math.floor(re[1]/8),Ke=10*(re[0]-8*ye),at=10*(re[1]-8*Se),xt=X.getElevationAt(ye,Se,!0,!0),ct=X.getMeterToDEM(he),_t=Math.floor(.5*(Ke*ct-1)),Ct=Math.floor(.5*(at*ct-1)),It=X.tileCoordToPixel(ye,Se),sn=2*_t+1,tn=2*Ct+1,Sn=(function(Xn,wn,pr,zr,yr){return[Xn.getElevationAtPixel(wn,pr,!0),Xn.getElevationAtPixel(wn+yr,pr,!0),Xn.getElevationAtPixel(wn,pr+yr,!0),Xn.getElevationAtPixel(wn+zr,pr+yr,!0)]})(X,It.x-_t,It.y-Ct,sn,tn),$n=Math.abs(Sn[0]-Sn[1]),fn=Math.abs(Sn[2]-Sn[3]),kn=Math.abs(Sn[0]-Sn[2])+Math.abs(Sn[1]-Sn[3]),Rn=Math.min(.25,.5*ct*($n+fn)/sn),Vn=Math.min(.25,.5*ct*kn/tn);return xt+Math.max(Rn*Ke,Vn*at)})(p,x,A):P;return{base:P+(l===0)?-1:l,top:R?Math.max($+h,P+l+2):P+h}}const RC=Tt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:MC}=RC,NC=Tt([{name:"a_packed",components:4,type:"Float32"}]),{members:DC}=NC,FC=Di.types,OC=Math.cos(Math.PI/180*37.5);class H_{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((l=>l.id)),this.index=r.index,this.projection=r.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((l=>{this.gradients[l.id]={}})),this.layoutVertexArray=new Wt,this.layoutVertexArray2=new Cn,this.indexArray=new xr,this.programConfigurations=new ih(r.layers,r.zoom),this.segments=new Pa,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((l=>l.isStateDependent())).map((l=>l.id))}populate(r,l,h,p){this.hasPattern=d("line",this.layers,l);const x=this.layers[0].layout.get("line-sort-key"),w=[];for(const{feature:$,id:X,index:re,sourceLayerIndex:he}of r){const ye=this.layers[0]._featureFilter.needGeometry,Se=Td($,ye);if(!this.layers[0]._featureFilter.filter(new G(this.zoom),Se,h))continue;const Ke=x?x.evaluate(Se,{},h):void 0,at={id:X,properties:$.properties,type:$.type,sourceLayerIndex:he,index:re,geometry:ye?Se.geometry:wu($,h,p),patterns:{},sortKey:Ke};w.push(at)}x&&w.sort((($,X)=>$.sortKey-X.sortKey));const{lineAtlas:A,featureIndex:P}=l,R=this.addConstantDashes(A);for(const $ of w){const{geometry:X,index:re,sourceLayerIndex:he}=$;if(R&&this.addFeatureDashes($,A),this.hasPattern){const ye=g("line",this.layers,$,this.zoom,l);this.patternFeatures.push(ye)}else this.addFeature($,X,re,h,A.positions,l.availableImages);P.insert(r[re].feature,X,re,he,this.index)}}addConstantDashes(r){let l=!1;for(const h of this.layers){const p=h.paint.get("line-dasharray").value,x=h.layout.get("line-cap").value;if(p.kind!=="constant"||x.kind!=="constant")l=!0;else{const w=x.value,A=p.value;if(!A)continue;r.addDash(A,w)}}return l}addFeatureDashes(r,l){const h=this.zoom;for(const p of this.layers){const x=p.paint.get("line-dasharray").value,w=p.layout.get("line-cap").value;if(x.kind==="constant"&&w.kind==="constant")continue;let A,P;if(x.kind==="constant"){if(A=x.value,!A)continue}else A=x.evaluate({zoom:h},r);P=w.kind==="constant"?w.value:w.evaluate({zoom:h},r),l.addDash(A,P),r.patterns[p.id]=l.getKey(A,P)}}update(r,l,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,h,p)}addFeatures(r,l,h,p,x){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,l,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,DC)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,MC),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&r.properties.hasOwnProperty("mapbox_clip_start")&&r.properties.hasOwnProperty("mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,l,h,p,x,w){const A=this.layers[0].layout,P=A.get("line-join").evaluate(r,{}),R=A.get("line-cap").evaluate(r,{}),$=A.get("line-miter-limit"),X=A.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const re of l)this.addLine(re,r,P,R,$,X);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,x,w,p)}addLine(r,l,h,p,x,w){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let at=0;at<r.length-1;at++)this.totalDistance+=r[at].dist(r[at+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const A=FC[l.type]==="Polygon";let P=r.length;for(;P>=2&&r[P-1].equals(r[P-2]);)P--;let R=0;for(;R<P-1&&r[R].equals(r[R+1]);)R++;if(P<(A?3:2))return;h==="bevel"&&(x=1.05);const $=this.overscaling<=16?15*Zr/(512*this.overscaling):0,X=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray);let re,he,ye,Se,Ke;this.e1=this.e2=-1,A&&(re=r[P-2],Ke=r[R].sub(re)._unit()._perp());for(let at=R;at<P;at++){if(ye=at===P-1?A?r[R+1]:void 0:r[at+1],ye&&r[at].equals(ye))continue;Ke&&(Se=Ke),re&&(he=re),re=r[at],Ke=ye?ye.sub(re)._unit()._perp():Se,Se=Se||Ke;let xt=Se.add(Ke);xt.x===0&&xt.y===0||xt._unit();const ct=Se.x*Ke.x+Se.y*Ke.y,_t=xt.x*Ke.x+xt.y*Ke.y,Ct=_t!==0?1/_t:1/0,It=2*Math.sqrt(2-2*_t),sn=_t<OC&&he&&ye,tn=Se.x*Ke.y-Se.y*Ke.x>0;if(sn&&at>R){const fn=re.dist(he);if(fn>2*$){const kn=re.sub(re.sub(he)._mult($/fn)._round());this.updateDistance(he,kn),this.addCurrentVertex(kn,Se,0,0,X),he=kn}}const Sn=he&&ye;let $n=Sn?h:A?"butt":p;if(Sn&&$n==="round"&&(Ct<w?$n="miter":Ct<=2&&($n="fakeround")),$n==="miter"&&Ct>x&&($n="bevel"),$n==="bevel"&&(Ct>2&&($n="flipbevel"),Ct<x&&($n="miter")),he&&this.updateDistance(he,re),$n==="miter")xt._mult(Ct),this.addCurrentVertex(re,xt,0,0,X);else if($n==="flipbevel"){if(Ct>100)xt=Ke.mult(-1);else{const fn=Ct*Se.add(Ke).mag()/Se.sub(Ke).mag();xt._perp()._mult(fn*(tn?-1:1))}this.addCurrentVertex(re,xt,0,0,X),this.addCurrentVertex(re,xt.mult(-1),0,0,X)}else if($n==="bevel"||$n==="fakeround"){const fn=-Math.sqrt(Ct*Ct-1),kn=tn?fn:0,Rn=tn?0:fn;if(he&&this.addCurrentVertex(re,Se,kn,Rn,X),$n==="fakeround"){const Vn=Math.round(180*It/Math.PI/20);for(let Xn=1;Xn<Vn;Xn++){let wn=Xn/Vn;if(wn!==.5){const zr=wn-.5;wn+=wn*zr*(wn-1)*((1.0904+ct*(ct*(3.55645-1.43519*ct)-3.2452))*zr*zr+(.848013+ct*(.215638*ct-1.06021)))}const pr=Ke.sub(Se)._mult(wn)._add(Se)._unit()._mult(tn?-1:1);this.addHalfVertex(re,pr.x,pr.y,!1,tn,0,X)}}ye&&this.addCurrentVertex(re,Ke,-kn,-Rn,X)}else if($n==="butt")this.addCurrentVertex(re,xt,0,0,X);else if($n==="square"){const fn=he?1:-1;he||this.addCurrentVertex(re,xt,fn,fn,X),this.addCurrentVertex(re,xt,0,0,X),he&&this.addCurrentVertex(re,xt,fn,fn,X)}else $n==="round"&&(he&&(this.addCurrentVertex(re,Se,0,0,X),this.addCurrentVertex(re,Se,1,1,X,!0)),ye&&(this.addCurrentVertex(re,Ke,-1,-1,X,!0),this.addCurrentVertex(re,Ke,0,0,X)));if(sn&&at<P-1){const fn=re.dist(ye);if(fn>2*$){const kn=re.add(ye.sub(re)._mult($/fn)._round());this.updateDistance(re,kn),this.addCurrentVertex(kn,Ke,0,0,X),re=kn}}}}addCurrentVertex(r,l,h,p,x,w=!1){const A=l.y*p-l.x,P=-l.y-l.x*p;this.addHalfVertex(r,l.x+l.y*h,l.y-l.x*h,w,!1,h,x),this.addHalfVertex(r,A,P,w,!0,-p,x)}addHalfVertex({x:r,y:l},h,p,x,w,A,P){this.layoutVertexArray.emplaceBack((r<<1)+(x?1:0),(l<<1)+(w?1:0),Math.round(63*h)+128,Math.round(63*p)+128,1+(A===0?0:A<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const R=P.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,R),P.primitiveLength++),w?this.e2=R:this.e1=R}updateScaledDistance(){if(this.lineClips){const r=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=r*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(r,l){this.distance+=r.dist(l),this.updateScaledDistance()}}ur(H_,"LineBucket",{omit:["layers","patternFeatures"]});const BC=new st({"line-cap":new $e(mn.layout_line["line-cap"]),"line-join":new $e(mn.layout_line["line-join"]),"line-miter-limit":new _e(mn.layout_line["line-miter-limit"]),"line-round-limit":new _e(mn.layout_line["line-round-limit"]),"line-sort-key":new $e(mn.layout_line["line-sort-key"])});var e4={paint:new st({"line-opacity":new $e(mn.paint_line["line-opacity"]),"line-color":new $e(mn.paint_line["line-color"]),"line-translate":new _e(mn.paint_line["line-translate"]),"line-translate-anchor":new _e(mn.paint_line["line-translate-anchor"]),"line-width":new $e(mn.paint_line["line-width"]),"line-gap-width":new $e(mn.paint_line["line-gap-width"]),"line-offset":new $e(mn.paint_line["line-offset"]),"line-blur":new $e(mn.paint_line["line-blur"]),"line-dasharray":new $e(mn.paint_line["line-dasharray"]),"line-pattern":new $e(mn.paint_line["line-pattern"]),"line-gradient":new it(mn.paint_line["line-gradient"]),"line-trim-offset":new _e(mn.paint_line["line-trim-offset"])}),layout:BC};const t4=new class extends $e{possiblyEvaluate(s,r){return r=new G(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,transition:r.transition}),super.possiblyEvaluate(s,r)}evaluate(s,r,l,h){return r=Be({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(s,r,l,h)}}(e4.paint.properties["line-width"].specification);function n4(s,r){return r>0?r+2*s:s}t4.useIntegerZoom=!0;const zC=Tt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),jC=Tt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),UC=Tt([{name:"a_projected_pos",components:4,type:"Float32"}],4);Tt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const VC=Tt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),qC=Tt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Tt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const r4=Tt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),$C=Tt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Tt([{name:"triangle",components:3,type:"Uint16"}]),Tt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Tt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Tt([{type:"Float32",name:"offsetX"}]),Tt([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var uu=24;const Hd=128;function Px(s,r){const{expression:l}=r;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new G(s+1))};if(l.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:p}=l;let x=0;for(;x<h.length&&h[x]<=s;)x++;x=Math.max(0,x-1);let w=x;for(;w<h.length&&h[w]<s+1;)w++;w=Math.min(h.length-1,w);const A=h[x],P=h[w];return l.kind==="composite"?{kind:"composite",minZoom:A,maxZoom:P,interpolationType:p}:{kind:"camera",minZoom:A,maxZoom:P,minSize:l.evaluate(new G(A)),maxSize:l.evaluate(new G(P)),interpolationType:p}}}function W_(s,{uSize:r,uSizeT:l},{lowerSize:h,upperSize:p}){return s.kind==="source"?h/Hd:s.kind==="composite"?He(h/Hd,p/Hd,l):r}function Dg(s,r){let l=0,h=0;if(s.kind==="constant")h=s.layoutSize;else if(s.kind!=="source"){const{interpolationType:p,minZoom:x,maxZoom:w}=s,A=p?De(Fa.interpolationFactor(p,r,x,w),0,1):0;s.kind==="camera"?h=He(s.minSize,s.maxSize,A):l=A}return{uSizeT:l,uSize:h}}var GC=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Hd,evaluateSizeForFeature:W_,evaluateSizeForZoom:Dg,getSizeData:Px});function HC(s,r,l){return s.sections.forEach((h=>{h.text=(function(p,x,w){const A=x.layout.get("text-transform").evaluate(w,{});return A==="uppercase"?p=p.toLocaleUpperCase():A==="lowercase"&&(p=p.toLocaleLowerCase()),z.applyArabicShaping&&(p=z.applyArabicShaping(p)),p})(h.text,r,l)})),s}const ly={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function WC(s){return s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""}function KC(s){return s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""}var i4=Js,o4=function(s,r,l,h,p){var x,w,A=8*p-h-1,P=(1<<A)-1,R=P>>1,$=-7,X=p-1,re=-1,he=s[r+X];for(X+=re,x=he&(1<<-$)-1,he>>=-$,$+=A;$>0;x=256*x+s[r+X],X+=re,$-=8);for(w=x&(1<<-$)-1,x>>=-$,$+=h;$>0;w=256*w+s[r+X],X+=re,$-=8);if(x===0)x=1-R;else{if(x===P)return w?NaN:1/0*(he?-1:1);w+=Math.pow(2,h),x-=R}return(he?-1:1)*w*Math.pow(2,x-h)},s4=function(s,r,l,h,p,x){var w,A,P,R=8*x-p-1,$=(1<<R)-1,X=$>>1,re=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,he=0,ye=1,Se=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(A=isNaN(r)?1:0,w=$):(w=Math.floor(Math.log(r)/Math.LN2),r*(P=Math.pow(2,-w))<1&&(w--,P*=2),(r+=w+X>=1?re/P:re*Math.pow(2,1-X))*P>=2&&(w++,P/=2),w+X>=$?(A=0,w=$):w+X>=1?(A=(r*P-1)*Math.pow(2,p),w+=X):(A=r*Math.pow(2,X-1)*Math.pow(2,p),w=0));p>=8;s[l+he]=255&A,he+=ye,A/=256,p-=8);for(w=w<<p|A,R+=p;R>0;s[l+he]=255&w,he+=ye,w/=256,R-=8);s[l+he-ye]|=128*Se};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Js(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}Js.Varint=0,Js.Fixed64=1,Js.Bytes=2,Js.Fixed32=5;var kx=4294967296,a4=1/kx,l4=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function lp(s){return s.type===Js.Bytes?s.readVarint()+s.pos:s.pos+1}function Fg(s,r,l){return l?4294967296*r+(s>>>0):4294967296*(r>>>0)+(s>>>0)}function c4(s,r,l){var h=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));l.realloc(h);for(var p=l.pos-1;p>=s;p--)l.buf[p+h]=l.buf[p]}function XC(s,r){for(var l=0;l<s.length;l++)r.writeVarint(s[l])}function ZC(s,r){for(var l=0;l<s.length;l++)r.writeSVarint(s[l])}function YC(s,r){for(var l=0;l<s.length;l++)r.writeFloat(s[l])}function JC(s,r){for(var l=0;l<s.length;l++)r.writeDouble(s[l])}function QC(s,r){for(var l=0;l<s.length;l++)r.writeBoolean(s[l])}function eL(s,r){for(var l=0;l<s.length;l++)r.writeFixed32(s[l])}function tL(s,r){for(var l=0;l<s.length;l++)r.writeSFixed32(s[l])}function nL(s,r){for(var l=0;l<s.length;l++)r.writeFixed64(s[l])}function rL(s,r){for(var l=0;l<s.length;l++)r.writeSFixed64(s[l])}function K_(s,r){return(s[r]|s[r+1]<<8|s[r+2]<<16)+16777216*s[r+3]}function Og(s,r,l){s[l]=r,s[l+1]=r>>>8,s[l+2]=r>>>16,s[l+3]=r>>>24}function u4(s,r){return(s[r]|s[r+1]<<8|s[r+2]<<16)+(s[r+3]<<24)}Js.prototype={destroy:function(){this.buf=null},readFields:function(s,r,l){for(l=l||this.length;this.pos<l;){var h=this.readVarint(),p=h>>3,x=this.pos;this.type=7&h,s(p,r,this),this.pos===x&&this.skip(h)}return r},readMessage:function(s,r){return this.readFields(s,r,this.readVarint()+this.pos)},readFixed32:function(){var s=K_(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=u4(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=K_(this.buf,this.pos)+K_(this.buf,this.pos+4)*kx;return this.pos+=8,s},readSFixed64:function(){var s=K_(this.buf,this.pos)+u4(this.buf,this.pos+4)*kx;return this.pos+=8,s},readFloat:function(){var s=o4(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=o4(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var r,l,h=this.buf;return r=127&(l=h[this.pos++]),l<128?r:(r|=(127&(l=h[this.pos++]))<<7,l<128?r:(r|=(127&(l=h[this.pos++]))<<14,l<128?r:(r|=(127&(l=h[this.pos++]))<<21,l<128?r:(function(p,x,w){var A,P,R=w.buf;if(A=(112&(P=R[w.pos++]))>>4,P<128||(A|=(127&(P=R[w.pos++]))<<3,P<128)||(A|=(127&(P=R[w.pos++]))<<10,P<128)||(A|=(127&(P=R[w.pos++]))<<17,P<128)||(A|=(127&(P=R[w.pos++]))<<24,P<128)||(A|=(1&(P=R[w.pos++]))<<31,P<128))return Fg(p,A,x);throw new Error("Expected varint not more than 10 bytes")})(r|=(15&(l=h[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var s=this.readVarint()+this.pos,r=this.pos;return this.pos=s,s-r>=12&&l4?(function(l,h,p){return l4.decode(l.subarray(h,p))})(this.buf,r,s):(function(l,h,p){for(var x="",w=h;w<p;){var A,P,R,$=l[w],X=null,re=$>239?4:$>223?3:$>191?2:1;if(w+re>p)break;re===1?$<128&&(X=$):re===2?(192&(A=l[w+1]))==128&&(X=(31&$)<<6|63&A)<=127&&(X=null):re===3?(P=l[w+2],(192&(A=l[w+1]))==128&&(192&P)==128&&((X=(15&$)<<12|(63&A)<<6|63&P)<=2047||X>=55296&&X<=57343)&&(X=null)):re===4&&(P=l[w+2],R=l[w+3],(192&(A=l[w+1]))==128&&(192&P)==128&&(192&R)==128&&((X=(15&$)<<18|(63&A)<<12|(63&P)<<6|63&R)<=65535||X>=1114112)&&(X=null)),X===null?(X=65533,re=1):X>65535&&(X-=65536,x+=String.fromCharCode(X>>>10&1023|55296),X=56320|1023&X),x+=String.fromCharCode(X),w+=re}return x})(this.buf,r,s)},readBytes:function(){var s=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,s);return this.pos=s,r},readPackedVarint:function(s,r){if(this.type!==Js.Bytes)return s.push(this.readVarint(r));var l=lp(this);for(s=s||[];this.pos<l;)s.push(this.readVarint(r));return s},readPackedSVarint:function(s){if(this.type!==Js.Bytes)return s.push(this.readSVarint());var r=lp(this);for(s=s||[];this.pos<r;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==Js.Bytes)return s.push(this.readBoolean());var r=lp(this);for(s=s||[];this.pos<r;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==Js.Bytes)return s.push(this.readFloat());var r=lp(this);for(s=s||[];this.pos<r;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==Js.Bytes)return s.push(this.readDouble());var r=lp(this);for(s=s||[];this.pos<r;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==Js.Bytes)return s.push(this.readFixed32());var r=lp(this);for(s=s||[];this.pos<r;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==Js.Bytes)return s.push(this.readSFixed32());var r=lp(this);for(s=s||[];this.pos<r;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==Js.Bytes)return s.push(this.readFixed64());var r=lp(this);for(s=s||[];this.pos<r;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==Js.Bytes)return s.push(this.readSFixed64());var r=lp(this);for(s=s||[];this.pos<r;)s.push(this.readSFixed64());return s},skip:function(s){var r=7&s;if(r===Js.Varint)for(;this.buf[this.pos++]>127;);else if(r===Js.Bytes)this.pos=this.readVarint()+this.pos;else if(r===Js.Fixed32)this.pos+=4;else{if(r!==Js.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(s,r){this.writeVarint(s<<3|r)},realloc:function(s){for(var r=this.length||16;r<this.pos+s;)r*=2;if(r!==this.length){var l=new Uint8Array(r);l.set(this.buf),this.buf=l,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),Og(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),Og(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),Og(this.buf,-1&s,this.pos),Og(this.buf,Math.floor(s*a4),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),Og(this.buf,-1&s,this.pos),Og(this.buf,Math.floor(s*a4),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?(function(r,l){var h,p;if(r>=0?(h=r%4294967296|0,p=r/4294967296|0):(p=~(-r/4294967296),4294967295^(h=~(-r%4294967296))?h=h+1|0:(h=0,p=p+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),(function(x,w,A){A.buf[A.pos++]=127&x|128,x>>>=7,A.buf[A.pos++]=127&x|128,x>>>=7,A.buf[A.pos++]=127&x|128,x>>>=7,A.buf[A.pos++]=127&x|128,A.buf[A.pos]=127&(x>>>=7)})(h,0,l),(function(x,w){var A=(7&x)<<4;w.buf[w.pos++]|=A|((x>>>=3)?128:0),x&&(w.buf[w.pos++]=127&x|((x>>>=7)?128:0),x&&(w.buf[w.pos++]=127&x|((x>>>=7)?128:0),x&&(w.buf[w.pos++]=127&x|((x>>>=7)?128:0),x&&(w.buf[w.pos++]=127&x|((x>>>=7)?128:0),x&&(w.buf[w.pos++]=127&x)))))})(p,l)})(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(!!s)},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var r=this.pos;this.pos=(function(h,p,x){for(var w,A,P=0;P<p.length;P++){if((w=p.charCodeAt(P))>55295&&w<57344){if(!A){w>56319||P+1===p.length?(h[x++]=239,h[x++]=191,h[x++]=189):A=w;continue}if(w<56320){h[x++]=239,h[x++]=191,h[x++]=189,A=w;continue}w=A-55296<<10|w-56320|65536,A=null}else A&&(h[x++]=239,h[x++]=191,h[x++]=189,A=null);w<128?h[x++]=w:(w<2048?h[x++]=w>>6|192:(w<65536?h[x++]=w>>12|224:(h[x++]=w>>18|240,h[x++]=w>>12&63|128),h[x++]=w>>6&63|128),h[x++]=63&w|128)}return x})(this.buf,s,this.pos);var l=this.pos-r;l>=128&&c4(r,l,this),this.pos=r-1,this.writeVarint(l),this.pos+=l},writeFloat:function(s){this.realloc(4),s4(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),s4(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var r=s.length;this.writeVarint(r),this.realloc(r);for(var l=0;l<r;l++)this.buf[this.pos++]=s[l]},writeRawMessage:function(s,r){this.pos++;var l=this.pos;s(r,this);var h=this.pos-l;h>=128&&c4(l,h,this),this.pos=l-1,this.writeVarint(h),this.pos+=h},writeMessage:function(s,r,l){this.writeTag(s,Js.Bytes),this.writeRawMessage(r,l)},writePackedVarint:function(s,r){r.length&&this.writeMessage(s,XC,r)},writePackedSVarint:function(s,r){r.length&&this.writeMessage(s,ZC,r)},writePackedBoolean:function(s,r){r.length&&this.writeMessage(s,QC,r)},writePackedFloat:function(s,r){r.length&&this.writeMessage(s,YC,r)},writePackedDouble:function(s,r){r.length&&this.writeMessage(s,JC,r)},writePackedFixed32:function(s,r){r.length&&this.writeMessage(s,eL,r)},writePackedSFixed32:function(s,r){r.length&&this.writeMessage(s,tL,r)},writePackedFixed64:function(s,r){r.length&&this.writeMessage(s,nL,r)},writePackedSFixed64:function(s,r){r.length&&this.writeMessage(s,rL,r)},writeBytesField:function(s,r){this.writeTag(s,Js.Bytes),this.writeBytes(r)},writeFixed32Field:function(s,r){this.writeTag(s,Js.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(s,r){this.writeTag(s,Js.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(s,r){this.writeTag(s,Js.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(s,r){this.writeTag(s,Js.Fixed64),this.writeSFixed64(r)},writeVarintField:function(s,r){this.writeTag(s,Js.Varint),this.writeVarint(r)},writeSVarintField:function(s,r){this.writeTag(s,Js.Varint),this.writeSVarint(r)},writeStringField:function(s,r){this.writeTag(s,Js.Bytes),this.writeString(r)},writeFloatField:function(s,r){this.writeTag(s,Js.Fixed32),this.writeFloat(r)},writeDoubleField:function(s,r){this.writeTag(s,Js.Fixed64),this.writeDouble(r)},writeBooleanField:function(s,r){this.writeVarintField(s,!!r)}};var X_=ue(i4);const Rx=3;function iL(s,r,l){r.glyphs=[],s===1&&l.readMessage(oL,r)}function oL(s,r,l){if(s===3){const{id:h,bitmap:p,width:x,height:w,left:A,top:P,advance:R}=l.readMessage(sL,{});r.glyphs.push({id:h,bitmap:new oh({width:x+2*Rx,height:w+2*Rx},p),metrics:{width:x,height:w,left:A,top:P,advance:R}})}else s===4?r.ascender=l.readSVarint():s===5&&(r.descender=l.readSVarint())}function sL(s,r,l){s===1?r.id=l.readVarint():s===2?r.bitmap=l.readBytes():s===3?r.width=l.readVarint():s===4?r.height=l.readVarint():s===5?r.left=l.readSVarint():s===6?r.top=l.readSVarint():s===7&&(r.advance=l.readVarint())}const h4=Rx;function Mx(s){let r=0,l=0;for(const w of s)r+=w.w*w.h,l=Math.max(l,w.w);s.sort(((w,A)=>A.h-w.h));const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),l),h:1/0}];let p=0,x=0;for(const w of s)for(let A=h.length-1;A>=0;A--){const P=h[A];if(!(w.w>P.w||w.h>P.h)){if(w.x=P.x,w.y=P.y,x=Math.max(x,w.y+w.h),p=Math.max(p,w.x+w.w),w.w===P.w&&w.h===P.h){const R=h.pop();A<h.length&&(h[A]=R)}else w.h===P.h?(P.x+=w.w,P.w-=w.w):w.w===P.w?(P.y+=w.h,P.h-=w.h):(h.push({x:P.x+w.w,y:P.y,w:P.w-w.w,h:w.h}),P.y+=w.h,P.h-=w.h);break}}return{w:p,h:x,fill:r/(p*x)||0}}const Th=1;class Nx{constructor(r,{pixelRatio:l,version:h,stretchX:p,stretchY:x,content:w}){this.paddedRect=r,this.pixelRatio=l,this.stretchX=p,this.stretchY=x,this.content=w,this.version=h}get tl(){return[this.paddedRect.x+Th,this.paddedRect.y+Th]}get br(){return[this.paddedRect.x+this.paddedRect.w-Th,this.paddedRect.y+this.paddedRect.h-Th]}get displaySize(){return[(this.paddedRect.w-2*Th)/this.pixelRatio,(this.paddedRect.h-2*Th)/this.pixelRatio]}}class d4{constructor(r,l){const h={},p={};this.haveRenderCallbacks=[];const x=[];this.addImages(r,h,x),this.addImages(l,p,x);const{w,h:A}=Mx(x),P=new Vu({width:w||1,height:A||1});for(const R in r){const $=r[R],X=h[R].paddedRect;Vu.copy($.data,P,{x:0,y:0},{x:X.x+Th,y:X.y+Th},$.data)}for(const R in l){const $=l[R],X=p[R].paddedRect,re=X.x+Th,he=X.y+Th,ye=$.data.width,Se=$.data.height;Vu.copy($.data,P,{x:0,y:0},{x:re,y:he},$.data),Vu.copy($.data,P,{x:0,y:Se-1},{x:re,y:he-1},{width:ye,height:1}),Vu.copy($.data,P,{x:0,y:0},{x:re,y:he+Se},{width:ye,height:1}),Vu.copy($.data,P,{x:ye-1,y:0},{x:re-1,y:he},{width:1,height:Se}),Vu.copy($.data,P,{x:0,y:0},{x:re+ye,y:he},{width:1,height:Se})}this.image=P,this.iconPositions=h,this.patternPositions=p}addImages(r,l,h){for(const p in r){const x=r[p],w={x:0,y:0,w:x.data.width+2*Th,h:x.data.height+2*Th};h.push(w),l[p]=new Nx(w,x),x.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(r,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((h=>r.hasImage(h))),r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const h in r.updatedImages)this.patchUpdatedImage(this.iconPositions[h],r.getImage(h),l),this.patchUpdatedImage(this.patternPositions[h],r.getImage(h),l)}patchUpdatedImage(r,l,h){if(!r||!l||r.version===l.version)return;r.version=l.version;const[p,x]=r.tl;h.update(l.data,void 0,{x:p,y:x})}}ur(Nx,"ImagePosition"),ur(d4,"ImageAtlas");const ld={horizontal:1,vertical:2,horizontalOnly:3},f4=-17;class cy{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,l){const h=new cy;return h.scale=r||1,h.fontStack=l,h}static forImage(r){const l=new cy;return l.imageName=r,l}}class Bg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,l){const h=new Bg;for(let p=0;p<r.sections.length;p++){const x=r.sections[p];x.image?h.addImageSection(x):h.addTextSection(x,l)}return h}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(r){this.text=(function(l,h){let p="";for(let x=0;x<l.length;x++){const w=l.charCodeAt(x+1)||null,A=l.charCodeAt(x-1)||null;p+=!h&&(w&&nt(w)&&!ly[l[x+1]]||A&&nt(A)&&!ly[l[x-1]])||!ly[l[x]]?l[x]:ly[l[x]]}return p})(this.text,r)}trim(){let r=0;for(let h=0;h<this.text.length&&Z_[this.text.charCodeAt(h)];h++)r++;let l=this.text.length;for(let h=this.text.length-1;h>=0&&h>=r&&Z_[this.text.charCodeAt(h)];h--)l--;this.text=this.text.substring(r,l),this.sectionIndex=this.sectionIndex.slice(r,l)}substring(r,l){const h=new Bg;return h.text=this.text.substring(r,l),h.sectionIndex=this.sectionIndex.slice(r,l),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((r,l)=>Math.max(r,this.sections[l].scale)),0)}addTextSection(r,l){this.text+=r.text,this.sections.push(cy.forText(r.scale,r.fontStack||l));const h=this.sections.length-1;for(let p=0;p<r.text.length;++p)this.sectionIndex.push(h)}addImageSection(r){const l=r.image?r.image.name:"";if(l.length===0)return void dr("Can't add FormattedSection with an empty image.");const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCharCode(h),this.sections.push(cy.forImage(l)),this.sectionIndex.push(this.sections.length-1)):dr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Dx(s,r,l,h,p,x,w,A,P,R,$,X,re,he,ye){const Se=Bg.fromFeature(s,p);X===ld.vertical&&Se.verticalizePunctuation(re);let Ke=[];const at=(function(It,sn,tn,Sn,$n,fn){if(!It)return[];const kn=[],Rn=(function(pr,zr,yr,Ki,Zn,ti){let Xi=0;for(let is=0;is<pr.length();is++){const Zi=pr.getSection(is);Xi+=p4(pr.getCharCode(is),Zi,Ki,Zn,zr,ti)}return Xi/Math.max(1,Math.ceil(Xi/yr))})(It,sn,tn,Sn,$n,fn),Vn=It.text.indexOf("")>=0;let Xn=0;for(let pr=0;pr<It.length();pr++){const zr=It.getSection(pr),yr=It.getCharCode(pr);if(Z_[yr]||(Xn+=p4(yr,zr,Sn,$n,sn,fn)),pr<It.length()-1){const Ki=!((wn=yr)<11904||!(oe["Bopomofo Extended"](wn)||oe.Bopomofo(wn)||oe["CJK Compatibility Forms"](wn)||oe["CJK Compatibility Ideographs"](wn)||oe["CJK Compatibility"](wn)||oe["CJK Radicals Supplement"](wn)||oe["CJK Strokes"](wn)||oe["CJK Symbols and Punctuation"](wn)||oe["CJK Unified Ideographs Extension A"](wn)||oe["CJK Unified Ideographs"](wn)||oe["Enclosed CJK Letters and Months"](wn)||oe["Halfwidth and Fullwidth Forms"](wn)||oe.Hiragana(wn)||oe["Ideographic Description Characters"](wn)||oe["Kangxi Radicals"](wn)||oe["Katakana Phonetic Extensions"](wn)||oe.Katakana(wn)||oe["Vertical Forms"](wn)||oe["Yi Radicals"](wn)||oe["Yi Syllables"](wn)));(aL[yr]||Ki||zr.imageName)&&kn.push(g4(pr+1,Xn,Rn,kn,lL(yr,It.getCharCode(pr+1),Ki&&Vn),!1))}}var wn;return y4(g4(It.length(),Xn,Rn,kn,0,!0))})(Se,R,x,r,h,he),{processBidirectionalText:xt,processStyledBidirectionalText:ct}=z;if(xt&&Se.sections.length===1){const It=xt(Se.toString(),at);for(const sn of It){const tn=new Bg;tn.text=sn,tn.sections=Se.sections;for(let Sn=0;Sn<sn.length;Sn++)tn.sectionIndex.push(0);Ke.push(tn)}}else if(ct){const It=ct(Se.text,Se.sectionIndex,at);for(const sn of It){const tn=new Bg;tn.text=sn[0],tn.sectionIndex=sn[1],tn.sections=Se.sections,Ke.push(tn)}}else Ke=(function(It,sn){const tn=[],Sn=It.text;let $n=0;for(const fn of sn)tn.push(It.substring($n,fn)),$n=fn;return $n<Sn.length&&tn.push(It.substring($n,Sn.length)),tn})(Se,at);const _t=[],Ct={positionedLines:_t,text:Se.toString(),top:$[1],bottom:$[1],left:$[0],right:$[0],writingMode:X,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return(function(It,sn,tn,Sn,$n,fn,kn,Rn,Vn,Xn,wn,pr){let zr=0,yr=0,Ki=0;const Zn=Rn==="right"?1:Rn==="left"?0:.5;let ti=!1;for(const Ji of $n){const Qi=Ji.getSections();for(const Fs of Qi){if(Fs.imageName)continue;const Qs=sn[Fs.fontStack];if(Qs&&(ti=Qs.ascender!==void 0&&Qs.descender!==void 0,!ti))break}if(!ti)break}let Xi=0;for(const Ji of $n){Ji.trim();const Qi=Ji.getMaxScale(),Fs=(Qi-1)*uu,Qs={positionedGlyphs:[],lineOffset:0};It.positionedLines[Xi]=Qs;const ea=Qs.positionedGlyphs;let Os=0;if(!Ji.length()){yr+=fn,++Xi;continue}let qa=0,_l=0;for(let Bs=0;Bs<Ji.length();Bs++){const mc=Ji.getSection(Bs),Zl=Ji.getSectionIndex(Bs),al=Ji.getCharCode(Bs);let cs=mc.scale,Yl=null,ta=null,ah=null,Jl=uu,hu=0;const Hc=!(Vn===ld.horizontal||!wn&&!Je(al)||wn&&(Z_[al]||(is=al,oe.Arabic(is)||oe["Arabic Supplement"](is)||oe["Arabic Extended-A"](is)||oe["Arabic Presentation Forms-A"](is)||oe["Arabic Presentation Forms-B"](is))));if(mc.imageName){const lh=Sn[mc.imageName];if(!lh)continue;ah=mc.imageName,It.iconsInText=It.iconsInText||!0,ta=lh.paddedRect;const Wc=lh.displaySize;cs=cs*uu/pr,Yl={width:Wc[0],height:Wc[1],left:Th,top:-h4,advance:Hc?Wc[1]:Wc[0],localGlyph:!1},hu=ti?-Yl.height*cs:f4+Qi*uu-Wc[1]*cs,Jl=Yl.advance;const Xd=(Hc?Wc[0]:Wc[1])*cs-uu*Qi;Xd>0&&Xd>Os&&(Os=Xd)}else{const lh=tn[mc.fontStack];if(!lh)continue;lh[al]&&(ta=lh[al]);const Wc=sn[mc.fontStack];if(!Wc)continue;const Xd=Wc.glyphs[al];if(!Xd)continue;if(Yl=Xd.metrics,Jl=al!==8203?uu:0,ti){const Gg=Wc.ascender!==void 0?Math.abs(Wc.ascender):0,vy=Wc.descender!==void 0?Math.abs(Wc.descender):0,xy=(Gg+vy)*cs;qa<xy&&(qa=xy,_l=(Gg-vy)/2*cs),hu=-Gg*cs}else hu=f4+(Qi-cs)*uu}Hc?(It.verticalizable=!0,ea.push({glyph:al,imageName:ah,x:zr,y:yr+hu,vertical:Hc,scale:cs,localGlyph:Yl.localGlyph,fontStack:mc.fontStack,sectionIndex:Zl,metrics:Yl,rect:ta}),zr+=Jl*cs+Xn):(ea.push({glyph:al,imageName:ah,x:zr,y:yr+hu,vertical:Hc,scale:cs,localGlyph:Yl.localGlyph,fontStack:mc.fontStack,sectionIndex:Zl,metrics:Yl,rect:ta}),zr+=Yl.advance*cs+Xn)}ea.length!==0&&(Ki=Math.max(zr-Xn,Ki),ti?_4(ea,Zn,Os,_l,fn*Qi/2):_4(ea,Zn,Os,0,fn/2)),zr=0;const Xl=fn*Qi+Os;Qs.lineOffset=Math.max(Os,Fs),yr+=Xl,++Xi}var is;const Zi=yr,{horizontalAlign:bi,verticalAlign:fa}=Fx(kn);(function(Ji,Qi,Fs,Qs,ea,Os){const qa=(Qi-Fs)*ea,_l=-Os*Qs;for(const Xl of Ji)for(const Bs of Xl.positionedGlyphs)Bs.x+=qa,Bs.y+=_l})(It.positionedLines,Zn,bi,fa,Ki,Zi),It.top+=-fa*Zi,It.bottom=It.top+Zi,It.left+=-bi*Ki,It.right=It.left+Ki,It.hasBaseline=ti})(Ct,r,l,h,Ke,w,A,P,X,R,re,ye),!(function(It){for(const sn of It)if(sn.positionedGlyphs.length!==0)return!1;return!0})(_t)&&Ct}const Z_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},aL={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function p4(s,r,l,h,p,x){if(r.imageName){const w=h[r.imageName];return w?w.displaySize[0]*r.scale*uu/x+p:0}{const w=l[r.fontStack],A=w&&w.glyphs[s];return A?A.metrics.advance*r.scale+p:0}}function m4(s,r,l,h){const p=Math.pow(s-r,2);return h?s<r?p/2:2*p:p+Math.abs(l)*l}function lL(s,r,l){let h=0;return s===10&&(h-=1e4),l&&(h+=150),s!==40&&s!==65288||(h+=50),r!==41&&r!==65289||(h+=50),h}function g4(s,r,l,h,p,x){let w=null,A=m4(r,l,p,x);for(const P of h){const R=m4(r-P.x,l,p,x)+P.badness;R<=A&&(w=P,A=R)}return{index:s,x:r,priorBreak:w,badness:A}}function y4(s){return s?y4(s.priorBreak).concat(s.index):[]}function Fx(s){let r=.5,l=.5;switch(s){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:r,verticalAlign:l}}function _4(s,r,l,h,p){if(!(r||l||h||p))return;const x=s.length-1,w=s[x],A=(w.x+w.metrics.advance*w.scale)*r;for(let P=0;P<=x;P++)s[P].x-=A,s[P].y+=l+h+p}function cL(s,r,l){const{horizontalAlign:h,verticalAlign:p}=Fx(l),x=r[0]-s.displaySize[0]*h,w=r[1]-s.displaySize[1]*p;return{image:s,top:w,bottom:w+s.displaySize[1],left:x,right:x+s.displaySize[0]}}function v4(s,r,l,h,p,x){const w=s.image;let A;if(w.content){const Ke=w.content,at=w.pixelRatio||1;A=[Ke[0]/at,Ke[1]/at,w.displaySize[0]-Ke[2]/at,w.displaySize[1]-Ke[3]/at]}const P=r.left*x,R=r.right*x;let $,X,re,he;l==="width"||l==="both"?(he=p[0]+P-h[3],X=p[0]+R+h[1]):(he=p[0]+(P+R-w.displaySize[0])/2,X=he+w.displaySize[0]);const ye=r.top*x,Se=r.bottom*x;return l==="height"||l==="both"?($=p[1]+ye-h[0],re=p[1]+Se+h[2]):($=p[1]+(ye+Se-w.displaySize[1])/2,re=$+w.displaySize[1]),{image:w,top:$,right:X,bottom:re,left:he,collisionPadding:A}}class cp extends q{constructor(r,l,h,p,x){super(r,l),this.angle=p,this.z=h,x!==void 0&&(this.segment=x)}clone(){return new cp(this.x,this.y,this.z,this.angle,this.segment)}}function x4(s,r,l,h,p){if(r.segment===void 0)return!0;let x=r,w=r.segment+1,A=0;for(;A>-l/2;){if(w--,w<0)return!1;A-=s[w].dist(x),x=s[w]}A+=s[w].dist(s[w+1]),w++;const P=[];let R=0;for(;A<l/2;){const $=s[w],X=s[w+1];if(!X)return!1;let re=s[w-1].angleTo($)-$.angleTo(X);for(re=Math.abs((re+3*Math.PI)%(2*Math.PI)-Math.PI),P.push({distance:A,angleDelta:re}),R+=re;A-P[0].distance>h;)R-=P.shift().angleDelta;if(R>p)return!1;w++,A+=$.dist(X)}return!0}function b4(s){let r=0;for(let l=0;l<s.length-1;l++)r+=s[l].dist(s[l+1]);return r}function w4(s,r,l){return s?.6*r*l:0}function S4(s,r){return Math.max(s?s.right-s.left:0,r?r.right-r.left:0)}function uL(s,r,l,h,p,x){const w=w4(l,p,x),A=S4(l,h)*x;let P=0;const R=b4(s)/2;for(let $=0;$<s.length-1;$++){const X=s[$],re=s[$+1],he=X.dist(re);if(P+he>R){const ye=(R-P)/he,Se=He(X.x,re.x,ye),Ke=He(X.y,re.y,ye),at=new cp(Se,Ke,0,re.angleTo(X),$);return!w||x4(s,at,A,w,r)?at:void 0}P+=he}}function hL(s,r,l,h,p,x,w,A,P){const R=w4(h,x,w),$=S4(h,p),X=$*w,re=s[0].x===0||s[0].x===P||s[0].y===0||s[0].y===P;return r-X<r/4&&(r=X+r/4),E4(s,re?r/2*A%r:($/2+2*x)*w*A%r,r,R,l,X,re,!1,P)}function E4(s,r,l,h,p,x,w,A,P){const R=x/2,$=b4(s);let X=0,re=r-l,he=[];for(let ye=0;ye<s.length-1;ye++){const Se=s[ye],Ke=s[ye+1],at=Se.dist(Ke),xt=Ke.angleTo(Se);for(;re+l<X+at;){re+=l;const ct=(re-X)/at,_t=He(Se.x,Ke.x,ct),Ct=He(Se.y,Ke.y,ct);if(_t>=0&&_t<P&&Ct>=0&&Ct<P&&re-R>=0&&re+R<=$){const It=new cp(_t,Ct,0,xt,ye);It._round(),h&&!x4(s,It,x,h,p)||he.push(It)}}X+=at}return A||he.length||w||(he=E4(s,X/2,l,h,p,x,w,!0,P)),he}function A4(s,r,l,h,p){const x=[];for(let w=0;w<s.length;w++){const A=s[w];let P;for(let R=0;R<A.length-1;R++){let $=A[R],X=A[R+1];$.x<r&&X.x<r||($.x<r?$=new q(r,$.y+(r-$.x)/(X.x-$.x)*(X.y-$.y))._round():X.x<r&&(X=new q(r,$.y+(r-$.x)/(X.x-$.x)*(X.y-$.y))._round()),$.y<l&&X.y<l||($.y<l?$=new q($.x+(l-$.y)/(X.y-$.y)*(X.x-$.x),l)._round():X.y<l&&(X=new q($.x+(l-$.y)/(X.y-$.y)*(X.x-$.x),l)._round()),$.x>=h&&X.x>=h||($.x>=h?$=new q(h,$.y+(h-$.x)/(X.x-$.x)*(X.y-$.y))._round():X.x>=h&&(X=new q(h,$.y+(h-$.x)/(X.x-$.x)*(X.y-$.y))._round()),$.y>=p&&X.y>=p||($.y>=p?$=new q($.x+(p-$.y)/(X.y-$.y)*(X.x-$.x),p)._round():X.y>=p&&(X=new q($.x+(p-$.y)/(X.y-$.y)*(X.x-$.x),p)._round()),P&&$.equals(P[P.length-1])||(P=[$],x.push(P)),P.push(X)))))}}return x}ur(cp,"Anchor");const uy=1e20;function T4(s,r,l,h,p,x,w,A,P){for(let R=r;R<r+h;R++)I4(s,l*x+R,x,p,w,A,P);for(let R=l;R<l+p;R++)I4(s,R*x+r,1,h,w,A,P)}function I4(s,r,l,h,p,x,w){x[0]=0,w[0]=-uy,w[1]=uy,p[0]=s[r];for(let A=1,P=0,R=0;A<h;A++){p[A]=s[r+A*l];const $=A*A;do{const X=x[P];R=(p[A]-p[X]+$-X*X)/(A-X)/2}while(R<=w[P]&&--P>-1);P++,x[P]=A,w[P]=R,w[P+1]=uy}for(let A=0,P=0;A<h;A++){for(;w[P+1]<A;)P++;const R=x[P],$=A-R;s[r+A*l]=p[R]+$*$}}const Wd=2,Ox={none:0,ideographs:1,all:2};class zg{constructor(r,l,h){this.requestManager=r,this.localGlyphMode=l,this.localFontFamily=h,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r){this.url=r}getGlyphs(r,l){const h=[];for(const p in r)for(const x of r[p])h.push({stack:p,id:x});le(h,(({stack:p,id:x},w)=>{let A=this.entries[p];A||(A=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let P=A.glyphs[x];if(P!==void 0)return void w(null,{stack:p,id:x,glyph:P});if(P=this._tinySDF(A,p,x),P)return A.glyphs[x]=P,void w(null,{stack:p,id:x,glyph:P});const R=Math.floor(x/256);if(256*R>65535)return void w(new Error("glyphs > 65535 not supported"));if(A.ranges[R])return void w(null,{stack:p,id:x,glyph:P});let $=A.requests[R];$||($=A.requests[R]=[],zg.loadGlyphRange(p,R,this.url,this.requestManager,((X,re)=>{if(re){A.ascender=re.ascender,A.descender=re.descender;for(const he in re.glyphs)this._doesCharSupportLocalGlyph(+he)||(A.glyphs[+he]=re.glyphs[+he]);A.ranges[R]=!0}for(const he of $)he(X,re);delete A.requests[R]}))),$.push(((X,re)=>{X?w(X):re&&w(null,{stack:p,id:x,glyph:re.glyphs[x]||null})}))}),((p,x)=>{if(p)l(p);else if(x){const w={};for(const{stack:A,id:P,glyph:R}of x)w[A]===void 0&&(w[A]={}),w[A].glyphs===void 0&&(w[A].glyphs={}),w[A].glyphs[P]=R&&{id:R.id,bitmap:R.bitmap.clone(),metrics:R.metrics},w[A].ascender=this.entries[A].ascender,w[A].descender=this.entries[A].descender;l(null,w)}}))}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==Ox.none&&(this.localGlyphMode===Ox.all?!!this.localFontFamily:!!this.localFontFamily&&(oe["CJK Unified Ideographs"](r)||oe["Hangul Syllables"](r)||oe.Hiragana(r)||oe.Katakana(r)||oe["CJK Symbols and Punctuation"](r)))}_tinySDF(r,l,h){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(h))return;let x=r.tinySDF;if(!x){let Se="400";/bold/i.test(l)?Se="900":/medium/i.test(l)?Se="500":/light/i.test(l)&&(Se="200"),x=r.tinySDF=new zg.TinySDF({fontFamily:p,fontWeight:Se,fontSize:24*Wd,buffer:3*Wd,radius:8*Wd}),x.fontWeight=Se}if(this.localGlyphs[x.fontWeight][h])return this.localGlyphs[x.fontWeight][h];const w=String.fromCharCode(h),{data:A,width:P,height:R,glyphWidth:$,glyphHeight:X,glyphLeft:re,glyphTop:he,glyphAdvance:ye}=x.draw(w);return this.localGlyphs[x.fontWeight][h]={id:h,bitmap:new oh({width:P,height:R},A),metrics:{width:$/Wd,height:X/Wd,left:re/Wd,top:he/Wd-27,advance:ye/Wd,localGlyph:!0}}}}zg.loadGlyphRange=function(s,r,l,h,p){const x=256*r,w=x+255,A=h.transformRequest(h.normalizeGlyphsURL(l).replace("{fontstack}",s).replace("{range}",`${x}-${w}`),or.Glyphs);hi(A,((P,R)=>{if(P)p(P);else if(R){const $={},X=(function(re){return new X_(re).readFields(iL,{})})(R);for(const re of X.glyphs)$[re.id]=re;p(null,{glyphs:$,ascender:X.ascender,descender:X.descender})}}))},zg.TinySDF=class{constructor({fontSize:s=24,buffer:r=3,radius:l=8,cutoff:h=.25,fontFamily:p="sans-serif",fontWeight:x="normal",fontStyle:w="normal"}={}){this.buffer=r,this.cutoff=h,this.radius=l;const A=this.size=s+4*r,P=this._createCanvas(A),R=this.ctx=P.getContext("2d",{willReadFrequently:!0});R.font=`${w} ${x} ${s}px ${p}`,R.textBaseline="alphabetic",R.textAlign="left",R.fillStyle="black",this.gridOuter=new Float64Array(A*A),this.gridInner=new Float64Array(A*A),this.f=new Float64Array(A),this.z=new Float64Array(A+1),this.v=new Uint16Array(A)}_createCanvas(s){const r=document.createElement("canvas");return r.width=r.height=s,r}draw(s){const{width:r,actualBoundingBoxAscent:l,actualBoundingBoxDescent:h,actualBoundingBoxLeft:p,actualBoundingBoxRight:x}=this.ctx.measureText(s),w=Math.ceil(l),A=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(x-p))),P=Math.min(this.size-this.buffer,w+Math.ceil(h)),R=A+2*this.buffer,$=P+2*this.buffer,X=Math.max(R*$,0),re=new Uint8ClampedArray(X),he={data:re,width:R,height:$,glyphWidth:A,glyphHeight:P,glyphTop:w,glyphLeft:0,glyphAdvance:r};if(A===0||P===0)return he;const{ctx:ye,buffer:Se,gridInner:Ke,gridOuter:at}=this;ye.clearRect(Se,Se,A,P),ye.fillText(s,Se,Se+w);const xt=ye.getImageData(Se,Se,A,P);at.fill(uy,0,X),Ke.fill(0,0,X);for(let ct=0;ct<P;ct++)for(let _t=0;_t<A;_t++){const Ct=xt.data[4*(ct*A+_t)+3]/255;if(Ct===0)continue;const It=(ct+Se)*R+_t+Se;if(Ct===1)at[It]=0,Ke[It]=uy;else{const sn=.5-Ct;at[It]=sn>0?sn*sn:0,Ke[It]=sn<0?sn*sn:0}}T4(at,0,0,R,$,R,this.f,this.v,this.z),T4(Ke,Se,Se,A,P,R,this.f,this.v,this.z);for(let ct=0;ct<X;ct++){const _t=Math.sqrt(at[ct])-Math.sqrt(Ke[ct]);re[ct]=Math.round(255-255*(_t/this.radius+this.cutoff))}return he}};const jg=Th;function C4(s,r,l,h){const p=[],x=s.image,w=x.pixelRatio,A=x.paddedRect.w-2*jg,P=x.paddedRect.h-2*jg,R=s.right-s.left,$=s.bottom-s.top,X=x.stretchX||[[0,A]],re=x.stretchY||[[0,P]],he=(fn,kn)=>fn+kn[1]-kn[0],ye=X.reduce(he,0),Se=re.reduce(he,0),Ke=A-ye,at=P-Se;let xt=0,ct=ye,_t=0,Ct=Se,It=0,sn=Ke,tn=0,Sn=at;if(x.content&&h){const fn=x.content;xt=Y_(X,0,fn[0]),_t=Y_(re,0,fn[1]),ct=Y_(X,fn[0],fn[2]),Ct=Y_(re,fn[1],fn[3]),It=fn[0]-xt,tn=fn[1]-_t,sn=fn[2]-fn[0]-ct,Sn=fn[3]-fn[1]-Ct}const $n=(fn,kn,Rn,Vn)=>{const Xn=J_(fn.stretch-xt,ct,R,s.left),wn=Q_(fn.fixed-It,sn,fn.stretch,ye),pr=J_(kn.stretch-_t,Ct,$,s.top),zr=Q_(kn.fixed-tn,Sn,kn.stretch,Se),yr=J_(Rn.stretch-xt,ct,R,s.left),Ki=Q_(Rn.fixed-It,sn,Rn.stretch,ye),Zn=J_(Vn.stretch-_t,Ct,$,s.top),ti=Q_(Vn.fixed-tn,Sn,Vn.stretch,Se),Xi=new q(Xn,pr),is=new q(yr,pr),Zi=new q(yr,Zn),bi=new q(Xn,Zn),fa=new q(wn/w,zr/w),Ji=new q(Ki/w,ti/w),Qi=r*Math.PI/180;if(Qi){const ea=Math.sin(Qi),Os=Math.cos(Qi),qa=[Os,-ea,ea,Os];Xi._matMult(qa),is._matMult(qa),bi._matMult(qa),Zi._matMult(qa)}const Fs=fn.stretch+fn.fixed,Qs=kn.stretch+kn.fixed;return{tl:Xi,tr:is,bl:bi,br:Zi,tex:{x:x.paddedRect.x+jg+Fs,y:x.paddedRect.y+jg+Qs,w:Rn.stretch+Rn.fixed-Fs,h:Vn.stretch+Vn.fixed-Qs},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:fa,pixelOffsetBR:Ji,minFontScaleX:sn/w/R,minFontScaleY:Sn/w/$,isSDF:l}};if(h&&(x.stretchX||x.stretchY)){const fn=L4(X,Ke,ye),kn=L4(re,at,Se);for(let Rn=0;Rn<fn.length-1;Rn++){const Vn=fn[Rn],Xn=fn[Rn+1];for(let wn=0;wn<kn.length-1;wn++)p.push($n(Vn,kn[wn],Xn,kn[wn+1]))}}else p.push($n({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:A+1},{fixed:0,stretch:P+1}));return p}function Y_(s,r,l){let h=0;for(const p of s)h+=Math.max(r,Math.min(l,p[1]))-Math.max(r,Math.min(l,p[0]));return h}function L4(s,r,l){const h=[{fixed:-jg,stretch:0}];for(const[p,x]of s){const w=h[h.length-1];h.push({fixed:p-w.stretch,stretch:w.stretch}),h.push({fixed:p-w.stretch,stretch:w.stretch+(x-p)})}return h.push({fixed:r+jg,stretch:l}),h}function J_(s,r,l,h){return s/r*l+h}function Q_(s,r,l,h){return s-r*l/h}function dL(s,r,l,h){const p=r+s.positionedLines[h].lineOffset;return h===0?l+p/2:l+(p+(r+s.positionedLines[h-1].lineOffset))/2}class fL{constructor(r=[],l=pL){if(this.data=r,this.length=this.data.length,this.compare=l,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const r=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:l,compare:h}=this,p=l[r];for(;r>0;){const x=r-1>>1,w=l[x];if(h(p,w)>=0)break;l[r]=w,r=x}l[r]=p}_down(r){const{data:l,compare:h}=this,p=this.length>>1,x=l[r];for(;r<p;){let w=1+(r<<1),A=l[w];const P=w+1;if(P<this.length&&h(l[P],A)<0&&(w=P,A=l[P]),h(A,x)>=0)break;l[r]=A,r=w}l[r]=x}}function pL(s,r){return s<r?-1:s>r?1:0}function mL(s,r=1,l=!1){let h=1/0,p=1/0,x=-1/0,w=-1/0;const A=s[0];for(let he=0;he<A.length;he++){const ye=A[he];(!he||ye.x<h)&&(h=ye.x),(!he||ye.y<p)&&(p=ye.y),(!he||ye.x>x)&&(x=ye.x),(!he||ye.y>w)&&(w=ye.y)}const P=Math.min(x-h,w-p);let R=P/2;const $=new fL([],gL);if(P===0)return new q(h,p);for(let he=h;he<x;he+=P)for(let ye=p;ye<w;ye+=P)$.push(new Ug(he+R,ye+R,R,s));let X=(function(he){let ye=0,Se=0,Ke=0;const at=he[0];for(let xt=0,ct=at.length,_t=ct-1;xt<ct;_t=xt++){const Ct=at[xt],It=at[_t],sn=Ct.x*It.y-It.x*Ct.y;Se+=(Ct.x+It.x)*sn,Ke+=(Ct.y+It.y)*sn,ye+=3*sn}return new Ug(Se/ye,Ke/ye,0,he)})(s),re=$.length;for(;$.length;){const he=$.pop();(he.d>X.d||!X.d)&&(X=he,l&&console.log("found best %d after %d probes",Math.round(1e4*he.d)/1e4,re)),he.max-X.d<=r||(R=he.h/2,$.push(new Ug(he.p.x-R,he.p.y-R,R,s)),$.push(new Ug(he.p.x+R,he.p.y-R,R,s)),$.push(new Ug(he.p.x-R,he.p.y+R,R,s)),$.push(new Ug(he.p.x+R,he.p.y+R,R,s)),re+=4)}return l&&(console.log(`num probes: ${re}`),console.log(`best distance: ${X.d}`)),X.p}function gL(s,r){return r.max-s.max}class Ug{constructor(r,l,h,p){this.p=new q(r,l),this.h=h,this.d=(function(x,w){let A=!1,P=1/0;for(let R=0;R<w.length;R++){const $=w[R];for(let X=0,re=$.length,he=re-1;X<re;he=X++){const ye=$[X],Se=$[he];ye.y>x.y!=Se.y>x.y&&x.x<(Se.x-ye.x)*(x.y-ye.y)/(Se.y-ye.y)+ye.x&&(A=!A),P=Math.min(P,H0(x,ye,Se))}}return(A?1:-1)*Math.sqrt(P)})(this.p,p),this.max=this.d+this.h*Math.SQRT2}}const Vg=7,Bx=Number.POSITIVE_INFINITY,yL=Math.sqrt(2);function P4(s,[r,l]){let h=0,p=0;if(l===Bx){r<0&&(r=0);const x=r/yL;switch(s){case"top-right":case"top-left":p=x-Vg;break;case"bottom-right":case"bottom-left":p=-x+Vg;break;case"bottom":p=-r+Vg;break;case"top":p=r-Vg}switch(s){case"top-right":case"bottom-right":h=-x;break;case"top-left":case"bottom-left":h=x;break;case"left":h=r;break;case"right":h=-r}}else{switch(r=Math.abs(r),l=Math.abs(l),s){case"top-right":case"top-left":case"top":p=l-Vg;break;case"bottom-right":case"bottom-left":case"bottom":p=-l+Vg}switch(s){case"top-right":case"bottom-right":case"right":h=-r;break;case"top-left":case"bottom-left":case"left":h=r}}return[h,p]}function _L(s,r,l,h,p,x,w,A,P,R){s.createArrays(),s.tilePixelRatio=Zr/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const $=s.layers[0].layout,X=s.layers[0]._unevaluatedLayout._values,re={};if(s.textSizeData.kind==="composite"){const{minZoom:Se,maxZoom:Ke}=s.textSizeData;re.compositeTextSizes=[X["text-size"].possiblyEvaluate(new G(Se),A),X["text-size"].possiblyEvaluate(new G(Ke),A)]}if(s.iconSizeData.kind==="composite"){const{minZoom:Se,maxZoom:Ke}=s.iconSizeData;re.compositeIconSizes=[X["icon-size"].possiblyEvaluate(new G(Se),A),X["icon-size"].possiblyEvaluate(new G(Ke),A)]}re.layoutTextSize=X["text-size"].possiblyEvaluate(new G(P+1),A),re.layoutIconSize=X["icon-size"].possiblyEvaluate(new G(P+1),A),re.textMaxSize=X["text-size"].possiblyEvaluate(new G(18),A);const he=$.get("text-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",ye=$.get("text-size");for(const Se of s.features){const Ke=$.get("text-font").evaluate(Se,{},A).join(","),at=ye.evaluate(Se,{},A),xt=re.layoutTextSize.evaluate(Se,{},A),ct=(re.layoutIconSize.evaluate(Se,{},A),{horizontal:{},vertical:void 0}),_t=Se.text;let Ct,It=[0,0];if(_t){const Sn=_t.toString(),$n=$.get("text-letter-spacing").evaluate(Se,{},A)*uu,fn=$.get("text-line-height").evaluate(Se,{},A)*uu,kn=Ve(Sn)?$n:0,Rn=$.get("text-anchor").evaluate(Se,{},A),Vn=$.get("text-variable-anchor");if(!Vn){const yr=$.get("text-radial-offset").evaluate(Se,{},A);It=yr?P4(Rn,[yr*uu,Bx]):$.get("text-offset").evaluate(Se,{},A).map((Ki=>Ki*uu))}let Xn=he?"center":$.get("text-justify").evaluate(Se,{},A);const wn=$.get("symbol-placement")==="point",pr=wn?$.get("text-max-width").evaluate(Se,{},A)*uu:1/0,zr=yr=>{s.allowVerticalPlacement&&Pe(Sn)&&(ct.vertical=Dx(_t,r,l,p,Ke,pr,fn,Rn,yr,kn,It,ld.vertical,!0,xt,at))};if(!he&&Vn){const yr=Xn==="auto"?Vn.map((Zn=>zx(Zn))):[Xn];let Ki=!1;for(let Zn=0;Zn<yr.length;Zn++){const ti=yr[Zn];if(!ct.horizontal[ti])if(Ki)ct.horizontal[ti]=ct.horizontal[0];else{const Xi=Dx(_t,r,l,p,Ke,pr,fn,"center",ti,kn,It,ld.horizontal,!1,xt,at);Xi&&(ct.horizontal[ti]=Xi,Ki=Xi.positionedLines.length===1)}}zr("left")}else{if(Xn==="auto"&&(Xn=zx(Rn)),wn||$.get("text-writing-mode").indexOf("horizontal")>=0||!Pe(Sn)){const yr=Dx(_t,r,l,p,Ke,pr,fn,Rn,Xn,kn,It,ld.horizontal,!1,xt,at);yr&&(ct.horizontal[Xn]=yr)}zr(wn?"left":Xn)}}let sn=!1;if(Se.icon&&Se.icon.name){const Sn=h[Se.icon.name];Sn&&(Ct=cL(p[Se.icon.name],$.get("icon-offset").evaluate(Se,{},A),$.get("icon-anchor").evaluate(Se,{},A)),sn=Sn.sdf,s.sdfIcons===void 0?s.sdfIcons=Sn.sdf:s.sdfIcons!==Sn.sdf&&dr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Sn.pixelRatio!==s.pixelRatio||$.get("icon-rotate").constantOr(1)!==0)&&(s.iconsNeedLinear=!0))}const tn=R4(ct.horizontal)||ct.vertical;s.iconsInText||(s.iconsInText=!!tn&&tn.iconsInText),(tn||Ct)&&vL(s,Se,ct,Ct,h,re,xt,0,It,sn,w,A,R)}x&&s.generateCollisionDebugBuffers(P,s.collisionBoxArray)}function zx(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function vL(s,r,l,h,p,x,w,A,P,R,$,X,re){let he=x.textMaxSize.evaluate(r,{},X);he===void 0&&(he=w);const ye=s.layers[0].layout,Se=ye.get("icon-offset").evaluate(r,{},X),Ke=R4(l.horizontal)||l.vertical,at=re.name==="globe",xt=uu,ct=w/xt,_t=s.tilePixelRatio*he/xt,Ct=(Rn=s.overscaling,s.zoom>18&&Rn>2&&(Rn>>=1),Math.max(Zr/(512*Rn),1)*ye.get("symbol-spacing")),It=ye.get("text-padding")*s.tilePixelRatio,sn=ye.get("icon-padding")*s.tilePixelRatio,tn=Z(ye.get("text-max-angle")),Sn=ye.get("text-rotation-alignment")==="map"&&ye.get("symbol-placement")!=="point",$n=ye.get("icon-rotation-alignment")==="map"&&ye.get("symbol-placement")!=="point",fn=ye.get("symbol-placement"),kn=Ct/2;var Rn;const Vn=ye.get("icon-text-fit");let Xn;h&&Vn!=="none"&&(s.allowVerticalPlacement&&l.vertical&&(Xn=v4(h,l.vertical,Vn,ye.get("icon-text-fit-padding"),Se,ct)),Ke&&(h=v4(h,Ke,Vn,ye.get("icon-text-fit-padding"),Se,ct)));const wn=(pr,zr,yr)=>{if(zr.x<0||zr.x>=Zr||zr.y<0||zr.y>=Zr)return;let Ki=null;if(at){const{x:Zn,y:ti,z:Xi}=re.projectTilePoint(zr.x,zr.y,yr);Ki={anchor:new cp(Zn,ti,Xi,0,void 0),up:re.upVector(yr,zr.x,zr.y)}}(function(Zn,ti,Xi,is,Zi,bi,fa,Ji,Qi,Fs,Qs,ea,Os,qa,_l,Xl,Bs,mc,Zl,al,cs,Yl,ta,ah,Jl){const hu=Zn.addToLineVertexArray(ti,is);let Hc,lh,Wc,Xd,Gg,vy,xy,h2=0,d2=0,f2=0,p2=0,eb=-1,tb=-1;const If={};let m2=Cc("");const jm=Xi?Xi.anchor:ti;let nb=0,rb=0;if(Qi._unevaluatedLayout.getValue("text-radial-offset")===void 0?[nb,rb]=Qi.layout.get("text-offset").evaluate(cs,{},Jl).map((Vh=>Vh*uu)):(nb=Qi.layout.get("text-radial-offset").evaluate(cs,{},Jl)*uu,rb=Bx),Zn.allowVerticalPlacement&&Zi.vertical){const Vh=Zi.vertical;if(_l)vy=jx(Vh),Ji&&(xy=jx(Ji));else{const qh=Qi.layout.get("text-rotate").evaluate(cs,{},Jl)+90;Wc=e1(Fs,jm,ti,Qs,ea,Os,Vh,qa,qh,Xl),Ji&&(Xd=e1(Fs,jm,ti,Qs,ea,Os,Ji,mc,qh))}}if(bi){const Vh=Qi.layout.get("icon-rotate").evaluate(cs,{},Jl),qh=Qi.layout.get("icon-text-fit")!=="none",by=C4(bi,Vh,ta,qh),ob=Ji?C4(Ji,Vh,ta,qh):void 0;lh=e1(Fs,jm,ti,Qs,ea,Os,bi,mc,Vh),h2=4*by.length;const g2=Zn.iconSizeData;let Um=null;g2.kind==="source"?(Um=[Hd*Qi.layout.get("icon-size").evaluate(cs,{},Jl)],Um[0]>Bp&&dr(`${Zn.layerIds[0]}: Value for "icon-size" is >= ${hy}. Reduce your "icon-size".`)):g2.kind==="composite"&&(Um=[Hd*Yl.compositeIconSizes[0].evaluate(cs,{},Jl),Hd*Yl.compositeIconSizes[1].evaluate(cs,{},Jl)],(Um[0]>Bp||Um[1]>Bp)&&dr(`${Zn.layerIds[0]}: Value for "icon-size" is >= ${hy}. Reduce your "icon-size".`)),Zn.addSymbols(Zn.icon,by,Um,al,Zl,cs,!1,Xi,ti,hu.lineStartIndex,hu.lineLength,-1,ah,Jl),eb=Zn.icon.placedSymbolArray.length-1,ob&&(d2=4*ob.length,Zn.addSymbols(Zn.icon,ob,Um,al,Zl,cs,ld.vertical,Xi,ti,hu.lineStartIndex,hu.lineLength,-1,ah,Jl),tb=Zn.icon.placedSymbolArray.length-1)}for(const Vh in Zi.horizontal){const qh=Zi.horizontal[Vh];Hc||(m2=Cc(qh.text),_l?Gg=jx(qh):Hc=e1(Fs,jm,ti,Qs,ea,Os,qh,qa,Qi.layout.get("text-rotate").evaluate(cs,{},Jl),Xl));const by=qh.positionedLines.length===1;if(f2+=k4(Zn,Xi,ti,qh,fa,Qi,_l,cs,Xl,hu,Zi.vertical?ld.horizontal:ld.horizontalOnly,by?Object.keys(Zi.horizontal):[Vh],If,eb,Yl,ah,Jl),by)break}Zi.vertical&&(p2+=k4(Zn,Xi,ti,Zi.vertical,fa,Qi,_l,cs,Xl,hu,ld.vertical,["vertical"],If,tb,Yl,ah,Jl));let $p=-1;const ib=(Vh,qh)=>Vh?Math.max(Vh,qh):qh;$p=ib(Gg,$p),$p=ib(vy,$p),$p=ib(xy,$p);const WL=$p>-1?1:0;Zn.glyphOffsetArray.length>=jp.MAX_GLYPHS&&dr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),cs.sortKey!==void 0&&Zn.addToSortKeyRanges(Zn.symbolInstances.length,cs.sortKey),Zn.symbolInstances.emplaceBack(jm.x,jm.y,jm.z,ti.x,ti.y,If.right>=0?If.right:-1,If.center>=0?If.center:-1,If.left>=0?If.left:-1,If.vertical>=0?If.vertical:-1,eb,tb,m2,Hc!==void 0?Hc:Zn.collisionBoxArray.length,Hc!==void 0?Hc+1:Zn.collisionBoxArray.length,Wc!==void 0?Wc:Zn.collisionBoxArray.length,Wc!==void 0?Wc+1:Zn.collisionBoxArray.length,lh!==void 0?lh:Zn.collisionBoxArray.length,lh!==void 0?lh+1:Zn.collisionBoxArray.length,Xd||Zn.collisionBoxArray.length,Xd?Xd+1:Zn.collisionBoxArray.length,Qs,f2,p2,h2,d2,WL,0,nb,rb,$p)})(s,zr,Ki,pr,l,h,p,Xn,s.layers[0],s.collisionBoxArray,r.index,r.sourceLayerIndex,s.index,It,Sn,P,0,sn,$n,Se,r,x,R,$,X)};if(fn==="line")for(const pr of A4(r.geometry,0,0,Zr,Zr)){const zr=hL(pr,Ct,tn,l.vertical||Ke,h,xt,_t,s.overscaling,Zr);for(const yr of zr)Ke&&xL(s,Ke.text,kn,yr)||wn(pr,yr,X)}else if(fn==="line-center"){for(const pr of r.geometry)if(pr.length>1){const zr=uL(pr,tn,l.vertical||Ke,h,xt,_t);zr&&wn(pr,zr,X)}}else if(r.type==="Polygon")for(const pr of iy(r.geometry,0)){const zr=mL(pr,16);wn(pr[0],new cp(zr.x,zr.y,0,0,void 0),X)}else if(r.type==="LineString")for(const pr of r.geometry)wn(pr,new cp(pr[0].x,pr[0].y,0,0,void 0),X);else if(r.type==="Point")for(const pr of r.geometry)for(const zr of pr)wn([zr],new cp(zr.x,zr.y,0,0,void 0),X)}const hy=255,Bp=hy*Hd;function k4(s,r,l,h,p,x,w,A,P,R,$,X,re,he,ye,Se,Ke){const at=(function(_t,Ct,It,sn,tn,Sn,$n,fn){const kn=[];if(Ct.positionedLines.length===0)return kn;const Rn=sn.layout.get("text-rotate").evaluate(Sn,{})*Math.PI/180,Vn=(function(yr){const Ki=yr[0],Zn=yr[1],ti=Ki*Zn;return ti>0?[Ki,-Zn]:ti<0?[-Ki,Zn]:Ki===0?[Zn,Ki]:[Zn,-Ki]})(It);let Xn=Math.abs(Ct.top-Ct.bottom);for(const yr of Ct.positionedLines)Xn-=yr.lineOffset;const wn=Ct.positionedLines.length,pr=Xn/wn;let zr=Ct.top-It[1];for(let yr=0;yr<wn;++yr){const Ki=Ct.positionedLines[yr];zr=dL(Ct,pr,zr,yr);for(const Zn of Ki.positionedGlyphs){if(!Zn.rect)continue;const ti=Zn.rect||{};let Xi=h4+1,is=!0,Zi=1,bi=0;if(Zn.imageName){const ta=$n[Zn.imageName];if(!ta)continue;if(ta.sdf){dr("SDF images are not supported in formatted text and will be ignored.");continue}is=!1,Zi=ta.pixelRatio,Xi=Th/Zi}const fa=(tn||fn)&&Zn.vertical,Ji=Zn.metrics.advance*Zn.scale/2,Qi=Zn.metrics,Fs=Zn.rect;if(Fs===null)continue;fn&&Ct.verticalizable&&(bi=Zn.imageName?Ji-Zn.metrics.width*Zn.scale/2:0);const Qs=tn?[Zn.x+Ji,Zn.y]:[0,0];let ea=[0,0],Os=[0,0],qa=!1;tn||(fa?(Os=[Zn.x+Ji+Vn[0],Zn.y+Vn[1]-bi],qa=!0):ea=[Zn.x+Ji+It[0],Zn.y+It[1]-bi]);const _l=Fs.w*Zn.scale/(Zi*(Zn.localGlyph?Wd:1)),Xl=Fs.h*Zn.scale/(Zi*(Zn.localGlyph?Wd:1));let Bs,mc,Zl,al;if(fa){const ta=Zn.y-zr,ah=new q(-Ji,Ji-ta),Jl=-Math.PI/2,hu=new q(...Os);Bs=new q(-Ji+ea[0],ea[1]),Bs._rotateAround(Jl,ah)._add(hu),Bs.x+=-ta+Ji,Bs.y-=(Qi.left-Xi)*Zn.scale;const Hc=Zn.imageName?Qi.advance*Zn.scale:uu*Zn.scale,lh=String.fromCharCode(Zn.glyph);WC(lh)?Bs.x+=(1-Xi)*Zn.scale:KC(lh)?Bs.x+=Hc-Qi.height*Zn.scale+(-Xi-1)*Zn.scale:Bs.x+=Zn.imageName||Qi.width+2*Xi===Fs.w&&Qi.height+2*Xi===Fs.h?(Hc-Xl)/2:(Hc-(Qi.height+2*Xi)*Zn.scale)/2,mc=new q(Bs.x,Bs.y-_l),Zl=new q(Bs.x+Xl,Bs.y),al=new q(Bs.x+Xl,Bs.y-_l)}else{const ta=(Qi.left-Xi)*Zn.scale-Ji+ea[0],ah=(-Qi.top-Xi)*Zn.scale+ea[1],Jl=ta+_l,hu=ah+Xl;Bs=new q(ta,ah),mc=new q(Jl,ah),Zl=new q(ta,hu),al=new q(Jl,hu)}if(Rn){let ta;ta=tn?new q(0,0):qa?new q(Vn[0],Vn[1]):new q(It[0],It[1]),Bs._rotateAround(Rn,ta),mc._rotateAround(Rn,ta),Zl._rotateAround(Rn,ta),al._rotateAround(Rn,ta)}const cs=new q(0,0),Yl=new q(0,0);kn.push({tl:Bs,tr:mc,bl:Zl,br:al,tex:ti,writingMode:Ct.writingMode,glyphOffset:Qs,sectionIndex:Zn.sectionIndex,isSDF:is,pixelOffsetTL:cs,pixelOffsetBR:Yl,minFontScaleX:0,minFontScaleY:0})}}return kn})(0,h,P,x,w,A,p,s.allowVerticalPlacement),xt=s.textSizeData;let ct=null;xt.kind==="source"?(ct=[Hd*x.layout.get("text-size").evaluate(A,{},Ke)],ct[0]>Bp&&dr(`${s.layerIds[0]}: Value for "text-size" is >= ${hy}. Reduce your "text-size".`)):xt.kind==="composite"&&(ct=[Hd*ye.compositeTextSizes[0].evaluate(A,{},Ke),Hd*ye.compositeTextSizes[1].evaluate(A,{},Ke)],(ct[0]>Bp||ct[1]>Bp)&&dr(`${s.layerIds[0]}: Value for "text-size" is >= ${hy}. Reduce your "text-size".`)),s.addSymbols(s.text,at,ct,P,w,A,$,r,l,R.lineStartIndex,R.lineLength,he,Se,Ke);for(const _t of X)re[_t]=s.text.placedSymbolArray.length-1;return 4*at.length}function R4(s){for(const r in s)return s[r];return null}function e1(s,r,l,h,p,x,w,A,P,R){let $=w.top,X=w.bottom,re=w.left,he=w.right;const ye=w.collisionPadding;if(ye&&(re-=ye[0],$-=ye[1],he+=ye[2],X+=ye[3]),P){const Se=new q(re,$),Ke=new q(he,$),at=new q(re,X),xt=new q(he,X),ct=Z(P);let _t=new q(0,0);R&&(_t=new q(R[0],R[1])),Se._rotateAround(ct,_t),Ke._rotateAround(ct,_t),at._rotateAround(ct,_t),xt._rotateAround(ct,_t),re=Math.min(Se.x,Ke.x,at.x,xt.x),he=Math.max(Se.x,Ke.x,at.x,xt.x),$=Math.min(Se.y,Ke.y,at.y,xt.y),X=Math.max(Se.y,Ke.y,at.y,xt.y)}return s.emplaceBack(r.x,r.y,r.z,l.x,l.y,re,$,he,X,A,h,p,x),s.length-1}function jx(s){s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const r=s.bottom-s.top;return r>0?Math.max(10,r):null}function xL(s,r,l,h){const p=s.compareText;if(r in p){const x=p[r];for(let w=x.length-1;w>=0;w--)if(h.dist(x[w])<l)return!0}else p[r]=[];return p[r].push(h),!1}function M4(s,r){const l=s.fovAboveCenter,h=s.elevation?s.elevation.getMinElevationBelowMSL()*r:0,p=(s._camera.position[2]*s.worldSize-h)/Math.cos(s._pitch),x=Math.sin(l)*p/Math.sin(Math.max(Math.PI/2-s._pitch-l,.01)),w=Math.sin(s._pitch)*x+p;return Math.min(1.01*w,p*(1/s._horizonShift))}function Bm(s,r){if(!r.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:r};const l=Math.pow(2,-s.z),h=s.x*l,p=(s.x+1)*l,x=s.y*l,w=(s.y+1)*l,A=Kl(h),P=Kl(p),R=Go(x),$=Go(w),X=r.project(A,R),re=r.project(P,R),he=r.project(P,$),ye=r.project(A,$);let Se=Math.min(X.x,re.x,he.x,ye.x),Ke=Math.min(X.y,re.y,he.y,ye.y),at=Math.max(X.x,re.x,he.x,ye.x),xt=Math.max(X.y,re.y,he.y,ye.y);const ct=l/16;function _t(It,sn,tn,Sn,$n,fn){const kn=(tn+$n)/2,Rn=(Sn+fn)/2,Vn=r.project(Kl(kn),Go(Rn)),Xn=Math.max(0,Se-Vn.x,Ke-Vn.y,Vn.x-at,Vn.y-xt);Se=Math.min(Se,Vn.x),at=Math.max(at,Vn.x),Ke=Math.min(Ke,Vn.y),xt=Math.max(xt,Vn.y),Xn>ct&&(_t(It,Vn,tn,Sn,kn,Rn),_t(Vn,sn,kn,Rn,$n,fn))}_t(X,re,h,x,p,x),_t(re,he,p,x,p,w),_t(he,ye,p,w,h,w),_t(ye,X,h,w,h,x),Se-=ct,Ke-=ct,at+=ct,xt+=ct;const Ct=1/Math.max(at-Se,xt-Ke);return{scale:Ct,x:Se*Ct,y:Ke*Ct,x2:at*Ct,y2:xt*Ct,projection:r}}const bL=Bu(new Float32Array(16));class zp{constructor(r){this.spec=r,this.name=r.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(r,l){return{x:0,y:0,z:0}}unproject(r,l){return new Jr(0,0)}projectTilePoint(r,l,h){return{x:r,y:l,z:0}}locationPoint(r,l,h=!0){return r._coordinatePoint(r.locationCoordinate(l),h)}pixelsPerMeter(r,l){return Va(1,r)*l}pixelSpaceConversion(r,l,h){return 1}farthestPixelDistance(r){return M4(r,r.pixelsPerMeter)}pointCoordinate(r,l,h,p){const x=r.horizonLineFromTop(!1),w=new q(l,Math.max(x,h));return r.rayIntersectionCoordinate(r.pointRayIntersection(w,p))}pointCoordinate3D(r,l,h){const p=new q(l,h);if(r.elevation)return r.elevation.pointCoordinate(p);{const x=this.pointCoordinate(r,p.x,p.y,0);return[x.x,x.y,x.z]}}isPointAboveHorizon(r,l){if(r.elevation)return!this.pointCoordinate3D(r,l.x,l.y);const h=r.horizonLineFromTop();return l.y<h}createInversionMatrix(r,l){return bL}createTileMatrix(r,l,h){let p,x,w;const A=h.canonical,P=Bu(new Float64Array(16));if(this.isReprojectedInTileSpace){const R=Bm(A,this);p=1,x=R.x+h.wrap*R.scale,w=R.y,wd(P,P,[p/R.scale,p/R.scale,r.pixelsPerMeter/l])}else p=l/r.zoomScale(A.z),x=(A.x+Math.pow(2,A.z)*h.wrap)*p,w=A.y*p;return nd(P,P,[x,w,0]),wd(P,P,[p/Zr,p/Zr,1]),P}upVector(r,l,h){return[0,0,1]}upVectorScale(r,l,h){return{metersToTile:1}}}class wL extends zp{constructor(r){super(r),this.range=[4,7],this.center=r.center||[-96,37.5];const[l,h]=this.parallels=r.parallels||[29.5,45.5],p=Math.sin(Z(l));this.n=(p+Math.sin(Z(h)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(r,l){const{n:h,c:p,r0:x}=this,w=Z(r-this.center[0]),A=Z(l),P=Math.sqrt(p-2*h*Math.sin(A))/h;return{x:P*Math.sin(w*h),y:P*Math.cos(w*h)-x,z:0}}unproject(r,l){const{n:h,c:p,r0:x}=this,w=x+l;let A=Math.atan2(r,Math.abs(w))*Math.sign(w);w*h<0&&(A-=Math.PI*Math.sign(r)*Math.sign(w));const P=Z(this.center[0])*h;A=xe(A,-Math.PI-P,Math.PI-P);const R=De(be(A/h)+this.center[0],-180,180),$=Math.asin(De((p-(r*r+w*w)*h*h)/(2*h),-1,1)),X=De(be($),-ka,ka);return new Jr(R,X)}}const dy=1.340264,fy=-.081106,py=893e-6,my=.003796,t1=Math.sqrt(3)/2;class SL extends zp{project(r,l){l=l/180*Math.PI,r=r/180*Math.PI;const h=Math.asin(t1*Math.sin(l)),p=h*h,x=p*p*p;return{x:.5*(r*Math.cos(h)/(t1*(dy+3*fy*p+x*(7*py+9*my*p)))/Math.PI+.5),y:1-.5*(h*(dy+fy*p+x*(py+my*p))/Math.PI+1),z:0}}unproject(r,l){r=(2*r-.5)*Math.PI;let h=l=(2*(1-l)-1)*Math.PI,p=h*h,x=p*p*p;for(let $,X,re,he=0;he<12&&(X=h*(dy+fy*p+x*(py+my*p))-l,re=dy+3*fy*p+x*(7*py+9*my*p),$=X/re,h=De(h-$,-Math.PI/3,Math.PI/3),p=h*h,x=p*p*p,!(Math.abs($)<1e-12));++he);const w=t1*r*(dy+3*fy*p+x*(7*py+9*my*p))/Math.cos(h),A=Math.asin(Math.sin(h)/t1),P=De(180*w/Math.PI,-180,180),R=De(180*A/Math.PI,-ka,ka);return new Jr(P,R)}}class EL extends zp{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0}project(r,l){return{x:.5+r/360,y:.5-l/360,z:0}}unproject(r,l){const h=360*(r-.5),p=De(360*(.5-l),-ka,ka);return new Jr(h,p)}}const qg=Math.PI/2;function n1(s){return Math.tan((qg+s)/2)}class AL extends zp{constructor(r){super(r),this.center=r.center||[0,30];const[l,h]=this.parallels=r.parallels||[30,30];let p=Z(l),x=Z(h);this.southernCenter=p+x<0,this.southernCenter&&(p=-p,x=-x);const w=Math.cos(p),A=n1(p);this.n=p===x?Math.sin(p):Math.log(w/Math.cos(x))/Math.log(n1(x)/A),this.f=w*Math.pow(n1(p),this.n)/this.n}project(r,l){l=Z(l),this.southernCenter&&(l=-l),r=Z(r-this.center[0]);const h=1e-6,{n:p,f:x}=this;x>0?l<-qg+h&&(l=-qg+h):l>qg-h&&(l=qg-h);const w=x/Math.pow(n1(l),p);let A=w*Math.sin(p*r),P=x-w*Math.cos(p*r);return A=.5*(A/Math.PI+.5),P=.5*(P/Math.PI+.5),{x:A,y:this.southernCenter?P:1-P,z:0}}unproject(r,l){r=(2*r-.5)*Math.PI,this.southernCenter&&(l=1-l),l=(2*(1-l)-.5)*Math.PI;const{n:h,f:p}=this,x=p-l,w=Math.sign(x),A=Math.sign(h)*Math.sqrt(r*r+x*x);let P=Math.atan2(r,Math.abs(x))*w;x*h<0&&(P-=Math.PI*Math.sign(r)*w);const R=De(be(P/h)+this.center[0],-180,180),$=De(be(2*Math.atan(Math.pow(p/A,1/h))-qg),-ka,ka);return new Jr(R,this.southernCenter?-$:$)}}class N4 extends zp{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(r,l){return{x:Is(r),y:bs(l),z:0}}unproject(r,l){const h=Kl(r),p=Go(l);return new Jr(h,p)}}const D4=Z(ka);class TL extends zp{project(r,l){const h=(l=Z(l))*l,p=h*h;return{x:.5*((r=Z(r))*(.8707-.131979*h+p*(p*(.003971*h-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(l*(1.007226+h*(.015085+p*(.028874*h-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(r,l){r=(2*r-.5)*Math.PI;let h=l=(2*(1-l)-1)*Math.PI,p=25,x=0,w=h*h;do{w=h*h;const R=w*w;x=(h*(1.007226+w*(.015085+R*(.028874*w-.044475-.005916*R)))-l)/(1.007226+w*(.045255+R*(.259866*w-.311325-.005916*11*R))),h=De(h-x,-D4,D4)}while(Math.abs(x)>1e-6&&--p>0);w=h*h;const A=De(be(r/(.8707+w*(w*(w*w*w*(.003971-.001529*w)-.013791)-.131979))),-180,180),P=be(h);return new Jr(A,P)}}const F4=Z(ka);class IL extends zp{project(r,l){l=Z(l),r=Z(r);const h=Math.cos(l),p=2/Math.PI,x=Math.acos(h*Math.cos(r/2)),w=Math.sin(x)/x,A=.5*(r*p+2*h*Math.sin(r/2)/w)||0,P=.5*(l+Math.sin(l)/w)||0;return{x:.5*(A/Math.PI+.5),y:1-.5*(P/Math.PI+1),z:0}}unproject(r,l){let h=r=(2*r-.5)*Math.PI,p=l=(2*(1-l)-1)*Math.PI,x=25;const w=1e-6;let A=0,P=0;do{const R=Math.cos(p),$=Math.sin(p),X=2*$*R,re=$*$,he=R*R,ye=Math.cos(h/2),Se=Math.sin(h/2),Ke=2*ye*Se,at=Se*Se,xt=1-he*ye*ye,ct=xt?1/xt:0,_t=xt?Math.acos(R*ye)*Math.sqrt(1/xt):0,Ct=.5*(2*_t*R*Se+2*h/Math.PI)-r,It=.5*(_t*$+p)-l,sn=.5*ct*(he*at+_t*R*ye*re)+1/Math.PI,tn=ct*(Ke*X/4-_t*$*Se),Sn=.125*ct*(X*Se-_t*$*he*Ke),$n=.5*ct*(re*ye+_t*at*R)+.5,fn=tn*Sn-$n*sn;A=(It*tn-Ct*$n)/fn,P=(Ct*Sn-It*sn)/fn,h=De(h-A,-Math.PI,Math.PI),p=De(p-P,-F4,F4)}while((Math.abs(A)>w||Math.abs(P)>w)&&--x>0);return new Jr(be(h),be(p))}}class O4 extends zp{constructor(r){super(r),this.center=r.center||[0,0],this.parallels=r.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Z(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(r,l){const{scale:h,cosPhi:p}=this;return{x:Z(r)*p*h+.5,y:-Math.sin(Z(l))/p*h+.5,z:0}}unproject(r,l){const{scale:h,cosPhi:p}=this,x=-(l-.5)/h,w=De(be((r-.5)/h)/p,-180,180),A=Math.asin(De(x*p,-1,1)),P=De(be(A),-ka,ka);return new Jr(w,P)}}class CL extends N4{constructor(r){super(r),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(r,l,h){const p=Wl(r,l,h);return ft(p,p,pc(Yi(h))),{x:p[0],y:p[1],z:p[2]}}locationPoint(r,l){const h=gl(l.lat,l.lng),p=Ge([],h),x=r.elevation?r.elevation.getAtPointOrZero(r.locationCoordinate(l),r._centerAltitude):r._centerAltitude;qe(h,h,p,Va(1,0)*Zr*x);const w=Bu(new Float64Array(16));return lu(w,r.pixelMatrix,r.globeMatrix),ft(h,h,w),new q(h[0],h[1])}pixelsPerMeter(r,l){return Va(1,0)*l}pixelSpaceConversion(r,l,h){const p=Va(1,r)*l,x=He(Va(1,45)*l,p,h);return this.pixelsPerMeter(r,l)/x}createTileMatrix(r,l,h){const p=Ah(Yi(h.canonical));return lu(new Float64Array(16),r.globeMatrix,p)}createInversionMatrix(r,l){const{center:h}=r,p=pc(Yi(l));return mf(p,p,Z(h.lng)),kp(p,p,Z(h.lat)),wd(p,p,[r._pixelsPerMercatorPixel,r._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(r,l,h,p){return Rl(r,l,h,!0)||new Ad(0,0)}pointCoordinate3D(r,l,h){const p=this.pointCoordinate(r,l,h,0);return[p.x,p.y,p.z]}isPointAboveHorizon(r,l){return!Rl(r,l.x,l.y,!1)}farthestPixelDistance(r){const l=(function(p,x){const w=p.cameraToCenterDistance,A=p._centerAltitude*x,P=p._camera,R=p._camera.forward(),$=Bh([],Ye([],R,-w),[0,0,A]),X=p.worldSize/(2*Math.PI),re=[0,0,-X],he=p.width/p.height,ye=Math.tan(p.fovAboveCenter),Se=Ye([],P.up(),ye),Ke=Ye([],P.right(),ye*he),at=Ge([],Bh([],Bh([],R,Se),Ke)),xt=[];let ct;if(new Ur($,at).closestPointOnSphere(re,X,xt)){const _t=Bh([],xt,re),Ct=bn([],_t,$);ct=Math.cos(p.fovAboveCenter)*jd(Ct)}else{const _t=bn([],$,re),Ct=bn([],re,$);Ge(Ct,Ct);const It=jd(_t)-X;ct=Math.sqrt(It*(It+2*X));const sn=Math.acos(ct/(X+It))-Math.acos(St(R,Ct));ct*=Math.cos(sn)}return 1.01*ct})(r,this.pixelsPerMeter(r.center.lat,r.worldSize)),h=ls(r.zoom);if(h>0){const p=M4(r,Va(1,r.center.lat)*r.worldSize),x=r.worldSize/(2*Math.PI),w=Math.max(r.width,r.height)/r.worldSize*Math.PI;return He(l,p+x*(1-Math.cos(w)),Math.pow(h,10))}return l}upVector(r,l,h){return Wl(l,h,r,1)}upVectorScale(r){return{metersToTile:ro(Sd(Yi(r)))}}}function B4(s){const r=s.parallels,l=!!r&&Math.abs(r[0]+r[1])<.01;switch(s.name){case"mercator":return new N4(s);case"equirectangular":return new EL(s);case"naturalEarth":return new TL(s);case"equalEarth":return new SL(s);case"winkelTripel":return new IL(s);case"albers":return l?new O4(s):new wL(s);case"lambertConformalConic":return l?new O4(s):new AL(s);case"globe":return new CL(s)}throw new Error(`Invalid projection name: ${s.name}`)}const LL=Di.types,PL=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function r1(s,r,l,h,p,x,w,A,P,R,$,X,re){const he=A?Math.min(Bp,Math.round(A[0])):0,ye=A?Math.min(Bp,Math.round(A[1])):0;s.emplaceBack(r,l,Math.round(32*h),Math.round(32*p),x,w,(he<<1)+(P?1:0),ye,16*R,16*$,256*X,256*re)}function i1(s,r,l,h,p,x,w){s.emplaceBack(r,l,h,p,x,w)}function o1(s,r,l,h,p){s.emplaceBack(r,l,h,p),s.emplaceBack(r,l,h,p),s.emplaceBack(r,l,h,p),s.emplaceBack(r,l,h,p)}function kL(s){for(const r of s.sections)if(Yt(r.text))return!0;return!1}class Ux{constructor(r){this.layoutVertexArray=new cn,this.indexArray=new xr,this.programConfigurations=r,this.segments=new Pa,this.dynamicLayoutVertexArray=new Cn,this.opacityVertexArray=new hr,this.placedSymbolArray=new Ms,this.globeExtVertexArray=new Nn}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(r,l,h,p){this.isEmpty()||(h&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,zC.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,UC.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,PL,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,jC.members,!0)),this.opacityVertexBuffer.itemSize=1),(h||p)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}ur(Ux,"SymbolBuffers");class Vx{constructor(r,l,h){this.layoutVertexArray=new r,this.layoutAttributes=l,this.indexArray=new h,this.segments=new Pa,this.collisionVertexArray=new ni,this.collisionVertexArrayExt=new mi}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,VC.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,qC.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ur(Vx,"CollisionBuffers");class jp{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((w=>w.id)),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Bu([]),this.placementViewportMatrix=Bu([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Px(this.zoom,l["text-size"]),this.iconSizeData=Px(this.zoom,l["icon-size"]);const h=this.layers[0].layout,p=h.get("symbol-sort-key"),x=h.get("symbol-z-order");this.canOverlap=h.get("text-allow-overlap")||h.get("icon-allow-overlap")||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=h.get("text-writing-mode").map((w=>ld[w])),this.stateDependentLayerIds=this.layers.filter((w=>w.isStateDependent())).map((w=>w.id)),this.sourceID=r.sourceID,this.projection=r.projection}createArrays(){this.text=new Ux(new ih(this.layers,this.zoom,(r=>/^text/.test(r)))),this.icon=new Ux(new ih(this.layers,this.zoom,(r=>/^icon/.test(r)))),this.glyphOffsetArray=new Ns,this.lineVertexArray=new ps,this.symbolInstances=new $o}calculateGlyphDependencies(r,l,h,p,x){for(let w=0;w<r.length;w++)if(l[r.charCodeAt(w)]=!0,p&&x){const A=ly[r.charAt(w)];A&&(l[A.charCodeAt(0)]=!0)}}populate(r,l,h,p){const x=this.layers[0],w=x.layout,A=this.projection.name==="globe",P=w.get("text-font"),R=w.get("text-field"),$=w.get("icon-image"),X=(R.value.kind!=="constant"||R.value.value instanceof vo&&!R.value.value.isEmpty()||R.value.value.toString().length>0)&&(P.value.kind!=="constant"||P.value.value.length>0),re=$.value.kind!=="constant"||!!$.value.value||Object.keys($.parameters).length>0,he=w.get("symbol-sort-key");if(this.features=[],!X&&!re)return;const ye=l.iconDependencies,Se=l.glyphDependencies,Ke=l.availableImages,at=new G(this.zoom);for(const{feature:xt,id:ct,index:_t,sourceLayerIndex:Ct}of r){const It=x._featureFilter.needGeometry,sn=Td(xt,It);if(!x._featureFilter.filter(at,sn,h))continue;if(It||(sn.geometry=wu(xt,h,p)),A&&xt.type!==1&&h.z<=5){const fn=sn.geometry,kn=.98078528056,Rn=(Vn,Xn)=>St(Wl(Vn.x,Vn.y,h,1),Wl(Xn.x,Xn.y,h,1))<kn;for(let Vn=0;Vn<fn.length;Vn++)fn[Vn]=Mp(fn[Vn],Rn)}let tn,Sn;if(X){const fn=x.getValueAndResolveTokens("text-field",sn,h,Ke),kn=vo.factory(fn);kL(kn)&&(this.hasRTLText=!0),(!this.hasRTLText||T()==="unavailable"||this.hasRTLText&&z.isParsed())&&(tn=HC(kn,x,sn))}if(re){const fn=x.getValueAndResolveTokens("icon-image",sn,h,Ke);Sn=fn instanceof Us?fn:Us.fromString(fn)}if(!tn&&!Sn)continue;const $n=this.sortFeaturesByKey?he.evaluate(sn,{},h):void 0;if(this.features.push({id:ct,text:tn,icon:Sn,index:_t,sourceLayerIndex:Ct,geometry:sn.geometry,properties:xt.properties,type:LL[xt.type],sortKey:$n}),Sn&&(ye[Sn.name]=!0),tn){const fn=P.evaluate(sn,{},h).join(","),kn=w.get("text-rotation-alignment")==="map"&&w.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ld.vertical)>=0;for(const Rn of tn.sections)if(Rn.image)ye[Rn.image.name]=!0;else{const Vn=Pe(tn.toString()),Xn=Rn.fontStack||fn,wn=Se[Xn]=Se[Xn]||{};this.calculateGlyphDependencies(Rn.text,wn,kn,this.allowVerticalPlacement,Vn)}}}w.get("symbol-placement")==="line"&&(this.features=(function(xt){const ct={},_t={},Ct=[];let It=0;function sn(fn){Ct.push(xt[fn]),It++}function tn(fn,kn,Rn){const Vn=_t[fn];return delete _t[fn],_t[kn]=Vn,Ct[Vn].geometry[0].pop(),Ct[Vn].geometry[0]=Ct[Vn].geometry[0].concat(Rn[0]),Vn}function Sn(fn,kn,Rn){const Vn=ct[kn];return delete ct[kn],ct[fn]=Vn,Ct[Vn].geometry[0].shift(),Ct[Vn].geometry[0]=Rn[0].concat(Ct[Vn].geometry[0]),Vn}function $n(fn,kn,Rn){const Vn=Rn?kn[0][kn[0].length-1]:kn[0][0];return`${fn}:${Vn.x}:${Vn.y}`}for(let fn=0;fn<xt.length;fn++){const kn=xt[fn],Rn=kn.geometry,Vn=kn.text?kn.text.toString():null;if(!Vn){sn(fn);continue}const Xn=$n(Vn,Rn),wn=$n(Vn,Rn,!0);if(Xn in _t&&wn in ct&&_t[Xn]!==ct[wn]){const pr=Sn(Xn,wn,Rn),zr=tn(Xn,wn,Ct[pr].geometry);delete ct[Xn],delete _t[wn],_t[$n(Vn,Ct[zr].geometry,!0)]=zr,Ct[pr].geometry=null}else Xn in _t?tn(Xn,wn,Rn):wn in ct?Sn(Xn,wn,Rn):(sn(fn),ct[Xn]=It-1,_t[wn]=It-1)}return Ct.filter((fn=>fn.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((xt,ct)=>xt.sortKey-ct.sortKey))}update(r,l,h,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,l,this.layers,h,p),this.icon.programConfigurations.updatePaintArrays(r,l,this.layers,h,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=B4(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,l){const h=this.lineVertexArray.length;if(r.segment!==void 0)for(const{x:p,y:x}of l)this.lineVertexArray.emplaceBack(p,x);return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(r,l,h,p,x,w,A,P,R,$,X,re,he,ye){const Se=r.indexArray,Ke=r.layoutVertexArray,at=r.globeExtVertexArray,xt=r.segments.prepareSegment(4*l.length,Ke,Se,this.canOverlap?w.sortKey:void 0),ct=this.glyphOffsetArray.length,_t=xt.vertexLength,Ct=this.allowVerticalPlacement&&A===ld.vertical?Math.PI/2:0,It=w.text&&w.text.sections;for(let tn=0;tn<l.length;tn++){const{tl:Sn,tr:$n,bl:fn,br:kn,tex:Rn,pixelOffsetTL:Vn,pixelOffsetBR:Xn,minFontScaleX:wn,minFontScaleY:pr,glyphOffset:zr,isSDF:yr,sectionIndex:Ki}=l[tn],Zn=xt.vertexLength,ti=zr[1];if(r1(Ke,R.x,R.y,Sn.x,ti+Sn.y,Rn.x,Rn.y,h,yr,Vn.x,Vn.y,wn,pr),r1(Ke,R.x,R.y,$n.x,ti+$n.y,Rn.x+Rn.w,Rn.y,h,yr,Xn.x,Vn.y,wn,pr),r1(Ke,R.x,R.y,fn.x,ti+fn.y,Rn.x,Rn.y+Rn.h,h,yr,Vn.x,Xn.y,wn,pr),r1(Ke,R.x,R.y,kn.x,ti+kn.y,Rn.x+Rn.w,Rn.y+Rn.h,h,yr,Xn.x,Xn.y,wn,pr),P){const{x:Xi,y:is,z:Zi}=P.anchor,[bi,fa,Ji]=P.up;i1(at,Xi,is,Zi,bi,fa,Ji),i1(at,Xi,is,Zi,bi,fa,Ji),i1(at,Xi,is,Zi,bi,fa,Ji),i1(at,Xi,is,Zi,bi,fa,Ji),o1(r.dynamicLayoutVertexArray,Xi,is,Zi,Ct)}else o1(r.dynamicLayoutVertexArray,R.x,R.y,R.z,Ct);Se.emplaceBack(Zn,Zn+1,Zn+2),Se.emplaceBack(Zn+1,Zn+2,Zn+3),xt.vertexLength+=4,xt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(zr[0]),tn!==l.length-1&&Ki===l[tn+1].sectionIndex||r.programConfigurations.populatePaintArrays(Ke.length,w,w.index,{},he,ye,It&&It[Ki])}const sn=P?P.anchor:R;r.placedSymbolArray.emplaceBack(sn.x,sn.y,sn.z,R.x,R.y,ct,this.glyphOffsetArray.length-ct,_t,$,X,R.segment,h?h[0]:0,h?h[1]:0,p[0],p[1],A,0,!1,0,re,0)}_commitLayoutVertex(r,l,h,p,x,w,A){r.emplaceBack(l,h,p,x,w,Math.round(A.x),Math.round(A.y))}_addCollisionDebugVertices(r,l,h,p,x,w,A){const P=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),R=P.vertexLength,$=A.tileAnchorX,X=A.tileAnchorY;for(let he=0;he<4;he++)h.collisionVertexArray.emplaceBack(0,0,0,0);h.collisionVertexArrayExt.emplaceBack(l,-r.padding,-r.padding),h.collisionVertexArrayExt.emplaceBack(l,r.padding,-r.padding),h.collisionVertexArrayExt.emplaceBack(l,r.padding,r.padding),h.collisionVertexArrayExt.emplaceBack(l,-r.padding,r.padding),this._commitLayoutVertex(h.layoutVertexArray,p,x,w,$,X,new q(r.x1,r.y1)),this._commitLayoutVertex(h.layoutVertexArray,p,x,w,$,X,new q(r.x2,r.y1)),this._commitLayoutVertex(h.layoutVertexArray,p,x,w,$,X,new q(r.x2,r.y2)),this._commitLayoutVertex(h.layoutVertexArray,p,x,w,$,X,new q(r.x1,r.y2)),P.vertexLength+=4;const re=h.indexArray;re.emplaceBack(R,R+1),re.emplaceBack(R+1,R+2),re.emplaceBack(R+2,R+3),re.emplaceBack(R+3,R),P.primitiveLength+=4}_addTextDebugCollisionBoxes(r,l,h,p,x,w){for(let A=p;A<x;A++){const P=h.get(A),R=this.getSymbolInstanceTextSize(r,w,l,A);this._addCollisionDebugVertices(P,R,this.textCollisionBox,P.projectedAnchorX,P.projectedAnchorY,P.projectedAnchorZ,w)}}_addIconDebugCollisionBoxes(r,l,h,p,x,w){for(let A=p;A<x;A++){const P=h.get(A),R=this.getSymbolInstanceIconSize(r,l,w.placedIconSymbolIndex);this._addCollisionDebugVertices(P,R,this.iconCollisionBox,P.projectedAnchorX,P.projectedAnchorY,P.projectedAnchorZ,w)}}generateCollisionDebugBuffers(r,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Vx(rr,r4.members,hs),this.iconCollisionBox=new Vx(rr,r4.members,hs);const h=Dg(this.iconSizeData,r),p=Dg(this.textSizeData,r);for(let x=0;x<this.symbolInstances.length;x++){const w=this.symbolInstances.get(x);this._addTextDebugCollisionBoxes(p,r,l,w.textBoxStartIndex,w.textBoxEndIndex,w),this._addTextDebugCollisionBoxes(p,r,l,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w),this._addIconDebugCollisionBoxes(h,r,l,w.iconBoxStartIndex,w.iconBoxEndIndex,w),this._addIconDebugCollisionBoxes(h,r,l,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w)}}getSymbolInstanceTextSize(r,l,h,p){const x=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:p),w=W_(this.textSizeData,r,x)/uu;return this.tilePixelRatio*w}getSymbolInstanceIconSize(r,l,h){const p=this.icon.placedSymbolArray.get(h),x=W_(this.iconSizeData,r,p);return this.tilePixelRatio*x}_commitDebugCollisionVertexUpdate(r,l,h){r.emplaceBack(l,-h,-h),r.emplaceBack(l,h,-h),r.emplaceBack(l,h,h),r.emplaceBack(l,-h,h)}_updateTextDebugCollisionBoxes(r,l,h,p,x,w){for(let A=p;A<x;A++){const P=h.get(A),R=this.getSymbolInstanceTextSize(r,w,l,A);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,R,P.padding)}}_updateIconDebugCollisionBoxes(r,l,h,p,x,w){for(let A=p;A<x;A++){const P=h.get(A),R=this.getSymbolInstanceIconSize(r,l,w);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,R,P.padding)}}updateCollisionDebugBuffers(r,l){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const h=Dg(this.iconSizeData,r),p=Dg(this.textSizeData,r);for(let x=0;x<this.symbolInstances.length;x++){const w=this.symbolInstances.get(x);this._updateTextDebugCollisionBoxes(p,r,l,w.textBoxStartIndex,w.textBoxEndIndex,w),this._updateTextDebugCollisionBoxes(p,r,l,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w),this._updateIconDebugCollisionBoxes(h,r,l,w.iconBoxStartIndex,w.iconBoxEndIndex,w.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(h,r,l,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,l,h,p,x,w,A,P,R){const $={};if(l<h){const{x1:X,y1:re,x2:he,y2:ye,padding:Se,projectedAnchorX:Ke,projectedAnchorY:at,projectedAnchorZ:xt,tileAnchorX:ct,tileAnchorY:_t,featureIndex:Ct}=r.get(l);$.textBox={x1:X,y1:re,x2:he,y2:ye,padding:Se,projectedAnchorX:Ke,projectedAnchorY:at,projectedAnchorZ:xt,tileAnchorX:ct,tileAnchorY:_t},$.textFeatureIndex=Ct}if(p<x){const{x1:X,y1:re,x2:he,y2:ye,padding:Se,projectedAnchorX:Ke,projectedAnchorY:at,projectedAnchorZ:xt,tileAnchorX:ct,tileAnchorY:_t,featureIndex:Ct}=r.get(p);$.verticalTextBox={x1:X,y1:re,x2:he,y2:ye,padding:Se,projectedAnchorX:Ke,projectedAnchorY:at,projectedAnchorZ:xt,tileAnchorX:ct,tileAnchorY:_t},$.verticalTextFeatureIndex=Ct}if(w<A){const{x1:X,y1:re,x2:he,y2:ye,padding:Se,projectedAnchorX:Ke,projectedAnchorY:at,projectedAnchorZ:xt,tileAnchorX:ct,tileAnchorY:_t,featureIndex:Ct}=r.get(w);$.iconBox={x1:X,y1:re,x2:he,y2:ye,padding:Se,projectedAnchorX:Ke,projectedAnchorY:at,projectedAnchorZ:xt,tileAnchorX:ct,tileAnchorY:_t},$.iconFeatureIndex=Ct}if(P<R){const{x1:X,y1:re,x2:he,y2:ye,padding:Se,projectedAnchorX:Ke,projectedAnchorY:at,projectedAnchorZ:xt,tileAnchorX:ct,tileAnchorY:_t,featureIndex:Ct}=r.get(P);$.verticalIconBox={x1:X,y1:re,x2:he,y2:ye,padding:Se,projectedAnchorX:Ke,projectedAnchorY:at,projectedAnchorZ:xt,tileAnchorX:ct,tileAnchorY:_t},$.verticalIconFeatureIndex=Ct}return $}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const h=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,l){const h=r.placedSymbolArray.get(l),p=h.vertexStartIndex+4*h.numGlyphs;for(let x=h.vertexStartIndex;x<p;x+=4)r.indexArray.emplaceBack(x,x+1,x+2),r.indexArray.emplaceBack(x+1,x+2,x+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const l=Math.sin(r),h=Math.cos(r),p=[],x=[],w=[];for(let A=0;A<this.symbolInstances.length;++A){w.push(A);const P=this.symbolInstances.get(A);p.push(0|Math.round(l*P.tileAnchorX+h*P.tileAnchorY)),x.push(P.featureIndex)}return w.sort(((A,P)=>p[A]-p[P]||x[P]-x[A])),w}addToSortKeyRanges(r,l){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===l?h.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const h=this.symbolInstances.get(l);this.featureSortOrder.push(h.featureIndex);const{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:x,leftJustifiedTextSymbolIndex:w,verticalPlacedTextSymbolIndex:A,placedIconSymbolIndex:P,verticalPlacedIconSymbolIndex:R}=h;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),x>=0&&x!==p&&this.addIndicesForPlacedSymbol(this.text,x),w>=0&&w!==x&&w!==p&&this.addIndicesForPlacedSymbol(this.text,w),A>=0&&this.addIndicesForPlacedSymbol(this.text,A),P>=0&&this.addIndicesForPlacedSymbol(this.icon,P),R>=0&&this.addIndicesForPlacedSymbol(this.icon,R)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}ur(jp,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),jp.MAX_GLYPHS=65535,jp.addDynamicAttributes=o1;const RL=new st({"symbol-placement":new _e(mn.layout_symbol["symbol-placement"]),"symbol-spacing":new _e(mn.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new _e(mn.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new $e(mn.layout_symbol["symbol-sort-key"]),"symbol-z-order":new _e(mn.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new _e(mn.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new _e(mn.layout_symbol["icon-ignore-placement"]),"icon-optional":new _e(mn.layout_symbol["icon-optional"]),"icon-rotation-alignment":new _e(mn.layout_symbol["icon-rotation-alignment"]),"icon-size":new $e(mn.layout_symbol["icon-size"]),"icon-text-fit":new _e(mn.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new _e(mn.layout_symbol["icon-text-fit-padding"]),"icon-image":new $e(mn.layout_symbol["icon-image"]),"icon-rotate":new $e(mn.layout_symbol["icon-rotate"]),"icon-padding":new _e(mn.layout_symbol["icon-padding"]),"icon-keep-upright":new _e(mn.layout_symbol["icon-keep-upright"]),"icon-offset":new $e(mn.layout_symbol["icon-offset"]),"icon-anchor":new $e(mn.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new _e(mn.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new _e(mn.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new _e(mn.layout_symbol["text-rotation-alignment"]),"text-field":new $e(mn.layout_symbol["text-field"]),"text-font":new $e(mn.layout_symbol["text-font"]),"text-size":new $e(mn.layout_symbol["text-size"]),"text-max-width":new $e(mn.layout_symbol["text-max-width"]),"text-line-height":new $e(mn.layout_symbol["text-line-height"]),"text-letter-spacing":new $e(mn.layout_symbol["text-letter-spacing"]),"text-justify":new $e(mn.layout_symbol["text-justify"]),"text-radial-offset":new $e(mn.layout_symbol["text-radial-offset"]),"text-variable-anchor":new _e(mn.layout_symbol["text-variable-anchor"]),"text-anchor":new $e(mn.layout_symbol["text-anchor"]),"text-max-angle":new _e(mn.layout_symbol["text-max-angle"]),"text-writing-mode":new _e(mn.layout_symbol["text-writing-mode"]),"text-rotate":new $e(mn.layout_symbol["text-rotate"]),"text-padding":new _e(mn.layout_symbol["text-padding"]),"text-keep-upright":new _e(mn.layout_symbol["text-keep-upright"]),"text-transform":new $e(mn.layout_symbol["text-transform"]),"text-offset":new $e(mn.layout_symbol["text-offset"]),"text-allow-overlap":new _e(mn.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new _e(mn.layout_symbol["text-ignore-placement"]),"text-optional":new _e(mn.layout_symbol["text-optional"])});var qx={paint:new st({"icon-opacity":new $e(mn.paint_symbol["icon-opacity"]),"icon-color":new $e(mn.paint_symbol["icon-color"]),"icon-halo-color":new $e(mn.paint_symbol["icon-halo-color"]),"icon-halo-width":new $e(mn.paint_symbol["icon-halo-width"]),"icon-halo-blur":new $e(mn.paint_symbol["icon-halo-blur"]),"icon-translate":new _e(mn.paint_symbol["icon-translate"]),"icon-translate-anchor":new _e(mn.paint_symbol["icon-translate-anchor"]),"text-opacity":new $e(mn.paint_symbol["text-opacity"]),"text-color":new $e(mn.paint_symbol["text-color"],{runtimeType:js,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new $e(mn.paint_symbol["text-halo-color"]),"text-halo-width":new $e(mn.paint_symbol["text-halo-width"]),"text-halo-blur":new $e(mn.paint_symbol["text-halo-blur"]),"text-translate":new _e(mn.paint_symbol["text-translate"]),"text-translate-anchor":new _e(mn.paint_symbol["text-translate-anchor"])}),layout:RL};class z4{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:Ls,this.defaultValue=r}evaluate(r){if(r.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(r.formattedSection))return l.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ur(z4,"FormatSectionOverride",{omit:["defaultValue"]});class s1 extends au{constructor(r){super(r,qx)}recalculate(r,l){super.recalculate(r,l),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const h=this.layout.get("text-writing-mode");if(h){const p=[];for(const x of h)p.indexOf(x)<0&&p.push(x);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(r,l,h,p){const x=this.layout.get(r).evaluate(l,{},h,p),w=this._unevaluatedLayout._values[r];return w.isDataDriven()||mr(w.value)||!x?x:(function(A,P){return P.replace(/{([^{}]+)}/g,((R,$)=>$ in A?String(A[$]):""))})(l.properties,x)}createBucket(r){return new jp(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of qx.paint.overridableProperties){if(!s1.hasPaintOverride(this.layout,r))continue;const l=this.paint.get(r),h=new z4(l),p=new jc(h,l.property.specification);let x=null;x=l.value.kind==="constant"||l.value.kind==="source"?new pl("source",p):new ru("composite",p,l.value.zoomStops,l.value._interpolationType),this.paint._values[r]=new Ue(l.property,x,l.parameters)}}_handleOverridablePaintPropertyUpdate(r,l,h){return!(!this.layout||l.isDataDriven()||h.isDataDriven())&&s1.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,l){const h=r.get("text-field"),p=qx.paint.properties[l];let x=!1;const w=A=>{for(const P of A)if(p.overrides&&p.overrides.hasOverride(P))return void(x=!0)};if(h.value.kind==="constant"&&h.value.value instanceof vo)w(h.value.value.sections);else if(h.value.kind==="source"){const A=R=>{x||(R instanceof Vs&&xo(R.value)===wl?w(R.value.sections):R instanceof Xa?w(R.sections):R.eachChild(A))},P=h.value;P._styleExpression&&A(P._styleExpression.expression)}return x}getProgramConfiguration(r){return new rh(this,r)}}var ML={paint:new st({"background-color":new _e(mn.paint_background["background-color"]),"background-pattern":new _e(mn.paint_background["background-pattern"]),"background-opacity":new _e(mn.paint_background["background-opacity"])})},NL={paint:new st({"raster-opacity":new _e(mn.paint_raster["raster-opacity"]),"raster-hue-rotate":new _e(mn.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new _e(mn.paint_raster["raster-brightness-min"]),"raster-brightness-max":new _e(mn.paint_raster["raster-brightness-max"]),"raster-saturation":new _e(mn.paint_raster["raster-saturation"]),"raster-contrast":new _e(mn.paint_raster["raster-contrast"]),"raster-resampling":new _e(mn.paint_raster["raster-resampling"]),"raster-fade-duration":new _e(mn.paint_raster["raster-fade-duration"])})};class DL extends au{constructor(r){super(r,{}),this.implementation=r}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}var FL={paint:new st({"sky-type":new _e(mn.paint_sky["sky-type"]),"sky-atmosphere-sun":new _e(mn.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new _e(mn.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new _e(mn.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new _e(mn.paint_sky["sky-gradient-radius"]),"sky-gradient":new it(mn.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new _e(mn.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new _e(mn.paint_sky["sky-atmosphere-color"]),"sky-opacity":new _e(mn.paint_sky["sky-opacity"])})};function $x(s,r,l){const h=[0,0,1],p=cr([]);return qr(p,p,l?-Z(s)+Math.PI:Z(s)),ri(p,p,-Z(r)),Xt(h,h,p),Ge(h,h)}const OL={circle:class extends au{constructor(s){super(s,j_)}createBucket(s){return new np(s)}queryRadius(s){const r=s;return rp("circle-radius",this,r)+rp("circle-stroke-width",this,r)+Np(this.paint.get("circle-translate"))}queryIntersectsFeature(s,r,l,h,p,x,w,A){const P=Ig(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,s.pixelToTileUnitsFactor),R=this.paint.get("circle-radius").evaluate(r,l)+this.paint.get("circle-stroke-width").evaluate(r,l);return W0(s,h,x,w,A,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",P,R)}getProgramIds(){return["circle"]}getProgramConfiguration(s){return new rh(this,s)}},heatmap:class extends au{createBucket(s){return new X0(s)}constructor(s){super(s,Nl),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=J0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(s){return rp("heatmap-radius",this,s)}queryIntersectsFeature(s,r,l,h,p,x,w,A){const P=this.paint.get("heatmap-radius").evaluate(r,l);return W0(s,h,x,w,A,!0,!0,new q(0,0),P)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(s){return new rh(this,s)}},hillshade:class extends au{constructor(s){super(s,U_)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends au{constructor(s){super(s,K)}getProgramIds(){const s=this.paint.get("fill-pattern"),r=s&&s.constantOr(1),l=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getProgramConfiguration(s){return new rh(this,s)}recalculate(s,r){super.recalculate(s,r);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new E(s)}queryRadius(){return Np(this.paint.get("fill-translate"))}queryIntersectsFeature(s,r,l,h,p,x){return!s.queryGeometry.isAboveHorizon&&Cm(xf(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,s.pixelToTileUnitsFactor),h)}isTileClipped(){return!0}},"fill-extrusion":class extends au{constructor(s){super(s,kC)}createBucket(s){return new oy(s)}queryRadius(){return Np(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(s){return new rh(this,s)}queryIntersectsFeature(s,r,l,h,p,x,w,A,P){const R=Ig(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,s.pixelToTileUnitsFactor),$=this.paint.get("fill-extrusion-height").evaluate(r,l),X=this.paint.get("fill-extrusion-base").evaluate(r,l),re=[0,0],he=A&&x.elevation,ye=x.elevation?x.elevation.exaggeration():1,Se=s.tile.getBucket(this);if(he&&Se instanceof oy){const _t=Se.centroidVertexArray,Ct=P+1;Ct<_t.length&&(re[0]=_t.geta_centroid_pos0(Ct),re[1]=_t.geta_centroid_pos1(Ct))}if(re[0]===0&&re[1]===1)return!1;x.projection.name==="globe"&&(h=X3([h],[new q(0,0),new q(Zr,Zr)],s.tileID.canonical).map((_t=>_t.polygon)).flat());const Ke=he?A:null,[at,xt]=(function(_t,Ct,It,sn,tn,Sn,$n,fn,kn,Rn,Vn){return _t.projection.name==="globe"?(function(Xn,wn,pr,zr,yr,Ki,Zn,ti,Xi,is,Zi){const bi=[],fa=[],Ji=Xn.projection.upVectorScale(Zi,Xn.center.lat,Xn.worldSize).metersToTile,Qi=[0,0,0,1],Fs=[0,0,0,1],Qs=(Os,qa,_l,Xl)=>{Os[0]=qa,Os[1]=_l,Os[2]=Xl,Os[3]=1},ea=K3();pr>0&&(pr+=ea),zr+=ea;for(const Os of wn){const qa=[],_l=[];for(const Xl of Os){const Bs=Xl.x+yr.x,mc=Xl.y+yr.y,Zl=Xn.projection.projectTilePoint(Bs,mc,Zi),al=Xn.projection.upVector(Zi,Xl.x,Xl.y);let cs=pr,Yl=zr;if(Zn){const ta=Q3(Bs,mc,pr,zr,Zn,ti,Xi,is);cs+=ta.base,Yl+=ta.top}pr!==0?Qs(Qi,Zl.x+al[0]*Ji*cs,Zl.y+al[1]*Ji*cs,Zl.z+al[2]*Ji*cs):Qs(Qi,Zl.x,Zl.y,Zl.z),Qs(Fs,Zl.x+al[0]*Ji*Yl,Zl.y+al[1]*Ji*Yl,Zl.z+al[2]*Ji*Yl),ft(Qi,Qi,Ki),ft(Fs,Fs,Ki),qa.push(new Ng(Qi[0],Qi[1],Qi[2])),_l.push(new Ng(Fs[0],Fs[1],Fs[2]))}bi.push(qa),fa.push(_l)}return[bi,fa]})(_t,Ct,It,sn,tn,Sn,$n,fn,kn,Rn,Vn):$n?(function(Xn,wn,pr,zr,yr,Ki,Zn,ti,Xi){const is=[],Zi=[],bi=[0,0,0,1];for(const fa of Xn){const Ji=[],Qi=[];for(const Fs of fa){const Qs=Fs.x+zr.x,ea=Fs.y+zr.y,Os=Q3(Qs,ea,wn,pr,Ki,Zn,ti,Xi);bi[0]=Qs,bi[1]=ea,bi[2]=Os.base,bi[3]=1,_r(bi,bi,yr),bi[3]=Math.max(bi[3],1e-5);const qa=new Ng(bi[0]/bi[3],bi[1]/bi[3],bi[2]/bi[3]);bi[0]=Qs,bi[1]=ea,bi[2]=Os.top,bi[3]=1,_r(bi,bi,yr),bi[3]=Math.max(bi[3],1e-5);const _l=new Ng(bi[0]/bi[3],bi[1]/bi[3],bi[2]/bi[3]);Ji.push(qa),Qi.push(_l)}is.push(Ji),Zi.push(Qi)}return[is,Zi]})(Ct,It,sn,tn,Sn,$n,fn,kn,Rn):(function(Xn,wn,pr,zr,yr){const Ki=[],Zn=[],ti=yr[8]*wn,Xi=yr[9]*wn,is=yr[10]*wn,Zi=yr[11]*wn,bi=yr[8]*pr,fa=yr[9]*pr,Ji=yr[10]*pr,Qi=yr[11]*pr;for(const Fs of Xn){const Qs=[],ea=[];for(const Os of Fs){const qa=Os.x+zr.x,_l=Os.y+zr.y,Xl=yr[0]*qa+yr[4]*_l+yr[12],Bs=yr[1]*qa+yr[5]*_l+yr[13],mc=yr[2]*qa+yr[6]*_l+yr[14],Zl=yr[3]*qa+yr[7]*_l+yr[15],al=Xl+ti,cs=Bs+Xi,Yl=mc+is,ta=Math.max(Zl+Zi,1e-5),ah=Xl+bi,Jl=Bs+fa,hu=mc+Ji,Hc=Math.max(Zl+Qi,1e-5);Qs.push(new Ng(al/ta,cs/ta,Yl/ta)),ea.push(new Ng(ah/Hc,Jl/Hc,hu/Hc))}Ki.push(Qs),Zn.push(ea)}return[Ki,Zn]})(Ct,It,sn,tn,Sn)})(x,h,X,$,R,w,Ke,re,ye,x.center.lat,s.tileID.canonical),ct=s.queryGeometry;return(function(_t,Ct,It){let sn=1/0;Cm(It,Ct)&&(sn=J3(It,Ct[0]));for(let tn=0;tn<Ct.length;tn++){const Sn=Ct[tn],$n=_t[tn];for(let fn=0;fn<Sn.length-1;fn++){const kn=Sn[fn],Rn=[kn,Sn[fn+1],$n[fn+1],$n[fn],kn];Eg(It,Rn)&&(sn=Math.min(sn,J3(It,Rn)))}}return sn!==1/0&&sn})(at,xt,ct.isPointQuery()?ct.screenBounds:ct.screenGeometry)}},line:class extends au{constructor(s){super(s,e4),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof ve,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(s,r){super.recalculate(s,r),this.paint._values["line-floorwidth"]=t4.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new H_(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(s){return new rh(this,s)}queryRadius(s){const r=s,l=n4(rp("line-width",this,r),rp("line-gap-width",this,r)),h=rp("line-offset",this,r);return l/2+Math.abs(h)+Np(this.paint.get("line-translate"))}queryIntersectsFeature(s,r,l,h,p,x){if(s.queryGeometry.isAboveHorizon)return!1;const w=xf(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,s.pixelToTileUnitsFactor),A=s.pixelToTileUnitsFactor/2*n4(this.paint.get("line-width").evaluate(r,l),this.paint.get("line-gap-width").evaluate(r,l)),P=this.paint.get("line-offset").evaluate(r,l);return P&&(h=(function(R,$){const X=[],re=new q(0,0);for(let he=0;he<R.length;he++){const ye=R[he],Se=[];for(let Ke=0;Ke<ye.length;Ke++){const at=ye[Ke],xt=ye[Ke+1],ct=Ke===0?re:at.sub(ye[Ke-1])._unit()._perp(),_t=Ke===ye.length-1?re:xt.sub(at)._unit()._perp(),Ct=ct._add(_t)._unit();Ct._mult(1/(Ct.x*_t.x+Ct.y*_t.y)),Se.push(Ct._mult($)._add(at))}X.push(Se)}return X})(h,P*s.pixelToTileUnitsFactor)),(function(R,$,X){for(let re=0;re<$.length;re++){const he=$[re];if(R.length>=3){for(let ye=0;ye<he.length;ye++)if(Gd(R,he[ye]))return!0}if(Uu(R,he,X))return!0}return!1})(w,h,A)}isTileClipped(){return!0}},symbol:s1,background:class extends au{constructor(s){super(s,ML)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends au{constructor(s){super(s,NL)}getProgramIds(){return["raster"]}},sky:class extends au{constructor(s){super(s,FL),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="sky-gradient"?this._updateColorRamp():s!=="sky-atmosphere-sun"&&s!=="sky-atmosphere-halo-color"&&s!=="sky-atmosphere-color"&&s!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=J0({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}return!1}getCenter(s,r){if(this.paint.get("sky-type")==="atmosphere"){const h=this.paint.get("sky-atmosphere-sun"),p=!h,x=s.style.light,w=x.properties.get("position");return p&&x.properties.get("anchor")==="viewport"&&dr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?$x(w.azimuthal,90-w.polar,r):$x(h[0],90-h[1],r)}const l=this.paint.get("sky-gradient-center");return $x(l[0],90-l[1],r)}is3D(){return!1}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return s==="atmosphere"?["skyboxCapture","skybox"]:s==="gradient"?["skyboxGradient"]:null}}};class gy{constructor(r,l,h,p){this.context=r,this.format=h,this.texture=r.gl.createTexture(),this.update(l,p)}update(r,l,h){const{width:p,height:x}=r,{context:w}=this,{gl:A}=w,{HTMLImageElement:P,HTMLCanvasElement:R,HTMLVideoElement:$,ImageData:X,ImageBitmap:re}=b;if(A.bindTexture(A.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===A.RGBA&&(!l||l.premultiply!==!1)),h||this.size&&this.size[0]===p&&this.size[1]===x){const{x:he,y:ye}=h||{x:0,y:0};r instanceof P||r instanceof R||r instanceof $||r instanceof X||re&&r instanceof re?A.texSubImage2D(A.TEXTURE_2D,0,he,ye,A.RGBA,A.UNSIGNED_BYTE,r):A.texSubImage2D(A.TEXTURE_2D,0,he,ye,p,x,A.RGBA,A.UNSIGNED_BYTE,r.data)}else this.size=[p,x],r instanceof P||r instanceof R||r instanceof $||r instanceof X||re&&r instanceof re?A.texImage2D(A.TEXTURE_2D,0,this.format,this.format,A.UNSIGNED_BYTE,r):A.texImage2D(A.TEXTURE_2D,0,this.format,p,x,0,this.format,A.UNSIGNED_BYTE,r.data);this.useMipmap=!!(l&&l.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&A.generateMipmap(A.TEXTURE_2D)}bind(r,l){const{context:h}=this,{gl:p}=h;p.bindTexture(p.TEXTURE_2D,this.texture),r!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,r),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?r===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_NEAREST:r),this.filter=r),l!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,l),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class BL{constructor(r){this._callback=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class zL{constructor(){this.tasks={},this.taskQueue=[],Jt(["process"],this),this.invoker=new BL(this.process),this.nextId=0}add(r,l){const h=this.nextId++,p=(function({type:x,isSymbolTile:w,zoom:A}){return A=A||0,x==="message"?0:x!=="maybePrepare"||w?x!=="parseTile"||w?x==="parseTile"&&w?300-A:x==="maybePrepare"&&w?400-A:500:200-A:100-A})(l);if(p===0){Ln();try{r()}finally{}return{cancel:()=>{}}}return this.tasks[h]={fn:r,metadata:l,priority:p,id:h},this.taskQueue.push(h),this.invoker.trigger(),{cancel:()=>{delete this.tasks[h]}}}process(){Ln();try{if(this.taskQueue=this.taskQueue.filter((h=>!!this.tasks[h])),!this.taskQueue.length)return;const r=this.pick();if(r===null)return;const l=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let r=null,l=1/0;for(let p=0;p<this.taskQueue.length;p++){const x=this.tasks[this.taskQueue[p]];x.priority<l&&(l=x.priority,r=p)}if(r===null)return null;const h=this.taskQueue[r];return this.taskQueue.splice(r,1),h}remove(){this.invoker.remove()}}class j4{constructor(r){this._stringToNumber={},this._numberToString=[];for(let l=0;l<r.length;l++){const h=r[l];this._stringToNumber[h]=l,this._numberToString[l]=h}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}const jL=["tile","layer","source","sourceLayer","state"];class U4{constructor(r,l,h,p,x){this.type="Feature",this._vectorTileFeature=r,this._z=l,this._x=h,this._y=p,this.properties=r.properties,this.id=x}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(r.id=this.id);for(const l of jL)this[l]!==void 0&&(r[l]=this[l]);return r}}const Cd=32,Ef=33,Up=new Uint16Array(8184);for(let s=0;s<2046;s++){let r=s+2,l=0,h=0,p=0,x=0,w=0,A=0;for(1&r?p=x=w=Cd:l=h=A=Cd;(r>>=1)>1;){const R=l+p>>1,$=h+x>>1;1&r?(p=l,x=h,l=w,h=A):(l=p,h=x,p=w,x=A),w=R,A=$}const P=4*s;Up[P+0]=l,Up[P+1]=h,Up[P+2]=p,Up[P+3]=x}const Af=new Uint16Array(2178),Vp=new Uint8Array(1089),a1=new Uint16Array(1089);function V4(s){return s===0?-.03125:s===32?.03125:0}var q4=Tt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const $4={type:2,extent:Zr,loadGeometry:()=>[[new q(0,0),new q(Zr+1,0),new q(Zr+1,Zr+1),new q(0,Zr+1),new q(0,0)]]};class Gx{constructor(r,l,h,p,x){this.tileID=r,this.uid=rt(),this.uses=0,this.tileSize=l,this.tileZoom=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=x,this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection)}registerFadeDuration(r){const l=r+this.timeAdded;l<Zo.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Bm(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,l,h){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=(function(p,x){const w={};if(!x)return w;for(const A of p){const P=A.layerIds.map((R=>x.getLayer(R))).filter(Boolean);if(P.length!==0){A.layers=P,A.stateDependentLayerIds&&(A.stateDependentLayers=A.stateDependentLayerIds.map((R=>P.filter(($=>$.id===R))[0])));for(const R of P)w[R.id]=A}}return w})(r.buckets,l.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const x=this.buckets[p];if(x instanceof jp){if(this.hasSymbolBuckets=!0,!h)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const x=this.buckets[p];if(x instanceof jp&&x.hasRTLText){this.hasRTLText=!0,z.isLoading()||z.isLoaded()||T()!=="deferred"||N();break}}this.queryPadding=0;for(const p in this.buckets){const x=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(p).queryRadius(x))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas)}else this.collisionBoxArray=new no}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(r){return this.buckets[r.id]}upload(r){for(const h in this.buckets){const p=this.buckets[h];p.uploadPending()&&p.upload(r)}const l=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new gy(r,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new gy(r,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new gy(r,this.lineAtlas.image,l.ALPHA),this.lineAtlas.uploaded=!0)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,l,h,p,x,w,A,P){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:p,pixelPosMatrix:A,transform:w,params:x,tileTransform:this.tileTransform},r,l,h):{}}querySourceFeatures(r,l){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const p=h.loadVTLayers(),x=l?l.sourceLayer:"",w=p._geojsonTileLayer||p[x];if(!w)return;const A=Qr(l&&l.filter),{z:P,x:R,y:$}=this.tileID.canonical,X={z:P,x:R,y:$};for(let re=0;re<w.length;re++){const he=w.feature(re);if(A.needGeometry){const Ke=Td(he,!0);if(!A.filter(new G(this.tileID.overscaledZ),Ke,this.tileID.canonical))continue}else if(!A.filter(new G(this.tileID.overscaledZ),he))continue;const ye=h.getId(he,x),Se=new U4(he,P,R,$,ye);Se.tile=X,r.push(Se)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const l=this.expirationTime;if(r.cacheControl){const h=ir(r.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const h=Date.now();let p=!1;if(this.expirationTime>h)p=!1;else if(l)if(this.expirationTime<l)p=!0;else{const x=this.expirationTime-l;x?this.expirationTime=h+Math.max(x,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(r,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(r).length===0||!l)return;const h=this.latestFeatureIndex.loadVTLayers(),p=l.style.listImages();for(const x in this.buckets){if(!l.style.hasLayer(x))continue;const w=this.buckets[x],A=w.layers[0].sourceLayer||"_geojsonTileLayer",P=h[A],R=r[A];if(!P||!R||Object.keys(R).length===0)continue;if(w.update(R,P,p,this.imageAtlas&&this.imageAtlas.patternPositions||{}),w instanceof H_||w instanceof E){const X=l.style._getSourceCache(w.layers[0].source);l._terrain&&l._terrain.enabled&&X&&w.programConfigurations.needsUpload&&l._terrain._clearRenderCacheForTile(X.id,this.tileID)}const $=l&&l.style&&l.style.getLayer(x);$&&(this.queryPadding=Math.max(this.queryPadding,$.queryRadius(w)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Zo.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=Zo.now()+r}setTexture(r,l){const h=l.context,p=h.gl;this.texture=this.texture||l.getTileTexture(r.width),this.texture?this.texture.update(r,{useMipmap:!0}):(this.texture=new gy(h,r,p.RGBA,{useMipmap:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE))}setDependencies(r,l){const h={};for(const p of l)h[p]=!0;this.dependencies[r]=h}hasDependency(r,l){for(const h of r){const p=this.dependencies[h];if(p){for(const x of l)if(p[x])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,l){if(!l||l.name==="mercator"||this._tileDebugBuffer)return;const h=wu($4,this.tileID.canonical,this.tileTransform)[0],p=new vn,x=new hc;for(let w=0;w<h.length;w++){const{x:A,y:P}=h[w];p.emplaceBack(A,P),x.emplaceBack(w)}x.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(x),this._tileDebugBuffer=r.createVertexBuffer(p,Bi.members),this._tileDebugSegments=Pa.simpleSegment(0,0,p.length,x.length)}_makeTileBoundsBuffers(r,l){if(this._tileBoundsBuffer||!l||l.name==="mercator")return;const h=wu($4,this.tileID.canonical,this.tileTransform)[0];let p,x;if(this.isRaster){const w=(function(A,P){const R=Bm(A,P),$=Math.pow(2,A.z);for(let Ke=0;Ke<Ef;Ke++)for(let at=0;at<Ef;at++){const xt=Kl((A.x+(at+V4(at))/Cd)/$),ct=Go((A.y+(Ke+V4(Ke))/Cd)/$),_t=P.project(xt,ct),Ct=Ke*Ef+at;Af[2*Ct+0]=Math.round((_t.x*R.scale-R.x)*Zr),Af[2*Ct+1]=Math.round((_t.y*R.scale-R.y)*Zr)}Vp.fill(0),a1.fill(0);for(let Ke=2045;Ke>=0;Ke--){const at=4*Ke,xt=Up[at+0],ct=Up[at+1],_t=Up[at+2],Ct=Up[at+3],It=xt+_t>>1,sn=ct+Ct>>1,tn=It+sn-ct,Sn=sn+xt-It,$n=ct*Ef+xt,fn=Ct*Ef+_t,kn=sn*Ef+It,Rn=Math.hypot((Af[2*$n+0]+Af[2*fn+0])/2-Af[2*kn+0],(Af[2*$n+1]+Af[2*fn+1])/2-Af[2*kn+1])>=16;Vp[kn]=Vp[kn]||(Rn?1:0),Ke<1022&&(Vp[kn]=Vp[kn]||Vp[(ct+Sn>>1)*Ef+(xt+tn>>1)]||Vp[(Ct+Sn>>1)*Ef+(_t+tn>>1)])}const X=new ln,re=new xr;let he=0;function ye(Ke,at){const xt=at*Ef+Ke;return a1[xt]===0&&(X.emplaceBack(Af[2*xt+0],Af[2*xt+1],Ke*Zr/Cd,at*Zr/Cd),a1[xt]=++he),a1[xt]-1}function Se(Ke,at,xt,ct,_t,Ct){const It=Ke+xt>>1,sn=at+ct>>1;if(Math.abs(Ke-_t)+Math.abs(at-Ct)>1&&Vp[sn*Ef+It])Se(_t,Ct,Ke,at,It,sn),Se(xt,ct,_t,Ct,It,sn);else{const tn=ye(Ke,at),Sn=ye(xt,ct),$n=ye(_t,Ct);re.emplaceBack(tn,Sn,$n)}}return Se(0,0,Cd,Cd,Cd,0),Se(Cd,Cd,0,0,0,Cd),{vertices:X,indices:re}})(this.tileID.canonical,l);p=w.vertices,x=w.indices}else{p=new ln,x=new xr;for(const{x:A,y:P}of h)p.emplaceBack(A,P,0,0);const w=Rg(p.int16,void 0,4);for(let A=0;A<w.length;A+=3)x.emplaceBack(w[A],w[A+1],w[A+2])}this._tileBoundsBuffer=r.createVertexBuffer(p,q4.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(x),this._tileBoundsSegments=Pa.simpleSegment(0,0,p.length,x.length)}_makeGlobeTileDebugBuffers(r,l){const h=l.projection;if(!h||h.name!=="globe"||l.freezeTileCoverage)return;const p=this.tileID.canonical,x=pc(cu(p,l)),w=ls(l.zoom);let A;w>0&&(A=kl(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(r,p,l,x,A,w),this._makeGlobeTileDebugTextBuffer(r,p,l,x,A,w)}_globePoint(r,l,h,p,x,w,A){let P=Wl(r,l,h);if(w){const R=1<<h.z,$=Is(p.center.lng),X=bs(p.center.lat),re=(h.x+.5)/R-$;let he=0;re>.5?he=-1:re<-.5&&(he=1);let ye=(r/Zr+h.x)/R+he,Se=(l/Zr+h.y)/R;ye=(ye-$)*p._pixelsPerMercatorPixel+$,Se=(Se-X)*p._pixelsPerMercatorPixel+X;const Ke=[ye*p.worldSize,Se*p.worldSize,0];ft(Ke,Ke,w),P=Wn(P,Ke,A)}return ft(P,P,x)}_makeGlobeTileDebugBorderBuffer(r,l,h,p,x,w){const A=new vn,P=new hc,R=new Bt,$=(re,he,ye,Se,Ke)=>{const at=(ye-re)/(Ke-1),xt=(Se-he)/(Ke-1),ct=A.length;for(let _t=0;_t<Ke;_t++){const Ct=re+_t*at,It=he+_t*xt;A.emplaceBack(Ct,It);const sn=this._globePoint(Ct,It,l,h,p,x,w);R.emplaceBack(sn[0],sn[1],sn[2]),P.emplaceBack(ct+_t)}},X=Zr;$(0,0,X,0,16),$(X,0,X,X,16),$(X,X,0,X,16),$(0,X,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(P),this._tileDebugBuffer=r.createVertexBuffer(A,Bi.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(R,Sr.members),this._tileDebugSegments=Pa.simpleSegment(0,0,A.length,P.length)}_makeGlobeTileDebugTextBuffer(r,l,h,p,x,w){const A=Zr/4,P=new vn,R=new xr,$=new Bt,X=25;R.reserve(32),P.reserve(X),$.reserve(X);const re=(he,ye)=>X*he+ye;for(let he=0;he<X;he++){const ye=he*A;for(let Se=0;Se<X;Se++){const Ke=Se*A;P.emplaceBack(Ke,ye);const at=this._globePoint(Ke,ye,l,h,p,x,w);$.emplaceBack(at[0],at[1],at[2])}}for(let he=0;he<4;he++)for(let ye=0;ye<4;ye++){const Se=re(he,ye),Ke=re(he,ye+1),at=re(he+1,ye),xt=re(he+1,ye+1);R.emplaceBack(Se,Ke,at),R.emplaceBack(at,Ke,xt)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(R),this._tileDebugTextBuffer=r.createVertexBuffer(P,Bi.members),this._globeTileDebugTextBuffer=r.createVertexBuffer($,Sr.members),this._tileDebugTextSegments=Pa.simpleSegment(0,0,X,32)}}class UL{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,l,h){const p=String(l);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][p]=this.stateChanges[r][p]||{},Be(this.stateChanges[r][p],h),this.deletedStates[r]===null){this.deletedStates[r]={};for(const x in this.state[r])x!==p&&(this.deletedStates[r][x]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][p]===null){this.deletedStates[r][p]={};for(const x in this.state[r][p])h[x]||(this.deletedStates[r][p][x]=null)}else for(const x in h)this.deletedStates[r]&&this.deletedStates[r][p]&&this.deletedStates[r][p][x]===null&&delete this.deletedStates[r][p][x]}removeFeatureState(r,l,h){if(this.deletedStates[r]===null)return;const p=String(l);if(this.deletedStates[r]=this.deletedStates[r]||{},h&&l!==void 0)this.deletedStates[r][p]!==null&&(this.deletedStates[r][p]=this.deletedStates[r][p]||{},this.deletedStates[r][p][h]=null);else if(l!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][p])for(h in this.deletedStates[r][p]={},this.stateChanges[r][p])this.deletedStates[r][p][h]=null;else this.deletedStates[r][p]=null;else this.deletedStates[r]=null}getState(r,l){const h=String(l),p=Be({},(this.state[r]||{})[h],(this.stateChanges[r]||{})[h]);if(this.deletedStates[r]===null)return{};if(this.deletedStates[r]){const x=this.deletedStates[r][l];if(x===null)return{};for(const w in x)delete p[w]}return p}initializeTileState(r,l){r.setFeatureState(this.state,l)}coalesceChanges(r,l){const h={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const x={};for(const w in this.stateChanges[p])this.state[p][w]||(this.state[p][w]={}),Be(this.state[p][w],this.stateChanges[p][w]),x[w]=this.state[p][w];h[p]=x}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const x={};if(this.deletedStates[p]===null)for(const w in this.state[p])x[w]={},this.state[p][w]={};else for(const w in this.deletedStates[p]){if(this.deletedStates[p][w]===null)this.state[p][w]={};else if(this.state[p][w])for(const A of Object.keys(this.deletedStates[p][w]))delete this.state[p][w][A];x[w]=this.state[p][w]}h[p]=h[p]||{},Be(h[p],x)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(const p in r)r[p].setFeatureState(h,l)}}class G4{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,l){const h=this.toIdx(r,l);return{min:this.minimums[h],max:this.maximums[h]}}isLeaf(r,l){return this.leaves[this.toIdx(r,l)]}toIdx(r,l){return l*this.size+r}}function H4(s,r,l,h){let p=0,x=Number.MAX_VALUE;for(let w=0;w<3;w++)if(Math.abs(h[w])<1e-15){if(l[w]<s[w]||l[w]>r[w])return null}else{const A=1/h[w];let P=(s[w]-l[w])*A,R=(r[w]-l[w])*A;if(P>R){const $=P;P=R,R=$}if(P>p&&(p=P),R<x&&(x=R),p>x)return null}return p}function W4(s,r,l,h,p,x,w,A,P,R,$){const X=h-s,re=p-r,he=x-l,ye=w-s,Se=A-r,Ke=P-l,at=$[1]*Ke-$[2]*Se,xt=$[2]*ye-$[0]*Ke,ct=$[0]*Se-$[1]*ye,_t=X*at+re*xt+he*ct;if(Math.abs(_t)<1e-15)return null;const Ct=1/_t,It=R[0]-s,sn=R[1]-r,tn=R[2]-l,Sn=(It*at+sn*xt+tn*ct)*Ct;if(Sn<0||Sn>1)return null;const $n=sn*he-tn*re,fn=tn*X-It*he,kn=It*re-sn*X,Rn=($[0]*$n+$[1]*fn+$[2]*kn)*Ct;return Rn<0||Sn+Rn>1?null:(ye*$n+Se*fn+Ke*kn)*Ct}function K4(s,r,l){return(s-r)/(l-r)}function X4(s,r,l,h,p,x,w,A,P){const R=1<<l,$=x-h,X=w-p,re=(s+1)/R*$+h,he=(r+0)/R*X+p,ye=(r+1)/R*X+p;A[0]=(s+0)/R*$+h,A[1]=he,P[0]=re,P[1]=ye}class Z4{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=(function(x){const w=Math.ceil(Math.log2(x.dim/8)),A=[];let P=Math.ceil(Math.pow(2,w));const R=1/P,$=(he,ye,Se,Ke,at)=>{const xt=Ke?1:0,ct=(he+1)*Se-xt,_t=ye*Se,Ct=(ye+1)*Se-xt;at[0]=he*Se,at[1]=_t,at[2]=ct,at[3]=Ct};let X=new G4(P);const re=[];for(let he=0;he<P*P;he++){$(he%P,Math.floor(he/P),R,!1,re);const ye=qp(re[0],re[1],x),Se=qp(re[2],re[1],x),Ke=qp(re[2],re[3],x),at=qp(re[0],re[3],x);X.minimums.push(Math.min(ye,Se,Ke,at)),X.maximums.push(Math.max(ye,Se,Ke,at)),X.leaves.push(1)}for(A.push(X),P/=2;P>=1;P/=2){const he=A[A.length-1];X=new G4(P);for(let ye=0;ye<P*P;ye++){$(ye%P,Math.floor(ye/P),2,!0,re);const Se=he.getElevation(re[0],re[1]),Ke=he.getElevation(re[2],re[1]),at=he.getElevation(re[2],re[3]),xt=he.getElevation(re[0],re[3]),ct=he.isLeaf(re[0],re[1]),_t=he.isLeaf(re[2],re[1]),Ct=he.isLeaf(re[2],re[3]),It=he.isLeaf(re[0],re[3]),sn=Math.min(Se.min,Ke.min,at.min,xt.min),tn=Math.max(Se.max,Ke.max,at.max,xt.max),Sn=ct&&_t&&Ct&&It;X.maximums.push(tn),X.minimums.push(sn),X.leaves.push(tn-sn<=5&&Sn?1:0)}A.push(X)}return A})(this.dem),h=l.length-1,p=l[h];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(l,0,0,h,0)}raycastRoot(r,l,h,p,x,w,A=1){return H4([r,l,-100],[h,p,this.maximums[0]*A],x,w)}raycast(r,l,h,p,x,w,A=1){if(!this.nodeCount)return null;const P=this.raycastRoot(r,l,h,p,x,w,A);if(P==null)return null;const R=[],$=[],X=[],re=[],he=[{idx:0,t:P,nodex:0,nodey:0,depth:0}];for(;he.length>0;){const{idx:ye,t:Se,nodex:Ke,nodey:at,depth:xt}=he.pop();if(this.leaves[ye]){X4(Ke,at,xt,r,l,h,p,X,re);const _t=1<<xt,Ct=(Ke+0)/_t,It=(Ke+1)/_t,sn=(at+0)/_t,tn=(at+1)/_t,Sn=qp(Ct,sn,this.dem)*A,$n=qp(It,sn,this.dem)*A,fn=qp(It,tn,this.dem)*A,kn=qp(Ct,tn,this.dem)*A,Rn=W4(X[0],X[1],Sn,re[0],X[1],$n,re[0],re[1],fn,x,w),Vn=W4(re[0],re[1],fn,X[0],re[1],kn,X[0],X[1],Sn,x,w),Xn=Math.min(Rn!==null?Rn:Number.MAX_VALUE,Vn!==null?Vn:Number.MAX_VALUE);if(Xn!==Number.MAX_VALUE)return Xn;{const wn=qe([],x,w,Se);if(Y4(Sn,$n,kn,fn,K4(wn[0],X[0],re[0]),K4(wn[1],X[1],re[1]))>=wn[2])return Se}continue}let ct=0;for(let _t=0;_t<this._siblingOffset.length;_t++){X4((Ke<<1)+this._siblingOffset[_t][0],(at<<1)+this._siblingOffset[_t][1],xt+1,r,l,h,p,X,re),X[2]=-100,re[2]=this.maximums[this.childOffsets[ye]+_t]*A;const Ct=H4(X,re,x,w);if(Ct!=null){const It=Ct;R[_t]=It;let sn=!1;for(let tn=0;tn<ct&&!sn;tn++)It>=R[$[tn]]&&($.splice(tn,0,_t),sn=!0);sn||($[ct]=_t),ct++}}for(let _t=0;_t<ct;_t++){const Ct=$[_t];he.push({idx:this.childOffsets[ye]+Ct,t:R[Ct],nodex:(Ke<<1)+this._siblingOffset[Ct][0],nodey:(at<<1)+this._siblingOffset[Ct][1],depth:xt+1})}}return null}_addNode(r,l,h){return this.minimums.push(r),this.maximums.push(l),this.leaves.push(h),this.childOffsets.push(0),this.nodeCount++}_construct(r,l,h,p,x){if(r[p].isLeaf(l,h)===1)return;this.childOffsets[x]||(this.childOffsets[x]=this.nodeCount);const w=p-1,A=r[w];let P=0,R=0;for(let $=0;$<this._siblingOffset.length;$++){const X=2*l+this._siblingOffset[$][0],re=2*h+this._siblingOffset[$][1],he=A.getElevation(X,re),ye=A.isLeaf(X,re),Se=this._addNode(he.min,he.max,ye);ye&&(P|=1<<$),R||(R=Se)}for(let $=0;$<this._siblingOffset.length;$++)P&1<<$||this._construct(r,2*l+this._siblingOffset[$][0],2*h+this._siblingOffset[$][1],w,R+$)}}function Y4(s,r,l,h,p,x){return He(He(s,l,x),He(r,h,x),p)}function qp(s,r,l){const h=l.dim,p=De(s*h-.5,0,h-1),x=De(r*h-.5,0,h-1),w=Math.floor(p),A=Math.floor(x),P=Math.min(w+1,h-1),R=Math.min(A+1,h-1);return Y4(l.get(w,A),l.get(P,A),l.get(w,R),l.get(P,R),p-w,x-A)}const J4={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function VL(s,r,l){return(256*s*256+256*r+l)/10-1e4}function qL(s,r,l){return 256*s+r+l/256-32768}class l1{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,l,h,p=!1,x=!1){if(this.uid=r,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(h&&h!=="mapbox"&&h!=="terrarium")return dr(`"${h}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const w=this.dim=l.height-2,A=new Uint32Array(l.data.buffer);if(this.pixels=new Uint8Array(l.data.buffer),this.encoding=h||"mapbox",this.borderReady=p,!p){for(let P=0;P<w;P++)A[this._idx(-1,P)]=A[this._idx(0,P)],A[this._idx(w,P)]=A[this._idx(w-1,P)],A[this._idx(P,-1)]=A[this._idx(P,0)],A[this._idx(P,w)]=A[this._idx(P,w-1)];A[this._idx(-1,-1)]=A[this._idx(0,0)],A[this._idx(w,-1)]=A[this._idx(w-1,0)],A[this._idx(-1,w)]=A[this._idx(0,w-1)],A[this._idx(w,w)]=A[this._idx(w-1,w-1)],x&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Z4(this)}get(r,l,h=!1){h&&(r=De(r,-1,this.dim),l=De(l,-1,this.dim));const p=4*this._idx(r,l);return(this.encoding==="terrarium"?qL:VL)(this.pixels[p],this.pixels[p+1],this.pixels[p+2])}static getUnpackVector(r){return J4[r]}get unpackVector(){return J4[this.encoding]}_idx(r,l){if(r<-1||r>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(r+1)}static pack(r,l){const h=[0,0,0,0],p=l1.getUnpackVector(l);let x=Math.floor((r+p[3])/p[2]);return h[2]=x%256,x=Math.floor(x/256),h[1]=x%256,x=Math.floor(x/256),h[0]=x,h}getPixels(){return new Vu({width:this.stride,height:this.stride},this.pixels)}backfillBorder(r,l,h){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let p=l*this.dim,x=l*this.dim+this.dim,w=h*this.dim,A=h*this.dim+this.dim;switch(l){case-1:p=x-1;break;case 1:x=p+1}switch(h){case-1:w=A-1;break;case 1:A=w+1}const P=-l*this.dim,R=-h*this.dim;for(let $=w;$<A;$++)for(let X=p;X<x;X++){const re=4*this._idx(X,$),he=4*this._idx(X+P,$+R);this.pixels[re+0]=r.pixels[he+0],this.pixels[re+1]=r.pixels[he+1],this.pixels[re+2]=r.pixels[he+2],this.pixels[re+3]=r.pixels[he+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}ur(l1,"DEMData"),ur(Z4,"DemMinMaxQuadTree",{omit:["dem"]});class $L{constructor(r,l){this.max=r,this.onRemove=l,this.reset()}reset(){for(const r in this.data)for(const l of this.data[r])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(r,l,h){const p=r.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const x={value:l,timeout:void 0};if(h!==void 0&&(x.timeout=setTimeout((()=>{this.remove(r,x)}),h)),this.data[p].push(x),this.order.push(p),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const l=this.data[r].shift();return l.timeout&&clearTimeout(l.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),l.value}getByKey(r){const l=this.data[r];return l?l[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,l){if(!this.has(r))return this;const h=r.wrapped().key,p=l===void 0?0:this.data[h].indexOf(l),x=this.data[h][p];return this.data[h].splice(p,1),x.timeout&&clearTimeout(x.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(x.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(r){const l=[];for(const h in this.data)for(const p of this.data[h])r(p.value)||l.push(p);for(const h of l)this.remove(h.value.tileID,h)}}class $g{constructor(r,l,h){this.func=r,this.mask=l,this.range=h}}$g.ReadOnly=!1,$g.ReadWrite=!0,$g.disabled=new $g(519,$g.ReadOnly,[0,1]);const Hx=7680;class Wx{constructor(r,l,h,p,x,w){this.test=r,this.ref=l,this.mask=h,this.fail=p,this.depthFail=x,this.pass=w}}Wx.disabled=new Wx({func:519,mask:0},0,0,Hx,Hx,Hx);class Tf{constructor(r,l,h){this.blendFunction=r,this.blendColor=l,this.mask=h}}Tf.Replace=[1,0],Tf.disabled=new Tf(Tf.Replace,Io.transparent,[!1,!1,!1,!1]),Tf.unblended=new Tf(Tf.Replace,Io.transparent,[!0,!0,!0,!0]),Tf.alphaBlended=new Tf([1,771],Io.transparent,[!0,!0,!0,!0]);const Kx=1029,Xx=2305;class Kd{constructor(r,l,h){this.enable=r,this.mode=l,this.frontFace=h}}Kd.disabled=new Kd(!1,Kx,Xx),Kd.backCCW=new Kd(!0,Kx,Xx),Kd.backCW=new Kd(!0,Kx,2304),Kd.frontCW=new Kd(!0,1028,2304),Kd.frontCCW=new Kd(!0,1028,Xx);class zm extends ra{constructor(r,l,h){super(),this.id=r,this._onlySymbols=h,l.on("data",(p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))})),l.on("error",(()=>{this._sourceErrored=!0})),this._source=l,this._tiles={},this._cache=new $L(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new UL,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(r){this.map=r,this._minTileCacheSize=this._minTileCacheSize===void 0&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles){const l=this._tiles[r];if(l.state!=="loaded"&&l.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,l){return r.isSymbolTile=this._onlySymbols,this._source.loadTile(r,l)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,(()=>{}))}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r,(()=>{}))}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const h=this._tiles[l];h.upload(r),h.prepare(this.map.style.imageManager)}}getIds(){return Ne(this._tiles).map((r=>r.tileID)).sort(Q4).map((r=>r.key))}getRenderableIds(r){const l=[];for(const h in this._tiles)this._isIdRenderable(+h,r)&&l.push(this._tiles[h]);return r?l.sort(((h,p)=>{const x=h.tileID,w=p.tileID,A=new q(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),P=new q(w.canonical.x,w.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-w.overscaledZ||P.y-A.y||P.x-A.x})).map((h=>h.tileID.key)):l.map((h=>h.tileID)).sort(Q4).map((h=>h.key))}hasRenderableParent(r){const l=this.findLoadedParent(r,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(r,l){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(l||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(+r,"reloading")}}_reloadTile(r,l){const h=this._tiles[r];h&&(h.state!=="loading"&&(h.state=l),this._loadTile(h,this._tileLoaded.bind(this,h,r,l)))}_tileLoaded(r,l,h,p){if(p)if(r.state="errored",p.status!==404)this._source.fire(new Sa(p,{tile:r}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const x=this.map.painter.terrain;this.update(this.transform,x.getScaledDemTileSize(),!0),x.resetTileLookupCache(this.id)}else this.update(this.transform);else r.timeAdded=Zo.now(),h==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(l,r),this._source.type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new rc("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const l=this.getRenderableIds();for(let p=0;p<l.length;p++){const x=l[p];if(r.neighboringTiles&&r.neighboringTiles[x]){const w=this.getTileByID(x);h(r,w),h(w,r)}}function h(p,x){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let w=x.tileID.canonical.x-p.tileID.canonical.x;const A=x.tileID.canonical.y-p.tileID.canonical.y,P=Math.pow(2,p.tileID.canonical.z),R=x.tileID.key;w===0&&A===0||Math.abs(A)>1||(Math.abs(w)>1&&(Math.abs(w+P)===1?w+=P:Math.abs(w-P)===1&&(w-=P)),x.dem&&p.dem&&(p.dem.backfillBorder(x.dem,w,A),p.neighboringTiles&&p.neighboringTiles[R]&&(p.neighboringTiles[R].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,l,h,p){for(const x in this._tiles){let w=this._tiles[x];if(p[x]||!w.hasData()||w.tileID.overscaledZ<=l||w.tileID.overscaledZ>h)continue;let A=w.tileID;for(;w&&w.tileID.overscaledZ>l+1;){const R=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[R.key],w&&w.hasData()&&(A=R)}let P=A;for(;P.overscaledZ>l;)if(P=P.scaledTo(P.overscaledZ-1),r[P.key]){p[A.key]=A;break}}}findLoadedParent(r,l){if(r.key in this._loadedParentTiles){const h=this._loadedParentTiles[r.key];return h&&h.tileID.overscaledZ>=l?h:null}for(let h=r.overscaledZ-1;h>=l;h--){const p=r.scaledTo(h),x=this._getLoadedTile(p);if(x)return x}}_getLoadedTile(r){const l=this._tiles[r.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,l){l=l||this._source.tileSize;const h=Math.ceil(r.width/l)+1,p=Math.ceil(r.height/l)+1,x=Math.floor(h*p*5),w=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,x):x,A=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(A)}handleWrapJump(r){const l=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,l){const h={};for(const p in this._tiles){const x=this._tiles[p];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+l),h[x.tileID.key]=x}this._tiles=h;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(r,l,h){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!h)return;let p;this.updateCacheSize(r,l),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=r.getVisibleUnwrappedCoordinates(this._source.tileID).map((A=>new sh(A.canonical.z,A.wrap,A.canonical.z,A.canonical.x,A.canonical.y))):(p=r.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(p=p.filter((A=>this._source.hasTile(A))))):p=[];const x=this._updateRetainedTiles(p);if(e2(this._source.type)&&p.length!==0){const A={},P={},R=Object.keys(x);for(const X of R){const re=x[X],he=this._tiles[X];if(!he||he.fadeEndTime&&he.fadeEndTime<=Zo.now())continue;const ye=this.findLoadedParent(re,Math.max(re.overscaledZ-zm.maxOverzooming,this._source.minzoom));ye&&(this._addTile(ye.tileID),A[ye.tileID.key]=ye.tileID),P[X]=re}const $=p[p.length-1].overscaledZ;for(const X in this._tiles){const re=this._tiles[X];if(x[X]||!re.hasData())continue;let he=re.tileID;for(;he.overscaledZ>$;){he=he.scaledTo(he.overscaledZ-1);const ye=this._tiles[he.key];if(ye&&ye.hasData()&&P[he.key]){x[X]=re.tileID;break}}}for(const X in A)x[X]||(this._coveredTiles[X]=!0,x[X]=A[X])}for(const A in x)this._tiles[A].clearFadeHold();const w=(function(A,P){const R=[];for(const $ in A)$ in P||R.push($);return R})(this._tiles,x);for(const A of w){const P=this._tiles[A];P.hasSymbolBuckets&&!P.holdingForFade()?P.setHoldDuration(this.map._fadeDuration):P.hasSymbolBuckets&&!P.symbolFadeFinished()||this._removeTile(+A)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const l={};if(r.length===0)return l;const h={},p=r.reduce(((R,$)=>Math.min(R,$.overscaledZ)),1/0),x=r[0].overscaledZ,w=Math.max(x-zm.maxOverzooming,this._source.minzoom),A=Math.max(x+zm.maxUnderzooming,this._source.minzoom),P={};for(const R of r){const $=this._addTile(R);l[R.key]=R,$.hasData()||p<this._source.maxzoom&&(P[R.key]=R)}this._retainLoadedChildren(P,p,A,l);for(const R of r){let $=this._tiles[R.key];if($.hasData())continue;if(R.canonical.z>=this._source.maxzoom){const re=R.children(this._source.maxzoom)[0],he=this.getTile(re);if(he&&he.hasData()){l[re.key]=re;continue}}else{const re=R.children(this._source.maxzoom);if(l[re[0].key]&&l[re[1].key]&&l[re[2].key]&&l[re[3].key])continue}let X=$.wasRequested();for(let re=R.overscaledZ-1;re>=w;--re){const he=R.scaledTo(re);if(h[he.key]||(h[he.key]=!0,$=this.getTile(he),!$&&X&&($=this._addTile(he)),$&&(l[he.key]=he,X=$.wasRequested(),$.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const l=[];let h,p=this._tiles[r].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){h=this._loadedParentTiles[p.key];break}l.push(p.key);const x=p.scaledTo(p.overscaledZ-1);if(h=this._getLoadedTile(x),h)break;p=x}for(const x of l)this._loadedParentTiles[x]=h}}_addTile(r){let l=this._tiles[r.key];if(l)return l;l=this._cache.getAndRemove(r),l&&(this._setTileReloadTimer(r.key,l),l.tileID=r,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,l)));const h=!!l;if(!h){const p=this.map?this.map.painter:null;l=new Gx(r,this._source.tileSize*r.overscaleFactor(),this.transform.tileZoom,p,this._isRaster),this._loadTile(l,this._tileLoaded.bind(this,l,r.key,l.state))}return l?(l.uses++,this._tiles[r.key]=l,h||this._source.fire(new rc("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(r,l){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const h=l.getExpiryTimeout();h&&(this._timers[r]=setTimeout((()=>{this._reloadTile(r,"expired"),delete this._timers[r]}),h))}_removeTile(r){const l=this._tiles[r];l&&(l.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),l.uses>0||(l.hasData()&&l.state!=="reloading"?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,l,h){const p=[],x=this.transform;if(!x)return p;const w=x.projection.name==="globe",A=Is(x.center.lng);for(const P in this._tiles){const R=this._tiles[P];if(h&&R.clearQueryDebugViz(),R.holdingForFade())continue;let $;if(w){const X=R.tileID.canonical;if(X.z===0){const re=[Math.abs(De(A,...yy(X,-1))-A),Math.abs(De(A,...yy(X,1))-A)];$=[0,2*re.indexOf(Math.min(...re))-1]}else{const re=[Math.abs(De(A,...yy(X,-1))-A),Math.abs(De(A,...yy(X,0))-A),Math.abs(De(A,...yy(X,1))-A)];$=[re.indexOf(Math.min(...re))-1]}}else $=[0];for(const X of $){const re=r.containsTile(R,x,l,X);re&&p.push(re)}}return p}getVisibleCoordinates(r){const l=this.getRenderableIds(r).map((h=>this._tiles[h].tileID));for(const h of l)h.projMatrix=this.transform.calculateProjMatrix(h.toUnwrapped());return l}hasTransition(){if(this._source.hasTransition())return!0;if(e2(this._source.type))for(const r in this._tiles){const l=this._tiles[r];if(l.fadeEndTime!==void 0&&l.fadeEndTime>=Zo.now())return!0}return!1}setFeatureState(r,l,h){this._state.updateState(r=r||"_geojsonTileLayer",l,h)}removeFeatureState(r,l,h){this._state.removeFeatureState(r=r||"_geojsonTileLayer",l,h)}getFeatureState(r,l){return this._state.getState(r=r||"_geojsonTileLayer",l)}setDependencies(r,l,h){const p=this._tiles[r];p&&p.setDependencies(l,h)}reloadTilesForDependencies(r,l){for(const h in this._tiles)this._tiles[h].hasDependency(r,l)&&this._reloadTile(+h,"reloading");this._cache.filter((h=>!h.hasDependency(r,l)))}_preloadTiles(r,l){if(!this._sourceLoaded){const A=()=>{this._sourceLoaded&&(this._source.off("data",A),this._preloadTiles(r,l))};return void this._source.on("data",A)}const h=new Map,p=Array.isArray(r)?r:[r],x=this.map.painter.terrain,w=this.usedForTerrain&&x?x.getScaledDemTileSize():this._source.tileSize;for(const A of p){const P=A.coveringTiles({tileSize:w,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const R of P)h.set(R.key,R);this.usedForTerrain&&A.updateElevation(!1)}le(Array.from(h.values()),((A,P)=>{const R=new Gx(A,this._source.tileSize*A.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(R,($=>{this._source.type==="raster-dem"&&R.dem&&this._backfillDEM(R),P($,R)}))}),l)}}function Q4(s,r){const l=Math.abs(2*s.wrap)-+(s.wrap<0),h=Math.abs(2*r.wrap)-+(r.wrap<0);return s.overscaledZ-r.overscaledZ||h-l||r.canonical.y-s.canonical.y||r.canonical.x-s.canonical.x}function e2(s){return s==="raster"||s==="image"||s==="video"||s==="custom"}function yy(s,r){const l=1<<s.z;return[s.x/l+r,(s.x+1)/l+r]}zm.maxOverzooming=10,zm.maxUnderzooming=3;class c1{constructor(r,l,h){this._demTile=r,this._dem=this._demTile.dem,this._scale=l,this._offset=h}static create(r,l,h){const p=h||r.findDEMTileFor(l);if(!p||!p.dem)return;const x=p.dem,w=p.tileID,A=1<<l.canonical.z-w.canonical.z;return new c1(p,p.tileSize/Zr/A,[(l.canonical.x/A-w.canonical.x)*x.dim,(l.canonical.y/A-w.canonical.y)*x.dim])}tileCoordToPixel(r,l){const h=l*this._scale+this._offset[1],p=Math.floor(r*this._scale+this._offset[0]),x=Math.floor(h);return new q(p,x)}getElevationAt(r,l,h,p){const x=r*this._scale+this._offset[0],w=l*this._scale+this._offset[1],A=Math.floor(x),P=Math.floor(w),R=this._dem;return p=!!p,h?He(He(R.get(A,P,p),R.get(A,P+1,p),w-P),He(R.get(A+1,P,p),R.get(A+1,P+1,p),w-P),x-A):R.get(A,P,p)}getElevationAtPixel(r,l,h){return this._dem.get(r,l,!!h)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*Va(1,r)*this._dem.stride}}class t2{constructor(r,l){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new Cl(Zr,16,0),this.featureIndexArray=new xs,this.promoteId=l}insert(r,l,h,p,x,w=0){const A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,p,x,w);const P=this.grid;for(let R=0;R<l.length;R++){const $=l[R],X=[1/0,1/0,-1/0,-1/0];for(let re=0;re<$.length;re++){const he=$[re];X[0]=Math.min(X[0],he.x),X[1]=Math.min(X[1],he.y),X[2]=Math.max(X[2],he.x),X[3]=Math.max(X[3],he.y)}X[0]<Zr&&X[1]<Zr&&X[2]>=0&&X[3]>=0&&P.insert(A,X[0],X[1],X[2],X[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new fi(new X_(this.rawTileData)).layers,this.sourceLayerCoder=new j4(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,l,h,p){this.loadVTLayers();const x=r.params||{},w=Qr(x.filter),A=r.tileResult,P=r.transform,R=A.bufferedTilespaceBounds,$=this.grid.query(R.min.x,R.min.y,R.max.x,R.max.y,((ye,Se,Ke,at)=>z_(A.bufferedTilespaceGeometry,ye,Se,Ke,at)));$.sort(GL);let X=null;P.elevation&&$.length>0&&(X=c1.create(P.elevation,this.tileID));const re={};let he;for(let ye=0;ye<$.length;ye++){const Se=$[ye];if(Se===he)continue;he=Se;const Ke=this.featureIndexArray.get(Se);let at=null;this.loadMatchingFeature(re,Ke,w,x.layers,x.availableImages,l,h,p,((xt,ct,_t,Ct=0)=>(at||(at=wu(xt,this.tileID.canonical,r.tileTransform)),ct.queryIntersectsFeature(A,xt,_t,at,this.z,r.transform,r.pixelPosMatrix,X,Ct))))}return re}loadMatchingFeature(r,l,h,p,x,w,A,P,R){const{featureIndex:$,bucketIndex:X,sourceLayerIndex:re,layoutVertexArrayOffset:he}=l,ye=this.bucketLayerIDs[X];if(p&&!(function(xt,ct){for(let _t=0;_t<xt.length;_t++)if(ct.indexOf(xt[_t])>=0)return!0;return!1})(p,ye))return;const Se=this.sourceLayerCoder.decode(re),Ke=this.vtLayers[Se].feature($);if(h.needGeometry){const xt=Td(Ke,!0);if(!h.filter(new G(this.tileID.overscaledZ),xt,this.tileID.canonical))return}else if(!h.filter(new G(this.tileID.overscaledZ),Ke))return;const at=this.getId(Ke,Se);for(let xt=0;xt<ye.length;xt++){const ct=ye[xt];if(p&&p.indexOf(ct)<0)continue;const _t=w[ct];if(!_t)continue;let Ct={};at!==void 0&&P&&(Ct=P.getState(_t.sourceLayer||"_geojsonTileLayer",at));const It=Be({},A[ct]);It.paint=n2(It.paint,_t.paint,Ke,Ct,x),It.layout=n2(It.layout,_t.layout,Ke,Ct,x);const sn=!R||R(Ke,_t,Ct,he);if(!sn)continue;const tn=new U4(Ke,this.z,this.x,this.y,at);tn.layer=It;let Sn=r[ct];Sn===void 0&&(Sn=r[ct]=[]),Sn.push({featureIndex:$,feature:tn,intersectionZ:sn})}}lookupSymbolFeatures(r,l,h,p,x,w,A,P){const R={};this.loadVTLayers();const $=Qr(x);for(const X of r)this.loadMatchingFeature(R,{bucketIndex:h,sourceLayerIndex:p,featureIndex:X,layoutVertexArrayOffset:0},$,w,A,P,l);return R}loadFeature(r){const{featureIndex:l,sourceLayerIndex:h}=r;this.loadVTLayers();const p=this.sourceLayerCoder.decode(h),x=this.vtFeatures[p];if(x[l])return x[l];const w=this.vtLayers[p].feature(l);return x[l]=w,w}hasLayer(r){for(const l of this.bucketLayerIDs)for(const h of l)if(r===h)return!0;return!1}getId(r,l){let h=r.id;if(this.promoteId){const p=typeof this.promoteId=="string"?this.promoteId:this.promoteId[l];p!=null&&(h=r.properties[p]),typeof h=="boolean"&&(h=Number(h))}return h}}function n2(s,r,l,h,p){return yn(s,((x,w)=>{const A=r instanceof Ze?r.get(w):null;return A&&A.evaluate?A.evaluate(l,h,p):A}))}function GL(s,r){return r-s}ur(t2,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class r2{constructor(r,l){this.width=r,this.height=l,this.nextRow=0,this.image=new oh({width:r,height:l}),this.positions={},this.uploaded=!1}getDash(r,l){const h=this.getKey(r,l);return this.positions[h]}trim(){const r=this.width,l=this.height=pt(this.nextRow);this.image.resize({width:r,height:l})}getKey(r,l){return r.join(",")+l}getDashRanges(r,l,h){const p=[];let x=r.length%2==1?-r[r.length-1]*h:0,w=r[0]*h,A=!0;p.push({left:x,right:w,isDash:A,zeroLength:r[0]===0});let P=r[0];for(let R=1;R<r.length;R++){A=!A;const $=r[R];x=P*h,P+=$,w=P*h,p.push({left:x,right:w,isDash:A,zeroLength:$===0})}return p}addRoundDash(r,l,h){const p=l/2;for(let x=-h;x<=h;x++){const w=this.width*(this.nextRow+h+x);let A=0,P=r[A];for(let R=0;R<this.width;R++){R/P.right>1&&(P=r[++A]);const $=Math.abs(R-P.left),X=Math.abs(R-P.right),re=Math.min($,X);let he;const ye=x/h*(p+1);if(P.isDash){const Se=p-Math.abs(ye);he=Math.sqrt(re*re+Se*Se)}else he=p-Math.sqrt(re*re+ye*ye);this.image.data[w+R]=Math.max(0,Math.min(255,he+128))}}}addRegularDash(r,l){for(let P=r.length-1;P>=0;--P){const R=r[P],$=r[P+1];R.zeroLength?r.splice(P,1):$&&$.isDash===R.isDash&&($.left=R.left,r.splice(P,1))}const h=r[0],p=r[r.length-1];h.isDash===p.isDash&&(h.left=p.left-this.width,p.right=h.right+this.width);const x=this.width*this.nextRow;let w=0,A=r[w];for(let P=0;P<this.width;P++){P/A.right>1&&(A=r[++w]);const R=Math.abs(P-A.left),$=Math.abs(P-A.right),X=Math.min(R,$);this.image.data[x+P]=Math.max(0,Math.min(255,(A.isDash?X:-X)+l+128))}}addDash(r,l){const h=this.getKey(r,l);if(this.positions[h])return this.positions[h];const p=l==="round",x=p?7:0,w=2*x+1;if(this.nextRow+w>this.height)return dr("LineAtlas out of space"),null;r.length===0&&r.push(1);let A=0;for(let $=0;$<r.length;$++)r[$]<0&&(dr("Negative value is found in line dasharray, replacing values with 0"),r[$]=0),A+=r[$];if(A!==0){const $=this.width/A,X=this.getDashRanges(r,this.width,$);p?this.addRoundDash(X,$,x):this.addRegularDash(X,l==="square"?.5*$:0)}const P=this.nextRow+x;this.nextRow+=w;const R={tl:[P,x],br:[A,0]};return this.positions[h]=R,R}}ur(r2,"LineAtlas");const i2=1*Wd;class o2{constructor(r){const l={},h=[];for(const A in r){const P=r[A],R=l[A]={};for(const $ in P.glyphs){const X=P.glyphs[+$];if(!X||X.bitmap.width===0||X.bitmap.height===0)continue;const re=X.metrics.localGlyph?i2:1,he={x:0,y:0,w:X.bitmap.width+2*re,h:X.bitmap.height+2*re};h.push(he),R[$]=he}}const{w:p,h:x}=Mx(h),w=new oh({width:p||1,height:x||1});for(const A in r){const P=r[A];for(const R in P.glyphs){const $=P.glyphs[+R];if(!$||$.bitmap.width===0||$.bitmap.height===0)continue;const X=l[A][R],re=$.metrics.localGlyph?i2:1;oh.copy($.bitmap,w,{x:0,y:0},{x:X.x+re,y:X.y+re},$.bitmap)}}this.image=w,this.positions=l}}ur(o2,"GlyphAtlas");class HL{constructor(r){this.tileID=new sh(r.tileID.overscaledZ,r.tileID.wrap,r.tileID.canonical.z,r.tileID.canonical.x,r.tileID.canonical.y),this.tileZoom=r.tileZoom,this.uid=r.uid,this.zoom=r.zoom,this.canonical=r.tileID.canonical,this.pixelRatio=r.pixelRatio,this.tileSize=r.tileSize,this.source=r.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=r.showCollisionBoxes,this.collectResourceTiming=!!r.collectResourceTiming,this.returnDependencies=!!r.returnDependencies,this.promoteId=r.promoteId,this.enableTerrain=!!r.enableTerrain,this.isSymbolTile=r.isSymbolTile,this.tileTransform=Bm(r.tileID.canonical,r.projection),this.projection=r.projection}parse(r,l,h,p,x){this.status="parsing",this.data=r,this.collisionBoxArray=new no;const w=new j4(Object.keys(r.layers).sort()),A=new t2(this.tileID,this.promoteId);A.bucketLayerIDs=[];const P={},R=new r2(256,256),$={featureIndex:A,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:R,availableImages:h},X=l.familiesBySource[this.source];for(const Ct in X){const It=r.layers[Ct];if(!It)continue;let sn=!1,tn=!1;for(const fn of X[Ct])fn[0].type==="symbol"?sn=!0:tn=!0;if(this.isSymbolTile===!0&&!sn||this.isSymbolTile===!1&&!tn)continue;It.version===1&&dr(`Vector tile source "${this.source}" layer "${Ct}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Sn=w.encode(Ct),$n=[];for(let fn=0;fn<It.length;fn++){const kn=It.feature(fn),Rn=A.getId(kn,Ct);$n.push({feature:kn,id:Rn,index:fn,sourceLayerIndex:Sn})}for(const fn of X[Ct]){const kn=fn[0];this.isSymbolTile!==void 0&&kn.type==="symbol"!==this.isSymbolTile||kn.minzoom&&this.zoom<Math.floor(kn.minzoom)||kn.maxzoom&&this.zoom>=kn.maxzoom||kn.visibility!=="none"&&(Zx(fn,this.zoom,h),(P[kn.id]=kn.createBucket({index:A.bucketLayerIDs.length,layers:fn,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Sn,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:h})).populate($n,$,this.tileID.canonical,this.tileTransform),A.bucketLayerIDs.push(fn.map((Rn=>Rn.id))))}}let re,he,ye,Se;R.trim();const Ke={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},at=()=>{if(re)return x(re);if(he&&ye&&Se){const Ct=new o2(he),It=new d4(ye,Se);for(const sn in P){const tn=P[sn];tn instanceof jp?(Zx(tn.layers,this.zoom,h),_L(tn,he,Ct.positions,ye,It.iconPositions,this.showCollisionBoxes,h,this.tileID.canonical,this.tileZoom,this.projection)):tn.hasPattern&&(tn instanceof H_||tn instanceof E||tn instanceof oy)&&(Zx(tn.layers,this.zoom,h),tn.addFeatures($,this.tileID.canonical,It.patternPositions,h,this.tileTransform))}this.status="done",x(null,{buckets:Ne(P).filter((sn=>!sn.isEmpty())),featureIndex:A,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ct.image,lineAtlas:R,imageAtlas:It,glyphMap:this.returnDependencies?he:null,iconMap:this.returnDependencies?ye:null,glyphPositions:this.returnDependencies?Ct.positions:null})}},xt=yn($.glyphDependencies,(Ct=>Object.keys(Ct).map(Number)));Object.keys(xt).length?p.send("getGlyphs",{uid:this.uid,stacks:xt},((Ct,It)=>{re||(re=Ct,he=It,at())}),void 0,!1,Ke):he={};const ct=Object.keys($.iconDependencies);ct.length?p.send("getImages",{icons:ct,source:this.source,tileID:this.tileID,type:"icons"},((Ct,It)=>{re||(re=Ct,ye=It,at())}),void 0,!1,Ke):ye={};const _t=Object.keys($.patternDependencies);_t.length?p.send("getImages",{icons:_t,source:this.source,tileID:this.tileID,type:"patterns"},((Ct,It)=>{re||(re=Ct,Se=It,at())}),void 0,!1,Ke):Se={},at()}}function Zx(s,r,l){const h=new G(r);for(const p of s)p.recalculate(h,l)}class s2{constructor(r){this.entries={},this.scheduler=r}request(r,l,h,p){const x=this.entries[r]=this.entries[r]||{callbacks:[]};if(x.result){const[w,A]=x.result;return this.scheduler?this.scheduler.add((()=>{p(w,A)}),l):p(w,A),()=>{}}return x.callbacks.push(p),x.cancel||(x.cancel=h(((w,A)=>{x.result=[w,A];for(const P of x.callbacks)this.scheduler?this.scheduler.add((()=>{P(w,A)}),l):P(w,A);setTimeout((()=>delete this.entries[r]),3e3)}))),()=>{x.result||(x.callbacks=x.callbacks.filter((w=>w!==p)),x.callbacks.length||(x.cancel(),delete this.entries[r]))}}}function a2(s,r,l){const h=JSON.stringify(s.request);return s.data&&(this.deduped.entries[h]={result:[null,s.data]}),this.deduped.request(h,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},(p=>{const x=hi(s.request,((w,A,P,R)=>{w?p(w):A&&p(null,{vectorTile:l?void 0:new fi(new X_(A)),rawData:A,cacheControl:P,expires:R})}));return()=>{x.cancel(),p()}}),r)}const l2=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Yx{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,h]=new Uint8Array(r,0,2);if(l!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=h>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const x=l2[15&h];if(!x)throw new Error("Unrecognized array type.");const[w]=new Uint16Array(r,2,1),[A]=new Uint32Array(r,4,1);return new Yx(A,w,x,r)}constructor(r,l=64,h=Float64Array,p){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=h,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const x=l2.indexOf(this.ArrayType),w=2*r*this.ArrayType.BYTES_PER_ELEMENT,A=r*this.IndexArrayType.BYTES_PER_ELEMENT,P=(8-A%8)%8;if(x<0)throw new Error(`Unexpected typed array class: ${h}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+A+P,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+w+A+P),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+A+P,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+x]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=r)}add(r,l){const h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=r,this.coords[this._pos++]=l,h}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return Jx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,l,h,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:x,coords:w,nodeSize:A}=this,P=[0,x.length-1,0],R=[];for(;P.length;){const $=P.pop()||0,X=P.pop()||0,re=P.pop()||0;if(X-re<=A){for(let Ke=re;Ke<=X;Ke++){const at=w[2*Ke],xt=w[2*Ke+1];at>=r&&at<=h&&xt>=l&&xt<=p&&R.push(x[Ke])}continue}const he=re+X>>1,ye=w[2*he],Se=w[2*he+1];ye>=r&&ye<=h&&Se>=l&&Se<=p&&R.push(x[he]),($===0?r<=ye:l<=Se)&&(P.push(re),P.push(he-1),P.push(1-$)),($===0?h>=ye:p>=Se)&&(P.push(he+1),P.push(X),P.push(1-$))}return R}within(r,l,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:x,nodeSize:w}=this,A=[0,p.length-1,0],P=[],R=h*h;for(;A.length;){const $=A.pop()||0,X=A.pop()||0,re=A.pop()||0;if(X-re<=w){for(let Ke=re;Ke<=X;Ke++)u2(x[2*Ke],x[2*Ke+1],r,l)<=R&&P.push(p[Ke]);continue}const he=re+X>>1,ye=x[2*he],Se=x[2*he+1];u2(ye,Se,r,l)<=R&&P.push(p[he]),($===0?r-h<=ye:l-h<=Se)&&(A.push(re),A.push(he-1),A.push(1-$)),($===0?r+h>=ye:l+h>=Se)&&(A.push(he+1),A.push(X),A.push(1-$))}return P}}function Jx(s,r,l,h,p,x){if(p-h<=l)return;const w=h+p>>1;c2(s,r,w,h,p,x),Jx(s,r,l,h,w-1,1-x),Jx(s,r,l,w+1,p,1-x)}function c2(s,r,l,h,p,x){for(;p>h;){if(p-h>600){const R=p-h+1,$=l-h+1,X=Math.log(R),re=.5*Math.exp(2*X/3),he=.5*Math.sqrt(X*re*(R-re)/R)*($-R/2<0?-1:1);c2(s,r,l,Math.max(h,Math.floor(l-$*re/R+he)),Math.min(p,Math.floor(l+(R-$)*re/R+he)),x)}const w=r[2*l+x];let A=h,P=p;for(_y(s,r,h,l),r[2*p+x]>w&&_y(s,r,h,p);A<P;){for(_y(s,r,A,P),A++,P--;r[2*A+x]<w;)A++;for(;r[2*P+x]>w;)P--}r[2*h+x]===w?_y(s,r,h,P):(P++,_y(s,r,P,p)),P<=l&&(h=P+1),l<=P&&(p=P-1)}}function _y(s,r,l,h){Qx(s,l,h),Qx(r,2*l,2*h),Qx(r,2*l+1,2*h+1)}function Qx(s,r,l){const h=s[r];s[r]=s[l],s[l]=h}function u2(s,r,l,h){const p=s-l,x=r-h;return p*p+x*x}o.ARRAY_TYPE=Pc,o.AUTH_ERR_MSG=ht,o.Aabb=Dn,o.Actor=class{constructor(s,r,l){this.target=s,this.parent=r,this.mapId=l,this.callbacks={},this.cancelCallbacks={},Jt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ln()?s:b,this.scheduler=new zL}send(s,r,l,h,p=!1,x){const w=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=x,this.callbacks[w]=l);const A=Kr(this.globalScope)?void 0:[];return this.target.postMessage({id:w,type:s,hasCallback:!!l,targetMapId:h,mustQueue:p,sourceMapId:this.mapId,data:B(r,A)},A),{cancel:()=>{l&&delete this.callbacks[w],this.target.postMessage({id:w,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(s){const r=s.data,l=r.id;if(l&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){const h=this.cancelCallbacks[l];delete this.cancelCallbacks[l],h&&h.cancel()}else if(r.mustQueue||Ln()){const h=this.callbacks[l];this.cancelCallbacks[l]=this.scheduler.add((()=>this.processTask(l,r)),h&&h.metadata||{type:"message"})}else this.processTask(l,r)}processTask(s,r){if(r.type==="<response>"){const l=this.callbacks[s];delete this.callbacks[s],l&&(r.error?l(ee(r.error)):l(null,ee(r.data)))}else{const l=Kr(this.globalScope)?void 0:[],h=r.hasCallback?(x,w)=>{delete this.cancelCallbacks[s],this.target.postMessage({id:s,type:"<response>",sourceMapId:this.mapId,error:x?B(x):null,data:B(w,l)},l)}:x=>{},p=ee(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,p,h);else if(this.parent.getWorkerSource){const x=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,x[0],p.source)[x[1]](p,h)}else h(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.CanonicalTileID=G_,o.Color=Io,o.ColorMode=Tf,o.CullFaceMode=Kd,o.DEMData=l1,o.DataConstantProperty=_e,o.DedupedRequest=s2,o.DepthMode=$g,o.EXTENT=Zr,o.Elevation=class{isDataAvailableAtPoint(s){const r=this._source();if(this.isUsingMockSource()||!r||s.y<0||s.y>1)return!1;const l=r.getSource().maxzoom,h=1<<l,p=Math.floor(s.x),x=Math.floor((s.x-p)*h),w=Math.floor(s.y*h),A=this.findDEMTileFor(new sh(l,p,l,x,w));return!(!A||!A.dem)}getAtPointOrZero(s,r=0){return this.getAtPoint(s,r)||0}getAtPoint(s,r,l=!0){if(this.isUsingMockSource())return null;r==null&&(r=null);const h=this._source();if(!h||s.y<0||s.y>1)return r;const p=h.getSource().maxzoom,x=1<<p,w=Math.floor(s.x),A=s.x-w,P=new sh(p,w,p,Math.floor(A*x),Math.floor(s.y*x)),R=this.findDEMTileFor(P);if(!R||!R.dem)return r;const $=R.dem,X=1<<R.tileID.canonical.z,re=(A*X-R.tileID.canonical.x)*$.dim,he=(s.y*X-R.tileID.canonical.y)*$.dim,ye=Math.floor(re),Se=Math.floor(he);return(l?this.exaggeration():1)*He(He($.get(ye,Se),$.get(ye,Se+1),he-Se),He($.get(ye+1,Se),$.get(ye+1,Se+1),he-Se),re-ye)}getAtTileOffset(s,r,l){const h=1<<s.canonical.z;return this.getAtPointOrZero(new Ad(s.wrap+(s.canonical.x+r/Zr)/h,(s.canonical.y+l/Zr)/h))}getAtTileOffsetFunc(s,r,l,h){return p=>{const x=this.getAtTileOffset(s,p.x,p.y),w=h.upVector(s.canonical,p.x,p.y);return Ye(w,w,x*h.upVectorScale(s.canonical,r,l).metersToTile),w}}getForTilePoints(s,r,l,h){if(this.isUsingMockSource())return!1;const p=c1.create(this,s,h);return!!p&&(r.forEach((x=>{x[2]=this.exaggeration()*p.getElevationAt(x[0],x[1],l)})),!0)}getMinMaxForTile(s){if(this.isUsingMockSource())return null;const r=this.findDEMTileFor(s);if(!r||!r.dem)return null;const l=r.dem.tree,h=r.tileID,p=1<<s.canonical.z-h.canonical.z;let x=s.canonical.x/p-h.canonical.x,w=s.canonical.y/p-h.canonical.y,A=0;for(let P=0;P<s.canonical.z-h.canonical.z&&!l.leaves[A];P++){x*=2,w*=2;const R=2*Math.floor(w)+Math.floor(x);A=l.childOffsets[A]+R,x%=1,w%=1}return{min:this.exaggeration()*l.minimums[A],max:this.exaggeration()*l.maximums[A]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,r,l){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},o.ErrorEvent=Sa,o.EvaluationParameters=G,o.Event=rc,o.Evented=ra,o.FillExtrusionBucket=oy,o.Frustum=xi,o.FrustumCorners=Fr,o.GLOBE_RADIUS=Gn,o.GLOBE_SCALE_MATCH_LATITUDE=45,o.GLOBE_ZOOM_THRESHOLD_MAX=dn,o.GLOBE_ZOOM_THRESHOLD_MIN=nn,o.GlobeSharedBuffers=class{constructor(s){this._createGrid(s),this._createPoles(s)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const s of this._poleSegments)s.destroy();for(const s of this._gridSegments)s.withSkirts.destroy(),s.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const s of this._wireframeSegments)s.destroy()}}_fillGridMeshWithLods(s,r){const l=new vn,h=new xr,p=[],x=s+1+2,w=r[0]+1,A=r[0]+1+(1+r.length),P=(R,$,X)=>{let re=R===x-1?R-2:R===0?R:R-1;return re+=X?24575:0,[re,$]};for(let R=0;R<x;++R)l.emplaceBack(...P(R,0,!0));for(let R=0;R<w;++R)for(let $=0;$<x;++$)l.emplaceBack(...P($,R,($===0||$===x-1)&&!0));for(let R=0;R<r.length;++R){const $=r[R];for(let X=0;X<x;++X)l.emplaceBack(...P(X,$,!0))}for(let R=0;R<r.length;++R){const $=h.length,X=r[R]+1+2,re=new xr;for(let Se=0;Se<X-1;Se++){const Ke=Se===X-2,at=Ke?x*(A-r.length+R-Se):x;for(let xt=0;xt<x-1;xt++){const ct=Se*x+xt;Se===0||Ke||xt===0||xt===x-2?(re.emplaceBack(ct+1,ct,ct+at),re.emplaceBack(ct+at,ct+at+1,ct+1)):(h.emplaceBack(ct+1,ct,ct+at),h.emplaceBack(ct+at,ct+at+1,ct+1))}}const he=Pa.simpleSegment(0,$,l.length,h.length-$);for(let Se=0;Se<re.uint16.length;Se+=3)h.emplaceBack(re.uint16[Se],re.uint16[Se+1],re.uint16[Se+2]);const ye=Pa.simpleSegment(0,$,l.length,h.length-$);p.push({withoutSkirts:he,withSkirts:ye})}return{vertices:l,indices:h,segments:p}}_createGrid(s){const r=this._fillGridMeshWithLods(ei,li);this._gridSegments=r.segments,this._gridBuffer=s.createVertexBuffer(r.vertices,Bi.members),this._gridIndexBuffer=s.createIndexBuffer(r.indices,!0)}_createPoles(s){const r=new xr;for(let p=0;p<=ei;p++)r.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=s.createIndexBuffer(r,!0);const l=new fo,h=new fo;this._poleSegments=[];for(let p=0,x=0;p<nn;p++){const w=360/(1<<p);l.emplaceBack(0,-Gn,0,.5,0),h.emplaceBack(0,-Gn,0,.5,1);for(let A=0;A<=ei;A++){const P=A/ei,R=He(0,w,P),[$,X,re]=as(id,yf,R,Gn);l.emplaceBack($,X,re,P,0),h.emplaceBack($,X,re,P,1)}this._poleSegments.push(Pa.simpleSegment(x,0,66,64)),x+=66}this._poleNorthVertexBuffer=s.createVertexBuffer(l,Ar,!1),this._poleSouthVertexBuffer=s.createVertexBuffer(h,Ar,!1)}getGridBuffers(s,r){return[this._gridBuffer,this._gridIndexBuffer,r?this._gridSegments[s].withSkirts:this._gridSegments[s].withoutSkirts]}getPoleBuffers(s){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[s]]}getWirefameBuffers(s,r){if(!this._wireframeSegments){const l=new hs,h=ei,p=h+1+2,x=1;this._wireframeSegments=[];for(let w=0,A=0;w<li.length;w++){const P=li[w];for(let $=x;$<P+x;$++)for(let X=x;X<h+x;X++){const re=$*p+X;l.emplaceBack(re,re+1),l.emplaceBack(re,re+p),l.emplaceBack(re,re+p+1)}const R=P*h*3;this._wireframeSegments.push(Pa.simpleSegment(0,A,(P+1)*p,R)),A+=R}this._wireframeIndexBuffer=s.createIndexBuffer(l)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[r]]}},o.GlyphManager=zg,o.ImagePosition=Nx,o.KDBush=Yx,o.LivePerformanceUtils=bl,o.LngLat=Jr,o.LngLatBounds=td,o.LocalGlyphMode=Ox,o.MAX_MERCATOR_LATITUDE=ka,o.MercatorCoordinate=Ad,o.ONE_EM=uu,o.OverscaledTileID=sh,o.PerformanceMarkers=ma,o.Point=q,o.Properties=st,o.RGBAImage=Vu,o.Ray=Ur,o.RequestManager=class{constructor(s,r,l){this._transformRequestFn=s,this._customAccessToken=r,this._silenceAuthErrors=!!l,this._createSkuToken()}_createSkuToken(){const s=(function(){let r="";for(let l=0;l<10;l++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",me,r].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(s,r){return this._transformRequestFn&&this._transformRequestFn(s,r)||{url:s}}normalizeStyleURL(s,r){if(!Lt(s))return s;const l=Un(s);return l.path=`/styles/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||r)}normalizeGlyphsURL(s,r){if(!Lt(s))return s;const l=Un(s);return l.path=`/fonts/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||r)}normalizeSourceURL(s,r,l,h){if(!Lt(s))return s;const p=Un(s);return p.path=`/v4/${p.authority}.json`,p.params.push("secure"),l&&p.params.push(`language=${l}`),h&&p.params.push(`worldview=${h}`),this._makeAPIURL(p,this._customAccessToken||r)}normalizeSpriteURL(s,r,l,h){const p=Un(s);return Lt(s)?(p.path=`/styles/v1${p.path}/sprite${r}${l}`,this._makeAPIURL(p,this._customAccessToken||h)):(p.path+=`${r}${l}`,In(p))}normalizeTileURL(s,r,l){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!Lt(s))return s;const h=Un(s);h.path=h.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||l&&h.authority!=="raster"&&l===512?"@2x":""}${k.supported?".webp":"$1"}`),h.authority==="raster"?h.path=`/${V.RASTER_URL_PREFIX}${h.path}`:(h.path=h.path.replace(/^.+\/v4\//,"/"),h.path=`/${V.TILE_URL_VERSION}${h.path}`);const p=this._customAccessToken||(function(x){for(const w of x){const A=w.match(/^access_token=(.*)$/);if(A)return A[1]}return null})(h.params)||V.ACCESS_TOKEN;return V.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&h.params.push(`sku=${this._skuToken}`),this._makeAPIURL(h,p)}canonicalizeTileURL(s,r){const l=Un(s);if(!l.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!l.path.match(/\.[\w]+$/))return s;let h="mapbox://";l.path.match(/^\/raster\/v1\//)?h+=`raster/${l.path.replace(`/${V.RASTER_URL_PREFIX}/`,"")}`:h+=`tiles/${l.path.replace(`/${V.TILE_URL_VERSION}/`,"")}`;let p=l.params;return r&&(p=p.filter((x=>!x.match(/^access_token=/)))),p.length&&(h+=`?${p.join("&")}`),h}canonicalizeTileset(s,r){const l=!!r&&Lt(r),h=[];for(const p of s.tiles||[])Rt(p)?h.push(this.canonicalizeTileURL(p,l)):h.push(p);return h}_makeAPIURL(s,r){const l="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",h=Un(V.API_URL);if(s.protocol=h.protocol,s.authority=h.authority,s.protocol==="http"){const p=s.params.indexOf("secure");p>=0&&s.params.splice(p,1)}if(h.path!=="/"&&(s.path=`${h.path}${s.path}`),!V.REQUIRE_ACCESS_TOKEN)return In(s);if(r=r||V.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${l}`);if(r[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${l}`)}return s.params=s.params.filter((p=>p.indexOf("access_token")===-1)),s.params.push(`access_token=${r||""}`),In(s)}},o.ResourceType=or,o.SegmentVector=Pa,o.SourceCache=zm,o.StencilMode=Wx,o.StructArrayLayout1ui2=hc,o.StructArrayLayout2f1f2i16=Jn,o.StructArrayLayout2i4=vn,o.StructArrayLayout2ui4=hs,o.StructArrayLayout3f12=mi,o.StructArrayLayout3ui6=xr,o.StructArrayLayout4i8=ln,o.StructArrayLayout5f20=fo,o.Texture=gy,o.Tile=Gx,o.Transitionable=ge,o.Uniform1f=Qh,o.Uniform1i=class extends Hl{constructor(s){super(s),this.current=0}set(s,r,l){this.fetchUniformLocation(s,r)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},o.Uniform2f=class extends Hl{constructor(s){super(s),this.current=[0,0]}set(s,r,l){this.fetchUniformLocation(s,r)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}},o.Uniform3f=class extends Hl{constructor(s){super(s),this.current=[0,0,0]}set(s,r,l){this.fetchUniformLocation(s,r)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}},o.Uniform4f=xd,o.UniformColor=ed,o.UniformMatrix2f=class extends Hl{constructor(s){super(s),this.current=Od}set(s,r,l){if(this.fetchUniformLocation(s,r)){for(let h=0;h<4;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}}},o.UniformMatrix3f=class extends Hl{constructor(s){super(s),this.current=Oh}set(s,r,l){if(this.fetchUniformLocation(s,r)){for(let h=0;h<9;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix3fv(this.location,!1,l);break}}}},o.UniformMatrix4f=class extends Hl{constructor(s){super(s),this.current=bd}set(s,r,l){if(this.fetchUniformLocation(s,r)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let h=1;h<16;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}},o.UnwrappedTileID=Y3,o.ValidationError=An,o.VectorTileFeature=Di,o.VectorTileWorkerSource=class extends ra{constructor(s,r,l,h,p){super(),this.actor=s,this.layerIndex=r,this.availableImages=l,this.loadVectorData=p||a2,this.loading={},this.loaded={},this.deduped=new s2(s.scheduler),this.isSpriteLoaded=h,this.scheduler=s.scheduler}loadTile(s,r){const l=s.uid,h=s&&s.request,p=h&&h.collectResourceTiming,x=this.loading[l]=new HL(s);x.abort=this.loadVectorData(s,((w,A)=>{const P=!this.loading[l];if(delete this.loading[l],P||w||!A)return x.status="done",P||(this.loaded[l]=x),r(w);const R=A.rawData,$={};A.expires&&($.expires=A.expires),A.cacheControl&&($.cacheControl=A.cacheControl),x.vectorTile=A.vectorTile||new fi(new X_(R));const X=()=>{x.parse(x.vectorTile,this.layerIndex,this.availableImages,this.actor,((re,he)=>{if(re||!he)return r(re);const ye={};if(p){const Se=nc(h);Se.length>0&&(ye.resourceTiming=JSON.parse(JSON.stringify(Se)))}r(null,Be({rawTileData:R.slice(0)},he,$,ye))}))};this.isSpriteLoaded?X():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(X,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom}):X()})),this.loaded=this.loaded||{},this.loaded[l]=x}))}reloadTile(s,r){const l=this.loaded,h=s.uid,p=this;if(l&&l[h]){const x=l[h];x.showCollisionBoxes=s.showCollisionBoxes,x.enableTerrain=!!s.enableTerrain,x.projection=s.projection,x.tileTransform=Bm(s.tileID.canonical,s.projection);const w=(A,P)=>{const R=x.reloadCallback;R&&(delete x.reloadCallback,x.parse(x.vectorTile,p.layerIndex,this.availableImages,p.actor,R)),r(A,P)};x.status==="parsing"?x.reloadCallback=w:x.status==="done"&&(x.vectorTile?x.parse(x.vectorTile,this.layerIndex,this.availableImages,this.actor,w):w())}}abortTile(s,r){const l=s.uid,h=this.loading[l];h&&(h.abort&&h.abort(),delete this.loading[l]),r()}removeTile(s,r){const l=this.loaded,h=s.uid;l&&l[h]&&delete l[h],r()}},o.WritingMode=ld,o.ZoomDependentExpression=ru,o.add=Bh,o.addDynamicAttributes=o1,o.adjoint=function(s,r){var l=r[0],h=r[1],p=r[2],x=r[3],w=r[4],A=r[5],P=r[6],R=r[7],$=r[8];return s[0]=w*$-A*R,s[1]=p*R-h*$,s[2]=h*A-p*w,s[3]=A*P-x*$,s[4]=l*$-p*P,s[5]=p*x-l*A,s[6]=x*R-w*P,s[7]=h*P-l*R,s[8]=l*w-h*x,s},o.asyncAll=le,o.bezier=Me,o.bindAll=Jt,o.boundsAttributes=q4,o.bufferConvexPolygon=function(s,r){const l=[];for(let h=0;h<s.length;h++){const p=xe(h-1,-1,s.length-1),x=xe(h+1,-1,s.length-1),w=s[h],A=s[x],P=s[p].sub(w).unit(),R=A.sub(w).unit(),$=R.angleWithSep(P.x,P.y),X=P.add(R).unit().mult(-1*r/Math.sin($/2));l.push(w.add(X))}return l},o.cacheEntryPossiblyAdded=function(s){ki++,ki>Rr&&(s.getActor().send("enforceCacheSizeLimit",Bn),ki=0)},o.calculateGlobeLabelMatrix=function(s,r){const{x:l,y:h}=s.point,p=Yr(l,h,s.worldSize/s._pixelsPerMercatorPixel,0,0);return lu(p,p,Ah(Yi(r)))},o.calculateGlobeMatrix=function(s){const{x:r,y:l}=s.point,{lng:h,lat:p}=s._center;return Yr(r,l,s.worldSize,h,p)},o.calculateGlobeMercatorMatrix=function(s){const r=s.pixelsPerMeter,l=r/Va(1,s.center.lat),h=Bu(new Float64Array(16));return nd(h,h,[s.point.x,s.point.y,0]),wd(h,h,[l,l,r]),Float32Array.from(h)},o.circumferenceAtLatitude=Ml,o.clamp=De,o.clearTileCache=function(s){if(!Ir())return;const r=b.caches.delete(Hn);s&&r.catch(s).then((()=>s()))},o.clipLine=A4,o.clone=function(s){var r=new Pc(16);return r[0]=s[0],r[1]=s[1],r[2]=s[2],r[3]=s[3],r[4]=s[4],r[5]=s[5],r[6]=s[6],r[7]=s[7],r[8]=s[8],r[9]=s[9],r[10]=s[10],r[11]=s[11],r[12]=s[12],r[13]=s[13],r[14]=s[14],r[15]=s[15],r},o.clone$1=Gt,o.collisionCircleLayout=$C,o.config=V,o.conjugate=function(s,r){return s[0]=-r[0],s[1]=-r[1],s[2]=-r[2],s[3]=r[3],s},o.create=function(){var s=new Pc(16);return Pc!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},o.create$1=Sm,o.createExpression=eo,o.createLayout=Tt,o.createStyleLayer=function(s){return s.type==="custom"?new DL(s):new OL[s.type](s)},o.cross=Dt,o.degToRad=Z,o.distance=function(s,r){return Math.hypot(r[0]-s[0],r[1]-s[1],r[2]-s[2])},o.div=function(s,r,l){return s[0]=r[0]/l[0],s[1]=r[1]/l[1],s[2]=r[2]/l[2],s},o.dot=St,o.earthRadius=qc,o.ease=we,o.easeCubicInOut=Oe,o.ecefToLatLng=function([s,r,l]){const h=Math.hypot(s,r,l),p=Math.atan2(s,l),x=.5*Math.PI-Math.acos(-r/h);return new Jr(be(p),be(x))},o.emitValidationErrors=La,o.endsWith=hn,o.enforceCacheSizeLimit=function(s){Pr(),vr&&vr.then((r=>{r.keys().then((l=>{for(let h=0;h<l.length-s;h++)r.delete(l[h])}))}))},o.evaluateSizeForFeature=W_,o.evaluateSizeForZoom=Dg,o.evaluateVariableOffset=P4,o.evented=S,o.exactEquals=function(s,r){return s[0]===r[0]&&s[1]===r[1]&&s[2]===r[2]&&s[3]===r[3]},o.exactEquals$1=function(s,r){return s[0]===r[0]&&s[1]===r[1]&&s[2]===r[2]},o.exported=Zo,o.exported$1=k,o.extend=Be,o.extend$1=Yo,o.fillExtrusionHeightLift=K3,o.filterObject=Mn,o.fromMat4=function(s,r){return s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[4],s[4]=r[5],s[5]=r[6],s[6]=r[8],s[7]=r[9],s[8]=r[10],s},o.fromQuat=function(s,r){var l=r[0],h=r[1],p=r[2],x=r[3],w=l+l,A=h+h,P=p+p,R=l*w,$=h*w,X=h*A,re=p*w,he=p*A,ye=p*P,Se=x*w,Ke=x*A,at=x*P;return s[0]=1-X-ye,s[1]=$+at,s[2]=re-Ke,s[3]=0,s[4]=$-at,s[5]=1-R-ye,s[6]=he+Se,s[7]=0,s[8]=re+Ke,s[9]=he-Se,s[10]=1-R-X,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},o.fromRotation=function(s,r){var l=Math.sin(r),h=Math.cos(r);return s[0]=h,s[1]=l,s[2]=0,s[3]=-l,s[4]=h,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},o.fromScaling=Rp,o.furthestTileCorner=function(s){const r=Math.round((s+45+360)%360/90)%4;return Re[r]},o.getAABBPointSquareDist=function(s,r,l){let h=0;for(let p=0;p<2;++p){const x=l?l[p]:0;s[p]>x&&(h+=(s[p]-x)*(s[p]-x)),r[p]<x&&(h+=(x-r[p])*(x-r[p]))}return h},o.getAnchorAlignment=Fx,o.getAnchorJustification=zx,o.getBounds=function(s){let r=1/0,l=1/0,h=-1/0,p=-1/0;for(const x of s)r=Math.min(r,x.x),l=Math.min(l,x.y),h=Math.max(h,x.x),p=Math.max(p,x.y);return{min:new q(r,l),max:new q(h,p)}},o.getColumn=Pn,o.getDefaultExportFromCjs=ue,o.getGridMatrix=function(s,r,l,h){const p=r.getNorth(),x=r.getSouth(),w=r.getWest(),A=r.getEast(),P=1<<s.z,R=A-w,$=p-x,X=R/ei,re=-$/li[l],he=[0,X,0,re,0,0,p,w,0];if(s.z>0){const ye=180/h;Bd(he,he,[ye/R+1,0,0,0,ye/$+1,0,-.5*ye/X,.5*ye/re,1])}return he[2]=P,he[5]=s.x,he[8]=s.y,he},o.getImage=et,o.getJSON=function(s,r){return Or(Be(s,{type:"json"}),r)},o.getLatitudinalLod=function(s){const r=ka-5;s=De(s,-r,r)/r*90;const l=Math.pow(Math.abs(Math.sin(Z(s))),3);return Math.round(l*(li.length-1))},o.getMapSessionAPI=ao,o.getPerformanceMeasurement=nc,o.getProjection=B4,o.getRTLTextPluginStatus=T,o.getReferrer=Gr,o.getTilePoint=function(s,{x:r,y:l},h=0){return new q(((r-h)*s.scale-s.x)*Zr,(l*s.scale-s.y)*Zr)},o.getTileVec3=function(s,r,l=0){return Ud(((r.x-l)*s.scale-s.x)*Zr,(r.y*s.scale-s.y)*Zr,_f(r.z,r.y))},o.getVideo=function(s,r){const l=b.document.createElement("video");l.muted=!0,l.onloadstart=function(){r(null,l)};for(let h=0;h<s.length;h++){const p=b.document.createElement("source");si(s[h])||(l.crossOrigin="Anonymous"),p.src=s[h],l.appendChild(p)}return{cancel:()=>{}}},o.globeCenterToScreenPoint=function(s){const r=[0,0,0],l=Bu(new Float64Array(16));return lu(l,s.pixelMatrix,s.globeMatrix),ft(r,r,l),new q(r[0],r[1])},o.globeDenormalizeECEF=Ah,o.globeECEFOrigin=function(s,r){const l=[0,0,0];return ft(l,l,pc(Yi(r.canonical))),ft(l,l,s),l},o.globeMetersToEcef=ro,o.globeNormalizeECEF=pc,o.globePixelsToTileUnits=function(s,r){return Zr/(512*Math.pow(2,s))*Sd(Yi(r))},o.globePoleMatrixForTile=function(s,r,l){const h=Bu(new Float64Array(16)),p=(r/(1<<s)-.5)*Math.PI*2;return mf(h,l.globeMatrix,p),Float32Array.from(h)},o.globeTileBounds=Yi,o.globeTiltAtLngLat=va,o.globeToMercatorTransition=ls,o.globeUseCustomAntiAliasing=function(s,r,l){const h=ls(l.zoom),p=s.style.map._antialias,x=!!r.extStandardDerivatives,w=r.extStandardDerivativesForceOff||s.terrain&&s.terrain.exaggeration()>0;return h===0&&!p&&!w&&x},o.identity=Bu,o.identity$1=cr,o.invert=kl,o.isFullscreen=function(){return!!b.document.fullscreenElement||!!b.document.webkitFullscreenElement},o.isLngLatBehindGlobe=zu,o.isMapAuthenticated=function(s){return Cs.has(s)},o.isMapboxURL=Lt,o.isSafariWithAntialiasingBug=function(s){const r=s.navigator?s.navigator.userAgent:null;return!!Kr(s)&&r&&(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.latFromMercatorY=Go,o.latLngToECEF=gl,o.len=zt,o.length=jd,o.length$1=function(s){return Math.hypot(s[0],s[1],s[2],s[3])},o.lngFromMercatorX=Kl,o.loadVectorTile=a2,o.makeRequest=Or,o.mapValue=function(s,r,l,h,p){return De((s-r)/(l-r)*(p-h)+h,h,p)},o.mercatorScale=qd,o.mercatorXfromLng=Is,o.mercatorYfromLat=bs,o.mercatorZfromAltitude=Va,o.mul=Em,o.mul$1=un,o.multiply=lu,o.multiply$1=Bd,o.multiply$2=fe,o.nextPowerOfTwo=pt,o.normalize=Ge,o.normalize$1=Vr,o.normalize$2=fr,o.number=He,o.ortho=function(s,r,l,h,p,x,w){var A=1/(r-l),P=1/(h-p),R=1/(x-w);return s[0]=-2*A,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*P,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*R,s[11]=0,s[12]=(r+l)*A,s[13]=(p+h)*P,s[14]=(w+x)*R,s[15]=1,s},o.pbf=i4,o.perspective=function(s,r,l,h,p){var x,w=1/Math.tan(r/2);return s[0]=w/l,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=w,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,p!=null&&p!==1/0?(s[10]=(p+h)*(x=1/(h-p)),s[14]=2*p*h*x):(s[10]=-1,s[14]=-2*h),s},o.pick=function(s,r){const l={};for(let h=0;h<r.length;h++){const p=r[h];p in s&&(l[p]=s[p])}return l},o.plugin=z,o.pointGeometry=U,o.polesInViewport=function(s){const r=Bu(new Float64Array(16));lu(r,s.pixelMatrix,s.globeMatrix);const l=[0,Co,0],h=[0,Fn,0];return ft(l,l,r),ft(h,h,r),[l[0]>0&&l[0]<=s.width&&l[1]>0&&l[1]<=s.height&&!zu(s,new Jr(s.center.lat,90)),h[0]>0&&h[0]<=s.width&&h[1]>0&&h[1]<=s.height&&!zu(s,new Jr(s.center.lat,-90))]},o.polygonContainsPoint=Gd,o.polygonIntersectsBox=z_,o.polygonIntersectsPolygon=Eg,o.polygonizeBounds=function(s,r,l=0,h=!0){const p=new q(l,l),x=s.sub(p),w=r.add(p),A=[x,new q(w.x,x.y),w,new q(x.x,w.y)];return h&&A.push(x.clone()),A},o.posAttributes=Bi,o.postMapLoadEvent=_o,o.postPerformanceEvent=so,o.postTurnstileEvent=Ei,o.potpack=Mx,o.prevPowerOfTwo=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log(s)/Math.LN2))},o.radToDeg=be,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.registerForPluginStateChange=function(s){return s({pluginStatus:y,pluginURL:a}),S.on("pluginStateChange",s),s},o.removeAuthState=function(s){Cs.delete(s)},o.renderColorRamp=J0,o.resample=ju,o.rotateX=kp,o.rotateX$1=ri,o.rotateY=mf,o.rotateY$1=qr,o.rotateZ=function(s,r,l){var h=Math.sin(l),p=Math.cos(l),x=r[0],w=r[1],A=r[2],P=r[3],R=r[4],$=r[5],X=r[6],re=r[7];return r!==s&&(s[8]=r[8],s[9]=r[9],s[10]=r[10],s[11]=r[11],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[0]=x*p+R*h,s[1]=w*p+$*h,s[2]=A*p+X*h,s[3]=P*p+re*h,s[4]=R*p-x*h,s[5]=$*p-w*h,s[6]=X*p-A*h,s[7]=re*p-P*h,s},o.rotateZ$1=function(s,r,l){l*=.5;var h=r[0],p=r[1],x=r[2],w=r[3],A=Math.sin(l),P=Math.cos(l);return s[0]=h*P+p*A,s[1]=p*P-h*A,s[2]=x*P+w*A,s[3]=w*P-x*A,s},o.scale=wd,o.scale$1=on,o.scale$2=Ye,o.scaleAndAdd=qe,o.set=function(s,r,l,h){return s[0]=r,s[1]=l,s[2]=h,s},o.setCacheLimits=function(s,r){Bn=s,Rr=r},o.setColumn=function(s,r,l){s[4*r+0]=l[0],s[4*r+1]=l[1],s[4*r+2]=l[2],s[4*r+3]=l[3]},o.setRTLTextPlugin=function(s,r,l=!1){if(y===dt||y===jt||y===Qt)throw new Error("setRTLTextPlugin cannot be called multiple times.");a=Zo.resolveURL(s),y=dt,En=r,v(),l||N()},o.smoothstep=tt,o.spec=mn,o.squaredLength=function(s){var r=s[0],l=s[1],h=s[2];return r*r+l*l+h*h},o.storeAuthState=function(s,r){r?Cs.add(s):Cs.delete(s)},o.sub=bn,o.subtract=O,o.symbolSize=GC,o.tileAABB=function(s,r,l,h,p,x,w,A,P){if(P.name==="globe")return Vd(s,r,new G_(l,h,p));const R=Bm({z:l,x:h,y:p},P);return new Dn([(x+R.x/R.scale)*r,r*(R.y/R.scale),w],[(x+R.x2/R.scale)*r,r*(R.y2/R.scale),A])},o.tileCornersToBounds=ml,o.tileTransform=Bm,o.transformMat3=function(s,r,l){var h=r[0],p=r[1],x=r[2];return s[0]=h*l[0]+p*l[3]+x*l[6],s[1]=h*l[1]+p*l[4]+x*l[7],s[2]=h*l[2]+p*l[5]+x*l[8],s},o.transformMat4=ft,o.transformMat4$1=_r,o.transformQuat=Xt,o.transitionTileAABBinECEF=cu,o.translate=nd,o.transpose=function(s,r){if(s===r){var l=r[1],h=r[2],p=r[5];s[1]=r[3],s[2]=r[6],s[3]=l,s[5]=r[7],s[6]=h,s[7]=p}else s[0]=r[0],s[1]=r[3],s[2]=r[6],s[3]=r[1],s[4]=r[4],s[5]=r[7],s[6]=r[2],s[7]=r[5],s[8]=r[8];return s},o.triggerPluginCompletionEvent=f,o.uniqueId=rt,o.updateGlobeVertexNormal=function(s,r,l,h,p){const x=5*r+2;s.float32[x+0]=l,s.float32[x+1]=h,s.float32[x+2]=p},o.validateCustomStyleLayer=function(s){const r=[],l=s.id;return l===void 0&&r.push({message:`layers.${l}: missing required property "id"`}),s.render===void 0&&r.push({message:`layers.${l}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&r.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),r},o.validateFilter=s=>Ca(ja(s)),o.validateFog=s=>Ca(lc(s)),o.validateLayer=s=>Ca(df(s)),o.validateLight=s=>Ca(Sh(s)),o.validateSource=s=>Ca(Ac(s)),o.validateStyle=tl,o.validateTerrain=s=>Ca(Ua(s)),o.values=Ne,o.vectorTile=_n,o.version=I,o.warnOnce=dr,o.window=b,o.wrap=xe})),m(["./shared"],(function(o){function b(lt){if(typeof lt=="number"||typeof lt=="boolean"||typeof lt=="string"||lt==null)return JSON.stringify(lt);if(Array.isArray(lt)){let Te="[";for(const et of lt)Te+=`${b(et)},`;return`${Te}]`}let Ee="{";for(const Te of Object.keys(lt).sort())Ee+=`${Te}:${b(lt[Te])},`;return`${Ee}}`}function I(lt){let Ee="";for(const Te of o.refProperties)Ee+=`/${b(lt[Te])}`;return Ee}class M{constructor(Ee){this.keyCache={},Ee&&this.replace(Ee)}replace(Ee){this._layerConfigs={},this._layers={},this.update(Ee,[])}update(Ee,Te){for(const ht of Ee)this._layerConfigs[ht.id]=ht,(this._layers[ht.id]=o.createStyleLayer(ht)).compileFilter(),this.keyCache[ht.id]&&delete this.keyCache[ht.id];for(const ht of Te)delete this.keyCache[ht],delete this._layerConfigs[ht],delete this._layers[ht];this.familiesBySource={};const et=(function(ht,Lt){const Rt={};for(let At=0;At<ht.length;At++){const Pt=Lt&&Lt[ht[At].id]||I(ht[At]);Lt&&(Lt[ht[At].id]=Pt);let xn=Rt[Pt];xn||(xn=Rt[Pt]=[]),xn.push(ht[At])}const Ot=[];for(const At in Rt)Ot.push(Rt[At]);return Ot})(o.values(this._layerConfigs),this.keyCache);for(const ht of et){const Lt=ht.map((Un=>this._layers[Un.id])),Rt=Lt[0];if(Rt.visibility==="none")continue;const Ot=Rt.source||"";let At=this.familiesBySource[Ot];At||(At=this.familiesBySource[Ot]={});const Pt=Rt.sourceLayer||"_geojsonTileLayer";let xn=At[Pt];xn||(xn=At[Pt]=[]),xn.push(Lt)}}}class V{loadTile(Ee,Te){const{uid:et,encoding:ht,rawImageData:Lt,padding:Rt,buildQuadTree:Ot}=Ee,At=o.window.ImageBitmap&&Lt instanceof o.window.ImageBitmap?this.getImageData(Lt,Rt):Lt;Te(null,new o.DEMData(et,At,ht,Rt<1,Ot))}getImageData(Ee,Te){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Ee.width,Ee.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Ee.width,this.offscreenCanvas.height=Ee.height,this.offscreenCanvasContext.drawImage(Ee,0,0,Ee.width,Ee.height);const et=this.offscreenCanvasContext.getImageData(-Te,-Te,Ee.width+2*Te,Ee.height+2*Te);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),et}}function k(lt,Ee){if(lt.length!==0){ie(lt[0],Ee);for(var Te=1;Te<lt.length;Te++)ie(lt[Te],!Ee)}}function ie(lt,Ee){for(var Te=0,et=0,ht=0,Lt=lt.length,Rt=Lt-1;ht<Lt;Rt=ht++){var Ot=(lt[ht][0]-lt[Rt][0])*(lt[Rt][1]+lt[ht][1]),At=Te+Ot;et+=Math.abs(Te)>=Math.abs(Ot)?Te-At+Ot:Ot-At+Te,Te=At}Te+et>=0!=!!Ee&&lt.reverse()}var se=o.getDefaultExportFromCjs((function lt(Ee,Te){var et,ht=Ee&&Ee.type;if(ht==="FeatureCollection")for(et=0;et<Ee.features.length;et++)lt(Ee.features[et],Te);else if(ht==="GeometryCollection")for(et=0;et<Ee.geometries.length;et++)lt(Ee.geometries[et],Te);else if(ht==="Feature")lt(Ee.geometry,Te);else if(ht==="Polygon")k(Ee.coordinates,Te);else if(ht==="MultiPolygon")for(et=0;et<Ee.coordinates.length;et++)k(Ee.coordinates[et],Te);return Ee}));const de=o.VectorTileFeature.prototype.toGeoJSON;var J={exports:{}},ne=o.pointGeometry,me=o.vectorTile.VectorTileFeature,ue=ke;function ke(lt,Ee){this.options=Ee||{},this.features=lt,this.length=lt.length}function ze(lt,Ee){this.id=typeof lt.id=="number"?lt.id:void 0,this.type=lt.type,this.rawGeometry=lt.type===1?[lt.geometry]:lt.geometry,this.properties=lt.tags,this.extent=Ee||4096}ke.prototype.feature=function(lt){return new ze(this.features[lt],this.options.extent)},ze.prototype.loadGeometry=function(){var lt=this.rawGeometry;this.geometry=[];for(var Ee=0;Ee<lt.length;Ee++){for(var Te=lt[Ee],et=[],ht=0;ht<Te.length;ht++)et.push(new ne(Te[ht][0],Te[ht][1]));this.geometry.push(et)}return this.geometry},ze.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var lt=this.geometry,Ee=1/0,Te=-1/0,et=1/0,ht=-1/0,Lt=0;Lt<lt.length;Lt++)for(var Rt=lt[Lt],Ot=0;Ot<Rt.length;Ot++){var At=Rt[Ot];Ee=Math.min(Ee,At.x),Te=Math.max(Te,At.x),et=Math.min(et,At.y),ht=Math.max(ht,At.y)}return[Ee,et,Te,ht]},ze.prototype.toGeoJSON=me.prototype.toGeoJSON;var pe=o.pbf,U=ue;function F(lt){var Ee=new pe;return(function(Te,et){for(var ht in Te.layers)et.writeMessage(3,q,Te.layers[ht])})(lt,Ee),Ee.finish()}function q(lt,Ee){var Te;Ee.writeVarintField(15,lt.version||1),Ee.writeStringField(1,lt.name||""),Ee.writeVarintField(5,lt.extent||4096);var et={keys:[],values:[],keycache:{},valuecache:{}};for(Te=0;Te<lt.length;Te++)et.feature=lt.feature(Te),Ee.writeMessage(2,j,et);var ht=et.keys;for(Te=0;Te<ht.length;Te++)Ee.writeStringField(3,ht[Te]);var Lt=et.values;for(Te=0;Te<Lt.length;Te++)Ee.writeMessage(4,Oe,Lt[Te])}function j(lt,Ee){var Te=lt.feature;Te.id!==void 0&&Ee.writeVarintField(1,Te.id),Ee.writeMessage(2,H,lt),Ee.writeVarintField(3,Te.type),Ee.writeMessage(4,Re,Te)}function H(lt,Ee){var Te=lt.feature,et=lt.keys,ht=lt.values,Lt=lt.keycache,Rt=lt.valuecache;for(var Ot in Te.properties){var At=Te.properties[Ot],Pt=Lt[Ot];if(At!==null){Pt===void 0&&(et.push(Ot),Lt[Ot]=Pt=et.length-1),Ee.writeVarint(Pt);var xn=typeof At;xn!=="string"&&xn!=="boolean"&&xn!=="number"&&(At=JSON.stringify(At));var Un=xn+":"+At,In=Rt[Un];In===void 0&&(ht.push(At),Rt[Un]=In=ht.length-1),Ee.writeVarint(In)}}}function Z(lt,Ee){return(Ee<<3)+(7&lt)}function be(lt){return lt<<1^lt>>31}function Re(lt,Ee){for(var Te=lt.loadGeometry(),et=lt.type,ht=0,Lt=0,Rt=Te.length,Ot=0;Ot<Rt;Ot++){var At=Te[Ot],Pt=1;et===1&&(Pt=At.length),Ee.writeVarint(Z(1,Pt));for(var xn=et===3?At.length-1:At.length,Un=0;Un<xn;Un++){Un===1&&et!==1&&Ee.writeVarint(Z(2,xn-1));var In=At[Un].x-ht,kr=At[Un].y-Lt;Ee.writeVarint(be(In)),Ee.writeVarint(be(kr)),ht+=In,Lt+=kr}et===3&&Ee.writeVarint(Z(7,1))}}function Oe(lt,Ee){var Te=typeof lt;Te==="string"?Ee.writeStringField(1,lt):Te==="boolean"?Ee.writeBooleanField(7,lt):Te==="number"&&(lt%1!=0?Ee.writeDoubleField(3,lt):lt<0?Ee.writeSVarintField(6,lt):Ee.writeVarintField(5,lt))}J.exports=F,J.exports.fromVectorTileJs=F,J.exports.fromGeojsonVt=function(lt,Ee){Ee=Ee||{};var Te={};for(var et in lt)Te[et]=new U(lt[et].features,Ee),Te[et].name=et,Te[et].version=Ee.version,Te[et].extent=Ee.extent;return F({layers:Te})},J.exports.GeoJSONWrapper=U;var Me=o.getDefaultExportFromCjs(J.exports);const we={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:lt=>lt},De=Math.fround||(tt=new Float32Array(1),lt=>(tt[0]=+lt,tt[0]));var tt;const xe=3,le=5,Ne=6;class Be{constructor(Ee){this.options=Object.assign(Object.create(we),Ee),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Ee){const{log:Te,minZoom:et,maxZoom:ht}=this.options;Te&&console.time("total time");const Lt=`prepare ${Ee.length} points`;Te&&console.time(Lt),this.points=Ee;const Rt=[];for(let At=0;At<Ee.length;At++){const Pt=Ee[At];if(!Pt.geometry)continue;const[xn,Un]=Pt.geometry.coordinates,In=De(gt(xn)),kr=De(pt(Un));Rt.push(In,kr,1/0,At,-1,1),this.options.reduce&&Rt.push(0)}let Ot=this.trees[ht+1]=this._createTree(Rt);Te&&console.timeEnd(Lt);for(let At=ht;At>=et;At--){const Pt=+Date.now();Ot=this.trees[At]=this._createTree(this._cluster(Ot,At)),Te&&console.log("z%d: %d clusters in %dms",At,Ot.numItems,+Date.now()-Pt)}return Te&&console.timeEnd("total time"),this}getClusters(Ee,Te){let et=((Ee[0]+180)%360+360)%360-180;const ht=Math.max(-90,Math.min(90,Ee[1]));let Lt=Ee[2]===180?180:((Ee[2]+180)%360+360)%360-180;const Rt=Math.max(-90,Math.min(90,Ee[3]));if(Ee[2]-Ee[0]>=360)et=-180,Lt=180;else if(et>Lt){const Un=this.getClusters([et,ht,180,Rt],Te),In=this.getClusters([-180,ht,Lt,Rt],Te);return Un.concat(In)}const Ot=this.trees[this._limitZoom(Te)],At=Ot.range(gt(et),pt(Rt),gt(Lt),pt(ht)),Pt=Ot.data,xn=[];for(const Un of At){const In=this.stride*Un;xn.push(Pt[In+le]>1?Qe(Pt,In,this.clusterProps):this.points[Pt[In+xe]])}return xn}getChildren(Ee){const Te=this._getOriginId(Ee),et=this._getOriginZoom(Ee),ht="No cluster with the specified id.",Lt=this.trees[et];if(!Lt)throw new Error(ht);const Rt=Lt.data;if(Te*this.stride>=Rt.length)throw new Error(ht);const Ot=this.options.radius/(this.options.extent*Math.pow(2,et-1)),At=Lt.within(Rt[Te*this.stride],Rt[Te*this.stride+1],Ot),Pt=[];for(const xn of At){const Un=xn*this.stride;Rt[Un+4]===Ee&&Pt.push(Rt[Un+le]>1?Qe(Rt,Un,this.clusterProps):this.points[Rt[Un+xe]])}if(Pt.length===0)throw new Error(ht);return Pt}getLeaves(Ee,Te,et){const ht=[];return this._appendLeaves(ht,Ee,Te=Te||10,et=et||0,0),ht}getTile(Ee,Te,et){const ht=this.trees[this._limitZoom(Ee)],Lt=Math.pow(2,Ee),{extent:Rt,radius:Ot}=this.options,At=Ot/Rt,Pt=(et-At)/Lt,xn=(et+1+At)/Lt,Un={features:[]};return this._addTileFeatures(ht.range((Te-At)/Lt,Pt,(Te+1+At)/Lt,xn),ht.data,Te,et,Lt,Un),Te===0&&this._addTileFeatures(ht.range(1-At/Lt,Pt,1,xn),ht.data,Lt,et,Lt,Un),Te===Lt-1&&this._addTileFeatures(ht.range(0,Pt,At/Lt,xn),ht.data,-1,et,Lt,Un),Un.features.length?Un:null}getClusterExpansionZoom(Ee){let Te=this._getOriginZoom(Ee)-1;for(;Te<=this.options.maxZoom;){const et=this.getChildren(Ee);if(Te++,et.length!==1)break;Ee=et[0].properties.cluster_id}return Te}_appendLeaves(Ee,Te,et,ht,Lt){const Rt=this.getChildren(Te);for(const Ot of Rt){const At=Ot.properties;if(At&&At.cluster?Lt+At.point_count<=ht?Lt+=At.point_count:Lt=this._appendLeaves(Ee,At.cluster_id,et,ht,Lt):Lt<ht?Lt++:Ee.push(Ot),Ee.length===et)break}return Lt}_createTree(Ee){const Te=new o.KDBush(Ee.length/this.stride|0,this.options.nodeSize,Float32Array);for(let et=0;et<Ee.length;et+=this.stride)Te.add(Ee[et],Ee[et+1]);return Te.finish(),Te.data=Ee,Te}_addTileFeatures(Ee,Te,et,ht,Lt,Rt){for(const Ot of Ee){const At=Ot*this.stride,Pt=Te[At+le]>1;let xn,Un,In;if(Pt)xn=rt(Te,At,this.clusterProps),Un=Te[At],In=Te[At+1];else{const jr=this.points[Te[At+xe]];xn=jr.properties;const[Er,Ei]=jr.geometry.coordinates;Un=gt(Er),In=pt(Ei)}const kr={type:1,geometry:[[Math.round(this.options.extent*(Un*Lt-et)),Math.round(this.options.extent*(In*Lt-ht))]],tags:xn};let Lr;Lr=Pt||this.options.generateId?Te[At+xe]:this.points[Te[At+xe]].id,Lr!==void 0&&(kr.id=Lr),Rt.features.push(kr)}}_limitZoom(Ee){return Math.max(this.options.minZoom,Math.min(Math.floor(+Ee),this.options.maxZoom+1))}_cluster(Ee,Te){const{radius:et,extent:ht,reduce:Lt,minPoints:Rt}=this.options,Ot=et/(ht*Math.pow(2,Te)),At=Ee.data,Pt=[],xn=this.stride;for(let Un=0;Un<At.length;Un+=xn){if(At[Un+2]<=Te)continue;At[Un+2]=Te;const In=At[Un],kr=At[Un+1],Lr=Ee.within(At[Un],At[Un+1],Ot),jr=At[Un+le];let Er=jr;for(const Ei of Lr){const oo=Ei*xn;At[oo+2]>Te&&(Er+=At[oo+le])}if(Er>jr&&Er>=Rt){let Ei,oo=In*jr,_o=kr*jr,Ho=-1;const so=((Un/xn|0)<<5)+(Te+1)+this.points.length;for(const _s of Lr){const ao=_s*xn;if(At[ao+2]<=Te)continue;At[ao+2]=Te;const Cs=At[ao+le];oo+=At[ao]*Cs,_o+=At[ao+1]*Cs,At[ao+4]=so,Lt&&(Ei||(Ei=this._map(At,Un,!0),Ho=this.clusterProps.length,this.clusterProps.push(Ei)),Lt(Ei,this._map(At,ao)))}At[Un+4]=so,Pt.push(oo/Er,_o/Er,1/0,so,-1,Er),Lt&&Pt.push(Ho)}else{for(let Ei=0;Ei<xn;Ei++)Pt.push(At[Un+Ei]);if(Er>1)for(const Ei of Lr){const oo=Ei*xn;if(!(At[oo+2]<=Te)){At[oo+2]=Te;for(let _o=0;_o<xn;_o++)Pt.push(At[oo+_o])}}}}return Pt}_getOriginId(Ee){return Ee-this.points.length>>5}_getOriginZoom(Ee){return(Ee-this.points.length)%32}_map(Ee,Te,et){if(Ee[Te+le]>1){const Rt=this.clusterProps[Ee[Te+Ne]];return et?Object.assign({},Rt):Rt}const ht=this.points[Ee[Te+xe]].properties,Lt=this.options.map(ht);return et&&Lt===ht?Object.assign({},Lt):Lt}}function Qe(lt,Ee,Te){return{type:"Feature",id:lt[Ee+xe],properties:rt(lt,Ee,Te),geometry:{type:"Point",coordinates:[(et=lt[Ee],360*(et-.5)),Mt(lt[Ee+1])]}};var et}function rt(lt,Ee,Te){const et=lt[Ee+le],ht=et>=1e4?`${Math.round(et/1e3)}k`:et>=1e3?Math.round(et/100)/10+"k":et,Lt=lt[Ee+Ne],Rt=Lt===-1?{}:Object.assign({},Te[Lt]);return Object.assign(Rt,{cluster:!0,cluster_id:lt[Ee+xe],point_count:et,point_count_abbreviated:ht})}function gt(lt){return lt/360+.5}function pt(lt){const Ee=Math.sin(lt*Math.PI/180),Te=.5-.25*Math.log((1+Ee)/(1-Ee))/Math.PI;return Te<0?0:Te>1?1:Te}function Mt(lt){const Ee=(180-360*lt)*Math.PI/180;return 360*Math.atan(Math.exp(Ee))/Math.PI-90}function Jt(lt,Ee,Te,et){for(var ht,Lt=et,Rt=Te-Ee>>1,Ot=Te-Ee,At=lt[Ee],Pt=lt[Ee+1],xn=lt[Te],Un=lt[Te+1],In=Ee+3;In<Te;In+=3){var kr=hn(lt[In],lt[In+1],At,Pt,xn,Un);if(kr>Lt)ht=In,Lt=kr;else if(kr===Lt){var Lr=Math.abs(In-Rt);Lr<Ot&&(ht=In,Ot=Lr)}}Lt>et&&(ht-Ee>3&&Jt(lt,Ee,ht,et),lt[ht+2]=Lt,Te-ht>3&&Jt(lt,ht,Te,et))}function hn(lt,Ee,Te,et,ht,Lt){var Rt=ht-Te,Ot=Lt-et;if(Rt!==0||Ot!==0){var At=((lt-Te)*Rt+(Ee-et)*Ot)/(Rt*Rt+Ot*Ot);At>1?(Te=ht,et=Lt):At>0&&(Te+=Rt*At,et+=Ot*At)}return(Rt=lt-Te)*Rt+(Ot=Ee-et)*Ot}function yn(lt,Ee,Te,et){var ht={id:lt===void 0?null:lt,type:Ee,geometry:Te,tags:et,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return(function(Lt){var Rt=Lt.geometry,Ot=Lt.type;if(Ot==="Point"||Ot==="MultiPoint"||Ot==="LineString")Mn(Lt,Rt);else if(Ot==="Polygon"||Ot==="MultiLineString")for(var At=0;At<Rt.length;At++)Mn(Lt,Rt[At]);else if(Ot==="MultiPolygon")for(At=0;At<Rt.length;At++)for(var Pt=0;Pt<Rt[At].length;Pt++)Mn(Lt,Rt[At][Pt])})(ht),ht}function Mn(lt,Ee){for(var Te=0;Te<Ee.length;Te+=3)lt.minX=Math.min(lt.minX,Ee[Te]),lt.minY=Math.min(lt.minY,Ee[Te+1]),lt.maxX=Math.max(lt.maxX,Ee[Te]),lt.maxY=Math.max(lt.maxY,Ee[Te+1])}function Gt(lt,Ee,Te,et){if(Ee.geometry){var ht=Ee.geometry.coordinates,Lt=Ee.geometry.type,Rt=Math.pow(Te.tolerance/((1<<Te.maxZoom)*Te.extent),2),Ot=[],At=Ee.id;if(Te.promoteId?At=Ee.properties[Te.promoteId]:Te.generateId&&(At=et||0),Lt==="Point")ot(ht,Ot);else if(Lt==="MultiPoint")for(var Pt=0;Pt<ht.length;Pt++)ot(ht[Pt],Ot);else if(Lt==="LineString")dr(ht,Ot,Rt,!1);else if(Lt==="MultiLineString"){if(Te.lineMetrics){for(Pt=0;Pt<ht.length;Pt++)dr(ht[Pt],Ot=[],Rt,!1),lt.push(yn(At,"LineString",Ot,Ee.properties));return}wr(ht,Ot,Rt,!1)}else if(Lt==="Polygon")wr(ht,Ot,Rt,!0);else{if(Lt!=="MultiPolygon"){if(Lt==="GeometryCollection"){for(Pt=0;Pt<Ee.geometry.geometries.length;Pt++)Gt(lt,{id:At,geometry:Ee.geometry.geometries[Pt],properties:Ee.properties},Te,et);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Pt=0;Pt<ht.length;Pt++){var xn=[];wr(ht[Pt],xn,Rt,!0),Ot.push(xn)}}lt.push(yn(At,Lt,Ot,Ee.properties))}}function ot(lt,Ee){Ee.push(Cr(lt[0])),Ee.push(Ln(lt[1])),Ee.push(0)}function dr(lt,Ee,Te,et){for(var ht,Lt,Rt=0,Ot=0;Ot<lt.length;Ot++){var At=Cr(lt[Ot][0]),Pt=Ln(lt[Ot][1]);Ee.push(At),Ee.push(Pt),Ee.push(0),Ot>0&&(Rt+=et?(ht*Pt-At*Lt)/2:Math.sqrt(Math.pow(At-ht,2)+Math.pow(Pt-Lt,2))),ht=At,Lt=Pt}var xn=Ee.length-3;Ee[2]=1,Jt(Ee,0,xn,Te),Ee[xn+2]=1,Ee.size=Math.abs(Rt),Ee.start=0,Ee.end=Ee.size}function wr(lt,Ee,Te,et){for(var ht=0;ht<lt.length;ht++){var Lt=[];dr(lt[ht],Lt,Te,et),Ee.push(Lt)}}function Cr(lt){return lt/360+.5}function Ln(lt){var Ee=Math.sin(lt*Math.PI/180),Te=.5-.25*Math.log((1+Ee)/(1-Ee))/Math.PI;return Te<0?0:Te>1?1:Te}function ir(lt,Ee,Te,et,ht,Lt,Rt,Ot){if(et/=Ee,Lt>=(Te/=Ee)&&Rt<et)return lt;if(Rt<Te||Lt>=et)return null;for(var At=[],Pt=0;Pt<lt.length;Pt++){var xn=lt[Pt],Un=xn.geometry,In=xn.type,kr=ht===0?xn.minX:xn.minY,Lr=ht===0?xn.maxX:xn.maxY;if(kr>=Te&&Lr<et)At.push(xn);else if(!(Lr<Te||kr>=et)){var jr=[];if(In==="Point"||In==="MultiPoint")Qn(Un,jr,Te,et,ht);else if(In==="LineString")Kr(Un,jr,Te,et,ht,!1,Ot.lineMetrics);else if(In==="MultiLineString")Pn(Un,jr,Te,et,ht,!1);else if(In==="Polygon")Pn(Un,jr,Te,et,ht,!0);else if(In==="MultiPolygon")for(var Er=0;Er<Un.length;Er++){var Ei=[];Pn(Un[Er],Ei,Te,et,ht,!0),Ei.length&&jr.push(Ei)}if(jr.length){if(Ot.lineMetrics&&In==="LineString"){for(Er=0;Er<jr.length;Er++)At.push(yn(xn.id,In,jr[Er],xn.tags));continue}In!=="LineString"&&In!=="MultiLineString"||(jr.length===1?(In="LineString",jr=jr[0]):In="MultiLineString"),In!=="Point"&&In!=="MultiPoint"||(In=jr.length===3?"Point":"MultiPoint"),At.push(yn(xn.id,In,jr,xn.tags))}}}return At.length?At:null}function Qn(lt,Ee,Te,et,ht){for(var Lt=0;Lt<lt.length;Lt+=3){var Rt=lt[Lt+ht];Rt>=Te&&Rt<=et&&(Ee.push(lt[Lt]),Ee.push(lt[Lt+1]),Ee.push(lt[Lt+2]))}}function Kr(lt,Ee,Te,et,ht,Lt,Rt){for(var Ot,At,Pt=qt(lt),xn=ht===0?Bn:Rr,Un=lt.start,In=0;In<lt.length-3;In+=3){var kr=lt[In],Lr=lt[In+1],jr=lt[In+2],Er=lt[In+3],Ei=lt[In+4],oo=ht===0?kr:Lr,_o=ht===0?Er:Ei,Ho=!1;Rt&&(Ot=Math.sqrt(Math.pow(kr-Er,2)+Math.pow(Lr-Ei,2))),oo<Te?_o>Te&&(At=xn(Pt,kr,Lr,Er,Ei,Te),Rt&&(Pt.start=Un+Ot*At)):oo>et?_o<et&&(At=xn(Pt,kr,Lr,Er,Ei,et),Rt&&(Pt.start=Un+Ot*At)):Hn(Pt,kr,Lr,jr),_o<Te&&oo>=Te&&(At=xn(Pt,kr,Lr,Er,Ei,Te),Ho=!0),_o>et&&oo<=et&&(At=xn(Pt,kr,Lr,Er,Ei,et),Ho=!0),!Lt&&Ho&&(Rt&&(Pt.end=Un+Ot*At),Ee.push(Pt),Pt=qt(lt)),Rt&&(Un+=Ot)}var so=lt.length-3;kr=lt[so],Lr=lt[so+1],jr=lt[so+2],(oo=ht===0?kr:Lr)>=Te&&oo<=et&&Hn(Pt,kr,Lr,jr),so=Pt.length-3,Lt&&so>=3&&(Pt[so]!==Pt[0]||Pt[so+1]!==Pt[1])&&Hn(Pt,Pt[0],Pt[1],Pt[2]),Pt.length&&Ee.push(Pt)}function qt(lt){var Ee=[];return Ee.size=lt.size,Ee.start=lt.start,Ee.end=lt.end,Ee}function Pn(lt,Ee,Te,et,ht,Lt){for(var Rt=0;Rt<lt.length;Rt++)Kr(lt[Rt],Ee,Te,et,ht,Lt,!1)}function Hn(lt,Ee,Te,et){lt.push(Ee),lt.push(Te),lt.push(et)}function Bn(lt,Ee,Te,et,ht,Lt){var Rt=(Lt-Ee)/(et-Ee);return lt.push(Lt),lt.push(Te+(ht-Te)*Rt),lt.push(1),Rt}function Rr(lt,Ee,Te,et,ht,Lt){var Rt=(Lt-Te)/(ht-Te);return lt.push(Ee+(et-Ee)*Rt),lt.push(Lt),lt.push(1),Rt}function vr(lt,Ee){for(var Te=[],et=0;et<lt.length;et++){var ht,Lt=lt[et],Rt=Lt.type;if(Rt==="Point"||Rt==="MultiPoint"||Rt==="LineString")ht=Tr(Lt.geometry,Ee);else if(Rt==="MultiLineString"||Rt==="Polygon"){ht=[];for(var Ot=0;Ot<Lt.geometry.length;Ot++)ht.push(Tr(Lt.geometry[Ot],Ee))}else if(Rt==="MultiPolygon")for(ht=[],Ot=0;Ot<Lt.geometry.length;Ot++){for(var At=[],Pt=0;Pt<Lt.geometry[Ot].length;Pt++)At.push(Tr(Lt.geometry[Ot][Pt],Ee));ht.push(At)}Te.push(yn(Lt.id,Rt,ht,Lt.tags))}return Te}function Tr(lt,Ee){var Te=[];Te.size=lt.size,lt.start!==void 0&&(Te.start=lt.start,Te.end=lt.end);for(var et=0;et<lt.length;et+=3)Te.push(lt[et]+Ee,lt[et+1],lt[et+2]);return Te}function Ir(lt,Ee){if(lt.transformed)return lt;var Te,et,ht,Lt=1<<lt.z,Rt=lt.x,Ot=lt.y;for(Te=0;Te<lt.features.length;Te++){var At=lt.features[Te],Pt=At.geometry,xn=At.type;if(At.geometry=[],xn===1)for(et=0;et<Pt.length;et+=2)At.geometry.push(Pr(Pt[et],Pt[et+1],Ee,Lt,Rt,Ot));else for(et=0;et<Pt.length;et++){var Un=[];for(ht=0;ht<Pt[et].length;ht+=2)Un.push(Pr(Pt[et][ht],Pt[et][ht+1],Ee,Lt,Rt,Ot));At.geometry.push(Un)}}return lt.transformed=!0,lt}function Pr(lt,Ee,Te,et,ht,Lt){return[Math.round(Te*(lt*et-ht)),Math.round(Te*(Ee*et-Lt))]}function Si(lt,Ee,Te,et,ht){for(var Lt=Ee===ht.maxZoom?0:ht.tolerance/((1<<Ee)*ht.extent),Rt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Te,y:et,z:Ee,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ot=0;Ot<lt.length;Ot++){Rt.numFeatures++,ki(Rt,lt[Ot],Lt,ht);var At=lt[Ot].minX,Pt=lt[Ot].minY,xn=lt[Ot].maxX,Un=lt[Ot].maxY;At<Rt.minX&&(Rt.minX=At),Pt<Rt.minY&&(Rt.minY=Pt),xn>Rt.maxX&&(Rt.maxX=xn),Un>Rt.maxY&&(Rt.maxY=Un)}return Rt}function ki(lt,Ee,Te,et){var ht=Ee.geometry,Lt=Ee.type,Rt=[];if(Lt==="Point"||Lt==="MultiPoint")for(var Ot=0;Ot<ht.length;Ot+=3)Rt.push(ht[Ot]),Rt.push(ht[Ot+1]),lt.numPoints++,lt.numSimplified++;else if(Lt==="LineString")or(Rt,ht,lt,Te,!1,!1);else if(Lt==="MultiLineString"||Lt==="Polygon")for(Ot=0;Ot<ht.length;Ot++)or(Rt,ht[Ot],lt,Te,Lt==="Polygon",Ot===0);else if(Lt==="MultiPolygon")for(var At=0;At<ht.length;At++){var Pt=ht[At];for(Ot=0;Ot<Pt.length;Ot++)or(Rt,Pt[Ot],lt,Te,!0,Ot===0)}if(Rt.length){var xn=Ee.tags||null;if(Lt==="LineString"&&et.lineMetrics){for(var Un in xn={},Ee.tags)xn[Un]=Ee.tags[Un];xn.mapbox_clip_start=ht.start/ht.size,xn.mapbox_clip_end=ht.end/ht.size}var In={geometry:Rt,type:Lt==="Polygon"||Lt==="MultiPolygon"?3:Lt==="LineString"||Lt==="MultiLineString"?2:1,tags:xn};Ee.id!==null&&(In.id=Ee.id),lt.features.push(In)}}function or(lt,Ee,Te,et,ht,Lt){var Rt=et*et;if(et>0&&Ee.size<(ht?Rt:et))Te.numPoints+=Ee.length/3;else{for(var Ot=[],At=0;At<Ee.length;At+=3)(et===0||Ee[At+2]>Rt)&&(Te.numSimplified++,Ot.push(Ee[At]),Ot.push(Ee[At+1])),Te.numPoints++;ht&&(function(Pt,xn){for(var Un=0,In=0,kr=Pt.length,Lr=kr-2;In<kr;Lr=In,In+=2)Un+=(Pt[In]-Pt[Lr])*(Pt[In+1]+Pt[Lr+1]);if(Un>0===xn)for(In=0,kr=Pt.length;In<kr/2;In+=2){var jr=Pt[In],Er=Pt[In+1];Pt[In]=Pt[kr-2-In],Pt[In+1]=Pt[kr-1-In],Pt[kr-2-In]=jr,Pt[kr-1-In]=Er}})(Ot,Lt),lt.push(Ot)}}function oi(lt,Ee){var Te=(Ee=this.options=(function(ht,Lt){for(var Rt in Lt)ht[Rt]=Lt[Rt];return ht})(Object.create(this.options),Ee)).debug;if(Te&&console.time("preprocess data"),Ee.maxZoom<0||Ee.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Ee.promoteId&&Ee.generateId)throw new Error("promoteId and generateId cannot be used together.");var et=(function(ht,Lt){var Rt=[];if(ht.type==="FeatureCollection")for(var Ot=0;Ot<ht.features.length;Ot++)Gt(Rt,ht.features[Ot],Lt,Ot);else Gt(Rt,ht.type==="Feature"?ht:{geometry:ht},Lt);return Rt})(lt,Ee);this.tiles={},this.tileCoords=[],Te&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Ee.indexMaxZoom,Ee.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),et=(function(ht,Lt){var Rt=Lt.buffer/Lt.extent,Ot=ht,At=ir(ht,1,-1-Rt,Rt,0,-1,2,Lt),Pt=ir(ht,1,1-Rt,2+Rt,0,-1,2,Lt);return(At||Pt)&&(Ot=ir(ht,1,-Rt,1+Rt,0,-1,2,Lt)||[],At&&(Ot=vr(At,1).concat(Ot)),Pt&&(Ot=Ot.concat(vr(Pt,-1)))),Ot})(et,Ee),et.length&&this.splitTile(et,0,0,0),Te&&(et.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Gr(lt,Ee,Te){return 32*((1<<lt)*Te+Ee)+lt}function Or(lt,Ee){const Te=lt.tileID.canonical;if(!this._geoJSONIndex)return Ee(null,null);const et=this._geoJSONIndex.getTile(Te.z,Te.x,Te.y);if(!et)return Ee(null,null);const ht=new class{constructor(Rt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=Rt.length,this._features=Rt}feature(Rt){return new class{constructor(Ot){this._feature=Ot,this.extent=o.EXTENT,this.type=Ot.type,this.properties=Ot.tags,"id"in Ot&&!isNaN(Ot.id)&&(this.id=parseInt(Ot.id,10))}loadGeometry(){if(this._feature.type===1){const Ot=[];for(const At of this._feature.geometry)Ot.push([new o.Point(At[0],At[1])]);return Ot}{const Ot=[];for(const At of this._feature.geometry){const Pt=[];for(const xn of At)Pt.push(new o.Point(xn[0],xn[1]));Ot.push(Pt)}return Ot}}toGeoJSON(Ot,At,Pt){return de.call(this,Ot,At,Pt)}}(this._features[Rt])}}(et.features);let Lt=Me(ht);Lt.byteOffset===0&&Lt.byteLength===Lt.buffer.byteLength||(Lt=new Uint8Array(Lt)),Ee(null,{vectorTile:ht,rawData:Lt.buffer})}oi.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},oi.prototype.splitTile=function(lt,Ee,Te,et,ht,Lt,Rt){for(var Ot=[lt,Ee,Te,et],At=this.options,Pt=At.debug;Ot.length;){et=Ot.pop(),Te=Ot.pop(),Ee=Ot.pop(),lt=Ot.pop();var xn=1<<Ee,Un=Gr(Ee,Te,et),In=this.tiles[Un];if(!In&&(Pt>1&&console.time("creation"),In=this.tiles[Un]=Si(lt,Ee,Te,et,At),this.tileCoords.push({z:Ee,x:Te,y:et}),Pt)){Pt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Ee,Te,et,In.numFeatures,In.numPoints,In.numSimplified),console.timeEnd("creation"));var kr="z"+Ee;this.stats[kr]=(this.stats[kr]||0)+1,this.total++}if(In.source=lt,ht){if(Ee===At.maxZoom||Ee===ht)continue;var Lr=1<<ht-Ee;if(Te!==Math.floor(Lt/Lr)||et!==Math.floor(Rt/Lr))continue}else if(Ee===At.indexMaxZoom||In.numPoints<=At.indexMaxPoints)continue;if(In.source=null,lt.length!==0){Pt>1&&console.time("clipping");var jr,Er,Ei,oo,_o,Ho,so=.5*At.buffer/At.extent,_s=.5-so,ao=.5+so,Cs=1+so;jr=Er=Ei=oo=null,_o=ir(lt,xn,Te-so,Te+ao,0,In.minX,In.maxX,At),Ho=ir(lt,xn,Te+_s,Te+Cs,0,In.minX,In.maxX,At),lt=null,_o&&(jr=ir(_o,xn,et-so,et+ao,1,In.minY,In.maxY,At),Er=ir(_o,xn,et+_s,et+Cs,1,In.minY,In.maxY,At),_o=null),Ho&&(Ei=ir(Ho,xn,et-so,et+ao,1,In.minY,In.maxY,At),oo=ir(Ho,xn,et+_s,et+Cs,1,In.minY,In.maxY,At),Ho=null),Pt>1&&console.timeEnd("clipping"),Ot.push(jr||[],Ee+1,2*Te,2*et),Ot.push(Er||[],Ee+1,2*Te,2*et+1),Ot.push(Ei||[],Ee+1,2*Te+1,2*et),Ot.push(oo||[],Ee+1,2*Te+1,2*et+1)}}},oi.prototype.getTile=function(lt,Ee,Te){var et=this.options,ht=et.extent,Lt=et.debug;if(lt<0||lt>24)return null;var Rt=1<<lt,Ot=Gr(lt,Ee=(Ee%Rt+Rt)%Rt,Te);if(this.tiles[Ot])return Ir(this.tiles[Ot],ht);Lt>1&&console.log("drilling down to z%d-%d-%d",lt,Ee,Te);for(var At,Pt=lt,xn=Ee,Un=Te;!At&&Pt>0;)Pt--,xn=Math.floor(xn/2),Un=Math.floor(Un/2),At=this.tiles[Gr(Pt,xn,Un)];return At&&At.source?(Lt>1&&console.log("found parent tile z%d-%d-%d",Pt,xn,Un),Lt>1&&console.time("drilling down"),this.splitTile(At.source,Pt,xn,Un,lt,Ee,Te),Lt>1&&console.timeEnd("drilling down"),this.tiles[Ot]?Ir(this.tiles[Ot],ht):null):null};class hi extends o.VectorTileWorkerSource{constructor(Ee,Te,et,ht,Lt){super(Ee,Te,et,ht,Or),Lt&&(this.loadGeoJSON=Lt)}loadData(Ee,Te){const et=Ee&&Ee.request,ht=et&&et.collectResourceTiming;this.loadGeoJSON(Ee,((Lt,Rt)=>{if(Lt||!Rt)return Te(Lt);if(typeof Rt!="object")return Te(new Error(`Input data given to '${Ee.source}' is not a valid GeoJSON object.`));{se(Rt,!0);try{if(Ee.filter){const At=o.createExpression(Ee.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(At.result==="error")throw new Error(At.value.map((xn=>`${xn.key}: ${xn.message}`)).join(", "));Rt={type:"FeatureCollection",features:Rt.features.filter((xn=>At.value.evaluate({zoom:0},xn)))}}this._geoJSONIndex=Ee.cluster?new Be((function({superclusterOptions:At,clusterProperties:Pt}){if(!Pt||!At)return At;const xn={},Un={},In={accumulated:null,zoom:0},kr={properties:null},Lr=Object.keys(Pt);for(const jr of Lr){const[Er,Ei]=Pt[jr],oo=o.createExpression(Ei),_o=o.createExpression(typeof Er=="string"?[Er,["accumulated"],["get",jr]]:Er);xn[jr]=oo.value,Un[jr]=_o.value}return At.map=jr=>{kr.properties=jr;const Er={};for(const Ei of Lr)Er[Ei]=xn[Ei].evaluate(In,kr);return Er},At.reduce=(jr,Er)=>{kr.properties=Er;for(const Ei of Lr)In.accumulated=jr[Ei],jr[Ei]=Un[Ei].evaluate(In,kr)},At})(Ee)).load(Rt.features):(function(At,Pt){return new oi(At,Pt)})(Rt,Ee.geojsonVtOptions)}catch(At){return Te(At)}this.loaded={};const Ot={};if(ht){const At=o.getPerformanceMeasurement(et);At&&(Ot.resourceTiming={},Ot.resourceTiming[Ee.source]=JSON.parse(JSON.stringify(At)))}Te(null,Ot)}}))}reloadTile(Ee,Te){const et=this.loaded;return et&&et[Ee.uid]?super.reloadTile(Ee,Te):this.loadTile(Ee,Te)}loadGeoJSON(Ee,Te){if(Ee.request)o.getJSON(Ee.request,Te);else{if(typeof Ee.data!="string")return Te(new Error(`Input data given to '${Ee.source}' is not a valid GeoJSON object.`));try{return Te(null,JSON.parse(Ee.data))}catch{return Te(new Error(`Input data given to '${Ee.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Ee,Te){try{Te(null,this._geoJSONIndex.getClusterExpansionZoom(Ee.clusterId))}catch(et){Te(et)}}getClusterChildren(Ee,Te){try{Te(null,this._geoJSONIndex.getChildren(Ee.clusterId))}catch(et){Te(et)}}getClusterLeaves(Ee,Te){try{Te(null,this._geoJSONIndex.getLeaves(Ee.clusterId,Ee.limit,Ee.offset))}catch(et){Te(et)}}}class si{constructor(Ee){this.self=Ee,this.actor=new o.Actor(Ee,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.getProjection({name:"mercator"}),this.workerSourceTypes={vector:o.VectorTileWorkerSource,geojson:hi},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Te,et)=>{if(this.workerSourceTypes[Te])throw new Error(`Worker source with name "${Te}" already registered.`);this.workerSourceTypes[Te]=et},this.self.registerRTLTextPlugin=Te=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=Te.applyArabicShaping,o.plugin.processBidirectionalText=Te.processBidirectionalText,o.plugin.processStyledBidirectionalText=Te.processStyledBidirectionalText}}clearCaches(Ee,Te,et){delete this.layerIndexes[Ee],delete this.availableImages[Ee],delete this.workerSources[Ee],delete this.demWorkerSources[Ee],et()}checkIfReady(Ee,Te,et){et()}setReferrer(Ee,Te){this.referrer=Te}spriteLoaded(Ee,Te){this.isSpriteLoaded[Ee]=Te;for(const et in this.workerSources[Ee]){const ht=this.workerSources[Ee][et];for(const Lt in ht)ht[Lt]instanceof o.VectorTileWorkerSource&&(ht[Lt].isSpriteLoaded=Te,ht[Lt].fire(new o.Event("isSpriteLoaded")))}}setImages(Ee,Te,et){this.availableImages[Ee]=Te;for(const ht in this.workerSources[Ee]){const Lt=this.workerSources[Ee][ht];for(const Rt in Lt)Lt[Rt].availableImages=Te}et()}enableTerrain(Ee,Te,et){this.terrain=Te,et()}setProjection(Ee,Te){this.projections[Ee]=o.getProjection(Te)}setLayers(Ee,Te,et){this.getLayerIndex(Ee).replace(Te),et()}updateLayers(Ee,Te,et){this.getLayerIndex(Ee).update(Te.layers,Te.removedIds),et()}loadTile(Ee,Te,et){const ht=this.enableTerrain?o.extend({enableTerrain:this.terrain},Te):Te;ht.projection=this.projections[Ee]||this.defaultProjection,this.getWorkerSource(Ee,Te.type,Te.source).loadTile(ht,et)}loadDEMTile(Ee,Te,et){const ht=this.enableTerrain?o.extend({buildQuadTree:this.terrain},Te):Te;this.getDEMWorkerSource(Ee,Te.source).loadTile(ht,et)}reloadTile(Ee,Te,et){const ht=this.enableTerrain?o.extend({enableTerrain:this.terrain},Te):Te;ht.projection=this.projections[Ee]||this.defaultProjection,this.getWorkerSource(Ee,Te.type,Te.source).reloadTile(ht,et)}abortTile(Ee,Te,et){this.getWorkerSource(Ee,Te.type,Te.source).abortTile(Te,et)}removeTile(Ee,Te,et){this.getWorkerSource(Ee,Te.type,Te.source).removeTile(Te,et)}removeSource(Ee,Te,et){if(!this.workerSources[Ee]||!this.workerSources[Ee][Te.type]||!this.workerSources[Ee][Te.type][Te.source])return;const ht=this.workerSources[Ee][Te.type][Te.source];delete this.workerSources[Ee][Te.type][Te.source],ht.removeSource!==void 0?ht.removeSource(Te,et):et()}loadWorkerSource(Ee,Te,et){try{this.self.importScripts(Te.url),et()}catch(ht){et(ht.toString())}}syncRTLPluginState(Ee,Te,et){try{o.plugin.setState(Te);const ht=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&ht!=null){this.self.importScripts(ht);const Lt=o.plugin.isParsed();et(Lt?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ht}`),Lt)}}catch(ht){et(ht.toString())}}getAvailableImages(Ee){let Te=this.availableImages[Ee];return Te||(Te=[]),Te}getLayerIndex(Ee){let Te=this.layerIndexes[Ee];return Te||(Te=this.layerIndexes[Ee]=new M),Te}getWorkerSource(Ee,Te,et){if(this.workerSources[Ee]||(this.workerSources[Ee]={}),this.workerSources[Ee][Te]||(this.workerSources[Ee][Te]={}),!this.workerSources[Ee][Te][et]){const ht={send:(Lt,Rt,Ot,At,Pt,xn)=>{this.actor.send(Lt,Rt,Ot,Ee,Pt,xn)},scheduler:this.actor.scheduler};this.workerSources[Ee][Te][et]=new this.workerSourceTypes[Te](ht,this.getLayerIndex(Ee),this.getAvailableImages(Ee),this.isSpriteLoaded[Ee])}return this.workerSources[Ee][Te][et]}getDEMWorkerSource(Ee,Te){return this.demWorkerSources[Ee]||(this.demWorkerSources[Ee]={}),this.demWorkerSources[Ee][Te]||(this.demWorkerSources[Ee][Te]=new V),this.demWorkerSources[Ee][Te]}enforceCacheSizeLimit(Ee,Te){o.enforceCacheSizeLimit(Te)}getWorkerPerformanceMetrics(Ee,Te,et){et(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new si(self)),si})),m(["./shared"],(function(o){function b(y,a){if(Array.isArray(y)){if(!Array.isArray(a)||y.length!==a.length)return!1;for(let f=0;f<y.length;f++)if(!b(y[f],a[f]))return!1;return!0}if(typeof y=="object"&&y!==null&&a!==null){if(typeof a!="object"||Object.keys(y).length!==Object.keys(a).length)return!1;for(const f in y)if(!b(y[f],a[f]))return!1;return!0}return y===a}var I=M;function M(y){return!(function(a){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var v,S,T=new Blob([""],{type:"text/javascript"}),N=URL.createObjectURL(T);try{S=new Worker(N),v=!0}catch{v=!1}return S&&S.terminate(),URL.revokeObjectURL(N),v})()?"Uint8ClampedArray"in window?ArrayBuffer.isView?(function(){var v=document.createElement("canvas");v.width=v.height=1;var S=v.getContext("2d");if(!S)return!1;var T=S.getImageData(0,0,1,1);return T&&T.width===v.width})()?(V[f=a&&a.failIfMajorPerformanceCaveat]===void 0&&(V[f]=(function(v){var S,T=(function(N){var z=document.createElement("canvas"),G=Object.create(M.webGLContextAttributes);return G.failIfMajorPerformanceCaveat=N,z.getContext("webgl",G)||z.getContext("experimental-webgl",G)})(v);if(!T)return!1;try{S=T.createShader(T.VERTEX_SHADER)}catch{return!1}return!(!S||T.isContextLost())&&(T.shaderSource(S,"void main() {}"),T.compileShader(S),T.getShaderParameter(S,T.COMPILE_STATUS)===!0)})(f)),V[f]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var f})(y)}var V={};function k(y,a,f){const v=o.window.document.createElement(y);return a!==void 0&&(v.className=a),f&&f.appendChild(v),v}function ie(y,a,f){const v=o.window.document.createElementNS("http://www.w3.org/2000/svg",y);for(const S of Object.keys(a))v.setAttributeNS(null,S,a[S]);return f&&f.appendChild(v),v}M.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const se=o.window.document&&o.window.document.documentElement.style,de=se&&se.userSelect!==void 0?"userSelect":"WebkitUserSelect";let J;function ne(){se&&de&&(J=se[de],se[de]="none")}function me(){se&&de&&(se[de]=J)}function ue(y){y.preventDefault(),y.stopPropagation(),o.window.removeEventListener("click",ue,!0)}function ke(){o.window.addEventListener("click",ue,!0),o.window.setTimeout((()=>{o.window.removeEventListener("click",ue,!0)}),0)}function ze(y,a){const f=y.getBoundingClientRect();return F(y,f,a)}function pe(y,a){const f=y.getBoundingClientRect(),v=[];for(let S=0;S<a.length;S++)v.push(F(y,f,a[S]));return v}function U(y){return o.window.InstallTrigger!==void 0&&y.button===2&&y.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:y.button}function F(y,a,f){const v=y.offsetWidth===a.width?1:y.offsetWidth/a.width;return new o.Point((f.clientX-a.left)*v,(f.clientY-a.top)*v)}function q(y,a){var f=a[0],v=a[1],S=a[2],T=a[3],N=f*T-S*v;return N?(y[0]=T*(N=1/N),y[1]=-v*N,y[2]=-S*N,y[3]=f*N,y):null}function j(y){const{userImage:a}=y;return!!(a&&a.render&&a.render())&&(y.data.replace(new Uint8Array(a.data.buffer)),!0)}class H extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(a){if(this.loaded!==a&&(this.loaded=a,a)){for(const{ids:f,callback:v}of this.requestors)this._notify(f,v);this.requestors=[]}}hasImage(a){return!!this.getImage(a)}getImage(a){return this.images[a]}addImage(a,f){this._validate(a,f)&&(this.images[a]=f)}_validate(a,f){let v=!0;return this._validateStretch(f.stretchX,f.data&&f.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${a}" has invalid "stretchX" value`))),v=!1),this._validateStretch(f.stretchY,f.data&&f.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${a}" has invalid "stretchY" value`))),v=!1),this._validateContent(f.content,f)||(this.fire(new o.ErrorEvent(new Error(`Image "${a}" has invalid "content" value`))),v=!1),v}_validateStretch(a,f){if(!a)return!0;let v=0;for(const S of a){if(S[0]<v||S[1]<S[0]||f<S[1])return!1;v=S[1]}return!0}_validateContent(a,f){return!(a&&(a.length!==4||a[0]<0||f.data.width<a[0]||a[1]<0||f.data.height<a[1]||a[2]<0||f.data.width<a[2]||a[3]<0||f.data.height<a[3]||a[2]<a[0]||a[3]<a[1]))}updateImage(a,f){f.version=this.images[a].version+1,this.images[a]=f,this.updatedImages[a]=!0}removeImage(a){const f=this.images[a];delete this.images[a],delete this.patterns[a],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(a,f){let v=!0;if(!this.isLoaded())for(const S of a)this.images[S]||(v=!1);this.isLoaded()||v?this._notify(a,f):this.requestors.push({ids:a,callback:f})}_notify(a,f){const v={};for(const S of a){this.images[S]||this.fire(new o.Event("styleimagemissing",{id:S}));const T=this.images[S];T?v[S]={data:T.data.clone(),pixelRatio:T.pixelRatio,sdf:T.sdf,version:T.version,stretchX:T.stretchX,stretchY:T.stretchY,content:T.content,hasRenderCallback:!!(T.userImage&&T.userImage.render)}:o.warnOnce(`Image "${S}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}f(null,v)}getPixelSize(){const{width:a,height:f}=this.atlasImage;return{width:a,height:f}}getPattern(a){const f=this.patterns[a],v=this.getImage(a);if(!v)return null;if(f&&f.position.version===v.version)return f.position;if(f)f.position.version=v.version;else{const S={w:v.data.width+2,h:v.data.height+2,x:0,y:0},T=new o.ImagePosition(S,v);this.patterns[a]={bin:S,position:T}}return this._updatePatternAtlas(),this.patterns[a].position}bind(a){const f=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(a,this.atlasImage,f.RGBA),this.atlasTexture&&this.atlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(){const a=[];for(const T in this.patterns)a.push(this.patterns[T].bin);const{w:f,h:v}=o.potpack(a),S=this.atlasImage;S.resize({width:f||1,height:v||1});for(const T in this.patterns){const{bin:N}=this.patterns[T],z=N.x+1,G=N.y+1,Q=this.images[T].data,te=Q.width,ge=Q.height;o.RGBAImage.copy(Q,S,{x:0,y:0},{x:z,y:G},{width:te,height:ge}),o.RGBAImage.copy(Q,S,{x:0,y:ge-1},{x:z,y:G-1},{width:te,height:1}),o.RGBAImage.copy(Q,S,{x:0,y:0},{x:z,y:G+ge},{width:te,height:1}),o.RGBAImage.copy(Q,S,{x:te-1,y:0},{x:z-1,y:G},{width:1,height:ge}),o.RGBAImage.copy(Q,S,{x:0,y:0},{x:z+te,y:G},{width:1,height:ge})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(a){for(const f of a){if(this.callbackDispatchedThisFrame[f])continue;this.callbackDispatchedThisFrame[f]=!0;const v=this.images[f];j(v)&&this.updateImage(f,v)}}}const Z=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(y,a){return(function([f,v,S]){const T=o.degToRad(v+90),N=o.degToRad(S);return{x:f*Math.cos(T)*Math.sin(N),y:f*Math.sin(T)*Math.sin(N),z:f*Math.cos(N),azimuthal:v,polar:S}})(y.expression.evaluate(a))}interpolate(y,a,f){return{x:o.number(y.x,a.x,f),y:o.number(y.y,a.y,f),z:o.number(y.z,a.z,f),azimuthal:o.number(y.azimuthal,a.azimuthal,f),polar:o.number(y.polar,a.polar,f)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)});class be extends o.Evented{constructor(a){super(),this._transitionable=new o.Transitionable(Z),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a,f={}){if(!this._validate(o.validateLight,a,f))for(const v in a){const S=a[v];o.endsWith(v,"-transition")?this._transitionable.setTransition(v.slice(0,-11),S):this._transitionable.setValue(v,S)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,f,v){return(!v||v.validate!==!1)&&o.emitValidationErrors(this,a.call(o.validateStyle,o.extend({value:f,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}const Re=new o.Properties({source:new o.DataConstantProperty(o.spec.terrain.source),exaggeration:new o.DataConstantProperty(o.spec.terrain.exaggeration)});let Oe=class extends o.Evented{constructor(y,a){super(),this._transitionable=new o.Transitionable(Re),this.set(y),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=a}get(){return this._transitionable.serialize()}set(y){for(const a in y){const f=y[a];o.endsWith(a,"-transition")?this._transitionable.setTransition(a.slice(0,-11),f):this._transitionable.setValue(a,f)}}updateTransitions(y){this._transitioning=this._transitionable.transitioned(y,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(y){this.properties=this._transitioning.possiblyEvaluate(y)}};function Me(y,a,f,v){const S=o.smoothstep(45,65,f),[T,N]=we(y,v),z=o.length(a);let G=1-Math.min(1,Math.exp((z-T)/(N-T)*-6));return G*=G*G,G=Math.min(1,1.00747*G),G*S*y.alpha}function we(y,a){const f=.5/Math.tan(.5*a);return[y.range[0]+f,y.range[1]+f]}const De=new o.Properties({range:new o.DataConstantProperty(o.spec.fog.range),color:new o.DataConstantProperty(o.spec.fog.color),"high-color":new o.DataConstantProperty(o.spec.fog["high-color"]),"space-color":new o.DataConstantProperty(o.spec.fog["space-color"]),"horizon-blend":new o.DataConstantProperty(o.spec.fog["horizon-blend"]),"star-intensity":new o.DataConstantProperty(o.spec.fog["star-intensity"])});class tt extends o.Evented{constructor(a,f){super(),this._transitionable=new o.Transitionable(De),this.set(a),this._transitioning=this._transitionable.untransitioned(),this._transform=f}get state(){const a=this._transform,f=a.projection.name==="globe",v=o.globeToMercatorTransition(a.zoom),S=this.properties.get("range"),T=[.5,3];return{range:f?[o.number(T[0],S[0],v),o.number(T[1],S[1],v)]:S,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(a,f={}){if(!this._validate(o.validateFog,a,f)){for(const v of Object.keys(o.spec.fog))a&&a[v]===void 0&&(a[v]=o.spec.fog[v].default);for(const v in a){const S=a[v];o.endsWith(v,"-transition")?this._transitionable.setTransition(v.slice(0,-11),S):this._transitionable.setValue(v,S)}}}getOpacity(a){if(!this._transform.projection.supportsFog)return 0;const f=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.smoothstep(45,65,a))*f.a}getOpacityAtLatLng(a,f){return this._transform.projection.supportsFog?(function(v,S,T){const N=o.MercatorCoordinate.fromLngLat(S),z=T.elevation?T.elevation.getAtPointOrZero(N):0,G=[N.x,N.y,z];return o.transformMat4(G,G,T.mercatorFogMatrix),Me(v,G,T.pitch,T._fov)})(this.state,a,f):0}getFovAdjustedRange(a){return this._transform.projection.supportsFog?we(this.state,a):[0,1]}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,f,v){return(!v||v.validate!==!1)&&o.emitValidationErrors(this,a.call(o.validateStyle,o.extend({value:f,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class xe{constructor(a,f){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=o.uniqueId();const v=this.workerPool.acquire(this.id);for(let S=0;S<v.length;S++){const T=new xe.Actor(v[S],f,this.id);T.name=`Worker ${S}`,this.actors.push(T)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(a,f,v){o.asyncAll(this.actors,((S,T)=>{S.send(a,f,T)}),v=v||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((a=>{a.remove()})),this.actors=[],this.workerPool.release(this.id)}}function le(y,a,f){return a*(o.EXTENT/(y.tileSize*Math.pow(2,f-y.tileID.overscaledZ)))}xe.Actor=o.Actor;class Ne{constructor(a,f,v,S){this.screenBounds=a,this.cameraPoint=f,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=v,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,S)}static createFromScreenPoints(a,f){let v,S;if(a instanceof o.Point||typeof a[0]=="number"){const T=o.Point.convert(a);v=[T],S=f.isPointAboveHorizon(T)}else{const T=o.Point.convert(a[0]),N=o.Point.convert(a[1]);v=[T,N],S=o.polygonizeBounds(T,N).every((z=>f.isPointAboveHorizon(z)))}return new Ne(v,f.getCameraPoint(),S,f)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(a){return o.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],a)}bufferedCameraGeometry(a){const f=this.screenBounds[0],v=this.screenBounds.length===1?this.screenBounds[0].add(new o.Point(1,1)):this.screenBounds[1],S=o.polygonizeBounds(f,v,0,!1);return this.cameraPoint.y>v.y&&(this.cameraPoint.x>f.x&&this.cameraPoint.x<v.x?S.splice(3,0,this.cameraPoint):this.cameraPoint.x>=v.x?S[2]=this.cameraPoint:this.cameraPoint.x<=f.x&&(S[3]=this.cameraPoint)),o.bufferConvexPolygon(S,a)}bufferedCameraGeometryGlobe(a){const f=this.screenBounds[0],v=this.screenBounds.length===1?this.screenBounds[0].add(new o.Point(1,1)):this.screenBounds[1],S=o.polygonizeBounds(f,v,a),T=this.cameraPoint.clone();switch(3*((T.y>f.y)+(T.y>v.y))+((T.x>f.x)+(T.x>v.x))){case 0:S[0]=T,S[4]=T.clone();break;case 1:S.splice(1,0,T);break;case 2:S[1]=T;break;case 3:S.splice(4,0,T);break;case 5:S.splice(2,0,T);break;case 6:S[3]=T;break;case 7:S.splice(3,0,T);break;case 8:S[2]=T}return S}containsTile(a,f,v,S=0){const T=a.queryPadding/f._pixelsPerMercatorPixel+1,N=v?this._bufferedCameraMercator(T,f):this._bufferedScreenMercator(T,f);let z=a.tileID.wrap+(N.unwrapped?S:0);const G=N.polygon.map((Ze=>o.getTilePoint(a.tileTransform,Ze,z)));if(!o.polygonIntersectsBox(G,0,0,o.EXTENT,o.EXTENT))return;z=a.tileID.wrap+(this.screenGeometryMercator.unwrapped?S:0);const Q=this.screenGeometryMercator.polygon.map((Ze=>o.getTileVec3(a.tileTransform,Ze,z))),te=Q.map((Ze=>new o.Point(Ze[0],Ze[1]))),ge=f.getFreeCameraOptions().position||new o.MercatorCoordinate(0,0,0),Ae=o.getTileVec3(a.tileTransform,ge,z),Le=Q.map((Ze=>{const _e=o.sub(Ze,Ze,Ae);return o.normalize(_e,_e),new o.Ray(Ae,_e)})),Xe=le(a,1,f.zoom)*f._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:te,tilespaceRays:Le,bufferedTilespaceGeometry:G,bufferedTilespaceBounds:(Ue=o.getBounds(G),Ue.min.x=o.clamp(Ue.min.x,0,o.EXTENT),Ue.min.y=o.clamp(Ue.min.y,0,o.EXTENT),Ue.max.x=o.clamp(Ue.max.x,0,o.EXTENT),Ue.max.y=o.clamp(Ue.max.y,0,o.EXTENT),Ue),tile:a,tileID:a.tileID,pixelToTileUnitsFactor:Xe};var Ue}_bufferedScreenMercator(a,f){const v=rt(a);if(this._screenRaycastCache[v])return this._screenRaycastCache[v];{let S;return S=f.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(a),f):{polygon:this.bufferedScreenGeometry(a).map((T=>f.pointCoordinate3D(T))),unwrapped:!0},this._screenRaycastCache[v]=S,S}}_bufferedCameraMercator(a,f){const v=rt(a);if(this._cameraRaycastCache[v])return this._cameraRaycastCache[v];{let S;return S=f.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(a),f):{polygon:this.bufferedCameraGeometry(a).map((T=>f.pointCoordinate3D(T))),unwrapped:!0},this._cameraRaycastCache[v]=S,S}}_projectAndResample(a,f){const v=(function(T,N){const z=o.multiply([],N.pixelMatrix,N.globeMatrix),G=[0,-o.GLOBE_RADIUS,0,1],Q=[0,o.GLOBE_RADIUS,0,1],te=[0,0,0,1];o.transformMat4$1(G,G,z),o.transformMat4$1(Q,Q,z),o.transformMat4$1(te,te,z);const ge=new o.Point(G[0]/G[3],G[1]/G[3]),Ae=new o.Point(Q[0]/Q[3],Q[1]/Q[3]),Le=o.polygonContainsPoint(T,ge)&&G[3]<te[3],Xe=o.polygonContainsPoint(T,Ae)&&Q[3]<te[3];if(!Le&&!Xe)return null;const Ue=(function(vt,kt,Tt){for(let Vt=1;Vt<vt.length;Vt++){const vn=Qe(kt.pointCoordinate3D(vt[Vt-1]).x),Bt=Qe(kt.pointCoordinate3D(vt[Vt]).x);if(Tt<0){if(vn<Bt)return{idx:Vt,t:-vn/(Bt-1-vn)}}else if(Bt<vn)return{idx:Vt,t:(1-vn)/(Bt+1-vn)}}return null})(T,N,Le?-1:1);if(!Ue)return null;const{idx:Ze,t:_e}=Ue;let $e=Ze>1?Be(T.slice(0,Ze),N):[],it=Ze<T.length?Be(T.slice(Ze),N):[];$e=$e.map((vt=>new o.Point(Qe(vt.x),vt.y))),it=it.map((vt=>new o.Point(Qe(vt.x),vt.y)));const st=[...$e];st.length===0&&st.push(it[it.length-1]);const bt=o.number(st[st.length-1].y,(it.length===0?$e[0]:it[0]).y,_e);let wt;return wt=Le?[new o.Point(0,bt),new o.Point(0,0),new o.Point(1,0),new o.Point(1,bt)]:[new o.Point(1,bt),new o.Point(1,1),new o.Point(0,1),new o.Point(0,bt)],st.push(...wt),it.length===0?st.push($e[0]):st.push(...it),{polygon:st.map((vt=>new o.MercatorCoordinate(vt.x,vt.y))),unwrapped:!1}})(a,f);if(v)return v;const S=(function(T,N){let z=!1,G=-1/0,Q=0;for(let ge=0;ge<T.length-1;ge++)T[ge].x>G&&(G=T[ge].x,Q=ge);for(let ge=0;ge<T.length-1;ge++){const Ae=(Q+ge)%(T.length-1),Le=T[Ae],Xe=T[Ae+1];Math.abs(Le.x-Xe.x)>.5&&(Le.x<Xe.x?(Le.x+=1,Ae===0&&(T[T.length-1].x+=1)):(Xe.x+=1,Ae+1===T.length-1&&(T[0].x+=1)),z=!0)}const te=o.mercatorXfromLng(N.center.lng);return z&&te<Math.abs(te-1)&&T.forEach((ge=>{ge.x-=1})),{polygon:T,unwrapped:z}})(Be(a,f).map((T=>new o.Point(Qe(T.x),T.y))),f);return{polygon:S.polygon.map((T=>new o.MercatorCoordinate(T.x,T.y))),unwrapped:S.unwrapped}}}function Be(y,a){return o.resample(y,(f=>{const v=a.pointCoordinate3D(f);f.x=v.x,f.y=v.y}),1/256)}function Qe(y){return y<0?1+y%1:y%1}function rt(y){return 100*y|0}function gt(y,a,f,v,S){const T=function(N,z){if(N)return S(N);if(z){y.url&&z.tiles&&y.tiles&&delete y.tiles;const G=o.pick(o.extend(z,y),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);z.vector_layers&&(G.vectorLayers=z.vector_layers,G.vectorLayerIds=G.vectorLayers.map((Q=>Q.id))),G.tiles=a.canonicalizeTileset(G,y.url),S(null,G)}};return y.url?o.getJSON(a.transformRequest(a.normalizeSourceURL(y.url,null,f,v),o.ResourceType.Source),T):o.exported.frame((()=>T(null,y)))}class pt{constructor(a,f,v){this.bounds=o.LngLatBounds.convert(this.validateBounds(a)),this.minzoom=f||0,this.maxzoom=v||24}validateBounds(a){return Array.isArray(a)&&a.length===4?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(a){const f=Math.pow(2,a.z),v=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*f),S=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*f),T=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*f),N=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*f);return a.x>=v&&a.x<T&&a.y>=S&&a.y<N}}class Mt{constructor(a,f,v){this.context=a;const S=a.gl;this.buffer=S.createBuffer(),this.dynamicDraw=!!v,this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),S.bufferData(S.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||f.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){const f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Jt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class hn{constructor(a,f,v,S){this.length=f.length,this.attributes=v,this.itemSize=f.bytesPerElement,this.dynamicDraw=S,this.context=a;const T=a.gl;this.buffer=T.createBuffer(),a.bindVertexBuffer.set(this.buffer),T.bufferData(T.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||f.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,f){for(let v=0;v<this.attributes.length;v++){const S=f.attributes[this.attributes[v].name];S!==void 0&&a.enableVertexAttribArray(S)}}setVertexAttribPointers(a,f,v){for(let S=0;S<this.attributes.length;S++){const T=this.attributes[S],N=f.attributes[T.name];N!==void 0&&a.vertexAttribPointer(N,T.components,a[Jt[T.type]],!1,this.itemSize,T.offset+this.itemSize*(v||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class yn{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Mn extends yn{getDefault(){return o.Color.transparent}set(a){const f=this.current;(a.r!==f.r||a.g!==f.g||a.b!==f.b||a.a!==f.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class Gt extends yn{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class ot extends yn{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class dr extends yn{getDefault(){return[!0,!0,!0,!0]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||a[2]!==f[2]||a[3]!==f[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class wr extends yn{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class Cr extends yn{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class Ln extends yn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const f=this.current;(a.func!==f.func||a.ref!==f.ref||a.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class ir extends yn{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||a[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class Qn extends yn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=a,this.dirty=!1}}class Kr extends yn{getDefault(){return[0,1]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class qt extends yn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=a,this.dirty=!1}}class Pn extends yn{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class Hn extends yn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.BLEND):f.disable(f.BLEND),this.current=a,this.dirty=!1}}class Bn extends yn{getDefault(){const a=this.gl;return[a.ONE,a.ZERO]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)}}class Rr extends yn{getDefault(){return o.Color.transparent}set(a){const f=this.current;(a.r!==f.r||a.g!==f.g||a.b!==f.b||a.a!==f.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class vr extends yn{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)}}class Tr extends yn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=a,this.dirty=!1}}class Ir extends yn{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class Pr extends yn{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}let Si,ki=class extends yn{getDefault(){return null}set(y){(y!==this.current||this.dirty)&&(this.gl.useProgram(y),this.current=y,this.dirty=!1)}};class or extends yn{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class oi extends yn{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||a[2]!==f[2]||a[3]!==f[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class Gr extends yn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class Or extends yn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class hi extends yn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class si extends yn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class lt extends yn{getDefault(){return null}set(a){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class Ee extends yn{constructor(a){super(a),this.vao=a.extVertexArrayObject}getDefault(){return null}set(a){this.vao&&(a!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(a),this.current=a,this.dirty=!1)}}class Te extends yn{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class et extends yn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class ht extends yn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class Lt extends yn{constructor(a,f){super(a),this.context=a,this.parent=f}getDefault(){return null}}class Rt extends Lt{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class Ot extends Lt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,this.attachment(),f.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class At extends Ot{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Pt{constructor(a,f,v,S){this.context=a,this.width=f,this.height=v;const T=this.framebuffer=a.gl.createFramebuffer();this.colorAttachment=new Rt(a,T),S&&(this.depthAttachment=new Ot(a,T))}destroy(){const a=this.context.gl,f=this.colorAttachment.get();if(f&&a.deleteTexture(f),this.depthAttachment){const v=this.depthAttachment.get();v&&a.deleteRenderbuffer(v)}a.deleteFramebuffer(this.framebuffer)}}class xn{constructor(a,f=!1){if(this.gl=a,this.isWebGL2=f,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),f){const v=a;this.extVertexArrayObject={createVertexArrayOES:v.createVertexArray.bind(a),deleteVertexArrayOES:v.deleteVertexArray.bind(a),bindVertexArrayOES:v.bindVertexArray.bind(a)}}this.clearColor=new Mn(this),this.clearDepth=new Gt(this),this.clearStencil=new ot(this),this.colorMask=new dr(this),this.depthMask=new wr(this),this.stencilMask=new Cr(this),this.stencilFunc=new Ln(this),this.stencilOp=new ir(this),this.stencilTest=new Qn(this),this.depthRange=new Kr(this),this.depthTest=new qt(this),this.depthFunc=new Pn(this),this.blend=new Hn(this),this.blendFunc=new Bn(this),this.blendColor=new Rr(this),this.blendEquation=new vr(this),this.cullFace=new Tr(this),this.cullFaceSide=new Ir(this),this.frontFace=new Pr(this),this.program=new ki(this),this.activeTexture=new or(this),this.viewport=new oi(this),this.bindFramebuffer=new Gr(this),this.bindRenderbuffer=new Or(this),this.bindTexture=new hi(this),this.bindVertexBuffer=new si(this),this.bindElementBuffer=new lt(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Ee(this),this.pixelStoreUnpack=new Te(this),this.pixelStoreUnpackPremultiplyAlpha=new et(this),this.pixelStoreUnpackFlipY=new ht(this),this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=a.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=a.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=a.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),f||(this.extTextureHalfFloat=a.getExtension("OES_texture_half_float")),(f||this.extTextureHalfFloat&&a.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=a.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=f||a.getExtension("OES_standard_derivatives"),this.extTimerQuery=a.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,f){return new Mt(this,a,f)}createVertexBuffer(a,f,v){return new hn(this,a,f,v)}createRenderbuffer(a,f,v){const S=this.gl,T=S.createRenderbuffer();return this.bindRenderbuffer.set(T),S.renderbufferStorage(S.RENDERBUFFER,a,f,v),this.bindRenderbuffer.set(null),T}createFramebuffer(a,f,v){return new Pt(this,a,f,v)}clear({color:a,depth:f,stencil:v}){const S=this.gl;let T=0;a&&(T|=S.COLOR_BUFFER_BIT,this.clearColor.set(a),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(T|=S.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),v!==void 0&&(T|=S.STENCIL_BUFFER_BIT,this.clearStencil.set(v),this.stencilMask.set(255)),S.clear(T)}setCullFace(a){a.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){b(a.blendFunction,o.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor)),this.colorMask.set(a.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Un extends o.Evented{constructor(a,f,v,S){if(super(),this.id=a,this.dispatcher=v,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(f,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},f),this._collectResourceTiming=f.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(S),this._tileWorkers={},this._deduped=new o.DedupedRequest}load(a){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"}));const f=Array.isArray(this.map._language)?this.map._language.join():this.map._language,v=this.map._worldview;this._tileJSONRequest=gt(this._options,this.map._requestManager,f,v,((S,T)=>{this._tileJSONRequest=null,this._loaded=!0,S?(f&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${f}`),v&&v.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${v}`),this.fire(new o.ErrorEvent(S))):T&&(o.extend(this,T),T.bounds&&(this.tileBounds=new pt(T.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(T.tiles,this.map._requestManager._customAccessToken),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),a&&a(S)}))}loaded(){return this._loaded}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest(),this.load((()=>this.map.style._clearSource(this.id)))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.extend({},this._options)}loadTile(a,f){const v=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme)),S={request:this.map._requestManager.transformRequest(v,o.ResourceType.Tile),data:void 0,uid:a.uid,tileID:a.tileID,tileZoom:a.tileZoom,zoom:a.tileID.overscaledZ,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:a.isSymbolTile};if(S.request.collectResourceTiming=this._collectResourceTiming,a.actor&&a.state!=="expired")a.state==="loading"?a.reloadCallback=f:a.request=a.actor.send("reloadTile",S,T.bind(this));else if(a.actor=this._tileWorkers[v]=this._tileWorkers[v]||this.dispatcher.getActor(),this.dispatcher.ready)a.request=a.actor.send("loadTile",S,T.bind(this),void 0,!0);else{const N=o.loadVectorTile.call({deduped:this._deduped},S,((z,G)=>{z||!G?T.call(this,z):(S.data={cacheControl:G.cacheControl,expires:G.expires,rawData:G.rawData.slice(0)},a.actor&&a.actor.send("loadTile",S,T.bind(this),void 0,!0))}),!0);a.request={cancel:N}}function T(N,z){return delete a.request,a.aborted?f(null):N&&N.status!==404?f(N):(z&&z.resourceTiming&&(a.resourceTiming=z.resourceTiming),this.map._refreshExpiredTiles&&z&&a.setExpiryData(z),a.loadVectorData(z,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),f(null),void(a.reloadCallback&&(this.loadTile(a,a.reloadCallback),a.reloadCallback=null)))}}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id})}unloadTile(a){a.unloadVectorData(),a.actor&&a.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class In extends o.Evented{constructor(a,f,v,S){super(),this.id=a,this.dispatcher=v,this.setEventedParent(S),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},f),o.extend(this,o.pick(f,["url","scheme","tileSize"]))}load(a){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=gt(this._options,this.map._requestManager,null,null,((f,v)=>{this._tileJSONRequest=null,this._loaded=!0,f?this.fire(new o.ErrorEvent(f)):v&&(o.extend(this,v),v.bounds&&(this.tileBounds=new pt(v.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(v.tiles),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),a&&a(f)}))}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest(),this.load((()=>this.map.style._clearSource(this.id)))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.extend({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a,f){const v=o.exported.devicePixelRatio>=2,S=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),v,this.tileSize);a.request=o.getImage(this.map._requestManager.transformRequest(S,o.ResourceType.Tile),((T,N,z,G)=>(delete a.request,a.aborted?(a.state="unloaded",f(null)):T?(a.state="errored",f(T)):N?(this.map._refreshExpiredTiles&&a.setExpiryData({cacheControl:z,expires:G}),a.setTexture(N,this.map.painter),a.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),void f(null)):f(null))))}static loadTileData(a,f,v){a.setTexture(f,v)}static unloadTileData(a,f){a.texture&&f.saveTileTexture(a.texture)}abortTile(a,f){a.request&&(a.request.cancel(),delete a.request),f()}unloadTile(a,f){a.texture&&this.map.painter.saveTileTexture(a.texture),f()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function kr(y,a,f,v,S,T,N,z){const G=[y,f,S,a,v,T,1,1,1],Q=[N,z,1],te=o.adjoint([],G),[ge,Ae,Le]=o.transformMat3(Q,Q,o.transpose(te,te));return o.multiply$1(G,[ge,0,0,0,Ae,0,0,0,Le],G)}class Lr extends o.Evented{constructor(a,f,v,S){super(),this.id=a,this.dispatcher=v,this.coordinates=f.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(S),this.options=f,this._dirty=!1}load(a,f){this._loaded=f||!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),((v,S)=>{if(this._imageRequest=null,this._loaded=!0,v)this.fire(new o.ErrorEvent(v));else if(S){const{HTMLImageElement:T}=o.window;this.image=S instanceof T?o.exported.getImageData(S):S,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,a&&(this.coordinates=a),this._finishLoading()}}))}loaded(){return this._loaded}updateImage(a){return this.image&&a.url?(this._imageRequest&&a.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=a.url,this.load(a.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(a){this.coordinates=a,this._boundsArray=void 0;const f=a.map(o.MercatorCoordinate.fromLngLat);return this.tileID=(function(v){let S=1/0,T=1/0,N=-1/0,z=-1/0;for(const ge of v)S=Math.min(S,ge.x),T=Math.min(T,ge.y),N=Math.max(N,ge.x),z=Math.max(z,ge.y);const G=Math.max(N-S,z-T),Q=Math.max(0,Math.floor(-Math.log(G)/Math.LN2)),te=Math.pow(2,Q);return new o.CanonicalTileID(Q,Math.floor((S+N)/2*te),Math.floor((T+z)/2*te))})(f),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(a){for(const G in this.tiles){const Q=this.tiles[G];Q.state!=="loaded"&&(Q.state="loaded",Q.texture=this.texture)}if(this._boundsArray)return;const f=o.tileTransform(this.tileID,this.map.transform.projection),[v,S,T,N]=this.coordinates.map((G=>{const Q=f.projection.project(G[0],G[1]);return o.getTilePoint(f,Q)._round()}));this.perspectiveTransform=(function(G,Q,te,ge,Ae,Le,Xe,Ue,Ze,_e){const $e=kr(0,0,G,0,0,Q,G,Q),it=kr(te,ge,Ae,Le,Xe,Ue,Ze,_e);return o.multiply$1(it,o.adjoint($e,$e),it),[it[6]/it[8]*G/o.EXTENT,it[7]/it[8]*Q/o.EXTENT]})(this.width,this.height,v.x,v.y,S.x,S.y,N.x,N.y,T.x,T.y);const z=this._boundsArray=new o.StructArrayLayout4i8;z.emplaceBack(v.x,v.y,0,0),z.emplaceBack(S.x,S.y,o.EXTENT,0),z.emplaceBack(N.x,N.y,0,o.EXTENT),z.emplaceBack(T.x,T.y,o.EXTENT,o.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=a.createVertexBuffer(z,o.boundsAttributes.members),this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const a=this.map.painter.context,f=a.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new o.Texture(a,this.image,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(a)}loadTile(a,f){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={},f(null)):(a.state="errored",f(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const jr={vector:Un,raster:In,"raster-dem":class extends In{constructor(y,a,f,v){super(y,a,f,v),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox"}loadTile(y,a){const f=this.map._requestManager.normalizeTileURL(y.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function v(S,T){S&&(y.state="errored",a(S)),T&&(y.dem=T,y.dem.onDeserialize(),y.needsHillshadePrepare=!0,y.needsDEMTextureUpload=!0,y.state="loaded",a(null))}y.request=o.getImage(this.map._requestManager.transformRequest(f,o.ResourceType.Tile),(function(S,T,N,z){if(delete y.request,y.aborted)y.state="unloaded",a(null);else if(S)y.state="errored",a(S);else if(T){this.map._refreshExpiredTiles&&y.setExpiryData({cacheControl:N,expires:z});const G=o.window.ImageBitmap&&T instanceof o.window.ImageBitmap&&(Si==null&&(Si=o.window.OffscreenCanvas&&new o.window.OffscreenCanvas(1,1).getContext("2d")&&typeof o.window.createImageBitmap=="function"),Si),Q=1-(T.width-o.prevPowerOfTwo(T.width))/2;Q<1||y.neighboringTiles||(y.neighboringTiles=this._getNeighboringTiles(y.tileID));const te=G?T:o.exported.getImageData(T,Q),ge={uid:y.uid,coord:y.tileID,source:this.id,rawImageData:te,encoding:this.encoding,padding:Q};y.actor&&y.state!=="expired"||(y.actor=this.dispatcher.getActor(),y.actor.send("loadDEMTile",ge,v.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(y){const a=y.canonical,f=Math.pow(2,a.z),v=(a.x-1+f)%f,S=a.x===0?y.wrap-1:y.wrap,T=(a.x+1+f)%f,N=a.x+1===f?y.wrap+1:y.wrap,z={};return z[new o.OverscaledTileID(y.overscaledZ,S,a.z,v,a.y).key]={backfilled:!1},z[new o.OverscaledTileID(y.overscaledZ,N,a.z,T,a.y).key]={backfilled:!1},a.y>0&&(z[new o.OverscaledTileID(y.overscaledZ,S,a.z,v,a.y-1).key]={backfilled:!1},z[new o.OverscaledTileID(y.overscaledZ,y.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},z[new o.OverscaledTileID(y.overscaledZ,N,a.z,T,a.y-1).key]={backfilled:!1}),a.y+1<f&&(z[new o.OverscaledTileID(y.overscaledZ,S,a.z,v,a.y+1).key]={backfilled:!1},z[new o.OverscaledTileID(y.overscaledZ,y.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},z[new o.OverscaledTileID(y.overscaledZ,N,a.z,T,a.y+1).key]={backfilled:!1}),z}unloadTile(y){y.demTexture&&this.map.painter.saveTileTexture(y.demTexture),y.fbo&&(y.fbo.destroy(),delete y.fbo),y.dem&&delete y.dem,delete y.neighboringTiles,y.state="unloaded"}},geojson:class extends o.Evented{constructor(y,a,f,v){super(),this.id=y,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=f.getActor(),this.setEventedParent(v),this._data=a.data,this._options=o.extend({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const S=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(a.buffer!==void 0?a.buffer:128)*S,tolerance:(a.tolerance!==void 0?a.tolerance:.375)*S,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:a.clusterMaxZoom!==void 0?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:o.EXTENT,radius:(a.clusterRadius!==void 0?a.clusterRadius:50)*S,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions)}onAdd(y){this.map=y,this.setData(this._data)}setData(y){return this._data=y,this._updateWorkerData(),this}getClusterExpansionZoom(y,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:y,source:this.id},a),this}getClusterChildren(y,a){return this.actor.send("geojson.getClusterChildren",{clusterId:y,source:this.id},a),this}getClusterLeaves(y,a,f,v){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:y,limit:a,offset:f},v),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.Event("dataloading",{dataType:"source"})),this._loaded=!1;const y=o.extend({},this.workerOptions),a=this._data;typeof a=="string"?(y.request=this.map._requestManager.transformRequest(o.exported.resolveURL(a),o.ResourceType.Source),y.request.collectResourceTiming=this._collectResourceTiming):y.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,y,((f,v)=>{if(this._loaded=!0,this._pendingLoad=null,f)this.fire(new o.ErrorEvent(f));else{const S={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(S.resourceTiming=v.resourceTiming[this.id]),this.fire(new o.Event("data",S)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)}))}loaded(){return this._loaded}loadTile(y,a){const f=y.actor?"reloadTile":"loadTile";y.actor=this.actor,y.request=this.actor.send(f,{type:this.type,uid:y.uid,tileID:y.tileID,tileZoom:y.tileZoom,zoom:y.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},((v,S)=>(delete y.request,y.unloadVectorData(),y.aborted?a(null):v?a(v):(y.loadVectorData(S,this.map.painter,f==="reloadTile"),a(null)))),void 0,f==="loadTile")}abortTile(y){y.request&&(y.request.cancel(),delete y.request),y.aborted=!0}unloadTile(y){y.unloadVectorData(),this.actor.send("removeTile",{uid:y.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Lr{constructor(y,a,f,v){super(y,a,f,v),this.roundZoom=!0,this.type="video",this.options=a}load(){this._loaded=!1;const y=this.options;this.urls=[];for(const a of y.urls)this.urls.push(this.map._requestManager.transformRequest(a,o.ResourceType.Source).url);o.getVideo(this.urls,((a,f)=>{this._loaded=!0,a?this.fire(new o.ErrorEvent(a)):f&&(this.video=f,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(y){if(this.video){const a=this.video.seekable;y<a.start(0)||y>a.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=y}}getVideo(){return this.video}onAdd(y){this.map||(this.map=y,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const y=this.map.painter.context,a=y.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(y,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(y)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Lr,canvas:class extends Lr{constructor(y,a,f,v){super(y,a,f,v),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some((S=>!Array.isArray(S)||S.length!==2||S.some((T=>typeof T!="number"))))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${y}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${y}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${y}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${y}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${y}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(y){this.map=y,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let y=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,y=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,y=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context;this.texture?(y||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(a,this.canvas,a.gl.RGBA,{premultiply:!0}),this._prepareData(a)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const y of[this.canvas.width,this.canvas.height])if(isNaN(y)||y<=0)return!0;return!1}},custom:class extends o.Evented{constructor(y,a,f,v){super(),this.id=y,this.type="custom",this._dataType="raster",this._dispatcher=f,this._implementation=a,this.setEventedParent(v),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new pt(this._implementation.bounds,this.minzoom,this.maxzoom)),a.update=this._update.bind(this),a.clearTiles=this._clearTiles.bind(this),a.coveringTiles=this._coveringTiles.bind(this),o.extend(this,o.pick(a,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(y){this._map=y,this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(y),this.load()}onRemove(y){this._implementation.onRemove&&this._implementation.onRemove(y)}hasTile(y){if(this._implementation.hasTile){const{x:a,y:f,z:v}=y.canonical;return this._implementation.hasTile({x:a,y:f,z:v})}return!this.tileBounds||this.tileBounds.contains(y.canonical)}loadTile(y,a){const{x:f,y:v,z:S}=y.tileID.canonical,T=new o.window.AbortController;y.request=Promise.resolve(this._implementation.loadTile({x:f,y:v,z:S},{signal:T.signal})).then((function(N){return delete y.request,y.aborted?(y.state="unloaded",a(null)):N===void 0?(y.state="errored",a(null)):N===null?(this.loadTileData(y,{width:this.tileSize,height:this.tileSize,data:null}),y.state="loaded",a(null)):(function(z){return z instanceof o.window.ImageData||z instanceof o.window.HTMLCanvasElement||z instanceof o.window.ImageBitmap||z instanceof o.window.HTMLImageElement})(N)?(this.loadTileData(y,N),y.state="loaded",void a(null)):(y.state="errored",a(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch((N=>{N.code!==20&&(y.state="errored",a(N))})),y.request.cancel=()=>T.abort()}loadTileData(y,a){In.loadTileData(y,a,this._map.painter)}unloadTileData(y){In.unloadTileData(y,this._map.painter)}unloadTile(y,a){if(this.unloadTileData(y),this._implementation.unloadTile){const{x:f,y:v,z:S}=y.tileID.canonical;this._implementation.unloadTile({x:f,y:v,z:S})}a()}abortTile(y,a){y.request&&y.request.cancel&&(y.request.cancel(),delete y.request),a()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((y=>({x:y.canonical.x,y:y.canonical.y,z:y.canonical.z})))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Er=function(y,a,f,v){const S=new jr[a.type](y,a,f,v);if(S.id!==y)throw new Error(`Expected Source id to be ${y} instead of ${S.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],S),S};function Ei(y,a){const f=o.identity([]);return o.scale(f,f,[.5*y.width,.5*-y.height,1]),o.translate(f,f,[1,-1,0]),o.multiply(f,f,y.calculateProjMatrix(a.toUnwrapped())),Float32Array.from(f)}function oo(y,a,f,v,S,T,N,z=!1){const G=y.tilesIn(v,N,z);G.sort(Ho);const Q=[];for(const ge of G)Q.push({wrappedTileID:ge.tile.tileID.wrapped().key,queryResults:ge.tile.queryRenderedFeatures(a,f,y._state,ge,S,T,Ei(y.transform,ge.tile.tileID),z)});const te=(function(ge){const Ae={},Le={};for(const Xe of ge){const Ue=Xe.queryResults,Ze=Xe.wrappedTileID,_e=Le[Ze]=Le[Ze]||{};for(const $e in Ue){const it=Ue[$e],st=_e[$e]=_e[$e]||{},bt=Ae[$e]=Ae[$e]||[];for(const wt of it)st[wt.featureIndex]||(st[wt.featureIndex]=!0,bt.push(wt))}}return Ae})(Q);for(const ge in te)te[ge].forEach((Ae=>{const Le=Ae.feature,Xe=Le.layer;Xe&&Xe.type!=="background"&&Xe.type!=="sky"&&(Le.source=Xe.source,Xe["source-layer"]&&(Le.sourceLayer=Xe["source-layer"]),Le.state=Le.id!==void 0?y.getFeatureState(Xe["source-layer"],Le.id):{})}));return te}function _o(y,a){const f=y.getRenderableIds().map((T=>y.getTileByID(T))),v=[],S={};for(let T=0;T<f.length;T++){const N=f[T],z=N.tileID.canonical.key;S[z]||(S[z]=!0,N.querySourceFeatures(v,a))}return v}function Ho(y,a){const f=y.tileID,v=a.tileID;return f.overscaledZ-v.overscaledZ||f.canonical.y-v.canonical.y||f.wrap-v.wrap||f.canonical.x-v.canonical.x}function so(){return En.workerClass!=null?new En.workerClass:new o.window.Worker(En.workerUrl)}const _s="mapboxgl_preloaded_worker_pool";class ao{constructor(){this.active={}}acquire(a){if(!this.workers)for(this.workers=[];this.workers.length<ao.workerCount;)this.workers.push(new so);return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],this.numActive()===0&&(this.workers.forEach((f=>{f.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[_s]}numActive(){return Object.keys(this.active).length}}let Cs;function ma(){return Cs||(Cs=new ao),Cs}function bl(y,a){const f={};for(const v in y)v!=="ref"&&(f[v]=y[v]);return o.refProperties.forEach((v=>{v in a&&(f[v]=a[v])})),f}function ll(y){y=y.slice();const a=Object.create(null);for(let f=0;f<y.length;f++)a[y[f].id]=y[f];for(let f=0;f<y.length;f++)"ref"in y[f]&&(y[f]=bl(y[f],a[y[f].ref]));return y}ao.workerCount=2;const Hi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function nc(y,a,f){f.push({command:Hi.addSource,args:[y,a[y]]})}function Lu(y,a,f){a.push({command:Hi.removeSource,args:[y]}),f[y]=!0}function To(y,a,f,v){Lu(y,f,v),nc(y,a,f)}function fu(y,a,f){let v;for(v in y[f])if(y[f].hasOwnProperty(v)&&v!=="data"&&!b(y[f][v],a[f][v]))return!1;for(v in a[f])if(a[f].hasOwnProperty(v)&&v!=="data"&&!b(y[f][v],a[f][v]))return!1;return!0}function wa(y,a,f,v,S,T){let N;for(N in a=a||{},y=y||{})y.hasOwnProperty(N)&&(b(y[N],a[N])||f.push({command:T,args:[v,N,a[N],S]}));for(N in a)a.hasOwnProperty(N)&&!y.hasOwnProperty(N)&&(b(y[N],a[N])||f.push({command:T,args:[v,N,a[N],S]}))}function Zo(y){return y.id}function Ha(y,a){return y[a.id]=a,y}class Bl{constructor(a,f){this.reset(a,f)}reset(a,f){this.points=a||[],this._distances=[0];for(let v=1;v<this.points.length;v++)this._distances[v]=this._distances[v-1]+this.points[v].dist(this.points[v-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(this.points.length===1)return this.points[0];a=o.clamp(a,0,1);let f=1,v=this._distances[f];const S=a*this.paddedLength+this.padding;for(;v<S&&f<this._distances.length;)v=this._distances[++f];const T=f-1,N=this._distances[T],z=v-N,G=z>0?(S-N)/z:0;return this.points[T].mult(1-G).add(this.points[f].mult(G))}}class rc{constructor(a,f,v){const S=this.boxCells=[],T=this.circleCells=[];this.xCellCount=Math.ceil(a/v),this.yCellCount=Math.ceil(f/v);for(let N=0;N<this.xCellCount*this.yCellCount;N++)S.push([]),T.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=f,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,f,v,S,T){this._forEachCell(f,v,S,T,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(f),this.bboxes.push(v),this.bboxes.push(S),this.bboxes.push(T)}insertCircle(a,f,v,S){this._forEachCell(f-S,v-S,f+S,v+S,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(f),this.circles.push(v),this.circles.push(S)}_insertBoxCell(a,f,v,S,T,N){this.boxCells[T].push(N)}_insertCircleCell(a,f,v,S,T,N){this.circleCells[T].push(N)}_query(a,f,v,S,T,N){if(v<0||a>this.width||S<0||f>this.height)return!T&&[];const z=[];if(a<=0&&f<=0&&this.width<=v&&this.height<=S){if(T)return!0;for(let G=0;G<this.boxKeys.length;G++)z.push({key:this.boxKeys[G],x1:this.bboxes[4*G],y1:this.bboxes[4*G+1],x2:this.bboxes[4*G+2],y2:this.bboxes[4*G+3]});for(let G=0;G<this.circleKeys.length;G++){const Q=this.circles[3*G],te=this.circles[3*G+1],ge=this.circles[3*G+2];z.push({key:this.circleKeys[G],x1:Q-ge,y1:te-ge,x2:Q+ge,y2:te+ge})}return N?z.filter(N):z}return this._forEachCell(a,f,v,S,this._queryCell,z,{hitTest:T,seenUids:{box:{},circle:{}}},N),T?z.length>0:z}_queryCircle(a,f,v,S,T){const N=a-v,z=a+v,G=f-v,Q=f+v;if(z<0||N>this.width||Q<0||G>this.height)return!S&&[];const te=[];return this._forEachCell(N,G,z,Q,this._queryCellCircle,te,{hitTest:S,circle:{x:a,y:f,radius:v},seenUids:{box:{},circle:{}}},T),S?te.length>0:te}query(a,f,v,S,T){return this._query(a,f,v,S,!1,T)}hitTest(a,f,v,S,T){return this._query(a,f,v,S,!0,T)}hitTestCircle(a,f,v,S){return this._queryCircle(a,f,v,!0,S)}_queryCell(a,f,v,S,T,N,z,G){const Q=z.seenUids,te=this.boxCells[T];if(te!==null){const Ae=this.bboxes;for(const Le of te)if(!Q.box[Le]){Q.box[Le]=!0;const Xe=4*Le;if(a<=Ae[Xe+2]&&f<=Ae[Xe+3]&&v>=Ae[Xe+0]&&S>=Ae[Xe+1]&&(!G||G(this.boxKeys[Le]))){if(z.hitTest)return N.push(!0),!0;N.push({key:this.boxKeys[Le],x1:Ae[Xe],y1:Ae[Xe+1],x2:Ae[Xe+2],y2:Ae[Xe+3]})}}}const ge=this.circleCells[T];if(ge!==null){const Ae=this.circles;for(const Le of ge)if(!Q.circle[Le]){Q.circle[Le]=!0;const Xe=3*Le;if(this._circleAndRectCollide(Ae[Xe],Ae[Xe+1],Ae[Xe+2],a,f,v,S)&&(!G||G(this.circleKeys[Le]))){if(z.hitTest)return N.push(!0),!0;{const Ue=Ae[Xe],Ze=Ae[Xe+1],_e=Ae[Xe+2];N.push({key:this.circleKeys[Le],x1:Ue-_e,y1:Ze-_e,x2:Ue+_e,y2:Ze+_e})}}}}}_queryCellCircle(a,f,v,S,T,N,z,G){const Q=z.circle,te=z.seenUids,ge=this.boxCells[T];if(ge!==null){const Le=this.bboxes;for(const Xe of ge)if(!te.box[Xe]){te.box[Xe]=!0;const Ue=4*Xe;if(this._circleAndRectCollide(Q.x,Q.y,Q.radius,Le[Ue+0],Le[Ue+1],Le[Ue+2],Le[Ue+3])&&(!G||G(this.boxKeys[Xe])))return N.push(!0),!0}}const Ae=this.circleCells[T];if(Ae!==null){const Le=this.circles;for(const Xe of Ae)if(!te.circle[Xe]){te.circle[Xe]=!0;const Ue=3*Xe;if(this._circlesCollide(Le[Ue],Le[Ue+1],Le[Ue+2],Q.x,Q.y,Q.radius)&&(!G||G(this.circleKeys[Xe])))return N.push(!0),!0}}}_forEachCell(a,f,v,S,T,N,z,G){const Q=this._convertToXCellCoord(a),te=this._convertToYCellCoord(f),ge=this._convertToXCellCoord(v),Ae=this._convertToYCellCoord(S);for(let Le=Q;Le<=ge;Le++)for(let Xe=te;Xe<=Ae;Xe++)if(T.call(this,a,f,v,S,this.xCellCount*Xe+Le,N,z,G))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,f,v,S,T,N){const z=S-a,G=T-f,Q=v+N;return Q*Q>z*z+G*G}_circleAndRectCollide(a,f,v,S,T,N,z){const G=(N-S)/2,Q=Math.abs(a-(S+G));if(Q>G+v)return!1;const te=(z-T)/2,ge=Math.abs(f-(T+te));if(ge>te+v)return!1;if(Q<=G||ge<=te)return!0;const Ae=Q-G,Le=ge-te;return Ae*Ae+Le*Le<=v*v}}const Sa={unknown:0,flipRequired:1,flipNotRequired:2},ra=Math.tan(85*Math.PI/180);function mn(y,a,f,v,S,T,N){const z=o.create();if(f)if(T.name==="globe"){const G=o.calculateGlobeLabelMatrix(S,a);o.multiply(z,z,G)}else{const G=q([],N);z[0]=G[0],z[1]=G[1],z[4]=G[2],z[5]=G[3],v||o.rotateZ(z,z,S.angle)}else o.multiply(z,S.labelPlaneMatrix,y);return z}function Yo(y,a,f,v,S,T,N){const z=mn(y,a,f,v,S,T,N);return T.name==="globe"&&f||(z[2]=z[6]=z[10]=z[14]=0),z}function ss(y,a,f,v,S,T,N){if(f){if(T.name==="globe"){const z=mn(y,a,f,v,S,T,N);return o.invert(z,z),o.multiply(z,y,z),z}{const z=o.clone(y),G=o.identity([]);return G[0]=N[0],G[1]=N[1],G[4]=N[2],G[5]=N[3],o.multiply(z,z,G),v||o.rotateZ(z,z,-S.angle),z}}return S.glCoordMatrix}function _i(y,a,f,v){const S=[y,a,f,1];f?o.transformMat4$1(S,S,v):vi(S,S,v);const T=S[3];return S[0]/=T,S[1]/=T,S[2]/=T,S}function pu(y,a){return Math.min(.5+y/a*.5,1.5)}function Wa(y,a){const f=y[0]/y[3],v=y[1]/y[3];return f>=-a[0]&&f<=a[0]&&v>=-a[1]&&v<=a[1]}function Ka(y,a,f,v,S,T,N,z,G,Q){const te=f.transform,ge=v?y.textSizeData:y.iconSizeData,Ae=o.evaluateSizeForZoom(ge,f.transform.zoom),Le=te.projection.name==="globe",Xe=[256/f.width*2+1,256/f.height*2+1],Ue=v?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;Ue.clear();let Ze=null;Le&&(Ze=v?y.text.globeExtVertexArray:y.icon.globeExtVertexArray);const _e=y.lineVertexArray,$e=v?y.text.placedSymbolArray:y.icon.placedSymbolArray,it=f.transform.width/f.transform.height;let st,bt=!1;for(let wt=0;wt<$e.length;wt++){const vt=$e.get(wt),{numGlyphs:kt,writingMode:Tt}=vt;if(Tt!==o.WritingMode.vertical||bt||st===o.WritingMode.horizontal||(bt=!0),st=Tt,(vt.hidden||Tt===o.WritingMode.vertical)&&!bt){Ea(kt,Ue);continue}bt=!1;const Vt=new o.Point(vt.tileAnchorX,vt.tileAnchorY);let{x:vn,y:Bt,z:ln}=te.projection.projectTilePoint(Vt.x,Vt.y,Q.canonical);if(G){const[Dr,rr,Jn]=G(Vt);vn+=Dr,Bt+=rr,ln+=Jn}const Wt=[vn,Bt,ln,1];if(o.transformMat4$1(Wt,Wt,a),!Wa(Wt,Xe)){Ea(kt,Ue);continue}const Cn=pu(f.transform.cameraToCenterDistance,Wt[3]),Ut=o.evaluateSizeForFeature(ge,Ae,vt),rn=N?Ut/Cn:Ut*Cn,Tn=_i(vn,Bt,ln,S);if(Tn[3]<=0){Ea(kt,Ue);continue}let cn={};const Nn=N?null:G,hr=er(vt,rn,!1,z,a,S,T,y.glyphOffsetArray,_e,Ue,Ze,Tn,Vt,cn,it,Nn,te.projection,Q,N);bt=hr.useVertical,Nn&&hr.needsFlipping&&(cn={}),(hr.notEnoughRoom||bt||hr.needsFlipping&&er(vt,rn,!0,z,a,S,T,y.glyphOffsetArray,_e,Ue,Ze,Tn,Vt,cn,it,Nn,te.projection,Q,N).notEnoughRoom)&&Ea(kt,Ue)}v?(y.text.dynamicLayoutVertexBuffer.updateData(Ue),Ze&&y.text.globeExtVertexBuffer.updateData(Ze)):(y.icon.dynamicLayoutVertexBuffer.updateData(Ue),Ze&&y.icon.globeExtVertexBuffer.updateData(Ze))}function cl(y,a,f,v,S,T,N,z,G,Q,te,ge,Ae,Le,Xe,Ue){const{lineStartIndex:Ze,glyphStartIndex:_e,segment:$e}=z,it=_e+z.numGlyphs,st=Ze+z.lineLength,bt=a.getoffsetX(_e),wt=a.getoffsetX(it-1),vt=js(y*bt,f,v,S,T,N,$e,Ze,st,G,Q,te,ge,Ae,!0,Le,Xe,Ue);if(!vt)return null;const kt=js(y*wt,f,v,S,T,N,$e,Ze,st,G,Q,te,ge,Ae,!0,Le,Xe,Ue);return kt?{first:vt,last:kt}:null}function Ls(y,a,f,v){return y===o.WritingMode.horizontal&&Math.abs(v)>Math.abs(f)?{useVertical:!0}:y===o.WritingMode.vertical?v>0?{needsFlipping:!0}:null:a!==Sa.unknown&&(function(S,T){return S===0||Math.abs(T/S)>ra})(f,v)?a===Sa.flipRequired?{needsFlipping:!0}:null:f<0?{needsFlipping:!0}:null}function er(y,a,f,v,S,T,N,z,G,Q,te,ge,Ae,Le,Xe,Ue,Ze,_e,$e){const it=a/24,st=y.lineOffsetX*it,bt=y.lineOffsetY*it,{lineStartIndex:wt,glyphStartIndex:vt,numGlyphs:kt,segment:Tt,writingMode:Vt,flipState:vn}=y,Bt=wt+y.lineLength,ln=Wt=>{if(te){const[Tn,cn,Nn]=Wt.up,hr=Q.length;o.updateGlobeVertexNormal(te,hr+0,Tn,cn,Nn),o.updateGlobeVertexNormal(te,hr+1,Tn,cn,Nn),o.updateGlobeVertexNormal(te,hr+2,Tn,cn,Nn),o.updateGlobeVertexNormal(te,hr+3,Tn,cn,Nn)}const[Cn,Ut,rn]=Wt.point;o.addDynamicAttributes(Q,Cn,Ut,rn,Wt.angle)};if(kt>1){const Wt=cl(it,z,st,bt,f,ge,Ae,y,G,T,Le,Ue,!1,Ze,_e,$e);if(!Wt)return{notEnoughRoom:!0};if(v&&!f){let[Cn,Ut,rn]=Wt.first.point,[Tn,cn,Nn]=Wt.last.point;[Cn,Ut]=_i(Cn,Ut,rn,N),[Tn,cn]=_i(Tn,cn,Nn,N);const hr=Ls(Vt,vn,(Tn-Cn)*Xe,cn-Ut);if(y.flipState=hr&&hr.needsFlipping?Sa.flipRequired:Sa.flipNotRequired,hr)return hr}ln(Wt.first);for(let Cn=vt+1;Cn<vt+kt-1;Cn++){const Ut=js(it*z.getoffsetX(Cn),st,bt,f,ge,Ae,Tt,wt,Bt,G,T,Le,Ue,!1,!1,Ze,_e,$e);if(!Ut)return Q.length-=4*(Cn-vt),{notEnoughRoom:!0};ln(Ut)}ln(Wt.last)}else{if(v&&!f){const Cn=_i(Ae.x,Ae.y,0,S),Ut=wt+Tt+1,rn=new o.Point(G.getx(Ut),G.gety(Ut)),Tn=_i(rn.x,rn.y,0,S),cn=Tn[3]>0?Tn:Mr(Ae,rn,Cn,1,S,void 0,Ze,_e.canonical),Nn=Ls(Vt,vn,(cn[0]-Cn[0])*Xe,cn[1]-Cn[1]);if(y.flipState=Nn&&Nn.needsFlipping?Sa.flipRequired:Sa.flipNotRequired,Nn)return Nn}const Wt=js(it*z.getoffsetX(vt),st,bt,f,ge,Ae,Tt,wt,Bt,G,T,Le,Ue,!1,!1,Ze,_e,$e);if(!Wt)return{notEnoughRoom:!0};ln(Wt)}return{}}function Br(y,a,f,v,S){const{x:T,y:N,z}=v.projectTilePoint(y.x,y.y,a);if(!S)return _i(T,N,z,f);const[G,Q,te]=S(y);return _i(T+G,N+Q,z+te,f)}function Mr(y,a,f,v,S,T,N,z){const G=Br(y.sub(a)._unit()._add(y),z,S,N,T);return o.sub(G,f,G),o.normalize(G,G),o.scaleAndAdd(G,f,G,v)}function js(y,a,f,v,S,T,N,z,G,Q,te,ge,Ae,Le,Xe,Ue,Ze,_e){const $e=v?y-a:y+a;let it=$e>0?1:-1,st=0;v&&(it*=-1,st=Math.PI),it<0&&(st+=Math.PI);let bt=z+N+(it>0?0:1)|0,wt=S,vt=S,kt=0,Tt=0;const Vt=Math.abs($e),vn=[],Bt=[];let ln=T,Wt=ln;const Cn=()=>Mr(Wt,ln,vt,Vt-kt+1,te,Ae,Ue,Ze.canonical);for(;kt+Tt<=Vt;){if(bt+=it,bt<z||bt>=G)return null;if(vt=wt,Wt=ln,vn.push(vt),Le&&Bt.push(Wt),ln=new o.Point(Q.getx(bt),Q.gety(bt)),wt=ge[bt],!wt){const Jn=Br(ln,Ze.canonical,te,Ue,Ae);wt=Jn[3]>0?ge[bt]=Jn:Cn()}kt+=Tt,Tt=o.distance(vt,wt)}Xe&&Ae&&(ge[bt]&&(wt=Cn(),Tt=o.distance(vt,wt)),ge[bt]=wt);const Ut=(Vt-kt)/Tt,rn=ln.sub(Wt)._mult(Ut)._add(Wt),Tn=o.sub([],wt,vt),cn=o.scaleAndAdd([],vt,Tn,Ut);let Nn=[0,0,1],hr=Tn[0],Dr=Tn[1];if(_e&&(Nn=Ue.upVector(Ze.canonical,rn.x,rn.y),Nn[0]!==0||Nn[1]!==0||Nn[2]!==1)){const Jn=[Nn[2],0,-Nn[0]],ni=o.cross([],Nn,Jn);o.normalize(Jn,Jn),o.normalize(ni,ni),hr=o.dot(Tn,Jn),Dr=o.dot(Tn,ni)}if(f){const Jn=o.cross([],Nn,Tn);o.normalize(Jn,Jn),o.scaleAndAdd(cn,cn,Jn,f*it)}const rr=st+Math.atan2(Dr,hr);return vn.push(cn),Le&&Bt.push(rn),{point:cn,angle:rr,path:vn,tilePath:Bt,up:Nn}}function Ea(y,a){const f=a.length,v=f+4*y;a.resize(v),a.float32.fill(-1/0,4*f,4*v)}function vi(y,a,f){const v=a[0],S=a[1];return y[0]=f[0]*v+f[4]*S+f[12],y[1]=f[1]*v+f[5]*S+f[13],y[3]=f[3]*v+f[7]*S+f[15],y}const Mi=100;class wl{constructor(a,f,v=new rc(a.width+200,a.height+200,25),S=new rc(a.width+200,a.height+200,25)){this.transform=a,this.grid=v,this.ignoredGrid=S,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+Mi,this.screenBottomBoundary=a.height+Mi,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.fogState=f}placeCollisionBox(a,f,v,S,T,N,z,G){let Q=v.projectedAnchorX,te=v.projectedAnchorY,ge=v.projectedAnchorZ;const Ae=v.elevation,Le=v.tileID,Xe=a.getProjection();if(Ae&&Le){const[wt,vt,kt]=Xe.upVector(Le.canonical,v.tileAnchorX,v.tileAnchorY),Tt=Xe.upVectorScale(Le.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;Q+=wt*Ae*Tt,te+=vt*Ae*Tt,ge+=kt*Ae*Tt}const Ue=this.projectAndGetPerspectiveRatio(z,Q,te,ge,v.tileID,Xe.name==="globe"||!!Ae||this.transform.pitch>0,Xe),Ze=N*Ue.perspectiveRatio,_e=(v.x1*f+S.x-v.padding)*Ze+Ue.point.x,$e=(v.y1*f+S.y-v.padding)*Ze+Ue.point.y,it=(v.x2*f+S.x+v.padding)*Ze+Ue.point.x,st=(v.y2*f+S.y+v.padding)*Ze+Ue.point.y,bt=Ue.perspectiveRatio<=.55||Ue.occluded;return!this.isInsideGrid(_e,$e,it,st)||!T&&this.grid.hitTest(_e,$e,it,st,G)||bt?{box:[],offscreen:!1,occluded:Ue.occluded}:{box:[_e,$e,it,st],offscreen:this.isOffscreen(_e,$e,it,st),occluded:!1}}placeCollisionCircles(a,f,v,S,T,N,z,G,Q,te,ge,Ae,Le,Xe,Ue){const Ze=[],_e=this.transform.elevation,$e=a.getProjection(),it=_e?_e.getAtTileOffsetFunc(Ue,this.transform.center.lat,this.transform.worldSize,$e):null,st=new o.Point(v.tileAnchorX,v.tileAnchorY);let{x:bt,y:wt,z:vt}=$e.projectTilePoint(st.x,st.y,Ue.canonical);if(it){const[rn,Tn,cn]=it(st);bt+=rn,wt+=Tn,vt+=cn}const kt=$e.name==="globe",Tt=this.projectAndGetPerspectiveRatio(z,bt,wt,vt,Ue,kt||!!_e||this.transform.pitch>0,$e),{perspectiveRatio:Vt}=Tt,vn=(ge?N/Vt:N*Vt)/o.ONE_EM,Bt=_i(bt,wt,vt,G),ln=Tt.signedDistanceFromCamera>0?cl(vn,T,v.lineOffsetX*vn,v.lineOffsetY*vn,!1,Bt,st,v,S,G,{},_e&&!ge?it:null,ge&&!!_e,$e,Ue,ge):null;let Wt=!1,Cn=!1,Ut=!0;if(ln&&!Tt.occluded){const rn=.5*Le*Vt+Xe,Tn=new o.Point(-100,-100),cn=new o.Point(this.screenRightBoundary,this.screenBottomBoundary),Nn=new Bl,{first:hr,last:Dr}=ln,rr=hr.path.length;let Jn=[];for(let xr=rr-1;xr>=1;xr--)Jn.push(hr.path[xr]);for(let xr=1;xr<Dr.path.length;xr++)Jn.push(Dr.path[xr]);const ni=2.5*rn;Q&&(Jn=Jn.map((([xr,Ii,Ci],Ni)=>(it&&!kt&&(Ci=it(Ni<rr-1?hr.tilePath[rr-1-Ni]:Dr.tilePath[Ni-rr+2])[2]),_i(xr,Ii,Ci,Q)))),Jn.some((xr=>xr[3]<=0))&&(Jn=[]));let mi=[];if(Jn.length>0){let xr=1/0,Ii=-1/0,Ci=1/0,Ni=-1/0;for(const fo of Jn)xr=Math.min(xr,fo[0]),Ci=Math.min(Ci,fo[1]),Ii=Math.max(Ii,fo[0]),Ni=Math.max(Ni,fo[1]);Ii>=Tn.x&&xr<=cn.x&&Ni>=Tn.y&&Ci<=cn.y&&(mi=[Jn.map((fo=>new o.Point(fo[0],fo[1])))],(xr<Tn.x||Ii>cn.x||Ci<Tn.y||Ni>cn.y)&&(mi=o.clipLine(mi,Tn.x,Tn.y,cn.x,cn.y)))}for(const xr of mi){Nn.reset(xr,.25*rn);let Ii=0;Ii=Nn.length<=.5*rn?1:Math.ceil(Nn.paddedLength/ni)+1;for(let Ci=0;Ci<Ii;Ci++){const Ni=Ci/Math.max(Ii-1,1),fo=Nn.lerp(Ni),Rs=fo.x+Mi,hs=fo.y+Mi;Ze.push(Rs,hs,rn,0);const hc=Rs-rn,Tc=hs-rn,Li=Rs+rn,no=hs+rn;if(Ut=Ut&&this.isOffscreen(hc,Tc,Li,no),Cn=Cn||this.isInsideGrid(hc,Tc,Li,no),!f&&this.grid.hitTestCircle(Rs,hs,rn,Ae)&&(Wt=!0,!te))return{circles:[],offscreen:!1,collisionDetected:Wt,occluded:!1}}}}return{circles:!te&&Wt||!Cn?[]:Ze,offscreen:Ut,collisionDetected:Wt,occluded:Tt.occluded}}queryRenderedSymbols(a){if(a.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const f=[];let v=1/0,S=1/0,T=-1/0,N=-1/0;for(const te of a){const ge=new o.Point(te.x+Mi,te.y+Mi);v=Math.min(v,ge.x),S=Math.min(S,ge.y),T=Math.max(T,ge.x),N=Math.max(N,ge.y),f.push(ge)}const z=this.grid.query(v,S,T,N).concat(this.ignoredGrid.query(v,S,T,N)),G={},Q={};for(const te of z){const ge=te.key;if(G[ge.bucketInstanceId]===void 0&&(G[ge.bucketInstanceId]={}),G[ge.bucketInstanceId][ge.featureIndex])continue;const Ae=[new o.Point(te.x1,te.y1),new o.Point(te.x2,te.y1),new o.Point(te.x2,te.y2),new o.Point(te.x1,te.y2)];o.polygonIntersectsPolygon(f,Ae)&&(G[ge.bucketInstanceId][ge.featureIndex]=!0,Q[ge.bucketInstanceId]===void 0&&(Q[ge.bucketInstanceId]=[]),Q[ge.bucketInstanceId].push(ge.featureIndex))}return Q}insertCollisionBox(a,f,v,S,T){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:S,collisionGroupID:T},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,f,v,S,T){const N=f?this.ignoredGrid:this.grid,z={bucketInstanceId:v,featureIndex:S,collisionGroupID:T};for(let G=0;G<a.length;G+=4)N.insertCircle(z,a[G],a[G+1],a[G+2])}projectAndGetPerspectiveRatio(a,f,v,S,T,N,z){const G=[f,v,S,1];let Q=!1;S||this.transform.pitch>0?(o.transformMat4$1(G,G,a),this.fogState&&T&&z.name!=="globe"&&(Q=(function(Ae,Le,Xe,Ue,Ze,_e){const $e=_e.calculateFogTileMatrix(Ze),it=[Le,Xe,Ue];return o.transformMat4(it,it,$e),Me(Ae,it,_e.pitch,_e._fov)})(this.fogState,f,v,S,T.toUnwrapped(),this.transform)>.9)):vi(G,G,a);const te=G[3];return{point:new o.Point((G[0]/te+1)/2*this.transform.width+Mi,(-G[1]/te+1)/2*this.transform.height+Mi),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(z)/te*.5,1.5),signedDistanceFromCamera:te,occluded:N&&G[2]>te||Q}}isOffscreen(a,f,v,S){return v<Mi||a>=this.screenRightBoundary||S<Mi||f>this.screenBottomBoundary}isInsideGrid(a,f,v,S){return v>=0&&a<this.gridRightBoundary&&S>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const a=o.identity([]);return o.translate(a,a,[-100,-100,0]),a}}function qi(y,a,f){const v=a.createTileMatrix(y,y.worldSize,f.toUnwrapped());return o.multiply(new Float32Array(16),y.projMatrix,v)}function fs(y,a,f){if(a.projection.name===f.projection.name)return y.projMatrix;const v=f.clone();return v.setProjection(a.projection),qi(v,a.getProjection(),y)}function zi(y,a,f){return a.name===f.projection.name?y.projMatrix:qi(f,a,y)}class mu{constructor(a,f,v,S){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?f:-f))):S&&v?1:0,this.placed=v}isHidden(){return this.opacity===0&&!this.placed}}class ic{constructor(a,f,v,S,T,N=!1){this.text=new mu(a?a.text:null,f,v,T),this.icon=new mu(a?a.icon:null,f,S,T),this.clipped=N}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Jc{constructor(a,f,v,S=!1){this.text=a,this.icon=f,this.skipFade=v,this.clipped=S}}class yc{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class oc{constructor(a,f,v,S,T){this.bucketInstanceId=a,this.featureIndex=f,this.sourceLayerIndex=v,this.bucketIndex=S,this.tileID=T}}class Ma{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const f=++this.maxGroupID;this.collisionGroups[a]={ID:f,predicate:v=>v.collisionGroupID===f}}return this.collisionGroups[a]}}function Ps(y,a,f,v,S){const{horizontalAlign:T,verticalAlign:N}=o.getAnchorAlignment(y),z=-(T-.5)*a,G=-(N-.5)*f,Q=o.evaluateVariableOffset(y,v);return new o.Point(z+Q[0]*S,G+Q[1]*S)}function ji(y,a,f,v,S){const T=new o.Point(y,a);return f&&T._rotate(v?S:-S),T}class Na{constructor(a,f,v,S,T){this.transform=a.clone(),this.projection=a.projection.name,this.collisionIndex=new wl(this.transform,T),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new Ma(v),this.collisionCircleArrays={},this.prevPlacement=S,S&&(S.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,f,v,S){const T=v.getBucket(f),N=v.latestFeatureIndex;if(!T||!N||f.id!==T.layerIds[0])return;const z=T.layers[0].layout,G=v.collisionBoxArray,Q=Math.pow(2,this.transform.zoom-v.tileID.overscaledZ),te=v.tileSize/o.EXTENT,ge=v.tileID.toUnwrapped();this.transform.setProjection(T.projection);const Ae=(Le=v.tileID,Xe=T.getProjection(),Ue=this.transform,Xe.name===this.projection?Ue.calculateProjMatrix(Le.toUnwrapped()):qi(Ue,Xe,Le));var Le,Xe,Ue;const Ze=z.get("text-pitch-alignment")==="map",_e=z.get("text-rotation-alignment")==="map";f.compileFilter();const $e=f.dynamicFilter(),it=f.dynamicFilterNeedsFeature(),st=this.transform.calculatePixelsToTileUnitsMatrix(v),bt=Yo(Ae,v.tileID.canonical,Ze,_e,this.transform,T.getProjection(),st);let wt=null;if(Ze){const Tt=ss(Ae,v.tileID.canonical,Ze,_e,this.transform,T.getProjection(),st);wt=o.multiply([],this.transform.labelPlaneMatrix,Tt)}let vt=null;$e&&v.latestFeatureIndex&&(vt={unwrappedTileID:ge,dynamicFilter:$e,dynamicFilterNeedsFeature:it,featureIndex:v.latestFeatureIndex}),this.retainedQueryData[T.bucketInstanceId]=new oc(T.bucketInstanceId,N,T.sourceLayerIndex,T.index,v.tileID);const kt={bucket:T,layout:z,posMatrix:Ae,textLabelPlaneMatrix:bt,labelToScreenMatrix:wt,clippingData:vt,scale:Q,textPixelRatio:te,holdingForFade:v.holdingForFade(),collisionBoxArray:G,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(T.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.evaluateSizeForZoom(T.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(T.sourceID)};if(S)for(const Tt of T.sortKeyRanges){const{sortKey:Vt,symbolInstanceStart:vn,symbolInstanceEnd:Bt}=Tt;a.push({sortKey:Vt,symbolInstanceStart:vn,symbolInstanceEnd:Bt,parameters:kt})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:kt})}attemptAnchorPlacement(a,f,v,S,T,N,z,G,Q,te,ge,Ae,Le,Xe,Ue,Ze,_e,$e){const{textOffset0:it,textOffset1:st,crossTileID:bt}=Ae,wt=[it,st],vt=Ps(a,v,S,wt,T),kt=this.collisionIndex.placeCollisionBox(Xe,T,f,ji(vt.x,vt.y,N,z,this.transform.angle),ge,G,Q,te.predicate);if(Ze){const Tt=Xe.getSymbolInstanceIconSize($e,this.transform.zoom,Ae.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Xe,Tt,Ze,ji(vt.x,vt.y,N,z,this.transform.angle),ge,G,Q,te.predicate).box.length===0)return}if(kt.box.length>0){let Tt;return this.prevPlacement&&this.prevPlacement.variableOffsets[bt]&&this.prevPlacement.placements[bt]&&this.prevPlacement.placements[bt].text&&(Tt=this.prevPlacement.variableOffsets[bt].anchor),this.variableOffsets[bt]={textOffset:wt,width:v,height:S,anchor:a,textScale:T,prevAnchor:Tt},this.markUsedJustification(Xe,a,Ae,Ue),Xe.allowVerticalPlacement&&(this.markUsedOrientation(Xe,Ue,Ae),this.placedOrientations[bt]=Ue),{shift:vt,placedGlyphBoxes:kt}}}placeLayerBucketPart(a,f,v,S){const{bucket:T,layout:N,posMatrix:z,textLabelPlaneMatrix:G,labelToScreenMatrix:Q,clippingData:te,textPixelRatio:ge,holdingForFade:Ae,collisionBoxArray:Le,partiallyEvaluatedTextSize:Xe,partiallyEvaluatedIconSize:Ue,collisionGroup:Ze}=a.parameters,_e=N.get("text-optional"),$e=N.get("icon-optional"),it=N.get("text-allow-overlap"),st=N.get("icon-allow-overlap"),bt=N.get("text-rotation-alignment")==="map",wt=N.get("text-pitch-alignment")==="map",vt=N.get("icon-text-fit")!=="none",kt=N.get("symbol-z-order")==="viewport-y";this.transform.setProjection(T.projection);let Tt=it&&(st||!T.hasIconData()||$e),Vt=st&&(it||!T.hasTextData()||_e);!T.collisionArrays&&Le&&T.deserializeCollisionBoxes(Le),v&&S&&T.updateCollisionDebugBuffers(this.transform.zoom,Le);const vn=(Bt,ln,Wt)=>{const{crossTileID:Cn,numVerticalGlyphVertices:Ut}=Bt;if(te){const Li={zoom:this.transform.zoom,pitch:this.transform.pitch};let no=null;if(te.dynamicFilterNeedsFeature){const po=this.retainedQueryData[T.bucketInstanceId];no=te.featureIndex.loadFeature({featureIndex:Bt.featureIndex,bucketIndex:po.bucketIndex,sourceLayerIndex:po.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,te.dynamicFilter)(Li,no,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new o.Point(Bt.tileAnchorX,Bt.tileAnchorY),this.transform.calculateDistanceTileData(te.unwrappedTileID)))return this.placements[Cn]=new Jc(!1,!1,!1,!0),void f.add(Cn)}if(f.has(Cn))return;if(Ae)return void(this.placements[Cn]=new Jc(!1,!1,!1));let rn=!1,Tn=!1,cn=!0,Nn=!1,hr=!1,Dr=null,rr={box:null,offscreen:null,occluded:null},Jn={box:null},ni=null,mi=null,xr=null,Ii=0,Ci=0,Ni=0;Wt.textFeatureIndex?Ii=Wt.textFeatureIndex:Bt.useRuntimeCollisionCircles&&(Ii=Bt.featureIndex),Wt.verticalTextFeatureIndex&&(Ci=Wt.verticalTextFeatureIndex);const fo=Li=>{Li.tileID=this.retainedQueryData[T.bucketInstanceId].tileID;const no=this.transform.elevation;(no||Li.elevation)&&(Li.elevation=no?no.getAtTileOffset(Li.tileID,Li.tileAnchorX,Li.tileAnchorY):0)},Rs=Wt.textBox;if(Rs){fo(Rs);const Li=po=>{let Ms=o.WritingMode.horizontal;if(T.allowVerticalPlacement&&!po&&this.prevPlacement){const nl=this.prevPlacement.placedOrientations[Cn];nl&&(this.placedOrientations[Cn]=nl,Ms=nl,this.markUsedOrientation(T,Ms,Bt))}return Ms},no=(po,Ms)=>{if(T.allowVerticalPlacement&&Ut>0&&Wt.verticalTextBox){for(const nl of T.writingModes)if(nl===o.WritingMode.vertical?(rr=Ms(),Jn=rr):rr=po(),rr&&rr.box&&rr.box.length)break}else rr=po()};if(N.get("text-variable-anchor")){let po=N.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Cn]){const $o=this.prevPlacement.variableOffsets[Cn];po.indexOf($o.anchor)>0&&(po=po.filter((Ns=>Ns!==$o.anchor)),po.unshift($o.anchor))}const Ms=($o,Ns,ps)=>{const ns=T.getSymbolInstanceTextSize(Xe,Bt,this.transform.zoom,ln),xs=($o.x2-$o.x1)*ns+2*$o.padding,dc=($o.y2-$o.y1)*ns+2*$o.padding,Ds=vt&&!st?Ns:null;Ds&&fo(Ds);let Ic={box:[],offscreen:!1,occluded:!1};const yd=it?2*po.length:po.length;for(let Ys=0;Ys<yd;++Ys){const Fh=this.attemptAnchorPlacement(po[Ys%po.length],$o,xs,dc,ns,bt,wt,ge,z,Ze,Ys>=po.length,Bt,ln,T,ps,Ds,Xe,Ue);if(Fh&&(Ic=Fh.placedGlyphBoxes,Ic&&Ic.box&&Ic.box.length)){rn=!0,Dr=Fh.shift;break}}return Ic};no((()=>Ms(Rs,Wt.iconBox,o.WritingMode.horizontal)),(()=>{const $o=Wt.verticalTextBox;return $o&&fo($o),T.allowVerticalPlacement&&!(rr&&rr.box&&rr.box.length)&&Ut>0&&$o?Ms($o,Wt.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null,occluded:null}})),rr&&(rn=rr.box,cn=rr.offscreen,Nn=rr.occluded);const nl=Li(!(!rr||!rr.box));if(!rn&&this.prevPlacement){const $o=this.prevPlacement.variableOffsets[Cn];$o&&(this.variableOffsets[Cn]=$o,this.markUsedJustification(T,$o.anchor,Bt,nl))}}else{const po=(Ms,nl)=>{const $o=T.getSymbolInstanceTextSize(Xe,Bt,this.transform.zoom,ln),Ns=this.collisionIndex.placeCollisionBox(T,$o,Ms,new o.Point(0,0),it,ge,z,Ze.predicate);return Ns&&Ns.box&&Ns.box.length&&(this.markUsedOrientation(T,nl,Bt),this.placedOrientations[Cn]=nl),Ns};no((()=>po(Rs,o.WritingMode.horizontal)),(()=>{const Ms=Wt.verticalTextBox;return T.allowVerticalPlacement&&Ut>0&&Ms?(fo(Ms),po(Ms,o.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}})),Li(!!(rr&&rr.box&&rr.box.length))}}if(ni=rr,rn=ni&&ni.box&&ni.box.length>0,cn=ni&&ni.offscreen,Nn=ni&&ni.occluded,Bt.useRuntimeCollisionCircles){const Li=T.text.placedSymbolArray.get(Bt.centerJustifiedTextSymbolIndex>=0?Bt.centerJustifiedTextSymbolIndex:Bt.verticalPlacedTextSymbolIndex),no=o.evaluateSizeForFeature(T.textSizeData,Xe,Li),po=N.get("text-padding");mi=this.collisionIndex.placeCollisionCircles(T,it,Li,T.lineVertexArray,T.glyphOffsetArray,no,z,G,Q,v,wt,Ze.predicate,Bt.collisionCircleDiameter*no/o.ONE_EM,po,this.retainedQueryData[T.bucketInstanceId].tileID),rn=it||mi.circles.length>0&&!mi.collisionDetected,cn=cn&&mi.offscreen,Nn=mi.occluded}if(Wt.iconFeatureIndex&&(Ni=Wt.iconFeatureIndex),Wt.iconBox){const Li=no=>{fo(no);const po=vt&&Dr?ji(Dr.x,Dr.y,bt,wt,this.transform.angle):new o.Point(0,0),Ms=T.getSymbolInstanceIconSize(Ue,this.transform.zoom,Bt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(T,Ms,no,po,st,ge,z,Ze.predicate)};Jn&&Jn.box&&Jn.box.length&&Wt.verticalIconBox?(xr=Li(Wt.verticalIconBox),Tn=xr.box.length>0):(xr=Li(Wt.iconBox),Tn=xr.box.length>0),cn=cn&&xr.offscreen,hr=xr.occluded}const hs=_e||Bt.numHorizontalGlyphVertices===0&&Ut===0,hc=$e||Bt.numIconVertices===0;if(hs||hc?hc?hs||(Tn=Tn&&rn):rn=Tn&&rn:Tn=rn=Tn&&rn,rn&&ni&&ni.box&&this.collisionIndex.insertCollisionBox(ni.box,N.get("text-ignore-placement"),T.bucketInstanceId,Jn&&Jn.box&&Ci?Ci:Ii,Ze.ID),Tn&&xr&&this.collisionIndex.insertCollisionBox(xr.box,N.get("icon-ignore-placement"),T.bucketInstanceId,Ni,Ze.ID),mi&&(rn&&this.collisionIndex.insertCollisionCircles(mi.circles,N.get("text-ignore-placement"),T.bucketInstanceId,Ii,Ze.ID),v)){const Li=T.bucketInstanceId;let no=this.collisionCircleArrays[Li];no===void 0&&(no=this.collisionCircleArrays[Li]=new yc);for(let po=0;po<mi.circles.length;po+=4)no.circles.push(mi.circles[po+0]),no.circles.push(mi.circles[po+1]),no.circles.push(mi.circles[po+2]),no.circles.push(mi.collisionDetected?1:0)}const Tc=T.projection.name!=="globe";Tt=Tt&&(Tc||!Nn),Vt=Vt&&(Tc||!hr),this.placements[Cn]=new Jc(rn||Tt,Tn||Vt,cn||T.justReloaded),f.add(Cn)};if(kt){const Bt=T.getSortedSymbolIndexes(this.transform.angle);for(let ln=Bt.length-1;ln>=0;--ln){const Wt=Bt[ln];vn(T.symbolInstances.get(Wt),Wt,T.collisionArrays[Wt])}}else for(let Bt=a.symbolInstanceStart;Bt<a.symbolInstanceEnd;Bt++)vn(T.symbolInstances.get(Bt),Bt,T.collisionArrays[Bt]);if(v&&T.bucketInstanceId in this.collisionCircleArrays){const Bt=this.collisionCircleArrays[T.bucketInstanceId];o.invert(Bt.invProjMatrix,z),Bt.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(a,f,v,S){const{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:N,rightJustifiedTextSymbolIndex:z,verticalPlacedTextSymbolIndex:G,crossTileID:Q}=v,te=o.getAnchorJustification(f),ge=S===o.WritingMode.vertical?G:te==="left"?T:te==="center"?N:te==="right"?z:-1;T>=0&&(a.text.placedSymbolArray.get(T).crossTileID=ge>=0&&T!==ge?0:Q),N>=0&&(a.text.placedSymbolArray.get(N).crossTileID=ge>=0&&N!==ge?0:Q),z>=0&&(a.text.placedSymbolArray.get(z).crossTileID=ge>=0&&z!==ge?0:Q),G>=0&&(a.text.placedSymbolArray.get(G).crossTileID=ge>=0&&G!==ge?0:Q)}markUsedOrientation(a,f,v){const S=f===o.WritingMode.horizontal||f===o.WritingMode.horizontalOnly?f:0,T=f===o.WritingMode.vertical?f:0,{leftJustifiedTextSymbolIndex:N,centerJustifiedTextSymbolIndex:z,rightJustifiedTextSymbolIndex:G,verticalPlacedTextSymbolIndex:Q}=v,te=a.text.placedSymbolArray;N>=0&&(te.get(N).placedOrientation=S),z>=0&&(te.get(z).placedOrientation=S),G>=0&&(te.get(G).placedOrientation=S),Q>=0&&(te.get(Q).placedOrientation=T)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let v=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const S=f?f.symbolFadeChange(a):1,T=f?f.opacities:{},N=f?f.variableOffsets:{},z=f?f.placedOrientations:{};for(const G in this.placements){const Q=this.placements[G],te=T[G];te?(this.opacities[G]=new ic(te,S,Q.text,Q.icon,null,Q.clipped),v=v||Q.text!==te.text.placed||Q.icon!==te.icon.placed):(this.opacities[G]=new ic(null,S,Q.text,Q.icon,Q.skipFade,Q.clipped),v=v||Q.text||Q.icon)}for(const G in T){const Q=T[G];if(!this.opacities[G]){const te=new ic(Q,S,!1,!1);te.isHidden()||(this.opacities[G]=te,v=v||Q.text.placed||Q.icon.placed)}}for(const G in N)this.variableOffsets[G]||!this.opacities[G]||this.opacities[G].isHidden()||(this.variableOffsets[G]=N[G]);for(const G in z)this.placedOrientations[G]||!this.opacities[G]||this.opacities[G].isHidden()||(this.placedOrientations[G]=z[G]);v?this.lastPlacementChangeTime=a:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:a)}updateLayerOpacities(a,f){const v=new Set;for(const S of f){const T=S.getBucket(a);T&&S.latestFeatureIndex&&a.id===T.layerIds[0]&&this.updateBucketOpacities(T,v,S.collisionBoxArray)}}updateBucketOpacities(a,f,v){a.hasTextData()&&a.text.opacityVertexArray.clear(),a.hasIconData()&&a.icon.opacityVertexArray.clear(),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const S=a.layers[0].layout,T=!!a.layers[0].dynamicFilter(),N=new ic(null,0,!1,!1,!0),z=S.get("text-allow-overlap"),G=S.get("icon-allow-overlap"),Q=S.get("text-variable-anchor"),te=S.get("text-rotation-alignment")==="map",ge=S.get("text-pitch-alignment")==="map",Ae=S.get("icon-text-fit")!=="none",Le=new ic(null,0,z&&(G||!a.hasIconData()||S.get("icon-optional")),G&&(z||!a.hasTextData()||S.get("text-optional")),!0);!a.collisionArrays&&v&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(v);const Xe=(Ze,_e,$e)=>{for(let it=0;it<_e/4;it++)Ze.opacityVertexArray.emplaceBack($e)};let Ue=0;for(let Ze=0;Ze<a.symbolInstances.length;Ze++){const _e=a.symbolInstances.get(Ze),{numHorizontalGlyphVertices:$e,numVerticalGlyphVertices:it,crossTileID:st,numIconVertices:bt}=_e,wt=f.has(st);let vt=this.opacities[st];wt?vt=N:vt||(vt=Le,this.opacities[st]=vt),f.add(st);const kt=$e>0||it>0,Tt=bt>0,Vt=this.placedOrientations[st],vn=Vt===o.WritingMode.vertical,Bt=Vt===o.WritingMode.horizontal||Vt===o.WritingMode.horizontalOnly;if(!kt&&!Tt||vt.isHidden()||Ue++,kt){const ln=Wo(vt.text);Xe(a.text,$e,vn?xo:ln),Xe(a.text,it,Bt?xo:ln);const Wt=vt.text.isHidden(),{leftJustifiedTextSymbolIndex:Cn,centerJustifiedTextSymbolIndex:Ut,rightJustifiedTextSymbolIndex:rn,verticalPlacedTextSymbolIndex:Tn}=_e,cn=a.text.placedSymbolArray,Nn=Wt||vn?1:0;Cn>=0&&(cn.get(Cn).hidden=Nn),Ut>=0&&(cn.get(Ut).hidden=Nn),rn>=0&&(cn.get(rn).hidden=Nn),Tn>=0&&(cn.get(Tn).hidden=Wt||Bt?1:0);const hr=this.variableOffsets[st];hr&&this.markUsedJustification(a,hr.anchor,_e,Vt);const Dr=this.placedOrientations[st];Dr&&(this.markUsedJustification(a,"left",_e,Dr),this.markUsedOrientation(a,Dr,_e))}if(Tt){const ln=Wo(vt.icon),{placedIconSymbolIndex:Wt,verticalPlacedIconSymbolIndex:Cn}=_e,Ut=a.icon.placedSymbolArray,rn=vt.icon.isHidden()?1:0;Wt>=0&&(Xe(a.icon,bt,vn?xo:ln),Ut.get(Wt).hidden=rn),Cn>=0&&(Xe(a.icon,_e.numVerticalIconVertices,Bt?xo:ln),Ut.get(Cn).hidden=rn)}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const ln=a.collisionArrays[Ze];if(ln){let Wt=new o.Point(0,0),Cn=!0;if(ln.textBox||ln.verticalTextBox){if(Q){const rn=this.variableOffsets[st];rn?(Wt=Ps(rn.anchor,rn.width,rn.height,rn.textOffset,rn.textScale),te&&Wt._rotate(ge?this.transform.angle:-this.transform.angle)):Cn=!1}T&&(Cn=!vt.clipped),ln.textBox&&ai(a.textCollisionBox.collisionVertexArray,vt.text.placed,!Cn||vn,Wt.x,Wt.y),ln.verticalTextBox&&ai(a.textCollisionBox.collisionVertexArray,vt.text.placed,!Cn||Bt,Wt.x,Wt.y)}const Ut=Cn&&!!(!Bt&&ln.verticalIconBox);ln.iconBox&&ai(a.iconCollisionBox.collisionVertexArray,vt.icon.placed,Ut,Ae?Wt.x:0,Ae?Wt.y:0),ln.verticalIconBox&&ai(a.iconCollisionBox.collisionVertexArray,vt.icon.placed,!Ut,Ae?Wt.x:0,Ae?Wt.y:0)}}}if(a.fullyClipped=Ue===0,a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.bucketInstanceId in this.collisionCircleArrays){const Ze=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=Ze.invProjMatrix,a.placementViewportMatrix=Ze.viewportMatrix,a.collisionCircleArray=Ze.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return this.fadeDuration===0?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,f){const v=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*v>a}setStale(){this.stale=!0}}function ai(y,a,f,v,S){y.emplaceBack(a?1:0,f?1:0,v||0,S||0),y.emplaceBack(a?1:0,f?1:0,v||0,S||0),y.emplaceBack(a?1:0,f?1:0,v||0,S||0),y.emplaceBack(a?1:0,f?1:0,v||0,S||0)}const Jo=Math.pow(2,25),Io=Math.pow(2,24),vh=Math.pow(2,17),Pu=Math.pow(2,16),vo=Math.pow(2,9),Us=Math.pow(2,8),ku=Math.pow(2,1);function Wo(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const a=y.placed?1:0,f=Math.floor(127*y.opacity);return f*Jo+a*Io+f*vh+a*Pu+f*vo+a*Us+f*ku+a}const xo=0;class zl{constructor(a){this._sortAcrossTiles=a.layout.get("symbol-z-order")!=="viewport-y"&&a.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(a,f,v,S,T){const N=this._bucketParts;for(;this._currentTileIndex<a.length;)if(f.getBucketParts(N,S,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,T())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,N.sort(((z,G)=>z.sortKey-G.sortKey)));this._currentPartIndex<N.length;){const z=N[this._currentPartIndex];if(f.placeLayerBucketPart(z,this._seenCrossTileIDs,v,z.symbolInstanceStart===0),this._currentPartIndex++,T())return!0}return!1}}class Da{constructor(a,f,v,S,T,N,z,G){this.placement=new Na(a,T,N,z,G),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=S,this._done=!1}isDone(){return this._done}continuePlacement(a,f,v){const S=o.exported.now(),T=()=>{const N=o.exported.now()-S;return!this._forceFullPlacement&&N>2};for(;this._currentPlacementIndex>=0;){const N=f[a[this._currentPlacementIndex]],z=this.placement.collisionIndex.transform.zoom;if(N.type==="symbol"&&(!N.minzoom||N.minzoom<=z)&&(!N.maxzoom||N.maxzoom>z)){if(this._inProgressLayer||(this._inProgressLayer=new zl(N)),this._inProgressLayer.continuePlacement(v[N.source],this.placement,this._showCollisionBoxes,N,T))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const Vs=512/o.EXTENT/2;class Bo{constructor(a,f,v){this.tileID=a,this.bucketInstanceId=v,this.index=new o.KDBush(f.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const S=a.canonical.x*o.EXTENT,T=a.canonical.y*o.EXTENT;for(let N=0;N<f.length;N++){const{key:z,crossTileID:G,tileAnchorX:Q,tileAnchorY:te}=f.get(N),ge=Math.floor((S+Q)*Vs),Ae=Math.floor((T+te)*Vs);this.index.add(ge,Ae),this.keys.push(z),this.crossTileIDs.push(G)}this.index.finish()}findMatches(a,f,v){const S=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),T=Vs/Math.pow(2,f.canonical.z-this.tileID.canonical.z),N=f.canonical.x*o.EXTENT,z=f.canonical.y*o.EXTENT;for(let G=0;G<a.length;G++){const Q=a.get(G);if(Q.crossTileID)continue;const{key:te,tileAnchorX:ge,tileAnchorY:Ae}=Q,Le=Math.floor((N+ge)*T),Xe=Math.floor((z+Ae)*T),Ue=this.index.range(Le-S,Xe-S,Le+S,Xe+S);for(const Ze of Ue){const _e=this.crossTileIDs[Ze];if(this.keys[Ze]===te&&!v.has(_e)){v.add(_e),Q.crossTileID=_e;break}}}}}class Dc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ko{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const f=Math.round((a-this.lng)/360);if(f!==0)for(const v in this.indexes){const S=this.indexes[v],T={};for(const N in S){const z=S[N];z.tileID=z.tileID.unwrapTo(z.tileID.wrap+f),T[z.tileID.key]=z}this.indexes[v]=T}this.lng=a}addBucket(a,f,v){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let T=0;T<f.symbolInstances.length;T++)f.symbolInstances.get(T).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]=new Set);const S=this.usedCrossTileIDs[a.overscaledZ];for(const T in this.indexes){const N=this.indexes[T];if(Number(T)>a.overscaledZ)for(const z in N){const G=N[z];G.tileID.isChildOf(a)&&G.findMatches(f.symbolInstances,a,S)}else{const z=N[a.scaledTo(Number(T)).key];z&&z.findMatches(f.symbolInstances,a,S)}}for(let T=0;T<f.symbolInstances.length;T++){const N=f.symbolInstances.get(T);N.crossTileID||(N.crossTileID=v.generate(),S.add(N.crossTileID))}return this.indexes[a.overscaledZ]===void 0&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new Bo(a,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(a,f){for(const v of f.crossTileIDs)this.usedCrossTileIDs[a].delete(v)}removeStaleBuckets(a){let f=!1;for(const v in this.indexes){const S=this.indexes[v];for(const T in S)a[S[T].bucketInstanceId]||(this.removeBucketCrossTileIDs(v,S[T]),delete S[T],f=!0)}return f}}class ga{constructor(){this.layerIndexes={},this.crossTileIDs=new Dc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,f,v,S){let T=this.layerIndexes[a.id];T===void 0&&(T=this.layerIndexes[a.id]=new Ko);let N=!1;const z={};S.name!=="globe"&&T.handleWrapJump(v);for(const G of f){const Q=G.getBucket(a);Q&&a.id===Q.layerIds[0]&&(Q.bucketInstanceId||(Q.bucketInstanceId=++this.maxBucketInstanceId),T.addBucket(G.tileID,Q,this.crossTileIDs)&&(N=!0),z[Q.bucketInstanceId]=!0)}return T.removeStaleBuckets(z)&&(N=!0),N}pruneUnusedLayers(a){const f={};a.forEach((v=>{f[v]=!0}));for(const v in this.layerIndexes)f[v]||delete this.layerIndexes[v]}}const Xa=(y,a)=>o.emitValidationErrors(y,a&&a.filter((f=>f.identifier!=="source.canvas"))),ul=o.pick(Hi,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Qc=o.pick(Hi,["setCenter","setZoom","setBearing","setPitch"]),_c={version:8,layers:[],sources:{}},qs={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Ai extends o.Evented{constructor(a,f={}){super(),this.map=a,this.dispatcher=new xe(ma(),this),this.imageManager=new H,this.imageManager.setEventedParent(this),this.glyphManager=new o.GlyphManager(a._requestManager,f.localFontFamily?o.LocalGlyphMode.all:f.localIdeographFontFamily?o.LocalGlyphMode.ideographs:o.LocalGlyphMode.none,f.localFontFamily||f.localIdeographFontFamily),this.crossTileSymbolIndex=new ga,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const v=this;this._rtlTextPluginCallback=Ai.registerForPluginStateChange((S=>{v.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:S.pluginStatus,pluginURL:S.pluginURL},((T,N)=>{if(o.triggerPluginCompletionEvent(T),N&&N.every((z=>z)))for(const z in v._sourceCaches){const G=v._sourceCaches[z],Q=G.getSource().type;Q!=="vector"&&Q!=="geojson"||G.reload()}}))})),this.on("data",(S=>{if(S.dataType!=="source"||S.sourceDataType!=="metadata")return;const T=this.getSource(S.sourceId);if(T&&T.vectorLayerIds)for(const N in this._layers){const z=this._layers[N];z.source===T.id&&this._validateLayer(z)}}))}loadURL(a,f={}){this.fire(new o.Event("dataloading",{dataType:"style"}));const v=typeof f.validate=="boolean"?f.validate:!o.isMapboxURL(a);a=this.map._requestManager.normalizeStyleURL(a,f.accessToken);const S=this.map._requestManager.transformRequest(a,o.ResourceType.Style);this._request=o.getJSON(S,((T,N)=>{this._request=null,T?this.fire(new o.ErrorEvent(T)):N&&this._load(N,v)}))}loadJSON(a,f={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame((()=>{this._request=null,this._load(a,f.validate!==!1)}))}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(_c,!1)}_updateLayerCount(a,f){const v=f?1:-1;a.is3D()&&(this._num3DLayers+=v),a.type==="circle"&&(this._numCircleLayers+=v),a.type==="symbol"&&(this._numSymbolLayers+=v)}_load(a,f){if(f&&Xa(this,o.validateStyle(a)))return;this._loaded=!0,this.stylesheet=o.clone$1(a),this._updateMapProjection();for(const S in a.sources)this.addSource(S,a.sources[S],{validate:!1});this._changed=!1,a.sprite?this._loadSprite(a.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(a.glyphs);const v=ll(this.stylesheet.layers);this._order=v.map((S=>S.id)),this._layers={},this._serializedLayers={};for(const S of v){const T=o.createStyleLayer(S);T.setEventedParent(this,{layer:{id:T.id}}),this._layers[T.id]=T,this._serializedLayers[T.id]=T.serialize(),this._updateLayerCount(T,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new be(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(a){a?this.stylesheet.projection=a:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(a){this._spriteRequest=(function(f,v,S){let T,N,z;const G=o.exported.devicePixelRatio>1?"@2x":"";let Q=o.getJSON(v.transformRequest(v.normalizeSpriteURL(f,G,".json"),o.ResourceType.SpriteJSON),((Ae,Le)=>{Q=null,z||(z=Ae,T=Le,ge())})),te=o.getImage(v.transformRequest(v.normalizeSpriteURL(f,G,".png"),o.ResourceType.SpriteImage),((Ae,Le)=>{te=null,z||(z=Ae,N=Le,ge())}));function ge(){if(z)S(z);else if(T&&N){const Ae=o.exported.getImageData(N),Le={};for(const Xe in T){const{width:Ue,height:Ze,x:_e,y:$e,sdf:it,pixelRatio:st,stretchX:bt,stretchY:wt,content:vt}=T[Xe],kt=new o.RGBAImage({width:Ue,height:Ze});o.RGBAImage.copy(Ae,kt,{x:_e,y:$e},{x:0,y:0},{width:Ue,height:Ze}),Le[Xe]={data:kt,pixelRatio:st,sdf:it,stretchX:bt,stretchY:wt,content:vt}}S(null,Le)}}return{cancel(){Q&&(Q.cancel(),Q=null),te&&(te.cancel(),te=null)}}})(a,this.map._requestManager,((f,v)=>{if(this._spriteRequest=null,f)this.fire(new o.ErrorEvent(f));else if(v)for(const S in v)this.imageManager.addImage(S,v[S]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new o.Event("data",{dataType:"style"}))}))}_validateLayer(a){const f=this.getSource(a.source);if(!f)return;const v=a.sourceLayer;v&&(f.type==="geojson"||f.vectorLayerIds&&f.vectorLayerIds.indexOf(v)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${v}" does not exist on source "${f.id}" as specified by style layer "${a.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const a in this._sourceCaches)if(!this._sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(a){const f=[];for(const v of a){const S=this._layers[v];S.type!=="custom"&&f.push(S.serialize())}return f}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const a in this._sourceCaches)if(this._sourceCaches[a].hasTransition())return!0;for(const a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(a){return!!this.terrain&&(typeof a.isLayerDraped=="function"?a.isLayerDraped():qs[a.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(a){if(!this._loaded)return;const f=this._changed;if(this._changed){const S=Object.keys(this._updatedLayers),T=Object.keys(this._removedLayers);(S.length||T.length)&&this._updateWorkerLayers(S,T);for(const N in this._updatedSources){const z=this._updatedSources[N];z==="reload"?this._reloadSource(N):z==="clear"&&this._clearSource(N)}this._updateTilesForChangedImages();for(const N in this._updatedPaintProps)this._layers[N].updateTransitions(a);this.light.updateTransitions(a),this.fog&&this.fog.updateTransitions(a),this._resetUpdates()}const v={};for(const S in this._sourceCaches){const T=this._sourceCaches[S];v[S]=T.used,T.used=!1}for(const S of this._order){const T=this._layers[S];if(T.recalculate(a,this._availableImages),!T.isHidden(a.zoom)){const z=this._getLayerSourceCache(T);z&&(z.used=!0)}const N=this.map.painter;if(N){const z=T.getProgramIds();if(!z)continue;const G=T.getProgramConfiguration(a.zoom);for(const Q of z)N.useProgram(Q,G)}}for(const S in v){const T=this._sourceCaches[S];v[S]!==T.used&&T.getSource().fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:T.getSource().id}))}this.light.recalculate(a),this.terrain&&this.terrain.recalculate(a),this.fog&&this.fog.recalculate(a),this.z=a.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),f&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const a=Object.keys(this._changedImages);if(a.length){for(const f in this._sourceCaches)this._sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}}_updateWorkerLayers(a,f){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(a),removedIds:f})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(a){if(this._checkLoaded(),Xa(this,o.validateStyle(a)))return!1;(a=o.clone$1(a)).layers=ll(a.layers);const f=(function(S,T){if(!S)return[{command:Hi.setStyle,args:[T]}];let N=[];try{if(!b(S.version,T.version))return[{command:Hi.setStyle,args:[T]}];b(S.center,T.center)||N.push({command:Hi.setCenter,args:[T.center]}),b(S.zoom,T.zoom)||N.push({command:Hi.setZoom,args:[T.zoom]}),b(S.bearing,T.bearing)||N.push({command:Hi.setBearing,args:[T.bearing]}),b(S.pitch,T.pitch)||N.push({command:Hi.setPitch,args:[T.pitch]}),b(S.sprite,T.sprite)||N.push({command:Hi.setSprite,args:[T.sprite]}),b(S.glyphs,T.glyphs)||N.push({command:Hi.setGlyphs,args:[T.glyphs]}),b(S.transition,T.transition)||N.push({command:Hi.setTransition,args:[T.transition]}),b(S.light,T.light)||N.push({command:Hi.setLight,args:[T.light]}),b(S.fog,T.fog)||N.push({command:Hi.setFog,args:[T.fog]}),b(S.projection,T.projection)||N.push({command:Hi.setProjection,args:[T.projection]});const z={},G=[];(function(ge,Ae,Le,Xe){let Ue;for(Ue in Ae=Ae||{},ge=ge||{})ge.hasOwnProperty(Ue)&&(Ae.hasOwnProperty(Ue)||Lu(Ue,Le,Xe));for(Ue in Ae){if(!Ae.hasOwnProperty(Ue))continue;const Ze=Ae[Ue];ge.hasOwnProperty(Ue)?b(ge[Ue],Ze)||(ge[Ue].type==="geojson"&&Ze.type==="geojson"&&fu(ge,Ae,Ue)?Le.push({command:Hi.setGeoJSONSourceData,args:[Ue,Ze.data]}):To(Ue,Ae,Le,Xe)):nc(Ue,Ae,Le)}})(S.sources,T.sources,G,z);const Q=[];S.layers&&S.layers.forEach((ge=>{ge.source&&z[ge.source]?N.push({command:Hi.removeLayer,args:[ge.id]}):Q.push(ge)}));let te=S.terrain;te&&z[te.source]&&(N.push({command:Hi.setTerrain,args:[void 0]}),te=void 0),N=N.concat(G),b(te,T.terrain)||N.push({command:Hi.setTerrain,args:[T.terrain]}),(function(ge,Ae,Le){Ae=Ae||[];const Xe=(ge=ge||[]).map(Zo),Ue=Ae.map(Zo),Ze=ge.reduce(Ha,{}),_e=Ae.reduce(Ha,{}),$e=Xe.slice(),it=Object.create(null);let st,bt,wt,vt,kt,Tt,Vt;for(st=0,bt=0;st<Xe.length;st++)wt=Xe[st],_e.hasOwnProperty(wt)?bt++:(Le.push({command:Hi.removeLayer,args:[wt]}),$e.splice($e.indexOf(wt,bt),1));for(st=0,bt=0;st<Ue.length;st++)wt=Ue[Ue.length-1-st],$e[$e.length-1-st]!==wt&&(Ze.hasOwnProperty(wt)?(Le.push({command:Hi.removeLayer,args:[wt]}),$e.splice($e.lastIndexOf(wt,$e.length-bt),1)):bt++,Tt=$e[$e.length-st],Le.push({command:Hi.addLayer,args:[_e[wt],Tt]}),$e.splice($e.length-st,0,wt),it[wt]=!0);for(st=0;st<Ue.length;st++)if(wt=Ue[st],vt=Ze[wt],kt=_e[wt],!it[wt]&&!b(vt,kt))if(b(vt.source,kt.source)&&b(vt["source-layer"],kt["source-layer"])&&b(vt.type,kt.type)){for(Vt in wa(vt.layout,kt.layout,Le,wt,null,Hi.setLayoutProperty),wa(vt.paint,kt.paint,Le,wt,null,Hi.setPaintProperty),b(vt.filter,kt.filter)||Le.push({command:Hi.setFilter,args:[wt,kt.filter]}),b(vt.minzoom,kt.minzoom)&&b(vt.maxzoom,kt.maxzoom)||Le.push({command:Hi.setLayerZoomRange,args:[wt,kt.minzoom,kt.maxzoom]}),vt)vt.hasOwnProperty(Vt)&&Vt!=="layout"&&Vt!=="paint"&&Vt!=="filter"&&Vt!=="metadata"&&Vt!=="minzoom"&&Vt!=="maxzoom"&&(Vt.indexOf("paint.")===0?wa(vt[Vt],kt[Vt],Le,wt,Vt.slice(6),Hi.setPaintProperty):b(vt[Vt],kt[Vt])||Le.push({command:Hi.setLayerProperty,args:[wt,Vt,kt[Vt]]}));for(Vt in kt)kt.hasOwnProperty(Vt)&&!vt.hasOwnProperty(Vt)&&Vt!=="layout"&&Vt!=="paint"&&Vt!=="filter"&&Vt!=="metadata"&&Vt!=="minzoom"&&Vt!=="maxzoom"&&(Vt.indexOf("paint.")===0?wa(vt[Vt],kt[Vt],Le,wt,Vt.slice(6),Hi.setPaintProperty):b(vt[Vt],kt[Vt])||Le.push({command:Hi.setLayerProperty,args:[wt,Vt,kt[Vt]]}))}else Le.push({command:Hi.removeLayer,args:[wt]}),Tt=$e[$e.lastIndexOf(wt)+1],Le.push({command:Hi.addLayer,args:[kt,Tt]})})(Q,T.layers,N)}catch(z){console.warn("Unable to compute style diff:",z),N=[{command:Hi.setStyle,args:[T]}]}return N})(this.serialize(),a).filter((S=>!(S.command in Qc)));if(f.length===0)return!1;const v=f.filter((S=>!(S.command in ul)));if(v.length>0)throw new Error(`Unimplemented: ${v.map((S=>S.command)).join(", ")}.`);return f.forEach((S=>{S.command!=="setTransition"&&S.command!=="setProjection"&&this[S.command].apply(this,S.args)})),this.stylesheet=a,this._updateMapProjection(),!0}addImage(a,f){return this.getImage(a)?this.fire(new o.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(a,f),this._afterImageUpdated(a),this)}updateImage(a,f){this.imageManager.updateImage(a,f)}getImage(a){return this.imageManager.getImage(a)}removeImage(a){return this.getImage(a)?(this.imageManager.removeImage(a),this._afterImageUpdated(a),this):this.fire(new o.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(a,f,v={}){if(this._checkLoaded(),this.getSource(a)!==void 0)throw new Error("There is already a source with this ID");if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(o.validateSource,`sources.${a}`,f,null,v))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const S=Er(a,f,this.dispatcher,this);S.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(a),source:S.serialize(),sourceId:a})));const T=N=>{const z=(N?"symbol:":"other:")+a,G=this._sourceCaches[z]=new o.SourceCache(z,S,N);(N?this._symbolSourceCaches:this._otherSourceCaches)[a]=G,G.style=this,G.onAdd(this.map)};T(!1),f.type!=="vector"&&f.type!=="geojson"||T(!0),S.onAdd&&S.onAdd(this.map),this._changed=!0}removeSource(a){this._checkLoaded();const f=this.getSource(a);if(!f)throw new Error("There is no source with this ID");for(const S in this._layers)if(this._layers[S].source===a)return this.fire(new o.ErrorEvent(new Error(`Source "${a}" cannot be removed while layer "${S}" is using it.`)));if(this.terrain&&this.terrain.get().source===a)return this.fire(new o.ErrorEvent(new Error(`Source "${a}" cannot be removed while terrain is using it.`)));const v=this._getSourceCaches(a);for(const S of v)delete this._sourceCaches[S.id],delete this._updatedSources[S.id],S.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:S.getSource().id})),S.setEventedParent(null),S.clearTiles();return delete this._otherSourceCaches[a],delete this._symbolSourceCaches[a],f.setEventedParent(null),f.onRemove&&f.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(a,f){this._checkLoaded(),this.getSource(a).setData(f),this._changed=!0}getSource(a){const f=this._getSourceCache(a);return f&&f.getSource()}_getSources(){const a=[];for(const f in this._otherSourceCaches){const v=this._getSourceCache(f);v&&a.push(v.getSource())}return a}addLayer(a,f,v={}){this._checkLoaded();const S=a.id;if(this.getLayer(S))return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${S}" already exists on this map`)));let T;if(a.type==="custom"){if(Xa(this,o.validateCustomStyleLayer(a)))return;T=o.createStyleLayer(a)}else{if(typeof a.source=="object"&&(this.addSource(S,a.source),a=o.clone$1(a),a=o.extend(a,{source:S})),this._validate(o.validateLayer,`layers.${S}`,a,{arrayIndex:-1},v))return;T=o.createStyleLayer(a),this._validateLayer(T),T.setEventedParent(this,{layer:{id:S}}),this._serializedLayers[T.id]=T.serialize(),this._updateLayerCount(T,!0)}const N=f?this._order.indexOf(f):this._order.length;if(f&&N===-1)return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${f}" does not exist on this map.`)));this._order.splice(N,0,S),this._layerOrderChanged=!0,this._layers[S]=T;const z=this._getLayerSourceCache(T);if(this._removedLayers[S]&&T.source&&z&&T.type!=="custom"){const G=this._removedLayers[S];delete this._removedLayers[S],G.type!==T.type?this._updatedSources[T.source]="clear":(this._updatedSources[T.source]="reload",z.pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(a,f){if(this._checkLoaded(),this._changed=!0,!this._layers[a])return void this.fire(new o.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be moved.`)));if(a===f)return;const v=this._order.indexOf(a);this._order.splice(v,1);const S=f?this._order.indexOf(f):this._order.length;f&&S===-1?this.fire(new o.ErrorEvent(new Error(`Layer with id "${f}" does not exist on this map.`))):(this._order.splice(S,0,a),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(a){this._checkLoaded();const f=this._layers[a];if(!f)return void this.fire(new o.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be removed.`)));f.setEventedParent(null),this._updateLayerCount(f,!1);const v=this._order.indexOf(a);this._order.splice(v,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=f,delete this._layers[a],delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],f.onRemove&&f.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(a){return this._layers[a]}hasLayer(a){return a in this._layers}hasLayerType(a){for(const f in this._layers)if(this._layers[f].type===a)return!0;return!1}setLayerZoomRange(a,f,v){this._checkLoaded();const S=this.getLayer(a);S?S.minzoom===f&&S.maxzoom===v||(f!=null&&(S.minzoom=f),v!=null&&(S.maxzoom=v),this._updateLayer(S)):this.fire(new o.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(a,f,v={}){this._checkLoaded();const S=this.getLayer(a);if(S){if(!b(S.filter,f))return f==null?(S.filter=void 0,void this._updateLayer(S)):void(this._validate(o.validateFilter,`layers.${S.id}.filter`,f,{layerType:S.type},v)||(S.filter=o.clone$1(f),this._updateLayer(S)))}else this.fire(new o.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be filtered.`)))}getFilter(a){const f=this.getLayer(a);return f&&o.clone$1(f.filter)}setLayoutProperty(a,f,v,S={}){this._checkLoaded();const T=this.getLayer(a);T?b(T.getLayoutProperty(f),v)||(T.setLayoutProperty(f,v,S),this._updateLayer(T)):this.fire(new o.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(a,f){const v=this.getLayer(a);if(v)return v.getLayoutProperty(f);this.fire(new o.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style.`)))}setPaintProperty(a,f,v,S={}){this._checkLoaded();const T=this.getLayer(a);T?b(T.getPaintProperty(f),v)||(T.setPaintProperty(f,v,S)&&this._updateLayer(T),this._changed=!0,this._updatedPaintProps[a]=!0):this.fire(new o.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(a,f){const v=this.getLayer(a);return v&&v.getPaintProperty(f)}setFeatureState(a,f){this._checkLoaded();const v=a.source,S=a.sourceLayer,T=this.getSource(v);if(!T)return void this.fire(new o.ErrorEvent(new Error(`The source '${v}' does not exist in the map's style.`)));const N=T.type;if(N==="geojson"&&S)return void this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(N==="vector"&&!S)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));a.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided.")));const z=this._getSourceCaches(v);for(const G of z)G.setFeatureState(S,a.id,f)}removeFeatureState(a,f){this._checkLoaded();const v=a.source,S=this.getSource(v);if(!S)return void this.fire(new o.ErrorEvent(new Error(`The source '${v}' does not exist in the map's style.`)));const T=S.type,N=T==="vector"?a.sourceLayer:void 0;if(T==="vector"&&!N)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(f&&typeof a.id!="string"&&typeof a.id!="number")return void this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const z=this._getSourceCaches(v);for(const G of z)G.removeFeatureState(N,a.id,f)}getFeatureState(a){this._checkLoaded();const f=a.source,v=a.sourceLayer,S=this.getSource(f);if(S){if(S.type!=="vector"||v)return a.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(f)[0].getFeatureState(v,a.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const a={};for(const f in this._sourceCaches){const v=this._sourceCaches[f].getSource();a[v.id]||(a[v.id]=v.serialize())}return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:a,layers:this._serializeLayers(this._order)},(f=>f!==void 0))}_updateLayer(a){this._updatedLayers[a.id]=!0;const f=this._getLayerSourceCache(a);a.source&&!this._updatedSources[a.source]&&f&&f.getSource().type!=="raster"&&(this._updatedSources[a.source]="reload",f.pause()),this._changed=!0,a.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(a){const f=N=>this._layers[N].type==="fill-extrusion",v={},S=[];for(let N=this._order.length-1;N>=0;N--){const z=this._order[N];if(f(z)){v[z]=N;for(const G of a){const Q=G[z];if(Q)for(const te of Q)S.push(te)}}}S.sort(((N,z)=>z.intersectionZ-N.intersectionZ));const T=[];for(let N=this._order.length-1;N>=0;N--){const z=this._order[N];if(f(z))for(let G=S.length-1;G>=0;G--){const Q=S[G].feature;if(v[Q.layer.id]<N)break;T.push(Q),S.pop()}else for(const G of a){const Q=G[z];if(Q)for(const te of Q)T.push(te.feature)}}return T}queryRenderedFeatures(a,f,v){f&&f.filter&&this._validate(o.validateFilter,"queryRenderedFeatures.filter",f.filter,null,f);const S={};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const G of f.layers){const Q=this._layers[G];if(!Q)return this.fire(new o.ErrorEvent(new Error(`The layer '${G}' does not exist in the map's style and cannot be queried for features.`))),[];S[Q.source]=!0}}const T=[];f.availableImages=this._availableImages;const N=f&&f.layers?f.layers.some((G=>{const Q=this.getLayer(G);return Q&&Q.is3D()})):this.has3DLayers(),z=Ne.createFromScreenPoints(a,v);for(const G in this._sourceCaches){const Q=this._sourceCaches[G].getSource().id;f.layers&&!S[Q]||T.push(oo(this._sourceCaches[G],this._layers,this._serializedLayers,z,f,v,N,!!this.map._showQueryGeometry))}return this.placement&&T.push((function(G,Q,te,ge,Ae,Le,Xe){const Ue={},Ze=Le.queryRenderedSymbols(ge),_e=[];for(const $e of Object.keys(Ze).map(Number))_e.push(Xe[$e]);_e.sort(Ho);for(const $e of _e){const it=$e.featureIndex.lookupSymbolFeatures(Ze[$e.bucketInstanceId],Q,$e.bucketIndex,$e.sourceLayerIndex,Ae.filter,Ae.layers,Ae.availableImages,G);for(const st in it){const bt=Ue[st]=Ue[st]||[],wt=it[st];wt.sort(((vt,kt)=>{const Tt=$e.featureSortOrder;if(Tt){const Vt=Tt.indexOf(vt.featureIndex);return Tt.indexOf(kt.featureIndex)-Vt}return kt.featureIndex-vt.featureIndex}));for(const vt of wt)bt.push(vt)}}for(const $e in Ue)Ue[$e].forEach((it=>{const st=it.feature,bt=te(G[$e]);if(!bt)return;const wt=bt.getFeatureState(st.layer["source-layer"],st.id);st.source=st.layer.source,st.layer["source-layer"]&&(st.sourceLayer=st.layer["source-layer"]),st.state=wt}));return Ue})(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),z.screenGeometry,f,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(T)}querySourceFeatures(a,f){f&&f.filter&&this._validate(o.validateFilter,"querySourceFeatures.filter",f.filter,null,f);const v=this._getSourceCaches(a);let S=[];for(const T of v)S=S.concat(_o(T,f));return S}addSourceType(a,f,v){return Ai.getSourceType(a)?v(new Error(`A source type called "${a}" already exists.`)):(Ai.setSourceType(a,f),f.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:f.workerSourceURL},v):v(null,null))}getLight(){return this.light.getLight()}setLight(a,f={}){this._checkLoaded();const v=this.light.getLight();let S=!1;for(const N in a)if(!b(a[N],v[N])){S=!0;break}if(!S)return;const T=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(a,f),this.light.updateTransitions(T)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(a,f=1){if(this._checkLoaded(),!a)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let v=a;if(f===1){if(typeof v.source=="object"){const S="terrain-dem-src";this.addSource(S,v.source),v=o.clone$1(v),v=o.extend(v,{source:S})}if(this._validate(o.validateTerrain,"terrain",v))return}if(!this.terrain||this.terrain&&f!==this.terrain.drapeRenderMode){if(!v)return;this._createTerrain(v,f)}else{const S=this.terrain,T=S.get();for(const N of Object.keys(o.spec.terrain))!v.hasOwnProperty(N)&&o.spec.terrain[N].default&&(v[N]=o.spec.terrain[N].default);for(const N in v)if(!b(v[N],T[N])){S.set(v),this.stylesheet.terrain=v;const z=this._setTransitionParameters({duration:0});S.updateTransitions(z);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(a){const f=this.fog=new tt(a,this.map.transform);this.stylesheet.fog=a;const v=this._setTransitionParameters({duration:0});f.updateTransitions(v)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask((()=>{for(const a of this.map._markers)a._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(a){if(this._checkLoaded(),!a)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const f=this.fog,v=f.get();Object.keys(a).length===0&&f.set(a);for(const S in a)if(!b(a[S],v[S])){f.set(a),this.stylesheet.fog=a;const T=this._setTransitionParameters({duration:0});f.updateTransitions(T);break}}else this._createFog(a);this._markersNeedUpdate=!0}_setTransitionParameters(a){return{now:o.exported.now(),transition:o.extend(a,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const a=this._order.filter((v=>this.isLayerDraped(this._layers[v]))),f=this._order.filter((v=>!this.isLayerDraped(this._layers[v])));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...a),this._drapedFirstOrder.push(...f)}_createTerrain(a,f){const v=this.terrain=new Oe(a,f);this.stylesheet.terrain=a,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const S=this._setTransitionParameters({duration:0});v.updateTransitions(S)}_force3DLayerUpdate(){for(const a in this._layers){const f=this._layers[a];f.type==="fill-extrusion"&&this._updateLayer(f)}}_forceSymbolLayerUpdate(){for(const a in this._layers){const f=this._layers[a];f.type==="symbol"&&this._updateLayer(f)}}_validate(a,f,v,S,T={}){return(!T||T.validate!==!1)&&Xa(this,a.call(o.validateStyle,o.extend({key:f,style:this.serialize(),value:v,styleSpec:o.spec},S)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this._sourceCaches)this._sourceCaches[a].clearTiles(),this._sourceCaches[a].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(a){const f=this._getSourceCaches(a);for(const v of f)v.clearTiles()}_reloadSource(a){const f=this._getSourceCaches(a);for(const v of f)v.resume(),v.reload()}_reloadSources(){for(const a of this._getSources())a.reload&&a.reload()}_updateSources(a){for(const f in this._sourceCaches)this._sourceCaches[f].update(a)}_generateCollisionBoxes(){for(const a in this._sourceCaches){const f=this._sourceCaches[a];f.resume(),f.reload()}}_updatePlacement(a,f,v,S,T=!1){let N=!1,z=!1;const G={};for(const Q of this._order){const te=this._layers[Q];if(te.type!=="symbol")continue;if(!G[te.source]){const Ae=this._getLayerSourceCache(te);if(!Ae)continue;G[te.source]=Ae.getRenderableIds(!0).map((Le=>Ae.getTileByID(Le))).sort(((Le,Xe)=>Xe.tileID.overscaledZ-Le.tileID.overscaledZ||(Le.tileID.isLessThan(Xe.tileID)?-1:1)))}const ge=this.crossTileSymbolIndex.addLayer(te,G[te.source],a.center.lng,a.projection);N=N||ge}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),T=T||this._layerOrderChanged||v===0,this._layerOrderChanged&&this.fire(new o.Event("neworder")),(T||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),a.zoom))&&(this.pauseablePlacement=new Da(a,this._order,T,f,v,S,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,G),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),z=!0),N&&this.pauseablePlacement.placement.setStale()),z||N)for(const Q of this._order){const te=this._layers[Q];te.type==="symbol"&&this.placement.updateLayerOpacities(te,G[te.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const a in this._sourceCaches)this._sourceCaches[a].releaseSymbolFadeTiles()}getImages(a,f,v){this.imageManager.getImages(f.icons,v),this._updateTilesForChangedImages();const S=T=>{T&&T.setDependencies(f.tileID.key,f.type,f.icons)};S(this._otherSourceCaches[f.source]),S(this._symbolSourceCaches[f.source])}getGlyphs(a,f,v){this.glyphManager.getGlyphs(f.stacks,v)}getResource(a,f,v){return o.makeRequest(f,v)}_getSourceCache(a){return this._otherSourceCaches[a]}_getLayerSourceCache(a){return a.type==="symbol"?this._symbolSourceCaches[a.source]:this._otherSourceCaches[a.source]}_getSourceCaches(a){const f=[];return this._otherSourceCaches[a]&&f.push(this._otherSourceCaches[a]),this._symbolSourceCaches[a]&&f.push(this._symbolSourceCaches[a]),f}_isSourceCacheLoaded(a){const f=this._getSourceCaches(a);return f.length===0?(this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${a}'`))),!1):f.every((v=>v.loaded()))}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ai.getSourceType=function(y){return jr[y]},Ai.setSourceType=function(y,a){jr[y]=a},Ai.registerForPluginStateChange=o.registerForPluginStateChange;var Ss=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,$s="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ia=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,oa=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,hl=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let Gs={},Hs={};const vc=[];$t(Ss,vc),$t(ia,vc),$t(oa,vc),$t(hl,vc),Gs=Zt("",ia),Hs=Zt(hl,oa);const W=Zt(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Ce=Ss,mt=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var yt={background:Zt(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Zt(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Zt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Zt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Zt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Zt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Zt("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Zt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Zt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Zt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Zt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Zt(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Zt(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Zt(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Zt(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Zt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Zt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Zt(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Zt(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Zt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Zt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Zt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Zt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Zt(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:Zt(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Zt(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,$s),skyboxGradient:Zt(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,$s),skyboxCapture:Zt(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Zt(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Zt(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function $t(y,a){const f=y.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let v of f)if(v=v.trim(),v[0]==="#"&&v.includes("if")&&!v.includes("endif")){v=v.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const S=v.split(" ");for(const T of S)a.includes(T)||a.push(T)}}function Zt(y,a){const f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,v=a.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),S={},T=[...vc];return $t(y,T),$t(a,T),{fragmentSource:y=y.replace(f,((N,z,G,Q,te)=>(S[te]=!0,z==="define"?`
#ifndef HAS_UNIFORM_u_${te}
varying ${G} ${Q} ${te};
#else
uniform ${G} ${Q} u_${te};
#endif
`:`
#ifdef HAS_UNIFORM_u_${te}
    ${G} ${Q} ${te} = u_${te};
#endif
`))),vertexSource:a=a.replace(f,((N,z,G,Q,te)=>{const ge=Q==="float"?"vec2":"vec4",Ae=te.match(/color/)?"color":ge;return S[te]?z==="define"?`
#ifndef HAS_UNIFORM_u_${te}
uniform lowp float u_${te}_t;
attribute ${G} ${ge} a_${te};
varying ${G} ${Q} ${te};
#else
uniform ${G} ${Q} u_${te};
#endif
`:Ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${te}
    ${te} = a_${te};
#else
    ${G} ${Q} ${te} = u_${te};
#endif
`:`
#ifndef HAS_UNIFORM_u_${te}
    ${te} = unpack_mix_${Ae}(a_${te}, u_${te}_t);
#else
    ${G} ${Q} ${te} = u_${te};
#endif
`:z==="define"?`
#ifndef HAS_UNIFORM_u_${te}
uniform lowp float u_${te}_t;
attribute ${G} ${ge} a_${te};
#else
uniform ${G} ${Q} u_${te};
#endif
`:Ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${te}
    ${G} ${Q} ${te} = a_${te};
#else
    ${G} ${Q} ${te} = u_${te};
#endif
`:`
#ifndef HAS_UNIFORM_u_${te}
    ${G} ${Q} ${te} = unpack_mix_${Ae}(a_${te}, u_${te}_t);
#else
    ${G} ${Q} ${te} = u_${te};
#endif
`})),staticAttributes:v,usedDefines:T}}class zn{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(a,f,v,S,T,N,z){this.context=a;let G=this.boundPaintVertexBuffers.length!==S.length;for(let te=0;!G&&te<S.length;te++)this.boundPaintVertexBuffers[te]!==S[te]&&(G=!0);let Q=this.boundDynamicVertexBuffers.length!==z.length;for(let te=0;!Q&&te<z.length;te++)this.boundDynamicVertexBuffers[te]!==z[te]&&(Q=!0);if(!a.extVertexArrayObject||!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==v||G||Q||this.boundIndexBuffer!==T||this.boundVertexOffset!==N)this.freshBind(f,v,S,T,N,z);else{a.bindVertexArrayOES.set(this.vao);for(const te of z)te&&te.bind();T&&T.dynamicDraw&&T.bind()}}freshBind(a,f,v,S,T,N){let z;const G=a.numAttributes,Q=this.context,te=Q.gl;if(Q.extVertexArrayObject)this.vao&&this.destroy(),this.vao=Q.extVertexArrayObject.createVertexArrayOES(),Q.bindVertexArrayOES.set(this.vao),z=0,this.boundProgram=a,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=v,this.boundIndexBuffer=S,this.boundVertexOffset=T,this.boundDynamicVertexBuffers=N;else{z=Q.currentNumAttributes||0;for(let ge=G;ge<z;ge++)te.disableVertexAttribArray(ge)}f.enableAttributes(te,a),f.bind(),f.setVertexAttribPointers(te,a,T);for(const ge of v)ge.enableAttributes(te,a),ge.bind(),ge.setVertexAttribPointers(te,a,T);for(const ge of N)ge&&(ge.enableAttributes(te,a),ge.bind(),ge.setVertexAttribPointers(te,a,T));S&&S.bind(),Q.currentNumAttributes=G}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Nr(y,a){const f=Math.pow(2,a.canonical.z),v=a.canonical.y;return[new o.MercatorCoordinate(0,v/f).toLngLat().lat,new o.MercatorCoordinate(0,(v+1)/f).toLngLat().lat]}function Hr(y,a,f,v,S,T,N){const z=y.context,G=z.gl,Q=f.fbo;if(!Q)return;y.prepareDrawTile();const te=y.useProgram("hillshade");z.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_2D,Q.colorAttachment.get());const ge=((Ue,Ze,_e,$e)=>{const it=_e.paint.get("hillshade-shadow-color"),st=_e.paint.get("hillshade-highlight-color"),bt=_e.paint.get("hillshade-accent-color");let wt=_e.paint.get("hillshade-illumination-direction")*(Math.PI/180);_e.paint.get("hillshade-illumination-anchor")==="viewport"&&(wt-=Ue.transform.angle);const vt=!Ue.options.moving;return{u_matrix:$e||Ue.transform.calculateProjMatrix(Ze.tileID.toUnwrapped(),vt),u_image:0,u_latrange:Nr(0,Ze.tileID),u_light:[_e.paint.get("hillshade-exaggeration"),wt],u_shadow:it,u_highlight:st,u_accent:bt}})(y,f,v,y.terrain?a.projMatrix:null);y.prepareDrawProgram(z,te,a.toUnwrapped());const{tileBoundsBuffer:Ae,tileBoundsIndexBuffer:Le,tileBoundsSegments:Xe}=y.getTileBoundsBuffers(f);te.draw(z,G.TRIANGLES,S,T,N,o.CullFaceMode.disabled,ge,v.id,Ae,Le,Xe)}function gi(y,a,f){if(!a.needsDEMTextureUpload)return;const v=y.context,S=v.gl;v.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||y.getTileTexture(f.stride);const T=f.getPixels();a.demTexture?a.demTexture.update(T,{premultiply:!1}):a.demTexture=new o.Texture(v,T,S.RGBA,{premultiply:!1}),a.needsDEMTextureUpload=!1}function Ti(y,a,f,v,S,T){const N=y.context,z=N.gl;if(!a.dem)return;const G=a.dem;if(N.activeTexture.set(z.TEXTURE1),gi(y,a,G),!a.demTexture)return;a.demTexture.bind(z.NEAREST,z.CLAMP_TO_EDGE);const Q=G.dim;N.activeTexture.set(z.TEXTURE0);let te=a.fbo;if(!te){const Xe=new o.Texture(N,{width:Q,height:Q,data:null},z.RGBA);Xe.bind(z.LINEAR,z.CLAMP_TO_EDGE),te=a.fbo=N.createFramebuffer(Q,Q,!0),te.colorAttachment.set(Xe.texture)}N.bindFramebuffer.set(te.framebuffer),N.viewport.set([0,0,Q,Q]);const{tileBoundsBuffer:ge,tileBoundsIndexBuffer:Ae,tileBoundsSegments:Le}=y.getMercatorTileBoundsBuffers();y.useProgram("hillshadePrepare").draw(N,z.TRIANGLES,v,S,T,o.CullFaceMode.disabled,((Xe,Ue)=>{const Ze=Ue.stride,_e=o.create();return o.ortho(_e,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(_e,_e,[0,-o.EXTENT,0]),{u_matrix:_e,u_image:1,u_dimension:[Ze,Ze],u_zoom:Xe.overscaledZ,u_unpack:Ue.unpackVector}})(a.tileID,G),f.id,ge,Ae,Le),a.needsHillshadePrepare=!1}const bo=y=>({u_matrix:new o.UniformMatrix4f(y),u_image0:new o.Uniform1i(y),u_skirt_height:new o.Uniform1f(y)}),wo=(y,a)=>({u_matrix:y,u_image0:0,u_skirt_height:a}),Qo=(y,a,f,v,S,T,N,z,G,Q,te,ge,Ae,Le,Xe)=>({u_proj_matrix:Float32Array.from(y),u_globe_matrix:a,u_normalize_matrix:Float32Array.from(v),u_merc_matrix:f,u_zoom_transition:S,u_merc_center:T,u_image0:0,u_frustum_tl:N,u_frustum_tr:z,u_frustum_br:G,u_frustum_bl:Q,u_globe_pos:te,u_globe_radius:ge,u_viewport:Ae,u_grid_matrix:Xe?Float32Array.from(Xe):new Float32Array(9),u_skirt_height:Le});function Mo(y,a){return y!=null&&a!=null&&!(!y.hasData()||!a.hasData())&&y.demTexture!=null&&a.demTexture!=null&&y.tileID.key!==a.tileID.key}const zo=new class{constructor(){this.operations={}}newMorphing(y,a,f,v,S){if(y in this.operations){const T=this.operations[y];T.to.tileID.key!==f.tileID.key&&(T.queued=f)}else this.operations[y]={startTime:v,phase:0,duration:S,from:a,to:f,queued:null}}getMorphValuesForProxy(y){if(!(y in this.operations))return null;const a=this.operations[y];return{from:a.from,to:a.to,phase:a.phase}}update(y){for(const a in this.operations){const f=this.operations[a];for(f.phase=(y-f.startTime)/f.duration;f.phase>=1||!this._validOp(f);)if(!this._nextOp(f,y)){delete this.operations[a];break}}}_nextOp(y,a){return!!y.queued&&(y.from=y.to,y.to=y.queued,y.queued=null,y.phase=0,y.startTime=a,!0)}_validOp(y){return y.from.hasData()&&y.to.hasData()}},es={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function us(y){return 6*Math.pow(1.5,22-y)}function jo(y,a){const f=1<<y.z;return!a&&(y.x===0||y.x===f-1)||y.y===0||y.y===f-1}const Es=y=>({u_matrix:y});function Fc(y,a,f,v,S){if(S>0){const T=o.exported.now(),N=(T-y.timeAdded)/S,z=a?(T-a.timeAdded)/S:-1,G=f.getSource(),Q=v.coveringZoomLevel({tileSize:G.tileSize,roundZoom:G.roundZoom}),te=!a||Math.abs(a.tileID.overscaledZ-Q)>Math.abs(y.tileID.overscaledZ-Q),ge=te&&y.refreshedUponExpiration?1:o.clamp(te?N:1-z,0,1);return y.refreshedUponExpiration&&N>=1&&(y.refreshedUponExpiration=!1),a?{opacity:1,mix:1-ge}:{opacity:ge,mix:0}}return{opacity:1,mix:0}}class Za extends o.SourceCache{constructor(a){const f={type:"raster-dem",maxzoom:a.transform.maxZoom},v=new xe(ma(),null),S=Er("mock-dem",f,v,a.style);super("mock-dem",S,!1),S.setEventedParent(this),this._sourceLoaded=!0}_loadTile(a,f){a.state="loaded",f(null)}}class L extends o.SourceCache{constructor(a){const f=Er("proxy",{type:"geojson",maxzoom:a.transform.maxZoom},new xe(ma(),null),a.style);super("proxy",f,!1),f.setEventedParent(this),this.map=this.getSource().map=a,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(a,f,v){if(a.freezeTileCoverage)return;this.transform=a;const S=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((T,N)=>{if(T[N.key]="",!this._tiles[N.key]){const z=new o.Tile(N,this._source.tileSize*N.overscaleFactor(),a.tileZoom);z.state="loaded",this._tiles[N.key]=z}return T}),{});for(const T in this._tiles)T in S||(this.freeFBO(T),this._tiles[T].unloadVectorData(),delete this._tiles[T])}freeFBO(a){const f=this.proxyCachedFBO[a];if(f!==void 0){const v=Object.values(f);this.renderCachePool.push(...v),delete this.proxyCachedFBO[a]}}deallocRenderCache(){this.renderCache.forEach((a=>a.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class ae extends o.OverscaledTileID{constructor(a,f,v){super(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y),this.proxyTileKey=f,this.projMatrix=v}}class ve extends o.Elevation{constructor(a,f){super(),this.painter=a,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[v,S,T]=(function(G){const Q=new o.StructArrayLayout2i4,te=new o.StructArrayLayout3ui6,ge=131;Q.reserve(17161),te.reserve(33800);const Ae=o.EXTENT/128,Le=o.EXTENT+Ae/2,Xe=Le+Ae;for(let Ze=-Ae;Ze<Xe;Ze+=Ae)for(let _e=-Ae;_e<Xe;_e+=Ae){const $e=_e<0||_e>Le||Ze<0||Ze>Le?24575:0,it=o.clamp(Math.round(_e),0,o.EXTENT),st=o.clamp(Math.round(Ze),0,o.EXTENT);Q.emplaceBack(it+$e,st)}const Ue=(Ze,_e)=>{const $e=_e*ge+Ze;te.emplaceBack($e+1,$e,$e+ge),te.emplaceBack($e+ge,$e+ge+1,$e+1)};for(let Ze=1;Ze<129;Ze++)for(let _e=1;_e<129;_e++)Ue(_e,Ze);return[0,129].forEach((Ze=>{for(let _e=0;_e<130;_e++)Ue(_e,Ze),Ue(Ze,_e)})),[Q,te,32768]})(),N=a.context;this.gridBuffer=N.createVertexBuffer(v,o.posAttributes.members),this.gridIndexBuffer=N.createIndexBuffer(S),this.gridSegments=o.SegmentVector.simpleSegment(0,0,v.length,S.length),this.gridNoSkirtSegments=o.SegmentVector.simpleSegment(0,0,v.length,T),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new L(f.map),this.orthoMatrix=o.create(),o.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.EXTENT,0,o.EXTENT,0,1);const z=N.gl;this._overlapStencilMode=new o.StencilMode({func:z.GEQUAL,mask:255},0,255,z.KEEP,z.KEEP,z.REPLACE),this._previousZoom=a.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=f,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Za(f.map)}set style(a){a.on("data",this._onStyleDataEvent.bind(this)),a.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=a,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(a,f,v){if(a&&a.terrain){this._style!==a&&(this.style=a),this.enabled=!0;const S=a.terrain.properties;this.sourceCache=a.terrain.drapeRenderMode===0?this._mockSourceCache:a._getSourceCache(S.get("source")),this._exaggeration=S.get("exaggeration");const T=()=>{this.sourceCache.used&&o.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const N=this.getScaledDemTileSize();this.sourceCache.update(f,N,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,T(),this._initializing=!0),T(),f.updateElevation(!0,v),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(f),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(a){this._findCoveringTileCache[a]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const a=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||a.efficiency!==100&&o.warnOnce(`Terrain render cache efficiency is not optimal (${a.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${a.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(a){a.coord&&a.dataType==="source"?this._clearRenderCacheForTile(a.sourceCacheId,a.coord):a.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const a in this._style._sourceCaches)this._style._sourceCaches[a].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach((a=>a.fb.destroy())),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const a=2*this.proxySourceCache.getSource().tileSize;return[a,a]}set useVertexMorphing(a){this._useVertexMorphing=a}updateTileBinding(a){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const f=this.proxySourceCache,v=this.painter.transform;this._initializing&&(this._initializing=v._centerAltitude===0&&this.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(v.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const S=this.proxyCoords=f.getIds().map((G=>{const Q=f.getTileByID(G).tileID;return Q.projMatrix=v.calculateProjMatrix(Q.toUnwrapped()),Q}));(function(G,Q){const te=Q.transform.pointCoordinate(Q.transform.getCameraPoint()),ge=new o.Point(te.x,te.y);G.sort(((Ae,Le)=>{if(Le.overscaledZ-Ae.overscaledZ)return Le.overscaledZ-Ae.overscaledZ;const Xe=new o.Point(Ae.canonical.x+(1<<Ae.canonical.z)*Ae.wrap,Ae.canonical.y),Ue=new o.Point(Le.canonical.x+(1<<Le.canonical.z)*Le.wrap,Le.canonical.y),Ze=ge.mult(1<<Ae.canonical.z);return Ze.x-=.5,Ze.y-=.5,Ze.distSqr(Xe)-Ze.distSqr(Ue)}))})(S,this.painter),this._previousZoom=v.zoom;const T=this.proxyToSource||{};this.proxyToSource={},S.forEach((G=>{this.proxyToSource[G.key]={}})),this.terrainTileForTile={};const N=this._style._sourceCaches;for(const G in N){const Q=N[G];if(!Q.used||(Q!==this.sourceCache&&this.resetTileLookupCache(Q.id),this._setupProxiedCoordsForOrtho(Q,a[G],T),Q.usedForTerrain))continue;const te=a[G];Q.getSource().reparseOverscaled&&this._assignTerrainTiles(te)}this.proxiedCoords[f.id]=S.map((G=>new ae(G,G.key,this.orthoMatrix))),this._assignTerrainTiles(S),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(T),this.renderingToTexture=!1,this._updateTimestamp=o.exported.now();const z={};this._visibleDemTiles=[];for(const G of this.proxyCoords){const Q=this.terrainTileForTile[G.key];if(!Q)continue;const te=Q.tileID.key;te in z||(this._visibleDemTiles.push(Q),z[te]=te)}}_assignTerrainTiles(a){this._initializing||a.forEach((f=>{if(this.terrainTileForTile[f.key])return;const v=this._findTileCoveringTileID(f,this.sourceCache);v&&(this.terrainTileForTile[f.key]=v)}))}_prepareDEMTextures(){const a=this.painter.context,f=a.gl;for(const v in this.terrainTileForTile){const S=this.terrainTileForTile[v],T=S.dem;!T||S.demTexture&&!S.needsDEMTextureUpload||(a.activeTexture.set(f.TEXTURE1),gi(this.painter,S,T))}}_prepareDemTileUniforms(a,f,v,S){if(!f||f.demTexture==null)return!1;const T=a.tileID.canonical,N=Math.pow(2,f.tileID.canonical.z-T.z),z=S||"";return v[`u_dem_tl${z}`]=[T.x*N%1,T.y*N%1],v[`u_dem_scale${z}`]=N,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const a=this.painter.context,f=a.gl;if(!this._emptyDepthBufferTexture){const v=new o.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new o.Texture(a,v,f.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let a=0;const f=this._visibleDemTiles.reduce(((v,S)=>{if(!S.dem)return v;const T=S.dem.tree.minimums[0];return T>0&&a++,v+T}),0);return a?f/a:0}_updateEmptyDEMTexture(){const a=this.painter.context,f=a.gl;a.activeTexture.set(f.TEXTURE2);const v=this._getLoadedAreaMinimum(),S=new o.RGBAImage({width:1,height:1},new Uint8Array(o.DEMData.pack(v,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let T=this._emptyDEMTexture;return T?T.update(S,{premultiply:!1}):T=this._emptyDEMTexture=new o.Texture(a,S,f.RGBA,{premultiply:!1}),T}setupElevationDraw(a,f,v){const S=this.painter.context,T=S.gl,N=(z=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:o.DEMData.getUnpackVector(z),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var z;N.u_dem_size=this.sourceCache.getSource().tileSize,N.u_exaggeration=this.exaggeration();let G=null,Q=null,te=1;if(v&&v.morphing&&this._useVertexMorphing){const ge=v.morphing.srcDemTile,Ae=v.morphing.dstDemTile;te=v.morphing.phase,ge&&Ae&&(this._prepareDemTileUniforms(a,ge,N,"_prev")&&(Q=ge),this._prepareDemTileUniforms(a,Ae,N)&&(G=Ae))}if(Q&&G?(S.activeTexture.set(T.TEXTURE2),G.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE,T.NEAREST),S.activeTexture.set(T.TEXTURE4),Q.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE,T.NEAREST),N.u_dem_lerp=te):(G=this.terrainTileForTile[a.tileID.key],S.activeTexture.set(T.TEXTURE2),(this._prepareDemTileUniforms(a,G,N)?G.demTexture:this.emptyDEMTexture).bind(T.NEAREST,T.CLAMP_TO_EDGE)),S.activeTexture.set(T.TEXTURE3),v&&v.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),this._depthFBO&&(N.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),N.u_depth_size_inv=[1,1]),v&&v.useMeterToDem&&G){const ge=(1<<G.tileID.canonical.z)*o.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;N.u_meter_to_dem=ge}if(v&&v.labelPlaneMatrixInv&&(N.u_label_plane_matrix_inv=v.labelPlaneMatrixInv),f.setTerrainUniformValues(S,N),this.painter.transform.projection.name==="globe"){const ge=this.globeUniformValues(this.painter.transform,a.tileID.canonical,v&&v.useDenormalizedUpVectorScale);f.setGlobeUniformValues(S,ge)}}globeUniformValues(a,f,v){const S=a.projection;return{u_tile_tl_up:S.upVector(f,0,0),u_tile_tr_up:S.upVector(f,o.EXTENT,0),u_tile_br_up:S.upVector(f,o.EXTENT,o.EXTENT),u_tile_bl_up:S.upVector(f,0,o.EXTENT),u_tile_up_scale:v?o.globeMetersToEcef(1):S.upVectorScale(f,a.center.lat,a.worldSize).metersToTile}}renderToBackBuffer(a){const f=this.painter,v=this.painter.context;a.length!==0&&(v.bindFramebuffer.set(null),v.viewport.set([0,0,f.width,f.height]),f.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(S,T,N,z,G){if(S.transform.projection.name==="globe")(function(Q,te,ge,Ae,Le){const Xe=Q.context,Ue=Xe.gl;let Ze,_e;const $e=Q.options.showTerrainWireframe?2:0,it=Q.transform,st=o.globeUseCustomAntiAliasing(Q,Xe,it),bt=(Cn,Ut)=>{if(_e===Cn)return;const rn=[es[Cn],"PROJECTION_GLOBE_VIEW"];st&&rn.push("CUSTOM_ANTIALIASING"),Ut&&rn.push(es[$e]),Ze=Q.useProgram("globeRaster",null,rn),_e=Cn},wt=Q.colorModeForRenderPass(),vt=new o.DepthMode(Ue.LEQUAL,o.DepthMode.ReadWrite,Q.depthRangeFor3D);zo.update(Le);const kt=o.calculateGlobeMercatorMatrix(it),Tt=[o.mercatorXfromLng(it.center.lng),o.mercatorYfromLat(it.center.lat)],Vt=$e?[!1,!0]:[!1],vn=Q.globeSharedBuffers,Bt=[it.width*o.exported.devicePixelRatio,it.height*o.exported.devicePixelRatio],ln=Float32Array.from(it.globeMatrix),Wt={useDenormalizedUpVectorScale:!0};if(Vt.forEach((Cn=>{const Ut=Q.transform,rn=us(Ut.zoom)*te.exaggeration();_e=-1;const Tn=Cn?Ue.LINES:Ue.TRIANGLES;for(const cn of Ae){const Nn=ge.getTile(cn),hr=o.StencilMode.disabled,Dr=te.prevTerrainTileForTile[cn.key],rr=te.terrainTileForTile[cn.key];Mo(Dr,rr)&&zo.newMorphing(cn.key,Dr,rr,Le,250),Xe.activeTexture.set(Ue.TEXTURE0),Nn.texture.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE);const Jn=zo.getMorphValuesForProxy(cn.key),ni=Jn?1:0;Jn&&o.extend$1(Wt,{morphing:{srcDemTile:Jn.from,dstDemTile:Jn.to,phase:o.easeCubicInOut(Jn.phase)}});const mi=o.tileCornersToBounds(cn.canonical),xr=o.getLatitudinalLod(mi.getCenter().lat),Ii=o.getGridMatrix(cn.canonical,mi,xr,Ut.worldSize/Ut._pixelsPerMercatorPixel),Ci=o.globeNormalizeECEF(o.globeTileBounds(cn.canonical)),Ni=Qo(Ut.projMatrix,ln,kt,Ci,o.globeToMercatorTransition(Ut.zoom),Tt,Ut.frustumCorners.TL,Ut.frustumCorners.TR,Ut.frustumCorners.BR,Ut.frustumCorners.BL,Ut.globeCenterInViewSpace,Ut.globeRadius,Bt,rn,Ii);if(bt(ni,Cn),te.setupElevationDraw(Nn,Ze,Wt),Q.prepareDrawProgram(Xe,Ze,cn.toUnwrapped()),vn){const[fo,Rs,hs]=Cn?vn.getWirefameBuffers(Q.context,xr):vn.getGridBuffers(xr,rn!==0);Ze.draw(Xe,Tn,vt,hr,wt,o.CullFaceMode.backCCW,Ni,"globe_raster",fo,Rs,hs)}}})),vn){const Cn=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];st&&Cn.push("CUSTOM_ANTIALIASING"),Ze=Q.useProgram("globeRaster",null,Cn);for(const Ut of Ae){const{x:rn,y:Tn,z:cn}=Ut.canonical,Nn=Tn===0,hr=Tn===(1<<cn)-1,[Dr,rr,Jn,ni]=vn.getPoleBuffers(cn);if(ni&&(Nn||hr)){const mi=ge.getTile(Ut);Xe.activeTexture.set(Ue.TEXTURE0),mi.texture.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE);let xr=o.globePoleMatrixForTile(cn,rn,it);const Ii=o.globeNormalizeECEF(o.globeTileBounds(Ut.canonical)),Ci=(Ni,fo)=>Ni.draw(Xe,Ue.TRIANGLES,vt,o.StencilMode.disabled,wt,o.CullFaceMode.disabled,Qo(it.projMatrix,xr,xr,Ii,0,Tt,it.frustumCorners.TL,it.frustumCorners.TR,it.frustumCorners.BR,it.frustumCorners.BL,it.globeCenterInViewSpace,it.globeRadius,Bt,0),"globe_pole_raster",fo,Jn,ni);te.setupElevationDraw(mi,Ze,Wt),Q.prepareDrawProgram(Xe,Ze,Ut.toUnwrapped()),Nn&&Ci(Ze,Dr),hr&&(xr=o.scale(o.create(),xr,[1,-1,1]),Ci(Ze,rr))}}}})(S,T,N,z,G);else{const Q=S.context,te=Q.gl;let ge,Ae;const Le=S.options.showTerrainWireframe?2:0,Xe=(it,st)=>{if(Ae===it)return;const bt=[es[it]];st&&bt.push(es[Le]),ge=S.useProgram("terrainRaster",null,bt),Ae=it},Ue=S.colorModeForRenderPass(),Ze=new o.DepthMode(te.LEQUAL,o.DepthMode.ReadWrite,S.depthRangeFor3D);zo.update(G);const _e=S.transform,$e=us(_e.zoom)*T.exaggeration();(Le?[!1,!0]:[!1]).forEach((it=>{Ae=-1;const st=it?te.LINES:te.TRIANGLES,[bt,wt]=it?T.getWirefameBuffer():[T.gridIndexBuffer,T.gridSegments];for(const vt of z){const kt=N.getTile(vt),Tt=o.StencilMode.disabled,Vt=T.prevTerrainTileForTile[vt.key],vn=T.terrainTileForTile[vt.key];Mo(Vt,vn)&&zo.newMorphing(vt.key,Vt,vn,G,250),Q.activeTexture.set(te.TEXTURE0),kt.texture.bind(te.LINEAR,te.CLAMP_TO_EDGE,te.LINEAR_MIPMAP_NEAREST);const Bt=zo.getMorphValuesForProxy(vt.key),ln=Bt?1:0;let Wt;Bt&&(Wt={morphing:{srcDemTile:Bt.from,dstDemTile:Bt.to,phase:o.easeCubicInOut(Bt.phase)}});const Cn=wo(vt.projMatrix,jo(vt.canonical,_e.renderWorldCopies)?$e/10:$e);Xe(ln,it),T.setupElevationDraw(kt,ge,Wt),S.prepareDrawProgram(Q,ge,vt.toUnwrapped()),ge.draw(Q,st,Ze,Tt,Ue,o.CullFaceMode.backCCW,Cn,"terrain_raster",T.gridBuffer,bt,wt)}}))}})(f,this,this.proxySourceCache,a,this._updateTimestamp),this.renderingToTexture=!0,f.gpuTimingDeferredRenderEnd(),a.splice(0,a.length))}renderBatch(a){if(this._drapedRenderBatches.length===0)return a+1;this.renderingToTexture=!0;const f=this.painter,v=this.painter.context,S=this.proxySourceCache,T=this.proxiedCoords[S.id],N=this._drapedRenderBatches.shift(),z=[],G=f.style.order;let Q=0;for(const te of T){const ge=S.getTileByID(te.proxyTileKey),Ae=S.proxyCachedFBO[te.key]?S.proxyCachedFBO[te.key][a]:void 0,Le=Ae!==void 0?S.renderCache[Ae]:this.pool[Q++],Xe=Ae!==void 0;if(ge.texture=Le.tex,Xe&&!Le.dirty){z.push(ge.tileID);continue}let Ue;v.bindFramebuffer.set(Le.fb.framebuffer),this.renderedToTile=!1,Le.dirty&&(v.clear({color:o.Color.transparent,stencil:0}),Le.dirty=!1);for(let Ze=N.start;Ze<=N.end;++Ze){const _e=f.style._layers[G[Ze]];if(_e.isHidden(f.transform.zoom))continue;const $e=f.style._getLayerSourceCache(_e),it=$e?this.proxyToSource[te.key][$e.id]:[te];if(!it)continue;const st=it;v.viewport.set([0,0,Le.fb.width,Le.fb.height]),Ue!==($e?$e.id:null)&&(this._setupStencil(Le,it,_e,$e),Ue=$e?$e.id:null),f.renderLayer(f,$e,_e,st)}this.renderedToTile?(Le.dirty=!0,z.push(ge.tileID)):Xe||--Q,Q===5&&(Q=0,this.renderToBackBuffer(z))}return this.renderToBackBuffer(z),this.renderingToTexture=!1,v.bindFramebuffer.set(null),v.viewport.set([0,0,f.width,f.height]),N.end+1}postRender(){}renderCacheEfficiency(a){const f=a.order.length;if(f===0)return{efficiency:100};let v,S=0,T=0,N=!1;for(let z=0;z<f;++z){const G=a._layers[a.order[z]];this._style.isLayerDraped(G)?(N&&++S,++T):N||(N=!0,v=G.id)}return T===0?{efficiency:100}:{efficiency:100*(1-S/T),firstUndrapedLayer:v}}getMinElevationBelowMSL(){let a=0;return this._visibleDemTiles.filter((f=>f.dem)).forEach((f=>{a=Math.min(a,f.dem.tree.minimums[0])})),a===0?a:(a-30)*this._exaggeration}raycast(a,f,v){if(!this._visibleDemTiles)return null;const S=this._visibleDemTiles.filter((T=>T.dem)).map((T=>{const N=T.tileID,z=1<<N.overscaledZ,{x:G,y:Q}=N.canonical,te=G/z,ge=(G+1)/z,Ae=Q/z,Le=(Q+1)/z;return{minx:te,miny:Ae,maxx:ge,maxy:Le,t:T.dem.tree.raycastRoot(te,Ae,ge,Le,a,f,v),tile:T}}));S.sort(((T,N)=>(T.t!==null?T.t:Number.MAX_VALUE)-(N.t!==null?N.t:Number.MAX_VALUE)));for(const T of S){if(T.t==null)return null;const N=T.tile.dem.tree.raycast(T.minx,T.miny,T.maxx,T.maxy,a,f,v);if(N!=null)return N}return null}_createFBO(){const a=this.painter.context,f=a.gl,v=this.drapeBufferSize;a.activeTexture.set(f.TEXTURE0);const S=new o.Texture(a,{width:v[0],height:v[1],data:null},f.RGBA);S.bind(f.LINEAR,f.CLAMP_TO_EDGE);const T=a.createFramebuffer(v[0],v[1],!1);return T.colorAttachment.set(S.texture),T.depthAttachment=new At(a,T.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=a.createRenderbuffer(a.gl.DEPTH_STENCIL,v[0],v[1]),this._stencilRef=0,T.depthAttachment.set(this._sharedDepthStencil),a.clear({stencil:0})):T.depthAttachment.set(this._sharedDepthStencil),a.extTextureFilterAnisotropic&&!a.extTextureFilterAnisotropicForceOff&&f.texParameterf(f.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax),{fb:T,tex:S,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const a in this._style._sourceCaches)if(this._style._sourceCaches[a].hasTransition())return!0;return this._style.order.some((a=>{const f=this._style._layers[a],v=f.isHidden(this.painter.transform.zoom);return f.type==="custom"?!v&&f.shouldRedrape():!v&&f.hasTransition()}))}_clearLineLayersFromRenderCache(){let a=!1;for(const v of this._style._getSources())if(v instanceof Un){a=!0;break}if(!a)return;const f={};for(let v=0;v<this._style.order.length;++v){const S=this._style._layers[this._style.order[v]],T=this._style._getLayerSourceCache(S);if(T&&!f[T.id]&&!S.isHidden(this.painter.transform.zoom)&&S.type==="line"&&S.widthExpression()instanceof o.ZoomDependentExpression){f[T.id]=!0;for(const N of this.proxyCoords){const z=this.proxyToSource[N.key][T.id];if(z)for(const G of z)this._clearRenderCacheForTile(T.id,G)}}}}_clearRasterLayersFromRenderCache(){let a=!1;for(const v in this._style._sourceCaches)if(this._style._sourceCaches[v]._source instanceof In){a=!0;break}if(!a)return;const f={};for(let v=0;v<this._style.order.length;++v){const S=this._style._layers[this._style.order[v]],T=this._style._getLayerSourceCache(S);if(!T||f[T.id]||S.isHidden(this.painter.transform.zoom)||S.type!=="raster")continue;const N=S.paint.get("raster-fade-duration");for(const z of this.proxyCoords){const G=this.proxyToSource[z.key][T.id];if(G)for(const Q of G){const te=Fc(T.getTile(Q),T.findLoadedParent(Q,0),T,this.painter.transform,N);(te.opacity!==1||te.mix!==0)&&this._clearRenderCacheForTile(T.id,Q)}}}}_setupDrapedRenderBatches(){const a=this._style.order,f=a.length;if(f===0)return;const v=[];let S,T=0,N=this._style._layers[a[T]];for(;!this._style.isLayerDraped(N)&&N.isHidden(this.painter.transform.zoom)&&++T<f;)N=this._style._layers[a[T]];for(;T<f;++T){const z=this._style._layers[a[T]];z.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(z)?S===void 0&&(S=T):S!==void 0&&(v.push({start:S,end:T-1}),S=void 0))}S!==void 0&&v.push({start:S,end:T-1}),this._drapedRenderBatches=v}_setupRenderCache(a){const f=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,f.renderCache.length>f.renderCachePool.length){const N=Object.values(f.proxyCachedFBO);f.proxyCachedFBO={};for(let z=0;z<N.length;++z){const G=Object.values(N[z]);f.renderCachePool.push(...G)}}return}this._clearRasterLayersFromRenderCache();const v=this.proxyCoords,S=this._tilesDirty;for(let N=v.length-1;N>=0;N--){const z=v[N];if(f.getTileByID(z.key),f.proxyCachedFBO[z.key]!==void 0){const G=a[z.key],Q=this.proxyToSource[z.key];let te=0;for(const ge in Q){const Ae=Q[ge],Le=G[ge];if(!Le||Le.length!==Ae.length||Ae.some(((Xe,Ue)=>Xe!==Le[Ue]||S[ge]&&S[ge].hasOwnProperty(Xe.key)))){te=-1;break}++te}for(const ge in f.proxyCachedFBO[z.key])f.renderCache[f.proxyCachedFBO[z.key][ge]].dirty=te<0||te!==Object.values(G).length}}const T=[...this._drapedRenderBatches];T.sort(((N,z)=>z.end-z.start-(N.end-N.start)));for(const N of T)for(const z of v){if(f.proxyCachedFBO[z.key])continue;let G=f.renderCachePool.pop();G===void 0&&f.renderCache.length<50&&(G=f.renderCache.length,f.renderCache.push(this._createFBO())),G!==void 0&&(f.proxyCachedFBO[z.key]={},f.proxyCachedFBO[z.key][N.start]=G,f.renderCache[G].dirty=!0)}this._tilesDirty={}}_setupStencil(a,f,v,S){if(!S||!this._sourceTilesOverlap[S.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const T=this.painter.context,N=T.gl;if(f.length<=1)return void(this._overlapStencilType=!1);let z;if(v.isTileClipped())z=f.length,this._overlapStencilMode.test={func:N.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(f[0].overscaledZ>f[f.length-1].overscaledZ))return void(this._overlapStencilType=!1);z=1,this._overlapStencilMode.test={func:N.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+z>255&&(T.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=z,this._overlapStencilMode.ref=this._stencilRef,v.isTileClipped()&&this._renderTileClippingMasks(f,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(a){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[a.key]),this._overlapStencilMode):o.StencilMode.disabled}_renderTileClippingMasks(a,f){const v=this.painter,S=this.painter.context,T=S.gl;v._tileClippingMaskIDs={},S.setColorMode(o.ColorMode.disabled),S.setDepthMode(o.DepthMode.disabled);const N=v.useProgram("clippingMask");for(const z of a){const G=v._tileClippingMaskIDs[z.key]=--f;N.draw(S,T.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:T.ALWAYS,mask:0},G,255,T.KEEP,T.KEEP,T.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,Es(z.projMatrix),"$clipping",v.tileExtentBuffer,v.quadTriangleIndexBuffer,v.tileExtentSegments)}}pointCoordinate(a){const f=this.painter.transform;if(a.x<0||a.x>f.width||a.y<0||a.y>f.height)return null;const v=[a.x,a.y,1,1];o.transformMat4$1(v,v,f.pixelMatrixInverse),o.scale$1(v,v,1/v[3]),v[0]/=f.worldSize,v[1]/=f.worldSize;const S=f._camera.position,T=o.mercatorZfromAltitude(1,f.center.lat),N=[S[0],S[1],S[2]/T,0],z=o.subtract([],v.slice(0,3),N);o.normalize(z,z);const G=this.raycast(N,z,this._exaggeration);return G!==null&&G?(o.scaleAndAdd(N,N,z,G),N[3]=N[2],N[2]*=T,N):null}drawDepth(){const a=this.painter,f=a.context,v=this.proxySourceCache,S=Math.ceil(a.width),T=Math.ceil(a.height);if(!this._depthFBO||this._depthFBO.width===S&&this._depthFBO.height===T||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const N=f.gl,z=f.createFramebuffer(S,T,!0);f.activeTexture.set(N.TEXTURE0);const G=new o.Texture(f,{width:S,height:T,data:null},N.RGBA);G.bind(N.NEAREST,N.CLAMP_TO_EDGE),z.colorAttachment.set(G.texture);const Q=f.createRenderbuffer(f.gl.DEPTH_COMPONENT16,S,T);z.depthAttachment.set(Q),this._depthFBO=z,this._depthTexture=G}f.bindFramebuffer.set(this._depthFBO.framebuffer),f.viewport.set([0,0,S,T]),(function(N,z,G,Q){if(N.transform.projection.name==="globe")return;const te=N.context,ge=te.gl;te.clear({depth:1});const Ae=N.useProgram("terrainDepth"),Le=new o.DepthMode(ge.LESS,o.DepthMode.ReadWrite,N.depthRangeFor3D);for(const Xe of Q){const Ue=G.getTile(Xe),Ze=wo(Xe.projMatrix,0);z.setupElevationDraw(Ue,Ae),Ae.draw(te,ge.TRIANGLES,Le,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.backCCW,Ze,"terrain_depth",z.gridBuffer,z.gridIndexBuffer,z.gridNoSkirtSegments)}})(a,this,v,this.proxyCoords)}_setupProxiedCoordsForOrtho(a,f,v){if(a.getSource()instanceof Lr)return this._setupProxiedCoordsForImageSource(a,f,v);this._findCoveringTileCache[a.id]=this._findCoveringTileCache[a.id]||{};const S=this.proxiedCoords[a.id]=[],T=this.proxyCoords;for(let z=0;z<T.length;z++){const G=T[z],Q=this._findTileCoveringTileID(G,a);if(Q){const te=this._createProxiedId(G,Q,v[G.key]&&v[G.key][a.id]);S.push(te),this.proxyToSource[G.key][a.id]=[te]}}let N=!1;for(let z=0;z<f.length;z++){const G=a.getTile(f[z]);if(!G||!G.hasData())continue;const Q=this._findTileCoveringTileID(G.tileID,this.proxySourceCache);if(Q&&Q.tileID.canonical.z!==G.tileID.canonical.z){const te=this.proxyToSource[Q.tileID.key][a.id],ge=this._createProxiedId(Q.tileID,G,v[Q.tileID.key]&&v[Q.tileID.key][a.id]);te?te.splice(te.length-1,0,ge):this.proxyToSource[Q.tileID.key][a.id]=[ge],S.push(ge),N=!0}}this._sourceTilesOverlap[a.id]=N}_setupProxiedCoordsForImageSource(a,f,v){if(!a.getSource().loaded())return;const S=this.proxiedCoords[a.id]=[],T=this.proxyCoords,N=a.getSource(),z=new o.Point(N.tileID.x,N.tileID.y)._div(1<<N.tileID.z),G=N.coordinates.map(o.MercatorCoordinate.fromLngLat).reduce(((te,ge)=>(te.min.x=Math.min(te.min.x,ge.x-z.x),te.min.y=Math.min(te.min.y,ge.y-z.y),te.max.x=Math.max(te.max.x,ge.x-z.x),te.max.y=Math.max(te.max.y,ge.y-z.y),te)),{min:new o.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),Q=(te,ge)=>{const Ae=te.wrap+te.canonical.x/(1<<te.canonical.z),Le=te.canonical.y/(1<<te.canonical.z),Xe=o.EXTENT/(1<<te.canonical.z),Ue=ge.wrap+ge.canonical.x/(1<<ge.canonical.z),Ze=ge.canonical.y/(1<<ge.canonical.z);return Ae+Xe<Ue+G.min.x||Ae>Ue+G.max.x||Le+Xe<Ze+G.min.y||Le>Ze+G.max.y};for(let te=0;te<T.length;te++){const ge=T[te];for(let Ae=0;Ae<f.length;Ae++){const Le=a.getTile(f[Ae]);if(!Le||!Le.hasData()||Q(ge,Le.tileID))continue;const Xe=this._createProxiedId(ge,Le,v[ge.key]&&v[ge.key][a.id]),Ue=this.proxyToSource[ge.key][a.id];Ue?Ue.push(Xe):this.proxyToSource[ge.key][a.id]=[Xe],S.push(Xe)}}}_createProxiedId(a,f,v){let S=this.orthoMatrix;if(v){const T=v.find((N=>N.key===f.tileID.key));if(T)return T}if(f.tileID.key!==a.key){const T=a.canonical.z-f.tileID.canonical.z;let N,z,G;S=o.create();const Q=f.tileID.wrap-a.wrap<<a.overscaledZ;T>0?(N=o.EXTENT>>T,z=N*((f.tileID.canonical.x<<T)-a.canonical.x+Q),G=N*((f.tileID.canonical.y<<T)-a.canonical.y)):(N=o.EXTENT<<-T,z=o.EXTENT*(f.tileID.canonical.x-(a.canonical.x+Q<<-T)),G=o.EXTENT*(f.tileID.canonical.y-(a.canonical.y<<-T))),o.ortho(S,0,N,0,N,0,1),o.translate(S,S,[z,G,0])}return new ae(f.tileID,a.key,S)}_findTileCoveringTileID(a,f){let v=f.getTile(a);if(v&&v.hasData())return v;const S=this._findCoveringTileCache[f.id],T=S[a.key];if(v=T?f.getTileByID(T):null,v&&v.hasData()||T===null)return v;let N=v?v.tileID:a,z=N.overscaledZ;const G=f.getSource().minzoom,Q=[];if(!T){const ge=f.getSource().maxzoom;if(a.canonical.z>=ge){const Ae=a.canonical.z-ge;f.getSource().reparseOverscaled?(z=Math.max(a.canonical.z+2,f.transform.tileZoom),N=new o.OverscaledTileID(z,a.wrap,ge,a.canonical.x>>Ae,a.canonical.y>>Ae)):Ae!==0&&(z=ge,N=new o.OverscaledTileID(z,a.wrap,ge,a.canonical.x>>Ae,a.canonical.y>>Ae))}N.key!==a.key&&(Q.push(N.key),v=f.getTile(N))}const te=ge=>{Q.forEach((Ae=>{S[Ae]=ge})),Q.length=0};for(z-=1;z>=G&&(!v||!v.hasData());z--){v&&te(v.tileID.key);const ge=N.calculateScaledKey(z);if(v=f.getTileByID(ge),v&&v.hasData())break;const Ae=S[ge];if(Ae===null)break;Ae===void 0?Q.push(ge):v=f.getTileByID(Ae)}return te(v?v.tileID.key:null),v&&v.hasData()?v:null}findDEMTileFor(a){return this.enabled?this._findTileCoveringTileID(a,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(a,f){let v=this._tilesDirty[a];v||(v=this._tilesDirty[a]={}),v[f.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const a=(function(f){let v=0;const S=new o.StructArrayLayout2ui4,T=131;for(let N=1;N<129;N++){for(let z=1;z<129;z++)v=N*T+z,S.emplaceBack(v,v+1),S.emplaceBack(v,v+T),S.emplaceBack(v+1,v+T),N===128&&S.emplaceBack(v+T,v+T+1);S.emplaceBack(v+1,v+1+T)}return S})();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(a),this.wireframeSegments=o.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,a.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class He{static cacheKey(a,f,v,S){let T=`${f}${S?S.cacheKey:""}`;for(const N of v)a.usedDefines.includes(N)&&(T+=`/${N}`);return T}constructor(a,f,v,S,T,N){const z=a.gl;this.program=z.createProgram();const G=(function(_e){const $e=[];for(let it=0;it<_e.length;it++){if(_e[it]===null)continue;const st=_e[it].split(" ");$e.push(st.pop())}return $e})(v.staticAttributes),Q=S?S.getBinderAttributes():[],te=G.concat(Q);let ge=S?S.defines():[];ge=ge.concat(N.map((_e=>`#define ${_e}`)));const Ae=a.isWebGL2?`#version 300 es
`:"",Le=Ae+ge.concat(a.extStandardDerivatives&&Ae.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(mt):mt,mt,Ce,W.fragmentSource,Hs.fragmentSource,v.fragmentSource).join(`
`),Xe=Ae+ge.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Ce,W.vertexSource,Hs.vertexSource,Gs.vertexSource,v.vertexSource).join(`
`),Ue=z.createShader(z.FRAGMENT_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);z.shaderSource(Ue,Le),z.compileShader(Ue),z.attachShader(this.program,Ue);const Ze=z.createShader(z.VERTEX_SHADER);if(z.isContextLost())this.failedToCreate=!0;else{z.shaderSource(Ze,Xe),z.compileShader(Ze),z.attachShader(this.program,Ze),this.attributes={},this.numAttributes=te.length;for(let _e=0;_e<this.numAttributes;_e++)te[_e]&&(z.bindAttribLocation(this.program,_e,te[_e]),this.attributes[te[_e]]=_e);z.linkProgram(this.program),z.deleteShader(Ze),z.deleteShader(Ue),this.fixedUniforms=T(a),this.binderUniforms=S?S.getUniforms(a):[],N.includes("TERRAIN")&&(this.terrainUniforms=(_e=>({u_dem:new o.Uniform1i(_e),u_dem_prev:new o.Uniform1i(_e),u_dem_unpack:new o.Uniform4f(_e),u_dem_tl:new o.Uniform2f(_e),u_dem_scale:new o.Uniform1f(_e),u_dem_tl_prev:new o.Uniform2f(_e),u_dem_scale_prev:new o.Uniform1f(_e),u_dem_size:new o.Uniform1f(_e),u_dem_lerp:new o.Uniform1f(_e),u_exaggeration:new o.Uniform1f(_e),u_depth:new o.Uniform1i(_e),u_depth_size_inv:new o.Uniform2f(_e),u_meter_to_dem:new o.Uniform1f(_e),u_label_plane_matrix_inv:new o.UniformMatrix4f(_e)}))(a)),N.includes("GLOBE")&&(this.globeUniforms=(_e=>({u_tile_tl_up:new o.Uniform3f(_e),u_tile_tr_up:new o.Uniform3f(_e),u_tile_br_up:new o.Uniform3f(_e),u_tile_bl_up:new o.Uniform3f(_e),u_tile_up_scale:new o.Uniform1f(_e)}))(a)),N.includes("FOG")&&(this.fogUniforms=(_e=>({u_fog_matrix:new o.UniformMatrix4f(_e),u_fog_range:new o.Uniform2f(_e),u_fog_color:new o.Uniform4f(_e),u_fog_horizon_blend:new o.Uniform1f(_e),u_fog_temporal_offset:new o.Uniform1f(_e),u_frustum_tl:new o.Uniform3f(_e),u_frustum_tr:new o.Uniform3f(_e),u_frustum_br:new o.Uniform3f(_e),u_frustum_bl:new o.Uniform3f(_e),u_globe_pos:new o.Uniform3f(_e),u_globe_radius:new o.Uniform1f(_e),u_globe_transition:new o.Uniform1f(_e),u_is_globe:new o.Uniform1i(_e),u_viewport:new o.Uniform2f(_e)}))(a))}}setTerrainUniformValues(a,f){if(!this.terrainUniforms)return;const v=this.terrainUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const S in f)v[S]&&v[S].set(this.program,S,f[S])}}setGlobeUniformValues(a,f){if(!this.globeUniforms)return;const v=this.globeUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const S in f)v[S]&&v[S].set(this.program,S,f[S])}}setFogUniformValues(a,f){if(!this.fogUniforms)return;const v=this.fogUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const S in f)v[S].set(this.program,S,f[S])}}draw(a,f,v,S,T,N,z,G,Q,te,ge,Ae,Le,Xe,Ue){const Ze=a.gl;if(this.failedToCreate)return;a.program.set(this.program),a.setDepthMode(v),a.setStencilMode(S),a.setColorMode(T),a.setCullFace(N);for(const $e of Object.keys(this.fixedUniforms))this.fixedUniforms[$e].set(this.program,$e,z[$e]);Xe&&Xe.setUniforms(this.program,a,this.binderUniforms,Ae,{zoom:Le});const _e={[Ze.LINES]:2,[Ze.TRIANGLES]:3,[Ze.LINE_STRIP]:1}[f];for(const $e of ge.get()){const it=$e.vaos||($e.vaos={});(it[G]||(it[G]=new zn)).bind(a,this,Q,Xe?Xe.getPaintVertexBuffers():[],te,$e.vertexOffset,Ue||[]),Ze.drawElements(f,$e.primitiveLength*_e,Ze.UNSIGNED_SHORT,$e.primitiveOffset*_e*2)}}}function Kt(y,a){const f=Math.pow(2,a.tileID.overscaledZ),v=a.tileSize*Math.pow(2,y.transform.tileZoom)/f,S=v*(a.tileID.canonical.x+a.tileID.wrap*f),T=v*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_tile_units_to_pixels:1/le(a,1,y.transform.tileZoom),u_pixel_coord_upper:[S>>16,T>>16],u_pixel_coord_lower:[65535&S,65535&T]}}const pn=o.create(),sr=(y,a,f,v,S,T,N,z,G,Q,te)=>{const ge=a.style.light,Ae=ge.properties.get("position"),Le=[Ae.x,Ae.y,Ae.z],Xe=o.create$1();ge.properties.get("anchor")==="viewport"&&(o.fromRotation(Xe,-a.transform.angle),o.transformMat3(Le,Le,Xe));const Ue=ge.properties.get("color"),Ze=a.transform,_e={u_matrix:y,u_lightpos:Le,u_lightintensity:ge.properties.get("intensity"),u_lightcolor:[Ue.r,Ue.g,Ue.b],u_vertical_gradient:+f,u_opacity:v,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:pn,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:S,u_edge_radius:T};return Ze.projection.name==="globe"&&(_e.u_tile_id=[N.canonical.x,N.canonical.y,1<<N.canonical.z],_e.u_zoom_transition=G,_e.u_inv_rot_matrix=te,_e.u_merc_center=Q,_e.u_up_dir=Ze.projection.upVector(new o.CanonicalTileID(0,0,0),Q[0]*o.EXTENT,Q[1]*o.EXTENT),_e.u_height_lift=z),_e},ho=(y,a,f,v,S,T,N,z,G,Q,te,ge)=>{const Ae=sr(y,a,f,v,S,T,N,G,Q,te,ge),Le={u_height_factor:-Math.pow(2,N.overscaledZ)/z.tileSize/8};return o.extend(Ae,Kt(a,z),Le)},Fo=y=>({u_matrix:y}),Wi=(y,a,f)=>o.extend(Fo(y),Kt(a,f)),Oi=(y,a)=>({u_matrix:y,u_world:a}),No=(y,a,f,v)=>o.extend(Wi(y,a,f),{u_world:v}),sa=o.create(),Oo=(y,a,f,v,S,T)=>{const N=y.transform,z=N.projection.name==="globe";let G;if(T.paint.get("circle-pitch-alignment")==="map")if(z){const te=o.globePixelsToTileUnits(N.zoom,a.canonical)*N._pixelsPerMercatorPixel;G=Float32Array.from([te,0,0,te])}else G=N.calculatePixelsToTileUnitsMatrix(f);else G=new Float32Array([N.pixelsToGLUnits[0],0,0,N.pixelsToGLUnits[1]]);const Q={u_camera_to_center_distance:N.cameraToCenterDistance,u_matrix:y.translatePosMatrix(a.projMatrix,f,T.paint.get("circle-translate"),T.paint.get("circle-translate-anchor")),u_device_pixel_ratio:o.exported.devicePixelRatio,u_extrude_scale:G,u_inv_rot_matrix:sa,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(z){Q.u_inv_rot_matrix=v,Q.u_merc_center=S,Q.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],Q.u_zoom_transition=o.globeToMercatorTransition(N.zoom);const te=S[0]*o.EXTENT,ge=S[1]*o.EXTENT;Q.u_up_dir=N.projection.upVector(new o.CanonicalTileID(0,0,0),te,ge)}return Q},$i=y=>{const a=[];return y.paint.get("circle-pitch-alignment")==="map"&&a.push("PITCH_WITH_MAP"),y.paint.get("circle-pitch-scale")==="map"&&a.push("SCALE_WITH_MAP"),a},jl=(y,a,f,v)=>{const S=o.EXTENT/f.tileSize;return{u_matrix:y,u_camera_to_center_distance:a.getCameraToCenterDistance(v),u_extrude_scale:[a.pixelsToGLUnits[0]/S,a.pixelsToGLUnits[1]/S]}},aa=(y,a,f=1)=>({u_matrix:y,u_color:a,u_overlay:0,u_overlay_scale:f}),Ru=o.create(),dl=(y,a,f,v,S,T,N)=>{const z=y.transform,G=z.projection.name==="globe",Q=G?o.globePixelsToTileUnits(z.zoom,a.canonical)*z._pixelsPerMercatorPixel:le(f,1,T),te={u_matrix:a.projMatrix,u_extrude_scale:Q,u_intensity:N,u_inv_rot_matrix:Ru,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(G){te.u_inv_rot_matrix=v,te.u_merc_center=S,te.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],te.u_zoom_transition=o.globeToMercatorTransition(z.zoom);const ge=S[0]*o.EXTENT,Ae=S[1]*o.EXTENT;te.u_up_dir=z.projection.upVector(new o.CanonicalTileID(0,0,0),ge,Ae)}return te},xc=(y,a,f,v,S,T,N)=>{const z=y.transform,G=z.calculatePixelsToTileUnitsMatrix(a);return{u_matrix:gu(y,a,f,v),u_pixels_to_tile_units:G,u_device_pixel_ratio:T,u_units_to_pixels:[1/z.pixelsToGLUnits[0],1/z.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:S,u_texsize:ts(f)?a.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:ya(a,y.transform),u_alpha_discard_threshold:0,u_trim_offset:N}},ks=(y,a,f,v,S)=>{const T=y.transform;return{u_matrix:gu(y,a,f,v),u_texsize:a.imageAtlasTexture.size,u_pixels_to_tile_units:T.calculatePixelsToTileUnitsMatrix(a),u_device_pixel_ratio:S,u_image:0,u_tile_units_to_pixels:ya(a,T),u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function ya(y,a){return 1/le(y,1,a.tileZoom)}function gu(y,a,f,v){return y.translatePosMatrix(v||a.tileID.projMatrix,a,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}function ts(y){const a=y.paint.get("line-dasharray").value;return a.value||a.kind!=="constant"}const Ws=(y,a,f,v,S,T)=>{return{u_matrix:y,u_tl_parent:a,u_scale_parent:f,u_fade_t:v.mix,u_opacity:v.opacity*S.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:S.paint.get("raster-brightness-min"),u_brightness_high:S.paint.get("raster-brightness-max"),u_saturation_factor:(z=S.paint.get("raster-saturation"),z>0?1-1/(1.001-z):-z),u_contrast_factor:(N=S.paint.get("raster-contrast"),N>0?1/(1-N):1+N),u_spin_weights:Fa(S.paint.get("raster-hue-rotate")),u_perspective_transform:T};var N,z};function Fa(y){y*=Math.PI/180;const a=Math.sin(y),f=Math.cos(y);return[(2*f+1)/3,(-Math.sqrt(3)*a-f+1)/3,(Math.sqrt(3)*a-f+1)/3]}const Ul=o.create(),vs=(y,a,f,v,S,T,N,z,G,Q,te,ge,Ae,Le,Xe,Ue)=>{const Ze=S.transform,_e={u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:Ze.cameraToCenterDistance,u_rotate_symbol:+f,u_aspect_ratio:Ze.width/Ze.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_matrix:T,u_label_plane_matrix:N,u_coord_matrix:z,u_is_text:+G,u_pitch_with_map:+v,u_texsize:Q,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ul,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Ul,u_up_vector:[0,-1,0]};return Ue.name==="globe"&&(_e.u_tile_id=[te.canonical.x,te.canonical.y,1<<te.canonical.z],_e.u_zoom_transition=ge,_e.u_inv_rot_matrix=Le,_e.u_merc_center=Ae,_e.u_camera_forward=Ze._camera.forward(),_e.u_ecef_origin=o.globeECEFOrigin(Ze.globeMatrix,te.toUnwrapped()),_e.u_tile_matrix=Float32Array.from(Ze.globeMatrix),_e.u_up_vector=Xe),_e},Uo=(y,a,f,v,S,T,N,z,G,Q,te,ge,Ae,Le,Xe,Ue,Ze)=>o.extend(vs(y,a,f,v,S,T,N,z,G,Q,ge,Ae,Le,Xe,Ue,Ze),{u_gamma_scale:v?S.transform.cameraToCenterDistance*Math.cos(S.terrain?0:S.transform._pitch):1,u_device_pixel_ratio:o.exported.devicePixelRatio,u_is_halo:1}),Aa=(y,a,f,v,S,T,N,z,G,Q,te,ge,Ae,Le,Xe,Ue)=>o.extend(Uo(y,a,f,v,S,T,N,z,!0,G,!0,te,ge,Ae,Le,Xe,Ue),{u_texsize_icon:Q,u_texture_icon:1}),Ks=(y,a,f)=>({u_matrix:y,u_opacity:a,u_color:f}),yu=(y,a,f,v,S)=>o.extend((function(T,N,z){const G=N.imageManager.getPattern(T.toString()),{width:Q,height:te}=N.imageManager.getPixelSize(),ge=Math.pow(2,z.tileID.overscaledZ),Ae=z.tileSize*Math.pow(2,N.transform.tileZoom)/ge,Le=Ae*(z.tileID.canonical.x+z.tileID.wrap*ge),Xe=Ae*z.tileID.canonical.y;return{u_image:0,u_pattern_tl:G.tl,u_pattern_br:G.br,u_texsize:[Q,te],u_pattern_size:G.displaySize,u_tile_units_to_pixels:1/le(z,1,N.transform.tileZoom),u_pixel_coord_upper:[Le>>16,Xe>>16],u_pixel_coord_lower:[65535&Le,65535&Xe]}})(v,f,S),{u_matrix:y,u_opacity:a}),bc={fillExtrusion:y=>({u_matrix:new o.UniformMatrix4f(y),u_lightpos:new o.Uniform3f(y),u_lightintensity:new o.Uniform1f(y),u_lightcolor:new o.Uniform3f(y),u_vertical_gradient:new o.Uniform1f(y),u_opacity:new o.Uniform1f(y),u_edge_radius:new o.Uniform1f(y),u_ao:new o.Uniform2f(y),u_tile_id:new o.Uniform3f(y),u_zoom_transition:new o.Uniform1f(y),u_inv_rot_matrix:new o.UniformMatrix4f(y),u_merc_center:new o.Uniform2f(y),u_up_dir:new o.Uniform3f(y),u_height_lift:new o.Uniform1f(y)}),fillExtrusionPattern:y=>({u_matrix:new o.UniformMatrix4f(y),u_lightpos:new o.Uniform3f(y),u_lightintensity:new o.Uniform1f(y),u_lightcolor:new o.Uniform3f(y),u_vertical_gradient:new o.Uniform1f(y),u_height_factor:new o.Uniform1f(y),u_edge_radius:new o.Uniform1f(y),u_ao:new o.Uniform2f(y),u_tile_id:new o.Uniform3f(y),u_zoom_transition:new o.Uniform1f(y),u_inv_rot_matrix:new o.UniformMatrix4f(y),u_merc_center:new o.Uniform2f(y),u_up_dir:new o.Uniform3f(y),u_height_lift:new o.Uniform1f(y),u_image:new o.Uniform1i(y),u_texsize:new o.Uniform2f(y),u_pixel_coord_upper:new o.Uniform2f(y),u_pixel_coord_lower:new o.Uniform2f(y),u_tile_units_to_pixels:new o.Uniform1f(y),u_opacity:new o.Uniform1f(y)}),fill:y=>({u_matrix:new o.UniformMatrix4f(y)}),fillPattern:y=>({u_matrix:new o.UniformMatrix4f(y),u_image:new o.Uniform1i(y),u_texsize:new o.Uniform2f(y),u_pixel_coord_upper:new o.Uniform2f(y),u_pixel_coord_lower:new o.Uniform2f(y),u_tile_units_to_pixels:new o.Uniform1f(y)}),fillOutline:y=>({u_matrix:new o.UniformMatrix4f(y),u_world:new o.Uniform2f(y)}),fillOutlinePattern:y=>({u_matrix:new o.UniformMatrix4f(y),u_world:new o.Uniform2f(y),u_image:new o.Uniform1i(y),u_texsize:new o.Uniform2f(y),u_pixel_coord_upper:new o.Uniform2f(y),u_pixel_coord_lower:new o.Uniform2f(y),u_tile_units_to_pixels:new o.Uniform1f(y)}),circle:y=>({u_camera_to_center_distance:new o.Uniform1f(y),u_extrude_scale:new o.UniformMatrix2f(y),u_device_pixel_ratio:new o.Uniform1f(y),u_matrix:new o.UniformMatrix4f(y),u_inv_rot_matrix:new o.UniformMatrix4f(y),u_merc_center:new o.Uniform2f(y),u_tile_id:new o.Uniform3f(y),u_zoom_transition:new o.Uniform1f(y),u_up_dir:new o.Uniform3f(y)}),collisionBox:y=>({u_matrix:new o.UniformMatrix4f(y),u_camera_to_center_distance:new o.Uniform1f(y),u_extrude_scale:new o.Uniform2f(y)}),collisionCircle:y=>({u_matrix:new o.UniformMatrix4f(y),u_inv_matrix:new o.UniformMatrix4f(y),u_camera_to_center_distance:new o.Uniform1f(y),u_viewport_size:new o.Uniform2f(y)}),debug:y=>({u_color:new o.UniformColor(y),u_matrix:new o.UniformMatrix4f(y),u_overlay:new o.Uniform1i(y),u_overlay_scale:new o.Uniform1f(y)}),clippingMask:y=>({u_matrix:new o.UniformMatrix4f(y)}),heatmap:y=>({u_extrude_scale:new o.Uniform1f(y),u_intensity:new o.Uniform1f(y),u_matrix:new o.UniformMatrix4f(y),u_inv_rot_matrix:new o.UniformMatrix4f(y),u_merc_center:new o.Uniform2f(y),u_tile_id:new o.Uniform3f(y),u_zoom_transition:new o.Uniform1f(y),u_up_dir:new o.Uniform3f(y)}),heatmapTexture:y=>({u_image:new o.Uniform1i(y),u_color_ramp:new o.Uniform1i(y),u_opacity:new o.Uniform1f(y)}),hillshade:y=>({u_matrix:new o.UniformMatrix4f(y),u_image:new o.Uniform1i(y),u_latrange:new o.Uniform2f(y),u_light:new o.Uniform2f(y),u_shadow:new o.UniformColor(y),u_highlight:new o.UniformColor(y),u_accent:new o.UniformColor(y)}),hillshadePrepare:y=>({u_matrix:new o.UniformMatrix4f(y),u_image:new o.Uniform1i(y),u_dimension:new o.Uniform2f(y),u_zoom:new o.Uniform1f(y),u_unpack:new o.Uniform4f(y)}),line:y=>({u_matrix:new o.UniformMatrix4f(y),u_pixels_to_tile_units:new o.UniformMatrix2f(y),u_device_pixel_ratio:new o.Uniform1f(y),u_units_to_pixels:new o.Uniform2f(y),u_dash_image:new o.Uniform1i(y),u_gradient_image:new o.Uniform1i(y),u_image_height:new o.Uniform1f(y),u_texsize:new o.Uniform2f(y),u_tile_units_to_pixels:new o.Uniform1f(y),u_alpha_discard_threshold:new o.Uniform1f(y),u_trim_offset:new o.Uniform2f(y)}),linePattern:y=>({u_matrix:new o.UniformMatrix4f(y),u_texsize:new o.Uniform2f(y),u_pixels_to_tile_units:new o.UniformMatrix2f(y),u_device_pixel_ratio:new o.Uniform1f(y),u_image:new o.Uniform1i(y),u_units_to_pixels:new o.Uniform2f(y),u_tile_units_to_pixels:new o.Uniform1f(y),u_alpha_discard_threshold:new o.Uniform1f(y)}),raster:y=>({u_matrix:new o.UniformMatrix4f(y),u_tl_parent:new o.Uniform2f(y),u_scale_parent:new o.Uniform1f(y),u_fade_t:new o.Uniform1f(y),u_opacity:new o.Uniform1f(y),u_image0:new o.Uniform1i(y),u_image1:new o.Uniform1i(y),u_brightness_low:new o.Uniform1f(y),u_brightness_high:new o.Uniform1f(y),u_saturation_factor:new o.Uniform1f(y),u_contrast_factor:new o.Uniform1f(y),u_spin_weights:new o.Uniform3f(y),u_perspective_transform:new o.Uniform2f(y)}),symbolIcon:y=>({u_is_size_zoom_constant:new o.Uniform1i(y),u_is_size_feature_constant:new o.Uniform1i(y),u_size_t:new o.Uniform1f(y),u_size:new o.Uniform1f(y),u_camera_to_center_distance:new o.Uniform1f(y),u_rotate_symbol:new o.Uniform1i(y),u_aspect_ratio:new o.Uniform1f(y),u_fade_change:new o.Uniform1f(y),u_matrix:new o.UniformMatrix4f(y),u_label_plane_matrix:new o.UniformMatrix4f(y),u_coord_matrix:new o.UniformMatrix4f(y),u_is_text:new o.Uniform1i(y),u_pitch_with_map:new o.Uniform1i(y),u_texsize:new o.Uniform2f(y),u_tile_id:new o.Uniform3f(y),u_zoom_transition:new o.Uniform1f(y),u_inv_rot_matrix:new o.UniformMatrix4f(y),u_merc_center:new o.Uniform2f(y),u_camera_forward:new o.Uniform3f(y),u_tile_matrix:new o.UniformMatrix4f(y),u_up_vector:new o.Uniform3f(y),u_ecef_origin:new o.Uniform3f(y),u_texture:new o.Uniform1i(y)}),symbolSDF:y=>({u_is_size_zoom_constant:new o.Uniform1i(y),u_is_size_feature_constant:new o.Uniform1i(y),u_size_t:new o.Uniform1f(y),u_size:new o.Uniform1f(y),u_camera_to_center_distance:new o.Uniform1f(y),u_rotate_symbol:new o.Uniform1i(y),u_aspect_ratio:new o.Uniform1f(y),u_fade_change:new o.Uniform1f(y),u_matrix:new o.UniformMatrix4f(y),u_label_plane_matrix:new o.UniformMatrix4f(y),u_coord_matrix:new o.UniformMatrix4f(y),u_is_text:new o.Uniform1i(y),u_pitch_with_map:new o.Uniform1i(y),u_texsize:new o.Uniform2f(y),u_texture:new o.Uniform1i(y),u_gamma_scale:new o.Uniform1f(y),u_device_pixel_ratio:new o.Uniform1f(y),u_tile_id:new o.Uniform3f(y),u_zoom_transition:new o.Uniform1f(y),u_inv_rot_matrix:new o.UniformMatrix4f(y),u_merc_center:new o.Uniform2f(y),u_camera_forward:new o.Uniform3f(y),u_tile_matrix:new o.UniformMatrix4f(y),u_up_vector:new o.Uniform3f(y),u_ecef_origin:new o.Uniform3f(y),u_is_halo:new o.Uniform1i(y)}),symbolTextAndIcon:y=>({u_is_size_zoom_constant:new o.Uniform1i(y),u_is_size_feature_constant:new o.Uniform1i(y),u_size_t:new o.Uniform1f(y),u_size:new o.Uniform1f(y),u_camera_to_center_distance:new o.Uniform1f(y),u_rotate_symbol:new o.Uniform1i(y),u_aspect_ratio:new o.Uniform1f(y),u_fade_change:new o.Uniform1f(y),u_matrix:new o.UniformMatrix4f(y),u_label_plane_matrix:new o.UniformMatrix4f(y),u_coord_matrix:new o.UniformMatrix4f(y),u_is_text:new o.Uniform1i(y),u_pitch_with_map:new o.Uniform1i(y),u_texsize:new o.Uniform2f(y),u_texsize_icon:new o.Uniform2f(y),u_texture:new o.Uniform1i(y),u_texture_icon:new o.Uniform1i(y),u_gamma_scale:new o.Uniform1f(y),u_device_pixel_ratio:new o.Uniform1f(y),u_is_halo:new o.Uniform1i(y)}),background:y=>({u_matrix:new o.UniformMatrix4f(y),u_opacity:new o.Uniform1f(y),u_color:new o.UniformColor(y)}),backgroundPattern:y=>({u_matrix:new o.UniformMatrix4f(y),u_opacity:new o.Uniform1f(y),u_image:new o.Uniform1i(y),u_pattern_tl:new o.Uniform2f(y),u_pattern_br:new o.Uniform2f(y),u_texsize:new o.Uniform2f(y),u_pattern_size:new o.Uniform2f(y),u_pixel_coord_upper:new o.Uniform2f(y),u_pixel_coord_lower:new o.Uniform2f(y),u_tile_units_to_pixels:new o.Uniform1f(y)}),terrainRaster:bo,terrainDepth:bo,skybox:y=>({u_matrix:new o.UniformMatrix4f(y),u_sun_direction:new o.Uniform3f(y),u_cubemap:new o.Uniform1i(y),u_opacity:new o.Uniform1f(y),u_temporal_offset:new o.Uniform1f(y)}),skyboxGradient:y=>({u_matrix:new o.UniformMatrix4f(y),u_color_ramp:new o.Uniform1i(y),u_center_direction:new o.Uniform3f(y),u_radius:new o.Uniform1f(y),u_opacity:new o.Uniform1f(y),u_temporal_offset:new o.Uniform1f(y)}),skyboxCapture:y=>({u_matrix_3f:new o.UniformMatrix3f(y),u_sun_direction:new o.Uniform3f(y),u_sun_intensity:new o.Uniform1f(y),u_color_tint_r:new o.Uniform4f(y),u_color_tint_m:new o.Uniform4f(y),u_luminance:new o.Uniform1f(y)}),globeRaster:y=>({u_proj_matrix:new o.UniformMatrix4f(y),u_globe_matrix:new o.UniformMatrix4f(y),u_normalize_matrix:new o.UniformMatrix4f(y),u_merc_matrix:new o.UniformMatrix4f(y),u_zoom_transition:new o.Uniform1f(y),u_merc_center:new o.Uniform2f(y),u_image0:new o.Uniform1i(y),u_grid_matrix:new o.UniformMatrix3f(y),u_skirt_height:new o.Uniform1f(y),u_frustum_tl:new o.Uniform3f(y),u_frustum_tr:new o.Uniform3f(y),u_frustum_br:new o.Uniform3f(y),u_frustum_bl:new o.Uniform3f(y),u_globe_pos:new o.Uniform3f(y),u_globe_radius:new o.Uniform1f(y),u_viewport:new o.Uniform2f(y)}),globeAtmosphere:y=>({u_frustum_tl:new o.Uniform3f(y),u_frustum_tr:new o.Uniform3f(y),u_frustum_br:new o.Uniform3f(y),u_frustum_bl:new o.Uniform3f(y),u_horizon:new o.Uniform1f(y),u_transition:new o.Uniform1f(y),u_fadeout_range:new o.Uniform1f(y),u_color:new o.Uniform4f(y),u_high_color:new o.Uniform4f(y),u_space_color:new o.Uniform4f(y),u_star_intensity:new o.Uniform1f(y),u_star_density:new o.Uniform1f(y),u_star_size:new o.Uniform1f(y),u_temporal_offset:new o.Uniform1f(y),u_horizon_angle:new o.Uniform1f(y),u_rotation_matrix:new o.UniformMatrix4f(y)})};let eu;function Oa(y,a,f,v,S,T,N){const z=y.context,G=z.gl,Q=y.transform,te=y.useProgram("collisionBox"),ge=[];let Ae=0,Le=0;for(let st=0;st<v.length;st++){const bt=v[st],wt=a.getTile(bt),vt=wt.getBucket(f);if(!vt)continue;const kt=fs(bt,vt,Q);let Tt=kt;S[0]===0&&S[1]===0||(Tt=y.translatePosMatrix(kt,wt,S,T));const Vt=N?vt.textCollisionBox:vt.iconCollisionBox,vn=vt.collisionCircleArray;if(vn.length>0){const Bt=o.create(),ln=Tt;o.mul(Bt,vt.placementInvProjMatrix,Q.glCoordMatrix),o.mul(Bt,Bt,vt.placementViewportMatrix),ge.push({circleArray:vn,circleOffset:Le,transform:ln,invTransform:Bt,projection:vt.getProjection()}),Ae+=vn.length/4,Le=Ae}Vt&&(y.terrain&&y.terrain.setupElevationDraw(wt,te),te.draw(z,G.LINES,o.DepthMode.disabled,o.StencilMode.disabled,y.colorModeForRenderPass(),o.CullFaceMode.disabled,jl(Tt,Q,wt,vt.getProjection()),f.id,Vt.layoutVertexBuffer,Vt.indexBuffer,Vt.segments,null,Q.zoom,null,[Vt.collisionVertexBuffer,Vt.collisionVertexBufferExt]))}if(!N||!ge.length)return;const Xe=y.useProgram("collisionCircle"),Ue=new o.StructArrayLayout2f1f2i16;Ue.resize(4*Ae),Ue._trim();let Ze=0;for(const st of ge)for(let bt=0;bt<st.circleArray.length/4;bt++){const wt=4*bt,vt=st.circleArray[wt+0],kt=st.circleArray[wt+1],Tt=st.circleArray[wt+2],Vt=st.circleArray[wt+3];Ue.emplace(Ze++,vt,kt,Tt,Vt,0),Ue.emplace(Ze++,vt,kt,Tt,Vt,1),Ue.emplace(Ze++,vt,kt,Tt,Vt,2),Ue.emplace(Ze++,vt,kt,Tt,Vt,3)}(!eu||eu.length<2*Ae)&&(eu=(function(st){const bt=2*st,wt=new o.StructArrayLayout3ui6;wt.resize(bt),wt._trim();for(let vt=0;vt<bt;vt++){const kt=6*vt;wt.uint16[kt+0]=4*vt+0,wt.uint16[kt+1]=4*vt+1,wt.uint16[kt+2]=4*vt+2,wt.uint16[kt+3]=4*vt+2,wt.uint16[kt+4]=4*vt+3,wt.uint16[kt+5]=4*vt+0}return wt})(Ae));const _e=z.createIndexBuffer(eu,!0),$e=z.createVertexBuffer(Ue,o.collisionCircleLayout.members,!0);for(const st of ge){const bt={u_matrix:st.transform,u_inv_matrix:st.invTransform,u_camera_to_center_distance:(it=Q).getCameraToCenterDistance(st.projection),u_viewport_size:[it.width,it.height]};Xe.draw(z,G.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,y.colorModeForRenderPass(),o.CullFaceMode.disabled,bt,f.id,$e,_e,o.SegmentVector.simpleSegment(0,2*st.circleOffset,st.circleArray.length,st.circleArray.length/2),null,Q.zoom)}var it;$e.destroy(),_e.destroy()}const sc=o.create();function Sl({width:y,height:a,anchor:f,textOffset:v,textScale:S},T){const{horizontalAlign:N,verticalAlign:z}=o.getAnchorAlignment(f),G=-(N-.5)*y,Q=-(z-.5)*a,te=o.evaluateVariableOffset(f,v);return new o.Point((G/S+te[0])*T,(Q/S+te[1])*T)}function Vl(y,a,f,v,S,T,N,z,G,Q,te){const ge=y.text.placedSymbolArray,Ae=y.text.dynamicLayoutVertexArray,Le=y.icon.dynamicLayoutVertexArray,Xe={},Ue=y.getProjection(),Ze=zi(z,Ue,T),_e=T.elevation,$e=Ue.upVectorScale(z.canonical,T.center.lat,T.worldSize).metersToTile;Ae.clear();for(let it=0;it<ge.length;it++){const st=ge.get(it),{tileAnchorX:bt,tileAnchorY:wt,numGlyphs:vt}=st,kt=st.hidden||!st.crossTileID||y.allowVerticalPlacement&&!st.placedOrientation?null:v[st.crossTileID];if(kt){let Tt=0,Vt=0,vn=0;if(_e){const Nn=_e?_e.getAtTileOffset(z,bt,wt):0,[hr,Dr,rr]=Ue.upVector(z.canonical,bt,wt);Tt=Nn*hr*$e,Vt=Nn*Dr*$e,vn=Nn*rr*$e}let[Bt,ln,Wt,Cn]=_i(st.projectedAnchorX+Tt,st.projectedAnchorY+Vt,st.projectedAnchorZ+vn,f?Ze:N);const Ut=pu(T.getCameraToCenterDistance(Ue),Cn);let rn=S.evaluateSizeForFeature(y.textSizeData,Q,st)*Ut/o.ONE_EM;f&&(rn*=y.tilePixelRatio/G);const Tn=Sl(kt,rn);f?({x:Bt,y:ln,z:Wt}=Ue.projectTilePoint(bt+Tn.x,wt+Tn.y,z.canonical),[Bt,ln,Wt]=_i(Bt+Tt,ln+Vt,Wt+vn,N)):(a&&Tn._rotate(-T.angle),Bt+=Tn.x,ln+=Tn.y,Wt=0);const cn=y.allowVerticalPlacement&&st.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let Nn=0;Nn<vt;Nn++)o.addDynamicAttributes(Ae,Bt,ln,Wt,cn);te&&st.associatedIconIndex>=0&&(Xe[st.associatedIconIndex]={x:Bt,y:ln,z:Wt,angle:cn})}else Ea(vt,Ae)}if(te){Le.clear();const it=y.icon.placedSymbolArray;for(let st=0;st<it.length;st++){const bt=it.get(st),{numGlyphs:wt}=bt,vt=Xe[st];if(bt.hidden||!vt)Ea(wt,Le);else{const{x:kt,y:Tt,z:Vt,angle:vn}=vt;for(let Bt=0;Bt<wt;Bt++)o.addDynamicAttributes(Le,kt,Tt,Vt,vn)}}y.icon.dynamicLayoutVertexBuffer.updateData(Le)}y.text.dynamicLayoutVertexBuffer.updateData(Ae)}function wc(y,a,f){return f.iconsInText&&a?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function El(y,a,f,v,S,T,N,z,G,Q,te,ge){const Ae=y.context,Le=Ae.gl,Xe=y.transform,Ue=z==="map",Ze=G==="map",_e=Ue&&f.layout.get("symbol-placement")!=="point",$e=Ue&&!Ze&&!_e,it=f.layout.get("symbol-sort-key").constantOr(1)!==void 0;let st=!1;const bt=y.depthModeForSublayer(0,o.DepthMode.ReadOnly),wt=[o.mercatorXfromLng(Xe.center.lng),o.mercatorYfromLat(Xe.center.lat)],vt=f.layout.get("text-variable-anchor"),kt=Xe.projection.name==="globe",Tt=[],Vt=[0,-1,0];let vn=Vt;!kt&&!Xe.mercatorFromTransition||Ue||(vn=(function(Bt){const ln=Bt._camera.getWorldToCamera(Bt.worldSize,1),Wt=o.multiply([],ln,Bt.globeMatrix);o.invert(Wt,Wt);const Cn=[0,0,0],Ut=[0,1,0,0];return o.transformMat4$1(Ut,Ut,Wt),Cn[0]=Ut[0],Cn[1]=Ut[1],Cn[2]=Ut[2],o.normalize(Cn,Cn),Cn})(Xe));for(const Bt of v){const ln=a.getTile(Bt),Wt=ln.getBucket(f);if(!Wt||Wt.projection.name==="mercator"&&kt)continue;const Cn=S?Wt.text:Wt.icon;if(!Cn||Wt.fullyClipped||!Cn.segments.get().length)continue;const Ut=Cn.programConfigurations.get(f.id),rn=S||Wt.sdfIcons,Tn=S?Wt.textSizeData:Wt.iconSizeData,cn=Ze||Xe.pitch!==0,Nn=o.evaluateSizeForZoom(Tn,Xe.zoom);let hr,Dr,rr,Jn,ni=[0,0],mi=null;if(S)Dr=ln.glyphAtlasTexture,rr=Le.LINEAR,hr=ln.glyphAtlasTexture.size,Wt.iconsInText&&(ni=ln.imageAtlasTexture.size,mi=ln.imageAtlasTexture,Jn=cn||y.options.rotating||y.options.zooming||Tn.kind==="composite"||Tn.kind==="camera"?Le.LINEAR:Le.NEAREST);else{const dc=f.layout.get("icon-size").constantOr(0)!==1||Wt.iconsNeedLinear;Dr=ln.imageAtlasTexture,rr=rn||y.options.rotating||y.options.zooming||dc||cn?Le.LINEAR:Le.NEAREST,hr=ln.imageAtlasTexture.size}const xr=Wt.projection.name==="globe",Ii=xr?vn:Vt,Ci=xr?o.globeToMercatorTransition(Xe.zoom):0,Ni=zi(Bt,Wt.getProjection(),Xe),fo=Xe.calculatePixelsToTileUnitsMatrix(ln),Rs=mn(Ni,ln.tileID.canonical,Ze,Ue,Xe,Wt.getProjection(),fo),hs=y.terrain&&Ze&&_e?o.invert(o.create(),Rs):sc,hc=ss(Ni,ln.tileID.canonical,Ze,Ue,Xe,Wt.getProjection(),fo),Tc=vt&&Wt.hasTextData(),Li=f.layout.get("icon-text-fit")!=="none"&&Tc&&Wt.hasIconData();if(_e){const dc=Xe.elevation,Ds=dc?dc.getAtTileOffsetFunc(Bt,Xe.center.lat,Xe.worldSize,Wt.getProjection()):null,Ic=Yo(Ni,ln.tileID.canonical,Ze,Ue,Xe,Wt.getProjection(),fo);Ka(Wt,Ni,y,S,Ic,hc,Ze,Q,Ds,Bt)}const no=_e||S&&vt||Li,po=y.translatePosMatrix(Ni,ln,T,N),Ms=no?sc:Rs,nl=y.translatePosMatrix(hc,ln,T,N,!0),$o=Wt.getProjection().createInversionMatrix(Xe,Bt.canonical),Ns=[];y.terrainRenderModeElevated()&&Ze&&Ns.push("PITCH_WITH_MAP_TERRAIN"),xr&&Ns.push("PROJECTION_GLOBE_VIEW"),no&&Ns.push("PROJECTED_POS_ON_VIEWPORT");const ps=rn&&f.paint.get(S?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ns;ns=rn?Wt.iconsInText?Aa(Tn.kind,Nn,$e,Ze,y,po,Ms,nl,hr,ni,Bt,Ci,wt,$o,Ii,Wt.getProjection()):Uo(Tn.kind,Nn,$e,Ze,y,po,Ms,nl,S,hr,!0,Bt,Ci,wt,$o,Ii,Wt.getProjection()):vs(Tn.kind,Nn,$e,Ze,y,po,Ms,nl,S,hr,Bt,Ci,wt,$o,Ii,Wt.getProjection());const xs={program:y.useProgram(wc(rn,S,Wt),Ut,Ns),buffers:Cn,uniformValues:ns,atlasTexture:Dr,atlasTextureIcon:mi,atlasInterpolation:rr,atlasInterpolationIcon:Jn,isSDF:rn,hasHalo:ps,tile:ln,labelPlaneMatrixInv:hs};if(it&&Wt.canOverlap){st=!0;const dc=Cn.segments.get();for(const Ds of dc)Tt.push({segments:new o.SegmentVector([Ds]),sortKey:Ds.sortKey,state:xs})}else Tt.push({segments:Cn.segments,sortKey:0,state:xs})}st&&Tt.sort(((Bt,ln)=>Bt.sortKey-ln.sortKey));for(const Bt of Tt){const ln=Bt.state;if(y.terrain&&y.terrain.setupElevationDraw(ln.tile,ln.program,{useDepthForOcclusion:!kt,labelPlaneMatrixInv:ln.labelPlaneMatrixInv}),Ae.activeTexture.set(Le.TEXTURE0),ln.atlasTexture.bind(ln.atlasInterpolation,Le.CLAMP_TO_EDGE),ln.atlasTextureIcon&&(Ae.activeTexture.set(Le.TEXTURE1),ln.atlasTextureIcon&&ln.atlasTextureIcon.bind(ln.atlasInterpolationIcon,Le.CLAMP_TO_EDGE)),ln.isSDF){const Wt=ln.uniformValues;ln.hasHalo&&(Wt.u_is_halo=1,Oc(ln.buffers,Bt.segments,f,y,ln.program,bt,te,ge,Wt)),Wt.u_is_halo=0}Oc(ln.buffers,Bt.segments,f,y,ln.program,bt,te,ge,ln.uniformValues)}}function Oc(y,a,f,v,S,T,N,z,G){const Q=v.context,te=[y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer,y.globeExtVertexBuffer];S.draw(Q,Q.gl.TRIANGLES,T,N,z,o.CullFaceMode.disabled,G,f.id,y.layoutVertexBuffer,y.indexBuffer,a,f.paint,v.transform.zoom,y.programConfigurations.get(f.id),te)}function lo(y,a,f,v,S,T,N){const z=y.context.gl,G=f.paint.get("fill-pattern"),Q=G&&G.constantOr(1);let te,ge,Ae,Le,Xe;N?(ge=Q&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",te=z.LINES):(ge=Q?"fillPattern":"fill",te=z.TRIANGLES);for(const Ue of v){const Ze=a.getTile(Ue);if(Q&&!Ze.patternsLoaded())continue;const _e=Ze.getBucket(f);if(!_e)continue;y.prepareDrawTile();const $e=_e.programConfigurations.get(f.id),it=y.useProgram(ge,$e);Q&&(y.context.activeTexture.set(z.TEXTURE0),Ze.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),$e.updatePaintBuffers());const st=G.constantOr(null);if(st&&Ze.imageAtlas){const wt=Ze.imageAtlas.patternPositions[st.toString()];wt&&$e.setConstantPatternPositions(wt)}const bt=y.translatePosMatrix(Ue.projMatrix,Ze,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));if(N){Le=_e.indexBuffer2,Xe=_e.segments2;const wt=y.terrain&&y.terrain.renderingToTexture?y.terrain.drapeBufferSize:[z.drawingBufferWidth,z.drawingBufferHeight];Ae=ge==="fillOutlinePattern"&&Q?No(bt,y,Ze,wt):Oi(bt,wt)}else Le=_e.indexBuffer,Xe=_e.segments,Ae=Q?Wi(bt,y,Ze):Fo(bt);y.prepareDrawProgram(y.context,it,Ue.toUnwrapped()),it.draw(y.context,te,S,y.stencilModeForClipping(Ue),T,o.CullFaceMode.disabled,Ae,f.id,_e.layoutVertexBuffer,Le,Xe,f.paint,y.transform.zoom,$e)}}function Al(y,a,f,v,S,T,N){const z=y.context,G=z.gl,Q=y.transform,te=f.paint.get("fill-extrusion-pattern"),ge=te.constantOr(1),Ae=f.paint.get("fill-extrusion-opacity"),Le=[f.paint.get("fill-extrusion-ambient-occlusion-intensity"),f.paint.get("fill-extrusion-ambient-occlusion-radius")],Xe=f.layout.get("fill-extrusion-edge-radius"),Ue=Xe>0&&!f.paint.get("fill-extrusion-rounded-roof"),Ze=Ue?0:Xe,_e=Q.projection.name==="globe"?o.fillExtrusionHeightLift():0,$e=Q.projection.name==="globe",it=$e?o.globeToMercatorTransition(Q.zoom):0,st=[o.mercatorXfromLng(Q.center.lng),o.mercatorYfromLat(Q.center.lat)],bt=[];$e&&bt.push("PROJECTION_GLOBE_VIEW"),Le[0]>0&&bt.push("FAUX_AO"),Ue&&bt.push("ZERO_ROOF_RADIUS");for(const wt of v){const vt=a.getTile(wt),kt=vt.getBucket(f);if(!kt||kt.projection.name!==Q.projection.name)continue;const Tt=kt.programConfigurations.get(f.id),Vt=y.useProgram(ge?"fillExtrusionPattern":"fillExtrusion",Tt,bt);if(y.terrain){const rn=y.terrain;if(y.style.terrainSetForDrapingOnly())rn.setupElevationDraw(vt,Vt,{useMeterToDem:!0});else{if(!kt.enableTerrain)continue;if(rn.setupElevationDraw(vt,Vt,{useMeterToDem:!0}),Xo(z,a,wt,kt,f,rn),!kt.centroidVertexBuffer){const Tn=Vt.attributes.a_centroid_pos;Tn!==void 0&&G.vertexAttrib2f(Tn,0,0)}}}ge&&(y.context.activeTexture.set(G.TEXTURE0),vt.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),Tt.updatePaintBuffers());const vn=te.constantOr(null);if(vn&&vt.imageAtlas){const rn=vt.imageAtlas.patternPositions[vn.toString()];rn&&Tt.setConstantPatternPositions(rn)}const Bt=y.translatePosMatrix(wt.projMatrix,vt,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),ln=Q.projection.createInversionMatrix(Q,wt.canonical),Wt=f.paint.get("fill-extrusion-vertical-gradient"),Cn=ge?ho(Bt,y,Wt,Ae,Le,Ze,wt,vt,_e,it,st,ln):sr(Bt,y,Wt,Ae,Le,Ze,wt,_e,it,st,ln);y.prepareDrawProgram(z,Vt,wt.toUnwrapped());const Ut=[];y.terrain&&Ut.push(kt.centroidVertexBuffer),$e&&Ut.push(kt.layoutVertexExtBuffer),Vt.draw(z,z.gl.TRIANGLES,S,T,N,o.CullFaceMode.backCCW,Cn,f.id,kt.layoutVertexBuffer,kt.indexBuffer,kt.segments,f.paint,y.transform.zoom,Tt,Ut)}}function Xo(y,a,f,v,S,T){const N=[_e=>{let $e=_e.canonical.x-1,it=_e.wrap;return $e<0&&($e=(1<<_e.canonical.z)-1,it--),new o.OverscaledTileID(_e.overscaledZ,it,_e.canonical.z,$e,_e.canonical.y)},_e=>{let $e=_e.canonical.x+1,it=_e.wrap;return $e===1<<_e.canonical.z&&($e=0,it++),new o.OverscaledTileID(_e.overscaledZ,it,_e.canonical.z,$e,_e.canonical.y)},_e=>new o.OverscaledTileID(_e.overscaledZ,_e.wrap,_e.canonical.z,_e.canonical.x,(_e.canonical.y===0?1<<_e.canonical.z:_e.canonical.y)-1),_e=>new o.OverscaledTileID(_e.overscaledZ,_e.wrap,_e.canonical.z,_e.canonical.x,_e.canonical.y===(1<<_e.canonical.z)-1?0:_e.canonical.y+1)],z=_e=>{const $e=a.getSource().minzoom,it=bt=>{const wt=a.getTileByID(bt);if(wt&&wt.hasData())return wt.getBucket(S)},st=[0,-1,1];for(const bt of st){if(_e.overscaledZ+bt<$e)continue;const wt=it(_e.calculateScaledKey(_e.overscaledZ+bt));if(wt)return wt}},G=[0,0,0],Q=(_e,$e)=>(G[0]=Math.min(_e.min.y,$e.min.y),G[1]=Math.max(_e.max.y,$e.max.y),G[2]=o.EXTENT-$e.min.x>_e.max.x?$e.min.x-o.EXTENT:_e.max.x,G),te=(_e,$e)=>(G[0]=Math.min(_e.min.x,$e.min.x),G[1]=Math.max(_e.max.x,$e.max.x),G[2]=o.EXTENT-$e.min.y>_e.max.y?$e.min.y-o.EXTENT:_e.max.y,G),ge=[(_e,$e)=>Q(_e,$e),(_e,$e)=>Q($e,_e),(_e,$e)=>te(_e,$e),(_e,$e)=>te($e,_e)],Ae=new o.Point(0,0);let Le,Xe,Ue;const Ze=(_e,$e,it,st,bt)=>{const wt=[[st?it:_e,st?_e:it,0],[st?it:$e,st?$e:it,0]],vt=bt<0?o.EXTENT+bt:bt,kt=[st?vt:(_e+$e)/2,st?(_e+$e)/2:vt,0];return it===0&&bt<0||it!==0&&bt>0?T.getForTilePoints(Ue,[kt],!0,Xe):wt.push(kt),T.getForTilePoints(f,wt,!0,Le),Math.max(wt[0][2],wt[1][2],kt[2])/T.exaggeration()};for(let _e=0;_e<4;_e++){const $e=(_e<2?1:5)-_e,it=v.borders[_e];if(it.length===0)continue;const st=Ue=N[_e](f),bt=z(st);if(!(bt&&bt instanceof o.FillExtrusionBucket&&bt.enableTerrain)||v.borderDoneWithNeighborZ[_e]===bt.canonical.z&&bt.borderDoneWithNeighborZ[$e]===v.canonical.z||(Xe=T.findDEMTileFor(st),!Xe||!Xe.dem))continue;if(!Le){const Tt=T.findDEMTileFor(f);if(!Tt||!Tt.dem)return;Le=Tt}const wt=bt.borders[$e];let vt=0;const kt=bt.borderDoneWithNeighborZ[$e]!==v.canonical.z;if(v.canonical.z===bt.canonical.z){for(let Tt=0;Tt<it.length;Tt++){const Vt=v.featuresOnBorder[it[Tt]],vn=Vt.borders[_e];let Bt;for(;vt<wt.length&&(Bt=bt.featuresOnBorder[wt[vt]],!(Bt.borders[$e][1]>vn[0]+3));)kt&&bt.encodeCentroid(void 0,Bt,!1),vt++;if(Bt&&vt<wt.length){const ln=vt;let Wt=0;for(;!(Bt.borders[$e][0]>vn[1]-3)&&(Wt++,++vt!==wt.length);)Bt=bt.featuresOnBorder[wt[vt]];if(Bt=bt.featuresOnBorder[wt[ln]],Vt.intersectsCount()>1||Bt.intersectsCount()>1||Wt!==1){Wt!==1&&(vt=ln),v.encodeCentroid(void 0,Vt,!1),kt&&bt.encodeCentroid(void 0,Bt,!1);continue}const Cn=ge[_e](Vt,Bt),Ut=_e%2?o.EXTENT-1:0;Ae.x=Ze(Cn[0],Math.min(o.EXTENT-1,Cn[1]),Ut,_e<2,Cn[2]),Ae.y=0,v.encodeCentroid(Ae,Vt,!1),kt&&bt.encodeCentroid(Ae,Bt,!1)}else v.encodeCentroid(void 0,Vt,!1)}v.borderDoneWithNeighborZ[_e]=bt.canonical.z,v.needsCentroidUpdate=!0,kt&&(bt.borderDoneWithNeighborZ[$e]=v.canonical.z,bt.needsCentroidUpdate=!0)}else{for(const Tt of it)v.encodeCentroid(void 0,v.featuresOnBorder[Tt],!1);if(kt){for(const Tt of wt)bt.encodeCentroid(void 0,bt.featuresOnBorder[Tt],!1);bt.borderDoneWithNeighborZ[$e]=v.canonical.z,bt.needsCentroidUpdate=!0}v.borderDoneWithNeighborZ[_e]=bt.canonical.z,v.needsCentroidUpdate=!0}}(v.needsCentroidUpdate||!v.centroidVertexBuffer&&v.centroidVertexArray.length!==0)&&v.uploadCentroid(y)}const So=new o.Color(1,0,0,1),la=new o.Color(0,1,0,1),ca=new o.Color(0,0,1,1),Bc=new o.Color(1,0,1,1),kh=new o.Color(0,1,1,1);function _u(y,a,f){const v=y.context,S=y.transform,T=v.gl,N=S.projection.name==="globe",z=N?["PROJECTION_GLOBE_VIEW"]:null;let G=f.projMatrix;if(N&&o.globeToMercatorTransition(S.zoom)>0){const Vt=o.transitionTileAABBinECEF(f.canonical,S),vn=o.globeDenormalizeECEF(Vt);G=o.multiply(new Float32Array(16),S.globeMatrix,vn),o.multiply(G,S.projMatrix,G)}const Q=y.useProgram("debug",null,z),te=a.getTileByID(f.key);y.terrain&&y.terrain.setupElevationDraw(te,Q);const ge=o.DepthMode.disabled,Ae=o.StencilMode.disabled,Le=y.colorModeForRenderPass(),Xe="$debug";v.activeTexture.set(T.TEXTURE0),y.emptyTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),N?te._makeGlobeTileDebugBuffers(y.context,S):te._makeDebugTileBoundsBuffers(y.context,S.projection);const Ue=te._tileDebugBuffer||y.debugBuffer,Ze=te._tileDebugIndexBuffer||y.debugIndexBuffer,_e=te._tileDebugSegments||y.debugSegments;Q.draw(v,T.LINE_STRIP,ge,Ae,Le,o.CullFaceMode.disabled,aa(G,o.Color.red),Xe,Ue,Ze,_e,null,null,null,[te._globeTileDebugBorderBuffer]);const $e=te.latestRawTileData,it=Math.floor(($e&&$e.byteLength||0)/1024),st=a.getTile(f).tileSize,bt=512/Math.min(st,512)*(f.overscaledZ/S.zoom)*.5;let wt=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(wt+=` => ${f.overscaledZ}`),wt+=` ${it}kb`,(function(Vt,vn){Vt.initDebugOverlayCanvas();const Bt=Vt.debugOverlayCanvas,ln=Vt.context.gl,Wt=Vt.debugOverlayCanvas.getContext("2d");Wt.clearRect(0,0,Bt.width,Bt.height),Wt.shadowColor="white",Wt.shadowBlur=2,Wt.lineWidth=1.5,Wt.strokeStyle="white",Wt.textBaseline="top",Wt.font="bold 36px Open Sans, sans-serif",Wt.fillText(vn,5,5),Wt.strokeText(vn,5,5),Vt.debugOverlayTexture.update(Bt),Vt.debugOverlayTexture.bind(ln.LINEAR,ln.CLAMP_TO_EDGE)})(y,wt);const vt=te._tileDebugTextBuffer||y.debugBuffer,kt=te._tileDebugTextIndexBuffer||y.quadTriangleIndexBuffer,Tt=te._tileDebugTextSegments||y.debugSegments;Q.draw(v,T.TRIANGLES,ge,Ae,o.ColorMode.alphaBlended,o.CullFaceMode.disabled,aa(G,o.Color.transparent,bt),Xe,vt,kt,Tt,null,null,null,[te._globeTileDebugTextBuffer])}function tu(y,a,f,v){nu(y,0,a+f/2,y.transform.width,f,v)}function Mu(y,a,f,v){nu(y,a-f/2,0,f,y.transform.height,v)}function nu(y,a,f,v,S,T){const N=y.context,z=N.gl;z.enable(z.SCISSOR_TEST),z.scissor(a*o.exported.devicePixelRatio,f*o.exported.devicePixelRatio,v*o.exported.devicePixelRatio,S*o.exported.devicePixelRatio),N.clear({color:T}),z.disable(z.SCISSOR_TEST)}const xh=o.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Zh}=xh;function ql(y,a,f,v){y.emplaceBack(a,f,v)}class zc{constructor(a){this.vertexArray=new o.StructArrayLayout3f12,this.indices=new o.StructArrayLayout3ui6,ql(this.vertexArray,-1,-1,1),ql(this.vertexArray,1,-1,1),ql(this.vertexArray,-1,1,1),ql(this.vertexArray,1,1,1),ql(this.vertexArray,-1,-1,-1),ql(this.vertexArray,1,-1,-1),ql(this.vertexArray,-1,1,-1),ql(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=a.createVertexBuffer(this.vertexArray,Zh),this.indexBuffer=a.createIndexBuffer(this.indices),this.segment=o.SegmentVector.simpleSegment(0,0,36,12)}}function Xs(y,a,f,v,S,T){const N=y.gl,z=a.paint.get("sky-atmosphere-color"),G=a.paint.get("sky-atmosphere-halo-color"),Q=a.paint.get("sky-atmosphere-sun-intensity"),te=((ge,Ae,Le,Xe,Ue)=>({u_matrix_3f:ge,u_sun_direction:Ae,u_sun_intensity:Le,u_color_tint_r:[Xe.r,Xe.g,Xe.b,Xe.a],u_color_tint_m:[Ue.r,Ue.g,Ue.b,Ue.a],u_luminance:5e-5}))(o.fromMat4(o.create$1(),v),S,Q,z,G);N.framebufferTexture2D(N.FRAMEBUFFER,N.COLOR_ATTACHMENT0,N.TEXTURE_CUBE_MAP_POSITIVE_X+T,a.skyboxTexture,0),f.draw(y,N.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.frontCW,te,"skyboxCapture",a.skyboxGeometry.vertexBuffer,a.skyboxGeometry.indexBuffer,a.skyboxGeometry.segment)}const vu=o.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Sc{constructor(a){const f=new o.StructArrayLayout5f20;f.emplaceBack(-1,1,1,0,0),f.emplaceBack(1,1,1,1,0),f.emplaceBack(1,-1,1,1,1),f.emplaceBack(-1,-1,1,0,1);const v=new o.StructArrayLayout3ui6;v.emplaceBack(0,1,2),v.emplaceBack(2,3,0),this.vertexBuffer=a.createVertexBuffer(f,vu.members),this.indexBuffer=a.createIndexBuffer(v),this.segments=o.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const fl={symbol:function(y,a,f,v,S){if(y.renderPass!=="translucent")return;const T=o.StencilMode.disabled,N=y.colorModeForRenderPass();f.layout.get("text-variable-anchor")&&(function(z,G,Q,te,ge,Ae,Le){const Xe=G.transform,Ue=ge==="map",Ze=Ae==="map";for(const _e of z){const $e=te.getTile(_e),it=$e.getBucket(Q);if(!it||!it.text||!it.text.segments.get().length)continue;const st=o.evaluateSizeForZoom(it.textSizeData,Xe.zoom),bt=zi(_e,it.getProjection(),Xe),wt=Xe.calculatePixelsToTileUnitsMatrix($e),vt=mn(bt,$e.tileID.canonical,Ze,Ue,Xe,it.getProjection(),wt),kt=Q.layout.get("icon-text-fit")!=="none"&&it.hasIconData();if(st){const Tt=Math.pow(2,Xe.zoom-$e.tileID.overscaledZ);Vl(it,Ue,Ze,Le,o.symbolSize,Xe,vt,_e,Tt,st,kt)}}})(v,y,f,a,f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),S),f.paint.get("icon-opacity").constantOr(1)!==0&&El(y,a,f,v,!1,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),f.layout.get("icon-rotation-alignment"),f.layout.get("icon-pitch-alignment"),f.layout.get("icon-keep-upright"),T,N),f.paint.get("text-opacity").constantOr(1)!==0&&El(y,a,f,v,!0,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),f.layout.get("text-keep-upright"),T,N),a.map.showCollisionBoxes&&(Oa(y,a,f,v,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),!0),Oa(y,a,f,v,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),!1))},circle:function(y,a,f,v){if(y.renderPass!=="translucent")return;const S=f.paint.get("circle-opacity"),T=f.paint.get("circle-stroke-width"),N=f.paint.get("circle-stroke-opacity"),z=f.layout.get("circle-sort-key").constantOr(1)!==void 0;if(S.constantOr(1)===0&&(T.constantOr(1)===0||N.constantOr(1)===0))return;const G=y.context,Q=G.gl,te=y.transform,ge=y.depthModeForSublayer(0,o.DepthMode.ReadOnly),Ae=o.StencilMode.disabled,Le=y.colorModeForRenderPass(),Xe=te.projection.name==="globe",Ue=[o.mercatorXfromLng(te.center.lng),o.mercatorYfromLat(te.center.lat)],Ze=[];for(let $e=0;$e<v.length;$e++){const it=v[$e],st=a.getTile(it),bt=st.getBucket(f);if(!bt||bt.projection.name!==te.projection.name)continue;const wt=bt.programConfigurations.get(f.id),vt=$i(f);Xe&&vt.push("PROJECTION_GLOBE_VIEW");const kt=y.useProgram("circle",wt,vt),Tt=bt.layoutVertexBuffer,Vt=bt.globeExtVertexBuffer,vn=bt.indexBuffer,Bt=te.projection.createInversionMatrix(te,it.canonical),ln={programConfiguration:wt,program:kt,layoutVertexBuffer:Tt,globeExtVertexBuffer:Vt,indexBuffer:vn,uniformValues:Oo(y,it,st,Bt,Ue,f),tile:st};if(z){const Wt=bt.segments.get();for(const Cn of Wt)Ze.push({segments:new o.SegmentVector([Cn]),sortKey:Cn.sortKey,state:ln})}else Ze.push({segments:bt.segments,sortKey:0,state:ln})}z&&Ze.sort((($e,it)=>$e.sortKey-it.sortKey));const _e={useDepthForOcclusion:!Xe};for(const $e of Ze){const{programConfiguration:it,program:st,layoutVertexBuffer:bt,globeExtVertexBuffer:wt,indexBuffer:vt,uniformValues:kt,tile:Tt}=$e.state,Vt=$e.segments;y.terrain&&y.terrain.setupElevationDraw(Tt,st,_e),y.prepareDrawProgram(G,st,Tt.tileID.toUnwrapped()),st.draw(G,Q.TRIANGLES,ge,Ae,Le,o.CullFaceMode.disabled,kt,f.id,bt,vt,Vt,f.paint,te.zoom,it,[wt])}},heatmap:function(y,a,f,v){if(f.paint.get("heatmap-opacity")!==0)if(y.renderPass==="offscreen"){const S=y.context,T=S.gl,N=o.StencilMode.disabled,z=new o.ColorMode([T.ONE,T.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(Le,Xe,Ue,Ze){const _e=Le.gl,$e=Xe.width*Ze,it=Xe.height*Ze;Le.activeTexture.set(_e.TEXTURE1),Le.viewport.set([0,0,$e,it]);let st=Ue.heatmapFbo;if(!st||st&&(st.width!==$e||st.height!==it)){st&&st.destroy();const bt=_e.createTexture();_e.bindTexture(_e.TEXTURE_2D,bt),_e.texParameteri(_e.TEXTURE_2D,_e.TEXTURE_WRAP_S,_e.CLAMP_TO_EDGE),_e.texParameteri(_e.TEXTURE_2D,_e.TEXTURE_WRAP_T,_e.CLAMP_TO_EDGE),_e.texParameteri(_e.TEXTURE_2D,_e.TEXTURE_MIN_FILTER,_e.LINEAR),_e.texParameteri(_e.TEXTURE_2D,_e.TEXTURE_MAG_FILTER,_e.LINEAR),st=Ue.heatmapFbo=Le.createFramebuffer($e,it,!1),(function(wt,vt,kt,Tt,Vt,vn){const Bt=wt.gl;Bt.texImage2D(Bt.TEXTURE_2D,0,wt.isWebGL2&&wt.extRenderToTextureHalfFloat?Bt.RGBA16F:Bt.RGBA,Vt,vn,0,Bt.RGBA,wt.extRenderToTextureHalfFloat?wt.isWebGL2?Bt.HALF_FLOAT:wt.extTextureHalfFloat.HALF_FLOAT_OES:Bt.UNSIGNED_BYTE,null),Tt.colorAttachment.set(kt)})(Le,0,bt,st,$e,it)}else _e.bindTexture(_e.TEXTURE_2D,st.colorAttachment.get()),Le.bindFramebuffer.set(st.framebuffer)})(S,y,f,y.transform.projection.name==="globe"?.5:.25),S.clear({color:o.Color.transparent});const G=y.transform,Q=G.projection.name==="globe",te=Q?["PROJECTION_GLOBE_VIEW"]:null,ge=Q?o.CullFaceMode.frontCCW:o.CullFaceMode.disabled,Ae=[o.mercatorXfromLng(G.center.lng),o.mercatorYfromLat(G.center.lat)];for(let Le=0;Le<v.length;Le++){const Xe=v[Le];if(a.hasRenderableParent(Xe))continue;const Ue=a.getTile(Xe),Ze=Ue.getBucket(f);if(!Ze||Ze.projection.name!==G.projection.name)continue;const _e=Ze.programConfigurations.get(f.id),$e=y.useProgram("heatmap",_e,te),{zoom:it}=y.transform;y.terrain&&y.terrain.setupElevationDraw(Ue,$e),y.prepareDrawProgram(S,$e,Xe.toUnwrapped());const st=G.projection.createInversionMatrix(G,Xe.canonical);$e.draw(S,T.TRIANGLES,o.DepthMode.disabled,N,z,ge,dl(y,Xe,Ue,st,Ae,it,f.paint.get("heatmap-intensity")),f.id,Ze.layoutVertexBuffer,Ze.indexBuffer,Ze.segments,f.paint,y.transform.zoom,_e,Q?[Ze.globeExtVertexBuffer]:null)}S.viewport.set([0,0,y.width,y.height])}else y.renderPass==="translucent"&&(y.context.setColorMode(y.colorModeForRenderPass()),(function(S,T){const N=S.context,z=N.gl,G=T.heatmapFbo;if(!G)return;N.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,G.colorAttachment.get()),N.activeTexture.set(z.TEXTURE1);let Q=T.colorRampTexture;Q||(Q=T.colorRampTexture=new o.Texture(N,T.colorRamp,z.RGBA)),Q.bind(z.LINEAR,z.CLAMP_TO_EDGE),S.useProgram("heatmapTexture").draw(N,z.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,S.colorModeForRenderPass(),o.CullFaceMode.disabled,((te,ge,Ae,Le)=>({u_image:0,u_color_ramp:1,u_opacity:ge.paint.get("heatmap-opacity")}))(0,T),T.id,S.viewportBuffer,S.quadTriangleIndexBuffer,S.viewportSegments,T.paint,S.transform.zoom)})(y,f))},line:function(y,a,f,v){if(y.renderPass!=="translucent")return;const S=f.paint.get("line-opacity"),T=f.paint.get("line-width");if(S.constantOr(1)===0||T.constantOr(1)===0)return;const N=y.depthModeForSublayer(0,o.DepthMode.ReadOnly),z=y.colorModeForRenderPass(),G=y.terrain&&y.terrain.renderingToTexture?1:o.exported.devicePixelRatio,Q=f.paint.get("line-dasharray"),te=Q.constantOr(1),ge=f.layout.get("line-cap"),Ae=f.paint.get("line-pattern"),Le=Ae.constantOr(1),Xe=f.paint.get("line-gradient"),Ue=Le?"linePattern":"line",Ze=y.context,_e=Ze.gl,$e=(st=>{const bt=[];ts(st)&&bt.push("RENDER_LINE_DASH"),st.paint.get("line-gradient")&&bt.push("RENDER_LINE_GRADIENT");const wt=st.paint.get("line-trim-offset");wt[0]===0&&wt[1]===0||bt.push("RENDER_LINE_TRIM_OFFSET");const vt=st.paint.get("line-pattern").constantOr(1),kt=st.paint.get("line-opacity").constantOr(1)!==1;return!vt&&kt&&bt.push("RENDER_LINE_ALPHA_DISCARD"),bt})(f);let it=$e.includes("RENDER_LINE_ALPHA_DISCARD");y.terrain&&y.terrain.clipOrMaskOverlapStencilType()&&(it=!1);for(const st of v){const bt=a.getTile(st);if(Le&&!bt.patternsLoaded())continue;const wt=bt.getBucket(f);if(!wt)continue;y.prepareDrawTile();const vt=wt.programConfigurations.get(f.id),kt=y.useProgram(Ue,vt,$e),Tt=Ae.constantOr(null);if(Tt&&bt.imageAtlas){const rn=bt.imageAtlas.patternPositions[Tt.toString()];rn&&vt.setConstantPatternPositions(rn)}const Vt=Q.constantOr(null),vn=ge.constantOr(null);if(!Le&&Vt&&vn&&bt.lineAtlas){const rn=bt.lineAtlas.getDash(Vt,vn);rn&&vt.setConstantPatternPositions(rn)}let[Bt,ln]=f.paint.get("line-trim-offset");(vn==="round"||vn==="square")&&Bt!==ln&&(Bt===0&&(Bt-=1),ln===1&&(ln+=1));const Wt=y.terrain?st.projMatrix:null,Cn=Le?ks(y,bt,f,Wt,G):xc(y,bt,f,Wt,wt.lineClipsArray.length,G,[Bt,ln]);if(Xe){const rn=wt.gradients[f.id];let Tn=rn.texture;if(f.gradientVersion!==rn.version){let cn=256;if(f.stepInterpolant){const Nn=a.getSource().maxzoom,hr=st.canonical.z===Nn?Math.ceil(1<<y.transform.maxZoom-st.canonical.z):1;cn=o.clamp(o.nextPowerOfTwo(wt.maxLineLength/o.EXTENT*1024*hr),256,Ze.maxTextureSize)}rn.gradient=o.renderColorRamp({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:cn,image:rn.gradient||void 0,clips:wt.lineClipsArray}),rn.texture?rn.texture.update(rn.gradient):rn.texture=new o.Texture(Ze,rn.gradient,_e.RGBA),rn.version=f.gradientVersion,Tn=rn.texture}Ze.activeTexture.set(_e.TEXTURE1),Tn.bind(f.stepInterpolant?_e.NEAREST:_e.LINEAR,_e.CLAMP_TO_EDGE)}te&&(Ze.activeTexture.set(_e.TEXTURE0),bt.lineAtlasTexture.bind(_e.LINEAR,_e.REPEAT),vt.updatePaintBuffers()),Le&&(Ze.activeTexture.set(_e.TEXTURE0),bt.imageAtlasTexture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE),vt.updatePaintBuffers()),y.prepareDrawProgram(Ze,kt,st.toUnwrapped());const Ut=rn=>{kt.draw(Ze,_e.TRIANGLES,N,rn,z,o.CullFaceMode.disabled,Cn,f.id,wt.layoutVertexBuffer,wt.indexBuffer,wt.segments,f.paint,y.transform.zoom,vt,[wt.layoutVertexBuffer2])};if(it){const rn=y.stencilModeForClipping(st).ref;rn===0&&y.terrain&&Ze.clear({stencil:0});const Tn={func:_e.EQUAL,mask:255};Cn.u_alpha_discard_threshold=.8,Ut(new o.StencilMode(Tn,rn,255,_e.KEEP,_e.KEEP,_e.INVERT)),Cn.u_alpha_discard_threshold=0,Ut(new o.StencilMode(Tn,rn,255,_e.KEEP,_e.KEEP,_e.KEEP))}else Ut(y.stencilModeForClipping(st))}it&&(y.resetStencilClippingMasks(),y.terrain&&Ze.clear({stencil:0}))},fill:function(y,a,f,v){const S=f.paint.get("fill-color"),T=f.paint.get("fill-opacity");if(T.constantOr(1)===0)return;const N=y.colorModeForRenderPass(),z=f.paint.get("fill-pattern"),G=y.opaquePassEnabledForLayer()&&!z.constantOr(1)&&S.constantOr(o.Color.transparent).a===1&&T.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===G){const Q=y.depthModeForSublayer(1,y.renderPass==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly);lo(y,a,f,v,Q,N,!1)}if(y.renderPass==="translucent"&&f.paint.get("fill-antialias")){const Q=y.depthModeForSublayer(f.getPaintProperty("fill-outline-color")?2:0,o.DepthMode.ReadOnly);lo(y,a,f,v,Q,N,!0)}},"fill-extrusion":function(y,a,f,v){const S=f.paint.get("fill-extrusion-opacity");if(S!==0&&y.renderPass==="translucent"){const T=new o.DepthMode(y.context.gl.LEQUAL,o.DepthMode.ReadWrite,y.depthRangeFor3D);if(S!==1||f.paint.get("fill-extrusion-pattern").constantOr(1))Al(y,a,f,v,T,o.StencilMode.disabled,o.ColorMode.disabled),Al(y,a,f,v,T,y.stencilModeFor3D(),y.colorModeForRenderPass()),y.resetStencilClippingMasks();else{const N=y.colorModeForRenderPass();Al(y,a,f,v,T,o.StencilMode.disabled,N)}}},hillshade:function(y,a,f,v){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;const S=y.context,T=y.depthModeForSublayer(0,o.DepthMode.ReadOnly),N=y.colorModeForRenderPass(),z=y.terrain&&y.terrain.renderingToTexture,[G,Q]=y.renderPass!=="translucent"||z?[{},v]:y.stencilConfigForOverlap(v);for(const te of Q){const ge=a.getTile(te);if(ge.needsHillshadePrepare&&y.renderPass==="offscreen")Ti(y,ge,f,T,o.StencilMode.disabled,N);else if(y.renderPass==="translucent"){const Ae=z&&y.terrain?y.terrain.stencilModeForRTTOverlap(te):G[te.overscaledZ];Hr(y,te,ge,f,T,Ae,N)}}S.viewport.set([0,0,y.width,y.height]),y.resetStencilClippingMasks()},raster:function(y,a,f,v,S,T){if(y.renderPass!=="translucent"||f.paint.get("raster-opacity")===0||!v.length)return;const N=y.context,z=N.gl,G=a.getSource(),Q=y.useProgram("raster"),te=y.colorModeForRenderPass(),ge=y.terrain&&y.terrain.renderingToTexture,[Ae,Le]=G instanceof Lr||ge?[{},v]:y.stencilConfigForOverlap(v),Xe=Le[Le.length-1].overscaledZ,Ue=!y.options.moving;for(const Ze of Le){const _e=ge?o.DepthMode.disabled:y.depthModeForSublayer(Ze.overscaledZ-Xe,f.paint.get("raster-opacity")===1?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly,z.LESS),$e=Ze.toUnwrapped(),it=a.getTile(Ze);if(ge&&(!it||!it.hasData()))continue;const st=ge?Ze.projMatrix:y.transform.calculateProjMatrix($e,Ue),bt=y.terrain&&ge?y.terrain.stencilModeForRTTOverlap(Ze):Ae[Ze.overscaledZ],wt=T?0:f.paint.get("raster-fade-duration");it.registerFadeDuration(wt);const vt=a.findLoadedParent(Ze,0),kt=Fc(it,vt,a,y.transform,wt);let Tt,Vt;y.terrain&&y.terrain.prepareDrawTile();const vn=f.paint.get("raster-resampling")==="nearest"?z.NEAREST:z.LINEAR;N.activeTexture.set(z.TEXTURE0),it.texture.bind(vn,z.CLAMP_TO_EDGE),N.activeTexture.set(z.TEXTURE1),vt?(vt.texture.bind(vn,z.CLAMP_TO_EDGE),Tt=Math.pow(2,vt.tileID.overscaledZ-it.tileID.overscaledZ),Vt=[it.tileID.canonical.x*Tt%1,it.tileID.canonical.y*Tt%1]):it.texture.bind(vn,z.CLAMP_TO_EDGE),it.texture.useMipmap&&N.extTextureFilterAnisotropic&&y.transform.pitch>20&&z.texParameterf(z.TEXTURE_2D,N.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,N.extTextureFilterAnisotropicMax);const Bt=Ws(st,Vt||[0,0],Tt||1,kt,f,G instanceof Lr?G.perspectiveTransform:[0,0]);if(y.prepareDrawProgram(N,Q,$e),G instanceof Lr)G.boundsBuffer&&G.boundsSegments&&Q.draw(N,z.TRIANGLES,_e,o.StencilMode.disabled,te,o.CullFaceMode.disabled,Bt,f.id,G.boundsBuffer,y.quadTriangleIndexBuffer,G.boundsSegments);else{const{tileBoundsBuffer:ln,tileBoundsIndexBuffer:Wt,tileBoundsSegments:Cn}=y.getTileBoundsBuffers(it);Q.draw(N,z.TRIANGLES,_e,bt,te,o.CullFaceMode.disabled,Bt,f.id,ln,Wt,Cn)}}y.resetStencilClippingMasks()},background:function(y,a,f,v){const S=f.paint.get("background-color"),T=f.paint.get("background-opacity");if(T===0)return;const N=y.context,z=N.gl,G=y.transform,Q=G.tileSize,te=f.paint.get("background-pattern");if(y.isPatternMissing(te))return;const ge=!te&&S.a===1&&T===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==ge)return;const Ae=o.StencilMode.disabled,Le=y.depthModeForSublayer(0,ge==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly),Xe=y.colorModeForRenderPass(),Ue=y.useProgram(te?"backgroundPattern":"background");let Ze,_e=v;_e||(Ze=y.getBackgroundTiles(),_e=Object.values(Ze).map(($e=>$e.tileID))),te&&(N.activeTexture.set(z.TEXTURE0),y.imageManager.bind(y.context));for(const $e of _e){const it=$e.toUnwrapped(),st=v?$e.projMatrix:y.transform.calculateProjMatrix(it);y.prepareDrawTile();const bt=a?a.getTile($e):Ze?Ze[$e.key]:new o.Tile($e,Q,G.zoom,y),wt=te?yu(st,T,y,te,{tileID:$e,tileSize:Q}):Ks(st,T,S);y.prepareDrawProgram(N,Ue,it);const{tileBoundsBuffer:vt,tileBoundsIndexBuffer:kt,tileBoundsSegments:Tt}=y.getTileBoundsBuffers(bt);Ue.draw(N,z.TRIANGLES,Le,Ae,Xe,o.CullFaceMode.disabled,wt,f.id,vt,kt,Tt)}},sky:function(y,a,f){const v=y.transform,S=v.projection.name==="mercator"||v.projection.name==="globe"?1:o.smoothstep(7,8,v.zoom),T=f.paint.get("sky-opacity")*S;if(T===0)return;const N=y.context,z=f.paint.get("sky-type"),G=new o.DepthMode(N.gl.LEQUAL,o.DepthMode.ReadOnly,[0,1]),Q=y.frameCounter/1e3%1;z==="atmosphere"?y.renderPass==="offscreen"?f.needsSkyboxCapture(y)&&((function(te,ge,Ae,Le){const Xe=te.context,Ue=Xe.gl;let Ze=ge.skyboxFbo;if(!Ze){Ze=ge.skyboxFbo=Xe.createFramebuffer(32,32,!1),ge.skyboxGeometry=new zc(Xe),ge.skyboxTexture=Xe.gl.createTexture(),Ue.bindTexture(Ue.TEXTURE_CUBE_MAP,ge.skyboxTexture),Ue.texParameteri(Ue.TEXTURE_CUBE_MAP,Ue.TEXTURE_WRAP_S,Ue.CLAMP_TO_EDGE),Ue.texParameteri(Ue.TEXTURE_CUBE_MAP,Ue.TEXTURE_WRAP_T,Ue.CLAMP_TO_EDGE),Ue.texParameteri(Ue.TEXTURE_CUBE_MAP,Ue.TEXTURE_MIN_FILTER,Ue.LINEAR),Ue.texParameteri(Ue.TEXTURE_CUBE_MAP,Ue.TEXTURE_MAG_FILTER,Ue.LINEAR);for(let st=0;st<6;++st)Ue.texImage2D(Ue.TEXTURE_CUBE_MAP_POSITIVE_X+st,0,Ue.RGBA,32,32,0,Ue.RGBA,Ue.UNSIGNED_BYTE,null)}Xe.bindFramebuffer.set(Ze.framebuffer),Xe.viewport.set([0,0,32,32]);const _e=ge.getCenter(te,!0),$e=te.useProgram("skyboxCapture"),it=new Float64Array(16);o.identity(it),o.rotateY(it,it,.5*-Math.PI),Xs(Xe,ge,$e,it,_e,0),o.identity(it),o.rotateY(it,it,.5*Math.PI),Xs(Xe,ge,$e,it,_e,1),o.identity(it),o.rotateX(it,it,.5*-Math.PI),Xs(Xe,ge,$e,it,_e,2),o.identity(it),o.rotateX(it,it,.5*Math.PI),Xs(Xe,ge,$e,it,_e,3),o.identity(it),Xs(Xe,ge,$e,it,_e,4),o.identity(it),o.rotateY(it,it,Math.PI),Xs(Xe,ge,$e,it,_e,5),Xe.viewport.set([0,0,te.width,te.height])})(y,f),f.markSkyboxValid(y)):y.renderPass==="sky"&&(function(te,ge,Ae,Le,Xe){const Ue=te.context,Ze=Ue.gl,_e=te.transform,$e=te.useProgram("skybox");Ue.activeTexture.set(Ze.TEXTURE0),Ze.bindTexture(Ze.TEXTURE_CUBE_MAP,ge.skyboxTexture);const it=((st,bt,wt,vt,kt)=>({u_matrix:st,u_sun_direction:bt,u_cubemap:0,u_opacity:vt,u_temporal_offset:kt}))(_e.skyboxMatrix,ge.getCenter(te,!1),0,Le,Xe);te.prepareDrawProgram(Ue,$e),$e.draw(Ue,Ze.TRIANGLES,Ae,o.StencilMode.disabled,te.colorModeForRenderPass(),o.CullFaceMode.backCW,it,"skybox",ge.skyboxGeometry.vertexBuffer,ge.skyboxGeometry.indexBuffer,ge.skyboxGeometry.segment)})(y,f,G,T,Q):z==="gradient"&&y.renderPass==="sky"&&(function(te,ge,Ae,Le,Xe){const Ue=te.context,Ze=Ue.gl,_e=te.transform,$e=te.useProgram("skyboxGradient");ge.skyboxGeometry||(ge.skyboxGeometry=new zc(Ue)),Ue.activeTexture.set(Ze.TEXTURE0);let it=ge.colorRampTexture;it||(it=ge.colorRampTexture=new o.Texture(Ue,ge.colorRamp,Ze.RGBA)),it.bind(Ze.LINEAR,Ze.CLAMP_TO_EDGE);const st=((bt,wt,vt,kt,Tt)=>({u_matrix:bt,u_color_ramp:0,u_center_direction:wt,u_radius:o.degToRad(vt),u_opacity:kt,u_temporal_offset:Tt}))(_e.skyboxMatrix,ge.getCenter(te,!1),ge.paint.get("sky-gradient-radius"),Le,Xe);te.prepareDrawProgram(Ue,$e),$e.draw(Ue,Ze.TRIANGLES,Ae,o.StencilMode.disabled,te.colorModeForRenderPass(),o.CullFaceMode.backCW,st,"skyboxGradient",ge.skyboxGeometry.vertexBuffer,ge.skyboxGeometry.indexBuffer,ge.skyboxGeometry.segment)})(y,f,G,T,Q)},debug:function(y,a,f){for(let v=0;v<f.length;v++)_u(y,a,f[v])},custom:function(y,a,f,v){const S=y.context,T=f.implementation;if(!y.transform.projection.unsupportedLayers||!y.transform.projection.unsupportedLayers.includes("custom")||y.terrain&&(y.terrain.renderingToTexture||y.renderPass==="offscreen")&&f.isLayerDraped()){if(y.renderPass==="offscreen"){const N=T.prerender;if(N){if(y.setCustomLayerDefaults(),S.setColorMode(y.colorModeForRenderPass()),y.transform.projection.name==="globe"){const z=y.transform.pointMerc;N.call(T,S.gl,y.transform.customLayerMatrix(),y.transform.getProjection(),y.transform.globeToMercatorMatrix(),o.globeToMercatorTransition(y.transform.zoom),[z.x,z.y],y.transform.pixelsPerMeterRatio)}else N.call(T,S.gl,y.transform.customLayerMatrix());S.setDirty(),y.setBaseState()}}else if(y.renderPass==="translucent"){if(y.terrain&&y.terrain.renderingToTexture){const z=T.renderToTile;if(z){const G=v[0].canonical,Q=new o.MercatorCoordinate(G.x+v[0].wrap*(1<<G.z),G.y,G.z);S.setDepthMode(o.DepthMode.disabled),S.setStencilMode(o.StencilMode.disabled),S.setColorMode(y.colorModeForRenderPass()),y.setCustomLayerDefaults(),z.call(T,S.gl,Q),S.setDirty(),y.setBaseState()}return}y.setCustomLayerDefaults(),S.setColorMode(y.colorModeForRenderPass()),S.setStencilMode(o.StencilMode.disabled);const N=T.renderingMode==="3d"?new o.DepthMode(y.context.gl.LEQUAL,o.DepthMode.ReadWrite,y.depthRangeFor3D):y.depthModeForSublayer(0,o.DepthMode.ReadOnly);if(S.setDepthMode(N),y.transform.projection.name==="globe"){const z=y.transform.pointMerc;T.render(S.gl,y.transform.customLayerMatrix(),y.transform.getProjection(),y.transform.globeToMercatorMatrix(),o.globeToMercatorTransition(y.transform.zoom),[z.x,z.y],y.transform.pixelsPerMeterRatio)}else T.render(S.gl,y.transform.customLayerMatrix());S.setDirty(),y.setBaseState(),S.bindFramebuffer.set(null)}}else o.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class As{constructor(a,f,v=!1){this.context=new xn(a,v),this.transform=f,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=o.SourceCache.maxUnderzooming+o.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(a,f){const v=!!a&&!!a.terrain&&this.transform.projection.supportsTerrain;if(!(v||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new ve(this,a));const S=this._terrain;this.transform.elevation=v?S:null,S.update(a,this.transform,f)}_updateFog(a){const f=a.fog;if(!f||this.transform.projection.name==="globe"||f.getOpacity(this.transform.pitch)<1||f.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[v,S]=f.getFovAdjustedRange(this.transform._fov);if(v>S)return void(this.transform.fogCullDistSq=null);const T=v+.78*(S-v);this.transform.fogCullDistSq=T*T}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(a,f){if(this.width=a*o.exported.devicePixelRatio,this.height=f*o.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const v of this.style.order)this.style._layers[v].resize()}setup(){const a=this.context,f=new o.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(o.EXTENT,0),f.emplaceBack(0,o.EXTENT),f.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=a.createVertexBuffer(f,o.posAttributes.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const v=new o.StructArrayLayout2i4;v.emplaceBack(0,0),v.emplaceBack(o.EXTENT,0),v.emplaceBack(0,o.EXTENT),v.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=a.createVertexBuffer(v,o.posAttributes.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const S=new o.StructArrayLayout2i4;S.emplaceBack(-1,-1),S.emplaceBack(1,-1),S.emplaceBack(-1,1),S.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(S,o.posAttributes.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const T=new o.StructArrayLayout4i8;T.emplaceBack(0,0,0,0),T.emplaceBack(o.EXTENT,0,o.EXTENT,0),T.emplaceBack(0,o.EXTENT,0,o.EXTENT),T.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.mercatorBoundsBuffer=a.createVertexBuffer(T,o.boundsAttributes.members),this.mercatorBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const N=new o.StructArrayLayout3ui6;N.emplaceBack(0,1,2),N.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(N);const z=new o.StructArrayLayout1ui2;for(const Q of[0,1,3,2,0])z.emplaceBack(Q);this.debugIndexBuffer=a.createIndexBuffer(z),this.emptyTexture=new o.Texture(a,new o.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),a.gl.RGBA),this.identityMat=o.create();const G=this.context.gl;this.stencilClearMode=new o.StencilMode({func:G.ALWAYS,mask:0},0,255,G.ZERO,G.ZERO,G.ZERO),this.loadTimeStamps.push(o.window.performance.now()),this.atmosphereBuffer=new Sc(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(a){return a._makeTileBoundsBuffers(this.context,this.transform.projection),a._tileBoundsBuffer?{tileBoundsBuffer:a._tileBoundsBuffer,tileBoundsIndexBuffer:a._tileBoundsIndexBuffer,tileBoundsSegments:a._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const a=this.context,f=a.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(a,f.TRIANGLES,o.DepthMode.disabled,this.stencilClearMode,o.ColorMode.disabled,o.CullFaceMode.disabled,Es(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(a,f,v){if(!f||this.currentStencilSource===f.id||!a.isTileClipped()||!v||v.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let z=!1;for(const G of v)if(this._tileClippingMaskIDs[G.key]===void 0){z=!0;break}if(!z)return}this.currentStencilSource=f.id;const S=this.context,T=S.gl;this.nextStencilID+v.length>256&&this.clearStencil(),S.setColorMode(o.ColorMode.disabled),S.setDepthMode(o.DepthMode.disabled);const N=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const z of v){const G=f.getTile(z),Q=this._tileClippingMaskIDs[z.key]=this.nextStencilID++,{tileBoundsBuffer:te,tileBoundsIndexBuffer:ge,tileBoundsSegments:Ae}=this.getTileBoundsBuffers(G);N.draw(S,T.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:T.ALWAYS,mask:0},Q,255,T.KEEP,T.KEEP,T.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,Es(z.projMatrix),"$clipping",te,ge,Ae)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,f=this.context.gl;return new o.StencilMode({func:f.NOTEQUAL,mask:255},a,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(a){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(a);const f=this.context.gl;return new o.StencilMode({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,f.KEEP,f.KEEP,f.REPLACE)}stencilConfigForOverlap(a){const f=this.context.gl,v=a.sort(((N,z)=>z.overscaledZ-N.overscaledZ)),S=v[v.length-1].overscaledZ,T=v[0].overscaledZ-S+1;if(T>1){this.currentStencilSource=void 0,this.nextStencilID+T>256&&this.clearStencil();const N={};for(let z=0;z<T;z++)N[z+S]=new o.StencilMode({func:f.GEQUAL,mask:255},z+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=T,[N,v]}return[{[S]:o.StencilMode.disabled},v]}colorModeForRenderPass(){const a=this.context.gl;return this._showOverdrawInspector?new o.ColorMode([a.CONSTANT_COLOR,a.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?o.ColorMode.unblended:o.ColorMode.alphaBlended}depthModeForSublayer(a,f,v){if(!this.opaquePassEnabledForLayer())return o.DepthMode.disabled;const S=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new o.DepthMode(v||this.context.gl.LEQUAL,f,[S,S])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(a,f){this.style=a,this.options=f,this.imageManager=a.imageManager,this.glyphManager=a.glyphManager,this.symbolFadeChange=a.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const v=this.style.order,S=this.style._sourceCaches;for(const Q in S){const te=S[Q];te.used&&te.prepare(this.context)}const T={},N={},z={};for(const Q in S){const te=S[Q];T[Q]=te.getVisibleCoordinates(),N[Q]=T[Q].slice().reverse(),z[Q]=te.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let Q=0;Q<v.length;Q++)if(this.style._layers[v[Q]].is3D()){this.opaquePassCutoff=Q;break}if(this.terrain&&(this.terrain.updateTileBinding(z),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.GlobeSharedBuffers(this.context)),!o.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const Q of v){const te=this.style._layers[Q],ge=a._getLayerSourceCache(te);if(!te.hasOffscreenPass()||te.isHidden(this.transform.zoom))continue;const Ae=ge?N[ge.id]:void 0;(te.type==="custom"||te.isSky()||Ae&&Ae.length)&&this.renderLayer(this,ge,te,Ae)}this.depthRangeFor3D=[0,1-(a.order.length+2)*this.numSublayers*this.depthEpsilon];const G=this.terrain;if(G&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&G.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:f.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){const Q=this.style._layers[v[this.currentLayer]],te=a._getLayerSourceCache(Q);if(Q.isSky())continue;const ge=te?N[te.id]:void 0;this._renderTileClippingMasks(Q,te,ge),this.renderLayer(this,te,Q,ge)}if(this.style.fog&&this.transform.projection.supportsFog&&(function(Q,te){const ge=Q.context,Ae=ge.gl,Le=Q.transform,Xe=new o.DepthMode(Ae.LEQUAL,o.DepthMode.ReadOnly,[0,1]),Ue=Q.useProgram("globeAtmosphere",null,Le.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Ze=o.globeToMercatorTransition(Le.zoom),_e=te.properties.get("color").toArray01(),$e=te.properties.get("high-color").toArray01(),it=te.properties.get("space-color").toArray01PremultipliedAlpha(),st=o.identity$1([]);o.rotateY$1(st,st,-o.degToRad(Le._center.lng)),o.rotateX$1(st,st,o.degToRad(Le._center.lat)),o.rotateZ$1(st,st,Le.angle),o.rotateX$1(st,st,-Le._pitch);const bt=o.fromQuat(new Float32Array(16),st),wt=o.mapValue(te.properties.get("star-intensity"),0,1,0,.25),vt=5e-4,kt=o.mapValue(te.properties.get("horizon-blend"),0,1,vt,.25),Tt=o.globeUseCustomAntiAliasing(Q,ge,Le)&&kt===vt?Le.worldSize/(2*Math.PI*1.025)-1:Le.globeRadius,Vt=Q.frameCounter/1e3%1,vn=o.length(Le.globeCenterInViewSpace),Bt=Math.sqrt(Math.pow(vn,2)-Math.pow(Tt,2)),ln=Math.acos(Bt/vn),Wt=((Ut,rn,Tn,cn,Nn,hr,Dr,rr,Jn,ni,mi,xr,Ii,Ci)=>({u_frustum_tl:Ut,u_frustum_tr:rn,u_frustum_br:Tn,u_frustum_bl:cn,u_horizon:Nn,u_transition:hr,u_fadeout_range:Dr,u_color:rr,u_high_color:Jn,u_space_color:ni,u_star_intensity:mi,u_star_size:5*o.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:xr,u_horizon_angle:Ii,u_rotation_matrix:Ci}))(Le.frustumCorners.TL,Le.frustumCorners.TR,Le.frustumCorners.BR,Le.frustumCorners.BL,Le.frustumCorners.horizon,Ze,kt,_e,$e,it,wt,Vt,ln,bt);Q.prepareDrawProgram(ge,Ue);const Cn=Q.atmosphereBuffer;Cn&&Ue.draw(ge,Ae.TRIANGLES,Xe,o.StencilMode.disabled,o.ColorMode.alphaBlended,o.CullFaceMode.backCW,Wt,"skybox",Cn.vertexBuffer,Cn.indexBuffer,Cn.segments)})(this,this.style.fog),this.renderPass="sky",(o.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){const Q=this.style._layers[v[this.currentLayer]],te=a._getLayerSourceCache(Q);Q.isSky()&&this.renderLayer(this,te,Q,te?N[te.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<v.length;){const Q=this.style._layers[v[this.currentLayer]],te=a._getLayerSourceCache(Q);if(Q.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(Q)){if(Q.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const ge=te?(Q.type==="symbol"?z:N)[te.id]:void 0;this._renderTileClippingMasks(Q,te,te?T[te.id]:void 0),this.renderLayer(this,te,Q,ge),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Q=null;o.values(this.style._layers).forEach((te=>{const ge=a._getLayerSourceCache(te);ge&&!te.isHidden(this.transform.zoom)&&(!Q||Q.getSource().maxzoom<ge.getSource().maxzoom)&&(Q=ge)})),Q&&this.options.showTileBoundaries&&fl.debug(this,Q,Q.getVisibleCoordinates())}this.options.showPadding&&(function(Q){const te=Q.transform.padding;tu(Q,Q.transform.height-(te.top||0),3,So),tu(Q,te.bottom||0,3,la),Mu(Q,te.left||0,3,ca),Mu(Q,Q.transform.width-(te.right||0),3,Bc);const ge=Q.transform.centerPoint;(function(Ae,Le,Xe,Ue){nu(Ae,Le-1,Xe-10,2,20,Ue),nu(Ae,Le-10,Xe-1,20,2,Ue)})(Q,ge.x,Q.transform.height-ge.y,kh)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(o.window.performance.now()),this.saveCanvasCopy())}renderLayer(a,f,v,S){v.isHidden(this.transform.zoom)||(v.type==="background"||v.type==="sky"||v.type==="custom"||S&&S.length)&&(this.id=v.id,this.gpuTimingStart(v),(!a.transform.projection.unsupportedLayers||!a.transform.projection.unsupportedLayers.includes(v.type)||a.terrain&&v.type==="custom")&&fl[v.type](a,f,v,S,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(a){if(!this.options.gpuTiming)return;const f=this.context.extTimerQuery;let v=this.gpuTimers[a.id];v||(v=this.gpuTimers[a.id]={calls:0,cpuTime:0,query:f.createQueryEXT()}),v.calls++,f.beginQueryEXT(f.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const a=this.context.extTimerQuery,f=a.createQueryEXT();this.deferredRenderGpuTimeQueries.push(f),a.beginQueryEXT(a.TIME_ELAPSED_EXT,f)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}collectGpuTimers(){const a=this.gpuTimers;return this.gpuTimers={},a}collectDeferredRenderGpuQueries(){const a=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],a}queryGpuTimers(a){const f={};for(const v in a){const S=a[v],T=this.context.extTimerQuery,N=T.getQueryObjectEXT(S.query,T.QUERY_RESULT_EXT)/1e6;T.deleteQueryEXT(S.query),f[v]=N}return f}queryGpuTimeDeferredRender(a){if(!this.options.gpuTimingDeferredRender)return 0;const f=this.context.extTimerQuery;let v=0;for(const S of a)v+=f.getQueryObjectEXT(S,f.QUERY_RESULT_EXT)/1e6,f.deleteQueryEXT(S);return v}translatePosMatrix(a,f,v,S,T){if(!v[0]&&!v[1])return a;const N=T?S==="map"?this.transform.angle:0:S==="viewport"?-this.transform.angle:0;if(N){const Q=Math.sin(N),te=Math.cos(N);v=[v[0]*te-v[1]*Q,v[0]*Q+v[1]*te]}const z=[T?v[0]:le(f,v[0],this.transform.zoom),T?v[1]:le(f,v[1],this.transform.zoom),0],G=new Float32Array(16);return o.translate(G,a,z),G}saveTileTexture(a){const f=this._tileTextures[a.size[0]];f?f.push(a):this._tileTextures[a.size[0]]=[a]}getTileTexture(a){const f=this._tileTextures[a];return f&&f.length>0?f.pop():null}isPatternMissing(a){return a===null||a!==void 0&&!this.imageManager.getPattern(a.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const a=this.terrain&&this.terrain.renderingToTexture,f=this.terrain&&this.terrain.exaggeration()===0,v=this.style&&this.style.fog,S=[];return this.terrainRenderModeElevated()&&S.push("TERRAIN"),this.transform.projection.name==="globe"&&S.push("GLOBE"),f&&S.push("ZERO_EXAGGERATION"),v&&!a&&v.getOpacity(this.transform.pitch)!==0&&S.push("FOG"),a&&S.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&S.push("OVERDRAW_INSPECTOR"),S}useProgram(a,f,v){this.cache=this.cache||{};const S=v||[],T=this.currentGlobalDefines().concat(S),N=He.cacheKey(yt[a],a,T,f);return this.cache[N]||(this.cache[N]=new He(this.context,a,yt[a],f,bc[a],T)),this.cache[N]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(a,f,v){if(this.terrain&&this.terrain.renderingToTexture)return;const S=this.style.fog;if(S){const T=S.getOpacity(this.transform.pitch),N=((z,G,Q,te,ge,Ae,Le,Xe,Ue,Ze,_e)=>{const $e=z.transform,it=G.properties.get("color").toArray01();it[3]=te;const st=z.frameCounter/1e3%1;return{u_fog_matrix:Q?$e.calculateFogTileMatrix(Q):z.identityMat,u_fog_range:G.getFovAdjustedRange($e._fov),u_fog_color:it,u_fog_horizon_blend:G.properties.get("horizon-blend"),u_fog_temporal_offset:st,u_frustum_tl:ge,u_frustum_tr:Ae,u_frustum_br:Le,u_frustum_bl:Xe,u_globe_pos:Ue,u_globe_radius:Ze,u_viewport:_e,u_globe_transition:o.globeToMercatorTransition($e.zoom),u_is_globe:+($e.projection.name==="globe")}})(this,S,v,T,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.exported.devicePixelRatio,this.transform.height*o.exported.devicePixelRatio]);f.setFogUniformValues(a,N)}}setTileLoadedFlag(a){this.tileLoaded=a}saveCanvasCopy(){const a=this.canvasCopy();a&&(this.frameCopies.push(a),this.tileLoaded=!1)}canvasCopy(){const a=this.context.gl,f=a.createTexture();return a.bindTexture(a.TEXTURE_2D,f),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,a.drawingBufferWidth,a.drawingBufferHeight,0),f}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const a=this.style&&this.style.fog;return!!a&&a.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const a=this._backgroundTiles,f=this._backgroundTiles={},v=this.transform.coveringTiles({tileSize:512});for(const S of v)f[S.key]=a[S.key]||new o.Tile(S,512,this.transform.tileZoom,this);return f}clearBackgroundTiles(){this._backgroundTiles={}}}class Yu{constructor(a=0,f=0,v=0,S=0){if(isNaN(a)||a<0||isNaN(f)||f<0||isNaN(v)||v<0||isNaN(S)||S<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=f,this.left=v,this.right=S}interpolate(a,f,v){return f.top!=null&&a.top!=null&&(this.top=o.number(a.top,f.top,v)),f.bottom!=null&&a.bottom!=null&&(this.bottom=o.number(a.bottom,f.bottom,v)),f.left!=null&&a.left!=null&&(this.left=o.number(a.left,f.left,v)),f.right!=null&&a.right!=null&&(this.right=o.number(a.right,f.right,v)),this}getCenter(a,f){const v=o.clamp((this.left+a-this.right)/2,0,a),S=o.clamp((this.top+f-this.bottom)/2,0,f);return new o.Point(v,S)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new Yu(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function $r(y,a){const f=o.getColumn(y,3);o.fromQuat(y,a),o.setColumn(y,3,f)}function co(y,a){const f=o.identity$1([]);return o.rotateZ$1(f,f,-a),o.rotateX$1(f,f,-y),f}function Nu(y,a){const f=[y[0],y[1],0],v=[a[0],a[1],0];if(o.length(f)>=1e-15){const N=o.normalize([],f);o.scale$2(v,N,o.dot(v,N)),a[0]=v[0],a[1]=v[1]}const S=o.cross([],a,y);if(o.len(S)<1e-15)return null;const T=Math.atan2(-S[1],S[0]);return co(Math.atan2(Math.sqrt(y[0]*y[0]+y[1]*y[1]),-y[2]),T)}class Ba{constructor(a,f){this.position=a,this.orientation=f}get position(){return this._position}set position(a){if(a){const f=a instanceof o.MercatorCoordinate?a:new o.MercatorCoordinate(a[0],a[1],a[2]);this._renderWorldCopies&&(f.x=o.wrap(f.x,0,1)),this._position=f}else this._position=null}lookAtPoint(a,f){if(this.orientation=null,!this.position)return;const v=this.position,S=this._elevation?this._elevation.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(a)):0,T=o.MercatorCoordinate.fromLngLat(a,S),N=[T.x-v.x,T.y-v.y,T.z-v.z];f||(f=[0,0,1]),f[2]=Math.abs(f[2]),this.orientation=Nu(N,f)}setPitchBearing(a,f){this.orientation=co(o.degToRad(a),o.degToRad(-f))}}class Ya{constructor(a,f){this._transform=o.identity([]),this.orientation=f,this.position=a}get mercatorPosition(){const a=this.position;return new o.MercatorCoordinate(a[0],a[1],a[2])}get position(){const a=o.getColumn(this._transform,3);return[a[0],a[1],a[2]]}set position(a){var f;a&&o.setColumn(this._transform,3,[(f=a)[0],f[1],f[2],1])}get orientation(){return this._orientation}set orientation(a){this._orientation=a||o.identity$1([]),a&&$r(this._transform,this._orientation)}getPitchBearing(){const a=this.forward(),f=this.right();return{bearing:Math.atan2(-f[1],f[0]),pitch:Math.atan2(Math.sqrt(a[0]*a[0]+a[1]*a[1]),-a[2])}}setPitchBearing(a,f){this._orientation=co(a,f),$r(this._transform,this._orientation)}forward(){const a=o.getColumn(this._transform,2);return[-a[0],-a[1],-a[2]]}up(){const a=o.getColumn(this._transform,1);return[-a[0],-a[1],-a[2]]}right(){const a=o.getColumn(this._transform,0);return[a[0],a[1],a[2]]}getCameraToWorld(a,f){const v=new Float64Array(16);return o.invert(v,this.getWorldToCamera(a,f)),v}getWorldToCameraPosition(a,f,v){const S=this.position;o.scale$2(S,S,-a);const T=new Float64Array(16);return o.fromScaling(T,[v,v,v]),o.translate(T,T,S),T[10]*=f,T}getWorldToCamera(a,f){const v=new Float64Array(16),S=new Float64Array(4),T=this.position;return o.conjugate(S,this._orientation),o.scale$2(T,T,-a),o.fromQuat(v,S),o.translate(v,v,T),v[1]*=-1,v[5]*=-1,v[9]*=-1,v[13]*=-1,v[8]*=f,v[9]*=f,v[10]*=f,v[11]*=f,v}getCameraToClipPerspective(a,f,v,S){const T=new Float64Array(16);return o.perspective(T,a,f,v,S),T}getDistanceToElevation(a,f=!1){const v=a===0?0:o.mercatorZfromAltitude(a,f?o.latFromMercatorY(this.position[1]):this.position[1]),S=this.forward();return(v-this.position[2])/S[2]}clone(){return new Ya([...this.position],[...this.orientation])}}function Ta(y,a){const f=Ec(y.projection,y.zoom,y.width,y.height),v=(function(T,N,z,G,Q){const te=new o.LngLat(z.lng-180*ua,z.lat),ge=new o.LngLat(z.lng+180*ua,z.lat),Ae=T.project(te.lng,te.lat),Le=T.project(ge.lng,ge.lat),Xe=-Math.atan2(Le.y-Ae.y,Le.x-Ae.x),Ue=o.MercatorCoordinate.fromLngLat(z);Ue.y=o.clamp(Ue.y,-1+ua,1-ua);const Ze=Ue.toLngLat(),_e=T.project(Ze.lng,Ze.lat),$e=o.MercatorCoordinate.fromLngLat(Ze);$e.x+=ua;const it=$e.toLngLat(),st=T.project(it.lng,it.lat),bt=jc(st.x-_e.x,st.y-_e.y,Xe),wt=o.MercatorCoordinate.fromLngLat(Ze);wt.y+=ua;const vt=wt.toLngLat(),kt=T.project(vt.lng,vt.lat),Tt=jc(kt.x-_e.x,kt.y-_e.y,Xe),Vt=Math.abs(bt.x)/Math.abs(Tt.y),vn=o.identity([]);o.rotateZ(vn,vn,-Xe*(1-(Q?0:G)));const Bt=o.identity([]);return o.scale(Bt,Bt,[1,1-(1-Vt)*G,1]),Bt[4]=-Tt.x/Tt.y*G,o.rotateZ(Bt,Bt,Xe),o.multiply(Bt,vn,Bt),Bt})(y.projection,0,y.center,f,a),S=Ja(y);return o.scale(v,v,[S,S,1]),v}function Ja(y){const a=y.projection,f=Ec(y.projection,y.zoom,y.width,y.height),v=bh(a,y.center),S=bh(a,o.LngLat.convert(a.center));return Math.pow(2,v*f+(1-f)*S)}function Ec(y,a,f,v,S=1/0){const T=y.range;if(!T)return 0;const N=Math.min(S,Math.max(f,v)),z=Math.log(N/1024)/Math.LN2;return o.smoothstep(T[0]+z,T[1]+z,a)}const ua=1/4e4;function bh(y,a){const f=o.clamp(a.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),v=new o.LngLat(a.lng-180*ua,f),S=new o.LngLat(a.lng+180*ua,f),T=y.project(v.lng,f),N=y.project(S.lng,f),z=o.MercatorCoordinate.fromLngLat(v),G=o.MercatorCoordinate.fromLngLat(S),Q=N.x-T.x,te=N.y-T.y,ge=G.x-z.x,Ae=G.y-z.y,Le=Math.sqrt((ge*ge+Ae*Ae)/(Q*Q+te*te));return Math.log(Le)/Math.LN2}function jc(y,a,f){const v=Math.cos(f),S=Math.sin(f);return{x:y*v-a*S,y:y*S+a*v}}class mr{constructor(a,f,v,S,T,N,z){this.tileSize=512,this._renderWorldCopies=T===void 0||T,this._minZoom=a||0,this._maxZoom=f||22,this._minPitch=v??0,this._maxPitch=S??60,this.setProjection(N),this.setMaxBounds(z),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Yu,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Ya,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const a=new mr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return a._elevation=this._elevation,a._centerAltitude=this._centerAltitude,a._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,a.tileSize=this.tileSize,a.mercatorFromTransition=this.mercatorFromTransition,a.width=this.width,a.height=this.height,a.cameraElevationReference=this.cameraElevationReference,a._center=this._center,a._setZoom(this.zoom),a._seaLevelZoom=this._seaLevelZoom,a.angle=this.angle,a._fov=this._fov,a._pitch=this._pitch,a._nearZ=this._nearZ,a._farZ=this._farZ,a._averageElevation=this._averageElevation,a._unmodified=this._unmodified,a._edgeInsets=this._edgeInsets.clone(),a._camera=this._camera.clone(),a._calcMatrices(),a.freezeTileCoverage=this.freezeTileCoverage,a.frustumCorners=this.frustumCorners,a}get elevation(){return this._elevation}set elevation(a){this._elevation!==a&&(this._elevation=a,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(a,f=!1){const v=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||v)&&this._updateCameraOnTerrain(),(a||v)&&this._constrainCamera(f),this._calcMatrices()}getProjection(){return o.pick(this.projection,["name","center","parallels"])}setProjection(a){this.projectionOptions=a||{name:"mercator"};const f=this.projection?this.getProjection():void 0;this.projection=o.getProjection(this.projectionOptions);const v=!b(f,this.getProjection());return v&&this._calcMatrices(),this.mercatorFromTransition=!1,v}setMercatorFromTransition(){const a=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.getProjection({name:"mercator"});const f=a!==this.projection.name;return f&&this._calcMatrices(),f}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(a){a===void 0?a=!0:a===null&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get cameraWorldSize(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.Point(this.width,this.height)}get bearing(){return o.wrap(this.rotation,-180,180)}set bearing(a){this.rotation=a}get rotation(){return-this.angle/Math.PI*180}set rotation(a){const f=-a*Math.PI/180;var v;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=(v=new o.ARRAY_TYPE(4),o.ARRAY_TYPE!=Float32Array&&(v[1]=0,v[2]=0),v[0]=1,v[3]=1,v),(function(S,T,N){var z=T[0],G=T[1],Q=T[2],te=T[3],ge=Math.sin(N),Ae=Math.cos(N);S[0]=z*Ae+Q*ge,S[1]=G*Ae+te*ge,S[2]=z*-ge+Q*Ae,S[3]=G*-ge+te*Ae})(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(a){const f=o.clamp(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const a=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/a)}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=o.degToRad(a),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(a){this._averageElevation=a,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(a){const f=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._setZoom(f),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(a){this._zoom=a,this.scale=this.zoomScale(a),this.tileZoom=Math.floor(a),this.zoomFraction=a-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const a=this._elevation;this._centerAltitude=a.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=a.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const a=this._elevation,f=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],v=this.horizonLineFromTop();let S=0,T=0;for(let N=0;N<f.length;N++){const z=new o.Point(f[N][0]*this.width,v+f[N][1]*(this.height-v)),G=a.pointCoordinate(z);if(!G)continue;const Q=1/Math.hypot(G[0]-this._camera.position[0],G[1]-this._camera.position[1]);S+=G[3]*Q,T+=Q}return T===0?NaN:S/T}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const a=this._seaLevelZoom,f=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),v=this.pixelsPerMeter/this.worldSize*f,S=this._mercatorZfromZoom(a),T=this._mercatorZfromZoom(this._maxZoom),N=Math.max(S-v,T);this._setZoom(this._zoomFromMercatorZ(N))}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}computeZoomRelativeTo(a){const f=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,a.toAltitude()));let v;v=a.z<this._camera.position[2]?[f.x,f.y,f.z]:[a.x,a.y,a.z];const S=o.length(o.sub([],this._camera.position,v));return o.clamp(this._zoomFromMercatorZ(S),this._minZoom,this._maxZoom)}setFreeCameraOptions(a){if(!this.height||!a.position&&!a.orientation)return;this._updateCameraState();let f=!1;if(a.orientation&&!o.exactEquals(a.orientation,this._camera.orientation)&&(f=this._setCameraOrientation(a.orientation)),a.position){const v=[a.position.x,a.position.y,a.position.z];o.exactEquals$1(v,this._camera.position)||(this._setCameraPosition(v),f=!0)}f&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const a=this._camera.position,f=new Ba;return f.position=new o.MercatorCoordinate(a[0],a[1],a[2]),f.orientation=this._camera.orientation,f._elevation=this.elevation,f._renderWorldCopies=this.renderWorldCopies,f}_setCameraOrientation(a){if(!o.length$1(a))return!1;o.normalize$1(a,a);const f=o.transformQuat([],[0,0,-1],a),v=o.transformQuat([],[0,-1,0],a);if(v[2]<0)return!1;const S=Nu(f,v);return!!S&&(this._camera.orientation=S,!0)}_setCameraPosition(a){const f=this.zoomScale(this.minZoom)*this.tileSize,v=this.zoomScale(this.maxZoom)*this.tileSize,S=this.cameraToCenterDistance;a[2]=o.clamp(a[2],S/v,S/f),this._camera.position=a}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,f,v){this._unmodified=!1,this._edgeInsets.interpolate(a,f,v),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){const f=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,f)}getVisibleUnwrappedCoordinates(a){const f=[new o.UnwrappedTileID(0,a)];if(this.renderWorldCopies){const v=this.pointCoordinate(new o.Point(0,0)),S=this.pointCoordinate(new o.Point(this.width,0)),T=this.pointCoordinate(new o.Point(this.width,this.height)),N=this.pointCoordinate(new o.Point(0,this.height)),z=Math.floor(Math.min(v.x,S.x,T.x,N.x)),G=Math.floor(Math.max(v.x,S.x,T.x,N.x)),Q=1;for(let te=z-Q;te<=G+Q;te++)te!==0&&f.push(new o.UnwrappedTileID(te,a))}return f}coveringTiles(a){let f=this.coveringZoomLevel(a);const v=f,S=this.elevation&&!a.isTerrainDEM,T=this.projection.name==="mercator";if(a.minzoom!==void 0&&f<a.minzoom)return[];a.maxzoom!==void 0&&f>a.maxzoom&&(f=a.maxzoom);const N=this.locationCoordinate(this.center),z=this.center.lat,G=1<<f,Q=[G*N.x,G*N.y,0],te=this.projection.name==="globe",ge=!te,Ae=o.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f,ge),Le=te?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Xe=G*o.mercatorZfromAltitude(1,this.center.lat),Ue=this._camera.position[2]/o.mercatorZfromAltitude(1,this.center.lat),Ze=[G*Le.x,G*Le.y,Ue*(ge?1:Xe)],_e=this.cameraToCenterDistance/a.tileSize*(a.roundZoom?1:.502),$e=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?f:0,it=a.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,st=a.isTerrainDEM?-it:this._elevation?this._elevation.getMinElevationBelowMSL():0,bt=this.projection.isReprojectedInTileSpace?Ja(this):1,wt=Ut=>{const Tn=new o.MercatorCoordinate(Ut.x+25e-6,Ut.y,Ut.z),cn=new o.MercatorCoordinate(Ut.x,Ut.y+25e-6,Ut.z),Nn=Ut.toLngLat(),hr=Tn.toLngLat(),Dr=cn.toLngLat(),rr=this.locationCoordinate(Nn),Jn=this.locationCoordinate(hr),ni=this.locationCoordinate(Dr),mi=Math.hypot(Jn.x-rr.x,Jn.y-rr.y),xr=Math.hypot(ni.x-rr.x,ni.y-rr.y);return Math.sqrt(mi*xr)*bt/25e-6},vt=Ut=>{const rn=it,Tn=st;return{aabb:o.tileAABB(this,G,0,0,0,Ut,Tn,rn,this.projection),zoom:0,x:0,y:0,minZ:Tn,maxZ:rn,wrap:Ut,fullyVisible:!1}},kt=[];let Tt=[];const Vt=f,vn=a.reparseOverscaled?v:f,Bt=Ut=>Ut*Ut,ln=Bt((Ue-this._centerAltitude)*Xe),Wt=Ut=>{if(!this._elevation||!Ut.tileID||!T)return;const rn=this._elevation.getMinMaxForTile(Ut.tileID),Tn=Ut.aabb;rn?(Tn.min[2]=rn.min,Tn.max[2]=rn.max,Tn.center[2]=(Tn.min[2]+Tn.max[2])/2):(Ut.shouldSplit=Cn(Ut),Ut.shouldSplit||(Tn.min[2]=Tn.max[2]=Tn.center[2]=this._centerAltitude))},Cn=Ut=>{if(Ut.zoom<$e)return!0;if(Ut.zoom===Vt)return!1;if(Ut.shouldSplit!=null)return Ut.shouldSplit;const rn=Ut.aabb.distanceX(Ze),Tn=Ut.aabb.distanceY(Ze);let cn=ln,Nn=1;if(te){cn=Bt(Ut.aabb.distanceZ(Ze));const rr=Math.pow(2,Ut.zoom),Jn=o.latFromMercatorY((Ut.y+1)/rr),ni=o.latFromMercatorY(Ut.y/rr),mi=Math.min(Math.max(z,Jn),ni),xr=o.circumferenceAtLatitude(mi)/o.circumferenceAtLatitude(z);if(Nn=mi===z?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,xr/this._mercatorScaleRatio),this.zoom<=o.GLOBE_ZOOM_THRESHOLD_MIN&&Ut.zoom===Vt-1&&xr>=.9)return!0}else if(S&&(cn=Bt(Ut.aabb.distanceZ(Ze)*Xe)),this.projection.isReprojectedInTileSpace&&v<=5){const rr=Math.pow(2,Ut.zoom),Jn=wt(new o.MercatorCoordinate((Ut.x+.5)/rr,(Ut.y+.5)/rr));Nn=Jn>.85?1:Jn}const hr=rn*rn+Tn*Tn+cn,Dr=Bt((1<<Vt-Ut.zoom)*_e*Nn*((rr,Jn)=>{if(Jn*Bt(.707)<rr)return 1;const ni=Math.sqrt(Jn/rr);return ni/(1.4144271570014144+(Math.pow(1.1,ni-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(cn,ln),hr));return hr<Dr};if(this.renderWorldCopies)for(let Ut=1;Ut<=3;Ut++)kt.push(vt(-Ut)),kt.push(vt(Ut));for(kt.push(vt(0));kt.length>0;){const Ut=kt.pop(),rn=Ut.x,Tn=Ut.y;let cn=Ut.fullyVisible;if(!cn){const Nn=Ut.aabb.intersects(Ae);if(Nn===0)continue;cn=Nn===2}if(Ut.zoom!==Vt&&Cn(Ut))for(let Nn=0;Nn<4;Nn++){const hr=(rn<<1)+Nn%2,Dr=(Tn<<1)+(Nn>>1),rr={aabb:T?Ut.aabb.quadrant(Nn):o.tileAABB(this,G,Ut.zoom+1,hr,Dr,Ut.wrap,Ut.minZ,Ut.maxZ,this.projection),zoom:Ut.zoom+1,x:hr,y:Dr,wrap:Ut.wrap,fullyVisible:cn,tileID:void 0,shouldSplit:void 0,minZ:Ut.minZ,maxZ:Ut.maxZ};S&&!te&&(rr.tileID=new o.OverscaledTileID(Ut.zoom+1===Vt?vn:Ut.zoom+1,Ut.wrap,Ut.zoom+1,hr,Dr),Wt(rr)),kt.push(rr)}else{const Nn=Ut.zoom===Vt?vn:Ut.zoom;if(a.minzoom&&a.minzoom>Nn)continue;const hr=Q[0]-(.5+rn+(Ut.wrap<<Ut.zoom))*(1<<f-Ut.zoom),Dr=Q[1]-.5-Tn,rr=Ut.tileID?Ut.tileID:new o.OverscaledTileID(Nn,Ut.wrap,Ut.zoom,rn,Tn);Tt.push({tileID:rr,distanceSq:hr*hr+Dr*Dr})}}if(this.fogCullDistSq){const Ut=this.fogCullDistSq,rn=this.horizonLineFromTop();Tt=Tt.filter((Tn=>{const cn=[0,0,0,1],Nn=[o.EXTENT,o.EXTENT,0,1],hr=this.calculateFogTileMatrix(Tn.tileID.toUnwrapped());o.transformMat4$1(cn,cn,hr),o.transformMat4$1(Nn,Nn,hr);const Dr=o.getAABBPointSquareDist(cn,Nn);if(Dr===0)return!0;let rr=!1;const Jn=this._elevation;if(Jn&&Dr>Ut&&rn!==0){const ni=this.calculateProjMatrix(Tn.tileID.toUnwrapped());let mi;a.isTerrainDEM||(mi=Jn.getMinMaxForTile(Tn.tileID)),mi||(mi={min:st,max:it});const xr=o.furthestTileCorner(this.rotation),Ii=[xr[0]*o.EXTENT,xr[1]*o.EXTENT,mi.max];o.transformMat4(Ii,Ii,ni),rr=(1-Ii[1])*this.height*.5<rn}return Dr<Ut||rr}))}return Tt.sort(((Ut,rn)=>Ut.distanceSq-rn.distanceSq)).map((Ut=>Ut.tileID))}resize(a,f){this.width=a,this.height=f,this.pixelsToGLUnits=[2/a,-2/f],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){const f=o.clamp(a.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),v=this.projection.project(a.lng,f);return new o.Point(v.x*this.worldSize,v.y*this.worldSize)}unproject(a){return this.projection.unproject(a.x/this.worldSize,a.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(a,f){let v,S;const T=this.centerPoint;if(this.projection.name==="globe"){const z=this.worldSize;v=(f.x-T.x)/z,S=(f.y-T.y)/z}else{const z=this.pointCoordinate(f),G=this.pointCoordinate(T);v=z.x-G.x,S=z.y-G.y}const N=this.locationCoordinate(a);this.setLocation(new o.MercatorCoordinate(N.x-v,N.y-S))}setLocation(a){this.center=this.coordinateLocation(a),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(a){return this.projection.locationPoint(this,a)}locationPoint3D(a){return this.projection.locationPoint(this,a,!0)}pointLocation(a){return this.coordinateLocation(this.pointCoordinate(a))}pointLocation3D(a){return this.coordinateLocation(this.pointCoordinate3D(a))}locationCoordinate(a,f){const v=f?o.mercatorZfromAltitude(f,a.lat):void 0,S=this.projection.project(a.lng,a.lat);return new o.MercatorCoordinate(S.x,S.y,v)}coordinateLocation(a){return this.projection.unproject(a.x,a.y)}pointRayIntersection(a,f){const v=f??this._centerAltitude,S=[a.x,a.y,0,1],T=[a.x,a.y,1,1];o.transformMat4$1(S,S,this.pixelMatrixInverse),o.transformMat4$1(T,T,this.pixelMatrixInverse);const N=T[3];o.scale$1(S,S,1/S[3]),o.scale$1(T,T,1/N);const z=S[2],G=T[2];return{p0:S,p1:T,t:z===G?0:(v-z)/(G-z)}}screenPointToMercatorRay(a){const f=[a.x,a.y,0,1],v=[a.x,a.y,1,1];return o.transformMat4$1(f,f,this.pixelMatrixInverse),o.transformMat4$1(v,v,this.pixelMatrixInverse),o.scale$1(f,f,1/f[3]),o.scale$1(v,v,1/v[3]),f[2]=o.mercatorZfromAltitude(f[2],this._center.lat)*this.worldSize,v[2]=o.mercatorZfromAltitude(v[2],this._center.lat)*this.worldSize,o.scale$1(f,f,1/this.worldSize),o.scale$1(v,v,1/this.worldSize),new o.Ray([f[0],f[1],f[2]],o.normalize([],o.sub([],v,f)))}rayIntersectionCoordinate(a){const{p0:f,p1:v,t:S}=a,T=o.mercatorZfromAltitude(f[2],this._center.lat),N=o.mercatorZfromAltitude(v[2],this._center.lat);return new o.MercatorCoordinate(o.number(f[0],v[0],S)/this.worldSize,o.number(f[1],v[1],S)/this.worldSize,o.number(T,N,S))}pointCoordinate(a,f=this._centerAltitude){return this.projection.pointCoordinate(this,a.x,a.y,f)}pointCoordinate3D(a){if(!this.elevation)return this.pointCoordinate(a);let f=this.projection.pointCoordinate3D(this,a.x,a.y);if(f)return new o.MercatorCoordinate(f[0],f[1],f[2]);let v=0,S=this.horizonLineFromTop();if(a.y>S)return this.pointCoordinate(a);const T=.02*S,N=a.clone();for(let z=0;z<10&&S-v>T;z++){N.y=o.number(v,S,.66);const G=this.projection.pointCoordinate3D(this,N.x,N.y);G?(S=N.y,f=G):v=N.y}return f?new o.MercatorCoordinate(f[0],f[1],f[2]):this.pointCoordinate(a)}isPointAboveHorizon(a){return this.projection.isPointAboveHorizon(this,a)}isPointOnSurface(a){if(a.y<0||a.y>this.height||a.x<0||a.x>this.width)return!1;if(this.elevation||this.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(a);const f=this.pointCoordinate(a);return f.y>=0&&f.y<=1}_coordinatePoint(a,f){const v=f&&this.elevation?this.elevation.getAtPointOrZero(a,this._centerAltitude):this._centerAltitude,S=[a.x*this.worldSize,a.y*this.worldSize,v+a.toAltitude(),1];return o.transformMat4$1(S,S,this.pixelMatrix),S[3]>0?new o.Point(S[0]/S[3],S[1]/S[3]):new o.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:a,left:f}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,T=this.pointLocation3D(new o.Point(f,a)),N=this.pointLocation3D(new o.Point(S,a)),z=this.pointLocation3D(new o.Point(S,v)),G=this.pointLocation3D(new o.Point(f,v));let Q=Math.min(T.lng,N.lng,z.lng,G.lng),te=Math.max(T.lng,N.lng,z.lng,G.lng),ge=Math.min(T.lat,N.lat,z.lat,G.lat),Ae=Math.max(T.lat,N.lat,z.lat,G.lat);const Le=Math.pow(2,-this.zoom)/16*270,Xe=this.projection.name==="globe"?1:4,Ue=(Ze,_e,$e,it,st)=>{const bt=(Ze+$e)/2,wt=(_e+it)/2,vt=new o.Point(bt,wt),{lng:kt,lat:Tt}=this.pointLocation3D(vt),Vt=Math.max(0,Q-kt,ge-Tt,kt-te,Tt-Ae);Q=Math.min(Q,kt),te=Math.max(te,kt),ge=Math.min(ge,Tt),Ae=Math.max(Ae,Tt),(st<Xe||Vt>Le)&&(Ue(Ze,_e,bt,wt,st+1),Ue(bt,wt,$e,it,st+1))};if(Ue(f,a,S,a,1),Ue(S,a,S,v,1),Ue(S,v,f,v,1),Ue(f,v,f,a,1),this.projection.name==="globe"){const[Ze,_e]=o.polesInViewport(this);Ze?(Ae=90,te=180,Q=-180):_e&&(ge=-90,te=180,Q=-180)}return new o.LngLatBounds(new o.LngLat(Q,ge),new o.LngLat(te,Ae))}_getBoundsRectangular(a,f){const{top:v,left:S}=this._edgeInsets,T=this.height-this._edgeInsets.bottom,N=this.width-this._edgeInsets.right,z=new o.Point(S,v),G=new o.Point(N,v),Q=new o.Point(N,T),te=new o.Point(S,T);let ge=this.pointCoordinate(z,a),Ae=this.pointCoordinate(G,a);const Le=this.pointCoordinate(Q,f),Xe=this.pointCoordinate(te,f),Ue=(Ze,_e)=>(_e.y-Ze.y)/(_e.x-Ze.x);return ge.y>1&&Ae.y>=0?ge=new o.MercatorCoordinate((1-Xe.y)/Ue(Xe,ge)+Xe.x,1):ge.y<0&&Ae.y<=1&&(ge=new o.MercatorCoordinate(-Xe.y/Ue(Xe,ge)+Xe.x,0)),Ae.y>1&&ge.y>=0?Ae=new o.MercatorCoordinate((1-Le.y)/Ue(Le,Ae)+Le.x,1):Ae.y<0&&ge.y<=1&&(Ae=new o.MercatorCoordinate(-Le.y/Ue(Le,Ae)+Le.x,0)),new o.LngLatBounds().extend(this.coordinateLocation(ge)).extend(this.coordinateLocation(Ae)).extend(this.coordinateLocation(Xe)).extend(this.coordinateLocation(Le))}_getBoundsRectangularTerrain(){const a=this.elevation;if(!a.visibleDemTiles.length||a.isUsingMockSource())return this._getBoundsRectangular(0,0);const f=a.visibleDemTiles.reduce(((v,S)=>{if(S.dem){const T=S.dem.tree;v.min=Math.min(v.min,T.minimums[0]),v.max=Math.max(v.max,T.maximums[0])}return v}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(f.min*a.exaggeration(),f.max*a.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(a=!0){const f=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,v=this.height/2-f*(1-this._horizonShift);return a?Math.max(0,v):v}getMaxBounds(){return this.maxBounds}setMaxBounds(a){this.maxBounds=a,this.minLat=-o.MAX_MERCATOR_LATITUDE,this.maxLat=o.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,a&&(this.minLat=a.getSouth(),this.maxLat=a.getNorth(),this.minLng=a.getWest(),this.maxLng=a.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=o.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=o.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=o.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(a,f){return this.projection.createTileMatrix(this,f,a)}calculateDistanceTileData(a){const f=a.key,v=this._distanceTileDataCache;if(v[f])return v[f];const S=a.canonical,T=1/this.height,N=this.cameraWorldSize,z=N/this.zoomScale(S.z),G=(S.x+Math.pow(2,S.z)*a.wrap)*z,Q=S.y*z,te=this.point;te.x*=N/this.worldSize,te.y*=N/this.worldSize;const ge=this.angle,Ae=Math.sin(-ge),Le=-Math.cos(-ge);return v[f]={bearing:[Ae,Le],center:[(te.x-G)*T,(te.y-Q)*T],scale:z/o.EXTENT*T},v[f]}calculateFogTileMatrix(a){const f=a.key,v=this._fogTileMatrixCache;if(v[f])return v[f];const S=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,a);return o.multiply(S,this.worldToFogMatrix,S),v[f]=new Float32Array(S),v[f]}calculateProjMatrix(a,f=!1){const v=a.key,S=f?this._alignedProjMatrixCache:this._projMatrixCache;if(S[v])return S[v];const T=this.calculatePosMatrix(a,this.worldSize);return o.multiply(T,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:f?this.alignedProjMatrix:this.projMatrix,T),S[v]=new Float32Array(T),S[v]}calculatePixelsToTileUnitsMatrix(a){const f=a.tileID.key,v=this._pixelsToTileUnitsCache;if(v[f])return v[f];const S=(function(T,N){const{scale:z}=T.tileTransform,G=z*o.EXTENT/(T.tileSize*Math.pow(2,N.zoom-T.tileID.overscaledZ+T.tileID.canonical.z));return Q=new Float32Array(4),Ae=(te=N.inverseAdjustmentMatrix)[1],Le=te[2],Xe=te[3],Ze=(ge=[G,G])[1],Q[0]=te[0]*(Ue=ge[0]),Q[1]=Ae*Ue,Q[2]=Le*Ze,Q[3]=Xe*Ze,Q;var Q,te,ge,Ae,Le,Xe,Ue,Ze})(a,this);return v[f]=S,v[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const a=1/this.worldSize,f=o.fromScaling([],[a,a,a]);return o.multiply(f,f,this.globeMatrix),f}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const a=this._elevation;this._updateCameraState();const f=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(f),S=this._camera.forward(),T=o.mercatorZfromAltitude(1,this._center.lat);v[2]/=T,S[2]/=T,o.normalize(S,S);const N=a.raycast(v,S,a.exaggeration());if(N){const z=o.scaleAndAdd([],v,S,N),G=new o.MercatorCoordinate(z[0],z[1],o.mercatorZfromAltitude(z[2],o.latFromMercatorY(z[1]))),Q=(G.z+o.length([G.x-v[0],G.y-v[1],G.z-v[2]*T]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(Q),this._centerAltitude=G.toAltitude(),this._center=this.coordinateLocation(G),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(a=!1){if(!this._elevation)return;const f=this._elevation,v=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,S=this._computeCameraPosition(v),T=f.getAtPointOrZero(new o.MercatorCoordinate(...S)),N=this.pixelsPerMeter/this.worldSize*T,z=this._minimumHeightOverTerrain(),G=S[2]-N;if(G<=z)if(G<0||a){const Q=this.locationCoordinate(this._center,this._centerAltitude),te=[S[0],S[1],Q.z-S[2]],ge=o.length(te);te[2]-=(z-G)/this._pixelsPerMercatorPixel;const Ae=o.length(te);if(Ae===0)return;o.scale$2(te,te,ge/Ae*this._pixelsPerMercatorPixel),this._camera.position=[S[0],S[1],Q.z*this._pixelsPerMercatorPixel-te[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const a=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||a){const Ae=this.center;return Ae.lat=o.clamp(Ae.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!a)&&(Ae.lng=o.clamp(Ae.lng,this.minLng,this.maxLng)),this.center=Ae,void(this._constraining=!1)}const f=this._unmodified,{x:v,y:S}=this.point;let T=0,N=v,z=S;const G=this.width/2,Q=this.height/2,te=this.worldMinY*this.scale,ge=this.worldMaxY*this.scale;if(S-Q<te&&(z=te+Q),S+Q>ge&&(z=ge-Q),ge-te<this.height&&(T=Math.max(T,this.height/(ge-te)),z=(ge+te)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Ae=this.worldMinX*this.scale,Le=this.worldMaxX*this.scale,Xe=this.worldSize/2-(Ae+Le)/2;N=(v+Xe+this.worldSize)%this.worldSize-Xe,N-G<Ae&&(N=Ae+G),N+G>Le&&(N=Le-G),Le-Ae<this.width&&(T=Math.max(T,this.width/(Le-Ae)),N=(Le+Ae)/2)}N===v&&z===S||(this.center=this.unproject(new o.Point(N,z))),T&&(this.zoom+=this.scaleZoom(T)),this._constrainCamera(),this._unmodified=f,this._constraining=!1}_minZoomForBounds(){let a=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(a=Math.max(a,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),a}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const a=this.centerOffset,f=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.mercatorZfromAltitude(1,this.center.lat)/o.mercatorZfromAltitude(1,o.GLOBE_SCALE_MATCH_LATITUDE));const v=Ec(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const S=this.projection.zAxisUnit==="meters"?f:1,T=this._camera.getWorldToCamera(this.worldSize,S),N=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);N[8]=2*-a.x/this.width,N[9]=2*a.y/this.height;let z=o.mul([],N,T);if(this.projection.isReprojectedInTileSpace){const wt=this.locationCoordinate(this.center),vt=o.identity([]);o.translate(vt,vt,[wt.x*this.worldSize,wt.y*this.worldSize,0]),o.multiply(vt,vt,Ta(this)),o.translate(vt,vt,[-wt.x*this.worldSize,-wt.y*this.worldSize,0]),o.multiply(z,z,vt),this.inverseAdjustmentMatrix=(function(kt){const Tt=Ta(kt,!0);return q([],[Tt[0],Tt[1],Tt[4],Tt[5]])})(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=o.scale([],z,[this.worldSize,this.worldSize,this.worldSize/S,1]),this.projMatrix=z,this.invProjMatrix=o.invert(new Float64Array(16),this.projMatrix);const G=o.invert([],N);this.frustumCorners=o.FrustumCorners.fromInvProjectionMatrix(G,this.horizonLineFromTop(),this.height);const Q=new Float32Array(16);o.identity(Q),o.scale(Q,Q,[1,-1,1]),o.rotateX(Q,Q,this._pitch),o.rotateZ(Q,Q,this.angle);const te=o.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),ge=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;te[8]=2*-a.x/this.width,te[9]=2*(a.y+ge)/this.height,this.skyboxMatrix=o.multiply(Q,te,Q);const Ae=this.point,Le=Ae.x,Xe=Ae.y,Ue=this.width%2/2,Ze=this.height%2/2,_e=Math.cos(this.angle),$e=Math.sin(this.angle),it=Le-Math.round(Le)+_e*Ue+$e*Ze,st=Xe-Math.round(Xe)+_e*Ze+$e*Ue,bt=new Float64Array(z);if(o.translate(bt,bt,[it>.5?it-1:it,st>.5?st-1:st,0]),this.alignedProjMatrix=bt,z=o.create(),o.scale(z,z,[this.width/2,-this.height/2,1]),o.translate(z,z,[1,-1,0]),this.labelPlaneMatrix=z,z=o.create(),o.scale(z,z,[1,-1,1]),o.translate(z,z,[-1,-1,0]),o.scale(z,z,[2/this.width,2/this.height,1]),this.glCoordMatrix=z,this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},z=o.invert(new Float64Array(16),this.pixelMatrix),!z)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=z,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.calculateGlobeMatrix(this);const wt=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.transformMat4(wt,wt,T),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=z;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const a=this.cameraWorldSizeForFog,f=this.cameraPixelsPerMeter,v=this._camera.position,S=1/this.height/this._pixelsPerMercatorPixel,T=[a,a,f];o.scale$2(T,T,S),o.scale$2(v,v,-1),o.multiply$2(v,v,T);const N=o.create();o.translate(N,N,v),o.scale(N,N,T),this.mercatorFogMatrix=N,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(a,f,S)}_computeCameraPosition(a){const f=(a=a||this.pixelsPerMeter)/this.pixelsPerMeter,v=this._camera.forward(),S=this.point,T=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*f-a/this.worldSize*this._centerAltitude;return[S.x/this.worldSize-v[0]*T,S.y/this.worldSize-v[1]*T,a/this.worldSize*this._centerAltitude-v[2]*T]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(a){const f=this._maxCameraBoundsDistance()*Math.cos(this._pitch),v=this._camera.position[2],S=a[2];let T=1;this.projection.wrap&&(this.center=this.center.wrap()),S>0&&(T=Math.min((f-v)/S,1)),this._camera.position=o.scaleAndAdd([],this._camera.position,a,T),this._updateStateFromCamera()}_updateStateFromCamera(){const a=this._camera.position,f=this._camera.forward(),{pitch:v,bearing:S}=this._camera.getPitchBearing(),T=o.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,N=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.degToRad(this._maxPitch)),z=Math.max((a[2]-T)/Math.cos(v),N),G=this._zoomFromMercatorZ(z);o.scaleAndAdd(a,a,f,z),this._pitch=o.clamp(v,o.degToRad(this.minPitch),o.degToRad(this.maxPitch)),this.angle=o.wrap(S,-Math.PI,Math.PI),this._setZoom(o.clamp(G,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.MercatorCoordinate(a[0],a[1],a[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(a){return Math.pow(2,a)*this.tileSize}_mercatorZfromZoom(a){return this.cameraToCenterDistance/this._worldSizeFromZoom(a)}_minimumHeightOverTerrain(){const a=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(a)}_zoomFromMercatorZ(a){return this.scaleZoom(this.cameraToCenterDistance/(a*this.tileSize))}zoomFromMercatorZAdjusted(a){let f=0,v=o.GLOBE_ZOOM_THRESHOLD_MAX,S=0,T=1/0;for(;v-f>1e-6&&v>f;){const N=f+.5*(v-f),z=this.tileSize*Math.pow(2,N),G=this.getCameraToCenterDistance(this.projection,N,z),Q=this.scaleZoom(G/(a*this.tileSize)),te=Math.abs(N-Q);te<T&&(T=te,S=N),N<Q?f=N:v=N}return S}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(a,f){const v=Math.min(a.x,f.x),S=Math.max(a.x,f.x),T=Math.min(a.y,f.y),N=Math.max(a.y,f.y);if(T<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const z=[new o.Point(v,T),new o.Point(S,N),new o.Point(v,N),new o.Point(S,T)],G=this.renderWorldCopies?-3:0,Q=this.renderWorldCopies?4:1;for(const te of z){const ge=this.pointRayIntersection(te);if(ge.t<0)return!0;const Ae=this.rayIntersectionCoordinate(ge);if(Ae.x<G||Ae.y<0||Ae.x>Q||Ae.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.Point(0,0),new o.Point(this.width,this.height))}zoomDeltaToMovement(a,f){const v=o.length(o.sub([],this._camera.position,a)),S=this._zoomFromMercatorZ(v)+f;return v-this._mercatorZfromZoom(S)}getCameraPoint(){if(this.projection.name==="globe"){const a=(function([f,v,S],T){const N=[f,v,S,1];o.transformMat4$1(N,N,T);const z=N[3]=Math.max(N[3],1e-6);return N[0]/=z,N[1]/=z,N[2]/=z,N})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.Point(a[0],a[1])}{const a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.Point(0,a))}}getCameraToCenterDistance(a,f=this.zoom,v=this.worldSize){const S=Ec(a,f,this.width,this.height,1024),T=a.pixelSpaceConversion(this.center.lat,v,S);return .5/Math.tan(.5*this._fov)*this.height*T}getWorldToCameraMatrix(){const a=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.multiply(a,a,this.globeMatrix),a}}function eo(y,a){let f=!1,v=null;const S=()=>{v=null,f&&(y(),v=setTimeout(S,a),f=!1)};return()=>(f=!0,v||S(),v)}class pl{constructor(a){this._hashName=a&&encodeURIComponent(a),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=eo(this._updateHashUnthrottled.bind(this),300)}addTo(a){return this._map=a,o.window.addEventListener("hashchange",this._onHashChange,!1),a.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),o.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const a=this._map;if(!a)return"";const f=ru(a);if(this._hashName){const v=this._hashName;let S=!1;const T=o.window.location.hash.slice(1).split("&").map((N=>{const z=N.split("=")[0];return z===v?(S=!0,`${z}=${f}`):N})).filter((N=>N));return S||T.push(`${v}=${f}`),`#${T.join("&")}`}return`#${f}`}_getCurrentHash(){const a=o.window.location.hash.replace("#","");if(this._hashName){let f;return a.split("&").map((v=>v.split("="))).forEach((v=>{v[0]===this._hashName&&(f=v)})),(f&&f[1]||"").split("/")}return a.split("/")}_onHashChange(){const a=this._map;if(!a)return!1;const f=this._getCurrentHash();if(f.length>=3&&!f.some((v=>isNaN(v)))){const v=a.dragRotate.isEnabled()&&a.touchZoomRotate.isEnabled()?+(f[3]||0):a.getBearing();return a.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:v,pitch:+(f[4]||0)}),!0}return!1}_updateHashUnthrottled(){const a=o.window.location.href.replace(/(#.+)?$/,this.getHashString());o.window.history.replaceState(o.window.history.state,null,a)}}function ru(y,a){const f=y.getCenter(),v=Math.round(100*y.getZoom())/100,S=Math.ceil((v*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,S),N=Math.round(f.lng*T)/T,z=Math.round(f.lat*T)/T,G=y.getBearing(),Q=y.getPitch();let te=a?`/${N}/${z}/${v}`:`${v}/${z}/${N}`;return(G||Q)&&(te+="/"+Math.round(10*G)/10),Q&&(te+=`/${Math.round(Q)}`),te}const ac={linearity:.3,easing:o.bezier(0,0,.3,1)},iu=o.extend({deceleration:2500,maxSpeed:1400},ac),ou=o.extend({deceleration:20,maxSpeed:1400},ac),An=o.extend({deceleration:1e3,maxSpeed:360},ac),Ts=o.extend({deceleration:1e3,maxSpeed:90},ac);class Vo{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,f=o.exported.now();for(;a.length>0&&f-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const f={zoom:0,bearing:0,pitch:0,pan:new o.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:T}of this._inertiaBuffer)f.zoom+=T.zoomDelta||0,f.bearing+=T.bearingDelta||0,f.pitch+=T.pitchDelta||0,T.panDelta&&f.pan._add(T.panDelta),T.around&&(f.around=T.around),T.pinchAround&&(f.pinchAround=T.pinchAround);const v=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,S={};if(f.pan.mag()){const T=_a(f.pan.mag(),v,o.extend({},iu,a||{}));S.offset=f.pan.mult(T.amount/f.pan.mag()),S.center=this._map.transform.center,Tl(S,T)}if(f.zoom){const T=_a(f.zoom,v,ou);S.zoom=this._map.transform.zoom+T.amount,Tl(S,T)}if(f.bearing){const T=_a(f.bearing,v,An);S.bearing=this._map.transform.bearing+o.clamp(T.amount,-179,179),Tl(S,T)}if(f.pitch){const T=_a(f.pitch,v,Ts);S.pitch=this._map.transform.pitch+T.amount,Tl(S,T)}if(S.zoom||S.bearing){const T=f.pinchAround===void 0?f.around:f.pinchAround;S.around=T?this._map.unproject(T):this._map.getCenter()}return this.clear(),S.noMoveStart=!0,S}}function Tl(y,a){(!y.duration||y.duration<a.duration)&&(y.duration=a.duration,y.easing=a.easing)}function _a(y,a,f){const{maxSpeed:v,linearity:S,deceleration:T}=f,N=o.clamp(y*S/(a/1e3),-v,v),z=Math.abs(N)/(T*S);return{easing:f.easing,duration:1e3*z,amount:N*(z/2)}}class Ri extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,f,v,S={}){const T=ze(f.getCanvasContainer(),v),N=f.unproject(T);super(a,o.extend({point:T,lngLat:N,originalEvent:v},S)),this._defaultPrevented=!1,this.target=f}}class ha extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,f,v){const S=a==="touchend"?v.changedTouches:v.touches,T=pe(f.getCanvasContainer(),S),N=T.map((G=>f.unproject(G))),z=T.reduce(((G,Q,te,ge)=>G.add(Q.div(ge.length))),new o.Point(0,0));super(a,{points:T,point:z,lngLats:N,lngLat:f.unproject(z),originalEvent:v}),this._defaultPrevented=!1}}class Rh extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,f,v){super(a,{originalEvent:v}),this._defaultPrevented=!1}}class wh{constructor(a,f){this._map=a,this._clickTolerance=f.clickTolerance}reset(){this._mousedownPos=void 0}wheel(a){return this._firePreventable(new Rh(a.type,this._map,a))}mousedown(a,f){return this._mousedownPos=f,this._firePreventable(new Ri(a.type,this._map,a))}mouseup(a){this._map.fire(new Ri(a.type,this._map,a))}preclick(a){const f=o.extend({},a);f.type="preclick",this._map.fire(new Ri(f.type,this._map,f))}click(a,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||(this.preclick(a),this._map.fire(new Ri(a.type,this._map,a)))}dblclick(a){return this._firePreventable(new Ri(a.type,this._map,a))}mouseover(a){this._map.fire(new Ri(a.type,this._map,a))}mouseout(a){this._map.fire(new Ri(a.type,this._map,a))}touchstart(a){return this._firePreventable(new ha(a.type,this._map,a))}touchmove(a){this._map.fire(new ha(a.type,this._map,a))}touchend(a){this._map.fire(new ha(a.type,this._map,a))}touchcancel(a){this._map.fire(new ha(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Qr{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(a){this._map.fire(new Ri(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ri("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._map.fire(new Ri(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class xu{constructor(a,f){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,f){this.isEnabled()&&a.shiftKey&&a.button===0&&(ne(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(a,f){if(!this._active)return;const v=f,S=this._startPos,T=this._lastPos;if(!S||!T||T.equals(v)||!this._box&&v.dist(S)<this._clickTolerance)return;this._lastPos=v,this._box||(this._box=k("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",a));const N=Math.min(S.x,v.x),z=Math.max(S.x,v.x),G=Math.min(S.y,v.y),Q=Math.max(S.y,v.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${N}px,${G}px)`,this._box.style.width=z-N+"px",this._box.style.height=Q-G+"px")}))}mouseupWindow(a,f){if(!this._active)return;const v=this._startPos,S=f;if(v&&a.button===0){if(this.reset(),ke(),v.x!==S.x||v.y!==S.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:a})),{cameraAnimation:T=>T.fitScreenCoordinates(v,S,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",a)}}keydown(a){this._active&&a.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",a))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),me(),delete this._startPos,delete this._lastPos}_fireEvent(a,f){return this._map.fire(new o.Event(a,{originalEvent:f}))}}function Mh(y,a){const f={};for(let v=0;v<y.length;v++)f[y[v].identifier]=a[v];return f}class Zs{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(a,f,v){(this.centroid||v.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=a.timeStamp),v.length===this.numTouches&&(this.centroid=(function(S){const T=new o.Point(0,0);for(const N of S)T._add(N);return T.div(S.length)})(f),this.touches=Mh(v,f)))}touchmove(a,f,v){if(this.aborted||!this.centroid)return;const S=Mh(v,f);for(const T in this.touches){const N=S[T];(!N||N.dist(this.touches[T])>30)&&(this.aborted=!0)}}touchend(a,f,v){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),v.length===0){const S=!this.aborted&&this.centroid;if(this.reset(),S)return S}}}class Qa{constructor(a){this.singleTap=new Zs(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(a,f,v){this.singleTap.touchstart(a,f,v)}touchmove(a,f,v){this.singleTap.touchmove(a,f,v)}touchend(a,f,v){const S=this.singleTap.touchend(a,f,v);if(S){const T=a.timeStamp-this.lastTime<500,N=!this.lastTap||this.lastTap.dist(S)<30;if(T&&N||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=S,this.count===this.numTaps)return this.reset(),S}}}class Nh{constructor(){this._zoomIn=new Qa({numTouches:1,numTaps:2}),this._zoomOut=new Qa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,f,v){this._zoomIn.touchstart(a,f,v),this._zoomOut.touchstart(a,f,v)}touchmove(a,f,v){this._zoomIn.touchmove(a,f,v),this._zoomOut.touchmove(a,f,v)}touchend(a,f,v){const S=this._zoomIn.touchend(a,f,v),T=this._zoomOut.touchend(a,f,v);return S?(this._active=!0,a.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:N=>N.easeTo({duration:300,zoom:N.getZoom()+1,around:N.unproject(S)},{originalEvent:a})}):T?(this._active=!0,a.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:N=>N.easeTo({duration:300,zoom:N.getZoom()-1,around:N.unproject(T)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Uc={0:1,2:2};class Du{constructor(a){this.reset(),this._clickTolerance=a.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(a,f){return!1}_move(a,f){return{}}mousedown(a,f){if(this._lastPoint)return;const v=U(a);this._correctButton(a,v)&&(this._lastPoint=f,this._eventButton=v)}mousemoveWindow(a,f){const v=this._lastPoint;if(v){if(a.preventDefault(),this._eventButton!=null&&(function(S,T){const N=Uc[T];return S.buttons===void 0||(S.buttons&N)!==N})(a,this._eventButton))this.reset();else if(this._moved||!(f.dist(v)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(v,f)}}mouseupWindow(a){this._lastPoint&&U(a)===this._eventButton&&(this._moved&&ke(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gd extends Du{mousedown(a,f){super.mousedown(a,f),this._lastPoint&&(this._active=!0)}_correctButton(a,f){return f===0&&!a.ctrlKey}_move(a,f){return{around:f,panDelta:f.sub(a)}}}class za extends Du{_correctButton(a,f){return f===0&&a.ctrlKey||f===2}_move(a,f){const v=.8*(f.x-a.x);if(v)return this._active=!0,{bearingDelta:v}}contextmenu(a){a.preventDefault()}}class Ui extends Du{_correctButton(a,f){return f===0&&a.ctrlKey||f===2}_move(a,f){const v=-.5*(f.y-a.y);if(v)return this._active=!0,{pitchDelta:v}}contextmenu(a){a.preventDefault()}}class da{constructor(a,f){this._map=a,this._el=a.getCanvasContainer(),this._minTouches=1,this._clickTolerance=f.clickTolerance||1,this.reset(),o.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.Point(0,0)}touchstart(a,f,v){return this._calculateTransform(a,f,v)}touchmove(a,f,v){if(this._active&&!(v.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(v.length===1&&!o.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return a.cancelable&&a.preventDefault(),this._calculateTransform(a,f,v)}}touchend(a,f,v){this._calculateTransform(a,f,v),this._active&&v.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,f,v){v.length>0&&(this._active=!0);const S=Mh(v,f),T=new o.Point(0,0),N=new o.Point(0,0);let z=0;for(const Q in S){const te=S[Q],ge=this._touches[Q];ge&&(T._add(te),N._add(te.sub(ge)),z++,S[Q]=te)}if(this._touches=S,z<this._minTouches||!N.mag())return;const G=N.div(z);return this._sum._add(G),this._sum.mag()<this._clickTolerance?void 0:{around:T.div(z),panDelta:G}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=k("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")}),500)}}class ja{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(a){}_move(a,f,v){return{}}touchstart(a,f,v){this._firstTwoTouches||v.length<2||(this._firstTwoTouches=[v[0].identifier,v[1].identifier],this._start([f[0],f[1]]))}touchmove(a,f,v){const S=this._firstTwoTouches;if(!S)return;a.preventDefault();const[T,N]=S,z=su(v,f,T),G=su(v,f,N);if(!z||!G)return;const Q=this._aroundCenter?null:z.add(G).div(2);return this._move([z,G],Q,a)}touchend(a,f,v){if(!this._firstTwoTouches)return;const[S,T]=this._firstTwoTouches,N=su(v,f,S),z=su(v,f,T);N&&z||(this._active&&ke(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&a.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function su(y,a,f){for(let v=0;v<y.length;v++)if(y[v].identifier===f)return a[v]}function to(y,a){return Math.log(y/a)/Math.LN2}class Il extends ja{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,f){const v=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(to(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:to(this._distance,v),pinchAround:f}}}function Dh(y,a){return 180*y.angleWith(a)/Math.PI}class df extends ja{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,f){const v=this._vector;if(this._vector=a[0].sub(a[1]),v&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Dh(this._vector,v),pinchAround:f}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const f=25/(Math.PI*this._minDiameter)*360,v=this._startVector;if(!v)return!1;const S=Dh(a,v);return Math.abs(S)<f}}function el(y){return Math.abs(y.y)>Math.abs(y.x)}class Ia extends ja{constructor(a){super(),this._map=a}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(a){this._lastPoints=a,el(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,f,v){const S=this._lastPoints;if(!S)return;const T=a[0].sub(S[0]),N=a[1].sub(S[1]);return this._map._cooperativeGestures&&!o.isFullscreen()&&v.touches.length<3||(this._valid=this.gestureBeginsVertically(T,N,v.timeStamp),!this._valid)?void 0:(this._lastPoints=a,this._active=!0,{pitchDelta:(T.y+N.y)/2*-.5})}gestureBeginsVertically(a,f,v){if(this._valid!==void 0)return this._valid;const S=a.mag()>=2,T=f.mag()>=2;if(!S&&!T)return;if(!S||!T)return this._firstMove==null&&(this._firstMove=v),v-this._firstMove<100&&void 0;const N=a.y>0==f.y>0;return el(a)&&el(f)&&N}}const Ac={panStep:100,bearingStep:15,pitchStep:10};class Yh{constructor(){const a=Ac;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let f=0,v=0,S=0,T=0,N=0;switch(a.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:a.shiftKey?v=-1:(a.preventDefault(),T=-1);break;case 39:a.shiftKey?v=1:(a.preventDefault(),T=1);break;case 38:a.shiftKey?S=1:(a.preventDefault(),N=-1);break;case 40:a.shiftKey?S=-1:(a.preventDefault(),N=1);break;default:return}return this._rotationDisabled&&(v=0,S=0),{cameraAnimation:z=>{const G=z.getZoom();z.easeTo({duration:300,easeId:"keyboardHandler",easing:Sh,zoom:f?Math.round(G)+f*(a.shiftKey?2:1):G,bearing:z.getBearing()+v*this._bearingStep,pitch:z.getPitch()+S*this._pitchStep,offset:[-T*this._panStep,-N*this._panStep],center:z.getCenter()},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Sh(y){return y*(2-y)}const Ua=4.000244140625;class lc{constructor(a,f){this._map=a,this._el=a.getCanvasContainer(),this._handler=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&a.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(a){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(a.ctrlKey||a.metaKey||this.isZooming()||o.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let f=a.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const v=o.exported.now(),S=v-(this._lastWheelEventTime||0);this._lastWheelEventTime=v,f!==0&&f%Ua==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":S>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(S*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),a.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=a,this._delta-=f,this._active||this._start(a)),a.preventDefault()}_onTimeout(a){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=ze(this._el,a);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:f,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._map.transform;this._type==="wheel"&&a.projection.wrap&&(a._center.lng>=180||a._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const f=()=>a._terrainEnabled()&&this._aroundCoord?a.computeZoomRelativeTo(this._aroundCoord):a.zoom;if(this._delta!==0){const G=this._type==="wheel"&&Math.abs(this._delta)>Ua?this._wheelZoomRate:this._defaultZoomRate;let Q=2/(1+Math.exp(-Math.abs(this._delta*G)));this._delta<0&&Q!==0&&(Q=1/Q);const te=f(),ge=Math.pow(2,te),Ae=typeof this._targetZoom=="number"?a.zoomScale(this._targetZoom):ge;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(Ae*Q))),this._type==="wheel"&&(this._startZoom=te,this._easing=this._smoothOutEasing(200)),this._delta=0}const v=typeof this._targetZoom=="number"?this._targetZoom:f(),S=this._startZoom,T=this._easing;let N,z=!1;if(this._type==="wheel"&&S&&T){const G=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),Q=T(G);N=o.number(S,v,Q),G<1?this._frameId||(this._frameId=!0):z=!0}else N=v,z=!0;return this._active=!0,z&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!z,zoomDelta:N-f(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let f=o.ease;if(this._prevEase){const v=this._prevEase,S=(o.exported.now()-v.start)/v.duration,T=v.easing(S+.01)-v.easing(S),N=.27/Math.sqrt(T*T+1e-4)*.01,z=Math.sqrt(.0729-N*N);f=o.bezier(N,z,.25,1)}return this._prevEase={start:o.exported.now(),duration:a,easing:f},f}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=k("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(o.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")}),200)}}class qo{constructor(a,f){this._clickZoom=a,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Gi{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(a,f){return a.preventDefault(),{cameraAnimation:v=>{v.easeTo({duration:300,zoom:v.getZoom()+(a.shiftKey?-1:1),around:v.unproject(f)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cc{constructor(){this._tap=new Qa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(a,f,v){this._swipePoint||(this._tapTime&&a.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?v.length>0&&(this._swipePoint=f[0],this._swipeTouch=v[0].identifier):this._tap.touchstart(a,f,v))}touchmove(a,f,v){if(this._tapTime){if(this._swipePoint){if(v[0].identifier!==this._swipeTouch)return;const S=f[0],T=S.y-this._swipePoint.y;return this._swipePoint=S,a.preventDefault(),this._active=!0,{zoomDelta:T/128}}}else this._tap.touchmove(a,f,v)}touchend(a,f,v){this._tapTime?this._swipePoint&&v.length===0&&this.reset():this._tap.touchend(a,f,v)&&(this._tapTime=a.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class tl{constructor(a,f,v){this._el=a,this._mousePan=f,this._touchPan=v}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class $l{constructor(a,f,v){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=f,this._mousePitch=v}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ju{constructor(a,f,v,S){this._el=a,this._touchZoom=f,this._touchRotate=v,this._tapDragZoom=S,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ca=y=>y.zoom||y.drag||y.pitch||y.rotate;class La extends o.Event{}class Jh{constructor(){this.constants=[1,1,.01],this.radius=0}setup(a,f){const v=o.sub([],f,a);this.radius=o.length(v[2]<0?o.div([],v,this.constants):[v[0],v[1],0])}projectRay(a){o.div(a,a,this.constants),o.normalize(a,a),o.mul$1(a,a,this.constants);const f=o.scale$2([],a,this.radius);if(f[2]>0){const v=o.scale$2([],[0,0,1],o.dot(f,[0,0,1])),S=o.scale$2([],o.normalize([],[f[0],f[1],0]),this.radius),T=o.add([],f,o.scale$2([],o.sub([],o.add([],S,v),f),2));f[0]=T[0],f[1]=T[1]}return f}}function uc(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class Gl{constructor(a,f){this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Vo(a),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Jh,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(f),o.bindAll(["handleEvent","handleWindowEvent"],this);const v=this._el;this._listeners=[[v,"touchstart",{passive:!0}],[v,"touchmove",{passive:!1}],[v,"touchend",void 0],[v,"touchcancel",void 0],[v,"mousedown",void 0],[v,"mousemove",void 0],[v,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[v,"mouseover",void 0],[v,"mouseout",void 0],[v,"dblclick",void 0],[v,"click",void 0],[v,"keydown",{capture:!1}],[v,"keyup",void 0],[v,"wheel",{passive:!1}],[v,"contextmenu",void 0],[o.window,"blur",void 0]];for(const[S,T,N]of this._listeners)S.addEventListener(T,S===o.window.document?this.handleWindowEvent:this.handleEvent,N)}destroy(){for(const[a,f,v]of this._listeners)a.removeEventListener(f,a===o.window.document?this.handleWindowEvent:this.handleEvent,v)}_addDefaultHandlers(a){const f=this._map,v=f.getCanvasContainer();this._add("mapEvent",new wh(f,a));const S=f.boxZoom=new xu(f,a);this._add("boxZoom",S);const T=new Nh,N=new Gi;f.doubleClickZoom=new qo(N,T),this._add("tapZoom",T),this._add("clickZoom",N);const z=new cc;this._add("tapDragZoom",z);const G=f.touchPitch=new Ia(f);this._add("touchPitch",G);const Q=new za(a),te=new Ui(a);f.dragRotate=new $l(a,Q,te),this._add("mouseRotate",Q,["mousePitch"]),this._add("mousePitch",te,["mouseRotate"]);const ge=new gd(a),Ae=new da(f,a);f.dragPan=new tl(v,ge,Ae),this._add("mousePan",ge),this._add("touchPan",Ae,["touchZoom","touchRotate"]);const Le=new df,Xe=new Il;f.touchZoomRotate=new Ju(v,Xe,Le,z),this._add("touchRotate",Le,["touchPan","touchZoom"]),this._add("touchZoom",Xe,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Qr(f));const Ue=f.scrollZoom=new lc(f,this);this._add("scrollZoom",Ue,["mousePan"]);const Ze=f.keyboard=new Yh;this._add("keyboard",Ze);for(const _e of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])a.interactive&&a[_e]&&f[_e].enable(a[_e])}_add(a,f,v){this._handlers.push({handlerName:a,handler:f,allowed:v}),this._handlersById[a]=f}stop(a){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[]}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ca(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(a,f,v){for(const S in a)if(S!==v&&(!f||f.indexOf(S)<0))return!0;return!1}handleWindowEvent(a){this.handleEvent(a,`${a.type}Window`)}_getMapTouches(a){const f=[];for(const v of a)this._el.contains(v.target)&&f.push(v);return f}handleEvent(a,f){this._updatingCamera=!0;const v=a.type==="renderFrame",S=v?void 0:a,T={needsRenderFrame:!1},N={},z={},G=a.touches?this._getMapTouches(a.touches):void 0,Q=G?pe(this._el,G):v?void 0:ze(this._el,a);for(const{handlerName:Ae,handler:Le,allowed:Xe}of this._handlers){if(!Le.isEnabled())continue;let Ue;this._blockedByActive(z,Xe,Ae)?Le.reset():Le[f||a.type]&&(Ue=Le[f||a.type](a,Q,G),this.mergeHandlerResult(T,N,Ue,Ae,S),Ue&&Ue.needsRenderFrame&&this._triggerRenderFrame()),(Ue||Le.isActive())&&(z[Ae]=Le)}const te={};for(const Ae in this._previousActiveHandlers)z[Ae]||(te[Ae]=S);this._previousActiveHandlers=z,(Object.keys(te).length||uc(T))&&(this._changes.push([T,N,te]),this._triggerRenderFrame()),(Object.keys(z).length||uc(T))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ge}=T;ge&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ge(this._map))}mergeHandlerResult(a,f,v,S,T){if(!v)return;o.extend(a,v);const N={handlerName:S,originalEvent:v.originalEvent||T};v.zoomDelta!==void 0&&(f.zoom=N),v.panDelta!==void 0&&(f.drag=N),v.pitchDelta!==void 0&&(f.pitch=N),v.bearingDelta!==void 0&&(f.rotate=N)}_applyChanges(){const a={},f={},v={};for(const[S,T,N]of this._changes)S.panDelta&&(a.panDelta=(a.panDelta||new o.Point(0,0))._add(S.panDelta)),S.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+S.zoomDelta),S.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+S.bearingDelta),S.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+S.pitchDelta),S.around!==void 0&&(a.around=S.around),S.aroundCoord!==void 0&&(a.aroundCoord=S.aroundCoord),S.pinchAround!==void 0&&(a.pinchAround=S.pinchAround),S.noInertia&&(a.noInertia=S.noInertia),o.extend(f,T),o.extend(v,N);this._updateMapTransform(a,f,v),this._changes=[]}_updateMapTransform(a,f,v){const S=this._map,T=S.transform,N=$e=>[$e.x,$e.y,$e.z];if(($e=>{const it=this._eventsInProgress.drag;return it&&!this._handlersById[it.handlerName].isActive()})()&&!uc(a)){const $e=T.zoom;T.cameraElevationReference="sea",T.recenterOnTerrain(),T.cameraElevationReference="ground",$e!==T.zoom&&this._map._update(!0)}if(T._isCameraConstrained&&S._stop(!0),!uc(a))return void this._fireEvents(f,v,!0);let{panDelta:z,zoomDelta:G,bearingDelta:Q,pitchDelta:te,around:ge,aroundCoord:Ae,pinchAround:Le}=a;T._isCameraConstrained&&(G>0&&(G=0),T._isCameraConstrained=!1),Le!==void 0&&(ge=Le),(G||($e=>f[$e]&&!this._eventsInProgress[$e])("drag"))&&ge&&(this._dragOrigin=N(T.pointCoordinate3D(ge)),this._trackingEllipsoid.setup(T._camera.position,this._dragOrigin)),T.cameraElevationReference="sea",S._stop(!0),ge=ge||S.transform.centerPoint,Q&&(T.bearing+=Q),te&&(T.pitch+=te),T._updateCameraState();const Xe=[0,0,0];if(z)if(T.projection.name==="mercator"){const $e=this._trackingEllipsoid.projectRay(T.screenPointToMercatorRay(ge).dir),it=this._trackingEllipsoid.projectRay(T.screenPointToMercatorRay(ge.sub(z)).dir);Xe[0]=it[0]-$e[0],Xe[1]=it[1]-$e[1]}else{const $e=T.pointCoordinate(ge);if(T.projection.name==="globe"){z=z.rotate(-T.angle);const it=T._pixelsPerMercatorPixel/T.worldSize;Xe[0]=-z.x*o.mercatorScale(o.latFromMercatorY($e.y))*it,Xe[1]=-z.y*o.mercatorScale(T.center.lat)*it}else{const it=T.pointCoordinate(ge.sub(z));$e&&it&&(Xe[0]=it.x-$e.x,Xe[1]=it.y-$e.y)}}const Ue=T.zoom,Ze=[0,0,0];if(G){const $e=N(Ae||T.pointCoordinate3D(ge)),it={dir:o.normalize([],o.sub([],$e,T._camera.position))};if(it.dir[2]<0){const st=T.zoomDeltaToMovement($e,G);o.scale$2(Ze,it.dir,st)}}const _e=o.add(Xe,Xe,Ze);T._translateCameraConstrained(_e),G&&Math.abs(T.zoom-Ue)>1e-4&&T.recenterOnTerrain(),T.cameraElevationReference="ground",this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(f,v,!0)}_fireEvents(a,f,v){const S=Ca(this._eventsInProgress),T=Ca(a),N={};for(const te in a){const{originalEvent:ge}=a[te];this._eventsInProgress[te]||(N[`${te}start`]=ge),this._eventsInProgress[te]=a[te]}!S&&T&&this._fireEvent("movestart",T.originalEvent);for(const te in N)this._fireEvent(te,N[te]);T&&this._fireEvent("move",T.originalEvent);for(const te in a){const{originalEvent:ge}=a[te];this._fireEvent(te,ge)}const z={};let G;for(const te in this._eventsInProgress){const{handlerName:ge,originalEvent:Ae}=this._eventsInProgress[te];this._handlersById[ge].isActive()||(delete this._eventsInProgress[te],G=f[ge]||Ae,z[`${te}end`]=G)}for(const te in z)this._fireEvent(te,z[te]);const Q=Ca(this._eventsInProgress);if(v&&(S||T)&&!Q){this._updatingCamera=!0;const te=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ge=Ae=>Ae!==0&&-this._bearingSnap<Ae&&Ae<this._bearingSnap;te?(ge(te.bearing||this._map.getBearing())&&(te.bearing=0),this._map.easeTo(te,{originalEvent:G})):(this._map.fire(new o.Event("moveend",{originalEvent:G})),ge(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(a,f){this._map.fire(new o.Event(a,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((a=>{this._frameId=void 0,this.handleEvent(new La("renderFrame",{timeStamp:a})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Cl="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Qu extends o.Evented{constructor(a,f){super(),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=f.bearingSnap,this._respectPrefersReducedMotion=f.respectPrefersReducedMotion!==!1,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(a,f){return this.jumpTo({center:a},f)}panBy(a,f,v){return a=o.Point.convert(a).mult(-1),this.panTo(this.transform.center,o.extend({offset:a},f),v)}panTo(a,f,v){return this.easeTo(o.extend({center:a},f),v)}getZoom(){return this.transform.zoom}setZoom(a,f){return this.jumpTo({zoom:a},f),this}zoomTo(a,f,v){return this.easeTo(o.extend({zoom:a},f),v)}zoomIn(a,f){return this.zoomTo(this.getZoom()+1,a,f),this}zoomOut(a,f){return this.zoomTo(this.getZoom()-1,a,f),this}getBearing(){return this.transform.bearing}setBearing(a,f){return this.jumpTo({bearing:a},f),this}getPadding(){return this.transform.padding}setPadding(a,f){return this.jumpTo({padding:a},f),this}rotateTo(a,f,v){return this.easeTo(o.extend({bearing:a},f),v)}resetNorth(a,f){return this.rotateTo(0,o.extend({duration:1e3},a),f),this}resetNorthPitch(a,f){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},a),f),this}snapToNorth(a,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,f):this}getPitch(){return this.transform.pitch}setPitch(a,f){return this.jumpTo({pitch:a},f),this}cameraForBounds(a,f){a=o.LngLatBounds.convert(a);const v=f&&f.bearing||0,S=f&&f.pitch||0,T=a.getNorthWest(),N=a.getSouthEast();return this._cameraForBounds(this.transform,T,N,v,S,f)}_extendCameraOptions(a){const f={top:0,bottom:0,right:0,left:0};if(typeof(a=o.extend({padding:f,offset:[0,0],maxZoom:this.transform.maxZoom},a)).padding=="number"){const v=a.padding;a.padding={top:v,bottom:v,right:v,left:v}}return a.padding=o.extend(f,a.padding),a}_minimumAABBFrustumDistance(a,f){const v=f.max[0]-f.min[0],S=f.max[1]-f.min[1];return v/S>a.aspect?v/(2*Math.tan(.5*a.fovX)*a.aspect):S/(2*Math.tan(.5*a.fovY)*a.aspect)}_cameraForBoundsOnGlobe(a,f,v,S,T,N){const z=a.clone(),G=this._extendCameraOptions(N);z.bearing=S,z.pitch=T;const Q=o.LngLat.convert(f),te=o.LngLat.convert(v),ge=.5*(Q.lat+te.lat),Ae=.5*(Q.lng+te.lng),Le=o.latLngToECEF(ge,Ae),Xe=o.normalize([],Le),Ue=o.normalize([],o.cross([],Xe,[0,1,0])),Ze=o.cross([],Ue,Xe),_e=[Ue[0],Ue[1],Ue[2],0,Ze[0],Ze[1],Ze[2],0,Xe[0],Xe[1],Xe[2],0,0,0,0,1],$e=[Le,o.latLngToECEF(Q.lat,Q.lng),o.latLngToECEF(te.lat,Q.lng),o.latLngToECEF(te.lat,te.lng),o.latLngToECEF(Q.lat,te.lng),o.latLngToECEF(ge,Q.lng),o.latLngToECEF(ge,te.lng),o.latLngToECEF(Q.lat,Ae),o.latLngToECEF(te.lat,Ae)];let it=o.Aabb.fromPoints($e.map((cn=>[o.dot(Ue,cn),o.dot(Ze,cn),o.dot(Xe,cn)])));const st=o.transformMat4([],it.center,_e);o.squaredLength(st)===0&&o.set(st,0,0,1),o.normalize(st,st),o.scale$2(st,st,o.GLOBE_RADIUS),z.center=o.ecefToLatLng(st);const bt=z.getWorldToCameraMatrix(),wt=o.invert(new Float64Array(16),bt);it=o.Aabb.applyTransform(it,o.multiply([],bt,_e)),o.transformMat4(st,st,bt);const vt=.5*(it.max[2]-it.min[2]),kt=this._minimumAABBFrustumDistance(z,it),Tt=o.scale$2([],[0,0,1],vt),Vt=o.add(Tt,st,Tt),vn=kt+(z.pitch===0?0:o.distance(st,Vt)),Bt=z.globeCenterInViewSpace,ln=o.sub([],st,[Bt[0],Bt[1],Bt[2]]);o.normalize(ln,ln),o.scale$2(ln,ln,vn);const Wt=o.add([],st,ln);o.transformMat4(Wt,Wt,wt);const Cn=o.earthRadius/o.GLOBE_RADIUS,Ut=o.length(Wt),rn=o.mercatorZfromAltitude(Math.max(Ut*Cn-o.earthRadius,Number.EPSILON),0),Tn=Math.min(z.zoomFromMercatorZAdjusted(rn),G.maxZoom);return Tn>.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(z.setProjection({name:"mercator"}),z.zoom=Tn,this._cameraForBounds(z,f,v,S,T,N)):{center:z.center,zoom:Tn,bearing:S,pitch:T}}queryTerrainElevation(a,f){const v=this.transform.elevation;return v?(f=o.extend({},{exaggerated:!0},f),v.getAtPoint(o.MercatorCoordinate.fromLngLat(a),null,f.exaggerated)):null}_cameraForBounds(a,f,v,S,T,N){if(a.projection.name==="globe")return this._cameraForBoundsOnGlobe(a,f,v,S,T,N);const z=a.clone(),G=this._extendCameraOptions(N),Q=z.padding;z.bearing=S,z.pitch=T;const te=o.LngLat.convert(f),ge=o.LngLat.convert(v),Ae=new o.LngLat(te.lng,ge.lat),Le=new o.LngLat(ge.lng,te.lat),Xe=z.project(te),Ue=z.project(ge),Ze=this.queryTerrainElevation(te),_e=this.queryTerrainElevation(ge),$e=this.queryTerrainElevation(Ae),it=this.queryTerrainElevation(Le),st=[[Xe.x,Xe.y,Math.min(Ze||0,_e||0,$e||0,it||0)],[Ue.x,Ue.y,Math.max(Ze||0,_e||0,$e||0,it||0)]];let bt=o.Aabb.fromPoints(st);const wt=z.getWorldToCameraMatrix(),vt=o.invert(new Float64Array(16),wt);bt=o.Aabb.applyTransform(bt,wt);const kt=o.sub([],bt.max,bt.min),Tt=Q.left||0,Vt=Q.right||0,vn=Q.bottom||0,Bt=Q.top||0,{left:ln,right:Wt,top:Cn,bottom:Ut}=G.padding,rn=.5*(Tt+Vt),Tn=.5*(Bt+vn),cn=Math.min(z.scaleZoom(z.scale*Math.min((z.width-(Tt+Vt+ln+Wt))/kt[0],(z.height-(vn+Bt+Ut+Cn))/kt[1])),G.maxZoom),Nn=z.scale/z.zoomScale(cn);bt=new o.Aabb([bt.min[0]-(ln+rn)*Nn,bt.min[1]-(Ut+Tn)*Nn,bt.min[2]],[bt.max[0]+(Wt+rn)*Nn,bt.max[1]+(Cn+Tn)*Nn,bt.max[2]]);const hr=.5*kt[2],Dr=this._minimumAABBFrustumDistance(z,bt),rr=[0,0,1,0];o.transformMat4$1(rr,rr,wt),o.normalize$2(rr,rr);const Jn=o.scale$2([],rr,Dr+hr),ni=o.add([],bt.center,Jn),mi=(typeof G.offset.x=="number"&&typeof G.offset.y=="number"?new o.Point(G.offset.x,G.offset.y):o.Point.convert(G.offset)).rotate(-o.degToRad(S));bt.center[0]-=mi.x*Nn,bt.center[1]+=mi.y*Nn,o.transformMat4(bt.center,bt.center,vt),o.transformMat4(ni,ni,vt);const xr=[bt.center[0],bt.center[1],ni[2]*z.pixelsPerMeter];o.scale$2(xr,xr,1/z.worldSize);const Ii=o.lngFromMercatorX(xr[0]),Ci=o.latFromMercatorY(xr[1]),Ni=Math.min(z._zoomFromMercatorZ(xr[2]),G.maxZoom),fo=new o.LngLat(Ii,Ci);return z.mercatorFromTransition&&Ni<.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(z.setProjection({name:"globe"}),z.zoom=Ni,this._cameraForBounds(z,f,v,S,T,N)):{center:fo,zoom:Ni,bearing:S,pitch:T}}fitBounds(a,f,v){const S=this.cameraForBounds(a,f);return this._fitInternal(S,f,v)}fitScreenCoordinates(a,f,v,S,T){const N=o.Point.convert(a),z=o.Point.convert(f),G=new o.Point(Math.min(N.x,z.x),Math.min(N.y,z.y)),Q=new o.Point(Math.max(N.x,z.x),Math.max(N.y,z.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(N,z))return this;const te=this.transform.pointLocation3D(G),ge=this.transform.pointLocation3D(Q),Ae=this.transform.pointLocation3D(new o.Point(G.x,Q.y)),Le=this.transform.pointLocation3D(new o.Point(Q.x,G.y)),Xe=[Math.min(te.lng,ge.lng,Ae.lng,Le.lng),Math.min(te.lat,ge.lat,Ae.lat,Le.lat)],Ue=[Math.max(te.lng,ge.lng,Ae.lng,Le.lng),Math.max(te.lat,ge.lat,Ae.lat,Le.lat)],Ze=S&&S.pitch?S.pitch:this.getPitch(),_e=this._cameraForBounds(this.transform,Xe,Ue,v,Ze,S);return this._fitInternal(_e,S,T)}_fitInternal(a,f,v){return a?(delete(f=o.extend(a,f)).padding,f.linear?this.easeTo(f,v):this.flyTo(f,v)):this}jumpTo(a,f){this.stop();const v=a.preloadOnly?this.transform.clone():this.transform;let S=!1,T=!1,N=!1;return"zoom"in a&&v.zoom!==+a.zoom&&(S=!0,v.zoom=+a.zoom),a.center!==void 0&&(v.center=o.LngLat.convert(a.center)),"bearing"in a&&v.bearing!==+a.bearing&&(T=!0,v.bearing=+a.bearing),"pitch"in a&&v.pitch!==+a.pitch&&(N=!0,v.pitch=+a.pitch),a.padding==null||v.isPaddingEqual(a.padding)||(v.padding=a.padding),a.preloadOnly?(this._preloadTiles(v),this):(this.fire(new o.Event("movestart",f)).fire(new o.Event("move",f)),S&&this.fire(new o.Event("zoomstart",f)).fire(new o.Event("zoom",f)).fire(new o.Event("zoomend",f)),T&&this.fire(new o.Event("rotatestart",f)).fire(new o.Event("rotate",f)).fire(new o.Event("rotateend",f)),N&&this.fire(new o.Event("pitchstart",f)).fire(new o.Event("pitch",f)).fire(new o.Event("pitchend",f)),this.fire(new o.Event("moveend",f)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.warnOnce(Cl),this.transform.getFreeCameraOptions()}setFreeCameraOptions(a,f){const v=this.transform;if(!v.projection.supportsFreeCamera)return o.warnOnce(Cl),this;this.stop();const S=v.zoom,T=v.pitch,N=v.bearing;v.setFreeCameraOptions(a);const z=S!==v.zoom,G=T!==v.pitch,Q=N!==v.bearing;return this.fire(new o.Event("movestart",f)).fire(new o.Event("move",f)),z&&this.fire(new o.Event("zoomstart",f)).fire(new o.Event("zoom",f)).fire(new o.Event("zoomend",f)),Q&&this.fire(new o.Event("rotatestart",f)).fire(new o.Event("rotate",f)).fire(new o.Event("rotateend",f)),G&&this.fire(new o.Event("pitchstart",f)).fire(new o.Event("pitch",f)).fire(new o.Event("pitchend",f)),this.fire(new o.Event("moveend",f)),this}easeTo(a,f){this._stop(!1,a.easeId),((a=o.extend({offset:[0,0],duration:500,easing:o.ease},a)).animate===!1||this._prefersReducedMotion(a))&&(a.duration=0);const v=this.transform,S=this.getZoom(),T=this.getBearing(),N=this.getPitch(),z=this.getPadding(),G="zoom"in a?+a.zoom:S,Q="bearing"in a?this._normalizeBearing(a.bearing,T):T,te="pitch"in a?+a.pitch:N,ge="padding"in a?a.padding:v.padding,Ae=o.Point.convert(a.offset);let Le,Xe,Ue;if(v.projection.name==="globe"){const Tt=o.MercatorCoordinate.fromLngLat(v.center),Vt=Ae.rotate(-v.angle);Tt.x+=Vt.x/v.worldSize,Tt.y+=Vt.y/v.worldSize;const vn=Tt.toLngLat(),Bt=o.LngLat.convert(a.center||vn);this._normalizeCenter(Bt),Le=v.centerPoint.add(Vt),Xe=new o.Point(Tt.x,Tt.y).mult(v.worldSize),Ue=new o.Point(o.mercatorXfromLng(Bt.lng),o.mercatorYfromLat(Bt.lat)).mult(v.worldSize).sub(Xe)}else{Le=v.centerPoint.add(Ae);const Tt=v.pointLocation(Le),Vt=o.LngLat.convert(a.center||Tt);this._normalizeCenter(Vt),Xe=v.project(Tt),Ue=v.project(Vt).sub(Xe)}const Ze=v.zoomScale(G-S);let _e,$e;a.around&&(_e=o.LngLat.convert(a.around),$e=v.locationPoint(_e));const it=this._zooming||G!==S,st=this._rotating||T!==Q,bt=this._pitching||te!==N,wt=!v.isPaddingEqual(ge),vt=Tt=>Vt=>{if(it&&(Tt.zoom=o.number(S,G,Vt)),st&&(Tt.bearing=o.number(T,Q,Vt)),bt&&(Tt.pitch=o.number(N,te,Vt)),wt&&(Tt.interpolatePadding(z,ge,Vt),Le=Tt.centerPoint.add(Ae)),_e)Tt.setLocationAtPoint(_e,$e);else{const vn=Tt.zoomScale(Tt.zoom-S),Bt=G>S?Math.min(2,Ze):Math.max(.5,Ze),ln=Math.pow(Bt,1-Vt),Wt=Tt.unproject(Xe.add(Ue.mult(Vt*ln)).mult(vn));Tt.setLocationAtPoint(Tt.renderWorldCopies?Wt.wrap():Wt,Le)}return a.preloadOnly||this._fireMoveEvents(f),Tt};if(a.preloadOnly){const Tt=this._emulate(vt,a.duration,v);return this._preloadTiles(Tt),this}const kt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=it,this._rotating=st,this._pitching=bt,this._padding=wt,this._easeId=a.easeId,this._prepareEase(f,a.noMoveStart,kt),this._ease(vt(v),(Tt=>{v.recenterOnTerrain(),this._afterEase(f,Tt)}),a),this}_prepareEase(a,f,v={}){this._moving=!0,this.transform.cameraElevationReference="sea",f||v.moving||this.fire(new o.Event("movestart",a)),this._zooming&&!v.zooming&&this.fire(new o.Event("zoomstart",a)),this._rotating&&!v.rotating&&this.fire(new o.Event("rotatestart",a)),this._pitching&&!v.pitching&&this.fire(new o.Event("pitchstart",a))}_fireMoveEvents(a){this.fire(new o.Event("move",a)),this._zooming&&this.fire(new o.Event("zoom",a)),this._rotating&&this.fire(new o.Event("rotate",a)),this._pitching&&this.fire(new o.Event("pitch",a))}_afterEase(a,f){if(this._easeId&&f&&this._easeId===f)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const v=this._zooming,S=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,v&&this.fire(new o.Event("zoomend",a)),S&&this.fire(new o.Event("rotateend",a)),T&&this.fire(new o.Event("pitchend",a)),this.fire(new o.Event("moveend",a))}flyTo(a,f){if(this._prefersReducedMotion(a)){const cn=o.pick(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(cn,f)}this.stop(),a=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},a);const v=this.transform,S=this.getZoom(),T=this.getBearing(),N=this.getPitch(),z=this.getPadding(),G="zoom"in a?o.clamp(+a.zoom,v.minZoom,v.maxZoom):S,Q="bearing"in a?this._normalizeBearing(a.bearing,T):T,te="pitch"in a?+a.pitch:N,ge="padding"in a?a.padding:v.padding,Ae=v.zoomScale(G-S),Le=o.Point.convert(a.offset);let Xe=v.centerPoint.add(Le);const Ue=v.pointLocation(Xe),Ze=o.LngLat.convert(a.center||Ue);this._normalizeCenter(Ze);const _e=v.project(Ue),$e=v.project(Ze).sub(_e);let it=a.curve;const st=Math.max(v.width,v.height),bt=st/Ae,wt=$e.mag();if("minZoom"in a){const cn=o.clamp(Math.min(a.minZoom,S,G),v.minZoom,v.maxZoom),Nn=st/v.zoomScale(cn-S);it=Math.sqrt(Nn/wt*2)}const vt=it*it;function kt(cn){const Nn=(bt*bt-st*st+(cn?-1:1)*vt*vt*wt*wt)/(2*(cn?bt:st)*vt*wt);return Math.log(Math.sqrt(Nn*Nn+1)-Nn)}function Tt(cn){return(Math.exp(cn)-Math.exp(-cn))/2}function Vt(cn){return(Math.exp(cn)+Math.exp(-cn))/2}const vn=kt(0);let Bt=function(cn){return Vt(vn)/Vt(vn+it*cn)},ln=function(cn){return st*((Vt(vn)*(Tt(Nn=vn+it*cn)/Vt(Nn))-Tt(vn))/vt)/wt;var Nn},Wt=(kt(1)-vn)/it;if(Math.abs(wt)<1e-6||!isFinite(Wt)){if(Math.abs(st-bt)<1e-6)return this.easeTo(a,f);const cn=bt<st?-1:1;Wt=Math.abs(Math.log(bt/st))/it,ln=function(){return 0},Bt=function(Nn){return Math.exp(cn*it*Nn)}}a.duration="duration"in a?+a.duration:1e3*Wt/("screenSpeed"in a?+a.screenSpeed/it:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0);const Cn=T!==Q,Ut=te!==N,rn=!v.isPaddingEqual(ge),Tn=cn=>Nn=>{const hr=Nn*Wt,Dr=1/Bt(hr);cn.zoom=Nn===1?G:S+cn.scaleZoom(Dr),Cn&&(cn.bearing=o.number(T,Q,Nn)),Ut&&(cn.pitch=o.number(N,te,Nn)),rn&&(cn.interpolatePadding(z,ge,Nn),Xe=cn.centerPoint.add(Le));const rr=Nn===1?Ze:cn.unproject(_e.add($e.mult(ln(hr))).mult(Dr));return cn.setLocationAtPoint(cn.renderWorldCopies?rr.wrap():rr,Xe),cn._updateCameraOnTerrain(),a.preloadOnly||this._fireMoveEvents(f),cn};if(a.preloadOnly){const cn=this._emulate(Tn,a.duration,v);return this._preloadTiles(cn),this}return this._zooming=!0,this._rotating=Cn,this._pitching=Ut,this._padding=rn,this._prepareEase(f,!1),this._ease(Tn(v),(()=>this._afterEase(f)),a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(a,f){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const v=this._onEaseEnd;this._onEaseEnd=void 0,v.call(this,f)}if(!a){const v=this.handlers;v&&v.stop(!1)}return this}_ease(a,f,v){v.animate===!1||v.duration===0?(a(1),f()):(this._easeStart=o.exported.now(),this._easeOptions=v,this._onEaseFrame=a,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const a=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1),f=this._onEaseFrame;f&&f(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(a,f){a=o.wrap(a,-180,180);const v=Math.abs(a-f);return Math.abs(a-360-f)<v&&(a-=360),Math.abs(a+360-f)<v&&(a+=360),a}_normalizeCenter(a){const f=this.transform;if(!f.renderWorldCopies||f.maxBounds)return;const v=a.lng-f.center.lng;a.lng+=v>180?-360:v<-180?360:0}_prefersReducedMotion(a){return this._respectPrefersReducedMotion&&o.exported.prefersReducedMotion&&!(a&&a.essential)}_emulate(a,f,v){const S=Math.ceil(15*f/1e3),T=[],N=a(v.clone());for(let z=0;z<=S;z++){const G=N(z/S);T.push(G.clone())}return T}}class ur{constructor(a={}){this.options=a,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(a){const f=this.options&&this.options.compact;return this._map=a,this._container=k("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=k("button","mapboxgl-ctrl-attrib-button",this._container),k("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=k("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(a,f){const v=this._map._getUIString(`AttributionControl.${f}`);a.setAttribute("aria-label",v),a.removeAttribute("title"),a.firstElementChild&&a.firstElementChild.setAttribute("title",v)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let a=this._editLink;a||(a=this._editLink=this._container.querySelector(".mapbox-improve-map"));const f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(a){const v=f.reduce(((S,T,N)=>(T.value&&(S+=`${T.key}=${T.value}${N<f.length-1?"&":""}`),S)),"?");a.href=`${o.config.FEEDBACK_URL}/${v}#${ru(this._map,!0)}`,a.rel="noopener nofollow",this._setElementTitle(a,"MapFeedback")}}_updateData(a){!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let a=[];if(this._map.style.stylesheet){const S=this._map.style.stylesheet;this.styleOwner=S.owner,this.styleId=S.id}const f=this._map.style._sourceCaches;for(const S in f){const T=f[S];if(T.used){const N=T.getSource();N.attribution&&a.indexOf(N.attribution)<0&&a.push(N.attribution)}}a.sort(((S,T)=>S.length-T.length)),a=a.filter(((S,T)=>{for(let N=T+1;N<a.length;N++)if(a[N].indexOf(S)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=[...this.options.customAttribution,...a]:a.unshift(this.options.customAttribution));const v=a.join(" | ");v!==this._attribHTML&&(this._attribHTML=v,a.length?(this._innerContainer.innerHTML=v,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class eh{constructor(){o.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(a){this._map=a,this._container=k("div","mapboxgl-ctrl");const f=k("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(a){a&&a.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const a=this._map.style._sourceCaches;if(Object.entries(a).length===0)return!0;for(const f in a){const v=a[f].getSource();if(v.hasOwnProperty("mapbox_logo")&&!v.mapbox_logo)return!1}return!0}_updateCompact(){const a=this._container.children;if(a.length){const f=a[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}}}class C{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const f=++this._id;return this._queue.push({callback:a,id:f,cancelled:!1}),f}remove(a){const f=this._currentlyRunning,v=f?this._queue.concat(f):this._queue;for(const S of v)if(S.id===a)return void(S.cancelled=!0)}run(a=0){const f=this._currentlyRunning=this._queue;this._queue=[];for(const v of f)if(!v.cancelled&&(v.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function B(y,a,f){if(y=new o.LngLat(y.lng,y.lat),a){const v=new o.LngLat(y.lng-360,y.lat),S=new o.LngLat(y.lng+360,y.lat),T=360*Math.ceil(Math.abs(y.lng-f.center.lng)/360),N=f.locationPoint(y).distSqr(a),z=a.x<0||a.y<0||a.x>f.width||a.y>f.height;f.locationPoint(v).distSqr(a)<N&&(z||Math.abs(v.lng-f.center.lng)<T)?y=v:f.locationPoint(S).distSqr(a)<N&&(z||Math.abs(S.lng-f.center.lng)<T)&&(y=S)}for(;Math.abs(y.lng-f.center.lng)>180;){const v=f.locationPoint(y);if(v.x>=0&&v.y>=0&&v.x<=f.width&&v.y<=f.height)break;y.lng>f.center.lng?y.lng-=360:y.lng+=360}return y}const ee={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class oe extends o.Evented{constructor(a,f){if(super(),(a instanceof o.window.HTMLElement||f)&&(a=o.extend({element:a},f)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=a&&a.occludedOpacity||.2,a&&a.element)this._element=a.element,this._offset=o.Point.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=k("div");const S=41,T=27,N=ie("svg",{display:"block",height:S*this._scale+"px",width:T*this._scale+"px",viewBox:`0 0 ${T} ${S}`},this._element),z=ie("radialGradient",{id:"shadowGradient"},ie("defs",{},N));ie("stop",{offset:"10%","stop-opacity":.4},z),ie("stop",{offset:"100%","stop-opacity":.05},z),ie("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},N),ie("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},N),ie("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},N),ie("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},N),this._offset=o.Point.convert(a&&a.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(S=>{S.preventDefault()})),this._element.addEventListener("mousedown",(S=>{S.preventDefault()}));const v=this._element.classList;for(const S in ee)v.remove(`mapboxgl-marker-anchor-${S}`);v.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(a){return a===this._map||(this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._updateMoving),a.on("moveend",this._update),a.on("remove",this._clearFadeTimer),a._addMarker(this),this.setDraggable(this._draggable),this._update(),a.on("click",this._onMapClick)),this}remove(){const a=this._map;return a&&(a.off("click",this._onMapClick),a.off("move",this._updateMoving),a.off("moveend",this._update),a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler),a.off("mouseup",this._onUp),a.off("touchend",this._onUp),a.off("mousemove",this._onMove),a.off("touchmove",this._onMove),a.off("remove",this._clearFadeTimer),a._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=o.LngLat.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const S=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[S,-1*(38.1-13.5+S)],"bottom-right":[-S,-1*(38.1-13.5+S)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=a,a._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(a){const f=a.code,v=a.charCode||a.keyCode;f!=="Space"&&f!=="Enter"&&v!==32&&v!==13||this.togglePopup()}_onMapClick(a){const f=a.originalEvent.target,v=this._element;this._popup&&(f===v||v.contains(f))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const a=this._popup;return a?(a.isOpen()?(a.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(a.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const a=this._map,f=this._pos;if(!a||!f)return!1;const v=a.unproject(f),S=a.getFreeCameraOptions();if(!S.position)return!1;const T=S.position.toLngLat();return T.distanceTo(v)<.9*T.distanceTo(this._lngLat)}_evaluateOpacity(){const a=this._map;if(!a)return;const f=this._pos;if(!f||f.x<0||f.x>a.transform.width||f.y<0||f.y>a.transform.height)return void this._clearFadeTimer();const v=a.unproject(f);let S;a._showingGlobe()&&o.isLngLatBehindGlobe(a.transform,this._lngLat)?S=0:(S=1-a._queryFogOpacity(v),a.transform._terrainEnabled()&&a.getTerrain()&&this._behindTerrain()&&(S*=this._occludedOpacity)),this._element.style.opacity=`${S}`,this._element.style.pointerEvents=S>0?"auto":"none",this._popup&&this._popup._setOpacity(S),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const a=this._pos;if(!a||!this._map)return;const f=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${a.x}px,${a.y}px)
            ${ee[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${f.x}px,${f.y}px)
        `}_calculateXYTransform(){const a=this._pos,f=this._map,v=this.getPitchAlignment();if(!f||!a||v!=="map")return"";if(!f._showingGlobe()){const G=f.getPitch();return G?`rotateX(${G}deg)`:""}const S=o.radToDeg(o.globeTiltAtLngLat(f.transform,this._lngLat)),T=a.sub(o.globeCenterToScreenPoint(f.transform)),N=Math.abs(T.x)+Math.abs(T.y);if(N===0)return"";const z=S/N;return`rotateX(${-T.y*z}deg) rotateY(${T.x*z}deg)`}_calculateZTransform(){const a=this._pos,f=this._map;if(!f||!a)return"";let v=0;const S=this.getRotationAlignment();if(S==="map")if(f._showingGlobe()){const T=f.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),N=f.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(T);v=o.radToDeg(Math.atan2(N.y,N.x))-90}else v=-f.getBearing();else if(S==="horizon"){const T=o.smoothstep(4,6,f.getZoom()),N=o.globeCenterToScreenPoint(f.transform);N.y+=T*f.transform.height;const z=a.sub(N),G=o.radToDeg(Math.atan2(z.y,z.x));v=(G>90?G-270:G+90)*(1-T)}return v+=this._rotation,v?`rotateZ(${v}deg)`:""}_update(a){o.window.cancelAnimationFrame(this._updateFrameId);const f=this._map;f&&(f.transform.renderWorldCopies&&(this._lngLat=B(this._lngLat,this._pos,f.transform)),this._pos=f.project(this._lngLat),a===!0?this._updateFrameId=o.window.requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),f._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(f._showingGlobe()||f.getTerrain()||f.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(a){return this._offset=o.Point.convert(a),this._update(),this}_onMove(a){const f=this._map;if(!f)return;const v=this._pointerdownPos,S=this._positionDelta;if(v&&S){if(!this._isDragging){const T=this._clickTolerance||f._clickTolerance;if(a.point.dist(v)<T)return;this._isDragging=!0}this._pos=a.point.sub(S),this._lngLat=f.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const a=this._map;a&&(a.off("mousemove",this._onMove),a.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(a){const f=this._map,v=this._pos;f&&v&&this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(v),this._pointerdownPos=a.point,this._state="pending",f.on("mousemove",this._onMove),f.on("touchmove",this._onMove),f.once("mouseup",this._onUp),f.once("touchend",this._onUp))}setDraggable(a){this._draggable=!!a;const f=this._map;return f&&(a?(f.on("mousedown",this._addDragHandler),f.on("touchstart",this._addDragHandler)):(f.off("mousedown",this._addDragHandler),f.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(a){return this._occludedOpacity=a||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Pe={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ve=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function We(y=new o.Point(0,0),a="bottom"){if(typeof y=="number"){const f=Math.round(Math.sqrt(.5*Math.pow(y,2)));switch(a){case"top":return new o.Point(0,y);case"top-left":return new o.Point(f,f);case"top-right":return new o.Point(-f,f);case"bottom":return new o.Point(0,-y);case"bottom-left":return new o.Point(f,-f);case"bottom-right":return new o.Point(-f,-f);case"left":return new o.Point(y,0);case"right":return new o.Point(-y,0)}return new o.Point(0,0)}return y instanceof o.Point||Array.isArray(y)?o.Point.convert(y):o.Point.convert(y[a]||[0,0])}class Je{constructor(a){this.jumpTo(a)}getValue(a){if(a<=this._startTime)return this._start;if(a>=this._endTime)return this._end;const f=o.easeCubicInOut((a-this._startTime)/(this._endTime-this._startTime));return this._start*(1-f)+this._end*f}isEasing(a){return a>=this._startTime&&a<=this._endTime}jumpTo(a){this._startTime=-1/0,this._endTime=-1/0,this._start=a,this._end=a}easeTo(a,f,v){this._start=this.getValue(f),this._end=a,this._startTime=f,this._endTime=f+v}}const nt={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},ut={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},Nt={showCompass:!0,showZoom:!0,visualizePitch:!1};class Yt{constructor(a,f,v=!1){this._clickTolerance=10,this.element=f,this.mouseRotate=new za({clickTolerance:a.dragRotate._mouseRotate._clickTolerance}),this.map=a,v&&(this.mousePitch=new Ui({clickTolerance:a.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),f.addEventListener("mousedown",this.mousedown),f.addEventListener("touchstart",this.touchstart,{passive:!1}),f.addEventListener("touchmove",this.touchmove),f.addEventListener("touchend",this.touchend),f.addEventListener("touchcancel",this.reset)}down(a,f){this.mouseRotate.mousedown(a,f),this.mousePitch&&this.mousePitch.mousedown(a,f),ne()}move(a,f){const v=this.map,S=this.mouseRotate.mousemoveWindow(a,f),T=S&&S.bearingDelta;if(T&&v.setBearing(v.getBearing()+T),this.mousePitch){const N=this.mousePitch.mousemoveWindow(a,f),z=N&&N.pitchDelta;z&&v.setPitch(v.getPitch()+z)}}off(){const a=this.element;a.removeEventListener("mousedown",this.mousedown),a.removeEventListener("touchstart",this.touchstart,{passive:!1}),a.removeEventListener("touchmove",this.touchmove),a.removeEventListener("touchend",this.touchend),a.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){me(),o.window.removeEventListener("mousemove",this.mousemove),o.window.removeEventListener("mouseup",this.mouseup)}mousedown(a){this.down(o.extend({},a,{ctrlKey:!0,preventDefault:()=>a.preventDefault()}),ze(this.element,a)),o.window.addEventListener("mousemove",this.mousemove),o.window.addEventListener("mouseup",this.mouseup)}mousemove(a){this.move(a,ze(this.element,a))}mouseup(a){this.mouseRotate.mouseupWindow(a),this.mousePitch&&this.mousePitch.mouseupWindow(a),this.offTemp()}touchstart(a){a.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=pe(this.element,a.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>a.preventDefault()},this._startPos))}touchmove(a){a.targetTouches.length!==1?this.reset():(this._lastPos=pe(this.element,a.targetTouches)[0],this.move({preventDefault:()=>a.preventDefault()},this._lastPos))}touchend(a){a.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const dt={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},jt={maxWidth:100,unit:"metric"},Qt={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},En={version:o.version,supported:I,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends Qu{constructor(y){if(o.LivePerformanceUtils.mark(o.PerformanceMarkers.create),(y=o.extend({},ut,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(y.antialias&&o.isSafariWithAntialiasingBug(o.window)&&(y.antialias=!1,o.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new mr(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies),y),this._interactive=y.interactive,this._minTileCacheSize=y.minTileCacheSize,this._maxTileCacheSize=y.maxTileCacheSize,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._useWebGL2=y.useWebGL2,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=y.crossSourceCollisions,this._collectResourceTiming=y.collectResourceTiming,this._optimizeForTerrain=y.optimizeForTerrain,this._language=this._parseLanguage(y.language),this._worldview=y.worldview,this._renderTaskQueue=new C,this._domRenderTaskQueue=new C,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.uniqueId(),this._locale=o.extend({},nt,y.locale),this._clickTolerance=y.clickTolerance,this._cooperativeGestures=y.cooperativeGestures,this._performanceMetricsCollection=y.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Je(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new o.RequestManager(y.transformRequest,y.accessToken,y.testMode),this._silenceAuthErrors=!!y.testMode,typeof y.container=="string"){if(this._container=o.window.document.getElementById(y.container),!this._container)throw new Error(`Container '${y.container}' not found.`)}else{if(!(y.container instanceof o.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(this._container.childNodes.length>0&&o.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),y.maxBounds&&this.setMaxBounds(y.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1),o.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Gl(this,y),this._localFontFamily=y.localFontFamily,this._localIdeographFontFamily=y.localIdeographFontFamily,y.style&&this.setStyle(y.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),y.projection&&this.setProjection(y.projection),this._hash=y.hash&&new pl(typeof y.hash=="string"&&y.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}),y.bounds&&(this.resize(),this.fitBounds(y.bounds,o.extend({},y.fitBoundsOptions,{duration:0})))),this.resize(),y.attributionControl&&this.addControl(new ur({customAttribution:y.customAttribution})),this._logoControl=new eh,this.addControl(this._logoControl,y.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(a=>{this._update(a.dataType==="style"),this.fire(new o.Event(`${a.dataType}data`,a))})),this.on("dataloading",(a=>{this.fire(new o.Event(`${a.dataType}dataloading`,a))}))}_getMapId(){return this._mapId}addControl(y,a){if(a===void 0&&(a=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=y.onAdd(this);this._controls.push(y);const v=this._controlPositions[a];return a.indexOf("bottom")!==-1?v.insertBefore(f,v.firstChild):v.appendChild(f),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(y);return a>-1&&this._controls.splice(a,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(y){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const a=!this._moving;return a&&this.fire(new o.Event("movestart",y)).fire(new o.Event("move",y)),this.fire(new o.Event("resize",y)),a&&this.fire(new o.Event("moveend",y)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(y){return this.transform.setMaxBounds(o.LngLatBounds.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y?this.setZoom(y):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y?this.setZoom(y):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y?this.setPitch(y):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y?this.setPitch(y):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(y){return y==="auto"?o.window.navigator.language:Array.isArray(y)?y.length===0?void 0:y.map((a=>a==="auto"?o.window.navigator.language:a)):y}setLanguage(y){const a=this._parseLanguage(y);if(!this.style||a===this._language)return this;this._language=a,this.style._reloadSources();for(const f of this._controls)f._setLanguage&&f._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(y){return this.style&&y!==this._worldview?(this._worldview=y,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(y){return this._lazyInitEmptyStyle(),y?typeof y=="string"&&(y={name:y}):y=null,this._useExplicitProjection=!!y,this._prioritizeAndUpdateProjection(y,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const y=this.transform,a=y.projection.name;let f;a==="globe"&&y.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?(y.setMercatorFromTransition(),f=!0):a==="mercator"&&y.zoom<o.GLOBE_ZOOM_THRESHOLD_MAX&&(y.setProjection({name:"globe"}),f=!0),f&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(y,a){return this._updateProjection(y||a||{name:"mercator"})}_updateProjection(y){let a;if(a=y.name==="globe"&&this.transform.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(y),this.style.applyProjectionUpdate(),a){this.painter.clearBackgroundTiles();for(const f in this.style._sourceCaches)this.style._sourceCaches[f].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(y){return this.transform.locationPoint3D(o.LngLat.convert(y))}unproject(y){return this.transform.pointLocation3D(o.Point.convert(y))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(y,a,f){if(y==="mouseenter"||y==="mouseover"){let v=!1;const S=N=>{const z=a.filter((Q=>this.getLayer(Q))),G=z.length?this.queryRenderedFeatures(N.point,{layers:z}):[];G.length?v||(v=!0,f.call(this,new Ri(y,this,N.originalEvent,{features:G}))):v=!1},T=()=>{v=!1};return{layers:new Set(a),listener:f,delegates:{mousemove:S,mouseout:T}}}if(y==="mouseleave"||y==="mouseout"){let v=!1;const S=N=>{const z=a.filter((G=>this.getLayer(G)));(z.length?this.queryRenderedFeatures(N.point,{layers:z}):[]).length?v=!0:v&&(v=!1,f.call(this,new Ri(y,this,N.originalEvent)))},T=N=>{v&&(v=!1,f.call(this,new Ri(y,this,N.originalEvent)))};return{layers:new Set(a),listener:f,delegates:{mousemove:S,mouseout:T}}}{const v=S=>{const T=a.filter((z=>this.getLayer(z))),N=T.length?this.queryRenderedFeatures(S.point,{layers:T}):[];N.length&&(S.features=N,f.call(this,S),delete S.features)};return{layers:new Set(a),listener:f,delegates:{[y]:v}}}}on(y,a,f){if(f===void 0)return super.on(y,a);Array.isArray(a)||(a=[a]);const v=this._createDelegatedListener(y,a,f);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(v);for(const S in v.delegates)this.on(S,v.delegates[S]);return this}once(y,a,f){if(f===void 0)return super.once(y,a);Array.isArray(a)||(a=[a]);const v=this._createDelegatedListener(y,a,f);for(const S in v.delegates)this.once(S,v.delegates[S]);return this}off(y,a,f){if(f===void 0)return super.off(y,a);a=new Set(Array.isArray(a)?a:[a]);const v=(T,N)=>{if(T.size!==N.size)return!1;for(const z of T)if(!N.has(z))return!1;return!0},S=this._delegatedListeners?this._delegatedListeners[y]:void 0;return S&&(T=>{for(let N=0;N<T.length;N++){const z=T[N];if(z.listener===f&&v(z.layers,a)){for(const G in z.delegates)this.off(G,z.delegates[G]);return T.splice(N,1),this}}})(S),this}queryRenderedFeatures(y,a){return this.style?(a!==void 0||y===void 0||y instanceof o.Point||Array.isArray(y)||(a=y,y=void 0),this.style.queryRenderedFeatures(y=y||[[0,0],[this.transform.width,this.transform.height]],a=a||{},this.transform)):[]}querySourceFeatures(y,a){return this.style.querySourceFeatures(y,a)}isPointOnSurface(y){const{name:a}=this.transform.projection;return a!=="globe"&&a!=="mercator"&&o.warnOnce(`${a} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.Point.convert(y))}setStyle(y,a){return(a=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},a)).diff!==!1&&a.localIdeographFontFamily===this._localIdeographFontFamily&&a.localFontFamily===this._localFontFamily&&this.style&&y?(this._diffStyle(y,a),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._localFontFamily=a.localFontFamily,this._updateStyle(y,a))}_getUIString(y){const a=this._locale[y];if(a==null)throw new Error(`Missing UI string '${y}'`);return a}_updateStyle(y,a){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),y&&(this.style=new Ai(this,a||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y):this.style.loadJSON(y)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ai(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,a){if(typeof y=="string"){const f=this._requestManager.normalizeStyleURL(y),v=this._requestManager.transformRequest(f,o.ResourceType.Style);o.getJSON(v,((S,T)=>{S?this.fire(new o.ErrorEvent(S)):T&&this._updateDiff(T,a)}))}else typeof y=="object"&&this._updateDiff(y,a)}_updateDiff(y,a){try{this.style.setState(y)&&this._update(!0)}catch(f){o.warnOnce(`Unable to perform style diff: ${f.message||f.error||f}.  Rebuilding the style from scratch.`),this._updateStyle(y,a)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.warnOnce("There is no style added to the map."),!1)}addSource(y,a){return this._lazyInitEmptyStyle(),this.style.addSource(y,a),this._update(!0)}isSourceLoaded(y){return!!this.style&&this.style._isSourceCacheLoaded(y)}areTilesLoaded(){const y=this.style&&this.style._sourceCaches;for(const a in y){const f=y[a]._tiles;for(const v in f){const S=f[v];if(S.state!=="loaded"&&S.state!=="errored")return!1}}return!0}addSourceType(y,a,f){this._lazyInitEmptyStyle(),this.style.addSourceType(y,a,f)}removeSource(y){return this.style.removeSource(y),this._updateTerrain(),this._update(!0)}getSource(y){return this.style.getSource(y)}addImage(y,a,{pixelRatio:f=1,sdf:v=!1,stretchX:S,stretchY:T,content:N}={}){if(this._lazyInitEmptyStyle(),a instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&a instanceof o.window.ImageBitmap){const{width:z,height:G,data:Q}=o.exported.getImageData(a);this.style.addImage(y,{data:new o.RGBAImage({width:z,height:G},Q),pixelRatio:f,stretchX:S,stretchY:T,content:N,sdf:v,version:0})}else if(a.width===void 0||a.height===void 0)this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:z,height:G}=a,Q=a;this.style.addImage(y,{data:new o.RGBAImage({width:z,height:G},new Uint8Array(Q.data)),pixelRatio:f,stretchX:S,stretchY:T,content:N,sdf:v,version:0,userImage:Q}),Q.onAdd&&Q.onAdd(this,y)}}updateImage(y,a){const f=this.style.getImage(y);if(!f)return void this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const v=a instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&a instanceof o.window.ImageBitmap?o.exported.getImageData(a):a,{width:S,height:T}=v;S!==void 0&&T!==void 0?S===f.data.width&&T===f.data.height?(f.data.replace(v.data,!(a instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&a instanceof o.window.ImageBitmap)),this.style.updateImage(y,f)):this.fire(new o.ErrorEvent(new Error(`The width and height of the updated image (${S}, ${T})
                must be that same as the previous version of the image
                (${f.data.width}, ${f.data.height})`))):this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y,a){o.getImage(this._requestManager.transformRequest(y,o.ResourceType.Image),((f,v)=>{a(f,v instanceof o.window.HTMLImageElement?o.exported.getImageData(v):v)}))}listImages(){return this.style.listImages()}addLayer(y,a){return this._lazyInitEmptyStyle(),this.style.addLayer(y,a),this._update(!0)}moveLayer(y,a){return this.style.moveLayer(y,a),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}setLayerZoomRange(y,a,f){return this.style.setLayerZoomRange(y,a,f),this._update(!0)}setFilter(y,a,f={}){return this.style.setFilter(y,a,f),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,a,f,v={}){return this.style.setPaintProperty(y,a,f,v),this._update(!0)}getPaintProperty(y,a){return this.style.getPaintProperty(y,a)}setLayoutProperty(y,a,f,v={}){return this.style.setLayoutProperty(y,a,f,v),this._update(!0)}getLayoutProperty(y,a){return this.style.getLayoutProperty(y,a)}setLight(y,a={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,a),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(y){return this._lazyInitEmptyStyle(),!y&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(y),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(y){return this._lazyInitEmptyStyle(),this.style.setFog(y),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(y){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.LngLat.convert(y),this.transform):0}setFeatureState(y,a){return this.style.setFeatureState(y,a),this._update()}removeFeatureState(y,a){return this.style.removeFeatureState(y,a),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}_updateContainerDimensions(){if(!this._container)return;const y=this._container.getBoundingClientRect().width||400,a=this._container.getBoundingClientRect().height||300;let f,v,S,T=this._container;for(;T&&(!v||!S);){const N=o.window.getComputedStyle(T).transform;N&&N!=="none"&&(f=N.match(/matrix.*\((.+)\)/)[1].split(", "),f[0]&&f[0]!=="0"&&f[0]!=="1"&&(v=f[0]),f[3]&&f[3]!=="0"&&f[3]!=="1"&&(S=f[3])),T=T.parentElement}this._containerWidth=v?Math.abs(y/v):y,this._containerHeight=S?Math.abs(a/S):a}_detectMissingCSS(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const y=this._container;y.classList.add("mapboxgl-map"),(this._missingCSSCanary=k("div","mapboxgl-canary",y)).style.visibility="hidden",this._detectMissingCSS();const a=this._canvasContainer=k("div","mapboxgl-canvas-container",y);this._interactive&&a.classList.add("mapboxgl-interactive"),this._canvas=k("canvas","mapboxgl-canvas",a),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const f=this._controlContainer=k("div","mapboxgl-control-container",y),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((S=>{v[S]=k("div",`mapboxgl-ctrl-${S}`,f)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,a){const f=o.exported.devicePixelRatio||1;this._canvas.width=f*Math.ceil(y),this._canvas.height=f*Math.ceil(a),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${a}px`}_addMarker(y){this._markers.push(y)}_removeMarker(y){const a=this._markers.indexOf(y);a!==-1&&this._markers.splice(a,1)}_addPopup(y){this._popups.push(y)}_removePopup(y){const a=this._popups.indexOf(y);a!==-1&&this._popups.splice(a,1)}_setupPainter(){const y=o.extend({},I.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),a=this._useWebGL2&&this._canvas.getContext("webgl2",y),f=a||this._canvas.getContext("webgl",y)||this._canvas.getContext("experimental-webgl",y);f?(this._useWebGL2&&!a&&o.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),o.storeAuthState(f,!0),this.painter=new As(f,this.transform,!!a),this.on("data",(v=>{v.dataType==="source"&&this.painter.setTileLoadedFlag(!0)})),o.exported$1.testSupport(f)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(y){y.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:y}))}_contextRestored(y){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:y}))}_onMapScroll(y){if(y.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_requestDomTask(y){!this.loaded()||this.loaded()&&!this.isMoving()?y():this._domRenderTaskQueue.add(y)}_render(y){let a;const f=this.painter.context.extTimerQuery,v=o.exported.now();if(this.listens("gpu-timing-frame")&&(a=f.createQueryEXT(),f.beginQueryEXT(f.TIME_ELAPSED_EXT,a)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],o.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],o.window.performance.now())),this._renderTaskQueue.run(y),this._domRenderTaskQueue.run(y),this._removed)return;this._updateProjectionTransition();const S=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const z=this.transform.zoom,G=this.transform.pitch,Q=o.exported.now(),te=new o.EvaluationParameters(z,{now:Q,fadeDuration:S,pitch:G,transition:this.style.getTransition()});this.style.update(te)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(v),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):T=this._updateAverageElevation(v),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,S,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:S,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),a){const z=o.exported.now()-v;f.endQueryEXT(f.TIME_ELAPSED_EXT,a),setTimeout((()=>{const G=f.getQueryObjectEXT(a,f.QUERY_RESULT_EXT)/1e6;f.deleteQueryEXT(a),this.fire(new o.Event("gpu-timing-frame",{cpuTime:z,gpuTime:G})),o.window.performance.mark("frame-gpu",{startTime:v,detail:{gpuTime:G}})}),50)}if(this.listens("gpu-timing-layer")){const z=this.painter.collectGpuTimers();setTimeout((()=>{const G=this.painter.queryGpuTimers(z);this.fire(new o.Event("gpu-timing-layer",{layerTimes:G}))}),50)}if(this.listens("gpu-timing-deferred-render")){const z=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const G=this.painter.queryGpuTimeDeferredRender(z);this.fire(new o.Event("gpu-timing-deferred-render",{gpuTime:G}))}),50)}const N=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(N||this._repaint)this.triggerRepaint();else{const z=!this.isMoving()&&this.loaded();if(z&&(T=this._updateAverageElevation(v,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),z&&(this.fire(new o.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const G=this._calculateSpeedIndex();this.fire(new o.Event("speedindexcompleted",{speedIndex:G})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||N||(this._fullyLoaded=!0,o.LivePerformanceUtils.mark(o.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&o.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(y){for(const a of this._markers)y&&!this.getRenderWorldCopies()&&(a._lngLat=a._lngLat.wrap()),a._update();for(const a of this._popups)!y||this.getRenderWorldCopies()||a._trackPointer||(a._lngLat=a._lngLat.wrap()),a._update()}_updateAverageElevation(y,a=!1){const f=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&f(0);if((a||y-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(y)){const v=this.transform.averageElevation;let S=this.transform.sampleAverageElevation(),T=!1;this.transform.elevation&&(T=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(S)?S=0:this._averageElevationLastSampledAt=y;const N=Math.abs(v-S);if(N>1){if(this._isInitialLoad||T)return this._averageElevation.jumpTo(S),f(S);this._averageElevation.easeTo(S,y,300)}else if(N>1e-4)return this._averageElevation.jumpTo(S),f(S)}return!!this._averageElevation.isEasing(y)&&f(this._averageElevation.getValue(y))}_authenticate(){o.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(y=>{if(y&&(y.message===o.AUTH_ERR_MSG||y.status===401)){const a=this.painter.context.gl;o.storeAuthState(a,!1),this._logoControl instanceof eh&&this._logoControl._updateLogo(),a&&a.clear(a.DEPTH_BUFFER_BIT|a.COLOR_BUFFER_BIT|a.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),o.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_updateTerrain(){const y=this._isDragging();this.painter.updateTerrain(this.style,y)}_calculateSpeedIndex(){const y=this.painter.canvasCopy(),a=this.painter.getCanvasCopiesAndTimestamps();a.timeStamps.push(performance.now());const f=this.painter.context.gl,v=f.createFramebuffer();function S(T){f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,T,0);const N=new Uint8Array(f.drawingBufferWidth*f.drawingBufferHeight*4);return f.readPixels(0,0,f.drawingBufferWidth,f.drawingBufferHeight,f.RGBA,f.UNSIGNED_BYTE,N),N}return f.bindFramebuffer(f.FRAMEBUFFER,v),this._canvasPixelComparison(S(y),a.canvasCopies.map(S),a.timeStamps)}_canvasPixelComparison(y,a,f){let v=f[1]-f[0];const S=y.length/4;for(let T=0;T<a.length;T++){const N=a[T];let z=0;for(let G=0;G<N.length;G+=4)N[G]===y[G]&&N[G+1]===y[G+1]&&N[G+2]===y[G+2]&&N[G+3]===y[G+3]&&(z+=1);v+=(f[T+2]-f[T+1])*(1-z/S)}return v}remove(){this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1),o.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const y=this.painter.context.gl.getExtension("WEBGL_lose_context");y&&y.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),o.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(y){this._renderNextFrame=this._renderNextFrame||y,this.style&&!this._frame&&(this._frame=o.exported.frame((a=>{const f=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,f&&this._render(a)})))}_preloadTiles(y){const a=this.style?Object.values(this.style._sourceCaches):[];return o.asyncAll(a,((f,v)=>f._preloadTiles(y,v)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(y){this._trackResize&&this.resize({originalEvent:y})._update()}_onVisibilityChange(){o.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(y){this._showTerrainWireframe!==y&&(this._showTerrainWireframe=y,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(y){this._speedIndexTiming!==y&&(this._speedIndexTiming=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(y){this._showTileAABBs!==y&&(this._showTileAABBs=y,y&&this._update())}_setCacheLimits(y,a){o.setCacheLimits(y,a)}get version(){return o.version}},NavigationControl:class{constructor(y){this.options=o.extend({},Nt,y),this._container=k("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(a=>a.preventDefault())),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(a=>{this._map&&this._map.zoomIn({},{originalEvent:a})})),k("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(a=>{this._map&&this._map.zoomOut({},{originalEvent:a})})),k("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(a=>{const f=this._map;f&&(this.options.visualizePitch?f.resetNorthPitch({},{originalEvent:a}):f.resetNorth({},{originalEvent:a}))})),this._compassIcon=k("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const y=this._map;if(!y)return;const a=y.getZoom(),f=a===y.getMaxZoom(),v=a===y.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=v,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",v.toString())}_rotateCompassArrow(){const y=this._map;if(!y)return;const a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(y.transform.pitch*(Math.PI/180)),.5)}) rotateX(${y.transform.pitch}deg) rotateZ(${y.transform.angle*(180/Math.PI)}deg)`:`rotate(${y.transform.angle*(180/Math.PI)}deg)`;y._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=a)}))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),y.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&y.on("pitch",this._rotateCompassArrow),y.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Yt(y,this._compass,this.options.visualizePitch)),this._container}onRemove(){const y=this._map;y&&(this._container.remove(),this.options.showZoom&&y.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&y.off("pitch",this._rotateCompassArrow),y.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(y,a){const f=k("button",y,this._container);return f.type="button",f.addEventListener("click",a),f}_setButtonTitle(y,a){if(!this._map)return;const f=this._map._getUIString(`NavigationControl.${a}`);y.setAttribute("aria-label",f),y.firstElementChild&&y.firstElementChild.setAttribute("title",f)}},GeolocateControl:class extends o.Evented{constructor(y){super(),this.options=o.extend({geolocation:o.window.navigator.geolocation},dt,y),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=eo(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(y){return this._map=y,this._container=k("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(y){const a=(f=!!this.options.geolocation)=>{this._supportsGeolocation=f,y(f)};this._supportsGeolocation!==void 0?y(this._supportsGeolocation):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then((f=>a(f.state!=="denied"))).catch((()=>a())):a()}_isOutOfMapMaxBounds(y){const a=this._map.getMaxBounds(),f=y.coords;return!!a&&(f.longitude<a.getWest()||f.longitude>a.getEast()||f.latitude<a.getSouth()||f.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(y){if(this._map){if(this._isOutOfMapMaxBounds(y))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",y)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=y,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(y),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(y),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",y)),this._finish()}}_updateCamera(y){const a=new o.LngLat(y.coords.longitude,y.coords.latitude),f=y.coords.accuracy,v=this._map.getBearing(),S=o.extend({bearing:v},this.options.fitBoundsOptions);this._map.fitBounds(a.toBounds(f),S,{geolocateSource:!0})}_updateMarker(y){if(y){const a=new o.LngLat(y.coords.longitude,y.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=y.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const y=this._map.transform,a=o.mercatorZfromAltitude(1,y._center.lat)*y.worldSize,f=Math.ceil(2*this._accuracy*a);this._circleElement.style.width=`${f}px`,this._circleElement.style.height=`${f}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(y){if(this._map){if(this.options.trackUserLocation)if(y.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(y.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",y)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(y){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",(a=>a.preventDefault())),this._geolocateButton=k("button","mapboxgl-ctrl-geolocate",this._container),k("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",y===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=k("div","mapboxgl-user-location"),this._dotElement.appendChild(k("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(k("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new oe({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=k("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new oe({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(a=>{a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a.originalEvent&&a.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))}))}}_onDeviceOrientation(y){this._userLocationDotMarker&&(y.webkitCompassHeading?this._heading=y.webkitCompassHeading:y.absolute===!0&&(this._heading=-1*y.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(y={maximumAge:6e5,timeout:0},this._noTimeout=!0):(y=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,y),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const y=()=>{o.window.addEventListener("ondeviceorientationabsolute"in o.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};o.window.DeviceMotionEvent!==void 0&&typeof o.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then((a=>{a==="granted"&&y()})).catch(console.error):y()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),o.window.removeEventListener("deviceorientation",this._onDeviceOrientation),o.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ur,ScaleControl:class{constructor(y){this.options=o.extend({},jt,y),this._isNumberFormatSupported=(function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}})(),o.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const y=this.options.maxWidth||100,a=this._map,f=a._containerHeight/2,v=a._containerWidth/2-y/2,S=a.unproject([v,f]),T=a.unproject([v+y,f]),N=S.distanceTo(T);if(this.options.unit==="imperial"){const z=3.2808*N;z>5280?this._setScale(y,z/5280,"mile"):this._setScale(y,z,"foot")}else this.options.unit==="nautical"?this._setScale(y,N/1852,"nautical-mile"):N>=1e3?this._setScale(y,N/1e3,"kilometer"):this._setScale(y,N,"meter")}_setScale(y,a,f){this._map._requestDomTask((()=>{const v=(function(T){const N=Math.pow(10,`${Math.floor(T)}`.length-1);let z=T/N;return z=z>=10?10:z>=5?5:z>=3?3:z>=2?2:z>=1?1:(function(G){const Q=Math.pow(10,Math.ceil(-Math.log(G)/Math.LN10));return Math.round(G*Q)/Q})(z),N*z})(a),S=v/a;this._container.innerHTML=this._isNumberFormatSupported&&f!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:f}).format(v):`${v}&nbsp;${Qt[f]}`,this._container.style.width=y*S+"px"}))}onAdd(y){return this._map=y,this._language=y.getLanguage(),this._container=k("div","mapboxgl-ctrl mapboxgl-ctrl-scale",y.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(y){this._language=y,this._update()}setUnit(y){this.options.unit=y,this._update()}},FullscreenControl:class{constructor(y){this._fullscreen=!1,y&&y.container&&(y.container instanceof o.window.HTMLElement?this._container=y.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in o.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=k("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!o.window.document.fullscreenEnabled&&!o.window.document.webkitFullscreenEnabled)}_setupUI(){const y=this._fullscreenButton=k("button","mapboxgl-ctrl-fullscreen",this._controlContainer);k("span","mapboxgl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",y)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(o.window.document.fullscreenElement||o.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.Evented{constructor(y){super(),this.options=o.extend(Object.create(Pe),y),o.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(y&&y.className?y.className.trim().split(/\s+/):[])}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&y.on("preclick",this._onClose),this.options.closeOnMove&&y.on("move",this._onClose),y.on("remove",this.remove),this._update(),y._addPopup(this),this._focusFirstElement(),this._trackPointer?(y.on("mousemove",this._onMouseEvent),y.on("mouseup",this._onMouseEvent),y._canvasContainer.classList.add("mapboxgl-track-pointer")):y.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const y=this._map;return y&&(y.off("move",this._update),y.off("move",this._onClose),y.off("preclick",this._onClose),y.off("click",this._onClose),y.off("remove",this.remove),y.off("mousemove",this._onMouseEvent),y.off("mouseup",this._onMouseEvent),y.off("drag",this._onMouseEvent),y._canvasContainer&&y._canvasContainer.classList.remove("mapboxgl-track-pointer"),y._removePopup(this),this._map=void 0),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(y){this._lngLat=o.LngLat.convert(y),this._pos=null,this._trackPointer=!1,this._update();const a=this._map;return a&&(a.on("move",this._update),a.off("mousemove",this._onMouseEvent),a._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const y=this._map;return y&&(y.off("move",this._update),y.on("mousemove",this._onMouseEvent),y.on("drag",this._onMouseEvent),y._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(o.window.document.createTextNode(y))}setHTML(y){const a=o.window.document.createDocumentFragment(),f=o.window.document.createElement("body");let v;for(f.innerHTML=y;v=f.firstChild,v;)a.appendChild(v);return this.setDOMContent(a)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){let a=this._content;if(a)for(;a.hasChildNodes();)a.firstChild&&a.removeChild(a.firstChild);else a=this._content=k("div","mapboxgl-popup-content",this._container||void 0);if(a.appendChild(y),this.options.closeButton){const f=this._closeButton=k("button","mapboxgl-popup-close-button",a);f.type="button",f.setAttribute("aria-label","Close popup"),f.setAttribute("aria-hidden","true"),f.innerHTML="&#215;",f.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(y){return this._classList.add(y),this._updateClassList(),this}removeClassName(y){return this._classList.delete(y),this._updateClassList(),this}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){let a;return this._classList.delete(y)?a=!1:(this._classList.add(y),a=!0),this._updateClassList(),a}_onMouseEvent(y){this._update(y.point)}_getAnchor(y){if(this.options.anchor)return this.options.anchor;const a=this._map,f=this._container,v=this._pos;if(!a||!f||!v)return"bottom";const S=f.offsetWidth,T=f.offsetHeight,N=v.x<S/2,z=v.x>a.transform.width-S/2;if(v.y+y<T)return N?"top-left":z?"top-right":"top";if(v.y>a.transform.height-T){if(N)return"bottom-left";if(z)return"bottom-right"}return N?"left":z?"right":"bottom"}_updateClassList(){const y=this._container;if(!y)return;const a=[...this._classList];a.push("mapboxgl-popup"),this._anchor&&a.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&a.push("mapboxgl-popup-track-pointer"),y.className=a.join(" ")}_update(y){const a=this._map,f=this._content;if(!a||!this._lngLat&&!this._trackPointer||!f)return;let v=this._container;if(v||(v=this._container=k("div","mapboxgl-popup",a.getContainer()),this._tip=k("div","mapboxgl-popup-tip",v),v.appendChild(f)),this.options.maxWidth&&v.style.maxWidth!==this.options.maxWidth&&(v.style.maxWidth=this.options.maxWidth),a.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=B(this._lngLat,this._pos,a.transform)),!this._trackPointer||y){const S=this._pos=this._trackPointer&&y?y:a.project(this._lngLat),T=We(this.options.offset),N=this._anchor=this._getAnchor(T.y),z=We(this.options.offset,N),G=S.add(z).round();a._requestDomTask((()=>{this._container&&N&&(this._container.style.transform=`${ee[N]} translate(${G.x}px,${G.y}px)`)}))}if(!this._marker&&a._showingGlobe()){const S=o.isLngLatBehindGlobe(a.transform,this._lngLat)?0:1;this._setOpacity(S)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(Ve);y&&y.focus()}_onClose(){this.remove()}_setOpacity(y){this._container&&(this._container.style.opacity=`${y}`),this._content&&(this._content.style.pointerEvents=y?"auto":"none")}},Marker:oe,Style:Ai,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.Point,MercatorCoordinate:o.MercatorCoordinate,FreeCameraOptions:Ba,Evented:o.Evented,config:o.config,prewarm:function(){ma().acquire(_s)},clearPrewarmedResources:function(){const y=Cs;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(_s),Cs=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(y){o.config.ACCESS_TOKEN=y},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(y){o.config.API_URL=y},get workerCount(){return ao.workerCount},set workerCount(y){ao.workerCount=y},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(y){o.config.MAX_PARALLEL_IMAGE_REQUESTS=y},clearStorage(y){o.clearTileCache(y)},workerUrl:"",workerClass:null,setNow:o.exported.setNow,restoreNow:o.exported.restoreNow};return En}));var _=u;return _}))})(z1)),z1.exports}var N7=M7();const Rd=Yv(N7),D7="modulepreload",F7=function(n){return"/StakeholderMap/"+n},R2={},fb=function(e,t,i){let c=Promise.resolve();if(t&&t.length>0){let o=function(b){return Promise.all(b.map(I=>Promise.resolve(I).then(M=>({status:"fulfilled",value:M}),M=>({status:"rejected",reason:M}))))};document.getElementsByTagName("link");const m=document.querySelector("meta[property=csp-nonce]"),_=m?.nonce||m?.getAttribute("nonce");c=o(t.map(b=>{if(b=F7(b),b in R2)return;R2[b]=!0;const I=b.endsWith(".css"),M=I?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${b}"]${M}`))return;const V=document.createElement("link");if(V.rel=I?"stylesheet":D7,I||(V.as="script"),V.crossOrigin="",V.href=b,_&&V.setAttribute("nonce",_),document.head.appendChild(V),I)return new Promise((k,ie)=>{V.addEventListener("load",k),V.addEventListener("error",()=>ie(new Error(`Unable to preload CSS for ${b}`)))})}))}function u(m){const _=new Event("vite:preloadError",{cancelable:!0});if(_.payload=m,window.dispatchEvent(_),!_.defaultPrevented)throw m}return c.then(m=>{for(const _ of m||[])_.status==="rejected"&&u(_.reason);return e().catch(u)})};function xa(n){"@babel/helpers - typeof";return xa=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xa(n)}var lf=Uint8Array,pd=Uint16Array,xw=Int32Array,bw=new lf([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ww=new lf([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),M2=new lf([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),s6=function(n,e){for(var t=new pd(31),i=0;i<31;++i)t[i]=e+=1<<n[i-1];for(var c=new xw(t[30]),i=1;i<30;++i)for(var u=t[i];u<t[i+1];++u)c[u]=u-t[i]<<5|i;return{b:t,r:c}},a6=s6(bw,2),O7=a6.b,g5=a6.r;O7[28]=258,g5[258]=28;var B7=s6(ww,0),N2=B7.r,y5=new pd(32768);for(var xl=0;xl<32768;++xl){var Gp=(xl&43690)>>1|(xl&21845)<<1;Gp=(Gp&52428)>>2|(Gp&13107)<<2,Gp=(Gp&61680)>>4|(Gp&3855)<<4,y5[xl]=((Gp&65280)>>8|(Gp&255)<<8)>>1}var qy=(function(n,e,t){for(var i=n.length,c=0,u=new pd(e);c<i;++c)n[c]&&++u[n[c]-1];var m=new pd(e);for(c=1;c<e;++c)m[c]=m[c-1]+u[c-1]<<1;var _;if(t){_=new pd(1<<e);var o=15-e;for(c=0;c<i;++c)if(n[c])for(var b=c<<4|n[c],I=e-n[c],M=m[n[c]-1]++<<I,V=M|(1<<I)-1;M<=V;++M)_[y5[M]>>o]=b}else for(_=new pd(i),c=0;c<i;++c)n[c]&&(_[c]=y5[m[n[c]-1]++]>>15-n[c]);return _}),og=new lf(288);for(var xl=0;xl<144;++xl)og[xl]=8;for(var xl=144;xl<256;++xl)og[xl]=9;for(var xl=256;xl<280;++xl)og[xl]=7;for(var xl=280;xl<288;++xl)og[xl]=8;var pv=new lf(32);for(var xl=0;xl<32;++xl)pv[xl]=5;var z7=qy(og,9,0),j7=qy(pv,5,0),l6=function(n){return(n+7)/8|0},U7=function(n,e,t){return(t==null||t>n.length)&&(t=n.length),new lf(n.subarray(e,t))},up=function(n,e,t){t<<=e&7;var i=e/8|0;n[i]|=t,n[i+1]|=t>>8},Ey=function(n,e,t){t<<=e&7;var i=e/8|0;n[i]|=t,n[i+1]|=t>>8,n[i+2]|=t>>16},pb=function(n,e){for(var t=[],i=0;i<n.length;++i)n[i]&&t.push({s:i,f:n[i]});var c=t.length,u=t.slice();if(!c)return{t:u6,l:0};if(c==1){var m=new lf(t[0].s+1);return m[t[0].s]=1,{t:m,l:1}}t.sort(function(ke,ze){return ke.f-ze.f}),t.push({s:-1,f:25001});var _=t[0],o=t[1],b=0,I=1,M=2;for(t[0]={s:-1,f:_.f+o.f,l:_,r:o};I!=c-1;)_=t[t[b].f<t[M].f?b++:M++],o=t[b!=I&&t[b].f<t[M].f?b++:M++],t[I++]={s:-1,f:_.f+o.f,l:_,r:o};for(var V=u[0].s,i=1;i<c;++i)u[i].s>V&&(V=u[i].s);var k=new pd(V+1),ie=_5(t[I-1],k,0);if(ie>e){var i=0,se=0,de=ie-e,J=1<<de;for(u.sort(function(ze,pe){return k[pe.s]-k[ze.s]||ze.f-pe.f});i<c;++i){var ne=u[i].s;if(k[ne]>e)se+=J-(1<<ie-k[ne]),k[ne]=e;else break}for(se>>=de;se>0;){var me=u[i].s;k[me]<e?se-=1<<e-k[me]++-1:++i}for(;i>=0&&se;--i){var ue=u[i].s;k[ue]==e&&(--k[ue],++se)}ie=e}return{t:new lf(k),l:ie}},_5=function(n,e,t){return n.s==-1?Math.max(_5(n.l,e,t+1),_5(n.r,e,t+1)):e[n.s]=t},D2=function(n){for(var e=n.length;e&&!n[--e];);for(var t=new pd(++e),i=0,c=n[0],u=1,m=function(o){t[i++]=o},_=1;_<=e;++_)if(n[_]==c&&_!=e)++u;else{if(!c&&u>2){for(;u>138;u-=138)m(32754);u>2&&(m(u>10?u-11<<5|28690:u-3<<5|12305),u=0)}else if(u>3){for(m(c),--u;u>6;u-=6)m(8304);u>2&&(m(u-3<<5|8208),u=0)}for(;u--;)m(c);u=1,c=n[_]}return{c:t.subarray(0,i),n:e}},Ay=function(n,e){for(var t=0,i=0;i<e.length;++i)t+=n[i]*e[i];return t},c6=function(n,e,t){var i=t.length,c=l6(e+2);n[c]=i&255,n[c+1]=i>>8,n[c+2]=n[c]^255,n[c+3]=n[c+1]^255;for(var u=0;u<i;++u)n[c+u+4]=t[u];return(c+4+i)*8},F2=function(n,e,t,i,c,u,m,_,o,b,I){up(e,I++,t),++c[256];for(var M=pb(c,15),V=M.t,k=M.l,ie=pb(u,15),se=ie.t,de=ie.l,J=D2(V),ne=J.c,me=J.n,ue=D2(se),ke=ue.c,ze=ue.n,pe=new pd(19),U=0;U<ne.length;++U)++pe[ne[U]&31];for(var U=0;U<ke.length;++U)++pe[ke[U]&31];for(var F=pb(pe,7),q=F.t,j=F.l,H=19;H>4&&!q[M2[H-1]];--H);var Z=b+5<<3,be=Ay(c,og)+Ay(u,pv)+m,Re=Ay(c,V)+Ay(u,se)+m+14+3*H+Ay(pe,q)+2*pe[16]+3*pe[17]+7*pe[18];if(o>=0&&Z<=be&&Z<=Re)return c6(e,I,n.subarray(o,o+b));var Oe,Me,we,De;if(up(e,I,1+(Re<be)),I+=2,Re<be){Oe=qy(V,k,0),Me=V,we=qy(se,de,0),De=se;var tt=qy(q,j,0);up(e,I,me-257),up(e,I+5,ze-1),up(e,I+10,H-4),I+=14;for(var U=0;U<H;++U)up(e,I+3*U,q[M2[U]]);I+=3*H;for(var xe=[ne,ke],le=0;le<2;++le)for(var Ne=xe[le],U=0;U<Ne.length;++U){var Be=Ne[U]&31;up(e,I,tt[Be]),I+=q[Be],Be>15&&(up(e,I,Ne[U]>>5&127),I+=Ne[U]>>12)}}else Oe=z7,Me=og,we=j7,De=pv;for(var U=0;U<_;++U){var Qe=i[U];if(Qe>255){var Be=Qe>>18&31;Ey(e,I,Oe[Be+257]),I+=Me[Be+257],Be>7&&(up(e,I,Qe>>23&31),I+=bw[Be]);var rt=Qe&31;Ey(e,I,we[rt]),I+=De[rt],rt>3&&(Ey(e,I,Qe>>5&8191),I+=ww[rt])}else Ey(e,I,Oe[Qe]),I+=Me[Qe]}return Ey(e,I,Oe[256]),I+Me[256]},V7=new xw([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),u6=new lf(0),q7=function(n,e,t,i,c,u){var m=u.z||n.length,_=new lf(i+m+5*(1+Math.ceil(m/7e3))+c),o=_.subarray(i,_.length-c),b=u.l,I=(u.r||0)&7;if(e){I&&(o[0]=u.r>>3);for(var M=V7[e-1],V=M>>13,k=M&8191,ie=(1<<t)-1,se=u.p||new pd(32768),de=u.h||new pd(ie+1),J=Math.ceil(t/3),ne=2*J,me=function(Gt){return(n[Gt]^n[Gt+1]<<J^n[Gt+2]<<ne)&ie},ue=new xw(25e3),ke=new pd(288),ze=new pd(32),pe=0,U=0,F=u.i||0,q=0,j=u.w||0,H=0;F+2<m;++F){var Z=me(F),be=F&32767,Re=de[Z];if(se[be]=Re,de[Z]=be,j<=F){var Oe=m-F;if((pe>7e3||q>24576)&&(Oe>423||!b)){I=F2(n,o,0,ue,ke,ze,U,q,H,F-H,I),q=pe=U=0,H=F;for(var Me=0;Me<286;++Me)ke[Me]=0;for(var Me=0;Me<30;++Me)ze[Me]=0}var we=2,De=0,tt=k,xe=be-Re&32767;if(Oe>2&&Z==me(F-xe))for(var le=Math.min(V,Oe)-1,Ne=Math.min(32767,F),Be=Math.min(258,Oe);xe<=Ne&&--tt&&be!=Re;){if(n[F+we]==n[F+we-xe]){for(var Qe=0;Qe<Be&&n[F+Qe]==n[F+Qe-xe];++Qe);if(Qe>we){if(we=Qe,De=xe,Qe>le)break;for(var rt=Math.min(xe,Qe-2),gt=0,Me=0;Me<rt;++Me){var pt=F-xe+Me&32767,Mt=se[pt],Jt=pt-Mt&32767;Jt>gt&&(gt=Jt,Re=pt)}}}be=Re,Re=se[be],xe+=be-Re&32767}if(De){ue[q++]=268435456|g5[we]<<18|N2[De];var hn=g5[we]&31,yn=N2[De]&31;U+=bw[hn]+ww[yn],++ke[257+hn],++ze[yn],j=F+we,++pe}else ue[q++]=n[F],++ke[n[F]]}}for(F=Math.max(F,j);F<m;++F)ue[q++]=n[F],++ke[n[F]];I=F2(n,o,b,ue,ke,ze,U,q,H,F-H,I),b||(u.r=I&7|o[I/8|0]<<3,I-=7,u.h=de,u.p=se,u.i=F,u.w=j)}else{for(var F=u.w||0;F<m+b;F+=65535){var Mn=F+65535;Mn>=m&&(o[I/8|0]=b,Mn=m),I=c6(o,I+1,n.subarray(F,Mn))}u.i=m}return U7(_,0,i+l6(I)+c)},h6=function(){var n=1,e=0;return{p:function(t){for(var i=n,c=e,u=t.length|0,m=0;m!=u;){for(var _=Math.min(m+2655,u);m<_;++m)c+=i+=t[m];i=(i&65535)+15*(i>>16),c=(c&65535)+15*(c>>16)}n=i,e=c},d:function(){return n%=65521,e%=65521,(n&255)<<24|(n&65280)<<8|(e&255)<<8|e>>8}}},$7=function(n,e,t,i,c){if(!c&&(c={l:1},e.dictionary)){var u=e.dictionary.subarray(-32768),m=new lf(u.length+n.length);m.set(u),m.set(n,u.length),n=m,c.w=u.length}return q7(n,e.level==null?6:e.level,e.mem==null?c.l?Math.ceil(Math.max(8,Math.min(13,Math.log(n.length)))*1.5):20:12+e.mem,t,i,c)},d6=function(n,e,t){for(;t;++e)n[e]=t,t>>>=8},G7=function(n,e){var t=e.level,i=t==0?0:t<6?1:t==9?3:2;if(n[0]=120,n[1]=i<<6|(e.dictionary&&32),n[1]|=31-(n[0]<<8|n[1])%31,e.dictionary){var c=h6();c.p(e.dictionary),d6(n,2,c.d())}};function v5(n,e){e||(e={});var t=h6();t.p(n);var i=$7(n,e,e.dictionary?6:2,4);return G7(i,e),d6(i,i.length-4,t.d()),i}var H7=typeof TextDecoder<"u"&&new TextDecoder,W7=0;try{H7.decode(u6,{stream:!0}),W7=1}catch{}function K7(n){if(Array.isArray(n))return n}function X7(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var i,c,u,m,_=[],o=!0,b=!1;try{if(u=(t=t.call(n)).next,e!==0)for(;!(o=(i=u.call(t)).done)&&(_.push(i.value),_.length!==e);o=!0);}catch(I){b=!0,c=I}finally{try{if(!o&&t.return!=null&&(m=t.return(),Object(m)!==m))return}finally{if(b)throw c}}return _}}function O2(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=Array(e);t<e;t++)i[t]=n[t];return i}function Z7(n,e){if(n){if(typeof n=="string")return O2(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?O2(n,e):void 0}}function Y7(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function B2(n,e){return K7(n)||X7(n,e)||Z7(n,e)||Y7()}function z2(n,e="utf8"){return new TextDecoder(e).decode(n)}const J7=new TextEncoder;function Q7(n){return J7.encode(n)}const ek=1024*8,tk=(()=>{const n=new Uint8Array(4),e=new Uint32Array(n.buffer);return!((e[0]=1)&n[0])})(),mb={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class Sw{buffer;byteLength;byteOffset;length;offset;lastWrittenByte;littleEndian;_data;_mark;_marks;constructor(e=ek,t={}){let i=!1;typeof e=="number"?e=new ArrayBuffer(e):(i=!0,this.lastWrittenByte=e.byteLength);const c=t.offset?t.offset>>>0:0,u=e.byteLength-c;let m=c;(ArrayBuffer.isView(e)||e instanceof Sw)&&(e.byteLength!==e.buffer.byteLength&&(m=e.byteOffset+c),e=e.buffer),i?this.lastWrittenByte=u:this.lastWrittenByte=0,this.buffer=e,this.length=u,this.byteLength=u,this.byteOffset=m,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,m,u),this._mark=0,this._marks=[]}available(e=1){return this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e=1){return this.offset+=e,this}back(e=1){return this.offset-=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(e===void 0)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e=1){if(!this.available(e)){const i=(this.offset+e)*2,c=new Uint8Array(i);c.set(new Uint8Array(this.buffer)),this.buffer=c.buffer,this.length=i,this.byteLength=i,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e=1){return this.readArray(e,"uint8")}readArray(e,t){const i=mb[t].BYTES_PER_ELEMENT*e,c=this.byteOffset+this.offset,u=this.buffer.slice(c,c+i);if(this.littleEndian===tk&&t!=="uint8"&&t!=="int8"){const _=new Uint8Array(this.buffer.slice(c,c+i));_.reverse();const o=new mb[t](_.buffer);return this.offset+=i,o.reverse(),o}const m=new mb[t](u);return this.offset+=i,m}readInt16(){const e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){const e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){const e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){const e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){const e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){const e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readBigInt64(){const e=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,e}readBigUint64(){const e=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){let t="";for(let i=0;i<e;i++)t+=this.readChar();return t}readUtf8(e=1){return z2(this.readBytes(e))}decodeText(e=1,t="utf8"){return z2(this.readBytes(e),t)}writeBoolean(e){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(let t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(e){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(e){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(let t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this}writeUtf8(e){return this.writeBytes(Q7(e))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function O0(n){let e=n.length;for(;--e>=0;)n[e]=0}const nk=3,rk=258,f6=29,ik=256,ok=ik+1+f6,p6=30,sk=512,ak=new Array((ok+2)*2);O0(ak);const lk=new Array(p6*2);O0(lk);const ck=new Array(sk);O0(ck);const uk=new Array(rk-nk+1);O0(uk);const hk=new Array(f6);O0(hk);const dk=new Array(p6);O0(dk);const fk=(n,e,t,i)=>{let c=n&65535|0,u=n>>>16&65535|0,m=0;for(;t!==0;){m=t>2e3?2e3:t,t-=m;do c=c+e[i++]|0,u=u+c|0;while(--m);c%=65521,u%=65521}return c|u<<16|0};var x5=fk;const pk=()=>{let n,e=[];for(var t=0;t<256;t++){n=t;for(var i=0;i<8;i++)n=n&1?3988292384^n>>>1:n>>>1;e[t]=n}return e},mk=new Uint32Array(pk()),gk=(n,e,t,i)=>{const c=mk,u=i+t;n^=-1;for(let m=i;m<u;m++)n=n>>>8^c[(n^e[m])&255];return n^-1};var Cf=gk,b5={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},m6={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const yk=(n,e)=>Object.prototype.hasOwnProperty.call(n,e);var _k=function(n){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const t=e.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(const i in t)yk(t,i)&&(n[i]=t[i])}}return n},vk=n=>{let e=0;for(let i=0,c=n.length;i<c;i++)e+=n[i].length;const t=new Uint8Array(e);for(let i=0,c=0,u=n.length;i<u;i++){let m=n[i];t.set(m,c),c+=m.length}return t},g6={assign:_k,flattenChunks:vk};let y6=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{y6=!1}const o_=new Uint8Array(256);for(let n=0;n<256;n++)o_[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;o_[254]=o_[254]=1;var xk=n=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(n);let e,t,i,c,u,m=n.length,_=0;for(c=0;c<m;c++)t=n.charCodeAt(c),(t&64512)===55296&&c+1<m&&(i=n.charCodeAt(c+1),(i&64512)===56320&&(t=65536+(t-55296<<10)+(i-56320),c++)),_+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(_),u=0,c=0;u<_;c++)t=n.charCodeAt(c),(t&64512)===55296&&c+1<m&&(i=n.charCodeAt(c+1),(i&64512)===56320&&(t=65536+(t-55296<<10)+(i-56320),c++)),t<128?e[u++]=t:t<2048?(e[u++]=192|t>>>6,e[u++]=128|t&63):t<65536?(e[u++]=224|t>>>12,e[u++]=128|t>>>6&63,e[u++]=128|t&63):(e[u++]=240|t>>>18,e[u++]=128|t>>>12&63,e[u++]=128|t>>>6&63,e[u++]=128|t&63);return e};const bk=(n,e)=>{if(e<65534&&n.subarray&&y6)return String.fromCharCode.apply(null,n.length===e?n:n.subarray(0,e));let t="";for(let i=0;i<e;i++)t+=String.fromCharCode(n[i]);return t};var wk=(n,e)=>{const t=e||n.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(n.subarray(0,e));let i,c;const u=new Array(t*2);for(c=0,i=0;i<t;){let m=n[i++];if(m<128){u[c++]=m;continue}let _=o_[m];if(_>4){u[c++]=65533,i+=_-1;continue}for(m&=_===2?31:_===3?15:7;_>1&&i<t;)m=m<<6|n[i++]&63,_--;if(_>1){u[c++]=65533;continue}m<65536?u[c++]=m:(m-=65536,u[c++]=55296|m>>10&1023,u[c++]=56320|m&1023)}return bk(u,c)},Sk=(n,e)=>{e=e||n.length,e>n.length&&(e=n.length);let t=e-1;for(;t>=0&&(n[t]&192)===128;)t--;return t<0||t===0?e:t+o_[n[t]]>e?t:e},w5={string2buf:xk,buf2string:wk,utf8border:Sk};function Ek(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Ak=Ek;const d1=16209,Tk=16191;var Ik=function(e,t){let i,c,u,m,_,o,b,I,M,V,k,ie,se,de,J,ne,me,ue,ke,ze,pe,U,F,q;const j=e.state;i=e.next_in,F=e.input,c=i+(e.avail_in-5),u=e.next_out,q=e.output,m=u-(t-e.avail_out),_=u+(e.avail_out-257),o=j.dmax,b=j.wsize,I=j.whave,M=j.wnext,V=j.window,k=j.hold,ie=j.bits,se=j.lencode,de=j.distcode,J=(1<<j.lenbits)-1,ne=(1<<j.distbits)-1;e:do{ie<15&&(k+=F[i++]<<ie,ie+=8,k+=F[i++]<<ie,ie+=8),me=se[k&J];t:for(;;){if(ue=me>>>24,k>>>=ue,ie-=ue,ue=me>>>16&255,ue===0)q[u++]=me&65535;else if(ue&16){ke=me&65535,ue&=15,ue&&(ie<ue&&(k+=F[i++]<<ie,ie+=8),ke+=k&(1<<ue)-1,k>>>=ue,ie-=ue),ie<15&&(k+=F[i++]<<ie,ie+=8,k+=F[i++]<<ie,ie+=8),me=de[k&ne];n:for(;;){if(ue=me>>>24,k>>>=ue,ie-=ue,ue=me>>>16&255,ue&16){if(ze=me&65535,ue&=15,ie<ue&&(k+=F[i++]<<ie,ie+=8,ie<ue&&(k+=F[i++]<<ie,ie+=8)),ze+=k&(1<<ue)-1,ze>o){e.msg="invalid distance too far back",j.mode=d1;break e}if(k>>>=ue,ie-=ue,ue=u-m,ze>ue){if(ue=ze-ue,ue>I&&j.sane){e.msg="invalid distance too far back",j.mode=d1;break e}if(pe=0,U=V,M===0){if(pe+=b-ue,ue<ke){ke-=ue;do q[u++]=V[pe++];while(--ue);pe=u-ze,U=q}}else if(M<ue){if(pe+=b+M-ue,ue-=M,ue<ke){ke-=ue;do q[u++]=V[pe++];while(--ue);if(pe=0,M<ke){ue=M,ke-=ue;do q[u++]=V[pe++];while(--ue);pe=u-ze,U=q}}}else if(pe+=M-ue,ue<ke){ke-=ue;do q[u++]=V[pe++];while(--ue);pe=u-ze,U=q}for(;ke>2;)q[u++]=U[pe++],q[u++]=U[pe++],q[u++]=U[pe++],ke-=3;ke&&(q[u++]=U[pe++],ke>1&&(q[u++]=U[pe++]))}else{pe=u-ze;do q[u++]=q[pe++],q[u++]=q[pe++],q[u++]=q[pe++],ke-=3;while(ke>2);ke&&(q[u++]=q[pe++],ke>1&&(q[u++]=q[pe++]))}}else if((ue&64)===0){me=de[(me&65535)+(k&(1<<ue)-1)];continue n}else{e.msg="invalid distance code",j.mode=d1;break e}break}}else if((ue&64)===0){me=se[(me&65535)+(k&(1<<ue)-1)];continue t}else if(ue&32){j.mode=Tk;break e}else{e.msg="invalid literal/length code",j.mode=d1;break e}break}}while(i<c&&u<_);ke=ie>>3,i-=ke,ie-=ke<<3,k&=(1<<ie)-1,e.next_in=i,e.next_out=u,e.avail_in=i<c?5+(c-i):5-(i-c),e.avail_out=u<_?257+(_-u):257-(u-_),j.hold=k,j.bits=ie};const Hg=15,j2=852,U2=592,V2=0,gb=1,q2=2,Ck=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Lk=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Pk=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),kk=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),Rk=(n,e,t,i,c,u,m,_)=>{const o=_.bits;let b=0,I=0,M=0,V=0,k=0,ie=0,se=0,de=0,J=0,ne=0,me,ue,ke,ze,pe,U=null,F;const q=new Uint16Array(Hg+1),j=new Uint16Array(Hg+1);let H=null,Z,be,Re;for(b=0;b<=Hg;b++)q[b]=0;for(I=0;I<i;I++)q[e[t+I]]++;for(k=o,V=Hg;V>=1&&q[V]===0;V--);if(k>V&&(k=V),V===0)return c[u++]=1<<24|64<<16|0,c[u++]=1<<24|64<<16|0,_.bits=1,0;for(M=1;M<V&&q[M]===0;M++);for(k<M&&(k=M),de=1,b=1;b<=Hg;b++)if(de<<=1,de-=q[b],de<0)return-1;if(de>0&&(n===V2||V!==1))return-1;for(j[1]=0,b=1;b<Hg;b++)j[b+1]=j[b]+q[b];for(I=0;I<i;I++)e[t+I]!==0&&(m[j[e[t+I]]++]=I);if(n===V2?(U=H=m,F=20):n===gb?(U=Ck,H=Lk,F=257):(U=Pk,H=kk,F=0),ne=0,I=0,b=M,pe=u,ie=k,se=0,ke=-1,J=1<<k,ze=J-1,n===gb&&J>j2||n===q2&&J>U2)return 1;for(;;){Z=b-se,m[I]+1<F?(be=0,Re=m[I]):m[I]>=F?(be=H[m[I]-F],Re=U[m[I]-F]):(be=96,Re=0),me=1<<b-se,ue=1<<ie,M=ue;do ue-=me,c[pe+(ne>>se)+ue]=Z<<24|be<<16|Re|0;while(ue!==0);for(me=1<<b-1;ne&me;)me>>=1;if(me!==0?(ne&=me-1,ne+=me):ne=0,I++,--q[b]===0){if(b===V)break;b=e[t+m[I]]}if(b>k&&(ne&ze)!==ke){for(se===0&&(se=k),pe+=M,ie=b-se,de=1<<ie;ie+se<V&&(de-=q[ie+se],!(de<=0));)ie++,de<<=1;if(J+=1<<ie,n===gb&&J>j2||n===q2&&J>U2)return 1;ke=ne&ze,c[ke]=k<<24|ie<<16|pe-u|0}}return ne!==0&&(c[pe+ne]=b-se<<24|64<<16|0),_.bits=k,0};var $y=Rk;const Mk=0,_6=1,v6=2,{Z_FINISH:$2,Z_BLOCK:Nk,Z_TREES:f1,Z_OK:sg,Z_STREAM_END:Dk,Z_NEED_DICT:Fk,Z_STREAM_ERROR:Fd,Z_DATA_ERROR:x6,Z_MEM_ERROR:b6,Z_BUF_ERROR:Ok,Z_DEFLATED:G2}=m6,ex=16180,H2=16181,W2=16182,K2=16183,X2=16184,Z2=16185,Y2=16186,J2=16187,Q2=16188,eS=16189,mv=16190,hp=16191,yb=16192,tS=16193,_b=16194,nS=16195,rS=16196,iS=16197,oS=16198,p1=16199,m1=16200,sS=16201,aS=16202,lS=16203,cS=16204,uS=16205,vb=16206,hS=16207,dS=16208,Fl=16209,w6=16210,S6=16211,Bk=852,zk=592,jk=15,Uk=jk,fS=n=>(n>>>24&255)+(n>>>8&65280)+((n&65280)<<8)+((n&255)<<24);function Vk(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const yg=n=>{if(!n)return 1;const e=n.state;return!e||e.strm!==n||e.mode<ex||e.mode>S6?1:0},E6=n=>{if(yg(n))return Fd;const e=n.state;return n.total_in=n.total_out=e.total=0,n.msg="",e.wrap&&(n.adler=e.wrap&1),e.mode=ex,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(Bk),e.distcode=e.distdyn=new Int32Array(zk),e.sane=1,e.back=-1,sg},A6=n=>{if(yg(n))return Fd;const e=n.state;return e.wsize=0,e.whave=0,e.wnext=0,E6(n)},T6=(n,e)=>{let t;if(yg(n))return Fd;const i=n.state;return e<0?(t=0,e=-e):(t=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?Fd:(i.window!==null&&i.wbits!==e&&(i.window=null),i.wrap=t,i.wbits=e,A6(n))},I6=(n,e)=>{if(!n)return Fd;const t=new Vk;n.state=t,t.strm=n,t.window=null,t.mode=ex;const i=T6(n,e);return i!==sg&&(n.state=null),i},qk=n=>I6(n,Uk);let pS=!0,xb,bb;const $k=n=>{if(pS){xb=new Int32Array(512),bb=new Int32Array(32);let e=0;for(;e<144;)n.lens[e++]=8;for(;e<256;)n.lens[e++]=9;for(;e<280;)n.lens[e++]=7;for(;e<288;)n.lens[e++]=8;for($y(_6,n.lens,0,288,xb,0,n.work,{bits:9}),e=0;e<32;)n.lens[e++]=5;$y(v6,n.lens,0,32,bb,0,n.work,{bits:5}),pS=!1}n.lencode=xb,n.lenbits=9,n.distcode=bb,n.distbits=5},C6=(n,e,t,i)=>{let c;const u=n.state;return u.window===null&&(u.wsize=1<<u.wbits,u.wnext=0,u.whave=0,u.window=new Uint8Array(u.wsize)),i>=u.wsize?(u.window.set(e.subarray(t-u.wsize,t),0),u.wnext=0,u.whave=u.wsize):(c=u.wsize-u.wnext,c>i&&(c=i),u.window.set(e.subarray(t-i,t-i+c),u.wnext),i-=c,i?(u.window.set(e.subarray(t-i,t),0),u.wnext=i,u.whave=u.wsize):(u.wnext+=c,u.wnext===u.wsize&&(u.wnext=0),u.whave<u.wsize&&(u.whave+=c))),0},Gk=(n,e)=>{let t,i,c,u,m,_,o,b,I,M,V,k,ie,se,de=0,J,ne,me,ue,ke,ze,pe,U;const F=new Uint8Array(4);let q,j;const H=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(yg(n)||!n.output||!n.input&&n.avail_in!==0)return Fd;t=n.state,t.mode===hp&&(t.mode=yb),m=n.next_out,c=n.output,o=n.avail_out,u=n.next_in,i=n.input,_=n.avail_in,b=t.hold,I=t.bits,M=_,V=o,U=sg;e:for(;;)switch(t.mode){case ex:if(t.wrap===0){t.mode=yb;break}for(;I<16;){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}if(t.wrap&2&&b===35615){t.wbits===0&&(t.wbits=15),t.check=0,F[0]=b&255,F[1]=b>>>8&255,t.check=Cf(t.check,F,2,0),b=0,I=0,t.mode=H2;break}if(t.head&&(t.head.done=!1),!(t.wrap&1)||(((b&255)<<8)+(b>>8))%31){n.msg="incorrect header check",t.mode=Fl;break}if((b&15)!==G2){n.msg="unknown compression method",t.mode=Fl;break}if(b>>>=4,I-=4,pe=(b&15)+8,t.wbits===0&&(t.wbits=pe),pe>15||pe>t.wbits){n.msg="invalid window size",t.mode=Fl;break}t.dmax=1<<t.wbits,t.flags=0,n.adler=t.check=1,t.mode=b&512?eS:hp,b=0,I=0;break;case H2:for(;I<16;){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}if(t.flags=b,(t.flags&255)!==G2){n.msg="unknown compression method",t.mode=Fl;break}if(t.flags&57344){n.msg="unknown header flags set",t.mode=Fl;break}t.head&&(t.head.text=b>>8&1),t.flags&512&&t.wrap&4&&(F[0]=b&255,F[1]=b>>>8&255,t.check=Cf(t.check,F,2,0)),b=0,I=0,t.mode=W2;case W2:for(;I<32;){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}t.head&&(t.head.time=b),t.flags&512&&t.wrap&4&&(F[0]=b&255,F[1]=b>>>8&255,F[2]=b>>>16&255,F[3]=b>>>24&255,t.check=Cf(t.check,F,4,0)),b=0,I=0,t.mode=K2;case K2:for(;I<16;){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}t.head&&(t.head.xflags=b&255,t.head.os=b>>8),t.flags&512&&t.wrap&4&&(F[0]=b&255,F[1]=b>>>8&255,t.check=Cf(t.check,F,2,0)),b=0,I=0,t.mode=X2;case X2:if(t.flags&1024){for(;I<16;){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}t.length=b,t.head&&(t.head.extra_len=b),t.flags&512&&t.wrap&4&&(F[0]=b&255,F[1]=b>>>8&255,t.check=Cf(t.check,F,2,0)),b=0,I=0}else t.head&&(t.head.extra=null);t.mode=Z2;case Z2:if(t.flags&1024&&(k=t.length,k>_&&(k=_),k&&(t.head&&(pe=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(i.subarray(u,u+k),pe)),t.flags&512&&t.wrap&4&&(t.check=Cf(t.check,i,k,u)),_-=k,u+=k,t.length-=k),t.length))break e;t.length=0,t.mode=Y2;case Y2:if(t.flags&2048){if(_===0)break e;k=0;do pe=i[u+k++],t.head&&pe&&t.length<65536&&(t.head.name+=String.fromCharCode(pe));while(pe&&k<_);if(t.flags&512&&t.wrap&4&&(t.check=Cf(t.check,i,k,u)),_-=k,u+=k,pe)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=J2;case J2:if(t.flags&4096){if(_===0)break e;k=0;do pe=i[u+k++],t.head&&pe&&t.length<65536&&(t.head.comment+=String.fromCharCode(pe));while(pe&&k<_);if(t.flags&512&&t.wrap&4&&(t.check=Cf(t.check,i,k,u)),_-=k,u+=k,pe)break e}else t.head&&(t.head.comment=null);t.mode=Q2;case Q2:if(t.flags&512){for(;I<16;){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}if(t.wrap&4&&b!==(t.check&65535)){n.msg="header crc mismatch",t.mode=Fl;break}b=0,I=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),n.adler=t.check=0,t.mode=hp;break;case eS:for(;I<32;){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}n.adler=t.check=fS(b),b=0,I=0,t.mode=mv;case mv:if(t.havedict===0)return n.next_out=m,n.avail_out=o,n.next_in=u,n.avail_in=_,t.hold=b,t.bits=I,Fk;n.adler=t.check=1,t.mode=hp;case hp:if(e===Nk||e===f1)break e;case yb:if(t.last){b>>>=I&7,I-=I&7,t.mode=vb;break}for(;I<3;){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}switch(t.last=b&1,b>>>=1,I-=1,b&3){case 0:t.mode=tS;break;case 1:if($k(t),t.mode=p1,e===f1){b>>>=2,I-=2;break e}break;case 2:t.mode=rS;break;case 3:n.msg="invalid block type",t.mode=Fl}b>>>=2,I-=2;break;case tS:for(b>>>=I&7,I-=I&7;I<32;){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}if((b&65535)!==(b>>>16^65535)){n.msg="invalid stored block lengths",t.mode=Fl;break}if(t.length=b&65535,b=0,I=0,t.mode=_b,e===f1)break e;case _b:t.mode=nS;case nS:if(k=t.length,k){if(k>_&&(k=_),k>o&&(k=o),k===0)break e;c.set(i.subarray(u,u+k),m),_-=k,u+=k,o-=k,m+=k,t.length-=k;break}t.mode=hp;break;case rS:for(;I<14;){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}if(t.nlen=(b&31)+257,b>>>=5,I-=5,t.ndist=(b&31)+1,b>>>=5,I-=5,t.ncode=(b&15)+4,b>>>=4,I-=4,t.nlen>286||t.ndist>30){n.msg="too many length or distance symbols",t.mode=Fl;break}t.have=0,t.mode=iS;case iS:for(;t.have<t.ncode;){for(;I<3;){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}t.lens[H[t.have++]]=b&7,b>>>=3,I-=3}for(;t.have<19;)t.lens[H[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,q={bits:t.lenbits},U=$y(Mk,t.lens,0,19,t.lencode,0,t.work,q),t.lenbits=q.bits,U){n.msg="invalid code lengths set",t.mode=Fl;break}t.have=0,t.mode=oS;case oS:for(;t.have<t.nlen+t.ndist;){for(;de=t.lencode[b&(1<<t.lenbits)-1],J=de>>>24,ne=de>>>16&255,me=de&65535,!(J<=I);){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}if(me<16)b>>>=J,I-=J,t.lens[t.have++]=me;else{if(me===16){for(j=J+2;I<j;){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}if(b>>>=J,I-=J,t.have===0){n.msg="invalid bit length repeat",t.mode=Fl;break}pe=t.lens[t.have-1],k=3+(b&3),b>>>=2,I-=2}else if(me===17){for(j=J+3;I<j;){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}b>>>=J,I-=J,pe=0,k=3+(b&7),b>>>=3,I-=3}else{for(j=J+7;I<j;){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}b>>>=J,I-=J,pe=0,k=11+(b&127),b>>>=7,I-=7}if(t.have+k>t.nlen+t.ndist){n.msg="invalid bit length repeat",t.mode=Fl;break}for(;k--;)t.lens[t.have++]=pe}}if(t.mode===Fl)break;if(t.lens[256]===0){n.msg="invalid code -- missing end-of-block",t.mode=Fl;break}if(t.lenbits=9,q={bits:t.lenbits},U=$y(_6,t.lens,0,t.nlen,t.lencode,0,t.work,q),t.lenbits=q.bits,U){n.msg="invalid literal/lengths set",t.mode=Fl;break}if(t.distbits=6,t.distcode=t.distdyn,q={bits:t.distbits},U=$y(v6,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,q),t.distbits=q.bits,U){n.msg="invalid distances set",t.mode=Fl;break}if(t.mode=p1,e===f1)break e;case p1:t.mode=m1;case m1:if(_>=6&&o>=258){n.next_out=m,n.avail_out=o,n.next_in=u,n.avail_in=_,t.hold=b,t.bits=I,Ik(n,V),m=n.next_out,c=n.output,o=n.avail_out,u=n.next_in,i=n.input,_=n.avail_in,b=t.hold,I=t.bits,t.mode===hp&&(t.back=-1);break}for(t.back=0;de=t.lencode[b&(1<<t.lenbits)-1],J=de>>>24,ne=de>>>16&255,me=de&65535,!(J<=I);){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}if(ne&&(ne&240)===0){for(ue=J,ke=ne,ze=me;de=t.lencode[ze+((b&(1<<ue+ke)-1)>>ue)],J=de>>>24,ne=de>>>16&255,me=de&65535,!(ue+J<=I);){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}b>>>=ue,I-=ue,t.back+=ue}if(b>>>=J,I-=J,t.back+=J,t.length=me,ne===0){t.mode=uS;break}if(ne&32){t.back=-1,t.mode=hp;break}if(ne&64){n.msg="invalid literal/length code",t.mode=Fl;break}t.extra=ne&15,t.mode=sS;case sS:if(t.extra){for(j=t.extra;I<j;){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}t.length+=b&(1<<t.extra)-1,b>>>=t.extra,I-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=aS;case aS:for(;de=t.distcode[b&(1<<t.distbits)-1],J=de>>>24,ne=de>>>16&255,me=de&65535,!(J<=I);){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}if((ne&240)===0){for(ue=J,ke=ne,ze=me;de=t.distcode[ze+((b&(1<<ue+ke)-1)>>ue)],J=de>>>24,ne=de>>>16&255,me=de&65535,!(ue+J<=I);){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}b>>>=ue,I-=ue,t.back+=ue}if(b>>>=J,I-=J,t.back+=J,ne&64){n.msg="invalid distance code",t.mode=Fl;break}t.offset=me,t.extra=ne&15,t.mode=lS;case lS:if(t.extra){for(j=t.extra;I<j;){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}t.offset+=b&(1<<t.extra)-1,b>>>=t.extra,I-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){n.msg="invalid distance too far back",t.mode=Fl;break}t.mode=cS;case cS:if(o===0)break e;if(k=V-o,t.offset>k){if(k=t.offset-k,k>t.whave&&t.sane){n.msg="invalid distance too far back",t.mode=Fl;break}k>t.wnext?(k-=t.wnext,ie=t.wsize-k):ie=t.wnext-k,k>t.length&&(k=t.length),se=t.window}else se=c,ie=m-t.offset,k=t.length;k>o&&(k=o),o-=k,t.length-=k;do c[m++]=se[ie++];while(--k);t.length===0&&(t.mode=m1);break;case uS:if(o===0)break e;c[m++]=t.length,o--,t.mode=m1;break;case vb:if(t.wrap){for(;I<32;){if(_===0)break e;_--,b|=i[u++]<<I,I+=8}if(V-=o,n.total_out+=V,t.total+=V,t.wrap&4&&V&&(n.adler=t.check=t.flags?Cf(t.check,c,V,m-V):x5(t.check,c,V,m-V)),V=o,t.wrap&4&&(t.flags?b:fS(b))!==t.check){n.msg="incorrect data check",t.mode=Fl;break}b=0,I=0}t.mode=hS;case hS:if(t.wrap&&t.flags){for(;I<32;){if(_===0)break e;_--,b+=i[u++]<<I,I+=8}if(t.wrap&4&&b!==(t.total&4294967295)){n.msg="incorrect length check",t.mode=Fl;break}b=0,I=0}t.mode=dS;case dS:U=Dk;break e;case Fl:U=x6;break e;case w6:return b6;case S6:default:return Fd}return n.next_out=m,n.avail_out=o,n.next_in=u,n.avail_in=_,t.hold=b,t.bits=I,(t.wsize||V!==n.avail_out&&t.mode<Fl&&(t.mode<vb||e!==$2))&&C6(n,n.output,n.next_out,V-n.avail_out),M-=n.avail_in,V-=n.avail_out,n.total_in+=M,n.total_out+=V,t.total+=V,t.wrap&4&&V&&(n.adler=t.check=t.flags?Cf(t.check,c,V,n.next_out-V):x5(t.check,c,V,n.next_out-V)),n.data_type=t.bits+(t.last?64:0)+(t.mode===hp?128:0)+(t.mode===p1||t.mode===_b?256:0),(M===0&&V===0||e===$2)&&U===sg&&(U=Ok),U},Hk=n=>{if(yg(n))return Fd;let e=n.state;return e.window&&(e.window=null),n.state=null,sg},Wk=(n,e)=>{if(yg(n))return Fd;const t=n.state;return(t.wrap&2)===0?Fd:(t.head=e,e.done=!1,sg)},Kk=(n,e)=>{const t=e.length;let i,c,u;return yg(n)||(i=n.state,i.wrap!==0&&i.mode!==mv)?Fd:i.mode===mv&&(c=1,c=x5(c,e,t,0),c!==i.check)?x6:(u=C6(n,e,t,t),u?(i.mode=w6,b6):(i.havedict=1,sg))};var Xk=A6,Zk=T6,Yk=E6,Jk=qk,Qk=I6,eR=Gk,tR=Hk,nR=Wk,rR=Kk,iR="pako inflate (from Nodeca project)",gp={inflateReset:Xk,inflateReset2:Zk,inflateResetKeep:Yk,inflateInit:Jk,inflateInit2:Qk,inflate:eR,inflateEnd:tR,inflateGetHeader:nR,inflateSetDictionary:rR,inflateInfo:iR};function oR(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var sR=oR;const L6=Object.prototype.toString,{Z_NO_FLUSH:aR,Z_FINISH:lR,Z_OK:s_,Z_STREAM_END:wb,Z_NEED_DICT:Sb,Z_STREAM_ERROR:cR,Z_DATA_ERROR:mS,Z_MEM_ERROR:uR}=m6;function w_(n){this.options=g6.assign({chunkSize:1024*64,windowBits:15,to:""},n||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(n&&n.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15)===0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ak,this.strm.avail_out=0;let t=gp.inflateInit2(this.strm,e.windowBits);if(t!==s_)throw new Error(b5[t]);if(this.header=new sR,gp.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=w5.string2buf(e.dictionary):L6.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=gp.inflateSetDictionary(this.strm,e.dictionary),t!==s_)))throw new Error(b5[t])}w_.prototype.push=function(n,e){const t=this.strm,i=this.options.chunkSize,c=this.options.dictionary;let u,m,_;if(this.ended)return!1;for(e===~~e?m=e:m=e===!0?lR:aR,L6.call(n)==="[object ArrayBuffer]"?t.input=new Uint8Array(n):t.input=n,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(i),t.next_out=0,t.avail_out=i),u=gp.inflate(t,m),u===Sb&&c&&(u=gp.inflateSetDictionary(t,c),u===s_?u=gp.inflate(t,m):u===mS&&(u=Sb));t.avail_in>0&&u===wb&&t.state.wrap>0&&n[t.next_in]!==0;)gp.inflateReset(t),u=gp.inflate(t,m);switch(u){case cR:case mS:case Sb:case uR:return this.onEnd(u),this.ended=!0,!1}if(_=t.avail_out,t.next_out&&(t.avail_out===0||u===wb))if(this.options.to==="string"){let o=w5.utf8border(t.output,t.next_out),b=t.next_out-o,I=w5.buf2string(t.output,o);t.next_out=b,t.avail_out=i-b,b&&t.output.set(t.output.subarray(o,o+b),0),this.onData(I)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(u===s_&&_===0)){if(u===wb)return u=gp.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};w_.prototype.onData=function(n){this.chunks.push(n)};w_.prototype.onEnd=function(n){n===s_&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=g6.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};function hR(n,e){const t=new w_(e);if(t.push(n),t.err)throw t.msg||b5[t.err];return t.result}var dR=w_,fR=hR,pR={Inflate:dR,inflate:fR};const{Inflate:mR,inflate:gR}=pR;var gS=mR,yR=gR;const P6=[];for(let n=0;n<256;n++){let e=n;for(let t=0;t<8;t++)e&1?e=3988292384^e>>>1:e=e>>>1;P6[n]=e}const yS=4294967295;function _R(n,e,t){let i=n;for(let c=0;c<t;c++)i=P6[(i^e[c])&255]^i>>>8;return i}function vR(n,e){return(_R(yS,n,e)^yS)>>>0}function _S(n,e,t){const i=n.readUint32(),c=vR(new Uint8Array(n.buffer,n.byteOffset+n.offset-e-4,e),e);if(c!==i)throw new Error(`CRC mismatch for chunk ${t}. Expected ${i}, found ${c}`)}function k6(n,e,t){for(let i=0;i<t;i++)e[i]=n[i]}function R6(n,e,t,i){let c=0;for(;c<i;c++)e[c]=n[c];for(;c<t;c++)e[c]=n[c]+e[c-i]&255}function M6(n,e,t,i){let c=0;if(t.length===0)for(;c<i;c++)e[c]=n[c];else for(;c<i;c++)e[c]=n[c]+t[c]&255}function N6(n,e,t,i,c){let u=0;if(t.length===0){for(;u<c;u++)e[u]=n[u];for(;u<i;u++)e[u]=n[u]+(e[u-c]>>1)&255}else{for(;u<c;u++)e[u]=n[u]+(t[u]>>1)&255;for(;u<i;u++)e[u]=n[u]+(e[u-c]+t[u]>>1)&255}}function D6(n,e,t,i,c){let u=0;if(t.length===0){for(;u<c;u++)e[u]=n[u];for(;u<i;u++)e[u]=n[u]+e[u-c]&255}else{for(;u<c;u++)e[u]=n[u]+t[u]&255;for(;u<i;u++)e[u]=n[u]+xR(e[u-c],t[u],t[u-c])&255}}function xR(n,e,t){const i=n+e-t,c=Math.abs(i-n),u=Math.abs(i-e),m=Math.abs(i-t);return c<=u&&c<=m?n:u<=m?e:t}function bR(n,e,t,i,c,u){switch(n){case 0:k6(e,t,c);break;case 1:R6(e,t,c,u);break;case 2:M6(e,t,i,c);break;case 3:N6(e,t,i,c,u);break;case 4:D6(e,t,i,c,u);break;default:throw new Error(`Unsupported filter: ${n}`)}}const wR=new Uint16Array([255]),SR=new Uint8Array(wR.buffer),ER=SR[0]===255;function AR(n){const{data:e,width:t,height:i,channels:c,depth:u}=n,m=[{x:0,y:0,xStep:8,yStep:8},{x:4,y:0,xStep:8,yStep:8},{x:0,y:4,xStep:4,yStep:8},{x:2,y:0,xStep:4,yStep:4},{x:0,y:2,xStep:2,yStep:4},{x:1,y:0,xStep:2,yStep:2},{x:0,y:1,xStep:1,yStep:2}],_=Math.ceil(u/8)*c,o=new Uint8Array(i*t*_);let b=0;for(let I=0;I<7;I++){const M=m[I],V=Math.ceil((t-M.x)/M.xStep),k=Math.ceil((i-M.y)/M.yStep);if(V<=0||k<=0)continue;const ie=V*_,se=new Uint8Array(ie);for(let de=0;de<k;de++){const J=e[b++],ne=e.subarray(b,b+ie);b+=ie;const me=new Uint8Array(ie);bR(J,ne,me,se,ie,_),se.set(me);for(let ue=0;ue<V;ue++){const ke=M.x+ue*M.xStep,ze=M.y+de*M.yStep;if(!(ke>=t||ze>=i))for(let pe=0;pe<_;pe++)o[(ze*t+ke)*_+pe]=me[ue*_+pe]}}}if(u===16){const I=new Uint16Array(o.buffer);if(ER)for(let M=0;M<I.length;M++)I[M]=TR(I[M]);return I}else return o}function TR(n){return(n&255)<<8|n>>8&255}const IR=new Uint16Array([255]),CR=new Uint8Array(IR.buffer),LR=CR[0]===255,PR=new Uint8Array(0);function vS(n){const{data:e,width:t,height:i,channels:c,depth:u}=n,m=Math.ceil(u/8)*c,_=Math.ceil(u/8*c*t),o=new Uint8Array(i*_);let b=PR,I=0,M,V;for(let k=0;k<i;k++){switch(M=e.subarray(I+1,I+1+_),V=o.subarray(k*_,(k+1)*_),e[I]){case 0:k6(M,V,_);break;case 1:R6(M,V,_,m);break;case 2:M6(M,V,b,_);break;case 3:N6(M,V,b,_,m);break;case 4:D6(M,V,b,_,m);break;default:throw new Error(`Unsupported filter: ${e[I]}`)}b=V,I+=_+1}if(u===16){const k=new Uint16Array(o.buffer);if(LR)for(let ie=0;ie<k.length;ie++)k[ie]=kR(k[ie]);return k}else return o}function kR(n){return(n&255)<<8|n>>8&255}const j1=Uint8Array.of(137,80,78,71,13,10,26,10);function xS(n){if(!RR(n.readBytes(j1.length)))throw new Error("wrong PNG signature")}function RR(n){if(n.length<j1.length)return!1;for(let e=0;e<j1.length;e++)if(n[e]!==j1[e])return!1;return!0}const MR="tEXt",NR=0,F6=new TextDecoder("latin1");function DR(n){if(OR(n),n.length===0||n.length>79)throw new Error("keyword length must be between 1 and 79")}const FR=/^[\u0000-\u00FF]*$/;function OR(n){if(!FR.test(n))throw new Error("invalid latin1 text")}function BR(n,e,t){const i=O6(e);n[i]=zR(e,t-i.length-1)}function O6(n){for(n.mark();n.readByte()!==NR;);const e=n.offset;n.reset();const t=F6.decode(n.readBytes(e-n.offset-1));return n.skip(1),DR(t),t}function zR(n,e){return F6.decode(n.readBytes(e))}const cd={UNKNOWN:-1,GREYSCALE:0,TRUECOLOUR:2,INDEXED_COLOUR:3,GREYSCALE_ALPHA:4,TRUECOLOUR_ALPHA:6},Eb={UNKNOWN:-1,DEFLATE:0},bS={UNKNOWN:-1,ADAPTIVE:0},Ab={UNKNOWN:-1,NO_INTERLACE:0,ADAM7:1},g1={NONE:0,BACKGROUND:1,PREVIOUS:2},Tb={SOURCE:0,OVER:1};class jR extends Sw{_checkCrc;_inflator;_png;_apng;_end;_hasPalette;_palette;_hasTransparency;_transparency;_compressionMethod;_filterMethod;_interlaceMethod;_colorType;_isAnimated;_numberOfFrames;_numberOfPlays;_frames;_writingDataChunks;constructor(e,t={}){super(e);const{checkCrc:i=!1}=t;this._checkCrc=i,this._inflator=new gS,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._apng={width:-1,height:-1,channels:-1,depth:1,numberOfFrames:1,numberOfPlays:0,text:{},frames:[]},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=Eb.UNKNOWN,this._filterMethod=bS.UNKNOWN,this._interlaceMethod=Ab.UNKNOWN,this._colorType=cd.UNKNOWN,this._isAnimated=!1,this._numberOfFrames=1,this._numberOfPlays=0,this._frames=[],this._writingDataChunks=!1,this.setBigEndian()}decode(){for(xS(this);!this._end;){const e=this.readUint32(),t=this.readChars(4);this.decodeChunk(e,t)}return this.decodeImage(),this._png}decodeApng(){for(xS(this);!this._end;){const e=this.readUint32(),t=this.readChars(4);this.decodeApngChunk(e,t)}return this.decodeApngImage(),this._apng}decodeChunk(e,t){const i=this.offset;switch(t){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(e);break;case"IDAT":this.decodeIDAT(e);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(e);break;case"iCCP":this.decodeiCCP(e);break;case MR:BR(this._png.text,this,e);break;case"pHYs":this.decodepHYs();break;default:this.skip(e);break}if(this.offset-i!==e)throw new Error(`Length mismatch while decoding chunk ${t}`);this._checkCrc?_S(this,e+4,t):this.skip(4)}decodeApngChunk(e,t){const i=this.offset;switch(t!=="fdAT"&&t!=="IDAT"&&this._writingDataChunks&&this.pushDataToFrame(),t){case"acTL":this.decodeACTL();break;case"fcTL":this.decodeFCTL();break;case"fdAT":this.decodeFDAT(e);break;default:this.decodeChunk(e,t),this.offset=i+e;break}if(this.offset-i!==e)throw new Error(`Length mismatch while decoding chunk ${t}`);this._checkCrc?_S(this,e+4,t):this.skip(4)}decodeIHDR(){const e=this._png;e.width=this.readUint32(),e.height=this.readUint32(),e.depth=UR(this.readUint8());const t=this.readUint8();this._colorType=t;let i;switch(t){case cd.GREYSCALE:i=1;break;case cd.TRUECOLOUR:i=3;break;case cd.INDEXED_COLOUR:i=1;break;case cd.GREYSCALE_ALPHA:i=2;break;case cd.TRUECOLOUR_ALPHA:i=4;break;case cd.UNKNOWN:default:throw new Error(`Unknown color type: ${t}`)}if(this._png.channels=i,this._compressionMethod=this.readUint8(),this._compressionMethod!==Eb.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodeACTL(){this._numberOfFrames=this.readUint32(),this._numberOfPlays=this.readUint32(),this._isAnimated=!0}decodeFCTL(){const e={sequenceNumber:this.readUint32(),width:this.readUint32(),height:this.readUint32(),xOffset:this.readUint32(),yOffset:this.readUint32(),delayNumber:this.readUint16(),delayDenominator:this.readUint16(),disposeOp:this.readUint8(),blendOp:this.readUint8(),data:new Uint8Array(0)};this._frames.push(e)}decodePLTE(e){if(e%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${e}`);const t=e/3;this._hasPalette=!0;const i=[];this._palette=i;for(let c=0;c<t;c++)i.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(e){this._writingDataChunks=!0;const t=e,i=this.offset+this.byteOffset;if(this._inflator.push(new Uint8Array(this.buffer,i,t)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(e)}decodeFDAT(e){this._writingDataChunks=!0;let t=e,i=this.offset+this.byteOffset;if(i+=4,t-=4,this._inflator.push(new Uint8Array(this.buffer,i,t)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(e)}decodetRNS(e){switch(this._colorType){case cd.GREYSCALE:case cd.TRUECOLOUR:{if(e%2!==0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${e}`);if(e/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${e/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(e/2);for(let t=0;t<e/2;t++)this._transparency[t]=this.readUint16();break}case cd.INDEXED_COLOUR:{if(e>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${e} vs ${this._palette.length})`);let t=0;for(;t<e;t++){const i=this.readByte();this._palette[t].push(i)}for(;t<this._palette.length;t++)this._palette[t].push(255);break}case cd.UNKNOWN:case cd.GREYSCALE_ALPHA:case cd.TRUECOLOUR_ALPHA:default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(e){const t=O6(this),i=this.readUint8();if(i!==Eb.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${i}`);const c=this.readBytes(e-t.length-2);this._png.iccEmbeddedProfile={name:t,profile:yR(c)}}decodepHYs(){const e=this.readUint32(),t=this.readUint32(),i=this.readByte();this._png.resolution={x:e,y:t,unit:i}}decodeApngImage(){this._apng.width=this._png.width,this._apng.height=this._png.height,this._apng.channels=this._png.channels,this._apng.depth=this._png.depth,this._apng.numberOfFrames=this._numberOfFrames,this._apng.numberOfPlays=this._numberOfPlays,this._apng.text=this._png.text,this._apng.resolution=this._png.resolution;for(let e=0;e<this._numberOfFrames;e++){const t={sequenceNumber:this._frames[e].sequenceNumber,delayNumber:this._frames[e].delayNumber,delayDenominator:this._frames[e].delayDenominator,data:this._apng.depth===8?new Uint8Array(this._apng.width*this._apng.height*this._apng.channels):new Uint16Array(this._apng.width*this._apng.height*this._apng.channels)},i=this._frames.at(e);if(i){if(i.data=vS({data:i.data,width:i.width,height:i.height,channels:this._apng.channels,depth:this._apng.depth}),this._hasPalette&&(this._apng.palette=this._palette),this._hasTransparency&&(this._apng.transparency=this._transparency),e===0||i.xOffset===0&&i.yOffset===0&&i.width===this._png.width&&i.height===this._png.height)t.data=i.data;else{const c=this._apng.frames.at(e-1);this.disposeFrame(i,c,t),this.addFrameDataToCanvas(t,i)}this._apng.frames.push(t)}}return this._apng}disposeFrame(e,t,i){switch(e.disposeOp){case g1.NONE:break;case g1.BACKGROUND:for(let c=0;c<this._png.height;c++)for(let u=0;u<this._png.width;u++){const m=(c*e.width+u)*this._png.channels;for(let _=0;_<this._png.channels;_++)i.data[m+_]=0}break;case g1.PREVIOUS:i.data.set(t.data);break;default:throw new Error("Unknown disposeOp")}}addFrameDataToCanvas(e,t){const i=1<<this._png.depth,c=(u,m)=>{const _=((u+t.yOffset)*this._png.width+t.xOffset+m)*this._png.channels,o=(u*t.width+m)*this._png.channels;return{index:_,frameIndex:o}};switch(t.blendOp){case Tb.SOURCE:for(let u=0;u<t.height;u++)for(let m=0;m<t.width;m++){const{index:_,frameIndex:o}=c(u,m);for(let b=0;b<this._png.channels;b++)e.data[_+b]=t.data[o+b]}break;case Tb.OVER:for(let u=0;u<t.height;u++)for(let m=0;m<t.width;m++){const{index:_,frameIndex:o}=c(u,m);for(let b=0;b<this._png.channels;b++){const I=t.data[o+this._png.channels-1]/i,M=b%(this._png.channels-1)===0?1:t.data[o+b],V=Math.floor(I*M+(1-I)*e.data[_+b]);e.data[_+b]+=V}}break;default:throw new Error("Unknown blendOp")}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const e=this._isAnimated?(this._frames?.at(0)).data:this._inflator.result;if(this._filterMethod!==bS.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===Ab.NO_INTERLACE)this._png.data=vS({data:e,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else if(this._interlaceMethod===Ab.ADAM7)this._png.data=AR({data:e,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}pushDataToFrame(){const e=this._inflator.result,t=this._frames.at(-1);t?t.data=e:this._frames.push({sequenceNumber:0,width:this._png.width,height:this._png.height,xOffset:0,yOffset:0,delayNumber:0,delayDenominator:0,disposeOp:g1.NONE,blendOp:Tb.SOURCE,data:e}),this._inflator=new gS,this._writingDataChunks=!1}}function UR(n){if(n!==1&&n!==2&&n!==4&&n!==8&&n!==16)throw new Error(`invalid bit depth: ${n}`);return n}var wS;(function(n){n[n.UNKNOWN=0]="UNKNOWN",n[n.METRE=1]="METRE"})(wS||(wS={}));function VR(n,e){return new jR(n,e).decode()}var uo=(function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this})();function Ib(){uo.console&&typeof uo.console.log=="function"&&uo.console.log.apply(uo.console,arguments)}var Ga={log:Ib,warn:function(n){uo.console&&(typeof uo.console.warn=="function"?uo.console.warn.apply(uo.console,arguments):Ib.call(null,arguments))},error:function(n){uo.console&&(typeof uo.console.error=="function"?uo.console.error.apply(uo.console,arguments):Ib(n))}};function Cb(n,e,t){var i=new XMLHttpRequest;i.open("GET",n),i.responseType="blob",i.onload=function(){Km(i.response,e,t)},i.onerror=function(){Ga.error("could not download file")},i.send()}function SS(n){var e=new XMLHttpRequest;e.open("HEAD",n,!1);try{e.send()}catch{}return e.status>=200&&e.status<=299}function y1(n){try{n.dispatchEvent(new MouseEvent("click"))}catch{var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),n.dispatchEvent(e)}}var Km=uo.saveAs||((typeof window>"u"?"undefined":xa(window))!=="object"||window!==uo?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(n,e,t){var i=uo.URL||uo.webkitURL,c=document.createElement("a");e=e||n.name||"download",c.download=e,c.rel="noopener",typeof n=="string"?(c.href=n,c.origin!==location.origin?SS(c.href)?Cb(n,e,t):y1(c,c.target="_blank"):y1(c)):(c.href=i.createObjectURL(n),setTimeout(function(){i.revokeObjectURL(c.href)},4e4),setTimeout(function(){y1(c)},0))}:"msSaveOrOpenBlob"in navigator?function(n,e,t){if(e=e||n.name||"download",typeof n=="string")if(SS(n))Cb(n,e,t);else{var i=document.createElement("a");i.href=n,i.target="_blank",setTimeout(function(){y1(i)})}else navigator.msSaveOrOpenBlob((function(c,u){return u===void 0?u={autoBom:!1}:xa(u)!=="object"&&(Ga.warn("Deprecated: Expected third argument to be a object"),u={autoBom:!u}),u.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(c.type)?new Blob(["\uFEFF",c],{type:c.type}):c})(n,t),e)}:function(n,e,t,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),typeof n=="string")return Cb(n,e,t);var c=n.type==="application/octet-stream",u=/constructor/i.test(uo.HTMLElement)||uo.safari,m=/CriOS\/[\d]+/.test(navigator.userAgent);if((m||c&&u)&&(typeof FileReader>"u"?"undefined":xa(FileReader))==="object"){var _=new FileReader;_.onloadend=function(){var I=_.result;I=m?I:I.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=I:location=I,i=null},_.readAsDataURL(n)}else{var o=uo.URL||uo.webkitURL,b=o.createObjectURL(n);i?i.location=b:location.href=b,i=null,setTimeout(function(){o.revokeObjectURL(b)},4e4)}});/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
 * @license Use it if you like it
 */function B6(n){var e;n=n||"",this.ok=!1,n.charAt(0)=="#"&&(n=n.substr(1,6)),n={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[n=(n=n.replace(/ /g,"")).toLowerCase()]||n;for(var t=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(_){return[parseInt(_[1]),parseInt(_[2]),parseInt(_[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(_){return[parseInt(_[1],16),parseInt(_[2],16),parseInt(_[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(_){return[parseInt(_[1]+_[1],16),parseInt(_[2]+_[2],16),parseInt(_[3]+_[3],16)]}}],i=0;i<t.length;i++){var c=t[i].re,u=t[i].process,m=c.exec(n);m&&(e=u(m),this.r=e[0],this.g=e[1],this.b=e[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var _=this.r.toString(16),o=this.g.toString(16),b=this.b.toString(16);return _.length==1&&(_="0"+_),o.length==1&&(o="0"+o),b.length==1&&(b="0"+b),"#"+_+o+b}}var U1=uo.atob.bind(uo),ES=uo.btoa.bind(uo);/**
 * @license
 * Joseph Myers does not specify a particular license for his work.
 *
 * Author: Joseph Myers
 * Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
 *
 * Modified by: Owen Leong
 */function Lb(n,e){var t=n[0],i=n[1],c=n[2],u=n[3];t=ch(t,i,c,u,e[0],7,-680876936),u=ch(u,t,i,c,e[1],12,-389564586),c=ch(c,u,t,i,e[2],17,606105819),i=ch(i,c,u,t,e[3],22,-1044525330),t=ch(t,i,c,u,e[4],7,-176418897),u=ch(u,t,i,c,e[5],12,1200080426),c=ch(c,u,t,i,e[6],17,-1473231341),i=ch(i,c,u,t,e[7],22,-45705983),t=ch(t,i,c,u,e[8],7,1770035416),u=ch(u,t,i,c,e[9],12,-1958414417),c=ch(c,u,t,i,e[10],17,-42063),i=ch(i,c,u,t,e[11],22,-1990404162),t=ch(t,i,c,u,e[12],7,1804603682),u=ch(u,t,i,c,e[13],12,-40341101),c=ch(c,u,t,i,e[14],17,-1502002290),t=uh(t,i=ch(i,c,u,t,e[15],22,1236535329),c,u,e[1],5,-165796510),u=uh(u,t,i,c,e[6],9,-1069501632),c=uh(c,u,t,i,e[11],14,643717713),i=uh(i,c,u,t,e[0],20,-373897302),t=uh(t,i,c,u,e[5],5,-701558691),u=uh(u,t,i,c,e[10],9,38016083),c=uh(c,u,t,i,e[15],14,-660478335),i=uh(i,c,u,t,e[4],20,-405537848),t=uh(t,i,c,u,e[9],5,568446438),u=uh(u,t,i,c,e[14],9,-1019803690),c=uh(c,u,t,i,e[3],14,-187363961),i=uh(i,c,u,t,e[8],20,1163531501),t=uh(t,i,c,u,e[13],5,-1444681467),u=uh(u,t,i,c,e[2],9,-51403784),c=uh(c,u,t,i,e[7],14,1735328473),t=hh(t,i=uh(i,c,u,t,e[12],20,-1926607734),c,u,e[5],4,-378558),u=hh(u,t,i,c,e[8],11,-2022574463),c=hh(c,u,t,i,e[11],16,1839030562),i=hh(i,c,u,t,e[14],23,-35309556),t=hh(t,i,c,u,e[1],4,-1530992060),u=hh(u,t,i,c,e[4],11,1272893353),c=hh(c,u,t,i,e[7],16,-155497632),i=hh(i,c,u,t,e[10],23,-1094730640),t=hh(t,i,c,u,e[13],4,681279174),u=hh(u,t,i,c,e[0],11,-358537222),c=hh(c,u,t,i,e[3],16,-722521979),i=hh(i,c,u,t,e[6],23,76029189),t=hh(t,i,c,u,e[9],4,-640364487),u=hh(u,t,i,c,e[12],11,-421815835),c=hh(c,u,t,i,e[15],16,530742520),t=dh(t,i=hh(i,c,u,t,e[2],23,-995338651),c,u,e[0],6,-198630844),u=dh(u,t,i,c,e[7],10,1126891415),c=dh(c,u,t,i,e[14],15,-1416354905),i=dh(i,c,u,t,e[5],21,-57434055),t=dh(t,i,c,u,e[12],6,1700485571),u=dh(u,t,i,c,e[3],10,-1894986606),c=dh(c,u,t,i,e[10],15,-1051523),i=dh(i,c,u,t,e[1],21,-2054922799),t=dh(t,i,c,u,e[8],6,1873313359),u=dh(u,t,i,c,e[15],10,-30611744),c=dh(c,u,t,i,e[6],15,-1560198380),i=dh(i,c,u,t,e[13],21,1309151649),t=dh(t,i,c,u,e[4],6,-145523070),u=dh(u,t,i,c,e[11],10,-1120210379),c=dh(c,u,t,i,e[2],15,718787259),i=dh(i,c,u,t,e[9],21,-343485551),n[0]=tm(t,n[0]),n[1]=tm(i,n[1]),n[2]=tm(c,n[2]),n[3]=tm(u,n[3])}function tx(n,e,t,i,c,u){return e=tm(tm(e,n),tm(i,u)),tm(e<<c|e>>>32-c,t)}function ch(n,e,t,i,c,u,m){return tx(e&t|~e&i,n,e,c,u,m)}function uh(n,e,t,i,c,u,m){return tx(e&i|t&~i,n,e,c,u,m)}function hh(n,e,t,i,c,u,m){return tx(e^t^i,n,e,c,u,m)}function dh(n,e,t,i,c,u,m){return tx(t^(e|~i),n,e,c,u,m)}function z6(n){var e,t=n.length,i=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=n.length;e+=64)Lb(i,qR(n.substring(e-64,e)));n=n.substring(e-64);var c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<n.length;e++)c[e>>2]|=n.charCodeAt(e)<<(e%4<<3);if(c[e>>2]|=128<<(e%4<<3),e>55)for(Lb(i,c),e=0;e<16;e++)c[e]=0;return c[14]=8*t,Lb(i,c),i}function qR(n){var e,t=[];for(e=0;e<64;e+=4)t[e>>2]=n.charCodeAt(e)+(n.charCodeAt(e+1)<<8)+(n.charCodeAt(e+2)<<16)+(n.charCodeAt(e+3)<<24);return t}var AS="0123456789abcdef".split("");function $R(n){for(var e="",t=0;t<4;t++)e+=AS[n>>8*t+4&15]+AS[n>>8*t&15];return e}function GR(n){return String.fromCharCode(255&n,(65280&n)>>8,(16711680&n)>>16,(4278190080&n)>>24)}function S5(n){return z6(n).map(GR).join("")}var HR=(function(n){for(var e=0;e<n.length;e++)n[e]=$R(n[e]);return n.join("")})(z6("hello"))!="5d41402abc4b2a76b9719d911017c592";function tm(n,e){if(HR){var t=(65535&n)+(65535&e);return(n>>16)+(e>>16)+(t>>16)<<16|65535&t}return n+e&4294967295}/**
 * @license
 * FPDF is released under a permissive license: there is no usage restriction.
 * You may embed it freely in your application (commercial or not), with or
 * without modifications.
 *
 * Reference: http://www.fpdf.org/en/script/script37.php
 */function E5(n,e){var t,i,c,u;if(n!==t){for(var m=(c=n,u=1+(256/n.length|0),new Array(u+1).join(c)),_=[],o=0;o<256;o++)_[o]=o;var b=0;for(o=0;o<256;o++){var I=_[o];b=(b+I+m.charCodeAt(o))%256,_[o]=_[b],_[b]=I}t=n,i=_}else _=i;var M=e.length,V=0,k=0,ie="";for(o=0;o<M;o++)k=(k+(I=_[V=(V+1)%256]))%256,_[V]=_[k],_[k]=I,m=_[(_[V]+_[k])%256],ie+=String.fromCharCode(e.charCodeAt(o)^m);return ie}/**
 * @license
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 * Author: Owen Leong (@owenl131)
 * Date: 15 Oct 2020
 * References:
 * https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
 * https://github.com/foliojs/pdfkit/blob/master/lib/security.js
 * http://www.fpdf.org/en/script/script37.php
 */var TS={print:4,modify:8,copy:16,"annot-forms":32};function n0(n,e,t,i){this.v=1,this.r=2;var c=192;n.forEach(function(_){if(TS.perm!==void 0)throw new Error("Invalid permission: "+_);c+=TS[_]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var u=(e+this.padding).substr(0,32),m=(t+this.padding).substr(0,32);this.O=this.processOwnerPassword(u,m),this.P=-(1+(255^c)),this.encryptionKey=S5(u+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(i)).substr(0,5),this.U=E5(this.encryptionKey,this.padding)}function r0(n){if(/[^\u0000-\u00ff]/.test(n))throw new Error("Invalid PDF Name Object: "+n+", Only accept ASCII characters.");for(var e="",t=n.length,i=0;i<t;i++){var c=n.charCodeAt(i);e+=c<33||c===35||c===37||c===40||c===41||c===47||c===60||c===62||c===91||c===93||c===123||c===125||c>126?"#"+("0"+c.toString(16)).slice(-2):n[i]}return e}function IS(n){if(xa(n)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var e={};this.subscribe=function(t,i,c){if(c=c||!1,typeof t!="string"||typeof i!="function"||typeof c!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");e.hasOwnProperty(t)||(e[t]={});var u=Math.random().toString(35);return e[t][u]=[i,!!c],u},this.unsubscribe=function(t){for(var i in e)if(e[i][t])return delete e[i][t],Object.keys(e[i]).length===0&&delete e[i],!0;return!1},this.publish=function(t){if(e.hasOwnProperty(t)){var i=Array.prototype.slice.call(arguments,1),c=[];for(var u in e[t]){var m=e[t][u];try{m[0].apply(n,i)}catch(_){uo.console&&Ga.error("jsPDF PubSub Error",_.message,_)}m[1]&&c.push(u)}c.length&&c.forEach(this.unsubscribe)}},this.getTopics=function(){return e}}function gv(n){if(!(this instanceof gv))return new gv(n);var e="opacity,stroke-opacity".split(",");for(var t in n)n.hasOwnProperty(t)&&e.indexOf(t)>=0&&(this[t]=n[t]);this.id="",this.objectNumber=-1}function j6(n,e){this.gState=n,this.matrix=e,this.id="",this.objectNumber=-1}function Jm(n,e,t,i,c){if(!(this instanceof Jm))return new Jm(n,e,t,i,c);this.type=n==="axial"?2:3,this.coords=e,this.colors=t,j6.call(this,i,c)}function c0(n,e,t,i,c){if(!(this instanceof c0))return new c0(n,e,t,i,c);this.boundingBox=n,this.xStep=e,this.yStep=t,this.stream="",this.cloneIndex=0,j6.call(this,i,c)}function wi(n){var e,t=typeof arguments[0]=="string"?arguments[0]:"p",i=arguments[1],c=arguments[2],u=arguments[3],m=[],_=1,o=16,b="S",I=null;xa(n=n||{})==="object"&&(t=n.orientation,i=n.unit||i,c=n.format||c,u=n.compress||n.compressPdf||u,(I=n.encryption||null)!==null&&(I.userPassword=I.userPassword||"",I.ownerPassword=I.ownerPassword||"",I.userPermissions=I.userPermissions||[]),_=typeof n.userUnit=="number"?Math.abs(n.userUnit):1,n.precision!==void 0&&(e=n.precision),n.floatPrecision!==void 0&&(o=n.floatPrecision),b=n.defaultPathOperation||"S"),m=n.filters||(u===!0?["FlateEncode"]:m),i=i||"mm",t=(""+(t||"P")).toLowerCase();var M=n.putOnlyUsedFonts||!1,V={},k={internal:{},__private__:{}};k.__private__.PubSub=IS;var ie="1.3",se=k.__private__.getPdfVersion=function(){return ie};k.__private__.setPdfVersion=function(W){ie=W};var de={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};k.__private__.getPageFormats=function(){return de};var J=k.__private__.getPageFormat=function(W){return de[W]};c=c||"a4";var ne="compat",me="advanced",ue=ne;function ke(){this.saveGraphicsState(),ot(new Pt(Ir,0,0,-Ir,0,Hs()*Ir).toString()+" cm"),this.setFontSize(this.getFontSize()/Ir),b="n",ue=me}function ze(){this.restoreGraphicsState(),b="S",ue=ne}var pe=k.__private__.combineFontStyleAndFontWeight=function(W,Ce){if(W=="bold"&&Ce=="normal"||W=="bold"&&Ce==400||W=="normal"&&Ce=="italic"||W=="bold"&&Ce=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return Ce&&(W=Ce==400||Ce==="normal"?W==="italic"?"italic":"normal":Ce!=700&&Ce!=="bold"||W!=="normal"?(Ce==700?"bold":Ce)+""+W:"bold"),W};k.advancedAPI=function(W){var Ce=ue===ne;return Ce&&ke.call(this),typeof W!="function"||(W(this),Ce&&ze.call(this)),this},k.compatAPI=function(W){var Ce=ue===me;return Ce&&ze.call(this),typeof W!="function"||(W(this),Ce&&ke.call(this)),this},k.isAdvancedAPI=function(){return ue===me};var U,F=function(W){if(ue!==me)throw new Error(W+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},q=k.roundToPrecision=k.__private__.roundToPrecision=function(W,Ce){var mt=e||Ce;if(isNaN(W)||isNaN(mt))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return W.toFixed(mt).replace(/0+$/,"")};U=k.hpf=k.__private__.hpf=typeof o=="number"?function(W){if(isNaN(W))throw new Error("Invalid argument passed to jsPDF.hpf");return q(W,o)}:o==="smart"?function(W){if(isNaN(W))throw new Error("Invalid argument passed to jsPDF.hpf");return q(W,W>-1&&W<1?16:5)}:function(W){if(isNaN(W))throw new Error("Invalid argument passed to jsPDF.hpf");return q(W,16)};var j=k.f2=k.__private__.f2=function(W){if(isNaN(W))throw new Error("Invalid argument passed to jsPDF.f2");return q(W,2)},H=k.__private__.f3=function(W){if(isNaN(W))throw new Error("Invalid argument passed to jsPDF.f3");return q(W,3)},Z=k.scale=k.__private__.scale=function(W){if(isNaN(W))throw new Error("Invalid argument passed to jsPDF.scale");return ue===ne?W*Ir:ue===me?W:void 0},be=function(W){return Z((function(Ce){return ue===ne?Hs()-Ce:ue===me?Ce:void 0})(W))};k.__private__.setPrecision=k.setPrecision=function(W){typeof parseInt(W,10)=="number"&&(e=parseInt(W,10))};var Re,Oe="00000000000000000000000000000000",Me=k.__private__.getFileId=function(){return Oe},we=k.__private__.setFileId=function(W){return Oe=W!==void 0&&/^[a-fA-F0-9]{32}$/.test(W)?W.toUpperCase():Oe.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),I!==null&&(Br=new n0(I.userPermissions,I.userPassword,I.ownerPassword,Oe)),Oe};k.setFileId=function(W){return we(W),this},k.getFileId=function(){return Me()};var De=k.__private__.convertDateToPDFDate=function(W){var Ce=W.getTimezoneOffset(),mt=Ce<0?"+":"-",yt=Math.floor(Math.abs(Ce/60)),$t=Math.abs(Ce%60),Zt=[mt,Be(yt),"'",Be($t),"'"].join("");return["D:",W.getFullYear(),Be(W.getMonth()+1),Be(W.getDate()),Be(W.getHours()),Be(W.getMinutes()),Be(W.getSeconds()),Zt].join("")},tt=k.__private__.convertPDFDateToDate=function(W){var Ce=parseInt(W.substr(2,4),10),mt=parseInt(W.substr(6,2),10)-1,yt=parseInt(W.substr(8,2),10),$t=parseInt(W.substr(10,2),10),Zt=parseInt(W.substr(12,2),10),zn=parseInt(W.substr(14,2),10);return new Date(Ce,mt,yt,$t,Zt,zn,0)},xe=k.__private__.setCreationDate=function(W){var Ce;if(W===void 0&&(W=new Date),W instanceof Date)Ce=De(W);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(W))throw new Error("Invalid argument passed to jsPDF.setCreationDate");Ce=W}return Re=Ce},le=k.__private__.getCreationDate=function(W){var Ce=Re;return W==="jsDate"&&(Ce=tt(Re)),Ce};k.setCreationDate=function(W){return xe(W),this},k.getCreationDate=function(W){return le(W)};var Ne,Be=k.__private__.padd2=function(W){return("0"+parseInt(W)).slice(-2)},Qe=k.__private__.padd2Hex=function(W){return("00"+(W=W.toString())).substr(W.length)},rt=0,gt=[],pt=[],Mt=0,Jt=[],hn=[],yn=!1,Mn=pt;k.__private__.setCustomOutputDestination=function(W){yn=!0,Mn=W};var Gt=function(W){yn||(Mn=W)};k.__private__.resetCustomOutputDestination=function(){yn=!1,Mn=pt};var ot=k.__private__.out=function(W){return W=W.toString(),Mt+=W.length+1,Mn.push(W),Mn},dr=k.__private__.write=function(W){return ot(arguments.length===1?W.toString():Array.prototype.join.call(arguments," "))},wr=k.__private__.getArrayBuffer=function(W){for(var Ce=W.length,mt=new ArrayBuffer(Ce),yt=new Uint8Array(mt);Ce--;)yt[Ce]=W.charCodeAt(Ce);return mt},Cr=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];k.__private__.getStandardFonts=function(){return Cr};var Ln=n.fontSize||16;k.__private__.setFontSize=k.setFontSize=function(W){return Ln=ue===me?W/Ir:W,this};var ir,Qn=k.__private__.getFontSize=k.getFontSize=function(){return ue===ne?Ln:Ln*Ir},Kr=n.R2L||!1;k.__private__.setR2L=k.setR2L=function(W){return Kr=W,this},k.__private__.getR2L=k.getR2L=function(){return Kr};var qt,Pn=k.__private__.setZoomMode=function(W){if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(W))ir=W;else if(isNaN(W)){if([void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(W)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+W+'" is not recognized.');ir=W}else ir=parseInt(W,10)};k.__private__.getZoomMode=function(){return ir};var Hn,Bn=k.__private__.setPageMode=function(W){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(W)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+W+'" is not recognized.');qt=W};k.__private__.getPageMode=function(){return qt};var Rr=k.__private__.setLayoutMode=function(W){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(W)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+W+'" is not recognized.');Hn=W};k.__private__.getLayoutMode=function(){return Hn},k.__private__.setDisplayMode=k.setDisplayMode=function(W,Ce,mt){return Pn(W),Rr(Ce),Bn(mt),this};var vr={title:"",subject:"",author:"",keywords:"",creator:""};k.__private__.getDocumentProperty=function(W){if(Object.keys(vr).indexOf(W)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return vr[W]},k.__private__.getDocumentProperties=function(){return vr},k.__private__.setDocumentProperties=k.setProperties=k.setDocumentProperties=function(W){for(var Ce in vr)vr.hasOwnProperty(Ce)&&W[Ce]&&(vr[Ce]=W[Ce]);return this},k.__private__.setDocumentProperty=function(W,Ce){if(Object.keys(vr).indexOf(W)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return vr[W]=Ce};var Tr,Ir,Pr,Si,ki,or={},oi={},Gr=[],Or={},hi={},si={},lt={},Ee=null,Te=0,et=[],ht=new IS(k),Lt=n.hotfixes||[],Rt={},Ot={},At=[],Pt=function W(Ce,mt,yt,$t,Zt,zn){if(!(this instanceof W))return new W(Ce,mt,yt,$t,Zt,zn);isNaN(Ce)&&(Ce=1),isNaN(mt)&&(mt=0),isNaN(yt)&&(yt=0),isNaN($t)&&($t=1),isNaN(Zt)&&(Zt=0),isNaN(zn)&&(zn=0),this._matrix=[Ce,mt,yt,$t,Zt,zn]};Object.defineProperty(Pt.prototype,"sx",{get:function(){return this._matrix[0]},set:function(W){this._matrix[0]=W}}),Object.defineProperty(Pt.prototype,"shy",{get:function(){return this._matrix[1]},set:function(W){this._matrix[1]=W}}),Object.defineProperty(Pt.prototype,"shx",{get:function(){return this._matrix[2]},set:function(W){this._matrix[2]=W}}),Object.defineProperty(Pt.prototype,"sy",{get:function(){return this._matrix[3]},set:function(W){this._matrix[3]=W}}),Object.defineProperty(Pt.prototype,"tx",{get:function(){return this._matrix[4]},set:function(W){this._matrix[4]=W}}),Object.defineProperty(Pt.prototype,"ty",{get:function(){return this._matrix[5]},set:function(W){this._matrix[5]=W}}),Object.defineProperty(Pt.prototype,"a",{get:function(){return this._matrix[0]},set:function(W){this._matrix[0]=W}}),Object.defineProperty(Pt.prototype,"b",{get:function(){return this._matrix[1]},set:function(W){this._matrix[1]=W}}),Object.defineProperty(Pt.prototype,"c",{get:function(){return this._matrix[2]},set:function(W){this._matrix[2]=W}}),Object.defineProperty(Pt.prototype,"d",{get:function(){return this._matrix[3]},set:function(W){this._matrix[3]=W}}),Object.defineProperty(Pt.prototype,"e",{get:function(){return this._matrix[4]},set:function(W){this._matrix[4]=W}}),Object.defineProperty(Pt.prototype,"f",{get:function(){return this._matrix[5]},set:function(W){this._matrix[5]=W}}),Object.defineProperty(Pt.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(Pt.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(Pt.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(Pt.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),Pt.prototype.join=function(W){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(U).join(W)},Pt.prototype.multiply=function(W){var Ce=W.sx*this.sx+W.shy*this.shx,mt=W.sx*this.shy+W.shy*this.sy,yt=W.shx*this.sx+W.sy*this.shx,$t=W.shx*this.shy+W.sy*this.sy,Zt=W.tx*this.sx+W.ty*this.shx+this.tx,zn=W.tx*this.shy+W.ty*this.sy+this.ty;return new Pt(Ce,mt,yt,$t,Zt,zn)},Pt.prototype.decompose=function(){var W=this.sx,Ce=this.shy,mt=this.shx,yt=this.sy,$t=this.tx,Zt=this.ty,zn=Math.sqrt(W*W+Ce*Ce),Nr=(W/=zn)*mt+(Ce/=zn)*yt;mt-=W*Nr,yt-=Ce*Nr;var Hr=Math.sqrt(mt*mt+yt*yt);return Nr/=Hr,W*(yt/=Hr)<Ce*(mt/=Hr)&&(W=-W,Ce=-Ce,Nr=-Nr,zn=-zn),{scale:new Pt(zn,0,0,Hr,0,0),translate:new Pt(1,0,0,1,$t,Zt),rotate:new Pt(W,Ce,-Ce,W,0,0),skew:new Pt(1,0,Nr,1,0,0)}},Pt.prototype.toString=function(W){return this.join(" ")},Pt.prototype.inversed=function(){var W=this.sx,Ce=this.shy,mt=this.shx,yt=this.sy,$t=this.tx,Zt=this.ty,zn=1/(W*yt-Ce*mt),Nr=yt*zn,Hr=-Ce*zn,gi=-mt*zn,Ti=W*zn;return new Pt(Nr,Hr,gi,Ti,-Nr*$t-gi*Zt,-Hr*$t-Ti*Zt)},Pt.prototype.applyToPoint=function(W){var Ce=W.x*this.sx+W.y*this.shx+this.tx,mt=W.x*this.shy+W.y*this.sy+this.ty;return new ul(Ce,mt)},Pt.prototype.applyToRectangle=function(W){var Ce=this.applyToPoint(W),mt=this.applyToPoint(new ul(W.x+W.w,W.y+W.h));return new Qc(Ce.x,Ce.y,mt.x-Ce.x,mt.y-Ce.y)},Pt.prototype.clone=function(){var W=this.sx,Ce=this.shy,mt=this.shx,yt=this.sy,$t=this.tx,Zt=this.ty;return new Pt(W,Ce,mt,yt,$t,Zt)},k.Matrix=Pt;var xn=k.matrixMult=function(W,Ce){return Ce.multiply(W)},Un=new Pt(1,0,0,1,0,0);k.unitMatrix=k.identityMatrix=Un;var In=function(W,Ce){if(!hi[W]){var mt=(Ce instanceof Jm?"Sh":"P")+(Object.keys(Or).length+1).toString(10);Ce.id=mt,hi[W]=mt,Or[mt]=Ce,ht.publish("addPattern",Ce)}};k.ShadingPattern=Jm,k.TilingPattern=c0,k.addShadingPattern=function(W,Ce){return F("addShadingPattern()"),In(W,Ce),this},k.beginTilingPattern=function(W){F("beginTilingPattern()"),qs(W.boundingBox[0],W.boundingBox[1],W.boundingBox[2]-W.boundingBox[0],W.boundingBox[3]-W.boundingBox[1],W.matrix)},k.endTilingPattern=function(W,Ce){F("endTilingPattern()"),Ce.stream=hn[Ne].join(`
`),In(W,Ce),ht.publish("endTilingPattern",Ce),At.pop().restore()};var kr,Lr=k.__private__.newObject=function(){var W=jr();return Er(W,!0),W},jr=k.__private__.newObjectDeferred=function(){return rt++,gt[rt]=function(){return Mt},rt},Er=function(W,Ce){return Ce=typeof Ce=="boolean"&&Ce,gt[W]=Mt,Ce&&ot(W+" 0 obj"),W},Ei=k.__private__.newAdditionalObject=function(){var W={objId:jr(),content:""};return Jt.push(W),W},oo=jr(),_o=jr(),Ho=k.__private__.decodeColorString=function(W){var Ce=W.split(" ");if(Ce.length!==2||Ce[1]!=="g"&&Ce[1]!=="G")Ce.length!==5||Ce[4]!=="k"&&Ce[4]!=="K"||(Ce=[(1-Ce[0])*(1-Ce[3]),(1-Ce[1])*(1-Ce[3]),(1-Ce[2])*(1-Ce[3]),"r"]);else{var mt=parseFloat(Ce[0]);Ce=[mt,mt,mt,"r"]}for(var yt="#",$t=0;$t<3;$t++)yt+=("0"+Math.floor(255*parseFloat(Ce[$t])).toString(16)).slice(-2);return yt},so=k.__private__.encodeColorString=function(W){var Ce;typeof W=="string"&&(W={ch1:W});var mt=W.ch1,yt=W.ch2,$t=W.ch3,Zt=W.ch4,zn=W.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof mt=="string"&&mt.charAt(0)!=="#"){var Nr=new B6(mt);if(Nr.ok)mt=Nr.toHex();else if(!/^\d*\.?\d*$/.test(mt))throw new Error('Invalid color "'+mt+'" passed to jsPDF.encodeColorString.')}if(typeof mt=="string"&&/^#[0-9A-Fa-f]{3}$/.test(mt)&&(mt="#"+mt[1]+mt[1]+mt[2]+mt[2]+mt[3]+mt[3]),typeof mt=="string"&&/^#[0-9A-Fa-f]{6}$/.test(mt)){var Hr=parseInt(mt.substr(1),16);mt=Hr>>16&255,yt=Hr>>8&255,$t=255&Hr}if(yt===void 0||Zt===void 0&&mt===yt&&yt===$t)Ce=typeof mt=="string"?mt+" "+zn[0]:W.precision===2?j(mt/255)+" "+zn[0]:H(mt/255)+" "+zn[0];else if(Zt===void 0||xa(Zt)==="object"){if(Zt&&!isNaN(Zt.a)&&Zt.a===0)return["1.","1.","1.",zn[1]].join(" ");Ce=typeof mt=="string"?[mt,yt,$t,zn[1]].join(" "):W.precision===2?[j(mt/255),j(yt/255),j($t/255),zn[1]].join(" "):[H(mt/255),H(yt/255),H($t/255),zn[1]].join(" ")}else Ce=typeof mt=="string"?[mt,yt,$t,Zt,zn[2]].join(" "):W.precision===2?[j(mt),j(yt),j($t),j(Zt),zn[2]].join(" "):[H(mt),H(yt),H($t),H(Zt),zn[2]].join(" ");return Ce},_s=k.__private__.getFilters=function(){return m},ao=k.__private__.putStream=function(W){var Ce=(W=W||{}).data||"",mt=W.filters||_s(),yt=W.alreadyAppliedFilters||[],$t=W.addLength1||!1,Zt=Ce.length,zn=W.objectId,Nr=function(zo){return zo};if(I!==null&&zn===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");I!==null&&(Nr=Br.encryptor(zn,0));var Hr={};mt===!0&&(mt=["FlateEncode"]);var gi=W.additionalKeyValues||[],Ti=(Hr=wi.API.processDataByFilters!==void 0?wi.API.processDataByFilters(Ce,mt):{data:Ce,reverseChain:[]}).reverseChain+(Array.isArray(yt)?yt.join(" "):yt.toString());if(Hr.data.length!==0&&(gi.push({key:"Length",value:Hr.data.length}),$t===!0&&gi.push({key:"Length1",value:Zt})),Ti.length!=0)if(Ti.split("/").length-1==1)gi.push({key:"Filter",value:Ti});else{gi.push({key:"Filter",value:"["+Ti+"]"});for(var bo=0;bo<gi.length;bo+=1)if(gi[bo].key==="DecodeParms"){for(var wo=[],Qo=0;Qo<Hr.reverseChain.split("/").length-1;Qo+=1)wo.push("null");wo.push(gi[bo].value),gi[bo].value="["+wo.join(" ")+"]"}}ot("<<");for(var Mo=0;Mo<gi.length;Mo++)ot("/"+gi[Mo].key+" "+gi[Mo].value);ot(">>"),Hr.data.length!==0&&(ot("stream"),ot(Nr(Hr.data)),ot("endstream"))},Cs=k.__private__.putPage=function(W){var Ce=W.number,mt=W.data,yt=W.objId,$t=W.contentsObjId;Er(yt,!0),ot("<</Type /Page"),ot("/Parent "+W.rootDictionaryObjId+" 0 R"),ot("/Resources "+W.resourceDictionaryObjId+" 0 R"),ot("/MediaBox ["+parseFloat(U(W.mediaBox.bottomLeftX))+" "+parseFloat(U(W.mediaBox.bottomLeftY))+" "+U(W.mediaBox.topRightX)+" "+U(W.mediaBox.topRightY)+"]"),W.cropBox!==null&&ot("/CropBox ["+U(W.cropBox.bottomLeftX)+" "+U(W.cropBox.bottomLeftY)+" "+U(W.cropBox.topRightX)+" "+U(W.cropBox.topRightY)+"]"),W.bleedBox!==null&&ot("/BleedBox ["+U(W.bleedBox.bottomLeftX)+" "+U(W.bleedBox.bottomLeftY)+" "+U(W.bleedBox.topRightX)+" "+U(W.bleedBox.topRightY)+"]"),W.trimBox!==null&&ot("/TrimBox ["+U(W.trimBox.bottomLeftX)+" "+U(W.trimBox.bottomLeftY)+" "+U(W.trimBox.topRightX)+" "+U(W.trimBox.topRightY)+"]"),W.artBox!==null&&ot("/ArtBox ["+U(W.artBox.bottomLeftX)+" "+U(W.artBox.bottomLeftY)+" "+U(W.artBox.topRightX)+" "+U(W.artBox.topRightY)+"]"),typeof W.userUnit=="number"&&W.userUnit!==1&&ot("/UserUnit "+W.userUnit),ht.publish("putPage",{objId:yt,pageContext:et[Ce],pageNumber:Ce,page:mt}),ot("/Contents "+$t+" 0 R"),ot(">>"),ot("endobj");var Zt=mt.join(`
`);return ue===me&&(Zt+=`
Q`),Er($t,!0),ao({data:Zt,filters:_s(),objectId:$t}),ot("endobj"),yt},ma=k.__private__.putPages=function(){var W,Ce,mt=[];for(W=1;W<=Te;W++)et[W].objId=jr(),et[W].contentsObjId=jr();for(W=1;W<=Te;W++)mt.push(Cs({number:W,data:hn[W],objId:et[W].objId,contentsObjId:et[W].contentsObjId,mediaBox:et[W].mediaBox,cropBox:et[W].cropBox,bleedBox:et[W].bleedBox,trimBox:et[W].trimBox,artBox:et[W].artBox,userUnit:et[W].userUnit,rootDictionaryObjId:oo,resourceDictionaryObjId:_o}));Er(oo,!0),ot("<</Type /Pages");var yt="/Kids [";for(Ce=0;Ce<Te;Ce++)yt+=mt[Ce]+" 0 R ";ot(yt+"]"),ot("/Count "+Te),ot(">>"),ot("endobj"),ht.publish("postPutPages")},bl=function(W){ht.publish("putFont",{font:W,out:ot,newObject:Lr,putStream:ao}),W.isAlreadyPutted!==!0&&(W.objectNumber=Lr(),ot("<<"),ot("/Type /Font"),ot("/BaseFont /"+r0(W.postScriptName)),ot("/Subtype /Type1"),typeof W.encoding=="string"&&ot("/Encoding /"+W.encoding),ot("/FirstChar 32"),ot("/LastChar 255"),ot(">>"),ot("endobj"))},ll=function(W){W.objectNumber=Lr();var Ce=[];Ce.push({key:"Type",value:"/XObject"}),Ce.push({key:"Subtype",value:"/Form"}),Ce.push({key:"BBox",value:"["+[U(W.x),U(W.y),U(W.x+W.width),U(W.y+W.height)].join(" ")+"]"}),Ce.push({key:"Matrix",value:"["+W.matrix.toString()+"]"});var mt=W.pages[1].join(`
`);ao({data:mt,additionalKeyValues:Ce,objectId:W.objectNumber}),ot("endobj")},Hi=function(W,Ce){Ce||(Ce=21);var mt=Lr(),yt=(function(zn,Nr){var Hr,gi=[],Ti=1/(Nr-1);for(Hr=0;Hr<1;Hr+=Ti)gi.push(Hr);if(gi.push(1),zn[0].offset!=0){var bo={offset:0,color:zn[0].color};zn.unshift(bo)}if(zn[zn.length-1].offset!=1){var wo={offset:1,color:zn[zn.length-1].color};zn.push(wo)}for(var Qo="",Mo=0,zo=0;zo<gi.length;zo++){for(Hr=gi[zo];Hr>zn[Mo+1].offset;)Mo++;var es=zn[Mo].offset,us=(Hr-es)/(zn[Mo+1].offset-es),jo=zn[Mo].color,Es=zn[Mo+1].color;Qo+=Qe(Math.round((1-us)*jo[0]+us*Es[0]).toString(16))+Qe(Math.round((1-us)*jo[1]+us*Es[1]).toString(16))+Qe(Math.round((1-us)*jo[2]+us*Es[2]).toString(16))}return Qo.trim()})(W.colors,Ce),$t=[];$t.push({key:"FunctionType",value:"0"}),$t.push({key:"Domain",value:"[0.0 1.0]"}),$t.push({key:"Size",value:"["+Ce+"]"}),$t.push({key:"BitsPerSample",value:"8"}),$t.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),$t.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),ao({data:yt,additionalKeyValues:$t,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:mt}),ot("endobj"),W.objectNumber=Lr(),ot("<< /ShadingType "+W.type),ot("/ColorSpace /DeviceRGB");var Zt="/Coords ["+U(parseFloat(W.coords[0]))+" "+U(parseFloat(W.coords[1]))+" ";W.type===2?Zt+=U(parseFloat(W.coords[2]))+" "+U(parseFloat(W.coords[3])):Zt+=U(parseFloat(W.coords[2]))+" "+U(parseFloat(W.coords[3]))+" "+U(parseFloat(W.coords[4]))+" "+U(parseFloat(W.coords[5])),ot(Zt+="]"),W.matrix&&ot("/Matrix ["+W.matrix.toString()+"]"),ot("/Function "+mt+" 0 R"),ot("/Extend [true true]"),ot(">>"),ot("endobj")},nc=function(W,Ce){var mt=jr(),yt=Lr();Ce.push({resourcesOid:mt,objectOid:yt}),W.objectNumber=yt;var $t=[];$t.push({key:"Type",value:"/Pattern"}),$t.push({key:"PatternType",value:"1"}),$t.push({key:"PaintType",value:"1"}),$t.push({key:"TilingType",value:"1"}),$t.push({key:"BBox",value:"["+W.boundingBox.map(U).join(" ")+"]"}),$t.push({key:"XStep",value:U(W.xStep)}),$t.push({key:"YStep",value:U(W.yStep)}),$t.push({key:"Resources",value:mt+" 0 R"}),W.matrix&&$t.push({key:"Matrix",value:"["+W.matrix.toString()+"]"}),ao({data:W.stream,additionalKeyValues:$t,objectId:W.objectNumber}),ot("endobj")},Lu=function(W){for(var Ce in W.objectNumber=Lr(),ot("<<"),W)switch(Ce){case"opacity":ot("/ca "+j(W[Ce]));break;case"stroke-opacity":ot("/CA "+j(W[Ce]))}ot(">>"),ot("endobj")},To=function(W){Er(W.resourcesOid,!0),ot("<<"),ot("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),(function(){for(var Ce in ot("/Font <<"),or)or.hasOwnProperty(Ce)&&(M===!1||M===!0&&V.hasOwnProperty(Ce))&&ot("/"+Ce+" "+or[Ce].objectNumber+" 0 R");ot(">>")})(),(function(){if(Object.keys(Or).length>0){for(var Ce in ot("/Shading <<"),Or)Or.hasOwnProperty(Ce)&&Or[Ce]instanceof Jm&&Or[Ce].objectNumber>=0&&ot("/"+Ce+" "+Or[Ce].objectNumber+" 0 R");ht.publish("putShadingPatternDict"),ot(">>")}})(),(function(Ce){if(Object.keys(Or).length>0){for(var mt in ot("/Pattern <<"),Or)Or.hasOwnProperty(mt)&&Or[mt]instanceof k.TilingPattern&&Or[mt].objectNumber>=0&&Or[mt].objectNumber<Ce&&ot("/"+mt+" "+Or[mt].objectNumber+" 0 R");ht.publish("putTilingPatternDict"),ot(">>")}})(W.objectOid),(function(){if(Object.keys(si).length>0){var Ce;for(Ce in ot("/ExtGState <<"),si)si.hasOwnProperty(Ce)&&si[Ce].objectNumber>=0&&ot("/"+Ce+" "+si[Ce].objectNumber+" 0 R");ht.publish("putGStateDict"),ot(">>")}})(),(function(){for(var Ce in ot("/XObject <<"),Rt)Rt.hasOwnProperty(Ce)&&Rt[Ce].objectNumber>=0&&ot("/"+Ce+" "+Rt[Ce].objectNumber+" 0 R");ht.publish("putXobjectDict"),ot(">>")})(),ot(">>"),ot("endobj")},fu=function(W){oi[W.fontName]=oi[W.fontName]||{},oi[W.fontName][W.fontStyle]=W.id},wa=function(W,Ce,mt,yt,$t){var Zt={id:"F"+(Object.keys(or).length+1).toString(10),postScriptName:W,fontName:Ce,fontStyle:mt,encoding:yt,isStandardFont:$t||!1,metadata:{}};return ht.publish("addFont",{font:Zt,instance:this}),or[Zt.id]=Zt,fu(Zt),Zt.id},Zo=k.__private__.pdfEscape=k.pdfEscape=function(W,Ce){return(function(mt,yt){var $t,Zt,zn,Nr,Hr,gi,Ti,bo,wo;if(zn=(yt=yt||{}).sourceEncoding||"Unicode",Hr=yt.outputEncoding,(yt.autoencode||Hr)&&or[Tr].metadata&&or[Tr].metadata[zn]&&or[Tr].metadata[zn].encoding&&(Nr=or[Tr].metadata[zn].encoding,!Hr&&or[Tr].encoding&&(Hr=or[Tr].encoding),!Hr&&Nr.codePages&&(Hr=Nr.codePages[0]),typeof Hr=="string"&&(Hr=Nr[Hr]),Hr)){for(Ti=!1,gi=[],$t=0,Zt=mt.length;$t<Zt;$t++)(bo=Hr[mt.charCodeAt($t)])?gi.push(String.fromCharCode(bo)):gi.push(mt[$t]),gi[$t].charCodeAt(0)>>8&&(Ti=!0);mt=gi.join("")}for($t=mt.length;Ti===void 0&&$t!==0;)mt.charCodeAt($t-1)>>8&&(Ti=!0),$t--;if(!Ti)return mt;for(gi=yt.noBOM?[]:[254,255],$t=0,Zt=mt.length;$t<Zt;$t++){if((wo=(bo=mt.charCodeAt($t))>>8)>>8)throw new Error("Character at position "+$t+" of string '"+mt+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");gi.push(wo),gi.push(bo-(wo<<8))}return String.fromCharCode.apply(void 0,gi)})(W,Ce).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Ha=k.__private__.beginPage=function(W){hn[++Te]=[],et[Te]={objId:0,contentsObjId:0,userUnit:Number(_),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(W[0]),topRightY:Number(W[1])}},Sa(Te),Gt(hn[Ne])},Bl=function(W,Ce){var mt,yt,$t;switch(t=Ce||t,typeof W=="string"&&(mt=J(W.toLowerCase()),Array.isArray(mt)&&(yt=mt[0],$t=mt[1])),Array.isArray(W)&&(yt=W[0]*Ir,$t=W[1]*Ir),isNaN(yt)&&(yt=c[0],$t=c[1]),(yt>14400||$t>14400)&&(Ga.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),yt=Math.min(14400,yt),$t=Math.min(14400,$t)),c=[yt,$t],t.substr(0,1)){case"l":$t>yt&&(c=[$t,yt]);break;case"p":yt>$t&&(c=[$t,yt])}Ha(c),Jo(Na),ot(xo),Ko!==0&&ot(Ko+" J"),ga!==0&&ot(ga+" j"),ht.publish("addPage",{pageNumber:Te})},rc=function(W){W>0&&W<=Te&&(hn.splice(W,1),et.splice(W,1),Te--,Ne>Te&&(Ne=Te),this.setPage(Ne))},Sa=function(W){W>0&&W<=Te&&(Ne=W)},ra=k.__private__.getNumberOfPages=k.getNumberOfPages=function(){return hn.length-1},mn=function(W,Ce,mt){var yt,$t=void 0;return mt=mt||{},W=W!==void 0?W:or[Tr].fontName,Ce=Ce!==void 0?Ce:or[Tr].fontStyle,yt=W.toLowerCase(),oi[yt]!==void 0&&oi[yt][Ce]!==void 0?$t=oi[yt][Ce]:oi[W]!==void 0&&oi[W][Ce]!==void 0?$t=oi[W][Ce]:mt.disableWarning===!1&&Ga.warn("Unable to look up font label for font '"+W+"', '"+Ce+"'. Refer to getFontList() for available fonts."),$t||mt.noFallback||($t=oi.times[Ce])==null&&($t=oi.times.normal),$t},Yo=k.__private__.putInfo=function(){var W=Lr(),Ce=function(yt){return yt};for(var mt in I!==null&&(Ce=Br.encryptor(W,0)),ot("<<"),ot("/Producer ("+Zo(Ce("jsPDF "+wi.version))+")"),vr)vr.hasOwnProperty(mt)&&vr[mt]&&ot("/"+mt.substr(0,1).toUpperCase()+mt.substr(1)+" ("+Zo(Ce(vr[mt]))+")");ot("/CreationDate ("+Zo(Ce(Re))+")"),ot(">>"),ot("endobj")},ss=k.__private__.putCatalog=function(W){var Ce=(W=W||{}).rootDictionaryObjId||oo;switch(Lr(),ot("<<"),ot("/Type /Catalog"),ot("/Pages "+Ce+" 0 R"),ir||(ir="fullwidth"),ir){case"fullwidth":ot("/OpenAction [3 0 R /FitH null]");break;case"fullheight":ot("/OpenAction [3 0 R /FitV null]");break;case"fullpage":ot("/OpenAction [3 0 R /Fit]");break;case"original":ot("/OpenAction [3 0 R /XYZ null null 1]");break;default:var mt=""+ir;mt.substr(mt.length-1)==="%"&&(ir=parseInt(ir)/100),typeof ir=="number"&&ot("/OpenAction [3 0 R /XYZ null null "+j(ir)+"]")}switch(Hn||(Hn="continuous"),Hn){case"continuous":ot("/PageLayout /OneColumn");break;case"single":ot("/PageLayout /SinglePage");break;case"two":case"twoleft":ot("/PageLayout /TwoColumnLeft");break;case"tworight":ot("/PageLayout /TwoColumnRight")}qt&&ot("/PageMode /"+qt),ht.publish("putCatalog"),ot(">>"),ot("endobj")},_i=k.__private__.putTrailer=function(){ot("trailer"),ot("<<"),ot("/Size "+(rt+1)),ot("/Root "+rt+" 0 R"),ot("/Info "+(rt-1)+" 0 R"),I!==null&&ot("/Encrypt "+Br.oid+" 0 R"),ot("/ID [ <"+Oe+"> <"+Oe+"> ]"),ot(">>")},pu=k.__private__.putHeader=function(){ot("%PDF-"+ie),ot("%")},Wa=k.__private__.putXRef=function(){var W="0000000000";ot("xref"),ot("0 "+(rt+1)),ot("0000000000 65535 f ");for(var Ce=1;Ce<=rt;Ce++)typeof gt[Ce]=="function"?ot((W+gt[Ce]()).slice(-10)+" 00000 n "):gt[Ce]!==void 0?ot((W+gt[Ce]).slice(-10)+" 00000 n "):ot("0000000000 00000 n ")},Ka=k.__private__.buildDocument=function(){var W;rt=0,Mt=0,pt=[],gt=[],Jt=[],oo=jr(),_o=jr(),Gt(pt),ht.publish("buildDocument"),pu(),ma(),(function(){ht.publish("putAdditionalObjects");for(var mt=0;mt<Jt.length;mt++){var yt=Jt[mt];Er(yt.objId,!0),ot(yt.content),ot("endobj")}ht.publish("postPutAdditionalObjects")})(),W=[],(function(){for(var mt in or)or.hasOwnProperty(mt)&&(M===!1||M===!0&&V.hasOwnProperty(mt))&&bl(or[mt])})(),(function(){var mt;for(mt in si)si.hasOwnProperty(mt)&&Lu(si[mt])})(),(function(){for(var mt in Rt)Rt.hasOwnProperty(mt)&&ll(Rt[mt])})(),(function(mt){var yt;for(yt in Or)Or.hasOwnProperty(yt)&&(Or[yt]instanceof Jm?Hi(Or[yt]):Or[yt]instanceof c0&&nc(Or[yt],mt))})(W),ht.publish("putResources"),W.forEach(To),To({resourcesOid:_o,objectOid:Number.MAX_SAFE_INTEGER}),ht.publish("postPutResources"),I!==null&&(Br.oid=Lr(),ot("<<"),ot("/Filter /Standard"),ot("/V "+Br.v),ot("/R "+Br.r),ot("/U <"+Br.toHexString(Br.U)+">"),ot("/O <"+Br.toHexString(Br.O)+">"),ot("/P "+Br.P),ot(">>"),ot("endobj")),Yo(),ss();var Ce=Mt;return Wa(),_i(),ot("startxref"),ot(""+Ce),ot("%%EOF"),Gt(hn[Ne]),pt.join(`
`)},cl=k.__private__.getBlob=function(W){return new Blob([wr(W)],{type:"application/pdf"})},Ls=k.output=k.__private__.output=(kr=function(W,Ce){switch(typeof(Ce=Ce||{})=="string"?Ce={filename:Ce}:Ce.filename=Ce.filename||"generated.pdf",W){case void 0:return Ka();case"save":k.save(Ce.filename);break;case"arraybuffer":return wr(Ka());case"blob":return cl(Ka());case"bloburi":case"bloburl":if(uo.URL!==void 0&&typeof uo.URL.createObjectURL=="function")return uo.URL&&uo.URL.createObjectURL(cl(Ka()))||void 0;Ga.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var mt="",yt=Ka();try{mt=ES(yt)}catch{mt=ES(unescape(encodeURIComponent(yt)))}return"data:application/pdf;filename="+Ce.filename+";base64,"+mt;case"pdfobjectnewwindow":if(Object.prototype.toString.call(uo)==="[object Window]"){var $t="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",Zt=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';Ce.pdfObjectUrl&&($t=Ce.pdfObjectUrl,Zt="");var zn='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+$t+'"'+Zt+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(Ce)+");<\/script></body></html>",Nr=uo.open();return Nr!==null&&Nr.document.write(zn),Nr}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(uo)==="[object Window]"){var Hr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(Ce.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+Ce.filename+'" width="500px" height="400px" /></body></html>',gi=uo.open();if(gi!==null){gi.document.write(Hr);var Ti=this;gi.document.documentElement.querySelector("#pdfViewer").onload=function(){gi.document.title=Ce.filename,gi.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(Ti.output("bloburl"))}}return gi}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(uo)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var bo='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",Ce)+'"></iframe></body></html>',wo=uo.open();if(wo!==null&&(wo.document.write(bo),wo.document.title=Ce.filename),wo||typeof safari>"u")return wo;break;case"datauri":case"dataurl":return uo.document.location.href=this.output("datauristring",Ce);default:return null}},kr.foo=function(){try{return kr.apply(this,arguments)}catch(mt){var W=mt.stack||"";~W.indexOf(" at ")&&(W=W.split(" at ")[1]);var Ce="Error in function "+W.split(`
`)[0].split("<")[0]+": "+mt.message;if(!uo.console)throw new Error(Ce);uo.console.error(Ce,mt),uo.alert&&alert(Ce)}},kr.foo.bar=kr,kr.foo),er=function(W){return Array.isArray(Lt)===!0&&Lt.indexOf(W)>-1};switch(i){case"pt":Ir=1;break;case"mm":Ir=72/25.4;break;case"cm":Ir=72/2.54;break;case"in":Ir=72;break;case"px":Ir=er("px_scaling")==1?.75:96/72;break;case"pc":case"em":Ir=12;break;case"ex":Ir=6;break;default:if(typeof i!="number")throw new Error("Invalid unit: "+i);Ir=i}var Br=null;xe(),we();var Mr=k.__private__.getPageInfo=k.getPageInfo=function(W){if(isNaN(W)||W%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:et[W].objId,pageNumber:W,pageContext:et[W]}},js=k.__private__.getPageInfoByObjId=function(W){if(isNaN(W)||W%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var Ce in et)if(et[Ce].objId===W)break;return Mr(Ce)},Ea=k.__private__.getCurrentPageInfo=k.getCurrentPageInfo=function(){return{objId:et[Ne].objId,pageNumber:Ne,pageContext:et[Ne]}};k.addPage=function(){return Bl.apply(this,arguments),this},k.setPage=function(){return Sa.apply(this,arguments),Gt.call(this,hn[Ne]),this},k.insertPage=function(W){return this.addPage(),this.movePage(Ne,W),this},k.movePage=function(W,Ce){var mt,yt;if(W>Ce){mt=hn[W],yt=et[W];for(var $t=W;$t>Ce;$t--)hn[$t]=hn[$t-1],et[$t]=et[$t-1];hn[Ce]=mt,et[Ce]=yt,this.setPage(Ce)}else if(W<Ce){mt=hn[W],yt=et[W];for(var Zt=W;Zt<Ce;Zt++)hn[Zt]=hn[Zt+1],et[Zt]=et[Zt+1];hn[Ce]=mt,et[Ce]=yt,this.setPage(Ce)}return this},k.deletePage=function(){return rc.apply(this,arguments),this},k.__private__.text=k.text=function(W,Ce,mt,yt,$t){var Zt,zn,Nr,Hr,gi,Ti,bo,wo,Qo,Mo=(yt=yt||{}).scope||this;if(typeof W=="number"&&typeof Ce=="number"&&(typeof mt=="string"||Array.isArray(mt))){var zo=mt;mt=Ce,Ce=W,W=zo}if(arguments[3]instanceof Pt==0?(Nr=arguments[4],Hr=arguments[5],xa(bo=arguments[3])==="object"&&bo!==null||(typeof Nr=="string"&&(Hr=Nr,Nr=null),typeof bo=="string"&&(Hr=bo,bo=null),typeof bo=="number"&&(Nr=bo,bo=null),yt={flags:bo,angle:Nr,align:Hr})):(F("The transform parameter of text() with a Matrix value"),Qo=$t),isNaN(Ce)||isNaN(mt)||W==null)throw new Error("Invalid arguments passed to jsPDF.text");if(W.length===0)return Mo;var es,us="",jo=typeof yt.lineHeightFactor=="number"?yt.lineHeightFactor:ji,Es=Mo.internal.scaleFactor;function Fc(Xo){return Xo=Xo.split("	").join(Array(yt.TabLen||9).join(" ")),Zo(Xo,bo)}function Za(Xo){for(var So,la=Xo.concat(),ca=[],Bc=la.length;Bc--;)typeof(So=la.shift())=="string"?ca.push(So):Array.isArray(Xo)&&(So.length===1||So[1]===void 0&&So[2]===void 0)?ca.push(So[0]):ca.push([So[0],So[1],So[2]]);return ca}function L(Xo,So){var la;if(typeof Xo=="string")la=So(Xo)[0];else if(Array.isArray(Xo)){for(var ca,Bc,kh=Xo.concat(),_u=[],tu=kh.length;tu--;)typeof(ca=kh.shift())=="string"?_u.push(So(ca)[0]):Array.isArray(ca)&&typeof ca[0]=="string"&&(Bc=So(ca[0],ca[1],ca[2]),_u.push([Bc[0],Bc[1],Bc[2]]));la=_u}return la}var ae=!1,ve=!0;if(typeof W=="string")ae=!0;else if(Array.isArray(W)){var He=W.concat();zn=[];for(var Kt,pn=He.length;pn--;)(typeof(Kt=He.shift())!="string"||Array.isArray(Kt)&&typeof Kt[0]!="string")&&(ve=!1);ae=ve}if(ae===!1)throw new Error('Type of text must be string or Array. "'+W+'" is not recognized.');typeof W=="string"&&(W=W.match(/[\r?\n]/)?W.split(/\r\n|\r|\n/g):[W]);var sr=Ln/Mo.internal.scaleFactor,ho=sr*(jo-1);switch(yt.baseline){case"bottom":mt-=ho;break;case"top":mt+=sr-ho;break;case"hanging":mt+=sr-2*ho;break;case"middle":mt+=sr/2-ho}if((Ti=yt.maxWidth||0)>0&&(typeof W=="string"?W=Mo.splitTextToSize(W,Ti):Object.prototype.toString.call(W)==="[object Array]"&&(W=W.reduce(function(Xo,So){return Xo.concat(Mo.splitTextToSize(So,Ti))},[]))),Zt={text:W,x:Ce,y:mt,options:yt,mutex:{pdfEscape:Zo,activeFontKey:Tr,fonts:or,activeFontSize:Ln}},ht.publish("preProcessText",Zt),W=Zt.text,Nr=(yt=Zt.options).angle,Qo instanceof Pt==0&&Nr&&typeof Nr=="number"){Nr*=Math.PI/180,yt.rotationDirection===0&&(Nr=-Nr),ue===me&&(Nr=-Nr);var Fo=Math.cos(Nr),Wi=Math.sin(Nr);Qo=new Pt(Fo,Wi,-Wi,Fo,0,0)}else Nr&&Nr instanceof Pt&&(Qo=Nr);ue!==me||Qo||(Qo=Un),(gi=yt.charSpace||Bo)!==void 0&&(us+=U(Z(gi))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(wo=yt.horizontalScale)!==void 0&&(us+=U(100*wo)+` Tz
`),yt.lang;var Oi=-1,No=yt.renderingMode!==void 0?yt.renderingMode:yt.stroke,sa=Mo.internal.getCurrentPageInfo().pageContext;switch(No){case 0:case!1:case"fill":Oi=0;break;case 1:case!0:case"stroke":Oi=1;break;case 2:case"fillThenStroke":Oi=2;break;case 3:case"invisible":Oi=3;break;case 4:case"fillAndAddForClipping":Oi=4;break;case 5:case"strokeAndAddPathForClipping":Oi=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":Oi=6;break;case 7:case"addToPathForClipping":Oi=7}var Oo=sa.usedRenderingMode!==void 0?sa.usedRenderingMode:-1;Oi!==-1?us+=Oi+` Tr
`:Oo!==-1&&(us+=`0 Tr
`),Oi!==-1&&(sa.usedRenderingMode=Oi),Hr=yt.align||"left";var $i,jl=Ln*jo,aa=Mo.internal.pageSize.getWidth(),Ru=or[Tr];gi=yt.charSpace||Bo,Ti=yt.maxWidth||0,bo=Object.assign({autoencode:!0,noBOM:!0},yt.flags);var dl=[],xc=function(Xo){return Mo.getStringUnitWidth(Xo,{font:Ru,charSpace:gi,fontSize:Ln,doKerning:!1})*Ln/Es};if(Object.prototype.toString.call(W)==="[object Array]"){var ks;zn=Za(W),Hr!=="left"&&($i=zn.map(xc));var ya,gu=0;if(Hr==="right"){Ce-=$i[0],W=[],pn=zn.length;for(var ts=0;ts<pn;ts++)ts===0?(ya=vo(Ce),ks=Us(mt)):(ya=Z(gu-$i[ts]),ks=-jl),W.push([zn[ts],ya,ks]),gu=$i[ts]}else if(Hr==="center"){Ce-=$i[0]/2,W=[],pn=zn.length;for(var Ws=0;Ws<pn;Ws++)Ws===0?(ya=vo(Ce),ks=Us(mt)):(ya=Z((gu-$i[Ws])/2),ks=-jl),W.push([zn[Ws],ya,ks]),gu=$i[Ws]}else if(Hr==="left"){W=[],pn=zn.length;for(var Fa=0;Fa<pn;Fa++)W.push(zn[Fa])}else if(Hr==="justify"&&Ru.encoding==="Identity-H"){W=[],pn=zn.length,Ti=Ti!==0?Ti:aa;for(var Ul=0,vs=0;vs<pn;vs++)if(ks=vs===0?Us(mt):-jl,ya=vs===0?vo(Ce):Ul,vs<pn-1){var Uo=Z((Ti-$i[vs])/(zn[vs].split(" ").length-1)),Aa=zn[vs].split(" ");W.push([Aa[0]+" ",ya,ks]),Ul=0;for(var Ks=1;Ks<Aa.length;Ks++){var yu=(xc(Aa[Ks-1]+" "+Aa[Ks])-xc(Aa[Ks]))*Es+Uo;Ks==Aa.length-1?W.push([Aa[Ks],yu,0]):W.push([Aa[Ks]+" ",yu,0]),Ul-=yu}}else W.push([zn[vs],ya,ks]);W.push(["",Ul,0])}else{if(Hr!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(W=[],pn=zn.length,Ti=Ti!==0?Ti:aa,vs=0;vs<pn;vs++){ks=vs===0?Us(mt):-jl,ya=vs===0?vo(Ce):0;var bc=zn[vs].split(" ").length-1,eu=bc>0?(Ti-$i[vs])/bc:0;vs<pn-1?dl.push(U(Z(eu))):dl.push(0),W.push([zn[vs],ya,ks])}}}(typeof yt.R2L=="boolean"?yt.R2L:Kr)===!0&&(W=L(W,function(Xo,So,la){return[Xo.split("").reverse().join(""),So,la]})),Zt={text:W,x:Ce,y:mt,options:yt,mutex:{pdfEscape:Zo,activeFontKey:Tr,fonts:or,activeFontSize:Ln}},ht.publish("postProcessText",Zt),W=Zt.text,es=Zt.mutex.isHex||!1;var Oa=or[Tr].encoding;Oa!=="WinAnsiEncoding"&&Oa!=="StandardEncoding"||(W=L(W,function(Xo,So,la){return[Fc(Xo),So,la]})),zn=Za(W),W=[];for(var sc,Sl,Vl,wc=Array.isArray(zn[0])?1:0,El="",Oc=function(Xo,So,la){var ca="";return la instanceof Pt?(la=typeof yt.angle=="number"?xn(la,new Pt(1,0,0,1,Xo,So)):xn(new Pt(1,0,0,1,Xo,So),la),ue===me&&(la=xn(new Pt(1,0,0,-1,0,0),la)),ca=la.join(" ")+` Tm
`):ca=U(Xo)+" "+U(So)+` Td
`,ca},lo=0;lo<zn.length;lo++){switch(El="",wc){case 1:Vl=(es?"<":"(")+zn[lo][0]+(es?">":")"),sc=parseFloat(zn[lo][1]),Sl=parseFloat(zn[lo][2]);break;case 0:Vl=(es?"<":"(")+zn[lo]+(es?">":")"),sc=vo(Ce),Sl=Us(mt)}dl!==void 0&&dl[lo]!==void 0&&(El=dl[lo]+` Tw
`),lo===0?W.push(El+Oc(sc,Sl,Qo)+Vl):wc===0?W.push(El+Vl):wc===1&&W.push(El+Oc(sc,Sl,Qo)+Vl)}W=wc===0?W.join(` Tj
T* `):W.join(` Tj
`),W+=` Tj
`;var Al=`BT
/`;return Al+=Tr+" "+Ln+` Tf
`,Al+=U(Ln*jo)+` TL
`,Al+=Da+`
`,Al+=us,Al+=W,ot(Al+="ET"),V[Tr]=!0,Mo};var vi=k.__private__.clip=k.clip=function(W){return ot(W==="evenodd"?"W*":"W"),this};k.clipEvenOdd=function(){return vi("evenodd")},k.__private__.discardPath=k.discardPath=function(){return ot("n"),this};var Mi=k.__private__.isValidStyle=function(W){var Ce=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(W)!==-1&&(Ce=!0),Ce};k.__private__.setDefaultPathOperation=k.setDefaultPathOperation=function(W){return Mi(W)&&(b=W),this};var wl=k.__private__.getStyle=k.getStyle=function(W){var Ce=b;switch(W){case"D":case"S":Ce="S";break;case"F":Ce="f";break;case"FD":case"DF":Ce="B";break;case"f":case"f*":case"B":case"B*":Ce=W}return Ce},qi=k.close=function(){return ot("h"),this};k.stroke=function(){return ot("S"),this},k.fill=function(W){return fs("f",W),this},k.fillEvenOdd=function(W){return fs("f*",W),this},k.fillStroke=function(W){return fs("B",W),this},k.fillStrokeEvenOdd=function(W){return fs("B*",W),this};var fs=function(W,Ce){xa(Ce)==="object"?ic(Ce,W):ot(W)},zi=function(W){W===null||ue===me&&W===void 0||(W=wl(W),ot(W))};function mu(W,Ce,mt,yt,$t){var Zt=new c0(Ce||this.boundingBox,mt||this.xStep,yt||this.yStep,this.gState,$t||this.matrix);Zt.stream=this.stream;var zn=W+"$$"+this.cloneIndex+++"$$";return In(zn,Zt),Zt}var ic=function(W,Ce){var mt=hi[W.key],yt=Or[mt];if(yt instanceof Jm)ot("q"),ot(Jc(Ce)),yt.gState&&k.setGState(yt.gState),ot(W.matrix.toString()+" cm"),ot("/"+mt+" sh"),ot("Q");else if(yt instanceof c0){var $t=new Pt(1,0,0,-1,0,Hs());W.matrix&&($t=$t.multiply(W.matrix||Un),mt=mu.call(yt,W.key,W.boundingBox,W.xStep,W.yStep,$t).id),ot("q"),ot("/Pattern cs"),ot("/"+mt+" scn"),yt.gState&&k.setGState(yt.gState),ot(Ce),ot("Q")}},Jc=function(W){switch(W){case"f":case"F":case"n":return"W n";case"f*":return"W* n";case"B":case"S":return"W S";case"B*":return"W* S"}},yc=k.moveTo=function(W,Ce){return ot(U(Z(W))+" "+U(be(Ce))+" m"),this},oc=k.lineTo=function(W,Ce){return ot(U(Z(W))+" "+U(be(Ce))+" l"),this},Ma=k.curveTo=function(W,Ce,mt,yt,$t,Zt){return ot([U(Z(W)),U(be(Ce)),U(Z(mt)),U(be(yt)),U(Z($t)),U(be(Zt)),"c"].join(" ")),this};k.__private__.line=k.line=function(W,Ce,mt,yt,$t){if(isNaN(W)||isNaN(Ce)||isNaN(mt)||isNaN(yt)||!Mi($t))throw new Error("Invalid arguments passed to jsPDF.line");return ue===ne?this.lines([[mt-W,yt-Ce]],W,Ce,[1,1],$t||"S"):this.lines([[mt-W,yt-Ce]],W,Ce,[1,1]).stroke()},k.__private__.lines=k.lines=function(W,Ce,mt,yt,$t,Zt){var zn,Nr,Hr,gi,Ti,bo,wo,Qo,Mo,zo,es,us;if(typeof W=="number"&&(us=mt,mt=Ce,Ce=W,W=us),yt=yt||[1,1],Zt=Zt||!1,isNaN(Ce)||isNaN(mt)||!Array.isArray(W)||!Array.isArray(yt)||!Mi($t)||typeof Zt!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(yc(Ce,mt),zn=yt[0],Nr=yt[1],gi=W.length,zo=Ce,es=mt,Hr=0;Hr<gi;Hr++)(Ti=W[Hr]).length===2?(zo=Ti[0]*zn+zo,es=Ti[1]*Nr+es,oc(zo,es)):(bo=Ti[0]*zn+zo,wo=Ti[1]*Nr+es,Qo=Ti[2]*zn+zo,Mo=Ti[3]*Nr+es,zo=Ti[4]*zn+zo,es=Ti[5]*Nr+es,Ma(bo,wo,Qo,Mo,zo,es));return Zt&&qi(),zi($t),this},k.path=function(W){for(var Ce=0;Ce<W.length;Ce++){var mt=W[Ce],yt=mt.c;switch(mt.op){case"m":yc(yt[0],yt[1]);break;case"l":oc(yt[0],yt[1]);break;case"c":Ma.apply(this,yt);break;case"h":qi()}}return this},k.__private__.rect=k.rect=function(W,Ce,mt,yt,$t){if(isNaN(W)||isNaN(Ce)||isNaN(mt)||isNaN(yt)||!Mi($t))throw new Error("Invalid arguments passed to jsPDF.rect");return ue===ne&&(yt=-yt),ot([U(Z(W)),U(be(Ce)),U(Z(mt)),U(Z(yt)),"re"].join(" ")),zi($t),this},k.__private__.triangle=k.triangle=function(W,Ce,mt,yt,$t,Zt,zn){if(isNaN(W)||isNaN(Ce)||isNaN(mt)||isNaN(yt)||isNaN($t)||isNaN(Zt)||!Mi(zn))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[mt-W,yt-Ce],[$t-mt,Zt-yt],[W-$t,Ce-Zt]],W,Ce,[1,1],zn,!0),this},k.__private__.roundedRect=k.roundedRect=function(W,Ce,mt,yt,$t,Zt,zn){if(isNaN(W)||isNaN(Ce)||isNaN(mt)||isNaN(yt)||isNaN($t)||isNaN(Zt)||!Mi(zn))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var Nr=4/3*(Math.SQRT2-1);return $t=Math.min($t,.5*mt),Zt=Math.min(Zt,.5*yt),this.lines([[mt-2*$t,0],[$t*Nr,0,$t,Zt-Zt*Nr,$t,Zt],[0,yt-2*Zt],[0,Zt*Nr,-$t*Nr,Zt,-$t,Zt],[2*$t-mt,0],[-$t*Nr,0,-$t,-Zt*Nr,-$t,-Zt],[0,2*Zt-yt],[0,-Zt*Nr,$t*Nr,-Zt,$t,-Zt]],W+$t,Ce,[1,1],zn,!0),this},k.__private__.ellipse=k.ellipse=function(W,Ce,mt,yt,$t){if(isNaN(W)||isNaN(Ce)||isNaN(mt)||isNaN(yt)||!Mi($t))throw new Error("Invalid arguments passed to jsPDF.ellipse");var Zt=4/3*(Math.SQRT2-1)*mt,zn=4/3*(Math.SQRT2-1)*yt;return yc(W+mt,Ce),Ma(W+mt,Ce-zn,W+Zt,Ce-yt,W,Ce-yt),Ma(W-Zt,Ce-yt,W-mt,Ce-zn,W-mt,Ce),Ma(W-mt,Ce+zn,W-Zt,Ce+yt,W,Ce+yt),Ma(W+Zt,Ce+yt,W+mt,Ce+zn,W+mt,Ce),zi($t),this},k.__private__.circle=k.circle=function(W,Ce,mt,yt){if(isNaN(W)||isNaN(Ce)||isNaN(mt)||!Mi(yt))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(W,Ce,mt,mt,yt)},k.setFont=function(W,Ce,mt){return mt&&(Ce=pe(Ce,mt)),Tr=mn(W,Ce,{disableWarning:!1}),this};var Ps=k.__private__.getFont=k.getFont=function(){return or[mn.apply(k,arguments)]};k.__private__.getFontList=k.getFontList=function(){var W,Ce,mt={};for(W in oi)if(oi.hasOwnProperty(W))for(Ce in mt[W]=[],oi[W])oi[W].hasOwnProperty(Ce)&&mt[W].push(Ce);return mt},k.addFont=function(W,Ce,mt,yt,$t){var Zt=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&Zt.indexOf(arguments[3])!==-1?$t=arguments[3]:arguments[3]&&Zt.indexOf(arguments[3])==-1&&(mt=pe(mt,yt)),wa.call(this,W,Ce,mt,$t=$t||"Identity-H")};var ji,Na=n.lineWidth||.200025,ai=k.__private__.getLineWidth=k.getLineWidth=function(){return Na},Jo=k.__private__.setLineWidth=k.setLineWidth=function(W){return Na=W,ot(U(Z(W))+" w"),this};k.__private__.setLineDash=wi.API.setLineDash=wi.API.setLineDashPattern=function(W,Ce){if(W=W||[],Ce=Ce||0,isNaN(Ce)||!Array.isArray(W))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return W=W.map(function(mt){return U(Z(mt))}).join(" "),Ce=U(Z(Ce)),ot("["+W+"] "+Ce+" d"),this};var Io=k.__private__.getLineHeight=k.getLineHeight=function(){return Ln*ji};k.__private__.getLineHeight=k.getLineHeight=function(){return Ln*ji};var vh=k.__private__.setLineHeightFactor=k.setLineHeightFactor=function(W){return typeof(W=W||1.15)=="number"&&(ji=W),this},Pu=k.__private__.getLineHeightFactor=k.getLineHeightFactor=function(){return ji};vh(n.lineHeight);var vo=k.__private__.getHorizontalCoordinate=function(W){return Z(W)},Us=k.__private__.getVerticalCoordinate=function(W){return ue===me?W:et[Ne].mediaBox.topRightY-et[Ne].mediaBox.bottomLeftY-Z(W)},ku=k.__private__.getHorizontalCoordinateString=k.getHorizontalCoordinateString=function(W){return U(vo(W))},Wo=k.__private__.getVerticalCoordinateString=k.getVerticalCoordinateString=function(W){return U(Us(W))},xo=n.strokeColor||"0 G";k.__private__.getStrokeColor=k.getDrawColor=function(){return Ho(xo)},k.__private__.setStrokeColor=k.setDrawColor=function(W,Ce,mt,yt){return xo=so({ch1:W,ch2:Ce,ch3:mt,ch4:yt,pdfColorType:"draw",precision:2}),ot(xo),this};var zl=n.fillColor||"0 g";k.__private__.getFillColor=k.getFillColor=function(){return Ho(zl)},k.__private__.setFillColor=k.setFillColor=function(W,Ce,mt,yt){return zl=so({ch1:W,ch2:Ce,ch3:mt,ch4:yt,pdfColorType:"fill",precision:2}),ot(zl),this};var Da=n.textColor||"0 g",Vs=k.__private__.getTextColor=k.getTextColor=function(){return Ho(Da)};k.__private__.setTextColor=k.setTextColor=function(W,Ce,mt,yt){return Da=so({ch1:W,ch2:Ce,ch3:mt,ch4:yt,pdfColorType:"text",precision:3}),this};var Bo=n.charSpace,Dc=k.__private__.getCharSpace=k.getCharSpace=function(){return parseFloat(Bo||0)};k.__private__.setCharSpace=k.setCharSpace=function(W){if(isNaN(W))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Bo=W,this};var Ko=0;k.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},k.__private__.setLineCap=k.setLineCap=function(W){var Ce=k.CapJoinStyles[W];if(Ce===void 0)throw new Error("Line cap style of '"+W+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Ko=Ce,ot(Ce+" J"),this};var ga=0;k.__private__.setLineJoin=k.setLineJoin=function(W){var Ce=k.CapJoinStyles[W];if(Ce===void 0)throw new Error("Line join style of '"+W+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return ga=Ce,ot(Ce+" j"),this},k.__private__.setLineMiterLimit=k.__private__.setMiterLimit=k.setLineMiterLimit=k.setMiterLimit=function(W){if(W=W||0,isNaN(W))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return ot(U(Z(W))+" M"),this},k.GState=gv,k.setGState=function(W){(W=typeof W=="string"?si[lt[W]]:Xa(null,W)).equals(Ee)||(ot("/"+W.id+" gs"),Ee=W)};var Xa=function(W,Ce){if(!W||!lt[W]){var mt=!1;for(var yt in si)if(si.hasOwnProperty(yt)&&si[yt].equals(Ce)){mt=!0;break}if(mt)Ce=si[yt];else{var $t="GS"+(Object.keys(si).length+1).toString(10);si[$t]=Ce,Ce.id=$t}return W&&(lt[W]=Ce.id),ht.publish("addGState",Ce),Ce}};k.addGState=function(W,Ce){return Xa(W,Ce),this},k.saveGraphicsState=function(){return ot("q"),Gr.push({key:Tr,size:Ln,color:Da}),this},k.restoreGraphicsState=function(){ot("Q");var W=Gr.pop();return Tr=W.key,Ln=W.size,Da=W.color,Ee=null,this},k.setCurrentTransformationMatrix=function(W){return ot(W.toString()+" cm"),this},k.comment=function(W){return ot("#"+W),this};var ul=function(W,Ce){var mt=W||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return mt},set:function(Zt){isNaN(Zt)||(mt=parseFloat(Zt))}});var yt=Ce||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return yt},set:function(Zt){isNaN(Zt)||(yt=parseFloat(Zt))}});var $t="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return $t},set:function(Zt){$t=Zt.toString()}}),this},Qc=function(W,Ce,mt,yt){ul.call(this,W,Ce),this.type="rect";var $t=mt||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return $t},set:function(zn){isNaN(zn)||($t=parseFloat(zn))}});var Zt=yt||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return Zt},set:function(zn){isNaN(zn)||(Zt=parseFloat(zn))}}),this},_c=function(){this.page=Te,this.currentPage=Ne,this.pages=hn.slice(0),this.pagesContext=et.slice(0),this.x=Pr,this.y=Si,this.matrix=ki,this.width=Ss(Ne),this.height=ia(Ne),this.outputDestination=Mn,this.id="",this.objectNumber=-1};_c.prototype.restore=function(){Te=this.page,Ne=this.currentPage,et=this.pagesContext,hn=this.pages,Pr=this.x,Si=this.y,ki=this.matrix,$s(Ne,this.width),oa(Ne,this.height),Mn=this.outputDestination};var qs=function(W,Ce,mt,yt,$t){At.push(new _c),Te=Ne=0,hn=[],Pr=W,Si=Ce,ki=$t,Ha([mt,yt])};for(var Ai in k.beginFormObject=function(W,Ce,mt,yt,$t){return qs(W,Ce,mt,yt,$t),this},k.endFormObject=function(W){return(function(Ce){if(Ot[Ce])At.pop().restore();else{var mt=new _c,yt="Xo"+(Object.keys(Rt).length+1).toString(10);mt.id=yt,Ot[Ce]=yt,Rt[yt]=mt,ht.publish("addFormObject",mt),At.pop().restore()}})(W),this},k.doFormObject=function(W,Ce){var mt=Rt[Ot[W]];return ot("q"),ot(Ce.toString()+" cm"),ot("/"+mt.id+" Do"),ot("Q"),this},k.getFormObject=function(W){var Ce=Rt[Ot[W]];return{x:Ce.x,y:Ce.y,width:Ce.width,height:Ce.height,matrix:Ce.matrix}},k.save=function(W,Ce){return W=W||"generated.pdf",(Ce=Ce||{}).returnPromise=Ce.returnPromise||!1,Ce.returnPromise===!1?(Km(cl(Ka()),W),typeof Km.unload=="function"&&uo.setTimeout&&setTimeout(Km.unload,911),this):new Promise(function(mt,yt){try{var $t=Km(cl(Ka()),W);typeof Km.unload=="function"&&uo.setTimeout&&setTimeout(Km.unload,911),mt($t)}catch(Zt){yt(Zt.message)}})},wi.API)wi.API.hasOwnProperty(Ai)&&(Ai==="events"&&wi.API.events.length?(function(W,Ce){var mt,yt,$t;for($t=Ce.length-1;$t!==-1;$t--)mt=Ce[$t][0],yt=Ce[$t][1],W.subscribe.apply(W,[mt].concat(typeof yt=="function"?[yt]:yt))})(ht,wi.API.events):k[Ai]=wi.API[Ai]);function Ss(W){return et[W].mediaBox.topRightX-et[W].mediaBox.bottomLeftX}function $s(W,Ce){et[W].mediaBox.topRightX=Ce+et[W].mediaBox.bottomLeftX}function ia(W){return et[W].mediaBox.topRightY-et[W].mediaBox.bottomLeftY}function oa(W,Ce){et[W].mediaBox.topRightY=Ce+et[W].mediaBox.bottomLeftY}var hl=k.getPageWidth=function(W){return Ss(W=W||Ne)/Ir},Gs=k.setPageWidth=function(W,Ce){$s(W,Ce*Ir)},Hs=k.getPageHeight=function(W){return ia(W=W||Ne)/Ir},vc=k.setPageHeight=function(W,Ce){oa(W,Ce*Ir)};return k.internal={pdfEscape:Zo,getStyle:wl,getFont:Ps,getFontSize:Qn,getCharSpace:Dc,getTextColor:Vs,getLineHeight:Io,getLineHeightFactor:Pu,getLineWidth:ai,write:dr,getHorizontalCoordinate:vo,getVerticalCoordinate:Us,getCoordinateString:ku,getVerticalCoordinateString:Wo,collections:{},newObject:Lr,newAdditionalObject:Ei,newObjectDeferred:jr,newObjectDeferredBegin:Er,getFilters:_s,putStream:ao,events:ht,scaleFactor:Ir,pageSize:{getWidth:function(){return hl(Ne)},setWidth:function(W){Gs(Ne,W)},getHeight:function(){return Hs(Ne)},setHeight:function(W){vc(Ne,W)}},encryptionOptions:I,encryption:Br,getEncryptor:function(W){return I!==null?Br.encryptor(W,0):function(Ce){return Ce}},output:Ls,getNumberOfPages:ra,pages:hn,out:ot,f2:j,f3:H,getPageInfo:Mr,getPageInfoByObjId:js,getCurrentPageInfo:Ea,getPDFVersion:se,Point:ul,Rectangle:Qc,Matrix:Pt,hasHotfix:er},Object.defineProperty(k.internal.pageSize,"width",{get:function(){return hl(Ne)},set:function(W){Gs(Ne,W)},enumerable:!0,configurable:!0}),Object.defineProperty(k.internal.pageSize,"height",{get:function(){return Hs(Ne)},set:function(W){vc(Ne,W)},enumerable:!0,configurable:!0}),(function(W){for(var Ce=0,mt=Cr.length;Ce<mt;Ce++){var yt=wa.call(this,W[Ce][0],W[Ce][1],W[Ce][2],Cr[Ce][3],!0);M===!1&&(V[yt]=!0);var $t=W[Ce][0].split("-");fu({id:yt,fontName:$t[0],fontStyle:$t[1]||""})}ht.publish("addFonts",{fonts:or,dictionary:oi})}).call(k,Cr),Tr="F1",Bl(c,t),ht.publish("initialized"),k}n0.prototype.lsbFirstWord=function(n){return String.fromCharCode(255&n,n>>8&255,n>>16&255,n>>24&255)},n0.prototype.toHexString=function(n){return n.split("").map(function(e){return("0"+(255&e.charCodeAt(0)).toString(16)).slice(-2)}).join("")},n0.prototype.hexToBytes=function(n){for(var e=[],t=0;t<n.length;t+=2)e.push(String.fromCharCode(parseInt(n.substr(t,2),16)));return e.join("")},n0.prototype.processOwnerPassword=function(n,e){return E5(S5(e).substr(0,5),n)},n0.prototype.encryptor=function(n,e){var t=S5(this.encryptionKey+String.fromCharCode(255&n,n>>8&255,n>>16&255,255&e,e>>8&255)).substr(0,10);return function(i){return E5(t,i)}},gv.prototype.equals=function(n){var e,t="id,objectNumber,equals";if(!n||xa(n)!==xa(this))return!1;var i=0;for(e in this)if(!(t.indexOf(e)>=0)){if(this.hasOwnProperty(e)&&!n.hasOwnProperty(e)||this[e]!==n[e])return!1;i++}for(e in n)n.hasOwnProperty(e)&&t.indexOf(e)<0&&i--;return i===0},wi.API={events:[]},wi.version="3.0.3";var gc=wi.API,Ew=1,_g=function(n){return n.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Wg=function(n){return n.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},Lo=function(n){return n.toFixed(2)},Hp=function(n){return n.toFixed(5)};gc.__acroform__={};var Xh=function(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n},CS=function(n){return n*Ew},Pf=function(n){var e=new V6,t=pi.internal.getHeight(n)||0,i=pi.internal.getWidth(n)||0;return e.BBox=[0,0,Number(Lo(i)),Number(Lo(t))],e},WR=gc.__acroform__.setBit=function(n,e){if(n=n||0,e=e||0,isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return n|1<<e},KR=gc.__acroform__.clearBit=function(n,e){if(n=n||0,e=e||0,isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return n&~(1<<e)},XR=gc.__acroform__.getBit=function(n,e){if(isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return n&1<<e?1:0},Rc=gc.__acroform__.getBitForPdf=function(n,e){if(isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return XR(n,e-1)},Mc=gc.__acroform__.setBitForPdf=function(n,e){if(isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return WR(n,e-1)},Nc=gc.__acroform__.clearBitForPdf=function(n,e){if(isNaN(n)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return KR(n,e-1)},ZR=gc.__acroform__.calculateCoordinates=function(n,e){var t=e.internal.getHorizontalCoordinate,i=e.internal.getVerticalCoordinate,c=n[0],u=n[1],m=n[2],_=n[3],o={};return o.lowerLeft_X=t(c)||0,o.lowerLeft_Y=i(u+_)||0,o.upperRight_X=t(c+m)||0,o.upperRight_Y=i(u)||0,[Number(Lo(o.lowerLeft_X)),Number(Lo(o.lowerLeft_Y)),Number(Lo(o.upperRight_X)),Number(Lo(o.upperRight_Y))]},YR=function(n){if(n.appearanceStreamContent)return n.appearanceStreamContent;if(n.V||n.DV){var e=[],t=n._V||n.DV,i=A5(n,t),c=n.scope.internal.getFont(n.fontName,n.fontStyle).id;e.push("/Tx BMC"),e.push("q"),e.push("BT"),e.push(n.scope.__private__.encodeColorString(n.color)),e.push("/"+c+" "+Lo(i.fontSize)+" Tf"),e.push("1 0 0 1 0 0 Tm"),e.push(i.text),e.push("ET"),e.push("Q"),e.push("EMC");var u=Pf(n);return u.scope=n.scope,u.stream=e.join(`
`),u}},A5=function(n,e){var t=n.fontSize===0?n.maxFontSize:n.fontSize,i={text:"",fontSize:""},c=(e=(e=e.substr(0,1)=="("?e.substr(1):e).substr(e.length-1)==")"?e.substr(0,e.length-1):e).split(" ");c=n.multiline?c.map(function(j){return j.split(`
`)}):c.map(function(j){return[j]});var u=t,m=pi.internal.getHeight(n)||0;m=m<0?-m:m;var _=pi.internal.getWidth(n)||0;_=_<0?-_:_;var o=function(j,H,Z){if(j+1<c.length){var be=H+" "+c[j+1][0];return _1(be,n,Z).width<=_-4}return!1};u++;e:for(;u>0;){e="",u--;var b,I,M=_1("3",n,u).height,V=n.multiline?m-u:(m-M)/2,k=V+=2,ie=0,se=0,de=0;if(u<=0){e=`(...) Tj
`,e+="% Width of Text: "+_1(e,n,u=12).width+", FieldWidth:"+_+`
`;break}for(var J="",ne=0,me=0;me<c.length;me++)if(c.hasOwnProperty(me)){var ue=!1;if(c[me].length!==1&&de!==c[me].length-1){if((M+2)*(ne+2)+2>m)continue e;J+=c[me][de],ue=!0,se=me,me--}else{J=(J+=c[me][de]+" ").substr(J.length-1)==" "?J.substr(0,J.length-1):J;var ke=parseInt(me),ze=o(ke,J,u),pe=me>=c.length-1;if(ze&&!pe){J+=" ",de=0;continue}if(ze||pe){if(pe)se=ke;else if(n.multiline&&(M+2)*(ne+2)+2>m)continue e}else{if(!n.multiline||(M+2)*(ne+2)+2>m)continue e;se=ke}}for(var U="",F=ie;F<=se;F++){var q=c[F];if(n.multiline){if(F===se){U+=q[de]+" ",de=(de+1)%q.length;continue}if(F===ie){U+=q[q.length-1]+" ";continue}}U+=q[0]+" "}switch(U=U.substr(U.length-1)==" "?U.substr(0,U.length-1):U,I=_1(U,n,u).width,n.textAlign){case"right":b=_-I-2;break;case"center":b=(_-I)/2;break;default:b=2}e+=Lo(b)+" "+Lo(k)+` Td
`,e+="("+_g(U)+`) Tj
`,e+=-Lo(b)+` 0 Td
`,k=-(u+2),I=0,ie=ue?se:se+1,ne++,J=""}break}return i.text=e,i.fontSize=u,i},_1=function(n,e,t){var i=e.scope.internal.getFont(e.fontName,e.fontStyle),c=e.scope.getStringUnitWidth(n,{font:i,fontSize:parseFloat(t),charSpace:0})*parseFloat(t);return{height:e.scope.getStringUnitWidth("3",{font:i,fontSize:parseFloat(t),charSpace:0})*parseFloat(t)*1.5,width:c}},JR={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},QR=function(n,e){var t={type:"reference",object:n};e.internal.getPageInfo(n.page).pageContext.annotations.find(function(i){return i.type===t.type&&i.object===t.object})===void 0&&e.internal.getPageInfo(n.page).pageContext.annotations.push(t)},eM=function(n,e){if(e.scope=n,n.internal!==void 0&&(n.internal.acroformPlugin===void 0||n.internal.acroformPlugin.isInitialized===!1)){if(uf.FieldNum=0,n.internal.acroformPlugin=JSON.parse(JSON.stringify(JR)),n.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");Ew=n.internal.scaleFactor,n.internal.acroformPlugin.acroFormDictionaryRoot=new q6,n.internal.acroformPlugin.acroFormDictionaryRoot.scope=n,n.internal.acroformPlugin.acroFormDictionaryRoot._eventID=n.internal.events.subscribe("postPutResources",function(){(function(t){t.internal.events.unsubscribe(t.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete t.internal.acroformPlugin.acroFormDictionaryRoot._eventID,t.internal.acroformPlugin.printedOut=!0})(n)}),n.internal.events.subscribe("buildDocument",function(){(function(t){t.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var i=t.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var c in i)if(i.hasOwnProperty(c)){var u=i[c];u.objId=void 0,u.hasAnnotation&&QR(u,t)}})(n)}),n.internal.events.subscribe("putCatalog",function(){(function(t){if(t.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");t.internal.write("/AcroForm "+t.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(n)}),n.internal.events.subscribe("postPutPages",function(t){(function(i,c){var u=!i;for(var m in i||(c.internal.newObjectDeferredBegin(c.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),c.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),i=i||c.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(i.hasOwnProperty(m)){var _=i[m],o=[],b=_.Rect;if(_.Rect&&(_.Rect=ZR(_.Rect,c)),c.internal.newObjectDeferredBegin(_.objId,!0),_.DA=pi.createDefaultAppearanceStream(_),xa(_)==="object"&&typeof _.getKeyValueListForStream=="function"&&(o=_.getKeyValueListForStream()),_.Rect=b,_.hasAppearanceStream&&!_.appearanceStreamContent){var I=YR(_);o.push({key:"AP",value:"<</N "+I+">>"}),c.internal.acroformPlugin.xForms.push(I)}if(_.appearanceStreamContent){var M="";for(var V in _.appearanceStreamContent)if(_.appearanceStreamContent.hasOwnProperty(V)){var k=_.appearanceStreamContent[V];if(M+="/"+V+" ",M+="<<",Object.keys(k).length>=1||Array.isArray(k)){for(var m in k)if(k.hasOwnProperty(m)){var ie=k[m];typeof ie=="function"&&(ie=ie.call(c,_)),M+="/"+m+" "+ie+" ",c.internal.acroformPlugin.xForms.indexOf(ie)>=0||c.internal.acroformPlugin.xForms.push(ie)}}else typeof(ie=k)=="function"&&(ie=ie.call(c,_)),M+="/"+m+" "+ie,c.internal.acroformPlugin.xForms.indexOf(ie)>=0||c.internal.acroformPlugin.xForms.push(ie);M+=">>"}o.push({key:"AP",value:`<<
`+M+">>"})}c.internal.putStream({additionalKeyValues:o,objectId:_.objId}),c.internal.out("endobj")}u&&(function(se,de){for(var J in se)if(se.hasOwnProperty(J)){var ne=J,me=se[J];de.internal.newObjectDeferredBegin(me.objId,!0),xa(me)==="object"&&typeof me.putStream=="function"&&me.putStream(),delete se[ne]}})(c.internal.acroformPlugin.xForms,c)})(t,n)}),n.internal.acroformPlugin.isInitialized=!0}},U6=gc.__acroform__.arrayToPdfArray=function(n,e,t){var i=function(m){return m};if(Array.isArray(n)){for(var c="[",u=0;u<n.length;u++)switch(u!==0&&(c+=" "),xa(n[u])){case"boolean":case"number":case"object":c+=n[u].toString();break;case"string":n[u].substr(0,1)!=="/"?(e!==void 0&&t&&(i=t.internal.getEncryptor(e)),c+="("+_g(i(n[u].toString()))+")"):c+=n[u].toString()}return c+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},Pb=function(n,e,t){var i=function(c){return c};return e!==void 0&&t&&(i=t.internal.getEncryptor(e)),(n=n||"").toString(),"("+_g(i(n))+")"},zf=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(n){this._objId=n}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};zf.prototype.toString=function(){return this.objId+" 0 R"},zf.prototype.putStream=function(){var n=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:n,objectId:this.objId}),this.scope.internal.out("endobj")},zf.prototype.getKeyValueListForStream=function(){var n=[],e=Object.getOwnPropertyNames(this).filter(function(u){return u!="content"&&u!="appearanceStreamContent"&&u!="scope"&&u!="objId"&&u.substring(0,1)!="_"});for(var t in e)if(Object.getOwnPropertyDescriptor(this,e[t]).configurable===!1){var i=e[t],c=this[i];c&&(Array.isArray(c)?n.push({key:i,value:U6(c,this.objId,this.scope)}):c instanceof zf?(c.scope=this.scope,n.push({key:i,value:c.objId+" 0 R"})):typeof c!="function"&&n.push({key:i,value:c}))}return n};var V6=function(){zf.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var n,e=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(t){n=t.trim()},get:function(){return n||null}})};Xh(V6,zf);var q6=function(){zf.call(this);var n,e=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return e.length>0?e:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return e}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(n){var t=function(i){return i};return this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),"("+_g(t(n))+")"}},set:function(t){n=t}})};Xh(q6,zf);var uf=function n(){zf.call(this);var e=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return e},set:function(J){if(isNaN(J))throw new Error('Invalid value "'+J+'" for attribute F supplied.');e=J}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!Rc(e,3)},set:function(J){J?this.F=Mc(e,3):this.F=Nc(e,3)}});var t=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return t},set:function(J){if(isNaN(J))throw new Error('Invalid value "'+J+'" for attribute Ff supplied.');t=J}});var i=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(i.length!==0)return i},set:function(J){i=J!==void 0?J:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[0])?0:i[0]},set:function(J){i[0]=J}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[1])?0:i[1]},set:function(J){i[1]=J}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[2])?0:i[2]},set:function(J){i[2]=J}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[3])?0:i[3]},set:function(J){i[3]=J}});var c="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return c},set:function(J){switch(J){case"/Btn":case"/Tx":case"/Ch":case"/Sig":c=J;break;default:throw new Error('Invalid value "'+J+'" for attribute FT supplied.')}}});var u=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!u||u.length<1){if(this instanceof yv)return;u="FieldObject"+n.FieldNum++}var J=function(ne){return ne};return this.scope&&(J=this.scope.internal.getEncryptor(this.objId)),"("+_g(J(u))+")"},set:function(J){u=J.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return u},set:function(J){u=J}});var m="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return m},set:function(J){m=J}});var _="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return _},set:function(J){_=J}});var o=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return o},set:function(J){o=J}});var b=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return b===void 0?50/Ew:b},set:function(J){b=J}});var I="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return I},set:function(J){I=J}});var M="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!M||this instanceof yv||this instanceof rg))return Pb(M,this.objId,this.scope)},set:function(J){J=J.toString(),M=J}});var V=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(V)return this instanceof Iu==0?Pb(V,this.objId,this.scope):V},set:function(J){J=J.toString(),V=this instanceof Iu==0?J.substr(0,1)==="("?Wg(J.substr(1,J.length-2)):Wg(J):J}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Iu==1?Wg(V.substr(1,V.length-1)):V},set:function(J){J=J.toString(),V=this instanceof Iu==1?"/"+J:J}});var k=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(k)return k},set:function(J){this.V=J}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(k)return this instanceof Iu==0?Pb(k,this.objId,this.scope):k},set:function(J){J=J.toString(),k=this instanceof Iu==0?J.substr(0,1)==="("?Wg(J.substr(1,J.length-2)):Wg(J):J}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Iu==1?Wg(k.substr(1,k.length-1)):k},set:function(J){J=J.toString(),k=this instanceof Iu==1?"/"+J:J}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var ie,se=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return se},set:function(J){J=!!J,se=J}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(ie)return ie},set:function(J){ie=J}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!Rc(this.Ff,1)},set:function(J){J?this.Ff=Mc(this.Ff,1):this.Ff=Nc(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!Rc(this.Ff,2)},set:function(J){J?this.Ff=Mc(this.Ff,2):this.Ff=Nc(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!Rc(this.Ff,3)},set:function(J){J?this.Ff=Mc(this.Ff,3):this.Ff=Nc(this.Ff,3)}});var de=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(de!==null)return de},set:function(J){if([0,1,2].indexOf(J)===-1)throw new Error('Invalid value "'+J+'" for attribute Q supplied.');de=J}}),Object.defineProperty(this,"textAlign",{get:function(){var J;switch(de){case 0:default:J="left";break;case 1:J="center";break;case 2:J="right"}return J},configurable:!0,enumerable:!0,set:function(J){switch(J){case"right":case 2:de=2;break;case"center":case 1:de=1;break;default:de=0}}})};Xh(uf,zf);var m0=function(){uf.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var n=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return n},set:function(t){n=t}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return n},set:function(t){n=t}});var e=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return U6(e,this.objId,this.scope)},set:function(t){var i,c;c=[],typeof(i=t)=="string"&&(c=(function(u,m,_){_||(_=1);for(var o,b=[];o=m.exec(u);)b.push(o[_]);return b})(i,/\((.*?)\)/g)),e=c}}),this.getOptions=function(){return e},this.setOptions=function(t){e=t,this.sort&&e.sort()},this.addOption=function(t){t=(t=t||"").toString(),e.push(t),this.sort&&e.sort()},this.removeOption=function(t,i){for(i=i||!1,t=(t=t||"").toString();e.indexOf(t)!==-1&&(e.splice(e.indexOf(t),1),i!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!Rc(this.Ff,18)},set:function(t){t?this.Ff=Mc(this.Ff,18):this.Ff=Nc(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!Rc(this.Ff,19)},set:function(t){this.combo===!0&&(t?this.Ff=Mc(this.Ff,19):this.Ff=Nc(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!Rc(this.Ff,20)},set:function(t){t?(this.Ff=Mc(this.Ff,20),e.sort()):this.Ff=Nc(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!Rc(this.Ff,22)},set:function(t){t?this.Ff=Mc(this.Ff,22):this.Ff=Nc(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Rc(this.Ff,23)},set:function(t){t?this.Ff=Mc(this.Ff,23):this.Ff=Nc(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!Rc(this.Ff,27)},set:function(t){t?this.Ff=Mc(this.Ff,27):this.Ff=Nc(this.Ff,27)}}),this.hasAppearanceStream=!1};Xh(m0,uf);var g0=function(){m0.call(this),this.fontName="helvetica",this.combo=!1};Xh(g0,m0);var y0=function(){g0.call(this),this.combo=!0};Xh(y0,g0);var V1=function(){y0.call(this),this.edit=!0};Xh(V1,y0);var Iu=function(){uf.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!Rc(this.Ff,15)},set:function(t){t?this.Ff=Mc(this.Ff,15):this.Ff=Nc(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!Rc(this.Ff,16)},set:function(t){t?this.Ff=Mc(this.Ff,16):this.Ff=Nc(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!Rc(this.Ff,17)},set:function(t){t?this.Ff=Mc(this.Ff,17):this.Ff=Nc(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!Rc(this.Ff,26)},set:function(t){t?this.Ff=Mc(this.Ff,26):this.Ff=Nc(this.Ff,26)}});var n,e={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var t=function(u){return u};if(this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),Object.keys(e).length!==0){var i,c=[];for(i in c.push("<<"),e)c.push("/"+i+" ("+_g(t(e[i]))+")");return c.push(">>"),c.join(`
`)}},set:function(t){xa(t)==="object"&&(e=t)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return e.CA||""},set:function(t){typeof t=="string"&&(e.CA=t)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return n},set:function(t){n=t}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return n.substr(1,n.length-1)},set:function(t){n="/"+t}})};Xh(Iu,uf);var q1=function(){Iu.call(this),this.pushButton=!0};Xh(q1,Iu);var _0=function(){Iu.call(this),this.radio=!0,this.pushButton=!1;var n=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return n},set:function(e){n=e!==void 0?e:[]}})};Xh(_0,Iu);var yv=function(){var n,e;uf.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return n},set:function(c){n=c}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return e},set:function(c){e=c}});var t,i={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var c=function(_){return _};this.scope&&(c=this.scope.internal.getEncryptor(this.objId));var u,m=[];for(u in m.push("<<"),i)m.push("/"+u+" ("+_g(c(i[u]))+")");return m.push(">>"),m.join(`
`)},set:function(c){xa(c)==="object"&&(i=c)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return i.CA||""},set:function(c){typeof c=="string"&&(i.CA=c)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return t},set:function(c){t=c}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return t.substr(1,t.length-1)},set:function(c){t="/"+c}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=pi.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};Xh(yv,uf),_0.prototype.setAppearance=function(n){if(!("createAppearanceStream"in n)||!("getCA"in n))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var e in this.Kids)if(this.Kids.hasOwnProperty(e)){var t=this.Kids[e];t.appearanceStreamContent=n.createAppearanceStream(t.optionName),t.caption=n.getCA()}},_0.prototype.createOption=function(n){var e=new yv;return e.Parent=this,e.optionName=n,this.Kids.push(e),tM.call(this.scope,e),e};var $1=function(){Iu.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=pi.CheckBox.createAppearanceStream()};Xh($1,Iu);var rg=function(){uf.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!Rc(this.Ff,13)},set:function(e){e?this.Ff=Mc(this.Ff,13):this.Ff=Nc(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!Rc(this.Ff,21)},set:function(e){e?this.Ff=Mc(this.Ff,21):this.Ff=Nc(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Rc(this.Ff,23)},set:function(e){e?this.Ff=Mc(this.Ff,23):this.Ff=Nc(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!Rc(this.Ff,24)},set:function(e){e?this.Ff=Mc(this.Ff,24):this.Ff=Nc(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!Rc(this.Ff,25)},set:function(e){e?this.Ff=Mc(this.Ff,25):this.Ff=Nc(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!Rc(this.Ff,26)},set:function(e){e?this.Ff=Mc(this.Ff,26):this.Ff=Nc(this.Ff,26)}});var n=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return n},set:function(e){n=e}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return n},set:function(e){Number.isInteger(e)&&(n=e)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};Xh(rg,uf);var G1=function(){rg.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!Rc(this.Ff,14)},set:function(n){n?this.Ff=Mc(this.Ff,14):this.Ff=Nc(this.Ff,14)}}),this.password=!0};Xh(G1,rg);var pi={CheckBox:{createAppearanceStream:function(){return{N:{On:pi.CheckBox.YesNormal},D:{On:pi.CheckBox.YesPushDown,Off:pi.CheckBox.OffPushDown}}},YesPushDown:function(n){var e=Pf(n);e.scope=n.scope;var t=[],i=n.scope.internal.getFont(n.fontName,n.fontStyle).id,c=n.scope.__private__.encodeColorString(n.color),u=A5(n,n.caption);return t.push("0.749023 g"),t.push("0 0 "+Lo(pi.internal.getWidth(n))+" "+Lo(pi.internal.getHeight(n))+" re"),t.push("f"),t.push("BMC"),t.push("q"),t.push("0 0 1 rg"),t.push("/"+i+" "+Lo(u.fontSize)+" Tf "+c),t.push("BT"),t.push(u.text),t.push("ET"),t.push("Q"),t.push("EMC"),e.stream=t.join(`
`),e},YesNormal:function(n){var e=Pf(n);e.scope=n.scope;var t=n.scope.internal.getFont(n.fontName,n.fontStyle).id,i=n.scope.__private__.encodeColorString(n.color),c=[],u=pi.internal.getHeight(n),m=pi.internal.getWidth(n),_=A5(n,n.caption);return c.push("1 g"),c.push("0 0 "+Lo(m)+" "+Lo(u)+" re"),c.push("f"),c.push("q"),c.push("0 0 1 rg"),c.push("0 0 "+Lo(m-1)+" "+Lo(u-1)+" re"),c.push("W"),c.push("n"),c.push("0 g"),c.push("BT"),c.push("/"+t+" "+Lo(_.fontSize)+" Tf "+i),c.push(_.text),c.push("ET"),c.push("Q"),e.stream=c.join(`
`),e},OffPushDown:function(n){var e=Pf(n);e.scope=n.scope;var t=[];return t.push("0.749023 g"),t.push("0 0 "+Lo(pi.internal.getWidth(n))+" "+Lo(pi.internal.getHeight(n))+" re"),t.push("f"),e.stream=t.join(`
`),e}},RadioButton:{Circle:{createAppearanceStream:function(n){var e={D:{Off:pi.RadioButton.Circle.OffPushDown},N:{}};return e.N[n]=pi.RadioButton.Circle.YesNormal,e.D[n]=pi.RadioButton.Circle.YesPushDown,e},getCA:function(){return"l"},YesNormal:function(n){var e=Pf(n);e.scope=n.scope;var t=[],i=pi.internal.getWidth(n)<=pi.internal.getHeight(n)?pi.internal.getWidth(n)/4:pi.internal.getHeight(n)/4;i=Number((.9*i).toFixed(5));var c=pi.internal.Bezier_C,u=Number((i*c).toFixed(5));return t.push("q"),t.push("1 0 0 1 "+Hp(pi.internal.getWidth(n)/2)+" "+Hp(pi.internal.getHeight(n)/2)+" cm"),t.push(i+" 0 m"),t.push(i+" "+u+" "+u+" "+i+" 0 "+i+" c"),t.push("-"+u+" "+i+" -"+i+" "+u+" -"+i+" 0 c"),t.push("-"+i+" -"+u+" -"+u+" -"+i+" 0 -"+i+" c"),t.push(u+" -"+i+" "+i+" -"+u+" "+i+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e},YesPushDown:function(n){var e=Pf(n);e.scope=n.scope;var t=[],i=pi.internal.getWidth(n)<=pi.internal.getHeight(n)?pi.internal.getWidth(n)/4:pi.internal.getHeight(n)/4;i=Number((.9*i).toFixed(5));var c=Number((2*i).toFixed(5)),u=Number((c*pi.internal.Bezier_C).toFixed(5)),m=Number((i*pi.internal.Bezier_C).toFixed(5));return t.push("0.749023 g"),t.push("q"),t.push("1 0 0 1 "+Hp(pi.internal.getWidth(n)/2)+" "+Hp(pi.internal.getHeight(n)/2)+" cm"),t.push(c+" 0 m"),t.push(c+" "+u+" "+u+" "+c+" 0 "+c+" c"),t.push("-"+u+" "+c+" -"+c+" "+u+" -"+c+" 0 c"),t.push("-"+c+" -"+u+" -"+u+" -"+c+" 0 -"+c+" c"),t.push(u+" -"+c+" "+c+" -"+u+" "+c+" 0 c"),t.push("f"),t.push("Q"),t.push("0 g"),t.push("q"),t.push("1 0 0 1 "+Hp(pi.internal.getWidth(n)/2)+" "+Hp(pi.internal.getHeight(n)/2)+" cm"),t.push(i+" 0 m"),t.push(i+" "+m+" "+m+" "+i+" 0 "+i+" c"),t.push("-"+m+" "+i+" -"+i+" "+m+" -"+i+" 0 c"),t.push("-"+i+" -"+m+" -"+m+" -"+i+" 0 -"+i+" c"),t.push(m+" -"+i+" "+i+" -"+m+" "+i+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e},OffPushDown:function(n){var e=Pf(n);e.scope=n.scope;var t=[],i=pi.internal.getWidth(n)<=pi.internal.getHeight(n)?pi.internal.getWidth(n)/4:pi.internal.getHeight(n)/4;i=Number((.9*i).toFixed(5));var c=Number((2*i).toFixed(5)),u=Number((c*pi.internal.Bezier_C).toFixed(5));return t.push("0.749023 g"),t.push("q"),t.push("1 0 0 1 "+Hp(pi.internal.getWidth(n)/2)+" "+Hp(pi.internal.getHeight(n)/2)+" cm"),t.push(c+" 0 m"),t.push(c+" "+u+" "+u+" "+c+" 0 "+c+" c"),t.push("-"+u+" "+c+" -"+c+" "+u+" -"+c+" 0 c"),t.push("-"+c+" -"+u+" -"+u+" -"+c+" 0 -"+c+" c"),t.push(u+" -"+c+" "+c+" -"+u+" "+c+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e}},Cross:{createAppearanceStream:function(n){var e={D:{Off:pi.RadioButton.Cross.OffPushDown},N:{}};return e.N[n]=pi.RadioButton.Cross.YesNormal,e.D[n]=pi.RadioButton.Cross.YesPushDown,e},getCA:function(){return"8"},YesNormal:function(n){var e=Pf(n);e.scope=n.scope;var t=[],i=pi.internal.calculateCross(n);return t.push("q"),t.push("1 1 "+Lo(pi.internal.getWidth(n)-2)+" "+Lo(pi.internal.getHeight(n)-2)+" re"),t.push("W"),t.push("n"),t.push(Lo(i.x1.x)+" "+Lo(i.x1.y)+" m"),t.push(Lo(i.x2.x)+" "+Lo(i.x2.y)+" l"),t.push(Lo(i.x4.x)+" "+Lo(i.x4.y)+" m"),t.push(Lo(i.x3.x)+" "+Lo(i.x3.y)+" l"),t.push("s"),t.push("Q"),e.stream=t.join(`
`),e},YesPushDown:function(n){var e=Pf(n);e.scope=n.scope;var t=pi.internal.calculateCross(n),i=[];return i.push("0.749023 g"),i.push("0 0 "+Lo(pi.internal.getWidth(n))+" "+Lo(pi.internal.getHeight(n))+" re"),i.push("f"),i.push("q"),i.push("1 1 "+Lo(pi.internal.getWidth(n)-2)+" "+Lo(pi.internal.getHeight(n)-2)+" re"),i.push("W"),i.push("n"),i.push(Lo(t.x1.x)+" "+Lo(t.x1.y)+" m"),i.push(Lo(t.x2.x)+" "+Lo(t.x2.y)+" l"),i.push(Lo(t.x4.x)+" "+Lo(t.x4.y)+" m"),i.push(Lo(t.x3.x)+" "+Lo(t.x3.y)+" l"),i.push("s"),i.push("Q"),e.stream=i.join(`
`),e},OffPushDown:function(n){var e=Pf(n);e.scope=n.scope;var t=[];return t.push("0.749023 g"),t.push("0 0 "+Lo(pi.internal.getWidth(n))+" "+Lo(pi.internal.getHeight(n))+" re"),t.push("f"),e.stream=t.join(`
`),e}}},createDefaultAppearanceStream:function(n){var e=n.scope.internal.getFont(n.fontName,n.fontStyle).id,t=n.scope.__private__.encodeColorString(n.color);return"/"+e+" "+n.fontSize+" Tf "+t}};pi.internal={Bezier_C:.551915024494,calculateCross:function(n){var e=pi.internal.getWidth(n),t=pi.internal.getHeight(n),i=Math.min(e,t);return{x1:{x:(e-i)/2,y:(t-i)/2+i},x2:{x:(e-i)/2+i,y:(t-i)/2},x3:{x:(e-i)/2,y:(t-i)/2},x4:{x:(e-i)/2+i,y:(t-i)/2+i}}}},pi.internal.getWidth=function(n){var e=0;return xa(n)==="object"&&(e=CS(n.Rect[2])),e},pi.internal.getHeight=function(n){var e=0;return xa(n)==="object"&&(e=CS(n.Rect[3])),e};var tM=gc.addField=function(n){if(eM(this,n),!(n instanceof uf))throw new Error("Invalid argument passed to jsPDF.addField.");var e;return(e=n).scope.internal.acroformPlugin.printedOut&&(e.scope.internal.acroformPlugin.printedOut=!1,e.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),e.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(e),n.page=n.scope.internal.getCurrentPageInfo().pageNumber,this};gc.AcroFormChoiceField=m0,gc.AcroFormListBox=g0,gc.AcroFormComboBox=y0,gc.AcroFormEditBox=V1,gc.AcroFormButton=Iu,gc.AcroFormPushButton=q1,gc.AcroFormRadioButton=_0,gc.AcroFormCheckBox=$1,gc.AcroFormTextField=rg,gc.AcroFormPasswordField=G1,gc.AcroFormAppearance=pi,gc.AcroForm={ChoiceField:m0,ListBox:g0,ComboBox:y0,EditBox:V1,Button:Iu,PushButton:q1,RadioButton:_0,CheckBox:$1,TextField:rg,PasswordField:G1,Appearance:pi},wi.AcroForm={ChoiceField:m0,ListBox:g0,ComboBox:y0,EditBox:V1,Button:Iu,PushButton:q1,RadioButton:_0,CheckBox:$1,TextField:rg,PasswordField:G1,Appearance:pi};wi.AcroForm;function $6(n){return n.reduce(function(e,t,i){return e[t]=i,e},{})}(function(n){var e="addImage_";n.__addimage__={};var t="UNKNOWN",i={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},c=n.__addimage__.getImageFileTypeByImageData=function(j,H){var Z,be,Re,Oe,Me,we=t;if((H=H||t)==="RGBA"||j.data!==void 0&&j.data instanceof Uint8ClampedArray&&"height"in j&&"width"in j)return"RGBA";if(ze(j))for(Me in i)for(Re=i[Me],Z=0;Z<Re.length;Z+=1){for(Oe=!0,be=0;be<Re[Z].length;be+=1)if(Re[Z][be]!==void 0&&Re[Z][be]!==j[be]){Oe=!1;break}if(Oe===!0){we=Me;break}}else for(Me in i)for(Re=i[Me],Z=0;Z<Re.length;Z+=1){for(Oe=!0,be=0;be<Re[Z].length;be+=1)if(Re[Z][be]!==void 0&&Re[Z][be]!==j.charCodeAt(be)){Oe=!1;break}if(Oe===!0){we=Me;break}}return we===t&&H!==t&&(we=H),we},u=function j(H){for(var Z=this.internal.write,be=this.internal.putStream,Re=(0,this.internal.getFilters)();Re.indexOf("FlateEncode")!==-1;)Re.splice(Re.indexOf("FlateEncode"),1);H.objectId=this.internal.newObject();var Oe=[];if(Oe.push({key:"Type",value:"/XObject"}),Oe.push({key:"Subtype",value:"/Image"}),Oe.push({key:"Width",value:H.width}),Oe.push({key:"Height",value:H.height}),H.colorSpace===J.INDEXED?Oe.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(H.palette.length/3-1)+" "+("sMask"in H&&H.sMask!==void 0?H.objectId+2:H.objectId+1)+" 0 R]"}):(Oe.push({key:"ColorSpace",value:"/"+H.colorSpace}),H.colorSpace===J.DEVICE_CMYK&&Oe.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),Oe.push({key:"BitsPerComponent",value:H.bitsPerComponent}),"decodeParameters"in H&&H.decodeParameters!==void 0&&Oe.push({key:"DecodeParms",value:"<<"+H.decodeParameters+">>"}),"transparency"in H&&Array.isArray(H.transparency)&&H.transparency.length>0){for(var Me="",we=0,De=H.transparency.length;we<De;we++)Me+=H.transparency[we]+" "+H.transparency[we]+" ";Oe.push({key:"Mask",value:"["+Me+"]"})}H.sMask!==void 0&&Oe.push({key:"SMask",value:H.objectId+1+" 0 R"});var tt=H.filter!==void 0?["/"+H.filter]:void 0;if(be({data:H.data,additionalKeyValues:Oe,alreadyAppliedFilters:tt,objectId:H.objectId}),Z("endobj"),"sMask"in H&&H.sMask!==void 0){var xe,le=(xe=H.sMaskBitsPerComponent)!==null&&xe!==void 0?xe:H.bitsPerComponent,Ne={width:H.width,height:H.height,colorSpace:"DeviceGray",bitsPerComponent:le,data:H.sMask};"filter"in H&&(Ne.decodeParameters="/Predictor ".concat(H.predictor," /Colors 1 /BitsPerComponent ").concat(le," /Columns ").concat(H.width),Ne.filter=H.filter),j.call(this,Ne)}if(H.colorSpace===J.INDEXED){var Be=this.internal.newObject();be({data:U(new Uint8Array(H.palette)),objectId:Be}),Z("endobj")}},m=function(){var j=this.internal.collections[e+"images"];for(var H in j)u.call(this,j[H])},_=function(){var j,H=this.internal.collections[e+"images"],Z=this.internal.write;for(var be in H)Z("/I"+(j=H[be]).index,j.objectId,"0","R")},o=function(){this.internal.collections[e+"images"]||(this.internal.collections[e+"images"]={},this.internal.events.subscribe("putResources",m),this.internal.events.subscribe("putXobjectDict",_))},b=function(){var j=this.internal.collections[e+"images"];return o.call(this),j},I=function(){return Object.keys(this.internal.collections[e+"images"]).length},M=function(j){return typeof n["process"+j.toUpperCase()]=="function"},V=function(j){return xa(j)==="object"&&j.nodeType===1},k=function(j,H){if(j.nodeName==="IMG"&&j.hasAttribute("src")){var Z=""+j.getAttribute("src");if(Z.indexOf("data:image/")===0)return U1(unescape(Z).split("base64,").pop());var be=n.loadFile(Z,!0);if(be!==void 0)return be}if(j.nodeName==="CANVAS"){if(j.width===0||j.height===0)throw new Error("Given canvas must have data. Canvas width: "+j.width+", height: "+j.height);var Re;switch(H){case"PNG":Re="image/png";break;case"WEBP":Re="image/webp";break;default:Re="image/jpeg"}return U1(j.toDataURL(Re,1).split("base64,").pop())}},ie=function(j){var H=this.internal.collections[e+"images"];if(H){for(var Z in H)if(j===H[Z].alias)return H[Z]}},se=function(j,H,Z){return j||H||(j=-96,H=-96),j<0&&(j=-1*Z.width*72/j/this.internal.scaleFactor),H<0&&(H=-1*Z.height*72/H/this.internal.scaleFactor),j===0&&(j=H*Z.width/Z.height),H===0&&(H=j*Z.height/Z.width),[j,H]},de=function(j,H,Z,be,Re,Oe){var Me=se.call(this,Z,be,Re),we=this.internal.getCoordinateString,De=this.internal.getVerticalCoordinateString,tt=b.call(this);if(Z=Me[0],be=Me[1],tt[Re.index]=Re,Oe){Oe*=Math.PI/180;var xe=Math.cos(Oe),le=Math.sin(Oe),Ne=function(Qe){return Qe.toFixed(4)},Be=[Ne(xe),Ne(le),Ne(-1*le),Ne(xe),0,0,"cm"]}this.internal.write("q"),Oe?(this.internal.write([1,"0","0",1,we(j),De(H+be),"cm"].join(" ")),this.internal.write(Be.join(" ")),this.internal.write([we(Z),"0","0",we(be),"0","0","cm"].join(" "))):this.internal.write([we(Z),"0","0",we(be),we(j),De(H+be),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+Re.index+" Do"),this.internal.write("Q")},J=n.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};n.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var ne=n.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},me=n.__addimage__.sHashCode=function(j){var H,Z,be=0;if(typeof j=="string")for(Z=j.length,H=0;H<Z;H++)be=(be<<5)-be+j.charCodeAt(H),be|=0;else if(ze(j))for(Z=j.byteLength/2,H=0;H<Z;H++)be=(be<<5)-be+j[H],be|=0;return be},ue=n.__addimage__.validateStringAsBase64=function(j){(j=j||"").toString().trim();var H=!0;return j.length===0&&(H=!1),j.length%4!=0&&(H=!1),/^[A-Za-z0-9+/]+$/.test(j.substr(0,j.length-2))===!1&&(H=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(j.substr(-2))===!1&&(H=!1),H},ke=n.__addimage__.extractImageFromDataUrl=function(j){if(j==null||!(j=j.trim()).startsWith("data:"))return null;var H=j.indexOf(",");return H<0?null:j.substring(0,H).trim().endsWith("base64")?j.substring(H+1):null};n.__addimage__.isArrayBuffer=function(j){return j instanceof ArrayBuffer};var ze=n.__addimage__.isArrayBufferView=function(j){return j instanceof Int8Array||j instanceof Uint8Array||j instanceof Uint8ClampedArray||j instanceof Int16Array||j instanceof Uint16Array||j instanceof Int32Array||j instanceof Uint32Array||j instanceof Float32Array||j instanceof Float64Array},pe=n.__addimage__.binaryStringToUint8Array=function(j){for(var H=j.length,Z=new Uint8Array(H),be=0;be<H;be++)Z[be]=j.charCodeAt(be);return Z},U=n.__addimage__.arrayBufferToBinaryString=function(j){for(var H="",Z=ze(j)?j:new Uint8Array(j),be=0;be<Z.length;be+=8192)H+=String.fromCharCode.apply(null,Z.subarray(be,be+8192));return H};n.addImage=function(){var j,H,Z,be,Re,Oe,Me,we,De;if(typeof arguments[1]=="number"?(H=t,Z=arguments[1],be=arguments[2],Re=arguments[3],Oe=arguments[4],Me=arguments[5],we=arguments[6],De=arguments[7]):(H=arguments[1],Z=arguments[2],be=arguments[3],Re=arguments[4],Oe=arguments[5],Me=arguments[6],we=arguments[7],De=arguments[8]),xa(j=arguments[0])==="object"&&!V(j)&&"imageData"in j){var tt=j;j=tt.imageData,H=tt.format||H||t,Z=tt.x||Z||0,be=tt.y||be||0,Re=tt.w||tt.width||Re,Oe=tt.h||tt.height||Oe,Me=tt.alias||Me,we=tt.compression||we,De=tt.rotation||tt.angle||De}var xe=this.internal.getFilters();if(we===void 0&&xe.indexOf("FlateEncode")!==-1&&(we="SLOW"),isNaN(Z)||isNaN(be))throw new Error("Invalid coordinates passed to jsPDF.addImage");o.call(this);var le=F.call(this,j,H,Me,we);return de.call(this,Z,be,Re,Oe,le,De),this};var F=function(j,H,Z,be){var Re,Oe,Me;if(typeof j=="string"&&c(j)===t){j=unescape(j);var we=q(j,!1);(we!==""||(we=n.loadFile(j,!0))!==void 0)&&(j=we)}if(V(j)&&(j=k(j,H)),H=c(j,H),!M(H))throw new Error("addImage does not support files of type '"+H+"', please ensure that a plugin for '"+H+"' support is added.");if(((Me=Z)==null||Me.length===0)&&(Z=(function(De){return typeof De=="string"||ze(De)?me(De):ze(De.data)?me(De.data):null})(j)),(Re=ie.call(this,Z))||(j instanceof Uint8Array||H==="RGBA"||(Oe=j,j=pe(j)),Re=this["process"+H.toUpperCase()](j,I.call(this),Z,(function(De){return De&&typeof De=="string"&&(De=De.toUpperCase()),De in n.image_compression?De:ne.NONE})(be),Oe)),!Re)throw new Error("An unknown error occurred whilst processing the image.");return Re},q=n.__addimage__.convertBase64ToBinaryString=function(j,H){H=typeof H!="boolean"||H;var Z,be="";if(typeof j=="string"){var Re;Z=(Re=ke(j))!==null&&Re!==void 0?Re:j;try{be=U1(Z)}catch(Oe){if(H)throw ue(Z)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+Oe.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return be};n.getImageProperties=function(j){var H,Z,be="";if(V(j)&&(j=k(j)),typeof j=="string"&&c(j)===t&&((be=q(j,!1))===""&&(be=n.loadFile(j)||""),j=be),Z=c(j),!M(Z))throw new Error("addImage does not support files of type '"+Z+"', please ensure that a plugin for '"+Z+"' support is added.");if(j instanceof Uint8Array||(j=pe(j)),!(H=this["process"+Z.toUpperCase()](j)))throw new Error("An unknown error occurred whilst processing the image");return H.fileType=Z,H}})(wi.API),(function(n){var e=function(t){if(t!==void 0&&t!="")return!0};wi.API.events.push(["addPage",function(t){this.internal.getPageInfo(t.pageNumber).pageContext.annotations=[]}]),n.events.push(["putPage",function(t){for(var i,c,u,m=this.internal.getCoordinateString,_=this.internal.getVerticalCoordinateString,o=this.internal.getPageInfoByObjId(t.objId),b=t.pageContext.annotations,I=!1,M=0;M<b.length&&!I;M++)switch((i=b[M]).type){case"link":(e(i.options.url)||e(i.options.pageNumber))&&(I=!0);break;case"reference":case"text":case"freetext":I=!0}if(I!=0){this.internal.write("/Annots [");for(var V=0;V<b.length;V++){i=b[V];var k=this.internal.pdfEscape,ie=this.internal.getEncryptor(t.objId);switch(i.type){case"reference":this.internal.write(" "+i.object.objId+" 0 R ");break;case"text":var se=this.internal.newAdditionalObject(),de=this.internal.newAdditionalObject(),J=this.internal.getEncryptor(se.objId),ne=i.title||"Note";u="<</Type /Annot /Subtype /Text "+(c="/Rect ["+m(i.bounds.x)+" "+_(i.bounds.y+i.bounds.h)+" "+m(i.bounds.x+i.bounds.w)+" "+_(i.bounds.y)+"] ")+"/Contents ("+k(J(i.contents))+")",u+=" /Popup "+de.objId+" 0 R",u+=" /P "+o.objId+" 0 R",u+=" /T ("+k(J(ne))+") >>",se.content=u;var me=se.objId+" 0 R";u="<</Type /Annot /Subtype /Popup "+(c="/Rect ["+m(i.bounds.x+30)+" "+_(i.bounds.y+i.bounds.h)+" "+m(i.bounds.x+i.bounds.w+30)+" "+_(i.bounds.y)+"] ")+" /Parent "+me,i.open&&(u+=" /Open true"),u+=" >>",de.content=u,this.internal.write(se.objId,"0 R",de.objId,"0 R");break;case"freetext":c="/Rect ["+m(i.bounds.x)+" "+_(i.bounds.y)+" "+m(i.bounds.x+i.bounds.w)+" "+_(i.bounds.y+i.bounds.h)+"] ";var ue=i.color||"#000000";u="<</Type /Annot /Subtype /FreeText "+c+"/Contents ("+k(ie(i.contents))+")",u+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+ue+")",u+=" /Border [0 0 0]",u+=" >>",this.internal.write(u);break;case"link":if(i.options.name){var ke=this.annotations._nameMap[i.options.name];i.options.pageNumber=ke.page,i.options.top=ke.y}else i.options.top||(i.options.top=0);if(c="/Rect ["+i.finalBounds.x+" "+i.finalBounds.y+" "+i.finalBounds.w+" "+i.finalBounds.h+"] ",u="",i.options.url)u="<</Type /Annot /Subtype /Link "+c+"/Border [0 0 0] /A <</S /URI /URI ("+k(ie(i.options.url))+") >>";else if(i.options.pageNumber)switch(u="<</Type /Annot /Subtype /Link "+c+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(i.options.pageNumber).objId+" 0 R",i.options.magFactor=i.options.magFactor||"XYZ",i.options.magFactor){case"Fit":u+=" /Fit]";break;case"FitH":u+=" /FitH "+i.options.top+"]";break;case"FitV":i.options.left=i.options.left||0,u+=" /FitV "+i.options.left+"]";break;default:var ze=_(i.options.top);i.options.left=i.options.left||0,i.options.zoom===void 0&&(i.options.zoom=0),u+=" /XYZ "+i.options.left+" "+ze+" "+i.options.zoom+"]"}u!=""&&(u+=" >>",this.internal.write(u))}}this.internal.write("]")}}]),n.createAnnotation=function(t){var i=this.internal.getCurrentPageInfo();switch(t.type){case"link":this.link(t.bounds.x,t.bounds.y,t.bounds.w,t.bounds.h,t);break;case"text":case"freetext":i.pageContext.annotations.push(t)}},n.link=function(t,i,c,u,m){var _=this.internal.getCurrentPageInfo(),o=this.internal.getCoordinateString,b=this.internal.getVerticalCoordinateString;_.pageContext.annotations.push({finalBounds:{x:o(t),y:b(i),w:o(t+c),h:b(i+u)},options:m,type:"link"})},n.textWithLink=function(t,i,c,u){var m,_,o=this.getTextWidth(t),b=this.internal.getLineHeight()/this.internal.scaleFactor;if(u.maxWidth!==void 0){_=u.maxWidth;var I=this.splitTextToSize(t,_).length;m=Math.ceil(b*I)}else _=o,m=b;return this.text(t,i,c,u),c+=.2*b,u.align==="center"&&(i-=o/2),u.align==="right"&&(i-=o),this.link(i,c-b,_,m,u),o},n.getTextWidth=function(t){var i=this.internal.getFontSize();return this.getStringUnitWidth(t)*i/this.internal.scaleFactor}})(wi.API),(function(n){var e={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},t={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},i={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},c=[1570,1571,1573,1575];n.__arabicParser__={};var u=n.__arabicParser__.isInArabicSubstitutionA=function(se){return e[se.charCodeAt(0)]!==void 0},m=n.__arabicParser__.isArabicLetter=function(se){return typeof se=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(se)},_=n.__arabicParser__.isArabicEndLetter=function(se){return m(se)&&u(se)&&e[se.charCodeAt(0)].length<=2},o=n.__arabicParser__.isArabicAlfLetter=function(se){return m(se)&&c.indexOf(se.charCodeAt(0))>=0};n.__arabicParser__.arabicLetterHasIsolatedForm=function(se){return m(se)&&u(se)&&e[se.charCodeAt(0)].length>=1};var b=n.__arabicParser__.arabicLetterHasFinalForm=function(se){return m(se)&&u(se)&&e[se.charCodeAt(0)].length>=2};n.__arabicParser__.arabicLetterHasInitialForm=function(se){return m(se)&&u(se)&&e[se.charCodeAt(0)].length>=3};var I=n.__arabicParser__.arabicLetterHasMedialForm=function(se){return m(se)&&u(se)&&e[se.charCodeAt(0)].length==4},M=n.__arabicParser__.resolveLigatures=function(se){var de=0,J=t,ne="",me=0;for(de=0;de<se.length;de+=1)J[se.charCodeAt(de)]!==void 0?(me++,typeof(J=J[se.charCodeAt(de)])=="number"&&(ne+=String.fromCharCode(J),J=t,me=0),de===se.length-1&&(J=t,ne+=se.charAt(de-(me-1)),de-=me-1,me=0)):(J=t,ne+=se.charAt(de-me),de-=me,me=0);return ne};n.__arabicParser__.isArabicDiacritic=function(se){return se!==void 0&&i[se.charCodeAt(0)]!==void 0};var V=n.__arabicParser__.getCorrectForm=function(se,de,J){return m(se)?u(se)===!1?-1:!b(se)||!m(de)&&!m(J)||!m(J)&&_(de)||_(se)&&!m(de)||_(se)&&o(de)||_(se)&&_(de)?0:I(se)&&m(de)&&!_(de)&&m(J)&&b(J)?3:_(se)||!m(J)?1:2:-1},k=function(se){var de=0,J=0,ne=0,me="",ue="",ke="",ze=(se=se||"").split("\\s+"),pe=[];for(de=0;de<ze.length;de+=1){for(pe.push(""),J=0;J<ze[de].length;J+=1)me=ze[de][J],ue=ze[de][J-1],ke=ze[de][J+1],m(me)?(ne=V(me,ue,ke),pe[de]+=ne!==-1?String.fromCharCode(e[me.charCodeAt(0)][ne]):me):pe[de]+=me;pe[de]=M(pe[de])}return pe.join(" ")},ie=n.__arabicParser__.processArabic=n.processArabic=function(){var se,de=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,J=[];if(Array.isArray(de)){var ne=0;for(J=[],ne=0;ne<de.length;ne+=1)Array.isArray(de[ne])?J.push([k(de[ne][0]),de[ne][1],de[ne][2]]):J.push([k(de[ne])]);se=J}else se=k(de);return typeof arguments[0]=="string"?se:(arguments[0].text=se,arguments[0])};n.events.push(["preProcessText",ie])})(wi.API),wi.API.autoPrint=function(n){var e;return(n=n||{}).variant=n.variant||"non-conform",n.variant==="javascript"?this.addJS("print({});"):(this.internal.events.subscribe("postPutResources",function(){e=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+e+" 0 R")})),this},(function(n){var e=function(){var t=void 0;Object.defineProperty(this,"pdf",{get:function(){return t},set:function(_){t=_}});var i=150;Object.defineProperty(this,"width",{get:function(){return i},set:function(_){i=isNaN(_)||Number.isInteger(_)===!1||_<0?150:_,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=i+1)}});var c=300;Object.defineProperty(this,"height",{get:function(){return c},set:function(_){c=isNaN(_)||Number.isInteger(_)===!1||_<0?300:_,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=c+1)}});var u=[];Object.defineProperty(this,"childNodes",{get:function(){return u},set:function(_){u=_}});var m={};Object.defineProperty(this,"style",{get:function(){return m},set:function(_){m=_}}),Object.defineProperty(this,"parentNode",{})};e.prototype.getContext=function(t,i){var c;if((t=t||"2d")!=="2d")return null;for(c in i)this.pdf.context2d.hasOwnProperty(c)&&(this.pdf.context2d[c]=i[c]);return this.pdf.context2d._canvas=this,this.pdf.context2d},e.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},n.events.push(["initialized",function(){this.canvas=new e,this.canvas.pdf=this}])})(wi.API),(function(n){var e={left:0,top:0,bottom:0,right:0},t=!1,i=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},e),this.internal.__cell__.margins.width=this.getPageWidth(),c.call(this))},c=function(){this.internal.__cell__.lastCell=new u,this.internal.__cell__.pages=1},u=function(){var o=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return o},set:function(se){o=se}});var b=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return b},set:function(se){b=se}});var I=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return I},set:function(se){I=se}});var M=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return M},set:function(se){M=se}});var V=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return V},set:function(se){V=se}});var k=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return k},set:function(se){k=se}});var ie=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return ie},set:function(se){ie=se}}),this};u.prototype.clone=function(){return new u(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},u.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},n.setHeaderFunction=function(o){return i.call(this),this.internal.__cell__.headerFunction=typeof o=="function"?o:void 0,this},n.getTextDimensions=function(o,b){i.call(this);var I=(b=b||{}).fontSize||this.getFontSize(),M=b.font||this.getFont(),V=b.scaleFactor||this.internal.scaleFactor,k=0,ie=0,se=0,de=this;if(!Array.isArray(o)&&typeof o!="string"){if(typeof o!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");o=String(o)}var J=b.maxWidth;J>0?typeof o=="string"?o=this.splitTextToSize(o,J):Object.prototype.toString.call(o)==="[object Array]"&&(o=o.reduce(function(me,ue){return me.concat(de.splitTextToSize(ue,J))},[])):o=Array.isArray(o)?o:[o];for(var ne=0;ne<o.length;ne++)k<(se=this.getStringUnitWidth(o[ne],{font:M})*I)&&(k=se);return k!==0&&(ie=o.length),{w:k/=V,h:Math.max((ie*I*this.getLineHeightFactor()-I*(this.getLineHeightFactor()-1))/V,0)}},n.cellAddPage=function(){i.call(this),this.addPage();var o=this.internal.__cell__.margins||e;return this.internal.__cell__.lastCell=new u(o.left,o.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var m=n.cell=function(){var o;o=arguments[0]instanceof u?arguments[0]:new u(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),i.call(this);var b=this.internal.__cell__.lastCell,I=this.internal.__cell__.padding,M=this.internal.__cell__.margins||e,V=this.internal.__cell__.tableHeaderRow,k=this.internal.__cell__.printHeaders;return b.lineNumber!==void 0&&(b.lineNumber===o.lineNumber?(o.x=(b.x||0)+(b.width||0),o.y=b.y||0):b.y+b.height+o.height+M.bottom>this.getPageHeight()?(this.cellAddPage(),o.y=M.top,k&&V&&(this.printHeaderRow(o.lineNumber,!0),o.y+=V[0].height)):o.y=b.y+b.height||o.y),o.text[0]!==void 0&&(this.rect(o.x,o.y,o.width,o.height,t===!0?"FD":void 0),o.align==="right"?this.text(o.text,o.x+o.width-I,o.y+I,{align:"right",baseline:"top"}):o.align==="center"?this.text(o.text,o.x+o.width/2,o.y+I,{align:"center",baseline:"top",maxWidth:o.width-I-I}):this.text(o.text,o.x+I,o.y+I,{align:"left",baseline:"top",maxWidth:o.width-I-I})),this.internal.__cell__.lastCell=o,this};n.table=function(o,b,I,M,V){if(i.call(this),!I)throw new Error("No data for PDF table.");var k,ie,se,de,J=[],ne=[],me=[],ue={},ke={},ze=[],pe=[],U=(V=V||{}).autoSize||!1,F=V.printHeaders!==!1,q=V.css&&V.css["font-size"]!==void 0?16*V.css["font-size"]:V.fontSize||12,j=V.margins||Object.assign({width:this.getPageWidth()},e),H=typeof V.padding=="number"?V.padding:3,Z=V.headerBackgroundColor||"#c8c8c8",be=V.headerTextColor||"#000";if(c.call(this),this.internal.__cell__.printHeaders=F,this.internal.__cell__.margins=j,this.internal.__cell__.table_font_size=q,this.internal.__cell__.padding=H,this.internal.__cell__.headerBackgroundColor=Z,this.internal.__cell__.headerTextColor=be,this.setFontSize(q),M==null)ne=J=Object.keys(I[0]),me=J.map(function(){return"left"});else if(Array.isArray(M)&&xa(M[0])==="object")for(J=M.map(function(tt){return tt.name}),ne=M.map(function(tt){return tt.prompt||tt.name||""}),me=M.map(function(tt){return tt.align||"left"}),k=0;k<M.length;k+=1)ke[M[k].name]=.7499990551181103*M[k].width;else Array.isArray(M)&&typeof M[0]=="string"&&(ne=J=M,me=J.map(function(){return"left"}));if(U||Array.isArray(M)&&typeof M[0]=="string")for(k=0;k<J.length;k+=1){for(ue[de=J[k]]=I.map(function(tt){return tt[de]}),this.setFont(void 0,"bold"),ze.push(this.getTextDimensions(ne[k],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),ie=ue[de],this.setFont(void 0,"normal"),se=0;se<ie.length;se+=1)ze.push(this.getTextDimensions(ie[se],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);ke[de]=Math.max.apply(null,ze)+H+H,ze=[]}if(F){var Re={};for(k=0;k<J.length;k+=1)Re[J[k]]={},Re[J[k]].text=ne[k],Re[J[k]].align=me[k];var Oe=_.call(this,Re,ke);pe=J.map(function(tt){return new u(o,b,ke[tt],Oe,Re[tt].text,void 0,Re[tt].align)}),this.setTableHeaderRow(pe),this.printHeaderRow(1,!1)}var Me=M.reduce(function(tt,xe){return tt[xe.name]=xe.align,tt},{});for(k=0;k<I.length;k+=1){"rowStart"in V&&V.rowStart instanceof Function&&V.rowStart({row:k,data:I[k]},this);var we=_.call(this,I[k],ke);for(se=0;se<J.length;se+=1){var De=I[k][J[se]];"cellStart"in V&&V.cellStart instanceof Function&&V.cellStart({row:k,col:se,data:De},this),m.call(this,new u(o,b,ke[J[se]],we,De,k+2,Me[J[se]]))}}return this.internal.__cell__.table_x=o,this.internal.__cell__.table_y=b,this};var _=function(o,b){var I=this.internal.__cell__.padding,M=this.internal.__cell__.table_font_size,V=this.internal.scaleFactor;return Object.keys(o).map(function(k){var ie=o[k];return this.splitTextToSize(ie.hasOwnProperty("text")?ie.text:ie,b[k]-I-I)},this).map(function(k){return this.getLineHeightFactor()*k.length*M/V+I+I},this).reduce(function(k,ie){return Math.max(k,ie)},0)};n.setTableHeaderRow=function(o){i.call(this),this.internal.__cell__.tableHeaderRow=o},n.printHeaderRow=function(o,b){if(i.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var I;if(t=!0,typeof this.internal.__cell__.headerFunction=="function"){var M=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new u(M[0],M[1],M[2],M[3],void 0,-1)}this.setFont(void 0,"bold");for(var V=[],k=0;k<this.internal.__cell__.tableHeaderRow.length;k+=1){I=this.internal.__cell__.tableHeaderRow[k].clone(),b&&(I.y=this.internal.__cell__.margins.top||0,V.push(I)),I.lineNumber=o;var ie=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),m.call(this,I),this.setTextColor(ie)}V.length>0&&this.setTableHeaderRow(V),this.setFont(void 0,"normal"),t=!1}})(wi.API);var G6={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},H6=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],T5=$6(H6),W6=[100,200,300,400,500,600,700,800,900],nM=$6(W6);function kb(n){var e=n.family.replace(/"|'/g,"").toLowerCase(),t=(function(u){return G6[u=u||"normal"]?u:"normal"})(n.style),i=(function(u){return u?typeof u=="number"?u>=100&&u<=900&&u%100==0?u:400:/^\d00$/.test(u)?parseInt(u):u==="bold"?700:400:400})(n.weight),c=(function(u){return typeof T5[u=u||"normal"]=="number"?u:"normal"})(n.stretch);return{family:e,style:t,weight:i,stretch:c,src:n.src||[],ref:n.ref||{name:e,style:[c,t,i].join(" ")}}}function LS(n,e,t,i){var c;for(c=t;c>=0&&c<e.length;c+=i)if(n[e[c]])return n[e[c]];for(c=t;c>=0&&c<e.length;c-=i)if(n[e[c]])return n[e[c]]}var rM={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},PS={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function kS(n){return[n.stretch,n.style,n.weight,n.family].join(" ")}function RS(n){return n.trimLeft()}function iM(n,e){for(var t=0;t<n.length;){if(n.charAt(t)===e)return[n.substring(0,t),n.substring(t+1)];t+=1}return null}function oM(n){var e=n.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return e===null?null:[e[0],n.substring(e[0].length)]}var v1,MS,NS,Kg,x1,DS,FS,OS,Rb=["times"];function BS(n,e,t,i,c){var u=4,m=jS;switch(c){case wi.API.image_compression.FAST:u=1,m=zS;break;case wi.API.image_compression.MEDIUM:u=6,m=US;break;case wi.API.image_compression.SLOW:u=9,m=VS}n=(function(o,b,I,M){for(var V,k=o.length/b,ie=new Uint8Array(o.length+k),se=[sM,zS,jS,US,VS],de=0;de<k;de+=1){var J=de*b,ne=o.subarray(J,J+b);if(M)ie.set(M(ne,I,V),J+de);else{for(var me=se.length,ue=[],ke=0;ke<me;ke+=1)ue[ke]=se[ke](ne,I,V);var ze=lM(ue.concat());ie.set(ue[ze],J+de)}V=ne}return ie})(n,e,Math.ceil(t*i/8),m);var _=v5(n,{level:u});return wi.API.__addimage__.arrayBufferToBinaryString(_)}function sM(n){var e=Array.apply([],n);return e.unshift(0),e}function zS(n,e){var t=n.length,i=[];i[0]=1;for(var c=0;c<t;c+=1){var u=n[c-e]||0;i[c+1]=n[c]-u+256&255}return i}function jS(n,e,t){var i=n.length,c=[];c[0]=2;for(var u=0;u<i;u+=1){var m=t&&t[u]||0;c[u+1]=n[u]-m+256&255}return c}function US(n,e,t){var i=n.length,c=[];c[0]=3;for(var u=0;u<i;u+=1){var m=n[u-e]||0,_=t&&t[u]||0;c[u+1]=n[u]+256-(m+_>>>1)&255}return c}function VS(n,e,t){var i=n.length,c=[];c[0]=4;for(var u=0;u<i;u+=1){var m=aM(n[u-e]||0,t&&t[u]||0,t&&t[u-e]||0);c[u+1]=n[u]-m+256&255}return c}function aM(n,e,t){if(n===e&&e===t)return n;var i=Math.abs(e-t),c=Math.abs(n-t),u=Math.abs(n+e-t-t);return i<=c&&i<=u?n:c<=u?e:t}function lM(n){var e=n.map(function(t){return t.reduce(function(i,c){return i+Math.abs(c)},0)});return e.indexOf(Math.min.apply(null,e))}function Mb(n,e,t){var i=e*t,c=Math.floor(i/8),u=16-(i-8*c+t),m=(1<<t)-1;return K6(n,c)>>u&m}function qS(n,e,t,i){var c=t*i,u=Math.floor(c/8),m=16-(c-8*u+i),_=(1<<i)-1,o=(e&_)<<m;(function(b,I,M){if(I+1<b.byteLength)b.setUint16(I,M,!1);else{var V=M>>8&255;b.setUint8(I,V)}})(n,u,K6(n,u)&~(_<<m)&65535|o)}function K6(n,e){return e+1<n.byteLength?n.getUint16(e,!1):n.getUint8(e)<<8}function cM(n){var e=0;if(n[e++]!==71||n[e++]!==73||n[e++]!==70||n[e++]!==56||(n[e++]+1&253)!=56||n[e++]!==97)throw new Error("Invalid GIF 87a/89a header.");var t=n[e++]|n[e++]<<8,i=n[e++]|n[e++]<<8,c=n[e++],u=c>>7,m=1<<1+(7&c);n[e++],n[e++];var _=null,o=null;u&&(_=e,o=m,e+=3*m);var b=!0,I=[],M=0,V=null,k=0,ie=null;for(this.width=t,this.height=i;b&&e<n.length;)switch(n[e++]){case 33:switch(n[e++]){case 255:if(n[e]!==11||n[e+1]==78&&n[e+2]==69&&n[e+3]==84&&n[e+4]==83&&n[e+5]==67&&n[e+6]==65&&n[e+7]==80&&n[e+8]==69&&n[e+9]==50&&n[e+10]==46&&n[e+11]==48&&n[e+12]==3&&n[e+13]==1&&n[e+16]==0)e+=14,ie=n[e++]|n[e++]<<8,e++;else for(e+=12;;){if(!((j=n[e++])>=0))throw Error("Invalid block size");if(j===0)break;e+=j}break;case 249:if(n[e++]!==4||n[e+4]!==0)throw new Error("Invalid graphics extension block.");var se=n[e++];M=n[e++]|n[e++]<<8,V=n[e++],1&se||(V=null),k=se>>2&7,e++;break;case 254:for(;;){if(!((j=n[e++])>=0))throw Error("Invalid block size");if(j===0)break;e+=j}break;default:throw new Error("Unknown graphic control label: 0x"+n[e-1].toString(16))}break;case 44:var de=n[e++]|n[e++]<<8,J=n[e++]|n[e++]<<8,ne=n[e++]|n[e++]<<8,me=n[e++]|n[e++]<<8,ue=n[e++],ke=ue>>6&1,ze=1<<1+(7&ue),pe=_,U=o,F=!1;ue>>7&&(F=!0,pe=e,U=ze,e+=3*ze);var q=e;for(e++;;){var j;if(!((j=n[e++])>=0))throw Error("Invalid block size");if(j===0)break;e+=j}I.push({x:de,y:J,width:ne,height:me,has_local_palette:F,palette_offset:pe,palette_size:U,data_offset:q,data_length:e-q,transparent_index:V,interlaced:!!ke,delay:M,disposal:k});break;case 59:b=!1;break;default:throw new Error("Unknown gif block: 0x"+n[e-1].toString(16))}this.numFrames=function(){return I.length},this.loopCount=function(){return ie},this.frameInfo=function(H){if(H<0||H>=I.length)throw new Error("Frame index out of range.");return I[H]},this.decodeAndBlitFrameBGRA=function(H,Z){var be=this.frameInfo(H),Re=be.width*be.height,Oe=new Uint8Array(Re);$S(n,be.data_offset,Oe,Re);var Me=be.palette_offset,we=be.transparent_index;we===null&&(we=256);var De=be.width,tt=t-De,xe=De,le=4*(be.y*t+be.x),Ne=4*((be.y+be.height)*t+be.x),Be=le,Qe=4*tt;be.interlaced===!0&&(Qe+=4*t*7);for(var rt=8,gt=0,pt=Oe.length;gt<pt;++gt){var Mt=Oe[gt];if(xe===0&&(xe=De,(Be+=Qe)>=Ne&&(Qe=4*tt+4*t*(rt-1),Be=le+(De+tt)*(rt<<1),rt>>=1)),Mt===we)Be+=4;else{var Jt=n[Me+3*Mt],hn=n[Me+3*Mt+1],yn=n[Me+3*Mt+2];Z[Be++]=yn,Z[Be++]=hn,Z[Be++]=Jt,Z[Be++]=255}--xe}},this.decodeAndBlitFrameRGBA=function(H,Z){var be=this.frameInfo(H),Re=be.width*be.height,Oe=new Uint8Array(Re);$S(n,be.data_offset,Oe,Re);var Me=be.palette_offset,we=be.transparent_index;we===null&&(we=256);var De=be.width,tt=t-De,xe=De,le=4*(be.y*t+be.x),Ne=4*((be.y+be.height)*t+be.x),Be=le,Qe=4*tt;be.interlaced===!0&&(Qe+=4*t*7);for(var rt=8,gt=0,pt=Oe.length;gt<pt;++gt){var Mt=Oe[gt];if(xe===0&&(xe=De,(Be+=Qe)>=Ne&&(Qe=4*tt+4*t*(rt-1),Be=le+(De+tt)*(rt<<1),rt>>=1)),Mt===we)Be+=4;else{var Jt=n[Me+3*Mt],hn=n[Me+3*Mt+1],yn=n[Me+3*Mt+2];Z[Be++]=Jt,Z[Be++]=hn,Z[Be++]=yn,Z[Be++]=255}--xe}}}function $S(n,e,t,i){for(var c=n[e++],u=1<<c,m=u+1,_=m+1,o=c+1,b=(1<<o)-1,I=0,M=0,V=0,k=n[e++],ie=new Int32Array(4096),se=null;;){for(;I<16&&k!==0;)M|=n[e++]<<I,I+=8,k===1?k=n[e++]:--k;if(I<o)break;var de=M&b;if(M>>=o,I-=o,de!==u){if(de===m)break;for(var J=de<_?de:se,ne=0,me=J;me>u;)me=ie[me]>>8,++ne;var ue=me;if(V+ne+(J!==de?1:0)>i)return void Ga.log("Warning, gif stream longer than expected.");t[V++]=ue;var ke=V+=ne;for(J!==de&&(t[V++]=ue),me=J;ne--;)me=ie[me],t[--ke]=255&me,me>>=8;se!==null&&_<4096&&(ie[_++]=se<<8|ue,_>=b+1&&o<12&&(++o,b=b<<1|1)),se=de}else _=m+1,b=(1<<(o=c+1))-1,se=null}return V!==i&&Ga.log("Warning, gif stream shorter than expected."),t}/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function Nb(n){var e,t,i,c,u,m=Math.floor,_=new Array(64),o=new Array(64),b=new Array(64),I=new Array(64),M=new Array(65535),V=new Array(65535),k=new Array(64),ie=new Array(64),se=[],de=0,J=7,ne=new Array(64),me=new Array(64),ue=new Array(64),ke=new Array(256),ze=new Array(2048),pe=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],U=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],F=[0,1,2,3,4,5,6,7,8,9,10,11],q=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],j=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],H=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],Z=[0,1,2,3,4,5,6,7,8,9,10,11],be=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],Re=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function Oe(le,Ne){for(var Be=0,Qe=0,rt=new Array,gt=1;gt<=16;gt++){for(var pt=1;pt<=le[gt];pt++)rt[Ne[Qe]]=[],rt[Ne[Qe]][0]=Be,rt[Ne[Qe]][1]=gt,Qe++,Be++;Be*=2}return rt}function Me(le){for(var Ne=le[0],Be=le[1]-1;Be>=0;)Ne&1<<Be&&(de|=1<<J),Be--,--J<0&&(de==255?(we(255),we(0)):we(de),J=7,de=0)}function we(le){se.push(le)}function De(le){we(le>>8&255),we(255&le)}function tt(le,Ne,Be,Qe,rt){for(var gt,pt=rt[0],Mt=rt[240],Jt=(function(Ln,ir){var Qn,Kr,qt,Pn,Hn,Bn,Rr,vr,Tr,Ir,Pr=0;for(Tr=0;Tr<8;++Tr){Qn=Ln[Pr],Kr=Ln[Pr+1],qt=Ln[Pr+2],Pn=Ln[Pr+3],Hn=Ln[Pr+4],Bn=Ln[Pr+5],Rr=Ln[Pr+6];var Si=Qn+(vr=Ln[Pr+7]),ki=Qn-vr,or=Kr+Rr,oi=Kr-Rr,Gr=qt+Bn,Or=qt-Bn,hi=Pn+Hn,si=Pn-Hn,lt=Si+hi,Ee=Si-hi,Te=or+Gr,et=or-Gr;Ln[Pr]=lt+Te,Ln[Pr+4]=lt-Te;var ht=.707106781*(et+Ee);Ln[Pr+2]=Ee+ht,Ln[Pr+6]=Ee-ht;var Lt=.382683433*((lt=si+Or)-(et=oi+ki)),Rt=.5411961*lt+Lt,Ot=1.306562965*et+Lt,At=.707106781*(Te=Or+oi),Pt=ki+At,xn=ki-At;Ln[Pr+5]=xn+Rt,Ln[Pr+3]=xn-Rt,Ln[Pr+1]=Pt+Ot,Ln[Pr+7]=Pt-Ot,Pr+=8}for(Pr=0,Tr=0;Tr<8;++Tr){Qn=Ln[Pr],Kr=Ln[Pr+8],qt=Ln[Pr+16],Pn=Ln[Pr+24],Hn=Ln[Pr+32],Bn=Ln[Pr+40],Rr=Ln[Pr+48];var Un=Qn+(vr=Ln[Pr+56]),In=Qn-vr,kr=Kr+Rr,Lr=Kr-Rr,jr=qt+Bn,Er=qt-Bn,Ei=Pn+Hn,oo=Pn-Hn,_o=Un+Ei,Ho=Un-Ei,so=kr+jr,_s=kr-jr;Ln[Pr]=_o+so,Ln[Pr+32]=_o-so;var ao=.707106781*(_s+Ho);Ln[Pr+16]=Ho+ao,Ln[Pr+48]=Ho-ao;var Cs=.382683433*((_o=oo+Er)-(_s=Lr+In)),ma=.5411961*_o+Cs,bl=1.306562965*_s+Cs,ll=.707106781*(so=Er+Lr),Hi=In+ll,nc=In-ll;Ln[Pr+40]=nc+ma,Ln[Pr+24]=nc-ma,Ln[Pr+8]=Hi+bl,Ln[Pr+56]=Hi-bl,Pr++}for(Tr=0;Tr<64;++Tr)Ir=Ln[Tr]*ir[Tr],k[Tr]=Ir>0?Ir+.5|0:Ir-.5|0;return k})(le,Ne),hn=0;hn<64;++hn)ie[pe[hn]]=Jt[hn];var yn=ie[0]-Be;Be=ie[0],yn==0?Me(Qe[0]):(Me(Qe[V[gt=32767+yn]]),Me(M[gt]));for(var Mn=63;Mn>0&&ie[Mn]==0;)Mn--;if(Mn==0)return Me(pt),Be;for(var Gt,ot=1;ot<=Mn;){for(var dr=ot;ie[ot]==0&&ot<=Mn;)++ot;var wr=ot-dr;if(wr>=16){Gt=wr>>4;for(var Cr=1;Cr<=Gt;++Cr)Me(Mt);wr&=15}gt=32767+ie[ot],Me(rt[(wr<<4)+V[gt]]),Me(M[gt]),ot++}return Mn!=63&&Me(pt),Be}function xe(le){le=Math.min(Math.max(le,1),100),u!=le&&((function(Ne){for(var Be=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],Qe=0;Qe<64;Qe++){var rt=m((Be[Qe]*Ne+50)/100);rt=Math.min(Math.max(rt,1),255),_[pe[Qe]]=rt}for(var gt=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],pt=0;pt<64;pt++){var Mt=m((gt[pt]*Ne+50)/100);Mt=Math.min(Math.max(Mt,1),255),o[pe[pt]]=Mt}for(var Jt=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],hn=0,yn=0;yn<8;yn++)for(var Mn=0;Mn<8;Mn++)b[hn]=1/(_[pe[hn]]*Jt[yn]*Jt[Mn]*8),I[hn]=1/(o[pe[hn]]*Jt[yn]*Jt[Mn]*8),hn++})(le<50?Math.floor(5e3/le):Math.floor(200-2*le)),u=le)}this.encode=function(le,Ne){Ne&&xe(Ne),se=new Array,de=0,J=7,De(65496),De(65504),De(16),we(74),we(70),we(73),we(70),we(0),we(1),we(1),we(0),De(1),De(1),we(0),we(0),(function(){De(65499),De(132),we(0);for(var Kr=0;Kr<64;Kr++)we(_[Kr]);we(1);for(var qt=0;qt<64;qt++)we(o[qt])})(),(function(Kr,qt){De(65472),De(17),we(8),De(qt),De(Kr),we(3),we(1),we(17),we(0),we(2),we(17),we(1),we(3),we(17),we(1)})(le.width,le.height),(function(){De(65476),De(418),we(0);for(var Kr=0;Kr<16;Kr++)we(U[Kr+1]);for(var qt=0;qt<=11;qt++)we(F[qt]);we(16);for(var Pn=0;Pn<16;Pn++)we(q[Pn+1]);for(var Hn=0;Hn<=161;Hn++)we(j[Hn]);we(1);for(var Bn=0;Bn<16;Bn++)we(H[Bn+1]);for(var Rr=0;Rr<=11;Rr++)we(Z[Rr]);we(17);for(var vr=0;vr<16;vr++)we(be[vr+1]);for(var Tr=0;Tr<=161;Tr++)we(Re[Tr])})(),De(65498),De(12),we(3),we(1),we(0),we(2),we(17),we(3),we(17),we(0),we(63),we(0);var Be=0,Qe=0,rt=0;de=0,J=7,this.encode.displayName="_encode_";for(var gt,pt,Mt,Jt,hn,yn,Mn,Gt,ot,dr=le.data,wr=le.width,Cr=le.height,Ln=4*wr,ir=0;ir<Cr;){for(gt=0;gt<Ln;){for(hn=Ln*ir+gt,Mn=-1,Gt=0,ot=0;ot<64;ot++)yn=hn+(Gt=ot>>3)*Ln+(Mn=4*(7&ot)),ir+Gt>=Cr&&(yn-=Ln*(ir+1+Gt-Cr)),gt+Mn>=Ln&&(yn-=gt+Mn-Ln+4),pt=dr[yn++],Mt=dr[yn++],Jt=dr[yn++],ne[ot]=(ze[pt]+ze[Mt+256|0]+ze[Jt+512|0]>>16)-128,me[ot]=(ze[pt+768|0]+ze[Mt+1024|0]+ze[Jt+1280|0]>>16)-128,ue[ot]=(ze[pt+1280|0]+ze[Mt+1536|0]+ze[Jt+1792|0]>>16)-128;Be=tt(ne,b,Be,e,i),Qe=tt(me,I,Qe,t,c),rt=tt(ue,I,rt,t,c),gt+=32}ir+=8}if(J>=0){var Qn=[];Qn[1]=J+1,Qn[0]=(1<<J+1)-1,Me(Qn)}return De(65497),new Uint8Array(se)},n=n||50,(function(){for(var le=String.fromCharCode,Ne=0;Ne<256;Ne++)ke[Ne]=le(Ne)})(),e=Oe(U,F),t=Oe(H,Z),i=Oe(q,j),c=Oe(be,Re),(function(){for(var le=1,Ne=2,Be=1;Be<=15;Be++){for(var Qe=le;Qe<Ne;Qe++)V[32767+Qe]=Be,M[32767+Qe]=[],M[32767+Qe][1]=Be,M[32767+Qe][0]=Qe;for(var rt=-(Ne-1);rt<=-le;rt++)V[32767+rt]=Be,M[32767+rt]=[],M[32767+rt][1]=Be,M[32767+rt][0]=Ne-1+rt;le<<=1,Ne<<=1}})(),(function(){for(var le=0;le<256;le++)ze[le]=19595*le,ze[le+256|0]=38470*le,ze[le+512|0]=7471*le+32768,ze[le+768|0]=-11059*le,ze[le+1024|0]=-21709*le,ze[le+1280|0]=32768*le+8421375,ze[le+1536|0]=-27439*le,ze[le+1792|0]=-5329*le})(),xe(n)}/**
 * @license
 * Copyright (c) 2017 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */function Zd(n,e){if(this.pos=0,this.buffer=n,this.datav=new DataView(n.buffer),this.is_with_alpha=!!e,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function GS(n){function e(F){if(!F)throw Error("assert :P")}function t(F,q,j){for(var H=0;4>H;H++)if(F[q+H]!=j.charCodeAt(H))return!0;return!1}function i(F,q,j,H,Z){for(var be=0;be<Z;be++)F[q+be]=j[H+be]}function c(F,q,j,H){for(var Z=0;Z<H;Z++)F[q+Z]=j}function u(F){return new Int32Array(F)}function m(F,q){for(var j=[],H=0;H<F;H++)j.push(new q);return j}function _(F,q){var j=[];return(function H(Z,be,Re){for(var Oe=Re[be],Me=0;Me<Oe&&(Z.push(Re.length>be+1?[]:new q),!(Re.length<be+1));Me++)H(Z[Me],be+1,Re)})(j,0,F),j}var o=function(){var F=this;function q(C,B){for(var ee=1<<B-1>>>0;C&ee;)ee>>>=1;return ee?(C&ee-1)+ee:C}function j(C,B,ee,oe,Pe){e(!(oe%ee));do C[B+(oe-=ee)]=Pe;while(0<oe)}function H(C,B,ee,oe,Pe){if(e(2328>=Pe),512>=Pe)var Ve=u(512);else if((Ve=u(Pe))==null)return 0;return(function(We,Je,nt,ut,Nt,Yt){var dt,jt,Qt=Je,En=1<<nt,y=u(16),a=u(16);for(e(Nt!=0),e(ut!=null),e(We!=null),e(0<nt),jt=0;jt<Nt;++jt){if(15<ut[jt])return 0;++y[ut[jt]]}if(y[0]==Nt)return 0;for(a[1]=0,dt=1;15>dt;++dt){if(y[dt]>1<<dt)return 0;a[dt+1]=a[dt]+y[dt]}for(jt=0;jt<Nt;++jt)dt=ut[jt],0<ut[jt]&&(Yt[a[dt]++]=jt);if(a[15]==1)return(ut=new Z).g=0,ut.value=Yt[0],j(We,Qt,1,En,ut),En;var f,v=-1,S=En-1,T=0,N=1,z=1,G=1<<nt;for(jt=0,dt=1,Nt=2;dt<=nt;++dt,Nt<<=1){if(N+=z<<=1,0>(z-=y[dt]))return 0;for(;0<y[dt];--y[dt])(ut=new Z).g=dt,ut.value=Yt[jt++],j(We,Qt+T,Nt,G,ut),T=q(T,dt)}for(dt=nt+1,Nt=2;15>=dt;++dt,Nt<<=1){if(N+=z<<=1,0>(z-=y[dt]))return 0;for(;0<y[dt];--y[dt]){if(ut=new Z,(T&S)!=v){for(Qt+=G,f=1<<(v=dt)-nt;15>v&&!(0>=(f-=y[v]));)++v,f<<=1;En+=G=1<<(f=v-nt),We[Je+(v=T&S)].g=f+nt,We[Je+v].value=Qt-Je-v}ut.g=dt-nt,ut.value=Yt[jt++],j(We,Qt+(T>>nt),Nt,G,ut),T=q(T,dt)}}return N!=2*a[15]-1?0:En})(C,B,ee,oe,Pe,Ve)}function Z(){this.value=this.g=0}function be(){this.value=this.g=0}function Re(){this.G=m(5,Z),this.H=u(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=m(xc,be)}function Oe(C,B,ee,oe){e(C!=null),e(B!=null),e(2147483648>oe),C.Ca=254,C.I=0,C.b=-8,C.Ka=0,C.oa=B,C.pa=ee,C.Jd=B,C.Yc=ee+oe,C.Zc=4<=oe?ee+oe-4+1:ee,pt(C)}function Me(C,B){for(var ee=0;0<B--;)ee|=Jt(C,128)<<B;return ee}function we(C,B){var ee=Me(C,B);return Mt(C)?-ee:ee}function De(C,B,ee,oe){var Pe,Ve=0;for(e(C!=null),e(B!=null),e(4294967288>oe),C.Sb=oe,C.Ra=0,C.u=0,C.h=0,4<oe&&(oe=4),Pe=0;Pe<oe;++Pe)Ve+=B[ee+Pe]<<8*Pe;C.Ra=Ve,C.bb=oe,C.oa=B,C.pa=ee}function tt(C){for(;8<=C.u&&C.bb<C.Sb;)C.Ra>>>=8,C.Ra+=C.oa[C.pa+C.bb]<<gu-8>>>0,++C.bb,C.u-=8;Qe(C)&&(C.h=1,C.u=0)}function xe(C,B){if(e(0<=B),!C.h&&B<=ya){var ee=Be(C)&ks[B];return C.u+=B,tt(C),ee}return C.h=1,C.u=0}function le(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function Ne(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function Be(C){return C.Ra>>>(C.u&gu-1)>>>0}function Qe(C){return e(C.bb<=C.Sb),C.h||C.bb==C.Sb&&C.u>gu}function rt(C,B){C.u=B,C.h=Qe(C)}function gt(C){C.u>=ts&&(e(C.u>=ts),tt(C))}function pt(C){e(C!=null&&C.oa!=null),C.pa<C.Zc?(C.I=(C.oa[C.pa++]|C.I<<8)>>>0,C.b+=8):(e(C!=null&&C.oa!=null),C.pa<C.Yc?(C.b+=8,C.I=C.oa[C.pa++]|C.I<<8):C.Ka?C.b=0:(C.I<<=8,C.b+=8,C.Ka=1))}function Mt(C){return Me(C,1)}function Jt(C,B){var ee=C.Ca;0>C.b&&pt(C);var oe=C.b,Pe=ee*B>>>8,Ve=(C.I>>>oe>Pe)+0;for(Ve?(ee-=Pe,C.I-=Pe+1<<oe>>>0):ee=Pe+1,oe=ee,Pe=0;256<=oe;)Pe+=8,oe>>=8;return oe=7^Pe+Ws[oe],C.b-=oe,C.Ca=(ee<<oe)-1,Ve}function hn(C,B,ee){C[B+0]=ee>>24&255,C[B+1]=ee>>16&255,C[B+2]=ee>>8&255,C[B+3]=255&ee}function yn(C,B){return C[B+0]|C[B+1]<<8}function Mn(C,B){return yn(C,B)|C[B+2]<<16}function Gt(C,B){return yn(C,B)|yn(C,B+2)<<16}function ot(C,B){var ee=1<<B;return e(C!=null),e(0<B),C.X=u(ee),C.X==null?0:(C.Mb=32-B,C.Xa=B,1)}function dr(C,B){e(C!=null),e(B!=null),e(C.Xa==B.Xa),i(B.X,0,C.X,0,1<<B.Xa)}function wr(){this.X=[],this.Xa=this.Mb=0}function Cr(C,B,ee,oe){e(ee!=null),e(oe!=null);var Pe=ee[0],Ve=oe[0];return Pe==0&&(Pe=(C*Ve+B/2)/B),Ve==0&&(Ve=(B*Pe+C/2)/C),0>=Pe||0>=Ve?0:(ee[0]=Pe,oe[0]=Ve,1)}function Ln(C,B){return C+(1<<B)-1>>>B}function ir(C,B){return((4278255360&C)+(4278255360&B)>>>0&4278255360)+((16711935&C)+(16711935&B)>>>0&16711935)>>>0}function Qn(C,B){F[B]=function(ee,oe,Pe,Ve,We,Je,nt){var ut;for(ut=0;ut<We;++ut){var Nt=F[C](Je[nt+ut-1],Pe,Ve+ut);Je[nt+ut]=ir(ee[oe+ut],Nt)}}}function Kr(){this.ud=this.hd=this.jd=0}function qt(C,B){return((4278124286&(C^B))>>>1)+(C&B)>>>0}function Pn(C){return 0<=C&&256>C?C:0>C?0:255<C?255:void 0}function Hn(C,B){return Pn(C+(C-B+.5>>1))}function Bn(C,B,ee){return Math.abs(B-ee)-Math.abs(C-ee)}function Rr(C,B,ee,oe,Pe,Ve,We){for(oe=Ve[We-1],ee=0;ee<Pe;++ee)Ve[We+ee]=oe=ir(C[B+ee],oe)}function vr(C,B,ee,oe,Pe){var Ve;for(Ve=0;Ve<ee;++Ve){var We=C[B+Ve],Je=We>>8&255,nt=16711935&(nt=(nt=16711935&We)+((Je<<16)+Je));oe[Pe+Ve]=(4278255360&We)+nt>>>0}}function Tr(C,B){B.jd=255&C,B.hd=C>>8&255,B.ud=C>>16&255}function Ir(C,B,ee,oe,Pe,Ve){var We;for(We=0;We<oe;++We){var Je=B[ee+We],nt=Je>>>8,ut=Je,Nt=255&(Nt=(Nt=Je>>>16)+((C.jd<<24>>24)*(nt<<24>>24)>>>5));ut=255&(ut=(ut+=(C.hd<<24>>24)*(nt<<24>>24)>>>5)+((C.ud<<24>>24)*(Nt<<24>>24)>>>5)),Pe[Ve+We]=(4278255360&Je)+(Nt<<16)+ut}}function Pr(C,B,ee,oe,Pe){F[B]=function(Ve,We,Je,nt,ut,Nt,Yt,dt,jt){for(nt=Yt;nt<dt;++nt)for(Yt=0;Yt<jt;++Yt)ut[Nt++]=Pe(Je[oe(Ve[We++])])},F[C]=function(Ve,We,Je,nt,ut,Nt,Yt){var dt=8>>Ve.b,jt=Ve.Ea,Qt=Ve.K[0],En=Ve.w;if(8>dt)for(Ve=(1<<Ve.b)-1,En=(1<<dt)-1;We<Je;++We){var y,a=0;for(y=0;y<jt;++y)y&Ve||(a=oe(nt[ut++])),Nt[Yt++]=Pe(Qt[a&En]),a>>=dt}else F["VP8LMapColor"+ee](nt,ut,Qt,En,Nt,Yt,We,Je,jt)}}function Si(C,B,ee,oe,Pe){for(ee=B+ee;B<ee;){var Ve=C[B++];oe[Pe++]=Ve>>16&255,oe[Pe++]=Ve>>8&255,oe[Pe++]=255&Ve}}function ki(C,B,ee,oe,Pe){for(ee=B+ee;B<ee;){var Ve=C[B++];oe[Pe++]=Ve>>16&255,oe[Pe++]=Ve>>8&255,oe[Pe++]=255&Ve,oe[Pe++]=Ve>>24&255}}function or(C,B,ee,oe,Pe){for(ee=B+ee;B<ee;){var Ve=(We=C[B++])>>16&240|We>>12&15,We=240&We|We>>28&15;oe[Pe++]=Ve,oe[Pe++]=We}}function oi(C,B,ee,oe,Pe){for(ee=B+ee;B<ee;){var Ve=(We=C[B++])>>16&248|We>>13&7,We=We>>5&224|We>>3&31;oe[Pe++]=Ve,oe[Pe++]=We}}function Gr(C,B,ee,oe,Pe){for(ee=B+ee;B<ee;){var Ve=C[B++];oe[Pe++]=255&Ve,oe[Pe++]=Ve>>8&255,oe[Pe++]=Ve>>16&255}}function Or(C,B,ee,oe,Pe,Ve){if(Ve==0)for(ee=B+ee;B<ee;)hn(oe,((Ve=C[B++])[0]>>24|Ve[1]>>8&65280|Ve[2]<<8&16711680|Ve[3]<<24)>>>0),Pe+=32;else i(oe,Pe,C,B,ee)}function hi(C,B){F[B][0]=F[C+"0"],F[B][1]=F[C+"1"],F[B][2]=F[C+"2"],F[B][3]=F[C+"3"],F[B][4]=F[C+"4"],F[B][5]=F[C+"5"],F[B][6]=F[C+"6"],F[B][7]=F[C+"7"],F[B][8]=F[C+"8"],F[B][9]=F[C+"9"],F[B][10]=F[C+"10"],F[B][11]=F[C+"11"],F[B][12]=F[C+"12"],F[B][13]=F[C+"13"],F[B][14]=F[C+"0"],F[B][15]=F[C+"0"]}function si(C){return C==ru||C==ac||C==iu||C==ou}function lt(){this.eb=[],this.size=this.A=this.fb=0}function Ee(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function Te(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new lt,this.f.kb=new Ee,this.sd=null}function et(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function ht(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function Lt(C){return alert("todo:WebPSamplerProcessPlane"),C.T}function Rt(C,B){var ee=C.T,oe=B.ba.f.RGBA,Pe=oe.eb,Ve=oe.fb+C.ka*oe.A,We=Il[B.ba.S],Je=C.y,nt=C.O,ut=C.f,Nt=C.N,Yt=C.ea,dt=C.W,jt=B.cc,Qt=B.dc,En=B.Mc,y=B.Nc,a=C.ka,f=C.ka+C.T,v=C.U,S=v+1>>1;for(a==0?We(Je,nt,null,null,ut,Nt,Yt,dt,ut,Nt,Yt,dt,Pe,Ve,null,null,v):(We(B.ec,B.fc,Je,nt,jt,Qt,En,y,ut,Nt,Yt,dt,Pe,Ve-oe.A,Pe,Ve,v),++ee);a+2<f;a+=2)jt=ut,Qt=Nt,En=Yt,y=dt,Nt+=C.Rc,dt+=C.Rc,Ve+=2*oe.A,We(Je,(nt+=2*C.fa)-C.fa,Je,nt,jt,Qt,En,y,ut,Nt,Yt,dt,Pe,Ve-oe.A,Pe,Ve,v);return nt+=C.fa,C.j+f<C.o?(i(B.ec,B.fc,Je,nt,v),i(B.cc,B.dc,ut,Nt,S),i(B.Mc,B.Nc,Yt,dt,S),ee--):1&f||We(Je,nt,null,null,ut,Nt,Yt,dt,ut,Nt,Yt,dt,Pe,Ve+oe.A,null,null,v),ee}function Ot(C,B,ee){var oe=C.F,Pe=[C.J];if(oe!=null){var Ve=C.U,We=B.ba.S,Je=We==mr||We==iu;B=B.ba.f.RGBA;var nt=[0],ut=C.ka;nt[0]=C.T,C.Kb&&(ut==0?--nt[0]:(--ut,Pe[0]-=C.width),C.j+C.ka+C.T==C.o&&(nt[0]=C.o-C.j-ut));var Nt=B.eb;ut=B.fb+ut*B.A,C=Sc(oe,Pe[0],C.width,Ve,nt,Nt,ut+(Je?0:3),B.A),e(ee==nt),C&&si(We)&&Xs(Nt,ut,Je,Ve,nt,B.A)}return 0}function At(C){var B=C.ma,ee=B.ba.S,oe=11>ee,Pe=ee==ua||ee==jc||ee==mr||ee==eo||ee==12||si(ee);if(B.memory=null,B.Ib=null,B.Jb=null,B.Nd=null,!aa(B.Oa,C,Pe?11:12))return 0;if(Pe&&si(ee)&&Fc(),C.da)alert("todo:use_scaling");else{if(oe){if(B.Ib=Lt,C.Kb){if(ee=C.U+1>>1,B.memory=u(C.U+2*ee),B.memory==null)return 0;B.ec=B.memory,B.fc=0,B.cc=B.ec,B.dc=B.fc+C.U,B.Mc=B.cc,B.Nc=B.dc+ee,B.Ib=Rt,Fc()}}else alert("todo:EmitYUV");Pe&&(B.Jb=Ot,oe&&jo())}if(oe&&!tl){for(C=0;256>C;++C)$l[C]=89858*(C-128)+lc>>Ua,La[C]=-22014*(C-128)+lc,Ca[C]=-45773*(C-128),Ju[C]=113618*(C-128)+lc>>Ua;for(C=qo;C<Gi;++C)B=76283*(C-16)+lc>>Ua,Jh[C-qo]=Oi(B,255),uc[C-qo]=Oi(B+8>>4,15);tl=1}return 1}function Pt(C){var B=C.ma,ee=C.U,oe=C.T;return e(!(1&C.ka)),0>=ee||0>=oe?0:(ee=B.Ib(C,B),B.Jb!=null&&B.Jb(C,B,ee),B.Dc+=ee,1)}function xn(C){C.ma.memory=null}function Un(C,B,ee,oe){return xe(C,8)!=47?0:(B[0]=xe(C,14)+1,ee[0]=xe(C,14)+1,oe[0]=xe(C,1),xe(C,3)!=0?0:!C.h)}function In(C,B){if(4>C)return C+1;var ee=C-2>>1;return(2+(1&C)<<ee)+xe(B,ee)+1}function kr(C,B){return 120<B?B-120:1<=(ee=((ee=Ri[B-1])>>4)*C+(8-(15&ee)))?ee:1;var ee}function Lr(C,B,ee){var oe=Be(ee),Pe=C[B+=255&oe].g-8;return 0<Pe&&(rt(ee,ee.u+8),oe=Be(ee),B+=C[B].value,B+=oe&(1<<Pe)-1),rt(ee,ee.u+C[B].g),C[B].value}function jr(C,B,ee){return ee.g+=C.g,ee.value+=C.value<<B>>>0,e(8>=ee.g),C.g}function Er(C,B,ee){var oe=C.xc;return e((B=oe==0?0:C.vc[C.md*(ee>>oe)+(B>>oe)])<C.Wb),C.Ya[B]}function Ei(C,B,ee,oe){var Pe=C.ab,Ve=C.c*B,We=C.C;B=We+B;var Je=ee,nt=oe;for(oe=C.Ta,ee=C.Ua;0<Pe--;){var ut=C.gc[Pe],Nt=We,Yt=B,dt=Je,jt=nt,Qt=(nt=oe,Je=ee,ut.Ea);switch(e(Nt<Yt),e(Yt<=ut.nc),ut.hc){case 2:vs(dt,jt,(Yt-Nt)*Qt,nt,Je);break;case 0:var En=Nt,y=Yt,a=nt,f=Je,v=(G=ut).Ea;En==0&&(Fa(dt,jt,null,null,1,a,f),Rr(dt,jt+1,0,0,v-1,a,f+1),jt+=v,f+=v,++En);for(var S=1<<G.b,T=S-1,N=Ln(v,G.b),z=G.K,G=G.w+(En>>G.b)*N;En<y;){var Q=z,te=G,ge=1;for(Ul(dt,jt,a,f-v,1,a,f);ge<v;){var Ae=(ge&~T)+S;Ae>v&&(Ae=v),(0,bc[Q[te++]>>8&15])(dt,jt+ +ge,a,f+ge-v,Ae-ge,a,f+ge),ge=Ae}jt+=v,f+=v,++En&T||(G+=N)}Yt!=ut.nc&&i(nt,Je-Qt,nt,Je+(Yt-Nt-1)*Qt,Qt);break;case 1:for(Qt=dt,y=jt,v=(dt=ut.Ea)-(f=dt&~(a=(jt=1<<ut.b)-1)),En=Ln(dt,ut.b),S=ut.K,ut=ut.w+(Nt>>ut.b)*En;Nt<Yt;){for(T=S,N=ut,z=new Kr,G=y+f,Q=y+dt;y<G;)Tr(T[N++],z),eu(z,Qt,y,jt,nt,Je),y+=jt,Je+=jt;y<Q&&(Tr(T[N++],z),eu(z,Qt,y,v,nt,Je),y+=v,Je+=v),++Nt&a||(ut+=En)}break;case 3:if(dt==nt&&jt==Je&&0<ut.b){for(y=nt,dt=Qt=Je+(Yt-Nt)*Qt-(f=(Yt-Nt)*Ln(ut.Ea,ut.b)),jt=nt,a=Je,En=[],f=(v=f)-1;0<=f;--f)En[f]=jt[a+f];for(f=v-1;0<=f;--f)y[dt+f]=En[f];Uo(ut,Nt,Yt,nt,Qt,nt,Je)}else Uo(ut,Nt,Yt,dt,jt,nt,Je)}Je=oe,nt=ee}nt!=ee&&i(oe,ee,Je,nt,Ve)}function oo(C,B){var ee=C.V,oe=C.Ba+C.c*C.C,Pe=B-C.C;if(e(B<=C.l.o),e(16>=Pe),0<Pe){var Ve=C.l,We=C.Ta,Je=C.Ua,nt=Ve.width;if(Ei(C,Pe,ee,oe),Pe=Je=[Je],e((ee=C.C)<(oe=B)),e(Ve.v<Ve.va),oe>Ve.o&&(oe=Ve.o),ee<Ve.j){var ut=Ve.j-ee;ee=Ve.j,Pe[0]+=ut*nt}if(ee>=oe?ee=0:(Pe[0]+=4*Ve.v,Ve.ka=ee-Ve.j,Ve.U=Ve.va-Ve.v,Ve.T=oe-ee,ee=1),ee){if(Je=Je[0],11>(ee=C.ca).S){var Nt=ee.f.RGBA,Yt=(oe=ee.S,Pe=Ve.U,Ve=Ve.T,ut=Nt.eb,Nt.A),dt=Ve;for(Nt=Nt.fb+C.Ma*Nt.A;0<dt--;){var jt=We,Qt=Je,En=Pe,y=ut,a=Nt;switch(oe){case Ec:Oa(jt,Qt,En,y,a);break;case ua:sc(jt,Qt,En,y,a);break;case ru:sc(jt,Qt,En,y,a),Xs(y,a,0,En,1,0);break;case bh:wc(jt,Qt,En,y,a);break;case jc:Or(jt,Qt,En,y,a,1);break;case ac:Or(jt,Qt,En,y,a,1),Xs(y,a,0,En,1,0);break;case mr:Or(jt,Qt,En,y,a,0);break;case iu:Or(jt,Qt,En,y,a,0),Xs(y,a,1,En,1,0);break;case eo:Sl(jt,Qt,En,y,a);break;case ou:Sl(jt,Qt,En,y,a),vu(y,a,En,1,0);break;case pl:Vl(jt,Qt,En,y,a);break;default:e(0)}Je+=nt,Nt+=Yt}C.Ma+=Ve}else alert("todo:EmitRescaledRowsYUVA");e(C.Ma<=ee.height)}}C.C=B,e(C.C<=C.i)}function _o(C){var B;if(0<C.ua)return 0;for(B=0;B<C.Wb;++B){var ee=C.Ya[B].G,oe=C.Ya[B].H;if(0<ee[1][oe[1]+0].g||0<ee[2][oe[2]+0].g||0<ee[3][oe[3]+0].g)return 0}return 1}function Ho(C,B,ee,oe,Pe,Ve){if(C.Z!=0){var We=C.qd,Je=C.rd;for(e(to[C.Z]!=null);B<ee;++B)to[C.Z](We,Je,oe,Pe,oe,Pe,Ve),We=oe,Je=Pe,Pe+=Ve;C.qd=We,C.rd=Je}}function so(C,B){var ee=C.l.ma,oe=ee.Z==0||ee.Z==1?C.l.j:C.C;if(oe=C.C<oe?oe:C.C,e(B<=C.l.o),B>oe){var Pe=C.l.width,Ve=ee.ca,We=ee.tb+Pe*oe,Je=C.V,nt=C.Ba+C.c*oe,ut=C.gc;e(C.ab==1),e(ut[0].hc==3),Ks(ut[0],oe,B,Je,nt,Ve,We),Ho(ee,oe,B,Ve,We,Pe)}C.C=C.Ma=B}function _s(C,B,ee,oe,Pe,Ve,We){var Je=C.$/oe,nt=C.$%oe,ut=C.m,Nt=C.s,Yt=ee+C.$,dt=Yt;Pe=ee+oe*Pe;var jt=ee+oe*Ve,Qt=280+Nt.ua,En=C.Pb?Je:16777216,y=0<Nt.ua?Nt.Wa:null,a=Nt.wc,f=Yt<jt?Er(Nt,nt,Je):null;e(C.C<Ve),e(jt<=Pe);var v=!1;e:for(;;){for(;v||Yt<jt;){var S=0;if(Je>=En){var T=Yt-ee;e((En=C).Pb),En.wd=En.m,En.xd=T,0<En.s.ua&&dr(En.s.Wa,En.s.vb),En=Je+Rh}if(nt&a||(f=Er(Nt,nt,Je)),e(f!=null),f.Qb&&(B[Yt]=f.qb,v=!0),!v)if(gt(ut),f.jc){S=ut,T=B;var N=Yt,z=f.pd[Be(S)&xc-1];e(f.jc),256>z.g?(rt(S,S.u+z.g),T[N]=z.value,S=0):(rt(S,S.u+z.g-256),e(256<=z.value),S=z.value),S==0&&(v=!0)}else S=Lr(f.G[0],f.H[0],ut);if(ut.h)break;if(v||256>S){if(!v)if(f.nd)B[Yt]=(f.qb|S<<8)>>>0;else{if(gt(ut),v=Lr(f.G[1],f.H[1],ut),gt(ut),T=Lr(f.G[2],f.H[2],ut),N=Lr(f.G[3],f.H[3],ut),ut.h)break;B[Yt]=(N<<24|v<<16|S<<8|T)>>>0}if(v=!1,++Yt,++nt>=oe&&(nt=0,++Je,We!=null&&Je<=Ve&&!(Je%16)&&We(C,Je),y!=null))for(;dt<Yt;)S=B[dt++],y.X[(506832829*S&4294967295)>>>y.Mb]=S}else if(280>S){if(S=In(S-256,ut),T=Lr(f.G[4],f.H[4],ut),gt(ut),T=kr(oe,T=In(T,ut)),ut.h)break;if(Yt-ee<T||Pe-Yt<S)break e;for(N=0;N<S;++N)B[Yt+N]=B[Yt+N-T];for(Yt+=S,nt+=S;nt>=oe;)nt-=oe,++Je,We!=null&&Je<=Ve&&!(Je%16)&&We(C,Je);if(e(Yt<=Pe),nt&a&&(f=Er(Nt,nt,Je)),y!=null)for(;dt<Yt;)S=B[dt++],y.X[(506832829*S&4294967295)>>>y.Mb]=S}else{if(!(S<Qt))break e;for(v=S-280,e(y!=null);dt<Yt;)S=B[dt++],y.X[(506832829*S&4294967295)>>>y.Mb]=S;S=Yt,e(!(v>>>(T=y).Xa)),B[S]=T.X[v],v=!0}v||e(ut.h==Qe(ut))}if(C.Pb&&ut.h&&Yt<Pe)e(C.m.h),C.a=5,C.m=C.wd,C.$=C.xd,0<C.s.ua&&dr(C.s.vb,C.s.Wa);else{if(ut.h)break e;We?.(C,Je>Ve?Ve:Je),C.a=0,C.$=Yt-ee}return 1}return C.a=3,0}function ao(C){e(C!=null),C.vc=null,C.yc=null,C.Ya=null;var B=C.Wa;B!=null&&(B.X=null),C.vb=null,e(C!=null)}function Cs(){var C=new Hr;return C==null?null:(C.a=0,C.xb=su,hi("Predictor","VP8LPredictors"),hi("Predictor","VP8LPredictors_C"),hi("PredictorAdd","VP8LPredictorsAdd"),hi("PredictorAdd","VP8LPredictorsAdd_C"),vs=vr,eu=Ir,Oa=Si,sc=ki,Sl=or,Vl=oi,wc=Gr,F.VP8LMapColor32b=Aa,F.VP8LMapColor8b=yu,C)}function ma(C,B,ee,oe,Pe){var Ve=1,We=[C],Je=[B],nt=oe.m,ut=oe.s,Nt=null,Yt=0;e:for(;;){if(ee)for(;Ve&&xe(nt,1);){var dt=We,jt=Je,Qt=oe,En=1,y=Qt.m,a=Qt.gc[Qt.ab],f=xe(y,2);if(Qt.Oc&1<<f)Ve=0;else{switch(Qt.Oc|=1<<f,a.hc=f,a.Ea=dt[0],a.nc=jt[0],a.K=[null],++Qt.ab,e(4>=Qt.ab),f){case 0:case 1:a.b=xe(y,3)+2,En=ma(Ln(a.Ea,a.b),Ln(a.nc,a.b),0,Qt,a.K),a.K=a.K[0];break;case 3:var v,S=xe(y,8)+1,T=16<S?0:4<S?1:2<S?2:3;if(dt[0]=Ln(a.Ea,T),a.b=T,v=En=ma(S,1,0,Qt,a.K)){var N,z=S,G=a,Q=1<<(8>>G.b),te=u(Q);if(te==null)v=0;else{var ge=G.K[0],Ae=G.w;for(te[0]=G.K[0][0],N=1;N<1*z;++N)te[N]=ir(ge[Ae+N],te[N-1]);for(;N<4*Q;++N)te[N]=0;G.K[0]=null,G.K[0]=te,v=1}}En=v;break;case 2:break;default:e(0)}Ve=En}}if(We=We[0],Je=Je[0],Ve&&xe(nt,1)&&!(Ve=1<=(Yt=xe(nt,4))&&11>=Yt)){oe.a=3;break e}var Le;if(Le=Ve)t:{var Xe,Ue,Ze,_e=oe,$e=We,it=Je,st=Yt,bt=ee,wt=_e.m,vt=_e.s,kt=[null],Tt=1,Vt=0,vn=ha[st];n:for(;;){if(bt&&xe(wt,1)){var Bt=xe(wt,3)+2,ln=Ln($e,Bt),Wt=Ln(it,Bt),Cn=ln*Wt;if(!ma(ln,Wt,0,_e,kt))break n;for(kt=kt[0],vt.xc=Bt,Xe=0;Xe<Cn;++Xe){var Ut=kt[Xe]>>8&65535;kt[Xe]=Ut,Ut>=Tt&&(Tt=Ut+1)}}if(wt.h)break n;for(Ue=0;5>Ue;++Ue){var rn=Vo[Ue];!Ue&&0<st&&(rn+=1<<st),Vt<rn&&(Vt=rn)}var Tn=m(Tt*vn,Z),cn=Tt,Nn=m(cn,Re);if(Nn==null)var hr=null;else e(65536>=cn),hr=Nn;var Dr=u(Vt);if(hr==null||Dr==null||Tn==null){_e.a=1;break n}var rr=Tn;for(Xe=Ze=0;Xe<Tt;++Xe){var Jn=hr[Xe],ni=Jn.G,mi=Jn.H,xr=0,Ii=1,Ci=0;for(Ue=0;5>Ue;++Ue){rn=Vo[Ue],ni[Ue]=rr,mi[Ue]=Ze,!Ue&&0<st&&(rn+=1<<st);i:{var Ni,fo=rn,Rs=_e,hs=Dr,hc=rr,Tc=Ze,Li=0,no=Rs.m,po=xe(no,1);if(c(hs,0,0,fo),po){var Ms=xe(no,1)+1,nl=xe(no,1),$o=xe(no,nl==0?1:8);hs[$o]=1,Ms==2&&(hs[$o=xe(no,8)]=1);var Ns=1}else{var ps=u(19),ns=xe(no,4)+4;if(19<ns){Rs.a=3;var xs=0;break i}for(Ni=0;Ni<ns;++Ni)ps[_a[Ni]]=xe(no,3);var dc=void 0,Ds=void 0,Ic=Rs,yd=ps,Ys=fo,Fh=hs,_d=0,Fu=Ic.m,Ou=8,Cc=m(128,Z);r:for(;H(Cc,0,7,yd,19);){if(xe(Fu,1)){var th=2+2*xe(Fu,3);if((dc=2+xe(Fu,th))>Ys)break r}else dc=Ys;for(Ds=0;Ds<Ys&&dc--;){gt(Fu);var vd=Cc[0+(127&Be(Fu))];rt(Fu,Fu.u+vd.g);var nh=vd.value;if(16>nh)Fh[Ds++]=nh,nh!=0&&(Ou=nh);else{var Eh=nh==16,Hl=nh-16,Qh=Ts[Hl],xd=xe(Fu,An[Hl])+Qh;if(Ds+xd>Ys)break r;for(var ed=Eh?Ou:0;0<xd--;)Fh[Ds++]=ed}}_d=1;break r}_d||(Ic.a=3),Ns=_d}(Ns=Ns&&!no.h)&&(Li=H(hc,Tc,8,hs,fo)),Ns&&Li!=0?xs=Li:(Rs.a=3,xs=0)}if(xs==0)break n;if(Ii&&Tl[Ue]==1&&(Ii=rr[Ze].g==0),xr+=rr[Ze].g,Ze+=xs,3>=Ue){var bd,Oh=Dr[0];for(bd=1;bd<rn;++bd)Dr[bd]>Oh&&(Oh=Dr[bd]);Ci+=Oh}}if(Jn.nd=Ii,Jn.Qb=0,Ii&&(Jn.qb=(ni[3][mi[3]+0].value<<24|ni[1][mi[1]+0].value<<16|ni[2][mi[2]+0].value)>>>0,xr==0&&256>ni[0][mi[0]+0].value&&(Jn.Qb=1,Jn.qb+=ni[0][mi[0]+0].value<<8)),Jn.jc=!Jn.Qb&&6>Ci,Jn.jc){var Od,Ll=Jn;for(Od=0;Od<xc;++Od){var Pl=Od,fc=Ll.pd[Pl],Lc=Ll.G[0][Ll.H[0]+Pl];256<=Lc.value?(fc.g=Lc.g+256,fc.value=Lc.value):(fc.g=0,fc.value=0,Pl>>=jr(Lc,8,fc),Pl>>=jr(Ll.G[1][Ll.H[1]+Pl],16,fc),Pl>>=jr(Ll.G[2][Ll.H[2]+Pl],0,fc),jr(Ll.G[3][Ll.H[3]+Pl],24,fc))}}}vt.vc=kt,vt.Wb=Tt,vt.Ya=hr,vt.yc=Tn,Le=1;break t}Le=0}if(!(Ve=Le)){oe.a=3;break e}if(0<Yt){if(ut.ua=1<<Yt,!ot(ut.Wa,Yt)){oe.a=1,Ve=0;break e}}else ut.ua=0;var Vc=oe,bu=We,rh=Je,ih=Vc.s,ff=ih.xc;if(Vc.c=bu,Vc.i=rh,ih.md=Ln(bu,ff),ih.wc=ff==0?-1:(1<<ff)-1,ee){oe.xb=ja;break e}if((Nt=u(We*Je))==null){oe.a=1,Ve=0;break e}Ve=(Ve=_s(oe,Nt,0,We,Je,Je,null))&&!nt.h;break e}return Ve?(Pe!=null?Pe[0]=Nt:(e(Nt==null),e(ee)),oe.$=0,ee||ao(ut)):ao(ut),Ve}function bl(C,B){var ee=C.c*C.i,oe=ee+B+16*B;return e(C.c<=B),C.V=u(oe),C.V==null?(C.Ta=null,C.Ua=0,C.a=1,0):(C.Ta=C.V,C.Ua=C.Ba+ee+B,1)}function ll(C,B){var ee=C.C,oe=B-ee,Pe=C.V,Ve=C.Ba+C.c*ee;for(e(B<=C.l.o);0<oe;){var We=16<oe?16:oe,Je=C.l.ma,nt=C.l.width,ut=nt*We,Nt=Je.ca,Yt=Je.tb+nt*ee,dt=C.Ta,jt=C.Ua;Ei(C,We,Pe,Ve),fl(dt,jt,Nt,Yt,ut),Ho(Je,ee,ee+We,Nt,Yt,nt),oe-=We,Pe+=We*C.c,ee+=We}e(ee==B),C.C=C.Ma=B}function Hi(){this.ub=this.yd=this.td=this.Rb=0}function nc(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function Lu(){this.Fb=this.Bb=this.Cb=0,this.Zb=u(4),this.Lb=u(4)}function To(){this.Yb=(function(){var C=[];return(function B(ee,oe,Pe){for(var Ve=Pe[oe],We=0;We<Ve&&(ee.push(Pe.length>oe+1?[]:0),!(Pe.length<oe+1));We++)B(ee[We],oe+1,Pe)})(C,0,[3,11]),C})()}function fu(){this.jb=u(3),this.Wc=_([4,8],To),this.Xc=_([4,17],To)}function wa(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new u(4),this.od=new u(4)}function Zo(){this.ld=this.La=this.dd=this.tc=0}function Ha(){this.Na=this.la=0}function Bl(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function rc(){this.ad=u(384),this.Za=0,this.Ob=u(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function Sa(){this.uc=this.M=this.Nb=0,this.wa=Array(new Zo),this.Y=0,this.ya=Array(new rc),this.aa=0,this.l=new Yo}function ra(){this.y=u(16),this.f=u(8),this.ea=u(8)}function mn(){this.cb=this.a=0,this.sc="",this.m=new le,this.Od=new Hi,this.Kc=new nc,this.ed=new wa,this.Qa=new Lu,this.Ic=this.$c=this.Aa=0,this.D=new Sa,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=m(8,le),this.ia=0,this.pb=m(4,Bl),this.Pa=new fu,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new ra),this.Hd=0,this.rb=Array(new Ha),this.sb=0,this.wa=Array(new Zo),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new rc),this.L=this.aa=0,this.gd=_([4,2],Zo),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function Yo(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function ss(){var C=new mn;return C!=null&&(C.a=0,C.sc="OK",C.cb=0,C.Xb=0,xu||(xu=Ka)),C}function _i(C,B,ee){return C.a==0&&(C.a=B,C.sc=ee,C.cb=0),0}function pu(C,B,ee){return 3<=ee&&C[B+0]==157&&C[B+1]==1&&C[B+2]==42}function Wa(C,B){if(C==null)return 0;if(C.a=0,C.sc="OK",B==null)return _i(C,2,"null VP8Io passed to VP8GetHeaders()");var ee=B.data,oe=B.w,Pe=B.ha;if(4>Pe)return _i(C,7,"Truncated header.");var Ve=ee[oe+0]|ee[oe+1]<<8|ee[oe+2]<<16,We=C.Od;if(We.Rb=!(1&Ve),We.td=Ve>>1&7,We.yd=Ve>>4&1,We.ub=Ve>>5,3<We.td)return _i(C,3,"Incorrect keyframe parameters.");if(!We.yd)return _i(C,4,"Frame not displayable.");oe+=3,Pe-=3;var Je=C.Kc;if(We.Rb){if(7>Pe)return _i(C,7,"cannot parse picture header");if(!pu(ee,oe,Pe))return _i(C,3,"Bad code word");Je.c=16383&(ee[oe+4]<<8|ee[oe+3]),Je.Td=ee[oe+4]>>6,Je.i=16383&(ee[oe+6]<<8|ee[oe+5]),Je.Ud=ee[oe+6]>>6,oe+=7,Pe-=7,C.za=Je.c+15>>4,C.Ub=Je.i+15>>4,B.width=Je.c,B.height=Je.i,B.Da=0,B.j=0,B.v=0,B.va=B.width,B.o=B.height,B.da=0,B.ib=B.width,B.hb=B.height,B.U=B.width,B.T=B.height,c((Ve=C.Pa).jb,0,255,Ve.jb.length),e((Ve=C.Qa)!=null),Ve.Cb=0,Ve.Bb=0,Ve.Fb=1,c(Ve.Zb,0,0,Ve.Zb.length),c(Ve.Lb,0,0,Ve.Lb)}if(We.ub>Pe)return _i(C,7,"bad partition length");Oe(Ve=C.m,ee,oe,We.ub),oe+=We.ub,Pe-=We.ub,We.Rb&&(Je.Ld=Mt(Ve),Je.Kd=Mt(Ve)),Je=C.Qa;var nt,ut=C.Pa;if(e(Ve!=null),e(Je!=null),Je.Cb=Mt(Ve),Je.Cb){if(Je.Bb=Mt(Ve),Mt(Ve)){for(Je.Fb=Mt(Ve),nt=0;4>nt;++nt)Je.Zb[nt]=Mt(Ve)?we(Ve,7):0;for(nt=0;4>nt;++nt)Je.Lb[nt]=Mt(Ve)?we(Ve,6):0}if(Je.Bb)for(nt=0;3>nt;++nt)ut.jb[nt]=Mt(Ve)?Me(Ve,8):255}else Je.Bb=0;if(Ve.Ka)return _i(C,3,"cannot parse segment header");if((Je=C.ed).zd=Mt(Ve),Je.Tb=Me(Ve,6),Je.wb=Me(Ve,3),Je.Pc=Mt(Ve),Je.Pc&&Mt(Ve)){for(ut=0;4>ut;++ut)Mt(Ve)&&(Je.vd[ut]=we(Ve,6));for(ut=0;4>ut;++ut)Mt(Ve)&&(Je.od[ut]=we(Ve,6))}if(C.L=Je.Tb==0?0:Je.zd?1:2,Ve.Ka)return _i(C,3,"cannot parse filter header");var Nt=Pe;if(Pe=nt=oe,oe=nt+Nt,Je=Nt,C.Xb=(1<<Me(C.m,2))-1,Nt<3*(ut=C.Xb))ee=7;else{for(nt+=3*ut,Je-=3*ut,Nt=0;Nt<ut;++Nt){var Yt=ee[Pe+0]|ee[Pe+1]<<8|ee[Pe+2]<<16;Yt>Je&&(Yt=Je),Oe(C.Jc[+Nt],ee,nt,Yt),nt+=Yt,Je-=Yt,Pe+=3}Oe(C.Jc[+ut],ee,nt,Je),ee=nt<oe?0:5}if(ee!=0)return _i(C,ee,"cannot parse partitions");for(ee=Me(nt=C.m,7),Pe=Mt(nt)?we(nt,4):0,oe=Mt(nt)?we(nt,4):0,Je=Mt(nt)?we(nt,4):0,ut=Mt(nt)?we(nt,4):0,nt=Mt(nt)?we(nt,4):0,Nt=C.Qa,Yt=0;4>Yt;++Yt){if(Nt.Cb){var dt=Nt.Zb[Yt];Nt.Fb||(dt+=ee)}else{if(0<Yt){C.pb[Yt]=C.pb[0];continue}dt=ee}var jt=C.pb[Yt];jt.Sc[0]=wh[Oi(dt+Pe,127)],jt.Sc[1]=Qr[Oi(dt+0,127)],jt.Eb[0]=2*wh[Oi(dt+oe,127)],jt.Eb[1]=101581*Qr[Oi(dt+Je,127)]>>16,8>jt.Eb[1]&&(jt.Eb[1]=8),jt.Qc[0]=wh[Oi(dt+ut,117)],jt.Qc[1]=Qr[Oi(dt+nt,127)],jt.lc=dt+nt}if(!We.Rb)return _i(C,4,"Not a key frame.");for(Mt(Ve),We=C.Pa,ee=0;4>ee;++ee){for(Pe=0;8>Pe;++Pe)for(oe=0;3>oe;++oe)for(Je=0;11>Je;++Je)ut=Jt(Ve,Du[ee][Pe][oe][Je])?Me(Ve,8):Nh[ee][Pe][oe][Je],We.Wc[ee][Pe].Yb[oe][Je]=ut;for(Pe=0;17>Pe;++Pe)We.Xc[ee][Pe]=We.Wc[ee][gd[Pe]]}return C.kc=Mt(Ve),C.kc&&(C.Bd=Me(Ve,8)),C.cb=1}function Ka(C,B,ee,oe,Pe,Ve,We){var Je=B[Pe].Yb[ee];for(ee=0;16>Pe;++Pe){if(!Jt(C,Je[ee+0]))return Pe;for(;!Jt(C,Je[ee+1]);)if(Je=B[++Pe].Yb[0],ee=0,Pe==16)return 16;var nt=B[Pe+1].Yb;if(Jt(C,Je[ee+2])){var ut=C,Nt=0;if(Jt(ut,(dt=Je)[(Yt=ee)+3]))if(Jt(ut,dt[Yt+6])){for(Je=0,Yt=2*(Nt=Jt(ut,dt[Yt+8]))+(dt=Jt(ut,dt[Yt+9+Nt])),Nt=0,dt=Mh[Yt];dt[Je];++Je)Nt+=Nt+Jt(ut,dt[Je]);Nt+=3+(8<<Yt)}else Jt(ut,dt[Yt+7])?(Nt=7+2*Jt(ut,165),Nt+=Jt(ut,145)):Nt=5+Jt(ut,159);else Nt=Jt(ut,dt[Yt+4])?3+Jt(ut,dt[Yt+5]):2;Je=nt[2]}else Nt=1,Je=nt[1];nt=We+Zs[Pe],0>(ut=C).b&&pt(ut);var Yt,dt=ut.b,jt=(Yt=ut.Ca>>1)-(ut.I>>dt)>>31;--ut.b,ut.Ca+=jt,ut.Ca|=1,ut.I-=(Yt+1&jt)<<dt,Ve[nt]=((Nt^jt)-jt)*oe[(0<Pe)+0]}return 16}function cl(C){var B=C.rb[C.sb-1];B.la=0,B.Na=0,c(C.zc,0,0,C.zc.length),C.ja=0}function Ls(C,B,ee,oe,Pe){Pe=C[B+ee+32*oe]+(Pe>>3),C[B+ee+32*oe]=-256&Pe?0>Pe?0:255:Pe}function er(C,B,ee,oe,Pe,Ve){Ls(C,B,0,ee,oe+Pe),Ls(C,B,1,ee,oe+Ve),Ls(C,B,2,ee,oe-Ve),Ls(C,B,3,ee,oe-Pe)}function Br(C){return(20091*C>>16)+C}function Mr(C,B,ee,oe){var Pe,Ve=0,We=u(16);for(Pe=0;4>Pe;++Pe){var Je=C[B+0]+C[B+8],nt=C[B+0]-C[B+8],ut=(35468*C[B+4]>>16)-Br(C[B+12]),Nt=Br(C[B+4])+(35468*C[B+12]>>16);We[Ve+0]=Je+Nt,We[Ve+1]=nt+ut,We[Ve+2]=nt-ut,We[Ve+3]=Je-Nt,Ve+=4,B++}for(Pe=Ve=0;4>Pe;++Pe)Je=(C=We[Ve+0]+4)+We[Ve+8],nt=C-We[Ve+8],ut=(35468*We[Ve+4]>>16)-Br(We[Ve+12]),Ls(ee,oe,0,0,Je+(Nt=Br(We[Ve+4])+(35468*We[Ve+12]>>16))),Ls(ee,oe,1,0,nt+ut),Ls(ee,oe,2,0,nt-ut),Ls(ee,oe,3,0,Je-Nt),Ve++,oe+=32}function js(C,B,ee,oe){var Pe=C[B+0]+4,Ve=35468*C[B+4]>>16,We=Br(C[B+4]),Je=35468*C[B+1]>>16;er(ee,oe,0,Pe+We,C=Br(C[B+1]),Je),er(ee,oe,1,Pe+Ve,C,Je),er(ee,oe,2,Pe-Ve,C,Je),er(ee,oe,3,Pe-We,C,Je)}function Ea(C,B,ee,oe,Pe){Mr(C,B,ee,oe),Pe&&Mr(C,B+16,ee,oe+4)}function vi(C,B,ee,oe){Oc(C,B+0,ee,oe,1),Oc(C,B+32,ee,oe+128,1)}function Mi(C,B,ee,oe){var Pe;for(C=C[B+0]+4,Pe=0;4>Pe;++Pe)for(B=0;4>B;++B)Ls(ee,oe,B,Pe,C)}function wl(C,B,ee,oe){C[B+0]&&Xo(C,B+0,ee,oe),C[B+16]&&Xo(C,B+16,ee,oe+4),C[B+32]&&Xo(C,B+32,ee,oe+128),C[B+48]&&Xo(C,B+48,ee,oe+128+4)}function qi(C,B,ee,oe){var Pe,Ve=u(16);for(Pe=0;4>Pe;++Pe){var We=C[B+0+Pe]+C[B+12+Pe],Je=C[B+4+Pe]+C[B+8+Pe],nt=C[B+4+Pe]-C[B+8+Pe],ut=C[B+0+Pe]-C[B+12+Pe];Ve[0+Pe]=We+Je,Ve[8+Pe]=We-Je,Ve[4+Pe]=ut+nt,Ve[12+Pe]=ut-nt}for(Pe=0;4>Pe;++Pe)We=(C=Ve[0+4*Pe]+3)+Ve[3+4*Pe],Je=Ve[1+4*Pe]+Ve[2+4*Pe],nt=Ve[1+4*Pe]-Ve[2+4*Pe],ut=C-Ve[3+4*Pe],ee[oe+0]=We+Je>>3,ee[oe+16]=ut+nt>>3,ee[oe+32]=We-Je>>3,ee[oe+48]=ut-nt>>3,oe+=64}function fs(C,B,ee){var oe,Pe=B-32,Ve=Ta,We=255-C[Pe-1];for(oe=0;oe<ee;++oe){var Je,nt=Ve,ut=We+C[B-1];for(Je=0;Je<ee;++Je)C[B+Je]=nt[ut+C[Pe+Je]];B+=32}}function zi(C,B){fs(C,B,4)}function mu(C,B){fs(C,B,8)}function ic(C,B){fs(C,B,16)}function Jc(C,B){var ee;for(ee=0;16>ee;++ee)i(C,B+32*ee,C,B-32,16)}function yc(C,B){var ee;for(ee=16;0<ee;--ee)c(C,B,C[B-1],16),B+=32}function oc(C,B,ee){var oe;for(oe=0;16>oe;++oe)c(B,ee+32*oe,C,16)}function Ma(C,B){var ee,oe=16;for(ee=0;16>ee;++ee)oe+=C[B-1+32*ee]+C[B+ee-32];oc(oe>>5,C,B)}function Ps(C,B){var ee,oe=8;for(ee=0;16>ee;++ee)oe+=C[B-1+32*ee];oc(oe>>4,C,B)}function ji(C,B){var ee,oe=8;for(ee=0;16>ee;++ee)oe+=C[B+ee-32];oc(oe>>4,C,B)}function Na(C,B){oc(128,C,B)}function ai(C,B,ee){return C+2*B+ee+2>>2}function Jo(C,B){var ee,oe=B-32;for(oe=new Uint8Array([ai(C[oe-1],C[oe+0],C[oe+1]),ai(C[oe+0],C[oe+1],C[oe+2]),ai(C[oe+1],C[oe+2],C[oe+3]),ai(C[oe+2],C[oe+3],C[oe+4])]),ee=0;4>ee;++ee)i(C,B+32*ee,oe,0,oe.length)}function Io(C,B){var ee=C[B-1],oe=C[B-1+32],Pe=C[B-1+64],Ve=C[B-1+96];hn(C,B+0,16843009*ai(C[B-1-32],ee,oe)),hn(C,B+32,16843009*ai(ee,oe,Pe)),hn(C,B+64,16843009*ai(oe,Pe,Ve)),hn(C,B+96,16843009*ai(Pe,Ve,Ve))}function vh(C,B){var ee,oe=4;for(ee=0;4>ee;++ee)oe+=C[B+ee-32]+C[B-1+32*ee];for(oe>>=3,ee=0;4>ee;++ee)c(C,B+32*ee,oe,4)}function Pu(C,B){var ee=C[B-1+0],oe=C[B-1+32],Pe=C[B-1+64],Ve=C[B-1-32],We=C[B+0-32],Je=C[B+1-32],nt=C[B+2-32],ut=C[B+3-32];C[B+0+96]=ai(oe,Pe,C[B-1+96]),C[B+1+96]=C[B+0+64]=ai(ee,oe,Pe),C[B+2+96]=C[B+1+64]=C[B+0+32]=ai(Ve,ee,oe),C[B+3+96]=C[B+2+64]=C[B+1+32]=C[B+0+0]=ai(We,Ve,ee),C[B+3+64]=C[B+2+32]=C[B+1+0]=ai(Je,We,Ve),C[B+3+32]=C[B+2+0]=ai(nt,Je,We),C[B+3+0]=ai(ut,nt,Je)}function vo(C,B){var ee=C[B+1-32],oe=C[B+2-32],Pe=C[B+3-32],Ve=C[B+4-32],We=C[B+5-32],Je=C[B+6-32],nt=C[B+7-32];C[B+0+0]=ai(C[B+0-32],ee,oe),C[B+1+0]=C[B+0+32]=ai(ee,oe,Pe),C[B+2+0]=C[B+1+32]=C[B+0+64]=ai(oe,Pe,Ve),C[B+3+0]=C[B+2+32]=C[B+1+64]=C[B+0+96]=ai(Pe,Ve,We),C[B+3+32]=C[B+2+64]=C[B+1+96]=ai(Ve,We,Je),C[B+3+64]=C[B+2+96]=ai(We,Je,nt),C[B+3+96]=ai(Je,nt,nt)}function Us(C,B){var ee=C[B-1+0],oe=C[B-1+32],Pe=C[B-1+64],Ve=C[B-1-32],We=C[B+0-32],Je=C[B+1-32],nt=C[B+2-32],ut=C[B+3-32];C[B+0+0]=C[B+1+64]=Ve+We+1>>1,C[B+1+0]=C[B+2+64]=We+Je+1>>1,C[B+2+0]=C[B+3+64]=Je+nt+1>>1,C[B+3+0]=nt+ut+1>>1,C[B+0+96]=ai(Pe,oe,ee),C[B+0+64]=ai(oe,ee,Ve),C[B+0+32]=C[B+1+96]=ai(ee,Ve,We),C[B+1+32]=C[B+2+96]=ai(Ve,We,Je),C[B+2+32]=C[B+3+96]=ai(We,Je,nt),C[B+3+32]=ai(Je,nt,ut)}function ku(C,B){var ee=C[B+0-32],oe=C[B+1-32],Pe=C[B+2-32],Ve=C[B+3-32],We=C[B+4-32],Je=C[B+5-32],nt=C[B+6-32],ut=C[B+7-32];C[B+0+0]=ee+oe+1>>1,C[B+1+0]=C[B+0+64]=oe+Pe+1>>1,C[B+2+0]=C[B+1+64]=Pe+Ve+1>>1,C[B+3+0]=C[B+2+64]=Ve+We+1>>1,C[B+0+32]=ai(ee,oe,Pe),C[B+1+32]=C[B+0+96]=ai(oe,Pe,Ve),C[B+2+32]=C[B+1+96]=ai(Pe,Ve,We),C[B+3+32]=C[B+2+96]=ai(Ve,We,Je),C[B+3+64]=ai(We,Je,nt),C[B+3+96]=ai(Je,nt,ut)}function Wo(C,B){var ee=C[B-1+0],oe=C[B-1+32],Pe=C[B-1+64],Ve=C[B-1+96];C[B+0+0]=ee+oe+1>>1,C[B+2+0]=C[B+0+32]=oe+Pe+1>>1,C[B+2+32]=C[B+0+64]=Pe+Ve+1>>1,C[B+1+0]=ai(ee,oe,Pe),C[B+3+0]=C[B+1+32]=ai(oe,Pe,Ve),C[B+3+32]=C[B+1+64]=ai(Pe,Ve,Ve),C[B+3+64]=C[B+2+64]=C[B+0+96]=C[B+1+96]=C[B+2+96]=C[B+3+96]=Ve}function xo(C,B){var ee=C[B-1+0],oe=C[B-1+32],Pe=C[B-1+64],Ve=C[B-1+96],We=C[B-1-32],Je=C[B+0-32],nt=C[B+1-32],ut=C[B+2-32];C[B+0+0]=C[B+2+32]=ee+We+1>>1,C[B+0+32]=C[B+2+64]=oe+ee+1>>1,C[B+0+64]=C[B+2+96]=Pe+oe+1>>1,C[B+0+96]=Ve+Pe+1>>1,C[B+3+0]=ai(Je,nt,ut),C[B+2+0]=ai(We,Je,nt),C[B+1+0]=C[B+3+32]=ai(ee,We,Je),C[B+1+32]=C[B+3+64]=ai(oe,ee,We),C[B+1+64]=C[B+3+96]=ai(Pe,oe,ee),C[B+1+96]=ai(Ve,Pe,oe)}function zl(C,B){var ee;for(ee=0;8>ee;++ee)i(C,B+32*ee,C,B-32,8)}function Da(C,B){var ee;for(ee=0;8>ee;++ee)c(C,B,C[B-1],8),B+=32}function Vs(C,B,ee){var oe;for(oe=0;8>oe;++oe)c(B,ee+32*oe,C,8)}function Bo(C,B){var ee,oe=8;for(ee=0;8>ee;++ee)oe+=C[B+ee-32]+C[B-1+32*ee];Vs(oe>>4,C,B)}function Dc(C,B){var ee,oe=4;for(ee=0;8>ee;++ee)oe+=C[B+ee-32];Vs(oe>>3,C,B)}function Ko(C,B){var ee,oe=4;for(ee=0;8>ee;++ee)oe+=C[B-1+32*ee];Vs(oe>>3,C,B)}function ga(C,B){Vs(128,C,B)}function Xa(C,B,ee){var oe=C[B-ee],Pe=C[B+0],Ve=3*(Pe-oe)+Ba[1020+C[B-2*ee]-C[B+ee]],We=Ya[112+(Ve+4>>3)];C[B-ee]=Ta[255+oe+Ya[112+(Ve+3>>3)]],C[B+0]=Ta[255+Pe-We]}function ul(C,B,ee,oe){var Pe=C[B+0],Ve=C[B+ee];return Ja[255+C[B-2*ee]-C[B-ee]]>oe||Ja[255+Ve-Pe]>oe}function Qc(C,B,ee,oe){return 4*Ja[255+C[B-ee]-C[B+0]]+Ja[255+C[B-2*ee]-C[B+ee]]<=oe}function _c(C,B,ee,oe,Pe){var Ve=C[B-3*ee],We=C[B-2*ee],Je=C[B-ee],nt=C[B+0],ut=C[B+ee],Nt=C[B+2*ee],Yt=C[B+3*ee];return 4*Ja[255+Je-nt]+Ja[255+We-ut]>oe?0:Ja[255+C[B-4*ee]-Ve]<=Pe&&Ja[255+Ve-We]<=Pe&&Ja[255+We-Je]<=Pe&&Ja[255+Yt-Nt]<=Pe&&Ja[255+Nt-ut]<=Pe&&Ja[255+ut-nt]<=Pe}function qs(C,B,ee,oe){var Pe=2*oe+1;for(oe=0;16>oe;++oe)Qc(C,B+oe,ee,Pe)&&Xa(C,B+oe,ee)}function Ai(C,B,ee,oe){var Pe=2*oe+1;for(oe=0;16>oe;++oe)Qc(C,B+oe*ee,1,Pe)&&Xa(C,B+oe*ee,1)}function Ss(C,B,ee,oe){var Pe;for(Pe=3;0<Pe;--Pe)qs(C,B+=4*ee,ee,oe)}function $s(C,B,ee,oe){var Pe;for(Pe=3;0<Pe;--Pe)Ai(C,B+=4,ee,oe)}function ia(C,B,ee,oe,Pe,Ve,We,Je){for(Ve=2*Ve+1;0<Pe--;){if(_c(C,B,ee,Ve,We))if(ul(C,B,ee,Je))Xa(C,B,ee);else{var nt=C,ut=B,Nt=ee,Yt=nt[ut-2*Nt],dt=nt[ut-Nt],jt=nt[ut+0],Qt=nt[ut+Nt],En=nt[ut+2*Nt],y=27*(f=Ba[1020+3*(jt-dt)+Ba[1020+Yt-Qt]])+63>>7,a=18*f+63>>7,f=9*f+63>>7;nt[ut-3*Nt]=Ta[255+nt[ut-3*Nt]+f],nt[ut-2*Nt]=Ta[255+Yt+a],nt[ut-Nt]=Ta[255+dt+y],nt[ut+0]=Ta[255+jt-y],nt[ut+Nt]=Ta[255+Qt-a],nt[ut+2*Nt]=Ta[255+En-f]}B+=oe}}function oa(C,B,ee,oe,Pe,Ve,We,Je){for(Ve=2*Ve+1;0<Pe--;){if(_c(C,B,ee,Ve,We))if(ul(C,B,ee,Je))Xa(C,B,ee);else{var nt=C,ut=B,Nt=ee,Yt=nt[ut-Nt],dt=nt[ut+0],jt=nt[ut+Nt],Qt=Ya[112+(4+(En=3*(dt-Yt))>>3)],En=Ya[112+(En+3>>3)],y=Qt+1>>1;nt[ut-2*Nt]=Ta[255+nt[ut-2*Nt]+y],nt[ut-Nt]=Ta[255+Yt+En],nt[ut+0]=Ta[255+dt-Qt],nt[ut+Nt]=Ta[255+jt-y]}B+=oe}}function hl(C,B,ee,oe,Pe,Ve){ia(C,B,ee,1,16,oe,Pe,Ve)}function Gs(C,B,ee,oe,Pe,Ve){ia(C,B,1,ee,16,oe,Pe,Ve)}function Hs(C,B,ee,oe,Pe,Ve){var We;for(We=3;0<We;--We)oa(C,B+=4*ee,ee,1,16,oe,Pe,Ve)}function vc(C,B,ee,oe,Pe,Ve){var We;for(We=3;0<We;--We)oa(C,B+=4,1,ee,16,oe,Pe,Ve)}function W(C,B,ee,oe,Pe,Ve,We,Je){ia(C,B,Pe,1,8,Ve,We,Je),ia(ee,oe,Pe,1,8,Ve,We,Je)}function Ce(C,B,ee,oe,Pe,Ve,We,Je){ia(C,B,1,Pe,8,Ve,We,Je),ia(ee,oe,1,Pe,8,Ve,We,Je)}function mt(C,B,ee,oe,Pe,Ve,We,Je){oa(C,B+4*Pe,Pe,1,8,Ve,We,Je),oa(ee,oe+4*Pe,Pe,1,8,Ve,We,Je)}function yt(C,B,ee,oe,Pe,Ve,We,Je){oa(C,B+4,1,Pe,8,Ve,We,Je),oa(ee,oe+4,1,Pe,8,Ve,We,Je)}function $t(){this.ba=new Te,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new ht,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function Zt(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function zn(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function Nr(){this.ua=0,this.Wa=new wr,this.vb=new wr,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new Re,this.yc=new Z}function Hr(){this.xb=this.a=0,this.l=new Yo,this.ca=new Te,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new Ne,this.Pb=0,this.wd=new Ne,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new Nr,this.ab=0,this.gc=m(4,zn),this.Oc=0}function gi(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new Yo,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function Ti(C,B,ee,oe,Pe,Ve,We){for(C=C==null?0:C[B+0],B=0;B<We;++B)Pe[Ve+B]=C+ee[oe+B]&255,C=Pe[Ve+B]}function bo(C,B,ee,oe,Pe,Ve,We){var Je;if(C==null)Ti(null,null,ee,oe,Pe,Ve,We);else for(Je=0;Je<We;++Je)Pe[Ve+Je]=C[B+Je]+ee[oe+Je]&255}function wo(C,B,ee,oe,Pe,Ve,We){if(C==null)Ti(null,null,ee,oe,Pe,Ve,We);else{var Je,nt=C[B+0],ut=nt,Nt=nt;for(Je=0;Je<We;++Je)ut=Nt+(nt=C[B+Je])-ut,Nt=ee[oe+Je]+(-256&ut?0>ut?0:255:ut)&255,ut=nt,Pe[Ve+Je]=Nt}}function Qo(C,B,ee,oe){var Pe=B.width,Ve=B.o;if(e(C!=null&&B!=null),0>ee||0>=oe||ee+oe>Ve)return null;if(!C.Cc){if(C.ga==null){var We;if(C.ga=new gi,(We=C.ga==null)||(We=B.width*B.o,e(C.Gb.length==0),C.Gb=u(We),C.Uc=0,C.Gb==null?We=0:(C.mb=C.Gb,C.nb=C.Uc,C.rc=null,We=1),We=!We),!We){We=C.ga;var Je=C.Fa,nt=C.P,ut=C.qc,Nt=C.mb,Yt=C.nb,dt=nt+1,jt=ut-1,Qt=We.l;if(e(Je!=null&&Nt!=null&&B!=null),to[0]=null,to[1]=Ti,to[2]=bo,to[3]=wo,We.ca=Nt,We.tb=Yt,We.c=B.width,We.i=B.height,e(0<We.c&&0<We.i),1>=ut)B=0;else if(We.$a=3&Je[nt+0],We.Z=Je[nt+0]>>2&3,We.Lc=Je[nt+0]>>4&3,nt=Je[nt+0]>>6&3,0>We.$a||1<We.$a||4<=We.Z||1<We.Lc||nt)B=0;else if(Qt.put=Pt,Qt.ac=At,Qt.bc=xn,Qt.ma=We,Qt.width=B.width,Qt.height=B.height,Qt.Da=B.Da,Qt.v=B.v,Qt.va=B.va,Qt.j=B.j,Qt.o=B.o,We.$a)e:{e(We.$a==1),B=Cs();t:for(;;){if(B==null){B=0;break e}if(e(We!=null),We.mc=B,B.c=We.c,B.i=We.i,B.l=We.l,B.l.ma=We,B.l.width=We.c,B.l.height=We.i,B.a=0,De(B.m,Je,dt,jt),!ma(We.c,We.i,1,B,null)||(B.ab==1&&B.gc[0].hc==3&&_o(B.s)?(We.ic=1,Je=B.c*B.i,B.Ta=null,B.Ua=0,B.V=u(Je),B.Ba=0,B.V==null?(B.a=1,B=0):B=1):(We.ic=0,B=bl(B,We.c)),!B))break t;B=1;break e}We.mc=null,B=0}else B=jt>=We.c*We.i;We=!B}if(We)return null;C.ga.Lc!=1?C.Ga=0:oe=Ve-ee}e(C.ga!=null),e(ee+oe<=Ve);e:{if(B=(Je=C.ga).c,Ve=Je.l.o,Je.$a==0){if(dt=C.rc,jt=C.Vc,Qt=C.Fa,nt=C.P+1+ee*B,ut=C.mb,Nt=C.nb+ee*B,e(nt<=C.P+C.qc),Je.Z!=0)for(e(to[Je.Z]!=null),We=0;We<oe;++We)to[Je.Z](dt,jt,Qt,nt,ut,Nt,B),dt=ut,jt=Nt,Nt+=B,nt+=B;else for(We=0;We<oe;++We)i(ut,Nt,Qt,nt,B),dt=ut,jt=Nt,Nt+=B,nt+=B;C.rc=dt,C.Vc=jt}else{if(e(Je.mc!=null),B=ee+oe,e((We=Je.mc)!=null),e(B<=We.i),We.C>=B)B=1;else if(Je.ic||jo(),Je.ic){Je=We.V,dt=We.Ba,jt=We.c;var En=We.i,y=(Qt=1,nt=We.$/jt,ut=We.$%jt,Nt=We.m,Yt=We.s,We.$),a=jt*En,f=jt*B,v=Yt.wc,S=y<f?Er(Yt,ut,nt):null;e(y<=a),e(B<=En),e(_o(Yt));t:for(;;){for(;!Nt.h&&y<f;){if(ut&v||(S=Er(Yt,ut,nt)),e(S!=null),gt(Nt),256>(En=Lr(S.G[0],S.H[0],Nt)))Je[dt+y]=En,++y,++ut>=jt&&(ut=0,++nt<=B&&!(nt%16)&&so(We,nt));else{if(!(280>En)){Qt=0;break t}En=In(En-256,Nt);var T,N=Lr(S.G[4],S.H[4],Nt);if(gt(Nt),!(y>=(N=kr(jt,N=In(N,Nt)))&&a-y>=En)){Qt=0;break t}for(T=0;T<En;++T)Je[dt+y+T]=Je[dt+y+T-N];for(y+=En,ut+=En;ut>=jt;)ut-=jt,++nt<=B&&!(nt%16)&&so(We,nt);y<f&&ut&v&&(S=Er(Yt,ut,nt))}e(Nt.h==Qe(Nt))}so(We,nt>B?B:nt);break t}!Qt||Nt.h&&y<a?(Qt=0,We.a=Nt.h?5:3):We.$=y,B=Qt}else B=_s(We,We.V,We.Ba,We.c,We.i,B,ll);if(!B){oe=0;break e}}ee+oe>=Ve&&(C.Cc=1),oe=1}if(!oe)return null;if(C.Cc&&((oe=C.ga)!=null&&(oe.mc=null),C.ga=null,0<C.Ga))return alert("todo:WebPDequantizeLevels"),null}return C.nb+ee*Pe}function Mo(C,B,ee,oe,Pe,Ve){for(;0<Pe--;){var We,Je=C,nt=B+(ee?1:0),ut=C,Nt=B+(ee?0:3);for(We=0;We<oe;++We){var Yt=ut[Nt+4*We];Yt!=255&&(Yt*=32897,Je[nt+4*We+0]=Je[nt+4*We+0]*Yt>>23,Je[nt+4*We+1]=Je[nt+4*We+1]*Yt>>23,Je[nt+4*We+2]=Je[nt+4*We+2]*Yt>>23)}B+=Ve}}function zo(C,B,ee,oe,Pe){for(;0<oe--;){var Ve;for(Ve=0;Ve<ee;++Ve){var We=C[B+2*Ve+0],Je=15&(ut=C[B+2*Ve+1]),nt=4369*Je,ut=(240&ut|ut>>4)*nt>>16;C[B+2*Ve+0]=(240&We|We>>4)*nt>>16&240|(15&We|We<<4)*nt>>16>>4&15,C[B+2*Ve+1]=240&ut|Je}B+=Pe}}function es(C,B,ee,oe,Pe,Ve,We,Je){var nt,ut,Nt=255;for(ut=0;ut<Pe;++ut){for(nt=0;nt<oe;++nt){var Yt=C[B+nt];Ve[We+4*nt]=Yt,Nt&=Yt}B+=ee,We+=Je}return Nt!=255}function us(C,B,ee,oe,Pe){var Ve;for(Ve=0;Ve<Pe;++Ve)ee[oe+Ve]=C[B+Ve]>>8}function jo(){Xs=Mo,vu=zo,Sc=es,fl=us}function Es(C,B,ee){F[C]=function(oe,Pe,Ve,We,Je,nt,ut,Nt,Yt,dt,jt,Qt,En,y,a,f,v){var S,T=v-1>>1,N=Je[nt+0]|ut[Nt+0]<<16,z=Yt[dt+0]|jt[Qt+0]<<16;e(oe!=null);var G=3*N+z+131074>>2;for(B(oe[Pe+0],255&G,G>>16,En,y),Ve!=null&&(G=3*z+N+131074>>2,B(Ve[We+0],255&G,G>>16,a,f)),S=1;S<=T;++S){var Q=Je[nt+S]|ut[Nt+S]<<16,te=Yt[dt+S]|jt[Qt+S]<<16,ge=N+Q+z+te+524296,Ae=ge+2*(Q+z)>>3;G=Ae+N>>1,N=(ge=ge+2*(N+te)>>3)+Q>>1,B(oe[Pe+2*S-1],255&G,G>>16,En,y+(2*S-1)*ee),B(oe[Pe+2*S-0],255&N,N>>16,En,y+(2*S-0)*ee),Ve!=null&&(G=ge+z>>1,N=Ae+te>>1,B(Ve[We+2*S-1],255&G,G>>16,a,f+(2*S-1)*ee),B(Ve[We+2*S+0],255&N,N>>16,a,f+(2*S+0)*ee)),N=Q,z=te}1&v||(G=3*N+z+131074>>2,B(oe[Pe+v-1],255&G,G>>16,En,y+(v-1)*ee),Ve!=null&&(G=3*z+N+131074>>2,B(Ve[We+v-1],255&G,G>>16,a,f+(v-1)*ee)))}}function Fc(){Il[Ec]=Dh,Il[ua]=el,Il[bh]=df,Il[jc]=Ia,Il[mr]=Ac,Il[eo]=Yh,Il[pl]=Sh,Il[ru]=el,Il[ac]=Ia,Il[iu]=Ac,Il[ou]=Yh}function Za(C){return C&-16384?0>C?0:255:C>>cc}function L(C,B){return Za((19077*C>>8)+(26149*B>>8)-14234)}function ae(C,B,ee){return Za((19077*C>>8)-(6419*B>>8)-(13320*ee>>8)+8708)}function ve(C,B){return Za((19077*C>>8)+(33050*B>>8)-17685)}function He(C,B,ee,oe,Pe){oe[Pe+0]=L(C,ee),oe[Pe+1]=ae(C,B,ee),oe[Pe+2]=ve(C,B)}function Kt(C,B,ee,oe,Pe){oe[Pe+0]=ve(C,B),oe[Pe+1]=ae(C,B,ee),oe[Pe+2]=L(C,ee)}function pn(C,B,ee,oe,Pe){var Ve=ae(C,B,ee);B=Ve<<3&224|ve(C,B)>>3,oe[Pe+0]=248&L(C,ee)|Ve>>5,oe[Pe+1]=B}function sr(C,B,ee,oe,Pe){var Ve=240&ve(C,B)|15;oe[Pe+0]=240&L(C,ee)|ae(C,B,ee)>>4,oe[Pe+1]=Ve}function ho(C,B,ee,oe,Pe){oe[Pe+0]=255,He(C,B,ee,oe,Pe+1)}function Fo(C,B,ee,oe,Pe){Kt(C,B,ee,oe,Pe),oe[Pe+3]=255}function Wi(C,B,ee,oe,Pe){He(C,B,ee,oe,Pe),oe[Pe+3]=255}function Oi(C,B){return 0>C?0:C>B?B:C}function No(C,B,ee){F[C]=function(oe,Pe,Ve,We,Je,nt,ut,Nt,Yt){for(var dt=Nt+(-2&Yt)*ee;Nt!=dt;)B(oe[Pe+0],Ve[We+0],Je[nt+0],ut,Nt),B(oe[Pe+1],Ve[We+0],Je[nt+0],ut,Nt+ee),Pe+=2,++We,++nt,Nt+=2*ee;1&Yt&&B(oe[Pe+0],Ve[We+0],Je[nt+0],ut,Nt)}}function sa(C,B,ee){return ee==0?C==0?B==0?6:5:B==0?4:0:ee}function Oo(C,B,ee,oe,Pe){switch(C>>>30){case 3:Oc(B,ee,oe,Pe,0);break;case 2:lo(B,ee,oe,Pe);break;case 1:Xo(B,ee,oe,Pe)}}function $i(C,B){var ee,oe,Pe=B.M,Ve=B.Nb,We=C.oc,Je=C.pc+40,nt=C.oc,ut=C.pc+584,Nt=C.oc,Yt=C.pc+600;for(ee=0;16>ee;++ee)We[Je+32*ee-1]=129;for(ee=0;8>ee;++ee)nt[ut+32*ee-1]=129,Nt[Yt+32*ee-1]=129;for(0<Pe?We[Je-1-32]=nt[ut-1-32]=Nt[Yt-1-32]=129:(c(We,Je-32-1,127,21),c(nt,ut-32-1,127,9),c(Nt,Yt-32-1,127,9)),oe=0;oe<C.za;++oe){var dt=B.ya[B.aa+oe];if(0<oe){for(ee=-1;16>ee;++ee)i(We,Je+32*ee-4,We,Je+32*ee+12,4);for(ee=-1;8>ee;++ee)i(nt,ut+32*ee-4,nt,ut+32*ee+4,4),i(Nt,Yt+32*ee-4,Nt,Yt+32*ee+4,4)}var jt=C.Gd,Qt=C.Hd+oe,En=dt.ad,y=dt.Hc;if(0<Pe&&(i(We,Je-32,jt[Qt].y,0,16),i(nt,ut-32,jt[Qt].f,0,8),i(Nt,Yt-32,jt[Qt].ea,0,8)),dt.Za){var a=We,f=Je-32+16;for(0<Pe&&(oe>=C.za-1?c(a,f,jt[Qt].y[15],4):i(a,f,jt[Qt+1].y,0,4)),ee=0;4>ee;ee++)a[f+128+ee]=a[f+256+ee]=a[f+384+ee]=a[f+0+ee];for(ee=0;16>ee;++ee,y<<=2)a=We,f=Je+Gl[ee],Ui[dt.Ob[ee]](a,f),Oo(y,En,16*+ee,a,f)}else if(a=sa(oe,Pe,dt.Ob[0]),za[a](We,Je),y!=0)for(ee=0;16>ee;++ee,y<<=2)Oo(y,En,16*+ee,We,Je+Gl[ee]);for(ee=dt.Gc,a=sa(oe,Pe,dt.Dd),da[a](nt,ut),da[a](Nt,Yt),y=En,a=nt,f=ut,255&(dt=0|ee)&&(170&dt?Al(y,256,a,f):So(y,256,a,f)),dt=Nt,y=Yt,255&(ee>>=8)&&(170&ee?Al(En,320,dt,y):So(En,320,dt,y)),Pe<C.Ub-1&&(i(jt[Qt].y,0,We,Je+480,16),i(jt[Qt].f,0,nt,ut+224,8),i(jt[Qt].ea,0,Nt,Yt+224,8)),ee=8*Ve*C.B,jt=C.sa,Qt=C.ta+16*oe+16*Ve*C.R,En=C.qa,dt=C.ra+8*oe+ee,y=C.Ha,a=C.Ia+8*oe+ee,ee=0;16>ee;++ee)i(jt,Qt+ee*C.R,We,Je+32*ee,16);for(ee=0;8>ee;++ee)i(En,dt+ee*C.B,nt,ut+32*ee,8),i(y,a+ee*C.B,Nt,Yt+32*ee,8)}}function jl(C,B,ee,oe,Pe,Ve,We,Je,nt){var ut=[0],Nt=[0],Yt=0,dt=nt!=null?nt.kd:0,jt=nt??new Zt;if(C==null||12>ee)return 7;jt.data=C,jt.w=B,jt.ha=ee,B=[B],ee=[ee],jt.gb=[jt.gb];e:{var Qt=B,En=ee,y=jt.gb;if(e(C!=null),e(En!=null),e(y!=null),y[0]=0,12<=En[0]&&!t(C,Qt[0],"RIFF")){if(t(C,Qt[0]+8,"WEBP")){y=3;break e}var a=Gt(C,Qt[0]+4);if(12>a||4294967286<a){y=3;break e}if(dt&&a>En[0]-8){y=7;break e}y[0]=a,Qt[0]+=12,En[0]-=12}y=0}if(y!=0)return y;for(a=0<jt.gb[0],ee=ee[0];;){e:{var f=C;En=B,y=ee;var v=ut,S=Nt,T=Qt=[0];if((G=Yt=[Yt])[0]=0,8>y[0])y=7;else{if(!t(f,En[0],"VP8X")){if(Gt(f,En[0]+4)!=10){y=3;break e}if(18>y[0]){y=7;break e}var N=Gt(f,En[0]+8),z=1+Mn(f,En[0]+12);if(2147483648<=z*(f=1+Mn(f,En[0]+15))){y=3;break e}T!=null&&(T[0]=N),v!=null&&(v[0]=z),S!=null&&(S[0]=f),En[0]+=18,y[0]-=18,G[0]=1}y=0}}if(Yt=Yt[0],Qt=Qt[0],y!=0)return y;if(En=!!(2&Qt),!a&&Yt)return 3;if(Ve!=null&&(Ve[0]=!!(16&Qt)),We!=null&&(We[0]=En),Je!=null&&(Je[0]=0),We=ut[0],Qt=Nt[0],Yt&&En&&nt==null){y=0;break}if(4>ee){y=7;break}if(a&&Yt||!a&&!Yt&&!t(C,B[0],"ALPH")){ee=[ee],jt.na=[jt.na],jt.P=[jt.P],jt.Sa=[jt.Sa];e:{N=C,y=B,a=ee;var G=jt.gb;v=jt.na,S=jt.P,T=jt.Sa,z=22,e(N!=null),e(a!=null),f=y[0];var Q=a[0];for(e(v!=null),e(T!=null),v[0]=null,S[0]=null,T[0]=0;;){if(y[0]=f,a[0]=Q,8>Q){y=7;break e}var te=Gt(N,f+4);if(4294967286<te){y=3;break e}var ge=8+te+1&-2;if(z+=ge,0<G&&z>G){y=3;break e}if(!t(N,f,"VP8 ")||!t(N,f,"VP8L")){y=0;break e}if(Q[0]<ge){y=7;break e}t(N,f,"ALPH")||(v[0]=N,S[0]=f+8,T[0]=te),f+=ge,Q-=ge}}if(ee=ee[0],jt.na=jt.na[0],jt.P=jt.P[0],jt.Sa=jt.Sa[0],y!=0)break}ee=[ee],jt.Ja=[jt.Ja],jt.xa=[jt.xa];e:if(G=C,y=B,a=ee,v=jt.gb[0],S=jt.Ja,T=jt.xa,N=y[0],f=!t(G,N,"VP8 "),z=!t(G,N,"VP8L"),e(G!=null),e(a!=null),e(S!=null),e(T!=null),8>a[0])y=7;else{if(f||z){if(G=Gt(G,N+4),12<=v&&G>v-12){y=3;break e}if(dt&&G>a[0]-8){y=7;break e}S[0]=G,y[0]+=8,a[0]-=8,T[0]=z}else T[0]=5<=a[0]&&G[N+0]==47&&!(G[N+4]>>5),S[0]=a[0];y=0}if(ee=ee[0],jt.Ja=jt.Ja[0],jt.xa=jt.xa[0],B=B[0],y!=0)break;if(4294967286<jt.Ja)return 3;if(Je==null||En||(Je[0]=jt.xa?2:1),We=[We],Qt=[Qt],jt.xa){if(5>ee){y=7;break}Je=We,dt=Qt,En=Ve,C==null||5>ee?C=0:5<=ee&&C[B+0]==47&&!(C[B+4]>>5)?(a=[0],G=[0],v=[0],De(S=new Ne,C,B,ee),Un(S,a,G,v)?(Je!=null&&(Je[0]=a[0]),dt!=null&&(dt[0]=G[0]),En!=null&&(En[0]=v[0]),C=1):C=0):C=0}else{if(10>ee){y=7;break}Je=Qt,C==null||10>ee||!pu(C,B+3,ee-3)?C=0:(dt=C[B+0]|C[B+1]<<8|C[B+2]<<16,En=16383&(C[B+7]<<8|C[B+6]),C=16383&(C[B+9]<<8|C[B+8]),1&dt||3<(dt>>1&7)||!(dt>>4&1)||dt>>5>=jt.Ja||!En||!C?C=0:(We&&(We[0]=En),Je&&(Je[0]=C),C=1))}if(!C||(We=We[0],Qt=Qt[0],Yt&&(ut[0]!=We||Nt[0]!=Qt)))return 3;nt!=null&&(nt[0]=jt,nt.offset=B-nt.w,e(4294967286>B-nt.w),e(nt.offset==nt.ha-ee));break}return y==0||y==7&&Yt&&nt==null?(Ve!=null&&(Ve[0]|=jt.na!=null&&0<jt.na.length),oe!=null&&(oe[0]=We),Pe!=null&&(Pe[0]=Qt),0):y}function aa(C,B,ee){var oe=B.width,Pe=B.height,Ve=0,We=0,Je=oe,nt=Pe;if(B.Da=C!=null&&0<C.Da,B.Da&&(Je=C.cd,nt=C.bd,Ve=C.v,We=C.j,11>ee||(Ve&=-2,We&=-2),0>Ve||0>We||0>=Je||0>=nt||Ve+Je>oe||We+nt>Pe))return 0;if(B.v=Ve,B.j=We,B.va=Ve+Je,B.o=We+nt,B.U=Je,B.T=nt,B.da=C!=null&&0<C.da,B.da){if(!Cr(Je,nt,ee=[C.ib],Ve=[C.hb]))return 0;B.ib=ee[0],B.hb=Ve[0]}return B.ob=C!=null&&C.ob,B.Kb=C==null||!C.Sd,B.da&&(B.ob=B.ib<3*oe/4&&B.hb<3*Pe/4,B.Kb=0),1}function Ru(C){if(C==null)return 2;if(11>C.S){var B=C.f.RGBA;B.fb+=(C.height-1)*B.A,B.A=-B.A}else B=C.f.kb,C=C.height,B.O+=(C-1)*B.fa,B.fa=-B.fa,B.N+=(C-1>>1)*B.Ab,B.Ab=-B.Ab,B.W+=(C-1>>1)*B.Db,B.Db=-B.Db,B.F!=null&&(B.J+=(C-1)*B.lb,B.lb=-B.lb);return 0}function dl(C,B,ee,oe){if(oe==null||0>=C||0>=B)return 2;if(ee!=null){if(ee.Da){var Pe=ee.cd,Ve=ee.bd,We=-2&ee.v,Je=-2&ee.j;if(0>We||0>Je||0>=Pe||0>=Ve||We+Pe>C||Je+Ve>B)return 2;C=Pe,B=Ve}if(ee.da){if(!Cr(C,B,Pe=[ee.ib],Ve=[ee.hb]))return 2;C=Pe[0],B=Ve[0]}}oe.width=C,oe.height=B;e:{var nt=oe.width,ut=oe.height;if(C=oe.S,0>=nt||0>=ut||!(C>=Ec&&13>C))C=2;else{if(0>=oe.Rd&&oe.sd==null){We=Ve=Pe=B=0;var Nt=(Je=nt*eh[C])*ut;if(11>C||(Ve=(ut+1)/2*(B=(nt+1)/2),C==12&&(We=(Pe=nt)*ut)),(ut=u(Nt+2*Ve+We))==null){C=1;break e}oe.sd=ut,11>C?((nt=oe.f.RGBA).eb=ut,nt.fb=0,nt.A=Je,nt.size=Nt):((nt=oe.f.kb).y=ut,nt.O=0,nt.fa=Je,nt.Fd=Nt,nt.f=ut,nt.N=0+Nt,nt.Ab=B,nt.Cd=Ve,nt.ea=ut,nt.W=0+Nt+Ve,nt.Db=B,nt.Ed=Ve,C==12&&(nt.F=ut,nt.J=0+Nt+2*Ve),nt.Tc=We,nt.lb=Pe)}if(B=1,Pe=oe.S,Ve=oe.width,We=oe.height,Pe>=Ec&&13>Pe)if(11>Pe)C=oe.f.RGBA,B&=(Je=Math.abs(C.A))*(We-1)+Ve<=C.size,B&=Je>=Ve*eh[Pe],B&=C.eb!=null;else{C=oe.f.kb,Je=(Ve+1)/2,Nt=(We+1)/2,nt=Math.abs(C.fa),ut=Math.abs(C.Ab);var Yt=Math.abs(C.Db),dt=Math.abs(C.lb),jt=dt*(We-1)+Ve;B&=nt*(We-1)+Ve<=C.Fd,B&=ut*(Nt-1)+Je<=C.Cd,B=(B&=Yt*(Nt-1)+Je<=C.Ed)&nt>=Ve&ut>=Je&Yt>=Je,B&=C.y!=null,B&=C.f!=null,B&=C.ea!=null,Pe==12&&(B&=dt>=Ve,B&=jt<=C.Tc,B&=C.F!=null)}else B=0;C=B?0:2}}return C!=0||ee!=null&&ee.fd&&(C=Ru(oe)),C}var xc=64,ks=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],ya=24,gu=32,ts=8,Ws=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];Qn("Predictor0","PredictorAdd0"),F.Predictor0=function(){return 4278190080},F.Predictor1=function(C){return C},F.Predictor2=function(C,B,ee){return B[ee+0]},F.Predictor3=function(C,B,ee){return B[ee+1]},F.Predictor4=function(C,B,ee){return B[ee-1]},F.Predictor5=function(C,B,ee){return qt(qt(C,B[ee+1]),B[ee+0])},F.Predictor6=function(C,B,ee){return qt(C,B[ee-1])},F.Predictor7=function(C,B,ee){return qt(C,B[ee+0])},F.Predictor8=function(C,B,ee){return qt(B[ee-1],B[ee+0])},F.Predictor9=function(C,B,ee){return qt(B[ee+0],B[ee+1])},F.Predictor10=function(C,B,ee){return qt(qt(C,B[ee-1]),qt(B[ee+0],B[ee+1]))},F.Predictor11=function(C,B,ee){var oe=B[ee+0];return 0>=Bn(oe>>24&255,C>>24&255,(B=B[ee-1])>>24&255)+Bn(oe>>16&255,C>>16&255,B>>16&255)+Bn(oe>>8&255,C>>8&255,B>>8&255)+Bn(255&oe,255&C,255&B)?oe:C},F.Predictor12=function(C,B,ee){var oe=B[ee+0];return(Pn((C>>24&255)+(oe>>24&255)-((B=B[ee-1])>>24&255))<<24|Pn((C>>16&255)+(oe>>16&255)-(B>>16&255))<<16|Pn((C>>8&255)+(oe>>8&255)-(B>>8&255))<<8|Pn((255&C)+(255&oe)-(255&B)))>>>0},F.Predictor13=function(C,B,ee){var oe=B[ee-1];return(Hn((C=qt(C,B[ee+0]))>>24&255,oe>>24&255)<<24|Hn(C>>16&255,oe>>16&255)<<16|Hn(C>>8&255,oe>>8&255)<<8|Hn(255&C,255&oe))>>>0};var Fa=F.PredictorAdd0;F.PredictorAdd1=Rr,Qn("Predictor2","PredictorAdd2"),Qn("Predictor3","PredictorAdd3"),Qn("Predictor4","PredictorAdd4"),Qn("Predictor5","PredictorAdd5"),Qn("Predictor6","PredictorAdd6"),Qn("Predictor7","PredictorAdd7"),Qn("Predictor8","PredictorAdd8"),Qn("Predictor9","PredictorAdd9"),Qn("Predictor10","PredictorAdd10"),Qn("Predictor11","PredictorAdd11"),Qn("Predictor12","PredictorAdd12"),Qn("Predictor13","PredictorAdd13");var Ul=F.PredictorAdd2;Pr("ColorIndexInverseTransform","MapARGB","32b",function(C){return C>>8&255},function(C){return C}),Pr("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(C){return C},function(C){return C>>8&255});var vs,Uo=F.ColorIndexInverseTransform,Aa=F.MapARGB,Ks=F.VP8LColorIndexInverseTransformAlpha,yu=F.MapAlpha,bc=F.VP8LPredictorsAdd=[];bc.length=16,(F.VP8LPredictors=[]).length=16,(F.VP8LPredictorsAdd_C=[]).length=16,(F.VP8LPredictors_C=[]).length=16;var eu,Oa,sc,Sl,Vl,wc,El,Oc,lo,Al,Xo,So,la,ca,Bc,kh,_u,tu,Mu,nu,xh,Zh,ql,zc,Xs,vu,Sc,fl,As=u(511),Yu=u(2041),$r=u(225),co=u(767),Nu=0,Ba=Yu,Ya=$r,Ta=co,Ja=As,Ec=0,ua=1,bh=2,jc=3,mr=4,eo=5,pl=6,ru=7,ac=8,iu=9,ou=10,An=[2,3,7],Ts=[3,3,11],Vo=[280,256,256,256,40],Tl=[0,1,1,1,0],_a=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],Ri=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],ha=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],Rh=8,wh=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],Qr=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],xu=null,Mh=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],Zs=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],Qa=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],Nh=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],Uc=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],Du=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],gd=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],za=[],Ui=[],da=[],ja=1,su=2,to=[],Il=[];Es("UpsampleRgbLinePair",He,3),Es("UpsampleBgrLinePair",Kt,3),Es("UpsampleRgbaLinePair",Wi,4),Es("UpsampleBgraLinePair",Fo,4),Es("UpsampleArgbLinePair",ho,4),Es("UpsampleRgba4444LinePair",sr,2),Es("UpsampleRgb565LinePair",pn,2);var Dh=F.UpsampleRgbLinePair,df=F.UpsampleBgrLinePair,el=F.UpsampleRgbaLinePair,Ia=F.UpsampleBgraLinePair,Ac=F.UpsampleArgbLinePair,Yh=F.UpsampleRgba4444LinePair,Sh=F.UpsampleRgb565LinePair,Ua=16,lc=1<<Ua-1,qo=-227,Gi=482,cc=6,tl=0,$l=u(256),Ju=u(256),Ca=u(256),La=u(256),Jh=u(Gi-qo),uc=u(Gi-qo);No("YuvToRgbRow",He,3),No("YuvToBgrRow",Kt,3),No("YuvToRgbaRow",Wi,4),No("YuvToBgraRow",Fo,4),No("YuvToArgbRow",ho,4),No("YuvToRgba4444Row",sr,2),No("YuvToRgb565Row",pn,2);var Gl=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],Cl=[0,2,8],Qu=[8,7,6,4,4,2,2,2,1,1,1,1],ur=1;this.WebPDecodeRGBA=function(C,B,ee,oe,Pe){var Ve=ua,We=new $t,Je=new Te;We.ba=Je,Je.S=Ve,Je.width=[Je.width],Je.height=[Je.height];var nt=Je.width,ut=Je.height,Nt=new et;if(Nt==null||C==null)var Yt=2;else e(Nt!=null),Yt=jl(C,B,ee,Nt.width,Nt.height,Nt.Pd,Nt.Qd,Nt.format,null);if(Yt!=0?nt=0:(nt!=null&&(nt[0]=Nt.width[0]),ut!=null&&(ut[0]=Nt.height[0]),nt=1),nt){Je.width=Je.width[0],Je.height=Je.height[0],oe!=null&&(oe[0]=Je.width),Pe!=null&&(Pe[0]=Je.height);e:{if(oe=new Yo,(Pe=new Zt).data=C,Pe.w=B,Pe.ha=ee,Pe.kd=1,B=[0],e(Pe!=null),((C=jl(Pe.data,Pe.w,Pe.ha,null,null,null,B,null,Pe))==0||C==7)&&B[0]&&(C=4),(B=C)==0){if(e(We!=null),oe.data=Pe.data,oe.w=Pe.w+Pe.offset,oe.ha=Pe.ha-Pe.offset,oe.put=Pt,oe.ac=At,oe.bc=xn,oe.ma=We,Pe.xa){if((C=Cs())==null){We=1;break e}if((function(dt,jt){var Qt=[0],En=[0],y=[0];t:for(;;){if(dt==null)return 0;if(jt==null)return dt.a=2,0;if(dt.l=jt,dt.a=0,De(dt.m,jt.data,jt.w,jt.ha),!Un(dt.m,Qt,En,y)){dt.a=3;break t}if(dt.xb=su,jt.width=Qt[0],jt.height=En[0],!ma(Qt[0],En[0],1,dt,null))break t;return 1}return e(dt.a!=0),0})(C,oe)){if(oe=(B=dl(oe.width,oe.height,We.Oa,We.ba))==0){t:{oe=C;n:for(;;){if(oe==null){oe=0;break t}if(e(oe.s.yc!=null),e(oe.s.Ya!=null),e(0<oe.s.Wb),e((ee=oe.l)!=null),e((Pe=ee.ma)!=null),oe.xb!=0){if(oe.ca=Pe.ba,oe.tb=Pe.tb,e(oe.ca!=null),!aa(Pe.Oa,ee,jc)){oe.a=2;break n}if(!bl(oe,ee.width)||ee.da)break n;if((ee.da||si(oe.ca.S))&&jo(),11>oe.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),oe.ca.f.kb.F!=null&&jo()),oe.Pb&&0<oe.s.ua&&oe.s.vb.X==null&&!ot(oe.s.vb,oe.s.Wa.Xa)){oe.a=1;break n}oe.xb=0}if(!_s(oe,oe.V,oe.Ba,oe.c,oe.i,ee.o,oo))break n;Pe.Dc=oe.Ma,oe=1;break t}e(oe.a!=0),oe=0}oe=!oe}oe&&(B=C.a)}else B=C.a}else{if((C=new ss)==null){We=1;break e}if(C.Fa=Pe.na,C.P=Pe.P,C.qc=Pe.Sa,Wa(C,oe)){if((B=dl(oe.width,oe.height,We.Oa,We.ba))==0){if(C.Aa=0,ee=We.Oa,e((Pe=C)!=null),ee!=null){if(0<(nt=0>(nt=ee.Md)?0:100<nt?255:255*nt/100)){for(ut=Nt=0;4>ut;++ut)12>(Yt=Pe.pb[ut]).lc&&(Yt.ia=nt*Qu[0>Yt.lc?0:Yt.lc]>>3),Nt|=Yt.ia;Nt&&(alert("todo:VP8InitRandom"),Pe.ia=1)}Pe.Ga=ee.Id,100<Pe.Ga?Pe.Ga=100:0>Pe.Ga&&(Pe.Ga=0)}(function(dt,jt){if(dt==null)return 0;if(jt==null)return _i(dt,2,"NULL VP8Io parameter in VP8Decode().");if(!dt.cb&&!Wa(dt,jt))return 0;if(e(dt.cb),jt.ac==null||jt.ac(jt)){jt.ob&&(dt.L=0);var Qt=Cl[dt.L];if(dt.L==2?(dt.yb=0,dt.zb=0):(dt.yb=jt.v-Qt>>4,dt.zb=jt.j-Qt>>4,0>dt.yb&&(dt.yb=0),0>dt.zb&&(dt.zb=0)),dt.Va=jt.o+15+Qt>>4,dt.Hb=jt.va+15+Qt>>4,dt.Hb>dt.za&&(dt.Hb=dt.za),dt.Va>dt.Ub&&(dt.Va=dt.Ub),0<dt.L){var En=dt.ed;for(Qt=0;4>Qt;++Qt){var y;if(dt.Qa.Cb){var a=dt.Qa.Lb[Qt];dt.Qa.Fb||(a+=En.Tb)}else a=En.Tb;for(y=0;1>=y;++y){var f=dt.gd[Qt][y],v=a;if(En.Pc&&(v+=En.vd[0],y&&(v+=En.od[0])),0<(v=0>v?0:63<v?63:v)){var S=v;0<En.wb&&(S=4<En.wb?S>>2:S>>1)>9-En.wb&&(S=9-En.wb),1>S&&(S=1),f.dd=S,f.tc=2*v+S,f.ld=40<=v?2:15<=v?1:0}else f.tc=0;f.La=y}}}Qt=0}else _i(dt,6,"Frame setup failed"),Qt=dt.a;if(Qt=Qt==0){if(Qt){dt.$c=0,0<dt.Aa||(dt.Ic=ur);t:{Qt=dt.Ic,En=4*(S=dt.za);var T=32*S,N=S+1,z=0<dt.L?S*(0<dt.Aa?2:1):0,G=(dt.Aa==2?2:1)*S;if((f=En+832+(y=3*(16*Qt+Cl[dt.L])/2*T)+(a=dt.Fa!=null&&0<dt.Fa.length?dt.Kc.c*dt.Kc.i:0))!=f)Qt=0;else{if(f>dt.Vb){if(dt.Vb=0,dt.Ec=u(f),dt.Fc=0,dt.Ec==null){Qt=_i(dt,1,"no memory during frame initialization.");break t}dt.Vb=f}f=dt.Ec,v=dt.Fc,dt.Ac=f,dt.Bc=v,v+=En,dt.Gd=m(T,ra),dt.Hd=0,dt.rb=m(N+1,Ha),dt.sb=1,dt.wa=z?m(z,Zo):null,dt.Y=0,dt.D.Nb=0,dt.D.wa=dt.wa,dt.D.Y=dt.Y,0<dt.Aa&&(dt.D.Y+=S),e(!0),dt.oc=f,dt.pc=v,v+=832,dt.ya=m(G,rc),dt.aa=0,dt.D.ya=dt.ya,dt.D.aa=dt.aa,dt.Aa==2&&(dt.D.aa+=S),dt.R=16*S,dt.B=8*S,S=(T=Cl[dt.L])*dt.R,T=T/2*dt.B,dt.sa=f,dt.ta=v+S,dt.qa=dt.sa,dt.ra=dt.ta+16*Qt*dt.R+T,dt.Ha=dt.qa,dt.Ia=dt.ra+8*Qt*dt.B+T,dt.$c=0,v+=y,dt.mb=a?f:null,dt.nb=a?v:null,e(v+a<=dt.Fc+dt.Vb),cl(dt),c(dt.Ac,dt.Bc,0,En),Qt=1}}if(Qt){if(jt.ka=0,jt.y=dt.sa,jt.O=dt.ta,jt.f=dt.qa,jt.N=dt.ra,jt.ea=dt.Ha,jt.Vd=dt.Ia,jt.fa=dt.R,jt.Rc=dt.B,jt.F=null,jt.J=0,!Nu){for(Qt=-255;255>=Qt;++Qt)As[255+Qt]=0>Qt?-Qt:Qt;for(Qt=-1020;1020>=Qt;++Qt)Yu[1020+Qt]=-128>Qt?-128:127<Qt?127:Qt;for(Qt=-112;112>=Qt;++Qt)$r[112+Qt]=-16>Qt?-16:15<Qt?15:Qt;for(Qt=-255;510>=Qt;++Qt)co[255+Qt]=0>Qt?0:255<Qt?255:Qt;Nu=1}El=qi,Oc=Ea,Al=vi,Xo=Mi,So=wl,lo=js,la=hl,ca=Gs,Bc=W,kh=Ce,_u=Hs,tu=vc,Mu=mt,nu=yt,xh=qs,Zh=Ai,ql=Ss,zc=$s,Ui[0]=vh,Ui[1]=zi,Ui[2]=Jo,Ui[3]=Io,Ui[4]=Pu,Ui[5]=Us,Ui[6]=vo,Ui[7]=ku,Ui[8]=xo,Ui[9]=Wo,za[0]=Ma,za[1]=ic,za[2]=Jc,za[3]=yc,za[4]=Ps,za[5]=ji,za[6]=Na,da[0]=Bo,da[1]=mu,da[2]=zl,da[3]=Da,da[4]=Ko,da[5]=Dc,da[6]=ga,Qt=1}else Qt=0}Qt&&(Qt=(function(Q,te){for(Q.M=0;Q.M<Q.Va;++Q.M){var ge,Ae=Q.Jc[Q.M&Q.Xb],Le=Q.m,Xe=Q;for(ge=0;ge<Xe.za;++ge){var Ue=Le,Ze=Xe,_e=Ze.Ac,$e=Ze.Bc+4*ge,it=Ze.zc,st=Ze.ya[Ze.aa+ge];if(Ze.Qa.Bb?st.$b=Jt(Ue,Ze.Pa.jb[0])?2+Jt(Ue,Ze.Pa.jb[2]):Jt(Ue,Ze.Pa.jb[1]):st.$b=0,Ze.kc&&(st.Ad=Jt(Ue,Ze.Bd)),st.Za=!Jt(Ue,145)+0,st.Za){var bt=st.Ob,wt=0;for(Ze=0;4>Ze;++Ze){var vt,kt=it[0+Ze];for(vt=0;4>vt;++vt){kt=Uc[_e[$e+vt]][kt];for(var Tt=Qa[Jt(Ue,kt[0])];0<Tt;)Tt=Qa[2*Tt+Jt(Ue,kt[Tt])];kt=-Tt,_e[$e+vt]=kt}i(bt,wt,_e,$e,4),wt+=4,it[0+Ze]=kt}}else kt=Jt(Ue,156)?Jt(Ue,128)?1:3:Jt(Ue,163)?2:0,st.Ob[0]=kt,c(_e,$e,kt,4),c(it,0,kt,4);st.Dd=Jt(Ue,142)?Jt(Ue,114)?Jt(Ue,183)?1:3:2:0}if(Xe.m.Ka)return _i(Q,7,"Premature end-of-partition0 encountered.");for(;Q.ja<Q.za;++Q.ja){if(Xe=Ae,Ue=(Le=Q).rb[Le.sb-1],_e=Le.rb[Le.sb+Le.ja],ge=Le.ya[Le.aa+Le.ja],$e=Le.kc?ge.Ad:0)Ue.la=_e.la=0,ge.Za||(Ue.Na=_e.Na=0),ge.Hc=0,ge.Gc=0,ge.ia=0;else{var Vt,vn;if(Ue=_e,_e=Xe,$e=Le.Pa.Xc,it=Le.ya[Le.aa+Le.ja],st=Le.pb[it.$b],Ze=it.ad,bt=0,wt=Le.rb[Le.sb-1],kt=vt=0,c(Ze,bt,0,384),it.Za)var Bt=0,ln=$e[3];else{Tt=u(16);var Wt=Ue.Na+wt.Na;if(Wt=xu(_e,$e[1],Wt,st.Eb,0,Tt,0),Ue.Na=wt.Na=(0<Wt)+0,1<Wt)El(Tt,0,Ze,bt);else{var Cn=Tt[0]+3>>3;for(Tt=0;256>Tt;Tt+=16)Ze[bt+Tt]=Cn}Bt=1,ln=$e[0]}var Ut=15&Ue.la,rn=15&wt.la;for(Tt=0;4>Tt;++Tt){var Tn=1&rn;for(Cn=vn=0;4>Cn;++Cn)Ut=Ut>>1|(Tn=(Wt=xu(_e,ln,Wt=Tn+(1&Ut),st.Sc,Bt,Ze,bt))>Bt)<<7,vn=vn<<2|(3<Wt?3:1<Wt?2:Ze[bt+0]!=0),bt+=16;Ut>>=4,rn=rn>>1|Tn<<7,vt=(vt<<8|vn)>>>0}for(ln=Ut,Bt=rn>>4,Vt=0;4>Vt;Vt+=2){for(vn=0,Ut=Ue.la>>4+Vt,rn=wt.la>>4+Vt,Tt=0;2>Tt;++Tt){for(Tn=1&rn,Cn=0;2>Cn;++Cn)Wt=Tn+(1&Ut),Ut=Ut>>1|(Tn=0<(Wt=xu(_e,$e[2],Wt,st.Qc,0,Ze,bt)))<<3,vn=vn<<2|(3<Wt?3:1<Wt?2:Ze[bt+0]!=0),bt+=16;Ut>>=2,rn=rn>>1|Tn<<5}kt|=vn<<4*Vt,ln|=Ut<<4<<Vt,Bt|=(240&rn)<<Vt}Ue.la=ln,wt.la=Bt,it.Hc=vt,it.Gc=kt,it.ia=43690&kt?0:st.ia,$e=!(vt|kt)}if(0<Le.L&&(Le.wa[Le.Y+Le.ja]=Le.gd[ge.$b][ge.Za],Le.wa[Le.Y+Le.ja].La|=!$e),Xe.Ka)return _i(Q,7,"Premature end-of-file encountered.")}if(cl(Q),Le=te,Xe=1,ge=(Ae=Q).D,Ue=0<Ae.L&&Ae.M>=Ae.zb&&Ae.M<=Ae.Va,Ae.Aa==0)t:{if(ge.M=Ae.M,ge.uc=Ue,$i(Ae,ge),Xe=1,ge=(vn=Ae.D).Nb,Ue=(kt=Cl[Ae.L])*Ae.R,_e=kt/2*Ae.B,Tt=16*ge*Ae.R,Cn=8*ge*Ae.B,$e=Ae.sa,it=Ae.ta-Ue+Tt,st=Ae.qa,Ze=Ae.ra-_e+Cn,bt=Ae.Ha,wt=Ae.Ia-_e+Cn,rn=(Ut=vn.M)==0,vt=Ut>=Ae.Va-1,Ae.Aa==2&&$i(Ae,vn),vn.uc)for(Tn=(Wt=Ae).D.M,e(Wt.D.uc),vn=Wt.yb;vn<Wt.Hb;++vn){Bt=vn,ln=Tn;var cn=(Nn=(Ci=Wt).D).Nb;Vt=Ci.R;var Nn=Nn.wa[Nn.Y+Bt],hr=Ci.sa,Dr=Ci.ta+16*cn*Vt+16*Bt,rr=Nn.dd,Jn=Nn.tc;if(Jn!=0)if(e(3<=Jn),Ci.L==1)0<Bt&&Zh(hr,Dr,Vt,Jn+4),Nn.La&&zc(hr,Dr,Vt,Jn),0<ln&&xh(hr,Dr,Vt,Jn+4),Nn.La&&ql(hr,Dr,Vt,Jn);else{var ni=Ci.B,mi=Ci.qa,xr=Ci.ra+8*cn*ni+8*Bt,Ii=Ci.Ha,Ci=Ci.Ia+8*cn*ni+8*Bt;cn=Nn.ld,0<Bt&&(ca(hr,Dr,Vt,Jn+4,rr,cn),kh(mi,xr,Ii,Ci,ni,Jn+4,rr,cn)),Nn.La&&(tu(hr,Dr,Vt,Jn,rr,cn),nu(mi,xr,Ii,Ci,ni,Jn,rr,cn)),0<ln&&(la(hr,Dr,Vt,Jn+4,rr,cn),Bc(mi,xr,Ii,Ci,ni,Jn+4,rr,cn)),Nn.La&&(_u(hr,Dr,Vt,Jn,rr,cn),Mu(mi,xr,Ii,Ci,ni,Jn,rr,cn))}}if(Ae.ia&&alert("todo:DitherRow"),Le.put!=null){if(vn=16*Ut,Ut=16*(Ut+1),rn?(Le.y=Ae.sa,Le.O=Ae.ta+Tt,Le.f=Ae.qa,Le.N=Ae.ra+Cn,Le.ea=Ae.Ha,Le.W=Ae.Ia+Cn):(vn-=kt,Le.y=$e,Le.O=it,Le.f=st,Le.N=Ze,Le.ea=bt,Le.W=wt),vt||(Ut-=kt),Ut>Le.o&&(Ut=Le.o),Le.F=null,Le.J=null,Ae.Fa!=null&&0<Ae.Fa.length&&vn<Ut&&(Le.J=Qo(Ae,Le,vn,Ut-vn),Le.F=Ae.mb,Le.F==null&&Le.F.length==0)){Xe=_i(Ae,3,"Could not decode alpha data.");break t}vn<Le.j&&(kt=Le.j-vn,vn=Le.j,e(!(1&kt)),Le.O+=Ae.R*kt,Le.N+=Ae.B*(kt>>1),Le.W+=Ae.B*(kt>>1),Le.F!=null&&(Le.J+=Le.width*kt)),vn<Ut&&(Le.O+=Le.v,Le.N+=Le.v>>1,Le.W+=Le.v>>1,Le.F!=null&&(Le.J+=Le.v),Le.ka=vn-Le.j,Le.U=Le.va-Le.v,Le.T=Ut-vn,Xe=Le.put(Le))}ge+1!=Ae.Ic||vt||(i(Ae.sa,Ae.ta-Ue,$e,it+16*Ae.R,Ue),i(Ae.qa,Ae.ra-_e,st,Ze+8*Ae.B,_e),i(Ae.Ha,Ae.Ia-_e,bt,wt+8*Ae.B,_e))}if(!Xe)return _i(Q,6,"Output aborted.")}return 1})(dt,jt)),jt.bc!=null&&jt.bc(jt),Qt&=1}return Qt?(dt.cb=0,Qt):0})(C,oe)||(B=C.a)}}else B=C.a}B==0&&We.Oa!=null&&We.Oa.fd&&(B=Ru(We.ba))}We=B}Ve=We!=0?null:11>Ve?Je.f.RGBA.eb:Je.f.kb.y}else Ve=null;return Ve};var eh=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function b(F,q){for(var j="",H=0;H<4;H++)j+=String.fromCharCode(F[q++]);return j}function I(F,q){return F[q+0]|F[q+1]<<8}function M(F,q){return(F[q+0]|F[q+1]<<8|F[q+2]<<16)>>>0}function V(F,q){return(F[q+0]|F[q+1]<<8|F[q+2]<<16|F[q+3]<<24)>>>0}new o;var k=[0],ie=[0],se=[],de=new o,J=n,ne=(function(F,q){var j={},H=0,Z=!1,be=0,Re=0;if(j.frames=[],!(function(le,Ne){for(var Be=0;Be<4;Be++)if(le[Ne+Be]!="RIFF".charCodeAt(Be))return!0;return!1})(F,q)){for(V(F,q+=4),q+=8;q<F.length;){var Oe=b(F,q),Me=V(F,q+=4);q+=4;var we=Me+(1&Me);switch(Oe){case"VP8 ":case"VP8L":j.frames[H]===void 0&&(j.frames[H]={}),(xe=j.frames[H]).src_off=Z?Re:q-8,xe.src_size=be+Me+8,H++,Z&&(Z=!1,be=0,Re=0);break;case"VP8X":(xe=j.header={}).feature_flags=F[q];var De=q+4;xe.canvas_width=1+M(F,De),De+=3,xe.canvas_height=1+M(F,De),De+=3;break;case"ALPH":Z=!0,be=we+8,Re=q-8;break;case"ANIM":(xe=j.header).bgcolor=V(F,q),De=q+4,xe.loop_count=I(F,De),De+=2;break;case"ANMF":var tt,xe;(xe=j.frames[H]={}).offset_x=2*M(F,q),q+=3,xe.offset_y=2*M(F,q),q+=3,xe.width=1+M(F,q),q+=3,xe.height=1+M(F,q),q+=3,xe.duration=M(F,q),q+=3,tt=F[q++],xe.dispose=1&tt,xe.blend=tt>>1&1}Oe!="ANMF"&&(q+=we)}return j}})(J,0);ne.response=J,ne.rgbaoutput=!0,ne.dataurl=!1;var me=ne.header?ne.header:null,ue=ne.frames?ne.frames:null;if(me){me.loop_counter=me.loop_count,k=[me.canvas_height],ie=[me.canvas_width];for(var ke=0;ke<ue.length&&ue[ke].blend!=0;ke++);}var ze=ue[0],pe=de.WebPDecodeRGBA(J,ze.src_off,ze.src_size,ie,k);ze.rgba=pe,ze.imgwidth=ie[0],ze.imgheight=k[0];for(var U=0;U<ie[0]*k[0]*4;U++)se[U]=pe[U];return this.width=ie,this.height=k,this.data=se,this}(function(n){var e,t,i,c,u,m,_,o,b,I=function(le){return le=le||{},this.isStrokeTransparent=le.isStrokeTransparent||!1,this.strokeOpacity=le.strokeOpacity||1,this.strokeStyle=le.strokeStyle||"#000000",this.fillStyle=le.fillStyle||"#000000",this.isFillTransparent=le.isFillTransparent||!1,this.fillOpacity=le.fillOpacity||1,this.font=le.font||"10px sans-serif",this.textBaseline=le.textBaseline||"alphabetic",this.textAlign=le.textAlign||"left",this.lineWidth=le.lineWidth||1,this.lineJoin=le.lineJoin||"miter",this.lineCap=le.lineCap||"butt",this.path=le.path||[],this.transform=le.transform!==void 0?le.transform.clone():new o,this.globalCompositeOperation=le.globalCompositeOperation||"normal",this.globalAlpha=le.globalAlpha||1,this.clip_path=le.clip_path||[],this.currentPoint=le.currentPoint||new m,this.miterLimit=le.miterLimit||10,this.lastPoint=le.lastPoint||new m,this.lineDashOffset=le.lineDashOffset||0,this.lineDash=le.lineDash||[],this.margin=le.margin||[0,0,0,0],this.prevPageLastElemOffset=le.prevPageLastElemOffset||0,this.ignoreClearRect=typeof le.ignoreClearRect!="boolean"||le.ignoreClearRect,this};n.events.push(["initialized",function(){this.context2d=new M(this),e=this.internal.f2,t=this.internal.getCoordinateString,i=this.internal.getVerticalCoordinateString,c=this.internal.getHorizontalCoordinate,u=this.internal.getVerticalCoordinate,m=this.internal.Point,_=this.internal.Rectangle,o=this.internal.Matrix,b=new I}]);var M=function(le){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var Ne=le;Object.defineProperty(this,"pdf",{get:function(){return Ne}});var Be=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return Be},set:function(Gt){Be=!!Gt}});var Qe=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return Qe},set:function(Gt){Qe=!!Gt}});var rt=0;Object.defineProperty(this,"posX",{get:function(){return rt},set:function(Gt){isNaN(Gt)||(rt=Gt)}});var gt=0;Object.defineProperty(this,"posY",{get:function(){return gt},set:function(Gt){isNaN(Gt)||(gt=Gt)}}),Object.defineProperty(this,"margin",{get:function(){return b.margin},set:function(Gt){var ot;typeof Gt=="number"?ot=[Gt,Gt,Gt,Gt]:((ot=new Array(4))[0]=Gt[0],ot[1]=Gt.length>=2?Gt[1]:ot[0],ot[2]=Gt.length>=3?Gt[2]:ot[0],ot[3]=Gt.length>=4?Gt[3]:ot[1]),b.margin=ot}});var pt=!1;Object.defineProperty(this,"autoPaging",{get:function(){return pt},set:function(Gt){pt=Gt}});var Mt=0;Object.defineProperty(this,"lastBreak",{get:function(){return Mt},set:function(Gt){Mt=Gt}});var Jt=[];Object.defineProperty(this,"pageBreaks",{get:function(){return Jt},set:function(Gt){Jt=Gt}}),Object.defineProperty(this,"ctx",{get:function(){return b},set:function(Gt){Gt instanceof I&&(b=Gt)}}),Object.defineProperty(this,"path",{get:function(){return b.path},set:function(Gt){b.path=Gt}});var hn=[];Object.defineProperty(this,"ctxStack",{get:function(){return hn},set:function(Gt){hn=Gt}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(Gt){var ot;ot=V(Gt),this.ctx.fillStyle=ot.style,this.ctx.isFillTransparent=ot.a===0,this.ctx.fillOpacity=ot.a,this.pdf.setFillColor(ot.r,ot.g,ot.b,{a:ot.a}),this.pdf.setTextColor(ot.r,ot.g,ot.b,{a:ot.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(Gt){var ot=V(Gt);this.ctx.strokeStyle=ot.style,this.ctx.isStrokeTransparent=ot.a===0,this.ctx.strokeOpacity=ot.a,ot.a===0?this.pdf.setDrawColor(255,255,255):(ot.a,this.pdf.setDrawColor(ot.r,ot.g,ot.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(Gt){["butt","round","square"].indexOf(Gt)!==-1&&(this.ctx.lineCap=Gt,this.pdf.setLineCap(Gt))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(Gt){isNaN(Gt)||(this.ctx.lineWidth=Gt,this.pdf.setLineWidth(Gt))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(Gt){["bevel","round","miter"].indexOf(Gt)!==-1&&(this.ctx.lineJoin=Gt,this.pdf.setLineJoin(Gt))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(Gt){isNaN(Gt)||(this.ctx.miterLimit=Gt,this.pdf.setMiterLimit(Gt))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(Gt){this.ctx.textBaseline=Gt}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(Gt){["right","end","center","left","start"].indexOf(Gt)!==-1&&(this.ctx.textAlign=Gt)}});var yn=null,Mn=null;Object.defineProperty(this,"fontFaces",{get:function(){return Mn},set:function(Gt){yn=null,Mn=Gt}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(Gt){var ot;if(this.ctx.font=Gt,(ot=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(Gt))!==null){var dr=ot[1];ot[2];var wr=ot[3],Cr=ot[4];ot[5];var Ln=ot[6],ir=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(Cr)[2];Cr=Math.floor(ir==="px"?parseFloat(Cr)*this.pdf.internal.scaleFactor:ir==="em"?parseFloat(Cr)*this.pdf.getFontSize():parseFloat(Cr)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(Cr);var Qn=(function(Ir){var Pr,Si,ki=[],or=Ir.trim();if(or==="")return Rb;if(or in PS)return[PS[or]];for(;or!=="";){switch(Si=null,Pr=(or=RS(or)).charAt(0)){case'"':case"'":Si=iM(or.substring(1),Pr);break;default:Si=oM(or)}if(Si===null||(ki.push(Si[0]),(or=RS(Si[1]))!==""&&or.charAt(0)!==","))return Rb;or=or.replace(/^,/,"")}return ki})(Ln);if(this.fontFaces){var Kr=(function(Ir,Pr){if(yn===null){var Si=(function(ki){var or=[];return Object.keys(ki).forEach(function(oi){ki[oi].forEach(function(Gr){var Or=null;switch(Gr){case"bold":Or={family:oi,weight:"bold"};break;case"italic":Or={family:oi,style:"italic"};break;case"bolditalic":Or={family:oi,weight:"bold",style:"italic"};break;case"":case"normal":Or={family:oi}}Or!==null&&(Or.ref={name:oi,style:Gr},or.push(Or))})}),or})(Ir.getFontList());yn=(function(ki){for(var or={},oi=0;oi<ki.length;++oi){var Gr=kb(ki[oi]),Or=Gr.family,hi=Gr.stretch,si=Gr.style,lt=Gr.weight;or[Or]=or[Or]||{},or[Or][hi]=or[Or][hi]||{},or[Or][hi][si]=or[Or][hi][si]||{},or[Or][hi][si][lt]=Gr}return or})(Si.concat(Pr))}return yn})(this.pdf,this.fontFaces),qt=Qn.map(function(Ir){return{family:Ir,stretch:"normal",weight:wr,style:dr}}),Pn=(function(Ir,Pr,Si){for(var ki=(Si=Si||{}).defaultFontFamily||"times",or=Object.assign({},rM,Si.genericFontFamilies||{}),oi=null,Gr=null,Or=0;Or<Pr.length;++Or)if(or[(oi=kb(Pr[Or])).family]&&(oi.family=or[oi.family]),Ir.hasOwnProperty(oi.family)){Gr=Ir[oi.family];break}if(!(Gr=Gr||Ir[ki]))throw new Error("Could not find a font-family for the rule '"+kS(oi)+"' and default family '"+ki+"'.");if(Gr=(function(hi,si){if(si[hi])return si[hi];var lt=T5[hi],Ee=lt<=T5.normal?-1:1,Te=LS(si,H6,lt,Ee);if(!Te)throw new Error("Could not find a matching font-stretch value for "+hi);return Te})(oi.stretch,Gr),Gr=(function(hi,si){if(si[hi])return si[hi];for(var lt=G6[hi],Ee=0;Ee<lt.length;++Ee)if(si[lt[Ee]])return si[lt[Ee]];throw new Error("Could not find a matching font-style for "+hi)})(oi.style,Gr),!(Gr=(function(hi,si){if(si[hi])return si[hi];if(hi===400&&si[500])return si[500];if(hi===500&&si[400])return si[400];var lt=nM[hi],Ee=LS(si,W6,lt,hi<400?-1:1);if(!Ee)throw new Error("Could not find a matching font-weight for value "+hi);return Ee})(oi.weight,Gr)))throw new Error("Failed to resolve a font for the rule '"+kS(oi)+"'.");return Gr})(Kr,qt);this.pdf.setFont(Pn.ref.name,Pn.ref.style)}else{var Hn="";(wr==="bold"||parseInt(wr,10)>=700||dr==="bold")&&(Hn="bold"),dr==="italic"&&(Hn+="italic"),Hn.length===0&&(Hn="normal");for(var Bn="",Rr={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},vr=0;vr<Qn.length;vr++){if(this.pdf.internal.getFont(Qn[vr],Hn,{noFallback:!0,disableWarning:!0})!==void 0){Bn=Qn[vr];break}if(Hn==="bolditalic"&&this.pdf.internal.getFont(Qn[vr],"bold",{noFallback:!0,disableWarning:!0})!==void 0)Bn=Qn[vr],Hn="bold";else if(this.pdf.internal.getFont(Qn[vr],"normal",{noFallback:!0,disableWarning:!0})!==void 0){Bn=Qn[vr],Hn="normal";break}}if(Bn===""){for(var Tr=0;Tr<Qn.length;Tr++)if(Rr[Qn[Tr]]){Bn=Rr[Qn[Tr]];break}}Bn=Bn===""?"Times":Bn,this.pdf.setFont(Bn,Hn)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(Gt){this.ctx.globalCompositeOperation=Gt}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(Gt){this.ctx.globalAlpha=Gt}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(Gt){this.ctx.lineDashOffset=Gt,xe.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(Gt){this.ctx.lineDash=Gt,xe.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(Gt){this.ctx.ignoreClearRect=!!Gt}})};M.prototype.setLineDash=function(le){this.lineDash=le},M.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},M.prototype.fill=function(){ue.call(this,"fill",!1)},M.prototype.stroke=function(){ue.call(this,"stroke",!1)},M.prototype.beginPath=function(){this.path=[{type:"begin"}]},M.prototype.moveTo=function(le,Ne){if(isNaN(le)||isNaN(Ne))throw Ga.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var Be=this.ctx.transform.applyToPoint(new m(le,Ne));this.path.push({type:"mt",x:Be.x,y:Be.y}),this.ctx.lastPoint=new m(le,Ne)},M.prototype.closePath=function(){var le=new m(0,0),Ne=0;for(Ne=this.path.length-1;Ne!==-1;Ne--)if(this.path[Ne].type==="begin"&&xa(this.path[Ne+1])==="object"&&typeof this.path[Ne+1].x=="number"){le=new m(this.path[Ne+1].x,this.path[Ne+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new m(le.x,le.y)},M.prototype.lineTo=function(le,Ne){if(isNaN(le)||isNaN(Ne))throw Ga.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var Be=this.ctx.transform.applyToPoint(new m(le,Ne));this.path.push({type:"lt",x:Be.x,y:Be.y}),this.ctx.lastPoint=new m(Be.x,Be.y)},M.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),ue.call(this,null,!0)},M.prototype.quadraticCurveTo=function(le,Ne,Be,Qe){if(isNaN(Be)||isNaN(Qe)||isNaN(le)||isNaN(Ne))throw Ga.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var rt=this.ctx.transform.applyToPoint(new m(Be,Qe)),gt=this.ctx.transform.applyToPoint(new m(le,Ne));this.path.push({type:"qct",x1:gt.x,y1:gt.y,x:rt.x,y:rt.y}),this.ctx.lastPoint=new m(rt.x,rt.y)},M.prototype.bezierCurveTo=function(le,Ne,Be,Qe,rt,gt){if(isNaN(rt)||isNaN(gt)||isNaN(le)||isNaN(Ne)||isNaN(Be)||isNaN(Qe))throw Ga.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var pt=this.ctx.transform.applyToPoint(new m(rt,gt)),Mt=this.ctx.transform.applyToPoint(new m(le,Ne)),Jt=this.ctx.transform.applyToPoint(new m(Be,Qe));this.path.push({type:"bct",x1:Mt.x,y1:Mt.y,x2:Jt.x,y2:Jt.y,x:pt.x,y:pt.y}),this.ctx.lastPoint=new m(pt.x,pt.y)},M.prototype.arc=function(le,Ne,Be,Qe,rt,gt){if(isNaN(le)||isNaN(Ne)||isNaN(Be)||isNaN(Qe)||isNaN(rt))throw Ga.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(gt=!!gt,!this.ctx.transform.isIdentity){var pt=this.ctx.transform.applyToPoint(new m(le,Ne));le=pt.x,Ne=pt.y;var Mt=this.ctx.transform.applyToPoint(new m(0,Be)),Jt=this.ctx.transform.applyToPoint(new m(0,0));Be=Math.sqrt(Math.pow(Mt.x-Jt.x,2)+Math.pow(Mt.y-Jt.y,2))}Math.abs(rt-Qe)>=2*Math.PI&&(Qe=0,rt=2*Math.PI),this.path.push({type:"arc",x:le,y:Ne,radius:Be,startAngle:Qe,endAngle:rt,counterclockwise:gt})},M.prototype.arcTo=function(le,Ne,Be,Qe,rt){throw new Error("arcTo not implemented.")},M.prototype.rect=function(le,Ne,Be,Qe){if(isNaN(le)||isNaN(Ne)||isNaN(Be)||isNaN(Qe))throw Ga.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(le,Ne),this.lineTo(le+Be,Ne),this.lineTo(le+Be,Ne+Qe),this.lineTo(le,Ne+Qe),this.lineTo(le,Ne),this.lineTo(le+Be,Ne),this.lineTo(le,Ne)},M.prototype.fillRect=function(le,Ne,Be,Qe){if(isNaN(le)||isNaN(Ne)||isNaN(Be)||isNaN(Qe))throw Ga.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!k.call(this)){var rt={};this.lineCap!=="butt"&&(rt.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(rt.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(le,Ne,Be,Qe),this.fill(),rt.hasOwnProperty("lineCap")&&(this.lineCap=rt.lineCap),rt.hasOwnProperty("lineJoin")&&(this.lineJoin=rt.lineJoin)}},M.prototype.strokeRect=function(le,Ne,Be,Qe){if(isNaN(le)||isNaN(Ne)||isNaN(Be)||isNaN(Qe))throw Ga.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");ie.call(this)||(this.beginPath(),this.rect(le,Ne,Be,Qe),this.stroke())},M.prototype.clearRect=function(le,Ne,Be,Qe){if(isNaN(le)||isNaN(Ne)||isNaN(Be)||isNaN(Qe))throw Ga.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(le,Ne,Be,Qe))},M.prototype.save=function(le){le=typeof le!="boolean"||le;for(var Ne=this.pdf.internal.getCurrentPageInfo().pageNumber,Be=0;Be<this.pdf.internal.getNumberOfPages();Be++)this.pdf.setPage(Be+1),this.pdf.internal.out("q");if(this.pdf.setPage(Ne),le){this.ctx.fontSize=this.pdf.internal.getFontSize();var Qe=new I(this.ctx);this.ctxStack.push(this.ctx),this.ctx=Qe}},M.prototype.restore=function(le){le=typeof le!="boolean"||le;for(var Ne=this.pdf.internal.getCurrentPageInfo().pageNumber,Be=0;Be<this.pdf.internal.getNumberOfPages();Be++)this.pdf.setPage(Be+1),this.pdf.internal.out("Q");this.pdf.setPage(Ne),le&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},M.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var V=function(le){var Ne,Be,Qe,rt;if(le.isCanvasGradient===!0&&(le=le.getColor()),!le)return{r:0,g:0,b:0,a:0,style:le};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(le))Ne=0,Be=0,Qe=0,rt=0;else{var gt=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(le);if(gt!==null)Ne=parseInt(gt[1]),Be=parseInt(gt[2]),Qe=parseInt(gt[3]),rt=1;else if((gt=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(le))!==null)Ne=parseInt(gt[1]),Be=parseInt(gt[2]),Qe=parseInt(gt[3]),rt=parseFloat(gt[4]);else{if(rt=1,typeof le=="string"&&le.charAt(0)!=="#"){var pt=new B6(le);le=pt.ok?pt.toHex():"#000000"}le.length===4?(Ne=le.substring(1,2),Ne+=Ne,Be=le.substring(2,3),Be+=Be,Qe=le.substring(3,4),Qe+=Qe):(Ne=le.substring(1,3),Be=le.substring(3,5),Qe=le.substring(5,7)),Ne=parseInt(Ne,16),Be=parseInt(Be,16),Qe=parseInt(Qe,16)}}return{r:Ne,g:Be,b:Qe,a:rt,style:le}},k=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},ie=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};M.prototype.fillText=function(le,Ne,Be,Qe){if(isNaN(Ne)||isNaN(Be)||typeof le!="string")throw Ga.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(Qe=isNaN(Qe)?void 0:Qe,!k.call(this)){var rt=we(this.ctx.transform.rotation),gt=this.ctx.transform.scaleX;H.call(this,{text:le,x:Ne,y:Be,scale:gt,angle:rt,align:this.textAlign,maxWidth:Qe})}},M.prototype.strokeText=function(le,Ne,Be,Qe){if(isNaN(Ne)||isNaN(Be)||typeof le!="string")throw Ga.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!ie.call(this)){Qe=isNaN(Qe)?void 0:Qe;var rt=we(this.ctx.transform.rotation),gt=this.ctx.transform.scaleX;H.call(this,{text:le,x:Ne,y:Be,scale:gt,renderingMode:"stroke",angle:rt,align:this.textAlign,maxWidth:Qe})}},M.prototype.measureText=function(le){if(typeof le!="string")throw Ga.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var Ne=this.pdf,Be=this.pdf.internal.scaleFactor,Qe=Ne.internal.getFontSize(),rt=Ne.getStringUnitWidth(le)*Qe/Ne.internal.scaleFactor;return new function(gt){var pt=(gt=gt||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return pt}}),this}({width:rt*=Math.round(96*Be/72*1e4)/1e4})},M.prototype.scale=function(le,Ne){if(isNaN(le)||isNaN(Ne))throw Ga.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var Be=new o(le,0,0,Ne,0,0);this.ctx.transform=this.ctx.transform.multiply(Be)},M.prototype.rotate=function(le){if(isNaN(le))throw Ga.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var Ne=new o(Math.cos(le),Math.sin(le),-Math.sin(le),Math.cos(le),0,0);this.ctx.transform=this.ctx.transform.multiply(Ne)},M.prototype.translate=function(le,Ne){if(isNaN(le)||isNaN(Ne))throw Ga.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var Be=new o(1,0,0,1,le,Ne);this.ctx.transform=this.ctx.transform.multiply(Be)},M.prototype.transform=function(le,Ne,Be,Qe,rt,gt){if(isNaN(le)||isNaN(Ne)||isNaN(Be)||isNaN(Qe)||isNaN(rt)||isNaN(gt))throw Ga.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var pt=new o(le,Ne,Be,Qe,rt,gt);this.ctx.transform=this.ctx.transform.multiply(pt)},M.prototype.setTransform=function(le,Ne,Be,Qe,rt,gt){le=isNaN(le)?1:le,Ne=isNaN(Ne)?0:Ne,Be=isNaN(Be)?0:Be,Qe=isNaN(Qe)?1:Qe,rt=isNaN(rt)?0:rt,gt=isNaN(gt)?0:gt,this.ctx.transform=new o(le,Ne,Be,Qe,rt,gt)};var se=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};M.prototype.drawImage=function(le,Ne,Be,Qe,rt,gt,pt,Mt,Jt){var hn=this.pdf.getImageProperties(le),yn=1,Mn=1,Gt=1,ot=1;Qe!==void 0&&Mt!==void 0&&(Gt=Mt/Qe,ot=Jt/rt,yn=hn.width/Qe*Mt/Qe,Mn=hn.height/rt*Jt/rt),gt===void 0&&(gt=Ne,pt=Be,Ne=0,Be=0),Qe!==void 0&&Mt===void 0&&(Mt=Qe,Jt=rt),Qe===void 0&&Mt===void 0&&(Mt=hn.width,Jt=hn.height);for(var dr,wr=this.ctx.transform.decompose(),Cr=we(wr.rotate.shx),Ln=new o,ir=(Ln=(Ln=(Ln=Ln.multiply(wr.translate)).multiply(wr.skew)).multiply(wr.scale)).applyToRectangle(new _(gt-Ne*Gt,pt-Be*ot,Qe*yn,rt*Mn)),Qn=de.call(this,ir),Kr=[],qt=0;qt<Qn.length;qt+=1)Kr.indexOf(Qn[qt])===-1&&Kr.push(Qn[qt]);if(me(Kr),this.autoPaging)for(var Pn=Kr[0],Hn=Kr[Kr.length-1],Bn=Pn;Bn<Hn+1;Bn++){this.pdf.setPage(Bn);var Rr=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],vr=Bn===1?this.posY+this.margin[0]:this.margin[0],Tr=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Ir=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Pr=Bn===1?0:Tr+(Bn-2)*Ir;if(this.ctx.clip_path.length!==0){var Si=this.path;dr=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=ne(dr,this.posX+this.margin[3],-Pr+vr+this.ctx.prevPageLastElemOffset),ke.call(this,"fill",!0),this.path=Si}var ki=JSON.parse(JSON.stringify(ir));ki=ne([ki],this.posX+this.margin[3],-Pr+vr+this.ctx.prevPageLastElemOffset)[0];var or=(Bn>Pn||Bn<Hn)&&se.call(this);or&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Rr,Ir,null).clip().discardPath()),this.pdf.addImage(le,"JPEG",ki.x,ki.y,ki.w,ki.h,null,null,Cr),or&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(le,"JPEG",ir.x,ir.y,ir.w,ir.h,null,null,Cr)};var de=function(le,Ne,Be){var Qe=[];Ne=Ne||this.pdf.internal.pageSize.width,Be=Be||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var rt=this.posY+this.ctx.prevPageLastElemOffset;switch(le.type){default:case"mt":case"lt":Qe.push(Math.floor((le.y+rt)/Be)+1);break;case"arc":Qe.push(Math.floor((le.y+rt-le.radius)/Be)+1),Qe.push(Math.floor((le.y+rt+le.radius)/Be)+1);break;case"qct":var gt=De(this.ctx.lastPoint.x,this.ctx.lastPoint.y,le.x1,le.y1,le.x,le.y);Qe.push(Math.floor((gt.y+rt)/Be)+1),Qe.push(Math.floor((gt.y+gt.h+rt)/Be)+1);break;case"bct":var pt=tt(this.ctx.lastPoint.x,this.ctx.lastPoint.y,le.x1,le.y1,le.x2,le.y2,le.x,le.y);Qe.push(Math.floor((pt.y+rt)/Be)+1),Qe.push(Math.floor((pt.y+pt.h+rt)/Be)+1);break;case"rect":Qe.push(Math.floor((le.y+rt)/Be)+1),Qe.push(Math.floor((le.y+le.h+rt)/Be)+1)}for(var Mt=0;Mt<Qe.length;Mt+=1)for(;this.pdf.internal.getNumberOfPages()<Qe[Mt];)J.call(this);return Qe},J=function(){var le=this.fillStyle,Ne=this.strokeStyle,Be=this.font,Qe=this.lineCap,rt=this.lineWidth,gt=this.lineJoin;this.pdf.addPage(),this.fillStyle=le,this.strokeStyle=Ne,this.font=Be,this.lineCap=Qe,this.lineWidth=rt,this.lineJoin=gt},ne=function(le,Ne,Be){for(var Qe=0;Qe<le.length;Qe++)switch(le[Qe].type){case"bct":le[Qe].x2+=Ne,le[Qe].y2+=Be;case"qct":le[Qe].x1+=Ne,le[Qe].y1+=Be;default:le[Qe].x+=Ne,le[Qe].y+=Be}return le},me=function(le){return le.sort(function(Ne,Be){return Ne-Be})},ue=function(le,Ne){for(var Be,Qe,rt=this.fillStyle,gt=this.strokeStyle,pt=this.lineCap,Mt=this.lineWidth,Jt=Math.abs(Mt*this.ctx.transform.scaleX),hn=this.lineJoin,yn=JSON.parse(JSON.stringify(this.path)),Mn=JSON.parse(JSON.stringify(this.path)),Gt=[],ot=0;ot<Mn.length;ot++)if(Mn[ot].x!==void 0)for(var dr=de.call(this,Mn[ot]),wr=0;wr<dr.length;wr+=1)Gt.indexOf(dr[wr])===-1&&Gt.push(dr[wr]);for(var Cr=0;Cr<Gt.length;Cr++)for(;this.pdf.internal.getNumberOfPages()<Gt[Cr];)J.call(this);if(me(Gt),this.autoPaging)for(var Ln=Gt[0],ir=Gt[Gt.length-1],Qn=Ln;Qn<ir+1;Qn++){this.pdf.setPage(Qn),this.fillStyle=rt,this.strokeStyle=gt,this.lineCap=pt,this.lineWidth=Jt,this.lineJoin=hn;var Kr=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],qt=Qn===1?this.posY+this.margin[0]:this.margin[0],Pn=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Hn=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Bn=Qn===1?0:Pn+(Qn-2)*Hn;if(this.ctx.clip_path.length!==0){var Rr=this.path;Be=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=ne(Be,this.posX+this.margin[3],-Bn+qt+this.ctx.prevPageLastElemOffset),ke.call(this,le,!0),this.path=Rr}if(Qe=JSON.parse(JSON.stringify(yn)),this.path=ne(Qe,this.posX+this.margin[3],-Bn+qt+this.ctx.prevPageLastElemOffset),Ne===!1||Qn===0){var vr=(Qn>Ln||Qn<ir)&&se.call(this);vr&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Kr,Hn,null).clip().discardPath()),ke.call(this,le,Ne),vr&&this.pdf.restoreGraphicsState()}this.lineWidth=Mt}else this.lineWidth=Jt,ke.call(this,le,Ne),this.lineWidth=Mt;this.path=yn},ke=function(le,Ne){if((le!=="stroke"||Ne||!ie.call(this))&&(le==="stroke"||Ne||!k.call(this))){for(var Be,Qe,rt=[],gt=this.path,pt=0;pt<gt.length;pt++){var Mt=gt[pt];switch(Mt.type){case"begin":rt.push({begin:!0});break;case"close":rt.push({close:!0});break;case"mt":rt.push({start:Mt,deltas:[],abs:[]});break;case"lt":var Jt=rt.length;if(gt[pt-1]&&!isNaN(gt[pt-1].x)&&(Be=[Mt.x-gt[pt-1].x,Mt.y-gt[pt-1].y],Jt>0)){for(;Jt>=0;Jt--)if(rt[Jt-1].close!==!0&&rt[Jt-1].begin!==!0){rt[Jt-1].deltas.push(Be),rt[Jt-1].abs.push(Mt);break}}break;case"bct":Be=[Mt.x1-gt[pt-1].x,Mt.y1-gt[pt-1].y,Mt.x2-gt[pt-1].x,Mt.y2-gt[pt-1].y,Mt.x-gt[pt-1].x,Mt.y-gt[pt-1].y],rt[rt.length-1].deltas.push(Be);break;case"qct":var hn=gt[pt-1].x+2/3*(Mt.x1-gt[pt-1].x),yn=gt[pt-1].y+2/3*(Mt.y1-gt[pt-1].y),Mn=Mt.x+2/3*(Mt.x1-Mt.x),Gt=Mt.y+2/3*(Mt.y1-Mt.y),ot=Mt.x,dr=Mt.y;Be=[hn-gt[pt-1].x,yn-gt[pt-1].y,Mn-gt[pt-1].x,Gt-gt[pt-1].y,ot-gt[pt-1].x,dr-gt[pt-1].y],rt[rt.length-1].deltas.push(Be);break;case"arc":rt.push({deltas:[],abs:[],arc:!0}),Array.isArray(rt[rt.length-1].abs)&&rt[rt.length-1].abs.push(Mt)}}Qe=Ne?null:le==="stroke"?"stroke":"fill";for(var wr=!1,Cr=0;Cr<rt.length;Cr++)if(rt[Cr].arc)for(var Ln=rt[Cr].abs,ir=0;ir<Ln.length;ir++){var Qn=Ln[ir];Qn.type==="arc"?U.call(this,Qn.x,Qn.y,Qn.radius,Qn.startAngle,Qn.endAngle,Qn.counterclockwise,void 0,Ne,!wr):Z.call(this,Qn.x,Qn.y),wr=!0}else if(rt[Cr].close===!0)this.pdf.internal.out("h"),wr=!1;else if(rt[Cr].begin!==!0){var Kr=rt[Cr].start.x,qt=rt[Cr].start.y;be.call(this,rt[Cr].deltas,Kr,qt),wr=!0}Qe&&F.call(this,Qe),Ne&&q.call(this)}},ze=function(le){var Ne=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,Be=Ne*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return le-Be;case"top":return le+Ne-Be;case"hanging":return le+Ne-2*Be;case"middle":return le+Ne/2-Be;default:return le}},pe=function(le){return le+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};M.prototype.createLinearGradient=function(){var le=function(){};return le.colorStops=[],le.addColorStop=function(Ne,Be){this.colorStops.push([Ne,Be])},le.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},le.isCanvasGradient=!0,le},M.prototype.createPattern=function(){return this.createLinearGradient()},M.prototype.createRadialGradient=function(){return this.createLinearGradient()};var U=function(le,Ne,Be,Qe,rt,gt,pt,Mt,Jt){for(var hn=Oe.call(this,Be,Qe,rt,gt),yn=0;yn<hn.length;yn++){var Mn=hn[yn];yn===0&&(Jt?j.call(this,Mn.x1+le,Mn.y1+Ne):Z.call(this,Mn.x1+le,Mn.y1+Ne)),Re.call(this,le,Ne,Mn.x2,Mn.y2,Mn.x3,Mn.y3,Mn.x4,Mn.y4)}Mt?q.call(this):F.call(this,pt)},F=function(le){switch(le){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},q=function(){this.pdf.clip(),this.pdf.discardPath()},j=function(le,Ne){this.pdf.internal.out(t(le)+" "+i(Ne)+" m")},H=function(le){var Ne;switch(le.align){case"right":case"end":Ne="right";break;case"center":Ne="center";break;default:Ne="left"}var Be=this.pdf.getTextDimensions(le.text),Qe=ze.call(this,le.y),rt=pe.call(this,Qe)-Be.h,gt=this.ctx.transform.applyToPoint(new m(le.x,Qe)),pt=this.ctx.transform.decompose(),Mt=new o;Mt=(Mt=(Mt=Mt.multiply(pt.translate)).multiply(pt.skew)).multiply(pt.scale);for(var Jt,hn,yn,Mn=this.ctx.transform.applyToRectangle(new _(le.x,Qe,Be.w,Be.h)),Gt=Mt.applyToRectangle(new _(le.x,rt,Be.w,Be.h)),ot=de.call(this,Gt),dr=[],wr=0;wr<ot.length;wr+=1)dr.indexOf(ot[wr])===-1&&dr.push(ot[wr]);if(me(dr),this.autoPaging)for(var Cr=dr[0],Ln=dr[dr.length-1],ir=Cr;ir<Ln+1;ir++){this.pdf.setPage(ir);var Qn=ir===1?this.posY+this.margin[0]:this.margin[0],Kr=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],qt=this.pdf.internal.pageSize.height-this.margin[2],Pn=qt-this.margin[0],Hn=this.pdf.internal.pageSize.width-this.margin[1],Bn=Hn-this.margin[3],Rr=ir===1?0:Kr+(ir-2)*Pn;if(this.ctx.clip_path.length!==0){var vr=this.path;Jt=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=ne(Jt,this.posX+this.margin[3],-1*Rr+Qn),ke.call(this,"fill",!0),this.path=vr}var Tr=ne([JSON.parse(JSON.stringify(Gt))],this.posX+this.margin[3],-Rr+Qn+this.ctx.prevPageLastElemOffset)[0];le.scale>=.01&&(hn=this.pdf.internal.getFontSize(),this.pdf.setFontSize(hn*le.scale),yn=this.lineWidth,this.lineWidth=yn*le.scale);var Ir=this.autoPaging!=="text";if(Ir||Tr.y+Tr.h<=qt){if(Ir||Tr.y>=Qn&&Tr.x<=Hn){var Pr=Ir?le.text:this.pdf.splitTextToSize(le.text,le.maxWidth||Hn-Tr.x)[0],Si=ne([JSON.parse(JSON.stringify(Mn))],this.posX+this.margin[3],-Rr+Qn+this.ctx.prevPageLastElemOffset)[0],ki=Ir&&(ir>Cr||ir<Ln)&&se.call(this);ki&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Bn,Pn,null).clip().discardPath()),this.pdf.text(Pr,Si.x,Si.y,{angle:le.angle,align:Ne,renderingMode:le.renderingMode}),ki&&this.pdf.restoreGraphicsState()}}else Tr.y<qt&&(this.ctx.prevPageLastElemOffset+=qt-Tr.y);le.scale>=.01&&(this.pdf.setFontSize(hn),this.lineWidth=yn)}else le.scale>=.01&&(hn=this.pdf.internal.getFontSize(),this.pdf.setFontSize(hn*le.scale),yn=this.lineWidth,this.lineWidth=yn*le.scale),this.pdf.text(le.text,gt.x+this.posX,gt.y+this.posY,{angle:le.angle,align:Ne,renderingMode:le.renderingMode,maxWidth:le.maxWidth}),le.scale>=.01&&(this.pdf.setFontSize(hn),this.lineWidth=yn)},Z=function(le,Ne,Be,Qe){Be=Be||0,Qe=Qe||0,this.pdf.internal.out(t(le+Be)+" "+i(Ne+Qe)+" l")},be=function(le,Ne,Be){return this.pdf.lines(le,Ne,Be,null,null)},Re=function(le,Ne,Be,Qe,rt,gt,pt,Mt){this.pdf.internal.out([e(c(Be+le)),e(u(Qe+Ne)),e(c(rt+le)),e(u(gt+Ne)),e(c(pt+le)),e(u(Mt+Ne)),"c"].join(" "))},Oe=function(le,Ne,Be,Qe){for(var rt=2*Math.PI,gt=Math.PI/2;Ne>Be;)Ne-=rt;var pt=Math.abs(Be-Ne);pt<rt&&Qe&&(pt=rt-pt);for(var Mt=[],Jt=Qe?-1:1,hn=Ne;pt>1e-5;){var yn=hn+Jt*Math.min(pt,gt);Mt.push(Me.call(this,le,hn,yn)),pt-=Math.abs(yn-hn),hn=yn}return Mt},Me=function(le,Ne,Be){var Qe=(Be-Ne)/2,rt=le*Math.cos(Qe),gt=le*Math.sin(Qe),pt=rt,Mt=-gt,Jt=pt*pt+Mt*Mt,hn=Jt+pt*rt+Mt*gt,yn=4/3*(Math.sqrt(2*Jt*hn)-hn)/(pt*gt-Mt*rt),Mn=pt-yn*Mt,Gt=Mt+yn*pt,ot=Mn,dr=-Gt,wr=Qe+Ne,Cr=Math.cos(wr),Ln=Math.sin(wr);return{x1:le*Math.cos(Ne),y1:le*Math.sin(Ne),x2:Mn*Cr-Gt*Ln,y2:Mn*Ln+Gt*Cr,x3:ot*Cr-dr*Ln,y3:ot*Ln+dr*Cr,x4:le*Math.cos(Be),y4:le*Math.sin(Be)}},we=function(le){return 180*le/Math.PI},De=function(le,Ne,Be,Qe,rt,gt){var pt=le+.5*(Be-le),Mt=Ne+.5*(Qe-Ne),Jt=rt+.5*(Be-rt),hn=gt+.5*(Qe-gt),yn=Math.min(le,rt,pt,Jt),Mn=Math.max(le,rt,pt,Jt),Gt=Math.min(Ne,gt,Mt,hn),ot=Math.max(Ne,gt,Mt,hn);return new _(yn,Gt,Mn-yn,ot-Gt)},tt=function(le,Ne,Be,Qe,rt,gt,pt,Mt){var Jt,hn,yn,Mn,Gt,ot,dr,wr,Cr,Ln,ir,Qn,Kr,qt,Pn=Be-le,Hn=Qe-Ne,Bn=rt-Be,Rr=gt-Qe,vr=pt-rt,Tr=Mt-gt;for(hn=0;hn<41;hn++)Cr=(dr=(yn=le+(Jt=hn/40)*Pn)+Jt*((Gt=Be+Jt*Bn)-yn))+Jt*(Gt+Jt*(rt+Jt*vr-Gt)-dr),Ln=(wr=(Mn=Ne+Jt*Hn)+Jt*((ot=Qe+Jt*Rr)-Mn))+Jt*(ot+Jt*(gt+Jt*Tr-ot)-wr),hn==0?(ir=Cr,Qn=Ln,Kr=Cr,qt=Ln):(ir=Math.min(ir,Cr),Qn=Math.min(Qn,Ln),Kr=Math.max(Kr,Cr),qt=Math.max(qt,Ln));return new _(Math.round(ir),Math.round(Qn),Math.round(Kr-ir),Math.round(qt-Qn))},xe=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var le,Ne,Be=(le=this.ctx.lineDash,Ne=this.ctx.lineDashOffset,JSON.stringify({lineDash:le,lineDashOffset:Ne}));this.prevLineDash!==Be&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=Be)}}})(wi.API),(function(n){var e=function(m){var _,o,b,I,M,V,k,ie,se,de;for(o=[],b=0,I=(m+=_="\0\0\0\0".slice(m.length%4||4)).length;I>b;b+=4)(M=(m.charCodeAt(b)<<24)+(m.charCodeAt(b+1)<<16)+(m.charCodeAt(b+2)<<8)+m.charCodeAt(b+3))!==0?(V=(M=((M=((M=((M=(M-(de=M%85))/85)-(se=M%85))/85)-(ie=M%85))/85)-(k=M%85))/85)%85,o.push(V+33,k+33,ie+33,se+33,de+33)):o.push(122);return(function(J,ne){for(var me=ne;me>0;me--)J.pop()})(o,_.length),String.fromCharCode.apply(String,o)+"~>"},t=function(m){var _,o,b,I,M,V=String,k="length",ie=255,se="charCodeAt",de="slice",J="replace";for(m[de](-2),m=m[de](0,-2)[J](/\s/g,"")[J]("z","!!!!!"),b=[],I=0,M=(m+=_="uuuuu"[de](m[k]%5||5))[k];M>I;I+=5)o=52200625*(m[se](I)-33)+614125*(m[se](I+1)-33)+7225*(m[se](I+2)-33)+85*(m[se](I+3)-33)+(m[se](I+4)-33),b.push(ie&o>>24,ie&o>>16,ie&o>>8,ie&o);return(function(ne,me){for(var ue=me;ue>0;ue--)ne.pop()})(b,_[k]),V.fromCharCode.apply(V,b)},i=function(m){return m.split("").map(function(_){return("0"+_.charCodeAt().toString(16)).slice(-2)}).join("")+">"},c=function(m){var _=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((m=m.replace(/\s/g,"")).indexOf(">")!==-1&&(m=m.substr(0,m.indexOf(">"))),m.length%2&&(m+="0"),_.test(m)===!1)return"";for(var o="",b=0;b<m.length;b+=2)o+=String.fromCharCode("0x"+(m[b]+m[b+1]));return o},u=function(m){for(var _=new Uint8Array(m.length),o=m.length;o--;)_[o]=m.charCodeAt(o);return(_=v5(_)).reduce(function(b,I){return b+String.fromCharCode(I)},"")};n.processDataByFilters=function(m,_){var o=0,b=m||"",I=[];for(typeof(_=_||[])=="string"&&(_=[_]),o=0;o<_.length;o+=1)switch(_[o]){case"ASCII85Decode":case"/ASCII85Decode":b=t(b),I.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":b=e(b),I.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":b=c(b),I.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":b=i(b),I.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":b=u(b),I.push("/FlateDecode");break;default:throw new Error('The filter: "'+_[o]+'" is not implemented')}return{data:b,reverseChain:I.reverse().join(" ")}}})(wi.API),(function(n){n.loadFile=function(e,t,i){return(function(c,u,m){u=u!==!1,m=typeof m=="function"?m:function(){};var _=void 0;try{_=(function(o,b,I){var M=new XMLHttpRequest,V=0,k=function(ie){var se=ie.length,de=[],J=String.fromCharCode;for(V=0;V<se;V+=1)de.push(J(255&ie.charCodeAt(V)));return de.join("")};if(M.open("GET",o,!b),M.overrideMimeType("text/plain; charset=x-user-defined"),b===!1&&(M.onload=function(){M.status===200?I(k(this.responseText)):I(void 0)}),M.send(null),b&&M.status===200)return k(M.responseText)})(c,u,m)}catch{}return _})(e,t,i)},n.loadImageFile=n.loadFile})(wi.API),(function(n){function e(){return(uo.html2canvas?Promise.resolve(uo.html2canvas):fb(()=>import("./html2canvas.esm-B0tyYwQk.js"),[])).catch(function(_){return Promise.reject(new Error("Could not load html2canvas: "+_))}).then(function(_){return _.default?_.default:_})}function t(){return(uo.DOMPurify?Promise.resolve(uo.DOMPurify):fb(()=>import("./purify.es-B6FQ9oRL.js"),[])).catch(function(_){return Promise.reject(new Error("Could not load dompurify: "+_))}).then(function(_){return _.default?_.default:_})}var i=function(_){var o=xa(_);return o==="undefined"?"undefined":o==="string"||_ instanceof String?"string":o==="number"||_ instanceof Number?"number":o==="function"||_ instanceof Function?"function":_&&_.constructor===Array?"array":_&&_.nodeType===1?"element":o==="object"?"object":"unknown"},c=function(_,o){var b=document.createElement(_);for(var I in o.className&&(b.className=o.className),o.innerHTML&&o.dompurify&&(b.innerHTML=o.dompurify.sanitize(o.innerHTML)),o.style)b.style[I]=o.style[I];return b},u=function _(o,b){for(var I=o.nodeType===3?document.createTextNode(o.nodeValue):o.cloneNode(!1),M=o.firstChild;M;M=M.nextSibling)b!==!0&&M.nodeType===1&&M.nodeName==="SCRIPT"||I.appendChild(_(M,b));return o.nodeType===1&&(o.nodeName==="CANVAS"?(I.width=o.width,I.height=o.height,I.getContext("2d").drawImage(o,0,0)):o.nodeName!=="TEXTAREA"&&o.nodeName!=="SELECT"||(I.value=o.value),I.addEventListener("load",function(){I.scrollTop=o.scrollTop,I.scrollLeft=o.scrollLeft},!0)),I},m=function _(o){var b=Object.assign(_.convert(Promise.resolve()),JSON.parse(JSON.stringify(_.template))),I=_.convert(Promise.resolve(),b);return(I=I.setProgress(1,_,1,[_])).set(o)};(m.prototype=Object.create(Promise.prototype)).constructor=m,m.convert=function(_,o){return _.__proto__=o||m.prototype,_},m.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},m.prototype.from=function(_,o){return this.then(function(){switch(o=o||(function(b){switch(i(b)){case"string":return"string";case"element":return b.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}})(_),o){case"string":return this.then(t).then(function(b){return this.set({src:c("div",{innerHTML:_,dompurify:b})})});case"element":return this.set({src:_});case"canvas":return this.set({canvas:_});case"img":return this.set({img:_});default:return this.error("Unknown source type.")}})},m.prototype.to=function(_){switch(_){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},m.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var _={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},o=u(this.prop.src,this.opt.html2canvas.javascriptEnabled);o.tagName==="BODY"&&(_.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=c("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=c("div",{className:"html2pdf__container",style:_}),this.prop.container.appendChild(o),this.prop.container.firstChild.appendChild(c("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},m.prototype.toCanvas=function(){var _=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(_).then(e).then(function(o){var b=Object.assign({},this.opt.html2canvas);return delete b.onrendered,o(this.prop.container,b)}).then(function(o){(this.opt.html2canvas.onrendered||function(){})(o),this.prop.canvas=o,document.body.removeChild(this.prop.overlay)})},m.prototype.toContext2d=function(){var _=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(_).then(e).then(function(o){var b=this.opt.jsPDF,I=this.opt.fontFaces,M=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,V=Object.assign({async:!0,allowTaint:!0,scale:M,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete V.onrendered,b.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,b.context2d.posX=this.opt.x,b.context2d.posY=this.opt.y,b.context2d.margin=this.opt.margin,b.context2d.fontFaces=I,I)for(var k=0;k<I.length;++k){var ie=I[k],se=ie.src.find(function(de){return de.format==="truetype"});se&&b.addFont(se.url,ie.ref.name,ie.ref.style)}return V.windowHeight=V.windowHeight||0,V.windowHeight=V.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):V.windowHeight,b.context2d.save(!0),o(this.prop.container,V)}).then(function(o){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(o),this.prop.canvas=o,document.body.removeChild(this.prop.overlay)})},m.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var _=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=_})},m.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},m.prototype.output=function(_,o,b){return(b=b||"pdf").toLowerCase()==="img"||b.toLowerCase()==="image"?this.outputImg(_,o):this.outputPdf(_,o)},m.prototype.outputPdf=function(_,o){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(_,o)})},m.prototype.outputImg=function(_){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(_){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+_+'" is not supported.'}})},m.prototype.save=function(_){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(_?{filename:_}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},m.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},m.prototype.set=function(_){if(i(_)!=="object")return this;var o=Object.keys(_||{}).map(function(b){if(b in m.template.prop)return function(){this.prop[b]=_[b]};switch(b){case"margin":return this.setMargin.bind(this,_.margin);case"jsPDF":return function(){return this.opt.jsPDF=_.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,_.pageSize);default:return function(){this.opt[b]=_[b]}}},this);return this.then(function(){return this.thenList(o)})},m.prototype.get=function(_,o){return this.then(function(){var b=_ in m.template.prop?this.prop[_]:this.opt[_];return o?o(b):b})},m.prototype.setMargin=function(_){return this.then(function(){switch(i(_)){case"number":_=[_,_,_,_];case"array":if(_.length===2&&(_=[_[0],_[1],_[0],_[1]]),_.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=_}).then(this.setPageSize)},m.prototype.setPageSize=function(_){function o(b,I){return Math.floor(b*I/72*96)}return this.then(function(){(_=_||wi.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(_.inner={width:_.width-this.opt.margin[1]-this.opt.margin[3],height:_.height-this.opt.margin[0]-this.opt.margin[2]},_.inner.px={width:o(_.inner.width,_.k),height:o(_.inner.height,_.k)},_.inner.ratio=_.inner.height/_.inner.width),this.prop.pageSize=_})},m.prototype.setProgress=function(_,o,b,I){return _!=null&&(this.progress.val=_),o!=null&&(this.progress.state=o),b!=null&&(this.progress.n=b),I!=null&&(this.progress.stack=I),this.progress.ratio=this.progress.val/this.progress.state,this},m.prototype.updateProgress=function(_,o,b,I){return this.setProgress(_?this.progress.val+_:null,o||null,b?this.progress.n+b:null,I?this.progress.stack.concat(I):null)},m.prototype.then=function(_,o){var b=this;return this.thenCore(_,o,function(I,M){return b.updateProgress(null,null,1,[I]),Promise.prototype.then.call(this,function(V){return b.updateProgress(null,I),V}).then(I,M).then(function(V){return b.updateProgress(1),V})})},m.prototype.thenCore=function(_,o,b){b=b||Promise.prototype.then;var I=this;_&&(_=_.bind(I)),o&&(o=o.bind(I));var M=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?I:m.convert(Object.assign({},I),Promise.prototype),V=b.call(M,_,o);return m.convert(V,I.__proto__)},m.prototype.thenExternal=function(_,o){return Promise.prototype.then.call(this,_,o)},m.prototype.thenList=function(_){var o=this;return _.forEach(function(b){o=o.thenCore(b)}),o},m.prototype.catch=function(_){_&&(_=_.bind(this));var o=Promise.prototype.catch.call(this,_);return m.convert(o,this)},m.prototype.catchExternal=function(_){return Promise.prototype.catch.call(this,_)},m.prototype.error=function(_){return this.then(function(){throw new Error(_)})},m.prototype.using=m.prototype.set,m.prototype.saveAs=m.prototype.save,m.prototype.export=m.prototype.output,m.prototype.run=m.prototype.then,wi.getPageSize=function(_,o,b){if(xa(_)==="object"){var I=_;_=I.orientation,o=I.unit||o,b=I.format||b}o=o||"mm",b=b||"a4",_=(""+(_||"P")).toLowerCase();var M,V=(""+b).toLowerCase(),k={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(o){case"pt":M=1;break;case"mm":M=72/25.4;break;case"cm":M=72/2.54;break;case"in":M=72;break;case"px":M=.75;break;case"pc":case"em":M=12;break;case"ex":M=6;break;default:throw"Invalid unit: "+o}var ie,se=0,de=0;if(k.hasOwnProperty(V))se=k[V][1]/M,de=k[V][0]/M;else try{se=b[1],de=b[0]}catch{throw new Error("Invalid format: "+b)}if(_==="p"||_==="portrait")_="p",de>se&&(ie=de,de=se,se=ie);else{if(_!=="l"&&_!=="landscape")throw"Invalid orientation: "+_;_="l",se>de&&(ie=de,de=se,se=ie)}return{width:de,height:se,unit:o,k:M,orientation:_}},n.html=function(_,o){(o=o||{}).callback=o.callback||function(){},o.html2canvas=o.html2canvas||{},o.html2canvas.canvas=o.html2canvas.canvas||this.canvas,o.jsPDF=o.jsPDF||this,o.fontFaces=o.fontFaces?o.fontFaces.map(kb):null;var b=new m(o);return o.worker?b:b.from(_).doCallback()}})(wi.API),wi.API.addJS=function(n){return NS=n,this.internal.events.subscribe("postPutResources",function(){v1=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(v1+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),MS=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+NS+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){v1!==void 0&&MS!==void 0&&this.internal.out("/Names <</JavaScript "+v1+" 0 R>>")}),this},(function(n){var e;n.events.push(["postPutResources",function(){var t=this,i=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var c=t.outline.render().split(/\r\n/),u=0;u<c.length;u++){var m=c[u],_=i.exec(m);if(_!=null){var o=_[1];t.internal.newObjectDeferredBegin(o,!1)}t.internal.write(m)}if(this.outline.createNamedDestinations){var b=this.internal.pages.length,I=[];for(u=0;u<b;u++){var M=t.internal.newObject();I.push(M);var V=t.internal.getPageInfo(u+1);t.internal.write("<< /D["+V.objId+" 0 R /XYZ null null null]>> endobj")}var k=t.internal.newObject();for(t.internal.write("<< /Names [ "),u=0;u<I.length;u++)t.internal.write("(page_"+(u+1)+")"+I[u]+" 0 R");t.internal.write(" ] >>","endobj"),e=t.internal.newObject(),t.internal.write("<< /Dests "+k+" 0 R"),t.internal.write(">>","endobj")}}]),n.events.push(["putCatalog",function(){var t=this;t.outline.root.children.length>0&&(t.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&t.internal.write("/Names "+e+" 0 R"))}]),n.events.push(["initialized",function(){var t=this;t.outline={createNamedDestinations:!1,root:{children:[]}},t.outline.add=function(i,c,u){var m={title:c,options:u,children:[]};return i==null&&(i=this.root),i.children.push(m),m},t.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=t,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},t.outline.genIds_r=function(i){i.id=t.internal.newObjectDeferred();for(var c=0;c<i.children.length;c++)this.genIds_r(i.children[c])},t.outline.renderRoot=function(i){this.objStart(i),this.line("/Type /Outlines"),i.children.length>0&&(this.line("/First "+this.makeRef(i.children[0])),this.line("/Last "+this.makeRef(i.children[i.children.length-1]))),this.line("/Count "+this.count_r({count:0},i)),this.objEnd()},t.outline.renderItems=function(i){for(var c=this.ctx.pdf.internal.getVerticalCoordinateString,u=0;u<i.children.length;u++){var m=i.children[u];this.objStart(m),this.line("/Title "+this.makeString(m.title)),this.line("/Parent "+this.makeRef(i)),u>0&&this.line("/Prev "+this.makeRef(i.children[u-1])),u<i.children.length-1&&this.line("/Next "+this.makeRef(i.children[u+1])),m.children.length>0&&(this.line("/First "+this.makeRef(m.children[0])),this.line("/Last "+this.makeRef(m.children[m.children.length-1])));var _=this.count=this.count_r({count:0},m);if(_>0&&this.line("/Count "+_),m.options&&m.options.pageNumber){var o=t.internal.getPageInfo(m.options.pageNumber);this.line("/Dest ["+o.objId+" 0 R /XYZ 0 "+c(0)+" 0]")}this.objEnd()}for(var b=0;b<i.children.length;b++)this.renderItems(i.children[b])},t.outline.line=function(i){this.ctx.val+=i+`\r
`},t.outline.makeRef=function(i){return i.id+" 0 R"},t.outline.makeString=function(i){return"("+t.internal.pdfEscape(i)+")"},t.outline.objStart=function(i){this.ctx.val+=`\r
`+i.id+` 0 obj\r
<<\r
`},t.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},t.outline.count_r=function(i,c){for(var u=0;u<c.children.length;u++)i.count++,this.count_r(i,c.children[u]);return i.count}}])})(wi.API),(function(n){var e=[192,193,194,195,196,197,198,199];n.processJPEG=function(t,i,c,u,m,_){var o,b=this.decode.DCT_DECODE,I=null;if(typeof t=="string"||this.__addimage__.isArrayBuffer(t)||this.__addimage__.isArrayBufferView(t)){switch(t=m||t,t=this.__addimage__.isArrayBuffer(t)?new Uint8Array(t):t,o=(function(M){for(var V,k=256*M.charCodeAt(4)+M.charCodeAt(5),ie=M.length,se={width:0,height:0,numcomponents:1},de=4;de<ie;de+=2){if(de+=k,e.indexOf(M.charCodeAt(de+1))!==-1){V=256*M.charCodeAt(de+5)+M.charCodeAt(de+6),se={width:256*M.charCodeAt(de+7)+M.charCodeAt(de+8),height:V,numcomponents:M.charCodeAt(de+9)};break}k=256*M.charCodeAt(de+2)+M.charCodeAt(de+3)}return se})(t=this.__addimage__.isArrayBufferView(t)?this.__addimage__.arrayBufferToBinaryString(t):t),o.numcomponents){case 1:_=this.color_spaces.DEVICE_GRAY;break;case 4:_=this.color_spaces.DEVICE_CMYK;break;case 3:_=this.color_spaces.DEVICE_RGB}I={data:t,width:o.width,height:o.height,colorSpace:_,bitsPerComponent:8,filter:b,index:i,alias:c}}return I}})(wi.API),wi.API.processPNG=function(n,e,t,i){if(this.__addimage__.isArrayBuffer(n)&&(n=new Uint8Array(n)),this.__addimage__.isArrayBufferView(n)){var c,u=VR(n,{checkCrc:!0}),m=u.width,_=u.height,o=u.channels,b=u.palette,I=u.depth;c=b&&o===1?(function(U){for(var F=U.width,q=U.height,j=U.data,H=U.palette,Z=U.depth,be=!1,Re=[],Oe=[],Me=void 0,we=!1,De=0,tt=0;tt<H.length;tt++){var xe=B2(H[tt],4),le=xe[0],Ne=xe[1],Be=xe[2],Qe=xe[3];Re.push(le,Ne,Be),Qe!=null&&(Qe===0?(De++,Oe.length<1&&Oe.push(tt)):Qe<255&&(we=!0))}if(we||De>1){be=!0,Oe=void 0;var rt=F*q;Me=new Uint8Array(rt);for(var gt=new DataView(j.buffer),pt=0;pt<rt;pt++){var Mt=Mb(gt,pt,Z),Jt=B2(H[Mt],4)[3];Me[pt]=Jt}}else De===0&&(Oe=void 0);return{colorSpace:"Indexed",colorsPerPixel:1,sMaskBitsPerComponent:be?8:void 0,colorBytes:j,alphaBytes:Me,needSMask:be,palette:Re,mask:Oe}})(u):o===2||o===4?(function(U){for(var F=U.data,q=U.width,j=U.height,H=U.channels,Z=U.depth,be=H===2?"DeviceGray":"DeviceRGB",Re=H-1,Oe=q*j,Me=Re,we=Oe*Me,De=1*Oe,tt=Math.ceil(we*Z/8),xe=Math.ceil(De*Z/8),le=new Uint8Array(tt),Ne=new Uint8Array(xe),Be=new DataView(F.buffer),Qe=new DataView(le.buffer),rt=new DataView(Ne.buffer),gt=!1,pt=0;pt<Oe;pt++){for(var Mt=pt*H,Jt=0;Jt<Me;Jt++)qS(Qe,Mb(Be,Mt+Jt,Z),pt*Me+Jt,Z);var hn=Mb(Be,Mt+Me,Z);hn<(1<<Z)-1&&(gt=!0),qS(rt,hn,1*pt,Z)}return{colorSpace:be,colorsPerPixel:Re,sMaskBitsPerComponent:gt?Z:void 0,colorBytes:le,alphaBytes:Ne,needSMask:gt}})(u):(function(U){var F=U.data,q=U.channels===1?"DeviceGray":"DeviceRGB";return{colorSpace:q,colorsPerPixel:q==="DeviceGray"?1:3,colorBytes:F instanceof Uint16Array?(function(j){for(var H=j.length,Z=new Uint8Array(2*H),be=new DataView(Z.buffer,Z.byteOffset,Z.byteLength),Re=0;Re<H;Re++)be.setUint16(2*Re,j[Re],!1);return Z})(F):F,needSMask:!1}})(u);var M,V,k,ie=c,se=ie.colorSpace,de=ie.colorsPerPixel,J=ie.sMaskBitsPerComponent,ne=ie.colorBytes,me=ie.alphaBytes,ue=ie.needSMask,ke=ie.palette,ze=ie.mask,pe=null;return i!==wi.API.image_compression.NONE&&typeof v5=="function"?(pe=(function(U){var F;switch(U){case wi.API.image_compression.FAST:F=11;break;case wi.API.image_compression.MEDIUM:F=13;break;case wi.API.image_compression.SLOW:F=14;break;default:F=12}return F})(i),M=this.decode.FLATE_DECODE,V="/Predictor ".concat(pe," /Colors ").concat(de," /BitsPerComponent ").concat(I," /Columns ").concat(m),n=BS(ne,Math.ceil(m*de*I/8),de,I,i),ue&&(k=BS(me,Math.ceil(m*J/8),1,J,i))):(M=void 0,V=void 0,n=ne,ue&&(k=me)),(this.__addimage__.isArrayBuffer(n)||this.__addimage__.isArrayBufferView(n))&&(n=this.__addimage__.arrayBufferToBinaryString(n)),(k&&this.__addimage__.isArrayBuffer(k)||this.__addimage__.isArrayBufferView(k))&&(k=this.__addimage__.arrayBufferToBinaryString(k)),{alias:t,data:n,index:e,filter:M,decodeParameters:V,transparency:ze,palette:ke,sMask:k,predictor:pe,width:m,height:_,bitsPerComponent:I,sMaskBitsPerComponent:J,colorSpace:se}}},(function(n){n.processGIF89A=function(e,t,i,c){var u=new cM(e),m=u.width,_=u.height,o=[];u.decodeAndBlitFrameRGBA(0,o);var b={data:o,width:m,height:_},I=new Nb(100).encode(b,100);return n.processJPEG.call(this,I,t,i,c)},n.processGIF87A=n.processGIF89A})(wi.API),Zd.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var n=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(n);for(var e=0;e<n;e++){var t=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),c=this.datav.getUint8(this.pos++,!0),u=this.datav.getUint8(this.pos++,!0);this.palette[e]={red:c,green:i,blue:t,quad:u}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},Zd.prototype.parseBGR=function(){this.pos=this.offset;try{var n="bit"+this.bitPP,e=this.width*this.height*4;this.data=new Uint8Array(e),this[n]()}catch(t){Ga.log("bit decode error:"+t)}},Zd.prototype.bit1=function(){var n,e=Math.ceil(this.width/8),t=e%4;for(n=this.height-1;n>=0;n--){for(var i=this.bottom_up?n:this.height-1-n,c=0;c<e;c++)for(var u=this.datav.getUint8(this.pos++,!0),m=i*this.width*4+8*c*4,_=0;_<8&&8*c+_<this.width;_++){var o=this.palette[u>>7-_&1];this.data[m+4*_]=o.blue,this.data[m+4*_+1]=o.green,this.data[m+4*_+2]=o.red,this.data[m+4*_+3]=255}t!==0&&(this.pos+=4-t)}},Zd.prototype.bit4=function(){for(var n=Math.ceil(this.width/2),e=n%4,t=this.height-1;t>=0;t--){for(var i=this.bottom_up?t:this.height-1-t,c=0;c<n;c++){var u=this.datav.getUint8(this.pos++,!0),m=i*this.width*4+2*c*4,_=u>>4,o=15&u,b=this.palette[_];if(this.data[m]=b.blue,this.data[m+1]=b.green,this.data[m+2]=b.red,this.data[m+3]=255,2*c+1>=this.width)break;b=this.palette[o],this.data[m+4]=b.blue,this.data[m+4+1]=b.green,this.data[m+4+2]=b.red,this.data[m+4+3]=255}e!==0&&(this.pos+=4-e)}},Zd.prototype.bit8=function(){for(var n=this.width%4,e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,i=0;i<this.width;i++){var c=this.datav.getUint8(this.pos++,!0),u=t*this.width*4+4*i;if(c<this.palette.length){var m=this.palette[c];this.data[u]=m.red,this.data[u+1]=m.green,this.data[u+2]=m.blue,this.data[u+3]=255}else this.data[u]=255,this.data[u+1]=255,this.data[u+2]=255,this.data[u+3]=255}n!==0&&(this.pos+=4-n)}},Zd.prototype.bit15=function(){for(var n=this.width%3,e=parseInt("11111",2),t=this.height-1;t>=0;t--){for(var i=this.bottom_up?t:this.height-1-t,c=0;c<this.width;c++){var u=this.datav.getUint16(this.pos,!0);this.pos+=2;var m=(u&e)/e*255|0,_=(u>>5&e)/e*255|0,o=(u>>10&e)/e*255|0,b=u>>15?255:0,I=i*this.width*4+4*c;this.data[I]=o,this.data[I+1]=_,this.data[I+2]=m,this.data[I+3]=b}this.pos+=n}},Zd.prototype.bit16=function(){for(var n=this.width%3,e=parseInt("11111",2),t=parseInt("111111",2),i=this.height-1;i>=0;i--){for(var c=this.bottom_up?i:this.height-1-i,u=0;u<this.width;u++){var m=this.datav.getUint16(this.pos,!0);this.pos+=2;var _=(m&e)/e*255|0,o=(m>>5&t)/t*255|0,b=(m>>11)/e*255|0,I=c*this.width*4+4*u;this.data[I]=b,this.data[I+1]=o,this.data[I+2]=_,this.data[I+3]=255}this.pos+=n}},Zd.prototype.bit24=function(){for(var n=this.height-1;n>=0;n--){for(var e=this.bottom_up?n:this.height-1-n,t=0;t<this.width;t++){var i=this.datav.getUint8(this.pos++,!0),c=this.datav.getUint8(this.pos++,!0),u=this.datav.getUint8(this.pos++,!0),m=e*this.width*4+4*t;this.data[m]=u,this.data[m+1]=c,this.data[m+2]=i,this.data[m+3]=255}this.pos+=this.width%4}},Zd.prototype.bit32=function(){for(var n=this.height-1;n>=0;n--)for(var e=this.bottom_up?n:this.height-1-n,t=0;t<this.width;t++){var i=this.datav.getUint8(this.pos++,!0),c=this.datav.getUint8(this.pos++,!0),u=this.datav.getUint8(this.pos++,!0),m=this.datav.getUint8(this.pos++,!0),_=e*this.width*4+4*t;this.data[_]=u,this.data[_+1]=c,this.data[_+2]=i,this.data[_+3]=m}},Zd.prototype.getData=function(){return this.data},(function(n){n.processBMP=function(e,t,i,c){var u=new Zd(e,!1),m=u.width,_=u.height,o={data:u.getData(),width:m,height:_},b=new Nb(100).encode(o,100);return n.processJPEG.call(this,b,t,i,c)}})(wi.API),GS.prototype.getData=function(){return this.data},(function(n){n.processWEBP=function(e,t,i,c){var u=new GS(e),m=u.width,_=u.height,o={data:u.getData(),width:m,height:_},b=new Nb(100).encode(o,100);return n.processJPEG.call(this,b,t,i,c)}})(wi.API),wi.API.processRGBA=function(n,e,t){for(var i=n.data,c=i.length,u=new Uint8Array(c/4*3),m=new Uint8Array(c/4),_=0,o=0,b=0;b<c;b+=4){var I=i[b],M=i[b+1],V=i[b+2],k=i[b+3];u[_++]=I,u[_++]=M,u[_++]=V,m[o++]=k}var ie=this.__addimage__.arrayBufferToBinaryString(u);return{alpha:this.__addimage__.arrayBufferToBinaryString(m),data:ie,index:e,alias:t,colorSpace:"DeviceRGB",bitsPerComponent:8,width:n.width,height:n.height}},wi.API.setLanguage=function(n){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[n]!==void 0&&(this.internal.languageSettings.languageCode=n,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},Kg=wi.API,x1=Kg.getCharWidthsArray=function(n,e){var t,i,c=(e=e||{}).font||this.internal.getFont(),u=e.fontSize||this.internal.getFontSize(),m=e.charSpace||this.internal.getCharSpace(),_=e.widths?e.widths:c.metadata.Unicode.widths,o=_.fof?_.fof:1,b=e.kerning?e.kerning:c.metadata.Unicode.kerning,I=b.fof?b.fof:1,M=e.doKerning!==!1,V=0,k=n.length,ie=0,se=_[0]||o,de=[];for(t=0;t<k;t++)i=n.charCodeAt(t),typeof c.metadata.widthOfString=="function"?de.push((c.metadata.widthOfGlyph(c.metadata.characterToGlyph(i))+m*(1e3/u)||0)/1e3):(V=M&&xa(b[i])==="object"&&!isNaN(parseInt(b[i][ie],10))?b[i][ie]/I:0,de.push((_[i]||se)/o+V)),ie=i;return de},DS=Kg.getStringUnitWidth=function(n,e){var t=(e=e||{}).fontSize||this.internal.getFontSize(),i=e.font||this.internal.getFont(),c=e.charSpace||this.internal.getCharSpace();return Kg.processArabic&&(n=Kg.processArabic(n)),typeof i.metadata.widthOfString=="function"?i.metadata.widthOfString(n,t,c)/t:x1.apply(this,arguments).reduce(function(u,m){return u+m},0)},FS=function(n,e,t,i){for(var c=[],u=0,m=n.length,_=0;u!==m&&_+e[u]<t;)_+=e[u],u++;c.push(n.slice(0,u));var o=u;for(_=0;u!==m;)_+e[u]>i&&(c.push(n.slice(o,u)),_=0,o=u),_+=e[u],u++;return o!==u&&c.push(n.slice(o,u)),c},OS=function(n,e,t){t||(t={});var i,c,u,m,_,o,b,I=[],M=[I],V=t.textIndent||0,k=0,ie=0,se=n.split(" "),de=x1.apply(this,[" ",t])[0];if(o=t.lineIndent===-1?se[0].length+2:t.lineIndent||0){var J=Array(o).join(" "),ne=[];se.map(function(ue){(ue=ue.split(/\s*\n/)).length>1?ne=ne.concat(ue.map(function(ke,ze){return(ze&&ke.length?`
`:"")+ke})):ne.push(ue[0])}),se=ne,o=DS.apply(this,[J,t])}for(u=0,m=se.length;u<m;u++){var me=0;if(i=se[u],o&&i[0]==`
`&&(i=i.substr(1),me=1),V+k+(ie=(c=x1.apply(this,[i,t])).reduce(function(ue,ke){return ue+ke},0))>e||me){if(ie>e){for(_=FS.apply(this,[i,c,e-(V+k),e]),I.push(_.shift()),I=[_.pop()];_.length;)M.push([_.shift()]);ie=c.slice(i.length-(I[0]?I[0].length:0)).reduce(function(ue,ke){return ue+ke},0)}else I=[i];M.push(I),V=ie+o,k=de}else I.push(i),V+=k+ie,k=de}return b=o?function(ue,ke){return(ke?J:"")+ue.join(" ")}:function(ue){return ue.join(" ")},M.map(b)},Kg.splitTextToSize=function(n,e,t){var i,c=(t=t||{}).fontSize||this.internal.getFontSize(),u=(function(I){if(I.widths&&I.kerning)return{widths:I.widths,kerning:I.kerning};var M=this.internal.getFont(I.fontName,I.fontStyle),V="Unicode";return M.metadata[V]?{widths:M.metadata[V].widths||{0:1},kerning:M.metadata[V].kerning||{}}:{font:M.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,t);i=Array.isArray(n)?n:String(n).split(/\r?\n/);var m=1*this.internal.scaleFactor*e/c;u.textIndent=t.textIndent?1*t.textIndent*this.internal.scaleFactor/c:0,u.lineIndent=t.lineIndent;var _,o,b=[];for(_=0,o=i.length;_<o;_++)b=b.concat(OS.apply(this,[i[_],m,u]));return b},(function(n){n.__fontmetrics__=n.__fontmetrics__||{};for(var e="0123456789abcdef",t="klmnopqrstuvwxyz",i={},c={},u=0;u<16;u++)i[t[u]]=e[u],c[e[u]]=t[u];var m=function(V){return"0x"+parseInt(V,10).toString(16)},_=n.__fontmetrics__.compress=function(V){var k,ie,se,de,J=["{"];for(var ne in V){if(k=V[ne],isNaN(parseInt(ne,10))?ie="'"+ne+"'":(ne=parseInt(ne,10),ie=(ie=m(ne).slice(2)).slice(0,-1)+c[ie.slice(-1)]),typeof k=="number")k<0?(se=m(k).slice(3),de="-"):(se=m(k).slice(2),de=""),se=de+se.slice(0,-1)+c[se.slice(-1)];else{if(xa(k)!=="object")throw new Error("Don't know what to do with value type "+xa(k)+".");se=_(k)}J.push(ie+se)}return J.push("}"),J.join("")},o=n.__fontmetrics__.uncompress=function(V){if(typeof V!="string")throw new Error("Invalid argument passed to uncompress.");for(var k,ie,se,de,J={},ne=1,me=J,ue=[],ke="",ze="",pe=V.length-1,U=1;U<pe;U+=1)(de=V[U])=="'"?k?(se=k.join(""),k=void 0):k=[]:k?k.push(de):de=="{"?(ue.push([me,se]),me={},se=void 0):de=="}"?((ie=ue.pop())[0][ie[1]]=me,se=void 0,me=ie[0]):de=="-"?ne=-1:se===void 0?i.hasOwnProperty(de)?(ke+=i[de],se=parseInt(ke,16)*ne,ne=1,ke=""):ke+=de:i.hasOwnProperty(de)?(ze+=i[de],me[se]=parseInt(ze,16)*ne,ne=1,se=void 0,ze=""):ze+=de;return J},b={codePages:["WinAnsiEncoding"],WinAnsiEncoding:o("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},I={Unicode:{Courier:b,"Courier-Bold":b,"Courier-BoldOblique":b,"Courier-Oblique":b,Helvetica:b,"Helvetica-Bold":b,"Helvetica-BoldOblique":b,"Helvetica-Oblique":b,"Times-Roman":b,"Times-Bold":b,"Times-BoldItalic":b,"Times-Italic":b}},M={Unicode:{"Courier-Oblique":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":o("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":o("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":o("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:o("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:o("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":o("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:o("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":o("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":o("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":o("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};n.events.push(["addFont",function(V){var k=V.font,ie=M.Unicode[k.postScriptName];ie&&(k.metadata.Unicode={},k.metadata.Unicode.widths=ie.widths,k.metadata.Unicode.kerning=ie.kerning);var se=I.Unicode[k.postScriptName];se&&(k.metadata.Unicode.encoding=se,k.encoding=se.codePages[0])}])})(wi.API),(function(n){var e=function(t){for(var i=t.length,c=new Uint8Array(i),u=0;u<i;u++)c[u]=t.charCodeAt(u);return c};n.API.events.push(["addFont",function(t){var i=void 0,c=t.font,u=t.instance;if(!c.isStandardFont){if(u===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+c.postScriptName+"').");if(typeof(i=u.existsFileInVFS(c.postScriptName)===!1?u.loadFile(c.postScriptName):u.getFileFromVFS(c.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+c.postScriptName+"').");(function(m,_){_=/^\x00\x01\x00\x00/.test(_)?e(_):e(U1(_)),m.metadata=n.API.TTFFont.open(_),m.metadata.Unicode=m.metadata.Unicode||{encoding:{},kerning:{},widths:[]},m.metadata.glyIdsUsed=[0]})(c,i)}}])})(wi),wi.API.addSvgAsImage=function(n,e,t,i,c,u,m,_){if(isNaN(e)||isNaN(t))throw Ga.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(i)||isNaN(c))throw Ga.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var o=document.createElement("canvas");o.width=i,o.height=c;var b=o.getContext("2d");b.fillStyle="#fff",b.fillRect(0,0,o.width,o.height);var I={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},M=this;return(uo.canvg?Promise.resolve(uo.canvg):fb(()=>import("./index.es-CyK5AoT2.js"),[])).catch(function(V){return Promise.reject(new Error("Could not load canvg: "+V))}).then(function(V){return V.default?V.default:V}).then(function(V){return V.fromString(b,n,I)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(V){return V.render(I)}).then(function(){M.addImage(o.toDataURL("image/jpeg",1),e,t,i,c,m,_)})},wi.API.putTotalPages=function(n){var e,t=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(e=new RegExp(n,"g"),t=this.internal.getNumberOfPages()):(e=new RegExp(this.pdfEscape16(n,this.internal.getFont()),"g"),t=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var i=1;i<=this.internal.getNumberOfPages();i++)for(var c=0;c<this.internal.pages[i].length;c++)this.internal.pages[i][c]=this.internal.pages[i][c].replace(e,t);return this},wi.API.viewerPreferences=function(n,e){var t;n=n||{},e=e||!1;var i,c,u,m={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},_=Object.keys(m),o=[],b=0,I=0,M=0;function V(ie,se){var de,J=!1;for(de=0;de<ie.length;de+=1)ie[de]===se&&(J=!0);return J}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(m)),this.internal.viewerpreferences.isSubscribed=!1),t=this.internal.viewerpreferences.configuration,n==="reset"||e===!0){var k=_.length;for(M=0;M<k;M+=1)t[_[M]].value=t[_[M]].defaultValue,t[_[M]].explicitSet=!1}if(xa(n)==="object"){for(c in n)if(u=n[c],V(_,c)&&u!==void 0){if(t[c].type==="boolean"&&typeof u=="boolean")t[c].value=u;else if(t[c].type==="name"&&V(t[c].valueSet,u))t[c].value=u;else if(t[c].type==="integer"&&Number.isInteger(u))t[c].value=u;else if(t[c].type==="array"){for(b=0;b<u.length;b+=1)if(i=!0,u[b].length===1&&typeof u[b][0]=="number")o.push(String(u[b]-1));else if(u[b].length>1){for(I=0;I<u[b].length;I+=1)typeof u[b][I]!="number"&&(i=!1);i===!0&&o.push([u[b][0]-1,u[b][1]-1].join(" "))}t[c].value="["+o.join(" ")+"]"}else t[c].value=t[c].defaultValue;t[c].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var ie,se=[];for(ie in t)t[ie].explicitSet===!0&&(t[ie].type==="name"?se.push("/"+ie+" /"+t[ie].value):se.push("/"+ie+" "+t[ie].value));se.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+se.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=t,this},(function(n){var e=function(){var i='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',c=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),u=unescape(encodeURIComponent(i)),m=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),_=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),o=unescape(encodeURIComponent("</x:xmpmeta>")),b=u.length+m.length+_.length+c.length+o.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+b+" >>"),this.internal.write("stream"),this.internal.write(c+u+m+_+o),this.internal.write("endstream"),this.internal.write("endobj")},t=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};n.addMetadata=function(i,c){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:i,namespaceuri:c||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",t),this.internal.events.subscribe("postPutResources",e)),this}})(wi.API),(function(n){var e=n.API,t=e.pdfEscape16=function(u,m){for(var _,o=m.metadata.Unicode.widths,b=["","0","00","000","0000"],I=[""],M=0,V=u.length;M<V;++M){if(_=m.metadata.characterToGlyph(u.charCodeAt(M)),m.metadata.glyIdsUsed.push(_),m.metadata.toUnicode[_]=u.charCodeAt(M),o.indexOf(_)==-1&&(o.push(_),o.push([parseInt(m.metadata.widthOfGlyph(_),10)])),_=="0")return I.join("");_=_.toString(16),I.push(b[4-_.length],_)}return I.join("")},i=function(u){var m,_,o,b,I,M,V;for(I=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,o=[],M=0,V=(_=Object.keys(u).sort(function(k,ie){return k-ie})).length;M<V;M++)m=_[M],o.length>=100&&(I+=`
`+o.length+` beginbfchar
`+o.join(`
`)+`
endbfchar`,o=[]),u[m]!==void 0&&u[m]!==null&&typeof u[m].toString=="function"&&(b=("0000"+u[m].toString(16)).slice(-4),m=("0000"+(+m).toString(16)).slice(-4),o.push("<"+m+"><"+b+">"));return o.length&&(I+=`
`+o.length+` beginbfchar
`+o.join(`
`)+`
endbfchar
`),I+`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};e.events.push(["putFont",function(u){(function(m){var _=m.font,o=m.out,b=m.newObject,I=m.putStream;if(_.metadata instanceof n.API.TTFFont&&_.encoding==="Identity-H"){for(var M=_.metadata.Unicode.widths,V=_.metadata.subset.encode(_.metadata.glyIdsUsed,1),k="",ie=0;ie<V.length;ie++)k+=String.fromCharCode(V[ie]);var se=b();I({data:k,addLength1:!0,objectId:se}),o("endobj");var de=b();I({data:i(_.metadata.toUnicode),addLength1:!0,objectId:de}),o("endobj");var J=b();o("<<"),o("/Type /FontDescriptor"),o("/FontName /"+r0(_.fontName)),o("/FontFile2 "+se+" 0 R"),o("/FontBBox "+n.API.PDFObject.convert(_.metadata.bbox)),o("/Flags "+_.metadata.flags),o("/StemV "+_.metadata.stemV),o("/ItalicAngle "+_.metadata.italicAngle),o("/Ascent "+_.metadata.ascender),o("/Descent "+_.metadata.decender),o("/CapHeight "+_.metadata.capHeight),o(">>"),o("endobj");var ne=b();o("<<"),o("/Type /Font"),o("/BaseFont /"+r0(_.fontName)),o("/FontDescriptor "+J+" 0 R"),o("/W "+n.API.PDFObject.convert(M)),o("/CIDToGIDMap /Identity"),o("/DW 1000"),o("/Subtype /CIDFontType2"),o("/CIDSystemInfo"),o("<<"),o("/Supplement 0"),o("/Registry (Adobe)"),o("/Ordering ("+_.encoding+")"),o(">>"),o(">>"),o("endobj"),_.objectNumber=b(),o("<<"),o("/Type /Font"),o("/Subtype /Type0"),o("/ToUnicode "+de+" 0 R"),o("/BaseFont /"+r0(_.fontName)),o("/Encoding /"+_.encoding),o("/DescendantFonts ["+ne+" 0 R]"),o(">>"),o("endobj"),_.isAlreadyPutted=!0}})(u)}]),e.events.push(["putFont",function(u){(function(m){var _=m.font,o=m.out,b=m.newObject,I=m.putStream;if(_.metadata instanceof n.API.TTFFont&&_.encoding==="WinAnsiEncoding"){for(var M=_.metadata.rawData,V="",k=0;k<M.length;k++)V+=String.fromCharCode(M[k]);var ie=b();I({data:V,addLength1:!0,objectId:ie}),o("endobj");var se=b();I({data:i(_.metadata.toUnicode),addLength1:!0,objectId:se}),o("endobj");var de=b();o("<<"),o("/Descent "+_.metadata.decender),o("/CapHeight "+_.metadata.capHeight),o("/StemV "+_.metadata.stemV),o("/Type /FontDescriptor"),o("/FontFile2 "+ie+" 0 R"),o("/Flags 96"),o("/FontBBox "+n.API.PDFObject.convert(_.metadata.bbox)),o("/FontName /"+r0(_.fontName)),o("/ItalicAngle "+_.metadata.italicAngle),o("/Ascent "+_.metadata.ascender),o(">>"),o("endobj"),_.objectNumber=b();for(var J=0;J<_.metadata.hmtx.widths.length;J++)_.metadata.hmtx.widths[J]=parseInt(_.metadata.hmtx.widths[J]*(1e3/_.metadata.head.unitsPerEm));o("<</Subtype/TrueType/Type/Font/ToUnicode "+se+" 0 R/BaseFont/"+r0(_.fontName)+"/FontDescriptor "+de+" 0 R/Encoding/"+_.encoding+" /FirstChar 29 /LastChar 255 /Widths "+n.API.PDFObject.convert(_.metadata.hmtx.widths)+">>"),o("endobj"),_.isAlreadyPutted=!0}})(u)}]);var c=function(u){var m,_=u.text||"",o=u.x,b=u.y,I=u.options||{},M=u.mutex||{},V=M.pdfEscape,k=M.activeFontKey,ie=M.fonts,se=k,de="",J=0,ne="",me=ie[se].encoding;if(ie[se].encoding!=="Identity-H")return{text:_,x:o,y:b,options:I,mutex:M};for(ne=_,se=k,Array.isArray(_)&&(ne=_[0]),J=0;J<ne.length;J+=1)ie[se].metadata.hasOwnProperty("cmap")&&(m=ie[se].metadata.cmap.unicode.codeMap[ne[J].charCodeAt(0)]),m||ne[J].charCodeAt(0)<256&&ie[se].metadata.hasOwnProperty("Unicode")?de+=ne[J]:de+="";var ue="";return parseInt(se.slice(1))<14||me==="WinAnsiEncoding"?ue=V(de,se).split("").map(function(ke){return ke.charCodeAt(0).toString(16)}).join(""):me==="Identity-H"&&(ue=t(de,ie[se])),M.isHex=!0,{text:ue,x:o,y:b,options:I,mutex:M}};e.events.push(["postProcessText",function(u){var m=u.text||"",_=[],o={text:m,x:u.x,y:u.y,options:u.options,mutex:u.mutex};if(Array.isArray(m)){var b=0;for(b=0;b<m.length;b+=1)Array.isArray(m[b])&&m[b].length===3?_.push([c(Object.assign({},o,{text:m[b][0]})).text,m[b][1],m[b][2]]):_.push(c(Object.assign({},o,{text:m[b]})).text);u.text=_}else u.text=c(Object.assign({},o,{text:m})).text}])})(wi),(function(n){var e=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};n.existsFileInVFS=function(t){return e.call(this),this.internal.vFS[t]!==void 0},n.addFileToVFS=function(t,i){return e.call(this),this.internal.vFS[t]=i,this},n.getFileFromVFS=function(t){return e.call(this),this.internal.vFS[t]!==void 0?this.internal.vFS[t]:null}})(wi.API),(function(n){n.__bidiEngine__=n.prototype.__bidiEngine__=function(i){var c,u,m,_,o,b,I,M=e,V=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],k=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],ie={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},se={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},de=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],J=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),ne=!1,me=0;this.__bidiEngine__={};var ue=function(j){var H=j.charCodeAt(),Z=H>>8,be=se[Z];return be!==void 0?M[256*be+(255&H)]:Z===252||Z===253?"AL":J.test(Z)?"L":Z===8?"R":"N"},ke=function(j){for(var H,Z=0;Z<j.length;Z++){if((H=ue(j.charAt(Z)))==="L")return!1;if(H==="R")return!0}return!1},ze=function(j,H,Z,be){var Re,Oe,Me,we,De=H[be];switch(De){case"L":case"R":case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":ne=!1;break;case"N":case"AN":break;case"EN":ne&&(De="AN");break;case"AL":ne=!0,De="R";break;case"WS":case"BN":De="N";break;case"CS":be<1||be+1>=H.length||(Re=Z[be-1])!=="EN"&&Re!=="AN"||(Oe=H[be+1])!=="EN"&&Oe!=="AN"?De="N":ne&&(Oe="AN"),De=Oe===Re?Oe:"N";break;case"ES":De=(Re=be>0?Z[be-1]:"B")==="EN"&&be+1<H.length&&H[be+1]==="EN"?"EN":"N";break;case"ET":if(be>0&&Z[be-1]==="EN"){De="EN";break}if(ne){De="N";break}for(Me=be+1,we=H.length;Me<we&&H[Me]==="ET";)Me++;De=Me<we&&H[Me]==="EN"?"EN":"N";break;case"NSM":if(m&&!_){for(we=H.length,Me=be+1;Me<we&&H[Me]==="NSM";)Me++;if(Me<we){var tt=j[be],xe=tt>=1425&&tt<=2303||tt===64286;if(Re=H[Me],xe&&(Re==="R"||Re==="AL")){De="R";break}}}De=be<1||(Re=H[be-1])==="B"?"N":Z[be-1];break;case"B":ne=!1,c=!0,De=me;break;case"S":u=!0,De="N"}return De},pe=function(j,H,Z){var be=j.split("");return Z&&U(be,Z,{hiLevel:me}),be.reverse(),H&&H.reverse(),be.join("")},U=function(j,H,Z){var be,Re,Oe,Me,we,De=-1,tt=j.length,xe=0,le=[],Ne=me?k:V,Be=[];for(ne=!1,c=!1,u=!1,Re=0;Re<tt;Re++)Be[Re]=ue(j[Re]);for(Oe=0;Oe<tt;Oe++){if(we=xe,le[Oe]=ze(j,Be,le,Oe),be=240&(xe=Ne[we][ie[le[Oe]]]),xe&=15,H[Oe]=Me=Ne[xe][5],be>0)if(be===16){for(Re=De;Re<Oe;Re++)H[Re]=1;De=-1}else De=-1;if(Ne[xe][6])De===-1&&(De=Oe);else if(De>-1){for(Re=De;Re<Oe;Re++)H[Re]=Me;De=-1}Be[Oe]==="B"&&(H[Oe]=0),Z.hiLevel|=Me}u&&(function(Qe,rt,gt){for(var pt=0;pt<gt;pt++)if(Qe[pt]==="S"){rt[pt]=me;for(var Mt=pt-1;Mt>=0&&Qe[Mt]==="WS";Mt--)rt[Mt]=me}})(Be,H,tt)},F=function(j,H,Z,be,Re){if(!(Re.hiLevel<j)){if(j===1&&me===1&&!c)return H.reverse(),void(Z&&Z.reverse());for(var Oe,Me,we,De,tt=H.length,xe=0;xe<tt;){if(be[xe]>=j){for(we=xe+1;we<tt&&be[we]>=j;)we++;for(De=xe,Me=we-1;De<Me;De++,Me--)Oe=H[De],H[De]=H[Me],H[Me]=Oe,Z&&(Oe=Z[De],Z[De]=Z[Me],Z[Me]=Oe);xe=we}xe++}}},q=function(j,H,Z){var be=j.split(""),Re={hiLevel:me};return Z||(Z=[]),U(be,Z,Re),(function(Oe,Me,we){if(we.hiLevel!==0&&I)for(var De,tt=0;tt<Oe.length;tt++)Me[tt]===1&&(De=de.indexOf(Oe[tt]))>=0&&(Oe[tt]=de[De+1])})(be,Z,Re),F(2,be,H,Z,Re),F(1,be,H,Z,Re),be.join("")};return this.__bidiEngine__.doBidiReorder=function(j,H,Z){if((function(Re,Oe){if(Oe)for(var Me=0;Me<Re.length;Me++)Oe[Me]=Me;_===void 0&&(_=ke(Re)),b===void 0&&(b=ke(Re))})(j,H),m||!o||b)if(m&&o&&_^b)me=_?1:0,j=pe(j,H,Z);else if(!m&&o&&b)me=_?1:0,j=q(j,H,Z),j=pe(j,H);else if(!m||_||o||b){if(m&&!o&&_^b)j=pe(j,H),_?(me=0,j=q(j,H,Z)):(me=1,j=q(j,H,Z),j=pe(j,H));else if(m&&_&&!o&&b)me=1,j=q(j,H,Z),j=pe(j,H);else if(!m&&!o&&_^b){var be=I;_?(me=1,j=q(j,H,Z),me=0,I=!1,j=q(j,H,Z),I=be):(me=0,j=q(j,H,Z),j=pe(j,H),me=1,I=!1,j=q(j,H,Z),I=be,j=pe(j,H))}}else me=0,j=q(j,H,Z);else me=_?1:0,j=q(j,H,Z);return j},this.__bidiEngine__.setOptions=function(j){j&&(m=j.isInputVisual,o=j.isOutputVisual,_=j.isInputRtl,b=j.isOutputRtl,I=j.isSymmetricSwapping)},this.__bidiEngine__.setOptions(i),this.__bidiEngine__};var e=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],t=new n.__bidiEngine__({isInputVisual:!0});n.API.events.push(["postProcessText",function(i){var c=i.text;i.x,i.y;var u=i.options||{};i.mutex,u.lang;var m=[];if(u.isInputVisual=typeof u.isInputVisual!="boolean"||u.isInputVisual,t.setOptions(u),Object.prototype.toString.call(c)==="[object Array]"){var _=0;for(m=[],_=0;_<c.length;_+=1)Object.prototype.toString.call(c[_])==="[object Array]"?m.push([t.doBidiReorder(c[_][0]),c[_][1],c[_][2]]):m.push([t.doBidiReorder(c[_])]);i.text=m}else i.text=t.doBidiReorder(c);t.setOptions({isInputVisual:!0})}])})(wi),wi.API.TTFFont=(function(){function n(e){var t;if(this.rawData=e,t=this.contents=new dm(e),this.contents.pos=4,t.readString(4)==="ttcf")throw new Error("TTCF not supported.");t.pos=0,this.parse(),this.subset=new EM(this),this.registerTTF()}return n.open=function(e){return new n(e)},n.prototype.parse=function(){return this.directory=new uM(this.contents),this.head=new dM(this),this.name=new yM(this),this.cmap=new X6(this),this.toUnicode={},this.hhea=new fM(this),this.maxp=new _M(this),this.hmtx=new vM(this),this.post=new mM(this),this.os2=new pM(this),this.loca=new SM(this),this.glyf=new xM(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},n.prototype.registerTTF=function(){var e,t,i,c,u;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var m,_,o,b;for(b=[],m=0,_=(o=this.bbox).length;m<_;m++)e=o[m],b.push(Math.round(e*this.scaleFactor));return b}).call(this),this.stemV=0,this.post.exists?(i=255&(c=this.post.italic_angle),32768&(t=c>>16)&&(t=-(1+(65535^t))),this.italicAngle=+(t+"."+i)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(u=this.familyClass)===1||u===2||u===3||u===4||u===5||u===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},n.prototype.characterToGlyph=function(e){var t;return((t=this.cmap.unicode)!=null?t.codeMap[e]:void 0)||0},n.prototype.widthOfGlyph=function(e){var t;return t=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(e).advance*t},n.prototype.widthOfString=function(e,t,i){var c,u,m,_;for(m=0,u=0,_=(e=""+e).length;0<=_?u<_:u>_;u=0<=_?++u:--u)c=e.charCodeAt(u),m+=this.widthOfGlyph(this.characterToGlyph(c))+i*(1e3/t)||0;return m*(t/1e3)},n.prototype.lineHeight=function(e,t){var i;return t==null&&(t=!1),i=t?this.lineGap:0,(this.ascender+i-this.decender)/1e3*e},n})();var hf,dm=(function(){function n(e){this.data=e??[],this.pos=0,this.length=this.data.length}return n.prototype.readByte=function(){return this.data[this.pos++]},n.prototype.writeByte=function(e){return this.data[this.pos++]=e},n.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},n.prototype.writeUInt32=function(e){return this.writeByte(e>>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e)},n.prototype.readInt32=function(){var e;return(e=this.readUInt32())>=2147483648?e-4294967296:e},n.prototype.writeInt32=function(e){return e<0&&(e+=4294967296),this.writeUInt32(e)},n.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},n.prototype.writeUInt16=function(e){return this.writeByte(e>>8&255),this.writeByte(255&e)},n.prototype.readInt16=function(){var e;return(e=this.readUInt16())>=32768?e-65536:e},n.prototype.writeInt16=function(e){return e<0&&(e+=65536),this.writeUInt16(e)},n.prototype.readString=function(e){var t,i;for(i=[],t=0;0<=e?t<e:t>e;t=0<=e?++t:--t)i[t]=String.fromCharCode(this.readByte());return i.join("")},n.prototype.writeString=function(e){var t,i,c;for(c=[],t=0,i=e.length;0<=i?t<i:t>i;t=0<=i?++t:--t)c.push(this.writeByte(e.charCodeAt(t)));return c},n.prototype.readShort=function(){return this.readInt16()},n.prototype.writeShort=function(e){return this.writeInt16(e)},n.prototype.readLongLong=function(){var e,t,i,c,u,m,_,o;return e=this.readByte(),t=this.readByte(),i=this.readByte(),c=this.readByte(),u=this.readByte(),m=this.readByte(),_=this.readByte(),o=this.readByte(),128&e?-1*(72057594037927940*(255^e)+281474976710656*(255^t)+1099511627776*(255^i)+4294967296*(255^c)+16777216*(255^u)+65536*(255^m)+256*(255^_)+(255^o)+1):72057594037927940*e+281474976710656*t+1099511627776*i+4294967296*c+16777216*u+65536*m+256*_+o},n.prototype.writeLongLong=function(e){var t,i;return t=Math.floor(e/4294967296),i=4294967295&e,this.writeByte(t>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t),this.writeByte(i>>24&255),this.writeByte(i>>16&255),this.writeByte(i>>8&255),this.writeByte(255&i)},n.prototype.readInt=function(){return this.readInt32()},n.prototype.writeInt=function(e){return this.writeInt32(e)},n.prototype.read=function(e){var t,i;for(t=[],i=0;0<=e?i<e:i>e;i=0<=e?++i:--i)t.push(this.readByte());return t},n.prototype.write=function(e){var t,i,c,u;for(u=[],i=0,c=e.length;i<c;i++)t=e[i],u.push(this.writeByte(t));return u},n})(),uM=(function(){var n;function e(t){var i,c,u;for(this.scalarType=t.readInt(),this.tableCount=t.readShort(),this.searchRange=t.readShort(),this.entrySelector=t.readShort(),this.rangeShift=t.readShort(),this.tables={},c=0,u=this.tableCount;0<=u?c<u:c>u;c=0<=u?++c:--c)i={tag:t.readString(4),checksum:t.readInt(),offset:t.readInt(),length:t.readInt()},this.tables[i.tag]=i}return e.prototype.encode=function(t){var i,c,u,m,_,o,b,I,M,V,k,ie,se;for(se in k=Object.keys(t).length,o=Math.log(2),M=16*Math.floor(Math.log(k)/o),m=Math.floor(M/o),I=16*k-M,(c=new dm).writeInt(this.scalarType),c.writeShort(k),c.writeShort(M),c.writeShort(m),c.writeShort(I),u=16*k,b=c.pos+u,_=null,ie=[],t)for(V=t[se],c.writeString(se),c.writeInt(n(V)),c.writeInt(b),c.writeInt(V.length),ie=ie.concat(V),se==="head"&&(_=b),b+=V.length;b%4;)ie.push(0),b++;return c.write(ie),i=2981146554-n(c.data),c.pos=_+8,c.writeUInt32(i),c.data},n=function(t){var i,c,u,m;for(t=Z6.call(t);t.length%4;)t.push(0);for(u=new dm(t),c=0,i=0,m=t.length;i<m;i=i+=4)c+=u.readUInt32();return 4294967295&c},e})(),hM={}.hasOwnProperty,ep=function(n,e){for(var t in e)hM.call(e,t)&&(n[t]=e[t]);function i(){this.constructor=n}return i.prototype=e.prototype,n.prototype=new i,n.__super__=e.prototype,n};hf=(function(){function n(e){var t;this.file=e,t=this.file.directory.tables[this.tag],this.exists=!!t,t&&(this.offset=t.offset,this.length=t.length,this.parse(this.file.contents))}return n.prototype.parse=function(){},n.prototype.encode=function(){},n.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},n})();var dM=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return ep(n,hf),n.prototype.tag="head",n.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.revision=e.readInt(),this.checkSumAdjustment=e.readInt(),this.magicNumber=e.readInt(),this.flags=e.readShort(),this.unitsPerEm=e.readShort(),this.created=e.readLongLong(),this.modified=e.readLongLong(),this.xMin=e.readShort(),this.yMin=e.readShort(),this.xMax=e.readShort(),this.yMax=e.readShort(),this.macStyle=e.readShort(),this.lowestRecPPEM=e.readShort(),this.fontDirectionHint=e.readShort(),this.indexToLocFormat=e.readShort(),this.glyphDataFormat=e.readShort()},n.prototype.encode=function(e){var t;return(t=new dm).writeInt(this.version),t.writeInt(this.revision),t.writeInt(this.checkSumAdjustment),t.writeInt(this.magicNumber),t.writeShort(this.flags),t.writeShort(this.unitsPerEm),t.writeLongLong(this.created),t.writeLongLong(this.modified),t.writeShort(this.xMin),t.writeShort(this.yMin),t.writeShort(this.xMax),t.writeShort(this.yMax),t.writeShort(this.macStyle),t.writeShort(this.lowestRecPPEM),t.writeShort(this.fontDirectionHint),t.writeShort(e),t.writeShort(this.glyphDataFormat),t.data},n})(),HS=(function(){function n(e,t){var i,c,u,m,_,o,b,I,M,V,k,ie,se,de,J,ne,me;switch(this.platformID=e.readUInt16(),this.encodingID=e.readShort(),this.offset=t+e.readInt(),M=e.pos,e.pos=this.offset,this.format=e.readUInt16(),this.length=e.readUInt16(),this.language=e.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(o=0;o<256;++o)this.codeMap[o]=e.readByte();break;case 4:for(k=e.readUInt16(),V=k/2,e.pos+=6,u=(function(){var ue,ke;for(ke=[],o=ue=0;0<=V?ue<V:ue>V;o=0<=V?++ue:--ue)ke.push(e.readUInt16());return ke})(),e.pos+=2,se=(function(){var ue,ke;for(ke=[],o=ue=0;0<=V?ue<V:ue>V;o=0<=V?++ue:--ue)ke.push(e.readUInt16());return ke})(),b=(function(){var ue,ke;for(ke=[],o=ue=0;0<=V?ue<V:ue>V;o=0<=V?++ue:--ue)ke.push(e.readUInt16());return ke})(),I=(function(){var ue,ke;for(ke=[],o=ue=0;0<=V?ue<V:ue>V;o=0<=V?++ue:--ue)ke.push(e.readUInt16());return ke})(),c=(this.length-e.pos+this.offset)/2,_=(function(){var ue,ke;for(ke=[],o=ue=0;0<=c?ue<c:ue>c;o=0<=c?++ue:--ue)ke.push(e.readUInt16());return ke})(),o=J=0,me=u.length;J<me;o=++J)for(de=u[o],i=ne=ie=se[o];ie<=de?ne<=de:ne>=de;i=ie<=de?++ne:--ne)I[o]===0?m=i+b[o]:(m=_[I[o]/2+(i-ie)-(V-o)]||0)!==0&&(m+=b[o]),this.codeMap[i]=65535&m}e.pos=M}return n.encode=function(e,t){var i,c,u,m,_,o,b,I,M,V,k,ie,se,de,J,ne,me,ue,ke,ze,pe,U,F,q,j,H,Z,be,Re,Oe,Me,we,De,tt,xe,le,Ne,Be,Qe,rt,gt,pt,Mt,Jt,hn,yn;switch(be=new dm,m=Object.keys(e).sort(function(Mn,Gt){return Mn-Gt}),t){case"macroman":for(se=0,de=(function(){var Mn=[];for(ie=0;ie<256;++ie)Mn.push(0);return Mn})(),ne={0:0},u={},Re=0,De=m.length;Re<De;Re++)ne[Mt=e[c=m[Re]]]==null&&(ne[Mt]=++se),u[c]={old:e[c],new:ne[e[c]]},de[c]=ne[e[c]];return be.writeUInt16(1),be.writeUInt16(0),be.writeUInt32(12),be.writeUInt16(0),be.writeUInt16(262),be.writeUInt16(0),be.write(de),{charMap:u,subtable:be.data,maxGlyphID:se+1};case"unicode":for(H=[],M=[],me=0,ne={},i={},J=b=null,Oe=0,tt=m.length;Oe<tt;Oe++)ne[ke=e[c=m[Oe]]]==null&&(ne[ke]=++me),i[c]={old:ke,new:ne[ke]},_=ne[ke]-c,J!=null&&_===b||(J&&M.push(J),H.push(c),b=_),J=c;for(J&&M.push(J),M.push(65535),H.push(65535),q=2*(F=H.length),U=2*Math.pow(Math.log(F)/Math.LN2,2),V=Math.log(U/2)/Math.LN2,pe=2*F-U,o=[],ze=[],k=[],ie=Me=0,xe=H.length;Me<xe;ie=++Me){if(j=H[ie],I=M[ie],j===65535){o.push(0),ze.push(0);break}if(j-(Z=i[j].new)>=32768)for(o.push(0),ze.push(2*(k.length+F-ie)),c=we=j;j<=I?we<=I:we>=I;c=j<=I?++we:--we)k.push(i[c].new);else o.push(Z-j),ze.push(0)}for(be.writeUInt16(3),be.writeUInt16(1),be.writeUInt32(12),be.writeUInt16(4),be.writeUInt16(16+8*F+2*k.length),be.writeUInt16(0),be.writeUInt16(q),be.writeUInt16(U),be.writeUInt16(V),be.writeUInt16(pe),gt=0,le=M.length;gt<le;gt++)c=M[gt],be.writeUInt16(c);for(be.writeUInt16(0),pt=0,Ne=H.length;pt<Ne;pt++)c=H[pt],be.writeUInt16(c);for(Jt=0,Be=o.length;Jt<Be;Jt++)_=o[Jt],be.writeUInt16(_);for(hn=0,Qe=ze.length;hn<Qe;hn++)ue=ze[hn],be.writeUInt16(ue);for(yn=0,rt=k.length;yn<rt;yn++)se=k[yn],be.writeUInt16(se);return{charMap:i,subtable:be.data,maxGlyphID:me+1}}},n})(),X6=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return ep(n,hf),n.prototype.tag="cmap",n.prototype.parse=function(e){var t,i,c;for(e.pos=this.offset,this.version=e.readUInt16(),c=e.readUInt16(),this.tables=[],this.unicode=null,i=0;0<=c?i<c:i>c;i=0<=c?++i:--i)t=new HS(e,this.offset),this.tables.push(t),t.isUnicode&&this.unicode==null&&(this.unicode=t);return!0},n.encode=function(e,t){var i,c;return t==null&&(t="macroman"),i=HS.encode(e,t),(c=new dm).writeUInt16(0),c.writeUInt16(1),i.table=c.data.concat(i.subtable),i},n})(),fM=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return ep(n,hf),n.prototype.tag="hhea",n.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.ascender=e.readShort(),this.decender=e.readShort(),this.lineGap=e.readShort(),this.advanceWidthMax=e.readShort(),this.minLeftSideBearing=e.readShort(),this.minRightSideBearing=e.readShort(),this.xMaxExtent=e.readShort(),this.caretSlopeRise=e.readShort(),this.caretSlopeRun=e.readShort(),this.caretOffset=e.readShort(),e.pos+=8,this.metricDataFormat=e.readShort(),this.numberOfMetrics=e.readUInt16()},n})(),pM=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return ep(n,hf),n.prototype.tag="OS/2",n.prototype.parse=function(e){if(e.pos=this.offset,this.version=e.readUInt16(),this.averageCharWidth=e.readShort(),this.weightClass=e.readUInt16(),this.widthClass=e.readUInt16(),this.type=e.readShort(),this.ySubscriptXSize=e.readShort(),this.ySubscriptYSize=e.readShort(),this.ySubscriptXOffset=e.readShort(),this.ySubscriptYOffset=e.readShort(),this.ySuperscriptXSize=e.readShort(),this.ySuperscriptYSize=e.readShort(),this.ySuperscriptXOffset=e.readShort(),this.ySuperscriptYOffset=e.readShort(),this.yStrikeoutSize=e.readShort(),this.yStrikeoutPosition=e.readShort(),this.familyClass=e.readShort(),this.panose=(function(){var t,i;for(i=[],t=0;t<10;++t)i.push(e.readByte());return i})(),this.charRange=(function(){var t,i;for(i=[],t=0;t<4;++t)i.push(e.readInt());return i})(),this.vendorID=e.readString(4),this.selection=e.readShort(),this.firstCharIndex=e.readShort(),this.lastCharIndex=e.readShort(),this.version>0&&(this.ascent=e.readShort(),this.descent=e.readShort(),this.lineGap=e.readShort(),this.winAscent=e.readShort(),this.winDescent=e.readShort(),this.codePageRange=(function(){var t,i;for(i=[],t=0;t<2;t=++t)i.push(e.readInt());return i})(),this.version>1))return this.xHeight=e.readShort(),this.capHeight=e.readShort(),this.defaultChar=e.readShort(),this.breakChar=e.readShort(),this.maxContext=e.readShort()},n})(),mM=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return ep(n,hf),n.prototype.tag="post",n.prototype.parse=function(e){var t,i,c;switch(e.pos=this.offset,this.format=e.readInt(),this.italicAngle=e.readInt(),this.underlinePosition=e.readShort(),this.underlineThickness=e.readShort(),this.isFixedPitch=e.readInt(),this.minMemType42=e.readInt(),this.maxMemType42=e.readInt(),this.minMemType1=e.readInt(),this.maxMemType1=e.readInt(),this.format){case 65536:case 196608:break;case 131072:var u;for(i=e.readUInt16(),this.glyphNameIndex=[],u=0;0<=i?u<i:u>i;u=0<=i?++u:--u)this.glyphNameIndex.push(e.readUInt16());for(this.names=[],c=[];e.pos<this.offset+this.length;)t=e.readByte(),c.push(this.names.push(e.readString(t)));return c;case 151552:return i=e.readUInt16(),this.offsets=e.read(i);case 262144:return this.map=(function(){var m,_,o;for(o=[],u=m=0,_=this.file.maxp.numGlyphs;0<=_?m<_:m>_;u=0<=_?++m:--m)o.push(e.readUInt32());return o}).call(this)}},n})(),gM=function(n,e){this.raw=n,this.length=n.length,this.platformID=e.platformID,this.encodingID=e.encodingID,this.languageID=e.languageID},yM=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return ep(n,hf),n.prototype.tag="name",n.prototype.parse=function(e){var t,i,c,u,m,_,o,b,I,M,V;for(e.pos=this.offset,e.readShort(),t=e.readShort(),_=e.readShort(),i=[],u=0;0<=t?u<t:u>t;u=0<=t?++u:--u)i.push({platformID:e.readShort(),encodingID:e.readShort(),languageID:e.readShort(),nameID:e.readShort(),length:e.readShort(),offset:this.offset+_+e.readShort()});for(o={},u=I=0,M=i.length;I<M;u=++I)c=i[u],e.pos=c.offset,b=e.readString(c.length),m=new gM(b,c),o[V=c.nameID]==null&&(o[V]=[]),o[c.nameID].push(m);this.strings=o,this.copyright=o[0],this.fontFamily=o[1],this.fontSubfamily=o[2],this.uniqueSubfamily=o[3],this.fontName=o[4],this.version=o[5];try{this.postscriptName=o[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=o[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=o[7],this.manufacturer=o[8],this.designer=o[9],this.description=o[10],this.vendorUrl=o[11],this.designerUrl=o[12],this.license=o[13],this.licenseUrl=o[14],this.preferredFamily=o[15],this.preferredSubfamily=o[17],this.compatibleFull=o[18],this.sampleText=o[19]},n})(),_M=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return ep(n,hf),n.prototype.tag="maxp",n.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.numGlyphs=e.readUInt16(),this.maxPoints=e.readUInt16(),this.maxContours=e.readUInt16(),this.maxCompositePoints=e.readUInt16(),this.maxComponentContours=e.readUInt16(),this.maxZones=e.readUInt16(),this.maxTwilightPoints=e.readUInt16(),this.maxStorage=e.readUInt16(),this.maxFunctionDefs=e.readUInt16(),this.maxInstructionDefs=e.readUInt16(),this.maxStackElements=e.readUInt16(),this.maxSizeOfInstructions=e.readUInt16(),this.maxComponentElements=e.readUInt16(),this.maxComponentDepth=e.readUInt16()},n})(),vM=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return ep(n,hf),n.prototype.tag="hmtx",n.prototype.parse=function(e){var t,i,c,u,m,_,o;for(e.pos=this.offset,this.metrics=[],t=0,_=this.file.hhea.numberOfMetrics;0<=_?t<_:t>_;t=0<=_?++t:--t)this.metrics.push({advance:e.readUInt16(),lsb:e.readInt16()});for(c=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=(function(){var b,I;for(I=[],t=b=0;0<=c?b<c:b>c;t=0<=c?++b:--b)I.push(e.readInt16());return I})(),this.widths=(function(){var b,I,M,V;for(V=[],b=0,I=(M=this.metrics).length;b<I;b++)u=M[b],V.push(u.advance);return V}).call(this),i=this.widths[this.widths.length-1],o=[],t=m=0;0<=c?m<c:m>c;t=0<=c?++m:--m)o.push(this.widths.push(i));return o},n.prototype.forGlyph=function(e){return e in this.metrics?this.metrics[e]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[e-this.metrics.length]}},n})(),Z6=[].slice,xM=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return ep(n,hf),n.prototype.tag="glyf",n.prototype.parse=function(){return this.cache={}},n.prototype.glyphFor=function(e){var t,i,c,u,m,_,o,b,I,M;return e in this.cache?this.cache[e]:(u=this.file.loca,t=this.file.contents,i=u.indexOf(e),(c=u.lengthOf(e))===0?this.cache[e]=null:(t.pos=this.offset+i,m=(_=new dm(t.read(c))).readShort(),b=_.readShort(),M=_.readShort(),o=_.readShort(),I=_.readShort(),this.cache[e]=m===-1?new wM(_,b,M,o,I):new bM(_,m,b,M,o,I),this.cache[e]))},n.prototype.encode=function(e,t,i){var c,u,m,_,o;for(m=[],u=[],_=0,o=t.length;_<o;_++)c=e[t[_]],u.push(m.length),c&&(m=m.concat(c.encode(i)));return u.push(m.length),{table:m,offsets:u}},n})(),bM=(function(){function n(e,t,i,c,u,m){this.raw=e,this.numberOfContours=t,this.xMin=i,this.yMin=c,this.xMax=u,this.yMax=m,this.compound=!1}return n.prototype.encode=function(){return this.raw.data},n})(),wM=(function(){function n(e,t,i,c,u){var m,_;for(this.raw=e,this.xMin=t,this.yMin=i,this.xMax=c,this.yMax=u,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],m=this.raw;_=m.readShort(),this.glyphOffsets.push(m.pos),this.glyphIDs.push(m.readUInt16()),32&_;)m.pos+=1&_?4:2,128&_?m.pos+=8:64&_?m.pos+=4:8&_&&(m.pos+=2)}return n.prototype.encode=function(){var e,t,i;for(t=new dm(Z6.call(this.raw.data)),e=0,i=this.glyphIDs.length;e<i;++e)t.pos=this.glyphOffsets[e];return t.data},n})(),SM=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return ep(n,hf),n.prototype.tag="loca",n.prototype.parse=function(e){var t,i;return e.pos=this.offset,t=this.file.head.indexToLocFormat,this.offsets=t===0?(function(){var c,u;for(u=[],i=0,c=this.length;i<c;i+=2)u.push(2*e.readUInt16());return u}).call(this):(function(){var c,u;for(u=[],i=0,c=this.length;i<c;i+=4)u.push(e.readUInt32());return u}).call(this)},n.prototype.indexOf=function(e){return this.offsets[e]},n.prototype.lengthOf=function(e){return this.offsets[e+1]-this.offsets[e]},n.prototype.encode=function(e,t){for(var i=new Uint32Array(this.offsets.length),c=0,u=0,m=0;m<i.length;++m)if(i[m]=c,u<t.length&&t[u]==m){++u,i[m]=c;var _=this.offsets[m],o=this.offsets[m+1]-_;o>0&&(c+=o)}for(var b=new Array(4*i.length),I=0;I<i.length;++I)b[4*I+3]=255&i[I],b[4*I+2]=(65280&i[I])>>8,b[4*I+1]=(16711680&i[I])>>16,b[4*I]=(4278190080&i[I])>>24;return b},n})(),EM=(function(){function n(e){this.font=e,this.subset={},this.unicodes={},this.next=33}return n.prototype.generateCmap=function(){var e,t,i,c,u;for(t in c=this.font.cmap.tables[0].codeMap,e={},u=this.subset)i=u[t],e[t]=c[i];return e},n.prototype.glyphsFor=function(e){var t,i,c,u,m,_,o;for(c={},m=0,_=e.length;m<_;m++)c[u=e[m]]=this.font.glyf.glyphFor(u);for(u in t=[],c)(i=c[u])!=null&&i.compound&&t.push.apply(t,i.glyphIDs);if(t.length>0)for(u in o=this.glyphsFor(t))i=o[u],c[u]=i;return c},n.prototype.encode=function(e,t){var i,c,u,m,_,o,b,I,M,V,k,ie,se,de,J;for(c in i=X6.encode(this.generateCmap(),"unicode"),m=this.glyphsFor(e),k={0:0},J=i.charMap)k[(o=J[c]).old]=o.new;for(ie in V=i.maxGlyphID,m)ie in k||(k[ie]=V++);return I=(function(ne){var me,ue;for(me in ue={},ne)ue[ne[me]]=me;return ue})(k),M=Object.keys(I).sort(function(ne,me){return ne-me}),se=(function(){var ne,me,ue;for(ue=[],ne=0,me=M.length;ne<me;ne++)_=M[ne],ue.push(I[_]);return ue})(),u=this.font.glyf.encode(m,se,k),b=this.font.loca.encode(u.offsets,se),de={cmap:this.font.cmap.raw(),glyf:u.table,loca:b,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(t)},this.font.os2.exists&&(de["OS/2"]=this.font.os2.raw()),this.font.directory.encode(de)},n})();wi.API.PDFObject=(function(){var n;function e(){}return n=function(t,i){return(Array(i+1).join("0")+t).slice(-i)},e.convert=function(t){var i,c,u,m;if(Array.isArray(t))return"["+(function(){var _,o,b;for(b=[],_=0,o=t.length;_<o;_++)i=t[_],b.push(e.convert(i));return b})().join(" ")+"]";if(typeof t=="string")return"/"+t;if(t?.isString)return"("+t+")";if(t instanceof Date)return"(D:"+n(t.getUTCFullYear(),4)+n(t.getUTCMonth(),2)+n(t.getUTCDate(),2)+n(t.getUTCHours(),2)+n(t.getUTCMinutes(),2)+n(t.getUTCSeconds(),2)+"Z)";if({}.toString.call(t)==="[object Object]"){for(c in u=["<<"],t)m=t[c],u.push("/"+c+" "+e.convert(m));return u.push(">>"),u.join(`
`)}return""+t},e})();var WS={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y6=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let c=n.charCodeAt(i);c<128?e[t++]=c:c<2048?(e[t++]=c>>6|192,e[t++]=c&63|128):(c&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(c=65536+((c&1023)<<10)+(n.charCodeAt(++i)&1023),e[t++]=c>>18|240,e[t++]=c>>12&63|128,e[t++]=c>>6&63|128,e[t++]=c&63|128):(e[t++]=c>>12|224,e[t++]=c>>6&63|128,e[t++]=c&63|128)}return e},AM=function(n){const e=[];let t=0,i=0;for(;t<n.length;){const c=n[t++];if(c<128)e[i++]=String.fromCharCode(c);else if(c>191&&c<224){const u=n[t++];e[i++]=String.fromCharCode((c&31)<<6|u&63)}else if(c>239&&c<365){const u=n[t++],m=n[t++],_=n[t++],o=((c&7)<<18|(u&63)<<12|(m&63)<<6|_&63)-65536;e[i++]=String.fromCharCode(55296+(o>>10)),e[i++]=String.fromCharCode(56320+(o&1023))}else{const u=n[t++],m=n[t++];e[i++]=String.fromCharCode((c&15)<<12|(u&63)<<6|m&63)}}return e.join("")},J6={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let c=0;c<n.length;c+=3){const u=n[c],m=c+1<n.length,_=m?n[c+1]:0,o=c+2<n.length,b=o?n[c+2]:0,I=u>>2,M=(u&3)<<4|_>>4;let V=(_&15)<<2|b>>6,k=b&63;o||(k=64,m||(V=64)),i.push(t[I],t[M],t[V],t[k])}return i.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Y6(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):AM(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let c=0;c<n.length;){const u=t[n.charAt(c++)],_=c<n.length?t[n.charAt(c)]:0;++c;const b=c<n.length?t[n.charAt(c)]:64;++c;const M=c<n.length?t[n.charAt(c)]:64;if(++c,u==null||_==null||b==null||M==null)throw new TM;const V=u<<2|_>>4;if(i.push(V),b!==64){const k=_<<4&240|b>>2;if(i.push(k),M!==64){const ie=b<<6&192|M;i.push(ie)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class TM extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const IM=function(n){const e=Y6(n);return J6.encodeByteArray(e,!0)},_v=function(n){return IM(n).replace(/\./g,"")},Q6=function(n){try{return J6.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CM(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LM=()=>CM().__FIREBASE_DEFAULTS__,PM=()=>{if(typeof process>"u"||typeof WS>"u")return;const n=WS.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},kM=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Q6(n[1]);return e&&JSON.parse(e)},nx=()=>{try{return LM()||PM()||kM()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},e9=n=>{var e,t;return(t=(e=nx())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},RM=n=>{const e=e9(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),i]:[e.substring(0,t),i]},t9=()=>{var n;return(n=nx())===null||n===void 0?void 0:n.config},n9=n=>{var e;return(e=nx())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MM{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,i))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NM(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},i=e||"demo-project",c=n.iat||0,u=n.sub||n.user_id;if(!u)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const m=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:c,exp:c+3600,auth_time:c,sub:u,user_id:u,firebase:{sign_in_provider:"custom",identities:{}}},n);return[_v(JSON.stringify(t)),_v(JSON.stringify(m)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _h(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function DM(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(_h())}function FM(){var n;const e=(n=nx())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function OM(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function BM(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function zM(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function jM(){const n=_h();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function UM(){return!FM()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function VM(){try{return typeof indexedDB=="object"}catch{return!1}}function qM(){return new Promise((n,e)=>{try{let t=!0;const i="validate-browser-context-for-indexeddb-analytics-module",c=self.indexedDB.open(i);c.onsuccess=()=>{c.result.close(),t||self.indexedDB.deleteDatabase(i),n(!0)},c.onupgradeneeded=()=>{t=!1},c.onerror=()=>{var u;e(((u=c.error)===null||u===void 0?void 0:u.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $M="FirebaseError";class Pp extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name=$M,Object.setPrototypeOf(this,Pp.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,S_.prototype.create)}}class S_{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){const i=t[0]||{},c=`${this.service}/${e}`,u=this.errors[e],m=u?GM(u,i):"Error",_=`${this.serviceName}: ${m} (${c}).`;return new Pp(c,_,i)}}function GM(n,e){return n.replace(HM,(t,i)=>{const c=e[i];return c!=null?String(c):`<${i}?>`})}const HM=/\{\$([^}]+)}/g;function WM(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function vv(n,e){if(n===e)return!0;const t=Object.keys(n),i=Object.keys(e);for(const c of t){if(!i.includes(c))return!1;const u=n[c],m=e[c];if(KS(u)&&KS(m)){if(!vv(u,m))return!1}else if(u!==m)return!1}for(const c of i)if(!t.includes(c))return!1;return!0}function KS(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function E_(n){const e=[];for(const[t,i]of Object.entries(n))Array.isArray(i)?i.forEach(c=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(c))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}function KM(n,e){const t=new XM(n,e);return t.subscribe.bind(t)}class XM{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(i=>{this.error(i)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,i){let c;if(e===void 0&&t===void 0&&i===void 0)throw new Error("Missing Observer.");ZM(e,["next","error","complete"])?c=e:c={next:e,error:t,complete:i},c.next===void 0&&(c.next=Db),c.error===void 0&&(c.error=Db),c.complete===void 0&&(c.complete=Db);const u=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?c.error(this.finalError):c.complete()}catch{}}),this.observers.push(c),u}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function ZM(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Db(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ph(n){return n&&n._delegate?n._delegate:n}class ag{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xm="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YM{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const i=new MM;if(this.instancesDeferred.set(t,i),this.isInitialized(t)||this.shouldAutoInitialize())try{const c=this.getOrInitializeService({instanceIdentifier:t});c&&i.resolve(c)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const i=this.normalizeInstanceIdentifier(e?.identifier),c=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(u){if(c)return null;throw u}else{if(c)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(QM(e))try{this.getOrInitializeService({instanceIdentifier:Xm})}catch{}for(const[t,i]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(t);try{const u=this.getOrInitializeService({instanceIdentifier:c});i.resolve(u)}catch{}}}}clearInstance(e=Xm){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Xm){return this.instances.has(e)}getOptions(e=Xm){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const c=this.getOrInitializeService({instanceIdentifier:i,options:t});for(const[u,m]of this.instancesDeferred.entries()){const _=this.normalizeInstanceIdentifier(u);i===_&&m.resolve(c)}return c}onInit(e,t){var i;const c=this.normalizeInstanceIdentifier(t),u=(i=this.onInitCallbacks.get(c))!==null&&i!==void 0?i:new Set;u.add(e),this.onInitCallbacks.set(c,u);const m=this.instances.get(c);return m&&e(m,c),()=>{u.delete(e)}}invokeOnInitCallbacks(e,t){const i=this.onInitCallbacks.get(t);if(i)for(const c of i)try{c(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:JM(e),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=Xm){return this.component?this.component.multipleInstances?e:Xm:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function JM(n){return n===Xm?void 0:n}function QM(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eN{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new YM(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ys;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(ys||(ys={}));const tN={debug:ys.DEBUG,verbose:ys.VERBOSE,info:ys.INFO,warn:ys.WARN,error:ys.ERROR,silent:ys.SILENT},nN=ys.INFO,rN={[ys.DEBUG]:"log",[ys.VERBOSE]:"log",[ys.INFO]:"info",[ys.WARN]:"warn",[ys.ERROR]:"error"},iN=(n,e,...t)=>{if(e<n.logLevel)return;const i=new Date().toISOString(),c=rN[e];if(c)console[c](`[${i}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Aw{constructor(e){this.name=e,this._logLevel=nN,this._logHandler=iN,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ys))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?tN[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ys.DEBUG,...e),this._logHandler(this,ys.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ys.VERBOSE,...e),this._logHandler(this,ys.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ys.INFO,...e),this._logHandler(this,ys.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ys.WARN,...e),this._logHandler(this,ys.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ys.ERROR,...e),this._logHandler(this,ys.ERROR,...e)}}const oN=(n,e)=>e.some(t=>n instanceof t);let XS,ZS;function sN(){return XS||(XS=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function aN(){return ZS||(ZS=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const r9=new WeakMap,I5=new WeakMap,i9=new WeakMap,Fb=new WeakMap,Tw=new WeakMap;function lN(n){const e=new Promise((t,i)=>{const c=()=>{n.removeEventListener("success",u),n.removeEventListener("error",m)},u=()=>{t(om(n.result)),c()},m=()=>{i(n.error),c()};n.addEventListener("success",u),n.addEventListener("error",m)});return e.then(t=>{t instanceof IDBCursor&&r9.set(t,n)}).catch(()=>{}),Tw.set(e,n),e}function cN(n){if(I5.has(n))return;const e=new Promise((t,i)=>{const c=()=>{n.removeEventListener("complete",u),n.removeEventListener("error",m),n.removeEventListener("abort",m)},u=()=>{t(),c()},m=()=>{i(n.error||new DOMException("AbortError","AbortError")),c()};n.addEventListener("complete",u),n.addEventListener("error",m),n.addEventListener("abort",m)});I5.set(n,e)}let C5={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return I5.get(n);if(e==="objectStoreNames")return n.objectStoreNames||i9.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return om(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function uN(n){C5=n(C5)}function hN(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const i=n.call(Ob(this),e,...t);return i9.set(i,e.sort?e.sort():[e]),om(i)}:aN().includes(n)?function(...e){return n.apply(Ob(this),e),om(r9.get(this))}:function(...e){return om(n.apply(Ob(this),e))}}function dN(n){return typeof n=="function"?hN(n):(n instanceof IDBTransaction&&cN(n),oN(n,sN())?new Proxy(n,C5):n)}function om(n){if(n instanceof IDBRequest)return lN(n);if(Fb.has(n))return Fb.get(n);const e=dN(n);return e!==n&&(Fb.set(n,e),Tw.set(e,n)),e}const Ob=n=>Tw.get(n);function fN(n,e,{blocked:t,upgrade:i,blocking:c,terminated:u}={}){const m=indexedDB.open(n,e),_=om(m);return i&&m.addEventListener("upgradeneeded",o=>{i(om(m.result),o.oldVersion,o.newVersion,om(m.transaction),o)}),t&&m.addEventListener("blocked",o=>t(o.oldVersion,o.newVersion,o)),_.then(o=>{u&&o.addEventListener("close",()=>u()),c&&o.addEventListener("versionchange",b=>c(b.oldVersion,b.newVersion,b))}).catch(()=>{}),_}const pN=["get","getKey","getAll","getAllKeys","count"],mN=["put","add","delete","clear"],Bb=new Map;function YS(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Bb.get(e))return Bb.get(e);const t=e.replace(/FromIndex$/,""),i=e!==t,c=mN.includes(t);if(!(t in(i?IDBIndex:IDBObjectStore).prototype)||!(c||pN.includes(t)))return;const u=async function(m,..._){const o=this.transaction(m,c?"readwrite":"readonly");let b=o.store;return i&&(b=b.index(_.shift())),(await Promise.all([b[t](..._),c&&o.done]))[0]};return Bb.set(e,u),u}uN(n=>({...n,get:(e,t,i)=>YS(e,t)||n.get(e,t,i),has:(e,t)=>!!YS(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gN{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(yN(t)){const i=t.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(t=>t).join(" ")}}function yN(n){const e=n.getComponent();return e?.type==="VERSION"}const L5="@firebase/app",JS="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ap=new Aw("@firebase/app"),_N="@firebase/app-compat",vN="@firebase/analytics-compat",xN="@firebase/analytics",bN="@firebase/app-check-compat",wN="@firebase/app-check",SN="@firebase/auth",EN="@firebase/auth-compat",AN="@firebase/database",TN="@firebase/data-connect",IN="@firebase/database-compat",CN="@firebase/functions",LN="@firebase/functions-compat",PN="@firebase/installations",kN="@firebase/installations-compat",RN="@firebase/messaging",MN="@firebase/messaging-compat",NN="@firebase/performance",DN="@firebase/performance-compat",FN="@firebase/remote-config",ON="@firebase/remote-config-compat",BN="@firebase/storage",zN="@firebase/storage-compat",jN="@firebase/firestore",UN="@firebase/vertexai-preview",VN="@firebase/firestore-compat",qN="firebase",$N="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P5="[DEFAULT]",GN={[L5]:"fire-core",[_N]:"fire-core-compat",[xN]:"fire-analytics",[vN]:"fire-analytics-compat",[wN]:"fire-app-check",[bN]:"fire-app-check-compat",[SN]:"fire-auth",[EN]:"fire-auth-compat",[AN]:"fire-rtdb",[TN]:"fire-data-connect",[IN]:"fire-rtdb-compat",[CN]:"fire-fn",[LN]:"fire-fn-compat",[PN]:"fire-iid",[kN]:"fire-iid-compat",[RN]:"fire-fcm",[MN]:"fire-fcm-compat",[NN]:"fire-perf",[DN]:"fire-perf-compat",[FN]:"fire-rc",[ON]:"fire-rc-compat",[BN]:"fire-gcs",[zN]:"fire-gcs-compat",[jN]:"fire-fst",[VN]:"fire-fst-compat",[UN]:"fire-vertex","fire-js":"fire-js",[qN]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xv=new Map,HN=new Map,k5=new Map;function QS(n,e){try{n.container.addComponent(e)}catch(t){Ap.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function E0(n){const e=n.name;if(k5.has(e))return Ap.debug(`There were multiple attempts to register component ${e}.`),!1;k5.set(e,n);for(const t of xv.values())QS(t,n);for(const t of HN.values())QS(t,n);return!0}function Iw(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function jf(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WN={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},sm=new S_("app","Firebase",WN);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KN{constructor(e,t,i){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new ag("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw sm.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B0=$N;function o9(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const i=Object.assign({name:P5,automaticDataCollectionEnabled:!1},e),c=i.name;if(typeof c!="string"||!c)throw sm.create("bad-app-name",{appName:String(c)});if(t||(t=t9()),!t)throw sm.create("no-options");const u=xv.get(c);if(u){if(vv(t,u.options)&&vv(i,u.config))return u;throw sm.create("duplicate-app",{appName:c})}const m=new eN(c);for(const o of k5.values())m.addComponent(o);const _=new KN(t,i,m);return xv.set(c,_),_}function s9(n=P5){const e=xv.get(n);if(!e&&n===P5&&t9())return o9();if(!e)throw sm.create("no-app",{appName:n});return e}function am(n,e,t){var i;let c=(i=GN[n])!==null&&i!==void 0?i:n;t&&(c+=`-${t}`);const u=c.match(/\s|\//),m=e.match(/\s|\//);if(u||m){const _=[`Unable to register library "${c}" with version "${e}":`];u&&_.push(`library name "${c}" contains illegal characters (whitespace or "/")`),u&&m&&_.push("and"),m&&_.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ap.warn(_.join(" "));return}E0(new ag(`${c}-version`,()=>({library:c,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XN="firebase-heartbeat-database",ZN=1,a_="firebase-heartbeat-store";let zb=null;function a9(){return zb||(zb=fN(XN,ZN,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(a_)}catch(t){console.warn(t)}}}}).catch(n=>{throw sm.create("idb-open",{originalErrorMessage:n.message})})),zb}async function YN(n){try{const t=(await a9()).transaction(a_),i=await t.objectStore(a_).get(l9(n));return await t.done,i}catch(e){if(e instanceof Pp)Ap.warn(e.message);else{const t=sm.create("idb-get",{originalErrorMessage:e?.message});Ap.warn(t.message)}}}async function eE(n,e){try{const i=(await a9()).transaction(a_,"readwrite");await i.objectStore(a_).put(e,l9(n)),await i.done}catch(t){if(t instanceof Pp)Ap.warn(t.message);else{const i=sm.create("idb-set",{originalErrorMessage:t?.message});Ap.warn(i.message)}}}function l9(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JN=1024,QN=720*60*60*1e3;class eD{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new nD(t),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){var e,t;try{const c=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),u=tE();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===u||this._heartbeatsCache.heartbeats.some(m=>m.date===u)?void 0:(this._heartbeatsCache.heartbeats.push({date:u,agent:c}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(m=>{const _=new Date(m.date).valueOf();return Date.now()-_<=QN}),this._storage.overwrite(this._heartbeatsCache))}catch(i){Ap.warn(i)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=tE(),{heartbeatsToSend:i,unsentEntries:c}=tD(this._heartbeatsCache.heartbeats),u=_v(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=t,c.length>0?(this._heartbeatsCache.heartbeats=c,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),u}catch(t){return Ap.warn(t),""}}}function tE(){return new Date().toISOString().substring(0,10)}function tD(n,e=JN){const t=[];let i=n.slice();for(const c of n){const u=t.find(m=>m.agent===c.agent);if(u){if(u.dates.push(c.date),nE(t)>e){u.dates.pop();break}}else if(t.push({agent:c.agent,dates:[c.date]}),nE(t)>e){t.pop();break}i=i.slice(1)}return{heartbeatsToSend:t,unsentEntries:i}}class nD{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return VM()?qM().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await YN(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const c=await this.read();return eE(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:c.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const c=await this.read();return eE(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:c.lastSentHeartbeatDate,heartbeats:[...c.heartbeats,...e.heartbeats]})}else return}}function nE(n){return _v(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rD(n){E0(new ag("platform-logger",e=>new gN(e),"PRIVATE")),E0(new ag("heartbeat",e=>new eD(e),"PRIVATE")),am(L5,JS,n),am(L5,JS,"esm2017"),am("fire-js","")}rD("");var iD="firebase",oD="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */am(iD,oD,"app");var rE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var ig,c9;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(pe,U){function F(){}F.prototype=U.prototype,pe.D=U.prototype,pe.prototype=new F,pe.prototype.constructor=pe,pe.C=function(q,j,H){for(var Z=Array(arguments.length-2),be=2;be<arguments.length;be++)Z[be-2]=arguments[be];return U.prototype[j].apply(q,Z)}}function t(){this.blockSize=-1}function i(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(i,t),i.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function c(pe,U,F){F||(F=0);var q=Array(16);if(typeof U=="string")for(var j=0;16>j;++j)q[j]=U.charCodeAt(F++)|U.charCodeAt(F++)<<8|U.charCodeAt(F++)<<16|U.charCodeAt(F++)<<24;else for(j=0;16>j;++j)q[j]=U[F++]|U[F++]<<8|U[F++]<<16|U[F++]<<24;U=pe.g[0],F=pe.g[1],j=pe.g[2];var H=pe.g[3],Z=U+(H^F&(j^H))+q[0]+3614090360&4294967295;U=F+(Z<<7&4294967295|Z>>>25),Z=H+(j^U&(F^j))+q[1]+3905402710&4294967295,H=U+(Z<<12&4294967295|Z>>>20),Z=j+(F^H&(U^F))+q[2]+606105819&4294967295,j=H+(Z<<17&4294967295|Z>>>15),Z=F+(U^j&(H^U))+q[3]+3250441966&4294967295,F=j+(Z<<22&4294967295|Z>>>10),Z=U+(H^F&(j^H))+q[4]+4118548399&4294967295,U=F+(Z<<7&4294967295|Z>>>25),Z=H+(j^U&(F^j))+q[5]+1200080426&4294967295,H=U+(Z<<12&4294967295|Z>>>20),Z=j+(F^H&(U^F))+q[6]+2821735955&4294967295,j=H+(Z<<17&4294967295|Z>>>15),Z=F+(U^j&(H^U))+q[7]+4249261313&4294967295,F=j+(Z<<22&4294967295|Z>>>10),Z=U+(H^F&(j^H))+q[8]+1770035416&4294967295,U=F+(Z<<7&4294967295|Z>>>25),Z=H+(j^U&(F^j))+q[9]+2336552879&4294967295,H=U+(Z<<12&4294967295|Z>>>20),Z=j+(F^H&(U^F))+q[10]+4294925233&4294967295,j=H+(Z<<17&4294967295|Z>>>15),Z=F+(U^j&(H^U))+q[11]+2304563134&4294967295,F=j+(Z<<22&4294967295|Z>>>10),Z=U+(H^F&(j^H))+q[12]+1804603682&4294967295,U=F+(Z<<7&4294967295|Z>>>25),Z=H+(j^U&(F^j))+q[13]+4254626195&4294967295,H=U+(Z<<12&4294967295|Z>>>20),Z=j+(F^H&(U^F))+q[14]+2792965006&4294967295,j=H+(Z<<17&4294967295|Z>>>15),Z=F+(U^j&(H^U))+q[15]+1236535329&4294967295,F=j+(Z<<22&4294967295|Z>>>10),Z=U+(j^H&(F^j))+q[1]+4129170786&4294967295,U=F+(Z<<5&4294967295|Z>>>27),Z=H+(F^j&(U^F))+q[6]+3225465664&4294967295,H=U+(Z<<9&4294967295|Z>>>23),Z=j+(U^F&(H^U))+q[11]+643717713&4294967295,j=H+(Z<<14&4294967295|Z>>>18),Z=F+(H^U&(j^H))+q[0]+3921069994&4294967295,F=j+(Z<<20&4294967295|Z>>>12),Z=U+(j^H&(F^j))+q[5]+3593408605&4294967295,U=F+(Z<<5&4294967295|Z>>>27),Z=H+(F^j&(U^F))+q[10]+38016083&4294967295,H=U+(Z<<9&4294967295|Z>>>23),Z=j+(U^F&(H^U))+q[15]+3634488961&4294967295,j=H+(Z<<14&4294967295|Z>>>18),Z=F+(H^U&(j^H))+q[4]+3889429448&4294967295,F=j+(Z<<20&4294967295|Z>>>12),Z=U+(j^H&(F^j))+q[9]+568446438&4294967295,U=F+(Z<<5&4294967295|Z>>>27),Z=H+(F^j&(U^F))+q[14]+3275163606&4294967295,H=U+(Z<<9&4294967295|Z>>>23),Z=j+(U^F&(H^U))+q[3]+4107603335&4294967295,j=H+(Z<<14&4294967295|Z>>>18),Z=F+(H^U&(j^H))+q[8]+1163531501&4294967295,F=j+(Z<<20&4294967295|Z>>>12),Z=U+(j^H&(F^j))+q[13]+2850285829&4294967295,U=F+(Z<<5&4294967295|Z>>>27),Z=H+(F^j&(U^F))+q[2]+4243563512&4294967295,H=U+(Z<<9&4294967295|Z>>>23),Z=j+(U^F&(H^U))+q[7]+1735328473&4294967295,j=H+(Z<<14&4294967295|Z>>>18),Z=F+(H^U&(j^H))+q[12]+2368359562&4294967295,F=j+(Z<<20&4294967295|Z>>>12),Z=U+(F^j^H)+q[5]+4294588738&4294967295,U=F+(Z<<4&4294967295|Z>>>28),Z=H+(U^F^j)+q[8]+2272392833&4294967295,H=U+(Z<<11&4294967295|Z>>>21),Z=j+(H^U^F)+q[11]+1839030562&4294967295,j=H+(Z<<16&4294967295|Z>>>16),Z=F+(j^H^U)+q[14]+4259657740&4294967295,F=j+(Z<<23&4294967295|Z>>>9),Z=U+(F^j^H)+q[1]+2763975236&4294967295,U=F+(Z<<4&4294967295|Z>>>28),Z=H+(U^F^j)+q[4]+1272893353&4294967295,H=U+(Z<<11&4294967295|Z>>>21),Z=j+(H^U^F)+q[7]+4139469664&4294967295,j=H+(Z<<16&4294967295|Z>>>16),Z=F+(j^H^U)+q[10]+3200236656&4294967295,F=j+(Z<<23&4294967295|Z>>>9),Z=U+(F^j^H)+q[13]+681279174&4294967295,U=F+(Z<<4&4294967295|Z>>>28),Z=H+(U^F^j)+q[0]+3936430074&4294967295,H=U+(Z<<11&4294967295|Z>>>21),Z=j+(H^U^F)+q[3]+3572445317&4294967295,j=H+(Z<<16&4294967295|Z>>>16),Z=F+(j^H^U)+q[6]+76029189&4294967295,F=j+(Z<<23&4294967295|Z>>>9),Z=U+(F^j^H)+q[9]+3654602809&4294967295,U=F+(Z<<4&4294967295|Z>>>28),Z=H+(U^F^j)+q[12]+3873151461&4294967295,H=U+(Z<<11&4294967295|Z>>>21),Z=j+(H^U^F)+q[15]+530742520&4294967295,j=H+(Z<<16&4294967295|Z>>>16),Z=F+(j^H^U)+q[2]+3299628645&4294967295,F=j+(Z<<23&4294967295|Z>>>9),Z=U+(j^(F|~H))+q[0]+4096336452&4294967295,U=F+(Z<<6&4294967295|Z>>>26),Z=H+(F^(U|~j))+q[7]+1126891415&4294967295,H=U+(Z<<10&4294967295|Z>>>22),Z=j+(U^(H|~F))+q[14]+2878612391&4294967295,j=H+(Z<<15&4294967295|Z>>>17),Z=F+(H^(j|~U))+q[5]+4237533241&4294967295,F=j+(Z<<21&4294967295|Z>>>11),Z=U+(j^(F|~H))+q[12]+1700485571&4294967295,U=F+(Z<<6&4294967295|Z>>>26),Z=H+(F^(U|~j))+q[3]+2399980690&4294967295,H=U+(Z<<10&4294967295|Z>>>22),Z=j+(U^(H|~F))+q[10]+4293915773&4294967295,j=H+(Z<<15&4294967295|Z>>>17),Z=F+(H^(j|~U))+q[1]+2240044497&4294967295,F=j+(Z<<21&4294967295|Z>>>11),Z=U+(j^(F|~H))+q[8]+1873313359&4294967295,U=F+(Z<<6&4294967295|Z>>>26),Z=H+(F^(U|~j))+q[15]+4264355552&4294967295,H=U+(Z<<10&4294967295|Z>>>22),Z=j+(U^(H|~F))+q[6]+2734768916&4294967295,j=H+(Z<<15&4294967295|Z>>>17),Z=F+(H^(j|~U))+q[13]+1309151649&4294967295,F=j+(Z<<21&4294967295|Z>>>11),Z=U+(j^(F|~H))+q[4]+4149444226&4294967295,U=F+(Z<<6&4294967295|Z>>>26),Z=H+(F^(U|~j))+q[11]+3174756917&4294967295,H=U+(Z<<10&4294967295|Z>>>22),Z=j+(U^(H|~F))+q[2]+718787259&4294967295,j=H+(Z<<15&4294967295|Z>>>17),Z=F+(H^(j|~U))+q[9]+3951481745&4294967295,pe.g[0]=pe.g[0]+U&4294967295,pe.g[1]=pe.g[1]+(j+(Z<<21&4294967295|Z>>>11))&4294967295,pe.g[2]=pe.g[2]+j&4294967295,pe.g[3]=pe.g[3]+H&4294967295}i.prototype.u=function(pe,U){U===void 0&&(U=pe.length);for(var F=U-this.blockSize,q=this.B,j=this.h,H=0;H<U;){if(j==0)for(;H<=F;)c(this,pe,H),H+=this.blockSize;if(typeof pe=="string"){for(;H<U;)if(q[j++]=pe.charCodeAt(H++),j==this.blockSize){c(this,q),j=0;break}}else for(;H<U;)if(q[j++]=pe[H++],j==this.blockSize){c(this,q),j=0;break}}this.h=j,this.o+=U},i.prototype.v=function(){var pe=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);pe[0]=128;for(var U=1;U<pe.length-8;++U)pe[U]=0;var F=8*this.o;for(U=pe.length-8;U<pe.length;++U)pe[U]=F&255,F/=256;for(this.u(pe),pe=Array(16),U=F=0;4>U;++U)for(var q=0;32>q;q+=8)pe[F++]=this.g[U]>>>q&255;return pe};function u(pe,U){var F=_;return Object.prototype.hasOwnProperty.call(F,pe)?F[pe]:F[pe]=U(pe)}function m(pe,U){this.h=U;for(var F=[],q=!0,j=pe.length-1;0<=j;j--){var H=pe[j]|0;q&&H==U||(F[j]=H,q=!1)}this.g=F}var _={};function o(pe){return-128<=pe&&128>pe?u(pe,function(U){return new m([U|0],0>U?-1:0)}):new m([pe|0],0>pe?-1:0)}function b(pe){if(isNaN(pe)||!isFinite(pe))return M;if(0>pe)return de(b(-pe));for(var U=[],F=1,q=0;pe>=F;q++)U[q]=pe/F|0,F*=4294967296;return new m(U,0)}function I(pe,U){if(pe.length==0)throw Error("number format error: empty string");if(U=U||10,2>U||36<U)throw Error("radix out of range: "+U);if(pe.charAt(0)=="-")return de(I(pe.substring(1),U));if(0<=pe.indexOf("-"))throw Error('number format error: interior "-" character');for(var F=b(Math.pow(U,8)),q=M,j=0;j<pe.length;j+=8){var H=Math.min(8,pe.length-j),Z=parseInt(pe.substring(j,j+H),U);8>H?(H=b(Math.pow(U,H)),q=q.j(H).add(b(Z))):(q=q.j(F),q=q.add(b(Z)))}return q}var M=o(0),V=o(1),k=o(16777216);n=m.prototype,n.m=function(){if(se(this))return-de(this).m();for(var pe=0,U=1,F=0;F<this.g.length;F++){var q=this.i(F);pe+=(0<=q?q:4294967296+q)*U,U*=4294967296}return pe},n.toString=function(pe){if(pe=pe||10,2>pe||36<pe)throw Error("radix out of range: "+pe);if(ie(this))return"0";if(se(this))return"-"+de(this).toString(pe);for(var U=b(Math.pow(pe,6)),F=this,q="";;){var j=ue(F,U).g;F=J(F,j.j(U));var H=((0<F.g.length?F.g[0]:F.h)>>>0).toString(pe);if(F=j,ie(F))return H+q;for(;6>H.length;)H="0"+H;q=H+q}},n.i=function(pe){return 0>pe?0:pe<this.g.length?this.g[pe]:this.h};function ie(pe){if(pe.h!=0)return!1;for(var U=0;U<pe.g.length;U++)if(pe.g[U]!=0)return!1;return!0}function se(pe){return pe.h==-1}n.l=function(pe){return pe=J(this,pe),se(pe)?-1:ie(pe)?0:1};function de(pe){for(var U=pe.g.length,F=[],q=0;q<U;q++)F[q]=~pe.g[q];return new m(F,~pe.h).add(V)}n.abs=function(){return se(this)?de(this):this},n.add=function(pe){for(var U=Math.max(this.g.length,pe.g.length),F=[],q=0,j=0;j<=U;j++){var H=q+(this.i(j)&65535)+(pe.i(j)&65535),Z=(H>>>16)+(this.i(j)>>>16)+(pe.i(j)>>>16);q=Z>>>16,H&=65535,Z&=65535,F[j]=Z<<16|H}return new m(F,F[F.length-1]&-2147483648?-1:0)};function J(pe,U){return pe.add(de(U))}n.j=function(pe){if(ie(this)||ie(pe))return M;if(se(this))return se(pe)?de(this).j(de(pe)):de(de(this).j(pe));if(se(pe))return de(this.j(de(pe)));if(0>this.l(k)&&0>pe.l(k))return b(this.m()*pe.m());for(var U=this.g.length+pe.g.length,F=[],q=0;q<2*U;q++)F[q]=0;for(q=0;q<this.g.length;q++)for(var j=0;j<pe.g.length;j++){var H=this.i(q)>>>16,Z=this.i(q)&65535,be=pe.i(j)>>>16,Re=pe.i(j)&65535;F[2*q+2*j]+=Z*Re,ne(F,2*q+2*j),F[2*q+2*j+1]+=H*Re,ne(F,2*q+2*j+1),F[2*q+2*j+1]+=Z*be,ne(F,2*q+2*j+1),F[2*q+2*j+2]+=H*be,ne(F,2*q+2*j+2)}for(q=0;q<U;q++)F[q]=F[2*q+1]<<16|F[2*q];for(q=U;q<2*U;q++)F[q]=0;return new m(F,0)};function ne(pe,U){for(;(pe[U]&65535)!=pe[U];)pe[U+1]+=pe[U]>>>16,pe[U]&=65535,U++}function me(pe,U){this.g=pe,this.h=U}function ue(pe,U){if(ie(U))throw Error("division by zero");if(ie(pe))return new me(M,M);if(se(pe))return U=ue(de(pe),U),new me(de(U.g),de(U.h));if(se(U))return U=ue(pe,de(U)),new me(de(U.g),U.h);if(30<pe.g.length){if(se(pe)||se(U))throw Error("slowDivide_ only works with positive integers.");for(var F=V,q=U;0>=q.l(pe);)F=ke(F),q=ke(q);var j=ze(F,1),H=ze(q,1);for(q=ze(q,2),F=ze(F,2);!ie(q);){var Z=H.add(q);0>=Z.l(pe)&&(j=j.add(F),H=Z),q=ze(q,1),F=ze(F,1)}return U=J(pe,j.j(U)),new me(j,U)}for(j=M;0<=pe.l(U);){for(F=Math.max(1,Math.floor(pe.m()/U.m())),q=Math.ceil(Math.log(F)/Math.LN2),q=48>=q?1:Math.pow(2,q-48),H=b(F),Z=H.j(U);se(Z)||0<Z.l(pe);)F-=q,H=b(F),Z=H.j(U);ie(H)&&(H=V),j=j.add(H),pe=J(pe,Z)}return new me(j,pe)}n.A=function(pe){return ue(this,pe).h},n.and=function(pe){for(var U=Math.max(this.g.length,pe.g.length),F=[],q=0;q<U;q++)F[q]=this.i(q)&pe.i(q);return new m(F,this.h&pe.h)},n.or=function(pe){for(var U=Math.max(this.g.length,pe.g.length),F=[],q=0;q<U;q++)F[q]=this.i(q)|pe.i(q);return new m(F,this.h|pe.h)},n.xor=function(pe){for(var U=Math.max(this.g.length,pe.g.length),F=[],q=0;q<U;q++)F[q]=this.i(q)^pe.i(q);return new m(F,this.h^pe.h)};function ke(pe){for(var U=pe.g.length+1,F=[],q=0;q<U;q++)F[q]=pe.i(q)<<1|pe.i(q-1)>>>31;return new m(F,pe.h)}function ze(pe,U){var F=U>>5;U%=32;for(var q=pe.g.length-F,j=[],H=0;H<q;H++)j[H]=0<U?pe.i(H+F)>>>U|pe.i(H+F+1)<<32-U:pe.i(H+F);return new m(j,pe.h)}i.prototype.digest=i.prototype.v,i.prototype.reset=i.prototype.s,i.prototype.update=i.prototype.u,c9=i,m.prototype.add=m.prototype.add,m.prototype.multiply=m.prototype.j,m.prototype.modulo=m.prototype.A,m.prototype.compare=m.prototype.l,m.prototype.toNumber=m.prototype.m,m.prototype.toString=m.prototype.toString,m.prototype.getBits=m.prototype.i,m.fromNumber=b,m.fromString=I,ig=m}).apply(typeof rE<"u"?rE:typeof self<"u"?self:typeof window<"u"?window:{});var b1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var u9,Ry,h9,H1,R5,d9,f9,p9;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(L,ae,ve){return L==Array.prototype||L==Object.prototype||(L[ae]=ve.value),L};function t(L){L=[typeof globalThis=="object"&&globalThis,L,typeof window=="object"&&window,typeof self=="object"&&self,typeof b1=="object"&&b1];for(var ae=0;ae<L.length;++ae){var ve=L[ae];if(ve&&ve.Math==Math)return ve}throw Error("Cannot find global object")}var i=t(this);function c(L,ae){if(ae)e:{var ve=i;L=L.split(".");for(var He=0;He<L.length-1;He++){var Kt=L[He];if(!(Kt in ve))break e;ve=ve[Kt]}L=L[L.length-1],He=ve[L],ae=ae(He),ae!=He&&ae!=null&&e(ve,L,{configurable:!0,writable:!0,value:ae})}}function u(L,ae){L instanceof String&&(L+="");var ve=0,He=!1,Kt={next:function(){if(!He&&ve<L.length){var pn=ve++;return{value:ae(pn,L[pn]),done:!1}}return He=!0,{done:!0,value:void 0}}};return Kt[Symbol.iterator]=function(){return Kt},Kt}c("Array.prototype.values",function(L){return L||function(){return u(this,function(ae,ve){return ve})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var m=m||{},_=this||self;function o(L){var ae=typeof L;return ae=ae!="object"?ae:L?Array.isArray(L)?"array":ae:"null",ae=="array"||ae=="object"&&typeof L.length=="number"}function b(L){var ae=typeof L;return ae=="object"&&L!=null||ae=="function"}function I(L,ae,ve){return L.call.apply(L.bind,arguments)}function M(L,ae,ve){if(!L)throw Error();if(2<arguments.length){var He=Array.prototype.slice.call(arguments,2);return function(){var Kt=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Kt,He),L.apply(ae,Kt)}}return function(){return L.apply(ae,arguments)}}function V(L,ae,ve){return V=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?I:M,V.apply(null,arguments)}function k(L,ae){var ve=Array.prototype.slice.call(arguments,1);return function(){var He=ve.slice();return He.push.apply(He,arguments),L.apply(this,He)}}function ie(L,ae){function ve(){}ve.prototype=ae.prototype,L.aa=ae.prototype,L.prototype=new ve,L.prototype.constructor=L,L.Qb=function(He,Kt,pn){for(var sr=Array(arguments.length-2),ho=2;ho<arguments.length;ho++)sr[ho-2]=arguments[ho];return ae.prototype[Kt].apply(He,sr)}}function se(L){const ae=L.length;if(0<ae){const ve=Array(ae);for(let He=0;He<ae;He++)ve[He]=L[He];return ve}return[]}function de(L,ae){for(let ve=1;ve<arguments.length;ve++){const He=arguments[ve];if(o(He)){const Kt=L.length||0,pn=He.length||0;L.length=Kt+pn;for(let sr=0;sr<pn;sr++)L[Kt+sr]=He[sr]}else L.push(He)}}class J{constructor(ae,ve){this.i=ae,this.j=ve,this.h=0,this.g=null}get(){let ae;return 0<this.h?(this.h--,ae=this.g,this.g=ae.next,ae.next=null):ae=this.i(),ae}}function ne(L){return/^[\s\xa0]*$/.test(L)}function me(){var L=_.navigator;return L&&(L=L.userAgent)?L:""}function ue(L){return ue[" "](L),L}ue[" "]=function(){};var ke=me().indexOf("Gecko")!=-1&&!(me().toLowerCase().indexOf("webkit")!=-1&&me().indexOf("Edge")==-1)&&!(me().indexOf("Trident")!=-1||me().indexOf("MSIE")!=-1)&&me().indexOf("Edge")==-1;function ze(L,ae,ve){for(const He in L)ae.call(ve,L[He],He,L)}function pe(L,ae){for(const ve in L)ae.call(void 0,L[ve],ve,L)}function U(L){const ae={};for(const ve in L)ae[ve]=L[ve];return ae}const F="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function q(L,ae){let ve,He;for(let Kt=1;Kt<arguments.length;Kt++){He=arguments[Kt];for(ve in He)L[ve]=He[ve];for(let pn=0;pn<F.length;pn++)ve=F[pn],Object.prototype.hasOwnProperty.call(He,ve)&&(L[ve]=He[ve])}}function j(L){var ae=1;L=L.split(":");const ve=[];for(;0<ae&&L.length;)ve.push(L.shift()),ae--;return L.length&&ve.push(L.join(":")),ve}function H(L){_.setTimeout(()=>{throw L},0)}function Z(){var L=De;let ae=null;return L.g&&(ae=L.g,L.g=L.g.next,L.g||(L.h=null),ae.next=null),ae}class be{constructor(){this.h=this.g=null}add(ae,ve){const He=Re.get();He.set(ae,ve),this.h?this.h.next=He:this.g=He,this.h=He}}var Re=new J(()=>new Oe,L=>L.reset());class Oe{constructor(){this.next=this.g=this.h=null}set(ae,ve){this.h=ae,this.g=ve,this.next=null}reset(){this.next=this.g=this.h=null}}let Me,we=!1,De=new be,tt=()=>{const L=_.Promise.resolve(void 0);Me=()=>{L.then(xe)}};var xe=()=>{for(var L;L=Z();){try{L.h.call(L.g)}catch(ve){H(ve)}var ae=Re;ae.j(L),100>ae.h&&(ae.h++,L.next=ae.g,ae.g=L)}we=!1};function le(){this.s=this.s,this.C=this.C}le.prototype.s=!1,le.prototype.ma=function(){this.s||(this.s=!0,this.N())},le.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ne(L,ae){this.type=L,this.g=this.target=ae,this.defaultPrevented=!1}Ne.prototype.h=function(){this.defaultPrevented=!0};var Be=(function(){if(!_.addEventListener||!Object.defineProperty)return!1;var L=!1,ae=Object.defineProperty({},"passive",{get:function(){L=!0}});try{const ve=()=>{};_.addEventListener("test",ve,ae),_.removeEventListener("test",ve,ae)}catch{}return L})();function Qe(L,ae){if(Ne.call(this,L?L.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,L){var ve=this.type=L.type,He=L.changedTouches&&L.changedTouches.length?L.changedTouches[0]:null;if(this.target=L.target||L.srcElement,this.g=ae,ae=L.relatedTarget){if(ke){e:{try{ue(ae.nodeName);var Kt=!0;break e}catch{}Kt=!1}Kt||(ae=null)}}else ve=="mouseover"?ae=L.fromElement:ve=="mouseout"&&(ae=L.toElement);this.relatedTarget=ae,He?(this.clientX=He.clientX!==void 0?He.clientX:He.pageX,this.clientY=He.clientY!==void 0?He.clientY:He.pageY,this.screenX=He.screenX||0,this.screenY=He.screenY||0):(this.clientX=L.clientX!==void 0?L.clientX:L.pageX,this.clientY=L.clientY!==void 0?L.clientY:L.pageY,this.screenX=L.screenX||0,this.screenY=L.screenY||0),this.button=L.button,this.key=L.key||"",this.ctrlKey=L.ctrlKey,this.altKey=L.altKey,this.shiftKey=L.shiftKey,this.metaKey=L.metaKey,this.pointerId=L.pointerId||0,this.pointerType=typeof L.pointerType=="string"?L.pointerType:rt[L.pointerType]||"",this.state=L.state,this.i=L,L.defaultPrevented&&Qe.aa.h.call(this)}}ie(Qe,Ne);var rt={2:"touch",3:"pen",4:"mouse"};Qe.prototype.h=function(){Qe.aa.h.call(this);var L=this.i;L.preventDefault?L.preventDefault():L.returnValue=!1};var gt="closure_listenable_"+(1e6*Math.random()|0),pt=0;function Mt(L,ae,ve,He,Kt){this.listener=L,this.proxy=null,this.src=ae,this.type=ve,this.capture=!!He,this.ha=Kt,this.key=++pt,this.da=this.fa=!1}function Jt(L){L.da=!0,L.listener=null,L.proxy=null,L.src=null,L.ha=null}function hn(L){this.src=L,this.g={},this.h=0}hn.prototype.add=function(L,ae,ve,He,Kt){var pn=L.toString();L=this.g[pn],L||(L=this.g[pn]=[],this.h++);var sr=Mn(L,ae,He,Kt);return-1<sr?(ae=L[sr],ve||(ae.fa=!1)):(ae=new Mt(ae,this.src,pn,!!He,Kt),ae.fa=ve,L.push(ae)),ae};function yn(L,ae){var ve=ae.type;if(ve in L.g){var He=L.g[ve],Kt=Array.prototype.indexOf.call(He,ae,void 0),pn;(pn=0<=Kt)&&Array.prototype.splice.call(He,Kt,1),pn&&(Jt(ae),L.g[ve].length==0&&(delete L.g[ve],L.h--))}}function Mn(L,ae,ve,He){for(var Kt=0;Kt<L.length;++Kt){var pn=L[Kt];if(!pn.da&&pn.listener==ae&&pn.capture==!!ve&&pn.ha==He)return Kt}return-1}var Gt="closure_lm_"+(1e6*Math.random()|0),ot={};function dr(L,ae,ve,He,Kt){if(Array.isArray(ae)){for(var pn=0;pn<ae.length;pn++)dr(L,ae[pn],ve,He,Kt);return null}return ve=Hn(ve),L&&L[gt]?L.K(ae,ve,b(He)?!!He.capture:!1,Kt):wr(L,ae,ve,!1,He,Kt)}function wr(L,ae,ve,He,Kt,pn){if(!ae)throw Error("Invalid event type");var sr=b(Kt)?!!Kt.capture:!!Kt,ho=qt(L);if(ho||(L[Gt]=ho=new hn(L)),ve=ho.add(ae,ve,He,sr,pn),ve.proxy)return ve;if(He=Cr(),ve.proxy=He,He.src=L,He.listener=ve,L.addEventListener)Be||(Kt=sr),Kt===void 0&&(Kt=!1),L.addEventListener(ae.toString(),He,Kt);else if(L.attachEvent)L.attachEvent(Qn(ae.toString()),He);else if(L.addListener&&L.removeListener)L.addListener(He);else throw Error("addEventListener and attachEvent are unavailable.");return ve}function Cr(){function L(ve){return ae.call(L.src,L.listener,ve)}const ae=Kr;return L}function Ln(L,ae,ve,He,Kt){if(Array.isArray(ae))for(var pn=0;pn<ae.length;pn++)Ln(L,ae[pn],ve,He,Kt);else He=b(He)?!!He.capture:!!He,ve=Hn(ve),L&&L[gt]?(L=L.i,ae=String(ae).toString(),ae in L.g&&(pn=L.g[ae],ve=Mn(pn,ve,He,Kt),-1<ve&&(Jt(pn[ve]),Array.prototype.splice.call(pn,ve,1),pn.length==0&&(delete L.g[ae],L.h--)))):L&&(L=qt(L))&&(ae=L.g[ae.toString()],L=-1,ae&&(L=Mn(ae,ve,He,Kt)),(ve=-1<L?ae[L]:null)&&ir(ve))}function ir(L){if(typeof L!="number"&&L&&!L.da){var ae=L.src;if(ae&&ae[gt])yn(ae.i,L);else{var ve=L.type,He=L.proxy;ae.removeEventListener?ae.removeEventListener(ve,He,L.capture):ae.detachEvent?ae.detachEvent(Qn(ve),He):ae.addListener&&ae.removeListener&&ae.removeListener(He),(ve=qt(ae))?(yn(ve,L),ve.h==0&&(ve.src=null,ae[Gt]=null)):Jt(L)}}}function Qn(L){return L in ot?ot[L]:ot[L]="on"+L}function Kr(L,ae){if(L.da)L=!0;else{ae=new Qe(ae,this);var ve=L.listener,He=L.ha||L.src;L.fa&&ir(L),L=ve.call(He,ae)}return L}function qt(L){return L=L[Gt],L instanceof hn?L:null}var Pn="__closure_events_fn_"+(1e9*Math.random()>>>0);function Hn(L){return typeof L=="function"?L:(L[Pn]||(L[Pn]=function(ae){return L.handleEvent(ae)}),L[Pn])}function Bn(){le.call(this),this.i=new hn(this),this.M=this,this.F=null}ie(Bn,le),Bn.prototype[gt]=!0,Bn.prototype.removeEventListener=function(L,ae,ve,He){Ln(this,L,ae,ve,He)};function Rr(L,ae){var ve,He=L.F;if(He)for(ve=[];He;He=He.F)ve.push(He);if(L=L.M,He=ae.type||ae,typeof ae=="string")ae=new Ne(ae,L);else if(ae instanceof Ne)ae.target=ae.target||L;else{var Kt=ae;ae=new Ne(He,L),q(ae,Kt)}if(Kt=!0,ve)for(var pn=ve.length-1;0<=pn;pn--){var sr=ae.g=ve[pn];Kt=vr(sr,He,!0,ae)&&Kt}if(sr=ae.g=L,Kt=vr(sr,He,!0,ae)&&Kt,Kt=vr(sr,He,!1,ae)&&Kt,ve)for(pn=0;pn<ve.length;pn++)sr=ae.g=ve[pn],Kt=vr(sr,He,!1,ae)&&Kt}Bn.prototype.N=function(){if(Bn.aa.N.call(this),this.i){var L=this.i,ae;for(ae in L.g){for(var ve=L.g[ae],He=0;He<ve.length;He++)Jt(ve[He]);delete L.g[ae],L.h--}}this.F=null},Bn.prototype.K=function(L,ae,ve,He){return this.i.add(String(L),ae,!1,ve,He)},Bn.prototype.L=function(L,ae,ve,He){return this.i.add(String(L),ae,!0,ve,He)};function vr(L,ae,ve,He){if(ae=L.i.g[String(ae)],!ae)return!0;ae=ae.concat();for(var Kt=!0,pn=0;pn<ae.length;++pn){var sr=ae[pn];if(sr&&!sr.da&&sr.capture==ve){var ho=sr.listener,Fo=sr.ha||sr.src;sr.fa&&yn(L.i,sr),Kt=ho.call(Fo,He)!==!1&&Kt}}return Kt&&!He.defaultPrevented}function Tr(L,ae,ve){if(typeof L=="function")ve&&(L=V(L,ve));else if(L&&typeof L.handleEvent=="function")L=V(L.handleEvent,L);else throw Error("Invalid listener argument");return 2147483647<Number(ae)?-1:_.setTimeout(L,ae||0)}function Ir(L){L.g=Tr(()=>{L.g=null,L.i&&(L.i=!1,Ir(L))},L.l);const ae=L.h;L.h=null,L.m.apply(null,ae)}class Pr extends le{constructor(ae,ve){super(),this.m=ae,this.l=ve,this.h=null,this.i=!1,this.g=null}j(ae){this.h=arguments,this.g?this.i=!0:Ir(this)}N(){super.N(),this.g&&(_.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Si(L){le.call(this),this.h=L,this.g={}}ie(Si,le);var ki=[];function or(L){ze(L.g,function(ae,ve){this.g.hasOwnProperty(ve)&&ir(ae)},L),L.g={}}Si.prototype.N=function(){Si.aa.N.call(this),or(this)},Si.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var oi=_.JSON.stringify,Gr=_.JSON.parse,Or=class{stringify(L){return _.JSON.stringify(L,void 0)}parse(L){return _.JSON.parse(L,void 0)}};function hi(){}hi.prototype.h=null;function si(L){return L.h||(L.h=L.i())}function lt(){}var Ee={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Te(){Ne.call(this,"d")}ie(Te,Ne);function et(){Ne.call(this,"c")}ie(et,Ne);var ht={},Lt=null;function Rt(){return Lt=Lt||new Bn}ht.La="serverreachability";function Ot(L){Ne.call(this,ht.La,L)}ie(Ot,Ne);function At(L){const ae=Rt();Rr(ae,new Ot(ae))}ht.STAT_EVENT="statevent";function Pt(L,ae){Ne.call(this,ht.STAT_EVENT,L),this.stat=ae}ie(Pt,Ne);function xn(L){const ae=Rt();Rr(ae,new Pt(ae,L))}ht.Ma="timingevent";function Un(L,ae){Ne.call(this,ht.Ma,L),this.size=ae}ie(Un,Ne);function In(L,ae){if(typeof L!="function")throw Error("Fn must not be null and must be a function");return _.setTimeout(function(){L()},ae)}function kr(){this.g=!0}kr.prototype.xa=function(){this.g=!1};function Lr(L,ae,ve,He,Kt,pn){L.info(function(){if(L.g)if(pn)for(var sr="",ho=pn.split("&"),Fo=0;Fo<ho.length;Fo++){var Wi=ho[Fo].split("=");if(1<Wi.length){var Oi=Wi[0];Wi=Wi[1];var No=Oi.split("_");sr=2<=No.length&&No[1]=="type"?sr+(Oi+"="+Wi+"&"):sr+(Oi+"=redacted&")}}else sr=null;else sr=pn;return"XMLHTTP REQ ("+He+") [attempt "+Kt+"]: "+ae+`
`+ve+`
`+sr})}function jr(L,ae,ve,He,Kt,pn,sr){L.info(function(){return"XMLHTTP RESP ("+He+") [ attempt "+Kt+"]: "+ae+`
`+ve+`
`+pn+" "+sr})}function Er(L,ae,ve,He){L.info(function(){return"XMLHTTP TEXT ("+ae+"): "+oo(L,ve)+(He?" "+He:"")})}function Ei(L,ae){L.info(function(){return"TIMEOUT: "+ae})}kr.prototype.info=function(){};function oo(L,ae){if(!L.g)return ae;if(!ae)return null;try{var ve=JSON.parse(ae);if(ve){for(L=0;L<ve.length;L++)if(Array.isArray(ve[L])){var He=ve[L];if(!(2>He.length)){var Kt=He[1];if(Array.isArray(Kt)&&!(1>Kt.length)){var pn=Kt[0];if(pn!="noop"&&pn!="stop"&&pn!="close")for(var sr=1;sr<Kt.length;sr++)Kt[sr]=""}}}}return oi(ve)}catch{return ae}}var _o={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Ho={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},so;function _s(){}ie(_s,hi),_s.prototype.g=function(){return new XMLHttpRequest},_s.prototype.i=function(){return{}},so=new _s;function ao(L,ae,ve,He){this.j=L,this.i=ae,this.l=ve,this.R=He||1,this.U=new Si(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Cs}function Cs(){this.i=null,this.g="",this.h=!1}var ma={},bl={};function ll(L,ae,ve){L.L=1,L.v=wl(Mr(ae)),L.m=ve,L.P=!0,Hi(L,null)}function Hi(L,ae){L.F=Date.now(),To(L),L.A=Mr(L.v);var ve=L.A,He=L.R;Array.isArray(He)||(He=[String(He)]),ai(ve.i,"t",He),L.C=0,ve=L.j.J,L.h=new Cs,L.g=zo(L.j,ve?ae:null,!L.m),0<L.O&&(L.M=new Pr(V(L.Y,L,L.g),L.O)),ae=L.U,ve=L.g,He=L.ca;var Kt="readystatechange";Array.isArray(Kt)||(Kt&&(ki[0]=Kt.toString()),Kt=ki);for(var pn=0;pn<Kt.length;pn++){var sr=dr(ve,Kt[pn],He||ae.handleEvent,!1,ae.h||ae);if(!sr)break;ae.g[sr.key]=sr}ae=L.H?U(L.H):{},L.m?(L.u||(L.u="POST"),ae["Content-Type"]="application/x-www-form-urlencoded",L.g.ea(L.A,L.u,L.m,ae)):(L.u="GET",L.g.ea(L.A,L.u,null,ae)),At(),Lr(L.i,L.u,L.A,L.l,L.R,L.m)}ao.prototype.ca=function(L){L=L.target;const ae=this.M;ae&&Ss(L)==3?ae.j():this.Y(L)},ao.prototype.Y=function(L){try{if(L==this.g)e:{const No=Ss(this.g);var ae=this.g.Ba();const sa=this.g.Z();if(!(3>No)&&(No!=3||this.g&&(this.h.h||this.g.oa()||$s(this.g)))){this.J||No!=4||ae==7||(ae==8||0>=sa?At(3):At(2)),wa(this);var ve=this.g.Z();this.X=ve;t:if(nc(this)){var He=$s(this.g);L="";var Kt=He.length,pn=Ss(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Ha(this),Zo(this);var sr="";break t}this.h.i=new _.TextDecoder}for(ae=0;ae<Kt;ae++)this.h.h=!0,L+=this.h.i.decode(He[ae],{stream:!(pn&&ae==Kt-1)});He.length=0,this.h.g+=L,this.C=0,sr=this.h.g}else sr=this.g.oa();if(this.o=ve==200,jr(this.i,this.u,this.A,this.l,this.R,No,ve),this.o){if(this.T&&!this.K){t:{if(this.g){var ho,Fo=this.g;if((ho=Fo.g?Fo.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!ne(ho)){var Wi=ho;break t}}Wi=null}if(ve=Wi)Er(this.i,this.l,ve,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Bl(this,ve);else{this.o=!1,this.s=3,xn(12),Ha(this),Zo(this);break e}}if(this.P){ve=!0;let Oo;for(;!this.J&&this.C<sr.length;)if(Oo=Lu(this,sr),Oo==bl){No==4&&(this.s=4,xn(14),ve=!1),Er(this.i,this.l,null,"[Incomplete Response]");break}else if(Oo==ma){this.s=4,xn(15),Er(this.i,this.l,sr,"[Invalid Chunk]"),ve=!1;break}else Er(this.i,this.l,Oo,null),Bl(this,Oo);if(nc(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),No!=4||sr.length!=0||this.h.h||(this.s=1,xn(16),ve=!1),this.o=this.o&&ve,!ve)Er(this.i,this.l,sr,"[Invalid Chunked Response]"),Ha(this),Zo(this);else if(0<sr.length&&!this.W){this.W=!0;var Oi=this.j;Oi.g==this&&Oi.ba&&!Oi.M&&(Oi.j.info("Great, no buffering proxy detected. Bytes received: "+sr.length),Nr(Oi),Oi.M=!0,xn(11))}}else Er(this.i,this.l,sr,null),Bl(this,sr);No==4&&Ha(this),this.o&&!this.J&&(No==4?Ti(this.j,this):(this.o=!1,To(this)))}else ia(this.g),ve==400&&0<sr.indexOf("Unknown SID")?(this.s=3,xn(12)):(this.s=0,xn(13)),Ha(this),Zo(this)}}}catch{}finally{}};function nc(L){return L.g?L.u=="GET"&&L.L!=2&&L.j.Ca:!1}function Lu(L,ae){var ve=L.C,He=ae.indexOf(`
`,ve);return He==-1?bl:(ve=Number(ae.substring(ve,He)),isNaN(ve)?ma:(He+=1,He+ve>ae.length?bl:(ae=ae.slice(He,He+ve),L.C=He+ve,ae)))}ao.prototype.cancel=function(){this.J=!0,Ha(this)};function To(L){L.S=Date.now()+L.I,fu(L,L.I)}function fu(L,ae){if(L.B!=null)throw Error("WatchDog timer not null");L.B=In(V(L.ba,L),ae)}function wa(L){L.B&&(_.clearTimeout(L.B),L.B=null)}ao.prototype.ba=function(){this.B=null;const L=Date.now();0<=L-this.S?(Ei(this.i,this.A),this.L!=2&&(At(),xn(17)),Ha(this),this.s=2,Zo(this)):fu(this,this.S-L)};function Zo(L){L.j.G==0||L.J||Ti(L.j,L)}function Ha(L){wa(L);var ae=L.M;ae&&typeof ae.ma=="function"&&ae.ma(),L.M=null,or(L.U),L.g&&(ae=L.g,L.g=null,ae.abort(),ae.ma())}function Bl(L,ae){try{var ve=L.j;if(ve.G!=0&&(ve.g==L||Yo(ve.h,L))){if(!L.K&&Yo(ve.h,L)&&ve.G==3){try{var He=ve.Da.g.parse(ae)}catch{He=null}if(Array.isArray(He)&&He.length==3){var Kt=He;if(Kt[0]==0){e:if(!ve.u){if(ve.g)if(ve.g.F+3e3<L.F)gi(ve),Hs(ve);else break e;zn(ve),xn(18)}}else ve.za=Kt[1],0<ve.za-ve.T&&37500>Kt[2]&&ve.F&&ve.v==0&&!ve.C&&(ve.C=In(V(ve.Za,ve),6e3));if(1>=mn(ve.h)&&ve.ca){try{ve.ca()}catch{}ve.ca=void 0}}else wo(ve,11)}else if((L.K||ve.g==L)&&gi(ve),!ne(ae))for(Kt=ve.Da.g.parse(ae),ae=0;ae<Kt.length;ae++){let Wi=Kt[ae];if(ve.T=Wi[0],Wi=Wi[1],ve.G==2)if(Wi[0]=="c"){ve.K=Wi[1],ve.ia=Wi[2];const Oi=Wi[3];Oi!=null&&(ve.la=Oi,ve.j.info("VER="+ve.la));const No=Wi[4];No!=null&&(ve.Aa=No,ve.j.info("SVER="+ve.Aa));const sa=Wi[5];sa!=null&&typeof sa=="number"&&0<sa&&(He=1.5*sa,ve.L=He,ve.j.info("backChannelRequestTimeoutMs_="+He)),He=ve;const Oo=L.g;if(Oo){const $i=Oo.g?Oo.g.getResponseHeader("X-Client-Wire-Protocol"):null;if($i){var pn=He.h;pn.g||$i.indexOf("spdy")==-1&&$i.indexOf("quic")==-1&&$i.indexOf("h2")==-1||(pn.j=pn.l,pn.g=new Set,pn.h&&(ss(pn,pn.h),pn.h=null))}if(He.D){const jl=Oo.g?Oo.g.getResponseHeader("X-HTTP-Session-Id"):null;jl&&(He.ya=jl,Mi(He.I,He.D,jl))}}ve.G=3,ve.l&&ve.l.ua(),ve.ba&&(ve.R=Date.now()-L.F,ve.j.info("Handshake RTT: "+ve.R+"ms")),He=ve;var sr=L;if(He.qa=Mo(He,He.J?He.ia:null,He.W),sr.K){_i(He.h,sr);var ho=sr,Fo=He.L;Fo&&(ho.I=Fo),ho.B&&(wa(ho),To(ho)),He.g=sr}else Zt(He);0<ve.i.length&&W(ve)}else Wi[0]!="stop"&&Wi[0]!="close"||wo(ve,7);else ve.G==3&&(Wi[0]=="stop"||Wi[0]=="close"?Wi[0]=="stop"?wo(ve,7):Gs(ve):Wi[0]!="noop"&&ve.l&&ve.l.ta(Wi),ve.v=0)}}At(4)}catch{}}var rc=class{constructor(L,ae){this.g=L,this.map=ae}};function Sa(L){this.l=L||10,_.PerformanceNavigationTiming?(L=_.performance.getEntriesByType("navigation"),L=0<L.length&&(L[0].nextHopProtocol=="hq"||L[0].nextHopProtocol=="h2")):L=!!(_.chrome&&_.chrome.loadTimes&&_.chrome.loadTimes()&&_.chrome.loadTimes().wasFetchedViaSpdy),this.j=L?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ra(L){return L.h?!0:L.g?L.g.size>=L.j:!1}function mn(L){return L.h?1:L.g?L.g.size:0}function Yo(L,ae){return L.h?L.h==ae:L.g?L.g.has(ae):!1}function ss(L,ae){L.g?L.g.add(ae):L.h=ae}function _i(L,ae){L.h&&L.h==ae?L.h=null:L.g&&L.g.has(ae)&&L.g.delete(ae)}Sa.prototype.cancel=function(){if(this.i=pu(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const L of this.g.values())L.cancel();this.g.clear()}};function pu(L){if(L.h!=null)return L.i.concat(L.h.D);if(L.g!=null&&L.g.size!==0){let ae=L.i;for(const ve of L.g.values())ae=ae.concat(ve.D);return ae}return se(L.i)}function Wa(L){if(L.V&&typeof L.V=="function")return L.V();if(typeof Map<"u"&&L instanceof Map||typeof Set<"u"&&L instanceof Set)return Array.from(L.values());if(typeof L=="string")return L.split("");if(o(L)){for(var ae=[],ve=L.length,He=0;He<ve;He++)ae.push(L[He]);return ae}ae=[],ve=0;for(He in L)ae[ve++]=L[He];return ae}function Ka(L){if(L.na&&typeof L.na=="function")return L.na();if(!L.V||typeof L.V!="function"){if(typeof Map<"u"&&L instanceof Map)return Array.from(L.keys());if(!(typeof Set<"u"&&L instanceof Set)){if(o(L)||typeof L=="string"){var ae=[];L=L.length;for(var ve=0;ve<L;ve++)ae.push(ve);return ae}ae=[],ve=0;for(const He in L)ae[ve++]=He;return ae}}}function cl(L,ae){if(L.forEach&&typeof L.forEach=="function")L.forEach(ae,void 0);else if(o(L)||typeof L=="string")Array.prototype.forEach.call(L,ae,void 0);else for(var ve=Ka(L),He=Wa(L),Kt=He.length,pn=0;pn<Kt;pn++)ae.call(void 0,He[pn],ve&&ve[pn],L)}var Ls=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function er(L,ae){if(L){L=L.split("&");for(var ve=0;ve<L.length;ve++){var He=L[ve].indexOf("="),Kt=null;if(0<=He){var pn=L[ve].substring(0,He);Kt=L[ve].substring(He+1)}else pn=L[ve];ae(pn,Kt?decodeURIComponent(Kt.replace(/\+/g," ")):"")}}}function Br(L){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,L instanceof Br){this.h=L.h,js(this,L.j),this.o=L.o,this.g=L.g,Ea(this,L.s),this.l=L.l;var ae=L.i,ve=new Ma;ve.i=ae.i,ae.g&&(ve.g=new Map(ae.g),ve.h=ae.h),vi(this,ve),this.m=L.m}else L&&(ae=String(L).match(Ls))?(this.h=!1,js(this,ae[1]||"",!0),this.o=qi(ae[2]||""),this.g=qi(ae[3]||"",!0),Ea(this,ae[4]),this.l=qi(ae[5]||"",!0),vi(this,ae[6]||"",!0),this.m=qi(ae[7]||"")):(this.h=!1,this.i=new Ma(null,this.h))}Br.prototype.toString=function(){var L=[],ae=this.j;ae&&L.push(fs(ae,mu,!0),":");var ve=this.g;return(ve||ae=="file")&&(L.push("//"),(ae=this.o)&&L.push(fs(ae,mu,!0),"@"),L.push(encodeURIComponent(String(ve)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),ve=this.s,ve!=null&&L.push(":",String(ve))),(ve=this.l)&&(this.g&&ve.charAt(0)!="/"&&L.push("/"),L.push(fs(ve,ve.charAt(0)=="/"?Jc:ic,!0))),(ve=this.i.toString())&&L.push("?",ve),(ve=this.m)&&L.push("#",fs(ve,oc)),L.join("")};function Mr(L){return new Br(L)}function js(L,ae,ve){L.j=ve?qi(ae,!0):ae,L.j&&(L.j=L.j.replace(/:$/,""))}function Ea(L,ae){if(ae){if(ae=Number(ae),isNaN(ae)||0>ae)throw Error("Bad port number "+ae);L.s=ae}else L.s=null}function vi(L,ae,ve){ae instanceof Ma?(L.i=ae,Io(L.i,L.h)):(ve||(ae=fs(ae,yc)),L.i=new Ma(ae,L.h))}function Mi(L,ae,ve){L.i.set(ae,ve)}function wl(L){return Mi(L,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),L}function qi(L,ae){return L?ae?decodeURI(L.replace(/%25/g,"%2525")):decodeURIComponent(L):""}function fs(L,ae,ve){return typeof L=="string"?(L=encodeURI(L).replace(ae,zi),ve&&(L=L.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),L):null}function zi(L){return L=L.charCodeAt(0),"%"+(L>>4&15).toString(16)+(L&15).toString(16)}var mu=/[#\/\?@]/g,ic=/[#\?:]/g,Jc=/[#\?]/g,yc=/[#\?@]/g,oc=/#/g;function Ma(L,ae){this.h=this.g=null,this.i=L||null,this.j=!!ae}function Ps(L){L.g||(L.g=new Map,L.h=0,L.i&&er(L.i,function(ae,ve){L.add(decodeURIComponent(ae.replace(/\+/g," ")),ve)}))}n=Ma.prototype,n.add=function(L,ae){Ps(this),this.i=null,L=Jo(this,L);var ve=this.g.get(L);return ve||this.g.set(L,ve=[]),ve.push(ae),this.h+=1,this};function ji(L,ae){Ps(L),ae=Jo(L,ae),L.g.has(ae)&&(L.i=null,L.h-=L.g.get(ae).length,L.g.delete(ae))}function Na(L,ae){return Ps(L),ae=Jo(L,ae),L.g.has(ae)}n.forEach=function(L,ae){Ps(this),this.g.forEach(function(ve,He){ve.forEach(function(Kt){L.call(ae,Kt,He,this)},this)},this)},n.na=function(){Ps(this);const L=Array.from(this.g.values()),ae=Array.from(this.g.keys()),ve=[];for(let He=0;He<ae.length;He++){const Kt=L[He];for(let pn=0;pn<Kt.length;pn++)ve.push(ae[He])}return ve},n.V=function(L){Ps(this);let ae=[];if(typeof L=="string")Na(this,L)&&(ae=ae.concat(this.g.get(Jo(this,L))));else{L=Array.from(this.g.values());for(let ve=0;ve<L.length;ve++)ae=ae.concat(L[ve])}return ae},n.set=function(L,ae){return Ps(this),this.i=null,L=Jo(this,L),Na(this,L)&&(this.h-=this.g.get(L).length),this.g.set(L,[ae]),this.h+=1,this},n.get=function(L,ae){return L?(L=this.V(L),0<L.length?String(L[0]):ae):ae};function ai(L,ae,ve){ji(L,ae),0<ve.length&&(L.i=null,L.g.set(Jo(L,ae),se(ve)),L.h+=ve.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const L=[],ae=Array.from(this.g.keys());for(var ve=0;ve<ae.length;ve++){var He=ae[ve];const pn=encodeURIComponent(String(He)),sr=this.V(He);for(He=0;He<sr.length;He++){var Kt=pn;sr[He]!==""&&(Kt+="="+encodeURIComponent(String(sr[He]))),L.push(Kt)}}return this.i=L.join("&")};function Jo(L,ae){return ae=String(ae),L.j&&(ae=ae.toLowerCase()),ae}function Io(L,ae){ae&&!L.j&&(Ps(L),L.i=null,L.g.forEach(function(ve,He){var Kt=He.toLowerCase();He!=Kt&&(ji(this,He),ai(this,Kt,ve))},L)),L.j=ae}function vh(L,ae){const ve=new kr;if(_.Image){const He=new Image;He.onload=k(vo,ve,"TestLoadImage: loaded",!0,ae,He),He.onerror=k(vo,ve,"TestLoadImage: error",!1,ae,He),He.onabort=k(vo,ve,"TestLoadImage: abort",!1,ae,He),He.ontimeout=k(vo,ve,"TestLoadImage: timeout",!1,ae,He),_.setTimeout(function(){He.ontimeout&&He.ontimeout()},1e4),He.src=L}else ae(!1)}function Pu(L,ae){const ve=new kr,He=new AbortController,Kt=setTimeout(()=>{He.abort(),vo(ve,"TestPingServer: timeout",!1,ae)},1e4);fetch(L,{signal:He.signal}).then(pn=>{clearTimeout(Kt),pn.ok?vo(ve,"TestPingServer: ok",!0,ae):vo(ve,"TestPingServer: server error",!1,ae)}).catch(()=>{clearTimeout(Kt),vo(ve,"TestPingServer: error",!1,ae)})}function vo(L,ae,ve,He,Kt){try{Kt&&(Kt.onload=null,Kt.onerror=null,Kt.onabort=null,Kt.ontimeout=null),He(ve)}catch{}}function Us(){this.g=new Or}function ku(L,ae,ve){const He=ve||"";try{cl(L,function(Kt,pn){let sr=Kt;b(Kt)&&(sr=oi(Kt)),ae.push(He+pn+"="+encodeURIComponent(sr))})}catch(Kt){throw ae.push(He+"type="+encodeURIComponent("_badmap")),Kt}}function Wo(L){this.l=L.Ub||null,this.j=L.eb||!1}ie(Wo,hi),Wo.prototype.g=function(){return new xo(this.l,this.j)},Wo.prototype.i=(function(L){return function(){return L}})({});function xo(L,ae){Bn.call(this),this.D=L,this.o=ae,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}ie(xo,Bn),n=xo.prototype,n.open=function(L,ae){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=L,this.A=ae,this.readyState=1,Vs(this)},n.send=function(L){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const ae={headers:this.u,method:this.B,credentials:this.m,cache:void 0};L&&(ae.body=L),(this.D||_).fetch(new Request(this.A,ae)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Da(this)),this.readyState=0},n.Sa=function(L){if(this.g&&(this.l=L,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=L.headers,this.readyState=2,Vs(this)),this.g&&(this.readyState=3,Vs(this),this.g)))if(this.responseType==="arraybuffer")L.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof _.ReadableStream<"u"&&"body"in L){if(this.j=L.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;zl(this)}else L.text().then(this.Ra.bind(this),this.ga.bind(this))};function zl(L){L.j.read().then(L.Pa.bind(L)).catch(L.ga.bind(L))}n.Pa=function(L){if(this.g){if(this.o&&L.value)this.response.push(L.value);else if(!this.o){var ae=L.value?L.value:new Uint8Array(0);(ae=this.v.decode(ae,{stream:!L.done}))&&(this.response=this.responseText+=ae)}L.done?Da(this):Vs(this),this.readyState==3&&zl(this)}},n.Ra=function(L){this.g&&(this.response=this.responseText=L,Da(this))},n.Qa=function(L){this.g&&(this.response=L,Da(this))},n.ga=function(){this.g&&Da(this)};function Da(L){L.readyState=4,L.l=null,L.j=null,L.v=null,Vs(L)}n.setRequestHeader=function(L,ae){this.u.append(L,ae)},n.getResponseHeader=function(L){return this.h&&this.h.get(L.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const L=[],ae=this.h.entries();for(var ve=ae.next();!ve.done;)ve=ve.value,L.push(ve[0]+": "+ve[1]),ve=ae.next();return L.join(`\r
`)};function Vs(L){L.onreadystatechange&&L.onreadystatechange.call(L)}Object.defineProperty(xo.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(L){this.m=L?"include":"same-origin"}});function Bo(L){let ae="";return ze(L,function(ve,He){ae+=He,ae+=":",ae+=ve,ae+=`\r
`}),ae}function Dc(L,ae,ve){e:{for(He in ve){var He=!1;break e}He=!0}He||(ve=Bo(ve),typeof L=="string"?ve!=null&&encodeURIComponent(String(ve)):Mi(L,ae,ve))}function Ko(L){Bn.call(this),this.headers=new Map,this.o=L||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}ie(Ko,Bn);var ga=/^https?$/i,Xa=["POST","PUT"];n=Ko.prototype,n.Ha=function(L){this.J=L},n.ea=function(L,ae,ve,He){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+L);ae=ae?ae.toUpperCase():"GET",this.D=L,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():so.g(),this.v=this.o?si(this.o):si(so),this.g.onreadystatechange=V(this.Ea,this);try{this.B=!0,this.g.open(ae,String(L),!0),this.B=!1}catch(pn){ul(this,pn);return}if(L=ve||"",ve=new Map(this.headers),He)if(Object.getPrototypeOf(He)===Object.prototype)for(var Kt in He)ve.set(Kt,He[Kt]);else if(typeof He.keys=="function"&&typeof He.get=="function")for(const pn of He.keys())ve.set(pn,He.get(pn));else throw Error("Unknown input type for opt_headers: "+String(He));He=Array.from(ve.keys()).find(pn=>pn.toLowerCase()=="content-type"),Kt=_.FormData&&L instanceof _.FormData,!(0<=Array.prototype.indexOf.call(Xa,ae,void 0))||He||Kt||ve.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[pn,sr]of ve)this.g.setRequestHeader(pn,sr);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Ai(this),this.u=!0,this.g.send(L),this.u=!1}catch(pn){ul(this,pn)}};function ul(L,ae){L.h=!1,L.g&&(L.j=!0,L.g.abort(),L.j=!1),L.l=ae,L.m=5,Qc(L),qs(L)}function Qc(L){L.A||(L.A=!0,Rr(L,"complete"),Rr(L,"error"))}n.abort=function(L){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=L||7,Rr(this,"complete"),Rr(this,"abort"),qs(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),qs(this,!0)),Ko.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?_c(this):this.bb())},n.bb=function(){_c(this)};function _c(L){if(L.h&&typeof m<"u"&&(!L.v[1]||Ss(L)!=4||L.Z()!=2)){if(L.u&&Ss(L)==4)Tr(L.Ea,0,L);else if(Rr(L,"readystatechange"),Ss(L)==4){L.h=!1;try{const sr=L.Z();e:switch(sr){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var ae=!0;break e;default:ae=!1}var ve;if(!(ve=ae)){var He;if(He=sr===0){var Kt=String(L.D).match(Ls)[1]||null;!Kt&&_.self&&_.self.location&&(Kt=_.self.location.protocol.slice(0,-1)),He=!ga.test(Kt?Kt.toLowerCase():"")}ve=He}if(ve)Rr(L,"complete"),Rr(L,"success");else{L.m=6;try{var pn=2<Ss(L)?L.g.statusText:""}catch{pn=""}L.l=pn+" ["+L.Z()+"]",Qc(L)}}finally{qs(L)}}}}function qs(L,ae){if(L.g){Ai(L);const ve=L.g,He=L.v[0]?()=>{}:null;L.g=null,L.v=null,ae||Rr(L,"ready");try{ve.onreadystatechange=He}catch{}}}function Ai(L){L.I&&(_.clearTimeout(L.I),L.I=null)}n.isActive=function(){return!!this.g};function Ss(L){return L.g?L.g.readyState:0}n.Z=function(){try{return 2<Ss(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(L){if(this.g){var ae=this.g.responseText;return L&&ae.indexOf(L)==0&&(ae=ae.substring(L.length)),Gr(ae)}};function $s(L){try{if(!L.g)return null;if("response"in L.g)return L.g.response;switch(L.H){case"":case"text":return L.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in L.g)return L.g.mozResponseArrayBuffer}return null}catch{return null}}function ia(L){const ae={};L=(L.g&&2<=Ss(L)&&L.g.getAllResponseHeaders()||"").split(`\r
`);for(let He=0;He<L.length;He++){if(ne(L[He]))continue;var ve=j(L[He]);const Kt=ve[0];if(ve=ve[1],typeof ve!="string")continue;ve=ve.trim();const pn=ae[Kt]||[];ae[Kt]=pn,pn.push(ve)}pe(ae,function(He){return He.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function oa(L,ae,ve){return ve&&ve.internalChannelParams&&ve.internalChannelParams[L]||ae}function hl(L){this.Aa=0,this.i=[],this.j=new kr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=oa("failFast",!1,L),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=oa("baseRetryDelayMs",5e3,L),this.cb=oa("retryDelaySeedMs",1e4,L),this.Wa=oa("forwardChannelMaxRetries",2,L),this.wa=oa("forwardChannelRequestTimeoutMs",2e4,L),this.pa=L&&L.xmlHttpFactory||void 0,this.Xa=L&&L.Tb||void 0,this.Ca=L&&L.useFetchStreams||!1,this.L=void 0,this.J=L&&L.supportsCrossDomainXhr||!1,this.K="",this.h=new Sa(L&&L.concurrentRequestLimit),this.Da=new Us,this.P=L&&L.fastHandshake||!1,this.O=L&&L.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=L&&L.Rb||!1,L&&L.xa&&this.j.xa(),L&&L.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&L&&L.detectBufferingProxy||!1,this.ja=void 0,L&&L.longPollingTimeout&&0<L.longPollingTimeout&&(this.ja=L.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=hl.prototype,n.la=8,n.G=1,n.connect=function(L,ae,ve,He){xn(0),this.W=L,this.H=ae||{},ve&&He!==void 0&&(this.H.OSID=ve,this.H.OAID=He),this.F=this.X,this.I=Mo(this,null,this.W),W(this)};function Gs(L){if(vc(L),L.G==3){var ae=L.U++,ve=Mr(L.I);if(Mi(ve,"SID",L.K),Mi(ve,"RID",ae),Mi(ve,"TYPE","terminate"),yt(L,ve),ae=new ao(L,L.j,ae),ae.L=2,ae.v=wl(Mr(ve)),ve=!1,_.navigator&&_.navigator.sendBeacon)try{ve=_.navigator.sendBeacon(ae.v.toString(),"")}catch{}!ve&&_.Image&&(new Image().src=ae.v,ve=!0),ve||(ae.g=zo(ae.j,null),ae.g.ea(ae.v)),ae.F=Date.now(),To(ae)}Qo(L)}function Hs(L){L.g&&(Nr(L),L.g.cancel(),L.g=null)}function vc(L){Hs(L),L.u&&(_.clearTimeout(L.u),L.u=null),gi(L),L.h.cancel(),L.s&&(typeof L.s=="number"&&_.clearTimeout(L.s),L.s=null)}function W(L){if(!ra(L.h)&&!L.s){L.s=!0;var ae=L.Ga;Me||tt(),we||(Me(),we=!0),De.add(ae,L),L.B=0}}function Ce(L,ae){return mn(L.h)>=L.h.j-(L.s?1:0)?!1:L.s?(L.i=ae.D.concat(L.i),!0):L.G==1||L.G==2||L.B>=(L.Va?0:L.Wa)?!1:(L.s=In(V(L.Ga,L,ae),bo(L,L.B)),L.B++,!0)}n.Ga=function(L){if(this.s)if(this.s=null,this.G==1){if(!L){this.U=Math.floor(1e5*Math.random()),L=this.U++;const Kt=new ao(this,this.j,L);let pn=this.o;if(this.S&&(pn?(pn=U(pn),q(pn,this.S)):pn=this.S),this.m!==null||this.O||(Kt.H=pn,pn=null),this.P)e:{for(var ae=0,ve=0;ve<this.i.length;ve++){t:{var He=this.i[ve];if("__data__"in He.map&&(He=He.map.__data__,typeof He=="string")){He=He.length;break t}He=void 0}if(He===void 0)break;if(ae+=He,4096<ae){ae=ve;break e}if(ae===4096||ve===this.i.length-1){ae=ve+1;break e}}ae=1e3}else ae=1e3;ae=$t(this,Kt,ae),ve=Mr(this.I),Mi(ve,"RID",L),Mi(ve,"CVER",22),this.D&&Mi(ve,"X-HTTP-Session-Id",this.D),yt(this,ve),pn&&(this.O?ae="headers="+encodeURIComponent(String(Bo(pn)))+"&"+ae:this.m&&Dc(ve,this.m,pn)),ss(this.h,Kt),this.Ua&&Mi(ve,"TYPE","init"),this.P?(Mi(ve,"$req",ae),Mi(ve,"SID","null"),Kt.T=!0,ll(Kt,ve,null)):ll(Kt,ve,ae),this.G=2}}else this.G==3&&(L?mt(this,L):this.i.length==0||ra(this.h)||mt(this))};function mt(L,ae){var ve;ae?ve=ae.l:ve=L.U++;const He=Mr(L.I);Mi(He,"SID",L.K),Mi(He,"RID",ve),Mi(He,"AID",L.T),yt(L,He),L.m&&L.o&&Dc(He,L.m,L.o),ve=new ao(L,L.j,ve,L.B+1),L.m===null&&(ve.H=L.o),ae&&(L.i=ae.D.concat(L.i)),ae=$t(L,ve,1e3),ve.I=Math.round(.5*L.wa)+Math.round(.5*L.wa*Math.random()),ss(L.h,ve),ll(ve,He,ae)}function yt(L,ae){L.H&&ze(L.H,function(ve,He){Mi(ae,He,ve)}),L.l&&cl({},function(ve,He){Mi(ae,He,ve)})}function $t(L,ae,ve){ve=Math.min(L.i.length,ve);var He=L.l?V(L.l.Na,L.l,L):null;e:{var Kt=L.i;let pn=-1;for(;;){const sr=["count="+ve];pn==-1?0<ve?(pn=Kt[0].g,sr.push("ofs="+pn)):pn=0:sr.push("ofs="+pn);let ho=!0;for(let Fo=0;Fo<ve;Fo++){let Wi=Kt[Fo].g;const Oi=Kt[Fo].map;if(Wi-=pn,0>Wi)pn=Math.max(0,Kt[Fo].g-100),ho=!1;else try{ku(Oi,sr,"req"+Wi+"_")}catch{He&&He(Oi)}}if(ho){He=sr.join("&");break e}}}return L=L.i.splice(0,ve),ae.D=L,He}function Zt(L){if(!L.g&&!L.u){L.Y=1;var ae=L.Fa;Me||tt(),we||(Me(),we=!0),De.add(ae,L),L.v=0}}function zn(L){return L.g||L.u||3<=L.v?!1:(L.Y++,L.u=In(V(L.Fa,L),bo(L,L.v)),L.v++,!0)}n.Fa=function(){if(this.u=null,Hr(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var L=2*this.R;this.j.info("BP detection timer enabled: "+L),this.A=In(V(this.ab,this),L)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,xn(10),Hs(this),Hr(this))};function Nr(L){L.A!=null&&(_.clearTimeout(L.A),L.A=null)}function Hr(L){L.g=new ao(L,L.j,"rpc",L.Y),L.m===null&&(L.g.H=L.o),L.g.O=0;var ae=Mr(L.qa);Mi(ae,"RID","rpc"),Mi(ae,"SID",L.K),Mi(ae,"AID",L.T),Mi(ae,"CI",L.F?"0":"1"),!L.F&&L.ja&&Mi(ae,"TO",L.ja),Mi(ae,"TYPE","xmlhttp"),yt(L,ae),L.m&&L.o&&Dc(ae,L.m,L.o),L.L&&(L.g.I=L.L);var ve=L.g;L=L.ia,ve.L=1,ve.v=wl(Mr(ae)),ve.m=null,ve.P=!0,Hi(ve,L)}n.Za=function(){this.C!=null&&(this.C=null,Hs(this),zn(this),xn(19))};function gi(L){L.C!=null&&(_.clearTimeout(L.C),L.C=null)}function Ti(L,ae){var ve=null;if(L.g==ae){gi(L),Nr(L),L.g=null;var He=2}else if(Yo(L.h,ae))ve=ae.D,_i(L.h,ae),He=1;else return;if(L.G!=0){if(ae.o)if(He==1){ve=ae.m?ae.m.length:0,ae=Date.now()-ae.F;var Kt=L.B;He=Rt(),Rr(He,new Un(He,ve)),W(L)}else Zt(L);else if(Kt=ae.s,Kt==3||Kt==0&&0<ae.X||!(He==1&&Ce(L,ae)||He==2&&zn(L)))switch(ve&&0<ve.length&&(ae=L.h,ae.i=ae.i.concat(ve)),Kt){case 1:wo(L,5);break;case 4:wo(L,10);break;case 3:wo(L,6);break;default:wo(L,2)}}}function bo(L,ae){let ve=L.Ta+Math.floor(Math.random()*L.cb);return L.isActive()||(ve*=2),ve*ae}function wo(L,ae){if(L.j.info("Error code "+ae),ae==2){var ve=V(L.fb,L),He=L.Xa;const Kt=!He;He=new Br(He||"//www.google.com/images/cleardot.gif"),_.location&&_.location.protocol=="http"||js(He,"https"),wl(He),Kt?vh(He.toString(),ve):Pu(He.toString(),ve)}else xn(2);L.G=0,L.l&&L.l.sa(ae),Qo(L),vc(L)}n.fb=function(L){L?(this.j.info("Successfully pinged google.com"),xn(2)):(this.j.info("Failed to ping google.com"),xn(1))};function Qo(L){if(L.G=0,L.ka=[],L.l){const ae=pu(L.h);(ae.length!=0||L.i.length!=0)&&(de(L.ka,ae),de(L.ka,L.i),L.h.i.length=0,se(L.i),L.i.length=0),L.l.ra()}}function Mo(L,ae,ve){var He=ve instanceof Br?Mr(ve):new Br(ve);if(He.g!="")ae&&(He.g=ae+"."+He.g),Ea(He,He.s);else{var Kt=_.location;He=Kt.protocol,ae=ae?ae+"."+Kt.hostname:Kt.hostname,Kt=+Kt.port;var pn=new Br(null);He&&js(pn,He),ae&&(pn.g=ae),Kt&&Ea(pn,Kt),ve&&(pn.l=ve),He=pn}return ve=L.D,ae=L.ya,ve&&ae&&Mi(He,ve,ae),Mi(He,"VER",L.la),yt(L,He),He}function zo(L,ae,ve){if(ae&&!L.J)throw Error("Can't create secondary domain capable XhrIo object.");return ae=L.Ca&&!L.pa?new Ko(new Wo({eb:ve})):new Ko(L.pa),ae.Ha(L.J),ae}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function es(){}n=es.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function us(){}us.prototype.g=function(L,ae){return new jo(L,ae)};function jo(L,ae){Bn.call(this),this.g=new hl(ae),this.l=L,this.h=ae&&ae.messageUrlParams||null,L=ae&&ae.messageHeaders||null,ae&&ae.clientProtocolHeaderRequired&&(L?L["X-Client-Protocol"]="webchannel":L={"X-Client-Protocol":"webchannel"}),this.g.o=L,L=ae&&ae.initMessageHeaders||null,ae&&ae.messageContentType&&(L?L["X-WebChannel-Content-Type"]=ae.messageContentType:L={"X-WebChannel-Content-Type":ae.messageContentType}),ae&&ae.va&&(L?L["X-WebChannel-Client-Profile"]=ae.va:L={"X-WebChannel-Client-Profile":ae.va}),this.g.S=L,(L=ae&&ae.Sb)&&!ne(L)&&(this.g.m=L),this.v=ae&&ae.supportsCrossDomainXhr||!1,this.u=ae&&ae.sendRawJson||!1,(ae=ae&&ae.httpSessionIdParam)&&!ne(ae)&&(this.g.D=ae,L=this.h,L!==null&&ae in L&&(L=this.h,ae in L&&delete L[ae])),this.j=new Za(this)}ie(jo,Bn),jo.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},jo.prototype.close=function(){Gs(this.g)},jo.prototype.o=function(L){var ae=this.g;if(typeof L=="string"){var ve={};ve.__data__=L,L=ve}else this.u&&(ve={},ve.__data__=oi(L),L=ve);ae.i.push(new rc(ae.Ya++,L)),ae.G==3&&W(ae)},jo.prototype.N=function(){this.g.l=null,delete this.j,Gs(this.g),delete this.g,jo.aa.N.call(this)};function Es(L){Te.call(this),L.__headers__&&(this.headers=L.__headers__,this.statusCode=L.__status__,delete L.__headers__,delete L.__status__);var ae=L.__sm__;if(ae){e:{for(const ve in ae){L=ve;break e}L=void 0}(this.i=L)&&(L=this.i,ae=ae!==null&&L in ae?ae[L]:void 0),this.data=ae}else this.data=L}ie(Es,Te);function Fc(){et.call(this),this.status=1}ie(Fc,et);function Za(L){this.g=L}ie(Za,es),Za.prototype.ua=function(){Rr(this.g,"a")},Za.prototype.ta=function(L){Rr(this.g,new Es(L))},Za.prototype.sa=function(L){Rr(this.g,new Fc)},Za.prototype.ra=function(){Rr(this.g,"b")},us.prototype.createWebChannel=us.prototype.g,jo.prototype.send=jo.prototype.o,jo.prototype.open=jo.prototype.m,jo.prototype.close=jo.prototype.close,p9=function(){return new us},f9=function(){return Rt()},d9=ht,R5={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},_o.NO_ERROR=0,_o.TIMEOUT=8,_o.HTTP_ERROR=6,H1=_o,Ho.COMPLETE="complete",h9=Ho,lt.EventType=Ee,Ee.OPEN="a",Ee.CLOSE="b",Ee.ERROR="c",Ee.MESSAGE="d",Bn.prototype.listen=Bn.prototype.K,Ry=lt,Ko.prototype.listenOnce=Ko.prototype.L,Ko.prototype.getLastError=Ko.prototype.Ka,Ko.prototype.getLastErrorCode=Ko.prototype.Ba,Ko.prototype.getStatus=Ko.prototype.Z,Ko.prototype.getResponseJson=Ko.prototype.Oa,Ko.prototype.getResponseText=Ko.prototype.oa,Ko.prototype.send=Ko.prototype.ea,Ko.prototype.setWithCredentials=Ko.prototype.Ha,u9=Ko}).apply(typeof b1<"u"?b1:typeof self<"u"?self:typeof window<"u"?window:{});const iE="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gh{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}gh.UNAUTHENTICATED=new gh(null),gh.GOOGLE_CREDENTIALS=new gh("google-credentials-uid"),gh.FIRST_PARTY=new gh("first-party-uid"),gh.MOCK_USER=new gh("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let z0="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lg=new Aw("@firebase/firestore");function Ty(){return lg.logLevel}function yi(n,...e){if(lg.logLevel<=ys.DEBUG){const t=e.map(Cw);lg.debug(`Firestore (${z0}): ${n}`,...t)}}function Tp(n,...e){if(lg.logLevel<=ys.ERROR){const t=e.map(Cw);lg.error(`Firestore (${z0}): ${n}`,...t)}}function A0(n,...e){if(lg.logLevel<=ys.WARN){const t=e.map(Cw);lg.warn(`Firestore (${z0}): ${n}`,...t)}}function Cw(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(t){return JSON.stringify(t)})(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yo(n="Unexpected state"){const e=`FIRESTORE (${z0}) INTERNAL ASSERTION FAILED: `+n;throw Tp(e),new Error(e)}function ba(n,e){n||yo()}function ko(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yn={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ui extends Pp{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bp{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m9{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class sD{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(gh.UNAUTHENTICATED)))}shutdown(){}}class aD{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class lD{constructor(e){this.t=e,this.currentUser=gh.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ba(this.o===void 0);let i=this.i;const c=o=>this.i!==i?(i=this.i,t(o)):Promise.resolve();let u=new bp;this.o=()=>{this.i++,this.currentUser=this.u(),u.resolve(),u=new bp,e.enqueueRetryable((()=>c(this.currentUser)))};const m=()=>{const o=u;e.enqueueRetryable((async()=>{await o.promise,await c(this.currentUser)}))},_=o=>{yi("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=o,this.o&&(this.auth.addAuthTokenListener(this.o),m())};this.t.onInit((o=>_(o))),setTimeout((()=>{if(!this.auth){const o=this.t.getImmediate({optional:!0});o?_(o):(yi("FirebaseAuthCredentialsProvider","Auth not yet detected"),u.resolve(),u=new bp)}}),0),m()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((i=>this.i!==e?(yi("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(ba(typeof i.accessToken=="string"),new m9(i.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ba(e===null||typeof e=="string"),new gh(e)}}class cD{constructor(e,t,i){this.l=e,this.h=t,this.P=i,this.type="FirstParty",this.user=gh.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class uD{constructor(e,t,i){this.l=e,this.h=t,this.P=i}getToken(){return Promise.resolve(new cD(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable((()=>t(gh.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class hD{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class dD{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){ba(this.o===void 0);const i=u=>{u.error!=null&&yi("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${u.error.message}`);const m=u.token!==this.R;return this.R=u.token,yi("FirebaseAppCheckTokenProvider",`Received ${m?"new":"existing"} token.`),m?t(u.token):Promise.resolve()};this.o=u=>{e.enqueueRetryable((()=>i(u)))};const c=u=>{yi("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=u,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit((u=>c(u))),setTimeout((()=>{if(!this.appCheck){const u=this.A.getImmediate({optional:!0});u?c(u):yi("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(ba(typeof t.token=="string"),this.R=t.token,new hD(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fD(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let i=0;i<n;i++)t[i]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g9{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let i="";for(;i.length<20;){const c=fD(40);for(let u=0;u<c.length;++u)i.length<20&&c[u]<t&&(i+=e.charAt(c[u]%e.length))}return i}}function zs(n,e){return n<e?-1:n>e?1:0}function T0(n,e,t){return n.length===e.length&&n.every(((i,c)=>t(i,e[c])))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class du{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new ui(Yn.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new ui(Yn.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new ui(Yn.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ui(Yn.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return du.fromMillis(Date.now())}static fromDate(e){return du.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),i=Math.floor(1e6*(e-1e3*t));return new du(t,i)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?zs(this.nanoseconds,e.nanoseconds):zs(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Po{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Po(e)}static min(){return new Po(new du(0,0))}static max(){return new Po(new du(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l_{constructor(e,t,i){t===void 0?t=0:t>e.length&&yo(),i===void 0?i=e.length-t:i>e.length-t&&yo(),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return l_.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof l_?e.forEach((i=>{t.push(i)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const i=Math.min(e.length,t.length);for(let c=0;c<i;c++){const u=e.get(c),m=t.get(c);if(u<m)return-1;if(u>m)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class vl extends l_{construct(e,t,i){return new vl(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const i of e){if(i.indexOf("//")>=0)throw new ui(Yn.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter((c=>c.length>0)))}return new vl(t)}static emptyPath(){return new vl([])}}const pD=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ku extends l_{construct(e,t,i){return new Ku(e,t,i)}static isValidIdentifier(e){return pD.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ku.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Ku(["__name__"])}static fromServerFormat(e){const t=[];let i="",c=0;const u=()=>{if(i.length===0)throw new ui(Yn.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""};let m=!1;for(;c<e.length;){const _=e[c];if(_==="\\"){if(c+1===e.length)throw new ui(Yn.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const o=e[c+1];if(o!=="\\"&&o!=="."&&o!=="`")throw new ui(Yn.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=o,c+=2}else _==="`"?(m=!m,c++):_!=="."||m?(i+=_,c++):(u(),c++)}if(u(),m)throw new ui(Yn.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ku(t)}static emptyPath(){return new Ku([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vi{constructor(e){this.path=e}static fromPath(e){return new Vi(vl.fromString(e))}static fromName(e){return new Vi(vl.fromString(e).popFirst(5))}static empty(){return new Vi(vl.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&vl.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return vl.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Vi(new vl(e.slice()))}}function mD(n,e){const t=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,c=Po.fromTimestamp(i===1e9?new du(t+1,0):new du(t,i));return new fm(c,Vi.empty(),e)}function gD(n){return new fm(n.readTime,n.key,-1)}class fm{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new fm(Po.min(),Vi.empty(),-1)}static max(){return new fm(Po.max(),Vi.empty(),-1)}}function yD(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Vi.comparator(n.documentKey,e.documentKey),t!==0?t:zs(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _D="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class vD{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function A_(n){if(n.code!==Yn.FAILED_PRECONDITION||n.message!==_D)throw n;yi("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lr{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&yo(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new lr(((i,c)=>{this.nextCallback=u=>{this.wrapSuccess(e,u).next(i,c)},this.catchCallback=u=>{this.wrapFailure(t,u).next(i,c)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof lr?t:lr.resolve(t)}catch(t){return lr.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):lr.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):lr.reject(t)}static resolve(e){return new lr(((t,i)=>{t(e)}))}static reject(e){return new lr(((t,i)=>{i(e)}))}static waitFor(e){return new lr(((t,i)=>{let c=0,u=0,m=!1;e.forEach((_=>{++c,_.next((()=>{++u,m&&u===c&&t()}),(o=>i(o)))})),m=!0,u===c&&t()}))}static or(e){let t=lr.resolve(!1);for(const i of e)t=t.next((c=>c?lr.resolve(c):i()));return t}static forEach(e,t){const i=[];return e.forEach(((c,u)=>{i.push(t.call(this,c,u))})),this.waitFor(i)}static mapArray(e,t){return new lr(((i,c)=>{const u=e.length,m=new Array(u);let _=0;for(let o=0;o<u;o++){const b=o;t(e[b]).next((I=>{m[b]=I,++_,_===u&&i(m)}),(I=>c(I)))}}))}static doWhile(e,t){return new lr(((i,c)=>{const u=()=>{e()===!0?t().next((()=>{u()}),c):i()};u()}))}}function xD(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function T_(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lw{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=i=>this.ie(i),this.se=i=>t.writeSequenceNumber(i))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}Lw.oe=-1;function rx(n){return n==null}function bv(n){return n===0&&1/n==-1/0}function bD(n){return typeof n=="number"&&Number.isInteger(n)&&!bv(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oE(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function j0(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function y9(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tc{constructor(e,t){this.comparator=e,this.root=t||Wu.EMPTY}insert(e,t){return new tc(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Wu.BLACK,null,null))}remove(e){return new tc(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Wu.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const i=this.comparator(e,t.key);if(i===0)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){const c=this.comparator(e,i.key);if(c===0)return t+i.left.size;c<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,i)=>(e(t,i),!1)))}toString(){const e=[];return this.inorderTraversal(((t,i)=>(e.push(`${t}:${i}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new w1(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new w1(this.root,e,this.comparator,!1)}getReverseIterator(){return new w1(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new w1(this.root,e,this.comparator,!0)}}class w1{constructor(e,t,i,c){this.isReverse=c,this.nodeStack=[];let u=1;for(;!e.isEmpty();)if(u=t?i(e.key,t):1,t&&c&&(u*=-1),u<0)e=this.isReverse?e.left:e.right;else{if(u===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Wu{constructor(e,t,i,c,u){this.key=e,this.value=t,this.color=i??Wu.RED,this.left=c??Wu.EMPTY,this.right=u??Wu.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,i,c,u){return new Wu(e??this.key,t??this.value,i??this.color,c??this.left,u??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let c=this;const u=i(e,c.key);return c=u<0?c.copy(null,null,null,c.left.insert(e,t,i),null):u===0?c.copy(null,t,null,null,null):c.copy(null,null,null,null,c.right.insert(e,t,i)),c.fixUp()}removeMin(){if(this.left.isEmpty())return Wu.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let i,c=this;if(t(e,c.key)<0)c.left.isEmpty()||c.left.isRed()||c.left.left.isRed()||(c=c.moveRedLeft()),c=c.copy(null,null,null,c.left.remove(e,t),null);else{if(c.left.isRed()&&(c=c.rotateRight()),c.right.isEmpty()||c.right.isRed()||c.right.left.isRed()||(c=c.moveRedRight()),t(e,c.key)===0){if(c.right.isEmpty())return Wu.EMPTY;i=c.right.min(),c=c.copy(i.key,i.value,null,null,c.right.removeMin())}c=c.copy(null,null,null,null,c.right.remove(e,t))}return c.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Wu.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Wu.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw yo();const e=this.left.check();if(e!==this.right.check())throw yo();return e+(this.isRed()?0:1)}}Wu.EMPTY=null,Wu.RED=!0,Wu.BLACK=!1;Wu.EMPTY=new class{constructor(){this.size=0}get key(){throw yo()}get value(){throw yo()}get color(){throw yo()}get left(){throw yo()}get right(){throw yo()}copy(e,t,i,c,u){return this}insert(e,t,i){return new Wu(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xu{constructor(e){this.comparator=e,this.data=new tc(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,i)=>(e(t),!1)))}forEachInRange(e,t){const i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){const c=i.getNext();if(this.comparator(c.key,e[1])>=0)return;t(c.key)}}forEachWhile(e,t){let i;for(i=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new sE(this.data.getIterator())}getIteratorFrom(e){return new sE(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((i=>{t=t.add(i)})),t}isEqual(e){if(!(e instanceof Xu)||this.size!==e.size)return!1;const t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){const c=t.getNext().key,u=i.getNext().key;if(this.comparator(c,u)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Xu(this.comparator);return t.data=e,t}}class sE{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class of{constructor(e){this.fields=e,e.sort(Ku.comparator)}static empty(){return new of([])}unionWith(e){let t=new Xu(Ku.comparator);for(const i of this.fields)t=t.add(i);for(const i of e)t=t.add(i);return new of(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return T0(this.fields,e.fields,((t,i)=>t.isEqual(i)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _9 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zu{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(c){try{return atob(c)}catch(u){throw typeof DOMException<"u"&&u instanceof DOMException?new _9("Invalid base64 string: "+u):u}})(e);return new Zu(t)}static fromUint8Array(e){const t=(function(c){let u="";for(let m=0;m<c.length;++m)u+=String.fromCharCode(c[m]);return u})(e);return new Zu(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const i=new Uint8Array(t.length);for(let c=0;c<t.length;c++)i[c]=t.charCodeAt(c);return i})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return zs(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Zu.EMPTY_BYTE_STRING=new Zu("");const wD=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function pm(n){if(ba(!!n),typeof n=="string"){let e=0;const t=wD.exec(n);if(ba(!!t),t[1]){let c=t[1];c=(c+"000000000").substr(0,9),e=Number(c)}const i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:kc(n.seconds),nanos:kc(n.nanos)}}function kc(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function cg(n){return typeof n=="string"?Zu.fromBase64String(n):Zu.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pw(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function kw(n){const e=n.mapValue.fields.__previous_value__;return Pw(e)?kw(e):e}function c_(n){const e=pm(n.mapValue.fields.__local_write_time__.timestampValue);return new du(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SD{constructor(e,t,i,c,u,m,_,o,b){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=c,this.ssl=u,this.forceLongPolling=m,this.autoDetectLongPolling=_,this.longPollingOptions=o,this.useFetchStreams=b}}class u_{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new u_("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof u_&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S1={mapValue:{}};function ug(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Pw(n)?4:AD(n)?9007199254740991:ED(n)?10:11:yo()}function Zf(n,e){if(n===e)return!0;const t=ug(n);if(t!==ug(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return c_(n).isEqual(c_(e));case 3:return(function(c,u){if(typeof c.timestampValue=="string"&&typeof u.timestampValue=="string"&&c.timestampValue.length===u.timestampValue.length)return c.timestampValue===u.timestampValue;const m=pm(c.timestampValue),_=pm(u.timestampValue);return m.seconds===_.seconds&&m.nanos===_.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(c,u){return cg(c.bytesValue).isEqual(cg(u.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(c,u){return kc(c.geoPointValue.latitude)===kc(u.geoPointValue.latitude)&&kc(c.geoPointValue.longitude)===kc(u.geoPointValue.longitude)})(n,e);case 2:return(function(c,u){if("integerValue"in c&&"integerValue"in u)return kc(c.integerValue)===kc(u.integerValue);if("doubleValue"in c&&"doubleValue"in u){const m=kc(c.doubleValue),_=kc(u.doubleValue);return m===_?bv(m)===bv(_):isNaN(m)&&isNaN(_)}return!1})(n,e);case 9:return T0(n.arrayValue.values||[],e.arrayValue.values||[],Zf);case 10:case 11:return(function(c,u){const m=c.mapValue.fields||{},_=u.mapValue.fields||{};if(oE(m)!==oE(_))return!1;for(const o in m)if(m.hasOwnProperty(o)&&(_[o]===void 0||!Zf(m[o],_[o])))return!1;return!0})(n,e);default:return yo()}}function h_(n,e){return(n.values||[]).find((t=>Zf(t,e)))!==void 0}function I0(n,e){if(n===e)return 0;const t=ug(n),i=ug(e);if(t!==i)return zs(t,i);switch(t){case 0:case 9007199254740991:return 0;case 1:return zs(n.booleanValue,e.booleanValue);case 2:return(function(u,m){const _=kc(u.integerValue||u.doubleValue),o=kc(m.integerValue||m.doubleValue);return _<o?-1:_>o?1:_===o?0:isNaN(_)?isNaN(o)?0:-1:1})(n,e);case 3:return aE(n.timestampValue,e.timestampValue);case 4:return aE(c_(n),c_(e));case 5:return zs(n.stringValue,e.stringValue);case 6:return(function(u,m){const _=cg(u),o=cg(m);return _.compareTo(o)})(n.bytesValue,e.bytesValue);case 7:return(function(u,m){const _=u.split("/"),o=m.split("/");for(let b=0;b<_.length&&b<o.length;b++){const I=zs(_[b],o[b]);if(I!==0)return I}return zs(_.length,o.length)})(n.referenceValue,e.referenceValue);case 8:return(function(u,m){const _=zs(kc(u.latitude),kc(m.latitude));return _!==0?_:zs(kc(u.longitude),kc(m.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return lE(n.arrayValue,e.arrayValue);case 10:return(function(u,m){var _,o,b,I;const M=u.fields||{},V=m.fields||{},k=(_=M.value)===null||_===void 0?void 0:_.arrayValue,ie=(o=V.value)===null||o===void 0?void 0:o.arrayValue,se=zs(((b=k?.values)===null||b===void 0?void 0:b.length)||0,((I=ie?.values)===null||I===void 0?void 0:I.length)||0);return se!==0?se:lE(k,ie)})(n.mapValue,e.mapValue);case 11:return(function(u,m){if(u===S1.mapValue&&m===S1.mapValue)return 0;if(u===S1.mapValue)return 1;if(m===S1.mapValue)return-1;const _=u.fields||{},o=Object.keys(_),b=m.fields||{},I=Object.keys(b);o.sort(),I.sort();for(let M=0;M<o.length&&M<I.length;++M){const V=zs(o[M],I[M]);if(V!==0)return V;const k=I0(_[o[M]],b[I[M]]);if(k!==0)return k}return zs(o.length,I.length)})(n.mapValue,e.mapValue);default:throw yo()}}function aE(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return zs(n,e);const t=pm(n),i=pm(e),c=zs(t.seconds,i.seconds);return c!==0?c:zs(t.nanos,i.nanos)}function lE(n,e){const t=n.values||[],i=e.values||[];for(let c=0;c<t.length&&c<i.length;++c){const u=I0(t[c],i[c]);if(u)return u}return zs(t.length,i.length)}function C0(n){return M5(n)}function M5(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const i=pm(t);return`time(${i.seconds},${i.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return cg(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return Vi.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let i="[",c=!0;for(const u of t.values||[])c?c=!1:i+=",",i+=M5(u);return i+"]"})(n.arrayValue):"mapValue"in n?(function(t){const i=Object.keys(t.fields||{}).sort();let c="{",u=!0;for(const m of i)u?u=!1:c+=",",c+=`${m}:${M5(t.fields[m])}`;return c+"}"})(n.mapValue):yo()}function cE(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function N5(n){return!!n&&"integerValue"in n}function Rw(n){return!!n&&"arrayValue"in n}function uE(n){return!!n&&"nullValue"in n}function hE(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function W1(n){return!!n&&"mapValue"in n}function ED(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Gy(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return j0(n.mapValue.fields,((t,i)=>e.mapValue.fields[t]=Gy(i))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Gy(n.arrayValue.values[t]);return e}return Object.assign({},n)}function AD(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Md{constructor(e){this.value=e}static empty(){return new Md({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!W1(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Gy(t)}setAll(e){let t=Ku.emptyPath(),i={},c=[];e.forEach(((m,_)=>{if(!t.isImmediateParentOf(_)){const o=this.getFieldsMap(t);this.applyChanges(o,i,c),i={},c=[],t=_.popLast()}m?i[_.lastSegment()]=Gy(m):c.push(_.lastSegment())}));const u=this.getFieldsMap(t);this.applyChanges(u,i,c)}delete(e){const t=this.field(e.popLast());W1(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Zf(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let c=t.mapValue.fields[e.get(i)];W1(c)&&c.mapValue.fields||(c={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=c),t=c}return t.mapValue.fields}applyChanges(e,t,i){j0(t,((c,u)=>e[c]=u));for(const c of i)delete e[c]}clone(){return new Md(Gy(this.value))}}function v9(n){const e=[];return j0(n.fields,((t,i)=>{const c=new Ku([t]);if(W1(i)){const u=v9(i.mapValue).fields;if(u.length===0)e.push(c);else for(const m of u)e.push(c.child(m))}else e.push(c)})),new of(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yh{constructor(e,t,i,c,u,m,_){this.key=e,this.documentType=t,this.version=i,this.readTime=c,this.createTime=u,this.data=m,this.documentState=_}static newInvalidDocument(e){return new yh(e,0,Po.min(),Po.min(),Po.min(),Md.empty(),0)}static newFoundDocument(e,t,i,c){return new yh(e,1,t,Po.min(),i,c,0)}static newNoDocument(e,t){return new yh(e,2,t,Po.min(),Po.min(),Md.empty(),0)}static newUnknownDocument(e,t){return new yh(e,3,t,Po.min(),Po.min(),Md.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Po.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Md.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Md.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Po.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof yh&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new yh(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wv{constructor(e,t){this.position=e,this.inclusive=t}}function dE(n,e,t){let i=0;for(let c=0;c<n.position.length;c++){const u=e[c],m=n.position[c];if(u.field.isKeyField()?i=Vi.comparator(Vi.fromName(m.referenceValue),t.key):i=I0(m,t.data.field(u.field)),u.dir==="desc"&&(i*=-1),i!==0)break}return i}function fE(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Zf(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sv{constructor(e,t="asc"){this.field=e,this.dir=t}}function TD(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x9{}class Zc extends x9{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,i):new CD(e,t,i):t==="array-contains"?new kD(e,i):t==="in"?new RD(e,i):t==="not-in"?new MD(e,i):t==="array-contains-any"?new ND(e,i):new Zc(e,t,i)}static createKeyFieldInFilter(e,t,i){return t==="in"?new LD(e,i):new PD(e,i)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(I0(t,this.value)):t!==null&&ug(this.value)===ug(t)&&this.matchesComparison(I0(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return yo()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class cf extends x9{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new cf(e,t)}matches(e){return b9(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function b9(n){return n.op==="and"}function w9(n){return ID(n)&&b9(n)}function ID(n){for(const e of n.filters)if(e instanceof cf)return!1;return!0}function D5(n){if(n instanceof Zc)return n.field.canonicalString()+n.op.toString()+C0(n.value);if(w9(n))return n.filters.map((e=>D5(e))).join(",");{const e=n.filters.map((t=>D5(t))).join(",");return`${n.op}(${e})`}}function S9(n,e){return n instanceof Zc?(function(i,c){return c instanceof Zc&&i.op===c.op&&i.field.isEqual(c.field)&&Zf(i.value,c.value)})(n,e):n instanceof cf?(function(i,c){return c instanceof cf&&i.op===c.op&&i.filters.length===c.filters.length?i.filters.reduce(((u,m,_)=>u&&S9(m,c.filters[_])),!0):!1})(n,e):void yo()}function E9(n){return n instanceof Zc?(function(t){return`${t.field.canonicalString()} ${t.op} ${C0(t.value)}`})(n):n instanceof cf?(function(t){return t.op.toString()+" {"+t.getFilters().map(E9).join(" ,")+"}"})(n):"Filter"}class CD extends Zc{constructor(e,t,i){super(e,t,i),this.key=Vi.fromName(i.referenceValue)}matches(e){const t=Vi.comparator(e.key,this.key);return this.matchesComparison(t)}}class LD extends Zc{constructor(e,t){super(e,"in",t),this.keys=A9("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class PD extends Zc{constructor(e,t){super(e,"not-in",t),this.keys=A9("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function A9(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map((i=>Vi.fromName(i.referenceValue)))}class kD extends Zc{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Rw(t)&&h_(t.arrayValue,this.value)}}class RD extends Zc{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&h_(this.value.arrayValue,t)}}class MD extends Zc{constructor(e,t){super(e,"not-in",t)}matches(e){if(h_(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!h_(this.value.arrayValue,t)}}class ND extends Zc{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Rw(t)||!t.arrayValue.values)&&t.arrayValue.values.some((i=>h_(this.value.arrayValue,i)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DD{constructor(e,t=null,i=[],c=[],u=null,m=null,_=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=c,this.limit=u,this.startAt=m,this.endAt=_,this.ue=null}}function pE(n,e=null,t=[],i=[],c=null,u=null,m=null){return new DD(n,e,t,i,c,u,m)}function Mw(n){const e=ko(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((i=>D5(i))).join(","),t+="|ob:",t+=e.orderBy.map((i=>(function(u){return u.field.canonicalString()+u.dir})(i))).join(","),rx(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((i=>C0(i))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((i=>C0(i))).join(",")),e.ue=t}return e.ue}function Nw(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!TD(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!S9(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!fE(n.startAt,e.startAt)&&fE(n.endAt,e.endAt)}function F5(n){return Vi.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I_{constructor(e,t=null,i=[],c=[],u=null,m="F",_=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=c,this.limit=u,this.limitType=m,this.startAt=_,this.endAt=o,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function FD(n,e,t,i,c,u,m,_){return new I_(n,e,t,i,c,u,m,_)}function ix(n){return new I_(n)}function mE(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function T9(n){return n.collectionGroup!==null}function Hy(n){const e=ko(n);if(e.ce===null){e.ce=[];const t=new Set;for(const u of e.explicitOrderBy)e.ce.push(u),t.add(u.field.canonicalString());const i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(m){let _=new Xu(Ku.comparator);return m.filters.forEach((o=>{o.getFlattenedFilters().forEach((b=>{b.isInequality()&&(_=_.add(b.field))}))})),_})(e).forEach((u=>{t.has(u.canonicalString())||u.isKeyField()||e.ce.push(new Sv(u,i))})),t.has(Ku.keyField().canonicalString())||e.ce.push(new Sv(Ku.keyField(),i))}return e.ce}function $f(n){const e=ko(n);return e.le||(e.le=OD(e,Hy(n))),e.le}function OD(n,e){if(n.limitType==="F")return pE(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((c=>{const u=c.dir==="desc"?"asc":"desc";return new Sv(c.field,u)}));const t=n.endAt?new wv(n.endAt.position,n.endAt.inclusive):null,i=n.startAt?new wv(n.startAt.position,n.startAt.inclusive):null;return pE(n.path,n.collectionGroup,e,n.filters,n.limit,t,i)}}function O5(n,e){const t=n.filters.concat([e]);return new I_(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function B5(n,e,t){return new I_(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function ox(n,e){return Nw($f(n),$f(e))&&n.limitType===e.limitType}function I9(n){return`${Mw($f(n))}|lt:${n.limitType}`}function i0(n){return`Query(target=${(function(t){let i=t.path.canonicalString();return t.collectionGroup!==null&&(i+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(i+=`, filters: [${t.filters.map((c=>E9(c))).join(", ")}]`),rx(t.limit)||(i+=", limit: "+t.limit),t.orderBy.length>0&&(i+=`, orderBy: [${t.orderBy.map((c=>(function(m){return`${m.field.canonicalString()} (${m.dir})`})(c))).join(", ")}]`),t.startAt&&(i+=", startAt: ",i+=t.startAt.inclusive?"b:":"a:",i+=t.startAt.position.map((c=>C0(c))).join(",")),t.endAt&&(i+=", endAt: ",i+=t.endAt.inclusive?"a:":"b:",i+=t.endAt.position.map((c=>C0(c))).join(",")),`Target(${i})`})($f(n))}; limitType=${n.limitType})`}function sx(n,e){return e.isFoundDocument()&&(function(i,c){const u=c.key.path;return i.collectionGroup!==null?c.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(u):Vi.isDocumentKey(i.path)?i.path.isEqual(u):i.path.isImmediateParentOf(u)})(n,e)&&(function(i,c){for(const u of Hy(i))if(!u.field.isKeyField()&&c.data.field(u.field)===null)return!1;return!0})(n,e)&&(function(i,c){for(const u of i.filters)if(!u.matches(c))return!1;return!0})(n,e)&&(function(i,c){return!(i.startAt&&!(function(m,_,o){const b=dE(m,_,o);return m.inclusive?b<=0:b<0})(i.startAt,Hy(i),c)||i.endAt&&!(function(m,_,o){const b=dE(m,_,o);return m.inclusive?b>=0:b>0})(i.endAt,Hy(i),c))})(n,e)}function BD(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function C9(n){return(e,t)=>{let i=!1;for(const c of Hy(n)){const u=zD(c,e,t);if(u!==0)return u;i=i||c.field.isKeyField()}return 0}}function zD(n,e,t){const i=n.field.isKeyField()?Vi.comparator(e.key,t.key):(function(u,m,_){const o=m.data.field(u),b=_.data.field(u);return o!==null&&b!==null?I0(o,b):yo()})(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return yo()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U0{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i!==void 0){for(const[c,u]of i)if(this.equalsFn(c,e))return u}}has(e){return this.get(e)!==void 0}set(e,t){const i=this.mapKeyFn(e),c=this.inner[i];if(c===void 0)return this.inner[i]=[[e,t]],void this.innerSize++;for(let u=0;u<c.length;u++)if(this.equalsFn(c[u][0],e))return void(c[u]=[e,t]);c.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i===void 0)return!1;for(let c=0;c<i.length;c++)if(this.equalsFn(i[c][0],e))return i.length===1?delete this.inner[t]:i.splice(c,1),this.innerSize--,!0;return!1}forEach(e){j0(this.inner,((t,i)=>{for(const[c,u]of i)e(c,u)}))}isEmpty(){return y9(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jD=new tc(Vi.comparator);function Ip(){return jD}const L9=new tc(Vi.comparator);function My(...n){let e=L9;for(const t of n)e=e.insert(t.key,t);return e}function P9(n){let e=L9;return n.forEach(((t,i)=>e=e.insert(t,i.overlayedDocument))),e}function Qm(){return Wy()}function k9(){return Wy()}function Wy(){return new U0((n=>n.toString()),((n,e)=>n.isEqual(e)))}const UD=new tc(Vi.comparator),VD=new Xu(Vi.comparator);function ds(...n){let e=VD;for(const t of n)e=e.add(t);return e}const qD=new Xu(zs);function $D(){return qD}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dw(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:bv(e)?"-0":e}}function R9(n){return{integerValue:""+n}}function GD(n,e){return bD(e)?R9(e):Dw(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ax{constructor(){this._=void 0}}function HD(n,e,t){return n instanceof d_?(function(c,u){const m={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:c.seconds,nanos:c.nanoseconds}}}};return u&&Pw(u)&&(u=kw(u)),u&&(m.fields.__previous_value__=u),{mapValue:m}})(t,e):n instanceof f_?N9(n,e):n instanceof p_?D9(n,e):(function(c,u){const m=M9(c,u),_=gE(m)+gE(c.Pe);return N5(m)&&N5(c.Pe)?R9(_):Dw(c.serializer,_)})(n,e)}function WD(n,e,t){return n instanceof f_?N9(n,e):n instanceof p_?D9(n,e):t}function M9(n,e){return n instanceof Ev?(function(i){return N5(i)||(function(u){return!!u&&"doubleValue"in u})(i)})(e)?e:{integerValue:0}:null}class d_ extends ax{}class f_ extends ax{constructor(e){super(),this.elements=e}}function N9(n,e){const t=F9(e);for(const i of n.elements)t.some((c=>Zf(c,i)))||t.push(i);return{arrayValue:{values:t}}}class p_ extends ax{constructor(e){super(),this.elements=e}}function D9(n,e){let t=F9(e);for(const i of n.elements)t=t.filter((c=>!Zf(c,i)));return{arrayValue:{values:t}}}class Ev extends ax{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function gE(n){return kc(n.integerValue||n.doubleValue)}function F9(n){return Rw(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KD{constructor(e,t){this.field=e,this.transform=t}}function XD(n,e){return n.field.isEqual(e.field)&&(function(i,c){return i instanceof f_&&c instanceof f_||i instanceof p_&&c instanceof p_?T0(i.elements,c.elements,Zf):i instanceof Ev&&c instanceof Ev?Zf(i.Pe,c.Pe):i instanceof d_&&c instanceof d_})(n.transform,e.transform)}class ZD{constructor(e,t){this.version=e,this.transformResults=t}}class Gf{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Gf}static exists(e){return new Gf(void 0,e)}static updateTime(e){return new Gf(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function K1(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class lx{}function O9(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new z9(n.key,Gf.none()):new C_(n.key,n.data,Gf.none());{const t=n.data,i=Md.empty();let c=new Xu(Ku.comparator);for(let u of e.fields)if(!c.has(u)){let m=t.field(u);m===null&&u.length>1&&(u=u.popLast(),m=t.field(u)),m===null?i.delete(u):i.set(u,m),c=c.add(u)}return new vg(n.key,i,new of(c.toArray()),Gf.none())}}function YD(n,e,t){n instanceof C_?(function(c,u,m){const _=c.value.clone(),o=_E(c.fieldTransforms,u,m.transformResults);_.setAll(o),u.convertToFoundDocument(m.version,_).setHasCommittedMutations()})(n,e,t):n instanceof vg?(function(c,u,m){if(!K1(c.precondition,u))return void u.convertToUnknownDocument(m.version);const _=_E(c.fieldTransforms,u,m.transformResults),o=u.data;o.setAll(B9(c)),o.setAll(_),u.convertToFoundDocument(m.version,o).setHasCommittedMutations()})(n,e,t):(function(c,u,m){u.convertToNoDocument(m.version).setHasCommittedMutations()})(0,e,t)}function Ky(n,e,t,i){return n instanceof C_?(function(u,m,_,o){if(!K1(u.precondition,m))return _;const b=u.value.clone(),I=vE(u.fieldTransforms,o,m);return b.setAll(I),m.convertToFoundDocument(m.version,b).setHasLocalMutations(),null})(n,e,t,i):n instanceof vg?(function(u,m,_,o){if(!K1(u.precondition,m))return _;const b=vE(u.fieldTransforms,o,m),I=m.data;return I.setAll(B9(u)),I.setAll(b),m.convertToFoundDocument(m.version,I).setHasLocalMutations(),_===null?null:_.unionWith(u.fieldMask.fields).unionWith(u.fieldTransforms.map((M=>M.field)))})(n,e,t,i):(function(u,m,_){return K1(u.precondition,m)?(m.convertToNoDocument(m.version).setHasLocalMutations(),null):_})(n,e,t)}function JD(n,e){let t=null;for(const i of n.fieldTransforms){const c=e.data.field(i.field),u=M9(i.transform,c||null);u!=null&&(t===null&&(t=Md.empty()),t.set(i.field,u))}return t||null}function yE(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(i,c){return i===void 0&&c===void 0||!(!i||!c)&&T0(i,c,((u,m)=>XD(u,m)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class C_ extends lx{constructor(e,t,i,c=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=c,this.type=0}getFieldMask(){return null}}class vg extends lx{constructor(e,t,i,c,u=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=c,this.fieldTransforms=u,this.type=1}getFieldMask(){return this.fieldMask}}function B9(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const i=n.data.field(t);e.set(t,i)}})),e}function _E(n,e,t){const i=new Map;ba(n.length===t.length);for(let c=0;c<t.length;c++){const u=n[c],m=u.transform,_=e.data.field(u.field);i.set(u.field,WD(m,_,t[c]))}return i}function vE(n,e,t){const i=new Map;for(const c of n){const u=c.transform,m=t.data.field(c.field);i.set(c.field,HD(u,m,e))}return i}class z9 extends lx{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class QD extends lx{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eF{constructor(e,t,i,c){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=c}applyToRemoteDocument(e,t){const i=t.mutationResults;for(let c=0;c<this.mutations.length;c++){const u=this.mutations[c];u.key.isEqual(e.key)&&YD(u,e,i[c])}}applyToLocalView(e,t){for(const i of this.baseMutations)i.key.isEqual(e.key)&&(t=Ky(i,e,t,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(e.key)&&(t=Ky(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const i=k9();return this.mutations.forEach((c=>{const u=e.get(c.key),m=u.overlayedDocument;let _=this.applyToLocalView(m,u.mutatedFields);_=t.has(c.key)?null:_;const o=O9(m,_);o!==null&&i.set(c.key,o),m.isValidDocument()||m.convertToNoDocument(Po.min())})),i}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),ds())}isEqual(e){return this.batchId===e.batchId&&T0(this.mutations,e.mutations,((t,i)=>yE(t,i)))&&T0(this.baseMutations,e.baseMutations,((t,i)=>yE(t,i)))}}class Fw{constructor(e,t,i,c){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=c}static from(e,t,i){ba(e.mutations.length===i.length);let c=(function(){return UD})();const u=e.mutations;for(let m=0;m<u.length;m++)c=c.insert(u[m].key,i[m].version);return new Fw(e,t,i,c)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tF{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nF{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Kc,ws;function rF(n){switch(n){default:return yo();case Yn.CANCELLED:case Yn.UNKNOWN:case Yn.DEADLINE_EXCEEDED:case Yn.RESOURCE_EXHAUSTED:case Yn.INTERNAL:case Yn.UNAVAILABLE:case Yn.UNAUTHENTICATED:return!1;case Yn.INVALID_ARGUMENT:case Yn.NOT_FOUND:case Yn.ALREADY_EXISTS:case Yn.PERMISSION_DENIED:case Yn.FAILED_PRECONDITION:case Yn.ABORTED:case Yn.OUT_OF_RANGE:case Yn.UNIMPLEMENTED:case Yn.DATA_LOSS:return!0}}function j9(n){if(n===void 0)return Tp("GRPC error has no .code"),Yn.UNKNOWN;switch(n){case Kc.OK:return Yn.OK;case Kc.CANCELLED:return Yn.CANCELLED;case Kc.UNKNOWN:return Yn.UNKNOWN;case Kc.DEADLINE_EXCEEDED:return Yn.DEADLINE_EXCEEDED;case Kc.RESOURCE_EXHAUSTED:return Yn.RESOURCE_EXHAUSTED;case Kc.INTERNAL:return Yn.INTERNAL;case Kc.UNAVAILABLE:return Yn.UNAVAILABLE;case Kc.UNAUTHENTICATED:return Yn.UNAUTHENTICATED;case Kc.INVALID_ARGUMENT:return Yn.INVALID_ARGUMENT;case Kc.NOT_FOUND:return Yn.NOT_FOUND;case Kc.ALREADY_EXISTS:return Yn.ALREADY_EXISTS;case Kc.PERMISSION_DENIED:return Yn.PERMISSION_DENIED;case Kc.FAILED_PRECONDITION:return Yn.FAILED_PRECONDITION;case Kc.ABORTED:return Yn.ABORTED;case Kc.OUT_OF_RANGE:return Yn.OUT_OF_RANGE;case Kc.UNIMPLEMENTED:return Yn.UNIMPLEMENTED;case Kc.DATA_LOSS:return Yn.DATA_LOSS;default:return yo()}}(ws=Kc||(Kc={}))[ws.OK=0]="OK",ws[ws.CANCELLED=1]="CANCELLED",ws[ws.UNKNOWN=2]="UNKNOWN",ws[ws.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ws[ws.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ws[ws.NOT_FOUND=5]="NOT_FOUND",ws[ws.ALREADY_EXISTS=6]="ALREADY_EXISTS",ws[ws.PERMISSION_DENIED=7]="PERMISSION_DENIED",ws[ws.UNAUTHENTICATED=16]="UNAUTHENTICATED",ws[ws.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ws[ws.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ws[ws.ABORTED=10]="ABORTED",ws[ws.OUT_OF_RANGE=11]="OUT_OF_RANGE",ws[ws.UNIMPLEMENTED=12]="UNIMPLEMENTED",ws[ws.INTERNAL=13]="INTERNAL",ws[ws.UNAVAILABLE=14]="UNAVAILABLE",ws[ws.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iF(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oF=new ig([4294967295,4294967295],0);function xE(n){const e=iF().encode(n),t=new c9;return t.update(e),new Uint8Array(t.digest())}function bE(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),i=e.getUint32(4,!0),c=e.getUint32(8,!0),u=e.getUint32(12,!0);return[new ig([t,i],0),new ig([c,u],0)]}class Ow{constructor(e,t,i){if(this.bitmap=e,this.padding=t,this.hashCount=i,t<0||t>=8)throw new Ny(`Invalid padding: ${t}`);if(i<0)throw new Ny(`Invalid hash count: ${i}`);if(e.length>0&&this.hashCount===0)throw new Ny(`Invalid hash count: ${i}`);if(e.length===0&&t!==0)throw new Ny(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=ig.fromNumber(this.Ie)}Ee(e,t,i){let c=e.add(t.multiply(ig.fromNumber(i)));return c.compare(oF)===1&&(c=new ig([c.getBits(0),c.getBits(1)],0)),c.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=xE(e),[i,c]=bE(t);for(let u=0;u<this.hashCount;u++){const m=this.Ee(i,c,u);if(!this.de(m))return!1}return!0}static create(e,t,i){const c=e%8==0?0:8-e%8,u=new Uint8Array(Math.ceil(e/8)),m=new Ow(u,c,t);return i.forEach((_=>m.insert(_))),m}insert(e){if(this.Ie===0)return;const t=xE(e),[i,c]=bE(t);for(let u=0;u<this.hashCount;u++){const m=this.Ee(i,c,u);this.Ae(m)}}Ae(e){const t=Math.floor(e/8),i=e%8;this.bitmap[t]|=1<<i}}class Ny extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cx{constructor(e,t,i,c,u){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=i,this.documentUpdates=c,this.resolvedLimboDocuments=u}static createSynthesizedRemoteEventForCurrentChange(e,t,i){const c=new Map;return c.set(e,L_.createSynthesizedTargetChangeForCurrentChange(e,t,i)),new cx(Po.min(),c,new tc(zs),Ip(),ds())}}class L_{constructor(e,t,i,c,u){this.resumeToken=e,this.current=t,this.addedDocuments=i,this.modifiedDocuments=c,this.removedDocuments=u}static createSynthesizedTargetChangeForCurrentChange(e,t,i){return new L_(i,t,ds(),ds(),ds())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X1{constructor(e,t,i,c){this.Re=e,this.removedTargetIds=t,this.key=i,this.Ve=c}}class U9{constructor(e,t){this.targetId=e,this.me=t}}class V9{constructor(e,t,i=Zu.EMPTY_BYTE_STRING,c=null){this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=c}}class wE{constructor(){this.fe=0,this.ge=EE(),this.pe=Zu.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=ds(),t=ds(),i=ds();return this.ge.forEach(((c,u)=>{switch(u){case 0:e=e.add(c);break;case 2:t=t.add(c);break;case 1:i=i.add(c);break;default:yo()}})),new L_(this.pe,this.ye,e,t,i)}Ce(){this.we=!1,this.ge=EE()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,ba(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class sF{constructor(e){this.Le=e,this.Be=new Map,this.ke=Ip(),this.qe=SE(),this.Qe=new tc(zs)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,(t=>{const i=this.Ge(t);switch(e.state){case 0:this.ze(t)&&i.De(e.resumeToken);break;case 1:i.Oe(),i.Se||i.Ce(),i.De(e.resumeToken);break;case 2:i.Oe(),i.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(i.Ne(),i.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),i.De(e.resumeToken));break;default:yo()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach(((i,c)=>{this.ze(c)&&t(c)}))}He(e){const t=e.targetId,i=e.me.count,c=this.Je(t);if(c){const u=c.target;if(F5(u))if(i===0){const m=new Vi(u.path);this.Ue(t,m,yh.newNoDocument(m,Po.min()))}else ba(i===1);else{const m=this.Ye(t);if(m!==i){const _=this.Ze(e),o=_?this.Xe(_,e,m):1;if(o!==0){this.je(t);const b=o===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,b)}}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:i="",padding:c=0},hashCount:u=0}=t;let m,_;try{m=cg(i).toUint8Array()}catch(o){if(o instanceof _9)return A0("Decoding the base64 bloom filter in existence filter failed ("+o.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw o}try{_=new Ow(m,c,u)}catch(o){return A0(o instanceof Ny?"BloomFilter error: ":"Applying bloom filter failed: ",o),null}return _.Ie===0?null:_}Xe(e,t,i){return t.me.count===i-this.nt(e,t.targetId)?0:2}nt(e,t){const i=this.Le.getRemoteKeysForTarget(t);let c=0;return i.forEach((u=>{const m=this.Le.tt(),_=`projects/${m.projectId}/databases/${m.database}/documents/${u.path.canonicalString()}`;e.mightContain(_)||(this.Ue(t,u,null),c++)})),c}rt(e){const t=new Map;this.Be.forEach(((u,m)=>{const _=this.Je(m);if(_){if(u.current&&F5(_.target)){const o=new Vi(_.target.path);this.ke.get(o)!==null||this.it(m,o)||this.Ue(m,o,yh.newNoDocument(o,e))}u.be&&(t.set(m,u.ve()),u.Ce())}}));let i=ds();this.qe.forEach(((u,m)=>{let _=!0;m.forEachWhile((o=>{const b=this.Je(o);return!b||b.purpose==="TargetPurposeLimboResolution"||(_=!1,!1)})),_&&(i=i.add(u))})),this.ke.forEach(((u,m)=>m.setReadTime(e)));const c=new cx(e,t,this.Qe,this.ke,i);return this.ke=Ip(),this.qe=SE(),this.Qe=new tc(zs),c}$e(e,t){if(!this.ze(e))return;const i=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,i),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,i){if(!this.ze(e))return;const c=this.Ge(e);this.it(e,t)?c.Fe(t,1):c.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),i&&(this.ke=this.ke.insert(t,i))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new wE,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Xu(zs),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||yi("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new wE),this.Le.getRemoteKeysForTarget(e).forEach((t=>{this.Ue(e,t,null)}))}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function SE(){return new tc(Vi.comparator)}function EE(){return new tc(Vi.comparator)}const aF={asc:"ASCENDING",desc:"DESCENDING"},lF={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},cF={and:"AND",or:"OR"};class uF{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function z5(n,e){return n.useProto3Json||rx(e)?e:{value:e}}function Av(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function q9(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function hF(n,e){return Av(n,e.toTimestamp())}function Hf(n){return ba(!!n),Po.fromTimestamp((function(t){const i=pm(t);return new du(i.seconds,i.nanos)})(n))}function Bw(n,e){return j5(n,e).canonicalString()}function j5(n,e){const t=(function(c){return new vl(["projects",c.projectId,"databases",c.database])})(n).child("documents");return e===void 0?t:t.child(e)}function $9(n){const e=vl.fromString(n);return ba(X9(e)),e}function U5(n,e){return Bw(n.databaseId,e.path)}function jb(n,e){const t=$9(e);if(t.get(1)!==n.databaseId.projectId)throw new ui(Yn.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new ui(Yn.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Vi(H9(t))}function G9(n,e){return Bw(n.databaseId,e)}function dF(n){const e=$9(n);return e.length===4?vl.emptyPath():H9(e)}function V5(n){return new vl(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function H9(n){return ba(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function AE(n,e,t){return{name:U5(n,e),fields:t.value.mapValue.fields}}function fF(n,e){let t;if("targetChange"in e){e.targetChange;const i=(function(b){return b==="NO_CHANGE"?0:b==="ADD"?1:b==="REMOVE"?2:b==="CURRENT"?3:b==="RESET"?4:yo()})(e.targetChange.targetChangeType||"NO_CHANGE"),c=e.targetChange.targetIds||[],u=(function(b,I){return b.useProto3Json?(ba(I===void 0||typeof I=="string"),Zu.fromBase64String(I||"")):(ba(I===void 0||I instanceof Buffer||I instanceof Uint8Array),Zu.fromUint8Array(I||new Uint8Array))})(n,e.targetChange.resumeToken),m=e.targetChange.cause,_=m&&(function(b){const I=b.code===void 0?Yn.UNKNOWN:j9(b.code);return new ui(I,b.message||"")})(m);t=new V9(i,c,u,_||null)}else if("documentChange"in e){e.documentChange;const i=e.documentChange;i.document,i.document.name,i.document.updateTime;const c=jb(n,i.document.name),u=Hf(i.document.updateTime),m=i.document.createTime?Hf(i.document.createTime):Po.min(),_=new Md({mapValue:{fields:i.document.fields}}),o=yh.newFoundDocument(c,u,m,_),b=i.targetIds||[],I=i.removedTargetIds||[];t=new X1(b,I,o.key,o)}else if("documentDelete"in e){e.documentDelete;const i=e.documentDelete;i.document;const c=jb(n,i.document),u=i.readTime?Hf(i.readTime):Po.min(),m=yh.newNoDocument(c,u),_=i.removedTargetIds||[];t=new X1([],_,m.key,m)}else if("documentRemove"in e){e.documentRemove;const i=e.documentRemove;i.document;const c=jb(n,i.document),u=i.removedTargetIds||[];t=new X1([],u,c,null)}else{if(!("filter"in e))return yo();{e.filter;const i=e.filter;i.targetId;const{count:c=0,unchangedNames:u}=i,m=new nF(c,u),_=i.targetId;t=new U9(_,m)}}return t}function pF(n,e){let t;if(e instanceof C_)t={update:AE(n,e.key,e.value)};else if(e instanceof z9)t={delete:U5(n,e.key)};else if(e instanceof vg)t={update:AE(n,e.key,e.data),updateMask:SF(e.fieldMask)};else{if(!(e instanceof QD))return yo();t={verify:U5(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((i=>(function(u,m){const _=m.transform;if(_ instanceof d_)return{fieldPath:m.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(_ instanceof f_)return{fieldPath:m.field.canonicalString(),appendMissingElements:{values:_.elements}};if(_ instanceof p_)return{fieldPath:m.field.canonicalString(),removeAllFromArray:{values:_.elements}};if(_ instanceof Ev)return{fieldPath:m.field.canonicalString(),increment:_.Pe};throw yo()})(0,i)))),e.precondition.isNone||(t.currentDocument=(function(c,u){return u.updateTime!==void 0?{updateTime:hF(c,u.updateTime)}:u.exists!==void 0?{exists:u.exists}:yo()})(n,e.precondition)),t}function mF(n,e){return n&&n.length>0?(ba(e!==void 0),n.map((t=>(function(c,u){let m=c.updateTime?Hf(c.updateTime):Hf(u);return m.isEqual(Po.min())&&(m=Hf(u)),new ZD(m,c.transformResults||[])})(t,e)))):[]}function gF(n,e){return{documents:[G9(n,e.path)]}}function yF(n,e){const t={structuredQuery:{}},i=e.path;let c;e.collectionGroup!==null?(c=i,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(c=i.popLast(),t.structuredQuery.from=[{collectionId:i.lastSegment()}]),t.parent=G9(n,c);const u=(function(b){if(b.length!==0)return K9(cf.create(b,"and"))})(e.filters);u&&(t.structuredQuery.where=u);const m=(function(b){if(b.length!==0)return b.map((I=>(function(V){return{field:o0(V.field),direction:xF(V.dir)}})(I)))})(e.orderBy);m&&(t.structuredQuery.orderBy=m);const _=z5(n,e.limit);return _!==null&&(t.structuredQuery.limit=_),e.startAt&&(t.structuredQuery.startAt=(function(b){return{before:b.inclusive,values:b.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(b){return{before:!b.inclusive,values:b.position}})(e.endAt)),{_t:t,parent:c}}function _F(n){let e=dF(n.parent);const t=n.structuredQuery,i=t.from?t.from.length:0;let c=null;if(i>0){ba(i===1);const I=t.from[0];I.allDescendants?c=I.collectionId:e=e.child(I.collectionId)}let u=[];t.where&&(u=(function(M){const V=W9(M);return V instanceof cf&&w9(V)?V.getFilters():[V]})(t.where));let m=[];t.orderBy&&(m=(function(M){return M.map((V=>(function(ie){return new Sv(s0(ie.field),(function(de){switch(de){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(ie.direction))})(V)))})(t.orderBy));let _=null;t.limit&&(_=(function(M){let V;return V=typeof M=="object"?M.value:M,rx(V)?null:V})(t.limit));let o=null;t.startAt&&(o=(function(M){const V=!!M.before,k=M.values||[];return new wv(k,V)})(t.startAt));let b=null;return t.endAt&&(b=(function(M){const V=!M.before,k=M.values||[];return new wv(k,V)})(t.endAt)),FD(e,c,m,u,_,"F",o,b)}function vF(n,e){const t=(function(c){switch(c){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return yo()}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function W9(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const i=s0(t.unaryFilter.field);return Zc.create(i,"==",{doubleValue:NaN});case"IS_NULL":const c=s0(t.unaryFilter.field);return Zc.create(c,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const u=s0(t.unaryFilter.field);return Zc.create(u,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const m=s0(t.unaryFilter.field);return Zc.create(m,"!=",{nullValue:"NULL_VALUE"});default:return yo()}})(n):n.fieldFilter!==void 0?(function(t){return Zc.create(s0(t.fieldFilter.field),(function(c){switch(c){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return yo()}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return cf.create(t.compositeFilter.filters.map((i=>W9(i))),(function(c){switch(c){case"AND":return"and";case"OR":return"or";default:return yo()}})(t.compositeFilter.op))})(n):yo()}function xF(n){return aF[n]}function bF(n){return lF[n]}function wF(n){return cF[n]}function o0(n){return{fieldPath:n.canonicalString()}}function s0(n){return Ku.fromServerFormat(n.fieldPath)}function K9(n){return n instanceof Zc?(function(t){if(t.op==="=="){if(hE(t.value))return{unaryFilter:{field:o0(t.field),op:"IS_NAN"}};if(uE(t.value))return{unaryFilter:{field:o0(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(hE(t.value))return{unaryFilter:{field:o0(t.field),op:"IS_NOT_NAN"}};if(uE(t.value))return{unaryFilter:{field:o0(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:o0(t.field),op:bF(t.op),value:t.value}}})(n):n instanceof cf?(function(t){const i=t.getFilters().map((c=>K9(c)));return i.length===1?i[0]:{compositeFilter:{op:wF(t.op),filters:i}}})(n):yo()}function SF(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function X9(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nm{constructor(e,t,i,c,u=Po.min(),m=Po.min(),_=Zu.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=i,this.sequenceNumber=c,this.snapshotVersion=u,this.lastLimboFreeSnapshotVersion=m,this.resumeToken=_,this.expectedCount=o}withSequenceNumber(e){return new nm(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new nm(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new nm(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new nm(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EF{constructor(e){this.ct=e}}function AF(n){const e=_F({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?B5(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TF{constructor(){this.un=new IF}addToCollectionParentIndex(e,t){return this.un.add(t),lr.resolve()}getCollectionParents(e,t){return lr.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return lr.resolve()}deleteFieldIndex(e,t){return lr.resolve()}deleteAllFieldIndexes(e){return lr.resolve()}createTargetIndexes(e,t){return lr.resolve()}getDocumentsMatchingTarget(e,t){return lr.resolve(null)}getIndexType(e,t){return lr.resolve(0)}getFieldIndexes(e,t){return lr.resolve([])}getNextCollectionGroupToUpdate(e){return lr.resolve(null)}getMinOffset(e,t){return lr.resolve(fm.min())}getMinOffsetFromCollectionGroup(e,t){return lr.resolve(fm.min())}updateCollectionGroup(e,t,i){return lr.resolve()}updateIndexEntries(e,t){return lr.resolve()}}class IF{constructor(){this.index={}}add(e){const t=e.lastSegment(),i=e.popLast(),c=this.index[t]||new Xu(vl.comparator),u=!c.has(i);return this.index[t]=c.add(i),u}has(e){const t=e.lastSegment(),i=e.popLast(),c=this.index[t];return c&&c.has(i)}getEntries(e){return(this.index[e]||new Xu(vl.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L0{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new L0(0)}static kn(){return new L0(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CF{constructor(){this.changes=new U0((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,yh.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const i=this.changes.get(t);return i!==void 0?lr.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LF{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PF{constructor(e,t,i,c){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=c}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next((c=>(i=c,this.remoteDocumentCache.getEntry(e,t)))).next((c=>(i!==null&&Ky(i.mutation,c,of.empty(),du.now()),c)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((i=>this.getLocalViewOfDocuments(e,i,ds()).next((()=>i))))}getLocalViewOfDocuments(e,t,i=ds()){const c=Qm();return this.populateOverlays(e,c,t).next((()=>this.computeViews(e,t,c,i).next((u=>{let m=My();return u.forEach(((_,o)=>{m=m.insert(_,o.overlayedDocument)})),m}))))}getOverlayedDocuments(e,t){const i=Qm();return this.populateOverlays(e,i,t).next((()=>this.computeViews(e,t,i,ds())))}populateOverlays(e,t,i){const c=[];return i.forEach((u=>{t.has(u)||c.push(u)})),this.documentOverlayCache.getOverlays(e,c).next((u=>{u.forEach(((m,_)=>{t.set(m,_)}))}))}computeViews(e,t,i,c){let u=Ip();const m=Wy(),_=(function(){return Wy()})();return t.forEach(((o,b)=>{const I=i.get(b.key);c.has(b.key)&&(I===void 0||I.mutation instanceof vg)?u=u.insert(b.key,b):I!==void 0?(m.set(b.key,I.mutation.getFieldMask()),Ky(I.mutation,b,I.mutation.getFieldMask(),du.now())):m.set(b.key,of.empty())})),this.recalculateAndSaveOverlays(e,u).next((o=>(o.forEach(((b,I)=>m.set(b,I))),t.forEach(((b,I)=>{var M;return _.set(b,new LF(I,(M=m.get(b))!==null&&M!==void 0?M:null))})),_)))}recalculateAndSaveOverlays(e,t){const i=Wy();let c=new tc(((m,_)=>m-_)),u=ds();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((m=>{for(const _ of m)_.keys().forEach((o=>{const b=t.get(o);if(b===null)return;let I=i.get(o)||of.empty();I=_.applyToLocalView(b,I),i.set(o,I);const M=(c.get(_.batchId)||ds()).add(o);c=c.insert(_.batchId,M)}))})).next((()=>{const m=[],_=c.getReverseIterator();for(;_.hasNext();){const o=_.getNext(),b=o.key,I=o.value,M=k9();I.forEach((V=>{if(!u.has(V)){const k=O9(t.get(V),i.get(V));k!==null&&M.set(V,k),u=u.add(V)}})),m.push(this.documentOverlayCache.saveOverlays(e,b,M))}return lr.waitFor(m)})).next((()=>i))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((i=>this.recalculateAndSaveOverlays(e,i)))}getDocumentsMatchingQuery(e,t,i,c){return(function(m){return Vi.isDocumentKey(m.path)&&m.collectionGroup===null&&m.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):T9(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i,c):this.getDocumentsMatchingCollectionQuery(e,t,i,c)}getNextDocuments(e,t,i,c){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,c).next((u=>{const m=c-u.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,c-u.size):lr.resolve(Qm());let _=-1,o=u;return m.next((b=>lr.forEach(b,((I,M)=>(_<M.largestBatchId&&(_=M.largestBatchId),u.get(I)?lr.resolve():this.remoteDocumentCache.getEntry(e,I).next((V=>{o=o.insert(I,V)}))))).next((()=>this.populateOverlays(e,b,u))).next((()=>this.computeViews(e,o,b,ds()))).next((I=>({batchId:_,changes:P9(I)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Vi(t)).next((i=>{let c=My();return i.isFoundDocument()&&(c=c.insert(i.key,i)),c}))}getDocumentsMatchingCollectionGroupQuery(e,t,i,c){const u=t.collectionGroup;let m=My();return this.indexManager.getCollectionParents(e,u).next((_=>lr.forEach(_,(o=>{const b=(function(M,V){return new I_(V,null,M.explicitOrderBy.slice(),M.filters.slice(),M.limit,M.limitType,M.startAt,M.endAt)})(t,o.child(u));return this.getDocumentsMatchingCollectionQuery(e,b,i,c).next((I=>{I.forEach(((M,V)=>{m=m.insert(M,V)}))}))})).next((()=>m))))}getDocumentsMatchingCollectionQuery(e,t,i,c){let u;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId).next((m=>(u=m,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,i,u,c)))).next((m=>{u.forEach(((o,b)=>{const I=b.getKey();m.get(I)===null&&(m=m.insert(I,yh.newInvalidDocument(I)))}));let _=My();return m.forEach(((o,b)=>{const I=u.get(o);I!==void 0&&Ky(I.mutation,b,of.empty(),du.now()),sx(t,b)&&(_=_.insert(o,b))})),_}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kF{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return lr.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,(function(c){return{id:c.id,version:c.version,createTime:Hf(c.createTime)}})(t)),lr.resolve()}getNamedQuery(e,t){return lr.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,(function(c){return{name:c.name,query:AF(c.bundledQuery),readTime:Hf(c.readTime)}})(t)),lr.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RF{constructor(){this.overlays=new tc(Vi.comparator),this.Ir=new Map}getOverlay(e,t){return lr.resolve(this.overlays.get(t))}getOverlays(e,t){const i=Qm();return lr.forEach(t,(c=>this.getOverlay(e,c).next((u=>{u!==null&&i.set(c,u)})))).next((()=>i))}saveOverlays(e,t,i){return i.forEach(((c,u)=>{this.ht(e,t,u)})),lr.resolve()}removeOverlaysForBatchId(e,t,i){const c=this.Ir.get(i);return c!==void 0&&(c.forEach((u=>this.overlays=this.overlays.remove(u))),this.Ir.delete(i)),lr.resolve()}getOverlaysForCollection(e,t,i){const c=Qm(),u=t.length+1,m=new Vi(t.child("")),_=this.overlays.getIteratorFrom(m);for(;_.hasNext();){const o=_.getNext().value,b=o.getKey();if(!t.isPrefixOf(b.path))break;b.path.length===u&&o.largestBatchId>i&&c.set(o.getKey(),o)}return lr.resolve(c)}getOverlaysForCollectionGroup(e,t,i,c){let u=new tc(((b,I)=>b-I));const m=this.overlays.getIterator();for(;m.hasNext();){const b=m.getNext().value;if(b.getKey().getCollectionGroup()===t&&b.largestBatchId>i){let I=u.get(b.largestBatchId);I===null&&(I=Qm(),u=u.insert(b.largestBatchId,I)),I.set(b.getKey(),b)}}const _=Qm(),o=u.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach(((b,I)=>_.set(b,I))),!(_.size()>=c)););return lr.resolve(_)}ht(e,t,i){const c=this.overlays.get(i.key);if(c!==null){const m=this.Ir.get(c.largestBatchId).delete(i.key);this.Ir.set(c.largestBatchId,m)}this.overlays=this.overlays.insert(i.key,new tF(t,i));let u=this.Ir.get(t);u===void 0&&(u=ds(),this.Ir.set(t,u)),this.Ir.set(t,u.add(i.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MF{constructor(){this.sessionToken=Zu.EMPTY_BYTE_STRING}getSessionToken(e){return lr.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,lr.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zw{constructor(){this.Tr=new Xu(Tu.Er),this.dr=new Xu(Tu.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const i=new Tu(e,t);this.Tr=this.Tr.add(i),this.dr=this.dr.add(i)}Rr(e,t){e.forEach((i=>this.addReference(i,t)))}removeReference(e,t){this.Vr(new Tu(e,t))}mr(e,t){e.forEach((i=>this.removeReference(i,t)))}gr(e){const t=new Vi(new vl([])),i=new Tu(t,e),c=new Tu(t,e+1),u=[];return this.dr.forEachInRange([i,c],(m=>{this.Vr(m),u.push(m.key)})),u}pr(){this.Tr.forEach((e=>this.Vr(e)))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new Vi(new vl([])),i=new Tu(t,e),c=new Tu(t,e+1);let u=ds();return this.dr.forEachInRange([i,c],(m=>{u=u.add(m.key)})),u}containsKey(e){const t=new Tu(e,0),i=this.Tr.firstAfterOrEqual(t);return i!==null&&e.isEqual(i.key)}}class Tu{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return Vi.comparator(e.key,t.key)||zs(e.wr,t.wr)}static Ar(e,t){return zs(e.wr,t.wr)||Vi.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NF{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new Xu(Tu.Er)}checkEmpty(e){return lr.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,i,c){const u=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const m=new eF(u,t,i,c);this.mutationQueue.push(m);for(const _ of c)this.br=this.br.add(new Tu(_.key,u)),this.indexManager.addToCollectionParentIndex(e,_.key.path.popLast());return lr.resolve(m)}lookupMutationBatch(e,t){return lr.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const i=t+1,c=this.vr(i),u=c<0?0:c;return lr.resolve(this.mutationQueue.length>u?this.mutationQueue[u]:null)}getHighestUnacknowledgedBatchId(){return lr.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return lr.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const i=new Tu(t,0),c=new Tu(t,Number.POSITIVE_INFINITY),u=[];return this.br.forEachInRange([i,c],(m=>{const _=this.Dr(m.wr);u.push(_)})),lr.resolve(u)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new Xu(zs);return t.forEach((c=>{const u=new Tu(c,0),m=new Tu(c,Number.POSITIVE_INFINITY);this.br.forEachInRange([u,m],(_=>{i=i.add(_.wr)}))})),lr.resolve(this.Cr(i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,c=i.length+1;let u=i;Vi.isDocumentKey(u)||(u=u.child(""));const m=new Tu(new Vi(u),0);let _=new Xu(zs);return this.br.forEachWhile((o=>{const b=o.key.path;return!!i.isPrefixOf(b)&&(b.length===c&&(_=_.add(o.wr)),!0)}),m),lr.resolve(this.Cr(_))}Cr(e){const t=[];return e.forEach((i=>{const c=this.Dr(i);c!==null&&t.push(c)})),t}removeMutationBatch(e,t){ba(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let i=this.br;return lr.forEach(t.mutations,(c=>{const u=new Tu(c.key,t.batchId);return i=i.delete(u),this.referenceDelegate.markPotentiallyOrphaned(e,c.key)})).next((()=>{this.br=i}))}On(e){}containsKey(e,t){const i=new Tu(t,0),c=this.br.firstAfterOrEqual(i);return lr.resolve(t.isEqual(c&&c.key))}performConsistencyCheck(e){return this.mutationQueue.length,lr.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DF{constructor(e){this.Mr=e,this.docs=(function(){return new tc(Vi.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const i=t.key,c=this.docs.get(i),u=c?c.size:0,m=this.Mr(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:m}),this.size+=m-u,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const i=this.docs.get(t);return lr.resolve(i?i.document.mutableCopy():yh.newInvalidDocument(t))}getEntries(e,t){let i=Ip();return t.forEach((c=>{const u=this.docs.get(c);i=i.insert(c,u?u.document.mutableCopy():yh.newInvalidDocument(c))})),lr.resolve(i)}getDocumentsMatchingQuery(e,t,i,c){let u=Ip();const m=t.path,_=new Vi(m.child("")),o=this.docs.getIteratorFrom(_);for(;o.hasNext();){const{key:b,value:{document:I}}=o.getNext();if(!m.isPrefixOf(b.path))break;b.path.length>m.length+1||yD(gD(I),i)<=0||(c.has(I.key)||sx(t,I))&&(u=u.insert(I.key,I.mutableCopy()))}return lr.resolve(u)}getAllFromCollectionGroup(e,t,i,c){yo()}Or(e,t){return lr.forEach(this.docs,(i=>t(i)))}newChangeBuffer(e){return new FF(this)}getSize(e){return lr.resolve(this.size)}}class FF extends CF{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach(((i,c)=>{c.isValidDocument()?t.push(this.cr.addEntry(e,c)):this.cr.removeEntry(i)})),lr.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OF{constructor(e){this.persistence=e,this.Nr=new U0((t=>Mw(t)),Nw),this.lastRemoteSnapshotVersion=Po.min(),this.highestTargetId=0,this.Lr=0,this.Br=new zw,this.targetCount=0,this.kr=L0.Bn()}forEachTarget(e,t){return this.Nr.forEach(((i,c)=>t(c))),lr.resolve()}getLastRemoteSnapshotVersion(e){return lr.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return lr.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),lr.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this.Lr&&(this.Lr=t),lr.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new L0(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,lr.resolve()}updateTargetData(e,t){return this.Kn(t),lr.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,lr.resolve()}removeTargets(e,t,i){let c=0;const u=[];return this.Nr.forEach(((m,_)=>{_.sequenceNumber<=t&&i.get(_.targetId)===null&&(this.Nr.delete(m),u.push(this.removeMatchingKeysForTargetId(e,_.targetId)),c++)})),lr.waitFor(u).next((()=>c))}getTargetCount(e){return lr.resolve(this.targetCount)}getTargetData(e,t){const i=this.Nr.get(t)||null;return lr.resolve(i)}addMatchingKeys(e,t,i){return this.Br.Rr(t,i),lr.resolve()}removeMatchingKeys(e,t,i){this.Br.mr(t,i);const c=this.persistence.referenceDelegate,u=[];return c&&t.forEach((m=>{u.push(c.markPotentiallyOrphaned(e,m))})),lr.waitFor(u)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),lr.resolve()}getMatchingKeysForTargetId(e,t){const i=this.Br.yr(t);return lr.resolve(i)}containsKey(e,t){return lr.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BF{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Lw(0),this.Kr=!1,this.Kr=!0,this.$r=new MF,this.referenceDelegate=e(this),this.Ur=new OF(this),this.indexManager=new TF,this.remoteDocumentCache=(function(c){return new DF(c)})((i=>this.referenceDelegate.Wr(i))),this.serializer=new EF(t),this.Gr=new kF(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new RF,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this.qr[e.toKey()];return i||(i=new NF(t,this.referenceDelegate),this.qr[e.toKey()]=i),i}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,i){yi("MemoryPersistence","Starting transaction:",e);const c=new zF(this.Qr.next());return this.referenceDelegate.zr(),i(c).next((u=>this.referenceDelegate.jr(c).next((()=>u)))).toPromise().then((u=>(c.raiseOnCommittedEvent(),u)))}Hr(e,t){return lr.or(Object.values(this.qr).map((i=>()=>i.containsKey(e,t))))}}class zF extends vD{constructor(e){super(),this.currentSequenceNumber=e}}class jw{constructor(e){this.persistence=e,this.Jr=new zw,this.Yr=null}static Zr(e){return new jw(e)}get Xr(){if(this.Yr)return this.Yr;throw yo()}addReference(e,t,i){return this.Jr.addReference(i,t),this.Xr.delete(i.toString()),lr.resolve()}removeReference(e,t,i){return this.Jr.removeReference(i,t),this.Xr.add(i.toString()),lr.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),lr.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach((c=>this.Xr.add(c.toString())));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next((c=>{c.forEach((u=>this.Xr.add(u.toString())))})).next((()=>i.removeTargetData(e,t)))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return lr.forEach(this.Xr,(i=>{const c=Vi.fromPath(i);return this.ei(e,c).next((u=>{u||t.removeEntry(c,Po.min())}))})).next((()=>(this.Yr=null,t.apply(e))))}updateLimboDocument(e,t){return this.ei(e,t).next((i=>{i?this.Xr.delete(t.toString()):this.Xr.add(t.toString())}))}Wr(e){return 0}ei(e,t){return lr.or([()=>lr.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uw{constructor(e,t,i,c){this.targetId=e,this.fromCache=t,this.$i=i,this.Ui=c}static Wi(e,t){let i=ds(),c=ds();for(const u of t.docChanges)switch(u.type){case 0:i=i.add(u.doc.key);break;case 1:c=c.add(u.doc.key)}return new Uw(e,t.fromCache,i,c)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jF{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UF{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=(function(){return UM()?8:xD(_h())>0?6:4})()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,i,c){const u={result:null};return this.Yi(e,t).next((m=>{u.result=m})).next((()=>{if(!u.result)return this.Zi(e,t,c,i).next((m=>{u.result=m}))})).next((()=>{if(u.result)return;const m=new jF;return this.Xi(e,t,m).next((_=>{if(u.result=_,this.zi)return this.es(e,t,m,_.size)}))})).next((()=>u.result))}es(e,t,i,c){return i.documentReadCount<this.ji?(Ty()<=ys.DEBUG&&yi("QueryEngine","SDK will not create cache indexes for query:",i0(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),lr.resolve()):(Ty()<=ys.DEBUG&&yi("QueryEngine","Query:",i0(t),"scans",i.documentReadCount,"local documents and returns",c,"documents as results."),i.documentReadCount>this.Hi*c?(Ty()<=ys.DEBUG&&yi("QueryEngine","The SDK decides to create cache indexes for query:",i0(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,$f(t))):lr.resolve())}Yi(e,t){if(mE(t))return lr.resolve(null);let i=$f(t);return this.indexManager.getIndexType(e,i).next((c=>c===0?null:(t.limit!==null&&c===1&&(t=B5(t,null,"F"),i=$f(t)),this.indexManager.getDocumentsMatchingTarget(e,i).next((u=>{const m=ds(...u);return this.Ji.getDocuments(e,m).next((_=>this.indexManager.getMinOffset(e,i).next((o=>{const b=this.ts(t,_);return this.ns(t,b,m,o.readTime)?this.Yi(e,B5(t,null,"F")):this.rs(e,b,t,o)}))))})))))}Zi(e,t,i,c){return mE(t)||c.isEqual(Po.min())?lr.resolve(null):this.Ji.getDocuments(e,i).next((u=>{const m=this.ts(t,u);return this.ns(t,m,i,c)?lr.resolve(null):(Ty()<=ys.DEBUG&&yi("QueryEngine","Re-using previous result from %s to execute query: %s",c.toString(),i0(t)),this.rs(e,m,t,mD(c,-1)).next((_=>_)))}))}ts(e,t){let i=new Xu(C9(e));return t.forEach(((c,u)=>{sx(e,u)&&(i=i.add(u))})),i}ns(e,t,i,c){if(e.limit===null)return!1;if(i.size!==t.size)return!0;const u=e.limitType==="F"?t.last():t.first();return!!u&&(u.hasPendingWrites||u.version.compareTo(c)>0)}Xi(e,t,i){return Ty()<=ys.DEBUG&&yi("QueryEngine","Using full collection scan to execute query:",i0(t)),this.Ji.getDocumentsMatchingQuery(e,t,fm.min(),i)}rs(e,t,i,c){return this.Ji.getDocumentsMatchingQuery(e,i,c).next((u=>(t.forEach((m=>{u=u.insert(m.key,m)})),u)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VF{constructor(e,t,i,c){this.persistence=e,this.ss=t,this.serializer=c,this.os=new tc(zs),this._s=new U0((u=>Mw(u)),Nw),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(i)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new PF(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.os)))}}function qF(n,e,t,i){return new VF(n,e,t,i)}async function Z9(n,e){const t=ko(n);return await t.persistence.runTransaction("Handle user change","readonly",(i=>{let c;return t.mutationQueue.getAllMutationBatches(i).next((u=>(c=u,t.ls(e),t.mutationQueue.getAllMutationBatches(i)))).next((u=>{const m=[],_=[];let o=ds();for(const b of c){m.push(b.batchId);for(const I of b.mutations)o=o.add(I.key)}for(const b of u){_.push(b.batchId);for(const I of b.mutations)o=o.add(I.key)}return t.localDocuments.getDocuments(i,o).next((b=>({hs:b,removedBatchIds:m,addedBatchIds:_})))}))}))}function $F(n,e){const t=ko(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(i=>{const c=e.batch.keys(),u=t.cs.newChangeBuffer({trackRemovals:!0});return(function(_,o,b,I){const M=b.batch,V=M.keys();let k=lr.resolve();return V.forEach((ie=>{k=k.next((()=>I.getEntry(o,ie))).next((se=>{const de=b.docVersions.get(ie);ba(de!==null),se.version.compareTo(de)<0&&(M.applyToRemoteDocument(se,b),se.isValidDocument()&&(se.setReadTime(b.commitVersion),I.addEntry(se)))}))})),k.next((()=>_.mutationQueue.removeMutationBatch(o,M)))})(t,i,e,u).next((()=>u.apply(i))).next((()=>t.mutationQueue.performConsistencyCheck(i))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(i,c,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,(function(_){let o=ds();for(let b=0;b<_.mutationResults.length;++b)_.mutationResults[b].transformResults.length>0&&(o=o.add(_.batch.mutations[b].key));return o})(e)))).next((()=>t.localDocuments.getDocuments(i,c)))}))}function Y9(n){const e=ko(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Ur.getLastRemoteSnapshotVersion(t)))}function GF(n,e){const t=ko(n),i=e.snapshotVersion;let c=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(u=>{const m=t.cs.newChangeBuffer({trackRemovals:!0});c=t.os;const _=[];e.targetChanges.forEach(((I,M)=>{const V=c.get(M);if(!V)return;_.push(t.Ur.removeMatchingKeys(u,I.removedDocuments,M).next((()=>t.Ur.addMatchingKeys(u,I.addedDocuments,M))));let k=V.withSequenceNumber(u.currentSequenceNumber);e.targetMismatches.get(M)!==null?k=k.withResumeToken(Zu.EMPTY_BYTE_STRING,Po.min()).withLastLimboFreeSnapshotVersion(Po.min()):I.resumeToken.approximateByteSize()>0&&(k=k.withResumeToken(I.resumeToken,i)),c=c.insert(M,k),(function(se,de,J){return se.resumeToken.approximateByteSize()===0||de.snapshotVersion.toMicroseconds()-se.snapshotVersion.toMicroseconds()>=3e8?!0:J.addedDocuments.size+J.modifiedDocuments.size+J.removedDocuments.size>0})(V,k,I)&&_.push(t.Ur.updateTargetData(u,k))}));let o=Ip(),b=ds();if(e.documentUpdates.forEach((I=>{e.resolvedLimboDocuments.has(I)&&_.push(t.persistence.referenceDelegate.updateLimboDocument(u,I))})),_.push(HF(u,m,e.documentUpdates).next((I=>{o=I.Ps,b=I.Is}))),!i.isEqual(Po.min())){const I=t.Ur.getLastRemoteSnapshotVersion(u).next((M=>t.Ur.setTargetsMetadata(u,u.currentSequenceNumber,i)));_.push(I)}return lr.waitFor(_).next((()=>m.apply(u))).next((()=>t.localDocuments.getLocalViewOfDocuments(u,o,b))).next((()=>o))})).then((u=>(t.os=c,u)))}function HF(n,e,t){let i=ds(),c=ds();return t.forEach((u=>i=i.add(u))),e.getEntries(n,i).next((u=>{let m=Ip();return t.forEach(((_,o)=>{const b=u.get(_);o.isFoundDocument()!==b.isFoundDocument()&&(c=c.add(_)),o.isNoDocument()&&o.version.isEqual(Po.min())?(e.removeEntry(_,o.readTime),m=m.insert(_,o)):!b.isValidDocument()||o.version.compareTo(b.version)>0||o.version.compareTo(b.version)===0&&b.hasPendingWrites?(e.addEntry(o),m=m.insert(_,o)):yi("LocalStore","Ignoring outdated watch update for ",_,". Current version:",b.version," Watch version:",o.version)})),{Ps:m,Is:c}}))}function WF(n,e){const t=ko(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(i=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(i,e))))}function KF(n,e){const t=ko(n);return t.persistence.runTransaction("Allocate target","readwrite",(i=>{let c;return t.Ur.getTargetData(i,e).next((u=>u?(c=u,lr.resolve(c)):t.Ur.allocateTargetId(i).next((m=>(c=new nm(e,m,"TargetPurposeListen",i.currentSequenceNumber),t.Ur.addTargetData(i,c).next((()=>c)))))))})).then((i=>{const c=t.os.get(i.targetId);return(c===null||i.snapshotVersion.compareTo(c.snapshotVersion)>0)&&(t.os=t.os.insert(i.targetId,i),t._s.set(e,i.targetId)),i}))}async function q5(n,e,t){const i=ko(n),c=i.os.get(e),u=t?"readwrite":"readwrite-primary";try{t||await i.persistence.runTransaction("Release target",u,(m=>i.persistence.referenceDelegate.removeTarget(m,c)))}catch(m){if(!T_(m))throw m;yi("LocalStore",`Failed to update sequence numbers for target ${e}: ${m}`)}i.os=i.os.remove(e),i._s.delete(c.target)}function TE(n,e,t){const i=ko(n);let c=Po.min(),u=ds();return i.persistence.runTransaction("Execute query","readwrite",(m=>(function(o,b,I){const M=ko(o),V=M._s.get(I);return V!==void 0?lr.resolve(M.os.get(V)):M.Ur.getTargetData(b,I)})(i,m,$f(e)).next((_=>{if(_)return c=_.lastLimboFreeSnapshotVersion,i.Ur.getMatchingKeysForTargetId(m,_.targetId).next((o=>{u=o}))})).next((()=>i.ss.getDocumentsMatchingQuery(m,e,t?c:Po.min(),t?u:ds()))).next((_=>(XF(i,BD(e),_),{documents:_,Ts:u})))))}function XF(n,e,t){let i=n.us.get(e)||Po.min();t.forEach(((c,u)=>{u.readTime.compareTo(i)>0&&(i=u.readTime)})),n.us.set(e,i)}class IE{constructor(){this.activeTargetIds=$D()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class ZF{constructor(){this.so=new IE,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,i){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new IE,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YF{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CE{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){yi("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){yi("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let E1=null;function Ub(){return E1===null?E1=(function(){return 268435456+Math.round(2147483648*Math.random())})():E1++,"0x"+E1.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JF={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QF{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fh="WebChannelConnection";class eO extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const i=t.ssl?"https":"http",c=encodeURIComponent(this.databaseId.projectId),u=encodeURIComponent(this.databaseId.database);this.Do=i+"://"+t.host,this.vo=`projects/${c}/databases/${u}`,this.Co=this.databaseId.database==="(default)"?`project_id=${c}`:`project_id=${c}&database_id=${u}`}get Fo(){return!1}Mo(t,i,c,u,m){const _=Ub(),o=this.xo(t,i.toUriEncodedString());yi("RestConnection",`Sending RPC '${t}' ${_}:`,o,c);const b={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(b,u,m),this.No(t,o,b,c).then((I=>(yi("RestConnection",`Received RPC '${t}' ${_}: `,I),I)),(I=>{throw A0("RestConnection",`RPC '${t}' ${_} failed with error: `,I,"url: ",o,"request:",c),I}))}Lo(t,i,c,u,m,_){return this.Mo(t,i,c,u,m)}Oo(t,i,c){t["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+z0})(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),i&&i.headers.forEach(((u,m)=>t[m]=u)),c&&c.headers.forEach(((u,m)=>t[m]=u))}xo(t,i){const c=JF[t];return`${this.Do}/v1/${i}:${c}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,i,c){const u=Ub();return new Promise(((m,_)=>{const o=new u9;o.setWithCredentials(!0),o.listenOnce(h9.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case H1.NO_ERROR:const I=o.getResponseJson();yi(fh,`XHR for RPC '${e}' ${u} received:`,JSON.stringify(I)),m(I);break;case H1.TIMEOUT:yi(fh,`RPC '${e}' ${u} timed out`),_(new ui(Yn.DEADLINE_EXCEEDED,"Request time out"));break;case H1.HTTP_ERROR:const M=o.getStatus();if(yi(fh,`RPC '${e}' ${u} failed with status:`,M,"response text:",o.getResponseText()),M>0){let V=o.getResponseJson();Array.isArray(V)&&(V=V[0]);const k=V?.error;if(k&&k.status&&k.message){const ie=(function(de){const J=de.toLowerCase().replace(/_/g,"-");return Object.values(Yn).indexOf(J)>=0?J:Yn.UNKNOWN})(k.status);_(new ui(ie,k.message))}else _(new ui(Yn.UNKNOWN,"Server responded with status "+o.getStatus()))}else _(new ui(Yn.UNAVAILABLE,"Connection failed."));break;default:yo()}}finally{yi(fh,`RPC '${e}' ${u} completed.`)}}));const b=JSON.stringify(c);yi(fh,`RPC '${e}' ${u} sending request:`,c),o.send(t,"POST",b,i,15)}))}Bo(e,t,i){const c=Ub(),u=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],m=p9(),_=f9(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},b=this.longPollingOptions.timeoutSeconds;b!==void 0&&(o.longPollingTimeout=Math.round(1e3*b)),this.useFetchStreams&&(o.useFetchStreams=!0),this.Oo(o.initMessageHeaders,t,i),o.encodeInitMessageHeaders=!0;const I=u.join("");yi(fh,`Creating RPC '${e}' stream ${c}: ${I}`,o);const M=m.createWebChannel(I,o);let V=!1,k=!1;const ie=new QF({Io:de=>{k?yi(fh,`Not sending because RPC '${e}' stream ${c} is closed:`,de):(V||(yi(fh,`Opening RPC '${e}' stream ${c} transport.`),M.open(),V=!0),yi(fh,`RPC '${e}' stream ${c} sending:`,de),M.send(de))},To:()=>M.close()}),se=(de,J,ne)=>{de.listen(J,(me=>{try{ne(me)}catch(ue){setTimeout((()=>{throw ue}),0)}}))};return se(M,Ry.EventType.OPEN,(()=>{k||(yi(fh,`RPC '${e}' stream ${c} transport opened.`),ie.yo())})),se(M,Ry.EventType.CLOSE,(()=>{k||(k=!0,yi(fh,`RPC '${e}' stream ${c} transport closed`),ie.So())})),se(M,Ry.EventType.ERROR,(de=>{k||(k=!0,A0(fh,`RPC '${e}' stream ${c} transport errored:`,de),ie.So(new ui(Yn.UNAVAILABLE,"The operation could not be completed")))})),se(M,Ry.EventType.MESSAGE,(de=>{var J;if(!k){const ne=de.data[0];ba(!!ne);const me=ne,ue=me.error||((J=me[0])===null||J===void 0?void 0:J.error);if(ue){yi(fh,`RPC '${e}' stream ${c} received error:`,ue);const ke=ue.status;let ze=(function(F){const q=Kc[F];if(q!==void 0)return j9(q)})(ke),pe=ue.message;ze===void 0&&(ze=Yn.INTERNAL,pe="Unknown error status: "+ke+" with message "+ue.message),k=!0,ie.So(new ui(ze,pe)),M.close()}else yi(fh,`RPC '${e}' stream ${c} received:`,ne),ie.bo(ne)}})),se(_,d9.STAT_EVENT,(de=>{de.stat===R5.PROXY?yi(fh,`RPC '${e}' stream ${c} detected buffering proxy`):de.stat===R5.NOPROXY&&yi(fh,`RPC '${e}' stream ${c} detected no buffering proxy`)})),setTimeout((()=>{ie.wo()}),0),ie}}function Vb(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ux(n){return new uF(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J9{constructor(e,t,i=1e3,c=1.5,u=6e4){this.ui=e,this.timerId=t,this.ko=i,this.qo=c,this.Qo=u,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),i=Math.max(0,Date.now()-this.Uo),c=Math.max(0,t-i);c>0&&yi("ExponentialBackoff",`Backing off for ${c} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,c,(()=>(this.Uo=Date.now(),e()))),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q9{constructor(e,t,i,c,u,m,_,o){this.ui=e,this.Ho=i,this.Jo=c,this.connection=u,this.authCredentialsProvider=m,this.appCheckCredentialsProvider=_,this.listener=o,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new J9(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,(()=>this.__())))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===Yn.RESOURCE_EXHAUSTED?(Tp(t.toString()),Tp("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===Yn.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([i,c])=>{this.Yo===t&&this.P_(i,c)}),(i=>{e((()=>{const c=new ui(Yn.UNKNOWN,"Fetching auth token failed: "+i.message);return this.I_(c)}))}))}P_(e,t){const i=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo((()=>{i((()=>this.listener.Eo()))})),this.stream.Ro((()=>{i((()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,(()=>(this.r_()&&(this.state=3),Promise.resolve()))),this.listener.Ro())))})),this.stream.mo((c=>{i((()=>this.I_(c)))})),this.stream.onMessage((c=>{i((()=>++this.e_==1?this.E_(c):this.onNext(c)))}))}i_(){this.state=5,this.t_.Go((async()=>{this.state=0,this.start()}))}I_(e){return yi("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget((()=>this.Yo===e?t():(yi("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class tO extends Q9{constructor(e,t,i,c,u,m){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,i,c,m),this.serializer=u}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=fF(this.serializer,e),i=(function(u){if(!("targetChange"in u))return Po.min();const m=u.targetChange;return m.targetIds&&m.targetIds.length?Po.min():m.readTime?Hf(m.readTime):Po.min()})(e);return this.listener.d_(t,i)}A_(e){const t={};t.database=V5(this.serializer),t.addTarget=(function(u,m){let _;const o=m.target;if(_=F5(o)?{documents:gF(u,o)}:{query:yF(u,o)._t},_.targetId=m.targetId,m.resumeToken.approximateByteSize()>0){_.resumeToken=q9(u,m.resumeToken);const b=z5(u,m.expectedCount);b!==null&&(_.expectedCount=b)}else if(m.snapshotVersion.compareTo(Po.min())>0){_.readTime=Av(u,m.snapshotVersion.toTimestamp());const b=z5(u,m.expectedCount);b!==null&&(_.expectedCount=b)}return _})(this.serializer,e);const i=vF(this.serializer,e);i&&(t.labels=i),this.a_(t)}R_(e){const t={};t.database=V5(this.serializer),t.removeTarget=e,this.a_(t)}}class nO extends Q9{constructor(e,t,i,c,u,m){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,c,m),this.serializer=u}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return ba(!!e.streamToken),this.lastStreamToken=e.streamToken,ba(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){ba(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=mF(e.writeResults,e.commitTime),i=Hf(e.commitTime);return this.listener.g_(i,t)}p_(){const e={};e.database=V5(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map((i=>pF(this.serializer,i)))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rO extends class{}{constructor(e,t,i,c){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=i,this.serializer=c,this.y_=!1}w_(){if(this.y_)throw new ui(Yn.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,i,c){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([u,m])=>this.connection.Mo(e,j5(t,i),c,u,m))).catch((u=>{throw u.name==="FirebaseError"?(u.code===Yn.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),u):new ui(Yn.UNKNOWN,u.toString())}))}Lo(e,t,i,c,u){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([m,_])=>this.connection.Lo(e,j5(t,i),c,m,_,u))).catch((m=>{throw m.name==="FirebaseError"?(m.code===Yn.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),m):new ui(Yn.UNKNOWN,m.toString())}))}terminate(){this.y_=!0,this.connection.terminate()}}class iO{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve()))))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Tp(t),this.D_=!1):yi("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oO{constructor(e,t,i,c,u){this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=u,this.k_._o((m=>{i.enqueueAndForget((async()=>{xg(this)&&(yi("RemoteStore","Restarting streams for network reachability change."),await(async function(o){const b=ko(o);b.L_.add(4),await P_(b),b.q_.set("Unknown"),b.L_.delete(4),await hx(b)})(this))}))})),this.q_=new iO(i,c)}}async function hx(n){if(xg(n))for(const e of n.B_)await e(!0)}async function P_(n){for(const e of n.B_)await e(!1)}function eI(n,e){const t=ko(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Gw(t)?$w(t):V0(t).r_()&&qw(t,e))}function Vw(n,e){const t=ko(n),i=V0(t);t.N_.delete(e),i.r_()&&tI(t,e),t.N_.size===0&&(i.r_()?i.o_():xg(t)&&t.q_.set("Unknown"))}function qw(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Po.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}V0(n).A_(e)}function tI(n,e){n.Q_.xe(e),V0(n).R_(e)}function $w(n){n.Q_=new sF({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),V0(n).start(),n.q_.v_()}function Gw(n){return xg(n)&&!V0(n).n_()&&n.N_.size>0}function xg(n){return ko(n).L_.size===0}function nI(n){n.Q_=void 0}async function sO(n){n.q_.set("Online")}async function aO(n){n.N_.forEach(((e,t)=>{qw(n,e)}))}async function lO(n,e){nI(n),Gw(n)?(n.q_.M_(e),$w(n)):n.q_.set("Unknown")}async function cO(n,e,t){if(n.q_.set("Online"),e instanceof V9&&e.state===2&&e.cause)try{await(async function(c,u){const m=u.cause;for(const _ of u.targetIds)c.N_.has(_)&&(await c.remoteSyncer.rejectListen(_,m),c.N_.delete(_),c.Q_.removeTarget(_))})(n,e)}catch(i){yi("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),i),await Tv(n,i)}else if(e instanceof X1?n.Q_.Ke(e):e instanceof U9?n.Q_.He(e):n.Q_.We(e),!t.isEqual(Po.min()))try{const i=await Y9(n.localStore);t.compareTo(i)>=0&&await(function(u,m){const _=u.Q_.rt(m);return _.targetChanges.forEach(((o,b)=>{if(o.resumeToken.approximateByteSize()>0){const I=u.N_.get(b);I&&u.N_.set(b,I.withResumeToken(o.resumeToken,m))}})),_.targetMismatches.forEach(((o,b)=>{const I=u.N_.get(o);if(!I)return;u.N_.set(o,I.withResumeToken(Zu.EMPTY_BYTE_STRING,I.snapshotVersion)),tI(u,o);const M=new nm(I.target,o,b,I.sequenceNumber);qw(u,M)})),u.remoteSyncer.applyRemoteEvent(_)})(n,t)}catch(i){yi("RemoteStore","Failed to raise snapshot:",i),await Tv(n,i)}}async function Tv(n,e,t){if(!T_(e))throw e;n.L_.add(1),await P_(n),n.q_.set("Offline"),t||(t=()=>Y9(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{yi("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await hx(n)}))}function rI(n,e){return e().catch((t=>Tv(n,t,e)))}async function dx(n){const e=ko(n),t=mm(e);let i=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;uO(e);)try{const c=await WF(e.localStore,i);if(c===null){e.O_.length===0&&t.o_();break}i=c.batchId,hO(e,c)}catch(c){await Tv(e,c)}iI(e)&&oI(e)}function uO(n){return xg(n)&&n.O_.length<10}function hO(n,e){n.O_.push(e);const t=mm(n);t.r_()&&t.V_&&t.m_(e.mutations)}function iI(n){return xg(n)&&!mm(n).n_()&&n.O_.length>0}function oI(n){mm(n).start()}async function dO(n){mm(n).p_()}async function fO(n){const e=mm(n);for(const t of n.O_)e.m_(t.mutations)}async function pO(n,e,t){const i=n.O_.shift(),c=Fw.from(i,e,t);await rI(n,(()=>n.remoteSyncer.applySuccessfulWrite(c))),await dx(n)}async function mO(n,e){e&&mm(n).V_&&await(async function(i,c){if((function(m){return rF(m)&&m!==Yn.ABORTED})(c.code)){const u=i.O_.shift();mm(i).s_(),await rI(i,(()=>i.remoteSyncer.rejectFailedWrite(u.batchId,c))),await dx(i)}})(n,e),iI(n)&&oI(n)}async function LE(n,e){const t=ko(n);t.asyncQueue.verifyOperationInProgress(),yi("RemoteStore","RemoteStore received new credentials");const i=xg(t);t.L_.add(3),await P_(t),i&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await hx(t)}async function gO(n,e){const t=ko(n);e?(t.L_.delete(2),await hx(t)):e||(t.L_.add(2),await P_(t),t.q_.set("Unknown"))}function V0(n){return n.K_||(n.K_=(function(t,i,c){const u=ko(t);return u.w_(),new tO(i,u.connection,u.authCredentials,u.appCheckCredentials,u.serializer,c)})(n.datastore,n.asyncQueue,{Eo:sO.bind(null,n),Ro:aO.bind(null,n),mo:lO.bind(null,n),d_:cO.bind(null,n)}),n.B_.push((async e=>{e?(n.K_.s_(),Gw(n)?$w(n):n.q_.set("Unknown")):(await n.K_.stop(),nI(n))}))),n.K_}function mm(n){return n.U_||(n.U_=(function(t,i,c){const u=ko(t);return u.w_(),new nO(i,u.connection,u.authCredentials,u.appCheckCredentials,u.serializer,c)})(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:dO.bind(null,n),mo:mO.bind(null,n),f_:fO.bind(null,n),g_:pO.bind(null,n)}),n.B_.push((async e=>{e?(n.U_.s_(),await dx(n)):(await n.U_.stop(),n.O_.length>0&&(yi("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))}))),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hw{constructor(e,t,i,c,u){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=c,this.removalCallback=u,this.deferred=new bp,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((m=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,i,c,u){const m=Date.now()+i,_=new Hw(e,t,m,c,u);return _.start(i),_}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ui(Yn.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ww(n,e){if(Tp("AsyncQueue",`${e}: ${n}`),T_(n))return new ui(Yn.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v0{constructor(e){this.comparator=e?(t,i)=>e(t,i)||Vi.comparator(t.key,i.key):(t,i)=>Vi.comparator(t.key,i.key),this.keyedMap=My(),this.sortedSet=new tc(this.comparator)}static emptySet(e){return new v0(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,i)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof v0)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;t.hasNext();){const c=t.getNext().key,u=i.getNext().key;if(!c.isEqual(u))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const i=new v0;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=t,i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PE{constructor(){this.W_=new tc(Vi.comparator)}track(e){const t=e.doc.key,i=this.W_.get(t);i?e.type!==0&&i.type===3?this.W_=this.W_.insert(t,e):e.type===3&&i.type!==1?this.W_=this.W_.insert(t,{type:i.type,doc:e.doc}):e.type===2&&i.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&i.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&i.type===0?this.W_=this.W_.remove(t):e.type===1&&i.type===2?this.W_=this.W_.insert(t,{type:1,doc:i.doc}):e.type===0&&i.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):yo():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal(((t,i)=>{e.push(i)})),e}}class P0{constructor(e,t,i,c,u,m,_,o,b){this.query=e,this.docs=t,this.oldDocs=i,this.docChanges=c,this.mutatedKeys=u,this.fromCache=m,this.syncStateChanged=_,this.excludesMetadataChanges=o,this.hasCachedResults=b}static fromInitialDocuments(e,t,i,c,u){const m=[];return t.forEach((_=>{m.push({type:0,doc:_})})),new P0(e,t,v0.emptySet(t),m,i,c,!0,!1,u)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ox(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,i=e.docChanges;if(t.length!==i.length)return!1;for(let c=0;c<t.length;c++)if(t[c].type!==i[c].type||!t[c].doc.isEqual(i[c].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yO{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some((e=>e.J_()))}}class _O{constructor(){this.queries=kE(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,i){const c=ko(t),u=c.queries;c.queries=kE(),u.forEach(((m,_)=>{for(const o of _.j_)o.onError(i)}))})(this,new ui(Yn.ABORTED,"Firestore shutting down"))}}function kE(){return new U0((n=>I9(n)),ox)}async function Kw(n,e){const t=ko(n);let i=3;const c=e.query;let u=t.queries.get(c);u?!u.H_()&&e.J_()&&(i=2):(u=new yO,i=e.J_()?0:1);try{switch(i){case 0:u.z_=await t.onListen(c,!0);break;case 1:u.z_=await t.onListen(c,!1);break;case 2:await t.onFirstRemoteStoreListen(c)}}catch(m){const _=Ww(m,`Initialization of query '${i0(e.query)}' failed`);return void e.onError(_)}t.queries.set(c,u),u.j_.push(e),e.Z_(t.onlineState),u.z_&&e.X_(u.z_)&&Zw(t)}async function Xw(n,e){const t=ko(n),i=e.query;let c=3;const u=t.queries.get(i);if(u){const m=u.j_.indexOf(e);m>=0&&(u.j_.splice(m,1),u.j_.length===0?c=e.J_()?0:1:!u.H_()&&e.J_()&&(c=2))}switch(c){case 0:return t.queries.delete(i),t.onUnlisten(i,!0);case 1:return t.queries.delete(i),t.onUnlisten(i,!1);case 2:return t.onLastRemoteStoreUnlisten(i);default:return}}function vO(n,e){const t=ko(n);let i=!1;for(const c of e){const u=c.query,m=t.queries.get(u);if(m){for(const _ of m.j_)_.X_(c)&&(i=!0);m.z_=c}}i&&Zw(t)}function xO(n,e,t){const i=ko(n),c=i.queries.get(e);if(c)for(const u of c.j_)u.onError(t);i.queries.delete(e)}function Zw(n){n.Y_.forEach((e=>{e.next()}))}var $5,RE;(RE=$5||($5={})).ea="default",RE.Cache="cache";class Yw{constructor(e,t,i){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=i||{}}X_(e){if(!this.options.includeMetadataChanges){const i=[];for(const c of e.docChanges)c.type!==3&&i.push(c);e=new P0(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const i=t!=="Offline";return(!this.options._a||!i)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=P0.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==$5.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sI{constructor(e){this.key=e}}class aI{constructor(e){this.key=e}}class bO{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=ds(),this.mutatedKeys=ds(),this.Aa=C9(e),this.Ra=new v0(this.Aa)}get Va(){return this.Ta}ma(e,t){const i=t?t.fa:new PE,c=t?t.Ra:this.Ra;let u=t?t.mutatedKeys:this.mutatedKeys,m=c,_=!1;const o=this.query.limitType==="F"&&c.size===this.query.limit?c.last():null,b=this.query.limitType==="L"&&c.size===this.query.limit?c.first():null;if(e.inorderTraversal(((I,M)=>{const V=c.get(I),k=sx(this.query,M)?M:null,ie=!!V&&this.mutatedKeys.has(V.key),se=!!k&&(k.hasLocalMutations||this.mutatedKeys.has(k.key)&&k.hasCommittedMutations);let de=!1;V&&k?V.data.isEqual(k.data)?ie!==se&&(i.track({type:3,doc:k}),de=!0):this.ga(V,k)||(i.track({type:2,doc:k}),de=!0,(o&&this.Aa(k,o)>0||b&&this.Aa(k,b)<0)&&(_=!0)):!V&&k?(i.track({type:0,doc:k}),de=!0):V&&!k&&(i.track({type:1,doc:V}),de=!0,(o||b)&&(_=!0)),de&&(k?(m=m.add(k),u=se?u.add(I):u.delete(I)):(m=m.delete(I),u=u.delete(I)))})),this.query.limit!==null)for(;m.size>this.query.limit;){const I=this.query.limitType==="F"?m.last():m.first();m=m.delete(I.key),u=u.delete(I.key),i.track({type:1,doc:I})}return{Ra:m,fa:i,ns:_,mutatedKeys:u}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,i,c){const u=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const m=e.fa.G_();m.sort(((I,M)=>(function(k,ie){const se=de=>{switch(de){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return yo()}};return se(k)-se(ie)})(I.type,M.type)||this.Aa(I.doc,M.doc))),this.pa(i),c=c!=null&&c;const _=t&&!c?this.ya():[],o=this.da.size===0&&this.current&&!c?1:0,b=o!==this.Ea;return this.Ea=o,m.length!==0||b?{snapshot:new P0(this.query,e.Ra,u,m,e.mutatedKeys,o===0,b,!1,!!i&&i.resumeToken.approximateByteSize()>0),wa:_}:{wa:_}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new PE,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach((t=>this.Ta=this.Ta.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ta=this.Ta.delete(t))),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=ds(),this.Ra.forEach((i=>{this.Sa(i.key)&&(this.da=this.da.add(i.key))}));const t=[];return e.forEach((i=>{this.da.has(i)||t.push(new aI(i))})),this.da.forEach((i=>{e.has(i)||t.push(new sI(i))})),t}ba(e){this.Ta=e.Ts,this.da=ds();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return P0.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class wO{constructor(e,t,i){this.query=e,this.targetId=t,this.view=i}}class SO{constructor(e){this.key=e,this.va=!1}}class EO{constructor(e,t,i,c,u,m){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=c,this.currentUser=u,this.maxConcurrentLimboResolutions=m,this.Ca={},this.Fa=new U0((_=>I9(_)),ox),this.Ma=new Map,this.xa=new Set,this.Oa=new tc(Vi.comparator),this.Na=new Map,this.La=new zw,this.Ba={},this.ka=new Map,this.qa=L0.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function AO(n,e,t=!0){const i=fI(n);let c;const u=i.Fa.get(e);return u?(i.sharedClientState.addLocalQueryTarget(u.targetId),c=u.view.Da()):c=await lI(i,e,t,!0),c}async function TO(n,e){const t=fI(n);await lI(t,e,!0,!1)}async function lI(n,e,t,i){const c=await KF(n.localStore,$f(e)),u=c.targetId,m=n.sharedClientState.addLocalQueryTarget(u,t);let _;return i&&(_=await IO(n,e,u,m==="current",c.resumeToken)),n.isPrimaryClient&&t&&eI(n.remoteStore,c),_}async function IO(n,e,t,i,c){n.Ka=(M,V,k)=>(async function(se,de,J,ne){let me=de.view.ma(J);me.ns&&(me=await TE(se.localStore,de.query,!1).then((({documents:pe})=>de.view.ma(pe,me))));const ue=ne&&ne.targetChanges.get(de.targetId),ke=ne&&ne.targetMismatches.get(de.targetId)!=null,ze=de.view.applyChanges(me,se.isPrimaryClient,ue,ke);return NE(se,de.targetId,ze.wa),ze.snapshot})(n,M,V,k);const u=await TE(n.localStore,e,!0),m=new bO(e,u.Ts),_=m.ma(u.documents),o=L_.createSynthesizedTargetChangeForCurrentChange(t,i&&n.onlineState!=="Offline",c),b=m.applyChanges(_,n.isPrimaryClient,o);NE(n,t,b.wa);const I=new wO(e,t,m);return n.Fa.set(e,I),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),b.snapshot}async function CO(n,e,t){const i=ko(n),c=i.Fa.get(e),u=i.Ma.get(c.targetId);if(u.length>1)return i.Ma.set(c.targetId,u.filter((m=>!ox(m,e)))),void i.Fa.delete(e);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(c.targetId),i.sharedClientState.isActiveQueryTarget(c.targetId)||await q5(i.localStore,c.targetId,!1).then((()=>{i.sharedClientState.clearQueryState(c.targetId),t&&Vw(i.remoteStore,c.targetId),G5(i,c.targetId)})).catch(A_)):(G5(i,c.targetId),await q5(i.localStore,c.targetId,!0))}async function LO(n,e){const t=ko(n),i=t.Fa.get(e),c=t.Ma.get(i.targetId);t.isPrimaryClient&&c.length===1&&(t.sharedClientState.removeLocalQueryTarget(i.targetId),Vw(t.remoteStore,i.targetId))}async function PO(n,e,t){const i=OO(n);try{const c=await(function(m,_){const o=ko(m),b=du.now(),I=_.reduce(((k,ie)=>k.add(ie.key)),ds());let M,V;return o.persistence.runTransaction("Locally write mutations","readwrite",(k=>{let ie=Ip(),se=ds();return o.cs.getEntries(k,I).next((de=>{ie=de,ie.forEach(((J,ne)=>{ne.isValidDocument()||(se=se.add(J))}))})).next((()=>o.localDocuments.getOverlayedDocuments(k,ie))).next((de=>{M=de;const J=[];for(const ne of _){const me=JD(ne,M.get(ne.key).overlayedDocument);me!=null&&J.push(new vg(ne.key,me,v9(me.value.mapValue),Gf.exists(!0)))}return o.mutationQueue.addMutationBatch(k,b,J,_)})).next((de=>{V=de;const J=de.applyToLocalDocumentSet(M,se);return o.documentOverlayCache.saveOverlays(k,de.batchId,J)}))})).then((()=>({batchId:V.batchId,changes:P9(M)})))})(i.localStore,e);i.sharedClientState.addPendingMutation(c.batchId),(function(m,_,o){let b=m.Ba[m.currentUser.toKey()];b||(b=new tc(zs)),b=b.insert(_,o),m.Ba[m.currentUser.toKey()]=b})(i,c.batchId,t),await k_(i,c.changes),await dx(i.remoteStore)}catch(c){const u=Ww(c,"Failed to persist write");t.reject(u)}}async function cI(n,e){const t=ko(n);try{const i=await GF(t.localStore,e);e.targetChanges.forEach(((c,u)=>{const m=t.Na.get(u);m&&(ba(c.addedDocuments.size+c.modifiedDocuments.size+c.removedDocuments.size<=1),c.addedDocuments.size>0?m.va=!0:c.modifiedDocuments.size>0?ba(m.va):c.removedDocuments.size>0&&(ba(m.va),m.va=!1))})),await k_(t,i,e)}catch(i){await A_(i)}}function ME(n,e,t){const i=ko(n);if(i.isPrimaryClient&&t===0||!i.isPrimaryClient&&t===1){const c=[];i.Fa.forEach(((u,m)=>{const _=m.view.Z_(e);_.snapshot&&c.push(_.snapshot)})),(function(m,_){const o=ko(m);o.onlineState=_;let b=!1;o.queries.forEach(((I,M)=>{for(const V of M.j_)V.Z_(_)&&(b=!0)})),b&&Zw(o)})(i.eventManager,e),c.length&&i.Ca.d_(c),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function kO(n,e,t){const i=ko(n);i.sharedClientState.updateQueryState(e,"rejected",t);const c=i.Na.get(e),u=c&&c.key;if(u){let m=new tc(Vi.comparator);m=m.insert(u,yh.newNoDocument(u,Po.min()));const _=ds().add(u),o=new cx(Po.min(),new Map,new tc(zs),m,_);await cI(i,o),i.Oa=i.Oa.remove(u),i.Na.delete(e),Jw(i)}else await q5(i.localStore,e,!1).then((()=>G5(i,e,t))).catch(A_)}async function RO(n,e){const t=ko(n),i=e.batch.batchId;try{const c=await $F(t.localStore,e);hI(t,i,null),uI(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),await k_(t,c)}catch(c){await A_(c)}}async function MO(n,e,t){const i=ko(n);try{const c=await(function(m,_){const o=ko(m);return o.persistence.runTransaction("Reject batch","readwrite-primary",(b=>{let I;return o.mutationQueue.lookupMutationBatch(b,_).next((M=>(ba(M!==null),I=M.keys(),o.mutationQueue.removeMutationBatch(b,M)))).next((()=>o.mutationQueue.performConsistencyCheck(b))).next((()=>o.documentOverlayCache.removeOverlaysForBatchId(b,I,_))).next((()=>o.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(b,I))).next((()=>o.localDocuments.getDocuments(b,I)))}))})(i.localStore,e);hI(i,e,t),uI(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),await k_(i,c)}catch(c){await A_(c)}}function uI(n,e){(n.ka.get(e)||[]).forEach((t=>{t.resolve()})),n.ka.delete(e)}function hI(n,e,t){const i=ko(n);let c=i.Ba[i.currentUser.toKey()];if(c){const u=c.get(e);u&&(t?u.reject(t):u.resolve(),c=c.remove(e)),i.Ba[i.currentUser.toKey()]=c}}function G5(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const i of n.Ma.get(e))n.Fa.delete(i),t&&n.Ca.$a(i,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach((i=>{n.La.containsKey(i)||dI(n,i)}))}function dI(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(Vw(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),Jw(n))}function NE(n,e,t){for(const i of t)i instanceof sI?(n.La.addReference(i.key,e),NO(n,i)):i instanceof aI?(yi("SyncEngine","Document no longer in limbo: "+i.key),n.La.removeReference(i.key,e),n.La.containsKey(i.key)||dI(n,i.key)):yo()}function NO(n,e){const t=e.key,i=t.path.canonicalString();n.Oa.get(t)||n.xa.has(i)||(yi("SyncEngine","New document in limbo: "+t),n.xa.add(i),Jw(n))}function Jw(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new Vi(vl.fromString(e)),i=n.qa.next();n.Na.set(i,new SO(t)),n.Oa=n.Oa.insert(t,i),eI(n.remoteStore,new nm($f(ix(t.path)),i,"TargetPurposeLimboResolution",Lw.oe))}}async function k_(n,e,t){const i=ko(n),c=[],u=[],m=[];i.Fa.isEmpty()||(i.Fa.forEach(((_,o)=>{m.push(i.Ka(o,e,t).then((b=>{var I;if((b||t)&&i.isPrimaryClient){const M=b?!b.fromCache:(I=t?.targetChanges.get(o.targetId))===null||I===void 0?void 0:I.current;i.sharedClientState.updateQueryState(o.targetId,M?"current":"not-current")}if(b){c.push(b);const M=Uw.Wi(o.targetId,b);u.push(M)}})))})),await Promise.all(m),i.Ca.d_(c),await(async function(o,b){const I=ko(o);try{await I.persistence.runTransaction("notifyLocalViewChanges","readwrite",(M=>lr.forEach(b,(V=>lr.forEach(V.$i,(k=>I.persistence.referenceDelegate.addReference(M,V.targetId,k))).next((()=>lr.forEach(V.Ui,(k=>I.persistence.referenceDelegate.removeReference(M,V.targetId,k)))))))))}catch(M){if(!T_(M))throw M;yi("LocalStore","Failed to update sequence numbers: "+M)}for(const M of b){const V=M.targetId;if(!M.fromCache){const k=I.os.get(V),ie=k.snapshotVersion,se=k.withLastLimboFreeSnapshotVersion(ie);I.os=I.os.insert(V,se)}}})(i.localStore,u))}async function DO(n,e){const t=ko(n);if(!t.currentUser.isEqual(e)){yi("SyncEngine","User change. New user:",e.toKey());const i=await Z9(t.localStore,e);t.currentUser=e,(function(u,m){u.ka.forEach((_=>{_.forEach((o=>{o.reject(new ui(Yn.CANCELLED,m))}))})),u.ka.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),await k_(t,i.hs)}}function FO(n,e){const t=ko(n),i=t.Na.get(e);if(i&&i.va)return ds().add(i.key);{let c=ds();const u=t.Ma.get(e);if(!u)return c;for(const m of u){const _=t.Fa.get(m);c=c.unionWith(_.view.Va)}return c}}function fI(n){const e=ko(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=cI.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=FO.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=kO.bind(null,e),e.Ca.d_=vO.bind(null,e.eventManager),e.Ca.$a=xO.bind(null,e.eventManager),e}function OO(n){const e=ko(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=RO.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=MO.bind(null,e),e}class Iv{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=ux(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return qF(this.persistence,new UF,e.initialUser,this.serializer)}Ga(e){return new BF(jw.Zr,this.serializer)}Wa(e){return new ZF}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Iv.provider={build:()=>new Iv};class H5{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>ME(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=DO.bind(null,this.syncEngine),await gO(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new _O})()}createDatastore(e){const t=ux(e.databaseInfo.databaseId),i=(function(u){return new eO(u)})(e.databaseInfo);return(function(u,m,_,o){return new rO(u,m,_,o)})(e.authCredentials,e.appCheckCredentials,i,t)}createRemoteStore(e){return(function(i,c,u,m,_){return new oO(i,c,u,m,_)})(this.localStore,this.datastore,e.asyncQueue,(t=>ME(this.syncEngine,t,0)),(function(){return CE.D()?new CE:new YF})())}createSyncEngine(e,t){return(function(c,u,m,_,o,b,I){const M=new EO(c,u,m,_,o,b);return I&&(M.Qa=!0),M})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await(async function(c){const u=ko(c);yi("RemoteStore","RemoteStore shutting down."),u.L_.add(5),await P_(u),u.k_.shutdown(),u.q_.set("Unknown")})(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}H5.provider={build:()=>new H5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qw{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Tp("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BO{constructor(e,t,i,c,u){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this.databaseInfo=c,this.user=gh.UNAUTHENTICATED,this.clientId=g9.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=u,this.authCredentials.start(i,(async m=>{yi("FirestoreClient","Received user=",m.uid),await this.authCredentialListener(m),this.user=m})),this.appCheckCredentials.start(i,(m=>(yi("FirestoreClient","Received new app check token=",m),this.appCheckCredentialListener(m,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new bp;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const i=Ww(t,"Failed to shutdown persistence");e.reject(i)}})),e.promise}}async function qb(n,e){n.asyncQueue.verifyOperationInProgress(),yi("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let i=t.initialUser;n.setCredentialChangeListener((async c=>{i.isEqual(c)||(await Z9(e.localStore,c),i=c)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function DE(n,e){n.asyncQueue.verifyOperationInProgress();const t=await zO(n);yi("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((i=>LE(e.remoteStore,i))),n.setAppCheckTokenChangeListener(((i,c)=>LE(e.remoteStore,c))),n._onlineComponents=e}async function zO(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){yi("FirestoreClient","Using user provided OfflineComponentProvider");try{await qb(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(c){return c.name==="FirebaseError"?c.code===Yn.FAILED_PRECONDITION||c.code===Yn.UNIMPLEMENTED:!(typeof DOMException<"u"&&c instanceof DOMException)||c.code===22||c.code===20||c.code===11})(t))throw t;A0("Error using user provided cache. Falling back to memory cache: "+t),await qb(n,new Iv)}}else yi("FirestoreClient","Using default OfflineComponentProvider"),await qb(n,new Iv);return n._offlineComponents}async function pI(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(yi("FirestoreClient","Using user provided OnlineComponentProvider"),await DE(n,n._uninitializedComponentsProvider._online)):(yi("FirestoreClient","Using default OnlineComponentProvider"),await DE(n,new H5))),n._onlineComponents}function jO(n){return pI(n).then((e=>e.syncEngine))}async function Cv(n){const e=await pI(n),t=e.eventManager;return t.onListen=AO.bind(null,e.syncEngine),t.onUnlisten=CO.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=TO.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=LO.bind(null,e.syncEngine),t}function UO(n,e,t={}){const i=new bp;return n.asyncQueue.enqueueAndForget((async()=>(function(u,m,_,o,b){const I=new Qw({next:V=>{I.Za(),m.enqueueAndForget((()=>Xw(u,M)));const k=V.docs.has(_);!k&&V.fromCache?b.reject(new ui(Yn.UNAVAILABLE,"Failed to get document because the client is offline.")):k&&V.fromCache&&o&&o.source==="server"?b.reject(new ui(Yn.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):b.resolve(V)},error:V=>b.reject(V)}),M=new Yw(ix(_.path),I,{includeMetadataChanges:!0,_a:!0});return Kw(u,M)})(await Cv(n),n.asyncQueue,e,t,i))),i.promise}function VO(n,e,t={}){const i=new bp;return n.asyncQueue.enqueueAndForget((async()=>(function(u,m,_,o,b){const I=new Qw({next:V=>{I.Za(),m.enqueueAndForget((()=>Xw(u,M))),V.fromCache&&o.source==="server"?b.reject(new ui(Yn.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):b.resolve(V)},error:V=>b.reject(V)}),M=new Yw(_,I,{includeMetadataChanges:!0,_a:!0});return Kw(u,M)})(await Cv(n),n.asyncQueue,e,t,i))),i.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mI(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FE=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gI(n,e,t){if(!t)throw new ui(Yn.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function qO(n,e,t,i){if(e===!0&&i===!0)throw new ui(Yn.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function OE(n){if(!Vi.isDocumentKey(n))throw new ui(Yn.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function BE(n){if(Vi.isDocumentKey(n))throw new ui(Yn.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function fx(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(i){return i.constructor?i.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":yo()}function sf(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new ui(Yn.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=fx(n);throw new ui(Yn.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zE{constructor(e){var t,i;if(e.host===void 0){if(e.ssl!==void 0)throw new ui(Yn.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new ui(Yn.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}qO("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=mI((i=e.experimentalLongPollingOptions)!==null&&i!==void 0?i:{}),(function(u){if(u.timeoutSeconds!==void 0){if(isNaN(u.timeoutSeconds))throw new ui(Yn.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (must not be NaN)`);if(u.timeoutSeconds<5)throw new ui(Yn.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (minimum allowed value is 5)`);if(u.timeoutSeconds>30)throw new ui(Yn.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(i,c){return i.timeoutSeconds===c.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class px{constructor(e,t,i,c){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=c,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new zE({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ui(Yn.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new ui(Yn.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new zE(e),e.credentials!==void 0&&(this._authCredentials=(function(i){if(!i)return new sD;switch(i.type){case"firstParty":return new uD(i.sessionIndex||"0",i.iamToken||null,i.authTokenFactory||null);case"provider":return i.client;default:throw new ui(Yn.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const i=FE.get(t);i&&(yi("ComponentProvider","Removing Datastore"),FE.delete(t),i.terminate())})(this),Promise.resolve()}}function $O(n,e,t,i={}){var c;const u=(n=sf(n,px))._getSettings(),m=`${e}:${t}`;if(u.host!=="firestore.googleapis.com"&&u.host!==m&&A0("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},u),{host:m,ssl:!1})),i.mockUserToken){let _,o;if(typeof i.mockUserToken=="string")_=i.mockUserToken,o=gh.MOCK_USER;else{_=NM(i.mockUserToken,(c=n._app)===null||c===void 0?void 0:c.options.projectId);const b=i.mockUserToken.sub||i.mockUserToken.user_id;if(!b)throw new ui(Yn.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");o=new gh(b)}n._authCredentials=new aD(new m9(_,o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bg{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new bg(this.firestore,e,this._query)}}class Lh{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new lm(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Lh(this.firestore,e,this._key)}}class lm extends bg{constructor(e,t,i){super(e,t,ix(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Lh(this.firestore,null,new Vi(e))}withConverter(e){return new lm(this.firestore,e,this._path)}}function Vm(n,e,...t){if(n=Ph(n),gI("collection","path",e),n instanceof px){const i=vl.fromString(e,...t);return BE(i),new lm(n,null,i)}{if(!(n instanceof Lh||n instanceof lm))throw new ui(Yn.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(vl.fromString(e,...t));return BE(i),new lm(n.firestore,null,i)}}function u0(n,e,...t){if(n=Ph(n),arguments.length===1&&(e=g9.newId()),gI("doc","path",e),n instanceof px){const i=vl.fromString(e,...t);return OE(i),new Lh(n,null,new Vi(i))}{if(!(n instanceof Lh||n instanceof lm))throw new ui(Yn.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(vl.fromString(e,...t));return OE(i),new Lh(n.firestore,n instanceof lm?n.converter:null,new Vi(i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jE{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new J9(this,"async_queue_retry"),this.Vu=()=>{const i=Vb();i&&yi("AsyncQueue","Visibility state changed to "+i.visibilityState),this.t_.jo()},this.mu=e;const t=Vb();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=Vb();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise((()=>{}));const t=new bp;return this.gu((()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Pu.push(e),this.pu())))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!T_(e))throw e;yi("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go((()=>this.pu()))}}gu(e){const t=this.mu.then((()=>(this.du=!0,e().catch((i=>{this.Eu=i,this.du=!1;const c=(function(m){let _=m.message||"";return m.stack&&(_=m.stack.includes(m.message)?m.stack:m.message+`
`+m.stack),_})(i);throw Tp("INTERNAL UNHANDLED ERROR: ",c),i})).then((i=>(this.du=!1,i))))));return this.mu=t,t}enqueueAfterDelay(e,t,i){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const c=Hw.createAndSchedule(this,e,t,i,(u=>this.yu(u)));return this.Tu.push(c),c}fu(){this.Eu&&yo()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then((()=>{this.Tu.sort(((t,i)=>t.targetTimeMs-i.targetTimeMs));for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()}))}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function UE(n){return(function(t,i){if(typeof t!="object"||t===null)return!1;const c=t;for(const u of i)if(u in c&&typeof c[u]=="function")return!0;return!1})(n,["next","error","complete"])}class hg extends px{constructor(e,t,i,c){super(e,t,i,c),this.type="firestore",this._queue=new jE,this._persistenceKey=c?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new jE(e),this._firestoreClient=void 0,await e}}}function GO(n,e){const t=typeof n=="object"?n:s9(),i=typeof n=="string"?n:"(default)",c=Iw(t,"firestore").getImmediate({identifier:i});if(!c._initialized){const u=RM("firestore");u&&$O(c,...u)}return c}function mx(n){if(n._terminated)throw new ui(Yn.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||HO(n),n._firestoreClient}function HO(n){var e,t,i;const c=n._freezeSettings(),u=(function(_,o,b,I){return new SD(_,o,b,I.host,I.ssl,I.experimentalForceLongPolling,I.experimentalAutoDetectLongPolling,mI(I.experimentalLongPollingOptions),I.useFetchStreams)})(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,c);n._componentsProvider||!((t=c.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((i=c.localCache)===null||i===void 0)&&i._onlineComponentProvider)&&(n._componentsProvider={_offline:c.localCache._offlineComponentProvider,_online:c.localCache._onlineComponentProvider}),n._firestoreClient=new BO(n._authCredentials,n._appCheckCredentials,n._queue,u,n._componentsProvider&&(function(_){const o=_?._online.build();return{_offline:_?._offline.build(o),_online:o}})(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k0{constructor(e){this._byteString=e}static fromBase64String(e){try{return new k0(Zu.fromBase64String(e))}catch(t){throw new ui(Yn.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new k0(Zu.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e3{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new ui(Yn.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ku(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t3{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gx{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new ui(Yn.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new ui(Yn.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return zs(this._lat,e._lat)||zs(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n3{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(i,c){if(i.length!==c.length)return!1;for(let u=0;u<i.length;++u)if(i[u]!==c[u])return!1;return!0})(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WO=/^__.*__$/;class KO{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return this.fieldMask!==null?new vg(e,this.data,this.fieldMask,t,this.fieldTransforms):new C_(e,this.data,t,this.fieldTransforms)}}function yI(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw yo()}}class r3{constructor(e,t,i,c,u,m){this.settings=e,this.databaseId=t,this.serializer=i,this.ignoreUndefinedProperties=c,u===void 0&&this.vu(),this.fieldTransforms=u||[],this.fieldMask=m||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new r3(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const i=(t=this.path)===null||t===void 0?void 0:t.child(e),c=this.Fu({path:i,xu:!1});return c.Ou(e),c}Nu(e){var t;const i=(t=this.path)===null||t===void 0?void 0:t.child(e),c=this.Fu({path:i,xu:!1});return c.vu(),c}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Lv(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(yI(this.Cu)&&WO.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class XO{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=i||ux(e)}Qu(e,t,i,c=!1){return new r3({Cu:e,methodName:t,qu:i,path:Ku.emptyPath(),xu:!1,ku:c},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function i3(n){const e=n._freezeSettings(),t=ux(n._databaseId);return new XO(n._databaseId,!!e.ignoreUndefinedProperties,t)}function _I(n,e,t,i,c,u={}){const m=n.Qu(u.merge||u.mergeFields?2:0,e,t,c);bI("Data must be an object, but it was:",m,i);const _=vI(i,m);let o,b;if(u.merge)o=new of(m.fieldMask),b=m.fieldTransforms;else if(u.mergeFields){const I=[];for(const M of u.mergeFields){const V=YO(e,M,t);if(!m.contains(V))throw new ui(Yn.INVALID_ARGUMENT,`Field '${V}' is specified in your field mask but missing from your input data.`);QO(I,V)||I.push(V)}o=new of(I),b=m.fieldTransforms.filter((M=>o.covers(M.field)))}else o=null,b=m.fieldTransforms;return new KO(new Md(_),o,b)}class o3 extends t3{_toFieldTransform(e){return new KD(e.path,new d_)}isEqual(e){return e instanceof o3}}function ZO(n,e,t,i=!1){return s3(t,n.Qu(i?4:3,e))}function s3(n,e){if(xI(n=Ph(n)))return bI("Unsupported field value:",e,n),vI(n,e);if(n instanceof t3)return(function(i,c){if(!yI(c.Cu))throw c.Bu(`${i._methodName}() can only be used with update() and set()`);if(!c.path)throw c.Bu(`${i._methodName}() is not currently supported inside arrays`);const u=i._toFieldTransform(c);u&&c.fieldTransforms.push(u)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return(function(i,c){const u=[];let m=0;for(const _ of i){let o=s3(_,c.Lu(m));o==null&&(o={nullValue:"NULL_VALUE"}),u.push(o),m++}return{arrayValue:{values:u}}})(n,e)}return(function(i,c){if((i=Ph(i))===null)return{nullValue:"NULL_VALUE"};if(typeof i=="number")return GD(c.serializer,i);if(typeof i=="boolean")return{booleanValue:i};if(typeof i=="string")return{stringValue:i};if(i instanceof Date){const u=du.fromDate(i);return{timestampValue:Av(c.serializer,u)}}if(i instanceof du){const u=new du(i.seconds,1e3*Math.floor(i.nanoseconds/1e3));return{timestampValue:Av(c.serializer,u)}}if(i instanceof gx)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof k0)return{bytesValue:q9(c.serializer,i._byteString)};if(i instanceof Lh){const u=c.databaseId,m=i.firestore._databaseId;if(!m.isEqual(u))throw c.Bu(`Document reference is for database ${m.projectId}/${m.database} but should be for database ${u.projectId}/${u.database}`);return{referenceValue:Bw(i.firestore._databaseId||c.databaseId,i._key.path)}}if(i instanceof n3)return(function(m,_){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:m.toArray().map((o=>{if(typeof o!="number")throw _.Bu("VectorValues must only contain numeric values.");return Dw(_.serializer,o)}))}}}}}})(i,c);throw c.Bu(`Unsupported field value: ${fx(i)}`)})(n,e)}function vI(n,e){const t={};return y9(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):j0(n,((i,c)=>{const u=s3(c,e.Mu(i));u!=null&&(t[i]=u)})),{mapValue:{fields:t}}}function xI(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof du||n instanceof gx||n instanceof k0||n instanceof Lh||n instanceof t3||n instanceof n3)}function bI(n,e,t){if(!xI(t)||!(function(c){return typeof c=="object"&&c!==null&&(Object.getPrototypeOf(c)===Object.prototype||Object.getPrototypeOf(c)===null)})(t)){const i=fx(t);throw i==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+i)}}function YO(n,e,t){if((e=Ph(e))instanceof e3)return e._internalPath;if(typeof e=="string")return wI(n,e);throw Lv("Field path arguments must be of type string or ",n,!1,void 0,t)}const JO=new RegExp("[~\\*/\\[\\]]");function wI(n,e,t){if(e.search(JO)>=0)throw Lv(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new e3(...e.split("."))._internalPath}catch{throw Lv(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Lv(n,e,t,i,c){const u=i&&!i.isEmpty(),m=c!==void 0;let _=`Function ${e}() called with invalid data`;t&&(_+=" (via `toFirestore()`)"),_+=". ";let o="";return(u||m)&&(o+=" (found",u&&(o+=` in field ${i}`),m&&(o+=` in document ${c}`),o+=")"),new ui(Yn.INVALID_ARGUMENT,_+n+o)}function QO(n,e){return n.some((t=>t.isEqual(e)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SI{constructor(e,t,i,c,u){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=c,this._converter=u}get id(){return this._key.path.lastSegment()}get ref(){return new Lh(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new eB(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(a3("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class eB extends SI{data(){return super.data()}}function a3(n,e){return typeof e=="string"?wI(n,e):e instanceof e3?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EI(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new ui(Yn.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class l3{}class tB extends l3{}function VE(n,e,...t){let i=[];e instanceof l3&&i.push(e),i=i.concat(t),(function(u){const m=u.filter((o=>o instanceof c3)).length,_=u.filter((o=>o instanceof yx)).length;if(m>1||m>0&&_>0)throw new ui(Yn.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(i);for(const c of i)n=c._apply(n);return n}class yx extends tB{constructor(e,t,i){super(),this._field=e,this._op=t,this._value=i,this.type="where"}static _create(e,t,i){return new yx(e,t,i)}_apply(e){const t=this._parse(e);return AI(e._query,t),new bg(e.firestore,e.converter,O5(e._query,t))}_parse(e){const t=i3(e.firestore);return(function(u,m,_,o,b,I,M){let V;if(b.isKeyField()){if(I==="array-contains"||I==="array-contains-any")throw new ui(Yn.INVALID_ARGUMENT,`Invalid Query. You can't perform '${I}' queries on documentId().`);if(I==="in"||I==="not-in"){$E(M,I);const k=[];for(const ie of M)k.push(qE(o,u,ie));V={arrayValue:{values:k}}}else V=qE(o,u,M)}else I!=="in"&&I!=="not-in"&&I!=="array-contains-any"||$E(M,I),V=ZO(_,m,M,I==="in"||I==="not-in");return Zc.create(b,I,V)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function nB(n,e,t){const i=e,c=a3("where",n);return yx._create(c,i,t)}class c3 extends l3{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new c3(e,t)}_parse(e){const t=this._queryConstraints.map((i=>i._parse(e))).filter((i=>i.getFilters().length>0));return t.length===1?t[0]:cf.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(c,u){let m=c;const _=u.getFlattenedFilters();for(const o of _)AI(m,o),m=O5(m,o)})(e._query,t),new bg(e.firestore,e.converter,O5(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function qE(n,e,t){if(typeof(t=Ph(t))=="string"){if(t==="")throw new ui(Yn.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!T9(e)&&t.indexOf("/")!==-1)throw new ui(Yn.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const i=e.path.child(vl.fromString(t));if(!Vi.isDocumentKey(i))throw new ui(Yn.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return cE(n,new Vi(i))}if(t instanceof Lh)return cE(n,t._key);throw new ui(Yn.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${fx(t)}.`)}function $E(n,e){if(!Array.isArray(n)||n.length===0)throw new ui(Yn.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function AI(n,e){const t=(function(c,u){for(const m of c)for(const _ of m.getFlattenedFilters())if(u.indexOf(_.op)>=0)return _.op;return null})(n.filters,(function(c){switch(c){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new ui(Yn.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new ui(Yn.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class rB{convertValue(e,t="none"){switch(ug(e)){case 0:return null;case 1:return e.booleanValue;case 2:return kc(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(cg(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw yo()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const i={};return j0(e,((c,u)=>{i[c]=this.convertValue(u,t)})),i}convertVectorValue(e){var t,i,c;const u=(c=(i=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||i===void 0?void 0:i.values)===null||c===void 0?void 0:c.map((m=>kc(m.doubleValue)));return new n3(u)}convertGeoPoint(e){return new gx(kc(e.latitude),kc(e.longitude))}convertArray(e,t){return(e.values||[]).map((i=>this.convertValue(i,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const i=kw(e);return i==null?null:this.convertValue(i,t);case"estimate":return this.convertTimestamp(c_(e));default:return null}}convertTimestamp(e){const t=pm(e);return new du(t.seconds,t.nanos)}convertDocumentKey(e,t){const i=vl.fromString(e);ba(X9(i));const c=new u_(i.get(1),i.get(3)),u=new Vi(i.popFirst(5));return c.isEqual(t)||Tp(`Document ${u} contains a document reference within a different database (${c.projectId}/${c.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TI(n,e,t){let i;return i=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dy{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class II extends SI{constructor(e,t,i,c,u,m){super(e,t,i,c,m),this._firestore=e,this._firestoreImpl=e,this.metadata=u}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Z1(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const i=this._document.data.field(a3("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}}class Z1 extends II{data(e={}){return super.data(e)}}class CI{constructor(e,t,i,c){this._firestore=e,this._userDataWriter=t,this._snapshot=c,this.metadata=new Dy(c.hasPendingWrites,c.fromCache),this.query=i}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((i=>{e.call(t,new Z1(this._firestore,this._userDataWriter,i.key,i,new Dy(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new ui(Yn.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(c,u){if(c._snapshot.oldDocs.isEmpty()){let m=0;return c._snapshot.docChanges.map((_=>{const o=new Z1(c._firestore,c._userDataWriter,_.doc.key,_.doc,new Dy(c._snapshot.mutatedKeys.has(_.doc.key),c._snapshot.fromCache),c.query.converter);return _.doc,{type:"added",doc:o,oldIndex:-1,newIndex:m++}}))}{let m=c._snapshot.oldDocs;return c._snapshot.docChanges.filter((_=>u||_.type!==3)).map((_=>{const o=new Z1(c._firestore,c._userDataWriter,_.doc.key,_.doc,new Dy(c._snapshot.mutatedKeys.has(_.doc.key),c._snapshot.fromCache),c.query.converter);let b=-1,I=-1;return _.type!==0&&(b=m.indexOf(_.doc.key),m=m.delete(_.doc.key)),_.type!==1&&(m=m.add(_.doc),I=m.indexOf(_.doc.key)),{type:iB(_.type),doc:o,oldIndex:b,newIndex:I}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function iB(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return yo()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GE(n){n=sf(n,Lh);const e=sf(n.firestore,hg);return UO(mx(e),n._key).then((t=>PI(e,n,t)))}class u3 extends rB{constructor(e){super(),this.firestore=e}convertBytes(e){return new k0(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Lh(this.firestore,null,t)}}function A1(n){n=sf(n,bg);const e=sf(n.firestore,hg),t=mx(e),i=new u3(e);return EI(n._query),VO(t,n._query).then((c=>new CI(e,i,n,c)))}function W5(n,e,t){n=sf(n,Lh);const i=sf(n.firestore,hg),c=TI(n.converter,e,t);return LI(i,[_I(i3(i),"setDoc",n._key,c,n.converter!==null,t).toMutation(n._key,Gf.none())])}function HE(n,e){const t=sf(n.firestore,hg),i=u0(n),c=TI(n.converter,e);return LI(t,[_I(i3(n.firestore),"addDoc",i._key,c,n.converter!==null,{}).toMutation(i._key,Gf.exists(!1))]).then((()=>i))}function oB(n,...e){var t,i,c;n=Ph(n);let u={includeMetadataChanges:!1,source:"default"},m=0;typeof e[m]!="object"||UE(e[m])||(u=e[m],m++);const _={includeMetadataChanges:u.includeMetadataChanges,source:u.source};if(UE(e[m])){const M=e[m];e[m]=(t=M.next)===null||t===void 0?void 0:t.bind(M),e[m+1]=(i=M.error)===null||i===void 0?void 0:i.bind(M),e[m+2]=(c=M.complete)===null||c===void 0?void 0:c.bind(M)}let o,b,I;if(n instanceof Lh)b=sf(n.firestore,hg),I=ix(n._key.path),o={next:M=>{e[m]&&e[m](PI(b,n,M))},error:e[m+1],complete:e[m+2]};else{const M=sf(n,bg);b=sf(M.firestore,hg),I=M._query;const V=new u3(b);o={next:k=>{e[m]&&e[m](new CI(b,V,M,k))},error:e[m+1],complete:e[m+2]},EI(n._query)}return(function(V,k,ie,se){const de=new Qw(se),J=new Yw(k,de,ie);return V.asyncQueue.enqueueAndForget((async()=>Kw(await Cv(V),J))),()=>{de.Za(),V.asyncQueue.enqueueAndForget((async()=>Xw(await Cv(V),J)))}})(mx(b),I,_,o)}function LI(n,e){return(function(i,c){const u=new bp;return i.asyncQueue.enqueueAndForget((async()=>PO(await jO(i),c,u))),u.promise})(mx(n),e)}function PI(n,e,t){const i=t.docs.get(e._key),c=new u3(n);return new II(n,c,e._key,i,new Dy(t.hasPendingWrites,t.fromCache),e.converter)}function T1(){return new o3("serverTimestamp")}(function(e,t=!0){(function(c){z0=c})(B0),E0(new ag("firestore",((i,{instanceIdentifier:c,options:u})=>{const m=i.getProvider("app").getImmediate(),_=new hg(new lD(i.getProvider("auth-internal")),new dD(i.getProvider("app-check-internal")),(function(b,I){if(!Object.prototype.hasOwnProperty.apply(b.options,["projectId"]))throw new ui(Yn.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new u_(b.options.projectId,I)})(m,c),m);return u=Object.assign({useFetchStreams:t},u),_._setSettings(u),_}),"PUBLIC").setMultipleInstances(!0)),am(iE,"4.7.3",e),am(iE,"4.7.3","esm2017")})();function h3(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,i=Object.getOwnPropertySymbols(n);c<i.length;c++)e.indexOf(i[c])<0&&Object.prototype.propertyIsEnumerable.call(n,i[c])&&(t[i[c]]=n[i[c]]);return t}function kI(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const sB=kI,RI=new S_("auth","Firebase",kI());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pv=new Aw("@firebase/auth");function aB(n,...e){Pv.logLevel<=ys.WARN&&Pv.warn(`Auth (${B0}): ${n}`,...e)}function Y1(n,...e){Pv.logLevel<=ys.ERROR&&Pv.error(`Auth (${B0}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yf(n,...e){throw f3(n,...e)}function af(n,...e){return f3(n,...e)}function d3(n,e,t){const i=Object.assign(Object.assign({},sB()),{[e]:t});return new S_("auth","Firebase",i).create(e,{appName:n.name})}function cm(n){return d3(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function MI(n,e,t){const i=t;if(!(e instanceof i))throw i.name!==e.constructor.name&&Yf(n,"argument-error"),d3(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function f3(n,...e){if(typeof n!="string"){const t=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(t,...i)}return RI.create(n,...e)}function go(n,e,...t){if(!n)throw f3(e,...t)}function yp(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Y1(e),new Error(e)}function Cp(n,e){n||yp(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K5(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function lB(){return WE()==="http:"||WE()==="https:"}function WE(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cB(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(lB()||BM()||"connection"in navigator)?navigator.onLine:!0}function uB(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R_{constructor(e,t){this.shortDelay=e,this.longDelay=t,Cp(t>e,"Short delay should be less than long delay!"),this.isMobile=DM()||zM()}get(){return cB()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p3(n,e){Cp(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NI{static initialize(e,t,i){this.fetchImpl=e,t&&(this.headersImpl=t),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;yp("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;yp("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;yp("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hB={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dB=new R_(3e4,6e4);function m3(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function q0(n,e,t,i,c={}){return DI(n,c,async()=>{let u={},m={};i&&(e==="GET"?m=i:u={body:JSON.stringify(i)});const _=E_(Object.assign({key:n.config.apiKey},m)).slice(1),o=await n._getAdditionalHeaders();o["Content-Type"]="application/json",n.languageCode&&(o["X-Firebase-Locale"]=n.languageCode);const b=Object.assign({method:e,headers:o},u);return OM()||(b.referrerPolicy="no-referrer"),NI.fetch()(FI(n,n.config.apiHost,t,_),b)})}async function DI(n,e,t){n._canInitEmulator=!1;const i=Object.assign(Object.assign({},hB),e);try{const c=new pB(n),u=await Promise.race([t(),c.promise]);c.clearNetworkTimeout();const m=await u.json();if("needConfirmation"in m)throw I1(n,"account-exists-with-different-credential",m);if(u.ok&&!("errorMessage"in m))return m;{const _=u.ok?m.errorMessage:m.error.message,[o,b]=_.split(" : ");if(o==="FEDERATED_USER_ID_ALREADY_LINKED")throw I1(n,"credential-already-in-use",m);if(o==="EMAIL_EXISTS")throw I1(n,"email-already-in-use",m);if(o==="USER_DISABLED")throw I1(n,"user-disabled",m);const I=i[o]||o.toLowerCase().replace(/[_\s]+/g,"-");if(b)throw d3(n,I,b);Yf(n,I)}}catch(c){if(c instanceof Pp)throw c;Yf(n,"network-request-failed",{message:String(c)})}}async function fB(n,e,t,i,c={}){const u=await q0(n,e,t,i,c);return"mfaPendingCredential"in u&&Yf(n,"multi-factor-auth-required",{_serverResponse:u}),u}function FI(n,e,t,i){const c=`${e}${t}?${i}`;return n.config.emulator?p3(n.config,c):`${n.config.apiScheme}://${c}`}class pB{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,i)=>{this.timer=setTimeout(()=>i(af(this.auth,"network-request-failed")),dB.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function I1(n,e,t){const i={appName:n.name};t.email&&(i.email=t.email),t.phoneNumber&&(i.phoneNumber=t.phoneNumber);const c=af(n,e,i);return c.customData._tokenResponse=t,c}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mB(n,e){return q0(n,"POST","/v1/accounts:delete",e)}async function OI(n,e){return q0(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xy(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function gB(n,e=!1){const t=Ph(n),i=await t.getIdToken(e),c=g3(i);go(c&&c.exp&&c.auth_time&&c.iat,t.auth,"internal-error");const u=typeof c.firebase=="object"?c.firebase:void 0,m=u?.sign_in_provider;return{claims:c,token:i,authTime:Xy($b(c.auth_time)),issuedAtTime:Xy($b(c.iat)),expirationTime:Xy($b(c.exp)),signInProvider:m||null,signInSecondFactor:u?.sign_in_second_factor||null}}function $b(n){return Number(n)*1e3}function g3(n){const[e,t,i]=n.split(".");if(e===void 0||t===void 0||i===void 0)return Y1("JWT malformed, contained fewer than 3 sections"),null;try{const c=Q6(t);return c?JSON.parse(c):(Y1("Failed to decode base64 JWT payload"),null)}catch(c){return Y1("Caught error parsing JWT payload as JSON",c?.toString()),null}}function KE(n){const e=g3(n);return go(e,"internal-error"),go(typeof e.exp<"u","internal-error"),go(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function m_(n,e,t=!1){if(t)return e;try{return await e}catch(i){throw i instanceof Pp&&yB(i)&&n.auth.currentUser===n&&await n.auth.signOut(),i}}function yB({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _B{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const i=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),i}else{this.errorBackoff=3e4;const c=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,c)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X5{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Xy(this.lastLoginAt),this.creationTime=Xy(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kv(n){var e;const t=n.auth,i=await n.getIdToken(),c=await m_(n,OI(t,{idToken:i}));go(c?.users.length,t,"internal-error");const u=c.users[0];n._notifyReloadListener(u);const m=!((e=u.providerUserInfo)===null||e===void 0)&&e.length?BI(u.providerUserInfo):[],_=xB(n.providerData,m),o=n.isAnonymous,b=!(n.email&&u.passwordHash)&&!_?.length,I=o?b:!1,M={uid:u.localId,displayName:u.displayName||null,photoURL:u.photoUrl||null,email:u.email||null,emailVerified:u.emailVerified||!1,phoneNumber:u.phoneNumber||null,tenantId:u.tenantId||null,providerData:_,metadata:new X5(u.createdAt,u.lastLoginAt),isAnonymous:I};Object.assign(n,M)}async function vB(n){const e=Ph(n);await kv(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function xB(n,e){return[...n.filter(i=>!e.some(c=>c.providerId===i.providerId)),...e]}function BI(n){return n.map(e=>{var{providerId:t}=e,i=h3(e,["providerId"]);return{providerId:t,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bB(n,e){const t=await DI(n,{},async()=>{const i=E_({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:c,apiKey:u}=n.config,m=FI(n,c,"/v1/token",`key=${u}`),_=await n._getAdditionalHeaders();return _["Content-Type"]="application/x-www-form-urlencoded",NI.fetch()(m,{method:"POST",headers:_,body:i})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function wB(n,e){return q0(n,"POST","/v2/accounts:revokeToken",m3(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x0{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){go(e.idToken,"internal-error"),go(typeof e.idToken<"u","internal-error"),go(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):KE(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){go(e.length!==0,"internal-error");const t=KE(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(go(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:i,refreshToken:c,expiresIn:u}=await bB(e,t);this.updateTokensAndExpiration(i,c,Number(u))}updateTokensAndExpiration(e,t,i){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(e,t){const{refreshToken:i,accessToken:c,expirationTime:u}=t,m=new x0;return i&&(go(typeof i=="string","internal-error",{appName:e}),m.refreshToken=i),c&&(go(typeof c=="string","internal-error",{appName:e}),m.accessToken=c),u&&(go(typeof u=="number","internal-error",{appName:e}),m.expirationTime=u),m}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new x0,this.toJSON())}_performRefresh(){return yp("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wp(n,e){go(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class _p{constructor(e){var{uid:t,auth:i,stsTokenManager:c}=e,u=h3(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new _B(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=i,this.stsTokenManager=c,this.accessToken=c.accessToken,this.displayName=u.displayName||null,this.email=u.email||null,this.emailVerified=u.emailVerified||!1,this.phoneNumber=u.phoneNumber||null,this.photoURL=u.photoURL||null,this.isAnonymous=u.isAnonymous||!1,this.tenantId=u.tenantId||null,this.providerData=u.providerData?[...u.providerData]:[],this.metadata=new X5(u.createdAt||void 0,u.lastLoginAt||void 0)}async getIdToken(e){const t=await m_(this,this.stsTokenManager.getToken(this.auth,e));return go(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return gB(this,e)}reload(){return vB(this)}_assign(e){this!==e&&(go(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new _p(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){go(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let i=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),i=!0),t&&await kv(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(jf(this.auth.app))return Promise.reject(cm(this.auth));const e=await this.getIdToken();return await m_(this,mB(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var i,c,u,m,_,o,b,I;const M=(i=t.displayName)!==null&&i!==void 0?i:void 0,V=(c=t.email)!==null&&c!==void 0?c:void 0,k=(u=t.phoneNumber)!==null&&u!==void 0?u:void 0,ie=(m=t.photoURL)!==null&&m!==void 0?m:void 0,se=(_=t.tenantId)!==null&&_!==void 0?_:void 0,de=(o=t._redirectEventId)!==null&&o!==void 0?o:void 0,J=(b=t.createdAt)!==null&&b!==void 0?b:void 0,ne=(I=t.lastLoginAt)!==null&&I!==void 0?I:void 0,{uid:me,emailVerified:ue,isAnonymous:ke,providerData:ze,stsTokenManager:pe}=t;go(me&&pe,e,"internal-error");const U=x0.fromJSON(this.name,pe);go(typeof me=="string",e,"internal-error"),Wp(M,e.name),Wp(V,e.name),go(typeof ue=="boolean",e,"internal-error"),go(typeof ke=="boolean",e,"internal-error"),Wp(k,e.name),Wp(ie,e.name),Wp(se,e.name),Wp(de,e.name),Wp(J,e.name),Wp(ne,e.name);const F=new _p({uid:me,auth:e,email:V,emailVerified:ue,displayName:M,isAnonymous:ke,photoURL:ie,phoneNumber:k,tenantId:se,stsTokenManager:U,createdAt:J,lastLoginAt:ne});return ze&&Array.isArray(ze)&&(F.providerData=ze.map(q=>Object.assign({},q))),de&&(F._redirectEventId=de),F}static async _fromIdTokenResponse(e,t,i=!1){const c=new x0;c.updateFromServerResponse(t);const u=new _p({uid:t.localId,auth:e,stsTokenManager:c,isAnonymous:i});return await kv(u),u}static async _fromGetAccountInfoResponse(e,t,i){const c=t.users[0];go(c.localId!==void 0,"internal-error");const u=c.providerUserInfo!==void 0?BI(c.providerUserInfo):[],m=!(c.email&&c.passwordHash)&&!u?.length,_=new x0;_.updateFromIdToken(i);const o=new _p({uid:c.localId,auth:e,stsTokenManager:_,isAnonymous:m}),b={uid:c.localId,displayName:c.displayName||null,photoURL:c.photoUrl||null,email:c.email||null,emailVerified:c.emailVerified||!1,phoneNumber:c.phoneNumber||null,tenantId:c.tenantId||null,providerData:u,metadata:new X5(c.createdAt,c.lastLoginAt),isAnonymous:!(c.email&&c.passwordHash)&&!u?.length};return Object.assign(o,b),o}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XE=new Map;function vp(n){Cp(n instanceof Function,"Expected a class definition");let e=XE.get(n);return e?(Cp(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,XE.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zI{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}zI.type="NONE";const ZE=zI;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function J1(n,e,t){return`firebase:${n}:${e}:${t}`}class b0{constructor(e,t,i){this.persistence=e,this.auth=t,this.userKey=i;const{config:c,name:u}=this.auth;this.fullUserKey=J1(this.userKey,c.apiKey,u),this.fullPersistenceKey=J1("persistence",c.apiKey,u),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?_p._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,i="authUser"){if(!t.length)return new b0(vp(ZE),e,i);const c=(await Promise.all(t.map(async b=>{if(await b._isAvailable())return b}))).filter(b=>b);let u=c[0]||vp(ZE);const m=J1(i,e.config.apiKey,e.name);let _=null;for(const b of t)try{const I=await b._get(m);if(I){const M=_p._fromJSON(e,I);b!==u&&(_=M),u=b;break}}catch{}const o=c.filter(b=>b._shouldAllowMigration);return!u._shouldAllowMigration||!o.length?new b0(u,e,i):(u=o[0],_&&await u._set(m,_.toJSON()),await Promise.all(t.map(async b=>{if(b!==u)try{await b._remove(m)}catch{}})),new b0(u,e,i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YE(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(qI(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(jI(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(GI(e))return"Blackberry";if(HI(e))return"Webos";if(UI(e))return"Safari";if((e.includes("chrome/")||VI(e))&&!e.includes("edge/"))return"Chrome";if($I(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=n.match(t);if(i?.length===2)return i[1]}return"Other"}function jI(n=_h()){return/firefox\//i.test(n)}function UI(n=_h()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function VI(n=_h()){return/crios\//i.test(n)}function qI(n=_h()){return/iemobile/i.test(n)}function $I(n=_h()){return/android/i.test(n)}function GI(n=_h()){return/blackberry/i.test(n)}function HI(n=_h()){return/webos/i.test(n)}function y3(n=_h()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function SB(n=_h()){var e;return y3(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function EB(){return jM()&&document.documentMode===10}function WI(n=_h()){return y3(n)||$I(n)||HI(n)||GI(n)||/windows phone/i.test(n)||qI(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KI(n,e=[]){let t;switch(n){case"Browser":t=YE(_h());break;case"Worker":t=`${YE(_h())}-${n}`;break;default:t=n}const i=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${B0}/${i}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AB{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const i=u=>new Promise((m,_)=>{try{const o=e(u);m(o)}catch(o){_(o)}});i.onAbort=t,this.queue.push(i);const c=this.queue.length-1;return()=>{this.queue[c]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const i of this.queue)await i(e),i.onAbort&&t.push(i.onAbort)}catch(i){t.reverse();for(const c of t)try{c()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i?.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function TB(n,e={}){return q0(n,"GET","/v2/passwordPolicy",m3(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IB=6;class CB{constructor(e){var t,i,c,u;const m=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=m.minPasswordLength)!==null&&t!==void 0?t:IB,m.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=m.maxPasswordLength),m.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=m.containsLowercaseCharacter),m.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=m.containsUppercaseCharacter),m.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=m.containsNumericCharacter),m.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=m.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(c=(i=e.allowedNonAlphanumericCharacters)===null||i===void 0?void 0:i.join(""))!==null&&c!==void 0?c:"",this.forceUpgradeOnSignin=(u=e.forceUpgradeOnSignin)!==null&&u!==void 0?u:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,i,c,u,m,_;const o={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,o),this.validatePasswordCharacterOptions(e,o),o.isValid&&(o.isValid=(t=o.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),o.isValid&&(o.isValid=(i=o.meetsMaxPasswordLength)!==null&&i!==void 0?i:!0),o.isValid&&(o.isValid=(c=o.containsLowercaseLetter)!==null&&c!==void 0?c:!0),o.isValid&&(o.isValid=(u=o.containsUppercaseLetter)!==null&&u!==void 0?u:!0),o.isValid&&(o.isValid=(m=o.containsNumericCharacter)!==null&&m!==void 0?m:!0),o.isValid&&(o.isValid=(_=o.containsNonAlphanumericCharacter)!==null&&_!==void 0?_:!0),o}validatePasswordLengthOptions(e,t){const i=this.customStrengthOptions.minPasswordLength,c=this.customStrengthOptions.maxPasswordLength;i&&(t.meetsMinPasswordLength=e.length>=i),c&&(t.meetsMaxPasswordLength=e.length<=c)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let i;for(let c=0;c<e.length;c++)i=e.charAt(c),this.updatePasswordCharacterOptionsStatuses(t,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(e,t,i,c,u){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=c)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LB{constructor(e,t,i,c){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=i,this.config=c,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new JE(this),this.idTokenSubscription=new JE(this),this.beforeStateQueue=new AB(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=RI,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=c.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=vp(t)),this._initializationPromise=this.queue(async()=>{var i,c;if(!this._deleted&&(this.persistenceManager=await b0.create(this,e),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((c=this.currentUser)===null||c===void 0?void 0:c.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await OI(this,{idToken:e}),i=await _p._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(i)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(jf(this.app)){const m=this.app.settings.authIdToken;return m?new Promise(_=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(m).then(_,_))}):this.directlySetCurrentUser(null)}const i=await this.assertedPersistence.getCurrentUser();let c=i,u=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const m=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,_=c?._redirectEventId,o=await this.tryRedirectSignIn(e);(!m||m===_)&&o?.user&&(c=o.user,u=!0)}if(!c)return this.directlySetCurrentUser(null);if(!c._redirectEventId){if(u)try{await this.beforeStateQueue.runMiddleware(c)}catch(m){c=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(m))}return c?this.reloadAndSetCurrentUserOrClear(c):this.directlySetCurrentUser(null)}return go(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===c._redirectEventId?this.directlySetCurrentUser(c):this.reloadAndSetCurrentUserOrClear(c)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await kv(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=uB()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(jf(this.app))return Promise.reject(cm(this));const t=e?Ph(e):null;return t&&go(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&go(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return jf(this.app)?Promise.reject(cm(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return jf(this.app)?Promise.reject(cm(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(vp(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await TB(this),t=new CB(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new S_("auth","Firebase",e())}onAuthStateChanged(e,t,i){return this.registerStateListener(this.authStateSubscription,e,t,i)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,i){return this.registerStateListener(this.idTokenSubscription,e,t,i)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const i=this.onAuthStateChanged(()=>{i(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(i.tenantId=this.tenantId),await wB(this,i)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const i=await this.getOrInitRedirectPersistenceManager(t);return e===null?i.removeCurrentUser():i.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&vp(e)||this._popupRedirectResolver;go(t,this,"argument-error"),this.redirectPersistenceManager=await b0.create(this,[vp(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,i;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const i=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,i,c){if(this._deleted)return()=>{};const u=typeof t=="function"?t:t.next.bind(t);let m=!1;const _=this._isInitialized?Promise.resolve():this._initializationPromise;if(go(_,this,"internal-error"),_.then(()=>{m||u(this.currentUser)}),typeof t=="function"){const o=e.addObserver(t,i,c);return()=>{m=!0,o()}}else{const o=e.addObserver(t);return()=>{m=!0,o()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return go(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=KI(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const i=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());i&&(t["X-Firebase-Client"]=i);const c=await this._getAppCheckToken();return c&&(t["X-Firebase-AppCheck"]=c),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t?.error&&aB(`Error while retrieving App Check token: ${t.error}`),t?.token}}function $0(n){return Ph(n)}class JE{constructor(e){this.auth=e,this.observer=null,this.addObserver=KM(t=>this.observer=t)}get next(){return go(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _3={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function PB(n){_3=n}function kB(n){return _3.loadJS(n)}function RB(){return _3.gapiScript}function MB(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NB(n,e){const t=Iw(n,"auth");if(t.isInitialized()){const c=t.getImmediate(),u=t.getOptions();if(vv(u,e??{}))return c;Yf(c,"already-initialized")}return t.initialize({options:e})}function DB(n,e){const t=e?.persistence||[],i=(Array.isArray(t)?t:[t]).map(vp);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(i,e?.popupRedirectResolver)}function FB(n,e,t){const i=$0(n);go(i._canInitEmulator,i,"emulator-config-failed"),go(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");const c=!1,u=XI(e),{host:m,port:_}=OB(e),o=_===null?"":`:${_}`;i.config.emulator={url:`${u}//${m}${o}/`},i.settings.appVerificationDisabledForTesting=!0,i.emulatorConfig=Object.freeze({host:m,port:_,protocol:u.replace(":",""),options:Object.freeze({disableWarnings:c})}),BB()}function XI(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function OB(n){const e=XI(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const i=t[2].split("@").pop()||"",c=/^(\[[^\]]+\])(:|$)/.exec(i);if(c){const u=c[1];return{host:u,port:QE(i.substr(u.length+1))}}else{const[u,m]=i.split(":");return{host:u,port:QE(m)}}}function QE(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function BB(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZI{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return yp("not implemented")}_getIdTokenResponse(e){return yp("not implemented")}_linkToIdToken(e,t){return yp("not implemented")}_getReauthenticationResolver(e){return yp("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function w0(n,e){return fB(n,"POST","/v1/accounts:signInWithIdp",m3(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zB="http://localhost";class dg extends ZI{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new dg(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Yf("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:i,signInMethod:c}=t,u=h3(t,["providerId","signInMethod"]);if(!i||!c)return null;const m=new dg(i,c);return m.idToken=u.idToken||void 0,m.accessToken=u.accessToken||void 0,m.secret=u.secret,m.nonce=u.nonce,m.pendingToken=u.pendingToken||null,m}_getIdTokenResponse(e){const t=this.buildRequest();return w0(e,t)}_linkToIdToken(e,t){const i=this.buildRequest();return i.idToken=t,w0(e,i)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,w0(e,t)}buildRequest(){const e={requestUri:zB,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=E_(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _x{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M_ extends _x{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jp extends M_{constructor(){super("facebook.com")}static credential(e){return dg._fromParams({providerId:Jp.PROVIDER_ID,signInMethod:Jp.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Jp.credentialFromTaggedObject(e)}static credentialFromError(e){return Jp.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Jp.credential(e.oauthAccessToken)}catch{return null}}}Jp.FACEBOOK_SIGN_IN_METHOD="facebook.com";Jp.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bf extends M_{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return dg._fromParams({providerId:Bf.PROVIDER_ID,signInMethod:Bf.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Bf.credentialFromTaggedObject(e)}static credentialFromError(e){return Bf.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:i}=e;if(!t&&!i)return null;try{return Bf.credential(t,i)}catch{return null}}}Bf.GOOGLE_SIGN_IN_METHOD="google.com";Bf.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qp extends M_{constructor(){super("github.com")}static credential(e){return dg._fromParams({providerId:Qp.PROVIDER_ID,signInMethod:Qp.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Qp.credentialFromTaggedObject(e)}static credentialFromError(e){return Qp.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Qp.credential(e.oauthAccessToken)}catch{return null}}}Qp.GITHUB_SIGN_IN_METHOD="github.com";Qp.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class em extends M_{constructor(){super("twitter.com")}static credential(e,t){return dg._fromParams({providerId:em.PROVIDER_ID,signInMethod:em.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return em.credentialFromTaggedObject(e)}static credentialFromError(e){return em.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:i}=e;if(!t||!i)return null;try{return em.credential(t,i)}catch{return null}}}em.TWITTER_SIGN_IN_METHOD="twitter.com";em.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R0{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,i,c=!1){const u=await _p._fromIdTokenResponse(e,i,c),m=eA(i);return new R0({user:u,providerId:m,_tokenResponse:i,operationType:t})}static async _forOperation(e,t,i){await e._updateTokensIfNecessary(i,!0);const c=eA(i);return new R0({user:e,providerId:c,_tokenResponse:i,operationType:t})}}function eA(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rv extends Pp{constructor(e,t,i,c){var u;super(t.code,t.message),this.operationType=i,this.user=c,Object.setPrototypeOf(this,Rv.prototype),this.customData={appName:e.name,tenantId:(u=e.tenantId)!==null&&u!==void 0?u:void 0,_serverResponse:t.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(e,t,i,c){return new Rv(e,t,i,c)}}function YI(n,e,t,i){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(u=>{throw u.code==="auth/multi-factor-auth-required"?Rv._fromErrorAndOperation(n,u,e,i):u})}async function jB(n,e,t=!1){const i=await m_(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return R0._forOperation(n,"link",i)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function UB(n,e,t=!1){const{auth:i}=n;if(jf(i.app))return Promise.reject(cm(i));const c="reauthenticate";try{const u=await m_(n,YI(i,c,e,n),t);go(u.idToken,i,"internal-error");const m=g3(u.idToken);go(m,i,"internal-error");const{sub:_}=m;return go(n.uid===_,i,"user-mismatch"),R0._forOperation(n,c,u)}catch(u){throw u?.code==="auth/user-not-found"&&Yf(i,"user-mismatch"),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function VB(n,e,t=!1){if(jf(n.app))return Promise.reject(cm(n));const i="signIn",c=await YI(n,i,e),u=await R0._fromIdTokenResponse(n,i,c);return t||await n._updateCurrentUser(u.user),u}function qB(n,e,t,i){return Ph(n).onIdTokenChanged(e,t,i)}function $B(n,e,t){return Ph(n).beforeAuthStateChanged(e,t)}function GB(n,e,t,i){return Ph(n).onAuthStateChanged(e,t,i)}function HB(n){return Ph(n).signOut()}const Mv="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JI{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Mv,"1"),this.storage.removeItem(Mv),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WB=1e3,KB=10;class QI extends JI{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=WI(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const i=this.storage.getItem(t),c=this.localCache[t];i!==c&&e(t,c,i)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((m,_,o)=>{this.notifyListeners(m,o)});return}const i=e.key;t?this.detachListener():this.stopPolling();const c=()=>{const m=this.storage.getItem(i);!t&&this.localCache[i]===m||this.notifyListeners(i,m)},u=this.storage.getItem(i);EB()&&u!==e.newValue&&e.newValue!==e.oldValue?setTimeout(c,KB):c()}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const c of Array.from(i))c(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:i}),!0)})},WB)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}QI.type="LOCAL";const XB=QI;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e8 extends JI{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}e8.type="SESSION";const t8=e8;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZB(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vx{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(c=>c.isListeningto(e));if(t)return t;const i=new vx(e);return this.receivers.push(i),i}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:i,eventType:c,data:u}=t.data,m=this.handlersMap[c];if(!m?.size)return;t.ports[0].postMessage({status:"ack",eventId:i,eventType:c});const _=Array.from(m).map(async b=>b(t.origin,u)),o=await ZB(_);t.ports[0].postMessage({status:"done",eventId:i,eventType:c,response:o})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}vx.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v3(n="",e=10){let t="";for(let i=0;i<e;i++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YB{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,i=50){const c=typeof MessageChannel<"u"?new MessageChannel:null;if(!c)throw new Error("connection_unavailable");let u,m;return new Promise((_,o)=>{const b=v3("",20);c.port1.start();const I=setTimeout(()=>{o(new Error("unsupported_event"))},i);m={messageChannel:c,onMessage(M){const V=M;if(V.data.eventId===b)switch(V.data.status){case"ack":clearTimeout(I),u=setTimeout(()=>{o(new Error("timeout"))},3e3);break;case"done":clearTimeout(u),_(V.data.response);break;default:clearTimeout(I),clearTimeout(u),o(new Error("invalid_response"));break}}},this.handlers.add(m),c.port1.addEventListener("message",m.onMessage),this.target.postMessage({eventType:e,eventId:b,data:t},[c.port2])}).finally(()=>{m&&this.removeMessageHandler(m)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wf(){return window}function JB(n){Wf().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function n8(){return typeof Wf().WorkerGlobalScope<"u"&&typeof Wf().importScripts=="function"}async function QB(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function ez(){var n;return((n=navigator?.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function tz(){return n8()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r8="firebaseLocalStorageDb",nz=1,Nv="firebaseLocalStorage",i8="fbase_key";class N_{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function xx(n,e){return n.transaction([Nv],e?"readwrite":"readonly").objectStore(Nv)}function rz(){const n=indexedDB.deleteDatabase(r8);return new N_(n).toPromise()}function Z5(){const n=indexedDB.open(r8,nz);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const i=n.result;try{i.createObjectStore(Nv,{keyPath:i8})}catch(c){t(c)}}),n.addEventListener("success",async()=>{const i=n.result;i.objectStoreNames.contains(Nv)?e(i):(i.close(),await rz(),e(await Z5()))})})}async function tA(n,e,t){const i=xx(n,!0).put({[i8]:e,value:t});return new N_(i).toPromise()}async function iz(n,e){const t=xx(n,!1).get(e),i=await new N_(t).toPromise();return i===void 0?null:i.value}function nA(n,e){const t=xx(n,!0).delete(e);return new N_(t).toPromise()}const oz=800,sz=3;class o8{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Z5(),this.db)}async _withRetries(e){let t=0;for(;;)try{const i=await this._openDb();return await e(i)}catch(i){if(t++>sz)throw i;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return n8()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=vx._getInstance(tz()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await QB(),!this.activeServiceWorker)return;this.sender=new YB(this.activeServiceWorker);const i=await this.sender._send("ping",{},800);i&&!((e=i[0])===null||e===void 0)&&e.fulfilled&&!((t=i[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||ez()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Z5();return await tA(e,Mv,"1"),await nA(e,Mv),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(i=>tA(i,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(i=>iz(i,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>nA(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(c=>{const u=xx(c,!1).getAll();return new N_(u).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],i=new Set;if(e.length!==0)for(const{fbase_key:c,value:u}of e)i.add(c),JSON.stringify(this.localCache[c])!==JSON.stringify(u)&&(this.notifyListeners(c,u),t.push(c));for(const c of Object.keys(this.localCache))this.localCache[c]&&!i.has(c)&&(this.notifyListeners(c,null),t.push(c));return t}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const c of Array.from(i))c(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),oz)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}o8.type="LOCAL";const az=o8;new R_(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x3(n,e){return e?vp(e):(go(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b3 extends ZI{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return w0(e,this._buildIdpRequest())}_linkToIdToken(e,t){return w0(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return w0(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function lz(n){return VB(n.auth,new b3(n),n.bypassAuthState)}function cz(n){const{auth:e,user:t}=n;return go(t,e,"internal-error"),UB(t,new b3(n),n.bypassAuthState)}async function uz(n){const{auth:e,user:t}=n;return go(t,e,"internal-error"),jB(t,new b3(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s8{constructor(e,t,i,c,u=!1){this.auth=e,this.resolver=i,this.user=c,this.bypassAuthState=u,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:i,postBody:c,tenantId:u,error:m,type:_}=e;if(m){this.reject(m);return}const o={auth:this.auth,requestUri:t,sessionId:i,tenantId:u||void 0,postBody:c||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(_)(o))}catch(b){this.reject(b)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return lz;case"linkViaPopup":case"linkViaRedirect":return uz;case"reauthViaPopup":case"reauthViaRedirect":return cz;default:Yf(this.auth,"internal-error")}}resolve(e){Cp(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Cp(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hz=new R_(2e3,1e4);async function dz(n,e,t){if(jf(n.app))return Promise.reject(af(n,"operation-not-supported-in-this-environment"));const i=$0(n);MI(n,e,_x);const c=x3(i,t);return new eg(i,"signInViaPopup",e,c).executeNotNull()}class eg extends s8{constructor(e,t,i,c,u){super(e,t,c,u),this.provider=i,this.authWindow=null,this.pollId=null,eg.currentPopupAction&&eg.currentPopupAction.cancel(),eg.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return go(e,this.auth,"internal-error"),e}async onExecution(){Cp(this.filter.length===1,"Popup operations only handle one event");const e=v3();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(af(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(af(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,eg.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,i;if(!((i=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||i===void 0)&&i.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(af(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,hz.get())};e()}}eg.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fz="pendingRedirect",Q1=new Map;class pz extends s8{constructor(e,t,i=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,i),this.eventId=null}async execute(){let e=Q1.get(this.auth._key());if(!e){try{const i=await mz(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(i)}catch(t){e=()=>Promise.reject(t)}Q1.set(this.auth._key(),e)}return this.bypassAuthState||Q1.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function mz(n,e){const t=l8(e),i=a8(n);if(!await i._isAvailable())return!1;const c=await i._get(t)==="true";return await i._remove(t),c}async function gz(n,e){return a8(n)._set(l8(e),"true")}function yz(n,e){Q1.set(n._key(),e)}function a8(n){return vp(n._redirectPersistence)}function l8(n){return J1(fz,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _z(n,e,t){return vz(n,e,t)}async function vz(n,e,t){if(jf(n.app))return Promise.reject(cm(n));const i=$0(n);MI(n,e,_x),await i._initializationPromise;const c=x3(i,t);return await gz(c,i),c._openRedirect(i,e,"signInViaRedirect")}async function xz(n,e){return await $0(n)._initializationPromise,c8(n,e,!1)}async function c8(n,e,t=!1){if(jf(n.app))return Promise.reject(cm(n));const i=$0(n),c=x3(i,e),m=await new pz(i,c,t).execute();return m&&!t&&(delete m.user._redirectEventId,await i._persistUserIfCurrent(m.user),await i._setRedirectUser(null,e)),m}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bz=600*1e3;class wz{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(e,i)&&(t=!0,this.sendToConsumer(e,i),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Sz(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var i;if(e.error&&!u8(e)){const c=((i=e.error.code)===null||i===void 0?void 0:i.split("auth/")[1])||"internal-error";t.onError(af(this.auth,c))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const i=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&i}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=bz&&this.cachedEventUids.clear(),this.cachedEventUids.has(rA(e))}saveEventToCache(e){this.cachedEventUids.add(rA(e)),this.lastProcessedEventTime=Date.now()}}function rA(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function u8({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function Sz(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return u8(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ez(n,e={}){return q0(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Az=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Tz=/^https?/;async function Iz(n){if(n.config.emulator)return;const{authorizedDomains:e}=await Ez(n);for(const t of e)try{if(Cz(t))return}catch{}Yf(n,"unauthorized-domain")}function Cz(n){const e=K5(),{protocol:t,hostname:i}=new URL(e);if(n.startsWith("chrome-extension://")){const m=new URL(n);return m.hostname===""&&i===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&m.hostname===i}if(!Tz.test(t))return!1;if(Az.test(n))return i===n;const c=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+c+"|"+c+")$","i").test(i)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lz=new R_(3e4,6e4);function iA(){const n=Wf().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function Pz(n){return new Promise((e,t)=>{var i,c,u;function m(){iA(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{iA(),t(af(n,"network-request-failed"))},timeout:Lz.get()})}if(!((c=(i=Wf().gapi)===null||i===void 0?void 0:i.iframes)===null||c===void 0)&&c.Iframe)e(gapi.iframes.getContext());else if(!((u=Wf().gapi)===null||u===void 0)&&u.load)m();else{const _=MB("iframefcb");return Wf()[_]=()=>{gapi.load?m():t(af(n,"network-request-failed"))},kB(`${RB()}?onload=${_}`).catch(o=>t(o))}}).catch(e=>{throw ev=null,e})}let ev=null;function kz(n){return ev=ev||Pz(n),ev}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rz=new R_(5e3,15e3),Mz="__/auth/iframe",Nz="emulator/auth/iframe",Dz={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Fz=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Oz(n){const e=n.config;go(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?p3(e,Nz):`https://${n.config.authDomain}/${Mz}`,i={apiKey:e.apiKey,appName:n.name,v:B0},c=Fz.get(n.config.apiHost);c&&(i.eid=c);const u=n._getFrameworks();return u.length&&(i.fw=u.join(",")),`${t}?${E_(i).slice(1)}`}async function Bz(n){const e=await kz(n),t=Wf().gapi;return go(t,n,"internal-error"),e.open({where:document.body,url:Oz(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Dz,dontclear:!0},i=>new Promise(async(c,u)=>{await i.restyle({setHideOnLeave:!1});const m=af(n,"network-request-failed"),_=Wf().setTimeout(()=>{u(m)},Rz.get());function o(){Wf().clearTimeout(_),c(i)}i.ping(o).then(o,()=>{u(m)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zz={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},jz=500,Uz=600,Vz="_blank",qz="http://localhost";class oA{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function $z(n,e,t,i=jz,c=Uz){const u=Math.max((window.screen.availHeight-c)/2,0).toString(),m=Math.max((window.screen.availWidth-i)/2,0).toString();let _="";const o=Object.assign(Object.assign({},zz),{width:i.toString(),height:c.toString(),top:u,left:m}),b=_h().toLowerCase();t&&(_=VI(b)?Vz:t),jI(b)&&(e=e||qz,o.scrollbars="yes");const I=Object.entries(o).reduce((V,[k,ie])=>`${V}${k}=${ie},`,"");if(SB(b)&&_!=="_self")return Gz(e||"",_),new oA(null);const M=window.open(e||"",_,I);go(M,n,"popup-blocked");try{M.focus()}catch{}return new oA(M)}function Gz(n,e){const t=document.createElement("a");t.href=n,t.target=e;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hz="__/auth/handler",Wz="emulator/auth/handler",Kz=encodeURIComponent("fac");async function sA(n,e,t,i,c,u){go(n.config.authDomain,n,"auth-domain-config-required"),go(n.config.apiKey,n,"invalid-api-key");const m={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:i,v:B0,eventId:c};if(e instanceof _x){e.setDefaultLanguage(n.languageCode),m.providerId=e.providerId||"",WM(e.getCustomParameters())||(m.customParameters=JSON.stringify(e.getCustomParameters()));for(const[I,M]of Object.entries({}))m[I]=M}if(e instanceof M_){const I=e.getScopes().filter(M=>M!=="");I.length>0&&(m.scopes=I.join(","))}n.tenantId&&(m.tid=n.tenantId);const _=m;for(const I of Object.keys(_))_[I]===void 0&&delete _[I];const o=await n._getAppCheckToken(),b=o?`#${Kz}=${encodeURIComponent(o)}`:"";return`${Xz(n)}?${E_(_).slice(1)}${b}`}function Xz({config:n}){return n.emulator?p3(n,Wz):`https://${n.authDomain}/${Hz}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gb="webStorageSupport";class Zz{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=t8,this._completeRedirectFn=c8,this._overrideRedirectResult=yz}async _openPopup(e,t,i,c){var u;Cp((u=this.eventManagers[e._key()])===null||u===void 0?void 0:u.manager,"_initialize() not called before _openPopup()");const m=await sA(e,t,i,K5(),c);return $z(e,m,v3())}async _openRedirect(e,t,i,c){await this._originValidation(e);const u=await sA(e,t,i,K5(),c);return JB(u),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:c,promise:u}=this.eventManagers[t];return c?Promise.resolve(c):(Cp(u,"If manager is not set, promise should be"),u)}const i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}async initAndGetManager(e){const t=await Bz(e),i=new wz(e);return t.register("authEvent",c=>(go(c?.authEvent,e,"invalid-auth-event"),{status:i.onEvent(c.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:i},this.iframes[e._key()]=t,i}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Gb,{type:Gb},c=>{var u;const m=(u=c?.[0])===null||u===void 0?void 0:u[Gb];m!==void 0&&t(!!m),Yf(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Iz(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return WI()||UI()||y3()}}const Yz=Zz;var aA="@firebase/auth",lA="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jz{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(i=>{e(i?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){go(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qz(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function ej(n){E0(new ag("auth",(e,{options:t})=>{const i=e.getProvider("app").getImmediate(),c=e.getProvider("heartbeat"),u=e.getProvider("app-check-internal"),{apiKey:m,authDomain:_}=i.options;go(m&&!m.includes(":"),"invalid-api-key",{appName:i.name});const o={apiKey:m,authDomain:_,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:KI(n)},b=new LB(i,c,u,o);return DB(b,t),b},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,i)=>{e.getProvider("auth-internal").initialize()})),E0(new ag("auth-internal",e=>{const t=$0(e.getProvider("auth").getImmediate());return(i=>new Jz(i))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),am(aA,lA,Qz(n)),am(aA,lA,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tj=300,nj=n9("authIdTokenMaxAge")||tj;let cA=null;const rj=n=>async e=>{const t=e&&await e.getIdTokenResult(),i=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(i&&i>nj)return;const c=t?.token;cA!==c&&(cA=c,await fetch(n,{method:c?"POST":"DELETE",headers:c?{Authorization:`Bearer ${c}`}:{}}))};function tv(n=s9()){const e=Iw(n,"auth");if(e.isInitialized())return e.getImmediate();const t=NB(n,{popupRedirectResolver:Yz,persistence:[az,XB,t8]}),i=n9("authTokenSyncURL");if(i&&typeof isSecureContext=="boolean"&&isSecureContext){const u=new URL(i,location.origin);if(location.origin===u.origin){const m=rj(u.toString());$B(t,m,()=>m(t.currentUser)),qB(t,_=>m(_))}}const c=e9("auth");return c&&FB(t,`http://${c}`),t}function ij(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}PB({loadJS(n){return new Promise((e,t)=>{const i=document.createElement("script");i.setAttribute("src",n),i.onload=e,i.onerror=c=>{const u=af("internal-error");u.customData=c,t(u)},i.type="text/javascript",i.charset="UTF-8",ij().appendChild(i)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});ej("Browser");const oj={apiKey:"AIzaSyDqdNAi8z3vx8TJcbVwUN37GJtt4vGH_Cs",authDomain:"stakeholder-map-a4bdc.firebaseapp.com",projectId:"stakeholder-map-a4bdc",storageBucket:"stakeholder-map-a4bdc.firebasestorage.app",messagingSenderId:"201968932417",appId:"1:201968932417:web:c6053a304f5dc5f2ffd8c0",measurementId:"G-BEB17GFMBJ"},h8=o9(oj),mh=GO(h8);tv(h8);new Bf;const sj=[{value:5,label:"5 - Excellent"},{value:4,label:"4 - Good"},{value:3,label:"3 - Adequate"},{value:2,label:"2 - Poor"},{value:1,label:"1 - Very Poor"},{value:0,label:"0 - Not Set"}],uA={buildingName:"",notes:"",scores:{architecture:{exterior:0,entrances:0,interiorFinishes:0,lifeSafety:0,codesAndAccessibility:0},engineering:{superstructure:0,conveyingSystems:0,fireProtection:0,plumbing:0,mechanical:0,power:0,lighting:0},functionality:{telecomm:0,fireAlarm:0,spaceSize:0,technology:0}}},aj=({buildingId:n,assessments:e,onClose:t,onSave:i,universityId:c,panelPos:u,isAdminRole:m})=>{const[_,o]=On.useState(uA);On.useEffect(()=>{if(n&&e){const k=e[n]||{...uA,buildingName:n};o(k)}},[n,e]);const b=(k,ie,se)=>{o(de=>({...de,scores:{...de.scores,[k]:{...de.scores[k],[ie]:Number(se)}}}))},I=k=>{o(ie=>({...ie,notes:k.target.value}))},M=async()=>{if(!m){alert("Save failed: you are not signed in as an admin.");return}if(!n||!c)return;const k=n.replace(/\//g,"__"),ie=u0(mh,"universities",c,"buildingAssessments",k),se={..._,originalId:n};try{await W5(ie,se),i(se),alert("Assessment saved successfully!"),t()}catch(de){console.error("Error saving assessment:",de),alert("Failed to save assessment. See console for details.")}};if(!n)return null;const V=u?{position:"absolute",left:u.x??80,top:u.y??160,zIndex:6}:void 0;return Y.jsxs("div",{className:"assessment-panel",style:V,children:[Y.jsxs("div",{className:"panel-header",children:[Y.jsx("h3",{children:"Technical Assessment"}),Y.jsx("button",{onClick:t,className:"close-button",children:""})]}),Y.jsxs("div",{className:"panel-content",children:[Y.jsx("h4",{children:_.buildingName||n}),_.scores&&Object.entries(_.scores).map(([k,ie])=>Y.jsxs("div",{className:"category-section",children:[Y.jsx("h5",{children:k.charAt(0).toUpperCase()+k.slice(1)}),Object.entries(ie).map(([se,de])=>Y.jsxs("div",{className:"score-item",children:[Y.jsx("label",{children:se.replace(/([A-Z])/g," $1").trim()}),Y.jsx("select",{value:de,onChange:J=>b(k,se,J.target.value),children:sj.map(J=>Y.jsx("option",{value:J.value,children:J.label},J.value))})]},se))]},k)),Y.jsxs("div",{className:"notes-section",children:[Y.jsx("h5",{children:"Notes"}),Y.jsx("textarea",{value:_.notes||"",onChange:I,rows:"4"})]}),Y.jsx("button",{className:"save-button",onClick:M,children:"Save Changes"})]})]})},lj=({buildingId:n,buildingName:e,currentCondition:t,onSave:i,onOpenTechnical:c,onClose:u,floorplans:m,onSelectFloorplan:_})=>{const[o,b]=On.useState(t??"");On.useEffect(()=>{b(t??"")},[n,t]);const I=()=>{n&&o&&i(n,o)},M=(o||"")!==(t||"");return Y.jsxs("div",{className:"interaction-panel",children:[Y.jsx("button",{className:"close-button",onClick:u,children:""}),Y.jsx("h4",{children:e||n}),Y.jsxs("div",{className:"control-section",children:[Y.jsx("h5",{children:"Stakeholder Condition"}),Y.jsxs("select",{value:o,onChange:V=>b(V.target.value),children:[Y.jsx("option",{value:"",disabled:!0,children:"Select condition..."}),Y.jsx("option",{value:"5",children:"5 = Excellent"}),Y.jsx("option",{value:"4",children:"4 = Good"}),Y.jsx("option",{value:"3",children:"3 = Adequate"}),Y.jsx("option",{value:"2",children:"2 = Poor"}),Y.jsx("option",{value:"1",children:"1 = Very Poor"})]}),Y.jsx("div",{className:"button-row",style:{marginTop:8},children:Y.jsx("button",{onClick:I,disabled:!M||!o,children:"Save Stakeholder Condition"})})]}),Y.jsx("div",{className:"button-row",style:{marginTop:8},children:Y.jsx("button",{onClick:c,children:"Technical Assessment"})}),m&&m.length>0&&Y.jsxs("div",{className:"control-section",children:[Y.jsx("h5",{children:"Floor Plans"}),Y.jsx("div",{className:"floorplan-buttons",children:m.map((V,k)=>Y.jsx("button",{onClick:()=>_?.(V),children:V.name},k))})]})]})},hA={"This is one of my go-to study spots":"#006400","This is a go-to hangout spot for me and my friends":"#008000","I would like to use this space more, but it needs improvement":"#9cdef1ff","This space feels outdated or run-down":"#f4e806ff","The furniture in this space is uncomfortable or not functional":"#e9a804ff","The lighting or temperature in this space makes it uncomfortable":"#f29008ff","I rarely or never use this space":"#f05555ff","I do not feel safe in this space":"#e00905bc","Just leave a comment about this space":"#9E9E9E"},cj={"This space supports my teaching and/or professional work effectively":"#007330ff","I wish this space were more flexible or adaptable for different uses":"#31f579ff","I would like to use this space more, but it needs some improvement":"#94d2bd","The layout or furniture is not functional for my needs":"#e9d8a6","The technology in this space is inadequate or unreliable":"#f4d804ff","This space lacks the privacy needed for my work":"#f97c3eff","I rarely or never use this space":"#f25f54ff","I do not feel safe in this space":"#ae2012","Just leave a comment about this space":"#9E9E9E"},C1={student:hA,staff:cj,default:hA};var Gu=63710088e-1,d8={centimeters:Gu*100,centimetres:Gu*100,degrees:360/(2*Math.PI),feet:Gu*3.28084,inches:Gu*39.37,kilometers:Gu/1e3,kilometres:Gu/1e3,meters:Gu,metres:Gu,miles:Gu/1609.344,millimeters:Gu*1e3,millimetres:Gu*1e3,nauticalmiles:Gu/1852,radians:1,yards:Gu*1.0936};function w3(n,e,t={}){const i={type:"Feature"};return(t.id===0||t.id)&&(i.id=t.id),t.bbox&&(i.bbox=t.bbox),i.properties=e||{},i.geometry=n,i}function gs(n,e,t={}){if(!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!dA(n[0])||!dA(n[1]))throw new Error("coordinates must contain numbers");return w3({type:"Point",coordinates:n},e,t)}function S3(n,e,t={}){for(const c of n){if(c.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(c[c.length-1].length!==c[0].length)throw new Error("First and last Position are not equivalent.");for(let u=0;u<c[c.length-1].length;u++)if(c[c.length-1][u]!==c[0][u])throw new Error("First and last Position are not equivalent.")}return w3({type:"Polygon",coordinates:n},e,t)}function E3(n,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=n,t}function uj(n,e,t={}){return w3({type:"MultiPolygon",coordinates:n},e,t)}function f8(n,e="kilometers"){const t=d8[e];if(!t)throw new Error(e+" units is invalid");return n*t}function hj(n,e="kilometers"){const t=d8[e];if(!t)throw new Error(e+" units is invalid");return n/t}function p8(n){return n%(2*Math.PI)*180/Math.PI}function md(n){return n%360*Math.PI/180}function m8(n,e="kilometers",t="kilometers"){if(!(n>=0))throw new Error("length must be a positive number");return f8(hj(n,e),t)}function dA(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function A3(n){return n!==null&&typeof n=="object"&&!Array.isArray(n)}function Kh(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function T3(n){if(Array.isArray(n))return n;if(n.type==="Feature"){if(n.geometry!==null)return n.geometry.coordinates}else if(n.coordinates)return n.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function dj(n){return n.type==="Feature"?n.geometry:n}function g8(n,e){return n.type==="FeatureCollection"?"FeatureCollection":n.type==="GeometryCollection"?"GeometryCollection":n.type==="Feature"&&n.geometry!==null?n.geometry.type:n.type}function Zm(n,e,t={}){if(t.final===!0)return fj(n,e);const i=Kh(n),c=Kh(e),u=md(i[0]),m=md(c[0]),_=md(i[1]),o=md(c[1]),b=Math.sin(m-u)*Math.cos(o),I=Math.cos(_)*Math.sin(o)-Math.sin(_)*Math.cos(o)*Math.cos(m-u);return p8(Math.atan2(b,I))}function fj(n,e){let t=Zm(e,n);return t=(t+180)%360,t}function Of(n,e,t={}){var i=Kh(n),c=Kh(e),u=md(c[1]-i[1]),m=md(c[0]-i[0]),_=md(i[1]),o=md(c[1]),b=Math.pow(Math.sin(u/2),2)+Math.pow(Math.sin(m/2),2)*Math.cos(_)*Math.cos(o);return f8(2*Math.atan2(Math.sqrt(b),Math.sqrt(1-b)),t.units)}function y8(n,e,t={}){let i;return t.final?i=fA(Kh(e),Kh(n)):i=fA(Kh(n),Kh(e)),i>180?-(360-i):i}function fA(n,e){const t=md(n[1]),i=md(e[1]);let c=md(e[0]-n[0]);c>Math.PI&&(c-=2*Math.PI),c<-Math.PI&&(c+=2*Math.PI);const u=Math.log(Math.tan(i/2+Math.PI/4)/Math.tan(t/2+Math.PI/4)),m=Math.atan2(c,u);return(p8(m)+360)%360}function ym(n,e,t){if(n!==null)for(var i,c,u,m,_,o,b,I=0,M=0,V,k=n.type,ie=k==="FeatureCollection",se=k==="Feature",de=ie?n.features.length:1,J=0;J<de;J++){b=ie?n.features[J].geometry:se?n.geometry:n,V=b?b.type==="GeometryCollection":!1,_=V?b.geometries.length:1;for(var ne=0;ne<_;ne++){var me=0,ue=0;if(m=V?b.geometries[ne]:b,m!==null){o=m.coordinates;var ke=m.type;switch(I=t&&(ke==="Polygon"||ke==="MultiPolygon")?1:0,ke){case null:break;case"Point":if(e(o,M,J,me,ue)===!1)return!1;M++,me++;break;case"LineString":case"MultiPoint":for(i=0;i<o.length;i++){if(e(o[i],M,J,me,ue)===!1)return!1;M++,ke==="MultiPoint"&&me++}ke==="LineString"&&me++;break;case"Polygon":case"MultiLineString":for(i=0;i<o.length;i++){for(c=0;c<o[i].length-I;c++){if(e(o[i][c],M,J,me,ue)===!1)return!1;M++}ke==="MultiLineString"&&me++,ke==="Polygon"&&ue++}ke==="Polygon"&&me++;break;case"MultiPolygon":for(i=0;i<o.length;i++){for(ue=0,c=0;c<o[i].length;c++){for(u=0;u<o[i][c].length-I;u++){if(e(o[i][c][u],M,J,me,ue)===!1)return!1;M++}ue++}me++}break;case"GeometryCollection":for(i=0;i<m.geometries.length;i++)if(ym(m.geometries[i],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function pj(n,e){if(n.type==="Feature")e(n,0);else if(n.type==="FeatureCollection")for(var t=0;t<n.features.length&&e(n.features[t],t)!==!1;t++);}function _8(n,e){var t,i,c,u,m,_,o,b,I,M,V=0,k=n.type==="FeatureCollection",ie=n.type==="Feature",se=k?n.features.length:1;for(t=0;t<se;t++){for(_=k?n.features[t].geometry:ie?n.geometry:n,b=k?n.features[t].properties:ie?n.properties:{},I=k?n.features[t].bbox:ie?n.bbox:void 0,M=k?n.features[t].id:ie?n.id:void 0,o=_?_.type==="GeometryCollection":!1,m=o?_.geometries.length:1,c=0;c<m;c++){if(u=o?_.geometries[c]:_,u===null){if(e(null,V,b,I,M)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(u,V,b,I,M)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<u.geometries.length;i++)if(e(u.geometries[i],V,b,I,M)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}V++}}function mj(n,e,t){var i=t;return _8(n,function(c,u,m,_,o){i=e(i,c,u,m,_,o)}),i}function pA(n){return mj(n,(e,t)=>e+gj(t),0)}function gj(n){let e=0,t;switch(n.type){case"Polygon":return mA(n.coordinates);case"MultiPolygon":for(t=0;t<n.coordinates.length;t++)e+=mA(n.coordinates[t]);return e;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function mA(n){let e=0;if(n&&n.length>0){e+=Math.abs(gA(n[0]));for(let t=1;t<n.length;t++)e-=Math.abs(gA(n[t]))}return e}var yj=Gu*Gu/2,Hb=Math.PI/180;function gA(n){const e=n.length-1;if(e<=2)return 0;let t=0,i=0;for(;i<e;){const c=n[i],u=n[i+1===e?0:i+1],m=n[i+2>=e?(i+2)%e:i+2],_=c[0]*Hb,o=u[1]*Hb,b=m[0]*Hb;t+=(b-_)*Math.sin(o),i++}return t*yj}function Cu(n,e={}){if(n.bbox!=null&&e.recompute!==!0)return n.bbox;const t=[1/0,1/0,-1/0,-1/0];return ym(n,i=>{t[0]>i[0]&&(t[0]=i[0]),t[1]>i[1]&&(t[1]=i[1]),t[2]<i[0]&&(t[2]=i[0]),t[3]<i[1]&&(t[3]=i[1])}),t}const wp=11102230246251565e-32,ph=134217729,_j=(3+8*wp)*wp;function Wb(n,e,t,i,c){let u,m,_,o,b=e[0],I=i[0],M=0,V=0;I>b==I>-b?(u=b,b=e[++M]):(u=I,I=i[++V]);let k=0;if(M<n&&V<t)for(I>b==I>-b?(m=b+u,_=u-(m-b),b=e[++M]):(m=I+u,_=u-(m-I),I=i[++V]),u=m,_!==0&&(c[k++]=_);M<n&&V<t;)I>b==I>-b?(m=u+b,o=m-u,_=u-(m-o)+(b-o),b=e[++M]):(m=u+I,o=m-u,_=u-(m-o)+(I-o),I=i[++V]),u=m,_!==0&&(c[k++]=_);for(;M<n;)m=u+b,o=m-u,_=u-(m-o)+(b-o),b=e[++M],u=m,_!==0&&(c[k++]=_);for(;V<t;)m=u+I,o=m-u,_=u-(m-o)+(I-o),I=i[++V],u=m,_!==0&&(c[k++]=_);return(u!==0||k===0)&&(c[k++]=u),k}function vj(n,e){let t=e[0];for(let i=1;i<n;i++)t+=e[i];return t}function D_(n){return new Float64Array(n)}const xj=(3+16*wp)*wp,bj=(2+12*wp)*wp,wj=(9+64*wp)*wp*wp,Xg=D_(4),yA=D_(8),_A=D_(12),vA=D_(16),Ih=D_(4);function Sj(n,e,t,i,c,u,m){let _,o,b,I,M,V,k,ie,se,de,J,ne,me,ue,ke,ze,pe,U;const F=n-c,q=t-c,j=e-u,H=i-u;ue=F*H,V=ph*F,k=V-(V-F),ie=F-k,V=ph*H,se=V-(V-H),de=H-se,ke=ie*de-(ue-k*se-ie*se-k*de),ze=j*q,V=ph*j,k=V-(V-j),ie=j-k,V=ph*q,se=V-(V-q),de=q-se,pe=ie*de-(ze-k*se-ie*se-k*de),J=ke-pe,M=ke-J,Xg[0]=ke-(J+M)+(M-pe),ne=ue+J,M=ne-ue,me=ue-(ne-M)+(J-M),J=me-ze,M=me-J,Xg[1]=me-(J+M)+(M-ze),U=ne+J,M=U-ne,Xg[2]=ne-(U-M)+(J-M),Xg[3]=U;let Z=vj(4,Xg),be=bj*m;if(Z>=be||-Z>=be||(M=n-F,_=n-(F+M)+(M-c),M=t-q,b=t-(q+M)+(M-c),M=e-j,o=e-(j+M)+(M-u),M=i-H,I=i-(H+M)+(M-u),_===0&&o===0&&b===0&&I===0)||(be=wj*m+_j*Math.abs(Z),Z+=F*I+H*_-(j*b+q*o),Z>=be||-Z>=be))return Z;ue=_*H,V=ph*_,k=V-(V-_),ie=_-k,V=ph*H,se=V-(V-H),de=H-se,ke=ie*de-(ue-k*se-ie*se-k*de),ze=o*q,V=ph*o,k=V-(V-o),ie=o-k,V=ph*q,se=V-(V-q),de=q-se,pe=ie*de-(ze-k*se-ie*se-k*de),J=ke-pe,M=ke-J,Ih[0]=ke-(J+M)+(M-pe),ne=ue+J,M=ne-ue,me=ue-(ne-M)+(J-M),J=me-ze,M=me-J,Ih[1]=me-(J+M)+(M-ze),U=ne+J,M=U-ne,Ih[2]=ne-(U-M)+(J-M),Ih[3]=U;const Re=Wb(4,Xg,4,Ih,yA);ue=F*I,V=ph*F,k=V-(V-F),ie=F-k,V=ph*I,se=V-(V-I),de=I-se,ke=ie*de-(ue-k*se-ie*se-k*de),ze=j*b,V=ph*j,k=V-(V-j),ie=j-k,V=ph*b,se=V-(V-b),de=b-se,pe=ie*de-(ze-k*se-ie*se-k*de),J=ke-pe,M=ke-J,Ih[0]=ke-(J+M)+(M-pe),ne=ue+J,M=ne-ue,me=ue-(ne-M)+(J-M),J=me-ze,M=me-J,Ih[1]=me-(J+M)+(M-ze),U=ne+J,M=U-ne,Ih[2]=ne-(U-M)+(J-M),Ih[3]=U;const Oe=Wb(Re,yA,4,Ih,_A);ue=_*I,V=ph*_,k=V-(V-_),ie=_-k,V=ph*I,se=V-(V-I),de=I-se,ke=ie*de-(ue-k*se-ie*se-k*de),ze=o*b,V=ph*o,k=V-(V-o),ie=o-k,V=ph*b,se=V-(V-b),de=b-se,pe=ie*de-(ze-k*se-ie*se-k*de),J=ke-pe,M=ke-J,Ih[0]=ke-(J+M)+(M-pe),ne=ue+J,M=ne-ue,me=ue-(ne-M)+(J-M),J=me-ze,M=me-J,Ih[1]=me-(J+M)+(M-ze),U=ne+J,M=U-ne,Ih[2]=ne-(U-M)+(J-M),Ih[3]=U;const Me=Wb(Oe,_A,4,Ih,vA);return vA[Me-1]}function Ej(n,e,t,i,c,u){const m=(e-u)*(t-c),_=(n-c)*(i-u),o=m-_,b=Math.abs(m+_);return Math.abs(o)>=xj*b?o:-Sj(n,e,t,i,c,u,b)}function Aj(n,e){var t,i,c=0,u,m,_,o,b,I,M,V=n[0],k=n[1],ie=e.length;for(t=0;t<ie;t++){i=0;var se=e[t],de=se.length-1;if(I=se[0],I[0]!==se[de][0]&&I[1]!==se[de][1])throw new Error("First and last coordinates in a ring must be the same");for(m=I[0]-V,_=I[1]-k,i;i<de;i++){if(M=se[i+1],o=M[0]-V,b=M[1]-k,_===0&&b===0){if(o<=0&&m>=0||m<=0&&o>=0)return 0}else if(b>=0&&_<=0||b<=0&&_>=0){if(u=Ej(m,o,_,b,0,0),u===0)return 0;(u>0&&b>0&&_<=0||u<0&&b<=0&&_>0)&&c++}I=M,_=b,m=o}}return c%2!==0}function Tj(n,e,t={}){if(!n)throw new Error("point is required");if(!e)throw new Error("polygon is required");const i=Kh(n),c=dj(e),u=c.type,m=e.bbox;let _=c.coordinates;if(m&&Ij(i,m)===!1)return!1;u==="Polygon"&&(_=[_]);let o=!1;for(var b=0;b<_.length;++b){const I=Aj(i,_[b]);if(I===0)return!t.ignoreBoundary;I&&(o=!0)}return o}function Ij(n,e){return e[0]<=n[0]&&e[1]<=n[1]&&e[2]>=n[0]&&e[3]>=n[1]}function Cj(n,e={}){const t=Cu(n),i=(t[0]+t[2])/2,c=(t[1]+t[3])/2;return gs([i,c],e.properties,e)}function Ol(n,e={}){let t=0,i=0,c=0;return ym(n,function(u){t+=u[0],i+=u[1],c++},!0),gs([t/c,i/c],e.properties)}var L1={exports:{}},nv={exports:{}},Lj=nv.exports,xA;function Pj(){return xA||(xA=1,(function(n,e){(function(t,i){n.exports=i()})(Lj,function(){function t(ne,me,ue,ke,ze){(function pe(U,F,q,j,H){for(;j>q;){if(j-q>600){var Z=j-q+1,be=F-q+1,Re=Math.log(Z),Oe=.5*Math.exp(2*Re/3),Me=.5*Math.sqrt(Re*Oe*(Z-Oe)/Z)*(be-Z/2<0?-1:1),we=Math.max(q,Math.floor(F-be*Oe/Z+Me)),De=Math.min(j,Math.floor(F+(Z-be)*Oe/Z+Me));pe(U,F,we,De,H)}var tt=U[F],xe=q,le=j;for(i(U,q,F),H(U[j],tt)>0&&i(U,q,j);xe<le;){for(i(U,xe,le),xe++,le--;H(U[xe],tt)<0;)xe++;for(;H(U[le],tt)>0;)le--}H(U[q],tt)===0?i(U,q,le):i(U,++le,j),le<=F&&(q=le+1),F<=le&&(j=le-1)}})(ne,me,ue||0,ke||ne.length-1,ze||c)}function i(ne,me,ue){var ke=ne[me];ne[me]=ne[ue],ne[ue]=ke}function c(ne,me){return ne<me?-1:ne>me?1:0}var u=function(ne){ne===void 0&&(ne=9),this._maxEntries=Math.max(4,ne),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function m(ne,me,ue){if(!ue)return me.indexOf(ne);for(var ke=0;ke<me.length;ke++)if(ue(ne,me[ke]))return ke;return-1}function _(ne,me){o(ne,0,ne.children.length,me,ne)}function o(ne,me,ue,ke,ze){ze||(ze=de(null)),ze.minX=1/0,ze.minY=1/0,ze.maxX=-1/0,ze.maxY=-1/0;for(var pe=me;pe<ue;pe++){var U=ne.children[pe];b(ze,ne.leaf?ke(U):U)}return ze}function b(ne,me){return ne.minX=Math.min(ne.minX,me.minX),ne.minY=Math.min(ne.minY,me.minY),ne.maxX=Math.max(ne.maxX,me.maxX),ne.maxY=Math.max(ne.maxY,me.maxY),ne}function I(ne,me){return ne.minX-me.minX}function M(ne,me){return ne.minY-me.minY}function V(ne){return(ne.maxX-ne.minX)*(ne.maxY-ne.minY)}function k(ne){return ne.maxX-ne.minX+(ne.maxY-ne.minY)}function ie(ne,me){return ne.minX<=me.minX&&ne.minY<=me.minY&&me.maxX<=ne.maxX&&me.maxY<=ne.maxY}function se(ne,me){return me.minX<=ne.maxX&&me.minY<=ne.maxY&&me.maxX>=ne.minX&&me.maxY>=ne.minY}function de(ne){return{children:ne,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function J(ne,me,ue,ke,ze){for(var pe=[me,ue];pe.length;)if(!((ue=pe.pop())-(me=pe.pop())<=ke)){var U=me+Math.ceil((ue-me)/ke/2)*ke;t(ne,U,me,ue,ze),pe.push(me,U,U,ue)}}return u.prototype.all=function(){return this._all(this.data,[])},u.prototype.search=function(ne){var me=this.data,ue=[];if(!se(ne,me))return ue;for(var ke=this.toBBox,ze=[];me;){for(var pe=0;pe<me.children.length;pe++){var U=me.children[pe],F=me.leaf?ke(U):U;se(ne,F)&&(me.leaf?ue.push(U):ie(ne,F)?this._all(U,ue):ze.push(U))}me=ze.pop()}return ue},u.prototype.collides=function(ne){var me=this.data;if(!se(ne,me))return!1;for(var ue=[];me;){for(var ke=0;ke<me.children.length;ke++){var ze=me.children[ke],pe=me.leaf?this.toBBox(ze):ze;if(se(ne,pe)){if(me.leaf||ie(ne,pe))return!0;ue.push(ze)}}me=ue.pop()}return!1},u.prototype.load=function(ne){if(!ne||!ne.length)return this;if(ne.length<this._minEntries){for(var me=0;me<ne.length;me++)this.insert(ne[me]);return this}var ue=this._build(ne.slice(),0,ne.length-1,0);if(this.data.children.length)if(this.data.height===ue.height)this._splitRoot(this.data,ue);else{if(this.data.height<ue.height){var ke=this.data;this.data=ue,ue=ke}this._insert(ue,this.data.height-ue.height-1,!0)}else this.data=ue;return this},u.prototype.insert=function(ne){return ne&&this._insert(ne,this.data.height-1),this},u.prototype.clear=function(){return this.data=de([]),this},u.prototype.remove=function(ne,me){if(!ne)return this;for(var ue,ke,ze,pe=this.data,U=this.toBBox(ne),F=[],q=[];pe||F.length;){if(pe||(pe=F.pop(),ke=F[F.length-1],ue=q.pop(),ze=!0),pe.leaf){var j=m(ne,pe.children,me);if(j!==-1)return pe.children.splice(j,1),F.push(pe),this._condense(F),this}ze||pe.leaf||!ie(pe,U)?ke?(ue++,pe=ke.children[ue],ze=!1):pe=null:(F.push(pe),q.push(ue),ue=0,ke=pe,pe=pe.children[0])}return this},u.prototype.toBBox=function(ne){return ne},u.prototype.compareMinX=function(ne,me){return ne.minX-me.minX},u.prototype.compareMinY=function(ne,me){return ne.minY-me.minY},u.prototype.toJSON=function(){return this.data},u.prototype.fromJSON=function(ne){return this.data=ne,this},u.prototype._all=function(ne,me){for(var ue=[];ne;)ne.leaf?me.push.apply(me,ne.children):ue.push.apply(ue,ne.children),ne=ue.pop();return me},u.prototype._build=function(ne,me,ue,ke){var ze,pe=ue-me+1,U=this._maxEntries;if(pe<=U)return _(ze=de(ne.slice(me,ue+1)),this.toBBox),ze;ke||(ke=Math.ceil(Math.log(pe)/Math.log(U)),U=Math.ceil(pe/Math.pow(U,ke-1))),(ze=de([])).leaf=!1,ze.height=ke;var F=Math.ceil(pe/U),q=F*Math.ceil(Math.sqrt(U));J(ne,me,ue,q,this.compareMinX);for(var j=me;j<=ue;j+=q){var H=Math.min(j+q-1,ue);J(ne,j,H,F,this.compareMinY);for(var Z=j;Z<=H;Z+=F){var be=Math.min(Z+F-1,H);ze.children.push(this._build(ne,Z,be,ke-1))}}return _(ze,this.toBBox),ze},u.prototype._chooseSubtree=function(ne,me,ue,ke){for(;ke.push(me),!me.leaf&&ke.length-1!==ue;){for(var ze=1/0,pe=1/0,U=void 0,F=0;F<me.children.length;F++){var q=me.children[F],j=V(q),H=(Z=ne,be=q,(Math.max(be.maxX,Z.maxX)-Math.min(be.minX,Z.minX))*(Math.max(be.maxY,Z.maxY)-Math.min(be.minY,Z.minY))-j);H<pe?(pe=H,ze=j<ze?j:ze,U=q):H===pe&&j<ze&&(ze=j,U=q)}me=U||me.children[0]}var Z,be;return me},u.prototype._insert=function(ne,me,ue){var ke=ue?ne:this.toBBox(ne),ze=[],pe=this._chooseSubtree(ke,this.data,me,ze);for(pe.children.push(ne),b(pe,ke);me>=0&&ze[me].children.length>this._maxEntries;)this._split(ze,me),me--;this._adjustParentBBoxes(ke,ze,me)},u.prototype._split=function(ne,me){var ue=ne[me],ke=ue.children.length,ze=this._minEntries;this._chooseSplitAxis(ue,ze,ke);var pe=this._chooseSplitIndex(ue,ze,ke),U=de(ue.children.splice(pe,ue.children.length-pe));U.height=ue.height,U.leaf=ue.leaf,_(ue,this.toBBox),_(U,this.toBBox),me?ne[me-1].children.push(U):this._splitRoot(ue,U)},u.prototype._splitRoot=function(ne,me){this.data=de([ne,me]),this.data.height=ne.height+1,this.data.leaf=!1,_(this.data,this.toBBox)},u.prototype._chooseSplitIndex=function(ne,me,ue){for(var ke,ze,pe,U,F,q,j,H=1/0,Z=1/0,be=me;be<=ue-me;be++){var Re=o(ne,0,be,this.toBBox),Oe=o(ne,be,ue,this.toBBox),Me=(ze=Re,pe=Oe,U=void 0,F=void 0,q=void 0,j=void 0,U=Math.max(ze.minX,pe.minX),F=Math.max(ze.minY,pe.minY),q=Math.min(ze.maxX,pe.maxX),j=Math.min(ze.maxY,pe.maxY),Math.max(0,q-U)*Math.max(0,j-F)),we=V(Re)+V(Oe);Me<H?(H=Me,ke=be,Z=we<Z?we:Z):Me===H&&we<Z&&(Z=we,ke=be)}return ke||ue-me},u.prototype._chooseSplitAxis=function(ne,me,ue){var ke=ne.leaf?this.compareMinX:I,ze=ne.leaf?this.compareMinY:M;this._allDistMargin(ne,me,ue,ke)<this._allDistMargin(ne,me,ue,ze)&&ne.children.sort(ke)},u.prototype._allDistMargin=function(ne,me,ue,ke){ne.children.sort(ke);for(var ze=this.toBBox,pe=o(ne,0,me,ze),U=o(ne,ue-me,ue,ze),F=k(pe)+k(U),q=me;q<ue-me;q++){var j=ne.children[q];b(pe,ne.leaf?ze(j):j),F+=k(pe)}for(var H=ue-me-1;H>=me;H--){var Z=ne.children[H];b(U,ne.leaf?ze(Z):Z),F+=k(U)}return F},u.prototype._adjustParentBBoxes=function(ne,me,ue){for(var ke=ue;ke>=0;ke--)b(me[ke],ne)},u.prototype._condense=function(ne){for(var me=ne.length-1,ue=void 0;me>=0;me--)ne[me].children.length===0?me>0?(ue=ne[me-1].children).splice(ue.indexOf(ne[me]),1):this.clear():_(ne[me],this.toBBox)},u})})(nv)),nv.exports}class kj{constructor(e=[],t=Rj){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:i}=this,c=t[e];for(;e>0;){const u=e-1>>1,m=t[u];if(i(c,m)>=0)break;t[e]=m,e=u}t[e]=c}_down(e){const{data:t,compare:i}=this,c=this.length>>1,u=t[e];for(;e<c;){let m=(e<<1)+1,_=t[m];const o=m+1;if(o<this.length&&i(t[o],_)<0&&(m=o,_=t[o]),i(_,u)>=0)break;t[e]=_,e=m}t[e]=u}}function Rj(n,e){return n<e?-1:n>e?1:0}const Mj=Object.freeze(Object.defineProperty({__proto__:null,default:kj},Symbol.toStringTag,{value:"Module"})),Nj=XL(Mj);var Iy={exports:{}},Kb,bA;function Dj(){return bA||(bA=1,Kb=function(e,t,i,c){var u=e[0],m=e[1],_=!1;i===void 0&&(i=0),c===void 0&&(c=t.length);for(var o=(c-i)/2,b=0,I=o-1;b<o;I=b++){var M=t[i+b*2+0],V=t[i+b*2+1],k=t[i+I*2+0],ie=t[i+I*2+1],se=V>m!=ie>m&&u<(k-M)*(m-V)/(ie-V)+M;se&&(_=!_)}return _}),Kb}var Xb,wA;function Fj(){return wA||(wA=1,Xb=function(e,t,i,c){var u=e[0],m=e[1],_=!1;i===void 0&&(i=0),c===void 0&&(c=t.length);for(var o=c-i,b=0,I=o-1;b<o;I=b++){var M=t[b+i][0],V=t[b+i][1],k=t[I+i][0],ie=t[I+i][1],se=V>m!=ie>m&&u<(k-M)*(m-V)/(ie-V)+M;se&&(_=!_)}return _}),Xb}var SA;function Oj(){if(SA)return Iy.exports;SA=1;var n=Dj(),e=Fj();return Iy.exports=function(i,c,u,m){return c.length>0&&Array.isArray(c[0])?e(i,c,u,m):n(i,c,u,m)},Iy.exports.nested=e,Iy.exports.flat=n,Iy.exports}var Fy={exports:{}},Bj=Fy.exports,EA;function zj(){return EA||(EA=1,(function(n,e){(function(t,i){i(e)})(Bj,function(t){const c=33306690738754706e-32;function u(se,de,J,ne,me){let ue,ke,ze,pe,U=de[0],F=ne[0],q=0,j=0;F>U==F>-U?(ue=U,U=de[++q]):(ue=F,F=ne[++j]);let H=0;if(q<se&&j<J)for(F>U==F>-U?(ze=ue-((ke=U+ue)-U),U=de[++q]):(ze=ue-((ke=F+ue)-F),F=ne[++j]),ue=ke,ze!==0&&(me[H++]=ze);q<se&&j<J;)F>U==F>-U?(ze=ue-((ke=ue+U)-(pe=ke-ue))+(U-pe),U=de[++q]):(ze=ue-((ke=ue+F)-(pe=ke-ue))+(F-pe),F=ne[++j]),ue=ke,ze!==0&&(me[H++]=ze);for(;q<se;)ze=ue-((ke=ue+U)-(pe=ke-ue))+(U-pe),U=de[++q],ue=ke,ze!==0&&(me[H++]=ze);for(;j<J;)ze=ue-((ke=ue+F)-(pe=ke-ue))+(F-pe),F=ne[++j],ue=ke,ze!==0&&(me[H++]=ze);return ue===0&&H!==0||(me[H++]=ue),H}function m(se){return new Float64Array(se)}const _=33306690738754716e-32,o=22204460492503146e-32,b=11093356479670487e-47,I=m(4),M=m(8),V=m(12),k=m(16),ie=m(4);t.orient2d=function(se,de,J,ne,me,ue){const ke=(de-ue)*(J-me),ze=(se-me)*(ne-ue),pe=ke-ze;if(ke===0||ze===0||ke>0!=ze>0)return pe;const U=Math.abs(ke+ze);return Math.abs(pe)>=_*U?pe:-(function(F,q,j,H,Z,be,Re){let Oe,Me,we,De,tt,xe,le,Ne,Be,Qe,rt,gt,pt,Mt,Jt,hn,yn,Mn;const Gt=F-Z,ot=j-Z,dr=q-be,wr=H-be;tt=(Jt=(Ne=Gt-(le=(xe=134217729*Gt)-(xe-Gt)))*(Qe=wr-(Be=(xe=134217729*wr)-(xe-wr)))-((Mt=Gt*wr)-le*Be-Ne*Be-le*Qe))-(rt=Jt-(yn=(Ne=dr-(le=(xe=134217729*dr)-(xe-dr)))*(Qe=ot-(Be=(xe=134217729*ot)-(xe-ot)))-((hn=dr*ot)-le*Be-Ne*Be-le*Qe))),I[0]=Jt-(rt+tt)+(tt-yn),tt=(pt=Mt-((gt=Mt+rt)-(tt=gt-Mt))+(rt-tt))-(rt=pt-hn),I[1]=pt-(rt+tt)+(tt-hn),tt=(Mn=gt+rt)-gt,I[2]=gt-(Mn-tt)+(rt-tt),I[3]=Mn;let Cr=(function(qt,Pn){let Hn=Pn[0];for(let Bn=1;Bn<qt;Bn++)Hn+=Pn[Bn];return Hn})(4,I),Ln=o*Re;if(Cr>=Ln||-Cr>=Ln||(Oe=F-(Gt+(tt=F-Gt))+(tt-Z),we=j-(ot+(tt=j-ot))+(tt-Z),Me=q-(dr+(tt=q-dr))+(tt-be),De=H-(wr+(tt=H-wr))+(tt-be),Oe===0&&Me===0&&we===0&&De===0)||(Ln=b*Re+c*Math.abs(Cr),(Cr+=Gt*De+wr*Oe-(dr*we+ot*Me))>=Ln||-Cr>=Ln))return Cr;tt=(Jt=(Ne=Oe-(le=(xe=134217729*Oe)-(xe-Oe)))*(Qe=wr-(Be=(xe=134217729*wr)-(xe-wr)))-((Mt=Oe*wr)-le*Be-Ne*Be-le*Qe))-(rt=Jt-(yn=(Ne=Me-(le=(xe=134217729*Me)-(xe-Me)))*(Qe=ot-(Be=(xe=134217729*ot)-(xe-ot)))-((hn=Me*ot)-le*Be-Ne*Be-le*Qe))),ie[0]=Jt-(rt+tt)+(tt-yn),tt=(pt=Mt-((gt=Mt+rt)-(tt=gt-Mt))+(rt-tt))-(rt=pt-hn),ie[1]=pt-(rt+tt)+(tt-hn),tt=(Mn=gt+rt)-gt,ie[2]=gt-(Mn-tt)+(rt-tt),ie[3]=Mn;const ir=u(4,I,4,ie,M);tt=(Jt=(Ne=Gt-(le=(xe=134217729*Gt)-(xe-Gt)))*(Qe=De-(Be=(xe=134217729*De)-(xe-De)))-((Mt=Gt*De)-le*Be-Ne*Be-le*Qe))-(rt=Jt-(yn=(Ne=dr-(le=(xe=134217729*dr)-(xe-dr)))*(Qe=we-(Be=(xe=134217729*we)-(xe-we)))-((hn=dr*we)-le*Be-Ne*Be-le*Qe))),ie[0]=Jt-(rt+tt)+(tt-yn),tt=(pt=Mt-((gt=Mt+rt)-(tt=gt-Mt))+(rt-tt))-(rt=pt-hn),ie[1]=pt-(rt+tt)+(tt-hn),tt=(Mn=gt+rt)-gt,ie[2]=gt-(Mn-tt)+(rt-tt),ie[3]=Mn;const Qn=u(ir,M,4,ie,V);tt=(Jt=(Ne=Oe-(le=(xe=134217729*Oe)-(xe-Oe)))*(Qe=De-(Be=(xe=134217729*De)-(xe-De)))-((Mt=Oe*De)-le*Be-Ne*Be-le*Qe))-(rt=Jt-(yn=(Ne=Me-(le=(xe=134217729*Me)-(xe-Me)))*(Qe=we-(Be=(xe=134217729*we)-(xe-we)))-((hn=Me*we)-le*Be-Ne*Be-le*Qe))),ie[0]=Jt-(rt+tt)+(tt-yn),tt=(pt=Mt-((gt=Mt+rt)-(tt=gt-Mt))+(rt-tt))-(rt=pt-hn),ie[1]=pt-(rt+tt)+(tt-hn),tt=(Mn=gt+rt)-gt,ie[2]=gt-(Mn-tt)+(rt-tt),ie[3]=Mn;const Kr=u(Qn,V,4,ie,k);return k[Kr-1]})(se,de,J,ne,me,ue,U)},t.orient2dfast=function(se,de,J,ne,me,ue){return(de-ue)*(J-me)-(se-me)*(ne-ue)},Object.defineProperty(t,"__esModule",{value:!0})})})(Fy,Fy.exports)),Fy.exports}var AA;function jj(){if(AA)return L1.exports;AA=1;var n=Pj(),e=Nj,t=Oj(),i=zj().orient2d;e.default&&(e=e.default),L1.exports=c,L1.exports.default=c;function c(ue,ke,ze){ke=Math.max(0,ke===void 0?2:ke),ze=ze||0;var pe=k(ue),U=new n(16);U.toBBox=function(le){return{minX:le[0],minY:le[1],maxX:le[0],maxY:le[1]}},U.compareMinX=function(le,Ne){return le[0]-Ne[0]},U.compareMinY=function(le,Ne){return le[1]-Ne[1]},U.load(ue);for(var F=[],q=0,j;q<pe.length;q++){var H=pe[q];U.remove(H),j=ie(H,j),F.push(j)}var Z=new n(16);for(q=0;q<F.length;q++)Z.insert(V(F[q]));for(var be=ke*ke,Re=ze*ze;F.length;){var Oe=F.shift(),Me=Oe.p,we=Oe.next.p,De=se(Me,we);if(!(De<Re)){var tt=De/be;H=u(U,Oe.prev.p,Me,we,Oe.next.next.p,tt,Z),H&&Math.min(se(H,Me),se(H,we))<=tt&&(F.push(Oe),F.push(ie(H,Oe)),U.remove(H),Z.remove(Oe),Z.insert(V(Oe)),Z.insert(V(Oe.next)))}}Oe=j;var xe=[];do xe.push(Oe.p),Oe=Oe.next;while(Oe!==j);return xe.push(Oe.p),xe}function u(ue,ke,ze,pe,U,F,q){for(var j=new e([],m),H=ue.data;H;){for(var Z=0;Z<H.children.length;Z++){var be=H.children[Z],Re=H.leaf?de(be,ze,pe):_(ze,pe,be);Re>F||j.push({node:be,dist:Re})}for(;j.length&&!j.peek().node.children;){var Oe=j.pop(),Me=Oe.node,we=de(Me,ke,ze),De=de(Me,pe,U);if(Oe.dist<we&&Oe.dist<De&&b(ze,Me,q)&&b(pe,Me,q))return Me}H=j.pop(),H&&(H=H.node)}return null}function m(ue,ke){return ue.dist-ke.dist}function _(ue,ke,ze){if(o(ue,ze)||o(ke,ze))return 0;var pe=J(ue[0],ue[1],ke[0],ke[1],ze.minX,ze.minY,ze.maxX,ze.minY);if(pe===0)return 0;var U=J(ue[0],ue[1],ke[0],ke[1],ze.minX,ze.minY,ze.minX,ze.maxY);if(U===0)return 0;var F=J(ue[0],ue[1],ke[0],ke[1],ze.maxX,ze.minY,ze.maxX,ze.maxY);if(F===0)return 0;var q=J(ue[0],ue[1],ke[0],ke[1],ze.minX,ze.maxY,ze.maxX,ze.maxY);return q===0?0:Math.min(pe,U,F,q)}function o(ue,ke){return ue[0]>=ke.minX&&ue[0]<=ke.maxX&&ue[1]>=ke.minY&&ue[1]<=ke.maxY}function b(ue,ke,ze){for(var pe=Math.min(ue[0],ke[0]),U=Math.min(ue[1],ke[1]),F=Math.max(ue[0],ke[0]),q=Math.max(ue[1],ke[1]),j=ze.search({minX:pe,minY:U,maxX:F,maxY:q}),H=0;H<j.length;H++)if(M(j[H].p,j[H].next.p,ue,ke))return!1;return!0}function I(ue,ke,ze){return i(ue[0],ue[1],ke[0],ke[1],ze[0],ze[1])}function M(ue,ke,ze,pe){return ue!==pe&&ke!==ze&&I(ue,ke,ze)>0!=I(ue,ke,pe)>0&&I(ze,pe,ue)>0!=I(ze,pe,ke)>0}function V(ue){var ke=ue.p,ze=ue.next.p;return ue.minX=Math.min(ke[0],ze[0]),ue.minY=Math.min(ke[1],ze[1]),ue.maxX=Math.max(ke[0],ze[0]),ue.maxY=Math.max(ke[1],ze[1]),ue}function k(ue){for(var ke=ue[0],ze=ue[0],pe=ue[0],U=ue[0],F=0;F<ue.length;F++){var q=ue[F];q[0]<ke[0]&&(ke=q),q[0]>pe[0]&&(pe=q),q[1]<ze[1]&&(ze=q),q[1]>U[1]&&(U=q)}var j=[ke,ze,pe,U],H=j.slice();for(F=0;F<ue.length;F++)t(ue[F],j)||H.push(ue[F]);return me(H)}function ie(ue,ke){var ze={p:ue,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return ke?(ze.next=ke.next,ze.prev=ke,ke.next.prev=ze,ke.next=ze):(ze.prev=ze,ze.next=ze),ze}function se(ue,ke){var ze=ue[0]-ke[0],pe=ue[1]-ke[1];return ze*ze+pe*pe}function de(ue,ke,ze){var pe=ke[0],U=ke[1],F=ze[0]-pe,q=ze[1]-U;if(F!==0||q!==0){var j=((ue[0]-pe)*F+(ue[1]-U)*q)/(F*F+q*q);j>1?(pe=ze[0],U=ze[1]):j>0&&(pe+=F*j,U+=q*j)}return F=ue[0]-pe,q=ue[1]-U,F*F+q*q}function J(ue,ke,ze,pe,U,F,q,j){var H=ze-ue,Z=pe-ke,be=q-U,Re=j-F,Oe=ue-U,Me=ke-F,we=H*H+Z*Z,De=H*be+Z*Re,tt=be*be+Re*Re,xe=H*Oe+Z*Me,le=be*Oe+Re*Me,Ne=we*tt-De*De,Be,Qe,rt,gt,pt=Ne,Mt=Ne;Ne===0?(Qe=0,pt=1,gt=le,Mt=tt):(Qe=De*le-tt*xe,gt=we*le-De*xe,Qe<0?(Qe=0,gt=le,Mt=tt):Qe>pt&&(Qe=pt,gt=le+De,Mt=tt)),gt<0?(gt=0,-xe<0?Qe=0:-xe>we?Qe=pt:(Qe=-xe,pt=we)):gt>Mt&&(gt=Mt,-xe+De<0?Qe=0:-xe+De>we?Qe=pt:(Qe=-xe+De,pt=we)),Be=Qe===0?0:Qe/pt,rt=gt===0?0:gt/Mt;var Jt=(1-Be)*ue+Be*ze,hn=(1-Be)*ke+Be*pe,yn=(1-rt)*U+rt*q,Mn=(1-rt)*F+rt*j,Gt=yn-Jt,ot=Mn-hn;return Gt*Gt+ot*ot}function ne(ue,ke){return ue[0]===ke[0]?ue[1]-ke[1]:ue[0]-ke[0]}function me(ue){ue.sort(ne);for(var ke=[],ze=0;ze<ue.length;ze++){for(;ke.length>=2&&I(ke[ke.length-2],ke[ke.length-1],ue[ze])<=0;)ke.pop();ke.push(ue[ze])}for(var pe=[],U=ue.length-1;U>=0;U--){for(;pe.length>=2&&I(pe[pe.length-2],pe[pe.length-1],ue[U])<=0;)pe.pop();pe.push(ue[U])}return pe.pop(),ke.pop(),ke.concat(pe)}return L1.exports}var Uj=jj();const Vj=Yv(Uj);function v8(n,e={}){e.concavity=e.concavity||1/0;const t=[];if(ym(n,c=>{t.push([c[0],c[1]])}),!t.length)return null;const i=Vj(t,e.concavity);return i.length>3?S3([i]):null}function x8(n,e={}){switch(g8(n)){case"Point":return gs(Kh(n),e.properties);case"Polygon":var t=[];ym(n,function(ue){t.push(ue)});var i=Ol(n,{properties:e.properties}),c=i.geometry.coordinates,u=0,m=0,_=0,o,b,I,M,V,k,ie,se,de=t.map(function(ue){return[ue[0]-c[0],ue[1]-c[1]]});for(o=0;o<t.length-1;o++)b=de[o],M=b[0],k=b[1],I=de[o+1],V=I[0],ie=I[1],se=M*ie-V*k,_+=se,u+=(M+V)*se,m+=(k+ie)*se;if(_===0)return i;var J=_*.5,ne=1/(6*J);return gs([c[0]+ne*u,c[1]+ne*m],e.properties);default:var me=v8(n);return me?x8(me,{properties:e.properties}):Ol(n,{properties:e.properties})}}function I3(n){if(!n)throw new Error("geojson is required");switch(n.type){case"Feature":return b8(n);case"FeatureCollection":return qj(n);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return C3(n);default:throw new Error("unknown GeoJSON type")}}function b8(n){const e={type:"Feature"};return Object.keys(n).forEach(t=>{switch(t){case"type":case"properties":case"geometry":return;default:e[t]=n[t]}}),e.properties=w8(n.properties),n.geometry==null?e.geometry=null:e.geometry=C3(n.geometry),e}function w8(n){const e={};return n&&Object.keys(n).forEach(t=>{const i=n[t];typeof i=="object"?i===null?e[t]=null:Array.isArray(i)?e[t]=i.map(c=>c):e[t]=w8(i):e[t]=i}),e}function qj(n){const e={type:"FeatureCollection"};return Object.keys(n).forEach(t=>{switch(t){case"type":case"features":return;default:e[t]=n[t]}}),e.features=n.features.map(t=>b8(t)),e}function C3(n){const e={type:n.type};return n.bbox&&(e.bbox=n.bbox),n.type==="GeometryCollection"?(e.geometries=n.geometries.map(t=>C3(t)),e):(e.coordinates=S8(n.coordinates),e)}function S8(n){const e=n;return typeof e[0]!="object"?e.slice():e.map(t=>S8(t))}var $j=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,Zb=Math.ceil,Pd=Math.floor,Gh="[BigNumber Error] ",TA=Gh+"Number primitive has more than 15 significant digits: ",Yd=1e14,Ro=14,Yb=9007199254740991,Jb=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],Kp=1e7,Eu=1e9;function E8(n){var e,t,i,c=ne.prototype={constructor:ne,toString:null,valueOf:null},u=new ne(1),m=20,_=4,o=-7,b=21,I=-1e7,M=1e7,V=!1,k=1,ie=0,se={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"",suffix:""},de="0123456789abcdefghijklmnopqrstuvwxyz",J=!0;function ne(U,F){var q,j,H,Z,be,Re,Oe,Me,we=this;if(!(we instanceof ne))return new ne(U,F);if(F==null){if(U&&U._isBigNumber===!0){we.s=U.s,!U.c||U.e>M?we.c=we.e=null:U.e<I?we.c=[we.e=0]:(we.e=U.e,we.c=U.c.slice());return}if((Re=typeof U=="number")&&U*0==0){if(we.s=1/U<0?(U=-U,-1):1,U===~~U){for(Z=0,be=U;be>=10;be/=10,Z++);Z>M?we.c=we.e=null:(we.e=Z,we.c=[U]);return}Me=String(U)}else{if(!$j.test(Me=String(U)))return i(we,Me,Re);we.s=Me.charCodeAt(0)==45?(Me=Me.slice(1),-1):1}(Z=Me.indexOf("."))>-1&&(Me=Me.replace(".","")),(be=Me.search(/e/i))>0?(Z<0&&(Z=be),Z+=+Me.slice(be+1),Me=Me.substring(0,be)):Z<0&&(Z=Me.length)}else{if(Ql(F,2,de.length,"Base"),F==10&&J)return we=new ne(U),ze(we,m+we.e+1,_);if(Me=String(U),Re=typeof U=="number"){if(U*0!=0)return i(we,Me,Re,F);if(we.s=1/U<0?(Me=Me.slice(1),-1):1,ne.DEBUG&&Me.replace(/^0\.0*|\./,"").length>15)throw Error(TA+U)}else we.s=Me.charCodeAt(0)===45?(Me=Me.slice(1),-1):1;for(q=de.slice(0,F),Z=be=0,Oe=Me.length;be<Oe;be++)if(q.indexOf(j=Me.charAt(be))<0){if(j=="."){if(be>Z){Z=Oe;continue}}else if(!H&&(Me==Me.toUpperCase()&&(Me=Me.toLowerCase())||Me==Me.toLowerCase()&&(Me=Me.toUpperCase()))){H=!0,be=-1,Z=0;continue}return i(we,String(U),Re,F)}Re=!1,Me=t(Me,F,10,we.s),(Z=Me.indexOf("."))>-1?Me=Me.replace(".",""):Z=Me.length}for(be=0;Me.charCodeAt(be)===48;be++);for(Oe=Me.length;Me.charCodeAt(--Oe)===48;);if(Me=Me.slice(be,++Oe)){if(Oe-=be,Re&&ne.DEBUG&&Oe>15&&(U>Yb||U!==Pd(U)))throw Error(TA+we.s*U);if((Z=Z-be-1)>M)we.c=we.e=null;else if(Z<I)we.c=[we.e=0];else{if(we.e=Z,we.c=[],be=(Z+1)%Ro,Z<0&&(be+=Ro),be<Oe){for(be&&we.c.push(+Me.slice(0,be)),Oe-=Ro;be<Oe;)we.c.push(+Me.slice(be,be+=Ro));be=Ro-(Me=Me.slice(be)).length}else be-=Oe;for(;be--;Me+="0");we.c.push(+Me)}}else we.c=[we.e=0]}ne.clone=E8,ne.ROUND_UP=0,ne.ROUND_DOWN=1,ne.ROUND_CEIL=2,ne.ROUND_FLOOR=3,ne.ROUND_HALF_UP=4,ne.ROUND_HALF_DOWN=5,ne.ROUND_HALF_EVEN=6,ne.ROUND_HALF_CEIL=7,ne.ROUND_HALF_FLOOR=8,ne.EUCLID=9,ne.config=ne.set=function(U){var F,q;if(U!=null)if(typeof U=="object"){if(U.hasOwnProperty(F="DECIMAL_PLACES")&&(q=U[F],Ql(q,0,Eu,F),m=q),U.hasOwnProperty(F="ROUNDING_MODE")&&(q=U[F],Ql(q,0,8,F),_=q),U.hasOwnProperty(F="EXPONENTIAL_AT")&&(q=U[F],q&&q.pop?(Ql(q[0],-Eu,0,F),Ql(q[1],0,Eu,F),o=q[0],b=q[1]):(Ql(q,-Eu,Eu,F),o=-(b=q<0?-q:q))),U.hasOwnProperty(F="RANGE"))if(q=U[F],q&&q.pop)Ql(q[0],-Eu,-1,F),Ql(q[1],1,Eu,F),I=q[0],M=q[1];else if(Ql(q,-Eu,Eu,F),q)I=-(M=q<0?-q:q);else throw Error(Gh+F+" cannot be zero: "+q);if(U.hasOwnProperty(F="CRYPTO"))if(q=U[F],q===!!q)if(q)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))V=q;else throw V=!q,Error(Gh+"crypto unavailable");else V=q;else throw Error(Gh+F+" not true or false: "+q);if(U.hasOwnProperty(F="MODULO_MODE")&&(q=U[F],Ql(q,0,9,F),k=q),U.hasOwnProperty(F="POW_PRECISION")&&(q=U[F],Ql(q,0,Eu,F),ie=q),U.hasOwnProperty(F="FORMAT"))if(q=U[F],typeof q=="object")se=q;else throw Error(Gh+F+" not an object: "+q);if(U.hasOwnProperty(F="ALPHABET"))if(q=U[F],typeof q=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(q))J=q.slice(0,10)=="0123456789",de=q;else throw Error(Gh+F+" invalid: "+q)}else throw Error(Gh+"Object expected: "+U);return{DECIMAL_PLACES:m,ROUNDING_MODE:_,EXPONENTIAL_AT:[o,b],RANGE:[I,M],CRYPTO:V,MODULO_MODE:k,POW_PRECISION:ie,FORMAT:se,ALPHABET:de}},ne.isBigNumber=function(U){if(!U||U._isBigNumber!==!0)return!1;if(!ne.DEBUG)return!0;var F,q,j=U.c,H=U.e,Z=U.s;e:if({}.toString.call(j)=="[object Array]"){if((Z===1||Z===-1)&&H>=-Eu&&H<=Eu&&H===Pd(H)){if(j[0]===0){if(H===0&&j.length===1)return!0;break e}if(F=(H+1)%Ro,F<1&&(F+=Ro),String(j[0]).length==F){for(F=0;F<j.length;F++)if(q=j[F],q<0||q>=Yd||q!==Pd(q))break e;if(q!==0)return!0}}}else if(j===null&&H===null&&(Z===null||Z===1||Z===-1))return!0;throw Error(Gh+"Invalid BigNumber: "+U)},ne.maximum=ne.max=function(){return ue(arguments,-1)},ne.minimum=ne.min=function(){return ue(arguments,1)},ne.random=(function(){var U=9007199254740992,F=Math.random()*U&2097151?function(){return Pd(Math.random()*U)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(q){var j,H,Z,be,Re,Oe=0,Me=[],we=new ne(u);if(q==null?q=m:Ql(q,0,Eu),be=Zb(q/Ro),V)if(crypto.getRandomValues){for(j=crypto.getRandomValues(new Uint32Array(be*=2));Oe<be;)Re=j[Oe]*131072+(j[Oe+1]>>>11),Re>=9e15?(H=crypto.getRandomValues(new Uint32Array(2)),j[Oe]=H[0],j[Oe+1]=H[1]):(Me.push(Re%1e14),Oe+=2);Oe=be/2}else if(crypto.randomBytes){for(j=crypto.randomBytes(be*=7);Oe<be;)Re=(j[Oe]&31)*281474976710656+j[Oe+1]*1099511627776+j[Oe+2]*4294967296+j[Oe+3]*16777216+(j[Oe+4]<<16)+(j[Oe+5]<<8)+j[Oe+6],Re>=9e15?crypto.randomBytes(7).copy(j,Oe):(Me.push(Re%1e14),Oe+=7);Oe=be/7}else throw V=!1,Error(Gh+"crypto unavailable");if(!V)for(;Oe<be;)Re=F(),Re<9e15&&(Me[Oe++]=Re%1e14);for(be=Me[--Oe],q%=Ro,be&&q&&(Re=Jb[Ro-q],Me[Oe]=Pd(be/Re)*Re);Me[Oe]===0;Me.pop(),Oe--);if(Oe<0)Me=[Z=0];else{for(Z=-1;Me[0]===0;Me.splice(0,1),Z-=Ro);for(Oe=1,Re=Me[0];Re>=10;Re/=10,Oe++);Oe<Ro&&(Z-=Ro-Oe)}return we.e=Z,we.c=Me,we}})(),ne.sum=function(){for(var U=1,F=arguments,q=new ne(F[0]);U<F.length;)q=q.plus(F[U++]);return q},t=(function(){var U="0123456789";function F(q,j,H,Z){for(var be,Re=[0],Oe,Me=0,we=q.length;Me<we;){for(Oe=Re.length;Oe--;Re[Oe]*=j);for(Re[0]+=Z.indexOf(q.charAt(Me++)),be=0;be<Re.length;be++)Re[be]>H-1&&(Re[be+1]==null&&(Re[be+1]=0),Re[be+1]+=Re[be]/H|0,Re[be]%=H)}return Re.reverse()}return function(q,j,H,Z,be){var Re,Oe,Me,we,De,tt,xe,le,Ne=q.indexOf("."),Be=m,Qe=_;for(Ne>=0&&(we=ie,ie=0,q=q.replace(".",""),le=new ne(j),tt=le.pow(q.length-Ne),ie=we,le.c=F(dp(Ld(tt.c),tt.e,"0"),10,H,U),le.e=le.c.length),xe=F(q,j,H,be?(Re=de,U):(Re=U,de)),Me=we=xe.length;xe[--we]==0;xe.pop());if(!xe[0])return Re.charAt(0);if(Ne<0?--Me:(tt.c=xe,tt.e=Me,tt.s=Z,tt=e(tt,le,Be,Qe,H),xe=tt.c,De=tt.r,Me=tt.e),Oe=Me+Be+1,Ne=xe[Oe],we=H/2,De=De||Oe<0||xe[Oe+1]!=null,De=Qe<4?(Ne!=null||De)&&(Qe==0||Qe==(tt.s<0?3:2)):Ne>we||Ne==we&&(Qe==4||De||Qe==6&&xe[Oe-1]&1||Qe==(tt.s<0?8:7)),Oe<1||!xe[0])q=De?dp(Re.charAt(1),-Be,Re.charAt(0)):Re.charAt(0);else{if(xe.length=Oe,De)for(--H;++xe[--Oe]>H;)xe[Oe]=0,Oe||(++Me,xe=[1].concat(xe));for(we=xe.length;!xe[--we];);for(Ne=0,q="";Ne<=we;q+=Re.charAt(xe[Ne++]));q=dp(q,Me,Re.charAt(0))}return q}})(),e=(function(){function U(j,H,Z){var be,Re,Oe,Me,we=0,De=j.length,tt=H%Kp,xe=H/Kp|0;for(j=j.slice();De--;)Oe=j[De]%Kp,Me=j[De]/Kp|0,be=xe*Oe+Me*tt,Re=tt*Oe+be%Kp*Kp+we,we=(Re/Z|0)+(be/Kp|0)+xe*Me,j[De]=Re%Z;return we&&(j=[we].concat(j)),j}function F(j,H,Z,be){var Re,Oe;if(Z!=be)Oe=Z>be?1:-1;else for(Re=Oe=0;Re<Z;Re++)if(j[Re]!=H[Re]){Oe=j[Re]>H[Re]?1:-1;break}return Oe}function q(j,H,Z,be){for(var Re=0;Z--;)j[Z]-=Re,Re=j[Z]<H[Z]?1:0,j[Z]=Re*be+j[Z]-H[Z];for(;!j[0]&&j.length>1;j.splice(0,1));}return function(j,H,Z,be,Re){var Oe,Me,we,De,tt,xe,le,Ne,Be,Qe,rt,gt,pt,Mt,Jt,hn,yn,Mn=j.s==H.s?1:-1,Gt=j.c,ot=H.c;if(!Gt||!Gt[0]||!ot||!ot[0])return new ne(!j.s||!H.s||(Gt?ot&&Gt[0]==ot[0]:!ot)?NaN:Gt&&Gt[0]==0||!ot?Mn*0:Mn/0);for(Ne=new ne(Mn),Be=Ne.c=[],Me=j.e-H.e,Mn=Z+Me+1,Re||(Re=Yd,Me=kd(j.e/Ro)-kd(H.e/Ro),Mn=Mn/Ro|0),we=0;ot[we]==(Gt[we]||0);we++);if(ot[we]>(Gt[we]||0)&&Me--,Mn<0)Be.push(1),De=!0;else{for(Mt=Gt.length,hn=ot.length,we=0,Mn+=2,tt=Pd(Re/(ot[0]+1)),tt>1&&(ot=U(ot,tt,Re),Gt=U(Gt,tt,Re),hn=ot.length,Mt=Gt.length),pt=hn,Qe=Gt.slice(0,hn),rt=Qe.length;rt<hn;Qe[rt++]=0);yn=ot.slice(),yn=[0].concat(yn),Jt=ot[0],ot[1]>=Re/2&&Jt++;do{if(tt=0,Oe=F(ot,Qe,hn,rt),Oe<0){if(gt=Qe[0],hn!=rt&&(gt=gt*Re+(Qe[1]||0)),tt=Pd(gt/Jt),tt>1)for(tt>=Re&&(tt=Re-1),xe=U(ot,tt,Re),le=xe.length,rt=Qe.length;F(xe,Qe,le,rt)==1;)tt--,q(xe,hn<le?yn:ot,le,Re),le=xe.length,Oe=1;else tt==0&&(Oe=tt=1),xe=ot.slice(),le=xe.length;if(le<rt&&(xe=[0].concat(xe)),q(Qe,xe,rt,Re),rt=Qe.length,Oe==-1)for(;F(ot,Qe,hn,rt)<1;)tt++,q(Qe,hn<rt?yn:ot,rt,Re),rt=Qe.length}else Oe===0&&(tt++,Qe=[0]);Be[we++]=tt,Qe[0]?Qe[rt++]=Gt[pt]||0:(Qe=[Gt[pt]],rt=1)}while((pt++<Mt||Qe[0]!=null)&&Mn--);De=Qe[0]!=null,Be[0]||Be.splice(0,1)}if(Re==Yd){for(we=1,Mn=Be[0];Mn>=10;Mn/=10,we++);ze(Ne,Z+(Ne.e=we+Me*Ro-1)+1,be,De)}else Ne.e=Me,Ne.r=+De;return Ne}})();function me(U,F,q,j){var H,Z,be,Re,Oe;if(q==null?q=_:Ql(q,0,8),!U.c)return U.toString();if(H=U.c[0],be=U.e,F==null)Oe=Ld(U.c),Oe=j==1||j==2&&(be<=o||be>=b)?k1(Oe,be):dp(Oe,be,"0");else if(U=ze(new ne(U),F,q),Z=U.e,Oe=Ld(U.c),Re=Oe.length,j==1||j==2&&(F<=Z||Z<=o)){for(;Re<F;Oe+="0",Re++);Oe=k1(Oe,Z)}else if(F-=be+(j===2&&Z>be),Oe=dp(Oe,Z,"0"),Z+1>Re){if(--F>0)for(Oe+=".";F--;Oe+="0");}else if(F+=Z-Re,F>0)for(Z+1==Re&&(Oe+=".");F--;Oe+="0");return U.s<0&&H?"-"+Oe:Oe}function ue(U,F){for(var q,j,H=1,Z=new ne(U[0]);H<U.length;H++)j=new ne(U[H]),(!j.s||(q=qm(Z,j))===F||q===0&&Z.s===F)&&(Z=j);return Z}function ke(U,F,q){for(var j=1,H=F.length;!F[--H];F.pop());for(H=F[0];H>=10;H/=10,j++);return(q=j+q*Ro-1)>M?U.c=U.e=null:q<I?U.c=[U.e=0]:(U.e=q,U.c=F),U}i=(function(){var U=/^(-?)0([xbo])(?=\w[\w.]*$)/i,F=/^([^.]+)\.$/,q=/^\.([^.]+)$/,j=/^-?(Infinity|NaN)$/,H=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(Z,be,Re,Oe){var Me,we=Re?be:be.replace(H,"");if(j.test(we))Z.s=isNaN(we)?null:we<0?-1:1;else{if(!Re&&(we=we.replace(U,function(De,tt,xe){return Me=(xe=xe.toLowerCase())=="x"?16:xe=="b"?2:8,!Oe||Oe==Me?tt:De}),Oe&&(Me=Oe,we=we.replace(F,"$1").replace(q,"0.$1")),be!=we))return new ne(we,Me);if(ne.DEBUG)throw Error(Gh+"Not a"+(Oe?" base "+Oe:"")+" number: "+be);Z.s=null}Z.c=Z.e=null}})();function ze(U,F,q,j){var H,Z,be,Re,Oe,Me,we,De=U.c,tt=Jb;if(De){e:{for(H=1,Re=De[0];Re>=10;Re/=10,H++);if(Z=F-H,Z<0)Z+=Ro,be=F,Oe=De[Me=0],we=Pd(Oe/tt[H-be-1]%10);else if(Me=Zb((Z+1)/Ro),Me>=De.length)if(j){for(;De.length<=Me;De.push(0));Oe=we=0,H=1,Z%=Ro,be=Z-Ro+1}else break e;else{for(Oe=Re=De[Me],H=1;Re>=10;Re/=10,H++);Z%=Ro,be=Z-Ro+H,we=be<0?0:Pd(Oe/tt[H-be-1]%10)}if(j=j||F<0||De[Me+1]!=null||(be<0?Oe:Oe%tt[H-be-1]),j=q<4?(we||j)&&(q==0||q==(U.s<0?3:2)):we>5||we==5&&(q==4||j||q==6&&(Z>0?be>0?Oe/tt[H-be]:0:De[Me-1])%10&1||q==(U.s<0?8:7)),F<1||!De[0])return De.length=0,j?(F-=U.e+1,De[0]=tt[(Ro-F%Ro)%Ro],U.e=-F||0):De[0]=U.e=0,U;if(Z==0?(De.length=Me,Re=1,Me--):(De.length=Me+1,Re=tt[Ro-Z],De[Me]=be>0?Pd(Oe/tt[H-be]%tt[be])*Re:0),j)for(;;)if(Me==0){for(Z=1,be=De[0];be>=10;be/=10,Z++);for(be=De[0]+=Re,Re=1;be>=10;be/=10,Re++);Z!=Re&&(U.e++,De[0]==Yd&&(De[0]=1));break}else{if(De[Me]+=Re,De[Me]!=Yd)break;De[Me--]=0,Re=1}for(Z=De.length;De[--Z]===0;De.pop());}U.e>M?U.c=U.e=null:U.e<I&&(U.c=[U.e=0])}return U}function pe(U){var F,q=U.e;return q===null?U.toString():(F=Ld(U.c),F=q<=o||q>=b?k1(F,q):dp(F,q,"0"),U.s<0?"-"+F:F)}return c.absoluteValue=c.abs=function(){var U=new ne(this);return U.s<0&&(U.s=1),U},c.comparedTo=function(U,F){return qm(this,new ne(U,F))},c.decimalPlaces=c.dp=function(U,F){var q,j,H,Z=this;if(U!=null)return Ql(U,0,Eu),F==null?F=_:Ql(F,0,8),ze(new ne(Z),U+Z.e+1,F);if(!(q=Z.c))return null;if(j=((H=q.length-1)-kd(this.e/Ro))*Ro,H=q[H])for(;H%10==0;H/=10,j--);return j<0&&(j=0),j},c.dividedBy=c.div=function(U,F){return e(this,new ne(U,F),m,_)},c.dividedToIntegerBy=c.idiv=function(U,F){return e(this,new ne(U,F),0,1)},c.exponentiatedBy=c.pow=function(U,F){var q,j,H,Z,be,Re,Oe,Me,we,De=this;if(U=new ne(U),U.c&&!U.isInteger())throw Error(Gh+"Exponent not an integer: "+pe(U));if(F!=null&&(F=new ne(F)),Re=U.e>14,!De.c||!De.c[0]||De.c[0]==1&&!De.e&&De.c.length==1||!U.c||!U.c[0])return we=new ne(Math.pow(+pe(De),Re?U.s*(2-P1(U)):+pe(U))),F?we.mod(F):we;if(Oe=U.s<0,F){if(F.c?!F.c[0]:!F.s)return new ne(NaN);j=!Oe&&De.isInteger()&&F.isInteger(),j&&(De=De.mod(F))}else{if(U.e>9&&(De.e>0||De.e<-1||(De.e==0?De.c[0]>1||Re&&De.c[1]>=24e7:De.c[0]<8e13||Re&&De.c[0]<=9999975e7)))return Z=De.s<0&&P1(U)?-0:0,De.e>-1&&(Z=1/Z),new ne(Oe?1/Z:Z);ie&&(Z=Zb(ie/Ro+2))}for(Re?(q=new ne(.5),Oe&&(U.s=1),Me=P1(U)):(H=Math.abs(+pe(U)),Me=H%2),we=new ne(u);;){if(Me){if(we=we.times(De),!we.c)break;Z?we.c.length>Z&&(we.c.length=Z):j&&(we=we.mod(F))}if(H){if(H=Pd(H/2),H===0)break;Me=H%2}else if(U=U.times(q),ze(U,U.e+1,1),U.e>14)Me=P1(U);else{if(H=+pe(U),H===0)break;Me=H%2}De=De.times(De),Z?De.c&&De.c.length>Z&&(De.c.length=Z):j&&(De=De.mod(F))}return j?we:(Oe&&(we=u.div(we)),F?we.mod(F):Z?ze(we,ie,_,be):we)},c.integerValue=function(U){var F=new ne(this);return U==null?U=_:Ql(U,0,8),ze(F,F.e+1,U)},c.isEqualTo=c.eq=function(U,F){return qm(this,new ne(U,F))===0},c.isFinite=function(){return!!this.c},c.isGreaterThan=c.gt=function(U,F){return qm(this,new ne(U,F))>0},c.isGreaterThanOrEqualTo=c.gte=function(U,F){return(F=qm(this,new ne(U,F)))===1||F===0},c.isInteger=function(){return!!this.c&&kd(this.e/Ro)>this.c.length-2},c.isLessThan=c.lt=function(U,F){return qm(this,new ne(U,F))<0},c.isLessThanOrEqualTo=c.lte=function(U,F){return(F=qm(this,new ne(U,F)))===-1||F===0},c.isNaN=function(){return!this.s},c.isNegative=function(){return this.s<0},c.isPositive=function(){return this.s>0},c.isZero=function(){return!!this.c&&this.c[0]==0},c.minus=function(U,F){var q,j,H,Z,be=this,Re=be.s;if(U=new ne(U,F),F=U.s,!Re||!F)return new ne(NaN);if(Re!=F)return U.s=-F,be.plus(U);var Oe=be.e/Ro,Me=U.e/Ro,we=be.c,De=U.c;if(!Oe||!Me){if(!we||!De)return we?(U.s=-F,U):new ne(De?be:NaN);if(!we[0]||!De[0])return De[0]?(U.s=-F,U):new ne(we[0]?be:_==3?-0:0)}if(Oe=kd(Oe),Me=kd(Me),we=we.slice(),Re=Oe-Me){for((Z=Re<0)?(Re=-Re,H=we):(Me=Oe,H=De),H.reverse(),F=Re;F--;H.push(0));H.reverse()}else for(j=(Z=(Re=we.length)<(F=De.length))?Re:F,Re=F=0;F<j;F++)if(we[F]!=De[F]){Z=we[F]<De[F];break}if(Z&&(H=we,we=De,De=H,U.s=-U.s),F=(j=De.length)-(q=we.length),F>0)for(;F--;we[q++]=0);for(F=Yd-1;j>Re;){if(we[--j]<De[j]){for(q=j;q&&!we[--q];we[q]=F);--we[q],we[j]+=Yd}we[j]-=De[j]}for(;we[0]==0;we.splice(0,1),--Me);return we[0]?ke(U,we,Me):(U.s=_==3?-1:1,U.c=[U.e=0],U)},c.modulo=c.mod=function(U,F){var q,j,H=this;return U=new ne(U,F),!H.c||!U.s||U.c&&!U.c[0]?new ne(NaN):!U.c||H.c&&!H.c[0]?new ne(H):(k==9?(j=U.s,U.s=1,q=e(H,U,0,3),U.s=j,q.s*=j):q=e(H,U,0,k),U=H.minus(q.times(U)),!U.c[0]&&k==1&&(U.s=H.s),U)},c.multipliedBy=c.times=function(U,F){var q,j,H,Z,be,Re,Oe,Me,we,De,tt,xe,le,Ne,Be,Qe=this,rt=Qe.c,gt=(U=new ne(U,F)).c;if(!rt||!gt||!rt[0]||!gt[0])return!Qe.s||!U.s||rt&&!rt[0]&&!gt||gt&&!gt[0]&&!rt?U.c=U.e=U.s=null:(U.s*=Qe.s,!rt||!gt?U.c=U.e=null:(U.c=[0],U.e=0)),U;for(j=kd(Qe.e/Ro)+kd(U.e/Ro),U.s*=Qe.s,Oe=rt.length,De=gt.length,Oe<De&&(le=rt,rt=gt,gt=le,H=Oe,Oe=De,De=H),H=Oe+De,le=[];H--;le.push(0));for(Ne=Yd,Be=Kp,H=De;--H>=0;){for(q=0,tt=gt[H]%Be,xe=gt[H]/Be|0,be=Oe,Z=H+be;Z>H;)Me=rt[--be]%Be,we=rt[be]/Be|0,Re=xe*Me+we*tt,Me=tt*Me+Re%Be*Be+le[Z]+q,q=(Me/Ne|0)+(Re/Be|0)+xe*we,le[Z--]=Me%Ne;le[Z]=q}return q?++j:le.splice(0,1),ke(U,le,j)},c.negated=function(){var U=new ne(this);return U.s=-U.s||null,U},c.plus=function(U,F){var q,j=this,H=j.s;if(U=new ne(U,F),F=U.s,!H||!F)return new ne(NaN);if(H!=F)return U.s=-F,j.minus(U);var Z=j.e/Ro,be=U.e/Ro,Re=j.c,Oe=U.c;if(!Z||!be){if(!Re||!Oe)return new ne(H/0);if(!Re[0]||!Oe[0])return Oe[0]?U:new ne(Re[0]?j:H*0)}if(Z=kd(Z),be=kd(be),Re=Re.slice(),H=Z-be){for(H>0?(be=Z,q=Oe):(H=-H,q=Re),q.reverse();H--;q.push(0));q.reverse()}for(H=Re.length,F=Oe.length,H-F<0&&(q=Oe,Oe=Re,Re=q,F=H),H=0;F;)H=(Re[--F]=Re[F]+Oe[F]+H)/Yd|0,Re[F]=Yd===Re[F]?0:Re[F]%Yd;return H&&(Re=[H].concat(Re),++be),ke(U,Re,be)},c.precision=c.sd=function(U,F){var q,j,H,Z=this;if(U!=null&&U!==!!U)return Ql(U,1,Eu),F==null?F=_:Ql(F,0,8),ze(new ne(Z),U,F);if(!(q=Z.c))return null;if(H=q.length-1,j=H*Ro+1,H=q[H]){for(;H%10==0;H/=10,j--);for(H=q[0];H>=10;H/=10,j++);}return U&&Z.e+1>j&&(j=Z.e+1),j},c.shiftedBy=function(U){return Ql(U,-Yb,Yb),this.times("1e"+U)},c.squareRoot=c.sqrt=function(){var U,F,q,j,H,Z=this,be=Z.c,Re=Z.s,Oe=Z.e,Me=m+4,we=new ne("0.5");if(Re!==1||!be||!be[0])return new ne(!Re||Re<0&&(!be||be[0])?NaN:be?Z:1/0);if(Re=Math.sqrt(+pe(Z)),Re==0||Re==1/0?(F=Ld(be),(F.length+Oe)%2==0&&(F+="0"),Re=Math.sqrt(+F),Oe=kd((Oe+1)/2)-(Oe<0||Oe%2),Re==1/0?F="5e"+Oe:(F=Re.toExponential(),F=F.slice(0,F.indexOf("e")+1)+Oe),q=new ne(F)):q=new ne(Re+""),q.c[0]){for(Oe=q.e,Re=Oe+Me,Re<3&&(Re=0);;)if(H=q,q=we.times(H.plus(e(Z,H,Me,1))),Ld(H.c).slice(0,Re)===(F=Ld(q.c)).slice(0,Re))if(q.e<Oe&&--Re,F=F.slice(Re-3,Re+1),F=="9999"||!j&&F=="4999"){if(!j&&(ze(H,H.e+m+2,0),H.times(H).eq(Z))){q=H;break}Me+=4,Re+=4,j=1}else{(!+F||!+F.slice(1)&&F.charAt(0)=="5")&&(ze(q,q.e+m+2,1),U=!q.times(q).eq(Z));break}}return ze(q,q.e+m+1,_,U)},c.toExponential=function(U,F){return U!=null&&(Ql(U,0,Eu),U++),me(this,U,F,1)},c.toFixed=function(U,F){return U!=null&&(Ql(U,0,Eu),U=U+this.e+1),me(this,U,F)},c.toFormat=function(U,F,q){var j,H=this;if(q==null)U!=null&&F&&typeof F=="object"?(q=F,F=null):U&&typeof U=="object"?(q=U,U=F=null):q=se;else if(typeof q!="object")throw Error(Gh+"Argument not an object: "+q);if(j=H.toFixed(U,F),H.c){var Z,be=j.split("."),Re=+q.groupSize,Oe=+q.secondaryGroupSize,Me=q.groupSeparator||"",we=be[0],De=be[1],tt=H.s<0,xe=tt?we.slice(1):we,le=xe.length;if(Oe&&(Z=Re,Re=Oe,Oe=Z,le-=Z),Re>0&&le>0){for(Z=le%Re||Re,we=xe.substr(0,Z);Z<le;Z+=Re)we+=Me+xe.substr(Z,Re);Oe>0&&(we+=Me+xe.slice(Z)),tt&&(we="-"+we)}j=De?we+(q.decimalSeparator||"")+((Oe=+q.fractionGroupSize)?De.replace(new RegExp("\\d{"+Oe+"}\\B","g"),"$&"+(q.fractionGroupSeparator||"")):De):we}return(q.prefix||"")+j+(q.suffix||"")},c.toFraction=function(U){var F,q,j,H,Z,be,Re,Oe,Me,we,De,tt,xe=this,le=xe.c;if(U!=null&&(Re=new ne(U),!Re.isInteger()&&(Re.c||Re.s!==1)||Re.lt(u)))throw Error(Gh+"Argument "+(Re.isInteger()?"out of range: ":"not an integer: ")+pe(Re));if(!le)return new ne(xe);for(F=new ne(u),Me=q=new ne(u),j=Oe=new ne(u),tt=Ld(le),Z=F.e=tt.length-xe.e-1,F.c[0]=Jb[(be=Z%Ro)<0?Ro+be:be],U=!U||Re.comparedTo(F)>0?Z>0?F:Me:Re,be=M,M=1/0,Re=new ne(tt),Oe.c[0]=0;we=e(Re,F,0,1),H=q.plus(we.times(j)),H.comparedTo(U)!=1;)q=j,j=H,Me=Oe.plus(we.times(H=Me)),Oe=H,F=Re.minus(we.times(H=F)),Re=H;return H=e(U.minus(q),j,0,1),Oe=Oe.plus(H.times(Me)),q=q.plus(H.times(j)),Oe.s=Me.s=xe.s,Z=Z*2,De=e(Me,j,Z,_).minus(xe).abs().comparedTo(e(Oe,q,Z,_).minus(xe).abs())<1?[Me,j]:[Oe,q],M=be,De},c.toNumber=function(){return+pe(this)},c.toPrecision=function(U,F){return U!=null&&Ql(U,1,Eu),me(this,U,F,2)},c.toString=function(U){var F,q=this,j=q.s,H=q.e;return H===null?j?(F="Infinity",j<0&&(F="-"+F)):F="NaN":(U==null?F=H<=o||H>=b?k1(Ld(q.c),H):dp(Ld(q.c),H,"0"):U===10&&J?(q=ze(new ne(q),m+H+1,_),F=dp(Ld(q.c),q.e,"0")):(Ql(U,2,de.length,"Base"),F=t(dp(Ld(q.c),H,"0"),10,U,j,!0)),j<0&&q.c[0]&&(F="-"+F)),F},c.valueOf=c.toJSON=function(){return pe(this)},c._isBigNumber=!0,c[Symbol.toStringTag]="BigNumber",c[Symbol.for("nodejs.util.inspect.custom")]=c.valueOf,n!=null&&ne.set(n),ne}function kd(n){var e=n|0;return n>0||n===e?e:e-1}function Ld(n){for(var e,t,i=1,c=n.length,u=n[0]+"";i<c;){for(e=n[i++]+"",t=Ro-e.length;t--;e="0"+e);u+=e}for(c=u.length;u.charCodeAt(--c)===48;);return u.slice(0,c+1||1)}function qm(n,e){var t,i,c=n.c,u=e.c,m=n.s,_=e.s,o=n.e,b=e.e;if(!m||!_)return null;if(t=c&&!c[0],i=u&&!u[0],t||i)return t?i?0:-_:m;if(m!=_)return m;if(t=m<0,i=o==b,!c||!u)return i?0:!c^t?1:-1;if(!i)return o>b^t?1:-1;for(_=(o=c.length)<(b=u.length)?o:b,m=0;m<_;m++)if(c[m]!=u[m])return c[m]>u[m]^t?1:-1;return o==b?0:o>b^t?1:-1}function Ql(n,e,t,i){if(n<e||n>t||n!==Pd(n))throw Error(Gh+(i||"Argument")+(typeof n=="number"?n<e||n>t?" out of range: ":" not an integer: ":" not a primitive number: ")+String(n))}function P1(n){var e=n.c.length-1;return kd(n.e/Ro)==e&&n.c[e]%2!=0}function k1(n,e){return(n.length>1?n.charAt(0)+"."+n.slice(1):n)+(e<0?"e":"e+")+e}function dp(n,e,t){var i,c;if(e<0){for(c=t+".";++e;c+=t);n=c+n}else if(i=n.length,++e>i){for(c=t,e-=i;--e;c+=t);n+=c}else e<i&&(n=n.slice(0,e)+"."+n.slice(e));return n}var Uf=E8(),Gj=class{key;left=null;right=null;constructor(n){this.key=n}},Cy=class extends Gj{constructor(n){super(n)}},Hj=class{size=0;modificationCount=0;splayCount=0;splay(n){const e=this.root;if(e==null)return this.compare(n,n),-1;let t=null,i=null,c=null,u=null,m=e;const _=this.compare;let o;for(;;)if(o=_(m.key,n),o>0){let b=m.left;if(b==null||(o=_(b.key,n),o>0&&(m.left=b.right,b.right=m,m=b,b=m.left,b==null)))break;t==null?i=m:t.left=m,t=m,m=b}else if(o<0){let b=m.right;if(b==null||(o=_(b.key,n),o<0&&(m.right=b.left,b.left=m,m=b,b=m.right,b==null)))break;c==null?u=m:c.right=m,c=m,m=b}else break;return c!=null&&(c.right=m.left,m.left=u),t!=null&&(t.left=m.right,m.right=i),this.root!==m&&(this.root=m,this.splayCount++),o}splayMin(n){let e=n,t=e.left;for(;t!=null;){const i=t;e.left=i.right,i.right=e,e=i,t=e.left}return e}splayMax(n){let e=n,t=e.right;for(;t!=null;){const i=t;e.right=i.left,i.left=e,e=i,t=e.right}return e}_delete(n){if(this.root==null||this.splay(n)!=0)return null;let t=this.root;const i=t,c=t.left;if(this.size--,c==null)this.root=t.right;else{const u=t.right;t=this.splayMax(c),t.right=u,this.root=t}return this.modificationCount++,i}addNewRoot(n,e){this.size++,this.modificationCount++;const t=this.root;if(t==null){this.root=n;return}e<0?(n.left=t,n.right=t.right,t.right=null):(n.right=t,n.left=t.left,t.left=null),this.root=n}_first(){const n=this.root;return n==null?null:(this.root=this.splayMin(n),this.root)}_last(){const n=this.root;return n==null?null:(this.root=this.splayMax(n),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(n){return this.validKey(n)&&this.splay(n)==0}defaultCompare(){return(n,e)=>n<e?-1:n>e?1:0}wrap(){return{getRoot:()=>this.root,setRoot:n=>{this.root=n},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:n=>{this.splayCount=n},splay:n=>this.splay(n),has:n=>this.has(n)}}},Dv=class Oy extends Hj{root=null;compare;validKey;constructor(e,t){super(),this.compare=e??this.defaultCompare(),this.validKey=t??(i=>i!=null&&i!=null)}delete(e){return this.validKey(e)?this._delete(e)!=null:!1}deleteAll(e){for(const t of e)this.delete(t)}forEach(e){const t=this[Symbol.iterator]();let i;for(;i=t.next(),!i.done;)e(i.value,i.value,this)}add(e){const t=this.splay(e);return t!=0&&this.addNewRoot(new Cy(e),t),this}addAndReturn(e){const t=this.splay(e);return t!=0&&this.addNewRoot(new Cy(e),t),this.root.key}addAll(e){for(const t of e)this.add(t)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)<0)return this.root.key;let i=this.root.left;if(i==null)return null;let c=i.right;for(;c!=null;)i=c,c=i.right;return i.key}firstAfter(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)>0)return this.root.key;let i=this.root.right;if(i==null)return null;let c=i.left;for(;c!=null;)i=c,c=i.left;return i.key}retainAll(e){const t=new Oy(this.compare,this.validKey),i=this.modificationCount;for(const c of e){if(i!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(c)&&this.splay(c)==0&&t.add(this.root.key)}t.size!=this.size&&(this.root=t.root,this.size=t.size,this.modificationCount++)}lookup(e){return!this.validKey(e)||this.splay(e)!=0?null:this.root.key}intersection(e){const t=new Oy(this.compare,this.validKey);for(const i of this)e.has(i)&&t.add(i);return t}difference(e){const t=new Oy(this.compare,this.validKey);for(const i of this)e.has(i)||t.add(i);return t}union(e){const t=this.clone();return t.addAll(e),t}clone(){const e=new Oy(this.compare,this.validKey);return e.size=this.size,e.root=this.copyNode(this.root),e}copyNode(e){if(e==null)return null;function t(c,u){let m,_;do{if(m=c.left,_=c.right,m!=null){const o=new Cy(m.key);u.left=o,t(m,o)}if(_!=null){const o=new Cy(_.key);u.right=o,c=_,u=o}}while(_!=null)}const i=new Cy(e.key);return t(e,i),i}toSet(){return this.clone()}entries(){return new Kj(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[Symbol.iterator](){return new Wj(this.wrap())}[Symbol.toStringTag]="[object Set]"},A8=class{tree;path=new Array;modificationCount=null;splayCount;constructor(n){this.tree=n,this.splayCount=n.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;const n=this.path[this.path.length-1];return this.getValue(n)}rebuildPath(n){this.path.splice(0,this.path.length),this.tree.splay(n),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(n){for(;n!=null;)this.path.push(n),n=n.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let t=this.tree.getRoot();for(;t!=null;)this.path.push(t),t=t.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let n=this.path[this.path.length-1],e=n.right;if(e!=null){for(;e!=null;)this.path.push(e),e=e.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===n;)n=this.path.pop();return this.path.length>0}},Wj=class extends A8{getValue(n){return n.key}},Kj=class extends A8{getValue(n){return[n.key,n.key]}},T8=n=>()=>n,Y5=n=>{const e=n?(t,i)=>i.minus(t).abs().isLessThanOrEqualTo(n):T8(!1);return(t,i)=>e(t,i)?0:t.comparedTo(i)};function Xj(n){const e=n?(t,i,c,u,m)=>t.exponentiatedBy(2).isLessThanOrEqualTo(u.minus(i).exponentiatedBy(2).plus(m.minus(c).exponentiatedBy(2)).times(n)):T8(!1);return(t,i,c)=>{const u=t.x,m=t.y,_=c.x,o=c.y,b=m.minus(o).times(i.x.minus(_)).minus(u.minus(_).times(i.y.minus(o)));return e(b,u,m,_,o)?0:b.comparedTo(0)}}var Zj=n=>n,Yj=n=>{if(n){const e=new Dv(Y5(n)),t=new Dv(Y5(n)),i=(u,m)=>m.addAndReturn(u),c=u=>({x:i(u.x,e),y:i(u.y,t)});return c({x:new Uf(0),y:new Uf(0)}),c}return Zj},J5=n=>({set:e=>{Lp=J5(e)},reset:()=>J5(n),compare:Y5(n),snap:Yj(n),orient:Xj(n)}),Lp=J5(),Ly=(n,e)=>n.ll.x.isLessThanOrEqualTo(e.x)&&e.x.isLessThanOrEqualTo(n.ur.x)&&n.ll.y.isLessThanOrEqualTo(e.y)&&e.y.isLessThanOrEqualTo(n.ur.y),Q5=(n,e)=>{if(e.ur.x.isLessThan(n.ll.x)||n.ur.x.isLessThan(e.ll.x)||e.ur.y.isLessThan(n.ll.y)||n.ur.y.isLessThan(e.ll.y))return null;const t=n.ll.x.isLessThan(e.ll.x)?e.ll.x:n.ll.x,i=n.ur.x.isLessThan(e.ur.x)?n.ur.x:e.ur.x,c=n.ll.y.isLessThan(e.ll.y)?e.ll.y:n.ll.y,u=n.ur.y.isLessThan(e.ur.y)?n.ur.y:e.ur.y;return{ll:{x:t,y:c},ur:{x:i,y:u}}},rv=(n,e)=>n.x.times(e.y).minus(n.y.times(e.x)),I8=(n,e)=>n.x.times(e.x).plus(n.y.times(e.y)),Fv=n=>I8(n,n).sqrt(),Jj=(n,e,t)=>{const i={x:e.x.minus(n.x),y:e.y.minus(n.y)},c={x:t.x.minus(n.x),y:t.y.minus(n.y)};return rv(c,i).div(Fv(c)).div(Fv(i))},Qj=(n,e,t)=>{const i={x:e.x.minus(n.x),y:e.y.minus(n.y)},c={x:t.x.minus(n.x),y:t.y.minus(n.y)};return I8(c,i).div(Fv(c)).div(Fv(i))},IA=(n,e,t)=>e.y.isZero()?null:{x:n.x.plus(e.x.div(e.y).times(t.minus(n.y))),y:t},CA=(n,e,t)=>e.x.isZero()?null:{x:t,y:n.y.plus(e.y.div(e.x).times(t.minus(n.x)))},eU=(n,e,t,i)=>{if(e.x.isZero())return CA(t,i,n.x);if(i.x.isZero())return CA(n,e,t.x);if(e.y.isZero())return IA(t,i,n.y);if(i.y.isZero())return IA(n,e,t.y);const c=rv(e,i);if(c.isZero())return null;const u={x:t.x.minus(n.x),y:t.y.minus(n.y)},m=rv(u,e).div(c),_=rv(u,i).div(c),o=n.x.plus(_.times(e.x)),b=t.x.plus(m.times(i.x)),I=n.y.plus(_.times(e.y)),M=t.y.plus(m.times(i.y)),V=o.plus(b).div(2),k=I.plus(M).div(2);return{x:V,y:k}},Df=class C8{point;isLeft;segment;otherSE;consumedBy;static compare(e,t){const i=C8.comparePoints(e.point,t.point);return i!==0?i:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:Ov.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x.isLessThan(t.x)?-1:e.x.isGreaterThan(t.x)?1:e.y.isLessThan(t.y)?-1:e.y.isGreaterThan(t.y)?1:0}constructor(e,t){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let i=0,c=t.length;i<c;i++){const u=t[i];this.point.events.push(u),u.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const i=this.point.events[t];if(i.segment.consumedBy===void 0)for(let c=t+1;c<e;c++){const u=this.point.events[c];u.consumedBy===void 0&&i.otherSE.point.events===u.otherSE.point.events&&i.segment.consume(u.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,i=this.point.events.length;t<i;t++){const c=this.point.events[t];c!==this&&!c.segment.ringOut&&c.segment.isInResult()&&e.push(c)}return e}getLeftmostComparator(e){const t=new Map,i=c=>{const u=c.otherSE;t.set(c,{sine:Jj(this.point,e.point,u.point),cosine:Qj(this.point,e.point,u.point)})};return(c,u)=>{t.has(c)||i(c),t.has(u)||i(u);const{sine:m,cosine:_}=t.get(c),{sine:o,cosine:b}=t.get(u);return m.isGreaterThanOrEqualTo(0)&&o.isGreaterThanOrEqualTo(0)?_.isLessThan(b)?1:_.isGreaterThan(b)?-1:0:m.isLessThan(0)&&o.isLessThan(0)?_.isLessThan(b)?-1:_.isGreaterThan(b)?1:0:o.isLessThan(m)?-1:o.isGreaterThan(m)?1:0}}},tU=class ew{events;poly;_isExteriorRing;_enclosingRing;static factory(e){const t=[];for(let i=0,c=e.length;i<c;i++){const u=e[i];if(!u.isInResult()||u.ringOut)continue;let m=null,_=u.leftSE,o=u.rightSE;const b=[_],I=_.point,M=[];for(;m=_,_=o,b.push(_),_.point!==I;)for(;;){const V=_.getAvailableLinkedEvents();if(V.length===0){const se=b[0].point,de=b[b.length-1].point;throw new Error(`Unable to complete output ring starting at [${se.x}, ${se.y}]. Last matching segment found ends at [${de.x}, ${de.y}].`)}if(V.length===1){o=V[0].otherSE;break}let k=null;for(let se=0,de=M.length;se<de;se++)if(M[se].point===_.point){k=se;break}if(k!==null){const se=M.splice(k)[0],de=b.splice(se.index);de.unshift(de[0].otherSE),t.push(new ew(de.reverse()));continue}M.push({index:b.length,point:_.point});const ie=_.getLeftmostComparator(m);o=V.sort(ie)[0].otherSE;break}t.push(new ew(b))}return t}constructor(e){this.events=e;for(let t=0,i=e.length;t<i;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const t=[e];for(let b=1,I=this.events.length-1;b<I;b++){const M=this.events[b].point,V=this.events[b+1].point;Lp.orient(M,e,V)!==0&&(t.push(M),e=M)}if(t.length===1)return null;const i=t[0],c=t[1];Lp.orient(i,e,c)===0&&t.shift(),t.push(t[0]);const u=this.isExteriorRing()?1:-1,m=this.isExteriorRing()?0:t.length-1,_=this.isExteriorRing()?t.length:-1,o=[];for(let b=m;b!=_;b+=u)o.push([t[b].x.toNumber(),t[b].y.toNumber()]);return o}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let c=1,u=this.events.length;c<u;c++){const m=this.events[c];Df.compare(e,m)>0&&(e=m)}let t=e.segment.prevInResult(),i=t?t.prevInResult():null;for(;;){if(!t)return null;if(!i)return t.ringOut;if(i.ringOut!==t.ringOut)return i.ringOut?.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut?.enclosingRing();t=i.prevInResult(),i=t?t.prevInResult():null}}},LA=class{exteriorRing;interiorRings;constructor(n){this.exteriorRing=n,n.poly=this,this.interiorRings=[]}addInterior(n){this.interiorRings.push(n),n.poly=this}getGeom(){const n=this.exteriorRing.getGeom();if(n===null)return null;const e=[n];for(let t=0,i=this.interiorRings.length;t<i;t++){const c=this.interiorRings[t].getGeom();c!==null&&e.push(c)}return e}},nU=class{rings;polys;constructor(n){this.rings=n,this.polys=this._composePolys(n)}getGeom(){const n=[];for(let e=0,t=this.polys.length;e<t;e++){const i=this.polys[e].getGeom();i!==null&&n.push(i)}return n}_composePolys(n){const e=[];for(let t=0,i=n.length;t<i;t++){const c=n[t];if(!c.poly)if(c.isExteriorRing())e.push(new LA(c));else{const u=c.enclosingRing();u?.poly||e.push(new LA(u)),u?.poly?.addInterior(c)}}return e}},rU=class{queue;tree;segments;constructor(n,e=Ov.compare){this.queue=n,this.tree=new Dv(e),this.segments=[]}process(n){const e=n.segment,t=[];if(n.consumedBy)return n.isLeft?this.queue.delete(n.otherSE):this.tree.delete(e),t;n.isLeft&&this.tree.add(e);let i=e,c=e;do i=this.tree.lastBefore(i);while(i!=null&&i.consumedBy!=null);do c=this.tree.firstAfter(c);while(c!=null&&c.consumedBy!=null);if(n.isLeft){let u=null;if(i){const _=i.getIntersection(e);if(_!==null&&(e.isAnEndpoint(_)||(u=_),!i.isAnEndpoint(_))){const o=this._splitSafely(i,_);for(let b=0,I=o.length;b<I;b++)t.push(o[b])}}let m=null;if(c){const _=c.getIntersection(e);if(_!==null&&(e.isAnEndpoint(_)||(m=_),!c.isAnEndpoint(_))){const o=this._splitSafely(c,_);for(let b=0,I=o.length;b<I;b++)t.push(o[b])}}if(u!==null||m!==null){let _=null;u===null?_=m:m===null?_=u:_=Df.comparePoints(u,m)<=0?u:m,this.queue.delete(e.rightSE),t.push(e.rightSE);const o=e.split(_);for(let b=0,I=o.length;b<I;b++)t.push(o[b])}t.length>0?(this.tree.delete(e),t.push(n)):(this.segments.push(e),e.prev=i)}else{if(i&&c){const u=i.getIntersection(c);if(u!==null){if(!i.isAnEndpoint(u)){const m=this._splitSafely(i,u);for(let _=0,o=m.length;_<o;_++)t.push(m[_])}if(!c.isAnEndpoint(u)){const m=this._splitSafely(c,u);for(let _=0,o=m.length;_<o;_++)t.push(m[_])}}}this.tree.delete(e)}return t}_splitSafely(n,e){this.tree.delete(n);const t=n.rightSE;this.queue.delete(t);const i=n.split(e);return i.push(t),n.consumedBy===void 0&&this.tree.add(n),i}},iU=class{type;numMultiPolys;run(n,e,t){By.type=n;const i=[new kA(e,!0)];for(let b=0,I=t.length;b<I;b++)i.push(new kA(t[b],!1));if(By.numMultiPolys=i.length,By.type==="difference"){const b=i[0];let I=1;for(;I<i.length;)Q5(i[I].bbox,b.bbox)!==null?I++:i.splice(I,1)}if(By.type==="intersection")for(let b=0,I=i.length;b<I;b++){const M=i[b];for(let V=b+1,k=i.length;V<k;V++)if(Q5(M.bbox,i[V].bbox)===null)return[]}const c=new Dv(Df.compare);for(let b=0,I=i.length;b<I;b++){const M=i[b].getSweepEvents();for(let V=0,k=M.length;V<k;V++)c.add(M[V])}const u=new rU(c);let m=null;for(c.size!=0&&(m=c.first(),c.delete(m));m;){const b=u.process(m);for(let I=0,M=b.length;I<M;I++){const V=b[I];V.consumedBy===void 0&&c.add(V)}c.size!=0?(m=c.first(),c.delete(m)):m=null}Lp.reset();const _=tU.factory(u.segments);return new nU(_).getGeom()}},By=new iU,tw=By,oU=0,Ov=class iv{id;leftSE;rightSE;rings;windings;ringOut;consumedBy;prev;_prevInResult;_beforeState;_afterState;_isInResult;static compare(e,t){const i=e.leftSE.point.x,c=t.leftSE.point.x,u=e.rightSE.point.x,m=t.rightSE.point.x;if(m.isLessThan(i))return 1;if(u.isLessThan(c))return-1;const _=e.leftSE.point.y,o=t.leftSE.point.y,b=e.rightSE.point.y,I=t.rightSE.point.y;if(i.isLessThan(c)){if(o.isLessThan(_)&&o.isLessThan(b))return 1;if(o.isGreaterThan(_)&&o.isGreaterThan(b))return-1;const M=e.comparePoint(t.leftSE.point);if(M<0)return 1;if(M>0)return-1;const V=t.comparePoint(e.rightSE.point);return V!==0?V:-1}if(i.isGreaterThan(c)){if(_.isLessThan(o)&&_.isLessThan(I))return-1;if(_.isGreaterThan(o)&&_.isGreaterThan(I))return 1;const M=t.comparePoint(e.leftSE.point);if(M!==0)return M;const V=e.comparePoint(t.rightSE.point);return V<0?1:V>0?-1:1}if(_.isLessThan(o))return-1;if(_.isGreaterThan(o))return 1;if(u.isLessThan(m)){const M=t.comparePoint(e.rightSE.point);if(M!==0)return M}if(u.isGreaterThan(m)){const M=e.comparePoint(t.rightSE.point);if(M<0)return 1;if(M>0)return-1}if(!u.eq(m)){const M=b.minus(_),V=u.minus(i),k=I.minus(o),ie=m.minus(c);if(M.isGreaterThan(V)&&k.isLessThan(ie))return 1;if(M.isLessThan(V)&&k.isGreaterThan(ie))return-1}return u.isGreaterThan(m)?1:u.isLessThan(m)||b.isLessThan(I)?-1:b.isGreaterThan(I)?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,i,c){this.id=++oU,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=i,this.windings=c}static fromRing(e,t,i){let c,u,m;const _=Df.comparePoints(e,t);if(_<0)c=e,u=t,m=1;else if(_>0)c=t,u=e,m=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const o=new Df(c,!0),b=new Df(u,!1);return new iv(o,b,[i],[m])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e.isLessThan(t)?e:t},ur:{x:this.rightSE.point.x,y:e.isGreaterThan(t)?e:t}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(e){return e.x.eq(this.leftSE.point.x)&&e.y.eq(this.leftSE.point.y)||e.x.eq(this.rightSE.point.x)&&e.y.eq(this.rightSE.point.y)}comparePoint(e){return Lp.orient(this.leftSE.point,e,this.rightSE.point)}getIntersection(e){const t=this.bbox(),i=e.bbox(),c=Q5(t,i);if(c===null)return null;const u=this.leftSE.point,m=this.rightSE.point,_=e.leftSE.point,o=e.rightSE.point,b=Ly(t,_)&&this.comparePoint(_)===0,I=Ly(i,u)&&e.comparePoint(u)===0,M=Ly(t,o)&&this.comparePoint(o)===0,V=Ly(i,m)&&e.comparePoint(m)===0;if(I&&b)return V&&!M?m:!V&&M?o:null;if(I)return M&&u.x.eq(o.x)&&u.y.eq(o.y)?null:u;if(b)return V&&m.x.eq(_.x)&&m.y.eq(_.y)?null:_;if(V&&M)return null;if(V)return m;if(M)return o;const k=eU(u,this.vector(),_,e.vector());return k===null||!Ly(c,k)?null:Lp.snap(k)}split(e){const t=[],i=e.events!==void 0,c=new Df(e,!0),u=new Df(e,!1),m=this.rightSE;this.replaceRightSE(u),t.push(u),t.push(c);const _=new iv(c,m,this.rings.slice(),this.windings.slice());return Df.comparePoints(_.leftSE.point,_.rightSE.point)>0&&_.swapEvents(),Df.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(c.checkForConsuming(),u.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,i=this.windings.length;t<i;t++)this.windings[t]*=-1}consume(e){let t=this,i=e;for(;t.consumedBy;)t=t.consumedBy;for(;i.consumedBy;)i=i.consumedBy;const c=iv.compare(t,i);if(c!==0){if(c>0){const u=t;t=i,i=u}if(t.prev===i){const u=t;t=i,i=u}for(let u=0,m=i.rings.length;u<m;u++){const _=i.rings[u],o=i.windings[u],b=t.rings.indexOf(_);b===-1?(t.rings.push(_),t.windings.push(o)):t.windings[b]+=o}i.rings=null,i.windings=null,i.consumedBy=t,i.leftSE.consumedBy=t.leftSE,i.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,i=this._afterState.windings,c=this._afterState.multiPolys;for(let _=0,o=this.rings.length;_<o;_++){const b=this.rings[_],I=this.windings[_],M=t.indexOf(b);M===-1?(t.push(b),i.push(I)):i[M]+=I}const u=[],m=[];for(let _=0,o=t.length;_<o;_++){if(i[_]===0)continue;const b=t[_],I=b.poly;if(m.indexOf(I)===-1)if(b.isExterior)u.push(I);else{m.indexOf(I)===-1&&m.push(I);const M=u.indexOf(b.poly);M!==-1&&u.splice(M,1)}}for(let _=0,o=u.length;_<o;_++){const b=u[_].multiPoly;c.indexOf(b)===-1&&c.push(b)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(tw.type){case"union":{const i=e.length===0,c=t.length===0;this._isInResult=i!==c;break}case"intersection":{let i,c;e.length<t.length?(i=e.length,c=t.length):(i=t.length,c=e.length),this._isInResult=c===tw.numMultiPolys&&i<c;break}case"xor":{const i=Math.abs(e.length-t.length);this._isInResult=i%2===1;break}case"difference":{const i=c=>c.length===1&&c[0].isSubject;this._isInResult=i(e)!==i(t);break}}return this._isInResult}},PA=class{poly;isExterior;segments;bbox;constructor(n,e,t){if(!Array.isArray(n)||n.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=t,this.segments=[],typeof n[0][0]!="number"||typeof n[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const i=Lp.snap({x:new Uf(n[0][0]),y:new Uf(n[0][1])});this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};let c=i;for(let u=1,m=n.length;u<m;u++){if(typeof n[u][0]!="number"||typeof n[u][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const _=Lp.snap({x:new Uf(n[u][0]),y:new Uf(n[u][1])});_.x.eq(c.x)&&_.y.eq(c.y)||(this.segments.push(Ov.fromRing(c,_,this)),_.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=_.x),_.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=_.y),_.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=_.x),_.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=_.y),c=_)}(!i.x.eq(c.x)||!i.y.eq(c.y))&&this.segments.push(Ov.fromRing(c,i,this))}getSweepEvents(){const n=[];for(let e=0,t=this.segments.length;e<t;e++){const i=this.segments[e];n.push(i.leftSE),n.push(i.rightSE)}return n}},sU=class{multiPoly;exteriorRing;interiorRings;bbox;constructor(n,e){if(!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new PA(n[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let t=1,i=n.length;t<i;t++){const c=new PA(n[t],this,!1);c.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=c.bbox.ll.x),c.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=c.bbox.ll.y),c.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=c.bbox.ur.x),c.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=c.bbox.ur.y),this.interiorRings.push(c)}this.multiPoly=e}getSweepEvents(){const n=this.exteriorRing.getSweepEvents();for(let e=0,t=this.interiorRings.length;e<t;e++){const i=this.interiorRings[e].getSweepEvents();for(let c=0,u=i.length;c<u;c++)n.push(i[c])}return n}},kA=class{isSubject;polys;bbox;constructor(n,e){if(!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof n[0][0][0]=="number"&&(n=[n])}catch{}this.polys=[],this.bbox={ll:{x:new Uf(Number.POSITIVE_INFINITY),y:new Uf(Number.POSITIVE_INFINITY)},ur:{x:new Uf(Number.NEGATIVE_INFINITY),y:new Uf(Number.NEGATIVE_INFINITY)}};for(let t=0,i=n.length;t<i;t++){const c=new sU(n[t],this);c.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=c.bbox.ll.x),c.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=c.bbox.ll.y),c.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=c.bbox.ur.x),c.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=c.bbox.ur.y),this.polys.push(c)}this.isSubject=e}getSweepEvents(){const n=[];for(let e=0,t=this.polys.length;e<t;e++){const i=this.polys[e].getSweepEvents();for(let c=0,u=i.length;c<u;c++)n.push(i[c])}return n}},aU=(n,...e)=>tw.run("intersection",n,e);Lp.set;function L3(n,e,t,i={}){const c=e<0;let u=m8(Math.abs(e),i.units,"meters");c&&(u=-Math.abs(u));const m=Kh(n),_=lU(m,u,t);return _[0]+=_[0]-m[0]>180?-360:m[0]-_[0]>180?360:0,gs(_,i.properties)}function lU(n,e,t,i){i=i===void 0?Gu:Number(i);const c=e/i,u=n[0]*Math.PI/180,m=md(n[1]),_=md(t),o=c*Math.cos(_);let b=m+o;Math.abs(b)>Math.PI/2&&(b=b>0?Math.PI-b:-Math.PI-b);const I=Math.log(Math.tan(b/2+Math.PI/4)/Math.tan(m/2+Math.PI/4)),M=Math.abs(I)>1e-11?o/I:Math.cos(m),V=c*Math.sin(_)/M;return[((u+V)*180/Math.PI+540)%360-180,b*180/Math.PI]}function L8(n,e,t={}){const i=Kh(n),c=Kh(e);c[0]+=c[0]-i[0]>180?-360:i[0]-c[0]>180?360:0;const u=cU(i,c);return m8(u,"meters",t.units)}function cU(n,e,t){t=t===void 0?Gu:Number(t);const i=t,c=n[1]*Math.PI/180,u=e[1]*Math.PI/180,m=u-c;let _=Math.abs(e[0]-n[0])*Math.PI/180;_>Math.PI&&(_-=2*Math.PI);const o=Math.log(Math.tan(u/2+Math.PI/4)/Math.tan(c/2+Math.PI/4)),b=Math.abs(o)>1e-11?m/o:Math.cos(c);return Math.sqrt(m*m+b*b*_*_)*i}function Hh(n,e,t){if(t=t||{},!A3(t))throw new Error("options is invalid");const i=t.pivot,c=t.mutate;if(!n)throw new Error("geojson is required");if(e==null||isNaN(e))throw new Error("angle is required");if(e===0)return n;const u=i??Ol(n);return(c===!1||c===void 0)&&(n=I3(n)),ym(n,function(m){const o=y8(u,m)+e,b=L8(u,m),I=T3(L3(u,b,o));m[0]=I[0],m[1]=I[1]}),n}function P8(n,e={}){const t=[];if(_8(n,c=>{t.push(c.coordinates)}),t.length<2)throw new Error("Must specify at least 2 geometries");const i=aU(t[0],...t.slice(1));return i.length===0?null:i.length===1?S3(i[0],e.properties):uj(i,e.properties)}function fg(n,e,t){if(t=t||{},!A3(t))throw new Error("options is invalid");const i=t.origin||"centroid",c=t.mutate||!1;if(!n)throw new Error("geojson required");if(typeof e!="number"||e<=0)throw new Error("invalid factor");const u=Array.isArray(i)||typeof i=="object";return c!==!0&&(n=I3(n)),n.type==="FeatureCollection"&&!u?(pj(n,function(m,_){n.features[_]=RA(m,e,i)}),n):RA(n,e,i)}function RA(n,e,t){const i=g8(n)==="Point",c=uU(n,t);return e===1||i||(ym(n,function(u){const m=L8(c,u),_=y8(c,u),o=m*e,b=T3(L3(c,o,_));u[0]=b[0],u[1]=b[1],u.length===3&&(u[2]*=e)}),delete n.bbox),n}function uU(n,e){if(e==null&&(e="centroid"),Array.isArray(e)||typeof e=="object")return Kh(e);const t=n.bbox?n.bbox:Cu(n,{recompute:!0}),i=t[0],c=t[1],u=t[2],m=t[3];switch(e){case"sw":case"southwest":case"westsouth":case"bottomleft":return gs([i,c]);case"se":case"southeast":case"eastsouth":case"bottomright":return gs([u,c]);case"nw":case"northwest":case"westnorth":case"topleft":return gs([i,m]);case"ne":case"northeast":case"eastnorth":case"topright":return gs([u,m]);case"center":return Cj(n);case void 0:case null:case"centroid":return Ol(n);default:throw new Error("invalid origin")}}function tg(n,e,t,i){if(i=i||{},!A3(i))throw new Error("options is invalid");var c=i.units,u=i.zTranslation,m=i.mutate;if(!n)throw new Error("geojson is required");if(e==null||isNaN(e))throw new Error("distance is required");if(u&&typeof u!="number"&&isNaN(u))throw new Error("zTranslation is not a number");if(u=u!==void 0?u:0,e===0&&u===0)return n;if(t==null||isNaN(t))throw new Error("direction is required");return e<0&&(e=-e,t=t+180),(m===!1||m===void 0)&&(n=I3(n)),ym(n,function(_){var o=T3(L3(_,e,t,{units:c}));_[0]=o[0],_[1]=o[1],u&&_.length===3&&(_[2]+=u)}),n}function Yc(n){return String(n??"").trim().toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,"")||"na"}function fp(n){return Yc(n)}function Ra(n){return Yc(n)}function tf(...n){if(!n?.length)return"na";const e=n.flatMap(t=>Array.isArray(t)?t:[t]).map(t=>t==null?"":String(t)).map(t=>t.trim()).filter(Boolean);if(!e.length)return"na";if(e.length===1){const t=e[0];return t.match(/^\d+$/)?t:Yc(t)}return Yc(e.join("_"))}const P3={"Academic Support":"#f68a69",Admissions:"#b3b3b3","Admin-General":"#dcf4b4","Alumni & Foundation":"#4CAF50",Art:"#ea0ea0",Athletics:"#ea550a",Biology:"#17becf","Bronco Blend":"#5a4b22","Business Economics":"#d77cf8","Business Office":"#C44E52","Career Services":"#ff7f50",Chaplain:"#7B7F9E",Chemistry:"#f24516",Classroom:"#c20583",CFO:"#789051",CIO:"#2282bd",Communication:"#109014","Creighton Coll of Nursing":"#76C7C0","Digital Art":"#ffb347",Esports:"#00B894",Facilities:"#2CA02C","Financial Aid":"#8C564B",Forensics:"#aef2e1","Health Center":"#f50909","History, Religion, Philosophy":"#649515",Housing:"#f54d4d",HR:"#3498DB",IR:"#3b580e",IT:"#836377","Languages & Literatures":"#4a64b9",Library:"#079c29","Maintenance & Facilities":"#a6a6a6",Math:"#427b75",Music:"#9467bd",Offline:"#515250",OMC:"#9273f7",Open:"#95A5A6","Physical Education":"#a6d854",PM:"#d7a0fa","President Office":"#d884d8",Psychology:"#2bf087",Registrar:"#F1C40F","Service Learning/Chaplain":"#66c2a5","Student Accounts":"#86e6ed","Student Engagement":"#1584ed","Student Union":"#7cb0ef","Teacher Education":"#2E86AB",Theatre:"#f1374c",Unknown:"#8d776c",VPAA:"#1568f9","VPAA - Academic Admin":"#dde80d",Physics:"#ff24ab"},MA=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"];function hU(n){let e=0;for(let t=0;t<n.length;t++)e=e*31+n.charCodeAt(t)>>>0;return e}function rf(n){if(!n)return"#AAAAAA";const e=P3[n];if(e)return e;const t=hU(n)%MA.length;return MA[t]}function NA(n){const e=n||{},t=Array.isArray(e.features)?e.features:[];let i=0,c=0,u=0,m=0;const _=new Map;for(const I of t){const M=I.properties||{},V=M.__areaSf??M.Area_SF??M.Area_SF??M.area??M.Area??M.SF??M["Area (SF)"]??M.NetArea??0,k=Number(V);if(!Number.isFinite(k)||k<=0)continue;c+=1,i+=k;const ie=String(M.__roomType??M.NCES_Type??"").trim(),se=M.Name??M.Room??M["Room Name"]??"",de=String(se).toUpperCase(),J=ie.toUpperCase();(J.includes("CLASSROOM")||J.includes("LECTURE")||de.includes("CLASSROOM")||de.includes("LECTURE"))&&(m+=1,u+=k);const me=M.__dept??M.NCES_Department??M.NCES_Department??M.NCES_Dept??M["NCES Dept"]??M.department??M.Department??M.Dept??"",ue=String(me).trim();ue&&_.set(ue,(_.get(ue)||0)+k)}const o=Array.from(_.entries()).sort((I,M)=>M[1]-I[1]).slice(0,12).map(([I,M])=>({name:I,sf:M,color:rf(I)})),b=Object.fromEntries(_);return{totalSf:i,rooms:c,classroomSf:u,classroomCount:m,totalsByDept:b,keyDepts:o}}const dU=n=>Number.isFinite(n)?Math.max(0,Math.min(n,100)):null,fU=n=>Number.isFinite(n)?`${Math.round(n)}%`:"--",DA=({label:n,value:e,color:t,compact:i})=>{if(!Number.isFinite(e))return Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8,alignItems:"center"},children:[Y.jsx("div",{style:{fontSize:i?11:12,color:"#344054"},children:n}),Y.jsx("div",{style:{fontSize:i?11:12,color:"#667085"},children:"--"})]});const c=dU(e),u=i?6:8;return Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8,alignItems:"center"},children:[Y.jsxs("div",{children:[Y.jsx("div",{style:{fontSize:i?11:12,color:"#344054",marginBottom:3},children:n}),Y.jsx("div",{style:{height:u,background:"#e4e7ec",borderRadius:999,overflow:"hidden"},children:Y.jsx("div",{style:{width:`${c}%`,height:"100%",background:t}})})]}),Y.jsx("div",{style:{fontSize:i?11:12,color:"#475467",fontWeight:600},children:fU(e)})]})};function k8({timePct:n,seatPct:e,compact:t=!1}){return Number.isFinite(n)||Number.isFinite(e)?Y.jsxs("div",{style:{display:"grid",gap:t?6:10},children:[Y.jsx(DA,{label:"Time Utilization",value:n,color:"#3b82f6",compact:t}),Y.jsx(DA,{label:"Seat Utilization",value:e,color:"#f59e0b",compact:t})]}):null}function pU({buildingName:n,stats:e,keyDepts:t=[],floors:i=[],selectedFloor:c,onChangeFloor:u,onLoadFloorplan:m,onClose:_,onExportPDF:o,onExportCSV:b,onExplainBuilding:I,explainBuildingLoading:M=!1,explainBuildingDisabled:V=!1,explainBuildingError:k="",utilization:ie,dragHandleProps:se}){const de=pe=>Number.isFinite(pe)?Math.round(pe).toLocaleString():"-",J=pe=>Number.isFinite(pe)?Number(pe).toLocaleString():"-",ne=!!se,{style:me,...ue}=se||{},ke=ie&&(Number.isFinite(ie.timeUtilization)||Number.isFinite(ie.seatUtilization)),ze={display:"flex",justifyContent:"space-between",alignItems:"center",paddingRight:6,...ne?{cursor:"grab",userSelect:"none",touchAction:"none"}:{},...me||{}};return Y.jsxs("div",{style:{minWidth:320,maxWidth:360,padding:12,fontSize:13},children:[Y.jsxs("div",{style:ze,...ue,children:[Y.jsx("div",{style:{fontWeight:700},children:n}),Y.jsx("button",{onClick:_,"aria-label":"Close",style:{marginRight:4},children:""})]}),Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(0, 1fr) minmax(0, 1fr)",gap:8,marginTop:8},children:[Y.jsxs("div",{children:[Y.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"BUILDING TOTALS"}),Y.jsxs("div",{children:[Y.jsx("b",{children:"Total SF:"})," ",de(e?.totalSf)]}),Y.jsxs("div",{children:[Y.jsx("b",{children:"Rooms:"})," ",J(e?.rooms)]}),Y.jsxs("div",{children:[Y.jsx("b",{children:"Classroom SF:"})," ",de(e?.classroomSf)]}),Y.jsxs("div",{children:[Y.jsx("b",{children:"Classrooms:"})," ",J(e?.classroomCount)]}),Y.jsxs("div",{children:[Y.jsx("b",{children:"Levels:"})," ",i?.length??0]})]}),Y.jsxs("div",{children:[Y.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"Key Departments"}),t.length===0?Y.jsx("div",{style:{color:"#666"},children:""}):t.map(pe=>Y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4,fontSize:12,lineHeight:1.25},children:[Y.jsx("div",{style:{width:14,height:14,borderRadius:3,background:rf(pe.name),border:"1px solid #999"}}),Y.jsxs("div",{style:{flex:1},children:[pe.name," ",Number.isFinite(pe.areaSf||pe.Area||pe.sf)?` (${Math.round(pe.areaSf||pe.Area||pe.sf).toLocaleString()} SF)`:""]})]},pe.name))]})]}),ke?Y.jsxs("div",{style:{marginTop:10},children:[Y.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"Classroom Utilization"}),Y.jsx(k8,{timePct:ie.timeUtilization,seatPct:ie.seatUtilization,compact:!0})]}):null,Y.jsxs("div",{style:{marginTop:12,display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[Y.jsx("div",{children:Y.jsx("b",{children:"Floor"})}),Y.jsx("select",{value:c??"",onChange:pe=>u?.(pe.target.value),children:i.map(pe=>Y.jsx("option",{value:pe,children:pe},pe))}),Y.jsx("button",{className:"btn primary",onClick:m,children:"Load"}),Y.jsx("button",{className:"btn secondary",onClick:o,children:"Export to PDF"}),Y.jsx("button",{className:"btn",onClick:b,children:"Export CSV"}),Y.jsx("button",{className:"btn",onClick:I,disabled:V||M,children:M?"Explaining...":" Explain this building"})]}),k?Y.jsx("div",{style:{color:"crimson",marginTop:6,fontSize:12},children:k}):null]})}function mU({buildingName:n,floorLabel:e,stats:t,legendItems:i=[],floors:c=[],selectedFloor:u,onChangeFloor:m,onLoadFloorplan:_,onUnloadFloorplan:o,onClose:b,onExportPDF:I,onExportCSV:M,colorMode:V="department",onChangeColorMode:k,legendTitle:ie="Key Departments",legendSelection:se,onLegendClick:de,onExplainFloor:J,explainLoading:ne=!1,explainDisabled:me=!1,explainError:ue="",moveScenarioMode:ke=!1,onToggleMoveScenarioMode:ze,rotateActive:pe=!1,moveActive:U=!1,rotateValue:F=0,scaleValue:q=1,rotateNotice:j="",rotateStored:H=!1,adjustDebugInfo:Z=null,onStartRotate:be,onStartMove:Re,onCancelRotate:Oe,onClearRotate:Me,onScaleChange:we,onSaveAdjust:De,saveAdjustDisabled:tt=!1,dragHandleProps:xe}){const le=pt=>Number.isFinite(pt)?Math.round(pt).toLocaleString():"-",Ne=pt=>Number.isFinite(pt)?Number(pt).toLocaleString():"-",Be=!!xe,{style:Qe,...rt}=xe||{},gt={display:"flex",justifyContent:"space-between",...Be?{cursor:"grab",userSelect:"none",touchAction:"none"}:{},...Qe||{}};return Y.jsxs("div",{style:{minWidth:340,maxWidth:380,padding:12,fontSize:13},children:[Y.jsxs("div",{style:gt,...rt,children:[Y.jsx("div",{style:{fontWeight:700},children:n}),Y.jsx("button",{onClick:b,"aria-label":"Close",children:""})]}),Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(0, 0.95fr) minmax(0, 1.05fr)",gap:10,marginTop:8},children:[Y.jsxs("div",{children:[Y.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"FLOOR TOTALS"}),Y.jsxs("div",{children:[Y.jsx("b",{children:"Floor:"})," ",e??"-"]}),Y.jsxs("div",{children:[Y.jsx("b",{children:"Total SF:"})," ",le(t?.totalSf)]}),Y.jsxs("div",{children:[Y.jsx("b",{children:"Rooms:"})," ",Ne(t?.rooms)]}),Y.jsxs("div",{children:[Y.jsx("b",{children:"Classroom SF:"})," ",le(t?.classroomSf)]}),Y.jsxs("div",{children:[Y.jsx("b",{children:"Classrooms:"})," ",Ne(t?.classroomCount)]})]}),Y.jsxs("div",{children:[Y.jsx("div",{style:{fontWeight:600,marginBottom:6},children:ie}),i.length===0?Y.jsx("div",{style:{color:"#666"},children:""}):Y.jsx("div",{style:{maxHeight:"46vh",overflowY:"auto"},children:i.map(pt=>Y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4,padding:"2px 0",borderRadius:4,cursor:de?"pointer":"default",background:se===pt.name?"#f0f4ff":"transparent",fontSize:12,lineHeight:1.25},onClick:()=>de?.(pt.name),children:[Y.jsx("div",{style:{width:14,height:14,borderRadius:3,background:pt.color||rf(pt.name),border:"1px solid #999"}}),Y.jsxs("div",{style:{flex:1},children:[pt.name," ",Number.isFinite(pt.areaSf||pt.Area||pt.sf)?` (${Math.round(pt.areaSf||pt.Area||pt.sf).toLocaleString()} SF)`:""]})]},pt.name))})]})]}),Y.jsxs("div",{style:{marginTop:12,display:"flex",flexDirection:"column",gap:10},children:[Y.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[Y.jsx("div",{children:Y.jsx("b",{children:"Floor"})}),Y.jsx("select",{value:u??"",onChange:pt=>m?.(pt.target.value),children:c.map(pt=>Y.jsx("option",{value:pt,children:pt},pt))}),Y.jsx("button",{className:"btn primary",onClick:_,children:"Load"}),o?Y.jsx("button",{className:"btn",onClick:o,children:"Unload"}):null]}),Y.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginTop:6},children:[Y.jsx("button",{className:"btn secondary",onClick:I,children:"Export to PDF"}),M?Y.jsx("button",{className:"btn",onClick:M,children:"Export CSV"}):null,Y.jsx("button",{className:"btn",onClick:J,disabled:me||ne,children:ne?"Explaining...":" Explain this floor"})]}),ue?Y.jsx("div",{style:{color:"crimson",fontSize:12},children:ue}):null,Y.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[Y.jsx("div",{style:{fontWeight:600},children:"Highlight By"}),Y.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:6},children:[{key:"department",label:"Department"},{key:"type",label:"Type"},{key:"occupancy",label:"Occupancy"}].map(pt=>Y.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,fontSize:13},children:[Y.jsx("input",{type:"radio",name:"highlight-mode",value:pt.key,checked:V===pt.key,onChange:Mt=>k?.(Mt.target.value)}),pt.label]},pt.key))}),ze?Y.jsxs("div",{style:{marginTop:6},children:[Y.jsxs("button",{className:"btn",style:{width:"100%",fontWeight:600},onClick:ze,children:["Move Scenario Mode ",ke?"ON":"OFF"]}),Y.jsx("div",{style:{marginTop:4,fontSize:11,color:"#555",textAlign:"center"},children:"Click rooms to add/remove them from a what-if scenario. Real data is not changed."})]}):null,be?Y.jsxs("div",{style:{marginTop:10,paddingTop:8,borderTop:"1px solid #e5e5e5"},children:[Y.jsx("div",{style:{fontWeight:600},children:"Adjust Floorplan"}),Y.jsx("div",{style:{fontSize:12,color:"#555",marginTop:2},children:pe||U?"Drag on the map. Release to save.":"Use Rotate or Move, then drag on the map to adjust rooms + linework together."}),Y.jsxs("div",{style:{fontSize:12,marginTop:2},children:["Rotation: ",Number.isFinite(F)?`${F.toFixed(1)}`:"0","  Scale: ",Number.isFinite(q)?q.toFixed(2):"1.00"]}),Y.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginTop:6},children:[Y.jsx("button",{className:"btn",onClick:pe?Oe:be,children:pe?"Cancel Rotate":"Rotate"}),Re?Y.jsx("button",{className:"btn",onClick:U?Oe:Re,children:U?"Cancel Move":"Move"}):null,we?Y.jsxs(Y.Fragment,{children:[Y.jsx("button",{className:"btn",onClick:()=>we(-.02),children:"- Scale"}),Y.jsx("button",{className:"btn",onClick:()=>we(.02),children:"+ Scale"})]}):null,De?Y.jsx("button",{className:"btn primary",onClick:De,disabled:tt,children:"Save Adjust"}):null,Me?Y.jsx("button",{className:"btn",onClick:Me,disabled:!H,children:"Clear Adjust"}):null]}),j?Y.jsx("div",{style:{color:"crimson",fontSize:12,marginTop:4},children:j}):null,null]}):null]})]})]})}function FA({label:n,value:e,onChange:t,options:i,placeholder:c}){const[u,m]=On.useState(!1),[_,o]=On.useState(""),b=On.useRef(null),I=On.useMemo(()=>{const ie=new Set,se=[];return(i||[]).forEach(de=>{const J=typeof de=="string"?{value:de,label:de}:de;!J||!J.value||ie.has(J.value)||(ie.add(J.value),se.push({value:J.value,label:J.label??J.value}))}),se},[i]),M=On.useMemo(()=>I.find(se=>se.value===e)?.label??e??"",[I,e]),V=On.useMemo(()=>{const ie=(_||"").toLowerCase();return ie?I.filter(se=>{const de=(se.label??"").toLowerCase(),J=(se.value??"").toLowerCase();return de.includes(ie)||J.includes(ie)}):I},[I,_]),k=_||M||"";return Y.jsxs("div",{className:"mf-form-row",style:{position:"relative"},children:[Y.jsx("label",{children:n}),Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8},children:[Y.jsx("input",{ref:b,className:"mf-input",placeholder:c,value:k,onChange:ie=>{const se=ie.target.value;o(se),t?.(se)},onFocus:()=>m(!0)}),Y.jsx("button",{type:"button",className:"mf-input",style:{width:34,padding:0,display:"grid",placeItems:"center"},onClick:()=>{m(ie=>{const se=!ie;return se&&b.current?.focus(),se})},title:"Toggle options",children:""})]}),u&&Y.jsx("div",{style:{position:"absolute",zIndex:9999,left:0,right:0,top:"100%",background:"#fff",border:"1px solid #ddd",borderRadius:8,maxHeight:240,overflow:"auto",marginTop:6,boxShadow:"0 8px 24px rgba(0,0,0,.12)"},onMouseDown:ie=>ie.preventDefault(),children:V.length===0?Y.jsx("div",{style:{padding:10,color:"#777"},children:"No matches"}):V.map(ie=>Y.jsx("div",{style:{padding:"8px 10px",cursor:"pointer"},onClick:()=>{t?.(ie.value),o(""),m(!1)},children:ie.label},ie.value))})]})}function pp(n,e=8){if(!n)return[];const t=Object.entries(n);return t.sort((i,c)=>(c[1]||0)-(i[1]||0)),t.slice(0,e).map(([i,c])=>({name:i,areaSf:c}))}const gU=n=>{const e=Number(n||0);return Number.isFinite(e)?Math.round(e).toLocaleString():"0"},yU=({label:n,value:e})=>Y.jsxs("div",{style:{background:"#f9fafb",border:"1px solid #e4e7ec",borderRadius:8,padding:8},children:[Y.jsx("div",{style:{fontSize:10,textTransform:"uppercase",letterSpacing:.4,color:"#667085"},children:n}),Y.jsx("div",{style:{fontSize:16,fontWeight:800,color:"#1d2939"},children:e})]}),Qb=({children:n,style:e})=>Y.jsx("div",{style:{background:"#f9fafb",border:"1px solid #e4e7ec",borderRadius:8,padding:8,...e},children:n}),_U=({pct:n,occupied:e=0,vacant:t=0,unknown:i=0,scopeLabel:c=""})=>{const u=Number.isFinite(n)?Math.max(0,Math.min(1,n)):null,m=-90+(u||0)*180,_=u==null?"--":`${Math.round(u*100)}%`;return Y.jsxs("div",{className:"mf-gauge",children:[Y.jsx("div",{className:"mf-gauge-title",children:"OFFICE OCCUPANCY"}),c?Y.jsx("div",{style:{fontSize:11,color:"#667085",marginTop:-2,marginBottom:6},children:c}):null,Y.jsxs("svg",{width:"170",height:"110",viewBox:"0 0 200 130","aria-label":"Office Occupancy",children:[Y.jsx("path",{d:"M 20 110 A 80 80 0 0 1 80 30",fill:"none",stroke:"#d64545",strokeWidth:"16",strokeLinecap:"round"}),Y.jsx("path",{d:"M 80 30 A 80 80 0 0 1 120 30",fill:"none",stroke:"#f0a23b",strokeWidth:"16",strokeLinecap:"round"}),Y.jsx("path",{d:"M 120 30 A 80 80 0 0 1 180 110",fill:"none",stroke:"#2aa84a",strokeWidth:"16",strokeLinecap:"round"}),Y.jsxs("g",{transform:`translate(100 110) rotate(${m})`,children:[Y.jsx("line",{x1:"0",y1:"0",x2:"0",y2:"-70",stroke:"#222",strokeWidth:"3"}),Y.jsx("circle",{cx:"0",cy:"0",r:"6",fill:"#222"})]}),Y.jsx("text",{x:"20",y:"125",fontSize:"11",fill:"#666",children:"low"}),Y.jsx("text",{x:"92",y:"20",fontSize:"11",fill:"#666",children:"mid"}),Y.jsx("text",{x:"168",y:"125",fontSize:"11",fill:"#666",children:"high"}),Y.jsx("text",{x:"100",y:"90",textAnchor:"middle",fontSize:"16",fontWeight:"700",fill:"#1d2939",children:_})]}),Y.jsxs("div",{className:"mf-gauge-meta",children:[u==null?Y.jsx("div",{className:"muted",children:"No occupancy data"}):Y.jsxs("div",{children:[Y.jsx("b",{children:_})," occupied"]}),Y.jsxs("div",{className:"muted",children:["Occ: ",e," | Vac: ",t," | Unk: ",i]})]})]})},vU=({entries:n=[],maxSlices:e=8})=>{const t=n.slice(0,e),i=n.slice(e).reduce((V,k)=>V+Number(k?.sf||0),0),c=i>0?[...t,{name:"Other",sf:i}]:t,u=c.reduce((V,k)=>V+Number(k?.sf||0),0)||1,m="#94a3b8";let _=0;const o=60,b=60,I=50,M=c.map((V,k)=>{const ie=V?.name||"Unknown",se=Number(V?.sf||0),de=se/u,J=_+de*Math.PI*2,ne=o+I*Math.cos(_),me=b+I*Math.sin(_),ue=o+I*Math.cos(J),ke=b+I*Math.sin(J),ze=de>.5?1:0,pe=[`M ${o} ${b}`,`L ${ne} ${me}`,`A ${I} ${I} 0 ${ze} 1 ${ue} ${ke}`,"Z"].join(" "),U=ie==="Other"?m:rf(ie);return _=J,{d:pe,name:ie,sf:se,color:U}});return Y.jsxs("div",{className:"mf-pie",children:[Y.jsx("div",{className:"mf-section-title",children:"Departments (SF)"}),Y.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[Y.jsx("svg",{width:"120",height:"120",viewBox:"0 0 120 120","aria-label":"Department share by SF",children:M.map((V,k)=>Y.jsx("path",{d:V.d,fill:V.color,stroke:"#fff",strokeWidth:"1"},k))}),Y.jsx("div",{className:"mf-pie-legend",children:M.slice(0,6).map((V,k)=>Y.jsxs("div",{className:"mf-legend-row",children:[Y.jsx("span",{className:"mf-swatch",style:{background:V.color}}),Y.jsx("span",{className:"mf-legend-name",title:V.name,children:V.name}),Y.jsx("span",{className:"mf-legend-sf",children:Math.round(V.sf).toLocaleString()})]},k))})]})]})};function xU({title:n,metrics:e,loading:t,error:i,scopeLabel:c,utilization:u,utilizationScopeLabel:m,heatmapOn:_,onToggleHeatmap:o}){const b=e?.officeOccupancy||{},I=u&&(Number.isFinite(u.timeUtilization)||Number.isFinite(u.seatUtilization));return Y.jsxs("div",{style:{padding:6,width:"100%",display:"flex",flexDirection:"column",height:"100%"},children:[Y.jsx("div",{style:{fontWeight:800,fontSize:13,marginBottom:6},children:n}),t&&Y.jsx("div",{style:{fontSize:12,color:"#667085"},children:"Loading dashboard..."}),i&&Y.jsx("div",{style:{fontSize:12,color:"#b00020"},children:String(i)}),!t&&!i&&e&&Y.jsxs(Y.Fragment,{children:[Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(0, 1fr) 1.3fr",gap:6},children:[Y.jsx(yU,{label:"Total SF",value:gU(e.totalSf)}),Y.jsx(Qb,{children:Y.jsx(_U,{pct:b.pct,occupied:b.occupied,vacant:b.vacant,unknown:b.unknown,scopeLabel:c})})]}),Y.jsxs("div",{style:{flex:1,overflowY:"auto",paddingRight:4,marginTop:8},children:[Y.jsx(Qb,{children:Y.jsx(vU,{entries:e.byDept||[]})}),I?Y.jsxs(Qb,{style:{marginTop:8},children:[Y.jsx("div",{className:"mf-section-title",children:"Classroom Utilization"}),m?Y.jsx("div",{style:{fontSize:11,color:"#667085",marginTop:-2,marginBottom:6},children:m}):null,Y.jsx(k8,{timePct:u.timeUtilization,seatPct:u.seatUtilization,compact:!0}),Y.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,marginTop:8,fontSize:12},children:[Y.jsx("input",{type:"checkbox",checked:!!_,onChange:M=>o?.(M.target.checked)}),"Classroom Utilization Heat Map"]})]}):null]})]})]})}function R8(n={}){const e=n.area??n.Area??n["Area (SF)"]??n.SF??n.NetArea??n.Area_SF??n.Area_SF??0,t=Number(e);return!Number.isFinite(t)||t<=0?null:t}function k3(n={}){const e=n.occupancyStatus??n["Occupancy Status"]??n.vacancy??n.Vacancy??n.Vacant??n.Occupancy??n.OccupancyStatus??n.Status??"",t=String(e).trim().toUpperCase(),i=typeof e=="string"&&t.length>0||typeof e=="boolean"||typeof e=="number",c=e===!0||t==="VACANT"||t.includes("VACANT")||t.includes("UNOCCUPIED")||t.includes("AVAILABLE"),u=e===!1||t==="OCCUPIED"||t.includes("OCCUPIED");return i?c&&!u?"Vacant":u?"Occupied":"Unknown":(n.occupant??n.Occupant??n.AssignedTo??n.Assignee??"").toString().trim().length>0?"Occupied":"Unknown"}const bU=["Office - Staff","Office - Prof and Admin","Office - Prof & Admin","Office - Prof/Admin","Office - Faculty","Office - Adjunct Faculty","Office - Emeritus Faculty"],M8=n=>String(n||"").toLowerCase().replace(/[^a-z0-9]+/g," ").replace(/\b(and|&)\b/g," ").replace(/\s+/g," ").trim(),wU=new Set(bU.map(M8).filter(Boolean));function SU(n={}){const e=(n.NCES_Type??n.NCES_Type_Desc??n.__roomType??n.RoomTypeName??n.RoomType??n.Type??n.type??"").toString().toLowerCase();return wU.has(M8(e))}function EU(n){const e=Array.isArray(n)?n:Array.isArray(n?.features)?n.features:[];let t=0,i=0,c=0;for(const u of e){const m=u?.properties||{};if(!SU(m))continue;const _=k3(m);_==="Occupied"?t+=1:_==="Vacant"?i+=1:c+=1}return{pct:t+i>0?t/(t+i):null,occupied:t,vacant:i,unknown:c,totalOffices:t+i+c}}function AU(n={}){const e=R8(n);if(!e)return null;const t=(n.NCES_Department??n.department??n.Department??n.Dept??"").toString().trim()||"Unspecified",i=(n.NCES_Type??n.NCES_Type_Desc??n.RoomTypeName??n.RoomType??n.Type??n.type??"").toString().trim()||"Unknown",c=k3(n);return{sf:e,dept:t,type:i,occupancy:c}}function TU(n){const e=Array.isArray(n)?n:Array.isArray(n?.features)?n.features:[];let t=0,i=0,c=0,u=0,m=0,_=0;for(const I of e){const M=I?.properties||{},V=R8(M);if(!V)continue;const k=k3(M);k==="Vacant"?(i+=V,m+=1):k==="Occupied"?(t+=V,u+=1):(c+=V,_+=1)}const o=t+i+c,b=u+m+_;return{totalSF:o,totalRooms:b,occupiedSF:t,vacantSF:i,unknownSF:c,occupiedRooms:u,vacantRooms:m,unknownRooms:_,occupancyRate:o>0?t/o:null}}function IU(n=[]){let e=0,t=0;const i=new Map,c=new Map,u=new Map,m=I=>{const M=String(I||"").trim();if(!M)return!1;const V=M.toUpperCase();return/^rec[a-z0-9]{6,}$/i.test(M)?!1:V!=="UNSPECIFIED"&&V!=="UNKNOWN"&&V!=="N/A"&&V!=="NA"};for(const I of n){const M=AU(I?.properties||{});M&&(t+=1,e+=M.sf,m(M.dept)&&i.set(M.dept,(i.get(M.dept)||0)+M.sf),c.set(M.type,(c.get(M.type)||0)+M.sf),u.set(M.occupancy,(u.get(M.occupancy)||0)+M.sf))}const _=(I,M=10)=>Array.from(I.entries()).map(([V,k])=>({name:V,sf:k})).sort((V,k)=>k.sf-V.sf).slice(0,M),o=TU(n),b=EU(n);return{totalSf:e,roomCount:t,byDept:_(i,10),byType:_(c,10),byOccupancy:_(u,6),occupancySummary:o,officeOccupancy:b}}const CU={},{useRef:Ao,useEffect:ci,useState:qn,useCallback:nr,useMemo:$a}=eP,LU="https://github-stakeholder-ai.onrender.com";function N8(){const n="".trim();return n||(typeof window<"u"&&window.location.hostname.includes("github.io")?LU:"")}function PU(){const n=[];for(const[e,t]of Object.entries(P3))n.push(e,t);return["match",["coalesce",["feature-state","department"],["get","department"],["get","Department"],["get","Dept"],["get","NCES_Department"],["get","NCES_Dept"]],...n,"#e6e6e6"]}const kU=n=>{let e=0;for(let t=0;t<n.length;t++)e=e*31+n.charCodeAt(t)>>>0;return e},OA=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],nw=n=>n?String(n).trim().toLowerCase()==="public corridor"?"#D9D9D9":OA[kU(String(n).toLowerCase())%OA.length]:"#CCCCCC";function RU(n){return n?.length?n.map(e=>{const t=e.dept||e.name||e.Dept||e.Department;return t?`<div style="display:flex;align-items:center;gap:8px;margin:3px 0;">
        <span style="width:14px;height:14px;border-radius:3px;background:${rf(t)};border:1px solid #00000022"></span>
        <span>${t}</span>
      </div>`:""}).filter(Boolean).join(""):""}const BA=(n,e,t)=>Math.max(e,Math.min(n,t)),MU=n=>n instanceof Element?!!n.closest('button, a, input, select, textarea, [role="button"]'):!1,Py=(n,e,t,i)=>{if(n.button!==0||MU(n.target))return;const c=e.current;if(!c||!i)return;const u=i();if(!u)return;n.preventDefault(),n.stopPropagation();const m=c.getBoundingClientRect(),_=n.clientX-m.left,o=n.clientY-m.top,b=8,I=document.body.style.userSelect,M=(ie,se)=>{const de=ie-u.left-_,J=se-u.top-o,ne=Math.max(b,u.width-m.width-b),me=Math.max(b,u.height-m.height-b);t({x:BA(de,b,ne),y:BA(J,b,me)})},V=ie=>{M(ie.clientX,ie.clientY)},k=()=>{window.removeEventListener("pointermove",V),window.removeEventListener("pointerup",k),window.removeEventListener("pointercancel",k),document.body.style.userSelect=I};document.body.style.userSelect="none",window.addEventListener("pointermove",V),window.addEventListener("pointerup",k),window.addEventListener("pointercancel",k)},NU=["Classroom - General (111)","Classroom - Lecture Hall","Classroom - Indoor Amphitheater / Auditorium","Classroom - Multipurpose","Classroom - Service","Classroom - Seminar","Classroom - Dist Ed / Interactive","Classroom - Computer","Classroom - Collaborative","Laboratory - Class","Laboratory - Computer (non-scheduled)","Laboratory - Studio","Laboratory - Service","Laboratory - Open (non-scheduled)","Laboratory - Music Practice (non-scheduled)","Laboratory - Special Nonclass","Special Nonclass Lab Svs","Office - Prof and Admin (310)","Office - Staff (311)","Office - Faculty","Office - Adjunct Faculty","Office - Graduate / Post Doc Students","Office - Service","Office - Research / Non-Faculty","Office - Emeritus Faculty","Office - Other","Office - Waiting / Reception","Office - Student / Organization","Office - Pantry / Kitchenette","Office - Lounge / Lunch Room","Office - File Room","Office - Work Room","Office - Mail Room","Office - Vault","Office - Department / Suite Circulation","Office - Conference Room","Office - Conference Room Service","Office - Library / Reference Room","Office - Collaborative Work Space","Library - Study / Collaborative Area","Library / Testing / Study Room Service","Training / Tutorial Room","Library - Resource Room","Library Circulation or Reference","Library - Stack","Library / Testing / Study - Storage","Library - Open Stack, Study Area","Library - Processing Room","Academic Assistance","Academic Testing","Interview Room","Departmental Library","Recreation - Health or Physical Education","Athletics - Intercollegiate Sports","Spectator Seating","Fitness Area","Recreation - Service","Athletics - Intercollegiate Sports Service","Ice Rink","Swimming Pool","Athletics - Locker Room or Shower Area","Media - Multi Media Production","Media - Television Studio","Media - Radio Station","Media - Newspaper or Publications","Media - Service","Clinic - (Non-Health care)","Clinic - Observation Room (Non-Health care)","Clinic - Service (Non-Health care)","Clinic - Interview Room (Non-Health care)","Demonstration","Demonstration Service","Special Use - Other (All Purpose)","Public Performance / Assembly","Auditorium","Multi-Purpose Room","Dressing Room","Checkroom","Assembly Room Service (All Types)","Gallery","Museum","Exhibition / Display","Museum / Display / Exhibit Service","Dining / Food Facility","Vending","Dining / Food Service","Kitchen","Dry Food Storage","Cold Food Storage","Lounge - Public","Lounge - Faculty","Lounge - Staff","Lounge - Student","Lounge - Service","Merchandising","Bookstore","Merchandising Service","Recreation - General Use","Recreation Service - General Use","General - Locker Room","General - Locker Room (All Gender)","General - Locker Room Service","Computing or Networking (Central)","Telecom Room (Central)","Telecom / Audio / Video Room","Server Room","IT / Telecom / Network Service","Shop","Shop Service","Storage Room - Central","Storage Room - General","Vehicle / Equipment Storage","Vehicle / Equipment Storage Service","Central Services","Laundry - Central","Central Service Support","Hazardous Materials","Hazardous Materials Service","Parking Garage","Parking Garage Service","Patient Bedroom","Patient Bedroom Service","Health Care - Nurse Station","Utility Room","Record Room","Health Care - Recovery Room","Health Care - Treatment / Examination","Procedure Room","Health Care - Examining Room","Health Care - Therapy Room","Recreation Room","Health Care - Treatment / Examination Service","Health Care - X-Ray Treatment Room","Pharmacy","Health Care - Miscellaneous Storage","Health Care - Patient Reception","Dorm - Sleep / Study NO Toilet & Bath","Dorm - Bedroom Closet","Dorm - Lounge / Study Room","Dorm - Hallway","Dorm - Living Room","Dorm - Toilet or Bath","Sleep / Study WITH Toilet & Bath","Staff Quarters With Bath","Sleep / Study Service","Residence - Laundry","Residence - Storage Room","Apartment - Whole Building","Apartment - Whole Unit","Apartment - Bedroom","Apartment - Closet","Apartment - Living Room","Apartment - Service","Apartment - Kitchen","Apartment - Hallway","Apartment - Bathroom","Apartment - Storage","House","Rental House","Visiting/Special Residence","Other University Residence","Vacant - Assigned","Inactive Area","Available Unassigned","Alteration or Conversion Area","Unfinished Area","Clear Story (open to below)","Leased to Others","Unknown / No Data","Public Corridor","Non-Public Corridor","Lobby","Stairway","Escalator","Elevators","Vestibule","Ramp","Receiving / Loading Dock","Exterior Space - Covered","Commons Area","Custodial Area","Custodial Storage","Custodial Locker Room","Utility Room","Building Storage","Women's Restroom","Men's Restroom","Single Stall Restroom","Private Restroom","Trash / Recycle Room","Nursing / Lactation Room","Emergency Management Command Room","Mechanical Area","Mechanical Duct / Chase or Shaft Area","Interior Incinerator","Central Utility Plant Facility","Electrical Equipment Area","Structural Area","Storage Room - General","Testing"],R3=["Teacher Education","Business Office","Registrar","VPAA - Academic Admin","Chaplain","Financial Aid","Facilities","HR","Music","Open","Physical Education","Admissions","IT","Library","Student Accounts","Student Engagement","Health Center","Biology","Chemistry","Physics","Psychology","History, Religion, Philosophy","Languages & Literatures","Math","Art","Digital Art","Communication","Academic Support","Athletics","Esports","Forensics","CIO","CFO","President Office","Alumni & Foundation","Business Economics","Classroom","Creighton Coll of Nursing","Admin-General","Bronco Blend"],na=n=>(n??"").toString().trim(),h0=n=>{if(n==null)return"";if(typeof n=="string"||typeof n=="number")return String(n).trim();if(typeof n=="object"){const e=n.id??n.floorId??n.floor??n.name??n.label??n.value??"";return e!=null?String(e).trim():""}return String(n).trim()},Zg=(n,e)=>{if(!n)return null;const t=typeof n=="object"?n.id??n.buildingId??n.name??n.label??n.value??"":n;return t?e(t):null};function Zy(n={}){return n.Department||n.department||n.Dept||n.NCES_Department||n.NCES_Department||n["Department Owner Text"]||""}function Kf(n={},e=[]){if(!n||!Array.isArray(e))return null;for(const t of e){const i=n[t];if(i!=null&&String(i).trim()!=="")return i}return null}function DU(n,e,t){const i=(n||"").toString().trim(),c=na(e),u=na(t);return c&&u?`${c} - ${u} ${i}`.trim():c?`${c} ${i}`.trim():i||""}function D8(n,e={}){const t=na(n);if(!t)return null;const i=na(e.typeDesc??e.typeLabel??e.typeName),c=DU(i||t,e.categoryCode,e.typeCode)||t;return{value:t,label:c}}function FU(n=[]){const e=new Map;return(n||[]).forEach(t=>{const i=D8(t);i&&e.set(i.value,i)}),Array.from(e.values()).sort((t,i)=>t.label.localeCompare(i.label))}function OU(n=[],e=[]){const t=new Map;return(n||[]).forEach(i=>{i?.value&&t.set(i.value,i)}),(e||[]).forEach(i=>{i?.value&&t.set(i.value,i)}),Array.from(t.values()).sort((i,c)=>i.label.localeCompare(c.label))}function F8(n,e=.35){if(!n)return`rgba(255,165,0,${e})`;const t=n.replace("#","");if(!/^[0-9a-fA-F]+$/.test(t))return`rgba(255,165,0,${e})`;const i=parseInt(t,16);if(Number.isNaN(i))return`rgba(255,165,0,${e})`;const c=i>>16&255,u=i>>8&255,m=i&255;return`rgba(${c},${u},${m},${e})`}function O8(n={}){const e=Kf(n,["RoomCategory","Category","CategoryCode","rm_cat","rm_cat_id","NCES_Category","NCES Category","NCES_Category_Code","NCES Category Code"]);return e?String(e).trim():null}function e5(n={}){const e=n.seatCount??n.SeatCount??n["Seat Count"]??n.Seats??n.Capacity??n.rm_seats??n.SeatingCapacity??n["NCES_Seat Count"]??n.NCES_Seat_Count??n["NCES_Seat Count"]??n.NCES_SeatCount??null,t=Number(e);return Number.isFinite(t)&&t>0?t:null}function B8(n){if(!n)return!1;const e=String(n).trim();return e.length>0&&e.startsWith("3")}function BU(n){if(!n)return!1;const t=String(n).trim().charAt(0);return t==="1"||t==="2"}function z8(n={}){const e=Kf(n,["RoomType","roomType","Name","type","RoomTypeName","NCES_Type Description_Sh","NCES_Type Description","NCES Type Description","NCES_Type Description_Short"])??"",t=String(e).toLowerCase(),i=t.includes("office"),c=t.includes("classroom")||t.includes("lab")||t.includes("studio");return{norm:t,isOfficeText:i,isTeachingText:c}}function S0(n={}){const e=Kf(n,["FeatureClass","featureClass","Layer","layer","Type","type","Feature","feature","Name","name"])??"",t=String(e).toLowerCase();return t.includes("door")||t.includes("entrance")?"door":t.includes("stair")?"stair":"room"}function zU(n){const e=new Map,t=new Set(R3.map(na)),i=_=>Kf(_,["NCES_Category","NCES Category","NCES_Category_Code","NCES Category Code"]),c=_=>Kf(_,["NCES_Type","NCES Type","NCES_Type_Code","NCES Type Code"]),u=_=>Kf(_,["NCES_Type Description_Sh","NCES_Type Description","NCES Type Description","NCES_Type Description_Short"]),m=(_,o={})=>{const b=D8(_,o);b&&e.set(b.value,b)};for(const _ of n||[]){const o=_.properties||{},b=na(fd(o)),I=na(o.department??o.Department??o.Dept),M=i(o),V=c(o),k=u(o);b&&m(b,{categoryCode:M,typeCode:V,typeDesc:k}),I&&t.add(I)}return{typeOptions:Array.from(e.values()).sort((_,o)=>_.label.localeCompare(o.label)),deptOptions:Array.from(t).filter(Boolean).sort()}}function jU(n,e={}){if(!n||!Array.isArray(n.features)||!n.features.length)return null;const t=Cu(n);if(!t||t.some(pe=>!Number.isFinite(pe)))return null;const i=720,c=t[2]-t[0],u=t[3]-t[1];if(c<=0||u<=0)return null;const m=u/c,_=Math.max(260,Math.round(i*Math.max(.33,Math.min(m,2.5)))),o=document.createElement("canvas");o.width=i,o.height=_;const b=o.getContext("2d");b.fillStyle="#ffffff",b.fillRect(0,0,i,_);const I=pe=>{const U=(pe[0]-t[0])/c*i,F=_-(pe[1]-t[1])/u*_;return[U,F]},M=pe=>{if(!Array.isArray(pe))return;b.beginPath();const U=I(pe[0]);b.moveTo(U[0],U[1]);for(let F=1;F<pe.length;F++){const q=I(pe[F]);b.lineTo(q[0],q[1])}b.closePath()},V=pe=>{if(!Array.isArray(pe))return;b.beginPath();const U=I(pe[0]);b.moveTo(U[0],U[1]);for(let F=1;F<pe.length;F++){const q=I(pe[F]);b.lineTo(q[0],q[1])}},k=pe=>na(pe?.department??pe?.Department??pe?.Dept??"")||"",ie=pe=>{if(Number.isFinite(pe))return pe;const U=Number(pe);return Number.isFinite(U)?U:pe!=null?String(pe):null},se=new Set((e?.selectedIds||[]).map(pe=>ie(pe)).filter(pe=>pe!=null)),de=e?.solidFill===!0,J=e?.labelOptions||{},ne=J.enabled!==!1,me=J.hideDrawing===!0,ue={font:J.font||'bold 10px "Open Sans", Arial, sans-serif',lineHeight:J.lineHeight||12,maxLines:J.maxLines||4,minWidth:J.minWidth||32,minHeight:J.minHeight||14},ke=(pe,U,F,q)=>{const j=[],H=Z=>{const be=na(Z);be&&(me&&be.toLowerCase()==="drawing"||j.length>=ue.maxLines||j.push(be))};return H(pe?.Number??pe?.RoomNumber??pe?.number),H(fd(pe)||pe?.Name),H(U||F),q>0&&H(`${Math.round(q).toLocaleString()} SF`),j},ze=(pe,U)=>{if(!ne||!U.length)return;const q=Ol(pe)?.geometry?.coordinates;if(!q)return;const j=Cu(pe);if(!j)return;const H=(j[2]-j[0])/c*i,Z=(j[3]-j[1])/u*_,be=ue.lineHeight*U.length;if(H<ue.minWidth||Z<Math.max(be,ue.minHeight))return;const[Re,Oe]=I(q),Me=ue.lineHeight*U.length,we=Oe-Me/2+ue.lineHeight/2;b.save(),b.font=ue.font,b.textAlign="center",b.textBaseline="middle",b.lineJoin="round",b.fillStyle="#101010",b.strokeStyle="rgba(255,255,255,0.95)",b.lineWidth=3;for(let De=0;De<U.length;De+=1){const tt=we+De*ue.lineHeight;b.strokeText(U[De],Re,tt),b.fillText(U[De],Re,tt)}b.restore()};for(const pe of n.features){const U=pe?.properties||{},F=S0(U),q=na(U?.scenarioDepartment??U?.ScenarioDepartment??U?.scenarioDept??""),j=k(U),H=q||j,Z=U?.__roomType||fd(U)||U?.Name||"",be=(U?.occupant??U?.Occupant??"").toString().trim(),Re=e?.colorMode||"department";let Oe="#f7f7f7";Re==="type"?Oe=nw(Z):Re==="occupancy"?Oe=be?"#29b6f6":"#e0e0e0":Re==="vacancy"?Oe=be?"#29b6f6":"#ff7043":Oe=H?rf(H):"#f7f7f7";let Me=Oe?F8(Oe,de?1:q?.9:.4):"#f7f7f7",we="#2b2b2b",De=F==="room"?2.2:1.5;const tt=ie(pe?.id??U?.RevitId??U?.Revit_UniqueId??U?.RevitUniqueId??U?.Revit_UniqueID??U?.["Revit Unique Id"]??U?.["Room GUID"]??U?.roomGuid??U?.id),xe=tt!=null&&se.has(tt);F==="door"?(Me="#1d1d1d",we="#0d0d0d",De=1.5):F==="stair"?(Me="#6b6b6b",we="#3a3a3a",De=1.5):Oe&&(we="#202020"),xe&&(F==="room"&&(Me="rgba(0, 200, 255, 0.35)"),we="#00c8ff",De=4);const le=pe?.geometry;if(!le||!le.coordinates)continue;const Ne=(rt,gt)=>{Array.isArray(rt)&&(gt==="Polygon"?(b.fillStyle=Me,b.strokeStyle=we,b.lineWidth=De,rt.forEach(pt=>{M(pt),b.fill(),b.stroke()})):gt==="MultiPolygon"?rt.forEach(pt=>Ne(pt,"Polygon")):gt==="LineString"?(b.strokeStyle=we,b.lineWidth=F==="door"?2:1.5,V(rt),b.stroke()):gt==="MultiLineString"&&rt.forEach(pt=>Ne(pt,"LineString")))};Ne(le.coordinates,le.type);const Be=Number(U?.Area_SF??U?.Area??U?.["Area (SF)"]??U?.Area_sf??U?.NetArea??U?.SF??0),Qe=Number.isFinite(Be)&&Be>0?Be:0;if(F==="room"){const rt=ke(U,q,j,Qe);ze(pe,rt)}}return{width:o.width,height:o.height,data:o.toDataURL("image/png")}}function Yg(n={}){const e=n?.fc??n;return e?jU(e,n):null}const fd=(n={})=>{const e=n["Room Type Description"]??n.RoomTypeDescription??n.roomTypeDescription;if(e&&String(e).trim())return String(e).trim();const t=n.NCES_Type??n["NCES Type"]??n["NCES Types"]??n.NCES_Types??n.nces_type??n.ncesType;if(t&&String(t).trim())return String(t).trim();const i=n["NCES_Type Description_Sh"]??n["NCES_Type Description"]??n["NCES Type Description"]??n["NCES_Type Description_Short"]??n["NCES Type Description Short"];return i&&String(i).trim()?String(i).trim():(n["Room Type"]||n.RoomType||n.RoomTypeName||n.Type||n.type||n.Category||n.category||n.Name||n["Room Name"]||"").toString().trim()};function M3(n={}){return(n.NCES_Type??n["NCES Types"]??n.NCES_Types??n.nces_type??n.ncesType??"").toString().trim()}function j8(n={}){return(n.NCES_Department??n.NCES_Department??n.NCES_Dept??n["NCES Dept"]??n.department??n.Department??n.Dept??"").toString().trim()}function U8(n={}){const e=n.Area_SF??n.Area_SF??n.area??n.Area??n.SF??n["Area (SF)"]??n.NetArea??0,t=Number(e);return Number.isFinite(t)?t:0}function UU(n){if(!n?.features?.length)return n;const e=n.features.map(t=>{const i=t?.properties||{};if("__roomType"in i)return t;const c=M3(i),u=c&&String(c).trim();return u?{...t,properties:{...i,__roomType:u}}:t});return{...n,features:e}}function V8(n){if(!n)return null;const e=n.anchor_feet||n.anchorFeet||n.anchor;return[n.target_lon??n.targetLon,n.target_lat??n.targetLat,n.rotation_deg_cw??n.rotation_deg,n.scale_deg_per_foot??n.scale_deg_per_ft??n.scale,Array.isArray(e)?e.join(","):""].map(i=>i==null?"":String(i)).join("|")}const VU="mfDrawingAlign:",Yy=new Map,q8="mfFloorAdjust:",$8="mfFloorAdjustUrl:",G8="mfFloorAdjustFloor:",Jy=new Map,Qy=new Map,e_=new Map;function N3(n,e){const t=Yc(n||""),i=Ra(e||"");return`${VU}${t}/${i}`}function bx(n,e){const t=Yc(n||""),i=Ra(e||"");return`${q8}${t}/${i}`}function wx(n){const e=Yc(n||"");return`${$8}${e}`}function Sx(n,e){const t=n?Nd(n):"",i=Yc(t||n||""),c=Ra(e||"");return`${G8}${i}/${c}`}function H8(n){return n?[n.rotationDeg,n.scale,Array.isArray(n.pivot)?n.pivot.join(","):"",Array.isArray(n.target)?n.target.join(","):""].map(t=>t==null?"":String(t)).join("|"):null}function W8(n,e){const t=N3(n,e);if(!t)return null;if(Yy.has(t))return Yy.get(t);if(typeof window>"u"||!window.localStorage)return null;try{const i=window.localStorage.getItem(t);if(!i)return null;const c=JSON.parse(i);return!c||!Array.isArray(c.pivot)||!Array.isArray(c.target)?null:(Yy.set(t,c),c)}catch{return null}}function Ym(n,e){const t=bx(n,e);if(!t)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};if(Jy.has(t))return Jy.get(t);if(typeof window>"u"||!window.localStorage)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};try{const i=window.localStorage.getItem(t);if(!i)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};const c=JSON.parse(i),u=Number(c?.rotationDeg),m=Number(c?.scale),_=Array.isArray(c?.translateMeters)?c.translateMeters:[0,0],o=Array.isArray(c?.translateLngLat)?c.translateLngLat:null,b=Number(c?.savedAt),I=Array.isArray(c?.pivot)?c.pivot:null,M=Array.isArray(c?.anchorLngLat)?c.anchorLngLat:null,V={rotationDeg:Number.isFinite(u)?u:0,scale:Number.isFinite(m)&&m>0?m:1,translateMeters:[Number.isFinite(_[0])?_[0]:0,Number.isFinite(_[1])?_[1]:0],translateLngLat:Array.isArray(o)?[Number.isFinite(o[0])?o[0]:0,Number.isFinite(o[1])?o[1]:0]:null,anchorLngLat:Array.isArray(M)?[Number.isFinite(M[0])?M[0]:0,Number.isFinite(M[1])?M[1]:0]:null,savedAt:Number.isFinite(b)?b:0,pivot:Array.isArray(I)&&I.length>=2?I:null};return Jy.set(t,V),V}catch{return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0}}}function zy(n){const e=wx(n);if(!e)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};if(Qy.has(e))return Qy.get(e);if(typeof window>"u"||!window.localStorage)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};try{const t=window.localStorage.getItem(e);if(!t)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};const i=JSON.parse(t),c=Number(i?.rotationDeg),u=Number(i?.scale),m=Array.isArray(i?.translateMeters)?i.translateMeters:[0,0],_=Array.isArray(i?.translateLngLat)?i.translateLngLat:null,o=Number(i?.savedAt),b=Array.isArray(i?.pivot)?i.pivot:null,I=Array.isArray(i?.anchorLngLat)?i.anchorLngLat:null,M={rotationDeg:Number.isFinite(c)?c:0,scale:Number.isFinite(u)&&u>0?u:1,translateMeters:[Number.isFinite(m[0])?m[0]:0,Number.isFinite(m[1])?m[1]:0],translateLngLat:Array.isArray(_)?[Number.isFinite(_[0])?_[0]:0,Number.isFinite(_[1])?_[1]:0]:null,anchorLngLat:Array.isArray(I)?[Number.isFinite(I[0])?I[0]:0,Number.isFinite(I[1])?I[1]:0]:null,savedAt:Number.isFinite(o)?o:0,pivot:Array.isArray(b)&&b.length>=2?b:null};return Qy.set(e,M),M}catch{return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0}}}function jy(n,e){const t=Sx(n,e);if(!t)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};if(e_.has(t))return e_.get(t);if(typeof window>"u"||!window.localStorage)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};try{const i=window.localStorage.getItem(t);if(!i)return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0};const c=JSON.parse(i),u=Number(c?.rotationDeg),m=Number(c?.scale),_=Array.isArray(c?.translateMeters)?c.translateMeters:[0,0],o=Array.isArray(c?.translateLngLat)?c.translateLngLat:null,b=Number(c?.savedAt),I=Array.isArray(c?.pivot)?c.pivot:null,M=Array.isArray(c?.anchorLngLat)?c.anchorLngLat:null,V={rotationDeg:Number.isFinite(u)?u:0,scale:Number.isFinite(m)&&m>0?m:1,translateMeters:[Number.isFinite(_[0])?_[0]:0,Number.isFinite(_[1])?_[1]:0],translateLngLat:Array.isArray(o)?[Number.isFinite(o[0])?o[0]:0,Number.isFinite(o[1])?o[1]:0]:null,anchorLngLat:Array.isArray(M)?[Number.isFinite(M[0])?M[0]:0,Number.isFinite(M[1])?M[1]:0]:null,savedAt:Number.isFinite(b)?b:0,pivot:Array.isArray(I)&&I.length>=2?I:null};return e_.set(t,V),V}catch{return{rotationDeg:0,scale:1,translateMeters:[0,0],savedAt:0}}}function qU(n,e,t){const i=N3(n,e);if(!i||!t||typeof window>"u"||!window.localStorage)return!1;try{return window.localStorage.setItem(i,JSON.stringify(t)),Yy.set(i,t),!0}catch{return!1}}function R1(n,e,t){const i=bx(n,e);if(!i||!t||typeof window>"u"||!window.localStorage)return!1;const c=Array.isArray(t.pivot)?t.pivot:null,u=Array.isArray(t.translateLngLat)?t.translateLngLat:null,m=Array.isArray(t.anchorLngLat)?t.anchorLngLat:null,_={rotationDeg:Number.isFinite(t.rotationDeg)?t.rotationDeg:0,scale:Number.isFinite(t.scale)&&t.scale>0?t.scale:1,translateMeters:Array.isArray(t.translateMeters)?[Number.isFinite(t.translateMeters[0])?t.translateMeters[0]:0,Number.isFinite(t.translateMeters[1])?t.translateMeters[1]:0]:[0,0],translateLngLat:Array.isArray(u)?[Number.isFinite(u[0])?u[0]:0,Number.isFinite(u[1])?u[1]:0]:null,anchorLngLat:Array.isArray(m)?[Number.isFinite(m[0])?m[0]:0,Number.isFinite(m[1])?m[1]:0]:null,savedAt:Date.now(),pivot:Array.isArray(c)&&c.length>=2?c:null};try{return window.localStorage.setItem(i,JSON.stringify(_)),Jy.set(i,_),!0}catch{return!1}}function M1(n,e){const t=wx(n);if(!t||!e||typeof window>"u"||!window.localStorage)return!1;const i=Array.isArray(e.pivot)?e.pivot:null,c=Array.isArray(e.translateLngLat)?e.translateLngLat:null,u=Array.isArray(e.anchorLngLat)?e.anchorLngLat:null,m={rotationDeg:Number.isFinite(e.rotationDeg)?e.rotationDeg:0,scale:Number.isFinite(e.scale)&&e.scale>0?e.scale:1,translateMeters:Array.isArray(e.translateMeters)?[Number.isFinite(e.translateMeters[0])?e.translateMeters[0]:0,Number.isFinite(e.translateMeters[1])?e.translateMeters[1]:0]:[0,0],translateLngLat:Array.isArray(c)?[Number.isFinite(c[0])?c[0]:0,Number.isFinite(c[1])?c[1]:0]:null,anchorLngLat:Array.isArray(u)?[Number.isFinite(u[0])?u[0]:0,Number.isFinite(u[1])?u[1]:0]:null,savedAt:Date.now(),pivot:Array.isArray(i)&&i.length>=2?i:null};try{return window.localStorage.setItem(t,JSON.stringify(m)),Qy.set(t,m),!0}catch{return!1}}function N1(n,e,t){const i=Sx(n,e);if(!i||!t||typeof window>"u"||!window.localStorage)return!1;const c=Array.isArray(t.pivot)?t.pivot:null,u=Array.isArray(t.translateLngLat)?t.translateLngLat:null,m=Array.isArray(t.anchorLngLat)?t.anchorLngLat:null,_={rotationDeg:Number.isFinite(t.rotationDeg)?t.rotationDeg:0,scale:Number.isFinite(t.scale)&&t.scale>0?t.scale:1,translateMeters:Array.isArray(t.translateMeters)?[Number.isFinite(t.translateMeters[0])?t.translateMeters[0]:0,Number.isFinite(t.translateMeters[1])?t.translateMeters[1]:0]:[0,0],translateLngLat:Array.isArray(u)?[Number.isFinite(u[0])?u[0]:0,Number.isFinite(u[1])?u[1]:0]:null,anchorLngLat:Array.isArray(m)?[Number.isFinite(m[0])?m[0]:0,Number.isFinite(m[1])?m[1]:0]:null,savedAt:Date.now(),pivot:Array.isArray(c)&&c.length>=2?c:null};try{return window.localStorage.setItem(i,JSON.stringify(_)),e_.set(i,_),!0}catch{return!1}}function $U(n,e){const t=N3(n,e);if(t&&(Yy.delete(t),!(typeof window>"u"||!window.localStorage)))try{window.localStorage.removeItem(t)}catch{}}function GU(n,e){const t=bx(n,e);if(t&&(Jy.delete(t),!(typeof window>"u"||!window.localStorage)))try{window.localStorage.removeItem(t)}catch{}}function HU(n){const e=wx(n);if(e&&(Qy.delete(e),!(typeof window>"u"||!window.localStorage)))try{window.localStorage.removeItem(e)}catch{}}function WU(n,e){const t=Sx(n,e);if(t&&(e_.delete(t),!(typeof window>"u"||!window.localStorage)))try{window.localStorage.removeItem(t)}catch{}}function KU(n,e){if(!n?.features?.length||!e)return n;const t=H8(e);if(t&&n.__mfDrawingAlignSignature===t)return n;const i=Array.isArray(e.pivot)?e.pivot:null,c=Array.isArray(e.target)?e.target:null;if(!i||!c)return n;const u=Number.isFinite(e.scale)?e.scale:1,_=(Number.isFinite(e.rotationDeg)?e.rotationDeg:0)*Math.PI/180,o=Math.cos(_),b=Math.sin(_),[I,M]=i,[V,k]=c,ie=J=>{const ne=J[0]-I,me=J[1]-M,ue=(ne*o-me*b)*u,ke=(ne*b+me*o)*u;return[V+ue,k+ke]},se=n.features.map(J=>!Ch(J?.properties||{})||!J?.geometry?J:{...J,geometry:{...J.geometry,coordinates:Vf(J.geometry.coordinates,ie)}}),de={...n,features:se};return t&&(de.__mfDrawingAlignSignature=t),de}function Bv({buildingLabel:n,buildingId:e,floorBasePath:t,fitBuilding:i}={}){const c=n||e||i?.properties?.id||i?.properties?.name||"",u=Mf(c)||c;if(u)return u;if(t){const m=Nd(t);if(m)return p0?.[m]||m}return""}function XU({buildingLabel:n,buildingId:e,floorBasePath:t,fitBuilding:i}={}){const c=t?Nd(t):null;return c||Bv({buildingLabel:n,buildingId:e,floorBasePath:t,fitBuilding:i})}function zv(n){return n?[n.rotationDeg,n.scale,Array.isArray(n.translateMeters)?n.translateMeters.join(","):"",Array.isArray(n.translateLngLat)?n.translateLngLat.join(","):"",Array.isArray(n.anchorLngLat)?n.anchorLngLat.join(","):""].map(t=>t==null?"":String(t)).join("|"):null}function mp(n){return n?Math.abs(n.rotationDeg||0)>1e-6||Math.abs((n.scale||1)-1)>1e-6||Math.abs(n.translateMeters?.[0]||0)>1e-6||Math.abs(n.translateMeters?.[1]||0)>1e-6||Math.abs(n.translateLngLat?.[0]||0)>1e-12||Math.abs(n.translateLngLat?.[1]||0)>1e-12||Math.abs(n.anchorLngLat?.[0]||0)>1e-12||Math.abs(n.anchorLngLat?.[1]||0)>1e-12:!1}function rw({base:n,url:e,label:t}){const i=[{source:"basePath",adjust:n},{source:"url",adjust:e},{source:"label",adjust:t}].filter(m=>m.adjust),c=i.filter(m=>mp(m.adjust));if(c.length){let m=null;for(const _ of c){const o=Number(_.adjust?.savedAt)||0;(!m||o>m.savedAt)&&(m={..._,savedAt:o})}if(m)return m}return i.find(m=>m.source==="label")||i[0]||{source:"label",adjust:null,savedAt:0}}function ov(n){if(!n?.features?.length)return null;try{const e=Ol(n)?.geometry?.coordinates||null;return!Array.isArray(e)||e.length<2||!Number.isFinite(e[0])||!Number.isFinite(e[1])?null:e}catch{return null}}function ZU(n,e,t){if(!n?.features?.length||!e)return{fc:n,fitTransform:t};const i=zv(e);if(i&&n.__mfUserAdjustSignature===i)return{fc:n,fitTransform:t};const c=Number.isFinite(e.rotationDeg)?e.rotationDeg:0,u=Number.isFinite(e.scale)?e.scale:1,m=Array.isArray(e.translateMeters)?e.translateMeters:[0,0],_=Array.isArray(e.translateLngLat)?e.translateLngLat:null,o=Array.isArray(e.anchorLngLat)?e.anchorLngLat:null;let b=n;const I=(Array.isArray(e.pivot)?e.pivot:null)||t?.scaleOrigin||t?.rotationPivot||Ol(b)?.geometry?.coordinates||null;if(Number.isFinite(u)&&Math.abs(u-1)>1e-6&&I&&(b=fg(b,u,{origin:I})),Number.isFinite(c)&&Math.abs(c)>1e-6&&I&&(b=Hh(b,c,{pivot:I})),_&&(Math.abs(_[0]||0)>1e-12||Math.abs(_[1]||0)>1e-12)?b=ow(b,_):m&&(Math.abs(m[0]||0)>1e-6||Math.abs(m[1]||0)>1e-6)&&(b=F3(b,m)),o&&Number.isFinite(o[0])&&Number.isFinite(o[1])){const V=ov(b);if(V){const k=o[0]-V[0],ie=o[1]-V[1];(Math.abs(k)>1e-12||Math.abs(ie)>1e-12)&&(b=ow(b,[k,ie]))}}b&&typeof b=="object"&&(b.__mfUserAdjustSignature=i);let M=t;if((Number.isFinite(u)||Number.isFinite(c)||Array.isArray(m))&&(M=M||{rotationDeg:0,rotationPivot:I,scale:1,scaleOrigin:I,translateKm:0,translateBearing:0,nudgeMeters:[0,0],refineRotationDeg:0,refineRotationPivot:I},I&&(Array.isArray(M.rotationPivot)||(M.rotationPivot=I),Array.isArray(M.scaleOrigin)||(M.scaleOrigin=I),Array.isArray(M.refineRotationPivot)||(M.refineRotationPivot=I)),Number.isFinite(u)&&Math.abs(u-1)>1e-6&&(M.scale=(Number.isFinite(M.scale)?M.scale:1)*u),Number.isFinite(c)&&Math.abs(c)>1e-6&&(M.rotationDeg=(Number.isFinite(M.rotationDeg)?M.rotationDeg:0)+c),Array.isArray(m))){const V=Array.isArray(M.nudgeMeters)?M.nudgeMeters:[0,0];M.nudgeMeters=[(Number(V[0])||0)+(Number(m[0])||0),(Number(V[1])||0)+(Number(m[1])||0)]}return{fc:b,fitTransform:M}}function Ch(n={}){return n?String(n.type??n.Type??"").toLowerCase()==="drawing"?!0:n.interactive===!1:!1}function YU(n,e){if(!n?.geometry||!Array.isArray(e))return e;const t=Dd(n.geometry,4e3);if(!t.length)return e;let i=e,c=1/0;for(const[u,m]of t){const _=u-e[0],o=m-e[1],b=_*_+o*o;b<c&&(c=b,i=[u,m])}return i}function JU(n,e=4e3){let t=1/0,i=1/0,c=-1/0,u=-1/0,m=0;const _=o=>{if(!(!Array.isArray(o)||m>=e)){if(o.length>=2&&typeof o[0]=="number"&&typeof o[1]=="number"){const b=o[0],I=o[1];b<t&&(t=b),I<i&&(i=I),b>c&&(c=b),I>u&&(u=I),m+=1;return}o.forEach(_)}};return _(n),m?{minX:t,minY:i,maxX:c,maxY:u}:null}function QU(n,e=.12){if(!n?.features?.length)return n;const t=n.features.filter(J=>!Ch(J?.properties||{}));if(!t.length)return n;let i=1/0,c=1/0,u=-1/0,m=-1/0,_=0;for(const J of t){const ne=Dd(J?.geometry,4e3);for(const[me,ue]of ne)me<i&&(i=me),ue<c&&(c=ue),me>u&&(u=me),ue>m&&(m=ue),_+=1;if(_>2e4)break}if(!_)return n;const o=Math.max(1e-9,u-i),b=Math.max(1e-9,m-c),I=o*e,M=b*e,V=i-I,k=c-M,ie=u+I,se=m+M,de=[];for(const J of n.features){if(!Ch(J?.properties||{})){de.push(J);continue}const ne=JU(J?.geometry?.coordinates,4e3);if(!ne)continue;!(ne.maxX<V||ne.minX>ie||ne.maxY<k||ne.minY>se)&&de.push(J)}return de.length===n.features.length?n:{...n,features:de}}function eV(n,e={}){if(!n?.features?.length||n.__mfAutoDrawingAlign)return n;const t=n.features.filter(de=>Ch(de?.properties||{})),i=n.features.filter(de=>!Ch(de?.properties||{}));if(!t.length||!i.length)return n;const c=(de,J=2e4)=>{let ne=1/0,me=1/0,ue=-1/0,ke=-1/0,ze=0;for(const pe of de){const U=Dd(pe?.geometry,Math.max(0,J-ze));ze+=U.length;for(const[F,q]of U)F<ne&&(ne=F),q<me&&(me=q),F>ue&&(ue=F),q>ke&&(ke=q);if(ze>=J)break}return!Number.isFinite(ne)||!Number.isFinite(me)||!Number.isFinite(ue)||!Number.isFinite(ke)?null:{minX:ne,minY:me,maxX:ue,maxY:ke,spanX:ue-ne,spanY:ke-me,cx:(ne+ue)/2,cy:(me+ke)/2}},u=c(i),m=c(t);if(!u||!m||!(m.maxX<u.minX||m.minX>u.maxX||m.maxY<u.minY||m.minY>u.maxY))return n;const o=u.spanX>0?m.spanX/u.spanX:0,b=u.spanY>0?m.spanY/u.spanY:0;if(o<.5||o>2||b<.5||b>2)return n;const I=iq(e.buildingLabel,e.floorId);let M=n.features;if(I){const de=[m.cx,m.cy];M=M.map(J=>!Ch(J?.properties||{})||!J?.geometry?J:{...J,geometry:{...J.geometry,coordinates:Vf(J.geometry.coordinates,ne=>Uy(ne,de,180))}})}const V=c(M.filter(de=>Ch(de?.properties||{})));if(!V)return n;const k=u.cx-V.cx,ie=u.cy-V.cy;if(!Number.isFinite(k)||!Number.isFinite(ie))return n;const se={...n,features:M.map(de=>!Ch(de?.properties||{})||!de?.geometry?de:{...de,geometry:{...de.geometry,coordinates:Vf(de.geometry.coordinates,([J,ne])=>[J+k,ne+ie])}})};return se.__mfAutoDrawingAlign=!0,se}function t5({map:n,fc:e,isDrawing:t,screenPoint:i,maxPixels:c,maxPoints:u}){if(!n||!e?.features?.length||!i)return null;const m=Number.isFinite(c)?c:null,_=Number.isFinite(u)?u:8e3;let o=null,b=1/0,I=0;for(const M of e.features){const V=M?.properties||{},k=Ch(V),ie=M?.geometry?.type||"",de=k||(ie==="LineString"||ie==="MultiLineString");if((t?!de:de)||!M?.geometry)continue;const J=Dd(M.geometry,Math.max(0,_-I));I+=J.length;for(const[ne,me]of J){const ue=n.project({lng:ne,lat:me}),ke=ue.x-i.x,ze=ue.y-i.y,pe=ke*ke+ze*ze;pe<b&&(b=pe,o=[ne,me])}if(I>=_)break}return o&&(m==null||b<=m*m)?o:null}function tV(n){if(!n||!Array.isArray(n.features)||n.features.length===0)return n;const e=n.features.filter(t=>!Ch(t?.properties||{}));return e.length===0||e.length===n.features.length?n:{...n,features:e,__mfFitCandidate:!0}}const zA=[{key:"roomA",label:"Click room point A (rooms layer)"},{key:"roomB",label:"Click room point B (rooms layer)"},{key:"drawingA",label:"Click drawing point A (linework)"},{key:"drawingB",label:"Click drawing point B (linework)"}],nV=40,rV=140,n5=12e3,K8=CU?"/StakeholderMap/":"/",nf=n=>`${K8}${n}`.replace(/\/{2,}/g,"/"),sv=nf("floorplans/manifest.json"),iw="Hastings",iV=!1,d0=["==",["get","Element"],"Room"];async function g_(n){try{const e=await fetch(n,{cache:"no-store"});if(!e.ok)return null;const t=(e.headers.get("content-type")||"").toLowerCase(),i=await e.text();if(t.includes("text/html"))return null;const c=i.replace(/^\uFEFF/,"");try{return JSON.parse(c)}catch{return null}}catch{return null}}async function X8(n){if(!n)return null;try{const e=await fetch(n,{cache:"no-store"});if(!e.ok)return null;const t=(e.headers.get("content-type")||"").toLowerCase(),i=await e.text();if(t.includes("text/html"))return null;try{const c=i.replace(/^\uFEFF/,"");return JSON.parse(c)}catch{return null}}catch{return null}}function D3(n){return n?n.type==="FeatureCollection"&&Array.isArray(n.features)?n:Array.isArray(n.features)?{type:"FeatureCollection",features:n.features}:n.type==="Feature"?{type:"FeatureCollection",features:[n]}:null:null}function av(n,e){if(!n||!e||n.__mfAffineApplied||EV(n))return n;const t=J8(n,e);return t&&typeof t=="object"&&(t.__mfAffineApplied=!0,t.__mfAffineSignature=V8(e)),t}function Z8(n,e,t){if(!n||!Number.isFinite(e)||Math.abs(e)<1e-6||n.__mfRotationOverride===e)return n;try{const i=Array.isArray(t)&&t.length>=2?t:t?.geometry?.coordinates||Ol(n)?.geometry?.coordinates||null,c=Hh(n,e,i?{pivot:i}:void 0);if(c&&typeof c=="object")return c.__mfRotationOverride=e,i&&(c.__mfRotationPivot=i),n.__mfFitTransform&&(c.__mfFitTransform=n.__mfFitTransform),n.__mfFitted&&(c.__mfFitted=n.__mfFitted),n.__mfFittedBuilding&&(c.__mfFittedBuilding=n.__mfFittedBuilding),n.__mfAffineApplied&&(c.__mfAffineApplied=n.__mfAffineApplied),c}catch{}return n}function r5(n){if(!n)return null;const e=String(n).split("?")[0],t=e.lastIndexOf("/Rooms/");if(t>=0)return e.slice(0,t);const i=e.lastIndexOf("/");return i>0?e.slice(0,i):null}function F3(n,e){if(!n||!Array.isArray(e)||e.length<2)return n;const t=Number(e[0]),i=Number(e[1]);let c=n;if(Number.isFinite(t)&&Math.abs(t)>1e-6){const u=Math.abs(t)/1e3,m=t>=0?90:270;c=tg(c,u,m,{units:"kilometers"})}if(Number.isFinite(i)&&Math.abs(i)>1e-6){const u=Math.abs(i)/1e3,m=i>=0?0:180;c=tg(c,u,m,{units:"kilometers"})}return c}function ow(n,e){if(!n||!Array.isArray(e)||e.length<2)return n;const t=Number(e[0]),i=Number(e[1]);if(!Number.isFinite(t)&&!Number.isFinite(i))return n;const c=u=>[u[0]+(Number.isFinite(t)?t:0),u[1]+(Number.isFinite(i)?i:0)];return{...n,features:(n.features||[]).map(u=>({...u,geometry:u.geometry?{...u.geometry,coordinates:Vf(u.geometry.coordinates,c)}:u.geometry}))}}function Y8(n,e){if(!n||!e||n.__mfFitTransformApplied)return n;let t=n;try{const{rotationDeg:i,rotationPivot:c,scale:u,scaleOrigin:m,translateKm:_,translateBearing:o,nudgeMeters:b,refineRotationDeg:I,refineRotationPivot:M}=e;Number.isFinite(i)&&Math.abs(i)>1e-6&&Array.isArray(c)&&(t=Hh(t,i,{pivot:c})),Number.isFinite(u)&&u>0&&Math.abs(u-1)>1e-6&&Array.isArray(m)&&(t=fg(t,u,{origin:m})),Number.isFinite(_)&&Number.isFinite(o)&&Math.abs(_)>1e-9&&(t=tg(t,_,o,{units:"kilometers"})),Array.isArray(b)&&(t=F3(t,b)),Number.isFinite(I)&&Math.abs(I)>1e-6&&Array.isArray(M)&&(t=Hh(t,I,{pivot:M}))}catch{}return t&&typeof t=="object"&&(t.__mfFitTransformApplied=!0),t}function lv(n,e){if(!n||!e)return null;try{const t=n.getSource("buildings");let c=(t?._data||t?.serialize?.().data||null)?.features||[];if(!c.length&&typeof n.querySourceFeatures=="function")try{c=n.querySourceFeatures("buildings")||[]}catch{}return Rf(c,e)}catch{return null}}function oV(n,e){if(!n||!Number.isFinite(e)||Math.abs(e)<1e-6||!Array.isArray(n.features)||!n.features.length)return n;const t=Math.PI/180,i=-e*t,c=Math.cos(i),u=Math.sin(i),m=o=>{const b=o*t,I=Math.sin(b),M=Math.cos(b),V=I*c-M*u,k=I*u+M*c;return(Math.atan2(V,k)/t+360)%360};return{...n,features:n.features.map(o=>{const b=o?.properties||{},I=Number(b.bearing_deg);if(!Number.isFinite(I))return o;const M=m(I);return{...o,properties:{...b,bearing_deg:M}}})}}function sV(n,e,t,i={}){if(!n)return n;const c=i.adjustBearings&&Number.isFinite(i.bearingRotationDeg)&&Math.abs(i.bearingRotationDeg)>1e-6;if(!e&&!t&&!c||n.__mfOverlayTransformApplied)return n;let u=n;if(e?.deg!=null&&(u=Z8(u,e.deg,e.pivot)),t&&(u=Y8(u,t)),i.adjustBearings){const m=(Number.isFinite(i.bearingRotationDeg)?i.bearingRotationDeg:0)+(Number.isFinite(e?.deg)?e.deg:0)+(Number.isFinite(t?.rotationDeg)?t.rotationDeg:0)+(Number.isFinite(t?.refineRotationDeg)?t.refineRotationDeg:0);u=oV(u,m)}return u&&typeof u=="object"&&(u.__mfOverlayTransformApplied=!0),u}const aV=new Set(["calvin_french_chapel/basement","kiewit/level_2"]);async function a0(n,e){if(!n||!e)return null;const t=Yc(Nd(n)||""),i=Ra(e),u=aV.has(`${t}/${i}`)?[`${n}/${e}_Dept.affine.json`,`${n}/affine.json`]:[`${n}/affine.json`],m=Array.from(new Set([...u,...u.map(_=>{try{return encodeURI(_)}catch{return _}})]));for(const _ of m){const o=await X8(_);if(o)return o}return null}async function lV(n){for(const e of(n||[]).filter(Boolean)){const t=await X8(e);if(t)return{url:e,data:t}}return{url:n?.[0]||"",data:null}}async function cV({basePath:n,floorId:e,skipAffine:t=!1}){const i=[`${n}/Rooms/${e}_Dept_Rooms.geojson`,`${n}/Rooms/${e}_Dept.geojson`,`${n}/${e}_Dept_Rooms.geojson`,`${n}/${e}_Dept.geojson`],[{data:c},u]=await Promise.all([lV(i),t?Promise.resolve(null):a0(n,e)]),m=D3(c);if(!m)return{rawFC:null,patchedFC:null,affine:null};m.features=(m.features||[]).map(o=>{const b=o?.properties||{},I=M3(b),M=j8(b);return{...o,properties:{...b,__roomType:I||"",__dept:M||"",__areaSf:U8(b)}}});const _=av(m,u);return{rawFC:m,patchedFC:_,affine:u}}function uV(n,e){function t(i){if(!i)return i;if(typeof i[0]=="number"){const c=i[0],u=i[1];return[e.a*c+e.b*u+e.c,e.d*c+e.e*u+e.f]}return i.map(t)}return{...n,features:n.features.map(i=>({...i,geometry:i.geometry?{...i.geometry,coordinates:t(i.geometry.coordinates)}:i.geometry}))}}function J8(n,e){if(!n||!e)return n;const t=e.anchor_feet||e.anchorFeet||e.anchor;if(!Array.isArray(t)||t.length<2)return n;const i=Number(e.target_lon??e.targetLon),c=Number(e.target_lat??e.targetLat);if(!Number.isFinite(i)||!Number.isFinite(c))return n;const u=Number(e.rotation_deg_cw??e.rotation_deg??0),m=e.effective_scale_deg_per_foot!=null,_=Number(m?e.effective_scale_deg_per_foot:e.scale_deg_per_foot??e.scale_deg_per_ft??e.scale);if(!Number.isFinite(_)||_===0)return n;const o=Number(e.scale_percent??100),b=m?_:_*(Number.isFinite(o)?o/100:1),I=c*Math.PI/180,M=Math.max(1e-9,Math.cos(I)),V=b/M,k=u*Math.PI/180,ie=Math.cos(k),se=Math.sin(k),[de,J]=t,ne=V*ie,me=-V*se,ue=i-(ne*de+me*J),ke=b*se,ze=b*ie,pe=c-(ke*de+ze*J);return uV(n,{a:ne,b:me,c:ue,d:ke,e:ze,f:pe})}async function Q8(n){for(const e of(n||[]).filter(Boolean))try{const t=await fetch(e,{cache:"no-store"}),i=(t.headers.get("content-type")||"").toLowerCase(),c=await t.text();if(!t.ok||i.includes("text/html"))continue;try{const u=c.replace(/^\uFEFF/,""),m=JSON.parse(u);return{ok:!0,url:e,data:m}}catch{continue}}catch{continue}return{ok:!1,url:n?.[0]||"",error:"No valid JSON response from any candidate URL."}}async function hV({basePath:n,floorId:e,map:t,roomsFC:i,affine:c,rotationOverride:u,fitTransform:m}){if(!n||!e||!t)return;const _=String(e).trim(),o=[`${n}/${_}_-_Map_Export_Walls_RAW.geojson`,`${n}/${_}_Walls_RAW.geojson`,`${n}/${_}_-_Map_Export_Walls.geojson`,`${n}/${_}_Walls.geojson`],b=await hd(o);let I=D3(b);if(!I?.features?.length)return;console.log("[walls] loaded features",I.features.length);function M(se,de=20){let J=0;const ne=me=>{if(!me||J>=de)return!0;if(typeof me[0]=="number"&&typeof me[1]=="number"){const ue=me[0],ke=me[1];return J+=1,Math.abs(ue)<=180&&Math.abs(ke)<=90}for(const ue of me)if(!ne(ue))return!1;return!0};for(const me of se?.features||[]){if(!ne(me?.geometry?.coordinates))return!1;if(J>=de)break}return J>0}c&&!M(I)?(I=J8(I,c),console.log("[walls] applied affine")):c&&console.log("[walls] skipped affine (already lon/lat)"),I=sV(I,u,m,{adjustBearings:!1});const k="walls-source",ie="walls-layer";t.getSource(k)?t.getSource(k).setData(I):t.addSource(k,{type:"geojson",data:I});try{const se=Cu(I);console.log("[walls] bbox",se)}catch{console.log("[walls] first coord",I.features?.[0]?.geometry?.coordinates?.[0]?.[0])}if(!t.getLayer(ie)){const se=t.getLayer(Do)?Do:void 0;t.addLayer({id:ie,type:"line",source:k,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#000","line-width":["interpolate",["linear"],["zoom"],16,.15,18,.25,20,.45],"line-opacity":.25}},se)}}async function dV({basePath:n,floorId:e,map:t,affine:i,rotationOverride:c,fitTransform:u,roomsFC:m,buildingLabel:_}){}function jA(n,e){if(!e||!Array.isArray(n)||n.length<2)return n;const t=Number(e.target_lon??e.targetLon),i=Number(e.target_lat??e.targetLat),c=Number(e.rotation_deg_cw??e.rotation_deg??0),u=Number(e.effective_scale_deg_per_foot??e.scale_deg_per_foot??e.scale_deg_per_ft??e.scale),m=e.anchor_feet||e.anchorFeet||e.anchor;if(!Number.isFinite(t)||!Number.isFinite(i)||!Number.isFinite(u)||!Array.isArray(m))return n;const _=u,o=_/Math.max(1e-9,Math.cos(i*Math.PI/180)),[b,I]=n,M=(b-t)/o,V=(I-i)/_,k=c*Math.PI/180,ie=Math.cos(k),se=Math.sin(k),[de,J]=m;return[ie*M+se*V+de,-se*M+ie*V+J]}function Uy(n,e,t){if(!Array.isArray(n)||n.length<2)return n;const[i,c]=n,[u,m]=e||[0,0],_=t*Math.PI/180,o=Math.cos(_),b=Math.sin(_),I=i-u,M=c-m;return[u+o*I-b*M,m+b*I+o*M]}function Vf(n,e){return n&&(typeof n[0]=="number"?e(n):n.map(t=>Vf(t,e)))}function $m(n){let e=1/0,t=1/0,i=-1/0,c=-1/0;return n.forEach(([u,m])=>{!Number.isFinite(u)||!Number.isFinite(m)||(u<e&&(e=u),m<t&&(t=m),u>i&&(i=u),m>c&&(c=m))}),{minx:e,miny:t,maxx:i,maxy:c,spanX:i-e,spanY:c-t,cx:(e+i)/2,cy:(t+c)/2}}function fV({buildingLabel:n,floorId:e,floorBasePath:t}={}){if(Ra(e||"")!=="basement")return!1;if(t&&String(t).includes("/Calvin French Chapel/"))return!0;const c=Xr(n);return c&&[Xr("Calvin French Chapel"),Xr("Calvin H. French Chapel"),Xr("Calvin H. French Memorial Chapel")].includes(c)}function UA({buildingLabel:n,floorId:e,floorBasePath:t}={}){if(Ra(e||"")!=="level_3")return!1;if(t&&(()=>{try{return decodeURIComponent(String(t))}catch{return String(t)}})().includes("/Babcock Hall/"))return!0;const c=Xr(n);return c&&[Xr("Babcock Hall"),Xr("Babcock Hall Residence")].includes(c)}function VA(n){let e=0,t=0,i=0;const c=u=>{if(Array.isArray(u)){if(u.length>=2&&typeof u[0]=="number"&&typeof u[1]=="number"){e+=u[0],t+=u[1],i+=1;return}u.forEach(c)}};return(n||[]).forEach(u=>{u?.geometry?.coordinates&&c(u.geometry.coordinates)}),i?[e/i,t/i]:null}function qA(n,e,t){if(!n?.features?.length||n.__mfBabcockL3AutoRotated)return n;const i=90*Math.PI/180,c=Math.cos(i),u=Math.sin(i),m=o=>{const b=o[0],I=o[1];return[b*c-I*u,b*u+I*c]},_=n.features.map(o=>!Ch(o?.properties||{})||!o?.geometry?o:{...o,geometry:{...o.geometry,coordinates:Vf(o.geometry.coordinates,m)}});return{...n,features:_,__mfBabcockL3AutoRotated:!0}}function pV(n,e,t){if(!n?.features?.length||n.__mfBasementFixed)return n;const i=n.features.filter(xe=>Ch(xe?.properties||{})),c=n.features.filter(xe=>!Ch(xe?.properties||{}));if(i.length&&c.length){const xe={type:"FeatureCollection",features:i},le={type:"FeatureCollection",features:c},Ne=um(xe,1200)||xe,Be=um(le,1200)||le,Qe=l0(Ne,2e3),rt=l0(Be,2e3),gt=$m(Qe),pt=$m(rt),Mt=VA(i)||(gt?[gt.cx,gt.cy]:null),Jt=VA(c)||(pt?[pt.cx,pt.cy]:null);if(gt&&pt&&Mt&&Jt){const hn=Math.max(pt.spanX||0,pt.spanY||0,1e-9);if(Math.hypot(Mt[0]-Jt[0],Mt[1]-Jt[1])>hn*.18){const Gt=f0(Ne?.geometry)??0,ot=f0(Be?.geometry)??0,dr=hv(ot-Gt),wr=gt.spanX?pt.spanX/gt.spanX:1,Cr=gt.spanY?pt.spanY/gt.spanY:1;let Ln=1;Number.isFinite(wr)&&Number.isFinite(Cr)&&wr>0&&Cr>0&&(Ln=Math.min(wr,Cr)),Ln=Math.max(.2,Math.min(5,Ln||1));const ir=dr*Math.PI/180,Qn=Math.cos(ir),Kr=Math.sin(ir),[qt,Pn]=Mt,[Hn,Bn]=Jt,Rr=Ir=>{const Pr=Ir[0]-qt,Si=Ir[1]-Pn,ki=(Pr*Qn-Si*Kr)*Ln,or=(Pr*Kr+Si*Qn)*Ln;return[Hn+ki,Bn+or]},vr=n.features.map(Ir=>!Ch(Ir?.properties||{})||!Ir?.geometry?Ir:{...Ir,geometry:{...Ir.geometry,coordinates:Vf(Ir.geometry.coordinates,Rr)}}),Tr={...n,features:vr};return Tr.__mfBasementFixed=!0,Tr}}}if(!e||!t)return n;const u=n.features.map((xe,le)=>{const Ne=xe?.geometry?.coordinates;if(!Ne)return null;const Be=Dd({coordinates:Ne},1e3);if(!Be.length)return null;const Qe=Be.reduce((gt,pt)=>gt+pt[0],0)/Be.length,rt=Be.reduce((gt,pt)=>gt+pt[1],0)/Be.length;return{i:le,c:[Qe,rt]}}).filter(Boolean);if(u.length<6)return n;const m=u.map(xe=>xe.c[0]).sort((xe,le)=>xe-le),_=m[Math.floor(m.length/2)],o=new Set(u.filter(xe=>xe.c[0]<=_).map(xe=>xe.i));if(!o.size||o.size===n.features.length)return n;const b={type:"FeatureCollection",features:n.features.filter((xe,le)=>o.has(le))},I=um(b,1200),M=f0(t?.geometry)??0,V=f0(I?.geometry)??0,k=Number.isFinite(M)&&Number.isFinite(V)?M-V:0,ie=Ol(t)?.geometry?.coordinates||null;if(!ie)return n;const se=xe=>Uy(xe,ie,-M),de=xe=>Uy(xe,ie,M),J={type:"Feature",properties:{},geometry:{...t.geometry,coordinates:Vf(t.geometry.coordinates,se)}},ne=l0(J,4e3),me=$m(ne);if(!Number.isFinite(me.cx))return n;const ue=me.cx,ke=S3([[[ue-10,me.miny-10],[ue,me.miny-10],[ue,me.maxy+10],[ue-10,me.maxy+10],[ue-10,me.miny-10]]]),ze=P8(E3([J,ke]));if(!ze?.geometry)return n;const pe={type:"Feature",geometry:{...ze.geometry,coordinates:Vf(ze.geometry.coordinates,de)}},U=l0(pe,4e3),F=$m(U);if(!Number.isFinite(F.minx))return n;const q=$m([jA([F.minx,F.miny],e),jA([F.maxx,F.maxy],e)]),j=l0(b,4e3),H=$m(j),Z=[H.cx,H.cy],be=j.map(xe=>Uy(xe,Z,k)),Re=$m(be);if(!Number.isFinite(Re.spanX)||!Number.isFinite(Re.spanY))return n;const Oe=Math.min(q.spanX/Math.max(1e-9,Re.spanX),q.spanY/Math.max(1e-9,Re.spanY)),Me=[q.cx-Re.cx,q.cy-Re.cy],we=xe=>{const le=Uy(xe,Z,k),Ne=[(le[0]-Re.cx)*Oe+Re.cx,(le[1]-Re.cy)*Oe+Re.cy];return[Ne[0]+Me[0],Ne[1]+Me[1]]},De=n.features.map((xe,le)=>!o.has(le)||!xe?.geometry?.coordinates?xe:{...xe,geometry:{...xe.geometry,coordinates:Vf(xe.geometry.coordinates,we)}}),tt={...n,features:De};return tt.__mfBasementFixed=!0,tt}async function mV({basePath:n,floorId:e,map:t,affine:i,rotationOverride:c,fitTransform:u}){}let i5=0;function eC(n){if(!n||/^https?:\/\//i.test(n))return n;const e=N8();if(!e)return n;const t=e.replace(/\/$/,""),i=n.startsWith("/")?n:`/${n}`,c=i.startsWith("/ai/")?i.replace(/^\/ai/,""):i;return`${t}${c}`}async function Jd(n,e={}){const t=Date.now();if(t<i5)throw new Error(`Rate limited. Try again in ${Math.ceil((i5-t)/1e3)}s`);const i=Number(e.timeoutMs),c=Number.isFinite(i)&&i>0?new AbortController:null,u={...e};c&&(u.signal=c.signal),delete u.timeoutMs;let m=null;c&&(m=setTimeout(()=>c.abort(),i));let _;try{_=await fetch(eC(n),u)}finally{m&&clearTimeout(m)}if(_.status===429)throw i5=Date.now()+6e4,new Error("Rate limited (429). AI paused for 60 seconds.");return _}async function $A(n,e=iw){if(!n)return[];const t=k=>String(k||"").trim().toLowerCase().replace(/[^a-z0-9]/g,""),i=(k=[])=>{const ie=Array.isArray(k)?k:k?[k]:[];return ie.length?ie.map(se=>{if(typeof se=="string")return{id:se,url:null};if(!se)return null;const de=h0(se.id||se.floorId||se.name||se.label),J=se.url||se.path||null;return de?{id:de,url:J}:null}).filter(Boolean):[]},c=encodeURIComponent(e),u=encodeURIComponent(n),m=nf(`floorplans/${c}/${u}/manifest.json`),_=await g_(m),b=(await g_(sv))?.floorsByBuilding||{};let I=b[n];if(!I){const k=Object.keys(b).find(ie=>t(ie)===t(n));I=k?b[k]:null}const M=i(I||[]),V=i(_?.floors);if(!V.length)return M;if(M.length&&V.some(k=>!k.url)){const k=new Map(M.filter(ie=>ie?.id&&ie?.url).map(ie=>[ie.id,ie.url]));return V.map(ie=>({...ie,url:ie.url||k.get(ie.id)||null}))}return V}const gV=()=>{if(typeof window>"u")return"";const n=String(window.__MAPBOX_PUBLIC_TOKEN__??"").trim();if(n)return n;try{const e=String(window.localStorage?.getItem("MAPBOX_PUBLIC_TOKEN")??"").trim();if(e)return e}catch{}return""};Rd.accessToken=gV();console.log("Mapbox token length:",(Rd.accessToken||"").length);const pa="floor-source",Do="floor-fill",Wh="floor-line",jv="floor-sentiment-gradient-source",tC="floor-sentiment-light",nC="floor-sentiment-mid",rC="floor-sentiment-shade",iC="floor-sentiment-core",oC="floor-sentiment-core-2",sC="floor-sentiment-core-3",aC="floor-sentiment-core-4",lC="floor-sentiment-core-5",cC="floor-sentiment-core-6",uC="floor-sentiment-core-7",cv=[tC,nC,rC,iC,oC,sC,aC,lC,cC,uC],Sp="floor-drawing",qf="floor-highlight",pg="floor-highlight-border",Xc="floor-room-labels",Uv="floor-doors",Vv="floor-stairs",Gm="engagement-heat-source",Qd="engagement-heat-warm-halo-layer",ef="engagement-heat-cool-halo-layer",qv="walls-source",M0="walls-layer",GA="doors-source",HA="stairs-source",$v="doors-layer",Gv="stairs-layer",ms=new Map,Hu=new Map,o5=new Map,yV=n=>n?/^https?:\/\//i.test(n)||n.startsWith(K8)?n:nf(String(n).replace(/^\//,"")):null;async function _V(n){const e=yV(n);if(!e)return[];if(o5.has(e))return o5.get(e);const t=await g_(e),i=Array.isArray(t?.features)?t.features:[];return o5.set(e,i),i}async function vV(n,e,t){const i=[],c=[...n],u=Math.max(1,Number(e)||1),m=Array.from({length:u},async()=>{for(;c.length;){const _=c.shift();try{i.push(await t(_))}catch(o){console.warn("dashboard fetch failed",_,o)}}});return await Promise.all(m),i}function WA(n){if(!n)return;const e="buildings-fill";if(n.getLayer(e))try{n.setPaintProperty(e,"fill-color",ud("#ffffff")),n.setPaintProperty(e,"fill-opacity",1),n.setPaintProperty(e,"fill-outline-color","#cbd5e1")}catch{}}const xV={"fill-color":"#e6e6e6","fill-opacity":1};function sw(n,e="department",t={}){if(!n||!n.getLayer(Do))return;const i=[">",["length",["coalesce",["to-string",["get","occupant"]],["to-string",["get","Occupant"]],""]],0],u=["upcase",["to-string",["coalesce",["get","occupancyStatus"],["get","Occupancy Status"],["get","OccupancyStatus"],["get","Occupancy"],["get","Vacancy"],["get","vacancy"],["get","Vacant"],""]]],_=["in",["upcase",["to-string",["coalesce",["get","__roomType"],["get","NCES_Type"],["get","RoomType"],["get","Room Type"],["get","Type"],["get","type"],["get","Name"],""]]],["literal",cq]],M=["case",[">",["length",u],0],["case",["any",[">=",["index-of","VACANT",u],0],[">=",["index-of","UNOCCUPIED",u],0],[">=",["index-of","AVAILABLE",u],0],[">=",["index-of","UNASSIGNED",u],0]],"Vacant",[">=",["index-of","OCCUPIED",u],0],"Occupied","Unknown"],i,"Occupied","Unknown"],V=["case",_,["match",M,"Occupied","#29b6f6","Vacant","#ff7043","Unknown","#e0e0e0","#e0e0e0"],"#e6e6e6"],k=["case",_,["match",M,"Vacant","#ff7043","Occupied","#cfd8dc","Unknown","#cfd8dc","#cfd8dc"],"#e6e6e6"];try{e==="occupancy"?n.setPaintProperty(Do,"fill-color",V):e==="vacancy"?n.setPaintProperty(Do,"fill-color",k):n.setPaintProperty(Do,"fill-color",PU()),n.setPaintProperty(Do,"fill-opacity",1)}catch{}}function bV(n){if(!(!n||n.getLayer(qf)))try{n.addLayer({id:qf,type:"fill",source:pa,paint:{"fill-color":"rgba(0,255,255,0.4)","fill-outline-color":"#00ffff"},filter:["==",["id"],-1]},Do),n.addLayer({id:pg,type:"line",source:pa,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#00ffff","line-width":6,"line-opacity":1,"line-gap-width":0},filter:["==",["id"],-1]})}catch{}}function wV(n,e,t){!n||!e||!t||(n.getSource(e)?n.getSource(e).setData(t):n.addSource(e,{type:"geojson",data:t}))}async function KA(n,e,t){if(!n||!e||!t)return;try{if(n.hasImage(e))return}catch{}const i=await new Promise((c,u)=>{n.loadImage(t,(m,_)=>m?u(m):c(_))});try{n.addImage(e,i,{sdf:!0})}catch(c){console.warn("addImage failed for",e,c)}}function SV(n){if(n)try{n.getLayer(M0)&&n.getLayer(Do)&&n.moveLayer(M0,Do),n.getLayer(Wh)&&n.getLayer(Do)&&n.moveLayer(Wh),n.getLayer(Sp)&&(n.getLayer(Xc)?n.moveLayer(Sp,Xc):n.moveLayer(Sp)),n.getLayer($v)&&n.moveLayer($v),n.getLayer(Gv)&&n.moveLayer(Gv),n.getLayer(Xc)&&n.moveLayer(Xc)}catch{}}function XA(n=[],e=[]){const t=[];return n.length&&t.push(["in",["id"],["literal",n]]),e.length&&t.push(["in",["get","RevitId"],["literal",e]]),t.length?t.length===1?t[0]:["any",...t]:["==",["id"],""]}async function hd(n){const e=Array.isArray(n)?n.filter(Boolean):[n].filter(Boolean);if(!e.length)return null;const t=await Q8(e);return t.ok?t.data:(console.debug("GeoJSON fetch failed",{tried:e,lastUrl:t.url,error:t.error}),null)}function EV(n){try{if(!n?.features?.length)return!1;const e=Cu(n);if(!e||e.some(o=>!Number.isFinite(o)))return!1;const[t,i,c,u]=e;if(t<-180||c>180||i<-90||u>90)return!1;const m=Math.abs(c-t),_=Math.abs(u-i);return m<=.25&&_<=.25}catch{return!1}}async function AV(n,e,t,i,c={}){if(!n||!e)return;const{buildingId:u,floor:m,roomPatches:_,onOptionsCollected:o,currentFloorContextRef:b,airtableLookup:I}=c,M=c?.roomsBasePath||c?.wallsBasePath,V=c?.roomsFloorId||c?.wallsFloorId||m||null;let k=i?.fitBuilding||null;if(!k&&u&&(k=lv(n,u)),!k&&M){const qt=Nd(M);qt&&(k=lv(n,qt))}if(!k&&M){const qt=await c5();if(qt?.features?.length){const Pn=Nd(M),Hn=p0?.[Pn]||Pn;k=Rf(qt.features,u)||Rf(qt.features,Hn)||Rf(qt.features,Pn)||null}}if(!k&&M){const qt=Nd(M),Pn=p0?.[qt]||qt,Bn=Xr(u||Pn);Bn&&cw.has(Bn)&&(k=lv(n,Pn))}let ie=n_(k);const se=k?.properties?.id||k?.properties?.name||u||"",de=Bv({buildingLabel:se,buildingId:u,floorBasePath:M,fitBuilding:k}),J=XU({buildingLabel:se,buildingId:u,floorBasePath:M,fitBuilding:k}),ne=zV({buildingLabel:se}),me=rq(se||u||"",V||m||"")||0,ue=M&&V?jy(M,V):null,ke=zy(e),ze=Ym(J,V||m),U=rw({base:ue,url:ke,label:ze}).adjust,F=me;let q=null,j=null,H=ms.get(e);const Z=W8(de,V||m),be=H8(Z);if(H&&oq(se||u||"",V||m||"")&&(ms.delete(e),Hu.delete(e),H=null),H&&ie&&(H.__mfTransformed||H.__mfFitted||H.__mfFitTransform)&&(ms.delete(e),H=null),H&&Number.isFinite(F)&&H.__mfPostRotation!==F&&(ms.delete(e),Hu.delete(e),H=null),H&&M&&V&&!ne){const qt=await a0(M,V),Pn=V8(qt);Pn&&H.__mfAffineSignature&&H.__mfAffineSignature!==Pn||Pn&&H.__mfAffineApplied&&!H.__mfAffineSignature?(ms.delete(e),Hu.delete(e),H=null):q=qt}if(H&&!q&&!ne&&V){const qt=r5(e);qt&&(q=await a0(qt,V))}if(H&&(H.__mfDrawingAlignSignature||be)&&H.__mfDrawingAlignSignature!==be&&(ms.delete(e),Hu.delete(e),H=null),H){const qt=zv(U);(qt&&H.__mfUserAdjustSignature&&H.__mfUserAdjustSignature!==qt||qt&&H.__mfTransformed&&!H.__mfUserAdjustSignature)&&(ms.delete(e),Hu.delete(e),H=null)}if(!H){if(M&&V){const qt=await cV({basePath:M,floorId:V,skipAffine:ne});if(!qt.rawFC){console.warn("Floor summary: no data returned",`${M}/${V}_Dept.geojson`);return}if(H=qt.rawFC,q=qt.affine,!ne&&!q){const Pn=r5(e);Pn&&(q=await a0(Pn,V))}if(ne&&(q=null),fV({buildingLabel:u,floorId:V,floorBasePath:M})){const Pn=pV(qt.rawFC,q,k);j=av(Pn,q)}else if(UA({buildingLabel:u,floorId:V,floorBasePath:M})){const Pn=qA(qt.rawFC);j=av(Pn,q)}else j=qt.patchedFC}else if(H=await hd(e),!H)return;ms.set(e,H)}if(!j){if(j=D3(H)||Au(H),!j?.features?.length)return;if(!ne&&!q&&V&&(M&&(q=await a0(M,V)),!q)){const qt=r5(e);qt&&(q=await a0(qt,V))}UA({buildingLabel:u,floorId:V,floorBasePath:M})&&(j=qA(j)),j=av(j,q)}Z&&(j=KU(j,Z)),j=eV(j,{buildingLabel:se||u||"",floorId:V||m||""}),j=QU(j),j=UU(j);const Re=se||k?.properties?.id||k?.properties?.name||u||"";if(aq(Re,V||m||"")&&(j.__mfNoFit=!0),!k&&M){const qt=await c5();if(qt?.features?.length){const Pn=Nd(M),Hn=p0?.[Pn]||Pn;k=Rf(qt.features,u)||Rf(qt.features,Hn)||Rf(qt.features,Pn)||null,ie=n_(k)}}if(!k&&M){const qt=Nd(M),Pn=p0?.[qt]||qt,Bn=Xr(u||Pn);if(Bn&&cw.has(Bn)){const Rr=await c5();Rr?.features?.length&&(k=Rf(Rr.features,Pn)||Rf(Rr.features,qt)||null,ie=n_(k))}}const Me=Number.isFinite(i?.rotationOverrideDeg)?i.rotationOverrideDeg:null,we=Hu.get(e)||{};ie&&delete we.fitTransform;let De=null;if(Me!=null){const qt=we.rotationPivot||Ol(j)?.geometry?.coordinates||null;De=qt?{deg:Me,pivot:qt}:{deg:Me},!we.rotationPivot&&qt&&(we.rotationPivot=qt,Hu.set(e,we));const Pn=Z8(j,Me,qt);Pn&&Pn!==j&&(j=Pn,ie||ms.set(e,j))}j.features.forEach((qt,Pn)=>{qt&&qt.id==null&&(qt.id=qt.properties?.RevitId??Pn)});const tt=[],xe=[],le=[],Ne=[];j.features.forEach(qt=>{if(!qt)return;const Pn=qt.id??qt.properties?.RevitId??qt.properties?.id;if(Pn==null)return;const Hn=S0(qt.properties);Hn==="door"?(tt.push(Pn),qt.properties?.RevitId!=null&&xe.push(qt.properties.RevitId)):Hn==="stair"&&(le.push(Pn),qt.properties?.RevitId!=null&&Ne.push(qt.properties.RevitId))});const Be=(qt,Pn)=>{if(!qt)return;const Hn=Pn?.features;if(!(!Array.isArray(Hn)||Hn.length===0))try{const Bn=selectedBuildingIdRef.current||selectedBuilding||i?.fitBuilding?.properties?.id,Rr=i?.floorLabel||Hn[0]?.properties?.Floor||e?.match(/(BASEMENT|LEVEL_\\d+|LEVEL|L\\d+)/)?.[0]||"LEVEL_1";if(Bn){const Tr={...floorStatsByBuildingRef.current[Bn]||{},[Rr]:qt};floorStatsByBuildingRef.current[Bn]=Tr,setFloorStatsByBuilding({...floorStatsByBuildingRef.current})}panelBuildingKeyRef.current&&panelBuildingKeyRef.current===Bn&&setPanelStats(vr=>({...vr||{},floor:qt}))}catch{}};let Qe=NA(j);Be(Qe,j);const rt=tV(j),gt=rt&&rt!==j?rt:j;let pt=j?.__mfFitTransform||we.fitTransform||null;try{if(k&&GV(gt,k)){const qt=NV(gt,k);if(qt?.features?.length){if(pt=qt.__mfFitTransform||null,gt!==j&&pt){const Pn=Y8(j,pt);Pn?.features?.length&&(j.__mfAffineApplied&&(Pn.__mfAffineApplied=j.__mfAffineApplied),j.__mfRotationOverride!=null&&(Pn.__mfRotationOverride=j.__mfRotationOverride),j.__mfRotationPivot&&(Pn.__mfRotationPivot=j.__mfRotationPivot),Pn.__mfFitted=!0,Pn.__mfFittedBuilding=qt.__mfFittedBuilding||"",Pn.__mfFitTransform=pt,j=Pn)}else j=qt;H.__mfTransformed=!0,ie||ms.set(e,j)}}}catch{}const Mt=nq(se||u||"",V||m||"");if(Number.isFinite(Mt)&&Math.abs(Mt-1)>.001){const qt=pt?.scaleOrigin||Ol(j)?.geometry?.coordinates||null;qt&&(j=fg(j,Mt,{origin:qt}),pt=pt||{rotationDeg:0,rotationPivot:null,scale:1,scaleOrigin:qt,translateKm:0,translateBearing:0,nudgeMeters:null,refineRotationDeg:0,refineRotationPivot:null},pt.scale=(Number.isFinite(pt.scale)?pt.scale:1)*Mt,pt.scaleOrigin=qt,H.__mfTransformed=!0,ie||ms.set(e,j))}if(Number.isFinite(F)&&Math.abs(F)>.001){const qt=pt?.scaleOrigin||pt?.rotationPivot||Ol(k||j)?.geometry?.coordinates||null;qt&&(j=Hh(j,F,{pivot:qt}),pt=pt||{rotationDeg:0,rotationPivot:null,scale:1,scaleOrigin:qt,translateKm:0,translateBearing:0,nudgeMeters:null,refineRotationDeg:0,refineRotationPivot:null},pt.refineRotationDeg=(Number.isFinite(pt.refineRotationDeg)?pt.refineRotationDeg:0)+F,pt.refineRotationPivot=qt,H.__mfTransformed=!0,H.__mfPostRotation=F,ie||ms.set(e,j))}const Jt=pt?.scaleOrigin||pt?.rotationPivot||Ol(j)?.geometry?.coordinates||null;if(U&&mp(U)){const Pn=ZU(j,U,pt);Pn?.fc&&Pn.fc!==j&&(j=Pn.fc,pt=Pn.fitTransform||pt,H.__mfTransformed=!0,ie||ms.set(e,j))}pt&&(we.fitTransform=pt,Hu.set(e,we)),j&&Array.isArray(j.features)&&b&&typeof b=="object"&&(b.current={url:e,buildingId:u,floor:m,fc:j,floorAdjustLabel:J,floorAdjustFloorId:V||m||"",floorAdjustBasePath:M||null,floorAdjustBasePivot:Jt||null});let hn=j,yn=[];const Mn=u&&m&&_ instanceof Map,Gt=!!I;if(Mn||Gt){const qt=(j.features||[]).map(Pn=>{const Hn=Pn.properties||{};let Bn=Hn;if(Gt&&S0(Hn)==="room"){const vr=EC(Hn,I,u,m);vr&&(Bn=Wv(Bn,vr))}if(Mn){const vr=Pn.id??Hn.RevitId??Hn.id,Tr=tf(u,m,vr),Ir=_.get(Tr);Ir&&(Bn=Wv(Bn,Ir))}const Rr=fd(Bn);return{...Pn,properties:{...Bn,__roomType:Rr?String(Rr).trim():Bn.__roomType||""}}});if(hn={...j,features:qt},typeof o=="function"){const{typeOptions:Pn,deptOptions:Hn}=zU(qt);o({typeOptions:Pn,deptOptions:Hn})}}b&&typeof b=="object"&&(b.current={...b.current||{},buildingId:u,floor:V||m||"",fc:hn}),Array.isArray(hn?.features)&&(yn=hn.features.map(qt=>{const Pn=qt?.properties??{},Hn=qt?.id??Pn.RevitId??Pn.id,Bn=u&&m&&Hn!=null?tf(u,m,Hn):null,Rr=_ instanceof Map&&Bn&&_.get(Bn)||null;return{geo:{...Pn},db:Rr?{...Rr}:null,roomId:Bn||String(Hn??"")}}));const ot=Array.isArray(hn?.features)&&hn.features.length?NA(hn):null;ot&&(Qe=ot),Be(Qe,hn),TC(n);const dr=$u(n,pa);if(dr?dr.setData(hn):n.addSource(pa,{type:"geojson",data:hn,promoteId:"RevitId"}),!n.getLayer(Do))n.addLayer({id:Do,type:"fill",source:pa,paint:xV,filter:d0});else try{n.setFilter(Do,d0)}catch{}if(sw(n),bV(n),!sq(se||u||"",V||m||"")&&Array.isArray(hn?.features)&&hn.features.some(qt=>qt?.properties?.interactive===!1||qt?.properties?.type==="drawing")){const qt=["downcase",["to-string",["coalesce",["get","Layer"],["get","layer"],["get","FeatureClass"],["get","featureClass"],["get","type"],["get","Type"]]]],Hn=["all",["==",["get","interactive"],!1],["!",["any",[">=",["index-of","grid",qt],0],[">=",["index-of","area-bndy",qt],0],[">=",["index-of","area bndy",qt],0]]]];if(!n.getLayer(Sp))n.addLayer({id:Sp,type:"line",source:pa,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#2f2f2f","line-width":["interpolate",["linear"],["zoom"],16,.15,18,.25,20,.45],"line-opacity":.6},filter:Hn});else try{n.setFilter(Sp,Hn)}catch{}}if(!n.getLayer(Wh))n.addLayer({id:Wh,type:"line",source:pa,paint:{"line-color":"#444","line-width":["interpolate",["linear"],["zoom"],16,.4,18,.8,20,1.2],"line-opacity":.7},filter:d0});else try{n.setFilter(Wh,d0)}catch{}if(hw(n,c?.labelMode||"department"),c?.enableWalls&&c?.wallsBasePath){const qt=c.wallsFloorId||m||e?.match(/(BASEMENT|LEVEL_\d+|LEVEL|L\d+)/)?.[0]||null;await hV({basePath:c.wallsBasePath,floorId:qt,map:n,roomsFC:hn,affine:q,rotationOverride:De,fitTransform:pt});try{n.setPaintProperty(Do,"fill-opacity",.25)}catch{}}const Ln=c?.roomsBasePath||c?.wallsBasePath,ir=u||i?.fitBuilding?.properties?.id||i?.fitBuilding?.properties?.name||null;if(Ln){const qt=c?.roomsFloorId||c?.wallsFloorId||m||e?.match(/(BASEMENT|LEVEL_\d+|LEVEL|L\d+)/)?.[0]||null;qt&&(await dV({basePath:Ln,floorId:qt,map:n,affine:q,rotationOverride:De,fitTransform:pt||we.fitTransform||null,roomsFC:hn,buildingLabel:ir}),await mV({basePath:Ln,floorId:qt,map:n,affine:q,rotationOverride:De,fitTransform:pt||we.fitTransform||null}))}SV(n);const Qn=XA(tt,xe),Kr=XA(le,Ne);try{n.getLayer(Uv)&&n.setFilter(Uv,Qn),n.getLayer(Vv)&&n.setFilter(Vv,Kr)}catch{}try{n.getLayer(qf)&&n.getLayer(Wh)&&n.moveLayer(qf,Wh)}catch{}if(t!=null&&n.getLayer(qf)){const qt=Array.isArray(t)?t.filter(Hn=>Hn!=null):[t],Pn=qt.length?["any",["in",["id"],["literal",qt]],["in",["get","RevitId"],["literal",qt]]]:["==",["id"],""];n.setFilter(qf,Pn),n.getLayer(pg)&&n.setFilter(pg,Pn)}try{const qt=Cu(j);qt&&isFinite(qt[0])&&n.fitBounds([[qt[0],qt[1]],[qt[2],qt[3]]],{padding:40,duration:400})}catch{}return{summary:Qe,rooms:yn}}function Au(n){return n?n.type==="FeatureCollection"?n:n.type==="Feature"?{type:"FeatureCollection",features:[n]}:n.type==="GeometryCollection"?{type:"FeatureCollection",features:(n.geometries||[]).map(e=>({type:"Feature",geometry:e,properties:{}}))}:n.type&&n.coordinates?{type:"FeatureCollection",features:[{type:"Feature",geometry:n,properties:{}}]}:null:null}function TV(n){if(n==null)return 0;if(typeof n=="number")return n;const e=Number(String(n).replace(/,/g,""));return Number.isFinite(e)?e:0}function Ff(n={}){if(Number.isFinite(n.areaSF))return Number(n.areaSF);const e=n.Area_SF??n.Area??n["Area SF"];return e==null||e===""?null:TV(e)}function uv(){return{totalSf:0,rooms:0,classroomSf:0,classroomCount:0,labSf:0,labCount:0,officeSf:0,officeCount:0,deptCounts:new Map}}function IV(n={}){const e=O8(n)||"",t=String(e).trim().charAt(0),i=Kf(n,["NCES_Type","NCES Type","NCES_Type_Code","NCES Type Code"]),c=String(i||"").trim().charAt(0),u=z8(n),m=(u?.norm||"").toLowerCase(),_=m.includes("classroom")||m.includes("lecture")||t==="1"||c==="1",o=m.includes("lab")||m.includes("laboratory")||m.includes("studio")||t==="2"||c==="2",b=u?.isOfficeText||B8(e);return _?"classroom":o?"lab":b?"office":"other"}function aw(n,e={}){if(!n)return;const t=Ff(e),i=Number.isFinite(t)?t:0;n.totalSf+=i,n.rooms+=1;const c=IV(e);c==="classroom"?(n.classroomSf+=i,n.classroomCount+=1):c==="lab"?(n.labSf+=i,n.labCount+=1):c==="office"&&(n.officeSf+=i,n.officeCount+=1);const u=na(Zy(e));u&&n.deptCounts.set(u,(n.deptCounts.get(u)||0)+i)}function O3(n=[]){const e=uv();return n.forEach(t=>aw(e,t?.properties)),Vy(e)}function Vy(n){if(!n)return null;const t=Array.from((n.deptCounts||new Map).entries()).sort((c,u)=>u[1]-c[1]),i=Object.fromEntries(t);return{totalSf:n.totalSf||0,classroomSf:n.classroomSf||0,labSf:n.labSf||0,officeSf:n.officeSf||0,rooms:n.rooms||0,classroomCount:n.classroomCount||0,labCount:n.labCount||0,officeCount:n.officeCount||0,deptCounts:i,totalsByDept:i,keyDepts:t.slice(0,6).map(([c])=>c)}}function CV(n){const e=String(n||"").trim();if(!e||U3(e))return!1;const t=e.toUpperCase();return t!=="UNSPECIFIED"&&t!=="UNKNOWN"&&t!=="N/A"&&t!=="NA"}function Yp(n){const t=Object.entries(n||{}).filter(([i])=>CV(i));return Object.fromEntries(t)}function Jg(n=[]){const e=(n||[]).map(AC).filter(Boolean);if(!e.length)return null;const t=O3(e);if(!t)return null;const i=Yp(t.totalsByDept||t.deptCounts||{}),c=Object.entries(i).sort((u,m)=>(m[1]||0)-(u[1]||0));return{...t,deptCounts:i,totalsByDept:i,keyDepts:c.slice(0,6).map(([u])=>u)}}function LV(n=[]){const e=O3(n);if(!e)return null;const t=Yp(e.totalsByDept||e.deptCounts||{}),i=Object.entries(t).sort((c,u)=>(u[1]||0)-(c[1]||0));return{...e,deptCounts:t,totalsByDept:t,keyDepts:i.slice(0,6).map(([c])=>c)}}function PV(n,e){const t=(e||"").trim().toLowerCase();if(!t||!Array.isArray(n))return null;let i=0,c=0;const u={},m={};for(const _ of n){const o=_?.properties||{};if(String(Zy(o)||"").trim().toLowerCase()!==t)continue;const I=fd(o)||"Unspecified",M=Ff(o),V=Number.isFinite(M)?M:Number(o.sf??o.SF??o.AreaSF??o.Area??o.area??o.areaSF??o["Area SF"]??0)||0;c+=1,i+=V,u[I]=(u[I]||0)+1,m[I]=(m[I]||0)+V}return{totalSF:i,rooms:c,roomTypes:u,sfByRoomType:m}}function s5(n,e=1200){return Array.isArray(n)?n.slice(0,e).map((i,c)=>{const u=String(i.buildingName??i.buildingLabel??i.building??"").trim(),m=String(i.floor??i.floorId??"").trim(),_=String(i.roomNumber??i.roomLabel??i.name??"").trim(),o=String(i.roomId??i.revitId??i.id??"").trim(),b=i.roomGuid??i.roomGUID??i.revitUniqueId??i.revitUniqueID??i["Room GUID"]??null,I=[u,m,_].filter(Boolean).join("|")||`room-${c}`,M=o||I,V=String(i.occupant??"").trim(),k=String(i.vacancy??(V?"Occupied":"Unknown")).trim();return{id:M,revitId:i.revitId??b??null,roomGuid:b,roomId:o||I,buildingLabel:u,floorId:m,floorName:m,roomLabel:_,type:String(i.type??i.roomType??"").trim(),sf:Number(i.sf??i.areaSF??i.area??0)||0,department:String(i.department??"").trim(),occupant:V,vacancy:k,occupancyStatus:V?"Occupied":"Vacant",occupantDept:String(i.department??"").trim()||null}}).filter(i=>i.id):null}function hC(n){return Array.isArray(n)?n.map(e=>({id:e?.id??e?.roomId??"",roomId:e?.roomId??e?.id??"",revitId:e?.revitId??e?.roomGuid??null,buildingLabel:e?.buildingLabel??e?.buildingName??e?.building??"",floorId:e?.floorId??e?.floorName??"",floorName:e?.floorName??e?.floorId??"",roomLabel:e?.roomLabel??e?.roomNumber??"",type:e?.type??e?.roomType??"",sf:Number(e?.sf??e?.area??e?.areaSF??0)||0,department:e?.department??""})).filter(e=>e.id||e.roomId):[]}function dC(n,e={}){if(!Array.isArray(n)||n.length===0)return[];const t=Number.isFinite(e.maxTotal)?e.maxTotal:700,i=Number.isFinite(e.maxPerBuilding)?e.maxPerBuilding:120,c=Number.isFinite(e.maxPerType)?e.maxPerType:30,u=hC(n);if(u.length<=t)return u;const m=new Map;for(const I of u){const M=mo(I.buildingLabel||""),V=mg(I.type||"")||"other";m.has(M)||m.set(M,new Map);const k=m.get(M);k.has(V)||k.set(V,[]),k.get(V).push(I)}const _=[],o=(I,M)=>{if(!(!Array.isArray(I)||M<=0)){I.sort((V,k)=>(Number(k.sf)||0)-(Number(V.sf)||0));for(const V of I.slice(0,M))if(_.push(V),_.length>=t)return}};for(const[,I]of m.entries()){if(_.length>=t)break;let M=0;for(const V of I.values()){if(_.length>=t)break;const k=i-M;if(k<=0)break;const ie=Math.min(c,k);o(V,ie),M+=Math.min(V.length,ie)}}if(_.length>=t)return _.slice(0,t);const b=new Set(_.map(I=>I.id||I.roomId));for(const I of u){if(_.length>=t)break;const M=I.id||I.roomId;b.has(M)||(_.push(I),b.add(M))}return _.slice(0,t)}function kV(n=[]){const e={totalSF:0,rooms:0,roomTypes:{},sfByRoomType:{}};return(n||[]).forEach(t=>{const i=Number(t?.sf??0)||0,c=na(t?.type??t?.roomType??"Unknown")||"Unknown";e.rooms+=1,e.totalSF+=i,e.roomTypes[c]=(e.roomTypes[c]||0)+1,e.sfByRoomType[c]=(e.sfByRoomType[c]||0)+i}),e}function RV(n,e,t={}){if(!Array.isArray(n)||!e)return n||[];const i=Number.isFinite(t.maxTotal)?t.maxTotal:180,c=Number.isFinite(t.minPerType)?t.minPerType:4,u=Number.isFinite(t.maxPerType)?t.maxPerType:30,m=e?.sfByRoomType||{},_=e?.roomTypes||{},o=Number(e?.totalSF??0)||0,b=Number(e?.rooms??0)||0,I=Object.entries(m).map(([J,ne])=>{const me=mg(J),ue=Number(ne||0)||0,ke=Number(_[J]||0)||0;return{key:me,label:J,sf:ue,count:ke}}).filter(J=>J.key);if(!I.length)return dC(n,{maxTotal:i,maxPerBuilding:i,maxPerType:u});I.sort((J,ne)=>(ne.sf||0)-(J.sf||0));const M=new Map;I.forEach(J=>{const ne=o>0?J.sf/o:0,me=b>0?J.count/b:0,ue=Math.round(ne*i),ke=Math.round(me*i),ze=Math.max(c,ue,ke);M.set(J.key,Math.min(u,ze))});const V=new Map;n.forEach(J=>{const ne=mg(J?.type??J?.roomType??"")||"other";V.has(ne)||V.set(ne,[]),V.get(ne).push(J)}),V.forEach(J=>J.sort((ne,me)=>(Number(me.sf)||0)-(Number(ne.sf)||0)));const k=[],ie=new Set,se=J=>{const ne=String(J?.roomId??J?.id??J?.revitId??"");!ne||ie.has(ne)||(k.push(J),ie.add(ne))};for(const J of I){if(k.length>=i)break;const ne=V.get(J.key)||[],me=M.get(J.key)||0;let ue=0;for(const ke of ne){if(k.length>=i||ue>=me)break;se(ke),ue+=1}}if(k.length>=i)return k.slice(0,i);const de=[];V.forEach(J=>J.forEach(ne=>{const me=String(ne?.roomId??ne?.id??ne?.revitId??"");!me||ie.has(me)||de.push(ne)})),de.sort((J,ne)=>(Number(ne.sf)||0)-(Number(J.sf)||0));for(const J of de){if(k.length>=i)break;se(J)}return k.slice(0,i)}function ZA(n,e,t,i={}){if(!t||!Array.isArray(e))return{candidates:n||[],added:0};const c=Number(t.totalSF??0)||0;if(!c)return{candidates:n||[],added:0};const u=Number.isFinite(i.targetTolerance)?i.targetTolerance:.1,m=c*(1-u),_=Number.isFinite(i.maxCandidates)?i.maxCandidates:25,o=i.primaryBuilding||"",b=Array.isArray(n)?[...n]:[],I=kV(b);if(I.totalSF>=m||b.length>=_)return{candidates:b,added:0};const M=new Set(b.map(J=>String(J?.roomId??J?.id??J?.revitId??""))),V=new Map;e.forEach(J=>{const ne=String(J?.roomId??J?.id??J?.revitId??"");if(!ne||M.has(ne))return;const me=mg(J?.type??J?.roomType??"")||"other";V.has(me)||V.set(me,[]),V.get(me).push(J)}),V.forEach(J=>J.sort((ne,me)=>fC(ne,me,o)));const k=Object.entries(t.sfByRoomType||{}).map(([J,ne])=>({key:mg(J),label:J,sf:Number(ne||0)||0})).filter(J=>J.key);k.sort((J,ne)=>{const me=Hv(J.label),ue=Hv(ne.label);return me!==ue?me-ue:(ne.sf||0)-(J.sf||0)});const ie=k.map(J=>J.key);let se=0;const de=(J,ne)=>!J||b.length>=_?!1:(b.push({roomId:J?.roomId??J?.id??"",id:J?.id??J?.roomId??"",revitId:J?.revitId??J?.roomGuid??null,buildingLabel:J?.buildingLabel??"",floorId:J?.floorId??J?.floorName??"",floorName:J?.floorName??J?.floorId??"",roomLabel:J?.roomLabel??"",type:J?.type??"",sf:Number(J?.sf??0)||0,rationale:ne||"Added to reach baseline target."}),I.totalSF+=Number(J?.sf??0)||0,se+=1,!0);for(const J of ie){if(I.totalSF>=m||b.length>=_)break;const ne=V.get(J)||[];for(;ne.length&&I.totalSF<m&&b.length<_;){const me=ne.shift();de(me,"Added to better match baseline room-type mix.")}}if(I.totalSF<m&&b.length<_){const J=[];V.forEach(me=>me.forEach(ue=>J.push(ue)));const ne=pC(J,o);for(const me of ne){if(I.totalSF>=m||b.length>=_)break;de(me,"Added to reach baseline total SF.")}}return{candidates:b,added:se}}function a5(n){return n&&String(n).replace(/^\s*vacant\s*[:\-]\s*/i,"").replace(/^\s*vacant\?\s*[:\-]\s*/i,"").replace(/\bvacancy status\b/ig,"availability").replace(/\bvacant\b/ig,"available")}const Hv=n=>{const e=String(n??"").toLowerCase();return e?/(office|workstation|admin|faculty|staff|suite|open office)/i.test(e)?0:/(lab|laboratory|studio|shop|clinic|research)/i.test(e)?2:/(classroom|lecture|seminar|training|teaching)/i.test(e)?3:1:1},YA=n=>/(lab|laboratory|studio|shop|clinic|research)/i.test(String(n??"")),JA=n=>/(classroom|lecture|seminar|training|teaching)/i.test(String(n??"")),QA=n=>mo(n?.buildingLabel??n?.buildingName??n?.building??""),fC=(n,e,t)=>{const i=mo(t||""),c=QA(n),u=QA(e);if(i){const I=c===i;if(I!==(u===i))return I?-1:1}const m=Number(n?.sf??n?.area??n?.areaSF??0)||0,_=Number(e?.sf??e?.area??e?.areaSF??0)||0;if(m!==_)return _-m;const o=Hv(n?.type??n?.roomType??""),b=Hv(e?.type??e?.roomType??"");return o!==b?o-b:0},pC=(n,e)=>{if(!Array.isArray(n))return[];const t=[...n];return t.sort((i,c)=>fC(i,c,e)),t},eT=(n=[])=>{if(!Array.isArray(n)||!n.length)return"";const e=new Map;return n.forEach(t=>{const i=na(t?.buildingLabel||"");if(!i)return;const c=Number(t?.sf??t?.area??t?.areaSF??0)||0;e.set(i,(e.get(i)||0)+c)}),Array.from(e.entries()).sort((t,i)=>i[1]-t[1])[0]?.[0]||""};function $u(n,e){try{const t=n?.getSource(e);return t&&typeof t.setData=="function"?t:null}catch{return null}}function MV(n,e="",t="",i=1200){return Array.isArray(n)?n.slice(0,i).map((c,u)=>{const m=c?.properties||{},_=c?.id??m.RevitId??m.id??m.roomId??m.RoomId,o=String(m.roomNumber??m.RoomNumber??m.Number??m.Room??m.Name??"").trim(),b=fd(m)||"Unknown",I=String(m.department??m.Department??m.Dept??"").trim(),M=String(m.occupant??m.Occupant??"").trim(),V=Ff(m),k=Number.isFinite(V)?V:Number(m.sf??m.SF??m.AreaSF??m.Area??m.area??0)||0,ie=[e,t||m.Floor,o||u].filter(Boolean).join("|")||`feat-${u}`,se=String(_??"").trim()||ie;return{id:se,revitId:m.RevitId??_??null,roomId:se,buildingLabel:e||String(m.buildingLabel??m.Building??m.building??"").trim(),floorId:t||String(m.floorId??m.floor??m.Floor??"").trim(),floorName:t||String(m.floorId??m.floor??m.Floor??"").trim(),roomLabel:o,type:b,sf:k,department:I,occupant:M,vacancy:M?"Occupied":"Unknown",occupancyStatus:M?"Occupied":"Vacant",occupantDept:I||null}}).filter(c=>c.id):null}const tT=async(n,e)=>{const{ensureFloorsForBuilding:t,buildFloorUrl:i,floorCache:c,fetchGeoJSON:u}=e||{},m=(n||"").trim();if(!m)return{perBuilding:{},campusTotals:null};const _=m.toLowerCase(),o={},b={totalSF:0,rooms:0,roomTypes:{},sfByRoomType:{}};for(const I of dd){const M=I?.name;if(!M)continue;let V=await t(M);if(!V?.length)continue;const k={totalSF:0,rooms:0,roomTypes:{},sfByRoomType:{}};for(const ie of V){const se=i(M,ie);if(!se)continue;let de=c.get(se);if(!de)try{de=await u(se),de&&c.set(se,de)}catch{continue}const J=Au(de),ne=PV(J?.features||[],_);ne&&(k.totalSF+=ne.totalSF||0,k.rooms+=ne.rooms||0,Object.entries(ne.roomTypes||{}).forEach(([me,ue])=>{k.roomTypes[me]=(k.roomTypes[me]||0)+ue}),Object.entries(ne.sfByRoomType||{}).forEach(([me,ue])=>{k.sfByRoomType[me]=(k.sfByRoomType[me]||0)+ue}))}(k.rooms||k.totalSF)&&(o[M]=k,b.totalSF+=k.totalSF,b.rooms+=k.rooms,Object.entries(k.roomTypes||{}).forEach(([ie,se])=>{b.roomTypes[ie]=(b.roomTypes[ie]||0)+se}),Object.entries(k.sfByRoomType||{}).forEach(([ie,se])=>{b.sfByRoomType[ie]=(b.sfByRoomType[ie]||0)+se}))}return!b.rooms&&!b.totalSF?{perBuilding:{},campusTotals:null}:{perBuilding:o,campusTotals:b}};function qu(n,e){if(!n)return{loading:!1,mode:e,totalSf:"-",classroomSf:"-",rooms:"-",classroomCount:"-",labSf:"-",officeSf:"-",labCount:"-",officeCount:"-",deptCount:"-",keyDepts:[]};const t=u=>Number.isFinite(u)?Math.round(u).toLocaleString():"-",i=u=>Number.isFinite(u)?Number(u).toLocaleString():"-",c=n.deptCounts?Object.keys(n.deptCounts).length:0;return{loading:!1,mode:e,totalSf:t(n.totalSf),classroomSf:t(n.classroomSf),labSf:t(n.labSf),officeSf:t(n.officeSf),rooms:i(n.rooms),classroomCount:i(n.classroomCount),labCount:i(n.labCount),officeCount:i(n.officeCount),deptCount:c?c.toString():"-",keyDepts:n.keyDepts||[]}}function NV(n,e){try{if(!n||!Array.isArray(n.features)||n.features.length===0)return n;const t=e?.type==="Feature"?e:e?.type?{type:"Feature",properties:{},geometry:e}:null;if(!t)return n;const i=n_(t);if(i){const Me={rotationDeg:0,rotationPivot:null,scale:1,scaleOrigin:null,translateKm:0,translateBearing:0,nudgeMeters:null,refineRotationDeg:0,refineRotationPivot:null,snapCorner:i},we=qV(t),De=UV(t),tt=Array.isArray(De)?De[0]:null,xe=Array.isArray(De)?De[1]:null,le=!!(tt&&xe),Ne=VV(t);let Be=n,Qe=Ol(n);if(we!=="none"&&!le){const ht=lw(n,t);if(Number.isFinite(ht)&&Math.abs(ht)>1.5){const Lt=Qe?.geometry?.coordinates||null;Me.rotationDeg=ht,Me.rotationPivot=Lt;const Rt=Hh(n,ht,Lt?{pivot:Lt}:void 0);Rt?.features?.length&&(Be=Rt,Qe=Ol(Be))}}const[rt,gt,pt,Mt]=Cu(Be),[Jt,hn,yn,Mn]=Cu(t);if(![rt,gt,pt,Mt,Jt,hn,yn,Mn].every(Number.isFinite))return n;const Gt=Math.max(1e-9,pt-rt),ot=Math.max(1e-9,Mt-gt),dr=Math.max(1e-9,yn-Jt),wr=Math.max(1e-9,Mn-hn),Ln=u5(t)==="directional",ir=Ln?Zp(Be):Xp([rt,gt,pt,Mt]),Qn=Ln?Zp(t):Xp([Jt,hn,yn,Mn]);let Kr=null,qt=0,Pn=null,Hn=null,Bn=null,Rr=null;if(tt&&xe&&ir&&Qn&&(Pn=ir[tt],Hn=ir[xe],Bn=Qn[tt],Rr=Qn[xe],Pn&&Hn&&Bn&&Rr)){const ht=Of(gs(Pn),gs(Hn),{units:"kilometers"}),Lt=Of(gs(Bn),gs(Rr),{units:"kilometers"});Number.isFinite(ht)&&Number.isFinite(Lt)&&ht>0&&(Kr=Lt/ht);const Rt=Zm(gs(Pn),gs(Hn)),At=(Zm(gs(Bn),gs(Rr))-Rt+540)%360-180;Number.isFinite(At)&&(qt=At)}const vr=Pn||Qe?.geometry?.coordinates||null;Me.scaleOrigin=vr;const Tr=.96,Ir=iT(t),Pr=Math.min(dr/Gt,wr/ot)*Tr,Si=Ne!=="legacy"&&Number.isFinite(Kr)&&Kr>0,ki=(Si?Kr:Pr)*Ir,oi=Si||Math.abs(Ir-1)>1e-6||ki<.9||ki>1.1;Me.scale=oi?ki:1;let Gr=oi?fg(Be,ki,vr?{origin:vr}:void 0):Be;const Or=jV(t),hi=(Number.isFinite(qt)?qt:0)+(Number.isFinite(Or)?Or:0);le&&Ne!=="legacy"&&Number.isFinite(hi)&&Math.abs(hi)>1e-6&&Array.isArray(vr)&&(Gr=Hh(Gr,hi,{pivot:vr}),Me.rotationDeg=hi,Me.rotationPivot=vr);const si=Ln?null:Cu(Gr),lt=Ln?Zp(Gr):Xp(si),Ee=Qn||(Ln?Zp(t):Xp([Jt,hn,yn,Mn]));if(lt&&Ee){const ht=tt===i&&xe,Lt=ht?lt[tt]:lt[i],Rt=ht?Ee[tt]:Ee[i];if(Lt&&Rt){const Ot=gs(Lt),At=gs(Rt),Pt=Of(Ot,At,{units:"kilometers"}),xn=Zm(Ot,At);Number.isFinite(Pt)&&Number.isFinite(xn)&&(Gr=Pt>0?tg(Gr,Pt,xn,{units:"kilometers"}):Gr,Me.translateKm=Pt,Me.translateBearing=xn)}if(le&&ht&&Ne!=="legacy"&&Ne!=="match"){const Ot=lt[tt],At=Ee[tt];if(Ot&&At){const Pt=Of(gs(Ot),gs(At),{units:"kilometers"}),xn=Zm(gs(Ot),gs(At));Number.isFinite(Pt)&&Number.isFinite(xn)&&Pt>1e-9&&(Gr=tg(Gr,Pt,xn,{units:"kilometers"}),Me.translateKm=(Me.translateKm||0)+Pt,Me.translateBearing=xn)}}}const Te=Bn||Ee?.[i]||null;if(le&&Ne==="legacy"&&Number.isFinite(hi)&&Math.abs(hi)>1e-6&&Te&&(Gr=Hh(Gr,hi,{pivot:Te}),Me.refineRotationDeg=(Me.refineRotationDeg||0)+hi,Me.refineRotationPivot=Te),Te&&we!=="none"&&!le){const ht=rT(Gr,t,Te,{maxDeg:6,stepDeg:.4,fineStep:.1,fineWindow:1.5,hullLimit:1200});ht?.fc&&(Gr=ht.fc),Me.refineRotationDeg=ht?.angle||0,Me.refineRotationPivot=Te}le||Number.isFinite(Or)&&Math.abs(Or)>1e-6&&Te&&(Gr=Hh(Gr,Or,{pivot:Te}),Me.refineRotationDeg=(Me.refineRotationDeg||0)+Or,Me.refineRotationPivot=Te);const et=$V(t);return Array.isArray(et)&&(Gr=F3(Gr,et),Me.nudgeMeters=et),Gr&&typeof Gr=="object"&&(Gr.__mfFitted=!0,Gr.__mfFittedBuilding=t?.properties?.id||t?.properties?.name||"",Gr.__mfFitTransform=Me,n.__mfAffineApplied&&(Gr.__mfAffineApplied=n.__mfAffineApplied),n.__mfRotationOverride!=null&&(Gr.__mfRotationOverride=n.__mfRotationOverride),n.__mfRotationPivot&&(Gr.__mfRotationPivot=n.__mfRotationPivot),n.__mfFitTransformApplied&&(Gr.__mfFitTransformApplied=n.__mfFitTransformApplied)),Gr}let c=Ol(n);const u=Ol(t),m={rotationDeg:0,rotationPivot:null,scale:1,scaleOrigin:null,translateKm:0,translateBearing:0,nudgeMeters:null,refineRotationDeg:0,refineRotationPivot:null},_=lw(n,t);if(Number.isFinite(_)&&Math.abs(_)>1.5){const Me=c?.geometry?.coordinates||null;m.rotationDeg=_,m.rotationPivot=Me;const we=Hh(n,_,Me?{pivot:Me}:void 0);we?.features?.length&&(n=we,c=Ol(n))}const[o,b,I,M]=Cu(n),[V,k,ie,se]=Cu(t),de=Math.max(1e-9,I-o),J=Math.max(1e-9,M-b),ne=Math.max(1e-9,ie-V),me=Math.max(1e-9,se-k),ue=.96,ke=iT(t),ze=Math.min(ne/de,me/J)*ue*ke,pe=ze<.9||ze>1.1,U=c?.geometry?.coordinates||null;m.scale=pe?ze:1,m.scaleOrigin=U;let F=pe?fg(n,ze,U?{origin:U}:void 0):n;const q=Cu(F),j=[(V+ie)/2,(k+se)/2],H=Array.isArray(q)&&q.length===4&&q.every(Me=>Number.isFinite(Me)),Z=Number.isFinite(j[0])&&Number.isFinite(j[1]);if(i&&H){const we=u5(t)==="directional",De=we?Zp(F):Xp(q),tt=we?Zp(t):Xp([V,k,ie,se]);if(De&&tt){const xe=De[i],le=tt[i];if(xe&&le){const Ne=gs(xe),Be=gs(le),Qe=Of(Ne,Be,{units:"kilometers"}),rt=Zm(Ne,Be);Number.isFinite(Qe)&&Number.isFinite(rt)&&(F=Qe>0?tg(F,Qe,rt,{units:"kilometers"}):F,m.translateKm=Qe,m.translateBearing=rt,m.snapCorner=i)}}}else{const Me=[],we=(De,tt,xe)=>{if(!Array.isArray(tt)||!Array.isArray(xe))return;const le=gs(tt),Ne=gs(xe),Be=Of(le,Ne,{units:"kilometers"}),Qe=Zm(le,Ne);if(!Number.isFinite(Be)||!Number.isFinite(Qe))return;const rt=Be>0?tg(F,Be,Qe,{units:"kilometers"}):F,gt=um(rt,1200),pt=gt?t_(gt,t):0;Me.push({label:De,distKm:Be,bearing:Qe,fc:rt,score:pt})};if(H&&Z){const De=[(q[0]+q[2])/2,(q[1]+q[3])/2];we("center",De,j);const xe=u5(t)==="directional",le=xe?Zp(F):Xp(q),Ne=xe?Zp(t):Xp([V,k,ie,se]);le&&Ne&&Object.keys(le).forEach(Be=>{we(`corner-${Be}`,le[Be],Ne[Be])})}else we("centroid",c?.geometry?.coordinates,u?.geometry?.coordinates);if(Me.length){const De=Me.reduce((tt,xe)=>!tt||xe.score>tt.score+1e-6||Math.abs(xe.score-tt.score)<=1e-6&&xe.distKm<tt.distKm?xe:tt,null);De?.fc&&(F=De.fc,m.translateKm=De.distKm,m.translateBearing=De.bearing)}}const be=u?.geometry?.coordinates||j,Re=rT(F,t,be,{maxDeg:6,stepDeg:.4,fineStep:.1,fineWindow:1.5,hullLimit:1200}),Oe=Re?.fc||F;return m.refineRotationDeg=Re?.angle||0,m.refineRotationPivot=be,Oe&&typeof Oe=="object"&&(Oe.__mfFitted=!0,Oe.__mfFittedBuilding=t?.properties?.id||t?.properties?.name||"",Oe.__mfFitTransform=m,n.__mfAffineApplied&&(Oe.__mfAffineApplied=n.__mfAffineApplied),n.__mfRotationOverride!=null&&(Oe.__mfRotationOverride=n.__mfRotationOverride),n.__mfRotationPivot&&(Oe.__mfRotationPivot=n.__mfRotationPivot),n.__mfFitTransformApplied&&(Oe.__mfFitTransformApplied=n.__mfFitTransformApplied)),Oe}catch{return n}}function Dd(n,e=1/0){const t=[];function i(c){if(!(!c||t.length>=e)){if(typeof c[0]=="number"){t.push([c[0],c[1]]);return}for(const u of c){if(t.length>=e)break;i(u)}}}return n?.type==="GeometryCollection"?(n.geometries||[]).forEach(c=>i(c.coordinates)):i(n?.coordinates),t}function l0(n,e=1/0){if(!n)return[];if(n.type==="FeatureCollection"){const t=[];for(const i of n.features||[]){if(t.length>=e)break;const c=Dd(i.geometry,e-t.length);c?.length&&t.push(...c)}return t}return n.type==="Feature"?Dd(n.geometry,e):n.type?Dd(n,e):[]}function mC(n){if(!Array.isArray(n)||n.length<2)return 0;let e=0,t=0;n.forEach(([_,o])=>{e+=_,t+=o}),e/=n.length,t/=n.length;let i=0,c=0,u=0;return n.forEach(([_,o])=>{const b=_-e,I=o-t;i+=b*b,c+=I*I,u+=b*I}),!Number.isFinite(i)||!Number.isFinite(c)||!Number.isFinite(u)?0:.5*Math.atan2(2*u,i-c)*180/Math.PI}function ng(n){return Array.isArray(n)&&n.length>=2&&typeof n[0]=="number"&&typeof n[1]=="number"}function B3(n,e){if(Array.isArray(n)){if(n.length&&ng(n[0])){e.push(n);return}n.forEach(t=>B3(t,e))}}function f0(n){if(!n?.coordinates)return null;const e=[];B3(n.coordinates,e);let t=0,i=null;const c=(u,m)=>Math.abs(u[0]-m[0])<1e-9&&Math.abs(u[1]-m[1])<1e-9;return e.forEach(u=>{if(!Array.isArray(u)||u.length<2)return;for(let o=0;o<u.length-1;o+=1){const b=u[o],I=u[o+1];if(!ng(b)||!ng(I))continue;const M=I[0]-b[0],V=I[1]-b[1],k=Math.hypot(M,V);k>t&&(t=k,i=Math.atan2(V,M)*180/Math.PI)}const m=u[u.length-1],_=u[0];if(ng(m)&&ng(_)&&!c(m,_)){const o=_[0]-m[0],b=_[1]-m[1],I=Math.hypot(o,b);I>t&&(t=I,i=Math.atan2(b,o)*180/Math.PI)}}),i}function nT(n){if(!n?.coordinates)return null;const e=[];B3(n.coordinates,e);let t=0,i=0,c=0;return e.forEach(m=>{if(!(!Array.isArray(m)||m.length<2))for(let _=0;_<m.length-1;_+=1){const o=m[_],b=m[_+1];if(!ng(o)||!ng(b))continue;const I=b[0]-o[0],M=b[1]-o[1],V=Math.hypot(I,M);if(V<=0)continue;const k=Math.atan2(M,I);i+=V*Math.cos(2*k),t+=V*Math.sin(2*k),c+=V}}),c<=0?null:.5*Math.atan2(t,i)*180/Math.PI}function hv(n){let e=(n+180)%360-180;return e>90&&(e-=180),e<-90&&(e+=180),e}function DV(n,e=2e3){if(!n?.geometry)return 0;const t=Dd(n.geometry,e);return mC(t)}function FV(n,e=4e3){if(!n?.features?.length)return 0;const t=[];for(const i of n.features){if(t.length>=e)break;const c=Dd(i.geometry,e-t.length);c?.length&&t.push(...c)}return mC(t)}function um(n,e=3e3){if(!n?.features?.length)return null;const t=[];for(const u of n.features){if(t.length>=e)break;const m=Dd(u.geometry,e-t.length);m?.length&&t.push(...m)}if(t.length<3)return null;const i=t.map(u=>gs(u));return v8(E3(i))||null}function lw(n,e){const t=um(n),i=f0(t?.geometry),c=f0(e?.geometry),u=FV(n),m=DV(e),_=nT(t?.geometry),o=nT(e?.geometry),b=[];return Number.isFinite(i)&&Number.isFinite(c)&&b.push(hv(c-i)),Number.isFinite(u)&&Number.isFinite(m)&&b.push(hv(m-u)),Number.isFinite(_)&&Number.isFinite(o)&&b.push(hv(o-_)),b.length?b.length===1?b[0]:(b.sort((I,M)=>I-M),b[Math.floor(b.length/2)]):null}function t_(n,e){try{const t=P8(E3([n,e]));if(!t)return 0;const i=pA(t),c=pA(n);return!Number.isFinite(i)||!Number.isFinite(c)||c<=0?0:i/c}catch{return 0}}function rT(n,e,t,i={}){if(!n||!e||!t)return{fc:n,angle:0};const c=Number.isFinite(i.maxDeg)?i.maxDeg:5,u=Number.isFinite(i.stepDeg)?i.stepDeg:.5,m=Number.isFinite(i.fineStep)?i.fineStep:.1,_=Number.isFinite(i.fineWindow)?i.fineWindow:1.2,o=um(n,i.hullLimit||1200);if(!o)return{fc:n,angle:0};const b=t_(o,e);let I=0,M=b;for(let k=-c;k<=c;k+=u){if(Math.abs(k)<1e-6)continue;const ie=Hh(o,k,{pivot:t}),se=t_(ie,e);se>M+1e-4&&(M=se,I=k)}if(m>0&&_>0){const k=I-_,ie=I+_;for(let se=k;se<=ie;se+=m){if(Math.abs(se)<1e-6)continue;const de=Hh(o,se,{pivot:t}),J=t_(de,e);J>M+1e-4&&(M=J,I=se)}}if(Math.abs(I)<.001)return{fc:n,angle:0};const V=Hh(n,I,{pivot:t});return{fc:V?.features?.length?V:n,angle:I}}function OV(n){let e=1/0,t=1/0,i=-1/0,c=-1/0;return(n?.features||[]).forEach(u=>{Dd(u.geometry).forEach(([m,_])=>{m<e&&(e=m),_<t&&(t=_),m>i&&(i=m),_>c&&(c=_)})}),[e,t,i,c]}function Xp(n){if(!Array.isArray(n)||n.length!==4)return null;const[e,t,i,c]=n;return[e,t,i,c].every(Number.isFinite)?{nw:[e,c],ne:[i,c],sw:[e,t],se:[i,t]}:null}function Zp(n,e=4e3){let t=n;if(n?.type==="FeatureCollection"){const m=um(n,e);m?.geometry&&(t=m)}const i=l0(t,e);if(!i.length)return null;const c={nw:[-1,1],ne:[1,1],sw:[-1,-1],se:[1,-1]},u={nw:{score:-1/0,pt:null},ne:{score:-1/0,pt:null},sw:{score:-1/0,pt:null},se:{score:-1/0,pt:null}};for(const[m,_]of i)if(!(!Number.isFinite(m)||!Number.isFinite(_)))for(const o of Object.keys(c)){const[b,I]=c[o],M=m*b+_*I;M>u[o].score&&(u[o]={score:M,pt:[m,_]})}return{nw:u.nw.pt,ne:u.ne.pt,sw:u.sw.pt,se:u.se.pt}}function Xr(n){return String(n||"").replace(/\u00a0/g," ").trim().toLowerCase().replace(/\bthe\b/g,"").replace(/\bmemorial\b/g,"").replace(/\bresidence\b/g,"").replace(/\bresidency\b/g,"").replace(/\b[a-z]\b/g,"").replace(/theatre/g,"theater").replace(/centre/g,"center").replace(/[^a-z0-9]/g,"")}const F_=[{keys:["Morrison Reeves","Morrison-Reeves Science Center"],corner:"nw",cornerMethod:"directional",cornerPair:["nw","sw"],pairMode:"match",rotationMode:"none"},{keys:["Calvin French Chapel","Calvin H. French Chapel","French Memorial Chapel"],corner:"nw",cornerMethod:"directional",cornerPair:["nw","sw"],pairMode:"match"}];function O_(n,e){const t={};return n.forEach(i=>{!i||!i.keys||i[e]==null||i.keys.forEach(c=>{const u=Xr(c);u&&(t[u]=i[e])})}),t}const BV=new Set([]),cw=new Set([Xr("Calvin French Chapel"),Xr("Calvin H. French Chapel"),Xr("Calvin H. French Memorial Chapel"),Xr("Kiewit Building"),Xr("Taylor Hall"),Xr("Taylor Hall Residence")]);function zV({buildingLabel:n}={}){const e=Xr(n);return e&&BV.has(e)}let l5=null;async function c5(){if(l5)return l5;try{const n=[nf("Hastings_College_Buildings.json"),"/Hastings_College_Buildings.json","Hastings_College_Buildings.json"],e=await Q8(n);if(e?.ok&&e.data&&Array.isArray(e.data.features))return l5=e.data,e.data}catch{}return null}function Nd(n){const t=(()=>{try{return decodeURIComponent(String(n||""))}catch{return String(n||"")}})().split("/").filter(Boolean);if(!t.length)return"";const i=t.indexOf("floorplans");return i>=0&&t.length>i+2?t[i+2]:t[t.length-1]||""}function n_(n){if(!n)return null;const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const c=Xr(i);if(c&&sT[c])return sT[c]}return null}function jV(n){if(!n)return null;const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const c=Xr(i);if(c&&Number.isFinite(aT[c]))return aT[c]}return null}function u5(n){if(!n)return"bbox";const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const c=Xr(i);if(c&&lT[c])return lT[c]}return"bbox"}function UV(n){if(!n)return null;const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const c=Xr(i);if(c&&cT[c])return cT[c]}return null}function VV(n){if(!n)return"match";const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const c=Xr(i);if(c&&uT[c])return uT[c]}return"match"}function qV(n){if(!n)return"auto";const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const c=Xr(i);if(c&&hT[c])return hT[c]}return"auto"}function iT(n){if(!n)return 1;const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const c=Xr(i),u=YV[c];if(c&&Number.isFinite(u))return u}return 1}function $V(n){if(!n)return null;const e=n.properties||{},t=[e.id,e.name,e.Name,e.buildingId,e.buildingName,e.Building,e.building];for(const i of t){const c=Xr(i),u=JV[c];if(c&&Array.isArray(u)&&u.length>=2)return u}return null}function Rf(n=[],e){if(!Array.isArray(n)||!n.length||!e)return null;const t=Xr(e);if(!t)return null;let i=null,c=0;for(const u of n){const m=u?.properties||{},_=[Xr(m.id),Xr(m.name),Xr(m.Name),Xr(m.buildingId),Xr(m.buildingName),Xr(m.Building),Xr(m.building)].filter(Boolean);for(const o of _){if(!o)continue;const b=o===t,I=o.includes(t)||t.includes(o);if(!b&&!I)continue;const M=o.length;M>c&&(i=u,c=M)}}return i}function GV(n,e){try{if(!n||!n.features?.length||!e||n.__mfGeoreferenced||n.__mfNoFit)return!1;const t=Xr(e?.properties?.id||e?.properties?.name||"");if(t&&cw.has(t)||n_(e))return!0;if(n?.__mfFitted)return!1;const[i,c,u,m]=Cu(n),[_,o,b,I]=Cu(e);if(![i,c,u,m,_,o,b,I].every(Number.isFinite))return!1;const M=Math.max(1e-9,u-i),V=Math.max(1e-9,m-c),k=Math.max(1e-9,b-_),ie=Math.max(1e-9,I-o),se=Math.min(k/M,ie/V),de=se<.75||se>1.35,J=Ol(n),ne=Ol(e),me=Of(J,ne,{units:"kilometers"}),ue=Number.isFinite(me)&&me>.06,ke=Of(gs([_,o]),gs([b,I]),{units:"kilometers"}),pe=(Number.isFinite(me)&&Number.isFinite(ke)&&ke>0?me/ke:0)>.18,U=u<_||i>b||m<o||c>I,F=lw(n,e),q=Number.isFinite(F)&&Math.abs(F)>1.5,j=um(n,1200),H=j?t_(j,e):1,Z=H>0&&H<.85;return de||ue||U||q||pe||Z}catch{return!1}}const dd=[{name:"Hurley-McDonald Hall",folder:"HurleyMcDonald"},{name:"Gray Center",folder:"Gray Center"},{name:"Morrison-Reeves Science Center",folder:"Morrison Reeves"},{name:"1882",folder:"1882"},{name:"Altman Hall",folder:"Altman Hall"},{name:"Babcock Hall",folder:"Babcock Hall"},{name:"Barrett Alumni",folder:"Barrett Alumni"},{name:"Batchelder Services Bldg",folder:"Batchelder"},{name:"Bronc Hall",folder:"Bronc Hall"},{name:"Bronco Village Apt 911",folder:"Bronco Village Apt 911"},{name:"Bronco Village Apt 915",folder:"Bronco Village Apt 915"},{name:"Bronco Village Apt 917",folder:"Bronco Village Apt 917"},{name:"Bronco Village Apt 919",folder:"Bronco Village Apt 919"},{name:"Bronco Village Apt 921",folder:"Bronco Village Apt 921"},{name:"Bronco Village Apt 923",folder:"Bronco Village Apt 923"},{name:"Calvin H. French Chapel",folder:"Calvin French Chapel"},{name:"Daugherty Student Engagement Center",folder:"Daugherty"},{name:"Farrell-Fleharty",folder:"Fleharty"},{name:"Hazelrigg Student Union",folder:"Hazzelrig"},{name:"Jackson Dinsdale Art Center",folder:"Jackson Dinsdale"},{name:"Kiewit Building",folder:"Kiewit"},{name:"Lloyd Wilson Stadium",folder:"Lloyd Wilson Stadium"},{name:"McCormick Hall",folder:"McCormick"},{name:"Perkins Library",folder:"Perkins"},{name:"Physical Fitness Facility",folder:"Physical Fitness Facility"},{name:"Scott Studio Theater",folder:"Scott Theater"},{name:"Stone Health Center",folder:"Stone Health Center"},{name:"Taylor Hall",folder:"Taylor Hall"},{name:"Wilson Center",folder:"WilsonCenter"}],rm=Object.fromEntries(dd.map(n=>[n.name,n.folder])),gC=new Set(dd.map(n=>n.folder)),p0=Object.fromEntries(dd.map(n=>[n.folder,n.name])),yC=n=>String(n||"").replace(/\u00a0/g," ").trim().toLowerCase().replace(/theatre/g,"theater").replace(/centre/g,"center").replace(/\bmemorial\b/g,""),y_=n=>yC(n).replace(/[^a-z0-9]/g,""),uw=n=>yC(n).replace(/\b[a-z]\b/gi,"").replace(/[^a-z0-9]/g,""),HV=n=>{if(!n)return null;const e=y_(n);if(!e)return null;const t=vC?.[e];if(t&&rm[t])return t;for(const i of Object.keys(rm))if(y_(i)===e)return i;return null},Mf=n=>{if(!n)return null;if(rm[n])return n;if(gC.has(n))return p0[n]||null;const e=z3[n];if(e&&rm[e])return e;const t=y_(n),i=uw(n),c=t&&vC?.[t]||i&&WV?.[i]||null;if(c&&rm[c])return c;let u=null,m=0;for(const _ of Object.keys(rm)){const o=y_(_),b=uw(_),I=t===o||i===b,M=t&&o&&(t.includes(o)||o.includes(t))||i&&b&&(i.includes(b)||b.includes(i));if(!I&&!M)continue;const V=o.length;V>m&&(u=_,m=V)}return u},_C={1882:"The 1882 Residence Hall","Altman Hall":"Altman Hall Residency","Babcock Hall":"Babcock Hall Residence","Barrett Alumni":"Barrett Alumni Center","Batchelder Services Bldg":"Batchelder General Services","Bronc Hall":"Bronc Hall Residence","Hurley-McDonald Hall":"hurley_mcdonald","Gray Center":"gray_center","Hazelrigg Student Union":"Hazelrigg Student Union","Lloyd Wilson Stadium":"Lloyd Wilson Field/Stadium","Morrison-Reeves Science Center":"morrison_reeves","Scott Studio Theater":"Scott Studio Theatre","Stone Health Center":"The Stone Health Center","Taylor Hall":"Taylor Hall Residence","Wilson Center":"wilson_center","Farrell-Fleharty":"Lynn Farrell Arena/Fleharty Educational Center","Calvin H. French Chapel":"Calvin French Chapel","Bronco Village Apt 911":"Bronco Village Apartments 1","Bronco Village Apt 915":"Bronco Village Apartments 2","Bronco Village Apt 917":"Bronco Village Apartments 3","Bronco Village Apt 919":"Bronco Village Apartments 4","Bronco Village Apt 921":"Bronco Village Apartments 5","Bronco Village Apt 923":"Bronco Village Apartments 6"},z3={...Object.fromEntries(Object.entries(_C).map(([n,e])=>[e,n])),"Farrell Arena Fleharty Educational Center":"Farrell-Fleharty","Daugherty Center for Student Engagement":"Daugherty Student Engagement Center","Daugherty Center For Student Engagement":"Daugherty Student Engagement Center","Fleharty Center":"Farrell-Fleharty","Calvin H. French Memorial Chapel":"Calvin H. French Chapel","French Memorial Chapel":"Calvin H. French Chapel","Hazzelrig Student Union":"Hazelrigg Student Union","Hazelrigg Student Union":"Hazelrigg Student Union",Kiewit:"Kiewit Building","Scott Theatre":"Scott Studio Theater","Scott Theater":"Scott Studio Theater","Wilson Math and Computer Sci Center":"Wilson Center"},vC=Object.fromEntries(Object.entries(z3).map(([n,e])=>[y_(n),e])),WV=Object.fromEntries(Object.entries(z3).map(([n,e])=>[uw(n),e])),KV="Data/Utilization/classroom_utilization.csv",oT=n=>{const e=[];let t="",i=!1;for(let c=0;c<n.length;c+=1){const u=n[c];if(u==='"'){i&&n[c+1]==='"'?(t+='"',c+=1):i=!i;continue}if(u===","&&!i){e.push(t),t="";continue}t+=u}return e.push(t),e},Qg=n=>{const e=String(n??"").replace(/,/g,"").trim();if(!e)return null;const t=Number(e);return Number.isFinite(t)?t:null},e0=n=>{const e=String(n??"").replace(/[%\s]/g,"").replace(/,/g,"").trim();if(!e)return null;const t=Number(e);return Number.isFinite(t)?t:null},XV=n=>{const e=String(n??"").trim().toLowerCase();return e?/^0+\d+$/.test(e)?String(Number(e)):e:""},xC=(n,e)=>`${n}||${XV(e)}`,ZV=(n="")=>{const e=n.split(/\r?\n/).filter(ie=>ie.trim().length>0);if(!e.length)return{buildings:{},rooms:{},campus:null};const t=oT(e[0]).map(ie=>ie.trim()),i=t.findIndex(ie=>ie.toLowerCase().includes("building")),c=t.findIndex(ie=>ie.toLowerCase().includes("weekly")),u=t.findIndex(ie=>ie.toLowerCase().includes("enrollment")),m=t.findIndex(ie=>ie.toLowerCase().includes("capacity")),_=t.findIndex(ie=>ie.toLowerCase().includes("time")),o=t.findIndex(ie=>ie.toLowerCase().includes("seat")),b=t.findIndex(ie=>ie.toLowerCase().includes("overall"));if(i<0)return{buildings:{},rooms:{},campus:null};const I={},M={};let V=null,k=null;for(let ie=1;ie<e.length;ie+=1){const se=oT(e[ie]),de=(se[i]??"").trim();if(!de)continue;if(/^grand total$/i.test(de)){V={weeklyHours:Qg(se[c]),finalEnrollment:Qg(se[u]),totalCapacity:Qg(se[m]),timeUtilization:e0(se[_]),seatUtilization:e0(se[o]),overallUtilization:e0(se[b])},k=null;continue}const ne=HV(de)||null,me=Qg(se[c]),ue=Qg(se[u]),ke=Qg(se[m]),ze=e0(se[_]),pe=e0(se[o]),U=e0(se[b]);if(ne){k=ne,I[ne]={weeklyHours:me,finalEnrollment:ue,totalCapacity:ke,timeUtilization:ze,seatUtilization:pe,overallUtilization:U};continue}if(!k)continue;const F=xC(k,de);M[F]={building:k,roomLabel:de,weeklyHours:me,finalEnrollment:ue,totalCapacity:ke,timeUtilization:ze,seatUtilization:pe,overallUtilization:U}}return{buildings:I,rooms:M,campus:V}},sT={[Xr("Babcock Hall")]:"nw",[Xr("Babcock Hall Residence")]:"nw",[Xr("Gray Center")]:"sw",[Xr("Lloyd Wilson Stadium")]:"nw",[Xr("Lloyd Wilson Field/Stadium")]:"nw",[Xr("Stone Health Center")]:"nw",[Xr("The Stone Health Center")]:"nw",[Xr("McCormick Hall")]:"nw",[Xr("Jackson Dinsdale Art Center")]:"nw",[Xr("Farrell-Fleharty")]:"nw",[Xr("Lynn Farrell Arena/Fleharty Educational Center")]:"nw",...O_(F_,"corner")},aT={[Xr("Gray Center")]:0,[Xr("McCormick Hall")]:90},lT={[Xr("Gray Center")]:"directional",[Xr("Lloyd Wilson Stadium")]:"directional",[Xr("Lloyd Wilson Field/Stadium")]:"directional",...O_(F_,"cornerMethod")},cT={[Xr("Gray Center")]:["sw","nw"],[Xr("Lloyd Wilson Stadium")]:["nw","sw"],[Xr("Lloyd Wilson Field/Stadium")]:["nw","sw"],[Xr("Stone Health Center")]:["nw","sw"],[Xr("The Stone Health Center")]:["nw","sw"],[Xr("Jackson Dinsdale Art Center")]:["nw","sw"],[Xr("Farrell-Fleharty")]:["nw","sw"],[Xr("Lynn Farrell Arena/Fleharty Educational Center")]:["nw","sw"],[Xr("Daugherty Student Engagement Center")]:["nw","sw"],[Xr("McCormick Hall")]:["nw","sw"],...O_(F_,"cornerPair")},uT={[Xr("Lloyd Wilson Stadium")]:"match",[Xr("Lloyd Wilson Field/Stadium")]:"match",[Xr("Stone Health Center")]:"legacy",[Xr("The Stone Health Center")]:"legacy",...O_(F_,"pairMode")},hT={[Xr("Babcock Hall")]:"none",[Xr("Babcock Hall Residence")]:"none",...O_(F_,"rotationMode")},YV={[Xr("Gray Center")]:1.035,[Xr("Lloyd Wilson Stadium")]:1,[Xr("Lloyd Wilson Field/Stadium")]:1},JV={},dT={"wilson_center/basement":184.5,"wilson_center/level_1":180.5,"daugherty_student_engagement_center/basement":42,"daugherty_student_engagement_center/level_1":42,hurley_mcdonald_hall:180,"mccormick_hall/basement":84.5,"mccormick_hall/level_1":88.5,"mccormick_hall/level_2":88.5,"mccormick_hall/level_3":100,morrison_reeves_science_center:0,morrison_reeves:0,"morrison_reeves/level_1":0,"morrison_reeves/level_2":0},fT={"babcock_hall/level_2":1.12},pT={},mT=new Set(["kiewit/level_2","kiewit_building/level_2","babcock_hall/level_3","taylor_hall","taylor_hall_residence"]),gT=new Set(["calvin_french_chapel/level_2","calvin_h_french_chapel/level_2","calvin_h_french_memorial_chapel/level_2"]),QV=new Set(["bronc_hall/basement","bronc_hall_residence/basement"]),eq=new Set(["calvin_french_chapel/basement","calvin_h_french_chapel/basement","calvin_h_french_memorial_chapel/basement","kiewit/level_2","kiewit_building/level_2"]);function tq(n,e){if(!n)return null;const t=Yc(n),i=e?Ra(e):null;if(i){const u=`${t}/${i}`,m=dT[u];if(Number.isFinite(m))return m}const c=dT[t];return Number.isFinite(c)?c:null}function nq(n,e){if(!n||!e)return null;const t=Yc(n),i=Ra(e),c=`${t}/${i}`,u=fT[c]??fT[t];return Number.isFinite(u)?u:null}function rq(n,e){if(!n||!e)return null;const t=Yc(n),i=Ra(e),c=`${t}/${i}`,u=pT[c]??pT[t];return Number.isFinite(u)?u:null}function iq(n,e){if(!n||!e)return!1;const t=Yc(n),i=Ra(e);return QV.has(`${t}/${i}`)}function oq(n,e){if(!n||!e)return!1;const t=Yc(n),i=Ra(e);return mT.has(`${t}/${i}`)||mT.has(t)}function sq(n,e){if(!n||!e)return!1;const t=Yc(n),i=Ra(e);return gT.has(`${t}/${i}`)||gT.has(t)}function aq(n,e){if(!n||!e)return!1;const t=Yc(n),i=Ra(e);return eq.has(`${t}/${i}`)}const Wv=(n,e)=>({...n,...e}),mo=n=>{const e=String(n??"").trim();if(!e)return"";const t=Mf(e)||e;return Yc(t)},gm=n=>String(n||"").trim().toLowerCase().replace(/[^a-z0-9]/g,""),lq=/[0-9a-f]{8}(?:-[0-9a-f]{4}){3}-[0-9a-f]{12}/i,j3=n=>{const e=String(n||"").trim();if(!e)return[];const t=new Set,i=gm(e);i&&t.add(i);const c=e.match(lq);if(c&&c[0]){const u=gm(c[0]);u&&t.add(u)}return Array.from(t)},yT=n=>{const e=String(n||"").trim();if(!e)return"";const t=gm(e);return t?t.startsWith("room")&&t.length>4?t.slice(4):t:""},mg=n=>String(n||"").toLowerCase().replace(/[^a-z0-9]+/g," ").trim(),N0=n=>String(n||"").toLowerCase().replace(/&/g,"and").replace(/[^a-z0-9]+/g," ").trim(),r_=n=>n?.building??n?.buildingName??n?.buildingLabel??"",_T=(n=[])=>{const e=new Map;return(R3||[]).forEach(t=>{const i=N0(t);i&&e.set(i,t)}),(n||[]).forEach(t=>{const i=String(t?.department??"").trim(),c=N0(i);c&&e.set(c,i)}),Array.from(e.values())},vT=(n,e=[])=>{const t=N0(n);if(!t)return"";let i="",c=0;return(e||[]).forEach(u=>{const m=N0(u);m&&t.includes(m)&&m.length>c&&(i=u,c=m.length)}),i},Kv=n=>String(n||"").toLowerCase().replace(/&/g,"and").replace(/[^a-z0-9]+/g," ").trim(),xT=(n=[])=>{const e=new Map;return(dd||[]).forEach(t=>{const i=String(t?.name||"").trim(),c=Kv(i);c&&e.set(c,i)}),(n||[]).forEach(t=>{const i=String(t?.building??t?.buildingName??t?.buildingLabel??"").trim(),c=Kv(i);c&&e.set(c,i)}),Array.from(e.values())},bT=(n,e=[])=>{const t=Kv(n);if(!t)return"";let i="",c=0;return(e||[]).forEach(u=>{const m=Kv(u);m&&t.includes(m)&&m.length>c&&(i=u,c=m.length)}),i},wT=(n=[],e="")=>{const t=N0(e);if(!t)return[];const i=new Set;return(n||[]).forEach(c=>{const u=N0(c?.department??"");if(u&&u===t){const m=r_(c);m&&i.add(m)}}),Array.from(i)},h5=n=>{if(n==null)return[];const e=new Set,t=String(n);t&&e.add(t);const i=Number(t);return Number.isFinite(i)&&e.add(i),Array.from(e)},U3=n=>/^rec[a-z0-9]{6,}$/i.test(String(n||"")),Xv=n=>Array.isArray(n)&&n.length>0&&n.every(e=>U3(e)),bC=["Office - Staff","Office - Prof and Admin","Office - Prof & Admin","Office - Prof/Admin","Office - Faculty","Office - Adjunct Faculty","Office - Emeritus Faculty"],cq=bC.map(n=>n.toUpperCase()),wC=n=>String(n||"").toLowerCase().replace(/[^a-z0-9]+/g," ").replace(/\b(and|&)\b/g," ").replace(/\s+/g," ").trim(),uq=new Set(bC.map(wC).filter(Boolean)),dv=n=>uq.has(wC(n)),hq=/^[{(]?[0-9a-f]{8}(?:-[0-9a-f]{4}){3}-[0-9a-f]{12}(?:-[0-9a-f]{2,})?[)}]?$/i,dq=/^[0-9a-f]{24,}$/i,fq=/[0-9a-f]{8}(?:-[0-9a-f]{4}){3}-[0-9a-f]{12}(?:-[0-9a-f]{2,})?/i,im=n=>{const e=String(n||"").trim();return e?!!(hq.test(e)||fq.test(e)&&e.length>=24||dq.test(e)||e.includes("|")||/^[a-f0-9-]{24,}$/i.test(e)||U3(e)):!1},V3=n=>{const e=[n?.roomNumber,n?.roomLabel,n?.number,n?.Number,n?.RoomNumber,n?.Room];for(const i of e){const c=String(i??"").trim();if(c&&!im(c))return c}const t=String(n?.roomId??"").trim();return t&&!im(t)?t:""},pq=(n="")=>{const e=String(n||"").toLowerCase();return!/\bvacan(t|cy)\b/.test(e)||!/\boffice(s)?\b/.test(e)?!1:/\b(list|show|give|display|return|all|which|what)\b/.test(e)},mq=(n="")=>{const e=String(n||"").toLowerCase();return!/\bvacan(t|cy)\b/.test(e)||!/\boffice(s)?\b/.test(e)?!1:/\bhow many\b|\bcount\b|\bnumber of\b/.test(e)},gq=(n="")=>{const e=String(n||"").toLowerCase();return/\bclassroom(s)?\b/.test(e)?/\bhow many\b|\bcount\b|\bnumber of\b/.test(e):!1},yq=n=>{const e=String(n?.occupancyStatus??n?.occupancy??n?.Vacancy??n?.vacancy??"").toLowerCase();return String(n?.occupant??"").trim()||e.includes("occupied")||e.includes("assigned")&&!e.includes("unassigned")?!1:e.includes("vacant")||e.includes("available")},ST=(n=[])=>{const e=new Set,t=[];return(n||[]).forEach(i=>{const c=String(i?.type??i?.roomType??"").trim();if(!c||!c.toLowerCase().includes("office")&&!dv(c)||!yq(i))return;const m=String(r_(i)||"").trim(),_=String(i?.floor??i?.floorName??i?.floorId??"").trim(),o=V3(i),b=gm(i?.roomGuid??i?.revitId??i?.roomId??i?.id??""),I=Number(i?.areaSF??i?.area??i?.sf??0),M=Number.isFinite(I)&&I>0?Math.round(I):"",V=[m,_,o,c,M].join("|").toLowerCase();e.has(V)||(e.add(V),t.push({Building:m||"Unknown","Room Number":o,"Room Type":c,"Square Feet":M,__lookupKey:b,__floor:_}))}),t.sort((i,c)=>String(i.Building||"").localeCompare(String(c.Building||""),void 0,{sensitivity:"base"})||String(i["Room Number"]||"").localeCompare(String(c["Room Number"]||""),void 0,{numeric:!0,sensitivity:"base"})),t},_q=n=>{if(V3(n))return!1;const t=String(n?.roomId??n?.id??"").trim();return String(n?.roomGuid??n?.revitId??n?.revitUniqueId??"").trim()||!t?!0:im(t)},vq=n=>String(n||"").toLowerCase().replace(/[^a-z0-9]+/g," ").trim(),D1=n=>{const e=vq(n);return e?e.includes("classroom")?!0:e.includes("laboratory class")||e.includes("laboratory studio")||e.includes("lab class")||e.includes("lab studio"):!1},Nf=n=>{const e=String(n??"").trim();if(!e)return[];const t=new Set,i=Ra(e);t.add(i);const c=Number(e);return Number.isFinite(c)&&(t.add(`level_${c}`),c===0&&t.add("basement")),Array.from(t)},kf=(n,e)=>{if(!e?.length)return!0;const t=Nf(n);return t.length?t.some(i=>e.includes(i)):!1},F1=(n,e=[])=>{const t=h0(n);if(!t)return"";if(e.includes(t))return t;const i=Nf(t);return i.length&&e.find(c=>kf(c,i))||""};function SC(n=[]){const e=new Map,t=new Map;if(!Array.isArray(n))return{byGuid:e,byComposite:t};const i=(c,u,m)=>{if(!u)return;if(!c.has(u)){c.set(u,m);return}c.get(u)!==m&&c.set(u,null)};return n.forEach(c=>{if(!c)return;const u=c.roomGuid??c.revitId??c.revitUniqueId??c["Room GUID"]??c.roomId??"";j3(u).forEach(I=>i(e,I,c));const _=gm(c.roomId??c.roomNumber??c.roomLabel??c.id??""),o=mo(c.building??c.buildingName??c.buildingLabel??""),b=mo(c.floor??c.floorName??c.floorId??"");if(_&&o&&b){const I=`${o}|${b}|${_}`;t.has(I)||t.set(I,c)}}),{byGuid:e,byComposite:t}}function xq(n=[],e=[]){if(!Array.isArray(n)||n.length===0)return[];if(!Array.isArray(e)||e.length===0)return n;const t=SC(e);return n.map(i=>{if(!i)return i;const c=i.roomGuid??i.revitId??i.roomId??i.revitUniqueId??"",m=j3(c).reduce((I,M)=>I||t.byGuid.get(M)||null,null);if(!m)return i;const _={...i};!_.roomGuid&&m.roomGuid&&(_.roomGuid=m.roomGuid),!_.roomId&&m.roomId&&(_.roomId=m.roomId);const o=String(_.roomNumber??"").trim(),b=String(_.roomLabel??"").trim();if((!o||im(o))&&m.roomNumber){const I=String(m.roomNumber).trim();I&&!im(I)&&(_.roomNumber=I)}if((!b||im(b))&&m.roomLabel){const I=String(m.roomLabel).trim();I&&!im(I)&&(_.roomLabel=I)}return!_.building&&m.building&&(_.building=m.building),!_.floor&&m.floor&&(_.floor=m.floor),(!_.type||Xv(_.type))&&m.type&&(_.type=m.type),(!_.department||Xv(_.department))&&m.department&&(_.department=m.department),(!Number.isFinite(Number(_.areaSF))||Number(_.areaSF)<=0)&&Number.isFinite(Number(m.areaSF))&&Number(m.areaSF)>0&&(_.areaSF=Number(m.areaSF)),_})}function EC(n={},e,t,i){if(!e)return null;let c=null;const u=n.Revit_UniqueId??n.RevitUniqueId??n["Room GUID"]??n.roomGuid??"";if(j3(u).forEach(k=>{c||(c=e.byGuid.get(k)||null)}),!c){const k=gm(n.Number??n.RoomNumber??n.number??n.Room??n.roomNumber??""),ie=mo(t??n.Building??n.BuildingName??n.buildingId??""),se=mo(i??n.Floor??n.floor??"");k&&ie&&se&&(c=e.byComposite.get(`${ie}|${se}|${k}`)||null)}if(!c)return null;const _=String(c.occupancyStatus??"").trim(),o=String(c.occupant??"").trim(),b=String(c.type??"").trim(),I=String(c.department??"").trim();if(!_&&!o&&!b&&!I)return null;const M={};_&&(M.occupancyStatus=_,M.OccupancyStatus=_,M["Occupancy Status"]=_),o&&(M.occupant=o,M.Occupant=o),b&&(M.type=b,M.Type=b,M["Room Type"]=b,M["Room Type Description"]=b),I&&(M.department=I,M.Department=I);const V=Number(c.seatCount??c.SeatCount??c["Seat Count"]??0);return Number.isFinite(V)&&V>0&&(M.seatCount=V,M.SeatCount=V,M["Seat Count"]=V),M}const bq=n=>{const e=Number(n?.areaSF??n?.area??n?.sf??0);return Number.isFinite(e)&&e>0},wq=(n,e)=>{if(!n)return null;const t=n?.properties||{},i=U8(t);if(!Number.isFinite(i)||i<=0)return null;const c=(t.occupancyStatus??t["Occupancy Status"]??t.OccupancyStatus??t.vacancy??t.Vacancy??t.Occupancy??t.Status??"").toString().trim(),u=(t.occupant??t.Occupant??t.AssignedTo??t.Assignee??"").toString().trim(),m=String(t.Revit_UniqueId??t.RevitUniqueId??t["Room GUID"]??"").trim(),_=String(t.Number??t.RoomNumber??t.number??t.Room??"").trim(),o=t.Floor??t.Level??t.LevelName??t["Level Name"]??"";return{building:e||"",floor:o,areaSF:i,area:i,sf:i,roomId:_||"",roomNumber:_||"",roomLabel:_||"",roomGuid:m,department:j8(t),type:M3(t),occupancyStatus:c,occupant:u}},ET=async n=>{const e=n?.floorsByBuilding||{},t=[],i=new Map;return Array.isArray(n?.buildings)?n.buildings.forEach(u=>{u?.id&&i.set(String(u.id),u?.name||u.id)}):n?.buildings&&typeof n.buildings=="object"&&Object.entries(n.buildings).forEach(([u,m])=>{u&&i.set(String(u),m?.name||u)}),Object.entries(e).forEach(([u,m])=>{const _=i.get(String(u))||u;(m||[]).forEach(o=>{const b=typeof o=="string"?o:o?.url;b&&t.push({url:b,buildingLabel:_})})}),t.length?(await vV(t,6,async u=>{const m=await _V(u.url),_=[];return(m||[]).forEach(o=>{const b=wq(o,u.buildingLabel);b&&_.push(b)}),_})).flat():[]},AC=n=>{if(!n)return null;const e=Number(n.areaSF??n.area??n.sf??0);if(!Number.isFinite(e)||e<=0)return null;const t=String(n.department??"").trim(),i=String(n.type??"").trim(),c=String(n.occupancyStatus??"").trim(),u=String(n.occupant??"").trim();return{type:"Feature",properties:{Area_SF:e,Area:e,area:e,"Area (SF)":e,NCES_Department:t,Department:t,department:t,NCES_Type:i,__roomType:i,OccupancyStatus:c,"Occupancy Status":c,occupancyStatus:c,Occupant:u,occupant:u}}};function TC(n,e){if(n){try{n.getLayer(qf)&&n.removeLayer(qf),n.getLayer(pg)&&n.removeLayer(pg),n.getLayer(Xc)&&n.removeLayer(Xc),n.getLayer(Sp)&&n.removeLayer(Sp),n.getLayer(Wh)&&n.removeLayer(Wh),cv.forEach(t=>{n.getLayer(t)&&n.removeLayer(t)}),n.getSource(jv)&&n.removeSource(jv),n.getLayer(Uv)&&n.removeLayer(Uv),n.getLayer(Vv)&&n.removeLayer(Vv),n.getLayer(Do)&&n.removeLayer(Do),$u(n,pa)&&n.removeSource(pa),n.getLayer(M0)&&n.removeLayer(M0),n.getSource(qv)&&n.removeSource(qv),n.getLayer($v)&&n.removeLayer($v),n.getSource(GA)&&n.removeSource(GA),n.getLayer(Gv)&&n.removeLayer(Gv),n.getSource(HA)&&n.removeSource(HA)}catch{}e&&(e.current=null)}}function AT(n){try{const e=$u(n,pa),t=e?._data||e?.serialize?.()?.data,i=Au(t);if(!i)return;const c=Cu(i);c&&isFinite(c[0])&&n.fitBounds([[c[0],c[1]],[c[2],c[3]]],{padding:40,duration:500})}catch{}}function hw(n,e="department"){if(!n)return;const t=["coalesce",["get","Number"],["get","RoomNumber"],["get","name"],["literal","-"]],i=["to-string",["coalesce",["get","occupant"],["get","Occupant"],""]],c=["concat",["to-string",["round",["coalesce",["get","Area_SF"],["get","Area"],0]]]," SF"],b=e==="occupancy"?["case",["==",["get","Element"],"Room"],["concat",t,`
`,i,`
`,c],""]:["case",["==",["get","Element"],"Room"],["concat",t,`
`,["coalesce",["get","__roomType"],["get","RoomType"],["get","Room Type"],["get","Type"],["get","type"],["get","Name"],["literal","-"]],`
`,["coalesce",["get","scenarioDepartment"],["get","department"],["get","Department"],["literal","-"]],`
`,c],""],I=["interpolate",["linear"],["zoom"],14,0,15,0,16,3,17,5,18,7,19,10];if(n.getLayer(Xc)){try{n.setLayoutProperty(Xc,"text-field",b),n.setLayoutProperty(Xc,"text-size",I),n.setLayoutProperty(Xc,"symbol-placement","point"),n.setLayoutProperty(Xc,"text-allow-overlap",!1),n.setLayoutProperty(Xc,"text-ignore-placement",!1),n.setLayoutProperty(Xc,"text-max-width",6),n.setLayoutProperty(Xc,"visibility","visible"),n.setFilter(Xc,d0)}catch{}dw(n);return}try{n.addLayer({id:Xc,type:"symbol",source:pa,filter:["all",d0,["!=",["id"],-1]],layout:{"text-field":b,"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":I,"text-line-height":1,"text-variable-anchor":["center"],"text-radial-offset":0,"text-anchor":"center","text-justify":"center","symbol-placement":"point","text-allow-overlap":!1,"text-ignore-placement":!1,"text-max-width":6,visibility:"visible"},paint:{"text-color":"#0b0b0b","text-halo-color":"rgba(255,255,255,0.95)","text-halo-width":1}},Wh),dw(n)}catch{}}function dw(n){if(n)try{n.getLayer(Xc)&&n.moveLayer(Xc)}catch{}}const Sq={5:{label:"5 = Excellent condition",color:"#4CAF50"},4:{label:"4 = Good condition",color:"#8BC34A"},3:{label:"3 = Adequate condition",color:"#FFEB3B"},2:{label:"2 = Poor condition",color:"#FF9800"},1:{label:"1 = Very poor condition",color:"#F44336"}},Eq={0:"#85474b",1:"#aed6f1",2:"#5dade2",3:"#2e86c1"},Hm="#85474b",Aq=["603 E 9th St","603 E. 9th St","607 E 9th St","MacKay House","McKay House","905 N Elm St","905 N Elm Ave","Name 1","Name1","706 E. 7th St","706 E 7th St","706 E. 7th St. Residence","710 E. 7th St.","710 E 7th St","710 E. 7th St. Residence","714 E. 7th St.","714 E 7th St","714 E. 7th St. Residence","812 N Ash St","812 N Ash Ave","906 E 9th St","Campus Safety","The 1882 Residence Hall","1882 Residence Hall","Hayes M. Fuhr Hall of Music","Hayes M Fuhr Hall of Music"],Tq=Aq.map(n=>String(n||"").toLowerCase()),Iq=["downcase",["to-string",["coalesce",["get","id"],["get","name"]]]],Cq=["in",Iq,["literal",Tq]],ud=(n,e="#d1d5db")=>["case",Cq,e,n],Lq=n=>Number.isFinite(n)?n>=80?"#22c55e":n>=60?"#84cc16":n>=40?"#facc15":n>=20?"#f97316":"#ef4444":"#e5e7eb",TT=n=>{const e=String(n||"").trim().replace("#",""),t=e.length===3?e.split("").map(i=>i+i).join(""):e;return/^[0-9a-f]{6}$/i.test(t)?{r:parseInt(t.slice(0,2),16),g:parseInt(t.slice(2,4),16),b:parseInt(t.slice(4,6),16)}:null},Pq=({r:n,g:e,b:t})=>`#${[n,e,t].map(i=>Math.max(0,Math.min(255,Math.round(i))).toString(16).padStart(2,"0")).join("")}`,Lf=(n,e,t=.25)=>{const i=TT(n),c=TT(e);if(!i||!c)return n;const u=Math.max(0,Math.min(1,Number(t)||0));return Pq({r:i.r+(c.r-i.r)*u,g:i.g+(c.g-i.g)*u,b:i.b+(c.b-i.b)*u})},hm={study:{color:"#ef4444",heatValue:1,rgb:"255,69,69",haloRgb:"255,207,120"},hangout:{color:"#fb923c",heatValue:.95,rgb:"255,150,62",haloRgb:"255,218,140"},improve:{color:"#ffe44d",heatValue:.9,rgb:"255,228,77",haloRgb:"255,243,168"},outdated:{color:"#60a5fa",heatValue:.8,rgb:"82,148,255",haloRgb:"180,220,255"},rarely:{color:"#67e8f9",heatValue:.9,rgb:"78,228,250",haloRgb:"190,246,255"},unsafe:{color:"#1d4ed8",heatValue:1.03,rgb:"30,78,216",haloRgb:"142,181,255"},comment:{color:"#9ca3af",heatValue:0,rgb:"156,163,175",haloRgb:"125,250,255"}},kq={study:"Go-to Study",hangout:"Go-to Hang Out",improve:"Needs Improvement",outdated:"Outdated / Run Down",rarely:"Rarely / Never Use",unsafe:"Do Not Feel Safe",comment:"Comment"},Rq=["study","hangout","improve","rarely","outdated","unsafe","comment"],fw={study:"This is a go to study spot",hangout:"This is a go to hang out spot",improve:"I would like to use this space more, but it needs improvement",rarely:"I rarely or never use this space",outdated:"This space feels outdated or run down",unsafe:"I do not feel safe in this space",comment:"Just leave a comment"},Mq=Rq.reduce((n,e)=>{const t=fw[e];return n[t]=hm[e]?.color||"#9ca3af",n},{}),d5=24,Nq=["study","hangout","improve"],Dq=["outdated","rarely","unsafe"],Zv=["coalesce",["get","weight"],0],f5=[">",Zv,0],IT=!0,CT=[{category:"rarely",layerId:"engagement-heat-rarely"},{category:"outdated",layerId:"engagement-heat-outdated"},{category:"unsafe",layerId:"engagement-heat-unsafe"},{category:"improve",layerId:"engagement-heat-improve"},{category:"hangout",layerId:"engagement-heat-hangout"},{category:"study",layerId:"engagement-heat-study"}],__=n=>{const e=String(n||"").trim().toLowerCase();return!e||/just leave a ?comment|leave a comment about this space/.test(e)?"comment":/do not feel safe|unsafe/.test(e)?"unsafe":/rarely|never/.test(e)?"rarely":/outdated|run-down|run down/.test(e)||/furniture.*uncomfortable|layout.*not functional|lighting|temperature|technology.*inadequate|unreliable|privacy/.test(e)?"outdated":/needs improvement|need improvement|more flexible|adaptable|wish this space were more flexible|improv/.test(e)?"improve":/go[- ]to hang ?out|hang ?out/.test(e)?"hangout":/go[- ]to study|study spot|supports my teaching|professional work effectively|supports .*work effectively/.test(e)?"study":"comment"},Fq=n=>fw[__(n)]||fw.comment,Oq=n=>hm[__(n)]?.heatValue??0,LT=n=>hm[__(n)]?.color||"#9ca3af",Bq=n=>n==="outdated"||n==="rarely"||n==="unsafe",zq=n=>{const e=hm[n]?.rgb||"156,163,175",t=hm[n]?.haloRgb||e;return Bq(n)?["interpolate",["linear"],["heatmap-density"],0,"rgba(0,0,0,0)",.03,`rgba(${t},0.12)`,.1,`rgba(${t},0.24)`,.2,`rgba(${e},0.58)`,.36,`rgba(${e},0.82)`,.62,`rgba(${e},0.93)`,1,`rgba(${e},0.995)`]:["interpolate",["linear"],["heatmap-density"],0,"rgba(0,0,0,0)",.03,`rgba(${t},0.10)`,.12,`rgba(${t},0.22)`,.24,`rgba(${t},0.40)`,.4,`rgba(${e},0.66)`,.65,`rgba(${e},0.86)`,1,`rgba(${e},0.98)`]},jq=()=>["interpolate",["linear"],["heatmap-density"],0,"rgba(0,0,0,0)",.06,"rgba(255,237,128,0.20)",.22,"rgba(255,228,77,0.40)",.48,"rgba(251,146,60,0.58)",.72,"rgba(239,68,68,0.70)",1,"rgba(220,38,38,0.82)"],Uq=()=>["interpolate",["linear"],["heatmap-density"],0,"rgba(0,0,0,0)",.05,"rgba(207,250,254,0.24)",.18,"rgba(125,250,255,0.44)",.42,"rgba(56,189,248,0.62)",.7,"rgba(59,130,246,0.78)",1,"rgba(30,64,175,0.90)"],PT=n=>{const e=["coalesce",["get","weight"],0];return n==="unsafe"?["*",e,1.08]:n==="rarely"?["*",e,.95]:n==="outdated"?["*",e,.88]:n==="improve"?["*",e,.88]:n==="hangout"?["*",e,1.02]:n==="study"?["*",e,1.12]:["*",e,1]},kT=()=>["*",Zv,["match",["coalesce",["get","heatCategory"],""],"study",1.12,"hangout",1,"improve",.74,1]],RT=(n=!1)=>n?["interpolate",["linear"],["zoom"],16,1.02,18,1.14,20,1.24,22,1.32]:["interpolate",["linear"],["zoom"],10,.86,13,.96,15,1.06,17,1.16,19,1.24],MT=(n=!1)=>n?["interpolate",["linear"],["zoom"],16,20,18,30,20,44,22,60]:["interpolate",["linear"],["zoom"],10,34,12,52,14,74,16,98,18,124,20,152],NT=(n=!1)=>n?["interpolate",["linear"],["zoom"],16,.84,18,.89,20,.94,22,.97]:["interpolate",["linear"],["zoom"],10,.68,13,.72,16,.76,19,.8],DT=(n=!1)=>n?["interpolate",["linear"],["zoom"],16,1.04,18,1.14,20,1.24,22,1.32]:["interpolate",["linear"],["zoom"],10,.9,13,1,15,1.1,17,1.18,19,1.26],FT=(n=!1)=>n?["interpolate",["linear"],["zoom"],16,18,18,28,20,40,22,54]:["interpolate",["linear"],["zoom"],10,28,12,42,14,58,16,78,18,98,20,120],OT=(n=!1)=>n?["interpolate",["linear"],["zoom"],16,.82,18,.88,20,.94,22,.97]:["interpolate",["linear"],["zoom"],10,.62,13,.68,16,.74,19,.8],BT=(n,e=!1)=>e?n==="unsafe"?["interpolate",["linear"],["zoom"],16,7,18,11,20,16,22,22]:n==="rarely"||n==="outdated"?["interpolate",["linear"],["zoom"],16,8,18,12,20,18,22,24]:n==="improve"?["interpolate",["linear"],["zoom"],16,11,18,16,20,22,22,30]:["interpolate",["linear"],["zoom"],16,11,18,18,20,24,22,34]:n==="unsafe"?["interpolate",["linear"],["zoom"],10,13,12,18,14,26,16,36,18,46,20,56]:n==="rarely"||n==="outdated"?["interpolate",["linear"],["zoom"],10,14,12,22,14,30,16,40,18,52,20,64]:n==="improve"?["interpolate",["linear"],["zoom"],10,18,12,28,14,40,16,54,18,70,20,86]:["interpolate",["linear"],["zoom"],10,20,12,30,14,44,16,58,18,76,20,94],zT=(n,e=!1)=>e?n==="unsafe"?["interpolate",["linear"],["zoom"],16,1.24,18,1.34,20,1.44,22,1.56]:n==="rarely"||n==="outdated"?["interpolate",["linear"],["zoom"],16,1.16,18,1.26,20,1.36,22,1.48]:["interpolate",["linear"],["zoom"],16,1.14,18,1.24,20,1.34,22,1.46]:n==="unsafe"?["interpolate",["linear"],["zoom"],10,1.12,13,1.22,15,1.32,17,1.44,19,1.54]:n==="rarely"||n==="outdated"?["interpolate",["linear"],["zoom"],10,1,13,1.1,15,1.2,17,1.3,19,1.38]:["interpolate",["linear"],["zoom"],10,.98,13,1.08,15,1.18,17,1.3,19,1.4],jT=(n,e=!1)=>e?n==="unsafe"?["interpolate",["linear"],["zoom"],16,1,18,1,20,1,22,1]:n==="rarely"||n==="outdated"?["interpolate",["linear"],["zoom"],16,.94,18,.97,20,.99,22,1]:["interpolate",["linear"],["zoom"],16,.97,18,.99,20,1,22,1]:n==="unsafe"?["interpolate",["linear"],["zoom"],10,.88,13,.92,16,.95,19,.97]:n==="rarely"||n==="outdated"?["interpolate",["linear"],["zoom"],10,.78,13,.83,16,.89,19,.93]:["interpolate",["linear"],["zoom"],10,.85,13,.89,16,.93,19,.96],t0=(n,e,t)=>{try{if(!n?.getLayer(e))return;n.setLayoutProperty(e,"visibility",t?"visible":"none")}catch{}},Vq=(n,e="#f3f4f6")=>n?.length?["match",["to-string",["coalesce",["id"],["get","RevitId"],["get","id"]]],...n,e]:e,qq=(n,e={type:"FeatureCollection",features:[]})=>{if(!n||!n.getLayer(Do))return;const t=n.getLayer(Wh)?Wh:void 0,i=[{id:tC,band:1,opacity:.1},{id:nC,band:2,opacity:.11},{id:rC,band:3,opacity:.12},{id:iC,band:4,opacity:.13},{id:oC,band:5,opacity:.14},{id:sC,band:6,opacity:.15},{id:aC,band:7,opacity:.17},{id:lC,band:8,opacity:.19},{id:cC,band:9,opacity:.22},{id:uC,band:10,opacity:.25}];try{wV(n,jv,e),i.forEach(({id:c,band:u,opacity:m})=>{n.getLayer(c)||n.addLayer({id:c,type:"fill",source:jv,filter:["==",["get","band"],u],paint:{"fill-color":["coalesce",["get","c"],"#93c5fd"],"fill-opacity":m}},t)})}catch{}},$q=()=>{if(typeof document>"u")return"";try{const n=Array.from(document.scripts||[]).map(e=>String(e?.src||""));for(const e of n){const t=e.match(/assets\/index-([A-Za-z0-9_-]+)\.js/i);if(t?.[1])return t[1]}}catch{}return""},IC=({config:n,universityId:e,mode:t="public",persona:i,engagementMode:c=!1})=>{const u=Ao(null),m=Ao(null),_=Ao(null),o=Ao(null),b=Ao({}),I=Ao(null),M=Ao(null),V=Ao(null),[k,ie]=qn(!1),[se,de]=qn("select"),[J,ne]=qn(t==="admin"),[me,ue]=qn([]),[ke,ze]=qn({}),[pe,U]=qn({}),[F,q]=qn(null),[j,H]=qn(dd[0]?.name||""),be=n?.universityName||n?.name||""||e||"Campus",Re={SPACE_DATA:"space-data",ASSESSMENT:"assessment",TECHNICAL:"technical"},Oe=c?Re.ASSESSMENT:Re.SPACE_DATA,[Me,we]=qn(Oe),[De,tt]=qn(!!c),[xe,le]=qn(()=>{if(typeof window>"u")return!1;try{const O=new URLSearchParams(window.location.search||""),fe=String(O.get("presentation")||"").trim().toLowerCase();return fe==="1"||fe==="true"||fe==="yes"}catch{return!1}}),[Ne,Be]=qn(""),Qe=[{value:Re.SPACE_DATA,label:"Space Data"},{value:Re.ASSESSMENT,label:"Assessment Progress"},{value:Re.TECHNICAL,label:"Technical"}],rt=t==="admin"?Qe:Qe.filter(O=>O.value===Re.SPACE_DATA),[gt,pt]=qn(!0),[Mt,Jt]=qn(!1),[hn,yn]=qn(!0),[Mn,Gt]=qn(!1),[ot,dr]=qn(""),[wr,Cr]=qn("");ci(()=>{c&&Be($q())},[c]),ci(()=>{if(!(!Mn||ot))try{const O=String(window.localStorage?.getItem("MAPBOX_PUBLIC_TOKEN")??"").trim();O&&dr(O)}catch{}},[Mn,ot]),ci(()=>{const O=m.current;if(!O)return()=>{};const fe=()=>{O.querySelectorAll('.mapboxgl-popup-close-button[aria-hidden="true"]').forEach(Ye=>Ye.removeAttribute("aria-hidden"))};fe();const Ie=new MutationObserver(fe);return Ie.observe(O,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["aria-hidden"]}),()=>Ie.disconnect()},[]);const[Ln,ir]=qn(!0),Qn=$a(()=>FU(NU),[]),Kr=$a(()=>Array.from(new Set([...Object.keys(P3),...R3])).sort(),[]),[qt,Pn]=qn(null),[Hn,Bn]=qn(null),[Rr,vr]=qn(null),[Tr,Ir]=qn(null),[Pr,Si]=qn("building"),[ki,or]=qn(null),[oi,Gr]=qn({}),[Or,hi]=qn(0),[si,lt]=qn([]),[Ee,Te]=qn(new Map),[et,ht]=qn(null),Lt=Ao([]),[Rt,Ot]=qn(null),[At,Pt]=qn(""),xn=Ao(null),Un=Ao(!1),In=Ao(""),[kr,Lr]=qn(null),[jr,Er]=qn(""),Ei=Ao(null),oo=Ao(!1),_o=Ao(""),Ho=Ao(null),[so,_s]=qn(Qn),[ao,Cs]=qn(Kr),[ma,bl]=qn(new Set),[ll,Hi]=qn("__all__"),[nc,Lu]=qn(""),[To,fu]=qn("rooms"),[wa,Zo]=qn(!1),[Ha,Bl]=qn(""),[rc,Sa]=qn(!1),[ra,mn]=qn(!1),[Yo,ss]=qn(""),[_i,pu]=qn(null),[Wa,Ka]=qn(!1),[cl,Ls]=qn(!1),[er,Br]=qn(""),[Mr,js]=qn(null),[Ea,vi]=qn(!1),[Mi,wl]=qn(!1),[qi,fs]=qn(""),[zi,mu]=qn(null),[ic,Jc]=qn(!1),[yc,oc]=qn(!1),[Ma,Ps]=qn(""),[ji,Na]=qn(null),[ai,Jo]=qn(!1),[Io,vh]=qn(""),[Pu,vo]=qn(!1),[Us,ku]=qn(""),[Wo,xo]=qn(null),[zl,Da]=qn(!0),[Vs,Bo]=qn(!1),[Dc,Ko]=qn(!1),[ga,Xa]=qn(""),[ul,Qc]=qn(!1),[_c,qs]=qn(""),[Ai,Ss]=qn(null),[$s,ia]=qn(null),[oa,hl]=qn("Campus Summary"),[Gs,Hs]=qn(!1),[vc,W]=qn(null),[Ce,mt]=qn([]),[yt,$t]=qn([]),[Zt,zn]=qn(!1),[Nr,Hr]=qn(!1),[gi,Ti]=qn(""),[bo,wo]=qn(null),[Qo,Mo]=qn({buildings:{},rooms:{},campus:null}),[zo,es]=qn(!1),us=Ao(null),jo=Ao(null),Es=$a(()=>SC(Ce.length?Ce:yt),[Ce,yt]),Fc=$a(()=>Qo?.buildings||{},[Qo]),Za=$a(()=>Qo?.rooms||{},[Qo]),L=Qo?.campus||null,ae=$a(()=>{const O={};return Object.entries(Fc||{}).forEach(([fe,Ie])=>{if(!fe)return;O[fe]=Ie;const Fe=_C[fe];Fe&&(O[Fe]=Ie)}),O},[Fc]),ve=nr(O=>{if(!O)return null;const fe=Mf(O)||O;return Fc[fe]||null},[Fc]),He=nr((O,fe)=>{if(!O||!fe)return null;const Ie=Mf(O)||O,Fe=xC(Ie,fe);return Za[Fe]||null},[Za]),[Kt,pn]=qn(null),[sr,ho]=qn(!1),[Fo,Wi]=qn("unknown"),Oi=Fo==="down",No=Fo==="ok",sa=Fo==="unknown",Oo=$a(()=>({DEPARTMENT:"department",TYPE:"type",OCCUPANCY:"occupancy",VACANCY:"vacancy",PLAIN:"plain"}),[]),[$i,jl]=qn("department"),[aa,Ru]=qn(!1),[dl,xc]=qn("solid"),[ks,ya]=qn(!1),gu=(O,fe)=>{const Ie=new Set(O);return(fe||[]).forEach(Fe=>{Fe&&Ie.add(Fe)}),Array.from(Ie).sort()},ts=nr(O=>{const fe=_.current;if(!fe||!fe.getLayer(qf))return;const Ie=Array.isArray(O)?O.filter(Ye=>Ye!=null):O!=null?[O]:[];Lt.current=Ie;const Fe=Ie.length?["any",["in",["id"],["literal",Ie]],["in",["get","RevitId"],["literal",Ie]]]:["==",["id"],""];try{fe.setFilter(qf,Fe),fe.getLayer(pg)&&fe.setFilter(pg,Fe)}catch{}},[]),[Ws,Fa]=qn(new Map),[Ul,vs]=qn(!1),[Uo,Aa]=qn(null),[Ks,yu]=qn([]),[bc,eu]=qn(null),Oa=Ao([]),sc=nr((O=[])=>(O||[]).map(fe=>fe?.highlightId??fe?.revitId??fe?.roomId??null).filter(fe=>fe!=null),[]),Sl=nr((O=[])=>{const fe=sc(O);ts(fe.length?fe:null)},[sc,ts]),Vl=nr(()=>{Oa.current=[],yu([]),Sl([])},[Sl]),wc=nr(O=>{const fe=_.current,Ie=$u(fe,pa);if(!Ie)return;const Fe=Ie._data||Ie.serialize?.()?.data||null,Ye=Au(Fe);if(!Ye?.features?.length)return;const qe=new Map,Ge=new Map,St=ft=>{if(Number.isFinite(ft))return ft;const Xt=Number(ft);return Number.isFinite(Xt)?Xt:String(ft)};Ye.features.forEach(ft=>{const Xt=ft.properties||{},en=Ff(Xt);if(!Number.isFinite(en)||en<=0)return;const bn=Xt.__roomType??Xt.NCES_Type??Xt.RoomType??Xt["Room Type"]??Xt.Type??Xt.type??Xt.Name??"",un=dv(bn);let zt="",on="#e6e6e6";const fr=(cr={})=>{const ri=cr.occupancyStatus??cr["Occupancy Status"]??cr.OccupancyStatus??cr.Occupancy??cr.Vacancy??cr.vacancy??cr.Vacant??"",qr=String(ri??"").trim();if(qr){const Pi=qr.toUpperCase();return Pi.includes("VACANT")||Pi.includes("UNOCCUPIED")||Pi.includes("AVAILABLE")||Pi.includes("UNASSIGNED")?"Vacant":Pi.includes("OCCUPIED")?"Occupied":"Unknown"}return(cr.occupant??cr.Occupant??"").toString().trim()?"Occupied":"Unknown"};if(O===Oo.TYPE)zt=(Xt.__roomType||"").toString().trim()||"Unknown",on=nw(zt);else if(O===Oo.OCCUPANCY){if(!un)return;zt=fr(Xt),on=zt==="Occupied"?"#29b6f6":zt==="Vacant"?"#ff7043":"#cfd8dc"}else if(O===Oo.VACANCY){if(!un)return;zt=fr(Xt),on=zt==="Vacant"?"#ff7043":"#cfd8dc"}else zt=Zy(Xt)||"Unspecified",on=rf(zt)||"#e6e6e6";const _r=qe.get(zt)||{name:zt,areaSf:0,color:on};_r.areaSf+=en,_r.color=on,qe.set(zt,_r);const jn=St(ft.id??Xt.RevitId??Xt.id);if(jn!=null){const cr=Ge.get(zt)||[];cr.push(jn),Ge.set(zt,cr)}});const Dt=Array.from(qe.values()).map(ft=>({...ft,ids:Ge.get(ft.name)||[]})).sort((ft,Xt)=>(Xt.areaSf||0)-(ft.areaSf||0));lt(Dt),Te(new Map(Dt.map(ft=>[ft.name,ft.ids||[]])))},[Oo.OCCUPANCY,Oo.TYPE,Oo.VACANCY]),El=nr(O=>{const fe=_.current;if(!fe||!fe.getLayer(Do))return;const Ie=$u(fe,pa),Fe=Ie&&(Ie._data||Ie.serialize?.().data)||null,Ye=Au(Fe),qe=O===Oo.VACANCY?Oo.OCCUPANCY:O,Ge=c?Oo.PLAIN:qe;if(!(c&&aa)){if(Ge===Oo.PLAIN)try{fe.setPaintProperty(Do,"fill-color","#f3f4f6"),fe.setPaintProperty(Do,"fill-opacity",.86),lt([]),Te(new Map),ht(null);return}catch{}if(Ge===Oo.DEPARTMENT&&Ye?.features?.length){const St=new Map,Dt=new Map,ft=new Map,Xt=un=>{if(Number.isFinite(un))return un;const zt=Number(un);return Number.isFinite(zt)?zt:un!=null?String(un):null};Ye.features.forEach(un=>{const zt=un.properties||{},on=Zy(zt)||"Unspecified",fr=rf(on)||"#e6e6e6";St.set(on,fr);const _r=Ff(zt);if(Number.isFinite(_r)&&_r>0){const cr=Dt.get(on)||0;Dt.set(on,cr+_r)}const jn=Xt(un.id??zt.RevitId??zt.id);if(jn!=null){const cr=ft.get(on)||[];cr.push(jn),ft.set(on,cr)}});const en=[];St.forEach((un,zt)=>{en.push(zt,un)});const bn=["match",["coalesce",["feature-state","department"],["get","department"],["get","Department"],["get","Dept"],["get","NCES_Department"],["get","NCES_Dept"]],...en,"#e6e6e6"];try{fe.setPaintProperty(Do,"fill-color",bn),fe.setPaintProperty(Do,"fill-opacity",1);const un=Array.from(St.entries()).map(([zt,on])=>({name:zt,color:on,areaSf:Dt.get(zt)||0,ids:ft.get(zt)||[]})).sort((zt,on)=>(on.areaSf||0)-(zt.areaSf||0));lt(un),Te(new Map(un.map(zt=>[zt.name,zt.ids||[]])));return}catch{}}if(Ge===Oo.TYPE&&Ye?.features?.length){const St=new Map,Dt=new Map,ft=new Map,Xt=zt=>{if(Number.isFinite(zt))return zt;const on=Number(zt);return Number.isFinite(on)?on:zt!=null?String(zt):null};Ye.features.forEach(zt=>{const on=zt.properties||{},fr=(on.__roomType||"").toString().trim()||"Unknown",_r=nw(fr);St.set(fr,_r);const jn=Ff(on);if(Number.isFinite(jn)&&jn>0){const ri=Dt.get(fr)||0;Dt.set(fr,ri+jn)}const cr=Xt(zt.id??on.RevitId??on.id);if(cr!=null){const ri=ft.get(fr)||[];ri.push(cr),ft.set(fr,ri)}});const en=[];St.forEach((zt,on)=>{en.push(on,zt)});const un=["match",["case",["any",["!",["has","__roomType"]],["==",["get","__roomType"],""]],"Unknown",["get","__roomType"]],...en,"#e6e6e6"];try{fe.setPaintProperty(Do,"fill-color",un),fe.setPaintProperty(Do,"fill-opacity",1);const zt=Array.from(St.entries()).map(([on,fr])=>({name:on,color:fr,areaSf:Dt.get(on)||0,ids:ft.get(on)||[]})).sort((on,fr)=>(fr.areaSf||0)-(on.areaSf||0));lt(zt),Te(new Map(zt.map(on=>[on.name,on.ids||[]])));return}catch{}}sw(fe,Ge),wc(Ge),jl(Ge)}},[Oo.OCCUPANCY,Oo.PLAIN,Oo.TYPE,Oo.VACANCY,sw,wc,c,aa]);ci(()=>{Oa.current=Ks},[Ks]);const Oc=nr(()=>{vs(!1),Aa(null),Vl(),ts(null),bl(new Set),eu(null)},[Vl,ts]);ci(()=>{c&&(vs(!1),Aa(null),bl(new Set),eu(null),Vl(),ts(null))},[c,Vl,ts]);const lo=Uo?.targets?.length?Uo.targets:Uo?[Uo]:[],So={...(lo[0]||null)?.feature?.properties||{},...Uo?.properties||{}},la=["Occupied","Vacant","Unknown"],ca=(O={})=>O.occupancyStatus??O["Occupancy Status"]??O.OccupancyStatus??O.Occupancy??O.occupancy??"",Bc=(O={})=>O.seatCount??O.SeatCount??O["Seat Count"]??O.Seats??O.Capacity??O.rm_seats??O.SeatingCapacity??O["NCES_Seat Count"]??O.NCES_Seat_Count??O["NCES_Seat Count"]??O.NCES_SeatCount??"",kh=(O=[])=>{const fe=Array.from(new Set((O||[]).map(Ie=>(Ie??"").toString().trim()).filter(Boolean)));return fe.length?fe.length===1?fe[0]:"__MIXED__":""},_u=lo.length>1,tu=Uo?.properties?.occupancyStatus,Mu=tu!=null?String(tu).trim():"",nu=Mu.length>0,xh=_u?nu?Mu:kh(lo.map(O=>{const fe={...O?.feature?.properties||{},...O?.properties||{}};return ca(fe)})):Mu||String(ca(So)||"").trim(),Zh=Uo?.properties?.seatCount,ql=Zh!=null?String(Zh).trim():"",zc=_u?ql||kh(lo.map(O=>{const fe={...O?.feature?.properties||{},...O?.properties||{}};return Bc(fe)})):ql||String(Bc(So)||"").trim(),Xs=lo.length>0&&lo.every(O=>{const fe={...O?.feature?.properties||{},...O?.properties||{},...Uo?.properties||{}},Ie=fd(fe)||fe.type||fe["Room Type"]||fe["Room Type Description"]||"";return dv(Ie)}),vu=lo.length>0&&lo.every(O=>{const fe={...O?.feature?.properties||{},...O?.properties||{},...Uo?.properties||{}},Ie=fd(fe)||fe.type||fe["Room Type"]||fe["Room Type Description"]||"";return D1(Ie)});Kf(So,["NCES_Category","NCES Category","NCES_Category_Code","NCES Category Code"]),Kf(So,["NCES_Type","NCES Type","NCES_Type_Code","NCES Type Code"]),Kf(So,["NCES_Type Description_Sh","NCES_Type Description","NCES Type Description","NCES_Type Description_Short"]);const Sc=Ao(null),fl=Ao(null),As=Ao(null),Yu=Ao(null),$r=Ao({url:null,key:null,buildingId:null,floorId:null}),co=Ao(null),Nu=Ao({}),Ba=Ao({}),Ya=Ao(new Map),Ta=Ao(new Map);Ao({});const Ja=Ao(""),Ec=Ao(null),ua=Ao(null);Ao({});const[bh,jc]=qn(()=>c?"campus":"floor"),[mr,eo]=qn("LEVEL_1"),[pl,ru]=qn([]),ac=Ao(new Map),iu=Ao(new Map),ou=$a(()=>{const O=n?.buildings?.features||[],fe=O.find(Fe=>String(Fe?.properties?.id)===String(F));return fe||O.find(Fe=>(Fe?.properties?.name||"")===(j||""))||null},[n,F,j]),An=ou?.properties?.name||j||F||"Building",Ts=mr??(pl?.[0]||""),Vo=c&&bh==="floor",Tl=nr(O=>O?ac.current.get(O)??[]:[],[]),_a=nr(O=>{if(!O)return null;const fe=Mf(O);return fe&&rm[fe]?rm[fe]:gC.has(O)?O:null},[]),Ri=nr((O,fe)=>{const Ie=h0(fe);if(!O||!Ie)return null;const Fe=_a(O);if(!Fe||!Tl(Fe).includes(Ie))return null;const Ge=iu.current.get(Fe)?.get(Ie);if(Ge)return/^https?:\/\//i.test(Ge)?Ge:nf(Ge);const St=encodeURIComponent(iw),Dt=encodeURIComponent(Fe),ft=encodeURIComponent(Ie);return nf(`floorplans/${St}/${Dt}/Rooms/${ft}_Dept_Rooms.geojson`)},[Tl,_a]),ha=nr(async O=>{const fe=_a(O);if(!fe)return[];const Ie=Tl(fe),Fe=iu.current.has(fe);if(Ie.length&&Fe)return Ie;const Ye=await $A(fe),qe=(Ye||[]).map(St=>h0(St?.id)).filter(Boolean),Ge=new Map((Ye||[]).filter(St=>St?.id&&St?.url).map(St=>[St.id,St.url]));return ac.current.set(fe,qe),iu.current.set(fe,Ge),qe},[_a,Tl]),[Rh,wh]=qn([]),[Qr,xu]=qn(!1);Ao([]);const Mh=Ao(null),Zs=$a(()=>Ri(j,mr),[j,mr,Ri]);ci(()=>{Mh.current=Zs},[Zs]),ci(()=>{xn.current=Rt,Un.current=!!Rt},[Rt]),ci(()=>{Ei.current=kr,oo.current=!!kr},[kr]),ci(()=>{if(!k||!_.current)return;const fe=_.current.getCanvas();if(fe){if(Rt){In.current=fe.style.cursor||"",fe.style.cursor="crosshair";return}kr||(fe.style.cursor=In.current||"")}},[k,Rt]),ci(()=>{if(!k||!_.current)return;const fe=_.current.getCanvas();if(fe){if(kr){_o.current=fe.style.cursor||"",fe.style.cursor=kr==="move"?"move":"grab";return}Rt||(fe.style.cursor=_o.current||"")}},[k,kr,Rt]),ci(()=>{!k||!Zs||(El($i),hw(_.current,$i))},[k,Zs,$i,El]),ci(()=>{!k||!Zs||wc($i)},[k,Zs,$i,wc]),ci(()=>{ht(null),ts(null)},[$i,Zs,ts]),ci(()=>{Vl()},[F,Zs,Vl]),ci(()=>{Sa(!1),mn(!1),pu(null),ss(""),Ka(!1),Ls(!1),js(null),Br(""),Jo(!1),vo(!1),xo(null),ku("")},[F,j,mr]),ci(()=>{Rt&&(Ot(null),Pt(""))},[F,j,mr]),ci(()=>{kr&&(Lr(null),Er(""))},[F,j,mr]);const[Qa,Nh]=qn(!1),[Uc,Du]=qn(new Set),[gd,za]=qn({}),[Ui,da]=qn(""),[ja,su]=qn(""),[to,Il]=qn({totalSF:0,rooms:0,roomTypes:{},sfByRoomType:{}}),Dh=$a(()=>{const O=new Set([...Object.keys(to.roomTypes||{}),...Object.keys(to.sfByRoomType||{})]);return Array.from(O).map(fe=>({type:fe,count:to.roomTypes?.[fe]??0,sf:to.sfByRoomType?.[fe]??0}))},[to]),[df,el]=qn(!1),Ia=Ao(new Map),Ac=Ao(new Set),[Yh,Sh]=qn(20),[Ua,lc]=qn(null),qo=Ao(null),Gi=Ao(null),cc="scenario-highlight",tl="rgba(255, 159, 64, 0.9)",$l="#ff9f40",Ju=nr(()=>{const O=_.current;if(O&&O.getLayer(cc))try{O.removeLayer(cc)}catch{}},[]),Ca=nr((O=[])=>{if(!O.length)return;const fe=_.current;if(!fe)return;const Ie=$u(fe,pa);if(!Ie)return;const Fe=Ie._data||Ie.serialize?.()?.data,Ye=Au(Fe);if(!Ye?.features?.length)return;const qe=new Map;if(O.forEach(({revitId:ft,dept:Xt})=>{ft!=null&&qe.set(String(ft),Xt??null)}),!qe.size)return;let Ge=!1;const St=Ye.features.map(ft=>{const Xt=ft.id??ft.properties?.RevitId;if(Xt==null)return ft;const en=String(Xt);if(!qe.has(en))return ft;const bn=qe.get(en),un={...ft.properties||{}},zt=ft.properties?.scenarioDepartment??null;bn?un.scenarioDepartment=bn:delete un.scenarioDepartment;const on=un.scenarioDepartment??null;return zt===on?ft:(Ge=!0,{...ft,properties:un})});if(!Ge)return;const Dt={...Ye,features:St};try{Ie.setData(Dt)}catch{}$r.current&&($r.current={...$r.current||{},fc:Dt})},[]),La=nr((O=[],fe=Ia.current)=>{const Ie=_.current;Ie&&$u(Ie,pa)&&O.forEach(Fe=>{const Ye=fe.get(Fe);if(Ye?.revitId)try{h5(Ye.revitId).forEach(Ge=>{Ie.removeFeatureState({source:pa,id:Ge},"scenarioColor"),Ie.removeFeatureState({source:pa,id:Ge},"scenarioOutlineColor"),Ie.removeFeatureState({source:pa,id:Ge},"scenarioDepartment")})}catch{}})},[]),Jh=nr(()=>{const fe=Array.from(Ia.current.values()).filter(Ie=>Ie?.revitId!=null).map(Ie=>({revitId:Ie.revitId,dept:null}));La(Array.from(Ac.current),Ia.current),fe.length&&Ca(fe),Ia.current=new Map,Ac.current=new Set,Du(new Set),za({}),Il({totalSF:0,rooms:0,roomTypes:{},sfByRoomType:{}}),da(""),su(""),el(!1),lc(null),Sh(20),Bo(!1),Ju()},[La,Ju,Ca]),uc=nr(()=>{Jh()},[Jh]),Gl=nr(()=>{const O=_.current;if(!(!O||!$u(O,pa))&&!O.getLayer(cc))try{O.addLayer({id:cc,type:"fill",source:pa,paint:{"fill-color":["coalesce",["feature-state","scenarioColor"],tl],"fill-outline-color":["coalesce",["feature-state","scenarioOutlineColor"],$l],"fill-opacity":1},filter:["==",["get","id"],""]}),O.getLayer(Wh)&&O.moveLayer(cc,Wh),dw(O)}catch{}},[]),Cl=nr(O=>{Gl();const fe=_.current;if(!fe||!fe.getLayer(cc))return;const Ie=Array.isArray(O)?O.flatMap(qe=>h5(qe)):[],Fe=Array.from(new Set(Ie)),Ye=Fe.length?["any",["in",["id"],["literal",Fe]],["in",["get","RevitId"],["literal",Fe]],["in",["get","Revit_UniqueId"],["literal",Fe]],["in",["get","Revit Unique Id"],["literal",Fe]],["in",["get","Room GUID"],["literal",Fe]]]:["==",["id"],""];try{fe.setFilter(cc,Ye)}catch{}},[Gl]),Qu=nr(O=>{const fe={totalSF:0,rooms:0,roomTypes:{},sfByRoomType:{}},Ie=[],Fe=Ia.current;return O.forEach(Ye=>{const qe=Fe.get(Ye);if(!qe)return;const Ge=Number.isFinite(Number(qe.area))?Number(qe.area):0,St=na(qe.roomType??qe.type??"Unknown")||"Unknown";fe.rooms+=1,fe.totalSF+=Ge,fe.roomTypes[St]=(fe.roomTypes[St]||0)+1,fe.sfByRoomType[St]=(fe.sfByRoomType[St]||0)+Ge,qe.revitId!=null&&Ie.push(qe.revitId),qe.roomGuid&&qe.roomGuid!==qe.revitId&&Ie.push(qe.roomGuid)}),{totals:fe,highlightIds:Ie}},[]),ur=nr((O,fe)=>{const Ie=O?.buildingLabel&&(O?.floorName||O?.floorId)&&O?.revitId!=null?tf(O.buildingLabel,O.floorName||O.floorId,O.revitId):null,Fe=O?.roomId||Ie||O?.id||[O?.buildingLabel,O?.floorName||O?.floorId,O?.roomLabel,fe].filter(Boolean).join("|")||`cand-${fe}`,Ye=O?.roomGuid??O?.revitUniqueId??O?.revitUniqueID??null,qe=O?.revitId??Ye??null;return{roomId:Fe,buildingId:O?.buildingLabel||"",buildingName:O?.buildingLabel||"",floorName:O?.floorName||O?.floorId||"",revitId:qe,roomGuid:Ye,roomNumber:O?.roomLabel||"",roomType:O?.type||"Unspecified",department:O?.department||"",area:Number(O?.sf||0)||0}},[]),eh=nr(O=>{za(fe=>{const Ie={};return O.forEach(Fe=>{fe[Fe]&&(Ie[Fe]=fe[Fe])}),Ie})},[]),C=nr(O=>{const{totals:fe,highlightIds:Ie}=Qu(O),Fe=Ac.current,Ye=Array.from(Fe).filter(qe=>!O.has(qe));Ye.length&&La(Ye,Ia.current),Ac.current=new Set(O),Il(fe),el(O.size>0),Cl(Ie),eh(O)},[Qu,Cl,La,eh]),B=nr((O=[])=>{const fe=Ac.current;fe?.size&&La(Array.from(fe),Ia.current),Ia.current=new Map,Ac.current=new Set;const Ie=new Set;(O||[]).forEach((Fe,Ye)=>{const qe=ur(Fe,Ye);qe?.roomId&&(Ia.current.set(qe.roomId,qe),Ie.add(qe.roomId))}),Du(Ie),C(Ie)},[ur,La,C]),ee=nr(O=>{O?.roomId&&Du(fe=>{const Ie=new Set(fe);return Ie.has(O.roomId)?Ie.delete(O.roomId):(Ie.add(O.roomId),Ia.current.set(O.roomId,O)),C(Ie),Ie})},[C]),oe=nr((O,fe=.35)=>F8(O,fe),[]),Pe=nr((O,fe={})=>{const Ie=Ia.current.get(O);if(!Ie?.revitId)return;const Fe=_.current;if(!Fe||!$u(Fe,pa))return;const Ye={...fe};if(Object.keys(Ye).length)try{h5(Ie.revitId).forEach(Ge=>{Fe.setFeatureState({source:pa,id:Ge},Ye)})}catch{}},[]),Ve=nr(()=>{if(!Ui||Uc.size===0)return;const O=rf(Ui)||$l,fe=oe(O,.9);za(Fe=>{const Ye={...Fe};return Uc.forEach(qe=>{Ye[qe]=Ui,Pe(qe,{scenarioColor:fe,scenarioOutlineColor:O,scenarioDepartment:Ui})}),Ye});const Ie=[];Uc.forEach(Fe=>{const Ye=Ia.current.get(Fe);Ye?.revitId!=null&&Ie.push({revitId:Ye.revitId,dept:Ui})}),Ie.length&&Ca(Ie)},[Ui,Uc,Pe,oe,Ca]),We=nr(async()=>{if(!ji){alert("No scenario comparison available yet.");return}try{const O=new wi("p","pt","letter"),fe=O.internal.pageSize.getWidth(),Ie=O.internal.pageSize.getHeight(),Fe=36,Ye=fe-Fe*2,qe=14;let Ge=Fe;const St=(Ur=qe)=>{Ge+Ur>Ie-Fe&&(O.addPage(),Ge=Fe)},Dt=(Ur,Fr={})=>{const xi=Fr.indent||0;St(qe),O.text(String(Ur),Fe+xi,Ge),Ge+=qe},ft=(Ur,Fr={})=>{const xi=Fr.indent||0,Dn=Math.max(50,Ye-xi);O.splitTextToSize(String(Ur),Dn).forEach(dn=>Dt(dn,{indent:xi}))},Xt=Ur=>{Ur&&(St(qe*1.2),O.setFont(void 0,"bold"),O.setFontSize(12),ft(Ur),O.setFont(void 0,"normal"),O.setFontSize(11))},en=(Ur=[])=>{const Fr=Array.isArray(Ur)?Ur:[];Fr.length&&Fr.forEach(xi=>ft(`- ${xi}`,{indent:8}))},bn=(Ur={})=>{let Fr=0,xi=0,Dn=0;for(const[nn,dn]of Object.entries(Ur||{})){const Gn=String(nn||"").toLowerCase(),br=Number(dn||0)||0;Gn.includes("office")?Fr+=br:Gn.includes("class")?xi+=br:Gn.includes("lab")&&(Dn+=br)}return{offices:Fr,classrooms:xi,labs:Dn}},un=ji?.scenarioDept||Ui||"Scenario",zt=Kt?.__label||"baseline",on=An||j||F||"scenario",fr=mr?` (${mr})`:"";O.setFontSize(16),O.setFont(void 0,"bold"),Dt("Scenario Comparison"),O.setFont(void 0,"normal"),O.setFontSize(11),ft(`${un} - ${zt} to ${on}${fr}`),ji.summary&&(Xt("Summary"),ft(ji.summary)),Xt("Totals");const _r=Kt||{},jn=to||{},cr=bn(_r.roomTypes),ri=bn(jn.roomTypes);Dt(`Baseline (${zt})`),Dt(`Total SF: ${Math.round(_r.totalSF||0).toLocaleString()}`,{indent:8}),Dt(`Rooms: ${Math.round(_r.rooms||0).toLocaleString()}`,{indent:8}),(cr.offices||cr.classrooms||cr.labs)&&(Dt(`Offices: ${cr.offices}`,{indent:8}),Dt(`Classrooms: ${cr.classrooms}`,{indent:8}),Dt(`Labs: ${cr.labs}`,{indent:8})),Ge+=qe/2,Dt(`Scenario (${on})`),Dt(`Total SF: ${Math.round(jn.totalSF||0).toLocaleString()}`,{indent:8}),Dt(`Rooms: ${Math.round(jn.rooms||0).toLocaleString()}`,{indent:8}),(ri.offices||ri.classrooms||ri.labs)&&(Dt(`Offices: ${ri.offices}`,{indent:8}),Dt(`Classrooms: ${ri.classrooms}`,{indent:8}),Dt(`Labs: ${ri.labs}`,{indent:8}));const qr=(jn.totalSF||0)-(_r.totalSF||0),Vr=(jn.rooms||0)-(_r.rooms||0);Dt(`Delta SF: ${Math.round(qr).toLocaleString()}`,{indent:8}),Dt(`Delta Rooms: ${Math.round(Vr).toLocaleString()}`,{indent:8}),ji?.scenarioPros?.length&&(Xt("Pluses"),en(ji.scenarioPros)),ji?.scenarioCons?.length&&(Xt("Minuses"),en(ji.scenarioCons)),ji?.risks?.length&&(Xt("Risks / watchouts"),en(ji.risks)),ji?.notes?.length&&(Xt("Notes"),en(ji.notes)),Array.isArray(ji?.data_used)&&ji.data_used.length&&(Xt("Data used"),ft(ji.data_used.join(", ")));const Pi=(Ur,Fr)=>{if(!Ur?.data)return;O.addPage();const xi=36,Dn=O.internal.pageSize.getWidth(),nn=O.internal.pageSize.getHeight(),dn=Fr?`Floorplan - ${Fr}`:"Floorplan";O.setFont(void 0,"bold"),O.setFontSize(14),O.text(dn,xi,xi),O.setFont(void 0,"normal"),O.setFontSize(11);const Gn=Ur.height&&Ur.width?Ur.height/Ur.width:1;let br=Dn-xi*2,ei=br*Gn;const li=nn-xi*2-18;ei>li&&(ei=li,br=ei/(Gn||1));const Co=xi,Fn=xi+18;O.addImage(Ur.data,"PNG",Co,Fn,br,ei)},Ar=new Map;Uc.forEach(Ur=>{const Fr=Ia.current.get(Ur);if(!Fr)return;const xi=Fr?.buildingName||Fr?.buildingId||An||j||"",Dn=Fr?.floorName||Fr?.floorId||mr||"";if(!xi||!Dn)return;const nn=`${Yc(xi)}|${Ra(Dn)}`;Ar.has(nn)||Ar.set(nn,{buildingLabel:xi,floorLabel:Dn,ids:[]});const dn=Ar.get(nn);Fr?.revitId!=null&&dn.ids.push(Fr.revitId),Fr?.roomGuid&&Fr.roomGuid!==Fr.revitId&&dn.ids.push(Fr.roomGuid)});const Sr=[];if(Ar.size)for(const Ur of Ar.values()){const Fr=await ha(Ur.buildingLabel),xi=F1(Ur.floorLabel,Fr)||Ur.floorLabel,Dn=Ri(Ur.buildingLabel,xi);if(!Dn)continue;let nn=ms.get(Dn);if(!nn)try{nn=await hd(Dn),nn&&ms.set(Dn,nn)}catch{}const dn=Au(nn);if(!dn?.features?.length)continue;const Gn=Yg({fc:dn,colorMode:$i,solidFill:!0,selectedIds:Ur.ids,labelOptions:{hideDrawing:!0}});Gn?.data&&Sr.push({img:Gn,label:`${Ur.buildingLabel} - ${xi}`})}if(Sr.length)Sr.forEach(Ur=>Pi(Ur.img,Ur.label));else{const Ur=[];Uc.forEach(Dn=>{const nn=Ia.current.get(Dn);nn?.revitId!=null&&Ur.push(nn.revitId),nn?.roomGuid&&nn.roomGuid!==nn.revitId&&Ur.push(nn.roomGuid)});const Fr=$r?.current;let xi=Fr?.fc?Yg({...Fr,colorMode:$i,solidFill:!0,selectedIds:Ur,labelOptions:{hideDrawing:!0}}):null;if(!xi?.data&&j&&mr){const Dn=Ri(j,mr);if(Dn){let nn=ms.get(Dn);if(!nn)try{nn=await hd(Dn),nn&&ms.set(Dn,nn)}catch{}const dn=Au(nn);dn?.features?.length&&(xi=Yg({fc:dn,colorMode:$i,solidFill:!0,selectedIds:Ur,labelOptions:{hideDrawing:!0}}))}}if(xi?.data){const Dn=Fr?.floor||Fr?.floorId||mr||"";Pi(xi,Dn||"")}}const Bi=`${un}-scenario-compare`.replace(/\s+/g,"-").replace(/[^\w-]+/g,"").toLowerCase();O.save(`${Bi}.pdf`)}catch(O){console.error("Scenario export failed",O),alert("Export failed - see console for details.")}},[ji,Ui,Kt,to,An,j,F,mr,Uc,$i,ha,F1,Ri,hd]);ci(()=>{Qa&&Gl()},[Qa,Gl]),ci(()=>{if(!Qa||Uc.size===0)return;const{highlightIds:O}=Qu(Uc);Cl(O)},[Qa,Uc,Zs,Qu,Cl]);const[Je,nt]=qn(!1),[ut,Nt]=qn(null),[Yt,dt]=qn(null);ci(()=>{Je||Qa||Sl(Ks)},[Ks,Sl,Je,Qa]);const jt=O=>{const fe=m.current?.clientWidth??0,Ie=m.current?.clientHeight??0,Fe=fe||1e3,Ye=Ie||800,qe=O.x+110,Ge=O.y-160,St=Math.max(8,Ye*.15),Dt=Math.max(St,Math.min(Ye-220,Ye*.65));return{x:Math.min(Math.max(qe,8),Fe-260),y:Math.min(Math.max(Ge,St),Dt)}},Qt=nr(O=>{!O||Ua||Sh(()=>{const fe=m.current?.clientHeight??0,Ie=Math.max(360,(fe||0)*.7),Fe=Math.max(8,(fe||800)-Ie-40),Ye=O.y-120;return Math.max(8,Math.min(Ye,Fe))})},[Ua]),En=nr(()=>{Ua||Sh(O=>{const fe=m.current?.clientHeight??0,Ie=Math.max(360,(fe||0)*.7),Fe=Math.max(8,(fe||800)-Ie-40);return Math.max(8,Math.min(O-40,Fe))})},[Ua]),[y,a]=qn(null),[f,v]=qn(!1),[S,T]=qn(!1),[N,z]=qn(!1),[G,Q]=qn([]),te=nr(O=>O?Mf(O):null,[]),ge=nr(async O=>{if(!O)return null;const fe=[];if(typeof O=="string"&&O.endsWith("_Dept.geojson")){const Ge=O.replace(/\/([^/]+)$/,"/Rooms/$1");fe.push(O.replace("_Dept.geojson","_Dept_Rooms.geojson").replace(/\/([^/]+)$/,"/Rooms/$1")),fe.push(Ge),fe.push(O.replace("_Dept.geojson","_Dept_Rooms.geojson")),fe.push(O)}else fe.push(O);for(const Ge of fe)if(Ba.current[Ge])return Ba.current[Ge];let Ie=null,Fe=null;for(const Ge of fe)if(Ie=ms.get(Ge),Ie||(Ie=await hd(Ge),Ie&&ms.set(Ge,Ie)),Ie){Fe=Ge;break}if(!Ie)return console.warn("Floor summary: no data returned",O),null;const Ye=Au(Ie);if(!Array.isArray(Ye?.features))return console.warn("Floor summary: no features, skipping",Fe||O),null;const qe=O3(Ye.features);for(const Ge of fe)Ba.current[Ge]=qe;return qe},[]),Ae=nr(async(O,fe)=>{const Ie=Ri(O,fe);return Ie?ge(Ie):null},[Ri,ge]),Le=nr(async O=>{if(!O)return null;const fe=te(O)||O;if(!fe)return null;if(Nu.current[fe])return Nu.current[fe];const Ie=_a(fe);let Fe=Ie?Tl(Ie):[];if(Fe.length||(Fe=await ha(fe)),!Fe.length)return null;const Ye=fp(O),qe={totalSf:0,classroomSf:0,labSf:0,officeSf:0,rooms:0,classroomCount:0,labCount:0,officeCount:0,deptCounts:new Map};for(const St of Fe){const Dt=Ri(fe,St);if(!Dt)continue;const ft=Ra(St),Xt=`${Ye}/${ft}`;let en=Ya.current.get(Xt);en||(en=Ba.current[Dt],en||(en=await Ae(fe,St)),en&&Ya.current.set(Xt,en)),en&&(qe.totalSf+=en.totalSf||0,qe.classroomSf+=en.classroomSf||0,qe.labSf+=en.labSf||0,qe.officeSf+=en.officeSf||0,qe.rooms+=en.rooms||0,qe.classroomCount+=en.classroomCount||0,qe.labCount+=en.labCount||0,qe.officeCount+=en.officeCount||0,Object.entries(en.deptCounts||{}).forEach(([bn,un])=>{qe.deptCounts.set(bn,(qe.deptCounts.get(bn)||0)+un)}))}const Ge=Vy(qe);return Nu.current[fe]=Ge,Ge},[Ae,te,Tl,_a,Ri,ha]),Xe=nr(async O=>{if(!O)return{totalSf:void 0,rooms:void 0,classroomSf:void 0,classroomCount:void 0,labSf:void 0,labCount:void 0,officeSf:void 0,officeCount:void 0,totalsByDept:{}};if(Zt&&Array.isArray(yt)&&yt.length){const Ie=mo(O);if(Ie){const Fe=yt.filter(qe=>{const Ge=qe?.building??qe?.buildingName??qe?.buildingLabel??"";return mo(Ge)===Ie}),Ye=Jg(Fe);if(Ye)return Ye}}return await Le(O)??{totalSf:void 0,rooms:void 0,classroomSf:void 0,classroomCount:void 0,labSf:void 0,labCount:void 0,officeSf:void 0,officeCount:void 0,totalsByDept:{}}},[Le,Zt,yt]),Ue=nr(async()=>{const O=uv();return(await Promise.all(dd.map(async Ie=>{if(!Ie?.name)return null;try{return await Xe(Ie.name)}catch(Fe){return console.warn("Campus summary: failed to load building stats for",Ie.name,Fe),null}}))).forEach(Ie=>{if(!Ie)return;O.totalSf+=Ie.totalSf||0,O.classroomSf+=Ie.classroomSf||0,O.labSf+=Ie.labSf||0,O.officeSf+=Ie.officeSf||0,O.rooms+=Ie.rooms||0,O.classroomCount+=Ie.classroomCount||0,O.labCount+=Ie.labCount||0,O.officeCount+=Ie.officeCount||0;const Fe=Ie.deptCounts||Ie.totalsByDept||{};Object.entries(Fe).forEach(([Ye,qe])=>{const Ge=Number(qe)||0;O.deptCounts.set(Ye,(O.deptCounts.get(Ye)||0)+Ge)})}),Vy(O)},[Xe]);ci(()=>{let O=!1;return(async()=>{try{const Ie=await Ue();if(O)return;vr(Ie),Ir(qu(Ie,"campus"))}catch(Ie){if(O)return;console.warn("Campus summary load failed",Ie),vr(null),Ir(qu(null,"campus"))}})(),()=>{O=!0}},[Ue]);const Ze=nr(async O=>{const fe=_a(O);if(!fe)return;let Ie=Tl(fe);if(Ie.length||(Ie=await ha(O)),!!Ie.length)try{await Promise.all(Ie.map(Fe=>Ae(O,Fe)))}catch(Fe){console.warn("Floor summary prefetch failed:",Fe)}},[_a,Tl,Ae,ha]),_e=nr(O=>{if(Si("building"),Bn(null),!O){Pn(null),or(qu(null,"building"));return}const fe=te(O)||O;if(Ec.current=fe,As.current=null,$r.current={url:null,key:null,buildingId:null,floorId:null},or({loading:!0,mode:"building"}),Zt&&Array.isArray(yt)&&yt.length){const Ie=mo(O);if(Ie){const Fe=yt.filter(qe=>{const Ge=qe?.building??qe?.buildingName??qe?.buildingLabel??"";return mo(Ge)===Ie}),Ye=Jg(Fe);if(Ye){Pn(Ye),or(qu(Ye,"building"));return}}}Xe(O).then(Ie=>{Ec.current===fe&&(As.current||(Pn(Ie),or(qu(Ie,"building"))))}).catch(()=>{Ec.current===fe&&(As.current||(Pn(null),or(qu(null,"building"))))})},[Xe,te]),$e=nr(O=>{if(!O)return;Si("floor"),As.current=O,or({loading:!0,mode:"floor"});const fe=$r.current;if(Zt&&Array.isArray(yt)&&yt.length){const Fe=fe?.buildingId||F||j,Ye=fe?.floorLabel||mr||"",qe=yt.filter(St=>{const Dt=St?.building??St?.buildingName??St?.buildingLabel??"";if(mo(Dt)!==mo(Fe))return!1;if(!Ye)return!0;const ft=Nf(Ye);return ft.length?kf(St?.floor??St?.floorName??St?.floorId??"",ft):!0}),Ge=Jg(qe);if(Ge){const St={...Ge,floorLabel:Ye};Ba.current[O]=Ge,Bn(St),lt(pp(Yp(Ge.totalsByDept))),or(qu(Ge,"floor"));return}}const Ie=Ba.current[O];if(Ie){const Fe=fe?.floorLabel||mr||"";Bn({...Ie,floorLabel:Fe}),lt(pp(Yp(Ie.totalsByDept))),or(qu(Ie,"floor"));return}if(fe?.url===O&&fe?.key){const Fe=Ya.current.get(fe.key);if(Fe){const Ye=fe.floorLabel||mr||"";Bn({...Fe,floorLabel:Ye}),lt(pp(Yp(Fe.totalsByDept))),or(qu(Fe,"floor"));return}}ge(O).then(Fe=>{if(As.current!==O)return;const Ye=$r.current;Ye?.url===O&&Ye?.key&&Fe&&Ya.current.set(Ye.key,Fe);const qe=Ye?.floorLabel||mr||"";Bn(Fe?{...Fe,floorLabel:qe}:null),lt(pp(Yp(Fe?.totalsByDept))),or(qu(Fe,"floor"))}).catch(()=>{As.current===O&&(Bn(null),or(qu(null,"floor")))})},[ge,mr]),it=nr(async()=>{try{const O=await Jd("/ai/api/rooms",{cache:"no-store",timeoutMs:8e3});let fe=null;try{fe=await O.json()}catch{}if(O.ok&&fe?.ok&&Array.isArray(fe.rooms))return mt(fe.rooms),wo(new Date),!0}catch{}return!1},[]),st=nr(()=>{jo.current||(jo.current=setTimeout(()=>{jo.current=null,it()},300))},[it]),bt=nr(async()=>{if(Nr)return;Hr(!0),Ti("");const O=await it(),fe=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});Ti(O?`Refreshed ${fe}`:"Refresh failed"),Hr(!1)},[Nr,it]);ci(()=>()=>{jo.current&&(clearTimeout(jo.current),jo.current=null)},[]);const wt=nr(async O=>{if(t!=="admin"||!f||!O||!e)return null;const{buildingId:fe,buildingName:Ie,floorName:Fe,revitId:Ye,roomId:qe,roomLabel:Ge,roomNumber:St,roomGuid:Dt,properties:ft={}}=O;if(!fe||!Fe||Ye==null)return console.warn("Missing ids for room edit",O),null;const Xt=tf(fe,Fe,Ye);try{const en=u0(mh,"universities",e,"buildings",fe,"floors",Fe,"rooms",Xt),bn=String(ft.type??"").trim(),un=fd(ft)||bn,zt=dv(un),on=zt?String(ft.occupancyStatus??"").trim():"",fr=String(ft.department??"").trim(),_r=ft.occupant!=null,jn=String(ft.occupant??"").trim(),cr=ft.seatCount!=null,ri=ft.seatCount,qr=Number(ri),Vr=Number.isFinite(qr)&&qr>0?qr:null,Pi={type:bn||"",department:fr||"",comments:ft.comments||"",updatedAt:T1()};zt&&(Pi.occupant=ft.occupant||"",Pi.occupancyStatus=ft.occupancyStatus||""),cr&&(Pi.seatCount=Vr),await W5(en,Pi,{merge:!0});const Ar=ft.airtableId||ft.AirtableId||ft.airtableID||ft["Airtable ID"]||ft["Airtable Id"]||null,Sr={};on&&(Sr.occupancyStatus=on),bn&&(Sr.type=bn),fr&&(Sr.department=fr),zt&&_r&&(Sr.occupant=jn),cr&&(Sr.seatCount=Vr);const Bi=String(St??ft.roomNumber??ft.RoomNumber??ft.Number??Ge??"").trim(),Ur=String(Dt??ft.Revit_UniqueId??ft.revit_unique_id??ft.revitUniqueId??ft.RevitUniqueId??ft["Room GUID"]??ft.roomGuid??"").trim();let Fr=!1;if(Ar&&Object.keys(Sr).length)try{const nn=await Jd(`/ai/api/rooms/${Ar}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(Sr)});if(nn.ok)Fr=!0;else{const dn=await nn.text().catch(()=>"");console.warn("Airtable update failed",nn.status,dn)}}catch(nn){console.warn("Airtable update failed",nn)}if(!Fr&&(Ur||Bi)&&Object.keys(Sr).length)try{const nn=await Jd("/ai/api/rooms",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({roomId:Ur||Bi,roomGuid:Ur||void 0,building:fe,buildingName:Ie||"",floor:Fe,...Sr})});if(nn.ok)Fr=!0;else{const dn=await nn.text().catch(()=>"");console.warn("Airtable update by roomId failed",nn.status,dn)}}catch(nn){console.warn("Airtable update by roomId failed",nn)}const xi={type:ft.type||"",department:ft.department||"",occupant:zt?ft.occupant||"":ft.occupant??"",occupancyStatus:zt?ft.occupancyStatus||"":ft.occupancyStatus??"",comments:ft.comments||""};cr&&(xi.seatCount=Vr,xi.SeatCount=Vr,xi["Seat Count"]=Vr),Fa(nn=>{const dn=new Map(nn||[]),Gn=qe||Xt,br=dn.get(Gn)||{};return dn.set(Gn,{...br,...xi}),dn});let Dn=!1;$t(nn=>{if(!Array.isArray(nn)||!nn.length)return nn;const dn=ft.airtableId||ft.AirtableId||ft.airtableID||ft["Airtable ID"]||ft["Airtable Id"]||null,Gn=Wn=>String(Wn||"").trim().toLowerCase().replace(/[^a-z0-9]/g,""),br=String(qe??"").trim(),ei=String(Ge??"").trim(),li=Ye!=null?String(Ye):"",Co=ft.area??ft.areaSF??ft["Area (SF)"]??ft.Area_SF??ft.Area??null,Fn=Number(Co)||0,Eo=mo(fe),ro=mo(Fe),Rl=Gn(fe),rl=Gn(Fe),il=[];let Yi=nn.map((Wn,cu)=>{if(!Wn)return Wn;const zh=Wn.airtableId||Wn.AirtableId||Wn["Airtable ID"]||null,Vd=String(Wn.roomId??Wn.id??"").trim(),ml=mo(Wn.building??Wn.buildingName??Wn.buildingLabel??""),jh=mo(Wn.floor??Wn.floorId??Wn.floorName??""),as=Gn(Wn.building??Wn.buildingName??Wn.buildingLabel??""),gl=Gn(Wn.floor??Wn.floorId??Wn.floorName??""),Wl=Eo&&ml===Eo||Rl&&as===Rl,Sd=ro&&jh===ro||rl&&gl===rl,gf=dn&&zh&&String(zh)===String(dn)||br&&Vd===br||li&&Vd===li||ei&&Vd===ei;let pc=!1;if(!gf&&Wl&&Sd&&ei){const Ah=String(Wn.roomLabel??Wn.name??Wn.number??Wn.roomNumber??"").trim(),Yr=String(Wn.roomId??Wn.id??"").trim();pc=Ah&&Ah===ei||Yr&&Yr===ei}if(!gf&&!pc){if(ei&&!Wl&&!Sd){const Ah=String(Wn.roomId??Wn.id??"").trim();Ah&&Ah===ei&&il.push(cu)}return Wn}return Dn=!0,{...Wn,type:ft.type!=null?ft.type:Wn.type,department:ft.department!=null?ft.department:Wn.department,occupant:ft.occupant!=null?ft.occupant:Wn.occupant,occupancyStatus:ft.occupancyStatus!=null?ft.occupancyStatus:Wn.occupancyStatus,seatCount:cr?Vr:Wn.seatCount??Wn.SeatCount??Wn["Seat Count"],area:Fn>0?Fn:Wn.area??Wn.areaSF??Wn.sf??Wn.Area_SF??Wn.Area??Wn["Area (SF)"],areaSF:Fn>0?Fn:Wn.areaSF??Wn.sf??Wn.area??Wn.Area_SF??Wn.Area??Wn["Area (SF)"],sf:Fn>0?Fn:Wn.sf??Wn.areaSF??Wn.area??Wn.Area_SF??Wn.Area??Wn["Area (SF)"],roomLabel:Wn.roomLabel??Wn.name??Wn.number??Wn.roomNumber??ei,comments:ft.comments!=null?ft.comments:Wn.comments}});if(!Dn&&ei&&il.length===1){const Wn=il[0];Yi[Wn]&&(Dn=!0,Yi[Wn]={...Yi[Wn],type:ft.type!=null?ft.type:Yi[Wn].type,department:ft.department!=null?ft.department:Yi[Wn].department,occupant:ft.occupant!=null?ft.occupant:Yi[Wn].occupant,occupancyStatus:ft.occupancyStatus!=null?ft.occupancyStatus:Yi[Wn].occupancyStatus,seatCount:cr?Vr:Yi[Wn].seatCount??Yi[Wn].SeatCount??Yi[Wn]["Seat Count"],area:Fn>0?Fn:Yi[Wn].area??Yi[Wn].areaSF??Yi[Wn].sf,areaSF:Fn>0?Fn:Yi[Wn].areaSF??Yi[Wn].sf??Yi[Wn].area,sf:Fn>0?Fn:Yi[Wn].sf??Yi[Wn].areaSF??Yi[Wn].area,roomLabel:Yi[Wn].roomLabel??Yi[Wn].name??Yi[Wn].number??ei,comments:ft.comments!=null?ft.comments:Yi[Wn].comments})}if(!Dn&&ei){const Wn=Gn(ei),cu=Gn(fe),zh=Gn(Fe);Yi.some(ml=>{const jh=Gn(ml?.building??ml?.buildingName??ml?.buildingLabel??""),as=Gn(ml?.floor??ml?.floorId??ml?.floorName??""),gl=Gn(ml?.roomLabel??ml?.name??ml?.number??ml?.roomNumber??ml?.roomId??ml?.id??"");return gl&&gl===Wn&&(!cu||jh===cu)&&(!zh||as===zh)})||(Dn=!0,Yi=[...Yi,{roomId:ei,roomLabel:ei,building:fe,floor:Fe,area:Fn||0,areaSF:Fn||0,sf:Fn||0,type:ft.type||"",department:ft.department||"",occupant:ft.occupant||"",occupancyStatus:ft.occupancyStatus||"",seatCount:cr?Vr:null,comments:ft.comments||""}])}return Yi}),Fr&&st();try{const nn=$r.current;nn&&nn.url===As.current&&Ya.current.get(nn.key)&&Ya.current.delete(nn.key)}catch(nn){console.warn("Failed to invalidate floor summary cache",nn)}return Pi}catch(en){return console.error("Failed to save room edits",en),null}},[mh,e,st,t,f]);ci(()=>{if(j||!dd.length)return;const O=dd[0].name;H(O),eo("LEVEL_1")},[]),nr(O=>{const fe=_.current,Ie=m.current?.clientWidth||1e3,Fe=m.current?.clientHeight||800;if(!fe||!O?.geometry)return null;const Ye=Cu(O);if(!Ye||Ye.length!==4||Ye.some(ft=>!Number.isFinite(ft)))return null;const qe=(Ye[1]+Ye[3])/2,Ge=fe.project({lng:Ye[2],lat:qe}),St=Math.min(Math.max(Ge.x+12,8),Ie-360),Dt=Math.min(Math.max(Ge.y-120,8),Fe-260);return{x:St,y:Dt}},[]);const vt=nr(async O=>{await Ni(O)},[Ni]),kt=nr(()=>{const O=An;return{buildingLabel:Bv({buildingLabel:O,buildingId:F||j||""})||O,floorId:Ts||mr||""}},[An,F,j,Ts,mr]),Tt=nr(()=>{const O=Ts||mr||"",fe=$r.current?.url||null,Ie=$r.current?.floorAdjustBasePath||null,Fe=fe?Nd(fe):null,Ye=_a(F||j)||Fe,qe=$r.current?.floorAdjustLabel||null,Ge=$r.current?.floorAdjustFloorId||null,St=An,Dt=qe||Ye||Bv({buildingLabel:St,buildingId:F||j||""})||St,ft=Ge&&Ra(Ge)===Ra(O)?Ge:O;return{buildingLabel:Dt,floorId:ft,url:fe,basePath:Ie}},[An,F,j,Ts,mr,_a]),Vt=nr((O,fe)=>{const Ie=Yc(O||""),Fe=Ra(fe||"");return`${Ie}__${Fe}`},[]),vn=nr(async(O,fe)=>{if(!e||!O||!fe)return null;const Ie=Vt(O,fe);if(!Ie)return null;try{const Fe=u0(mh,"universities",e,"floorAdjustments",Ie),Ye=await GE(Fe);return Ye.exists()&&Ye.data()||null}catch{return null}},[mh,e,Vt]),Bt=nr(async(O,fe,Ie)=>{if(!e||!O||!fe||!Ie)return;const Fe=Vt(O,fe);if(Fe)try{const Ye=u0(mh,"universities",e,"floorAdjustments",Fe);await W5(Ye,{buildingLabel:O,floorId:fe,rotationDeg:Number.isFinite(Ie.rotationDeg)?Ie.rotationDeg:0,scale:Number.isFinite(Ie.scale)?Ie.scale:1,translateMeters:Array.isArray(Ie.translateMeters)?Ie.translateMeters:[0,0],translateLngLat:Array.isArray(Ie.translateLngLat)?Ie.translateLngLat:null,anchorLngLat:Array.isArray(Ie.anchorLngLat)?Ie.anchorLngLat:null,pivot:Array.isArray(Ie.pivot)?Ie.pivot:null,updatedAt:T1(),updatedBy:y?.uid||y?.email||null},{merge:!0})}catch{}},[mh,e,Vt,y]),ln=nr((O,fe)=>{if(!Array.isArray(O)||O.length<2||!Array.isArray(fe)||fe.length<2)return null;const[Ie,Fe]=O,[Ye,qe]=fe,Ge=Fe[0]-Ie[0],St=Fe[1]-Ie[1],Dt=qe[0]-Ye[0],ft=qe[1]-Ye[1],Xt=Math.hypot(Ge,St),en=Math.hypot(Dt,ft);if(!Number.isFinite(Xt)||!Number.isFinite(en)||Xt<=0||en<=0)return null;const bn=Math.atan2(St,Ge),un=Math.atan2(ft,Dt),zt=(bn-un)*180/Math.PI,on=Xt/en;return{rotationDeg:zt,scale:on,pivot:Ye,target:Ie}},[]);nr(()=>{Ot(null),Pt("")},[]),nr(()=>{if(!_.current||!_.current.getLayer(Do)){alert("Load a floorplan first, then start align.");return}const{buildingLabel:O,floorId:fe}=kt();if(!O||!fe){alert("Select a building and floor before aligning.");return}Pt(""),Ot({buildingLabel:O,floorId:fe,roomPts:[],drawingPts:[],step:0})},[kt]),nr(async()=>{const{buildingLabel:O,floorId:fe}=kt();if(!O||!fe)return;$U(O,fe),Pt("");const Ie=Ri(j,fe);Ie&&(ms.delete(Ie),Hu.delete(Ie)),await Ni(fe)},[kt,j,Ri,Ni]);const Wt=nr(()=>{if(!_.current||!_.current.getLayer(Do)){alert("Load a floorplan first, then rotate.");return}const{buildingLabel:O,floorId:fe}=Tt();if(!O||!fe){alert("Select a building and floor before rotating.");return}Er(""),Lr("rotate")},[Tt]),Cn=nr(()=>{if(!_.current||!_.current.getLayer(Do)){alert("Load a floorplan first, then move.");return}const{buildingLabel:O,floorId:fe}=Tt();if(!O||!fe){alert("Select a building and floor before moving.");return}Er(""),Lr("move")},[Tt]),Ut=nr(()=>{Lr(null),Er("");try{_.current?.dragPan?.enable()}catch{}},[]),rn=nr(async()=>{const{buildingLabel:O,floorId:fe}=Tt();if(!O||!fe)return;const Ie=$r.current?.floorAdjustLabel||O;GU(Ie,fe);const Fe=$r.current?.floorAdjustBasePath||null;Fe&&WU(Fe,fe);const Ye=$r.current?.url||Ri(j,fe);Ye&&HU(Ye);try{await Bt(Ie,fe,{rotationDeg:0,scale:1,translateMeters:[0,0],translateLngLat:null,anchorLngLat:null,pivot:null})}catch{}Er("");const qe=Ye||Ri(j,fe);qe&&(ms.delete(qe),Hu.delete(qe)),await Ni(fe)},[Tt,j,Ri,Ni,Bt]),Tn=kt();W8(Tn.buildingLabel,Tn.floorId),Rt&&zA[Rt.step]?.label,Rt&&Rt.step;const cn=Tt(),Nn=cn.basePath?jy(cn.basePath,cn.floorId):null,hr=cn.url?zy(cn.url):null,Dr=Ym(cn.buildingLabel,cn.floorId),rr=rw({base:Nn,url:hr,label:Dr}),Jn=rr.adjust,ni=f?{source:rr.source,labelKey:bx(cn.buildingLabel,cn.floorId),urlKey:cn.url?wx(cn.url):null,baseKey:cn.basePath?Sx(cn.basePath,cn.floorId):null,floorId:cn.floorId,url:cn.url,basePath:cn.basePath,savedAt:Jn?.savedAt||0,rotationDeg:Jn?.rotationDeg||0,scale:Jn?.scale||1,translateMeters:Jn?.translateMeters||[0,0],translateLngLat:Jn?.translateLngLat||null,anchorLngLat:Jn?.anchorLngLat||null,pivot:Jn?.pivot||$r.current?.floorAdjustBasePivot||null,storedKeys:(()=>{if(typeof window>"u"||!window.localStorage)return[];try{const O=Object.keys(window.localStorage).filter(Ie=>Ie.startsWith(q8)||Ie.startsWith($8)||Ie.startsWith(G8)),fe=Ra(cn.floorId||"");return O.filter(Ie=>fe&&Ie.includes(`/${fe}`))}catch{return[]}})()}:null,mi=Jn?.rotationDeg||0,xr=Jn?.scale||1;Jn?.translateMeters;const Ii=mp(Jn),Ci=nr(()=>{Ts&&(Ts!==mr&&eo(Ts),vt(Ts))},[Ts,vt,mr]);async function Ni(O){if(!k||!_.current)return!1;const Ie=!!(O&&typeof O=="object"&&("nativeEvent"in O||"target"in O||"preventDefault"in O))?null:O,Fe=h0(Ie||mr),Ye=Zg(F,_a)||Zg(j,_a);let qe=Ye?Tl(Ye):pl;(!qe||qe.length===0)&&Ye&&(qe=await ha(Ye));let Ge=F1(Fe,qe),St=null;if(!Ge&&qe?.length&&(Ge=qe[0]),!Ge&&Fe&&Ie&&Ye&&(!qe||qe.length===0)&&(Ge=Fe,St=nf(`floorplans/${iw}/${Ye}/Rooms/${Ge}_Dept_Rooms.geojson`),qe&&!qe.includes(Ge)&&(qe=[...qe,Ge],ac.current.set(Ye,qe))),!Ge)return alert("This floor is not available for this building."),!1;Ge!==mr&&eo(Ge);const Dt=St||Ri(j,Ge);if(!Dt)return alert("No file mapped for that floor."),!1;try{Si("floor"),Bn(null),or({loading:!0,mode:"floor"});const ft=b.current?.[Dt],Xt=Zg(F,_a)||Zg(j,_a),en=Xt?nf(`floorplans/Hastings/${Xt}`):null,bn=Dt?Nd(Dt):null,un=Ye||bn||Mf(F||j||"")||F||j,zt=en?jy(en,Ge):null,on=Dt?zy(Dt):null,fr=Ym(un,Ge),jn=rw({base:zt,url:on,label:fr}).adjust,cr=mp(jn),ri=Number(jn?.savedAt)||0,qr=await vn(un,Ge);if(qr){const dn={rotationDeg:Number(qr.rotationDeg)||0,scale:Number(qr.scale)||1,translateMeters:Array.isArray(qr.translateMeters)?qr.translateMeters:[0,0],translateLngLat:Array.isArray(qr.translateLngLat)?qr.translateLngLat:null,anchorLngLat:Array.isArray(qr.anchorLngLat)?qr.anchorLngLat:null,pivot:Array.isArray(qr.pivot)?qr.pivot:null},Gn=mp(dn),br=(()=>{const li=qr.updatedAt;return li?.toMillis?li.toMillis():Number.isFinite(li?.seconds)?li.seconds*1e3:0})();(br?br>=ri:!cr&&Gn)&&(R1(un,Ge,dn),Dt&&M1(Dt,dn),en&&N1(en,Ge,dn),Dt&&(ms.delete(Dt),Hu.delete(Dt)))}let Vr=fl.current||null;const Pi=String(F||j||"");try{const dn=Xr(Pi),Gn=Xr(Vr?.properties?.id||Vr?.properties?.name||"");(!Gn||dn&&Gn!==dn)&&(Vr=null)}catch{}if(!Vr)try{const dn=n?.buildings?.features||[],Gn=dn.find(br=>String(br.properties?.id)===Pi)||null;Gn?Vr=Gn:Vr=Rf(dn,Pi),Vr&&(fl.current=Vr)}catch{}!Vr&&ou&&(Vr=ou,fl.current=ou),Vr||(Vr=lv(_.current,Pi),Vr&&(fl.current=Vr));const Ar=tq(Vr?.properties?.id||Vr?.properties?.name||F||j,Ge),Sr=t==="admin"&&iV,Bi=await AV(_.current,Dt,ft,{fitBuilding:Vr,rotationOverrideDeg:Ar},{buildingId:F||j,floor:Ge,labelMode:$i,roomPatches:Ws,airtableLookup:Es,currentFloorContextRef:$r,roomsBasePath:en,roomsFloorId:Ge,enableWalls:Sr,wallsBasePath:en,wallsFloorId:Ge,onOptionsCollected:({typeOptions:dn,deptOptions:Gn})=>{dn?.length&&_s(br=>OU(br,dn)),Gn&&Cs(br=>gu(br,Gn))}});if(!Bi)return or(qu(null,"floor")),!1;xu(!0),hi(dn=>dn+1),As.current=Dt,Yu.current=Dt;const Ur=fp(F||j||""),Fr=Ra(Ge||""),xi=Ur&&Fr?`${Ur}/${Fr}`:null;xi&&Bi.summary&&(Ya.current.set(xi,Bi.summary),Ta.current.set(xi,Bi.rooms)),$r.current={...$r.current||{},url:Dt,key:xi,buildingId:Ur,floorId:Fr,floorLabel:Ge,floorAdjustLabel:un||$r.current?.floorAdjustLabel||null,floorAdjustFloorId:Ge,floorAdjustBasePath:en||$r.current?.floorAdjustBasePath||null};const nn=(Zt&&Array.isArray(yt)&&yt.length?Jg(yt.filter(dn=>{const Gn=dn?.building??dn?.buildingName??dn?.buildingLabel??"";if(mo(Gn)!==mo(F||j))return!1;const br=Nf(Ge);return br.length?kf(dn?.floor??dn?.floorName??dn?.floorId??"",br):!0})):null)||Bi.summary||null;if(nn){Ba.current[Dt]=nn,Ya.current.set(Dt,nn);const dn={...nn,floorLabel:Ge};Bn(dn),lt(pp(Yp(nn.totalsByDept))),As.current===Dt&&or(qu(nn,"floor"))}else Bn(null),or(qu(null,"floor"));try{El($i),wc($i)}catch{}return ir(!1),Si("floor"),Hl({x:12,y:12}),Me===Re.SPACE_DATA&&WA(_.current),!0}catch(ft){return console.error(ft),alert("Failed to load floor plan. See console for details."),xu(!1),!1}}const fo=(O,fe,Ie,Fe,Ye,qe,Ge="Key Departments")=>{if(!fe&&!qe&&!Ie?.length)return;const St=14,Dt=Fe+6,ft=24,Xt=qe||"Totals";O.setFontSize(12),O.setFont(void 0,"bold"),O.text(Xt,Dt,ft);let en=ft+St;if(O.setFont(void 0,"normal"),fe&&[fe.totalSF!=null?`Total SF: ${Math.round(fe.totalSF).toLocaleString()}`:null,fe.rooms!=null?`Rooms: ${fe.rooms}`:null,fe.classroomSf!=null?`Classroom SF: ${Math.round(fe.classroomSf).toLocaleString()}`:null,fe.classroomCount!=null?`Classrooms: ${fe.classroomCount}`:null,fe.levels!=null?`Levels: ${fe.levels}`:null].filter(Boolean).forEach(un=>{O.text(un,Dt,en),en+=St}),Ie?.length){en+=St/2,O.setFont(void 0,"bold"),O.text(Ge,Dt,en),en+=St,O.setFont(void 0,"normal");const bn=10;Ie.slice(0,8).forEach(un=>{const zt=un.color||rf(un.name);O.setFillColor(zt),O.rect(Fe+6,en-8,bn,bn,"F"),O.setTextColor("#000");const on=un.areaSf?`${un.name} (${Math.round(un.areaSf).toLocaleString()} SF)`:un.name;O.text(on,Fe+6+bn+4,en),en+=St})}},Rs=nr((O,fe={})=>{if(!Array.isArray(O)||!O.length){alert("No floorplan data to export.");return}try{const Ie=new wi("p","pt","letter"),Fe=Ie.internal.pageSize.getWidth(),Ye=Ie.internal.pageSize.getHeight(),qe=24,Ge=fe.stats||null,St=fe.keyDepts||[],Dt=fe.summaryLabel||"",ft=fe.legendTitle||"Key Departments",Xt=fe.filenameBase||"floorplan",en=!!(Ge||St&&St.length),bn=en?130:0,un=en?bn-12:0;O.forEach((on,fr)=>{const _r=on?.img;if(!_r?.data)return;fr>0&&Ie.addPage();const jn=_r.height&&_r.width?_r.height/_r.width:1,cr=en?Fe-qe*2-bn-qe:Fe-qe*2;let ri=Math.min(cr,_r.width),qr=ri*jn;const Vr=Ye-qe*2-40;qr>Vr&&(qr=Vr,ri=qr/(jn||1));const Pi=qe;Ie.addImage(_r.data,"PNG",Pi,qe+20,ri,qr),Ie.setFontSize(12);const Ar=on.label||"";if(Ar&&Ie.text(Ar,qe,qe),en){const Sr=Math.min(Fe-bn-qe,Pi+ri+qe*.75);fo(Ie,Ge,St,Sr,un,Dt||Ar,ft)}});const zt=`${Xt.replace(/\s+/g,"-").toLowerCase()}.pdf`;Ie.save(zt)}catch(Ie){console.error("Floor export failed",Ie),alert("Export failed - see console for details.")}},[]),hs=nr(async({context:O,floorStats:fe,panelStats:Ie})=>{const Fe=await Jd("/ai/explain-floor",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context:O,floorStats:fe,panelStats:Ie})}),Ye=await Fe.text();let qe=null;try{qe=JSON.parse(Ye)}catch{}if(!Fe.ok)throw new Error(qe?.error||Ye||`HTTP ${Fe.status}`);return qe},[]),hc=nr(async({context:O,campusStats:fe,panelStats:Ie})=>{const Fe=await Jd("/ai/explain-campus",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context:O,campusStats:fe,panelStats:Ie})}),Ye=await Fe.text();let qe=null;try{qe=JSON.parse(Ye)}catch{}if(!Fe.ok)throw new Error(qe?.error||Ye||`HTTP ${Fe.status}`);return qe},[]),Tc=nr(async({context:O,baselineStats:fe,scenarioStats:Ie,deltas:Fe})=>{const Ye=await Jd("/ai/compare-scenario",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context:O,baselineStats:fe,scenarioStats:Ie,deltas:Fe})}),qe=await Ye.text();let Ge=null;try{Ge=JSON.parse(qe)}catch{}if(!Ye.ok)throw new Error(Ge?.error||qe||`HTTP ${Ye.status}`);return Ge},[]),Li=nr(async({request:O,context:fe,inventory:Ie,constraints:Fe})=>{const Ye=await Jd("/ai/create-move-scenario",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({request:O,context:fe,inventory:Ie,constraints:Fe})}),qe=await Ye.text();let Ge=null;try{Ge=JSON.parse(qe)}catch{}if(!Ye.ok)throw new Error(Ge?.error||qe||`HTTP ${Ye.status}`);return Ge},[]),no=nr(async({question:O,context:fe,data:Ie})=>{const Fe=await Jd("/ai/ask-mapfluence",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:O,context:fe,data:Ie})}),Ye=await Fe.text();let qe=null;try{qe=JSON.parse(Ye)}catch{}if(!Fe.ok)throw new Error(qe?.error||Ye||`HTTP ${Fe.status}`);return qe},[]),po=nr(async({context:O,buildingStats:fe,panelStats:Ie})=>{const Fe=await Jd("/ai/explain-building",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context:O,buildingStats:fe,panelStats:Ie})}),Ye=await Fe.text();let qe=null;try{qe=JSON.parse(Ye)}catch{}if(!Fe.ok)throw new Error(qe?.error||Ye||`HTTP ${Fe.status}`);return qe},[]),Ms=nr(async()=>{ss(""),mn(!0),pu(null);try{const O=$r.current,fe={universityId:e,buildingId:O?.buildingId||F||j||"",buildingLabel:O?.buildingLabel||"",floorId:O?.floorId||mr||"",floorLabel:O?.floorLabel||Hn?.floorLabel||mr||"",url:O?.url||""},Ie=await hs({context:fe,floorStats:Hn,panelStats:ki});pu(Ie),Sa(!0)}catch(O){ss(String(O?.message||O))}finally{mn(!1)}},[hs,Hn,ki,F,j,mr,e]),nl=nr(async()=>{fs(""),wl(!0),mu(null);try{const O=$s?{totalSf:Math.round($s.totalSf||0),rooms:Math.round($s.roomCount||0),totalsByDept:Object.fromEntries(($s.byDept||[]).map(Fe=>[Fe.name,Math.round(Number(Fe.sf||0))])),byType:($s.byType||[]).map(Fe=>({type:Fe.name,sf:Math.round(Number(Fe.sf||0))})),occupancySummary:$s.occupancySummary||null,officeOccupancy:$s.officeOccupancy||null}:null,Ie=await hc({context:{universityId:e,campusLabel:be||e||"Campus",buildingId:"",buildingLabel:"",floorId:"",floorLabel:"",url:""},campusStats:O||Rr,panelStats:Tr});mu(Ie),vi(!0)}catch(O){fs(String(O?.message||O))}finally{wl(!1)}},[be,Tr,Rr,$s,hc,e]),$o=nr(async()=>{Ps(""),oc(!0),Na(null);try{if(!to)throw new Error("No scenario totals available. Turn on Move Scenario Mode and make changes.");if(!Ui)throw new Error("Select a department for the scenario before comparing.");const{perBuilding:O,campusTotals:fe}=await tT(Ui,{ensureFloorsForBuilding:ha,buildFloorUrl:Ri,floorCache:ms,fetchGeoJSON:hd});if(!fe)throw new Error("No baseline stats for the selected department on this campus.");const Fe=na(An||j||F||"").toLowerCase(),Ye=Object.entries(O||{}).sort((zt,on)=>(on[1]?.totalSF||0)-(zt[1]?.totalSF||0)||(on[1]?.rooms||0)-(zt[1]?.rooms||0)),qe=Ye.find(([zt])=>na(zt).toLowerCase()!==Fe)||Ye[0]||null,Ge=qe?qe[0]:"campus",St=qe?qe[1]:fe;St&&(St.__label=Ge||"campus");const Dt="campus",ft=F||j||"",Xt=Mf(F||j)||j||F||"",en={universityId:e,baselineScope:Dt,buildingId:ft,buildingLabel:An||"",floorId:mr||"",scenarioDepartment:Ui,baselineLabel:`Current allocation for ${Ui} (${Ge})`};console.log("Scenario compare baseline (dept campus-wide):",St),console.log("Scenario compare scenario (selection totals):",to),pn(St);const bn={totalSF:(to?.totalSF||0)-(St?.totalSF||0),rooms:(to?.rooms||0)-(St?.rooms||0)},un=await Tc({context:en,baselineStats:St,scenarioStats:to,deltas:bn,scenarioDept:Ui||""});Na(un),Jc(!0)}catch(O){Ps(String(O?.message||O))}finally{oc(!1)}},[An,Tc,Ui,to,An,ha,Ri,ms,hd,j,F,mr,e]);ci(()=>{Vs&&(!Ui||!to?.rooms||(Bo(!1),$o()))},[Vs,Ui,to,$o]);const Ns=nr(async()=>{Br(""),Ls(!0),js(null);try{const Ie=await po({context:{universityId:e,buildingId:F||j||"",buildingLabel:An||"",floorId:"",floorLabel:"",url:""},buildingStats:qt,panelStats:ki});js(Ie),Ka(!0)}catch(O){Br(String(O?.message||O))}finally{Ls(!1)}},[An,qt,po,ki,j,F,e]);ci(()=>{const O=N8();if(typeof window<"u"&&window.location.hostname.includes("github.io"))return Wi(O?"ok":"down"),()=>{};if(!O)return Wi("down"),()=>{};const Ie=eC("/ai/health"),Fe=async()=>{try{const qe=await Jd(Ie,{cache:"no-store",timeoutMs:3e3});Wi(qe.ok?"ok":"down")}catch{Wi("down")}};Fe();const Ye=setInterval(Fe,3e4);return()=>clearInterval(Ye)},[]);const ps=nr(()=>{const O=$r?.current;if(!O?.fc){alert("No floor loaded.");return}const fe=et?Ee.get(et)||[]:[],Ie=sc(Oa.current||[]),Fe=Lt.current||[],Ye=Array.from(new Set([...fe||[],...Ie||[],...Fe||[]])),qe=Yg({...O,colorMode:$i,selectedIds:Ye,solidFill:!0,labelOptions:{hideDrawing:!0}});if(!qe){alert("Unable to render floorplan.");return}const Ge=`${An} - ${O.floorLabel||mr||""}`.trim()||"Floor",St=O?.url?Ba.current[O.url]:null,Dt=Hn??(St?{...St,floorLabel:O.floorLabel||mr}:null),ft=si&&si.length?si:pp(Dt?.totalsByDept),Xt={department:"Key Departments",type:"Key Types",occupancy:"Occupancy",vacancy:"Vacancy"}[$i]||"Legend";Rs([{img:qe,label:Ge}],{filenameBase:`${An}-${O.floorLabel||mr||"floor"}`,stats:Dt,keyDepts:ft,summaryLabel:`${An} - ${O.floorLabel||mr||""} (${$i||"department"})`,legendTitle:Xt})},[An,mr,Rs,$i,si]),ns=nr(()=>{TC(_.current,As);try{const fe=_.current;fe?.getLayer(M0)&&fe.removeLayer(M0),fe?.getSource(qv)&&fe.removeSource(qv)}catch{}xu(!1),c&&jc("campus"),Ja.current="",As.current=null,Yu.current=null,$r.current={url:null,key:null,buildingId:null,floorId:null},Bn(null),Si("building");const O=Sc.current||j;O&&_e(O)},[j,_e,c]);nr(()=>{AT(_.current)},[]);const xs=nr(()=>{const O=!Qa;Nh(O),O?(el(!0),lc(null),Sh(20)):uc()},[uc,Qa,el]),dc=nr(()=>{try{const O={markers:me,buildingConditions:ke,buildingAssessments:pe},fe=new Blob([JSON.stringify(O,null,2)],{type:"application/json"}),Ie=document.createElement("a");Ie.href=URL.createObjectURL(fe),Ie.download=`${e||"campus"}-map-data.json`,document.body.appendChild(Ie),Ie.click(),document.body.removeChild(Ie)}catch(O){console.warn("Export failed",O),alert("Export failed. See console for details.")}},[me,ke,pe,e]);nr(()=>{alert("Export Drawing Entries not implemented in this build.")},[]);const Ds=nr(async(O="__all__",fe="")=>{const Ie=O&&O!=="__all__"?[O]:dd.map(qe=>qe.name).filter(Boolean),Fe=fe.toLowerCase().trim(),Ye=[];for(const qe of Ie){if(!qe)continue;const Ge=await ha(qe);if(Ge?.length)for(const St of Ge){const Dt=Ri(qe,St);if(!Dt)continue;let ft;try{const Xt=await hd(Dt);ft=Au(Xt)}catch(Xt){console.warn("Space export: failed to load",Dt,Xt);continue}if(ft?.features?.length)for(const Xt of ft.features){const en=Xt?.properties||{},bn=Xt?.id??en.RevitId??en.id,un=qe&&St&&bn!=null?tf(qe,St,bn):null,zt=un&&Ws instanceof Map?Ws.get(un):null,on=zt?{...en,...zt}:en,fr=on.Number??on.RoomNumber??on.number??on.Room??"",_r=fd(on)||on.Name||"",jn=(on.department??on.Department??on.Dept??"").toString().trim();if(Fe&&!jn.toLowerCase().includes(Fe))continue;const cr=Ff(on),ri=e5(on),qr=on.occupant??on.Occupant??"";Ye.push({building:qe,floor:St,roomNumber:fr||"",type:_r||"",department:jn||"",area:Number.isFinite(cr)?cr:"",seatCount:ri??"",occupant:qr||"",roomId:un||"",revitId:bn??null})}}}return Ye},[Ri,ha,Ws]);nr(async()=>{const O=await Ds("__all__","");return s5(O,250)||[]},[Ds]);const Ic=nr(async(O="__all__",fe="")=>{const Ie=O&&O!=="__all__"?[O]:dd.map(Xt=>Xt.name).filter(Boolean),Fe=fe.toLowerCase().trim(),Ye=[],qe=uv(),Ge=(Xt,en,bn)=>{if(!Xt)return null;const un=on=>Number.isFinite(on)?Math.round(on):"",zt=on=>Number.isFinite(on)?Number(on):0;return{buildingId:bn||fp(en||""),buildingName:en||"",totalSf:un(Xt.totalSf),rooms:zt(Xt.rooms),classroomSf:un(Xt.classroomSf),classrooms:zt(Xt.classroomCount),labSf:un(Xt.labSf),labs:zt(Xt.labCount),officeSf:un(Xt.officeSf),offices:zt(Xt.officeCount),keyDepts:(Xt.keyDepts||[]).join("; ")}};for(const Xt of Ie){if(!Xt)continue;const en=await ha(Xt);if(!en?.length)continue;const bn=uv();for(const on of en){const fr=Ri(Xt,on);if(!fr)continue;let _r=ms.get(fr);_r||(_r=await hd(fr),_r&&ms.set(fr,_r));const jn=Au(_r);if(jn?.features?.length)for(const cr of jn.features){const ri=cr?.properties||{},qr=cr?.id??ri.RevitId??ri.id,Vr=Xt&&on&&qr!=null?tf(Xt,on,qr):null,Pi=Vr&&Ws instanceof Map?Ws.get(Vr):null,Ar=Pi?{...ri,...Pi}:ri,Sr=(Ar.department??Ar.Department??Ar.Dept??"").toString().trim();Fe&&!Sr.toLowerCase().includes(Fe)||(aw(bn,Ar),aw(qe,Ar))}}const un=Vy(bn),zt=un?Ge(un,Xt):null;zt&&(zt.rooms||zt.totalSf)&&Ye.push(zt)}const St=Vy(qe);return{campusRow:(!O||O==="__all__")&&St&&(St.rooms||St.totalSf)?Ge(St,"Campus Total","campus"):null,buildingRows:Ye}},[Ri,ha,Ws]),yd=nr(async()=>{ku(""),vo(!0),xo(null);try{if(Fo==="down")throw new Error("AI server is offline.");const O=(Io||"").trim();if(!O)throw new Error("Enter a short request for the move scenario.");const fe=Zt&&Array.isArray(yt)?yt:[],Ie=_T(fe),Fe=Ui||vT(O,Ie)||"",Ye=Fe?wT(fe,Fe):[],qe=new Set((Ye||[]).map(Dn=>mo(Dn)).filter(Boolean)),Ge=xT(fe),St=bT(O,Ge)||"",Dt=St||"",ft="";let Xt=[];if(Zt&&Array.isArray(yt)&&yt.length)Xt=s5(yt,2e3)||[];else try{const Dn=await Ds("__all__","");Xt=s5(Dn,250)||[]}catch{}if(!Xt.length){const Dn=$r?.current?.fc?.features||[];Xt=MV(Dn,Dt,ft,250)||[]}if(!Xt.length)throw new Error("No room inventory loaded yet. Load Space Data or a floorplan first.");if(St){const Dn=mo(St),nn=Xt.filter(dn=>{const Gn=dn?.buildingLabel??dn?.building??dn?.buildingName??"";return mo(Gn)===Dn});if(!nn.length)throw new Error(`No rooms found for ${St}.`);Xt=nn}if(qe.size){const Dn=Xt.filter(nn=>{const dn=nn?.buildingLabel??nn?.building??nn?.buildingName??"";return!qe.has(mo(dn))});if(!Dn.length)throw new Error(`No rooms available outside the current ${Fe||"department"} home building(s).`);Xt=Dn}Xt=hC(Xt);let en=null,bn="";if(Fe)try{const{perBuilding:Dn,campusTotals:nn}=await tT(Fe,{ensureFloorsForBuilding:ha,buildFloorUrl:Ri,floorCache:ms,fetchGeoJSON:hd}),dn=Object.entries(Dn||{}).sort((Gn,br)=>(br[1]?.totalSF||0)-(Gn[1]?.totalSF||0)||(br[1]?.rooms||0)-(Gn[1]?.rooms||0))[0]||null;en=dn?dn[1]:nn,bn=dn?dn[0]:"",en&&(en={...en,__label:bn||"campus"})}catch{}const un=St?{maxTotal:260,maxPerBuilding:260,maxPerType:35}:{maxTotal:220,maxPerBuilding:90,maxPerType:25};en&&Xt.length>un.maxTotal?Xt=RV(Xt,en,{maxTotal:un.maxTotal,minPerType:St?8:5,maxPerType:St?45:35}):Xt=dC(Xt,un);const zt=new Map;Xt.forEach(Dn=>{if(!Dn)return;[Dn.roomId,Dn.id,Dn.revitId].filter(dn=>dn!=null).map(dn=>String(dn)).forEach(dn=>{zt.has(dn)||zt.set(dn,Dn)})});const on=Dn=>{if(!Dn||!Xt.length)return null;const nn=mo(Dn?.buildingLabel||""),dn=Nf(Dn?.floorName||Dn?.floorId||""),Gn=yT(Dn?.roomLabel||Dn?.roomNumber||"");if(Gn){const Eo=Xt.find(ro=>{const Rl=mo(ro?.buildingLabel??ro?.buildingName??ro?.building??"");if(nn&&Rl!==nn||dn.length&&!kf(ro?.floorName??ro?.floorId??"",dn))return!1;const rl=yT(ro?.roomLabel??ro?.roomNumber??"");return rl&&rl===Gn});if(Eo)return Eo}const br=mg(Dn?.type||""),ei=Number(Dn?.sf||0),li=Number.isFinite(ei)&&ei>0;let Co=null,Fn=Number.POSITIVE_INFINITY;return Xt.forEach(Eo=>{const ro=mo(Eo?.buildingLabel??Eo?.buildingName??Eo?.building??"");if(nn&&ro!==nn||dn.length&&!kf(Eo?.floorName??Eo?.floorId??"",dn))return;const Rl=mg(Eo?.type||Eo?.roomType||"");let rl=0;if(br&&Rl?rl+=Rl===br?0:1e3:br&&(rl+=500),li){const il=Number(Eo?.sf??Eo?.area??Eo?.areaSF??0);Number.isFinite(il)&&(rl+=Math.abs(il-ei))}rl<Fn&&(Fn=rl,Co=Eo)}),Co},fr={universityId:e,campusLabel:be||e||"Campus",buildingLabel:St||"",floorId:ft,moveScenarioMode:!0,scenarioDepartment:Ui||Fe||"",targetDepartment:Fe||Ui||"",excludeBuildings:Ye||[],scenarioLabel:(ja||"").trim(),scope:St?"building":"campus"},_r=en?{totalSF:Math.round(en.totalSF||0),rooms:Math.round(en.rooms||0),sfByType:Object.entries(en.sfByRoomType||{}).map(([Dn,nn])=>({type:Dn,sf:Math.round(Number(nn||0)||0)})),roomTypes:Object.entries(en.roomTypes||{}).map(([Dn,nn])=>({type:Dn,count:Math.round(Number(nn||0)||0)}))}:null,jn=_r?{baselineTotals:_r,targetSfTolerance:zl?.05:.1}:null,cr=await Li({request:O,context:fr,inventory:Xt,constraints:jn}),ri=Array.isArray(cr?.recommendedCandidates)?cr.recommendedCandidates.map(Dn=>{const dn=[Dn?.roomId,Dn?.id,Dn?.revitId].filter(ei=>ei!=null).map(ei=>String(ei)).map(ei=>zt.get(ei)).find(Boolean)||on(Dn);if(!dn)return{...Dn,floorName:Dn?.floorName||Dn?.floorId||"",rationale:a5(Dn?.rationale)};const Gn=Number(dn.sf??dn.area??dn.areaSF??0),br=Number(Dn?.sf??0);return{...Dn,roomId:Dn?.roomId||dn.roomId||dn.id||"",id:Dn?.id||dn.id||dn.roomId||"",revitId:Dn?.revitId??dn.revitId??null,roomGuid:Dn?.roomGuid??dn.roomGuid??dn.revitId??null,buildingLabel:Dn?.buildingLabel||dn.buildingLabel||dn.buildingName||dn.building||"",roomLabel:Dn?.roomLabel||dn.roomLabel||dn.roomNumber||"",type:Dn?.type||dn.type||dn.roomType||"",sf:Number.isFinite(br)&&br>0?br:Number.isFinite(Gn)?Gn:0,vacancy:dn.vacancy??Dn.vacancy,occupant:dn.occupant??Dn.occupant,occupancyStatus:dn.occupancyStatus??Dn.occupancyStatus,occupantDept:dn.occupantDept??Dn.occupantDept,department:dn.department??Dn.department,floorName:Dn?.floorName||Dn?.floorId||dn.floorName||dn.floorId||"",rationale:a5(Dn?.rationale)}}):[],qr=na(St||eT(ri)||"");let Vr=ri,Pi="";if(en){const{candidates:Dn,added:nn}=ZA(ri,Xt,en,{targetTolerance:jn?.targetSfTolerance??.1,maxCandidates:zl?40:30,primaryBuilding:qr});nn>0&&(Vr=Dn,Pi=`Auto-filled ${nn} rooms to better match baseline SF and room-type mix.`)}const Ar=Dn=>JA(Dn?.type)||YA(Dn?.type),Sr=qr||eT(Vr)||"";if(Sr){const Dn=Vr.filter(nn=>na(nn?.buildingLabel||"")===Sr?!0:Ar(nn));if(Dn.length&&(Vr=Dn,Pi=`${Pi?Pi+" ":""}Constrained scenario to a single building (${Sr}), allowing labs/classrooms to remain outside if needed.`),en){const nn=Xt.filter(br=>{if(na(br?.buildingLabel??br?.building??br?.buildingName??"")===Sr)return!0;const li=br?.type??br?.roomType??"";return JA(li)||YA(li)}),{candidates:dn,added:Gn}=ZA(Vr,nn,en,{targetTolerance:jn?.targetSfTolerance??.1,maxCandidates:zl?40:30,primaryBuilding:Sr});Gn>0&&(Vr=dn,Pi=`${Pi?Pi+" ":""}Auto-filled ${Gn} rooms to better match baseline SF.`)}}Vr=pC(Vr,Sr);const Bi=en?.totalSF||cr?.baselineTotals?.totalSF||0,Ur=Math.round((jn?.targetSfTolerance??.1)*100),Fr=Bi?[`Aim for total SF within +/-${Ur}% of baseline department total SF (${Math.round(Bi).toLocaleString()} SF).`]:[],xi=Array.isArray(cr?.selectionCriteria)?cr.selectionCriteria.filter(Dn=>!/baseline|total\s*sf|sf within/i.test(Dn||"")):[];xo({...cr,baselineTotals:en||cr?.baselineTotals,selectionCriteria:[...Fr,...Pi?[Pi]:[],...xi],recommendedCandidates:Vr}),Jo(!1)}catch(O){ku(String(O?.message||O))}finally{vo(!1)}},[An,be,Io,Fo,Zt,yt,Ds,Li,ha,Ri,hd,Ui,ja,j,mr,e]),Ys=nr(async()=>{qs(""),Qc(!0),Ss(null);try{const O=(ga||"").trim();if(!O)throw new Error("Type a question first.");const fe=Zt&&Array.isArray(yt)?yt:[],Ie=_T(fe),Fe=vT(O,Ie)||"",Ye=xT(fe),qe=bT(O,Ye)||"",Ge=/best new suitable home|suitable home|best home|relocat|move|find space|new home|anywhere|entire campus|campus[-\s]?wide|across campus/i.test(O),St=/\b(basement|ground floor|first floor|second floor|third floor|fourth floor|fifth floor|sixth floor|seventh floor|eighth floor|ninth floor|tenth floor|level\s*\d+|level\s*(one|two|three|four|five|six|seven|eight|nine|ten)|lvl\s*\d+|floor\s*\d+|floor\s*(one|two|three|four|five|six|seven|eight|nine|ten))\b/i.test(O),Dt=/\b(entire campus|campus[-\s]?wide|across campus|anywhere on campus)\b/i.test(O)||/\bwhere\s+(is|are)\b|\blocation of\b|\bwhere\b.*\b(located|location)\b|\bwhich building\b|\bwhat building\b/i.test(O)&&!qe,ft=Ge&&Fe?wT(fe,Fe):[],Xt=new Set((ft||[]).map(nn=>mo(nn)).filter(Boolean)),en={first:1,second:2,third:3,fourth:4,fifth:5,sixth:6,seventh:7,eighth:8,ninth:9,tenth:10},bn=(()=>{if(!St)return"";const nn=O.toLowerCase();if(nn.includes("basement"))return"BASEMENT";if(nn.includes("ground floor"))return"LEVEL_1";const dn=nn.match(/level\s*(\d+)/);if(dn)return`LEVEL_${dn[1]}`;const Gn=nn.match(/floor\s*(\d+)/);if(Gn)return`LEVEL_${Gn[1]}`;const br=nn.match(/\b(first|second|third|fourth|fifth|sixth|seventh|eighth|ninth|tenth)\s+floor\b/);return br?`LEVEL_${en[br[1]]}`:""})(),un=qe||"",zt=qe||"",on=!qe||Ge||Dt,fr=!on&&!!qe&&!!bn,_r={universityId:e,campusLabel:be||e||"Campus",buildingId:un,buildingLabel:qe||"",floorId:fr?bn:"",scope:on?"campus":fr?"floor":qe?"building":"campus",targetDepartment:Fe||"",excludeBuildings:ft||[]},jn=(()=>{if(!Zt)return[];if(on||!qe)return yt;const nn=mo(qe);if(!nn)return yt;const dn=yt.filter(br=>{const ei=br?.building??br?.buildingName??br?.buildingLabel??"";return mo(ei)===nn});if(!fr)return dn;const Gn=Nf(bn);return Gn.length?dn.filter(br=>kf(br?.floor??br?.floorName??br?.floorId??"",Gn)):dn})(),cr=Xt.size?jn.filter(nn=>{const dn=r_(nn);return!Xt.has(mo(dn))}):jn,ri=(nn,dn={})=>{if(!Array.isArray(nn))return[];const Gn=Number(dn.maxRows||400);if(nn.length<=Gn)return nn;const br=mo(dn.inferredDept||"");let ei=nn;if(br&&(ei=nn.filter(ro=>{const Rl=String(ro?.department??ro?.occupantDept??"").trim();return mo(Rl)===br}),ei.length<=Gn))return ei;const li=new Map;ei.forEach(ro=>{const Rl=mo(r_(ro));li.has(Rl)||li.set(Rl,[]),li.get(Rl).push(ro)});const Co=Math.max(1,Math.floor(Gn/Math.max(1,li.size||1))),Fn=[];if(li.forEach(ro=>{Fn.push(...ro.slice(0,Co))}),Fn.length>=Gn)return Fn.slice(0,Gn);const Eo=ei.filter(ro=>!Fn.includes(ro));return Fn.concat(Eo.slice(0,Math.max(0,Gn-Fn.length)))};if(gq(O)){const nn=cr.filter(Gn=>D1(Gn?.type??Gn?.roomType??"")),dn=on?"campus":qe||"selected scope";Ss({answer:`Found ${nn.length.toLocaleString()} classrooms in ${dn}.`,bullets:["Count is based on room type labels that include classroom/teaching room definitions."],resultType:"none",columns:[],rows:[],dataUsed:["roomRows"],missingData:[]});return}if(mq(O)){const nn=ST(cr),dn=on?"campus":qe||"selected scope";Ss({answer:`Found ${nn.length.toLocaleString()} vacant offices in ${dn}.`,bullets:["Only rooms marked vacant/available and without an occupant are counted."],resultType:"none",columns:[],rows:[],dataUsed:["roomRows"],missingData:nn.length?[]:["Vacancy status","Room inventory"]});return}if(pq(O)){let nn=ST(cr);if(nn.some(br=>!String(br?.["Room Number"]||"").trim()))try{const ei=await Ds(on?"__all__":zt||"__all__",""),li=new Map;(ei||[]).forEach(Co=>{const Fn=String(Co?.roomNumber??"").trim();if(!Fn||im(Fn))return;const Eo=gm(Co?.revitId??Co?.roomId??"");Eo&&(li.has(Eo)||li.set(Eo,Fn))}),nn=nn.map(Co=>{if(String(Co?.["Room Number"]||"").trim())return Co;const Eo=gm(Co?.__lookupKey??"");if(!Eo)return Co;const ro=li.get(Eo)||"";return ro?{...Co,"Room Number":ro}:Co})}catch{}const dn=on?"campus":qe||"selected scope",Gn=nn.length?`Found ${nn.length.toLocaleString()} vacant offices in ${dn}.`:`No vacant offices were found in ${dn} with explicit vacancy data.`;Ss({answer:Gn,bullets:["Only rooms marked as vacant/available and not currently assigned to an occupant are included."],resultType:nn.length?"table":"none",columns:nn.length?["Building","Room Number","Room Type","Square Feet"]:[],rows:nn,dataUsed:["roomRows"],missingData:nn.length?[]:["Vacancy status","Room inventory"]});return}const qr=/\bwhere\s+(is|are)\b|\blocation of\b|\bwhere\b.*\b(located|location)\b|\bwhich building\b|\bwhat building\b/i.test(O),Vr=(()=>{const nn=[];if(Fe&&nn.push(Fe),/\bpresident'?s?\b/i.test(O)&&nn.push("president"),/\bprovost\b/i.test(O)&&nn.push("provost"),/\bdean\b/i.test(O)&&nn.push("dean"),!nn.length)return[];const dn=nn.map(Gn=>mo(Gn)).filter(Boolean);return cr.filter(Gn=>{const br=String(Gn?.department??Gn?.occupantDept??"").trim(),ei=String(Gn?.occupant??"").trim(),li=String(Gn?.roomNumber??Gn?.roomLabel??"").trim(),Co=mo(`${br} ${ei} ${li}`);return dn.some(Fn=>Fn&&Co.includes(Fn))})})();if(qr&&Vr.length){const nn=new Map;Vr.forEach(Gn=>{const br=r_(Gn)||"Unknown Building";nn.has(br)||nn.set(br,[]),nn.get(br).push(Gn)});const dn=Array.from(nn.entries()).map(([Gn,br])=>{const ei=br.map(ro=>ro?.roomNumber||ro?.roomLabel||ro?.roomId||ro?.id||ro?.revitId||"").filter(Boolean),li=Array.from(new Set(ei)),Co=br.map(ro=>ro?.occupant||ro?.department||ro?.type||"").filter(Boolean),Fn=Array.from(new Set(Co)),Eo=li.length?`Rooms: ${li.slice(0,12).join(", ")}`:Fn.length?`Rooms: (not labeled)  ${Fn.slice(0,3).join(", ")}`:"Rooms: (not labeled)";return`${Gn}  ${Eo}`});Ss({answer:"Here are the rooms matching that request across campus.",bullets:dn,resultType:"none",columns:[],rows:[],dataUsed:["roomRows"],missingData:[]});return}const Pi=Vr.length?Vr:cr,Ar=ri(Pi,{maxRows:Fe?180:100,inferredDept:Fe}),Sr=Jg(cr),Bi=fr&&Sr?{...Sr,floorLabel:bn}:null,Ur=!fr&&qe&&Sr?Sr:null;let Fr=null;if(Ar.length)Fr=Ar.map(nn=>{const dn=Number(nn?.areaSF??nn?.area??nn?.sf??0),Gn=Number(nn?.seatCount??nn?.SeatCount??nn?.["Seat Count"]??0),br=V3(nn);return{building:nn?.building??nn?.buildingName??nn?.buildingLabel??zt,floor:nn?.floor??nn?.floorName??nn?.floorId??"",roomNumber:br||"",type:String(nn?.type??nn?.roomType??"").trim(),department:String(nn?.department??"").trim(),area:Number.isFinite(dn)?Math.round(dn):"",seatCount:Number.isFinite(Gn)&&Gn>0?Gn:"",occupant:String(nn?.occupant??"").trim(),occupancyStatus:String(nn?.occupancyStatus??"").trim()}});else try{const dn=await Ds(on?"__all__":zt||"__all__","");if(Array.isArray(dn)){const Gn=Xt.size?dn.filter(ei=>!Xt.has(mo(ei.building))):dn,br=ri(Gn,{maxRows:Fe?180:100,inferredDept:Fe});Fr=zt?br:br.slice(0,Fe?180:100)}else Fr=null}catch{Fr=null}const Dn=await no({question:O,context:_r,data:{campusStats:Rr,buildingStats:!on&&qe&&!fr&&Ur||void 0,floorStats:fr&&Bi||void 0,dashboardMetrics:void 0,scopeSummary:Sr||void 0,roomRows:Fr||void 0}});Ss(Dn)}catch(O){qs(String(O?.message||O))}finally{Qc(!1)}},[An,be,ga,F,j,mr,e,Zt,yt,Rr,qt,Hn,$s,Qr,no,Mf,Ds]),Fh=nr(()=>{if(Ai)try{const O=new wi("p","pt","letter"),fe=O.internal.pageSize.getWidth(),Ie=O.internal.pageSize.getHeight(),Fe=24,Ye=fe-Fe*2,qe=14;let Ge=Fe;const St=(un=qe)=>{Ge+un<=Ie-Fe||(O.addPage(),Ge=Fe)},Dt=(un,zt={})=>{const on=String(un??"").trim();if(!on)return;const fr=zt.fontStyle||"normal",_r=zt.fontSize||11;O.setFont(void 0,fr),O.setFontSize(_r),O.splitTextToSize(on,Ye).forEach(cr=>{St(qe),O.text(cr,Fe,Ge),Ge+=qe})},ft=(un=8)=>{St(un),Ge+=un};Dt("Ask Mapfluence",{fontStyle:"bold",fontSize:14}),ft(4),Dt(`Question: ${ga||"(no question)"}`,{fontSize:10}),ft(8),Dt(`Answer: ${Ai.answer||""}`),Array.isArray(Ai.bullets)&&Ai.bullets.length&&(ft(8),Dt("Notes:",{fontStyle:"bold"}),Ai.bullets.forEach(un=>Dt(`- ${un}`)));const Xt=Array.isArray(Ai.columns)?Ai.columns:[],en=Array.isArray(Ai.rows)?Ai.rows:[];Xt.length&&en.length&&(ft(10),Dt("Table:",{fontStyle:"bold"}),Dt(Xt.join(" | "),{fontStyle:"bold",fontSize:10}),en.forEach(un=>{const zt=Xt.map(on=>{const fr=un&&un[on]!=null?un[on]:"";return String(fr)});Dt(zt.join(" | "),{fontSize:10})})),Array.isArray(Ai.missingData)&&Ai.missingData.length&&(ft(8),Dt(`Missing data: ${Ai.missingData.join(", ")}`,{fontSize:10}));const bn=String(ga||"ask-mapfluence").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").slice(0,60)||"ask-mapfluence";O.save(`${bn}.pdf`)}catch(O){console.error("Ask Mapfluence PDF export failed",O),alert("PDF export failed - see console for details.")}},[Ai,ga]),_d=nr(async()=>{if(!Ai)return;const O=Array.isArray(Ai.columns)?Ai.columns:[],fe=Array.isArray(Ai.rows)?Ai.rows:[];if(!O.length||!fe.length){alert("No table data available to copy.");return}const Ie=qe=>{if(qe==null)return"";const Ge=String(qe);return/[",\n]/.test(Ge)?`"${Ge.replace(/"/g,'""')}"`:Ge},Fe=[O.map(Ie).join(",")];fe.forEach(qe=>{Fe.push(O.map(Ge=>Ie(qe&&qe[Ge]!=null?qe[Ge]:"")).join(","))});const Ye=Fe.join(`
`);try{if(navigator?.clipboard?.writeText)await navigator.clipboard.writeText(Ye);else throw new Error("Clipboard API unavailable")}catch{try{const qe=document.createElement("textarea");qe.value=Ye,qe.setAttribute("readonly",""),qe.style.position="fixed",qe.style.left="-9999px",document.body.appendChild(qe),qe.select(),document.execCommand("copy"),document.body.removeChild(qe)}catch{alert("Copy failed. Please use Export PDF.");return}}alert(`Copied ${fe.length.toLocaleString()} rows to clipboard (CSV).`)},[Ai]),Fu=nr(()=>{const O=String(ot||"").trim();if(!/^pk\./i.test(O)){Cr("Enter a valid Mapbox public token (starts with pk.).");return}try{window.localStorage.setItem("MAPBOX_PUBLIC_TOKEN",O)}catch{}Rd.accessToken=O,Cr(""),Gt(!1),window.location.reload()},[ot]);ci(()=>{const O=qo.current;if(!O||O.buildingLabel!==j||O.floorId!==mr)return;qo.current=null;const fe=Gi.current||[];Gi.current=null,(async()=>{try{if(!await Ni())return}catch{}B(fe)})()},[j,mr,Ni,B]);const Ou=nr(async()=>{const O=Wo?.recommendedCandidates||[];if(!O.length)return;const fe=Wo?.scenarioDept||Ui||"";Nh(!0),fe&&da(fe);const Ie=O[0],Fe=Ie?.buildingLabel||j,Ye=Ie?.floorName||Ie?.floorId||mr;let qe=Ye;if(Fe){const St=await ha(Fe);qe=F1(Ye,St)||St?.[0]||Ye}if(Fe&&qe&&(Fe!==j||qe!==mr)){qo.current={buildingLabel:Fe,floorId:qe},Gi.current=O,H(Fe),eo(qe);return}B(O)},[Wo?.recommendedCandidates,Wo?.scenarioDept,B,ha,Ui,j,mr,Nh,da,H,eo]),Cc=nr(O=>{const fe=O?.recommendedCandidates||[];if(!fe.length)return;const Ie=O?.scenarioDept||Ui||"";Nh(!0),Ie&&da(Ie),B(fe),Bo(!0)},[B,Ui,Nh,da]),th=nr(async(O,fe)=>{const Ie=O&&typeof O=="object"?null:O,Fe=fe||To||"rooms";Zo(!0),Bl(Fe==="summary"?"Preparing summary export...":"Building export data...");try{const Ye=bn=>{if(bn==null)return"";const un=String(bn);return/[",\n]/.test(un)?`"${un.replace(/"/g,'""')}"`:un};if(Fe==="summary"){const{campusRow:bn,buildingRows:un}=await Ic(Ie||ll,nc),zt=[...bn?[bn]:[],...un];if(!zt.length){Bl("No matching rooms found."),Zo(!1);return}const fr=[["BuildingId","BuildingName","TotalSF","Rooms","ClassroomSF","Classrooms","LabSF","Labs","OfficeSF","Offices","KeyDepts"].join(",")];zt.forEach(qr=>{fr.push([Ye(qr.buildingId),Ye(qr.buildingName),Ye(qr.totalSf),Ye(qr.rooms),Ye(qr.classroomSf),Ye(qr.classrooms),Ye(qr.labSf),Ye(qr.labs),Ye(qr.officeSf),Ye(qr.offices),Ye(qr.keyDepts)].join(","))});const _r=new Blob([fr.join(`
`)],{type:"text/csv;charset=utf-8;"}),jn=document.createElement("a");jn.href=URL.createObjectURL(_r);const cr=Ie||ll,ri=cr&&cr!=="__all__"?cr.replace(/\s+/g,"-").toLowerCase():"campus";jn.download=`${ri}-space-summary.csv`,document.body.appendChild(jn),jn.click(),document.body.removeChild(jn),Bl(`Exported ${zt.length} summary rows`);return}const qe=await Ds(Ie||ll,nc);if(!qe.length){Bl("No matching rooms found."),Zo(!1);return}const St=[["Building","Floor","Room","Type","Department","AreaSF","SeatCount","Occupant"].join(",")];qe.forEach(bn=>{St.push([Ye(bn.building),Ye(bn.floor),Ye(bn.roomNumber),Ye(bn.type),Ye(bn.department),Ye(bn.area),Ye(bn.seatCount),Ye(bn.occupant)].join(","))});const Dt=new Blob([St.join(`
`)],{type:"text/csv;charset=utf-8;"}),ft=document.createElement("a");ft.href=URL.createObjectURL(Dt);const Xt=Ie||ll,en=Xt&&Xt!=="__all__"?Xt.replace(/\s+/g,"-").toLowerCase():"campus";ft.download=`${en}-space-data.csv`,document.body.appendChild(ft),ft.click(),document.body.removeChild(ft),Bl(`Exported ${qe.length} rows`)}catch(Ye){console.warn("Space export failed",Ye),Bl("Export failed. See console.")}finally{Zo(!1)}},[Ds,Ic,ll,nc,To]);nr(()=>{try{ue([]),Q([])}catch{}},[]);const vd=nr(()=>{le(O=>{const fe=!O;try{const Ie=new URL(window.location.href);fe?Ie.searchParams.set("presentation","1"):Ie.searchParams.delete("presentation"),window.history.replaceState({},"",`${Ie.pathname}${Ie.search}${Ie.hash}`)}catch{}return fe})},[]),nh=nr(()=>{try{ze({}),U({})}catch{}},[]),[Eh,Hl]=qn(null),[Qh,xd]=qn(null),[ed,bd]=qn(null),[Oh,Od]=qn(null),Ll=nr(()=>u.current?.getBoundingClientRect()||{left:0,top:0,width:window.innerWidth,height:window.innerHeight},[]),Pl=nr(()=>({left:0,top:0,width:window.innerWidth,height:window.innerHeight}),[]),fc=nr(O=>Py(O,I,xd,Ll),[Ll]),Lc=nr(O=>Py(O,M,eu,Pl),[Pl]),Vc=nr(O=>Py(O,V,lc,Ll),[Ll]),bu=Ao(null),rh=Ao(null),ih=nr(O=>Py(O,bu,bd,Pl),[Pl]),ff=nr(O=>Py(O,rh,Od,Pl),[Pl]),_m={onPointerDown:fc,style:{cursor:"grab",userSelect:"none",touchAction:"none"}},vm={onPointerDown:Lc,style:{cursor:"grab",userSelect:"none",touchAction:"none"}},wg={onPointerDown:Vc,style:{cursor:"grab",userSelect:"none",touchAction:"none"}},xm={onPointerDown:ih,style:{cursor:"grab",userSelect:"none",touchAction:"none"}},bm={onPointerDown:ff,style:{cursor:"grab",userSelect:"none",touchAction:"none"}};if(Ao(null),!e)return Y.jsx("div",{children:"Loading University..."});const au=$a(()=>Vm(mh,"universities",e,"markers"),[e]),wm=$a(()=>Vm(mh,"universities",e,"buildingConditions"),[e]),Sg=$a(()=>Vm(mh,"universities",e,"buildingAssessments"),[e]);$a(()=>Vm(mh,"universities",e,"drawingEntries"),[e]);const Pa=$a(()=>Vm(mh,"moves"),[mh]),Zr=({person:O,from:fe,to:Ie,effectiveDate:Fe,comments:Ye,createdBy:qe})=>({person:O||"",fromRoomId:fe?.roomId||"",toRoomId:Ie?.roomId||"",fromBuildingId:fe?.buildingId||"",toBuildingId:Ie?.buildingId||"",fromFloorId:fe?.floorId||"",toFloorId:Ie?.floorId||"",fromRoomLabel:fe?.roomLabel||"",toRoomLabel:Ie?.roomLabel||"",effectiveDate:Fe||"",comments:Ye||"",createdAt:T1(),createdBy:qe||"unknown"}),td=nr(async O=>{if(O)try{await HE(Pa,O)}catch(fe){console.warn("Failed to log move",fe)}},[Pa]),pf=()=>{Nt(null),dt(null),ts(null)},Pc=async()=>{if(!Yt)return;const{from:O,to:fe,effectiveDate:Ie,comments:Fe,person:Ye}=Yt,qe=na(Ye||O?.occupantName||"");if(!(!O||!fe||!qe))try{const Ge=await wt({roomId:O.roomId,buildingId:O.buildingId,buildingName:O.buildingName,floorName:O.floorId,revitId:O.revitId,roomLabel:O.roomLabel,properties:{occupant:""}}),St=await wt({roomId:fe.roomId,buildingId:fe.buildingId,buildingName:fe.buildingName,floorName:fe.floorId,revitId:fe.revitId,roomLabel:fe.roomLabel,properties:{occupant:qe}});Ge&&St?await td(Zr({person:qe,from:O,to:fe,effectiveDate:Ie,comments:Fe,createdBy:y?.email||"unknown"})):console.warn("Move update incomplete, skipping move log.")}catch(Ge){console.warn("Move confirmation failed",Ge)}finally{pf()}},Sm=$a(()=>t!=="admin"?me:me.filter(O=>{const fe=(O.persona||"").toLowerCase();return fe.includes("student")?S:fe.includes("staff")||fe.includes("faculty")?N:!0}),[me,S,N,t]),Bd=$a(()=>{if(!c||!Qr)return me;const O=$r.current||{},fe=fp(O?.buildingId||F||j||""),Ie=Ra(O?.floorId||mr||""),Fe=String(O?.floorLabel||mr||"").trim(),Ye=Nf(Fe||Ie);return(me||[]).filter(qe=>{if(fp(qe?.buildingId||qe?.buildingName||qe?.building||"")!==fe)return!1;const St=String(qe?.floorId||qe?.floorLabel||qe?.floor||"").trim();return Ra(St)===Ie?!0:Ye.length?kf(St,Ye):!1})},[me,c,Qr,F,j,mr,Or]),Bu=$a(()=>({type:"FeatureCollection",features:(Bd||[]).filter(O=>Array.isArray(O?.coordinates)&&Number.isFinite(Number(O.coordinates[0]))&&Number.isFinite(Number(O.coordinates[1]))).map(O=>({type:"Feature",properties:{heatCategory:__(O?.type),weight:Oq(O?.type),markerType:O?.type||""},geometry:{type:"Point",coordinates:[Number(O.coordinates[0]),Number(O.coordinates[1])]}}))}),[Bd]),kl=$a(()=>{const O={matchPairs:[],matchPairsGradientBase:[],gradientPointCollection:{type:"FeatureCollection",features:[]},legendItems:[],roomCount:0,markerCount:0};if(!c||!aa||!Qr||!Vo)return O;const fe=_.current,Ie=fe?$u(fe,pa):null,Fe=Ie&&(Ie._data||Ie.serialize?.().data)||null,Ye=Au(Fe);if(!Ye?.features?.length)return O;const qe=Ye.features.filter(zt=>S0(zt?.properties)==="room").filter(zt=>{const on=String(zt?.geometry?.type||"");return on==="Polygon"||on==="MultiPolygon"}).map(zt=>{const on=zt.properties||{},fr=zt.id??on.RevitId??on.id;if(fr==null)return null;const _r=Ff(on);return{feature:zt,idRaw:fr,idKey:String(fr),areaSf:Number.isFinite(_r)?_r:0}}).filter(Boolean);if(!qe.length)return O;const Ge=new Map;qe.forEach(zt=>Ge.set(zt.idKey,{counts:new Map,total:0}));let St=0;(Bd||[]).filter(zt=>Array.isArray(zt?.coordinates)).forEach(zt=>{const on=Number(zt?.coordinates?.[0]),fr=Number(zt?.coordinates?.[1]);if(!Number.isFinite(on)||!Number.isFinite(fr))return;const _r=gs([on,fr]);for(const jn of qe){let cr=!1;try{cr=Tj(_r,jn.feature)}catch{cr=!1}if(!cr)continue;const ri=__(zt?.type),qr=Ge.get(jn.idKey),Vr=qr.counts.get(ri)||0;qr.counts.set(ri,Vr+1),qr.total+=1,St+=1;break}});const Dt=new Map,ft=[],Xt=[],en=[];let bn=0;qe.forEach(zt=>{const on=Ge.get(zt.idKey);if(!on||!on.total)return;bn+=1;const _r=Array.from(on.counts.entries()).sort((Vr,Pi)=>{if((Pi[1]||0)!==(Vr[1]||0))return(Pi[1]||0)-(Vr[1]||0);const Ar=hm[Vr[0]]?.heatValue??0;return(hm[Pi[0]]?.heatValue??0)-Ar})[0]?.[0]||"comment",jn=hm[_r]?.color||"#9ca3af",cr=Lf(jn,"#ffffff",.4),ri=[{band:1,scale:.98,color:Lf(jn,"#ffffff",.36)},{band:2,scale:.93,color:Lf(jn,"#ffffff",.3)},{band:3,scale:.88,color:Lf(jn,"#ffffff",.23)},{band:4,scale:.83,color:Lf(jn,"#ffffff",.16)},{band:5,scale:.77,color:Lf(jn,"#ffffff",.08)},{band:6,scale:.71,color:jn},{band:7,scale:.64,color:Lf(jn,"#000000",.1)},{band:8,scale:.57,color:Lf(jn,"#000000",.2)},{band:9,scale:.5,color:Lf(jn,"#000000",.31)},{band:10,scale:.43,color:Lf(jn,"#000000",.43)}];ft.push(zt.idKey,jn),Xt.push(zt.idKey,cr);try{const Pi=x8(zt.feature)?.geometry?.coordinates||null,Ar=Number.isFinite(Number(Pi?.[0]))&&Number.isFinite(Number(Pi?.[1]))?[Number(Pi[0]),Number(Pi[1])]:"center";ri.forEach(({band:Sr,scale:Bi,color:Ur})=>{let Fr=null;try{Fr=fg(zt.feature,Bi,{origin:Ar})}catch{Fr=null}if(!Fr&&Sr===1&&(Fr=zt.feature),!Fr)return;const xi=String(Fr?.geometry?.type||"");xi!=="Polygon"&&xi!=="MultiPolygon"||en.push({...Fr,properties:{...Fr.properties||{},roomId:zt.idKey,band:Sr,c:Ur}})})}catch{}const qr=Dt.get(_r)||{category:_r,label:kq[_r]||_r,color:jn,roomCount:0,markerCount:0,areaSf:0};qr.roomCount+=1,qr.markerCount+=on.total,qr.areaSf+=zt.areaSf||0,Dt.set(_r,qr)});const un=Array.from(Dt.values()).sort((zt,on)=>(on.roomCount||0)-(zt.roomCount||0));return{matchPairs:ft,matchPairsGradientBase:Xt,gradientPointCollection:{type:"FeatureCollection",features:en},legendItems:un,roomCount:bn,markerCount:St}},[c,aa,Qr,Vo,Bd,Or]);ci(()=>{if(!k)return;const O=_.current;if(!(!O||!O.getLayer(Do))&&!(!c||!aa||!Qr||!Vo))try{const fe=dl==="gradient",Ie=Vq(fe?kl.matchPairsGradientBase:kl.matchPairs,"#f3f4f6");if(O.setPaintProperty(Do,"fill-color",Ie),O.setPaintProperty(Do,"fill-opacity",fe?.94:.88),fe){qq(O,kl.gradientPointCollection),cv.forEach(Fe=>t0(O,Fe,!0));try{O.getLayer(Xc)&&O.moveLayer(Xc)}catch{}}else cv.forEach(Fe=>t0(O,Fe,!1))}catch{}},[k,c,aa,dl,Qr,Vo,kl,Or]),ci(()=>{if(!k)return;const O=_.current;if(!O)return;const fe=!!(c&&aa&&dl==="gradient"&&Qr&&Vo);cv.forEach(Ie=>t0(O,Ie,fe))},[k,c,aa,dl,Qr,Vo]),ci(()=>{!k||!c||!Qr||aa||El($i)},[k,c,Qr,aa,$i,El]),ci(()=>{aa||ks&&ya(!1)},[aa,ks]),ci(()=>{Qr&&Vo||ks&&ya(!1)},[Qr,Vo,ks]);const lu=$a(()=>c?Mq:t==="admin"?{...C1.student,...C1.staff}:C1[i]||C1.default,[i,t,c]),nd=$a(()=>{const O={};return Object.keys(lu||{}).forEach(fe=>{O[fe]=LT(fe)}),O},[lu]);ci(()=>{const O=tv();xz(O).catch(()=>{});const fe=GB(O,async Ie=>{if(a(Ie||null),!Ie){v(!1);return}try{const Fe=await GE(u0(mh,"universities",e,"roles",Ie.uid));v(!!Fe.exists()&&Fe.data()?.role==="admin")}catch{v(!1)}});return()=>fe()},[e]);async function wd(){try{const O=tv(),fe=new Bf;try{await dz(O,fe)}catch{await _z(O,fe)}}catch{}}function kp(){try{HB(tv())}catch{}}ci(()=>{e&&(async()=>{try{const O=Vm(mh,"universities",e,"buildings"),fe=await A1(O);if(!fe.empty){const Fe=fe.docs.map(Ye=>({id:Ye.id,name:Ye.data()?.name||Ye.id}));!j&&Fe.length&&H(Fe[0].id);return}const Ie=await fetch(sv);if(Ie.ok){const Fe=await Ie.json(),Ye=Object.entries(Fe.buildings||{}).map(([qe,Ge])=>({id:qe,name:Ge?.name||qe}));!j&&Ye.length&&H(Ye[0].id)}}catch(O){console.warn("Building options load failed:",O)}})()},[e]),ci(()=>{let O=!1;const fe=()=>{ru([]),eo(void 0)};return(async()=>{const Ie=Zg(F,_a)||Zg(j,_a);if(!Ie){fe();return}const Fe=await $A(Ie);if(O)return;const Ye=(Fe||[]).map(Ge=>h0(Ge?.id)).filter(Boolean),qe=new Map((Fe||[]).filter(Ge=>Ge?.id&&Ge?.url).map(Ge=>[Ge.id,Ge.url]));ac.current.set(Ie,Ye),iu.current.set(Ie,qe),Ye.length?(ru(Ye),eo(Ge=>Ge&&Ye.includes(Ge)?Ge:Ye[0])):fe()})(),()=>{O=!0}},[F,j,_a]),ci(()=>{let O=!1;return(async()=>{Hs(!0),W(null),hl("Campus Summary");try{const fe=await Jd("/ai/api/rooms",{cache:"no-store",timeoutMs:8e3});let Ie=null;try{Ie=await fe.json()}catch{}if(!fe.ok){const Fe=Ie?.error||Ie?.message||`Rooms fetch failed (${fe.status})`;throw new Error(Fe)}if(Ie?.ok&&Array.isArray(Ie.rooms)&&(O||(mt(Ie.rooms),wo(new Date)),Ie.rooms.some(bq)))return;throw new Error("Rooms payload missing or invalid")}catch{try{let Ie=us.current;Ie||(Ie=await g_(sv),us.current=Ie);const Fe=await ET(Ie);if(!Fe.length)throw new Error("No floorplan rooms found for dashboard");O||($t(Fe),W(null),zn(!0))}catch(Ie){O||W(Ie)}}finally{O||Hs(!1)}})(),()=>{O=!0}},[e]),ci(()=>{const fe=setInterval(()=>{it()},18e5);return()=>clearInterval(fe)},[it]),ci(()=>{let O=!1;return(async()=>{try{const fe=await fetch(nf(KV),{cache:"no-store"});if(!fe.ok)throw new Error(`Utilization CSV fetch failed (${fe.status})`);const Ie=await fe.text(),Fe=ZV(Ie);O||Mo(Fe)}catch(fe){console.warn("Unable to load classroom utilization data",fe)}})(),()=>{O=!0}},[]);const mf=$a(()=>{if(!Zt)return[];if(!(!!F||Qr))return yt;const fe=na(An);if(!!!fe)return yt;const Fe=new Set([mo(An),mo(F),mo(j)].filter(Boolean));if(!Fe.size)return yt;const Ye=yt.filter(Dt=>{const ft=Dt?.building??Dt?.buildingName??Dt?.buildingLabel??"";return Fe.has(mo(ft))});if(!!!(Qr&&fe))return Ye;const Ge=na($r.current?.floorLabel||mr||""),St=Nf(Ge);return St.length?Ye.filter(Dt=>kf(Dt?.floor??Dt?.floorName??Dt?.floorId??"",St)):Ye},[yt,Zt,An,F,j,Qr,mr]),Rp=$a(()=>{if(!(!!F||Qr))return"Campus";const fe=na(An);if(!!!fe)return"Campus";const Fe=na(Hn?.floorLabel||$r.current?.floorLabel||mr||"");return!!(Qr&&fe&&Fe)?`${fe} ${Fe}`:fe},[An,F,j,Qr,mr,Hn]),zd=$a(()=>{if(!!F||Qr){const fe=na(An);return fe?ve(fe):null}return L},[An,F,j,Qr,L,ve]),Em=$a(()=>!!F||Qr?na(An)||"":L?be:"",[An,F,j,Qr,L,be]),rd=$a(()=>{if(!Qr)return[];const O=$r.current||{},fe=mo(F||j||""),Ie=mo(O.buildingLabel||O.buildingId||O.building||"");if(fe&&Ie&&fe!==Ie)return[];const Fe=Nf(mr||"");if(Fe.length){const Ge=O.floorLabel||O.floorId||O.floor||"";if(!kf(Ge,Fe))return[]}const Ye=O.fc,qe=Array.isArray(Ye?.features)?Ye.features:[];return qe.length?qe.filter(Ge=>S0(Ge?.properties)==="room"):[]},[Qr,Or,F,j,mr]),Am=$a(()=>Qr?rd:(mf||[]).map(AC).filter(Boolean),[mf,rd,Qr]);ci(()=>{if(!Ce.length)return;let O=!1;if(!Ce.some(Ie=>Xv(Ie?.type)||Xv(Ie?.department)||_q(Ie))){O||($t(Ce),zn(!0));return}return(async()=>{try{let Ie=us.current;Ie||(Ie=await g_(sv),us.current=Ie);const Fe=await ET(Ie);if(O)return;const Ye=xq(Ce,Fe);$t(Ye),zn(!0)}catch{O||($t(Ce),zn(!0))}})(),()=>{O=!0}},[Ce]),ci(()=>{if(!Zt)return;const O=!!F||Qr,fe=na(An),Ie=na(Hn?.floorLabel||$r.current?.floorLabel||mr||""),qe=!!(Qr&&fe&&Ie)?`${fe} ${Ie} Summary`:!!(O&&fe)?`${fe} Summary`:"Campus Summary";hl(qe);try{const Ge=IU(Am);ia(Ge)}catch(Ge){W(Ge)}},[Zt,Am,An,F,j,Qr,mr,Hn]),ci(()=>{if(!Zt||!Array.isArray(yt)||!yt.length||Qr)return;const O=F||j;if(!O)return;const fe=mo(O);if(!fe)return;const Ie=yt.filter(Ye=>{const qe=Ye?.building??Ye?.buildingName??Ye?.buildingLabel??"";return mo(qe)===fe}),Fe=Jg(Ie);Fe&&(Pn(Fe),or(qu(Fe,"building")))},[Zt,yt,Qr,F,j]),ci(()=>{if(!Qr||!rd.length)return;const O=$r.current||{},fe=O.url||As.current,Ie=O.floorLabel||mr||O.floor||"";if(!fe)return;const Fe=LV(rd);if(!Fe)return;const Ye={...Fe,floorLabel:Ie};Ba.current[fe]=Fe,Ya.current.set(fe,Fe),O.key&&Ya.current.set(O.key,Fe),Bn(Ye),lt(pp(Yp(Fe.totalsByDept))),or(qu(Fe,"floor"))},[Qr,rd,mr]),ci(()=>{if(!k||!_.current||!Qr)return;const O=!!(Es?.byGuid?.size||Es?.byComposite?.size),fe=Ws instanceof Map&&Ws.size>0;if(!O&&!fe)return;const Ie=_.current,Fe=$u(Ie,pa);if(!Fe)return;const Ye=Fe._data||Fe.serialize?.()?.data||null,qe=Au(Ye);if(!qe?.features?.length)return;const Ge=$r.current||{},St=Ge.buildingId||F||j,Dt=Ge.floorLabel||Ge.floorId||Ge.floor||mr;let ft=!1;const Xt=qe.features.map(bn=>{if(!bn)return bn;const un=bn.properties||{};if(S0(un)!=="room")return bn;let zt=un,on=!1;if(O){const jn=EC(un,Es,St,Dt);jn&&(zt=Wv(zt,jn),on=!0)}if(fe&&St&&Dt){const jn=bn.id??un.RevitId??un.id,cr=jn!=null?tf(St,Dt,jn):null,ri=cr&&Ws.get(cr)||null;ri&&(zt=Wv(zt,ri),on=!0)}const fr=fd(zt),_r=fr?String(fr).trim():zt.__roomType||"";return!on&&_r===un.__roomType?bn:(ft=!0,{...bn,properties:{...zt,__roomType:_r}})});if(!ft)return;const en={...qe,features:Xt};try{Fe.setData(en)}catch{}$r.current&&($r.current={...$r.current,fc:en}),hi(bn=>bn+1);try{El($i)}catch{}},[Es,Ws,$i,Qr,k,F,j,mr,El]),ci(()=>{if(!n)return;let O=null,fe=null;const Ie=m.current;if(!Ie)return;const Fe=()=>Ie.clientWidth>0&&Ie.clientHeight>0,Ye=()=>{if(_.current)return;const Ge=n&&n.style||"mapbox://styles/mapbox/streets-v12",St=typeof Ge=="string"&&/^mapbox:\/\//i.test(Ge),Dt=!!(Rd.accessToken||"").trim();if(St&&!Dt){Gt(!0);return}Gt(!1);const ft=Ge,Xt=n?.initialCenter||[-98.3739,40.5939],en=n?.initialZoom??16;console.log("Mapbox token length:",(Rd.accessToken||"").length),console.log("Using style:",ft);let bn=null;try{bn=new Rd.Map({container:Ie,style:ft,center:Xt,zoom:en,attributionControl:!1,preserveDrawingBuffer:!0})}catch(un){console.error("Map constructor failed:",un);return}if(!bn){console.error("Map was not created (mapInstance is falsy).");return}bn.on("error",un=>{const zt=String(un?.error?.message||"");/access token/i.test(zt)&&Gt(!0)}),_.current=bn,typeof window<"u"&&(window.__map=bn);try{bn.addControl(new Rd.NavigationControl,"top-right")}catch(un){console.warn("Adding controls failed:",un)}bn.once("load",()=>{(async()=>{try{await KA(bn,"mf-door-swing","/StakeholderMap/icons/door-swing.png")}catch(un){console.warn("Door icon load failed:",un)}try{await KA(bn,"mf-stairs-run","/StakeholderMap/icons/stairs-run.png")}catch(un){console.warn("Stairs icon load failed:",un)}ie(!0);try{bn.resize()}catch(un){console.warn("resize() failed:",un)}try{const un=Au(n?.boundary);if(un?.features?.length){const[zt,on,fr,_r]=OV(un);Number.isFinite(zt)&&Number.isFinite(on)&&Number.isFinite(fr)&&Number.isFinite(_r)&&bn.fitBounds([[zt,on],[fr,_r]],{padding:40,duration:0})}}catch(un){console.warn("fitBounds from boundary failed:",un)}})()})};if(Fe())Ye();else{try{fe=new ResizeObserver(()=>{if(Fe()){try{fe.disconnect()}catch{}fe=void 0,Ye()}}),fe.observe(Ie)}catch{}O=requestAnimationFrame(()=>{if(Fe()){if(fe){try{fe.disconnect()}catch{}fe=void 0}Ye()}})}const qe=()=>{if(_.current)try{_.current.resize()}catch{}};try{window.addEventListener("resize",qe)}catch{}return()=>{if(O&&cancelAnimationFrame(O),fe)try{fe.disconnect()}catch{}try{window.removeEventListener("resize",qe)}catch{}if(_.current){try{_.current.remove()}catch{}_.current=null}}},[n]),ci(()=>{t!=="admin"&&(!Ul&&!Uo&&Ks.length===0||(vs(!1),Aa(null),yu([]),Oa.current=[]))},[t,Ul,Uo,Ks.length]),ci(()=>{(async()=>{try{let O;if(t==="admin"||c)O=VE(au);else{if(!i){ue([]);return}O=VE(au,nB("persona","==",i))}const fe=await A1(O);if(ue(fe.docs.map(Ge=>({id:Ge.id,...Ge.data(),coordinates:[Ge.data().coordinates.longitude,Ge.data().coordinates.latitude]}))),t!=="admin"){ze({}),U({});return}const[Ie,Fe]=await Promise.all([A1(wm),A1(Sg)]),Ye={};Ie.forEach(Ge=>{const St=Ge.data().originalId||Ge.id.replace(/__/g,"/");Ye[St]=Ge.data().condition}),ze(Ye);const qe={};Fe.forEach(Ge=>{const St=Ge.data().originalId||Ge.id.replace(/__/g,"/");qe[St]=Ge.data()}),U(qe)}catch(O){console.error("Failed to fetch data:",O),t==="admin"&&(ze({}),U({}))}})()},[t,c,e,i,au,wm,Sg]),ci(()=>{if(!F)return;const O=te(F)||F;j!==O&&H(O)},[F,te,j]),ci(()=>{if(!c||!k)return;if(!Vo){Ja.current="";return}const O=fp(F||j||""),fe=Ra(mr||""),Ie=Tl(O),Fe=Ie.some(Dt=>Ra(Dt)===fe);if(!Ie.length||!Fe){Ja.current="";return}const Ye=$r.current||{},qe=fp(Ye.buildingId||""),Ge=Ra(Ye.floorId||""),St=`${O}/${fe}`;if(Qr&&qe===O&&Ge===fe){Ja.current=St;return}Ja.current!==St&&(Ja.current=St,Ni(mr))},[c,Vo,k,F,j,mr,Tl,Qr,Or]),ci(()=>{c&&(Vo||Qr&&ns())},[c,Vo,Qr,ns]),ci(()=>{c&&(Vo||tt(!0))},[c,Vo]),ci(()=>{(!c||!Vo||!Qr)&&Ru(!1)},[c,Vo,Qr]),ci(()=>{if(ua.current){try{ua.current()}catch{}ua.current=null}const O=F||j;if(!O||!mr||!e)return;const fe=Yc(e),Ie=fp(O),Fe=Ra(mr),Ye=Vm(mh,"universities",fe,"buildings",Ie,"floors",Fe,"rooms");return ua.current=oB(Ye,qe=>{const Ge=new Map;qe.forEach(St=>{const Dt=St.data();Ge.set(St.id,{...Dt,buildingId:Dt.original?.buildingName??O,floor:Dt.original?.floorLabel??mr,revitId:Dt.original?.featureId??Dt.revitId??St.id})}),Fa(Ge)}),()=>{if(ua.current){try{ua.current()}catch{}ua.current=null}}},[F,j,mr,e]),ci(()=>{Sc.current=F,F||(Ec.current=null,fl.current=null,Pn(null),Bn(null),Si("building"),As.current||or(null))},[F]),ci(()=>{if(c||!k||!_.current||!n)return;const O=_.current;if(!O.getSource("buildings")){if(O.addSource("buildings",{type:"geojson",data:n.buildings,promoteId:"id"}),O.addLayer({id:"buildings-layer",type:"fill-extrusion",source:"buildings",paint:{"fill-extrusion-color":ud(Hm),"fill-extrusion-height":15,"fill-extrusion-opacity":.7}}),O.addLayer({id:"buildings-outline-base",type:"line",source:"buildings",paint:{"line-color":"rgba(0,0,0,0.35)","line-width":1.6,"line-opacity":.8}}),O.addLayer({id:"buildings-outline",type:"line",source:"buildings",paint:{"line-color":"#1d4ed8","line-width":2.6,"line-opacity":["case",["boolean",["feature-state","selected"],!1],1,0]}}),!O.getLayer("buildings-fill"))try{O.addLayer({id:"buildings-fill",type:"fill",source:"buildings",paint:{"fill-opacity":0}},"buildings-outline")}catch{O.addLayer({id:"buildings-fill",type:"fill",source:"buildings",paint:{"fill-opacity":0}})}O.addLayer({id:"buildings-labels",type:"symbol",source:"buildings",layout:{"text-field":["coalesce",["get","name"],["get","id"]],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":10,"text-anchor":"center","text-variable-anchor":["center"],"text-offset":[0,0],"text-line-height":1,"text-allow-overlap":!1,"text-max-width":10,"symbol-placement":"point"},paint:{"text-color":"#111111","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":1}}),O.getLayer("buildings-hit")||O.addLayer({id:"buildings-hit",type:"line",source:"buildings",paint:{"line-color":"#007aff","line-width":2},filter:["==",["get","id"],F||""]})}if(n.boundary&&!O.getSource("boundary")){const fe=Au(n.boundary);fe?(O.addSource("boundary",{type:"geojson",data:fe}),O.addLayer({id:"boundary-layer",type:"line",source:"boundary",paint:{"line-color":"#a9040e","line-width":3,"line-dasharray":[2,2]}})):console.warn("Boundary provided but could not normalize to FeatureCollection.")}},[k,n]),ci(()=>{if(!k||!_.current||!n)return;const O=_.current;O.getSource("buildings")||(O.addSource("buildings",{type:"geojson",data:n.buildings,promoteId:"id"}),O.addLayer({id:"buildings-layer",type:"fill-extrusion",source:"buildings",paint:{"fill-extrusion-color":ud(Hm),"fill-extrusion-height":15,"fill-extrusion-opacity":.7}}),O.addLayer({id:"buildings-outline",type:"line",source:"buildings",paint:{"line-color":"#1d4ed8","line-width":2.2,"line-opacity":["case",["boolean",["feature-state","selected"],!1],1,0]}}),O.getLayer("buildings-fill")||O.addLayer({id:"buildings-fill",type:"fill",source:"buildings",paint:{"fill-opacity":0}},"buildings-outline"));const fe=async Ie=>{if(!O)return;let Fe=null;try{if(O.getLayer(Do)){const St=O.queryRenderedFeatures(Ie.point,{layers:[Do]});Fe=St&&St[0]}}catch{}if(Fe)return;const Ye=Ie.features&&Ie.features[0];if(!Ye)return;fl.current=Ye;const qe=Ye.properties?.id;if(!qe)return;try{o.current&&O.setFeatureState({source:"buildings",id:o.current},{selected:!1}),O.setFeatureState({source:"buildings",id:qe},{selected:!0}),o.current=qe}catch{}q(qe),Sc.current=qe;const Ge=O.project(Ie.lngLat);Hl(jt(Ge)),ir(!1),Si("building"),Bn(null),Pn(null),or({loading:!0,mode:"building"}),Ze(qe);try{const St=await Xe(qe);if(Sc.current!==qe)return;if(As.current||(Pn(St),or(qu(St,"building"))),Me!==Re.SPACE_DATA){const Dt=await Le?.(qe)||St||{},ft=un=>Number.isFinite(un)?Math.round(un).toLocaleString():"-",Xt=un=>Number.isFinite(un)?Number(un).toLocaleString():"-",en=RU(Dt.keyDepts||[]),bn=`
          <div class="mf-popup mf-popup--building" style="min-width:280px;padding:8px 10px;">
            <div style="display:flex;gap:18px;align-items:flex-start;">
              <div style="flex:1">
                <div style="font-weight:700;margin-bottom:6px;">${buildingName}</div>
                <div><b>Total SF:</b> ${ft(Dt.totalSf)}</div>
                <div><b>Rooms:</b> ${Xt(Dt.rooms)}</div>
                <div><b>Classroom SF:</b> ${ft(Dt.classroomSf)}</div>
                <div><b>Classrooms:</b> ${Xt(Dt.classroomCount)}</div>
              </div>
              <div style="min-width:180px;">
                <div style="font-weight:600;margin-bottom:4px;">Key Departments</div>
                ${en||'<div class="mf-subtle">?</div>'}
              </div>
            </div>
          </div>`;new Rd.Popup({offset:12}).setLngLat(Ie.lngLat).setHTML(bn).addTo(O)}}catch(St){console.warn("Failed to load building totals for popup:",St)}};return O.__mf_building_click_bound||(O.on("click","buildings-fill",fe),O.__mf_building_click_bound=!0),()=>{try{O.__mf_building_click_bound&&(O.off("click","buildings-fill",fe),O.__mf_building_click_bound=!1)}catch{}}},[c,k,n,Me,Ze,Xe,Le]),ci(()=>{if(!k||!_.current)return;const O=_.current,fe=(qe,Ge)=>{try{O.setPaintProperty("buildings-layer","fill-extrusion-color",qe),O.setPaintProperty("buildings-layer","fill-extrusion-opacity",Ge)}catch{}},Ie=(qe,Ge,St)=>{try{O.setPaintProperty(qe,"fill-color",Ge),O.setPaintProperty(qe,"fill-opacity",St)}catch{}},Fe=O.getLayer("buildings-layer"),Ye=O.getLayer("buildings-fill");if(Me===Re.SPACE_DATA)Fe&&(Fe.type==="fill-extrusion"?fe(ud("#ffffff"),1):Ie("buildings-layer",ud("#ffffff"),1)),WA(O);else if(Fe&&(Fe.type==="fill-extrusion"?fe(ud(Hm),.7):Ie("buildings-layer",ud(Hm),.7)),Ye){Ie("buildings-fill",ud(Hm),.2);try{O.setPaintProperty("buildings-fill","fill-outline-color","#00000000")}catch{}hw(O,$i)}},[k,Me,$i]),ci(()=>{if(!k||!_.current)return;const O=_.current;try{O.getLayer("buildings-hit")&&O.setFilter("buildings-hit",["==",["get","id"],F||""])}catch{}},[F,k]),ci(()=>{if(!k||!_.current)return;const O=_.current;o.current&&O.setFeatureState({source:"buildings",id:o.current},{selected:!1}),F&&O.setFeatureState({source:"buildings",id:F},{selected:!0}),o.current=F},[F,k,t]),ci(()=>{if(!k||!_.current)return;const O=_.current,fe=()=>{const Fe=O.getStyle?.(),Ye=Fe?.layers||[],qe=Fe?.sources||{};try{O.getLayer(Qd)&&O.removeLayer(Qd)}catch{}try{O.getLayer(ef)&&O.removeLayer(ef)}catch{}Ye.map(Ge=>Ge?.id).filter(Ge=>typeof Ge=="string"&&Ge.startsWith("engagement-heat-layer-")).forEach(Ge=>{try{O.removeLayer(Ge)}catch{}}),Object.keys(qe).filter(Ge=>Ge.startsWith("engagement-heat-source-")).forEach(Ge=>{try{O.removeSource(Ge)}catch{}})},Ie=()=>{CT.forEach(({layerId:Fe})=>{try{O.getLayer(Fe)&&O.removeLayer(Fe)}catch{}});try{O.getLayer(Qd)&&O.removeLayer(Qd)}catch{}try{O.getLayer(ef)&&O.removeLayer(ef)}catch{}try{O.getSource(Gm)&&O.removeSource(Gm)}catch{}};if(!c){Ie(),fe();return}try{fe();const Fe=O.getSource(Gm);Fe&&typeof Fe.setData=="function"?Fe.setData(Bu):O.addSource(Gm,{type:"geojson",data:Bu});const Ye=O.getLayer("boundary-layer")?"boundary-layer":O.getLayer("buildings-labels")?"buildings-labels":void 0,qe=!0,Ge=!!Qr;O.getLayer(Qd)||O.addLayer({id:Qd,type:"heatmap",source:Gm,maxzoom:d5,filter:["all",["in",["coalesce",["get","heatCategory"],""],["literal",Nq]],f5],paint:{"heatmap-weight":kT(),"heatmap-intensity":RT(qe),"heatmap-radius":MT(Ge),"heatmap-opacity":NT(qe),"heatmap-color":jq()}},Ye),O.setPaintProperty(Qd,"heatmap-weight",kT()),O.setPaintProperty(Qd,"heatmap-intensity",RT(qe)),O.setPaintProperty(Qd,"heatmap-radius",MT(Ge)),O.setPaintProperty(Qd,"heatmap-opacity",NT(qe)),t0(O,Qd,De&&IT),O.getLayer(ef)||O.addLayer({id:ef,type:"heatmap",source:Gm,maxzoom:d5,filter:["all",["in",["coalesce",["get","heatCategory"],""],["literal",Dq]],f5],paint:{"heatmap-weight":["*",Zv,.98],"heatmap-intensity":DT(qe),"heatmap-radius":FT(Ge),"heatmap-opacity":OT(qe),"heatmap-color":Uq()}},Ye),O.setPaintProperty(ef,"heatmap-weight",["*",Zv,.98]),O.setPaintProperty(ef,"heatmap-intensity",DT(qe)),O.setPaintProperty(ef,"heatmap-radius",FT(Ge)),O.setPaintProperty(ef,"heatmap-opacity",OT(qe)),t0(O,ef,De&&IT),CT.forEach(({category:St,layerId:Dt})=>{O.getLayer(Dt)||O.addLayer({id:Dt,type:"heatmap",source:Gm,maxzoom:d5,filter:["all",["==",["coalesce",["get","heatCategory"],""],St],f5],paint:{"heatmap-weight":PT(St),"heatmap-intensity":zT(St,qe),"heatmap-radius":BT(St,Ge),"heatmap-opacity":jT(St,qe),"heatmap-color":zq(St)}},Ye),O.setPaintProperty(Dt,"heatmap-weight",PT(St)),O.setPaintProperty(Dt,"heatmap-intensity",zT(St,qe)),O.setPaintProperty(Dt,"heatmap-radius",BT(St,Ge)),O.setPaintProperty(Dt,"heatmap-opacity",jT(St,qe)),t0(O,Dt,De)})}catch(Fe){console.warn("Engagement heatmap update failed",Fe)}},[k,c,Bu,De,Qr]),ci(()=>{if(!k||!_.current)return;const O=_.current;O.getCanvas().parentElement.querySelectorAll(".custom-mapbox-marker").forEach(Fe=>Fe.remove());const fe=t==="admin"?J?Sm:[]:c?Bd:G;c&&(De||ks)||fe.forEach(Fe=>{const Ye=document.createElement("div");Ye.className="custom-marker custom-mapbox-marker";const qe=c?LT(Fe.type):lu[Fe.type]||"#9E9E9E";Ye.style.backgroundColor=qe;const Ge=new Rd.Marker(Ye).setLngLat(Fe.coordinates);if(Me!==Re.SPACE_DATA){const St=c?Fq(Fe.type):Fe.type;Ge.setPopup(new Rd.Popup({offset:25}).setText(Fe.comment||St))}Ge.addTo(O)})},[Sm,G,Bd,lu,nd,k,t,J,c,De,ks]),ci(()=>{if(!k||!_.current||!_.current.getSource("buildings"))return;const O=_.current;if(Me===Re.SPACE_DATA){if(zo&&ae&&Object.keys(ae).length>0){const Ye=["match",["get","id"]];Object.entries(ae).forEach(([Ge,St])=>{const Dt=Number.isFinite(St?.overallUtilization)?St.overallUtilization:null,ft=Lq(Dt);Ye.push(Ge,ft)}),Ye.push("#e5e7eb");const qe=ud(Ye);try{O.setPaintProperty("buildings-layer","fill-extrusion-color",qe),O.setPaintProperty("buildings-layer","fill-extrusion-opacity",.2),O.getLayer("buildings-fill")&&(O.setPaintProperty("buildings-fill","fill-color",qe),O.setPaintProperty("buildings-fill","fill-opacity",.55),O.setPaintProperty("buildings-fill","fill-outline-color","rgba(0,0,0,0)"))}catch{}}else try{O.setPaintProperty("buildings-layer","fill-extrusion-color",ud("#ffffff")),O.setPaintProperty("buildings-layer","fill-extrusion-opacity",.7),O.getLayer("buildings-fill")&&(O.setPaintProperty("buildings-fill","fill-color",ud("#ffffff")),O.setPaintProperty("buildings-fill","fill-opacity",0))}catch{}return}if(O.getLayer("buildings-fill"))try{O.setPaintProperty("buildings-fill","fill-opacity",0)}catch{}try{O.setPaintProperty("buildings-layer","fill-extrusion-opacity",.7)}catch{}const fe=["match",["get","id"]];let Ie=!1;t==="admin"&&Me===Re.ASSESSMENT&&Object.keys(pe).length>0?Object.entries(pe).forEach(Ye=>{const qe=Ye[0],Ge=Ye[1];let St=0;const Dt=Ge&&Ge.scores?Ge.scores:{};Dt.architecture&&Object.values(Dt.architecture).some(ft=>ft>0)&&St++,Dt.engineering&&Object.values(Dt.engineering).some(ft=>ft>0)&&St++,Dt.functionality&&Object.values(Dt.functionality).some(ft=>ft>0)&&St++,fe.push(Ge&&Ge.originalId||qe,Eq[St]),Ie=!0}):t==="admin"&&Me===Re.SPACE_DATA&&Object.keys(ke).length>0&&Object.entries(ke).forEach(Ye=>{const qe=Ye[0],Ge=Ye[1],St=Sq[Ge];St&&(fe.push(qe,St.color),Ie=!0)}),fe.push(Hm);const Fe=ud(fe);Ie?O.setPaintProperty("buildings-layer","fill-extrusion-color",Fe):O.setPaintProperty("buildings-layer","fill-extrusion-color",ud(Hm))},[ke,pe,k,t,Me,zo,ae]);const jd=nr(O=>{if(!_.current)return;const fe=document.createElement("div");fe.className="marker-prompt-popup",fe.innerHTML=`
      <h4>Add a Marker</h4>
      <select id="marker-type">${Object.keys(lu).map(Fe=>`<option value="${Fe}">${Fe}</option>`).join("")}</select>
      <textarea id="marker-comment" placeholder="Optional comment..."></textarea>
      <div class="button-group">
        <button id="confirm-marker">Add</button>
        <button id="cancel-marker">Cancel</button>
      </div>`;const Ie=new Rd.Popup({closeOnClick:!1,maxWidth:"280px"}).setDOMContent(fe).setLngLat(O).addTo(_.current);fe.querySelector("#confirm-marker").addEventListener("click",async()=>{const Fe=fe.querySelector("#marker-type").value,Ye=fe.querySelector("#marker-comment").value.trim(),qe=$r.current||{},Ge=Vo&&Qr,St=Ge&&(qe.buildingId||F||j)||"",Dt=fp(St||""),ft=String(Mf(St)||An).trim(),Xt=Ge?Ra(qe.floorId||mr||""):"",en=Ge?String(qe.floorLabel||mr||"").trim():"",bn=Ge?String(qe.url||Zs||"").trim():"",un={coordinates:new gx(O.lat,O.lng),type:Fe,comment:Ye,buildingId:Dt,buildingName:ft,floorId:Xt,floorLabel:en,floorUrl:bn,persona:i||(c?"student":"admin"),createdAt:T1()},zt=await HE(au,un),on={...un,id:zt.id,coordinates:[O.lng,O.lat]};ue(fr=>[...fr,on]),Q(fr=>[...fr,on]),Ie.remove()}),fe.querySelector("#cancel-marker").addEventListener("click",()=>Ie.remove())},[lu,au,i,c,F,j,mr,Zs,An,Vo,Qr]);ci(()=>{if(!c||t==="admin"||!k||!_.current)return;const O=_.current,fe=Ie=>{if(!(Un.current||oo.current)&&!(Vo&&!Qr)){try{if(Vo){const Fe=O.queryRenderedFeatures(Ie.point,{layers:["buildings-fill"]})||[],Ye=String(Fe[0]?.properties?.id||""),qe=String(Sc.current||F||j||"");if(Ye&&qe&&Ye!==qe)return}}catch{}jd(Ie.lngLat)}};return O.on("click",fe),()=>{try{O.off("click",fe)}catch{}}},[c,t,k,jd,Qr,F,j,Vo]),ci(()=>{if(!k||!_.current)return;const O=_.current,fe=Ie=>{const Fe=xn.current;if(!Fe)return;try{Ie.preventDefault?.(),Ie.originalEvent&&(Ie.originalEvent.preventDefault?.(),Ie.originalEvent.stopPropagation?.(),Ie.originalEvent.cancelBubble=!0)}catch{}const Ye=Number(Fe.step)||0,qe=Ye<2,Ge=qe?Do:Sp,Dt=$r.current?.fc||null;let ft=null;if(qe){if(O.getLayer(Ge)){const en=O.queryRenderedFeatures(Ie.point,{layers:[Ge]})||[];if(en.length){const bn=[Ie.lngLat.lng,Ie.lngLat.lat];ft=YU(en[0],bn)}}if(!ft&&Dt&&(ft=t5({map:O,fc:Dt,isDrawing:!1,screenPoint:Ie.point,maxPixels:nV,maxPoints:n5})),!ft){Pt("Click closer to a room polygon (or zoom in).");return}}else{const en=!!Dt?.features?.some(bn=>{const un=bn?.geometry?.type||"";return Ch(bn?.properties||{})||un==="LineString"||un==="MultiLineString"});if(Dt&&(ft=t5({map:O,fc:Dt,isDrawing:!0,screenPoint:Ie.point,maxPixels:rV,maxPoints:n5})),!ft&&en&&Dt&&(ft=t5({map:O,fc:Dt,isDrawing:!0,screenPoint:Ie.point,maxPixels:null,maxPoints:n5})),!ft){Pt(en?"No drawing vertex nearby. Zoom in and click closer to linework.":"No drawing linework found on this floor.");return}}const Xt={...Fe,roomPts:Array.isArray(Fe.roomPts)?[...Fe.roomPts]:[],drawingPts:Array.isArray(Fe.drawingPts)?[...Fe.drawingPts]:[]};if(qe?Xt.roomPts.push(ft):Xt.drawingPts.push(ft),Xt.step=Ye+1,Xt.step>=zA.length){const en=ln(Xt.roomPts,Xt.drawingPts);if(!en){Pt("Unable to compute alignment from those points.");return}if(!qU(Fe.buildingLabel,Fe.floorId,en)){Pt("Failed to save alignment in local storage.");return}Ot(null),Pt("");const un=Ri(j,Fe.floorId);un&&(ms.delete(un),Hu.delete(un)),Ni(Fe.floorId);return}Pt(""),Ot(Xt)};return O.on("click",fe),()=>{try{O.off("click",fe)}catch{}}},[k,j,Ri,Ni,ln]),ci(()=>{if(!k||!_.current)return;const O=_.current,fe=(qe,Ge)=>{const St=Of(gs([qe.lng,qe.lat]),gs([Ge.lng,qe.lat]),{units:"kilometers"}),Dt=Of(gs([qe.lng,qe.lat]),gs([qe.lng,Ge.lat]),{units:"kilometers"}),ft=(Ge.lng>=qe.lng?1:-1)*St*1e3,Xt=(Ge.lat>=qe.lat?1:-1)*Dt*1e3;return[ft,Xt]},Ie=qe=>{if(!oo.current)return;try{qe.preventDefault?.(),qe.originalEvent&&(qe.originalEvent.preventDefault?.(),qe.originalEvent.stopPropagation?.(),qe.originalEvent.cancelBubble=!0)}catch{}const Ge=Ei.current;if(!Ge)return;const St=Tt(),Dt=St.url||Ri(j,St.floorId),ft=St.basePath||$r.current?.floorAdjustBasePath||null,Xt=$r.current?.floorAdjustBasePivot||null,en=ft?jy(ft,St.floorId):null,bn=mp(en),un=Dt?zy(Dt):null,zt=mp(un),on=bn?en:zt?un:Ym(St.buildingLabel,St.floorId),fr=Array.isArray(on.translateLngLat)?on.translateLngLat:[0,0],_r=$r.current?.floorAdjustLabel||(Dt?Nd(Dt):null)||St.buildingLabel,cr=$u(O,pa)?._data||$r.current?.fc||null;if(!cr){Er("No floor data to adjust.");return}let ri=null;try{ri=Ol(cr)?.geometry?.coordinates||null}catch{ri=null}if(!ri){Er("Unable to find a transform pivot.");return}const qr=O.project({lng:ri[0],lat:ri[1]}),Vr=Math.atan2(qe.point.y-qr.y,qe.point.x-qr.x);Ho.current={mode:Ge,baseData:JSON.parse(JSON.stringify(cr)),pivot:ri,pivotScreen:qr,startAngle:Vr,startRotation:on.rotationDeg||0,startScale:on.scale||1,startTranslate:on.translateMeters||[0,0],startTranslateLngLat:fr,startLngLat:qe.lngLat,buildingLabel:St.buildingLabel,floorId:St.floorId,adjustUrl:Dt,adjustLabel:_r,adjustBasePath:ft,basePivot:Xt};try{O.dragPan.disable()}catch{}try{O.getCanvas().style.cursor="grabbing"}catch{}},Fe=qe=>{const Ge=Ho.current;if(!Ge)return;const St=$u(O,pa);if(St){if(Ge.mode==="rotate"){const ft=(Math.atan2(qe.point.y-Ge.pivotScreen.y,qe.point.x-Ge.pivotScreen.x)-Ge.startAngle)*180/Math.PI,Xt=Hh(Ge.baseData,ft,{pivot:Ge.pivot});St.setData(Xt);return}if(Ge.mode==="move"){fe(Ge.startLngLat,qe.lngLat);const Dt=qe.lngLat.lng-Ge.startLngLat.lng,ft=qe.lngLat.lat-Ge.startLngLat.lat,Xt=ow(Ge.baseData,[Dt,ft]);St.setData(Xt)}}},Ye=qe=>{const Ge=Ho.current;if(!Ge)return;let St=Ym(Ge.buildingLabel,Ge.floorId);if(Ge.mode==="rotate"){const on=(Math.atan2(qe.point.y-Ge.pivotScreen.y,qe.point.x-Ge.pivotScreen.x)-Ge.startAngle)*180/Math.PI,fr=Array.isArray(Ge.basePivot)?Ge.basePivot:Array.isArray(Ge.pivot)?Ge.pivot:St.pivot;St={...St,rotationDeg:(Ge.startRotation||0)+on,pivot:fr}}else if(Ge.mode==="move"){const[zt,on]=fe(Ge.startLngLat,qe.lngLat),fr=qe.lngLat.lng-Ge.startLngLat.lng,_r=qe.lngLat.lat-Ge.startLngLat.lat,jn=Array.isArray(Ge.basePivot)?Ge.basePivot:Array.isArray(Ge.pivot)?Ge.pivot:St.pivot;St={...St,translateMeters:[(Ge.startTranslate?.[0]||0)+zt,(Ge.startTranslate?.[1]||0)+on],translateLngLat:[(Ge.startTranslateLngLat?.[0]||0)+fr,(Ge.startTranslateLngLat?.[1]||0)+_r],pivot:jn}}const ft=$u(O,pa)?._data||$r.current?.fc||null,Xt=ov(ft);Xt&&(St={...St,anchorLngLat:Xt});const en=Ge.adjustLabel||Ge.buildingLabel;R1(en,Ge.floorId,St),Ge.adjustUrl&&M1(Ge.adjustUrl,St),Ge.adjustBasePath&&N1(Ge.adjustBasePath,Ge.floorId,St);try{Bt(en,Ge.floorId,St)}catch{}const bn=zv(St);if(bn&&ft){const zt={...ft,__mfUserAdjustSignature:bn};Ge.adjustUrl&&ms.set(Ge.adjustUrl,zt),$r.current={...$r.current||{},fc:zt}}Ho.current=null,Lr(null),Er("");const un=Ge.adjustUrl||Ri(j,Ge.floorId);un&&!Ge.adjustUrl&&(ms.delete(un),Hu.delete(un));try{O.dragPan.enable()}catch{}try{O.getCanvas().style.cursor=Ge.mode==="move"?"move":"grab"}catch{}};return O.on("mousedown",Ie),O.on("mousemove",Fe),O.on("mouseup",Ye),()=>{try{O.off("mousedown",Ie)}catch{}try{O.off("mousemove",Fe)}catch{}try{O.off("mouseup",Ye)}catch{}}},[k,j,Ri,Tt,Bt]),ci(()=>{if(!k||!_.current)return;const O=_.current,fe=Ye=>{try{Ye.preventDefault?.(),Ye.originalEvent&&(Ye.originalEvent.preventDefault?.(),Ye.originalEvent.stopPropagation?.(),Ye.originalEvent.cancelBubble=!0)}catch{}if(Un.current||oo.current)return;if(c){ts(null);return}co.current=null;const qe=Ye.features?.[0];if(!qe)return;if(Qa){try{const Yr=qe.properties||{},ls=F||j||Yr.Building||Yr.buildingId||"",va=Yr.Floor||mr||Zs?.match(/(BASEMENT|LEVEL_\d+|LEVEL|L\d+)/)?.[0]||"LEVEL_1",zu=qe.id??Yr.RevitId??Yr.revitId??null,yl=Yr.Number??Yr.RoomNumber??Yr.number??Yr.Room??"",id=na(fd(Yr)||Yr.__roomType||""),yf=Yr.department??Yr.Department??Yr.Dept??"",qc=Ff(Yr),Ed=Number.isFinite(qc)?qc:0,ol=ls&&va&&zu!=null?tf(ls,va,zu):null;if(!ol){console.warn("Scenario click: could not build roomId",{buildingId:ls,floorName:va,revitId:zu,props:Yr});return}const Jr=Ye.point||O.project(Ye.lngLat);ee({roomId:ol,buildingId:ls,buildingName:Yr.BuildingName||Yr.buildingName||ls,floorName:va,revitId:zu,roomNumber:yl,roomType:id,department:yf,area:Number(Ed)||0}),Qt(Jr),En()}catch(Yr){console.warn("Scenario click failed",Yr)}return}co.current=qe;const Ge=qe.id??qe.properties?.RevitId??null;Je||ts(Ge),Zs&&(b.current||(b.current={}),b.current[Zs]=Ge);const St=qe.properties||{},Dt=F||j,ft=An,Xt=qe.id??St.RevitId??null,en=St.Floor||mr||Zs?.match(/(BASEMENT|LEVEL_\d+|LEVEL|L\d+)/)?.[0]||"LEVEL_1",bn=Dt&&Xt!=null?tf(Dt,en,Xt):null;if(Qa){if(!bn)return;Du(Yr=>{const ls=new Set(Yr);return ls.has(bn)?ls.delete(bn):ls.add(bn),C(ls),ls});return}const un=bn?Ws.get(bn):null,zt=un?{...St,...un}:St,on=zt.Number??zt.RoomNumber??zt.number??zt.Room??"",fr=na(fd(zt)||zt.__roomType||""),_r=na(zt.__dept||Zy(zt)||""),jn=zt.occupant??zt.Occupant??"",cr=zt.comments??zt.Comments??"",ri=ca(zt),qr=Ff(zt);let Vr=fr,Pi=_r,Ar=Number.isFinite(qr)?qr:null,Sr=jn;const Bi=O8(zt),Ur=e5(zt),Fr=z8(zt),xi=B8(Bi)||Fr.isOfficeText,Dn=D1(fr)||BU(Bi)||Fr.isTeachingText,nn=Dt&&en&&Xt!=null?tf(Dt,en,Xt):null,dn=(Sr??"").toString().trim(),Gn=on||"-",br=String(zt.Revit_UniqueId??zt.RevitUniqueId??St.Revit_UniqueId??St.RevitUniqueId??St["Room GUID"]??"").trim(),ei=mo(Dt),li=Nf(en),Co=String(on??"").trim(),Fn=Ce?.length?Ce:yt,Eo=Array.isArray(Fn)?Fn.find(Yr=>{if(!Yr)return!1;const ls=String(Yr?.roomId??Yr?.roomNumber??Yr?.roomLabel??"").trim(),va=String(Yr?.roomGuid??Yr?.revitUniqueId??"").trim();if(br&&(va===br||ls===br))return!0;const zu=mo(Yr?.building??Yr?.buildingName??Yr?.buildingLabel??"");return ei&&zu!==ei||li.length&&!kf(Yr?.floor??Yr?.floorName??Yr?.floorId??"",li)?!1:Co&&ls===Co}):null,ro=Eo?.airtableId||Eo?.AirtableId||Eo?.["Airtable ID"]||null;if(Je){if(!ut){if(!dn||!nn||Ge==null){console.warn("Cannot start move: missing occupant or identifiers.");return}Nt({roomId:nn,roomLabel:Gn,buildingId:Dt,buildingName:ft,floorId:en,occupantName:dn,revitId:Xt,highlightId:Ge}),dt(null),ts(Ge);return}if(Ge===ut.highlightId){Nt(null),dt(null),ts(null);return}if(Dt!==ut.buildingId||en!==ut.floorId){Nt(null),dt(null),ts(null);return}dt({person:ut.occupantName,effectiveDate:"",comments:"",from:ut,to:{roomId:nn,roomLabel:Gn,buildingId:Dt,buildingName:ft,floorId:en,revitId:Xt,highlightId:Ge}});return}const Rl=f,rl=zt.Floor||en,il=!!(t==="admin"&&Rl&&Dt&&rl&&Xt!=null&&e),Yi=il?tf(Dt,rl,Xt):null,Wn=il?{roomId:Yi,buildingId:Dt,floorName:rl,revitId:Xt,roomGuid:br||null,roomLabel:Gn,roomNumber:on||"",feature:qe,flags:{isOffice:xi,isTeaching:Dn},highlightId:Ge,properties:{type:Vr||"",department:Pi||"",area:Number.isFinite(Ar)?Ar:"",occupant:Sr||"",occupancyStatus:ri||"",comments:cr||"",roomGuid:br||"",Revit_UniqueId:br||"",airtableId:ro}}:null;let cu=Oa.current||[];if(Wn){const Yr=Oa.current||[];Yr.findIndex(va=>va.roomId===Wn.roomId)>=0?cu=Yr.filter(va=>va.roomId!==Wn.roomId):cu=[...Yr,Wn],Oa.current=cu,yu(cu),Sl(cu)}const zh=()=>{const Yr=Number.isFinite(Ar)&&Ar!==0?Math.round(Ar).toLocaleString():"",va=(Oa.current||[]).length,zu=va>0,yl=va>1?`Edit ${va} Rooms`:"Edit",id=il?`<div class="mf-popup-actions" style="margin-top:6px;padding-top:6px;gap:6px;flex-wrap:wrap;width:100%;">
               <button id="mf-room-edit-btn" class="mf-btn tiny">${yl}</button>
               ${zu?'<button id="mf-clear-edit-selection" class="mf-btn tiny" style="background:#f4f4f4;color:#333;">Clear Selection</button>':""}
             </div>`:"",yf=Number.isFinite(Ur)&&Ur>0,qc=(Sr??"").toString().trim(),Ed=D1(Vr||""),ol=yf?Ur.toLocaleString():"-",Jr=Ed?`<div><b>Seat Count:</b> ${ol}</div>`:"",Ml=qc.length?qc:"-",Is=Ed?"":`<div><b>Occupant:</b> ${Ml}</div>`,bs=Ed?He(ft,on||Gn):null,Va=bs&&(Number.isFinite(bs.timeUtilization)||Number.isFinite(bs.seatUtilization)),Kl=(ka,qd,Ad)=>{if(!Number.isFinite(qd))return"";const $d=Math.max(0,Math.min(qd,100));return`
            <div style="margin-top:3px;">
              <div style="font-size:10px;color:#444;">${ka}: ${Math.round(qd)}%</div>
              <div style="height:4px;background:#e4e7ec;border-radius:999px;overflow:hidden;">
                <div style="width:${$d}%;height:100%;background:${Ad};"></div>
              </div>
            </div>
          `},Go=Va?`
            <div style="margin-top:6px; width:100%; max-width:220px;">
              ${Kl("Time Util",bs.timeUtilization,"#3b82f6")}
              ${Kl("Seat Util",bs.seatUtilization,"#f59e0b")}
            </div>
          `:"",_f=il&&va?`<div style="font-size:11px;color:#555;margin-top:6px;">Rooms selected: ${va}</div>`:"";return`
          <div class="mf-popup" style="min-width:340px;max-width:460px;background:#fff;border-radius:8px;box-shadow:0 8px 24px rgba(0,0,0,0.15);padding:2px;">
            <div class="mf-popup-body" style="padding:8px 12px 16px 12px;">
              <div class="mf-title">Room ${on||"-"}</div>
              <div><b>Room Type:</b></div>
              <div style="white-space:normal;word-break:break-word;margin-bottom:2px;">${Vr||"-"}</div>
              <div><b>Department:</b> ${Pi||"-"}</div>
              <div><b>Area (SF):</b> ${Yr||"-"}</div>
              <div><b>Floor:</b> ${rl}</div>
              ${Jr}
              ${Is}
              ${Go}
              ${_f}
              ${id}
            </div>
          </div>`},Vd=O.project(Ye.lngLat),ml=m.current?.clientWidth||1e3,jh=Vd.x>ml*.56?"right":"left",as=jh==="left"?240:-240,gl={top:[as,12],"top-left":[as,12],"top-right":[as,12],bottom:[as,-12],"bottom-left":[as,-12],"bottom-right":[as,-12],left:[as,0],right:[as,0]},Wl=new Rd.Popup({closeButton:!0,offset:gl,anchor:jh,maxWidth:"520px"}).setLngLat(Ye.lngLat).setHTML(zh()).addTo(O);Wl.on("close",()=>{if(!Je&&!ut){const Yr=sc(Oa.current||[]);ts(Yr.length?Yr:null)}});const Sd=async()=>{try{Wl.remove()}catch{}const Yr=As.current||Yu.current;if(Yr){we(Re.SPACE_DATA),Jt(!1),ir(!1);try{const ls=O.project(Ye.lngLat);Hl(jt(ls))}catch{}Sc.current?q(Sc.current):j&&q(j),$e(Yr)}},gf=()=>{if(!il)return;const ls=Ks.length?Yi&&Ks.some(id=>id.roomId===Yi)||!Wn?Ks:[...Ks,Wn]:Wn?[Wn]:[];if(!ls.length)return;const va=yl=>{const id=ls.map(qc=>qc?.properties?.[yl]??""),yf=id[0];return id.every(qc=>qc===yf)?yf:""},zu={type:va("type"),department:va("department"),occupant:va("occupant"),occupancyStatus:va("occupancyStatus"),comments:va("comments"),area:va("area")};Aa({...ls[0],targets:ls,roomLabel:ls.length===1?ls[0]?.roomLabel||"-":`${ls.length} rooms`,properties:zu,includedKeys:new Set(ls.map(yl=>yl.roomId||String(yl.revitId??""))),refreshPopup:()=>{Wl.setHTML(zh()),Ah()},onApply:yl=>{"type"in yl&&(Vr=yl.type),"department"in yl&&(Pi=yl.department),"occupant"in yl&&(Sr=yl.occupant)}}),bl(new Set(ls.map(yl=>yl.roomId||String(yl.revitId??"")))),vs(!0)},pc=()=>{Oa.current=[],yu([]),Sl([]);try{Wl.remove()}catch{}};function Ah(){const Yr=Wl.getElement();Yr&&(Yr.querySelector("#mf-show-floor")?.addEventListener("click",Sd),il&&(Yr.querySelector("#mf-room-edit-btn")?.addEventListener("click",gf),Yr.querySelector("#mf-clear-edit-selection")?.addEventListener("click",pc)))}Ah()},Ie=()=>{if(!(Un.current||oo.current)&&!c)try{O.getCanvas().style.cursor="pointer"}catch{}},Fe=()=>{if(!(Un.current||oo.current))try{O.getCanvas().style.cursor=""}catch{}};return O.on("click",Do,fe),O.on("mouseenter",Do,Ie),O.on("mouseleave",Do,Fe),()=>{try{O.off("click",Do,fe),O.off("mouseenter",Do,Ie),O.off("mouseleave",Do,Fe)}catch{}co.current=null}},[k,Zs,j,F,mr,$e,we,Jt,ir,Hl,ki,Ws,yt,Ce,f,y,e,te,Le,ge,Me,oi,Qa,Je,ut,ts,Ks,Vl,Sl,sc,c]),ci(()=>{if(!k||!_.current)return;const O=_.current,fe=Ie=>{const Fe=_.current;if(!Fe||Un.current||oo.current)return;const Ye=Sc.current;if(!Ye)return;if(!!!Fe.getLayer(Do)){_e(Ye);return}const Ge=Ie.point,St=Fe.queryRenderedFeatures(Ge,{layers:[Do]});if(St&&St.length||!!!Fe.getLayer("buildings-fill"))return;Fe.queryRenderedFeatures(Ge,{layers:["buildings-fill"]})?.some(en=>en.properties?.id===Ye)&&(As.current=null,_e(Ye))};return O.on("click",fe),()=>{try{O.off("click",fe)}catch{}}},[k,_e]);const Ud=nr(()=>{},[]),Bh=nr(async()=>{const O=Ec.current||F||j;if(!O){alert("No building selected for export.");return}if(!pl.length){alert("No floors available for export.");return}const fe=[];for(const qe of pl){const Ge=Ri(O,qe);if(!Ge)continue;const St=await hd(Ge),Dt=Au(St);if(!Dt?.features?.length)continue;const ft=Yg({fc:Dt,colorMode:$i,solidFill:!0,labelOptions:{hideDrawing:!0}});ft&&fe.push({img:ft,label:`${An} - ${qe}`})}if(!fe.length){alert("No floorplans could be rendered for export.");return}const Ie=pp(qt?.totalsByDept),Fe={totalSF:qt?.totalSf,rooms:qt?.rooms,classroomSf:qt?.classroomSf,classroomCount:qt?.classroomCount,levels:pl.length},Ye=`${An.replace(/\s+/g,"-").toLowerCase()}-floors`;Rs(fe,{filenameBase:Ye,stats:Fe,keyDepts:Ie,summaryLabel:`${An} Floors`})},[pl,An,Ri,Rs,j,F]);return Y.jsxs("div",{ref:u,className:"map-page-container",children:[Y.jsx("div",{className:"page",children:Y.jsx("div",{className:"map-wrapper",children:Y.jsx("div",{ref:m,className:"map-container"})})}),Mn&&Y.jsx("div",{style:{position:"fixed",inset:0,zIndex:10010,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Y.jsxs("div",{className:"mf-ai-modal-panel",style:{width:"min(560px, 92vw)",padding:16},children:[Y.jsx("div",{style:{fontWeight:700,fontSize:16},children:"Mapbox Token Required"}),Y.jsx("div",{style:{marginTop:8,fontSize:13,color:"#333"},children:"Enter a Mapbox public token (`pk...`) once for this browser to load the map."}),Y.jsx("input",{value:ot,onChange:O=>{dr(O.target.value),wr&&Cr("")},placeholder:"pk.eyJ...",style:{width:"100%",marginTop:10,padding:"8px 10px",borderRadius:8,border:"1px solid #d0d0d0"}}),wr?Y.jsx("div",{style:{marginTop:8,color:"crimson",fontSize:12},children:wr}):null,Y.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:12},children:[Y.jsx("button",{className:"btn",onClick:()=>{try{window.localStorage.removeItem("MAPBOX_PUBLIC_TOKEN")}catch{}dr("")},children:"Clear"}),Y.jsx("button",{className:"btn primary",onClick:Fu,children:"Save & Reload"})]})]})}),t==="admin"&&!xe&&Y.jsx("button",{className:"controls-toggle-button",onClick:()=>pt(O=>!O),children:gt?"Hide Controls":"Show Controls"}),c&&xe&&Y.jsx("div",{style:{position:"absolute",left:16,top:16,zIndex:40,display:"flex",gap:8},children:Y.jsx("button",{className:"btn",onClick:vd,children:"Exit Presentation"})}),Dc&&Y.jsx("div",{style:{position:"fixed",inset:0,zIndex:10002,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Y.jsxs("div",{className:"mf-ai-modal-panel",style:{width:"min(520px, 92vw)",padding:16,lineHeight:1.4},children:[Y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[Y.jsxs("div",{children:[Y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[Y.jsx("div",{style:{fontWeight:700,fontSize:16},children:"Ask Mapfluence"}),Y.jsx("span",{title:"AI-generated response based on currently loaded space data.",style:{fontSize:11,padding:"2px 8px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:"#f7f7ff"},children:" AI"})]}),Y.jsx("div",{style:{fontSize:12,color:"#555"},children:"Ask questions about loaded campus data."})]}),Y.jsx("button",{className:"btn",onClick:()=>Ko(!1),children:"Close"})]}),Y.jsxs("div",{style:{marginTop:10},children:[Y.jsx("label",{style:{fontWeight:600,fontSize:12},children:"Question"}),Y.jsx("textarea",{value:ga,onChange:O=>Xa(O.target.value),rows:3,placeholder:"e.g. How many vacant offices are on campus?",style:{width:"100%",resize:"vertical",padding:8,borderRadius:8,border:"1px solid #d0d0d0",marginTop:4}})]}),_c?Y.jsx("div",{style:{color:"crimson",marginTop:6,fontSize:12},children:_c}):null,Y.jsx("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:10},children:Y.jsx("button",{className:"btn",disabled:ul||!ga.trim()||Oi,onClick:Ys,children:ul?"Asking...":"Ask"})})]})}),Ai&&Y.jsx("div",{style:{position:"fixed",inset:0,zIndex:10004,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Y.jsxs("div",{className:"mf-ai-modal-panel",style:{width:"min(720px, 94vw)",padding:16,lineHeight:1.45,maxHeight:"86vh",overflowY:"auto"},children:[Y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,alignItems:"center"},children:[Y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[Y.jsx("div",{style:{fontWeight:700,fontSize:16},children:"Ask Mapfluence"}),Y.jsx("span",{title:"AI-generated response based on currently loaded space data.",style:{fontSize:11,padding:"2px 8px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:"#f7f7ff"},children:" AI"})]}),Y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[Y.jsx("button",{className:"btn",onClick:_d,children:"Copy CSV"}),Y.jsx("button",{className:"btn",onClick:Fh,children:"Export PDF"}),Y.jsx("button",{className:"btn",onClick:()=>Ss(null),children:"Close"})]})]}),Y.jsx("p",{style:{marginTop:10},children:Ai.answer}),Ai.bullets?.length?Y.jsx("ul",{style:{margin:"6px 0 10px 18px",padding:0},children:Ai.bullets.map((O,fe)=>Y.jsx("li",{children:O},fe))}):null,Ai.resultType==="table"&&Ai.columns?.length&&Ai.rows?.length?Y.jsx("div",{style:{marginTop:10,overflowX:"auto"},children:Y.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[Y.jsx("thead",{style:{background:"#f8f9fb"},children:Y.jsx("tr",{children:Ai.columns.map(O=>Y.jsx("th",{style:{textAlign:"left",padding:"6px 8px",borderBottom:"1px solid #e0e0e0"},children:O},O))})}),Y.jsx("tbody",{children:Ai.rows.map((O,fe)=>Y.jsx("tr",{style:{borderBottom:"1px solid #f0f0f0"},children:Ai.columns.map(Ie=>Y.jsx("td",{style:{padding:"6px 8px"},children:O&&O[Ie]!=null?String(O[Ie]):""},Ie))},fe))})]})}):null,Ai.missingData?.length?Y.jsxs("div",{style:{marginTop:10,fontSize:12,color:"#555"},children:["Missing data: ",Ai.missingData.join(", ")]}):null]})}),!xe&&Y.jsxs("div",{className:"mf-right-rail",children:[Y.jsxs("div",{className:"mf-right-logos",children:[Y.jsxs("div",{className:"logo-box",children:[Y.jsx("div",{className:"mapfluence-title",children:"MAPFLUENCE"}),Y.jsx("img",{className:"mf-logo mf-logo--mapfluence",src:nf("Clark_Enersen_Logo.png"),alt:"Clark & Enersen Logo"})]}),Y.jsx("div",{className:"logo-box",children:Y.jsx("img",{className:"mf-logo mf-logo--hc",src:nf("HC_image.png"),alt:"Hastings College"})})]}),!c&&Y.jsx("div",{className:"dashboard-box",children:Y.jsx(xU,{title:oa,scopeLabel:Rp,metrics:$s,loading:Gs,error:vc,utilization:zd,utilizationScopeLabel:Em,heatmapOn:zo,onToggleHeatmap:es})})]}),t==="admin"&&Y.jsxs(Y.Fragment,{children:[Me===Re.ASSESSMENT&&F&&!Mt&&Eh&&Y.jsx("div",{className:"floating-panel",style:{position:"absolute",zIndex:40,left:Math.max(8,Math.min(Eh.x+12,(m.current?.clientWidth||1e3)-360)),top:Math.max(8,Math.min(Eh.y+12,(m.current?.clientHeight||800)-260)),width:340},children:Y.jsx(lj,{buildingId:F,buildingName:n?.buildings?.features?.find(O=>O.properties.id===F)?.properties?.name,currentCondition:ke[F],onSave:Ud,onOpenTechnical:()=>Jt(!0),onClose:()=>{q(null),Jt(!1),Hl(null)},canWrite:f})}),Me===Re.TECHNICAL&&F&&Mt&&Y.jsx(aj,{buildingId:F,assessments:pe,universityId:e,panelPos:Eh,isAdminRole:f,onClose:()=>Jt(!1),onSave:handleAssessmentSave})]}),Me===Re.SPACE_DATA&&(F||j)&&!Ln&&(()=>{const O=m.current?.clientWidth||1e3,fe=m.current?.clientHeight||800,Ie=360,Fe=420,Ye=16,qe=260,Ge=24,St=140,Dt=(Ar,Sr,Bi)=>Math.max(Sr,Math.min(Ar,Bi)),ft=Math.max(300,Math.min(Ie,O-Ye*2)),Xt=Ye+40,en=Dt(O-ft-Xt,12,O-ft-12),bn=Dt(O-ft-qe-Ge-St,320,O-ft-12),un=12,zt=Eh||{y:fe*.65},on=Dt(zt.y,8,fe-Fe-8),fr=bn,_r=on,jn=fl.current;let cr=null;if(jn&&jn.geometry)try{const Ar=Cu(jn);if(Ar&&Ar.length===4&&Ar.every(Sr=>Number.isFinite(Sr))){const Sr=(Ar[1]+Ar[3])/2,Bi=_.current?.project?_.current.project({lng:Ar[2],lat:Sr}):null;if(Bi){const Ur=en,Fr=Dt(Bi.y-Fe*.35,8,fe-Fe-8);cr={left:Ur,top:Fr}}}}catch{}const ri={position:"absolute",zIndex:40,left:fr,top:_r,width:ft,maxHeight:"75vh",overflow:"auto"},qr=cr?{position:"absolute",zIndex:40,left:Math.max(12,Math.min(cr.left,O-ft-Ye)),top:un,width:ft,maxHeight:"80vh",overflow:"auto"}:ri,Vr=Pr==="floor"?qr:ri,Pi=Qh?{...Vr,left:Qh.x,top:Qh.y}:Vr;return Y.jsxs("div",{ref:I,className:"floating-panel",style:Pi,children:[Pr==="building"&&Y.jsx(pU,{buildingName:An,stats:qt,keyDepts:pp(qt?.totalsByDept),utilization:ve(An),floors:pl,selectedFloor:Ts,onChangeFloor:Ar=>eo(Ar),onLoadFloorplan:Ci,onExportCSV:()=>th(An),onClose:()=>{ir(!0),q(null),Hl(null),xd(null),As.current=null,Ec.current=null,fl.current=null,Pn(null),Bn(null),or(null),Si("building")},onExportPDF:Bh,onExplainBuilding:Ns,explainBuildingLoading:cl,explainBuildingDisabled:Oi||!qt,explainBuildingError:er,dragHandleProps:_m}),Pr==="floor"&&Y.jsx(mU,{buildingName:An,floorLabel:Hn?.floorLabel||Ts,stats:Hn,legendItems:si,legendTitle:{department:"Key Departments",type:"Key Types",occupancy:"Occupancy",vacancy:"Vacancy"}[$i]||"Legend",floors:pl,selectedFloor:Ts,onChangeFloor:Ar=>eo(Ar),onLoadFloorplan:Ci,onUnloadFloorplan:ns,onExportCSV:()=>th(An),colorMode:$i,onChangeColorMode:Ar=>{jl(Ar),El(Ar)},legendSelection:et,onLegendClick:Ar=>{const Sr=Ee.get(Ar)||[];ht(Bi=>{const Ur=Bi===Ar?null:Ar;return ts(Ur?Sr:null),Ur})},onClose:()=>{ir(!0),q(null),Hl(null),xd(null),As.current=null,Ec.current=null,fl.current=null,Pn(null),Bn(null),or(null),Si("building")},onExportPDF:ps,onExplainFloor:Ms,explainLoading:ra,explainDisabled:Oi||!Hn,explainError:Yo,moveScenarioMode:Qa,onToggleMoveScenarioMode:xs,rotateActive:t==="admin"&&kr==="rotate",moveActive:t==="admin"&&kr==="move",rotateValue:t==="admin"?mi:0,scaleValue:t==="admin"?xr:1,rotateNotice:t==="admin"?jr:"",rotateStored:t==="admin"?Ii:!1,adjustDebugInfo:t==="admin"?ni:null,onStartRotate:t==="admin"?Wt:void 0,onStartMove:t==="admin"?Cn:void 0,onCancelRotate:t==="admin"?Ut:void 0,onClearRotate:t==="admin"?rn:void 0,onSaveAdjust:t==="admin"?async()=>{const Ar=Tt();if(!Ar?.buildingLabel||!Ar?.floorId)return;const Sr=$r.current?.floorAdjustLabel||Ar.buildingLabel,Bi=Ar.url||$r.current?.url||Ri(j,Ar.floorId),Ur=Ar.basePath||$r.current?.floorAdjustBasePath||null,Fr=Jn||Ym(Sr,Ar.floorId),xi=$r.current?.floorAdjustBasePivot||$r.current?.fc&&Ol($r.current.fc)?.geometry?.coordinates||null,nn=$u(_.current,pa)?._data||$r.current?.fc||null,dn=ov(nn),Gn={...Fr,pivot:Array.isArray(Fr.pivot)?Fr.pivot:Array.isArray(xi)?xi:null,anchorLngLat:dn||Fr.anchorLngLat||null};R1(Sr,Ar.floorId,Gn),Bi&&M1(Bi,Gn),Ur&&N1(Ur,Ar.floorId,Gn);try{await Bt(Sr,Ar.floorId,Gn)}catch{}Bi&&(ms.delete(Bi),Hu.delete(Bi))}:void 0,saveAdjustDisabled:t==="admin"?!Ii:!0,onScaleChange:t==="admin"?Ar=>{const Sr=Tt();if(!Sr?.buildingLabel||!Sr?.floorId)return;const Bi=Sr.url||$r.current?.url||Ri(j,Sr.floorId),Ur=Sr.basePath||$r.current?.floorAdjustBasePath||null,Fr=Ur?jy(Ur,Sr.floorId):null,xi=mp(Fr),Dn=Bi?zy(Bi):null,nn=mp(Dn),dn=xi?Fr:nn?Dn:Ym(Sr.buildingLabel,Sr.floorId),Gn=Math.max(.5,Math.min(2.5,(dn.scale||1)+Ar)),br=Gn/(dn.scale||1),ei=$u(_.current,pa),li=ei?._data||$r.current?.fc||null,Co=li&&Ol(li)?.geometry?.coordinates||null;let Fn=null;li&&Co&&Number.isFinite(br)&&Math.abs(br-1)>1e-6&&(Fn=fg(li,br,{origin:Co}),ei&&ei.setData(Fn));const Eo={...dn,scale:Gn},ro=$r.current?.floorAdjustLabel||Sr.buildingLabel,Rl=$r.current?.floorAdjustBasePivot||li&&Ol(li)?.geometry?.coordinates||null,rl={...Eo,pivot:Array.isArray(Rl)?Rl:Eo.pivot,anchorLngLat:ov(Fn||ei?._data||li)||Eo.anchorLngLat||null};R1(ro,Sr.floorId,rl),Bi&&M1(Bi,rl),Ur&&N1(Ur,Sr.floorId,rl);try{Bt(ro,Sr.floorId,rl)}catch{}const il=zv(rl),Yi=li||$r.current?.fc||null;if(il&&Yi){const cu={...Yi,__mfUserAdjustSignature:il};Bi&&ms.set(Bi,cu),$r.current={...$r.current||{},fc:cu}}const Wn=Bi||Ri(j,Sr.floorId);Wn&&!Bi&&(ms.delete(Wn),Hu.delete(Wn))}:void 0,dragHandleProps:_m})]})})(),Qa&&df&&Y.jsxs("div",{ref:V,className:"floating-panel mf-move-scenario-panel",style:{position:"absolute",zIndex:60,right:Ua?"auto":16,left:Ua?Ua.x:"auto",top:Ua?Ua.y:Yh,width:320,maxHeight:"70vh",overflow:"auto",padding:12,fontSize:13},children:[Y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6},...wg,children:[Y.jsx("div",{style:{fontWeight:600},children:"Move Scenario"}),Y.jsx("button",{className:"btn secondary",style:{fontSize:11,padding:"2px 6px"},onClick:uc,children:"Clear"})]}),Y.jsxs("div",{style:{marginBottom:8},children:[Y.jsx("label",{style:{display:"block",fontSize:12,marginBottom:2},children:"Scenario label (optional)"}),Y.jsx("input",{className:"mf-input",value:ja,onChange:O=>su(O.target.value),placeholder:"e.g. Art Dept to Hurley - Option A",style:{width:"100%"}})]}),Y.jsxs("div",{style:{marginBottom:8},children:[Y.jsxs("div",{children:[Y.jsx("b",{children:"Total SF:"})," ",Math.round(to.totalSF).toLocaleString()]}),Y.jsxs("div",{children:[Y.jsx("b",{children:"Rooms:"})," ",to.rooms]})]}),Y.jsxs("div",{style:{marginBottom:8},children:[Y.jsx("div",{style:{fontWeight:600,marginBottom:2},children:"Rooms by Room Type Description"}),Dh.length===0?Y.jsx("div",{style:{fontSize:12,fontStyle:"italic",color:"#666"},children:"No rooms selected."}):Y.jsxs("table",{style:{width:"100%",fontSize:12},children:[Y.jsx("thead",{children:Y.jsxs("tr",{children:[Y.jsx("th",{style:{textAlign:"left"},children:"Room Type Description"}),Y.jsx("th",{style:{textAlign:"right"},children:"Qty"}),Y.jsx("th",{style:{textAlign:"right"},children:"SF"})]})}),Y.jsx("tbody",{children:Dh.map(({type:O,count:fe,sf:Ie})=>Y.jsxs("tr",{children:[Y.jsx("td",{children:O}),Y.jsx("td",{style:{textAlign:"right"},children:fe}),Y.jsx("td",{style:{textAlign:"right"},children:Math.round(Ie).toLocaleString()})]},O))})]})]}),Y.jsxs("div",{style:{marginTop:4},children:[Y.jsx("label",{style:{fontSize:12},children:"Scenario Department"}),Y.jsxs("select",{className:"mf-input",value:Ui,onChange:O=>da(O.target.value),children:[Y.jsx("option",{value:"",children:"Choose department..."}),ao.map(O=>Y.jsx("option",{value:O,children:O},O))]}),Y.jsx("button",{className:"btn primary",style:{marginTop:6},onClick:Ve,disabled:!Ui||Uc.size===0,children:"Commit"})]}),Y.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap",marginTop:8},children:[Y.jsx("button",{className:"btn primary",onClick:$o,disabled:Oi||yc||!Ui||!to,title:Ui?to?"Compare scenario vs current allocation for this department.":"Enable Move Scenario Mode and create a scenario to compare.":"Select a department for the scenario before comparing.",children:yc?"Comparing...":" Compare scenario vs current"}),Ma?Y.jsx("div",{style:{color:"crimson",fontSize:12},children:Ma}):null]}),Y.jsx("button",{className:"btn secondary",style:{width:"100%",marginTop:6},onClick:async()=>{try{const O=new wi("p","pt","letter"),fe=O.internal.pageSize.getWidth(),Ie=O.internal.pageSize.getHeight(),Fe=20,Ye=Yg({...$r.current,labelOptions:{hideDrawing:!0}});let qe=!1,Ge=0,St=0;if(Ye){const Ar=Ye.height&&Ye.width?Ye.height/Ye.width:1,Sr=Math.min(fe*.55,fe-Fe*3),Bi=Ie-Fe*2;Ge=Sr,St=Ge*Ar,St>Bi&&(St=Bi,Ge=St/(Ar||1)),O.addImage(Ye.data,"PNG",Fe,Fe,Ge,St),qe=!0}const Dt="Move Scenario",ft=ja||"Move Scenario",Xt=ja?.trim()?ja.trim():"",en=qe?Ge+Fe*2:Fe,bn=fe-en-Fe,un=16;let zt=Fe;O.setFontSize(14),O.text(Dt,en,zt),Xt&&O.text(Xt,en+bn,zt,{align:"right"}),zt+=un,O.setFontSize(12);const on=Ar=>{O.text(Ar,en,zt,{maxWidth:bn}),zt+=un},fr=Ui||"None selected",_r=rf(Ui)||"#AAAAAA",jn=14;O.setDrawColor(0),O.setFillColor(_r),O.rect(en,zt,jn,jn,"FD");const cr=`Scenario Dept: ${fr}`;O.setTextColor("#000000"),O.setFont(void 0,"bold");const ri=O.splitTextToSize(cr,Math.max(50,bn-jn-6));ri.forEach((Ar,Sr)=>{O.text(Ar,en+jn+6,zt+jn-4+Sr*un)}),O.setFont(void 0,"normal"),zt+=Math.max(jn,ri.length*un)+un/2,O.setFontSize(12),on(`Total SF: ${Math.round(to.totalSF).toLocaleString()}`),on(`Rooms: ${to.rooms}`),zt+=un/2,O.setFont(void 0,"bold"),O.text("Rooms by Type",en,zt),zt+=un;const qr=en+bn*.65,Vr=en+bn;if(O.setFontSize(11),O.text("Type",en,zt),O.text("Qty",qr,zt,{align:"right"}),O.text("SF",Vr,zt,{align:"right"}),zt+=un,O.setFont(void 0,"normal"),!Dh.length)O.text("No rooms selected.",en,zt),zt+=un;else{const Ar=Math.max(bn-120,100);Dh.forEach(({type:Sr,count:Bi,sf:Ur})=>{const Fr=Math.round(Ur).toLocaleString(),xi=O.splitTextToSize(Sr,Ar);xi.forEach((Dn,nn)=>{O.text(Dn,en,zt+nn*(un*.9))}),O.text(String(Bi),qr,zt,{align:"right"}),O.text(Fr,Vr,zt,{align:"right"}),zt+=un*Math.max(1,xi.length*.9)})}O.setFont(void 0,"normal"),O.setFontSize(12),zt+=un/4;const Pi=`${(ft||"move-scenario").replace(/\s+/g,"-").toLowerCase()}.pdf`;O.save(Pi)}catch(O){console.error("Scenario export failed",O),alert("Export failed - see console for details.")}},children:"Export Scenario (PDF)"})]}),gt&&!xe&&Y.jsx("div",{className:"map-controls-panel",style:{width:270,fontSize:12.5,lineHeight:1.25},children:Y.jsxs("div",{className:"map-controls",children:[t==="admin"&&Y.jsx("div",{className:"control-section",style:{background:"#fff",padding:6,border:"1px solid #ddd",borderRadius:6,marginBottom:4},children:Y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,justifyContent:"space-between"},children:[Y.jsx("h5",{style:{margin:0,fontSize:13},children:"Admin access"}),y?Y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[Y.jsxs("span",{style:{fontSize:12,whiteSpace:"nowrap"},children:[y.email," ",f?"(admin)":"(no admin)"]}),Y.jsx("button",{onClick:kp,children:"Sign out"})]}):Y.jsx("button",{onClick:wd,children:"Sign in with Google"})]})}),!c&&Y.jsxs("div",{className:"control-section theme-selector",style:{marginTop:6},children:[Y.jsx("label",{htmlFor:"theme-select",style:{marginRight:8},children:"Map View:"}),Y.jsx("select",{id:"theme-select",value:Me,onChange:O=>we(O.target.value),disabled:rt.length<=1,children:rt.map(O=>Y.jsx("option",{value:O.value,children:O.label},O.value))})]}),c&&Y.jsxs("div",{className:"legend",style:{marginTop:6},children:[Y.jsx("h4",{children:"Legend"}),Y.jsxs("div",{style:{display:"grid",gap:6,marginBottom:10},children:[Y.jsx("button",{className:"btn",onClick:()=>{const O=!De;tt(O),O&&ya(!1)},children:De?"Show Marker Dots":"Show Engagement Heatmap"}),Y.jsx("button",{className:"btn",onClick:()=>Ru(O=>!O),disabled:!Qr||!Vo,children:aa?"Hide Room Sentiment":"Show Room Sentiment"}),Y.jsx("button",{className:"btn",onClick:()=>{const O=!ks;ya(O),O&&(tt(!1),Ru(!0))},disabled:!Qr||!Vo,children:ks?"Exit Room Sentiment Only":"Room Sentiment Only"}),Y.jsx("button",{className:"btn",onClick:vd,children:xe?"Exit Presentation":"Presentation Mode"}),Y.jsx("div",{style:{fontSize:11,color:"#555"},children:"Tip: use `?presentation=1` in the URL for clean preview mode."}),Ne&&Y.jsxs("div",{style:{fontSize:11,color:"#777"},children:["Build: ",Ne]}),(!Qr||!Vo)&&Y.jsx("div",{style:{fontSize:11,color:"#666"},children:"Room sentiment coloring is available in Floorplan mode with a loaded floor."})]}),De&&Y.jsxs("div",{className:"legend-section",style:{marginBottom:10},children:[Y.jsx("h5",{children:"Heat Colors"}),Y.jsx("div",{style:{height:10,borderRadius:6,border:"1px solid #ddd",background:"linear-gradient(90deg, #1d4ed8 0%, #60a5fa 14%, #67e8f9 30%, #ffe44d 56%, #fb923c 78%, #ef4444 100%)"}}),Y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:11,color:"#555",marginTop:4},children:[Y.jsx("span",{children:"Cool"}),Y.jsx("span",{children:"Warm"})]}),Y.jsx("div",{style:{fontSize:11,color:"#666",marginTop:4},children:"Category cores plus thermal multicolor halo (comments stay gray dots only)."})]}),aa&&Qr&&Vo&&Y.jsxs("div",{className:"legend-section",style:{marginBottom:10},children:[Y.jsx("div",{style:{fontSize:11,fontWeight:600,marginBottom:6},children:"Room Fill Style"}),Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6,marginBottom:8},children:[Y.jsx("button",{className:"btn",style:{fontWeight:dl==="solid"?700:500,borderColor:dl==="solid"?"#1f2937":void 0},onClick:()=>xc("solid"),children:"Solid"}),Y.jsx("button",{className:"btn",style:{fontWeight:dl==="gradient"?700:500,borderColor:dl==="gradient"?"#1f2937":void 0},onClick:()=>xc("gradient"),children:"Gradient"})]}),Y.jsx("h5",{children:"Room Sentiment (Dominant)"}),kl.legendItems.length?Y.jsxs(Y.Fragment,{children:[kl.legendItems.map(O=>Y.jsxs("div",{className:"legend-item",style:{justifyContent:"space-between"},children:[Y.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[Y.jsx("span",{className:"legend-color-box",style:{backgroundColor:O.color}}),Y.jsx("span",{children:O.label})]}),Y.jsxs("span",{style:{fontSize:11,color:"#555"},children:[O.roomCount," rooms"]})]},O.category)),Y.jsxs("div",{style:{fontSize:11,color:"#666",marginTop:4},children:[kl.markerCount.toLocaleString()," markers matched inside ",kl.roomCount.toLocaleString()," rooms."]})]}):Y.jsx("div",{style:{fontSize:11,color:"#666"},children:"No markers are currently inside room polygons on this loaded floor."})]}),Y.jsxs("div",{className:"legend-section",children:[Y.jsx("h5",{children:"Marker Types"}),Object.entries(lu||{}).map(([O,fe])=>Y.jsxs("div",{className:"legend-item",children:[Y.jsx("span",{className:"legend-color-box",style:{backgroundColor:c&&nd[O]||fe}}),Y.jsx("span",{children:O})]},O))]})]}),Y.jsxs("div",{className:"floorplans-section",style:{marginTop:8,padding:6,borderRadius:8,border:"1px solid rgba(0,0,0,0.25)",background:"linear-gradient(180deg, rgba(235,250,240,0.9), rgba(220,242,230,0.9))"},children:[Y.jsx("h4",{style:{margin:"0 0 6px 0",fontSize:12.5},children:"Floorplans"}),Y.jsxs("div",{className:"floorplans",style:{display:"grid",gap:6},children:[c&&Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6},children:[Y.jsx("button",{className:"btn",style:{width:"100%",fontWeight:bh==="campus"?700:500,borderColor:bh==="campus"?"#1f2937":void 0},onClick:()=>{jc("campus"),ns()},children:"Campus"}),Y.jsx("button",{className:"btn",style:{width:"100%",fontWeight:bh==="floor"?700:500,borderColor:bh==="floor"?"#1f2937":void 0},onClick:()=>{jc("floor"),Qr||Ni()},disabled:!pl.length,children:"Floorplan"})]}),Y.jsx("select",{id:"fp-building",style:{width:"100%"},value:j,onChange:O=>{const fe=O.target.value;H(fe)},children:dd.map(O=>Y.jsx("option",{value:O.name,children:O.name},O.name))}),Y.jsx("select",{id:"fp-floor",style:{width:"100%"},value:mr??"",onChange:O=>eo(O.target.value),disabled:!pl.length,children:pl.map(O=>Y.jsx("option",{value:O,children:O},O))}),Y.jsx("button",{className:"btn",style:{width:"100%"},onClick:()=>{c&&jc("floor"),Ni()},disabled:!pl.length,children:"Load"}),Y.jsx("button",{className:"btn",style:{width:"100%"},onClick:()=>{c&&jc("campus"),ns()},children:"Unload"}),Y.jsx("button",{className:"btn",style:{width:"100%"},onClick:()=>AT(_.current),disabled:!Qr,children:"Center"})]}),!c&&Y.jsxs("div",{style:{marginTop:8},children:[Y.jsxs("button",{className:"mf-btn",style:{width:"100%",fontWeight:600},onClick:xs,children:["Move Scenario Mode ",Qa?"ON":"OFF"]}),Qa&&Y.jsx("div",{style:{marginTop:6,fontSize:11,color:"#555",textAlign:"center"},children:"Click rooms to add/remove them from a what-if scenario. Real data is not changed."})]})]}),!c&&Y.jsxs("div",{className:"floorplans-section",style:{marginTop:8,padding:6,borderRadius:8,border:"1px solid rgba(0,0,0,0.25)",background:"linear-gradient(180deg, rgba(255,247,235,0.9), rgba(255,239,219,0.9))"},children:[Y.jsx("h4",{style:{margin:"2px 0 4px 0",fontSize:12.5},children:"Space Data Export"}),Y.jsxs("div",{style:{display:"grid",gap:6},children:[Y.jsxs("select",{style:{width:"100%"},value:ll,onChange:O=>Hi(O.target.value),children:[Y.jsx("option",{value:"__all__",children:"All buildings"}),dd.map(O=>Y.jsx("option",{value:O.name,children:O.name},O.name))]}),Y.jsx("input",{className:"mf-input",style:{width:"100%"},placeholder:"Filter department (optional)",value:nc,onChange:O=>Lu(O.target.value)}),Y.jsxs("select",{style:{width:"100%"},value:To,onChange:O=>fu(O.target.value),children:[Y.jsx("option",{value:"rooms",children:"Room rows"}),Y.jsx("option",{value:"summary",children:"Building summary"})]}),Y.jsx("button",{className:"btn",style:{width:"100%"},onClick:()=>th(),disabled:wa,children:wa?"Exporting...":To==="summary"?"Export Summary CSV":"Export Space CSV"}),t==="admin"&&Y.jsx("button",{className:"btn",style:{width:"100%"},onClick:bt,disabled:Nr,children:Nr?"Refreshing Airtable...":"Refresh Airtable Data"})]}),Y.jsx("div",{style:{fontSize:11,color:"#555",marginTop:2,minHeight:0},children:Ha||(To==="summary"?"Summary export adds a campus total (when exporting all buildings) plus one row per building.":"")}),t==="admin"&&gi&&Y.jsx("div",{style:{fontSize:11,color:"#555",marginTop:2},children:gi}),t==="admin"&&Y.jsxs("div",{style:{fontSize:11,color:"#555",marginTop:2},children:["Last synced: ",bo?bo.toLocaleString([],{hour:"2-digit",minute:"2-digit",month:"short",day:"numeric"}):"Not yet"]})]}),!c&&Y.jsxs("div",{style:{marginTop:4,padding:6,borderRadius:8,border:"1px solid rgba(0,0,0,0.25)",background:"linear-gradient(180deg, rgba(240,246,255,0.94), rgba(228,238,255,0.94))",boxShadow:"0 2px 6px rgba(0,0,0,0.05)"},children:[Y.jsx("style",{children:"@keyframes aiSparklePulse { 0% { transform: translateY(0); } 50% { transform: translateY(-1px); } 100% { transform: translateY(0); } }"}),Y.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:10},children:[Y.jsxs("div",{children:[Y.jsxs("div",{style:{fontWeight:800,letterSpacing:.2,display:"flex",alignItems:"center",gap:6,flexWrap:"nowrap"},children:[Y.jsx("span",{style:{color:"#c62828",fontFamily:"'Trebuchet MS', 'Gill Sans', 'Helvetica Neue', Arial, sans-serif",fontWeight:700},children:"MAPFLUENCE"}),Y.jsx("span",{children:"AI"}),Y.jsx("span",{title:"AI-generated summaries based on currently loaded space data.",style:{display:"inline-flex",alignItems:"center",marginLeft:"auto",padding:"2px 6px",borderRadius:999,fontSize:10,fontWeight:700,border:"1px solid rgba(0,0,0,0.15)",background:"rgba(255,255,255,0.9)",animation:No?"aiSparklePulse 2.8s ease-in-out infinite":"none"},children:" AI Summary"})]}),Y.jsxs("div",{style:{marginTop:4,fontSize:11,opacity:.8,display:"flex",alignItems:"center",justifyContent:"space-between",gap:6},children:[Y.jsx("span",{children:"Summaries from loaded space data"}),Y.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:4},children:[Y.jsx("span",{style:{fontSize:10,padding:"2px 6px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:No?"rgba(0,255,0,0.10)":sa?"rgba(255,193,7,0.18)":"rgba(255,0,0,0.08)"},title:No?"AI server available":sa?"Checking AI status":"AI server not reachable",children:No?"Online":sa?"Checking":"Unavailable"}),Y.jsx("button",{onClick:()=>ho(!0),title:"What Mapfluence AI is doing",style:{border:"1px solid rgba(0,0,0,0.15)",borderRadius:999,background:"white",width:18,height:18,display:"inline-flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:10},"aria-label":"What Mapfluence AI is doing",children:"?"})]})]})]}),Y.jsxs("div",{style:{display:"none",alignItems:"center",gap:6,marginTop:10},children:[Y.jsx("span",{style:{fontSize:10,padding:"2px 6px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:No?"rgba(0,255,0,0.10)":sa?"rgba(255,193,7,0.18)":"rgba(255,0,0,0.08)"},title:No?"AI server available":sa?"Checking AI status":"AI server not reachable",children:No?"Online":sa?"Checking":"Unavailable"}),Y.jsx("button",{onClick:()=>ho(!0),title:"What Mapfluence AI is doing",style:{border:"1px solid rgba(0,0,0,0.15)",borderRadius:999,background:"white",width:20,height:20,display:"inline-flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:11,marginTop:2},"aria-label":"What Mapfluence AI is doing",children:"i"})]})]}),Y.jsxs("div",{style:{display:"grid",gap:6,marginTop:6},children:[Y.jsx("button",{style:{padding:"5px 7px",fontSize:11},disabled:Oi||!Hn||ra,onClick:Ms,children:ra?"Explaining...":" Explain this floor"}),Y.jsx("button",{style:{padding:"5px 7px",fontSize:11},disabled:Oi||!qt||cl,onClick:Ns,children:cl?"Explaining...":" Explain this building"}),Y.jsx("button",{style:{padding:"5px 7px",fontSize:11},disabled:Oi||!Rr||Mi,onClick:nl,children:Mi?"Explaining...":" Explain campus"})]}),Y.jsx("div",{style:{marginTop:6,display:"grid",gap:4},children:Y.jsx("button",{style:{padding:"5px 7px",fontSize:11},onClick:()=>Ko(!0),children:" Ask Mapfluence"})}),t==="admin"&&Y.jsx("div",{style:{marginTop:6},children:Y.jsx("button",{disabled:Oi,onClick:()=>Jo(!0),style:{width:"100%",padding:"5px 7px",fontSize:11},children:" Create move scenario"})}),Y.jsx("div",{style:{marginTop:10,fontSize:11,opacity:.75,lineHeight:1.35},children:"Results are descriptive and do not modify project data."}),Yo||er||qi?Y.jsx("div",{style:{marginTop:8,color:"crimson",fontSize:12},children:Yo||er||qi}):null]})]})}),t==="admin"&&gt&&!xe&&Y.jsxs("div",{style:{position:"absolute",left:20,bottom:20,width:270,borderRadius:8,border:"1px solid rgba(0,0,0,0.25)",background:"linear-gradient(180deg, rgba(245,245,245,0.96), rgba(230,230,230,0.96))",padding:8,boxShadow:"0 2px 6px rgba(0,0,0,0.05)"},children:[Y.jsx("h4",{style:{margin:"0 0 6px 0",fontSize:12.5},children:"Data Filters"}),Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:8},children:[Y.jsx("button",{className:"btn",onClick:dc,children:"Export Map Data"}),Y.jsx("button",{className:"btn",onClick:nh,children:"Clear Conditions"})]})]}),c&&hn&&!xe&&Y.jsxs("div",{className:"help-panel",style:{right:20,bottom:20},children:[Y.jsx("button",{className:"close-button","aria-label":"Close help",onClick:()=>yn(!1),children:""}),Y.jsx("h4",{children:"How to Use This Map"}),Y.jsxs("ul",{children:[Y.jsx("li",{children:"Click anywhere on the map to add a marker."}),Y.jsx("li",{children:"Select a marker type and add an optional comment."}),Y.jsx("li",{children:"Markers are saved to the engagement demo dataset."})]}),Y.jsx("button",{className:"close-button-main",onClick:()=>yn(!1),children:"Close"})]}),!c&&Ul&&Uo&&Y.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e4,background:"rgba(0,0,0,0.35)"},children:Y.jsxs("div",{ref:M,className:"mf-room-edit-panel",style:{position:"absolute",left:bc?bc.x:"50%",top:bc?bc.y:"50%",transform:bc?"none":"translate(-50%, -50%)",width:520,maxWidth:"90vw",background:"#fff",borderRadius:14,padding:16,boxShadow:"0 18px 36px rgba(0,0,0,0.2)"},children:[Y.jsx("div",{style:{display:"flex",alignItems:"center",marginBottom:12},...vm,children:Y.jsx("h4",{style:{margin:0},children:lo.length>1?`Edit ${lo.length} Rooms`:`Edit Room ${Uo.feature?.properties?.name||Uo.roomLabel||""}`})}),lo.length>1&&Y.jsxs("div",{style:{marginBottom:12},children:[Y.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"Selected Rooms"}),Y.jsx("div",{style:{maxHeight:180,overflow:"auto",border:"1px solid #e5e5e5",borderRadius:6},children:Y.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[Y.jsx("thead",{style:{background:"#f9f9f9",position:"sticky",top:0},children:Y.jsxs("tr",{children:[Y.jsx("th",{style:{padding:"6px 8px",width:40,textAlign:"center"},children:Y.jsx("input",{type:"checkbox",checked:ma.size===lo.length,onChange:O=>{const fe=O.target.checked?new Set(lo.map(Ie=>Ie.roomId||String(Ie.revitId??""))):new Set;bl(fe)}})}),Y.jsx("th",{style:{padding:"6px 8px",textAlign:"left"},children:"Room"}),Y.jsx("th",{style:{padding:"6px 8px",textAlign:"right"},children:"Area (SF)"}),Y.jsx("th",{style:{padding:"6px 8px",textAlign:"left"},children:"Department"}),Y.jsx("th",{style:{padding:"6px 8px",textAlign:"left"},children:"Room Type Description"})]})}),Y.jsx("tbody",{children:lo.map(O=>{const fe=O.roomId||String(O.revitId??""),Ie=ma.has(fe),Fe=Number.isFinite(O.properties?.area)?Math.round(O.properties.area):"";return Y.jsxs("tr",{style:{borderTop:"1px solid #f0f0f0"},children:[Y.jsx("td",{style:{padding:"6px 8px",textAlign:"center"},children:Y.jsx("input",{type:"checkbox",checked:Ie,onChange:Ye=>{bl(qe=>{const Ge=new Set(qe||[]);return Ye.target.checked?Ge.add(fe):Ge.delete(fe),Ge})}})}),Y.jsx("td",{style:{padding:"6px 8px",fontWeight:600},children:O.roomLabel||O.feature?.properties?.name||fe}),Y.jsx("td",{style:{padding:"6px 8px",textAlign:"right",whiteSpace:"nowrap"},children:Fe?Fe.toLocaleString():""}),Y.jsx("td",{style:{padding:"6px 8px"},children:O.properties?.department||O.feature?.properties?.department||""}),Y.jsx("td",{style:{padding:"6px 8px"},children:O.properties?.type||O.feature?.properties?.type||""})]},fe)})})]})})]}),Y.jsx(FA,{label:"Room Type",value:Uo.properties?.type??Uo.feature?.properties?.type??"",onChange:O=>Aa(fe=>fe&&{...fe,properties:{...fe.properties,type:O}}),options:so,placeholder:"Search or choose a type..."}),Y.jsx(FA,{label:"Department",value:Uo.properties?.department??Uo.feature?.properties?.department??"",onChange:O=>Aa(fe=>fe&&{...fe,properties:{...fe.properties,department:O}}),options:ao,placeholder:"Search or choose a department..."}),Xs&&Y.jsxs("div",{className:"mf-form-row",children:[Y.jsx("label",{children:"Occupant"}),Y.jsx("input",{className:"mf-input",type:"text",value:Uo.properties?.occupant??"",onChange:O=>Aa(fe=>fe&&{...fe,properties:{...fe.properties,occupant:O.target.value}}),placeholder:"(optional)"})]}),Y.jsxs("div",{className:"mf-form-row",children:[Y.jsx("label",{children:"Area (SF)"}),Y.jsx("input",{className:"mf-input",value:Uo.properties?.area??"",disabled:!0,readOnly:!0})]}),vu&&Y.jsxs("div",{className:"mf-form-row",children:[Y.jsx("label",{children:"Seat Count"}),Y.jsx("input",{className:"mf-input",type:"number",min:"0",value:zc==="__MIXED__"?"":zc,placeholder:_u&&zc==="__MIXED__"?"varies":"",onChange:O=>{const fe=O.target.value;Aa(Ie=>Ie&&{...Ie,properties:{...Ie.properties,seatCount:fe}})}})]}),Xs&&Y.jsxs("div",{className:"mf-form-row",children:[Y.jsx("label",{children:"Occupancy Status"}),Y.jsxs("select",{className:"mf-input",value:xh==="__MIXED__"?"":xh,onChange:O=>{const fe=O.target.value;Aa(Ie=>Ie&&{...Ie,properties:{...Ie.properties,occupancyStatus:fe||(_u?null:"")}})},children:[_u&&xh==="__MIXED__"?Y.jsx("option",{value:"",children:"-- Mixed --"}):Y.jsx("option",{value:"",children:"--"}),la.map(O=>Y.jsx("option",{value:O,children:O},O))]})]}),Y.jsxs("div",{className:"mf-form-row",children:[Y.jsx("label",{children:"Comments"}),Y.jsx("textarea",{className:"mf-input",rows:3,value:Uo.properties?.comments??"",onChange:O=>Aa(fe=>fe&&{...fe,properties:{...fe.properties,comments:O.target.value}})})]}),Y.jsxs("div",{className:"mf-actions",children:[Y.jsx("button",{className:"btn",onClick:Oc,children:"Cancel"}),Y.jsx("button",{className:"btn",onClick:async()=>{const O=ma,fe=lo.length?lo.filter(ft=>O.has(ft.roomId||String(ft.revitId??""))):[];if(!fe.length)return;let Ie=0;const Fe=fe.length>1,Ye=Uo.properties||{},qe=_.current,Ge=$u(qe,pa),St=Ge&&(Ge._data||Ge.serialize?.().data)||null,Dt=St?Au(St)?.features||[]:[];for(const ft of fe){const Xt={type:ft.properties?.type??ft.feature?.properties?.type??"",department:ft.properties?.department??ft.feature?.properties?.department??"",occupant:ft.properties?.occupant??ft.feature?.properties?.occupant??"",occupancyStatus:ft.properties?.occupancyStatus??ft.feature?.properties?.occupancyStatus??ft.properties?.["Occupancy Status"]??ft.feature?.properties?.["Occupancy Status"]??ft.properties?.OccupancyStatus??ft.feature?.properties?.OccupancyStatus??"",comments:ft.properties?.comments??ft.feature?.properties?.comments??"",seatCount:e5({...ft.feature?.properties||{},...ft.properties||{}})},bn=Ye.occupancyStatus!=null&&String(Ye.occupancyStatus).trim()!==""?Ye.occupancyStatus:Xt.occupancyStatus,un=Xs?Fe?Ye.occupant!=null&&String(Ye.occupant).trim()!==""?Ye.occupant:Xt.occupant:Ye.occupant??Xt.occupant:void 0,zt=vu?Ye.seatCount!=null?Ye.seatCount:Xt.seatCount:void 0,on={...ft.properties,...Ye,type:Ye.type!=null&&String(Ye.type).trim()!==""?Ye.type:Xt.type,department:Ye.department!=null&&String(Ye.department).trim()!==""?Ye.department:Xt.department,...Xs?{occupancyStatus:bn,occupant:un}:{},...vu?{seatCount:zt}:{}};if(Xs&&(on.OccupancyStatus=bn,on["Occupancy Status"]=bn),await wt({roomId:ft.roomId,buildingId:ft.buildingId,buildingName:ft.buildingName,floorName:ft.floorName,revitId:ft.revitId,roomLabel:ft.roomLabel,roomNumber:ft.roomNumber,properties:on})&&(Ie+=1,Dt.length)){const _r=ft.revitId??ft.feature?.id??ft.feature?.properties?.RevitId??null;if(_r!=null){const jn=Dt.find(cr=>(cr.id??cr.properties?.RevitId)===_r);jn&&jn.properties&&(jn.properties.department=on.department??jn.properties.department,jn.properties.department=jn.properties.department||on.department||"",jn.properties.Department=jn.properties.department,jn.properties.type=on.type??jn.properties.type,jn.properties.Type=jn.properties.type,jn.properties.RoomType=jn.properties.type,Xs&&(jn.properties.Occupant=on.occupant??jn.properties.Occupant,jn.properties.occupant=jn.properties.Occupant,jn.properties.occupancyStatus=on.occupancyStatus??jn.properties.occupancyStatus,jn.properties.OccupancyStatus=on.OccupancyStatus??jn.properties.OccupancyStatus,jn.properties["Occupancy Status"]=on["Occupancy Status"]??jn.properties["Occupancy Status"]),vu&&(jn.properties.SeatCount=on.seatCount??jn.properties.SeatCount,jn.properties["Seat Count"]=on.seatCount??jn.properties["Seat Count"],jn.properties.seatCount=on.seatCount??jn.properties.seatCount))}}}if(Ie>0){try{if(Ge&&Dt.length){const ft=Au(St)||{type:"FeatureCollection",features:[]};ft.features=Dt,Ge.setData(ft)}}catch{}Uo.refreshPopup?.(),Vl(),Oc()}},children:lo.length>1?`Save ${lo.length} Rooms`:"Save"})]})]})}),rc&&_i&&Y.jsx("div",{style:{position:"fixed",inset:0,zIndex:10001,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Y.jsxs("div",{className:"mf-ai-modal-panel",style:{width:"min(760px, 92vw)",padding:16},children:[Y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,alignItems:"center"},children:[Y.jsxs("div",{children:[Y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[Y.jsx("div",{style:{fontWeight:700,fontSize:16},children:_i.title&&_i.title.includes("Summary")?_i.title:`${_i.title||"Level"} - Summary`}),Y.jsx("span",{title:"AI-generated summary based on currently loaded space data.",style:{fontSize:11,padding:"2px 8px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:"#f7f7ff"},children:" AI Summary"})]}),Y.jsx("div",{style:{fontSize:12,color:"#555",marginTop:2},children:"AI-assisted overview"})]}),Y.jsx("button",{className:"btn",onClick:()=>Sa(!1),children:"Close"})]}),Y.jsxs("div",{style:{marginTop:10,lineHeight:1.45},children:[_i.summary?Y.jsx("p",{style:{margin:"6px 0 10px 0"},children:_i.summary}):null,Y.jsxs("div",{children:[Y.jsx("h4",{style:{margin:"8px 0 4px 0"},children:"Insights"}),Y.jsx("ul",{style:{margin:"0 0 10px 18px",padding:0},children:(_i.insights||[]).map((O,fe)=>Y.jsx("li",{children:O},fe))})]}),Array.isArray(_i.watchouts)&&_i.watchouts.length?Y.jsxs("div",{children:[Y.jsx("h4",{style:{margin:"8px 0 4px 0"},children:"Watchouts"}),Y.jsx("ul",{style:{margin:"0 0 10px 18px",padding:0},children:_i.watchouts.map((O,fe)=>Y.jsx("li",{children:O},fe))})]}):null,Array.isArray(_i.data_used)&&_i.data_used.length?Y.jsxs("small",{style:{color:"#555"},children:["Data used: ",_i.data_used.join(", ")]}):null,Y.jsx("div",{style:{marginTop:12,fontSize:11,color:"#666"},children:"AI summaries reflect available data at the time of generation."})]})]})}),Wa&&Mr&&Y.jsx("div",{style:{position:"fixed",inset:0,zIndex:10001,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Y.jsxs("div",{className:"mf-ai-modal-panel",style:{width:"min(760px, 92vw)",padding:16},children:[Y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,alignItems:"center"},children:[Y.jsxs("div",{children:[Y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[Y.jsx("div",{style:{fontWeight:700,fontSize:16},children:Mr.title&&Mr.title.includes("Summary")?Mr.title:`${Mr.title||"Building"} - Summary`}),Y.jsx("span",{title:"AI-generated summary based on currently loaded space data.",style:{fontSize:11,padding:"2px 8px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:"#f7f7ff"},children:" AI Summary"})]}),Y.jsx("div",{style:{fontSize:12,color:"#555",marginTop:2},children:"AI-assisted overview"})]}),Y.jsx("button",{className:"btn",onClick:()=>Ka(!1),children:"Close"})]}),Y.jsxs("div",{style:{marginTop:10,lineHeight:1.45},children:[Mr.summary?Y.jsx("p",{style:{margin:"6px 0 10px 0"},children:Mr.summary}):null,Y.jsxs("div",{children:[Y.jsx("h4",{style:{margin:"8px 0 4px 0"},children:"Insights"}),Y.jsx("ul",{style:{margin:"0 0 10px 18px",padding:0},children:(Mr.insights||[]).map((O,fe)=>Y.jsx("li",{children:O},fe))})]}),Array.isArray(Mr.watchouts)&&Mr.watchouts.length?Y.jsxs("div",{children:[Y.jsx("h4",{style:{margin:"8px 0 4px 0"},children:"Watchouts"}),Y.jsx("ul",{style:{margin:"0 0 10px 18px",padding:0},children:Mr.watchouts.map((O,fe)=>Y.jsx("li",{children:O},fe))})]}):null,Array.isArray(Mr.data_used)&&Mr.data_used.length?Y.jsxs("small",{style:{color:"#555"},children:["Data used: ",Mr.data_used.join(", ")]}):null,Y.jsx("div",{style:{marginTop:12,fontSize:11,color:"#666"},children:"AI summaries reflect available data at the time of generation."})]})]})}),Ea&&zi&&Y.jsx("div",{style:{position:"fixed",inset:0,zIndex:10001,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Y.jsxs("div",{className:"mf-ai-modal-panel",style:{width:"min(760px, 92vw)",padding:16},children:[Y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,alignItems:"center"},children:[Y.jsxs("div",{children:[Y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[Y.jsx("div",{style:{fontWeight:700,fontSize:16},children:zi.title&&zi.title.includes("Summary")?zi.title:`${zi.title||be} - Summary`}),Y.jsx("span",{title:"AI-generated summary based on currently loaded space data.",style:{fontSize:11,padding:"2px 8px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:"#f7f7ff"},children:" AI Summary"})]}),Y.jsx("div",{style:{fontSize:12,color:"#555",marginTop:2},children:"AI-assisted overview"})]}),Y.jsx("button",{className:"btn",onClick:()=>vi(!1),children:"Close"})]}),Y.jsxs("div",{style:{marginTop:10,lineHeight:1.45},children:[zi.summary?Y.jsx("p",{style:{margin:"6px 0 10px 0"},children:zi.summary}):null,Y.jsxs("div",{children:[Y.jsx("h4",{style:{margin:"8px 0 4px 0"},children:"Insights"}),Y.jsx("ul",{style:{margin:"0 0 10px 18px",padding:0},children:(zi.insights||[]).map((O,fe)=>Y.jsx("li",{children:O},fe))})]}),Array.isArray(zi.watchouts)&&zi.watchouts.length?Y.jsxs("div",{children:[Y.jsx("h4",{style:{margin:"8px 0 4px 0"},children:"Watchouts"}),Y.jsx("ul",{style:{margin:"0 0 10px 18px",padding:0},children:zi.watchouts.map((O,fe)=>Y.jsx("li",{children:O},fe))})]}):null,Array.isArray(zi.data_used)&&zi.data_used.length?Y.jsxs("small",{style:{color:"#555"},children:["Data used: ",zi.data_used.join(", ")]}):null,Y.jsx("div",{style:{marginTop:12,fontSize:11,color:"#666"},children:"AI summaries reflect available data at the time of generation."})]})]})}),ic&&ji&&(()=>{const O=(Xt={})=>{let en=0,bn=0,un=0;for(const[zt,on]of Object.entries(Xt||{})){const fr=String(zt||"").toLowerCase(),_r=Number(on||0)||0;fr.includes("office")?en+=_r:fr.includes("class")?bn+=_r:fr.includes("lab")&&(un+=_r)}return{offices:en,classrooms:bn,labs:un}},fe=Kt||{},Ie=to||{},Fe=ji?.scenarioDept||Ui||"Selected Dept",Ye=Kt?.__label||"baseline",qe=An,Ge=`Baseline (${Fe} in ${Ye})`,St=`Scenario (${Fe} to ${qe})`,Dt=O(fe.roomTypes),ft=O(Ie.roomTypes);return Y.jsx("div",{style:{position:"fixed",inset:0,zIndex:10006,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Y.jsxs("div",{ref:bu,className:"mf-ai-modal-panel",style:{position:"fixed",left:ed?ed.x:"50%",top:ed?ed.y:"50%",transform:ed?"none":"translate(-50%, -50%)",width:"min(760px, 92vw)",padding:16,maxHeight:"90vh",overflow:"auto"},children:[Y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,alignItems:"center"},children:[Y.jsx("div",{...xm,style:{fontWeight:700},children:`${Ui||"Scenario"} - ${Kt?.__label||"baseline"} to ${An}${mr?` (${mr})`:""}`}),Y.jsxs("div",{style:{display:"flex",gap:8},children:[Y.jsx("button",{className:"btn",onClick:We,children:"Export Scenario (PDF)"}),Y.jsx("button",{className:"btn",onClick:()=>Jc(!1),children:"Close"})]})]}),Y.jsx("p",{style:{marginTop:10},children:ji.summary}),Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(160px, 1fr))",gap:10,marginBottom:10},children:[Y.jsxs("div",{style:{border:"1px solid #e0e0e0",borderRadius:8,padding:10},children:[Y.jsx("div",{style:{fontWeight:700,marginBottom:4},children:Ge}),Y.jsxs("div",{style:{fontSize:13},children:["SF: ",Math.round(Kt?.totalSF||0).toLocaleString()]}),Y.jsxs("div",{style:{fontSize:13},children:["Rooms: ",Math.round(Kt?.rooms||0).toLocaleString()]}),Dt.offices||Dt.classrooms||Dt.labs?Y.jsxs(Y.Fragment,{children:[Y.jsxs("div",{style:{fontSize:13},children:["Offices: ",Dt.offices]}),Y.jsxs("div",{style:{fontSize:13},children:["Classrooms: ",Dt.classrooms]}),Y.jsxs("div",{style:{fontSize:13},children:["Labs: ",Dt.labs]})]}):null]}),Y.jsxs("div",{style:{border:"1px solid #e0e0e0",borderRadius:8,padding:10},children:[Y.jsx("div",{style:{fontWeight:700,marginBottom:4},children:St}),Y.jsxs("div",{style:{fontSize:13},children:["SF: ",Math.round(to?.totalSF||0).toLocaleString()]}),Y.jsxs("div",{style:{fontSize:13},children:["Rooms: ",Math.round(to?.rooms||0).toLocaleString()]}),ft.offices||ft.classrooms||ft.labs?Y.jsxs(Y.Fragment,{children:[Y.jsxs("div",{style:{fontSize:13},children:["Offices: ",ft.offices]}),Y.jsxs("div",{style:{fontSize:13},children:["Classrooms: ",ft.classrooms]}),Y.jsxs("div",{style:{fontSize:13},children:["Labs: ",ft.labs]})]}):null]})]}),Y.jsx("b",{children:`Scenario - ${ji?.scenarioDept||Ui||"Selected Dept"}`}),Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginTop:8},children:[Y.jsxs("div",{style:{border:"1px solid #e0e0e0",borderRadius:8,padding:10},children:[Y.jsx("div",{style:{fontWeight:700,marginBottom:6},children:"Pluses"}),Y.jsx("ul",{style:{margin:0,paddingLeft:18},children:(ji?.scenarioPros||[]).map((Xt,en)=>Y.jsx("li",{children:Xt},en))})]}),Y.jsxs("div",{style:{border:"1px solid #e0e0e0",borderRadius:8,padding:10},children:[Y.jsx("div",{style:{fontWeight:700,marginBottom:6},children:"Minuses"}),Y.jsx("ul",{style:{margin:0,paddingLeft:18},children:(ji?.scenarioCons||[]).map((Xt,en)=>Y.jsx("li",{children:Xt},en))})]})]}),ji.risks?.length?Y.jsxs(Y.Fragment,{children:[Y.jsx("b",{children:"Risks / watchouts"}),Y.jsx("ul",{children:ji.risks.map((Xt,en)=>Y.jsx("li",{children:Xt},en))})]}):null,ji.notes?.length?Y.jsxs(Y.Fragment,{children:[Y.jsx("b",{children:"Notes"}),Y.jsx("ul",{children:ji.notes.map((Xt,en)=>Y.jsx("li",{children:Xt},en))})]}):null]})})})(),ai&&Y.jsx("div",{style:{position:"fixed",inset:0,zIndex:10002,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Y.jsxs("div",{className:"mf-ai-modal-panel",style:{width:"min(560px, 92vw)",padding:16,lineHeight:1.4},children:[Y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[Y.jsxs("div",{children:[Y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[Y.jsx("div",{style:{fontWeight:700,fontSize:16},children:"Create move scenario (AI)"}),Y.jsx("span",{title:"AI-generated scenario plan based on currently loaded space data.",style:{fontSize:11,padding:"2px 8px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:"#f7f7ff"},children:" AI"})]}),Y.jsx("div",{style:{fontSize:12,color:"#555"},children:"Uses campus-wide room inventory to suggest candidates."})]}),Y.jsx("button",{className:"btn",onClick:()=>Jo(!1),children:"Close"})]}),Y.jsxs("div",{style:{marginTop:10},children:[Y.jsx("label",{style:{fontWeight:600,fontSize:12},children:"Request"}),Y.jsx("textarea",{value:Io,onChange:O=>vh(O.target.value),rows:3,placeholder:"e.g. Find a new home for Physics; move the Art department to the Gray Center.",style:{width:"100%",resize:"vertical",padding:8,borderRadius:8,border:"1px solid #d0d0d0",marginTop:4}})]}),Us?Y.jsx("div",{style:{color:"crimson",marginTop:6,fontSize:12},children:Us}):null,Y.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,marginTop:10},children:[Y.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,fontSize:12,color:"#444"},children:[Y.jsx("input",{type:"checkbox",checked:zl,onChange:O=>Da(O.target.checked)}),"Strict fit (5% target)"]}),Y.jsx("button",{className:"btn",disabled:Pu||!Io.trim()||Oi,onClick:yd,children:Pu?"Planning...":"Create move scenario"})]})]})}),Wo&&Y.jsx("div",{style:{position:"fixed",inset:0,zIndex:10004,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Y.jsxs("div",{ref:rh,className:"mf-ai-modal-panel",style:{position:"fixed",left:Oh?Oh.x:"50%",top:Oh?Oh.y:"50%",transform:Oh?"none":"translate(-50%, -50%)",width:"min(760px, 92vw)",padding:12,lineHeight:1.35,fontSize:12,maxHeight:"90vh",overflow:"auto"},children:[Y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,alignItems:"center"},children:[Y.jsxs("div",{children:[Y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},...bm,children:[Y.jsx("div",{style:{fontWeight:700,fontSize:16},children:Wo.title||"Move scenario plan"}),Y.jsx("span",{title:"AI-generated scenario plan based on currently loaded space data.",style:{fontSize:11,padding:"2px 8px",borderRadius:999,border:"1px solid rgba(0,0,0,0.15)",background:"#f7f7ff"},children:" AI"})]}),Wo.interpretedIntent?Y.jsx("div",{style:{fontSize:12,color:"#555"},children:Wo.interpretedIntent}):null]}),Y.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[Y.jsx("button",{className:"btn",onClick:()=>Cc(Wo),children:"Add to Scenario Comparison"}),Y.jsx("button",{className:"btn",onClick:()=>xo(null),children:"Close"})]})]}),Wo.selectionCriteria?.filter(O=>!/vacan/i.test(O||"")).length?Y.jsxs("div",{style:{marginTop:10},children:[Y.jsx("b",{children:"Selection criteria"}),Y.jsx("ul",{style:{margin:"6px 0 10px 18px",padding:0},children:Wo.selectionCriteria.filter(O=>!/vacan/i.test(O||"")).map((O,fe)=>Y.jsx("li",{children:O},fe))})]}):null,Y.jsxs("div",{style:{marginTop:10},children:[Y.jsx("b",{children:"Recommended candidates"}),Wo.recommendedCandidates?.length?Y.jsxs("div",{style:{marginTop:6,border:"1px solid #e0e0e0",borderRadius:8,overflow:"hidden"},children:[Y.jsx("div",{style:{display:"flex",justifyContent:"flex-end",padding:"6px 8px",background:"#f8f9fb"},children:Y.jsx("button",{className:"btn",onClick:Ou,children:"Select these rooms in Move Scenario"})}),Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 3fr",background:"#f8f9fb",padding:"6px 8px",fontWeight:600,fontSize:12},children:[Y.jsx("div",{children:"Location"}),Y.jsx("div",{children:"Room"}),Y.jsx("div",{style:{textAlign:"right"},children:"SF"}),Y.jsx("div",{style:{textAlign:"right"},children:"Match / Notes"}),Y.jsx("div",{children:"Rationale"})]}),Y.jsx("div",{children:Wo.recommendedCandidates.map((O,fe)=>Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 3fr",padding:"6px 8px",borderTop:"1px solid #f0f0f0",fontSize:12},children:[Y.jsxs("div",{children:[Y.jsx("div",{style:{fontWeight:600},children:O.buildingLabel||"Building"}),Y.jsx("div",{style:{opacity:.75},children:O.floorId||""})]}),Y.jsxs("div",{children:[Y.jsx("div",{style:{fontWeight:600},children:O.roomLabel||"Room"}),Y.jsx("div",{style:{opacity:.75},children:O.type||"Unspecified"})]}),Y.jsx("div",{style:{textAlign:"right"},children:Math.round(Number(O.sf||0)).toLocaleString()}),Y.jsx("div",{style:{textAlign:"right"},children:(()=>{const Ie=String(O.occupant||"").trim(),Fe=String(O.occupantDept||O.department||"").trim();return Ie?` Occupied  requires relocation${Fe?` of ${Fe}`:""}`:""})()}),Y.jsx("div",{children:a5(O.rationale)||""})]},O.id||fe))})]}):Y.jsx("div",{style:{marginTop:6,fontSize:12,color:"#666"},children:"No candidates returned."})]}),Wo.assumptions?.length?Y.jsxs("div",{style:{marginTop:10},children:[Y.jsx("b",{children:"Assumptions"}),Y.jsx("ul",{style:{margin:"6px 0 10px 18px",padding:0},children:Wo.assumptions.map((O,fe)=>Y.jsx("li",{children:O},fe))})]}):null,Wo.nextSteps?.length?Y.jsxs("div",{style:{marginTop:10},children:[Y.jsx("b",{children:"Next steps"}),Y.jsx("ul",{style:{margin:"6px 0 10px 18px",padding:0},children:Wo.nextSteps.map((O,fe)=>Y.jsx("li",{children:O},fe))})]}):null]})}),sr&&Y.jsx("div",{style:{position:"fixed",inset:0,zIndex:10002,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Y.jsxs("div",{style:{width:"min(520px, 92vw)",background:"#fff",borderRadius:12,padding:16,boxShadow:"0 22px 44px rgba(0,0,0,0.25)",lineHeight:1.5,fontSize:13},children:[Y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[Y.jsx("div",{style:{fontWeight:700,fontSize:16},children:"What Mapfluence AI is doing"}),Y.jsx("button",{className:"btn",onClick:()=>ho(!1),children:"Close"})]}),Y.jsxs("div",{style:{marginTop:10},children:[Y.jsx("div",{style:{fontWeight:600,marginBottom:4},children:"What Mapfluence AI is doing"}),Y.jsxs("ul",{style:{paddingLeft:18,margin:"0 0 10px 0"},children:[Y.jsx("li",{children:"Generates summaries and comparisons from the statistics currently loaded in this session."}),Y.jsx("li",{children:"Can reference the Hastings Master Facilities Plan for narrative/context questions when document support is enabled."}),Y.jsx("li",{children:"Uses your selected scope (campus / building / floor) and scenario totals when available."}),Y.jsx("li",{children:"Produces descriptive output and does not modify project data."})]}),Y.jsx("div",{style:{fontWeight:600,marginBottom:4},children:"What Mapfluence AI is not doing"}),Y.jsxs("ul",{style:{paddingLeft:18,margin:0},children:[Y.jsx("li",{children:"Not writing to the database automatically."}),Y.jsx("li",{children:"Not making final planning decisions."}),Y.jsx("li",{children:"Not inventing missing data; it will note what's unavailable."})]})]})]})}),Yt&&Y.jsx("div",{style:{position:"fixed",inset:0,zIndex:10001,display:"grid",placeItems:"center",background:"rgba(0,0,0,0.45)"},children:Y.jsxs("div",{style:{width:480,maxWidth:"90vw",background:"#fff",borderRadius:14,padding:18,boxShadow:"0 22px 44px rgba(0,0,0,0.25)"},children:[Y.jsx("h4",{style:{margin:"0 0 10px 0"},children:"Confirm Move"}),Y.jsx("div",{style:{fontSize:13,color:"#333",marginBottom:10},children:`Move ${Yt.person||Yt.from?.occupantName||"-"} from ${Yt.from?.buildingId||""} ${Yt.from?.roomLabel||"-"} to ${Yt.to?.buildingId||""} ${Yt.to?.roomLabel||"-"}.`}),Y.jsxs("div",{className:"mf-form-row",children:[Y.jsx("label",{children:"Person"}),Y.jsx("input",{className:"mf-input",value:Yt.person||"",onChange:O=>dt(fe=>fe&&{...fe,person:O.target.value})})]}),Y.jsxs("div",{className:"mf-form-row",children:[Y.jsx("label",{children:"Effective Date"}),Y.jsx("input",{className:"mf-input",type:"date",value:Yt.effectiveDate||"",onChange:O=>dt(fe=>fe&&{...fe,effectiveDate:O.target.value})})]}),Y.jsxs("div",{className:"mf-form-row",children:[Y.jsx("label",{children:"Comments"}),Y.jsx("textarea",{className:"mf-input",rows:3,value:Yt.comments||"",onChange:O=>dt(fe=>fe&&{...fe,comments:O.target.value})})]}),Y.jsxs("div",{className:"mf-actions",style:{marginTop:12,display:"flex",gap:8,justifyContent:"flex-end"},children:[Y.jsx("button",{className:"btn",onClick:pf,children:"Cancel"}),Y.jsx("button",{className:"btn",onClick:Pc,children:"Confirm move"})]})]})})]})},Gq=({config:n,universityId:e,persona:t,engagementMode:i=!1})=>Y.jsx(IC,{config:n,universityId:e,persona:t,engagementMode:i}),Hq=({config:n,universityId:e})=>Y.jsx("div",{className:"admin-page",style:{width:"100%",height:"100%"},children:Y.jsx(IC,{config:n,universityId:e,mode:"admin"})}),Wq=[{universityName:"Hastings College",enableDrawingEntry:!0,buildings:"Hastings_College_Buildings.geojson",boundary:"Hastings_College_Boundary.geojson",outdoorSpacesUrl:"geojson/HC_Outdoor_map.geojson",style:"mapbox://styles/mapbox/streets-v12",lng:-98.371164,lat:40.592958,zoom:15.8,pitch:39,bearing:0,logos:{clarkEnersen:"Clark_Enersen_Logo.png",university:"HC_image.png"}}],Kq="rockhurst",Xq="Rockhurst University",Zq=!1,Yq="mapbox://styles/mapbox/light-v10",Jq=39.038,Qq=-94.57,e$=16,t$=45,n$=-17.6,r$={universityId:Kq,universityName:Xq,enableDrawingEntry:Zq,style:Yq,lat:Jq,lng:Qq,zoom:e$,pitch:t$,bearing:n$},i$=`\uFEFF{"type":"FeatureCollection", "features": [\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37413233965788,40.590313487951285],[-98.37471259730057,40.59032045203848],[-98.37471509841112,40.5901317883289],[-98.3741348407684,40.590126090423354],[-98.37413233965788,40.590313487951285]]]},"properties":{"id":"Perkins Library"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.3736191179045,40.59064334156154],[-98.37362033072382,40.59056689953065],[-98.37387380996378,40.59057058348595],[-98.37387866124111,40.5903256000165],[-98.3736639922197,40.59032283703991],[-98.37366520503903,40.59030073322319],[-98.37333455263524,40.590296927283184],[-98.37333901987164,40.59001629518303],[-98.37333621176148,40.59001558437107],[-98.37294307634048,40.59001416274713],[-98.37294319965034,40.59029870430257],[-98.37297039172454,40.59029870430257],[-98.37297048222555,40.590645772706125],[-98.3736191179045,40.59064334156154]]]},"properties":{"id":"Kiewit Building"}},\r
{\r
  "type": "Feature",\r
  "geometry": {\r
    "type": "Polygon",\r
    "coordinates": [\r
      [\r
        [-98.374702, 40.590876],\r
        [-98.374710, 40.590479],\r
        [-98.374496, 40.590477],\r
        [-98.374487, 40.590874],\r
        [-98.374702, 40.590876]\r
      ]\r
    ]\r
  },\r
  "properties": {\r
    "id": "Hurley-McDonald Hall",\r
    "floorplans": [\r
      {\r
        "name": "Basement",\r
        "url": "/floorplans/hastings/Hurley_McDonald_Floor0.png",\r
        "bounds": [\r
          [-98.374714, 40.590887], \r
          [-98.374499, 40.590891], \r
          [-98.374507, 40.590498], \r
          [-98.374739, 40.590506]  \r
        ]\r
      },\r
      {\r
        "name": "First Floor",\r
        "url": "/floorplans/hastings/Hurley_McDonald_Floor1.png",\r
        "bounds": [\r
          [-98.374714, 40.590887],\r
          [-98.374499, 40.590891],\r
          [-98.374507, 40.590498],\r
          [-98.374739, 40.590506]\r
        ]\r
      },\r
      {\r
        "name": "Second Floor",\r
        "url": "/floorplans/hastings/HurleyMcDonald_Floor2.png",\r
        "bounds": [\r
          [-98.374714, 40.590887],\r
          [-98.374499, 40.590891],\r
          [-98.374507, 40.590498],\r
          [-98.374739, 40.590506]\r
        ]\r
      }\r
    ]\r
  }\r
},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37353314553962,40.59087905110178],[-98.37353314553962,40.590708779882675],[-98.37343235743603,40.590709639839424],[-98.37342896008421,40.59087905110178],[-98.37353314553962,40.59087905110178]]]},"properties":{"id":"Name1"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37382750296666,40.591193020762205],[-98.37382980649612,40.59115891068626],[-98.37386551120254,40.59115891068626],[-98.37387127002614,40.590980488467004],[-98.37383211002555,40.59097961384712],[-98.37382980649612,40.59094812752329],[-98.37358217708065,40.59094462904195],[-98.37357987355122,40.5911921461451],[-98.37382750296666,40.591193020762205]]]},"properties":{"id":"Daugherty Student Engagement Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37229446140842,40.59159148756918],[-98.37223367991126,40.591483310642786],[-98.37238183481058,40.59144580926746],[-98.37226027181626,40.59117752958438],[-98.37226217123805,40.59064529412409],[-98.37211591576053,40.59063952461079],[-98.3721178151823,40.59070587398362],[-98.372022844093,40.59070731636056],[-98.372022844093,40.590756357157964],[-98.37191647647298,40.590759241909645],[-98.3719107782076,40.59114002803756],[-98.37187278977188,40.591154451711894],[-98.37211211691694,40.59164773950174],[-98.37229446140842,40.59159148756918]]]},"properties":{"id":"Morrison-Reeves Science Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37336463965526,40.591802138119164],[-98.37337046026076,40.59172257877987],[-98.37363587987099,40.59172611475252],[-98.3736393722343,40.59156345981731],[-98.37337046026076,40.59155903984072],[-98.37337395262405,40.59147948021219],[-98.37323658633453,40.591475060230046],[-98.37323891457672,40.59155903984072],[-98.373206319186,40.59155815584537],[-98.37320748330708,40.591719042807036],[-98.37323891457672,40.591719042807036],[-98.37323658633453,40.59179860215054],[-98.37336463965526,40.591802138119164]]]},"properties":{"id":"Calvin H. French Memorial Chapel"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37201576628836,40.59262743658687],[-98.37201700980901,40.592578334337375],[-98.37203317557764,40.592578334337375],[-98.37204312374293,40.59206842423039],[-98.37202695797433,40.59206747994882],[-98.37202944501566,40.59201271159418],[-98.3719846782718,40.59201271159418],[-98.37198343475114,40.592025931545955],[-98.37195607729657,40.592026875828125],[-98.37195483377592,40.5920627585407],[-98.37188768366015,40.592063702822344],[-98.3718789790155,40.592578334337375],[-98.37194364208995,40.59257927861174],[-98.37194239856929,40.59260666256263],[-98.3719809477098,40.59260666256263],[-98.37197970418916,40.59262743658687],[-98.37201576628836,40.59262743658687]]]},"properties":{"id":"Altman Hall Residency"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37345908377378,40.592428311631785],[-98.37346414649254,40.592127677901516],[-98.37348540991137,40.592127677901516],[-98.37354717508036,40.59209077136578],[-98.37348844754263,40.59203771818496],[-98.3731381074038,40.59203694929797],[-98.3731340572288,40.592211486417455],[-98.37322214853538,40.59221379307237],[-98.3732170858166,40.592428311631785],[-98.37345908377378,40.592428311631785]]]},"properties":{"id":"Scott Studio Theatre"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37378031069133,40.59233336628362],[-98.37378112606382,40.592306742401384],[-98.37381863319813,40.59230736156156],[-98.37382271006055,40.592159382117295],[-98.37378520292624,40.59215876295575],[-98.37378520292624,40.59213151984219],[-98.37363680513397,40.59212966235677],[-98.37363680513397,40.59215133301679],[-98.37359522113724,40.59215133301679],[-98.37359032890232,40.59231107652247],[-98.37363272827155,40.59231107652247],[-98.37363354364403,40.59233336628362],[-98.37378031069133,40.59233336628362]]]},"properties":{"id":"McCormick Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37472106546831,40.59285396151976],[-98.3747264832459,40.59266057179469],[-98.3747658645213,40.59266160297934],[-98.37476450654628,40.59255229731774],[-98.37474549489609,40.59255126613141],[-98.37474549489609,40.59250692510384],[-98.37467895412038,40.59250692510384],[-98.37467895412038,40.592480114235705],[-98.37464228879502,40.592479083048254],[-98.37464093082,40.59250795629086],[-98.37457846396934,40.59250795629086],[-98.37457826932462,40.59254912199468],[-98.37452034258709,40.59254809904091],[-98.37451764832021,40.59265857795722],[-98.37457018652402,40.59265755500513],[-98.37456479799032,40.59285498446884],[-98.37472106546831,40.59285396151976]]]},"properties":{"id":"Taylor Hall Residence"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.3737386139963,40.592822505804655],[-98.3737406459065,40.592765417120646],[-98.37377315646964,40.59276618858968],[-98.37377417242475,40.59266744048179],[-98.37374369377179,40.59266666901163],[-98.37374470972688,40.59260417989853],[-98.37339826903835,40.59259955107303],[-98.37339217330776,40.592818648462675],[-98.3737386139963,40.592822505804655]]]},"properties":{"id":"Wilson Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.3710880581408,40.59285384881594],[-98.37108495134117,40.59269460559814],[-98.37111757273735,40.59269460559814],[-98.37111912613716,40.592625010294974],[-98.37109116494044,40.59262265113089],[-98.37109116494044,40.592462227777595],[-98.37088766956425,40.59245986860776],[-98.37088922296408,40.59250115406781],[-98.3708488345688,40.59249997448359],[-98.37084572776917,40.59285384881594],[-98.3710880581408,40.59285384881594]]]},"properties":{"id":"Batchelder General Services"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37139804641792,40.59329458891759],[-98.37139804641792,40.59319899088562],[-98.37129990788338,40.59319823814465],[-98.3712969339884,40.59329308343783],[-98.37139804641792,40.59329458891759]]]},"properties":{"id":"Campus Safety"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37252975651616,40.593156827790594],[-98.37252881637454,40.59312398858383],[-98.37250813325893,40.59312327468785],[-98.37251095368379,40.59305259894826],[-98.37230600281096,40.59304902946449],[-98.37230882323581,40.59292195571781],[-98.37217062241788,40.59292195571781],[-98.37217062241788,40.593047601670925],[-98.37191960460574,40.593045459980516],[-98.37191866446413,40.59312184689587],[-98.37189234049882,40.59312184689587],[-98.37189328064044,40.593152544416704],[-98.3719572102705,40.593152544416704],[-98.3719572102705,40.59316468064199],[-98.37217062241788,40.59316468064199],[-98.37217156255952,40.59315325831238],[-98.37224959431384,40.593155399999326],[-98.37224865417222,40.59316682232858],[-98.37246206631963,40.59316967791059],[-98.37246394660288,40.59315468610369],[-98.37252975651616,40.593156827790594]]]},"properties":{"id":"Bronc Hall Residence"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37189410131195,40.59411717917972],[-98.3718924278385,40.594065714506016],[-98.37190665236291,40.594065714506016],[-98.37190748909967,40.593829357718064],[-98.37189410131195,40.59382999308689],[-98.37189661152215,40.59378170503864],[-98.37176022343498,40.59378043430005],[-98.37175938669823,40.59382745161154],[-98.37174683564726,40.59382745161154],[-98.3717451621738,40.5940663498726],[-98.37175603975129,40.5940663498726],[-98.37175603975129,40.5941152730814],[-98.37189410131195,40.59411717917972]]]},"properties":{"id":"The 1882 Residence Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37297358496218,40.594287236848594],[-98.37302656725574,40.594179361354826],[-98.37318062346203,40.59422593696438],[-98.37321057883548,40.59415661511511],[-98.37328903338498,40.594179361354826],[-98.3734202664496,40.59391832071013],[-98.37334181190009,40.59389665754029],[-98.37335892925634,40.5938717448863],[-98.37293670113542,40.593748264638194],[-98.37292243667187,40.59377317733819],[-98.37255726640511,40.593660528533846],[-98.37249307631916,40.59376559521309],[-98.37264713252546,40.593813254270884],[-98.37260576558117,40.59390857228456],[-98.37245313582125,40.59386199645395],[-98.37236130461655,40.5940333213648],[-98.37244344372661,40.594057941663856],[-98.37243407698598,40.59407927924903],[-98.3725123372465,40.594103359502135],[-98.37250152675315,40.59412524968894],[-98.37257936230517,40.59414878163177],[-98.37257071391052,40.594169030041066],[-98.37297358496218,40.594287236848594]]]},"properties":{"id":"Hazelrigg Student Union"}},
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37003093644454,40.59489319890186],[-98.37002539427893,40.594554427576305],[-98.36991824574359,40.594554427576305],[-98.36991824574359,40.594491302294855],[-98.36939635848097,40.59449551064881],[-98.36939635848097,40.59456985819158],[-98.36930768383104,40.59456915680006],[-98.36931045491386,40.5949002127828],[-98.37003093644454,40.59489319890186]]]},"properties":{"id":"Physical Fitness Facility"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.3707569741431,40.595997812186724],[-98.3707609796432,40.59595345634213],[-98.37093925863765,40.59595608489197],[-98.37093579690959,40.59587065696967],[-98.37126985366618,40.59587459979926],[-98.37126985366618,40.595589401192704],[-98.37099983887846,40.59558677262847],[-98.37099983887846,40.595392258587665],[-98.36994747355205,40.59538963001566],[-98.3699455880793,40.59587362637473],[-98.3702990362079,40.59587224653109],[-98.37030085342192,40.59595296733678],[-98.37043169283199,40.59595227741577],[-98.37042896701095,40.595997812186724],[-98.3707569741431,40.595997812186724]]]},"properties":{"id":"Lynn Farrell Arena/Fleharty Educational Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37211946976164,40.595036751142146],[-98.37209853033835,40.595007397045535],[-98.37215327445425,40.59498984579718],[-98.37194527282195,40.59469129454744],[-98.37194712982472,40.594305952303756],[-98.37169736008775,40.5943052575816],[-98.37169708368509,40.594470035453604],[-98.37176513394347,40.59446865751005],[-98.37176604128025,40.5945802708457],[-98.37153514181085,40.59467504115343],[-98.37155328864164,40.59470053315958],[-98.37153877117701,40.59470397802453],[-98.37157052813086,40.594785965758],[-98.37158504559547,40.59478114295293],[-98.37158595293702,40.59481421360927],[-98.37186178476472,40.594816280524746],[-98.37186178476472,40.59482661510118],[-98.3718844683032,40.59482799304458],[-98.3718826536201,40.59485210704955],[-98.37185180400779,40.59486313059177],[-98.37190170779242,40.59493685048371],[-98.3718871903278,40.594941673277546],[-98.37198881258011,40.59508980177594],[-98.37211946976164,40.595036751142146]]]},"properties":{"id":"Hayes M. Fuhr Hall of Music"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37538555821986,40.59328018799004],[-98.37538724870973,40.59309726484104],[-98.37520974727416,40.59309405565852],[-98.37521059251908,40.5931608066232],[-98.37519875909004,40.5931608066232],[-98.37519537811033,40.59327890432057],[-98.37538555821986,40.59328018799004]]]},"properties":{"id":"The Stone Health Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37471015347589,40.59324279822121],[-98.37471437942709,40.592969393604285],[-98.37457407784693,40.5929681100119],[-98.37457069708597,40.59313433502105],[-98.37436278028643,40.59313369322644],[-98.3743602447157,40.59324023104691],[-98.37471015347589,40.59324279822121]]]},"properties":{"id":"Babcock Hall Residence"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37464990421633,40.59375608706591],[-98.37465352180178,40.593639797917334],[-98.37456187630376,40.59363888225395],[-98.3745570528565,40.59375608706591],[-98.37464990421633,40.59375608706591]]]},"properties":{"id":"MacKay House"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.3742242349953,40.593824761664976],[-98.3742242349953,40.593780809929704],[-98.37426523429703,40.593780809929704],[-98.37427005774431,40.593658111182506],[-98.37412414846457,40.59365627985621],[-98.37412173674093,40.593824761664976],[-98.3742242349953,40.593824761664976]]]},"properties":{"id":"905 N Elm Ave"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37328303907076,40.59576922084294],[-98.37317465862661,40.595267009011295],[-98.37290194299486,40.59530583646519],[-98.37292020520233,40.595377020072085],[-98.3728508088139,40.595386264690795],[-98.37291395234293,40.595698179498136],[-98.37300321983061,40.59568449262486],[-98.37301866997268,40.59575031994207],[-98.37316630466383,40.59573076728035],[-98.37316973802872,40.59576335504669],[-98.37323926366815,40.59575227520792],[-98.37324527205675,40.59577573839374],[-98.37328303907076,40.59576922084294]]]},"properties":{"id":"Gray Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37355669887391,40.59683971651677],[-98.37346882100307,40.59659623606328],[-98.37349312764819,40.59659197692209],[-98.3734622769063,40.596499695463045],[-98.37332952522907,40.596526670056555],[-98.37330428371297,40.59644929553547],[-98.37297801374571,40.59651176304569],[-98.37254797310115,40.59649259688399],[-98.37254516848826,40.596542996778915],[-98.37256106129469,40.59659481634959],[-98.37255171258502,40.596682128686005],[-98.37264706942358,40.59668425825375],[-98.37264426481069,40.596737497425636],[-98.3727667329073,40.59674175655755],[-98.37276766777826,40.59669277652411],[-98.37282376003624,40.596682128686005],[-98.37300979935856,40.59668851738907],[-98.37300512500373,40.596779378877706],[-98.37291163790708,40.59679499568363],[-98.3729247261006,40.59683758695397],[-98.37296586042312,40.5968361672454],[-98.37296586042312,40.596802094230576],[-98.37299110193923,40.596887986588825],[-98.37307617519718,40.59686882053498],[-98.37309393774554,40.596929158093324],[-98.37355669887391,40.59683971651677]]]},"properties":{"id":"Jackson Dinsdale Art Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.36946922209306,40.59663009808219],[-98.36946309192157,40.59646951080968],[-98.36938339969201,40.596471838164206],[-98.36938646477778,40.59621582868018],[-98.36946922209306,40.59621582868018],[-98.36946309192157,40.59595516347105],[-98.36938952986353,40.59595516347105],[-98.36938646477778,40.59568984248238],[-98.36946615700731,40.59568984248238],[-98.36946309192157,40.59554321727376],[-98.36923321049021,40.595536235112945],[-98.36923321049021,40.596632425431125],[-98.36946922209306,40.59663009808219]]]},"properties":{"id":"Lloyd Wilson Field/Stadium"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.36635224661157,40.5952162806942],[-98.36635339463838,40.594929482162954],[-98.36611345703568,40.594929482162954],[-98.36611116098207,40.595215408968],[-98.36635224661157,40.5952162806942]]]},"properties":{"id":"Bronco Village Apartments 3"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.36594778233456,40.59521075896037],[-98.36594433215241,40.595025407005174],[-98.36560448920957,40.59502671691478],[-98.36560621430067,40.595043090782795],[-98.36556481211473,40.595043090782795],[-98.36556912484242,40.59519242027393],[-98.36560362666404,40.595191765320756],[-98.36560362666404,40.59521337877231],[-98.36594778233456,40.59521075896037]]]},"properties":{"id":"Bronco Village Apartments 4"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.36581753737377,40.59488116136897],[-98.36582035820989,40.594594140268],[-98.36557917672252,40.594593069291435],[-98.36557776630447,40.59489829691811],[-98.36562431010026,40.59489936788978],[-98.36562431010026,40.594879019425015],[-98.36581753737377,40.59488116136897]]]},"properties":{"id":"Bronco Village Apartments 1"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.36636763296093,40.59478975582371],[-98.3663640756504,40.59460499524451],[-98.36598486634739,40.594606075717216],[-98.36598842365792,40.59476814642561],[-98.36602186237695,40.59476868666066],[-98.36602186237695,40.59479029605858],[-98.36636763296093,40.59478975582371]]]},"properties":{"id":"Bronco Village Apartments 2"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.36542716760385,40.59439543172675],[-98.36542432429836,40.59422414915383],[-98.36538736132702,40.594225588505026],[-98.36538830909551,40.59420543758567],[-98.36508217987125,40.59420543758567],[-98.36508407540826,40.59422630818061],[-98.3650442691314,40.59422630818061],[-98.3650433213629,40.59437815955442],[-98.36508217987125,40.59437815955442],[-98.36508312763975,40.59439615140052],[-98.36542716760385,40.59439543172675]]]},"properties":{"id":"Bronco Village Apartments 5"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.36597687333165,40.594175930871394],[-98.36597687333165,40.59398737546289],[-98.3655949226277,40.59398881481917],[-98.36559302709068,40.594155060260746],[-98.36563188559904,40.5941543405844],[-98.36563283336753,40.59417521119527],[-98.36597687333165,40.594175930871394]]]},"properties":{"id":"Bronco Village Apartments 6"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.3646686039858,40.595412581009995],[-98.36494650785933,40.595223709584495],[-98.36492058096735,40.59520402262996],[-98.36498701862807,40.595156035653986],[-98.36490680730597,40.595086515999505],[-98.36483631856838,40.59513450302537],[-98.36481120189175,40.59511481604457],[-98.36470911475455,40.595181874799174],[-98.36465645075519,40.59513327258924],[-98.36458110072535,40.595182490016796],[-98.36463295450933,40.59522801610503],[-98.3645316775875,40.59529938126202],[-98.3646686039858,40.595412581009995]]]},"properties":{"id":"Barrett Alumni Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37338949046577,40.58959597891962],[-98.3733933780237,40.58945132240717],[-98.37327675128608,40.589449551101],[-98.37327286372816,40.58959361718315],[-98.37338949046577,40.58959597891962]]]},"properties":{"id":"706 E. 7th St. Residence"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37321144031304,40.58958535110486],[-98.37321299533619,40.589450141536396],[-98.37309792362176,40.5894489606656],[-98.37309559108701,40.58958535110486],[-98.37321144031304,40.58958535110486]]]},"properties":{"id":"710 E. 7th St. Residence"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37301550739384,40.58959538848551],[-98.3730225049981,40.58935803355154],[-98.37315079440947,40.58935921442396],[-98.37315312694422,40.58927655330535],[-98.37305827053098,40.58927537243149],[-98.37305749301939,40.58930607514516],[-98.37299218204632,40.58930489427181],[-98.37299140453474,40.5893633474772],[-98.37294008877019,40.5893633474772],[-98.37294164379337,40.58939582145811],[-98.37290976581842,40.58939523102224],[-98.3729058782605,40.58959538848551],[-98.37301550739384,40.58959538848551]]]},"properties":{"id":"714 E. 7th St. Residence"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37481677520717,40.59378243356543],[-98.3748159702016,40.59364459103049],[-98.37470492415694,40.59364364015712],[-98.37470219608254,40.59378243356543],[-98.37481677520717,40.59378243356543]]]},"properties":{"id":"607 E 9th St"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37505232877834,40.59378603329276],[-98.37505232877834,40.59363389370436],[-98.3749411932886,40.59363270511246],[-98.37493806271144,40.59378603329276],[-98.37505232877834,40.59378603329276]]]},"properties":{"id":"603 E 9th St"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.37020808429642,40.59325096070355],[-98.3702087922692,40.59304678270344],[-98.37012640522326,40.59305025829369],[-98.37007453189801,40.59300275854457],[-98.3700699548399,40.59284403962595],[-98.36997383661961,40.59284403962595],[-98.36996925956151,40.59300275854457],[-98.37007148052594,40.59305373388376],[-98.37007497105584,40.59325096070355],[-98.37020808429642,40.59325096070355]]]},"properties":{"id":"906 E 9th St"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-98.3713716620568,40.59216760861196],[-98.3713716620568,40.59208501885758],[-98.37123658640381,40.592083686763935],[-98.37123658640381,40.592170272795876],[-98.3713716620568,40.59216760861196]]]},"properties":{"id":"812 N Ash Ave"}}\r
]}
`,o$=`{"type":"GeometryCollection", "geometries": [\r
{"type":"Polygon","coordinates":[[[-98.3702723467576,40.59295246060802],[-98.3712898200761,40.59296962250515],[-98.37127145248702,40.593452202532475],[-98.3693821617939,40.59343919245249],[-98.3693821617939,40.59396210621867],[-98.36898697694681,40.59395690670241],[-98.36897317608825,40.595313897438444],[-98.36666104991127,40.59530626415921],[-98.3666645004967,40.59434137689304],[-98.3660775631237,40.594328458560554],[-98.3660903226318,40.59391184099969],[-98.36552890427502,40.593908611396046],[-98.3655251986316,40.59414249211982],[-98.36432525734347,40.59413791286647],[-98.36427367897022,40.59707709495426],[-98.37377329389933,40.59709097965043],[-98.37386191086847,40.59401359006412],[-98.37508078915154,40.594020829208134],[-98.37509913072566,40.59343618356128],[-98.37541607762186,40.59342916474601],[-98.37541607762186,40.59304686495786],[-98.37491595389913,40.593044333163895],[-98.37497941341485,40.58982081072618],[-98.37347119813148,40.58981164082747],[-98.373477248548,40.58922812309826],[-98.37287220689669,40.589232717745936],[-98.37286010606364,40.58981164082747],[-98.37161977067842,40.58981164082747],[-98.37159980641273,40.59071814140597],[-98.37034264550859,40.590714592488666],[-98.37035943903622,40.59162321748957],[-98.37107540475405,40.59163250297191],[-98.37106656585733,40.592037456704084],[-98.37065419418758,40.59203614756078],[-98.37065535506281,40.59209797250316],[-98.37051258408789,40.59209551837214],[-98.37051409247337,40.59219975052995],[-98.37028934303831,40.59219975052995],[-98.3702875945045,40.59227459272085],[-98.37028731105269,40.59253351783216],[-98.37009609918391,40.59252977623261],[-98.36990069493494,40.59252314685871],[-98.36990818515268,40.5933535522459],[-98.37026022538576,40.59335639608224],[-98.3702723467576,40.59295246060802]]]}\r
]}`,s$='{"type":"FeatureCollection","features":[{"type":"Feature","properties":{"id":"Kiewit_MR_SEcorner"},"geometry":{"coordinates":[[[-98.37163503619607,40.59063976074893],[-98.37216212045448,40.590601318073],[-98.37257008962634,40.59062619274795],[-98.37289765611462,40.59063523808223],[-98.37286192158837,40.59039101362893],[-98.37285894371118,40.590234980871685],[-98.37290658974618,40.58994326648016],[-98.37282320918538,40.5896877326733],[-98.3716618370903,40.58968320994222],[-98.37163503619607,40.59063976074893]]],"type":"Polygon"},"id":0},{"type":"Feature","properties":{"id":"Daughtery_MR_Chapel"},"geometry":{"coordinates":[[[-98.37352702156389,40.5914658384647],[-98.37355230279564,40.59090910098766],[-98.37337280605138,40.590895662440005],[-98.37336774980503,40.59069984328954],[-98.37309471250403,40.590674885905486],[-98.3723160505715,40.590648008712265],[-98.37231099432515,40.591164432888604],[-98.3724626817145,40.5914312824801],[-98.37242728799043,40.591569506310634],[-98.37239189426599,40.5917653229138],[-98.37310482499674,40.5917787612872],[-98.37321100616931,40.591446640697654],[-98.37352702156389,40.5914658384647]]],"type":"Polygon"},"id":1},{"type":"Feature","properties":{"id":"801 Block"},"geometry":{"coordinates":[[[-98.37164381749396,40.591608632859675],[-98.37164919913825,40.59068913232153],[-98.37024189916244,40.59066052543514],[-98.37033069629301,40.591596372935584],[-98.37164381749396,40.591608632859675]]],"type":"Polygon"},"id":2},{"type":"Feature","properties":{"id":"South of Arboretum"},"geometry":{"coordinates":[[[-98.37476627281052,40.5910136742458],[-98.37477964615867,40.59092227590415],[-98.37446537247885,40.590915505651594],[-98.37446537247885,40.59037726838508],[-98.37394604079577,40.590356957462575],[-98.37393266744795,40.59120662589234],[-98.37434278345529,40.591032292413445],[-98.37476627281052,40.5910136742458]]],"type":"Polygon"},"id":3},{"type":"Feature","properties":{"id":"Arboretum"},"geometry":{"coordinates":[[[-98.37489112509611,40.59219972777811],[-98.37490794950106,40.591069061838084],[-98.37470325257557,40.59106054450788],[-98.37460230614677,40.59105628584243],[-98.37443686616615,40.59106693250561],[-98.37431068312993,40.59109035515871],[-98.37407514146206,40.591215985611285],[-98.3739938235057,40.59130328799105],[-98.37399101943821,40.59197189267704],[-98.37412561467688,40.59209965077304],[-98.37435554820935,40.59219333988858],[-98.37489112509611,40.59219972777811]]],"type":"Polygon"},"id":4},{"type":"Feature","properties":{"id":"North of Arboretum"},"geometry":{"coordinates":[[[-98.37431231320465,40.59336193656449],[-98.37433594448096,40.593078415557756],[-98.37448482150404,40.59306047115021],[-98.37451081590508,40.59293306571445],[-98.37449191088317,40.59276797661897],[-98.37448245837369,40.59257776476619],[-98.37449900026525,40.592471891896395],[-98.37483456434931,40.5924557417828],[-98.37483929060404,40.59226194011691],[-98.37479202805706,40.592233228710995],[-98.37449191088317,40.59222963978439],[-98.37424378251136,40.59221348961228],[-98.3740381904318,40.59213453315965],[-98.37391767093679,40.59193355267803],[-98.37388222402663,40.59336014213147],[-98.37431231320465,40.59336193656449]]],"type":"Polygon"},"id":5},{"type":"Feature","properties":{"id":"PickleBall Cts"},"geometry":{"coordinates":[[[-98.37301888192918,40.592758212922234],[-98.37305404173038,40.59270862956615],[-98.3730665988024,40.59181802995374],[-98.3720670558787,40.591791330852686],[-98.3720544988067,40.59201445872537],[-98.3720821243651,40.59211553349891],[-98.3720896586079,40.59233866028978],[-98.37207961295069,40.5925408087046],[-98.3720544988067,40.592636161518556],[-98.37203691890592,40.592884078198324],[-98.37301888192918,40.592758212922234]]],"type":"Polygon"},"id":6},{"type":"Feature","properties":{"id":"Steinhart Plz"},"geometry":{"coordinates":[[[-98.37375767305471,40.59380937954694],[-98.37381334284255,40.59285824408735],[-98.37336179901064,40.592860592586646],[-98.37332777858475,40.59276195554597],[-98.37319478964805,40.59273847051469],[-98.3726349990074,40.59282771358974],[-98.37261334964592,40.59363559284384],[-98.37317004752059,40.59373422859568],[-98.37375767305471,40.59380937954694]]],"type":"Polygon"},"id":7},{"type":"Feature","properties":{"id":"SE of Union"},"geometry":{"coordinates":[[[-98.37251903104057,40.59362476563635],[-98.37254773304886,40.593196135370334],[-98.37197369288644,40.59318887042687],[-98.37166753813338,40.593159810645574],[-98.37171059114546,40.59367925233752],[-98.37217939061152,40.593824549991155],[-98.37251903104057,40.59362476563635]]],"type":"Polygon"},"id":8},{"type":"Feature","properties":{"id":"Heartwell"},"geometry":{"coordinates":[[[-98.37407601600557,40.595375081069506],[-98.37397063105409,40.594673938335205],[-98.37389033775756,40.594109970364855],[-98.37308740479394,40.59428906881678],[-98.37294689152506,40.59433098540674],[-98.37263575500172,40.5942509628037],[-98.37250527839498,40.59418237192435],[-98.37237982011926,40.594094727921146],[-98.37199842696151,40.594033758112204],[-98.37202351861642,40.594334796004546],[-98.37202853694748,40.59470823353095],[-98.37212890356825,40.594822550724416],[-98.37225436184359,40.59499021558764],[-98.37219916020231,40.5950397528529],[-98.37206366526487,40.595108342852654],[-98.37216403188529,40.59528362808683],[-98.3728164149183,40.595218848814255],[-98.37322289973137,40.595119774511886],[-98.37330821135897,40.5956418182227],[-98.37353905458613,40.595710407604884],[-98.37407601600557,40.595375081069506]]],"type":"Polygon"},"id":9},{"type":"Feature","properties":{"id":"Heartwell North"},"geometry":{"coordinates":[[[-98.37364723125614,40.59642709268644],[-98.37372717366044,40.595729025036405],[-98.37348068458046,40.595744200497705],[-98.37331413790477,40.59580996078944],[-98.37317423869737,40.5958504286296],[-98.37308763442599,40.59580996078944],[-98.37296772081977,40.595789726860176],[-98.37289444028254,40.595739142010984],[-98.37274121734099,40.59567844014052],[-98.37272123173979,40.59534963738679],[-98.37165533301602,40.59529905220464],[-98.37130891593102,40.59546598316149],[-98.3713555489995,40.59585548710561],[-98.37149803178302,40.59612724032186],[-98.37170454966062,40.59618288333169],[-98.37166457845869,40.59672413564374],[-98.37141142751166,40.59705293163782],[-98.37241070756525,40.596997289352856],[-98.37251063557076,40.596410513342704],[-98.37364723125614,40.59642709268644]]],"type":"Polygon"},"id":10},{"type":"Feature","properties":{"id":"Athletic Parking lot"},"geometry":{"coordinates":[[[-98.37135713636462,40.59703881753842],[-98.37159398256752,40.59675342106121],[-98.37164547087292,40.59621781068529],[-98.37141377350018,40.59613570944552],[-98.37124901092368,40.59594804909017],[-98.37084225331375,40.5960575176949],[-98.37024498897541,40.59604578892433],[-98.36962198048437,40.5960184217856],[-98.36954474802666,40.596280363943634],[-98.3695498968572,40.59707400332135],[-98.37135713636462,40.59703881753842]]],"type":"Polygon"},"id":11},{"type":"Feature","properties":{"id":"Fle+PFF"},"geometry":{"coordinates":[[[-98.36986465261369,40.595478850474535],[-98.37011842595624,40.594928288639665],[-98.36931682444536,40.59493746470747],[-98.36901874147125,40.59488240828182],[-98.36905499480616,40.59548190913873],[-98.36986465261369,40.595478850474535]]],"type":"Polygon"},"id":12},{"type":"Feature","properties":{"id":"Football field"},"geometry":{"coordinates":[[[-98.36913306842247,40.59687166324542],[-98.36912125095233,40.595575039769074],[-98.36904443739681,40.59551222692079],[-98.36897944131144,40.59530135478337],[-98.36831766298764,40.59536416782973],[-98.36827630184256,40.596880636330724],[-98.36913306842247,40.59687166324542]]],"type":"Polygon"},"id":13},{"type":"Feature","properties":{"id":"Practice field"},"geometry":{"coordinates":[[[-98.36817488651938,40.596967941434826],[-98.3682206392564,40.5952830148853],[-98.36668220346046,40.59530907080216],[-98.36580718237055,40.59530907080216],[-98.36588153056778,40.59700268176945],[-98.36817488651938,40.596967941434826]]],"type":"Polygon"},"id":14},{"type":"Feature","properties":{"id":"track"},"geometry":{"coordinates":[[[-98.3658412178937,40.597004912936484],[-98.36577780942038,40.595387736092704],[-98.36551671491901,40.59541889048063],[-98.3653525983754,40.59530276950733],[-98.36468494243638,40.59548119921246],[-98.36468494243638,40.59674435461838],[-98.36463272353635,40.59700491285406],[-98.3658412178937,40.597004912936484]]],"type":"Polygon"},"id":15},{"type":"Feature","properties":{"id":"BVH outdoor"},"geometry":{"coordinates":[[[-98.36606218586846,40.594981336403094],[-98.36621039516318,40.5948299194323],[-98.36602176515188,40.59482378089922],[-98.36595709200517,40.59480741147544],[-98.36594361843285,40.59475011845865],[-98.36585738757081,40.59474807227855],[-98.36586277699975,40.594981336403094],[-98.36606218586846,40.594981336403094]]],"type":"Polygon"},"id":16},{"type":"Feature","properties":{"id":"BVH south outdoor"},"geometry":{"coordinates":[[[-98.36605957398896,40.59455423531671],[-98.36605957398896,40.59420722418943],[-98.36571163584682,40.59422694077912],[-98.36549871847637,40.59418750759389],[-98.36547794604984,40.59433735357291],[-98.36543120809051,40.59455817861465],[-98.36605957398896,40.59455423531671]]],"type":"Polygon"},"id":17}]}',a$=`{"type":"FeatureCollection", "features": [\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.5732546949417,39.033957896346706],[-94.57326522382158,39.033796212560006],[-94.5729226302682,39.033781742786736],[-94.57291453112981,39.03394783044083],[-94.5732546949417,39.033957896346706]]]},"properties":{"id":"Physical Plant Operations"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57330618126248,39.03329184109743],[-94.57333069079144,39.032868879640596],[-94.57332112401924,39.03286702180975],[-94.57332590740536,39.03279828203385],[-94.57289061927166,39.032835438677765],[-94.57286046661933,39.03328233695542],[-94.57330618126248,39.03329184109743]]]},"properties":{"id":"St. Luke's Urgent Care"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57151501542803,39.03292423985276],[-94.57151293405649,39.032993004805604],[-94.57184717798721,39.03300418514015],[-94.57184478733176,39.03304318257621],[-94.57179856799333,39.03305618171678],[-94.57179298979729,39.03312055837771],[-94.571829646514,39.033121177383784],[-94.57181849012196,39.033266024655184],[-94.5720280709153,39.03327654773599],[-94.57204321173309,39.033054943703505],[-94.5720575556657,39.03305556271014],[-94.5720631338617,39.03295156951771],[-94.572026477145,39.032949093487446],[-94.57203205534103,39.03290576294391],[-94.57191730388003,39.03289895385609],[-94.57191252256916,39.0329466174571],[-94.57185434995351,39.03294537944191],[-94.57185275618323,39.03297261577139],[-94.57165911309279,39.032966425697424],[-94.57166230063338,39.032929904250025],[-94.57151501542803,39.03292423985276]]]},"properties":{"id":"St. Peter Claver Jesuit Community"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57320143143617,39.03248280295288],[-94.5732236476623,39.03206766728228],[-94.57287806192237,39.03205807982458],[-94.57285214299189,39.0324693805906],[-94.57320143143617,39.03248280295288]]]},"properties":{"id":"Greenlease Library"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57258061133909,39.03244157711775],[-94.57259171945215,39.03223353009446],[-94.57203878226827,39.03221147899157],[-94.57202520568563,39.03242240230252],[-94.57258061133909,39.03244157711775]]]},"properties":{"id":"Conway Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.5729983573256,39.031851550588144],[-94.57299756184071,39.031777457537544],[-94.57321564931763,39.03178334435931],[-94.57323249004943,39.03143209646873],[-94.57296205948676,39.031423909721845],[-94.57296447934267,39.03135905846342],[-94.57280960856365,39.03135529896836],[-94.5728071887077,39.03138819454341],[-94.57269708526324,39.03138631479668],[-94.57269708526324,39.03142109010315],[-94.57267409663196,39.03142015023023],[-94.572672886704,39.03149158053676],[-94.57274790223761,39.0314934602807],[-94.57273580295798,39.03168519389932],[-94.5727950894281,39.031686133768716],[-94.57279387950013,39.031724668403285],[-94.5728701049617,39.03172748800987],[-94.57286526524985,39.03184873098651],[-94.5729983573256,39.031851550588144]]]},"properties":{"id":"Sedgewick Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57326241323847,39.03143368161774],[-94.57327626990363,39.03124423732891],[-94.5730261570974,39.03123347343362],[-94.57301275849636,39.0314254445335],[-94.57326241323847,39.03143368161774]]]},"properties":{"id":"Greenlease Gallery"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.573095990435,39.03111733680814],[-94.57308496704151,39.031231510274026],[-94.57308922652759,39.0312361877],[-94.57325910712441,39.03124349870881],[-94.57328155089225,39.03098889143854],[-94.57264954299825,39.03095820723238],[-94.57262565897899,39.031273611693024],[-94.57279744019438,39.0312828882735],[-94.57281213805237,39.03110377869681],[-94.573095990435,39.03111733680814]]]},"properties":{"id":"Van Ackeren Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57168446809365,39.032022569107156],[-94.57169184016705,39.03180937961588],[-94.57179868570213,39.031816109120946],[-94.57180734885364,39.0318116227843],[-94.57183045059094,39.03127774669104],[-94.57147526137969,39.031266530763475],[-94.57148969996551,39.030961456851074],[-94.57133665095579,39.03095921365567],[-94.57130690259424,39.031697853704856],[-94.57146028857838,39.031697853704856],[-94.57144848965653,39.032017331773794],[-94.57168446809365,39.032022569107156]]]},"properties":{"id":"Massman Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57102622899816,39.03227668523504],[-94.57041136868395,39.032248511124756],[-94.57038028024108,39.03258659970685],[-94.57099514055531,39.03261611529995],[-94.57102622899816,39.03227668523504]]]},"properties":{"id":"Mason-Halpin Fieldhouse"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57102622899816,39.03227668523504],[-94.5710435003553,39.03201775132257],[-94.57017475109112,39.0319855522205],[-94.57016266114111,39.03223509487781],[-94.57102622899816,39.03227668523504]]]},"properties":{"id":"Convocation Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57003078591215,39.032220762006155],[-94.57011418121974,39.032159390693046],[-94.57010430545964,39.032152571654976],[-94.57011857044647,39.0321355240569],[-94.57007906740601,39.03210654313074],[-94.57011857044647,39.03207244790827],[-94.57010211084628,39.03205880981468],[-94.57012515428654,39.03204005743169],[-94.57007687279265,39.03200340503239],[-94.57005492665907,39.03201960028093],[-94.57003627244553,39.03200425741399],[-94.56983546532327,39.03214575261624],[-94.56986180068357,39.03216620973048],[-94.56983985454998,39.03218837159754],[-94.56987935759042,39.03221479535305],[-94.56989910911065,39.032200304907704],[-94.56992434716427,39.03221905724818],[-94.56996714212474,39.03218496207999],[-94.57000993708525,39.032220762006155],[-94.57001981284535,39.03221309059493],[-94.57003078591215,39.032220762006155]]]},"properties":{"id":"Student Activities Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.5700079120054,39.03251153999033],[-94.57007391952787,39.03239788275361],[-94.56962616850038,39.03226029743301],[-94.56963937000486,39.03224064236535],[-94.56956236122863,39.03221756901809],[-94.569545859348,39.0322355149555],[-94.56911791057726,39.032091092758456],[-94.56905630355628,39.03220047764487],[-94.56942814593293,39.03231926260322],[-94.56943254643443,39.03240899211564],[-94.56956566160477,39.032447447586094],[-94.56962836875111,39.03238335512371],[-94.5700079120054,39.03251153999033]]]},"properties":{"id":"Corcoran Residence Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.56854799775466,39.03168092891154],[-94.56855120851591,39.03148472512313],[-94.5683842489311,39.03148306237683],[-94.56838210842359,39.031552066315285],[-94.56833501725863,39.03155040357058],[-94.5683318064974,39.03160527412545],[-94.56837889766234,39.031604442753725],[-94.5683756869011,39.03167843479901],[-94.56854799775466,39.03168092891154]]]},"properties":{"id":"Town House Village"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.5694451877561,39.031137040617324],[-94.56944931800915,39.031079289457125],[-94.56924142860419,39.03107180319216],[-94.56923729835111,39.031130623824076],[-94.5694451877561,39.031137040617324]]]},"properties":{"id":"The Birdhouse"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57023544284519,39.03101832984793],[-94.57024370335134,39.03090603569337],[-94.56974669623084,39.03088999365672],[-94.56974531947982,39.03083117282454],[-94.56960626762614,39.03082582547373],[-94.56960351412411,39.03088250737171],[-94.56911752101182,39.03087074320795],[-94.56911201400773,39.03097982901504],[-94.57023544284519,39.03101832984793]]]},"properties":{"id":"Xavier-Loyola Residence Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57110683934017,39.030625006944845],[-94.5711103812666,39.03058465303729],[-94.57115524566798,39.03058648730631],[-94.57116351016298,39.030412231536324],[-94.57103836209599,39.030407645852364],[-94.57103836209599,39.03042507144983],[-94.57075146605564,39.030415900083284],[-94.5707502854135,39.03054338197162],[-94.57072076935995,39.03054429910667],[-94.57071722743352,39.03061583560425],[-94.57110683934017,39.030625006944845]]]},"properties":{"id":"Magis Activity Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57198788526269,39.03047484462258],[-94.57200861727132,39.03025032364125],[-94.57210130154519,39.03026832323989],[-94.57212569214357,39.03018021989759],[-94.57206837423735,39.02993485624719],[-94.57194154312575,39.02995664533168],[-94.57194032359583,39.029975592356216],[-94.57188544474947,39.02997275030286],[-94.57188544474947,39.029948119168985],[-94.57170739338125,39.029948119168985],[-94.57155373261142,39.029932961543864],[-94.57155373261142,39.02994906652044],[-94.57146348739738,39.0299414877084],[-94.57145373115803,39.03010916873508],[-94.57150129282489,39.03011201078295],[-94.57148665846586,39.03031758527588],[-94.57179885812519,39.03032705874041],[-94.5717927604756,39.030445476939825],[-94.57185373697156,39.03044831897417],[-94.57185495650148,39.030468213211414],[-94.57198788526269,39.03047484462258]]]},"properties":{"id":"Pedro Arrupe, S.J., Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57284047860178,39.0302797832297],[-94.57286427952926,39.029831426558175],[-94.5727080859427,39.02982911543394],[-94.572694697921,39.03005444969102],[-94.5725905688633,39.03005329413256],[-94.57258164351548,39.030234716579436],[-94.57268279745728,39.030237027690404],[-94.57267982234133,39.03027631656532],[-94.57284047860178,39.0302797832297]]]},"properties":{"id":"McGee Residence Hall"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.5730942108803,39.03066445893382],[-94.57317199672308,39.030664613464],[-94.57325985414333,39.030643791903515],[-94.57335366799886,39.03057901367613],[-94.57337898284875,39.03051307863372],[-94.57340366198356,39.02995448923646],[-94.57335443753462,39.029949304371044],[-94.57335193459656,39.029918843279034],[-94.57318507205777,39.02991495462804],[-94.57317172305467,39.03002707731239],[-94.57310581235186,39.03002837352735],[-94.5730700106048,39.030426554038584],[-94.57268280619707,39.03041812687501],[-94.57267696475127,39.03046998632717],[-94.57261938478547,39.03048035821303],[-94.57261604681642,39.03052508695338],[-94.57264692302996,39.03053999652721],[-94.57264692302996,39.030585373471666],[-94.57268864764288,39.03067936847824],[-94.5730858659577,39.03068714736974],[-94.5730942108803,39.03066445893382]]]},"properties":{"id":"St. Ignatius Science Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57292884511348,39.02885017929442],[-94.57292884511348,39.02878607947923],[-94.57289583924593,39.02878607947923],[-94.57289790211264,39.02876043953688],[-94.57268542684032,39.02875242705299],[-94.57268336397358,39.02881973188946],[-94.57272049557459,39.02881973188946],[-94.57271843270787,39.02884697430505],[-94.57292884511348,39.02885017929442]]]},"properties":{"id":"University Marketing and Communication"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57283326901032,39.028729445595104],[-94.57284341632814,39.02854814224998],[-94.57270405983009,39.028544463626574],[-94.57270270685437,39.028568111916584],[-94.57268511817016,39.028568111916584],[-94.57268308870658,39.028620663643835],[-94.5727020303665,39.028622240195055],[-94.57270000090294,39.02865902638007],[-94.57268241221873,39.02865902638007],[-94.57268173573087,39.02870684839195],[-94.5727006773908,39.028707899424816],[-94.5726993244151,39.028725766981125],[-94.57283326901032,39.028729445595104]]]},"properties":{"id":"Rock Row Housing N"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57284691787102,39.02851897602392],[-94.57285908326953,39.0283383666503],[-94.57271782947576,39.02833311637091],[-94.57271715362029,39.02835674262511],[-94.5726975538116,39.02835726765288],[-94.57269417453423,39.02840924538392],[-94.57271512605388,39.02840924538392],[-94.572712422632,39.02844599729188],[-94.5726975538116,39.02844809740033],[-94.5726948503897,39.0284948247972],[-94.572712422632,39.028496399877454],[-94.57271174677652,39.02851582586437],[-94.57284691787102,39.02851897602392]]]},"properties":{"id":"Rock Row Housing S"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57359514381248,39.02847208180017],[-94.57361271431651,39.028083475715746],[-94.57327990829927,39.02807143210462],[-94.57325923711807,39.028461644061366],[-94.57359514381248,39.02847208180017]]]},"properties":{"id":"Security Department"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57480409573863,39.03238485708068],[-94.57475834188774,39.03234294052741],[-94.57478743748095,39.0323230514835],[-94.57466523598949,39.03222270213117],[-94.57465592539967,39.03222903047291],[-94.57456281950141,39.032149474135494],[-94.57455234508787,39.032154898434065],[-94.57453256008448,39.03213591338722],[-94.5745418706743,39.03212868098708],[-94.57443596271503,39.03204189212767],[-94.57444294565741,39.03200392196817],[-94.57448600713533,39.031963239631786],[-94.57446854977943,39.03195419910939],[-94.57445691154213,39.0319668558404],[-94.57437893535234,39.031978608517164],[-94.57437078858625,39.03197318420506],[-94.57426022533207,39.03199216929562],[-94.57421018091178,39.031950582900116],[-94.57410660059993,39.03202561920467],[-94.5741217303084,39.03203737187166],[-94.57391816391097,39.03218429006349],[-94.5739193483118,39.03221373112918],[-94.57398567475879,39.03222937169034],[-94.57396790874621,39.03229653406067],[-94.57383525585222,39.03238485708068],[-94.5738127522363,39.03243637879136],[-94.57379024862033,39.03244833918312],[-94.57380209262874,39.03245661945314],[-94.573822227443,39.03244281900256],[-94.57387552548074,39.03242901854928],[-94.57400462517222,39.032327815142885],[-94.57410885244606,39.03231401466714],[-94.57411122124773,39.032375656771244],[-94.57415030647543,39.03237933689516],[-94.5743552078206,39.03223397185472],[-94.574367051829,39.03224501224803],[-94.57443811587935,39.03218705016392],[-94.57453642114899,39.032267093029475],[-94.57452220833892,39.03227813341762],[-94.57461577600522,39.03235817618002],[-94.57462880441446,39.032348055835755],[-94.57464538602619,39.03236553642948],[-94.57466078323709,39.03235541608627],[-94.57474369129585,39.03242809851896],[-94.57480409573863,39.03238485708068]]]},"properties":{"id":"St. Francis Xavier Church"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57151501542803,39.03292423985276],[-94.57133748256577,39.032919396176545],[-94.57133184858787,39.03302943092199],[-94.57151052617259,39.03303443249725],[-94.57151501542803,39.03292423985276]]]},"properties":{"id":"Campus Ministry Center"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57133184858787,39.03302943092199],[-94.57132503847693,39.033133258595875],[-94.57150408963523,39.03313923484835],[-94.57151052617259,39.03303443249725],[-94.57133184858787,39.03302943092199]]]},"properties":{"id":"Kateri Community Residence"}},\r
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-94.57286010900144,39.03328693338342],[-94.57283532620258,39.03371719964933],[-94.5732878874704,39.0337356369808],[-94.57330546295397,39.03329801918155],[-94.57286010900144,39.03328693338342]]]},"properties":{"id":"Prosperity Center for Financial Opportunity"}}\r
]}`,l$=`{"type":"GeometryCollection", "geometries": [\r
{"type":"Polygon","coordinates":[[[-94.5733601221702,39.033991702842954],[-94.57343057843688,39.032627336829854],[-94.57483618218124,39.03266045740923],[-94.57483618218124,39.03225653248882],[-94.57456975228335,39.031925844267924],[-94.57443769998508,39.031865057522765],[-94.5734766527032,39.03184416206704],[-94.5737667714431,39.02721317928421],[-94.57318118713299,39.027186419902776],[-94.5731396822614,39.02830719202791],[-94.5726236948803,39.02827994478758],[-94.57256476148764,39.028963612429386],[-94.5679483123955,39.02883237317173],[-94.56774097288552,39.032390935290124],[-94.5688957036816,39.03245419936561],[-94.57042657308332,39.032720791128675],[-94.57108453863592,39.03274057444863],[-94.57121364975842,39.03280827134139],[-94.57119428309004,39.03315176939054],[-94.57150092200602,39.03315929122695],[-94.57153965534276,39.03306150729117],[-94.57173977758268,39.03306652185526],[-94.57178173869748,39.03329719141926],[-94.57214002206244,39.033307220513656],[-94.57216584428696,39.0332119440594],[-94.57283722212401,39.03322949499484],[-94.57279848878727,39.033964123097064],[-94.5733601221702,39.033991702842954]]]}\r
]}`;function B_(n){return typeof n=="string"?n.replace(/^\uFEFF/,""):n}const c$=JSON.parse(B_(i$)),u$=JSON.parse(B_(o$)),h$=JSON.parse(B_(s$)),d$=JSON.parse(B_(a$)),f$=JSON.parse(B_(l$));function CC(n){return Array.isArray(n)?n[0]||{}:n||{}}const p$=CC(Wq),m$=CC(r$),UT={...p$,buildings:c$,boundary:u$,outdoorSpaces:h$},g$={...m$,buildings:d$,boundary:f$},y$={hastings:UT,"hastings-demo":UT,rockhurst:g$};function _$(n){return y$[n]}function ky({engagementMode:n=!1}){const{universityId:e,persona:t}=BP(),i=_$(e);return i?window.location.pathname.includes("/admin")?Y.jsx(Hq,{config:i,universityId:e}):Y.jsx(Gq,{config:i,universityId:e,persona:t,engagementMode:n}):Y.jsxs("div",{children:['Error: Configuration not found for "',e,'".']})}function v$(){return Y.jsx(w7,{basename:"/StakeholderMap",children:Y.jsxs(QP,{children:[Y.jsx(Wm,{path:"/:universityId/admin",element:Y.jsx(ky,{})}),Y.jsx(Wm,{path:"/:universityId/engagement",element:Y.jsx(ky,{engagementMode:!0})}),Y.jsx(Wm,{path:"/:universityId/:persona",element:Y.jsx(ky,{})}),Y.jsx(Wm,{path:"/:universityId/survey",element:Y.jsx(ky,{})}),Y.jsx(Wm,{path:"/:universityId",element:Y.jsx(ky,{})}),Y.jsx(Wm,{path:"/",element:Y.jsx("div",{children:"Please select a university by navigating to its URL (e.g., /hastings)"})})]})})}const x$=aP.createRoot(document.getElementById("root"));x$.render(Y.jsx(v$,{}));export{xa as _,b$ as c,Yv as g};
